[
  {
    "Is the adversary using file transfer protocols for command and control? (TA0011 - Command-And-Control)": {
      "Indicators": {
        "T1071.002 - File Transfer Protocols": {
          "Network traffic exhibiting uncommon data flows (e.g., large outbound data transfers via SMB/FTP) associated with internal systems.": {
            "Data": "Zeek conn.log, Zeek ftp.log, Zeek smb.log, Windows Event ID 4688",
            "Data Platform": "Network devices, Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Analyze Zeek conn.log, ftp.log, and smb.log. For internal source IPs, calculate the ratio of bytes_sent to bytes_received. Flag internal hosts with significantly high send/receive ratios (e.g., using IQR or percentile analysis on the ratio distribution) for SMB/FTP traffic. Correlate flagged network traffic with Windows Event ID 4688 to identify the initiating process."
          },
          "Network connections using file transfer protocols originating from processes not typically expected to use these protocols or showing protocol non-compliance.": {
            "Data": "Zeek conn.log, Zeek ftp.log, Zeek smb.log, Zeek dce_rpc.log, Windows Event ID 4688",
            "Data Platform": "Network devices, Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Zeek logs (conn.log, ftp.log, smb.log) for connections using file transfer ports (20, 21, 139, 445) or protocols. Cross-reference network connections with Windows Event ID 4688 (Process Creation) based on time and source/destination IP/Port to identify processes involved. Flag network activity by processes not typically associated with file transfers or analyze packet payloads (if available) for protocol anomalies or hidden data (e.g., using entropy measures on payload data or correlation analysis between expected and observed protocol fields)."
          }
        }
      }
    }
  }
]