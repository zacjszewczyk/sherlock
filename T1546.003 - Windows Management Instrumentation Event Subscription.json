[
  {
    "Is the adversary maintaining persistence using WMI Event Subscriptions? (TA0003 - Persistence)": {
      "Indicators": {
        "T1546.003 - Windows Management Instrumentation Event Subscription": {
          "Creation of new WMI EventFilter, EventConsumer, or FilterToConsumerBinding objects.": {
            "Data": "Windows Event ID 5861",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 5861 or other WMI activity logs for the creation of new EventFilter, EventConsumer, or FilterToConsumerBinding objects. Compare newly created subscriptions against a baseline of known legitimate subscriptions on the host or similar hosts. Flag any unexpected creations for investigation."
          },
          "Suspicious process execution originating from WmiPrvSe.exe.": {
            "Data": "Windows Event ID 4688",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 4688 or Sysmon Event ID 1 for processes spawned by WmiPrvSe.exe. Analyze the command line and executable of the child process. Flag any suspicious or unrecognized executables or scripts being launched by WmiPrvSe.exe, especially if they are not standard system processes. Use frequency analysis on spawned process names and command lines to identify rare occurrences."
          },
          "Changes or deletions to existing legitimate WMI event subscriptions.": {
            "Data": "Sysmon Event ID 19; Sysmon Event ID 20; Sysmon Event ID 21",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Sysmon Event IDs 19, 20, and 21 which capture WMI filter, consumer, and binding creation/deletion. Baseline known legitimate WMI subscriptions on hosts. Flag events showing deletion of previously baselined legitimate entries (Event IDs 19, 20, 21 with IsDelete=true) or creation events with content that significantly deviates from expected patterns (e.g., unusual command lines in consumers, unexpected query strings in filters) using string matching or correlation analysis against baseline."
          },
          "Creation of WMI event subscriptions triggering on frequent or non-specific system events combined with suspicious consumer actions.": {
            "Data": "Windows Event ID 5861; Sysmon Event ID 19; Sysmon Event ID 20",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 5861 and Sysmon Event IDs 19/20 for new WMI subscriptions. Analyze the WMI query string in EventFilter events (Sysmon ID 19) for suspicious or overly broad conditions (e.g., timer intervals < 60 seconds, '__InstanceCreationEvent'). Correlate with the command line in the associated EventConsumer (Sysmon ID 20) via the binding event (Win Event ID 5861) to identify subscriptions triggering frequently or on general events that execute suspicious commands. Use frequency analysis on filter queries and consumer command lines to identify outliers."
          }
        }
      },
      "version": "1.1",
      "last_updated": "2025-05-07"
    }
  },
  {
    "Is the adversary attempting to elevate privileges using WMI Event Subscriptions? (TA0004 - Privilege-Escalation)": {
      "Indicators": {
        "T1546.003 - Windows Management Instrumentation Event Subscription": {
          "Use of commands or cmdlets to register WMI event subscriptions (e.g., Register-WmiEvent, mofcomp.exe).": {
            "Data": "Windows Event ID 4688",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 4688 or Sysmon Event ID 1 for command-line arguments containing 'Register-WmiEvent' or 'mofcomp.exe'. Identify the parent process executing these commands. Flag any execution of these tools by non-administrative accounts or from unusual locations/processes. Use correlation analysis to link these executions to subsequent WMI event creation logs (Win Event ID 5861)."
          },
          "WMI event subscription bindings causing execution with SYSTEM privileges without clear administrative justification.": {
            "Data": "Windows Event ID 4688",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 4688 or Sysmon Event ID 1 for processes where WmiPrvSe.exe is the parent and the running user is SYSTEM. Analyze the child process executable and command line. Correlate with known legitimate SYSTEM processes spawned by WMI. Investigate any unusual processes running as SYSTEM spawned by WmiPrvSe.exe by analyzing frequency and uniqueness of the child process image path and command line."
          },
          "Process execution spawned by WmiPrvSe.exe that attempts to interact with sensitive system resources or perform actions requiring elevated privileges.": {
            "Data": "Windows Event ID 4688; Windows Event ID 5156",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 4688 for processes spawned by WmiPrvSe.exe, especially those running as SYSTEM. Analyze the command line and parent-child relationships. Correlate with network connection events (Windows Event ID 5156) showing connections to external IPs or internal sensitive systems. Flag processes spawned by WmiPrvSe.exe attempting network connections or accessing sensitive files using correlation analysis and frequency checks on destination IPs/ports."
          },
          "Execution of mofcomp.exe with suspicious MOF file paths or by non-standard processes.": {
            "Data": "Windows Event ID 4688; Sysmon Event ID 1",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 4688 or Sysmon Event ID 1 for execution of `mofcomp.exe`. Analyze the command line argument specifying the MOF file path. Flag executions where the MOF file is located in unusual directories (e.g., user profile directories, temporary folders, non-system paths) or executed by non-standard processes. Use frequency analysis on MOF file paths to identify rare locations."
          }
        }
      },
      "version": "1.1",
      "last_updated": "2025-05-07"
    }
  }
]