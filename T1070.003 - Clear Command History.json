[
  {
    "Is the adversary attempting to evade defenses by clearing command history? (TA0005 - Defense-Evasion)": {
      "Indicators": {
        "T1070.003 - Clear Command History": {
          "Absence of expected command history entries following user login or modification/deletion of user history files (~/.bash_history).": {
            "Data": "Windows Event ID 4688; Zeek exec.log",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 4688 (Process Creation) or Zeek exec.log for execution of commands associated with clearing or deleting history files (e.g., 'history -c', 'rm ~/.bash_history', 'del ConsoleHost_history.txt'). Correlate these events with successful remote login events (e.g., from Zeek conn.log for SSH) and analyze for unexpected sequences or timing."
          },
          "Suspicious modification or deletion of PowerShell history file (ConsoleHost_history.txt) or execution of the Clear-History command.": {
            "Data": "Windows Event ID 4104; Windows Event ID 4688",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 4104 (PowerShell Script Block Logging) for the execution of 'Clear-History'. Monitor Windows Event ID 4688 (Process Creation) for command lines attempting to delete or modify files matching '*ConsoleHost_history.txt'. Use time series analysis or frequency analysis to detect anomalous occurrences of these events for specific users or systems."
          },
          "Execution of non-standard processes that attempt to delete or modify known command history files.": {
            "Data": "Windows Event ID 4688; Windows Event ID 4663",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 4688 for processes whose command line or executable name attempts to delete or modify files matching history patterns ('*bash_history*', '*ConsoleHost_history.txt*'). Exclude known legitimate shell processes (e.g., `powershell.exe`, `cmd.exe`, `bash`). If using Windows Event ID 4663 (Object Accessed/Deleted), configure SACLs on history files (`%USERPROFILE%\.bash_history`, `%APPDATA%\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt`) and alert on deletions/modifications by unexpected Process IDs. Use frequency analysis to identify rare process executions performing file operations on history files."
          },
          "Execution of command history clearing utilities or commands with an unusual parent process.": {
            "Data": "Windows Event ID 4688",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 4688 for processes whose command line contains history clearing commands ('history -c', 'Clear-History', 'rm *bash_history', 'del *ConsoleHost_history.history.txt'). Analyze the ParentProcessId and ParentProcessName fields. Flag instances where the parent process is not a standard shell interpreter (e.g., `powershell.exe`, `cmd.exe`, `bash`). Use baseline analysis or statistical profiling of parent-child relationships to identify anomalies."
          }
        }
      },
      "version": "1.1",
      "last_updated": "2025-05-07"
    }
  }
]