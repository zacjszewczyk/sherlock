[
  {
    "Has the adversary accessed cloud instance metadata for credentials? (TA0006 - Credential Access)": {
      "Indicators": {
        "T1552.005 - Cloud Instance Metadata API": {
          "Network connections or process activity querying the Instance Metadata API IP address (169.254.169.254) from within a cloud instance.": {
            "Data": "Zeek conn.log, Windows Event ID 4688",
            "Data Platform": "Endpoints, Servers, Network devices",
            "NAI": "Insert site-specific NAI here",
            "Action": "Filter Zeek conn.log and relevant Windows Event IDs (e.g., Sysmon 3/4) for connections where destination IP is 169.254.169.254. Analyze source processes (Event ID 4688 parent/child relationships) and source IPs/ports. Look for connections from unexpected processes, users, or instances that haven't been authorized to interact with the metadata API. Use frequency analysis to identify rare source processes or instances connecting to the API."
          },
          "Network connections or access logs showing unusual or unauthorized requests targeting public-facing services that result in internal connections to the Instance Metadata API IP.": {
            "Data": "Zeek conn.log",
            "Data Platform": "Network devices",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Zeek conn.log for internal connections originating from public-facing application hosts where the destination is 169.254.169.254. Correlate these internal connections with external requests received by the public-facing service (if possible with available logs). Look for anomalous patterns in the external requests preceding the internal API calls (e.g., unusual query parameters, high volume from single source). Use correlation analysis to link suspicious external requests to internal API calls."
          }
        }
      }
    }
  }
]