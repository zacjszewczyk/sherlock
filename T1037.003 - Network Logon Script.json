[
  {
    "Is the adversary maintaining persistence via network logon scripts? (TA0003 - Persistence)": {
      "Indicators": {
        "T1037.003 - Network Logon Script": {
          "Modification of network logon script files by unusual accounts or at unusual times.": {
            "Data": "Windows Event ID 4656",
            "Data Platform": "Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 4656 for write/modify events on network logon script paths. Identify events initiated by service accounts or user accounts not part of the standard IT/Admin group. Analyze timestamp data for deviations from normal administration schedules using time series analysis or descriptive statistics on modification times."
          },
          "Execution of network logon scripts initiating abnormal processes or network connections upon user logon.": {
            "Data": "Windows Event ID 4688; Zeek conn.log",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 4688 for processes spawned directly by logon scripts (e.g., logon.bat, logon.vbs, logon.ps1). Correlate with Zeek conn.log for outbound connections from these processes to unusual or external destinations. Use correlation analysis between process creation events and network connections originating from processes tied to logon scripts."
          },
          "Discovery of newly created or unexpected network logon script files in standard locations.": {
            "Data": "Windows Event ID 4656",
            "Data Platform": "Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 4656 for file creation events in known network logon script directories (e.g., Netlogon shared folder on Domain Controllers). Identify events created by accounts outside of authorized administrators or standard processes. Use descriptive statistics on file creation timestamps to flag creations occurring outside normal business hours or IT maintenance windows, potentially using outlier detection methods like IQR."
          },
          "Logon scripts attempting to launch executable files from non-standard user directories or temporary folders upon user logon.": {
            "Data": "Windows Event ID 4688",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Analyze Windows Event ID 4688 focusing on processes whose ParentProcessName corresponds to known logon script interpreters (e.g., cmd.exe, powershell.exe, wscript.exe, cscript.exe) and whose command line arguments (`NewProcessCommandLine`) indicate execution of files from suspicious paths like temp directories, user downloads, or unexpected network shares. Use frequency analysis to identify uncommon parent-child process relationships involving logon script interpreters."
          }
        }
      },
      "version": "1.1",
      "last_updated": "2025-05-07"
    }
  },
  {
    "Is the adversary using network logon scripts for privilege escalation? (TA0004 - Privilege-Escalation)": {
      "Indicators": {
        "T1037.003 - Network Logon Script": {
          "Network logon scripts executing processes with elevated privileges (e.g., SYSTEM, Administrator) beyond the standard user context.": {
            "Data": "Windows Event ID 4688",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Analyze Windows Event ID 4688 for processes spawned by logon scripts. Examine the SubjectUserSid and NewProcessId fields. Identify instances where a script executed under a user context (e.g., regular user SID) spawns a process running with SYSTEM or Administrator privileges (indicated by the elevated process token or target process user context), which is highly unusual and indicates potential privilege escalation."
          },
          "Execution of network logon scripts triggering suspicious network connections or host activity not typical for legitimate logon scripts.": {
            "Data": "Windows Event ID 4688; Zeek conn.log",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 4688 for command-line arguments of processes spawned by logon scripts, looking for suspicious patterns (e.g., encoded commands, remote file downloads, direct interaction with security tools). Monitor Zeek conn.log for C2-like traffic patterns (e.g., beacons, large uploads/downloads) originating from processes tied to logon script execution using statistical methods like frequency analysis or entropy on connection timing/size."
          },
          "Logon scripts attempting to modify system registry keys or files that control startup processes or service configurations.": {
            "Data": "Windows Event ID 4656",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 4656 for write/modify operations targeting critical registry keys (e.g., HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run*) or system configuration files where the initiating process's parent is a logon script interpreter (correlate with Windows Event ID 4688). Filter for events where the SubjectUserSid indicates a standard user account attempting to modify objects usually requiring administrator privileges, flagging potential privilege escalation attempts via script modification."
          },
          "Logon scripts executing system utilities (like schtasks, sc, net localgroup) with parameters indicative of privilege escalation attempts.": {
            "Data": "Windows Event ID 4688",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Analyze Windows Event ID 4688 for processes whose ParentProcessName is a logon script interpreter and whose `NewProcessCommandLine` contains suspicious usage of system utilities known for privilege escalation, such as `schtasks /create /tn`, `sc create`, `net localgroup Administrators`, etc. Use pattern matching and frequency analysis on command line arguments to identify anomalous utility usage from logon scripts, paying close attention to arguments like `/ru SYSTEM` or `/rl HIGHEST`."
          }
        }
      },
      "version": "1.1",
      "last_updated": "2025-05-07"
    }
  }
]