[
    {
        "information_requirement": "Is the adversary using LNK icon smuggling for defense evasion?",
        "tactic_id": "TA0005",
        "tactic_name": "Defense Evasion",
        "indicators": [
            {
                "technique_id": "T1027.012",
                "name": "LNK Icon Smuggling",
                "evidence": [
                    {
                        "description": "An LNK file is created containing an icon path URL/IP/domain that matches a known malicious indicator from a threat intelligence feed.",
                        "data_sources": [
                            "Windows Event ID 4663",
                            "Zeek conn.log",
                            "Zeek http.log"
                        ],
                        "data_platforms": [
                            "Endpoints",
                            "Servers",
                            "Network devices"
                        ],
                        "nai": "Insert site-specific NAI here",
                        "action": "Upon detection of a new .lnk file creation (e.g., via Windows Event ID 4663 auditing), use an endpoint tool or script to parse the file and extract the icon location path. Inner join any URLs, domains, or IPs found in the icon path against a high-confidence threat intelligence feed (updated daily). Separately, monitor network logs (Zeek conn.log, http.log) for any connections to URLs/IPs/domains from this threat feed, especially if initiated by explorer.exe. Investigate all matches."
                    },
                    {
                        "description": "An LNK file is created with an icon path that follows a known malicious delivery pattern, such as pointing to a remote WebDAV share or an unusual local path.",
                        "data_sources": [
                            "Windows Event ID 4663"
                        ],
                        "data_platforms": [
                            "Endpoints",
                            "Servers"
                        ],
                        "nai": "Insert site-specific NAI here",
                        "action": "Upon detection of a new .lnk file creation (e.g., via Windows Event ID 4663 auditing), parse the file to extract the icon location path. Use regular expressions to search for suspicious structural patterns within the icon path, such as UNC paths pointing to external IPs (`\\\\\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\@SSL\\DavWWWRoot\\`), unusual protocols, or local paths pointing to temporary directories or application data folders that do not normally contain icons. Maintain and update a list of these malicious patterns."
                    },
                    {
                        "description": "The explorer.exe process initiates an outbound network connection, especially one that results in the download of an executable, DLL, or script file.",
                        "data_sources": [
                            "Windows Event ID 4688",
                            "Zeek conn.log",
                            "Zeek http.log",
                            "Zeek files.log"
                        ],
                        "data_platforms": [
                            "Endpoints",
                            "Servers",
                            "Network devices"
                        ],
                        "nai": "Insert site-specific NAI here",
                        "action": "Continuously monitor for any outbound network connections (Zeek conn.log) originating from an endpoint where the source process is identified as `explorer.exe`. This is highly anomalous behavior. Correlate these connections with file download events (Zeek files.log) to identify if a file was transferred, noting its MIME type and size. Use descriptive statistics to establish a baseline of normal `explorer.exe` activity (which should have zero external network connections) and alert on any deviation. Prioritize alerts where the downloaded file is an executable, DLL, or script."
                    },
                    {
                        "description": "A sequence of events occurs in a short timeframe: a new LNK file is written, followed by an anomalous network connection from explorer.exe, and then execution of a new or unsigned payload.",
                        "data_sources": [
                            "Windows Event ID 4663",
                            "Windows Event ID 4688",
                            "Zeek conn.log"
                        ],
                        "data_platforms": [
                            "Endpoints",
                            "Servers",
                            "Network devices"
                        ],
                        "nai": "Insert site-specific NAI here",
                        "action": "Define and monitor for a specific chain of events using correlation analysis with a narrow time window (e.g., under 2 minutes). The sequence is: 1) An LNK file is created (Windows Event ID 4663) in a user-browsable directory (e.g., Desktop, Downloads). 2) `explorer.exe` on the same host initiates an outbound network connection (Zeek conn.log). 3) A new process is created (Windows Event ID 4688) by `explorer.exe` or by a proxy execution binary (e.g., `rundll32.exe`). Use time series analysis to correlate these events based on hostname and timestamp. An alert on this full sequence is a high-fidelity indicator of behavior associated with LNK smuggling."
                    }
                ]
            }
        ],
        "version": "2.1",
        "date_created": "2025-05-04",
        "last_updated": "2025-07-20",
        "contributors": [
            "Zachary Szewczyk"
        ]
    }
]
