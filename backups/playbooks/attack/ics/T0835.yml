name: T0835: Manipulate I-O Image
id: a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d
description: An adversary may be manipulating the I/O image of a PLC to inhibit its response function. This involves using Modbus commands like 'Force Single/Multiple Coils' (Function Codes 5, 15) or 'Preset Single/Multiple Registers' (Function Codes 6, 16) to alter the state of the PLC's inputs and outputs. Detection focuses on identifying commands from unauthorized sources (IPs or processes), outside of normal operational windows, at an anomalous frequency, or writing values that are outside of pre-defined safe operational ranges or are statistical outliers compared to historical norms.
type: technique
related:
  - TA0107: Inhibit Response Function
contributors:
  - Zachary Szewczyk
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Has a Modbus 'Force Coil' command (Function Code 5 or 15) been executed from an unauthorized source, unapproved process, or outside a scheduled maintenance window?
    context: This question aims to detect explicit policy violations related to forcing PLC coil states. An adversary might use these commands to directly manipulate physical actuators (e.g., open/close a valve, start/stop a motor) from a compromised, non-standard system, by an unapproved software tool, or at an unusual time to disrupt a physical process without authorization. Detecting such violations is a primary indicator of malicious control system manipulation.
    answer_sources:
      - Zeek modbus.log
      - Zeek conn.log
      - Windows Event ID 4688
      - Windows Event ID 4624
      - Industrial Demilitarized Zone (IDMZ) network segments
      - Control Network segments (Level 3.5 and 3 of Purdue Model)
      - Process Control Network (PCN) segments (Level 2 of Purdue Model)
      - Engineering Workstation (EWS) endpoints
      - PLC network interfaces
    range: Last 90 days
    queries:
      - tech: pseudocode
        query: |
          SEARCH Zeek modbus.log WHERE function_code IN (5, 15)
          IF (source_ip NOT IN ews_allowlist) OR (timestamp NOT IN maintenance_window) THEN ALERT
          ELSE CORRELATE source_ip with Windows Event ID 4688 on EWS
          IF (process_name NOT IN approved_software_list) THEN ALERT
  - question: Is there an anomalous frequency of Modbus 'Force Coil' commands (Function Code 5 or 15) being sent to a specific PLC?
    context: This question focuses on identifying unusual patterns in command frequency. A sudden spike in 'Force Coil' commands, even from an otherwise authorized source, can indicate an automated attack script or a manual, frantic attempt to disrupt a process. By baselining normal operational traffic, we can detect deviations that suggest an adversary is repeatedly trying to manipulate a control state.
    answer_sources:
      - Zeek modbus.log
      - Zeek conn.log
      - Industrial Demilitarized Zone (IDMZ) network segments
      - Control Network segments (Level 3.5 and 3 of Purdue Model)
      - Process Control Network (PCN) segments (Level 2 of Purdue Model)
      - Engineering Workstation (EWS) endpoints
      - PLC network interfaces
    range: Last 90 days
    queries:
      - tech: pseudocode
        query: |
          BASELINE hourly count of commands (FC 5, 15) per (source_ip, dest_plc) over 30 days
          CALCULATE 99th_percentile_threshold
          SEARCH Zeek modbus.log WHERE function_code IN (5, 15)
          AGGREGATE hourly count per (source_ip, dest_plc)
          IF current_hourly_count > 99th_percentile_threshold THEN ALERT
  - question: Can a machine learning model classify a Modbus 'Force Coil' command (Function Code 5 or 15) as malicious based on its contextual features?
    context: This question leverages advanced analytics to detect subtle or complex malicious activities that might evade simpler rule-based or statistical methods. A machine learning model can learn the nuanced relationships between various features (source, destination, time, originating process) to identify sophisticated attacks that mimic legitimate traffic but are contextually anomalous, providing a higher-fidelity detection mechanism.
    answer_sources:
      - Zeek modbus.log
      - Zeek conn.log
      - Windows Event ID 4688
      - Windows Event ID 4624
      - Industrial Demilitarized Zone (IDMZ) network segments
      - Control Network segments (Level 3.5 and 3 of Purdue Model)
      - Process Control Network (PCN) segments (Level 2 of Purdue Model)
      - Engineering Workstation (EWS) endpoints
      - PLC network interfaces
    range: Last 90 days
    queries:
      - tech: pseudocode
        query: |
          FOR each Modbus command (FC 5, 15) in real-time:
          EXTRACT features: source_ip, dest_ip, function_code, coil_address, time_of_day, day_of_week
          ENRICH with ProcessName from correlated Windows logs
          INPUT features into trained ML model (Random Forest/Gradient Boosting)
          IF model_prediction == 'malicious' AND prediction_probability > 0.9 THEN ALERT
  - question: Has a Modbus 'Preset Register' command (Function Code 6 or 16) been executed from an unauthorized source, via an unapproved process, or with a value outside its safe operational range?
    context: This question targets the direct manipulation of critical process parameters stored in PLC registers (e.g., setpoints, timers, counters). An adversary could use these commands to push a system into an unsafe or unstable state. This query verifies three key aspects of legitimacy: the origin of the command, the software used to send it, and the safety of the value being written, providing a multi-layered defense against process manipulation.
    answer_sources:
      - Zeek modbus.log
      - Zeek conn.log
      - Windows Event ID 4688
      - Windows Event ID 4624
      - Process Control Network (PCN) segments (Level 2 of Purdue Model)
      - critical PLC backplanes
      - Engineering Workstation (EWS) endpoints
      - PLC network interfaces
    range: Last 90 days
    queries:
      - tech: pseudocode
        query: |
          SEARCH Zeek modbus.log WHERE function_code IN (6, 16)
          IF (source_ip NOT IN ews_allowlist) THEN ALERT
          ELSE CORRELATE source_ip with Windows Event ID 4688 to get ProcessName
          IF (process_name NOT IN approved_software_list) THEN ALERT
          ELSE IF (register_address IN critical_registers_list) AND (register_value NOT IN safe_range) THEN ALERT
  - question: Has a 'Preset Register' command (Function Code 6 or 16) written a value to a critical register that is a significant statistical deviation from its historical norm?
    context: This question aims to detect potentially dangerous register modifications that might not violate a hard-coded safe range but are statistically anomalous. By establishing a baseline of normal values for critical registers, we can identify when a new value, while perhaps technically permissible, is highly unusual and could represent an adversary's attempt to subtly alter a process. This method helps catch manipulations that fall into the 'gray area' of operational parameters.
    answer_sources:
      - Zeek modbus.log
      - Zeek conn.log
      - Process Control Network (PCN) segments (Level 2 of Purdue Model)
      - critical PLC backplanes
      - Engineering Workstation (EWS) endpoints
      - PLC network interfaces
    range: Last 90 days
    queries:
      - tech: pseudocode
        query: |
          FOR each critical register: BASELINE values over 30 days to get mean and standard_deviation
          SEARCH Zeek modbus.log WHERE function_code IN (6, 16) AND register_address is critical
          IF abs(new_register_value - historical_mean) > (3 * standard_deviation) THEN ALERT
  - question: Can an unsupervised machine learning model identify a 'Preset Register' command (Function Code 6 or 16) as a rare and potentially malicious anomaly?
    context: This question uses unsupervised learning to find 'unknown unknowns' in Modbus write activity. Unlike supervised models, an Isolation Forest or similar algorithm doesn't need pre-labeled malicious data. It identifies data points that are rare and different from the majority of normal traffic. This is effective for detecting novel attack techniques or unusual combinations of command parameters (source, destination, register, value, time) that don't fit any established pattern.
    answer_sources:
      - Zeek modbus.log
      - Zeek conn.log
      - Process Control Network (PCN) segments (Level 2 of Purdue Model)
      - critical PLC backplanes
      - Engineering Workstation (EWS) endpoints
      - PLC network interfaces
    range: Last 90 days
    queries:
      - tech: pseudocode
        query: |
          TRAIN Isolation Forest model on baseline of normal Modbus write activity (FC 6, 16)
          FOR each new write command:
          EXTRACT features: source_ip, dest_ip, register_address, register_value, time_of_day
          CALCULATE anomaly_score using the model
          IF anomaly_score is in the top 5th percentile THEN ALERT