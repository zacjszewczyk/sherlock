name: 'T0892: Change Credential'
id: '3a1b9c8d-4e5f-4a6b-8c7d-9e0f1a2b3c4d'
description: |
  This playbook helps answer the priority intelligence requirement: "Is an adversary attempting to inhibit response functions by changing credentials on critical ICS devices?". It focuses on detecting unauthorized credential changes on Industrial Control System (ICS) devices by monitoring for several key indicators. These include the anomalous use of ICS engineering software on Engineering Workstations (EWS), identified by unauthorized user accounts, unusual times, or strange source networks; the direct observation of specific ICS protocol commands (like S7COMM, Modbus, EtherNet/IP) in network traffic that are known to modify credentials; and correlated event sequences, such as a remote logon from a new IP, followed by the execution of ICS software, and then the transmission of a credential-change command.
type: 'technique'
related:
  - 'TA0107: Inhibit Response Function'
contributors:
  - 'Zachary Szewczyk'
  - 'Ask Sage'
created: '2025-10-01'
modified: '2025-10-01'
version: 1.0
tags: 'none'
questions:
  - question: 'Has monitored ICS engineering software been executed on a critical Engineering Workstation (EWS) by an unauthorized user account?'
    context: |
      This question aims to identify a clear policy violation. The execution of specialized ICS software by an account not explicitly authorized for such activity is a strong indicator of a potential compromise or insider threat. This is often a precursor to unauthorized changes, such as modifying device credentials.
    answer_sources:
      - 'Windows Event ID 4688'
      - 'Windows Event ID 4624'
      - 'Zeek conn.log'
      - 'Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Active Directory Servers, and network gateways within the Process Control Network (PCN) and DMZ.'
    range: 'last 90 days'
    queries:
      - 'search (EventID:4688 AND Host IN [EWS_List]) where ProcessName IN [Monitored_ICS_Software] and UserName NOT IN [Authorized_Users_for_Host]'
  - question: 'Has an authorized user executed ICS software or logged in remotely to an EWS from an unusual time or network location?'
    context: |
      This question focuses on detecting behavioral anomalies even from authorized users. An adversary might compromise a legitimate account. By baselining normal working hours and remote access locations, we can flag activity that deviates significantly from the user's established pattern, which could indicate that the account is being used maliciously.
    answer_sources:
      - 'Windows Event ID 4688'
      - 'Windows Event ID 4624'
      - 'Zeek conn.log'
      - 'Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Active Directory Servers, and network gateways within the Process Control Network (PCN) and DMZ.'
    range: 'last 90 days'
    queries:
      - |
        // Query 1: Time Anomaly
        search (EventID:4688 AND Host IN [EWS_List] AND UserName IN [Authorized_Users])
        compare event_hour to user_baseline_hour_profile
        alert if deviation > 2_std_dev
        
        // Query 2: Location Anomaly
        search (EventID:4624 AND LogonType:10 AND Host IN [EWS_List] AND UserName IN [Authorized_Users])
        compare source_ip to user_baseline_subnet_profile
        alert if source_ip NOT IN baseline_subnets
  - question: 'Has machine learning detected anomalous user activity on an EWS based on a combination of user, process, time, and location?'
    context: |
      This question leverages an unsupervised machine learning model (Isolation Forest) to find complex anomalies that simpler rules might miss. By combining multiple features like user, process, time, and network source information, the model can identify subtle deviations from normal, multi-dimensional patterns, providing a more robust method for detecting sophisticated credential compromise attempts.
    answer_sources:
      - 'Windows Event ID 4688'
      - 'Windows Event ID 4624'
      - 'Zeek conn.log'
      - 'Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Active Directory Servers, and network gateways within the Process Control Network (PCN) and DMZ.'
    range: 'last 90 days'
    queries:
      - |
        // Pseudocode for ML Model Inference
        stream (EventID:4688 OR (EventID:4624 AND LogonType:10))
        enrich with Source_IP_ASN and Country from Zeek_conn_log
        create feature_vector: [UserID, ProcessName, DayOfWeek, HourOfDay, SourceASN, SourceCountry]
        feed vector into pre-trained IsolationForestModel
        alert if model_output == "anomaly"
  - question: 'Has a known credential-modification command been observed in ICS network traffic, outside of a scheduled maintenance window?'
    context: |
      This question seeks to directly identify the core malicious action. Certain commands in protocols like S7COMM, Modbus, and EtherNet/IP are used to write or change credentials. Detecting these commands in live network traffic is a high-fidelity indicator of an attempt to inhibit response functions. Cross-referencing with a change management system helps reduce false positives by ignoring authorized changes.
    answer_sources:
      - 'Zeek conn.log'
      - 'Zeek s7comm.log'
      - 'Zeek modbus.log'
      - 'Zeek enip.log'
      - 'Network segments within the Process Control Network (PCN) where Engineering Workstations (EWS) communicate with Programmable Logic Controllers (PLCs), Remote Terminal Units (RTUs), or Intelligent Electronic Devices (IEDs), including network taps at aggregation switches and firewalls separating these zones.'
    range: 'last 90 days'
    queries:
      - |
        search (zeek.s7comm.function:0xf0 OR zeek.modbus.function:16 OR zeek.enip.command:'Set_Attribute_Single')
        where source_ip NOT IN [Authorized_Change_Management_IPs for current_time]
        alert on match
  - question: 'Has a statistically rare credential-modifying command been observed between an EWS and a controller?'
    context: |
      This question uses statistical analysis to find suspicious commands. Credential modifications are typically infrequent operations. By baselining the frequency of all commands between specific devices, the appearance of a command that is normally very rare (e.g., in the bottom 1% of frequency) becomes a significant anomaly, suggesting it is not part of routine operations.
    answer_sources:
      - 'Zeek conn.log'
      - 'Zeek s7comm.log'
      - 'Zeek modbus.log'
      - 'Zeek enip.log'
      - 'Network segments within the Process Control Network (PCN) where Engineering Workstations (EWS) communicate with Programmable Logic Controllers (PLCs), Remote Terminal Units (RTUs), or Intelligent Electronic Devices (IEDs), including network taps at aggregation switches and firewalls separating these zones.'
    range: 'last 90 days'
    queries:
      - |
        // Pseudocode for statistical check
        for each (EWS_IP, Controller_IP) pair:
          get 30-day baseline of function_code frequencies
          in 1-hour sliding window:
            check for new function_code
            if new_function_code IN [Credential_Mod_Codes] AND frequency < 1st_percentile_of_baseline:
              alert
  - question: "Has an anomalous change in the complexity or 'rhythm' of ICS command sequences been detected between an EWS and a controller?"
    context: |
      This question applies advanced machine learning to detect subtle changes in communication patterns. Normal operations have a certain 'rhythm' or level of complexity, which can be measured by entropy. An LSTM autoencoder learns this normal rhythm. A high reconstruction error indicates the current pattern is unlike anything seen before, which could be caused by a malicious, perhaps simplistic and repetitive, command sequence used in an attack.
    answer_sources:
      - 'Zeek conn.log'
      - 'Zeek s7comm.log'
      - 'Zeek modbus.log'
      - 'Zeek enip.log'
      - 'Network segments within the Process Control Network (PCN) where Engineering Workstations (EWS) communicate with Programmable Logic Controllers (PLCs), Remote Terminal Units (RTUs), or Intelligent Electronic Devices (IEDs), including network taps at aggregation switches and firewalls separating these zones.'
    range: 'last 90 days'
    queries:
      - |
        // Pseudocode for ML Model Inference
        for each (EWS_IP, Controller_IP) pair:
          stream function_codes in 5-min windows
          calculate shannon_entropy for each window
          feed entropy_value to pre-trained LSTM_Autoencoder
          calculate reconstruction_error
          alert if reconstruction_error > 98th_percentile_threshold
  - question: 'Has a multi-stage attack sequence been observed, consisting of a remote logon from an unauthorized IP, followed by ICS software execution, and culminating in a credential-change command?'
    context: |
      This question aims to detect a classic attack chain by correlating disparate events over time. A single event might be benign, but the specific sequence of (1) anomalous remote access, (2) execution of sensitive software, and (3) a credential modification command within a short timeframe is a very strong indicator of a targeted attack.
    answer_sources:
      - 'Windows Event ID 4624'
      - 'Windows Event ID 4688'
      - 'Zeek conn.log'
      - 'Zeek s7comm.log'
      - 'Zeek modbus.log'
      - 'Zeek enip.log'
      - 'Engineering Workstations (EWS), Active Directory/Authentication Servers, VPN concentrators, and network perimeter devices between the IT and OT networks.'
    range: 'last 90 days'
    queries:
      - |
        // Pseudocode for multi-stage SIEM rule
        trigger on (EventID:4624, LogonType:10, Host IN [EWS_List], SourceIP NOT IN [Allowlist]) as event1
        within 5 minutes on same Host and UserName:
          look for (EventID:4688, ProcessName IN [Monitored_ICS_Software]) as event2
        within next 10 minutes from same Host IP:
          look for (zeek.s7comm.function:0xf0 OR ...) as event3
        alert if event1 -> event2 -> event3 sequence completes
  - question: 'Has a user activity sequence (logon, process execution, command) generated an anomalously high composite risk score?'
    context: |
      This question moves beyond simple rules to a risk-based scoring model. Instead of alerting on a single condition, it aggregates risk from multiple factors (IP source rarity, time anomaly, process rarity, command rarity) into a single score. This allows for the detection of "risky" but not explicitly forbidden behavior. A sequence that accumulates a high total risk score, even if no single part of it violates a hard rule, is flagged for investigation.
    answer_sources:
      - 'Windows Event ID 4624'
      - 'Windows Event ID 4688'
      - 'Zeek conn.log'
      - 'Zeek s7comm.log'
      - 'Zeek modbus.log'
      - 'Zeek enip.log'
      - 'Engineering Workstations (EWS), Active Directory/Authentication Servers, VPN concentrators, and network perimeter devices between the IT and OT networks.'
    range: 'last 90 days'
    queries:
      - |
        // Pseudocode for risk scoring
        for each sequence (logon -> process -> command):
          risk1 = score_asn_rarity(logon.source_ip)
          risk2 = score_time_zscore(logon.time, user.baseline)
          risk3 = score_process_rarity(process.name, user.baseline)
          risk4 = score_command_rarity(command.code, device_pair.baseline)
          total_risk = w1*risk1 + w2*risk2 + w3*risk3 + w4*risk4
          alert if total_risk > 99th_percentile_threshold
  - question: 'Has a Graph Neural Network (GNN) identified an anomalous interaction pattern between users, workstations, and controllers?'
    context: |
      This question represents a cutting-edge approach using graph-based machine learning. By modeling the entire system of interactions as a graph, a GNN can learn the complex, high-level patterns of normal relationships and activities. It can then detect anomalies not just in single events or simple sequences, but in the overall structure of interactions (e.g., a user who normally interacts with Controller A suddenly sending commands to Controller C via an unusual EWS), providing a powerful tool against novel attack paths.
    answer_sources:
      - 'Windows Event ID 4624'
      - 'Windows Event ID 4688'
      - 'Zeek conn.log'
      - 'Zeek s7comm.log'
      - 'Zeek modbus.log'
      - 'Zeek enip.log'
      - 'Engineering Workstations (EWS), Active Directory/Authentication Servers, VPN concentrators, and network perimeter devices between the IT and OT networks.'
    range: 'last 90 days'
    queries:
      - |
        // Pseudocode for GNN inference
        stream events (logons, process_execs, commands)
        update interaction_graph with new nodes and edges (User, Host, Controller)
        enrich edges with attributes (timestamp, IP_geo, process, command_code)
        feed updated graph_snapshot to pre-trained GNN
        alert if GNN flags an anomalous edge or subgraph