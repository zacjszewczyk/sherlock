name: 'T0840: Network Connection Enumeration'
id: 'a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d'
description: 'This playbook addresses the MITRE ATT&CK for ICS technique T0840: Network Connection Enumeration. It provides investigative steps to determine if an adversary is attempting to discover communication patterns and device roles within an Industrial Control System (ICS) network. The playbook focuses on three main categories of evidence: 1) The anomalous execution of built-in network enumeration utilities (like netstat.exe or arp.exe) on critical endpoints such as HMIs and Engineering Workstations. 2) Network traffic patterns indicative of scanning, such as a single host connecting to an unusually high number of unique IPs or ports. 3) Unauthorized communication attempts using ICS-specific protocols (e.g., Modbus, DNP3, S7) from devices not on a pre-approved allow-list. The investigative questions within this playbook leverage a combination of rule-based logic, statistical baselining, and machine learning models to detect these activities.'
type: 'technique'
related:
  - 'TA0102: Discovery'
contributors:
  - 'Zachary Szewczyk'
  - 'Ask Sage'
created: '2025-10-01'
modified: '2025-10-01'
version: 1.0
tags: 'none'
questions:
  - question: 'Is a standard network enumeration utility (e.g., netstat.exe, arp.exe) being executed by an anomalous user or parent process on a critical ICS asset?'
    context: 'Adversaries often use built-in system utilities ("living off the land") to perform reconnaissance while avoiding the introduction of new, easily detectable malware. The execution of tools like netstat.exe or ipconfig.exe from an interactive command shell (cmd.exe, powershell.exe) or by a user account that is not a system or approved administrator on a critical asset (HMI, EWS) is highly indicative of manual, hands-on-keyboard discovery activity.'
    answer_sources:
      - 'Windows Event ID 4688'
      - 'Windows Event ID 4104'
      - 'Sysmon Event ID 1'
      - 'Endpoint devices of critical ICS assets (Engineering Workstations, HMIs, Historian Servers, Data Gateways, Operator Workstations)'
    range: 'last 90 days'
    queries:
      - 'SEARCH ProcessCreationEvents (Sysmon EID 1, Win EID 4688) OR PowerShellScriptBlock (Win EID 4104) on NAI assets. ALERT IF (ProcessName IN ["netstat.exe", "arp.exe", "nbtstat.exe", "ipconfig.exe", "route.exe"] AND ParentProcessName IN ["cmd.exe", "powershell.exe", "explorer.exe"] AND UserName is not a system or pre-approved admin account) OR (ScriptBlock CONTAINS "Get-NetTCPConnection" or "Get-NetNeighbor" and is not allow-listed).'
  - question: 'Has there been a statistically significant increase in the execution frequency of network enumeration utilities on critical ICS assets?'
    context: 'This question aims to detect automated or scripted reconnaissance that might not be caught by single-event rules. An adversary might run an enumeration tool repeatedly to gather information over time. By establishing a historical baseline of normal execution frequency for these utilities and then calculating the z-score for current activity, we can identify statistically significant deviations (e.g., $$ z > 3 $$) that point to an abnormal increase in enumeration activity.'
    answer_sources:
      - 'Windows Event ID 4688'
      - 'Windows Event ID 4104'
      - 'Sysmon Event ID 1'
      - 'Endpoint devices of critical ICS assets (Engineering Workstations, HMIs, Historian Servers, Data Gateways, Operator Workstations)'
    range: 'last 90 days'
    queries:
      - 'FOREACH host in NAI: CALCULATE 30-day historical baseline of hourly execution count for monitored utilities. CALCULATE z-score for current hourly count against the baseline. ALERT IF z-score > 3.'
  - question: 'Are there any process executions on critical ICS assets related to network enumeration that are anomalous based on a machine learning model?'
    context: 'This question uses an advanced, data-driven approach to find novel or evasive threats. Unsupervised anomaly detection models, such as an Isolation Forest, can learn the complex patterns of "normal" process activity by analyzing features like process name, parent process, user context, command-line arguments, and time of day. This allows the model to flag any process execution that it scores as a significant outlier, potentially revealing sophisticated enumeration techniques that bypass static rules.'
    answer_sources:
      - 'Sysmon Event ID 1'
      - 'Endpoint devices of critical ICS assets (Engineering Workstations, HMIs, Historian Servers, Data Gateways, Operator Workstations)'
    range: 'last 90 days'
    queries:
      - 'TRAIN Isolation Forest model on historical process creation data (Sysmon EID 1) using features like ProcessName, ParentProcessName, UserName, and command-line properties. SCORE new process executions with the model. ALERT IF a process is scored as a significant outlier.'
  - question: 'Is a host on a critical ICS network segment attempting to connect to an unusually high number of unique internal devices, possibly indicating a network scan?'
    context: 'This question seeks to identify classic network scanning behavior from within the OT network. A host connecting to many different internal IP addresses in a short time window is a strong indicator of a network sweep to find live hosts. The detection is made more robust by checking for a high ratio of failed or rejected connection attempts (e.g., TCP SYN scans), which are common during reconnaissance.'
    answer_sources:
      - 'Zeek conn.log'
      - 'Firewall Logs'
      - 'ICS network segments (Process Control Network - PCN), Network choke points between IT and OT networks (DMZ, Purdue Model Zone 3.5), SCADA/DCS networks'
    range: 'last 90 days'
    queries:
      - 'SEARCH network connection logs where source IP is in the NAI. AGGREGATE by source IP over a 5-minute window. ALERT IF count of unique destination IPs > 20 AND the ratio of connection states "S0", "REJ", or "RSTOS0" is > 80%.'
  - question: 'Is a host on an ICS network segment exhibiting network connection patterns that are statistically anomalous compared to its own historical baseline?'
    context: 'This question aims to detect more subtle scanning activity by defining "normal" on a per-host basis. Instead of a single fixed threshold, this method establishes a 30-day behavioral baseline for each host, tracking metrics like the count of unique destination IPs/ports and the Shannon entropy of destination IPs. An alert is triggered if a host''s current activity exceeds the 99th percentile of its own history, indicating a significant deviation from its typical communication patterns.'
    answer_sources:
      - 'Zeek conn.log'
      - 'Firewall Logs'
      - 'ICS network segments (Process Control Network - PCN), Network choke points between IT and OT networks (DMZ, Purdue Model Zone 3.5), SCADA/DCS networks'
    range: 'last 90 days'
    queries:
      - 'FOR EACH source host in the NAI, establish a 30-day baseline of metrics (unique destination IPs, unique destination ports, Shannon entropy of destination IPs) calculated in 5-minute windows. ALERT IF any current metric exceeds the 99th percentile of its historical baseline.'
  - question: 'Are there anomalous spikes in network enumeration activity from high-value assets that cannot be explained by normal operational cycles?'
    context: 'This question applies time-series forecasting to account for the predictable, cyclical nature of many ICS communications. A SARIMA model can learn the daily and weekly seasonality of a high-value asset''s network behavior. If the observed number of connections significantly exceeds the model''s forecasted upper confidence limit, it indicates an anomalous spike in activity that cannot be explained by normal operations, suggesting potential enumeration.'
    answer_sources:
      - 'Zeek conn.log'
      - 'Firewall Logs'
      - 'ICS network segments (Process Control Network - PCN), Network choke points between IT and OT networks (DMZ, Purdue Model Zone 3.5), SCADA/DCS networks'
    range: 'last 90 days'
    queries:
      - 'FOR EACH high-value asset, model the hourly count of unique destination IPs as a time series using a SARIMA algorithm. FORECAST the expected count and its upper 99% confidence bound. ALERT IF the observed count exceeds the forecasted upper bound.'
  - question: 'Is an unauthorized device attempting to communicate using an ICS-specific protocol within the Process Control Network?'
    context: 'This question provides a high-fidelity method for detecting illicit activity based on a strong network security posture. In a properly segmented ICS environment, all legitimate communications using industrial protocols (Modbus, DNP3, S7) should be known and documented. This query checks network logs against a version-controlled allow-list of approved communication tuples (Source IP, Destination IP, Port, Protocol). Any connection using an ICS protocol that does not match an entry on the allow-list is a strong indicator of a breach or serious misconfiguration.'
    answer_sources:
      - 'Zeek conn.log'
      - 'Zeek dnp3.log'
      - 'Zeek modbus.log'
      - 'Zeek s7comm.log'
      - 'Firewall Logs'
      - 'Process Control Network (PCN) subnets containing PLCs, RTUs, and other field controllers, ICS DMZ, Control Server segment'
    range: 'last 90 days'
    queries:
      - 'MAINTAIN an allow-list of authorized [Source_IP, Destination_IP, Destination_Port, Protocol] tuples. QUERY network logs for any connection where the tuple is NOT on the allow-list AND the destination port is a known ICS port (e.g., 502, 102, 20000) or the service is identified as an ICS protocol. ALERT on any match.'
  - question: 'Is a non-allow-listed device attempting to scan multiple hosts on the network using ICS-specific ports?'
    context: 'Building upon the allow-list concept, this question specifically looks for scanning behavior from an unauthorized device. While a single unauthorized connection might be an error, an unapproved device attempting to connect to more than one host on ICS-specific ports within an hour is a much stronger indication of malicious reconnaissance. This behavior suggests an adversary is actively searching for discoverable control systems.'
    answer_sources:
      - 'Zeek conn.log'
      - 'Zeek dnp3.log'
      - 'Zeek modbus.log'
      - 'Zeek s7comm.log'
      - 'Firewall Logs'
      - 'Process Control Network (PCN) subnets containing PLCs, RTUs, and other field controllers, ICS DMZ, Control Server segment'
    range: 'last 90 days'
    queries:
      - 'SEARCH network logs for traffic where the source IP is NOT on the PCN allow-list and the destination port is an ICS port. GROUP by the source IP over a 1-hour window. ALERT IF the count of unique destination hosts is greater than one.'
  - question: 'Are there any devices on the network exhibiting communication behaviors that are anomalous compared to all other devices, potentially indicating an unauthorized device performing enumeration?'
    context: 'This question uses unsupervised clustering (e.g., DBSCAN) to identify outlier devices based on their network behavior profile, without relying on a pre-built allow-list. By creating a feature vector for each host describing its communication patterns (e.g., protocol mix, connection states, data volume), the algorithm can group hosts with similar behaviors. Any host that does not fit into a defined cluster is flagged as an outlier, warranting investigation as a potentially unauthorized or compromised device performing enumeration.'
    answer_sources:
      - 'Zeek conn.log'
      - 'Zeek dnp3.log'
      - 'Zeek modbus.log'
      - 'Zeek s7comm.log'
      - 'Firewall Logs'
      - 'Process Control Network (PCN) subnets containing PLCs, RTUs, and other field controllers, ICS DMZ, Control Server segment'
    range: 'last 90 days'
    queries:
      - 'FOR EACH source host in the NAI, create a feature vector from its network activity over a 1-hour window (e.g., connection count, ratio of ICS ports, ratio of rejected connections). APPLY a clustering algorithm like DBSCAN to all host vectors. ALERT IF any host is classified as an outlier (cluster label -1).'