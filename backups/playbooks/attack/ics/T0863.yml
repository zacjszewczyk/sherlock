name: T0863: User Execution
id: f47ac10b-58cc-4372-a567-0e02b2c3d479
description: This playbook is designed to answer the question 'Has an adversary successfully tricked an ICS operator or engineer into executing malicious code?'. It focuses on detecting adversary actions related to the MITRE ATT&CK technique T0863: User Execution. The playbook provides investigative questions and queries to identify suspicious process creation events (Windows Event ID 4688), such as an Office application spawning a command-line interpreter, an executable running from a non-standard user-writable directory, or a process running with unexpectedly elevated privileges. These indicators are corroborated by analyzing process command lines for obfuscation, checking file hashes against reputation databases and software inventories, and correlating endpoint events with outbound network connections to unusual destinations as observed in network logs.
type: technique
related:
- TA0104: Execution
contributors:
- Zachary Szewczyk
- Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
- question: Is an approved Office or PDF application spawning a suspicious child process like a command-line interpreter or scripting engine with malicious-looking arguments or subsequent suspicious network activity?
  context: This question is crucial for detecting common phishing attack vectors where a user opens a malicious document that uses macros or exploits to run code. Monitoring for Office applications launching command shells and then checking for obfuscated commands or immediate network connections to untrusted destinations helps catch the initial stage of a compromise.
  answer_sources:
  - Windows Event ID 4688
  - Zeek conn.log
  - Zeek dns.log
  - Zeek files.log
  - Zeek pe.log
  - Endpoint devices within the ICS network, including Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Data Historians, and ICS DMZ servers; network traffic monitoring points at ICS zone boundaries and egress points.
  range: last 90 days
  queries:
  - technology: SIEM/Pseudocode
    query: |
      SEARCH WindowsEventID:4688
      WHERE ParentProcess IN ('winword.exe', 'excel.exe', 'powerpnt.exe', 'acrord32.exe')
      AND ChildProcess IN ('cmd.exe', 'powershell.exe', 'wscript.exe', 'cscript.exe', 'rundll32.exe')
      AND CommandLine CONTAINS ('/c', '-EncodedCommand', '-nop', '-w hidden', 'IEX', 'DownloadString')
      CORRELATE ChildProcessID with NetworkLogs
      WHERE ConnectionTime within 15s of ProcessCreationTime
      AND DestinationIP is not RFC1918 AND DestinationIP not in Whitelist
      CORRELATE DestinationDomain with ThreatIntel for reputation.
- question: Are there any instances of Office applications launching command-line interpreters with unusually high command-line entropy or command-line patterns that are rare for the environment?
  context: Adversaries often use obfuscation (like Base64) to hide their commands, which increases the character randomness, or entropy. This question helps identify hidden malicious commands that might evade simple keyword-based detection. Additionally, looking for rare or first-seen command-line patterns (statistical outliers) can uncover novel attack techniques that don't match any known signature.
  answer_sources:
  - Windows Event ID 4688
  - Zeek conn.log
  - Zeek dns.log
  - Zeek files.log
  - Zeek pe.log
  - Endpoint devices within the ICS network, including Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Data Historians, and ICS DMZ servers; network traffic monitoring points at ICS zone boundaries and egress points.
  range: last 90 days
  queries:
  - technology: Analytics/Pseudocode
    query: |
      FOR EACH EventID:4688 with ParentProcess as OfficeApp and ChildProcess as Interpreter:
        CALCULATE ShannonEntropy(CommandLine)
        IF ShannonEntropy > 4.5: ALERT
        COMPARE (ParentProcess, ChildProcess, CommandLine) against 90-day baseline
        IF combination is new OR frequency < 1st percentile: ALERT
        COMPARE CommandLineLength against 90-day baseline for same Parent/Child pair
        IF length > 99th percentile: ALERT
- question: Can an unsupervised machine learning model identify anomalous process creation events originating from Office applications, based on process attributes, command-line features, and executable properties?
  context: This question moves beyond simple rules to a more sophisticated, behavior-based detection method. An unsupervised model can learn what 'normal' process activity looks like in your specific ICS environment and flag deviations without prior knowledge of the attack. This is powerful for detecting zero-day exploits or customized adversary tools.
  answer_sources:
  - Windows Event ID 4688
  - Zeek conn.log
  - Zeek dns.log
  - Zeek files.log
  - Zeek pe.log
  - Endpoint devices within the ICS network, including Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Data Historians, and ICS DMZ servers; network traffic monitoring points at ICS zone boundaries and egress points.
  range: last 90 days
  queries:
  - technology: ML/Pseudocode
    query: |
      TRAIN IsolationForest model on historical data (30+ days) with features:
        ParentProcessName, NewProcessName, CommandLineLength, CommandLineEntropy, Imphash, PE section count
      APPLY model to new process events
      IF anomaly_score is high (e.g., top 0.5%):
        ALERT and enrich with network logs and file reputation
- question: Is an executable running from a non-standard or user-writable directory (like Downloads or Temp folders) that has a bad reputation, is not on the software inventory list, or is masquerading as a legitimate process?
  context: Legitimate software is typically installed in protected system directories. Adversaries often drop and execute payloads in user-writable locations like 'AppData' or 'Downloads' to bypass administrative privilege requirements. This question helps detect this common TTP by flagging executions from unusual locations and verifying the file's identity and integrity.
  answer_sources:
  - Windows Event ID 4688
  - Zeek conn.log
  - Zeek dns.log
  - Zeek x509.log
  - Zeek files.log
  - Zeek pe.log
  - Endpoint devices such as Engineering Workstations (EWS), HMIs, Maintenance Laptops, and Jump Boxes within ICS zones; network egress points from the ICS network; ICS DMZ network segments where software updates might be staged.
  range: last 90 days
  queries:
  - technology: SIEM/Pseudocode
    query: |
      SEARCH WindowsEventID:4688
      WHERE NewProcessPath MATCHES ('\\Users\\', '\\AppData\\', '\\ProgramData\\')
      AND NewProcessPath NOT IN (ApprovedInstallerPathWhitelist)
      IF ImageHash IN (ThreatIntelList) OR ImageHash NOT IN (SoftwareInventoryDB): ALERT
      IF OriginalFileName IS EMPTY or OriginalFileName != NewProcessName: ALERT
      CORRELATE ProcessID with NetworkLogs
      WHERE ConnectionTime within 30s AND DestinationIP NOT IN (ApprovedIPWhitelist): ALERT
- question: When a process runs from a user-writable directory, is it making network connections to rare destinations (ASNs or countries) or using unusual destination ports or command-line arguments compared to its historical behavior?
  context: This question adds behavioral context to the detection in the previous question. Even if a process itself isn't immediately identifiable as malicious, its network behavior can be a strong indicator. Connections to geographically unusual locations or to ports that the host doesn't normally use are highly suspicious and can indicate C2 communication or data exfiltration.
  answer_sources:
  - Windows Event ID 4688
  - Zeek conn.log
  - Zeek dns.log
  - Zeek x509.log
  - Zeek files.log
  - Zeek pe.log
  - Endpoint devices such as Engineering Workstations (EWS), HMIs, Maintenance Laptops, and Jump Boxes within ICS zones; network egress points from the ICS network; ICS DMZ network segments where software updates might be staged.
  range: last 90 days
  queries:
  - technology: Analytics/Pseudocode
    query: |
      FOR EACH process from user-writable directory with network connection:
        LOOKUP DestinationASN and Country
        IF ASN/Country frequency < 5th percentile for host group: ALERT
        COMPARE DestinationPort against 30-day baseline for host
        IF port is new for host: ALERT
        CALCULATE JaccardSimilarity(NewCommandLine, HistoricalCommandLines)
        IF score < 0.2: ALERT
- question: Can a supervised machine learning model classify process executions as benign, suspicious, or malicious based on a combination of file path, command-line features, process signature, and network connection attributes?
  context: This question aims to build a predictive model that automates the triage process. By training a model on known good and bad examples, it can learn the complex patterns that differentiate legitimate activity from malicious execution, even for subtle cases. This reduces analyst workload by automatically flagging high-risk events for investigation.
  answer_sources:
  - Windows Event ID 4688
  - Zeek conn.log
  - Zeek dns.log
  - Zeek x509.log
  - Zeek files.log
  - Zeek pe.log
  - Endpoint devices such as Engineering Workstations (EWS), HMIs, Maintenance Laptops, and Jump Boxes within ICS zones; network egress points from the ICS network; ICS DMZ network segments where software updates might be staged.
  range: last 90 days
  queries:
  - technology: ML/Pseudocode
    query: |
      TRAIN GradientBoosting model on labeled data with features:
        NewProcessPath (is_temp, is_user_dir), CommandLineEntropy, SignatureStatus, IPReputation, PortPrevalence, Imphash
      APPLY model to new process/connection pairs
      IF classification is 'suspicious' or 'malicious':
        ALERT and trigger enrichment (query related DNS and x509 logs)
- question: Has a process been executed with full elevated administrator privileges that is not on a strict whitelist of approved administrative tools for the ICS environment?
  context: Unauthorized privilege escalation is a critical event in an attack chain. In a controlled ICS environment, only a very specific set of applications should ever run with elevated rights. This question implements a high-fidelity rule to detect any deviation from this policy, which is a strong indicator of compromise or a serious misconfiguration.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 4624
  - All Windows-based ICS assets requiring strict change control, including Engineering Workstations, SCADA servers, Data Historians, and Domain Controllers in the process control network.
  range: last 90 days
  queries:
  - technology: SIEM/Pseudocode
    query: |
      SEARCH WindowsEventID:4688
      WHERE TokenElevationType == '%%1937'
      AND (NewProcessName, NewProcessPath, ImageHash) NOT IN (PrivilegedAppWhitelist)
      ALERT (High Priority)
      ENRICH with SubjectUserName and check if user is non-administrative.
- question: Is a user account running a privileged process they have never run before, is a privileged process being spawned by an unusual parent, or is there an anomalous spike in the number of privileged executions on a host?
  context: This question seeks to find anomalies in the usage of legitimate privileged tools. An attacker who has compromised a user account might use that account's privileges to run administrative tools in a way that is abnormal for that user. Baselining user behavior and overall system activity provides a powerful way to detect such misuse.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 4624
  - All Windows-based ICS assets requiring strict change control, including Engineering Workstations, SCADA servers, Data Historians, and Domain Controllers in the process control network.
  range: last 90 days
  queries:
  - technology: Analytics/Pseudocode
    query: |
      FOR EACH user:
        MAINTAIN 90-day baseline of privileged processes executed.
        IF user executes a new privileged process: ALERT
      FOR EACH privileged process execution:
        COMPARE ParentProcess against baseline for that process.
        IF parent is unusual (e.g., winword.exe): ALERT
      FOR EACH host:
        MONITOR daily count of privileged executions.
        IF daily_count > (14-day_moving_avg + 3 * stdev): ALERT
- question: Can a time-series anomaly detection model identify unusual patterns or spikes in the rate of privileged process executions over time, either for a specific host or a user role?
  context: This question applies advanced analytics to monitor the rhythm of administrative activity. Normal operations, including maintenance, often have a predictable cadence. A time-series model can learn this cadence and automatically flag periods of abnormal activity (e.g., a sudden surge in privileged executions at 3 AM) that might indicate an ongoing attack.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 4624
  - All Windows-based ICS assets requiring strict change control, including Engineering Workstations, SCADA servers, Data Historians, and Domain Controllers in the process control network.
  range: last 90 days
  queries:
  - technology: ML/Pseudocode
    query: |
      TRAIN Seasonal-Hybrid ESD model on 90+ days of aggregated counts of privileged executions (per host, per user role).
      APPLY model to detect anomalies in the time series.
      FOR EACH detected anomaly:
        CALCULATE risk score using a secondary model (features: user role, process path type, etc.)
        ALERT on high-risk anomalies.