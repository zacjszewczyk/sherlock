name: 'T0895: Autorun Image'
id: a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d
description: "This playbook helps investigate whether an adversary has leveraged Autorun functionality from removable media or mounted virtual disk images to execute malicious code on an ICS system. It focuses on identifying processes created from these sources shortly after they are mounted, looking for secondary evidence such as malicious file hashes, unsigned executables paired with 'autorun.inf' files, high-entropy filenames, or anomalous network behavior like connections to blocklisted IPs, unusual DNS queries, or high data egress volumes. The goal is to detect initial execution attempts originating from external media or images, which are common vectors for introducing malware into segmented ICS environments."
type: technique
related:
  - 'TA0104: Execution'
contributors:
  - Zachary Szewczyk
  - AI Assistant
created: '2025-10-01'
modified: '2025-10-01'
version: 1.0
tags: none
questions:
  - question: Has a process been executed from a removable device shortly after it was mounted, where the executable is a known threat or associated with an autorun.inf file?
    context: This question targets a classic attack vector where malware is introduced via physical media like USB drives. Correlating a device insertion event with a subsequent process creation from that same device provides a strong signal. The detection is further refined by checking if the process executable is a known threat (via hash matching against threat intelligence) or if it is an unsigned executable launched in conjunction with an 'autorun.inf' file, which is a hallmark of this technique.
    answer_sources:
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - Sysmon Event ID 11
      - Windows System Log Event ID 12
      - Windows System Log Event ID 1006
      - Zeek conn.log
      - Zeek files.log
      - Physical USB ports on Windows-based Human-Machine Interfaces (HMIs), Engineering Workstations (EWS), data historians, and any servers within the Process Control Network (PCN) or ICS DMZ. Includes endpoints used for device programming or maintenance updates.
    range: last 90 days
    queries:
      - search_technology: Pseudocode
        query: |
          SEARCH for removable device insertion events (e.g., Windows Event 12, 1006).
          JOIN with process creation events (e.g., Windows Event 4688, Sysmon Event 1) on the same host within 30 seconds.
          FILTER where the new process path is on a non-fixed drive.
          ALERT if the executable's hash matches a known malicious IOC OR if the executable is unsigned AND an 'autorun.inf' creation event (Sysmon Event 11) occurred on the same drive just prior.
  - question: Is a process with an unusually random filename being executed from removable media, followed by anomalous network beaconing?
    context: Attackers often use randomized or high-entropy filenames for their payloads to evade simple signature-based detections. This question focuses on identifying such behavior. A process launched from removable media with a statistically unusual filename is suspicious. This suspicion is greatly amplified if the host then begins making an abnormally high number of new, unique network connections, which can indicate command-and-control (C2) beaconing or scanning activity from the new payload.
    answer_sources:
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - Sysmon Event ID 11
      - Windows System Log Event ID 12
      - Windows System Log Event ID 1006
      - Zeek conn.log
      - Zeek files.log
      - Physical USB ports on Windows-based Human-Machine Interfaces (HMIs), Engineering Workstations (EWS), data historians, and any servers within the Process Control Network (PCN) or ICS DMZ. Includes endpoints used for device programming or maintenance updates.
    range: last 90 days
    queries:
      - search_technology: Pseudocode
        query: |
          SEARCH for process creation events originating from removable media.
          CALCULATE the Shannon entropy of the executable's filename.
          COMPARE entropy against a 30-day rolling baseline for the host class.
          ALERT if entropy exceeds the 98th percentile.
          ENRICH alert by monitoring network connections from the host for 5 minutes post-execution.
          ALERT if the count of new, unique destination IP:port pairs exceeds the 99th percentile of the host's normal hourly rate.
  - question: Does a process launched from removable media exhibit characteristics that a machine learning model identifies as malicious?
    context: This question leverages machine learning to detect threats that may not trigger simple, discrete rules. A binary classification model can be trained to recognize complex patterns of maliciousness based on a combination of features. By feeding it data points like the parent process, command-line length, executable path entropy, signature status, and whether it launched from removable media, the model can score new processes in real-time and identify suspicious activity that would be difficult for a human analyst to spot.
    answer_sources:
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - Sysmon Event ID 11
      - Windows System Log Event ID 12
      - Windows System Log Event ID 1006
      - Zeek conn.log
      - Zeek files.log
      - Physical USB ports on Windows-based Human-Machine Interfaces (HMIs), Engineering Workstations (EWS), data historians, and any servers within the Process Control Network (PCN) or ICS DMZ. Includes endpoints used for device programming or maintenance updates.
    range: last 90 days
    queries:
      - search_technology: Pseudocode
        query: |
          DEPLOY a trained binary classification model (e.g., Random Forest) to score new process creation events in real-time.
          ENGINEER features including parent process name, command-line length, executable path entropy, is_unsigned, and a boolean for launching from removable media within 30s of a mount event.
          ALERT on any process with a 'malicious' prediction probability > 0.85, with high priority if the process originated from removable media.
  - question: Has a process been executed from a newly mounted virtual disk on a VM, which then immediately connects to a known malicious IP address?
    context: Attackers may use malicious virtual disk images (.iso, .vhd, etc.) to compromise virtualized systems. This question looks for a high-confidence chain of events indicating this specific attack. The query correlates a virtual disk being attached to a VM, a process being launched from that new disk, and that same process making an outbound network connection to an IP address on a threat intelligence blocklist. A positive match is a strong indicator of compromise.
    answer_sources:
      - Hypervisor API logs (e.g., vSphere, Hyper-V)
      - Windows System Log Event ID 15
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - Sysmon Event ID 3
      - Sysmon Event ID 22
      - Zeek conn.log
      - Zeek dns.log
      - Zeek http.log
      - Virtualization hosts (hypervisors) managing guest VMs in the ICS DMZ or Process Control Network. Specific targets include virtualized HMIs, EWS, data historians, and domain controllers. Also includes VM templates, golden images, and network egress points monitoring traffic from the virtualization cluster.
    range: last 90 days
    queries:
      - search_technology: Pseudocode
        query: |
          SEARCH for hypervisor 'virtual disk attach' events.
          JOIN with guest OS disk initialization events (e.g., Windows Event 15) and process creation events (Sysmon Event 1) on the same VM within 60 seconds, where the process path is on the new disk volume.
          JOIN with subsequent network connection events (Sysmon Event 3, Zeek conn.log) from that new process.
          ALERT if the destination IP address exists on a threat intelligence blocklist.
  - question: Following a process execution from a new virtual disk, is the VM making DNS queries for unusual domains or exhibiting anomalous data exfiltration patterns?
    context: This question probes for suspicious post-execution network activity after a process is launched from a new virtual disk. Malicious payloads often communicate with novel C2 domains. A low Jaccard similarity score between newly queried domains and the VM's historical baseline indicates this. Additionally, a high ratio of outbound to inbound data volume is a classic sign of data exfiltration. Combining these network anomalies with the context of a recent virtual disk mount creates a strong signal of malicious activity.
    answer_sources:
      - Hypervisor API logs (e.g., vSphere, Hyper-V)
      - Windows System Log Event ID 15
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - Sysmon Event ID 3
      - Sysmon Event ID 22
      - Zeek conn.log
      - Zeek dns.log
      - Zeek http.log
      - Virtualization hosts (hypervisors) managing guest VMs in the ICS DMZ or Process Control Network. Specific targets include virtualized HMIs, EWS, data historians, and domain controllers. Also includes VM templates, golden images, and network egress points monitoring traffic from the virtualization cluster.
    range: last 90 days
    queries:
      - search_technology: Pseudocode
        query: |
          SEARCH for processes launched from a newly mounted virtual disk.
          For those processes, analyze subsequent DNS queries (Sysmon Event 22, Zeek dns.log) over the next 10 minutes.
          CALCULATE Jaccard similarity between the new set of domains and the VM's 30-day baseline.
          ALERT if similarity score is below 0.10.
          ANALYZE associated network flows (Zeek conn.log) and ALERT if the ratio of outbound/inbound bytes exceeds the 95th percentile for that VM.
  - question: Is a critical ICS VM exhibiting a cluster of anomalous behaviors (e.g., process creation, network activity, DNS queries) that coincides with a virtual disk mount event?
    context: This question proposes a sophisticated anomaly detection approach for high-value assets. It uses a multivariate model to learn the normal baseline of a system across several key metrics simultaneously (processes, network connections, data volume, DNS queries). The system alerts when a time window's activity, as a whole, is statistically anomalous. The alert is prioritized if the anomalous window coincides with a virtual disk mount, as this provides a likely explanation for the sudden change in system behavior.
    answer_sources:
      - Hypervisor API logs (e.g., vSphere, Hyper-V)
      - Windows System Log Event ID 15
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - Sysmon Event ID 3
      - Sysmon Event ID 22
      - Zeek conn.log
      - Zeek dns.log
      - Zeek http.log
      - Virtualization hosts (hypervisors) managing guest VMs in the ICS DMZ or Process Control Network. Specific targets include virtualized HMIs, EWS, data historians, and domain controllers. Also includes VM templates, golden images, and network egress points monitoring traffic from the virtualization cluster.
    range: last 90 days
    queries:
      - search_technology: Pseudocode
        query: |
          For critical ICS VMs, aggregate metrics into 1-minute time windows: count of process creations, count of network connections, total bytes sent, count of unique DNS queries, and a binary flag for a virtual disk mount in that window.
          TRAIN a multivariate time-series anomaly detection model (e.g., Isolation Forest) on a 30-day baseline of normal activity.
          SCORE new time windows in real-time.
          ALERT on any time window with an anomaly score in the top 1%, prioritizing alerts where the 'vdisk_mounted' flag is true.