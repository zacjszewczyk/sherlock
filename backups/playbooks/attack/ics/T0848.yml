name: T0848: Rogue Master
id: a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d
description: This playbook helps identify if an unauthorized device is acting as a master or control server on an Industrial Control System (ICS) network. This is achieved by monitoring for several key indicators of compromise: unauthorized IP addresses sending ICS write or control commands (e.g., Modbus, DNP3); outstations (PLCs/RTUs) initiating connections to non-approved master servers; a master server's IP address being associated with an incorrect MAC address, suggesting ARP spoofing; critical master server software services stopping unexpectedly outside of maintenance windows; and new, previously unseen devices appearing on the network and exhibiting master-like communication behavior.
type: technique
related:
  - TA0108: Initial Access
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Is an IP address not on the master whitelist sending ICS write commands?
    context: This question provides a direct, rule-based check for a high-fidelity indicator of a rogue master. An unauthorized device sending control commands (like Modbus function codes 5, 6, 15, or 16, or DNP3 'WRITE' commands) is a clear sign of a malicious or misconfigured device attempting to manipulate the industrial process. This check is crucial for immediate threat detection.
    answer_sources:
      - Zeek modbus.log
      - Zeek dnp3.log
      - Zeek conn.log
      - Network TAPs or SPAN ports on switches within the Process Control Network (PCN), specifically monitoring traffic to and from PLCs and RTUs, and at the boundary between the PCN and the Industrial DMZ.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          DEFINE master_whitelist = [list of authorized master IPs]
          FOR each event IN modbus.log or dnp3.log:
            IF event.source_ip NOT IN master_whitelist AND
               (event.modbus_function_code IN [5, 6, 15, 16] OR event.dnp3_function == 'WRITE'):
              TRIGGER high_severity_alert
  - question: Has there been a statistical anomaly in the number of unauthorized IPs sending ICS write commands, or is one IP sending a burst of commands?
    context: This question looks for broader anomalous patterns beyond a single unauthorized command. A sudden increase in the number of unique unauthorized devices attempting to control the process can indicate a widespread or automated attack. Likewise, a single unauthorized IP sending a high volume of commands in a short period suggests a targeted attempt to disrupt or manipulate a specific process.
    answer_sources:
      - Zeek modbus.log
      - Zeek dnp3.log
      - Network TAPs or SPAN ports on switches within the Process Control Network (PCN).
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          // Hourly count anomaly
          CALCULATE hourly count of unique unauthorized source IPs sending write commands.
          COMPARE count to 30-day rolling baseline (mean + 3*std_dev).
          IF count > baseline_threshold:
            TRIGGER medium_severity_alert

          // Burst detection
          FOR each unauthorized IP:
            COUNT write commands in 60-second window.
            IF count > 5:
              TRIGGER high_severity_alert
  - question: Does the behavior of a new, unauthorized source IP statistically deviate from the learned normal behavior of legitimate master servers?
    context: This question uses a more advanced, machine learning-based approach to detect sophisticated impersonation attempts. An attacker may try to blend in by mimicking legitimate traffic. A time-series anomaly detection model, trained on the normal patterns of authorized masters (e.g., command frequency, function code distribution), can identify subtle deviations and flag a new source IP as a statistical outlier, indicating a potential rogue master.
    answer_sources:
      - Zeek modbus.log
      - Zeek dnp3.log
      - Network TAPs or SPAN ports on switches within the Process Control Network (PCN).
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          APPLY pre-trained time-series model to features from live traffic (command volume, frequency, function codes).
          IF model flags a new, unauthorized source IP as a statistical outlier compared to learned behavior:
            TRIGGER high_severity_alert
  - question: Is an outstation (PLC/RTU) initiating connections to a destination IP/port not on its authorized master list?
    context: This question focuses on the behavior of outstations, which should have highly predictable and static communication patterns. An outstation initiating a connection to an unknown destination is a strong indicator of compromise, suggesting it may be controlled by a rogue master or exfiltrating data. This requires maintaining a strict whitelist of allowed destinations for each outstation.
    answer_sources:
      - Zeek conn.log
      - Network sensors (TAPs/SPANs) monitoring traffic from network segments containing outstations like PLCs and RTUs.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each outstation_ip:
            DEFINE whitelist = [list of (master_ip, master_port) tuples for this outstation]
            FOR each connection_event where source_ip == outstation_ip:
              IF (connection_event.destination_ip, connection_event.destination_port) NOT IN whitelist:
                TRIGGER high_severity_alert
  - question: Has an outstation shown a statistical increase in the number of unique master servers it connects to?
    context: This question helps detect less obvious deviations in an outstation's communication. An outstation suddenly communicating with more unique destination IPs than its established baseline, even if those IPs are legitimate masters for other parts of the network, could indicate lateral movement, network scanning, or an adversary attempting to find a vulnerable control point from a compromised outstation.
    answer_sources:
      - Zeek conn.log
      - Network sensors (TAPs/SPANs) monitoring traffic from network segments containing outstations.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each outstation_ip:
            CALCULATE daily count of unique destination IPs on ICS ports.
            ESTABLISH 7-day rolling baseline (mean, std_dev) for this count.
            IF daily_count > (mean + 3*std_dev):
              TRIGGER medium_severity_alert
  - question: Are there anomalous network connections involving outstations that fall outside of normal communication clusters?
    context: This question employs unsupervised machine learning to find "unknown unknowns" in network traffic. By clustering normal connections based on features like source/destination IPs and ports, protocol, and data volume, this method can identify novel connections that are statistical outliers. These outliers may represent new attack techniques or communication channels that would not be caught by pre-defined rules.
    answer_sources:
      - Zeek conn.log
      - Network sensors (TAPs/SPANs) monitoring traffic from network segments containing outstations.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          APPLY pre-trained clustering model (e.g., DBSCAN) to features of new connection events.
          IF model classifies a connection as an outlier or noise point:
            TRIGGER medium_severity_alert
  - question: Is a master server's IP address associated with an incorrect or unauthorized MAC address?
    context: This question directly investigates ARP spoofing or man-in-the-middle attacks. In a secure ICS environment, the IP-to-MAC address mapping for critical assets like master servers should be static. If network traffic shows a master's IP address being claimed by a different MAC address, it is a critical alert that an attacker may be trying to impersonate the master server to intercept or inject malicious traffic.
    answer_sources:
      - Zeek arp.log
      - Network sensors monitoring Layer 2 traffic on all subnets containing critical ICS assets.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          DEFINE ip_to_mac_map = {master_ip: authoritative_mac}
          FOR each event IN arp.log:
            IF event.type == 'reply' AND event.ip IN ip_to_mac_map:
              IF event.mac != ip_to_mac_map[event.ip]:
                TRIGGER critical_severity_alert
  - question: Is a master server's IP address rapidly changing its associated MAC address?
    context: This question looks for the behavioral symptoms of an ARP spoofing attack. An attacker attempting to poison ARP caches may cause a single IP address to be associated with multiple MAC addresses in a short time (MAC flapping). Monitoring for this instability, either by counting unique MACs per IP in a short window or by detecting a spike in the entropy of MAC addresses, can effectively identify such an attack in progress.
    answer_sources:
      - Zeek arp.log
      - Network sensors monitoring Layer 2 traffic on subnets with critical assets.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each master_ip:
            COUNT unique MACs associated with master_ip in a 5-minute rolling window.
            IF count > 1:
              TRIGGER high_severity_alert
  - question: Is there an anomalous spike in the volume of ARP traffic related to a master server's IP?
    context: This question aims to detect the "noise" generated by an ARP poisoning tool. Such tools often work by flooding the network with gratuitous ARP requests or replies. A time-series anomaly detection model can learn the normal, typically low, baseline of ARP activity for a master server's IP and trigger an alert when a sudden, anomalous spike in traffic volume occurs, indicating a potential attack.
    answer_sources:
      - Zeek arp.log
      - Network sensors monitoring Layer 2 traffic.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          APPLY pre-trained time-series model to the rate of ARP requests/replies for each master IP.
          IF model flags a sudden, anomalous spike in ARP volume:
            TRIGGER high_severity_alert
  - question: Did a critical master server software service stop running outside of a scheduled maintenance window?
    context: This question provides a direct check for potential disruption of a master server. An unexpected stop of a critical service (e.g., HMI Server, SCADA Runtime) can disable operator visibility and control over the industrial process. Correlating a service stop event (like Windows Event ID 7036) with a pre-defined maintenance schedule helps distinguish between legitimate administrative actions and potential sabotage.
    answer_sources:
      - Windows Event ID 7036
      - Centralized Windows Event Log collection for SCADA/HMI servers.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          DEFINE critical_services = [list of service names]
          DEFINE maintenance_windows = [list of time ranges]
          FOR each event WHERE EventID == 7036 AND ServiceName IN critical_services AND State == 'stopped':
            IF event.timestamp NOT IN maintenance_windows:
              TRIGGER high_severity_alert
  - question: Has there been an unusual frequency of stop events for a critical master server service?
    context: While some services may occasionally stop due to instability, any stoppage of a critical control system service is highly suspect. This question establishes a baseline for service stop events (which should be near zero for stable systems) and alerts on any deviation. An alert for more than one stop in a 24-hour period can help differentiate a single operational hiccup from a persistent problem or repeated attack.
    answer_sources:
      - Windows Event ID 7036
      - Centralized Windows Event Log collection for SCADA/HMI servers.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each critical_service:
            COUNT stop events (EventID 7036) in the last 24 hours.
            CALCULATE 30-day baseline mean for stop events.
            IF count > 1 OR count > (mean + 3*std_dev):
              TRIGGER high_severity_alert
  - question: Was a critical service stop event part of a larger sequence of events recognized as malicious?
    context: This question adds crucial context to a service stop event. A service stopping on its own might be an operational issue, but a service stop that occurs immediately after a remote login from an unusual IP and the execution of a suspicious process is almost certainly a malicious act. Sequence analysis models can be trained to recognize these known-bad chains of events and automatically connect the dots for the analyst.
    answer_sources:
      - Windows Event ID 7036 (Service Control Manager)
      - Windows Event ID 4624 (Logon)
      - Windows Event ID 4688 (Process Creation)
      - Centralized Windows Event Log collection.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          APPLY pre-trained sequence analysis model to event logs.
          IF model identifies a sequence as malicious (e.g., unusual logon -> suspicious process -> service stop):
            TRIGGER critical_severity_alert
  - question: Has a new, previously unseen device on the network started sending ICS master commands?
    context: This is a high-fidelity detection for a physically or remotely introduced rogue device. The appearance of a new, un-inventoried MAC address on the network which then immediately begins sending ICS control commands (e.g., Modbus writes) is a major red flag. This query correlates asset discovery data (from DHCP logs) with ICS protocol analysis.
    answer_sources:
      - Zeek dhcp.log
      - Zeek conn.log
      - Zeek modbus.log
      - Zeek dnp3.log
      - Network sensors monitoring DHCP and ICS protocol traffic.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          MONITOR dhcp.log for new MAC addresses not in asset inventory.
          FOR each new device IP:
            MONITOR modbus.log and dnp3.log for write/control commands from this IP.
            IF such a command is found:
              TRIGGER high_severity_alert
  - question: Has there been a statistical anomaly in the number of new MAC addresses appearing on the network?
    context: This question serves as a potential early warning for a larger event. A sudden influx of new, unknown MAC addresses on the Process Control Network, even before they exhibit malicious behavior, is highly abnormal. It could indicate a physical intrusion with multiple devices, a wireless attack, or an adversary spinning up multiple virtual machines on a compromised host.
    answer_sources:
      - Zeek dhcp.log
      - Zeek conn.log
      - Network sensors monitoring DHCP traffic on the PCN.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          MAINTAIN rolling 30-day inventory of all MACs.
          CALCULATE daily count of new MACs.
          CALCULATE 99th percentile of historical daily new MAC count.
          IF daily_count > 99th_percentile:
            TRIGGER medium_severity_alert
  - question: Has a new device been profiled as an unauthorized master server based on its network behavior?
    context: This advanced question uses machine learning to automatically classify or 'profile' a new device based on its overall traffic patterns (protocols used, connection frequency, destinations). If a new, un-inventoried device exhibits a network profile that closely matches the learned profile of a legitimate master server, it can be flagged for investigation even before it sends a specific malicious command.
    answer_sources:
      - Zeek dhcp.log
      - Zeek conn.log
      - Zeek modbus.log
      - Zeek dnp3.log
      - Network sensors on the PCN.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          WHEN new device is detected:
            APPLY device profiling model to its network traffic.
            IF device is classified as 'unknown' or its profile matches 'master server':
              APPLY second-stage anomaly detection to its ICS traffic.
              IF anomalies are found:
                TRIGGER alert