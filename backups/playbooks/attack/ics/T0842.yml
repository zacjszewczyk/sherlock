name: T0842: Network Sniffing
id: d1e8f2c3-a4b5-4c6d-8e9f-0a1b2c3d4e5f
description: This playbook helps investigate whether an adversary is attempting to discover information about the Industrial Control System (ICS) network topology, protocols, or credentials by sniffing network traffic. This involves looking for evidence of known sniffing tools, anomalous network scanning behavior from ICS hosts, cleartext transmission of sensitive ICS commands or credentials, and signs of ARP or DNS spoofing to intercept traffic.
type: technique
related:
  - TA0102: Discovery
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Is a known network sniffing tool, driver, or library being executed or installed on a critical ICS asset?
    context: Adversaries often use well-known network sniffing tools (e.g., Wireshark, tcpdump) or their associated libraries (e.g., wpcap.dll) to capture network traffic. Detecting the execution, installation, or loading of these components on critical systems like Engineering Workstations (EWS) or Human-Machine Interfaces (HMIs) provides a high-fidelity indicator of reconnaissance activity.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 7045
      - Sysmon Event ID 1
      - Sysmon Event ID 7
      - Data from: Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Data Historians, and other Windows-based systems within the Process Control Network (PCN) and Manufacturing Zone.
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: SEARCH (ProcessCreationEvents OR ServiceInstallEvents OR ImageLoadEvents) WHERE (AssetType IN CriticalICSAssets) AND (ImageName IN SnifferToolWatchlist OR DriverName IN SnifferDriverWatchlist OR LibraryName IN SnifferLibraryWatchlist)
  - question: Has a critical ICS asset exhibited an anomalous number of new process creations or loaded unexpected DLLs?
    context: ICS environments are typically stable, with predictable software execution patterns. A sudden spike in new, non-allowlisted processes or the loading of unusual DLLs by critical applications can indicate the introduction of unauthorized software. This is a behavioral approach to detect custom or obfuscated sniffers that may not be on a known watchlist.
    answer_sources:
      - Sysmon Event ID 1
      - Sysmon Event ID 7
      - Data from: Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Data Historians, and other Windows-based systems within the Process Control Network (PCN) and Manufacturing Zone.
    range: last 14 days
    queries:
      - search_technology: pseudocode
        query: FOR each CriticalICSAsset, COMPARE DailyNewProcessCount against 14-day baseline. ALERT if count > 98th_percentile. THEN, COMPARE LoadedDLLs against application baseline. ALERT on new, unexpected DLLs.
  - question: Has a machine learning model identified any process creations on ICS assets as suspicious or sniffer-like?
    context: This question uses machine learning to detect advanced or evasive sniffing tools that might bypass signature or simple behavioral checks. By analyzing features like process name entropy (randomness), parent process lineage, and command-line arguments, a model can flag potentially malicious activity that appears benign at first glance.
    answer_sources:
      - Sysmon Event ID 1
      - Data from: Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Data Historians, and other Windows-based systems within the Process Control Network (PCN) and Manufacturing Zone.
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: SCORE ProcessCreationEvents from ICSAssets using ML_Model. ALERT on processes classified as 'suspicious_sniffer_like'.
  - question: Is an ICS asset violating the established network communication policy?
    context: In a well-architected OT environment, communication paths are predictable and restricted. A strict policy should define which assets can talk to each other and over which ports. Any connection that violates this policy, such as an HMI communicating with an external IP address, is highly suspicious and could indicate an adversary redirecting traffic or exfiltrating captured data.
    answer_sources:
      - Zeek conn.log
      - Data from: Network segments connecting PLCs, RTUs, and SCADA servers; network choke points between the IT and OT networks; switch port mirror/SPAN sessions on critical ICS segments.
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: SEARCH ZeekConnectionLogs WHERE (Connection tuple NOT IN ApprovedPolicyList) AND (SourceAssetType IN CriticalICSAssets).
  - question: Is any ICS host communicating with an abnormally high number of unique destinations or using an unusual distribution of ports?
    context: Network sniffing is often followed by network scanning to discover other hosts. This behavior manifests as a "fan-out" where one host connects to many other unique IP addresses. By baselining the normal hourly fan-out and destination port entropy for each host, we can detect deviations that suggest an adversary is actively exploring the network.
    answer_sources:
      - Zeek conn.log
      - Data from: Network segments connecting PLCs, RTUs, and SCADA servers; network choke points between the IT and OT networks; switch port mirror/SPAN sessions on critical ICS segments.
    range: last 30 days
    queries:
      - search_technology: pseudocode
        query: FOR each CriticalICSHost, COMPARE hourly UniqueDestinationIPCount against 30-day baseline. ALERT if count > 99th_percentile.
  - question: Has a time-series anomaly detection model flagged any host's network activity as a deviation from its normal communication profile?
    context: This question leverages a sophisticated machine learning model to create a holistic profile of a host's normal network behavior over time. The model considers multiple features simultaneously (e.g., connection counts, protocol mix, data volume). An alert is generated when a host's current activity no longer matches its learned profile, which can detect subtle or complex sniffing and scanning patterns.
    answer_sources:
      - Zeek conn.log
      - Data from: Network segments connecting PLCs, RTUs, and SCADA servers; network choke points between the IT and OT networks; switch port mirror/SPAN sessions on critical ICS segments.
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: FOR each host, INPUT hourly feature vector into LSTM_Autoencoder. ALERT if reconstruction_error > dynamic_threshold.
  - question: Are unauthorized ICS function codes or unapproved administrative protocols being used on the network?
    context: An adversary who has successfully sniffed the network may attempt to interact with ICS devices using captured information. This can involve sending specific function codes (e.g., Modbus 'Write Single Coil') that are not part of normal operations or using insecure administrative protocols like Telnet or FTP. Alerting on these policy violations can catch an adversary's attempt to move from passive sniffing to active manipulation.
    answer_sources:
      - Zeek modbus.log
      - Zeek dnp3.log
      - Zeek ftp.log
      - Zeek telnet.log
      - Data from: Data historians, SCADA servers, and network segments carrying administrative or industrial protocol traffic; DMZ segments for external ICS access.
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: SEARCH (ZeekModbusLogs OR ZeekDNP3Logs) WHERE FunctionCode NOT IN ApprovedList. SEARCH (ZeekFTPLogs OR ZeekTelnetLogs) WHERE ConnectionTuple NOT IN ApprovedAdminList.
  - question: Has any unencrypted protocol session shown a significant deviation in duration or data volume compared to its normal baseline?
    context: After gaining a foothold, an adversary might use existing unencrypted channels to exfiltrate large amounts of captured data. This would likely result in a session that is significantly longer or involves a much larger data transfer than usual. By baselining the normal duration and byte count for these sessions, we can spot outliers that could represent data theft.
    answer_sources:
      - Zeek conn.log
      - Data from: Data historians, SCADA servers, and network segments carrying administrative or industrial protocol traffic; DMZ segments for external ICS access.
    range: last 30 days
    queries:
      - search_technology: pseudocode
        query: FOR each SessionType, COMPARE SessionDuration and SessionBytes against 30-day baseline. ALERT if value > (mean + 3 * stdev).
  - question: Has an unsupervised clustering model identified any unencrypted communication sessions as anomalous outliers?
    context: This approach uses machine learning to find "unknown unknowns." By clustering all unencrypted sessions based on features like duration, data volume, and commands used, we can identify sessions that do not fit into any normal group. These outliers are anomalous by definition and warrant investigation, as they could represent a novel attack or exfiltration method.
    answer_sources:
      - Zeek conn.log
      - Zeek protocol-specific logs (e.g., ftp.log)
      - Data from: Data historians, SCADA servers, and network segments carrying administrative or industrial protocol traffic; DMZ segments for external ICS access.
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: APPLY DBSCAN clustering to all unencrypted sessions based on features (duration, bytes, commands). ALERT on any session classified as an outlier.
  - question: Has a critical ICS asset's IP address been re-mapped to an unauthorized MAC address, or has an internal resource's DNS name resolved to an external IP?
    context: This is a direct check for man-in-the-middle (MITM) attacks like ARP spoofing or DNS poisoning. If an attacker remaps a gateway's IP to their own MAC address, they can intercept all traffic passing through it. Similarly, poisoning a DNS entry can redirect a legitimate connection to a malicious server. Alerting on these events is critical for detecting traffic interception attempts.
    answer_sources:
      - Zeek arp.log
      - Zeek dns.log
      - Zeek notice.log
      - Data from: Local network segments within the Process Control Network (PCN), especially those containing EWS, HMIs, and PLCs; DNS servers and resolvers serving the OT environment.
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: SEARCH ZeekARPLogs WHERE (IP IN CriticalAssetIPs) AND (MAC NOT IN ApprovedMACList). SEARCH ZeekDNSLogs WHERE (Query IN InternalDomains) AND (Answer IN ExternalIPRange).
  - question: Are there any new, un-mapped IP-to-MAC address pairings, or is any host generating an unusual number of DNS 'not found' errors?
    context: This is a behavioral approach to detect spoofing. In a stable OT network, the mapping of IPs to MAC addresses (hardware) should be static. A new, unexpected pairing is a strong indicator of a new or spoofed device on the network. A spike in NXDOMAIN (not found) errors from a host could indicate it is compromised and attempting to contact C2 domains using a domain generation algorithm.
    answer_sources:
      - Zeek arp.log
      - Zeek dns.log
      - Data from: Local network segments within the Process Control Network (PCN), especially those containing EWS, HMIs, and PLCs; DNS servers and resolvers serving the OT environment.
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: SEARCH ZeekARPLogs for any new IP-MAC pair not in the known map. ALERT. FOR each host, COMPARE daily NXDOMAIN count to baseline. ALERT if count > 99th_percentile.
  - question: Has a graph-based anomaly detection model detected suspicious structural changes in the network communication graph?
    context: This advanced technique models the entire network as a graph of nodes (IPs, MACs, domains) and edges (communications). It learns the normal structure and flags significant changes, such as a critical IP node suddenly connecting to a new, unknown MAC node (potential ARP spoof) or a host connecting to a completely separate and new part of the graph (potential DNS compromise). This provides a holistic view of structural anomalies indicative of MITM attacks.
    answer_sources:
      - Zeek arp.log
      - Zeek dns.log
      - Data from: Local network segments within the Process Control Network (PCN), especially those containing EWS, HMIs, and PLCs; DNS servers and resolvers serving the OT environment.
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: INPUT network events into GraphModel. ALERT on structural changes with a high anomaly score (e.g., new edge between critical_IP_node and unknown_MAC_node).