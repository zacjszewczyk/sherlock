name: T1048.002: Exfiltration Over Asymmetric Encrypted Non-C2 Protocol
id: 1e9a3b8f-4c7d-4e9a-9f1b-2c3d4e5f6a7b
description: This playbook helps to determine if an adversary is exfiltrating data from the network over an encrypted, non-C2 channel. This involves detecting outbound encrypted connections to known malicious destinations, identifying connections that use suspicious TLS certificates (e.g., self-signed, short validity) coupled with high-volume data transfers, and flagging when the volume of outbound data from a host significantly exceeds its historical baseline. Further indicators include observing highly asymmetric data flows where outbound data vastly exceeds inbound data, and tracing large outbound encrypted transfers back to processes that are unapproved, running from non-standard locations, or are known dual-use tools.
type: technique
related:
  - TA0010: Exfiltration
contributors:
  - Zachary Szewczyk
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Are any internal hosts establishing encrypted connections with external destinations known to be malicious?
    context: This question aims to detect direct communication with known adversary infrastructure. By joining network connection, DNS, and SSL logs and comparing destination indicators (IP, domain, SNI) against a threat intelligence feed, analysts can identify high-confidence malicious activity, such as C2 communication or data exfiltration to a known bad location.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Zeek ssl.log
      - Internet Gateway/Egress Points
      - Internal DNS Resolvers
      - Outbound Web Proxies
    range: last 90 days
    queries:
      - technology: pseudocode
        query: JOIN conn.log, dns.log, ssl.log ON uid; CHECK destination_ip, dns_query, server_name AGAINST threat_intel_feed; ALERT on match;
  - question: Are any internal hosts sending a large amount of data to rare or newly observed external destinations?
    context: Adversaries often use unique, short-lived domains for data exfiltration. This question identifies such behavior by focusing on destinations that are not commonly visited across the organization. Correlating this rarity with unusually high outbound data volumes helps distinguish potential exfiltration from benign, uncommon web traffic.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Zeek ssl.log
      - Internet Gateway/Egress Points
      - Internal DNS Resolvers
      - Outbound Web Proxies
    range: last 90 days
    queries:
      - technology: pseudocode
        query: CALCULATE frequency of each destination_ip/domain; IDENTIFY rare destinations (<1% of hosts); CHECK if rare destination has high outbound_bytes (top 5th percentile); ALERT on match;
  - question: Can we predict if a new encrypted connection is malicious based on its network characteristics?
    context: This question leverages machine learning to proactively identify malicious connections that may not yet be on a threat intelligence list. By training a model on known malicious and benign connection attributes (like JA3/JA3S hashes, certificate data, and traffic stats), the system can classify new, unseen connections and alert on those that exhibit malicious patterns with high confidence.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Zeek ssl.log
      - Internet Gateway/Egress Points
      - Internal DNS Resolvers
      - Outbound Web Proxies
    range: last 90 days
    queries:
      - technology: pseudocode
        query: EXTRACT features (JA3, JA3S, cert_details, conn_stats) from new connection; INPUT features into trained classification model; ALERT if model predicts 'malicious' with high confidence;
  - question: Are there any high-volume outbound data transfers using self-signed TLS certificates?
    context: Legitimate services typically use certificates signed by a trusted Certificate Authority. An adversary may use a self-signed certificate for an exfiltration channel. This question looks for the combination of a self-signed certificate and a large data transfer (e.g., >10MB), which is a strong indicator of suspicious activity.
    answer_sources:
      - Zeek conn.log
      - Zeek ssl.log
      - Internet Gateway/Egress Points
      - Endpoints initiating TLS traffic
    range: last 90 days
    queries:
      - technology: pseudocode
        query: FILTER ssl.log for validation_status = 'self-signed certificate'; JOIN with conn.log on uid; ALERT if outbound_bytes > 10MB;
  - question: Are any outbound TLS connections exhibiting multiple anomalous certificate attributes and a high data upload-to-download ratio?
    context: This question seeks to identify suspicious connections by scoring multiple weak indicators. An anomaly score is calculated based on certificate properties like being self-signed, having low-entropy names, or a short validity period. A high score, combined with a data flow ratio that heavily favors uploads (e.g., 10:1), strongly suggests data exfiltration rather than normal browsing.
    answer_sources:
      - Zeek conn.log
      - Zeek ssl.log
      - Internet Gateway/Egress Points
      - Endpoints initiating TLS traffic
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SCORE TLS connections on cert_attributes (self-signed, name_entropy, validity_duration); ALERT if score > 98th percentile AND (outbound_bytes / inbound_bytes) > 10;
  - question: Can we detect anomalous TLS connections based on their certificate characteristics, especially when correlated with large data uploads?
    context: This question uses unsupervised machine learning to find outliers without pre-existing labels. An anomaly detection model, such as an Isolation Forest, is trained on normal TLS certificate features. Connections that the model flags as anomalous, especially when they are also associated with a large volume of outbound data, are prime candidates for investigation as potential exfiltration channels.
    answer_sources:
      - Zeek conn.log
      - Zeek ssl.log
      - Internet Gateway/Egress Points
      - Endpoints initiating TLS traffic
    range: last 90 days
    queries:
      - technology: pseudocode
        query: TRAIN anomaly detection model on ssl.log features; IDENTIFY outliers; CORRELATE outliers with high outbound_bytes from conn.log; ALERT on match;
  - question: Are there any single, unusually large outbound data transfers to external destinations?
    context: This question aims to catch blatant, large-scale data exfiltration in a single session. By setting a high static threshold (e.g., 500MB) for outbound data and filtering out traffic to sanctioned corporate services, analysts can quickly spot and investigate significant data transfers that are not part of normal business operations.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Zeek ssl.log
      - Internet Gateway/Egress Points
      - High-Value Asset Servers
      - User Workstations
    range: last 90 days
    queries:
      - technology: pseudocode
        query: FILTER conn.log for outbound_bytes > 500MB; EXCLUDE connections to approved corporate services; ALERT on remaining connections;
  - question: Is any host sending significantly more data to an external destination than it has historically?
    context: This question establishes a behavioral baseline for each host's communication patterns. By calculating the mean and standard deviation of outbound data volume for each host-destination pair over a 30-day period, it can automatically detect when a host suddenly starts sending an anomalous amount of data (e.g., >3 standard deviations above the mean), indicating a potential data breach.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Zeek ssl.log
      - Internet Gateway/Egress Points
      - High-Value Asset Servers
      - User Workstations
    range: last 90 days
    queries:
      - technology: pseudocode
        query: FOR each host-destination pair, CALCULATE 30-day rolling baseline (mean, std_dev) of outbound_bytes; ALERT if today's outbound_bytes > (mean + 3 * std_dev);
  - question: Is any host exhibiting a sudden, unpredicted spike in its total outbound data volume?
    context: This question uses time series forecasting to model the normal rhythm of a host's outbound data traffic. A model like ARIMA or Prophet can predict the expected volume for a given day. An alert is triggered if the actual observed volume significantly exceeds the prediction, catching sudden data staging or exfiltration events that break from established patterns.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Zeek ssl.log
      - Internet Gateway/Egress Points
      - High-Value Asset Servers
      - User Workstations
    range: last 90 days
    queries:
      - technology: pseudocode
        query: FOR each host, APPLY time series model to daily outbound_bytes; ALERT if observed_volume is outside the model's 95% confidence interval;
  - question: Are there any completed connections with an extremely high ratio of uploaded to downloaded data?
    context: Normal interactive web sessions involve downloading more data than uploading. Data exfiltration, however, is often a one-way street. This question seeks to identify these highly asymmetric connections by filtering for sessions where the amount of data sent is vastly greater than the data received (e.g., a 50:1 ratio), especially when the total upload volume is non-trivial (>1MB).
    answer_sources:
      - Zeek conn.log
      - Internet Gateway/Egress Points
    range: last 90 days
    queries:
      - technology: pseudocode
        query: FILTER conn.log where (outbound_bytes / inbound_bytes) > 50 AND outbound_bytes > 1MB; ALERT on match;
  - question: Are any encrypted connections showing an upload-to-download ratio that is anomalous for their specific service type?
    context: Different services have different typical traffic ratios. This question creates more nuanced baselines by calculating the normal range of upload-to-download ratios for each network service (e.g., HTTPS, SMTPS). A connection is flagged if its ratio exceeds the 99th percentile for its service, allowing for more accurate detection by comparing traffic to its peers rather than a single global threshold.
    answer_sources:
      - Zeek conn.log
      - Internet Gateway/Egress Points
    range: last 90 days
    queries:
      - technology: pseudocode
        query: CALCULATE percentile baseline of (outbound/inbound) ratio per service; FLAG connections where ratio exceeds 99th percentile for its service;
  - question: Can we identify clusters of network connections indicative of data dumping?
    context: This question uses clustering algorithms to group connections with similar features. The goal is to find clusters characterized by a combination of high outbound bytes, low inbound bytes, and relatively short duration. Such a cluster is a strong indicator of automated data dumping or exfiltration activity, as opposed to interactive user sessions.
    answer_sources:
      - Zeek conn.log
      - Internet Gateway/Egress Points
    range: last 90 days
    queries:
      - technology: pseudocode
        query: CLUSTER connections on features (duration, outbound_bytes, inbound_bytes); INVESTIGATE clusters with high outbound, low inbound, and short duration;
  - question: Is a suspicious process or a process from a watchlist initiating a large outbound data transfer?
    context: This question links network activity to its source process on the host. By correlating network connection logs with process execution events, analysts can check if a large data upload is initiated by a known dual-use tool (like powershell.exe), a process running from a temporary or unusual directory, or any process on a predefined watchlist.
    answer_sources:
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - Sysmon Event ID 3
      - Zeek conn.log
      - User Workstations
      - Servers
      - Domain Controllers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: CORRELATE process events (Sysmon EID 1) with network logs (Zeek); ALERT if process is on watchlist AND associated connection's outbound_bytes > 5MB;
  - question: Is a statistically rare parent-child process relationship responsible for a large outbound data transfer?
    context: Malware often involves legitimate processes spawning unusual child processes (e.g., Microsoft Word spawning PowerShell). This question establishes a baseline of normal parent-child process relationships across the enterprise. It then alerts on network connections that originate from a statistically rare process pair, especially when that connection involves a high volume of outbound data.
    answer_sources:
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - Sysmon Event ID 3
      - Zeek conn.log
      - User Workstations
      - Servers
      - Domain Controllers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: IDENTIFY rare parent-child process pairs from Sysmon EID 1; CORRELATE with network connections (Sysmon EID 3); ALERT if rare pair initiates connection with outbound_bytes in top 5th percentile;
  - question: Is a process with suspicious command-line arguments making a network connection with a high upload-to-download ratio?
    context: The command-line arguments of a process can reveal its intent. This question uses a machine learning model to classify process command lines as suspicious (based on features like length, entropy, and content). If a process flagged as suspicious is then observed making a network connection with a highly asymmetric data flow (heavy on uploads), it generates a high-priority alert for potential exfiltration.
    answer_sources:
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - Sysmon Event ID 3
      - Zeek conn.log
      - User Workstations
      - Servers
      - Domain Controllers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: CLASSIFY command lines from Sysmon EID 1 as suspicious using ML model; CORRELATE suspicious processes with network connections (Zeek); ALERT if connection has high outbound/inbound ratio;