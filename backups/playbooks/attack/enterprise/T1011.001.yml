name: T1011.001: Exfiltration Over Bluetooth
id: e4d5f6a7-1b2c-4d5e-8f9a-0b1c2d3e4f56
description: This playbook addresses the threat of data exfiltration over an unauthorized Bluetooth channel. It provides investigative steps to detect this activity by identifying: the execution of known malicious Bluetooth tools; the misuse of legitimate utilities like fsquirt.exe; the staging of data in large archives; the unauthorized activation of Bluetooth services on restricted hosts; correlated event sequences where data staging is followed by Bluetooth activity; and anomalous network traffic patterns indicative of data hoarding for exfiltration via an alternate channel.
type: technique
related:
  - TA0010: Exfiltration
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Have any known malicious tools or scripts capable of Bluetooth data transfer been executed?
    context: This question focuses on detecting the direct execution of malware specifically designed for Bluetooth exfiltration. By comparing process file hashes against threat intelligence feeds, analysts can identify high-confidence indicators of compromise. A match suggests an active attempt to use a specialized tool for unauthorized data transfer.
    answer_sources:
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - User Workstations and Laptops, especially those of high-value targets
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          SEARCH process_creation_events
          WHERE event_id IN ('4688', '1')
          LOOKUP file_hash against threat_intelligence_feed_of_bluetooth_malware
          WHERE match_found = true
          RETURN hostname, process_name, file_hash, command_line

  - question: Are there any rarely seen processes running that have Bluetooth-related capabilities?
    context: This question helps uncover potentially unknown or custom malware by focusing on statistical rarity. A process that runs on very few hosts (low prevalence) but interacts with Bluetooth APIs is highly suspicious. This approach helps find threats that are not yet in threat intelligence databases.
    answer_sources:
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - User Workstations and Laptops, especially those of high-value targets
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          SEARCH process_execution_data
          CALCULATE prevalence(process_hash) across all hosts
          FILTER prevalence < 1st_percentile AND process_imports_bluetooth_functions = true
          RETURN hostname, process_name, process_hash, prevalence

  - question: Have any newly observed processes with a high maliciousness score been seen alongside Bluetooth activity?
    context: This question uses a machine learning model to score the likelihood of a process being malicious based on its characteristics. It then correlates high-scoring processes with other Bluetooth-related events (like device connections). This helps prioritize alerts and identify suspicious behavior that combines a potentially malicious process with the means of exfiltration.
    answer_sources:
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - User Workstations and Laptops, especially those of high-value targets
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          SCORE process_events with classification_model
          FILTER malicious_score > high_threshold
          CORRELATE with bluetooth_device_activity on same host within short time window
          RETURN hostname, process_name, score, correlated_bluetooth_event

  - question: Has fsquirt.exe or PowerShell been used for non-interactive or scripted Bluetooth file transfers?
    context: Adversaries often abuse legitimate system tools ('living off the land') to avoid detection. This question looks for specific command-line arguments or script blocks that indicate fsquirt.exe or PowerShell are being used to send files via Bluetooth, especially when initiated by a non-interactive process, which is not typical user behavior.
    answer_sources:
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - Windows PowerShell Event ID 4104
      - User Workstations and Laptops
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          SEARCH process_creation (Sysmon 1) OR powershell_script_blocks (4104)
          FILTER (process_name = 'fsquirt.exe' AND command_line CONTAINS '-send') OR (script_text CONTAINS 'Send-BluetoothFile' AND parent_process_is_non_interactive = true)
          RETURN hostname, process_name, command_line, parent_process

  - question: Is there an anomalous pattern in the usage of fsquirt.exe or PowerShell for a specific user?
    context: This question establishes a baseline of normal activity for each user's execution of fsquirt.exe and PowerShell. It then flags significant deviations from this baseline, such as an unusual frequency of use or abnormally complex command-line arguments (high entropy). This can indicate that a user's account has been compromised and is being used for exfiltration.
    answer_sources:
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - Windows PowerShell Event ID 4104
      - User Workstations and Laptops
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each_user, BASELINE historical frequency and command_entropy for ('fsquirt.exe', 'powershell.exe')
          MONITOR current usage
          ALERT if current_frequency > 3_std_dev_from_baseline OR current_entropy > 95th_percentile_of_baseline
          RETURN user, hostname, process_name, command_line

  - question: Are there any sudden, unexplained spikes in Bluetooth-related commands from fsquirt.exe or PowerShell on any host?
    context: This question applies time-series analysis to detect sudden bursts of Bluetooth activity that are inconsistent with normal operational patterns. By modeling the expected frequency of commands over time, a machine learning model can identify anomalous spikes that might represent a large-scale or automated exfiltration event.
    answer_sources:
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - Windows PowerShell Event ID 4104
      - User Workstations and Laptops
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each_host, MODEL time_series of bluetooth_command_frequency
          ALERT on anomalous spikes not correlated with normal behavior (e.g., software updates)
          RETURN hostname, time_of_spike, anomalous_command_count

  - question: Are common archiving tools being run from unusual locations or by system accounts?
    context: Adversaries often stage data by compressing it into archives before exfiltration. This question looks for the execution of common archiving utilities (like 7z.exe, rar.exe) from suspicious locations (e.g., temp directories) or by system accounts that should not be performing such actions. This is a strong indicator of data preparation for exfiltration.
    answer_sources:
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - Sysmon Event ID 11
      - Windows Event ID 4663
      - File Servers, User Workstations, and Document Management Systems
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          SEARCH process_creation_events
          WHERE process_name IN ('7z.exe', 'rar.exe', 'tar.exe', 'zip.exe') AND (process_path CONTAINS '\\AppData\\Local\\Temp' OR user = 'NT AUTHORITY\\SYSTEM')
          RETURN hostname, process_name, process_path, user, command_line

  - question: Has there been an unusually large number or size of archive files created on any host?
    context: This question establishes a baseline for the normal creation of archive files (.zip, .rar, etc.) on a per-host basis. It then flags any short-term activity where the number or total size of created archives dramatically exceeds this baseline. Such a burst of activity suggests a large volume of data is being collected and compressed.
    answer_sources:
      - Sysmon Event ID 11
      - File Servers, User Workstations, and Document Management Systems
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each_host, BASELINE hourly count and size of created_archives (e.g., .zip, .rar, .7z)
          MONITOR file creation events (Sysmon 11) in 10-minute windows
          ALERT if count_in_window > 99th_percentile_baseline OR total_size_in_window > 99th_percentile_baseline
          RETURN hostname, files_created, total_size

  - question: Are there anomalous clusters of file creation activity that could indicate data staging?
    context: This question uses an unsupervised clustering algorithm to group file creation events based on their properties (file type, location, size, parent process). Events that do not fit into any normal cluster are flagged as anomalies. This can help identify novel or stealthy data staging techniques that don't use common archive tools or follow predictable patterns.
    answer_sources:
      - Sysmon Event ID 11
      - Sysmon Event ID 1
      - File Servers, User Workstations, and Document Management Systems
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          CLUSTER file_creation_events using DBSCAN on features (extension, path_entropy, size, parent_process)
          IDENTIFY and alert on noise points (anomalous events/clusters)
          RETURN hostname, file_path, file_size, parent_process, cluster_id

  - question: Has the Bluetooth service been enabled or started on a host where it is supposed to be disabled?
    context: In many secure environments, Bluetooth is disabled by policy on servers or specific workstations. This question creates a high-priority alert if the Bluetooth service ('bthserv') is started or its registry key is modified to enable it on a host where it should be disabled. This is a clear violation of policy and highly suspicious.
    answer_sources:
      - Windows Event ID 7036
      - Sysmon Event ID 13
      - Servers in Datacenters, Critical Workstations, and any host where Bluetooth is disabled by Group Policy
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          SEARCH service_state_changes (7036) OR registry_events (Sysmon 13)
          WHERE (hostname IN 'Bluetooth_Disabled_Asset_Group' AND service_name = 'bthserv' AND state = 'running') OR (registry_key = 'HKLM\\SYSTEM\\CurrentControlSet\\Services\\bthserv\\Start' AND value IS_NOT 4)
          ALERT high_priority

  - question: Has a new Bluetooth device been connected to a host that has never used Bluetooth before?
    context: This question identifies hosts that have historically had no Bluetooth activity. By tracking Plug-and-Play events, it flags the very first instance of a Bluetooth device being connected to such a host. This is a significant anomaly, as it could indicate an adversary physically or remotely introducing a new exfiltration channel.
    answer_sources:
      - Microsoft-Windows-Kernel-PnP/Configuration Event ID 400
      - Microsoft-Windows-Kernel-PnP/Configuration Event ID 410
      - Servers in Datacenters, Critical Workstations, and any host where Bluetooth is disabled by Group Policy
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          IDENTIFY list of hosts with zero bluetooth_pnp_events in last 90 days
          SEARCH pnp_events (400, 410) for new bluetooth devices
          ALERT if event_hostname IS IN zero_activity_list
          RETURN hostname, device_name, event_id

  - question: Does the current state of the Bluetooth service on any host conflict with its predicted state based on its role and configuration?
    context: This question uses a machine learning model to predict the intended state (Enabled/Disabled) of the Bluetooth service for every host based on its profile (OS, role, asset group). It then compares this prediction to the actual, current state. A mismatch indicates a potential policy violation or unauthorized change that warrants investigation.
    answer_sources:
      - Windows Event ID 7036
      - Asset Management Database
      - Servers in Datacenters, Critical Workstations, and any host where Bluetooth is disabled by Group Policy
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each_host, PREDICT bluetooth_service_state with classification_model based on (OS, asset_group, role)
          GET current_bluetooth_service_state
          COMPARE predicted_state with actual_state
          ALERT on mismatch
          RETURN hostname, predicted_state, actual_state

  - question: Has data staging activity been immediately followed by Bluetooth activity on the same host?
    context: This question looks for a specific, high-confidence attack chain: data staging (e.g., creating a large archive) followed closely in time (within 15 minutes) by Bluetooth activity (e.g., running fsquirt.exe). Correlating these two events on the same host provides strong evidence of an active exfiltration attempt.
    answer_sources:
      - Sysmon Event ID 1
      - Sysmon Event ID 11
      - Windows Event ID 7036
      - Executive Laptops and workstations of developers or system administrators
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          CORRELATE data_staging_event (e.g., rar.exe execution) AND bluetooth_activity_event (e.g., fsquirt.exe execution)
          WHERE events occur on same_host AND time_difference < 15_minutes
          ALERT high_confidence
          RETURN hostname, staging_event_details, bluetooth_event_details

  - question: Does any host have a rapidly increasing risk score based on a combination of staging and Bluetooth events?
    context: This question uses a risk scoring model where different suspicious activities (like archive creation or service starts) contribute points to a host's overall risk score. By monitoring a moving average of this score, analysts can detect when a host accumulates multiple indicators over a short period, pushing its risk score over a threshold and indicating a likely compromise in progress.
    answer_sources:
      - Sysmon Event ID 1
      - Sysmon Event ID 11
      - Windows Event ID 7036
      - Executive Laptops and workstations of developers or system administrators
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each_host, CALCULATE risk_score by summing points for suspicious_events (e.g., large_archive=+10, bth_service_start=+50)
          CALCULATE 1-hour_moving_average of risk_score
          ALERT if risk_score > 95th_percentile_of_all_host_scores
          RETURN hostname, current_risk_score, contributing_events

  - question: Has a rare and suspicious sequence of events, matching a known exfiltration pattern, been observed on any host?
    context: This question uses a sequence analysis model (like an HMM or RNN) trained on normal sequences of system events. The model can then calculate the probability of a newly observed sequence. An event sequence that matches the pattern of Bluetooth exfiltration (e.g., 'archive -> service start -> file transfer') and has a very low probability of occurring naturally will be flagged as a highly suspicious anomaly.
    answer_sources:
      - Sysmon Event ID 1
      - Sysmon Event ID 11
      - Windows Event ID 7036
      - Executive Laptops and workstations of developers or system administrators
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each_host, ANALYZE event_log_sequence with a sequence_analysis_model (HMM/RNN)
          CALCULATE probability of the observed_sequence
          ALERT if probability is anomalously_low AND sequence matches a known exfiltration_pattern
          RETURN hostname, observed_event_sequence, probability_score

  - question: Has any host received a large amount of data from internal servers but sent very little data out over the corporate network?
    context: This question identifies a classic data hoarding pattern. A host pulling large volumes of data (e.g., >500MB) from internal file servers or databases without a corresponding amount of outbound traffic to the internet is a strong indicator that the data is being exfiltrated through a covert, unmonitored channel like Bluetooth.
    answer_sources:
      - Zeek conn.log
      - Windows Event ID 5156
      - Sysmon Event ID 3
      - Internal network segments, DMZ, and connections to high-value data repositories
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          SEARCH network_connection_logs
          GROUP BY hostname, 1_hour_window
          WHERE sum(bytes_in_from_internal_servers) > 500MB AND sum(bytes_out_to_external_net) < 5MB
          RETURN hostname, bytes_in, bytes_out

  - question: Is there an anomalous ratio of data received from internal sources versus data sent to external sources for any host?
    context: This question establishes a baseline for each host's typical ratio of internal data ingress to external data egress. A sudden, sharp deviation from this baseline—specifically, a large increase in the ratio—indicates that the host is collecting much more internal data than it is sending out through normal channels, suggesting potential exfiltration via an alternate path.
    answer_sources:
      - Zeek conn.log
      - Internal network segments, DMZ, and connections to high-value data repositories
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each_host, BASELINE 24-hour rolling average of (bytes_in_internal / bytes_out_external) ratio
          MONITOR current hourly ratio
          ALERT if hourly_ratio > 3_std_dev_from_baseline
          RETURN hostname, current_ratio, baseline_ratio

  - question: Does time-series analysis of network flows show a large data ingress event without a corresponding egress event within the predicted timeframe?
    context: This question uses a time-series model to learn the normal patterns of data transfer between hosts and servers, including the typical delay between receiving data and sending related data out. The model can then detect anomalies where a host receives a large amount of data, but the expected corresponding outbound traffic never materializes, pointing to a likely side-channel exfiltration.
    answer_sources:
      - Zeek conn.log
      - Internal network segments, DMZ, and connections to high-value data repositories
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each host-to-server_pair, MODEL netflow_volume (bytes_in - bytes_out) with time_series_model (e.g., LSTM, Prophet)
          ALERT when observed netflow shows a large positive spike (high data ingress) that is not followed by a corresponding egress event within the predicted time window
          RETURN hostname, server, anomalous_netflow_spike_details