name: T1627.001: Geofencing
id: 5f1e8d2c-9a4b-4f7d-8c6a-1b3e9f0d7a2e
description: This playbook helps investigate whether an adversary is using geofencing on mobile devices to evade detection or analysis. The investigation focuses on two primary areas. First, static analysis of mobile applications to identify those that request high-risk, persistent background location permissions without a plausible functional requirement, based on corporate policy, peer-group statistical analysis, or machine-learning classification. Second, dynamic analysis in a sandboxed environment to observe if an application's network behavior, such as C2 beaconing, data exfiltration volume, or DNS request patterns, changes abruptly and sustainedly immediately following a simulated change in the device's GPS coordinates from a permitted to a restricted region.
type: technique
related:
  - TA0030: Defense Evasion
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Are any mobile applications on managed devices requesting persistent background location permissions without being in a policy-approved category?
    context: This question aims to identify potential misuse of location data. Applications that track a user's location in the background but have no legitimate reason to do so (e.g., a simple productivity app) are highly suspicious. This could indicate an attempt to gather sensitive location information for malicious purposes, including geofencing to evade analysis or target specific individuals. By comparing an app's permissions to its stated function and corporate policy, we can flag these high-risk outliers for further investigation.
    answer_sources:
      - MDM App Inventory Report
      - Static Analysis Tool Output (e.g., MobSF JSON report)
      - Corporate Application Policy
      - Application Store Metadata
      - Mobile Device Management (MDM) Platform
      - Application Vetting Sandbox
      - Corporate App Store Repository
      - Managed Mobile Endpoints
    range: last 90 days
    queries:
      - pseudocode: SEARCH MDM inventory for apps with background location permissions. FILTER results against a list of approved application categories. ALERT on any app with the permission that is not in an approved category.
  - question: Are there any mobile applications requesting background location permissions that are statistical outliers compared to other apps in the same App Store category?
    context: This question seeks to identify anomalous behavior by comparing an application's permissions to its peers. Even if a category isn't explicitly disallowed from using background location, an app might be the only one (or one of very few) in its category to request it. This statistical anomaly suggests the app's behavior deviates from the norm for its supposed function, which could be a sign of malicious intent like geofencing. This method helps find suspicious apps without relying solely on a predefined policy.
    answer_sources:
      - MDM App Inventory Report
      - Static Analysis Tool Output (e.g., MobSF JSON report)
      - Corporate Application Policy
      - Application Store Metadata
      - Mobile Device Management (MDM) Platform
      - Application Vetting Sandbox
      - Corporate App Store Repository
      - Managed Mobile Endpoints
    range: last 90 days
    queries:
      - pseudocode: GROUP all applications by App Store category. FOR EACH category, calculate the percentage of apps requesting background location. IDENTIFY categories where this permission is rare (e.g., <5% prevalence). ALERT on any app with the permission in one of those rare categories.
  - question: Does a machine learning model, trained on static application features, classify any new or updated mobile app as having a high probability of being malicious due to its permissions and API calls?
    context: This question leverages machine learning to automate the detection of potentially malicious applications based on a combination of factors. A model can learn complex patterns that are difficult for humans to spot, such as subtle correlations between permissions, specific API calls related to geofencing, and the application's category. An alert based on a high-confidence score from the model indicates that the app's static profile strongly resembles known malicious or policy-violating software, warranting immediate manual analysis.
    answer_sources:
      - MDM App Inventory Report
      - Static Analysis Tool Output (e.g., MobSF JSON report)
      - Corporate Application Policy
      - Application Store Metadata
      - Mobile Device Management (MDM) Platform
      - Application Vetting Sandbox
      - Corporate App Store Repository
      - Managed Mobile Endpoints
    range: last 90 days
    queries:
      - pseudocode: INPUT static features (permissions, API calls, category) of a new/updated app into a pre-trained classification model. IF the model's malicious probability score > threshold (e.g., 0.85), GENERATE an alert.
  - question: Does an application's periodic network beaconing stop after its simulated GPS location is moved to a restricted or unexpected region?
    context: This question aims to detect geofencing by observing an application's network behavior in a controlled sandbox environment. Malicious applications often use regular "beaconing" or "heartbeat" connections to a command and control (C2) server. If this beaconing activity suddenly stops immediately after the device's virtual location is changed, it is a strong indicator that the malware is geofenced and designed to cease operations or communication when outside a specific geographic area to evade detection by security researchers.
    answer_sources:
      - Mobile Application Vetting Sandbox Logs
      - Zeek conn.log
      - Zeek dns.log
      - Zeek http.log
      - Zeek ssl.log
      - Application Vetting Sandbox
      - Network Egress Points (VPN, Corporate Wi-Fi)
      - DNS Resolvers
      - Web Proxy Servers
    range: last 90 days
    queries:
      - pseudocode: IN sandbox, baseline app network traffic for 10 minutes to identify beacons. SIMULATE GPS location change. MONITOR for cessation of beacon activity. IF beaconing stops for >5 minutes post-change, GENERATE alert.
  - question: Following a simulated GPS location change in a sandbox, does the application's network traffic show a significant and simultaneous drop in both DNS request randomness and outbound data volume?
    context: This question looks for more subtle signs of geofencing. Malicious activity often involves communicating with randomly generated domains (high DNS entropy) and exfiltrating data (high outbound data volume). If an application abruptly shifts from this behavior to only contacting common, legitimate domains (low DNS entropy) and sending minimal data after a location change, it suggests the malware has entered a dormant, evasive state. This dual-metric approach provides a more robust signal of geofencing than looking at connection counts alone.
    answer_sources:
      - Mobile Application Vetting Sandbox Logs
      - Zeek conn.log
      - Zeek dns.log
      - Zeek http.log
      - Zeek ssl.log
      - Application Vetting Sandbox
      - Network Egress Points (VPN, Corporate Wi-Fi)
      - DNS Resolvers
      - Web Proxy Servers
    range: last 90 days
    queries:
      - pseudocode: IN sandbox, baseline DNS entropy and outbound data volume. SIMULATE GPS location change. IF post-change DNS entropy drops > 1.5 std dev AND outbound data volume drops > 75%, GENERATE alert.
  - question: Does a time-series anomaly detection model detect a significant behavioral change in an application's network telemetry that correlates directly with a simulated GPS location change?
    context: This question applies advanced machine learning to detect geofencing dynamically. An anomaly detection model learns what "normal" application network behavior looks like over time. When analyzing a new app, if the model flags a major anomaly (a high "reconstruction error") precisely when the virtual location is changed, it signifies the app's behavior has deviated unexpectedly. If this anomaly is followed by a new, quiet baseline, it strongly implies the app reacted to the location change by entering an evasive state, a classic sign of geofencing.
    answer_sources:
      - Mobile Application Vetting Sandbox Logs
      - Zeek conn.log
      - Zeek dns.log
      - Zeek http.log
      - Zeek ssl.log
      - Application Vetting Sandbox
      - Network Egress Points (VPN, Corporate Wi-Fi)
      - DNS Resolvers
      - Web Proxy Servers
    range: last 90 days
    queries:
      - pseudocode: IN sandbox, feed live network telemetry into a time-series anomaly model. SIMULATE GPS location change as an external event. IF model shows a high anomaly score immediately after the location change, followed by a new stable, low-activity state, GENERATE alert.