name: "T1603: Scheduled Task/Job"
id: "a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d"
description: "This playbook is designed to detect adversaries using scheduled tasks on mobile devices for persistence and execution. It focuses on identifying indicators such as repetitive, uniform network connections characteristic of C2 beaconing; statistical outliers in network traffic profiles compared to peer groups; periodic downloads of mobile executables from low-reputation sources; and regularly-timed DNS queries for domain generation algorithm (DGA) domains. By analyzing network logs, the playbook helps uncover covert C2 channels and malicious code execution scheduled by an attacker."
type: "technique"
related:
  - "TA0028: Persistence"
  - "TA0041: Execution"
contributors:
  - "Zachary Szewczyk"
  - "Ask Sage"
created: "2025-10-01"
modified: "2025-10-01"
version: 1.0
tags: "none"
questions:
  - question: "Are outbound connections from mobile devices matching known C2 threat intelligence feeds?"
    context: "This question aims to identify direct communication from mobile devices to known malicious infrastructure. Adversaries often use command and control (C2) servers for persistence, and scheduled tasks are a common method to automate this communication. Correlating network connection data (IPs, domains, TLS fingerprints) with up-to-date threat intelligence is a fundamental step in detecting C2 beaconing."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Zeek ssl.log"
      - "Zeek intel.log"
      - "Corporate Wi-Fi access points, VPN gateways, Network egress points, Cloud Access Security Brokers (CASB), Mobile Device Management (MDM) platforms."
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: |
          SEARCH Zeek logs (conn, dns, ssl)
          FILTER source IP is in mobile IP range
          JOIN conn.log, dns.log, and ssl.log to link IPs, domains, and JA3/JA3S hashes
          LOOKUP destination IPs, domains, JA3/JA3S against threat intelligence feeds
          RETURN connections that match threat intelligence via intel.log
  - question: "Are any mobile devices exhibiting highly uniform, repetitive network traffic patterns indicative of automated beaconing?"
    context: "This question focuses on detecting the behavioral characteristics of automated C2 communication, which can uncover novel threats not yet in intelligence feeds. Scheduled tasks used for persistence often create network connections with very regular timing (low jitter) and uniform size and duration (low Gini coefficient). Identifying these statistical anomalies is a strong indicator of non-interactive, automated traffic."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Zeek ssl.log"
      - "Zeek intel.log"
      - "Corporate Wi-Fi access points, VPN gateways, Network egress points, Cloud Access Security Brokers (CASB), Mobile Device Management (MDM) platforms."
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: |
          FOR each mobile source IP in Zeek conn.log over a 24-hour window:
            GROUP outbound connections by destination IP
            CALCULATE jitter (standard deviation of inter-arrival times)
            CALCULATE Gini coefficient for connection duration
            CALCULATE Gini coefficient for total bytes transferred
            FLAG device WHERE jitter is < 5 seconds AND Gini coefficients are < 0.2
  - question: "Can a periodic signal be identified in the connection patterns of mobile devices communicating with low-reputation destinations?"
    context: "This question seeks to confirm the presence of a scheduled task by identifying a clear, repeating frequency in a device's network connections. By applying time-series analysis like a Fast Fourier Transform (FFT), an analyst can mathematically prove that connections are occurring at a fixed interval (e.g., every hour, every 30 minutes). When this periodicity is associated with a suspicious destination, it provides high-fidelity evidence of a scheduled C2 beacon."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Zeek ssl.log"
      - "Zeek intel.log"
      - "Corporate Wi-Fi access points, VPN gateways, Network egress points, Cloud Access Security Brokers (CASB), Mobile Device Management (MDM) platforms."
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: |
          FOR connection patterns flagged by statistical analysis:
            CREATE time series of connection start times
            APPLY Fast Fourier Transform (FFT) to the time series
            IDENTIFY dominant frequencies to reveal the task's period
            ALERT on strong periodic signals to low-reputation destinations
  - question: "Are mobile devices communicating over non-standard ports or exhibiting other anomalous network behaviors?"
    context: "This question helps detect covert C2 channels that bypass standard port-based security controls. Adversaries may use non-standard ports to evade detection or use techniques like DNS tunneling. Monitoring for connections to unapproved ports or for protocol anomalies flagged in logs like `Zeek weird.log` can reveal attempts by a scheduled task to establish a hidden C2 channel."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Zeek weird.log"
      - "Corporate Wi-Fi access points, VPN gateways, Network egress points, Internal DNS resolvers."
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: |
          DEFINE allowlist of approved application ports (>1024)
          SEARCH Zeek conn.log for connections from mobile IPs to ports NOT on allowlist
          SEARCH Zeek weird.log for notices like 'dns_unmatched_reply' from mobile IPs
          ALERT on any findings
  - question: "Do any mobile devices show network traffic patterns that are statistical outliers compared to their peer group?"
    context: "This question aims to identify anomalous devices by comparing their network behavior against a baseline established by similar devices. A device whose traffic profile (e.g., ratio of non-standard port usage, DNS query size) deviates significantly from its peers (e.g., other devices in the same department with the same OS) is a strong candidate for investigation. This peer-based analysis helps reduce false positives and highlights truly unusual activity that could stem from a malicious scheduled task."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Zeek weird.log"
      - "Corporate Wi-Fi access points, VPN gateways, Network egress points, Internal DNS resolvers."
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: |
          DEFINE peer groups using MDM data (OS, department)
          FOR each device:
            CALCULATE ratio of traffic on non-standard ports
            CALCULATE average size of DNS TXT/NULL queries
          FLAG devices where metrics are > 98th percentile or > 2 stddev from peer group baseline
  - question: "Can machine learning identify mobile devices with anomalous network behavior indicative of a covert C2 channel?"
    context: "This question leverages unsupervised machine learning to find complex patterns of anomalous behavior that rule-based methods might miss. By creating a feature vector for each device (e.g., protocol distribution, port entropy, connection duration, JA3 hashes) and using a clustering algorithm like DBSCAN, devices that do not fit any normal cluster ('noise points') can be automatically identified. These outliers represent devices with highly unusual network profiles, possibly due to a scheduled task maintaining a C2 channel."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Zeek weird.log"
      - "Corporate Wi-Fi access points, VPN gateways, Network egress points, Internal DNS resolvers."
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: |
          FOR each mobile device:
            CREATE feature vector (protocol ratio, port entropy, avg conn duration, etc.)
          APPLY DBSCAN clustering algorithm to all device vectors
          INVESTIGATE devices classified as noise points (outliers)
  - question: "Are mobile devices downloading executable files from sources that match threat intelligence?"
    context: "This question seeks to detect the delivery of a malicious payload, which could be executed via a scheduled task. By hashing all downloaded files and checking them against malware databases, and by checking source domains and TLS certificates against threat feeds, an analyst can identify known malware being downloaded to mobile devices."
    answer_sources:
      - "Zeek http.log"
      - "Zeek files.log"
      - "Zeek conn.log"
      - "Zeek intel.log"
      - "Zeek x509.log"
      - "Network egress points, Corporate Wi-Fi access points, Web Proxies."
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: |
          SEARCH Zeek files.log for downloaded files
          CALCULATE hash (MD5/SHA1) of each file
          LOOKUP file hash, host (http.log), and certificate issuer (x509.log) against threat intelligence
          ALERT on any match reported in intel.log
  - question: "Are mobile devices periodically downloading mobile-specific executable files?"
    context: "This question focuses on identifying the periodic download of potential malware payloads, a behavior consistent with a scheduled task designed to fetch or update malicious code. By filtering for mobile executable MIME types, analyzing the download timestamps for periodicity using autocorrelation, and flagging uncommon User-Agent strings, an analyst can detect suspicious, automated download activity."
    answer_sources:
      - "Zeek http.log"
      - "Zeek files.log"
      - "Zeek conn.log"
      - "Zeek intel.log"
      - "Zeek x509.log"
      - "Network egress points, Corporate Wi-Fi access points, Web Proxies."
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: |
          FILTER files.log for mobile MIME types (e.g., 'application/vnd.android.package-archive')
          FOR each source device, create a time series of these downloads
          APPLY autocorrelation function (ACF) to detect periodicity
          FLAG devices with significant periodic download patterns and rare User-Agent strings
  - question: "Can a machine learning model identify high-risk file downloads on mobile devices?"
    context: "This question leverages a supervised machine learning model to score the likelihood that a file download is malicious, moving beyond simple rule-based detection. By training a classifier on features like domain age, filename entropy, User-Agent prevalence, and certificate validity, the system can produce a risk score. A high score, especially when combined with evidence of periodic downloads, provides a high-confidence alert for a scheduled malware dropper."
    answer_sources:
      - "Zeek http.log"
      - "Zeek files.log"
      - "Zeek conn.log"
      - "Zeek intel.log"
      - "Zeek x509.log"
      - "Network egress points, Corporate Wi--Fi access points, Web Proxies."
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: |
          EXTRACT features for downloads (domain age, filename entropy, MIME type, etc.)
          INPUT features into a pre-trained gradient boosting classifier
          GENERATE a 'malicious download' score
          ALERT on high scores, especially if correlated with periodic behavior
  - question: "Are mobile devices making DNS queries to domains associated with threat intelligence or using non-corporate DNS servers?"
    context: "This question aims to detect C2 communication at the DNS level. Adversaries often use scheduled tasks to have compromised devices query malicious domains (e.g., known C2 or DGA domains) to get instructions. Checking DNS queries against threat feeds and monitoring for the use of unauthorized external DNS resolvers are effective ways to uncover this stage of an attack."
    answer_sources:
      - "Zeek dns.log"
      - "Zeek intel.log"
      - "Zeek conn.log"
      - "Internal DNS resolvers, Network egress points, DNS firewalls."
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: |
          SEARCH Zeek dns.log for queries from mobile subnets
          LOOKUP all queried domains against threat intelligence (C2, DGA, NRD)
          CHECK if query was resolved by a non-corporate DNS server
          ALERT on any match
  - question: "Are mobile devices making periodic DNS queries to domains with high lexical entropy?"
    context: "This question is designed to detect Domain Generation Algorithms (DGAs), which are often used by malware to locate C2 servers. A scheduled task on an infected device might periodically query these algorithmically generated domains. By calculating the lexical properties (entropy, n-gram score) of queried domains and then checking for periodic query patterns (low standard deviation of inter-query time) for the most anomalous-looking domains, analysts can identify DGA-based C2 communication."
    answer_sources:
      - "Zeek dns.log"
      - "Zeek intel.log"
      - "Zeek conn.log"
      - "Internal DNS resolvers, Network egress points, DNS firewalls."
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: |
          FOR each queried domain not on an allowlist:
            CALCULATE lexical anomaly score (entropy, length, n-gram profile)
          FOR domains with high anomaly scores:
            GROUP by source device and domain
            CALCULATE standard deviation of inter-query arrival times
          FLAG domains with low standard deviation (<10s)
  - question: "Can a machine learning model detect DGA domains being queried periodically by mobile devices?"
    context: "This question applies a dedicated machine learning model (e.g., an LSTM-based classifier) to detect DGA domains, which are often too complex for simple lexical analysis. By feeding all non-allowlisted domains into a DGA detection model, analysts can identify high-probability DGA domains. Correlating these findings with periodic query patterns and subsequent outbound connections provides very strong evidence of a C2 channel established by a scheduled task on a compromised device."
    answer_sources:
      - "Zeek dns.log"
      - "Zeek intel.log"
      - "Zeek conn.log"
      - "Internal DNS resolvers, Network egress points, DNS firewalls."
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: |
          INPUT all non-allowlisted domains into a DGA detection model
          FOR domains with a high DGA probability score (>0.90):
            CORRELATE query timestamps to identify periodic patterns
            CORRELATE with conn.log to confirm active C2 connection
          ALERT on confirmed periodic DGA activity