name: T1628.003: Conceal Multimedia Files
id: f47ac10b-58cc-4372-a567-0e02b2c3d479
description: This playbook helps investigate whether an adversary is concealing captured multimedia files on mobile devices. This is often done by creating a '.nomedia' file on an Android device to prevent media scanners from indexing files in a specific directory. Malicious indicators include creation by a non-standard application, placement in an obfuscated directory path, and subsequent exfiltration of multimedia files over the network to new or low-reputation destinations.
type: technique
related:
  - TA0030: Defense Evasion
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Was a '.nomedia' file created by an unauthorized application?
    context: The '.nomedia' file is a legitimate Android mechanism to hide media from galleries. However, its creation by an application that is not a known system process or media application is highly suspicious. This question aims to identify such events by cross-referencing the process that created the file against a curated allowlist of legitimate applications. A match outside this list suggests an adversary may be attempting to hide captured media.
    answer_sources:
      - Mobile EDR File System Auditing Logs
      - Mobile MDM Application Inventory Logs
      - File systems of corporate-managed Android devices, specifically user-writable directories such as /storage/emulated/0/DCIM/, /storage/emulated/0/Pictures/, /storage/emulated/0/Download/, and application-specific data folders.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          SEARCH file creation events WHERE file.name == '.nomedia'
          FOR EACH event:
            EXTRACT process.name
            IF process.name NOT IN (allowlist_of_media_apps) THEN
              ALERT severity=medium, reason='unauthorized .nomedia creation'
            ENDIF
          END FOR
  - question: Was a '.nomedia' file created in an unusually named or obfuscated directory?
    context: Adversaries often create randomly named directories to store malicious payloads or stolen data, making them harder for analysts to find. By calculating the Shannon entropy of the directory path where a '.nomedia' file is created, we can quantify its randomness. A high entropy score, compared to a baseline of normal directory paths on the device fleet, strongly indicates that the directory was intentionally obfuscated to evade detection. This escalates the severity of a '.nomedia' creation event.
    answer_sources:
      - Mobile EDR File System Auditing Logs
      - Mobile MDM Application Inventory Logs
      - File systems of corporate-managed Android devices, specifically user-writable directories such as /storage/emulated/0/DCIM/, /storage/emulated/0/Pictures/, /storage/emulated/0/Download/, and application-specific data folders.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR EACH '.nomedia' creation alert:
            CALCULATE entropy_score = ShannonEntropy(event.file.directory)
            GET baseline_entropy = 98th_percentile(historical_directory_entropy)
            IF entropy_score > baseline_entropy OR entropy_score > 3.5 THEN
              ESCALATE alert to severity=high, reason='obfuscated directory path'
            ENDIF
          END FOR
  - question: Can we score the risk of a '.nomedia' file creation event using machine learning?
    context: To move beyond simple rules and thresholds, this question proposes using a machine learning model to assess the risk of a '.nomedia' creation event. By training a classifier (e.g., Random Forest) on a rich set of features—such as directory path entropy, the age of the application on the device, its number of permissions, and whether it was sideloaded—we can generate a probabilistic score of maliciousness. A high score (>0.90) provides strong, automated validation of a threat, justifying immediate response actions like device isolation.
    answer_sources:
      - Mobile EDR File System Auditing Logs
      - Mobile MDM Application Inventory Logs
      - File systems of corporate-managed Android devices, specifically user-writable directories such as /storage/emulated/0/DCIM/, /storage/emulated/0/Pictures/, /storage/emulated/0/Download/, and application-specific data folders.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR EACH '.nomedia' creation event:
            EXTRACT features (directory_entropy, app_age, app_permissions, is_sideloaded, etc.)
            CALCULATE risk_score = ML_Model.predict_proba(features)
            IF risk_score > 0.90 THEN
              ALERT severity=critical, reason='high probability of malicious activity'
              TRIGGER automated_response (e.g., device_quarantine)
            ENDIF
          END FOR
  - question: Did a mobile device transfer multimedia files to a known malicious domain?
    context: After concealing files, an adversary's next step is often exfiltration. This question seeks to detect this by correlating network traffic with threat intelligence. If a mobile device is observed communicating with a domain known to be malicious, we can then inspect the connection's payload. If that inspection reveals the transfer of multimedia files (e.g., JPEGs, MP4s), it provides high-confidence evidence of data exfiltration.
    answer_sources:
      - Zeek files.log
      - Zeek http.log
      - Zeek conn.log
      - Zeek dns.log
      - Network egress points monitoring traffic from mobile device subnets, including corporate Wi-Fi gateways, VPN concentrators, and Cloud Access Security Brokers (CASB).
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          SEARCH Zeek DNS/HTTP logs for connections from mobile_subnets to malicious_domains
          FOR EACH malicious connection:
            EXTRACT connection_uid
            SEARCH Zeek files.log WHERE uid == connection_uid AND mime_type IN (multimedia_types)
            IF found THEN
              ALERT severity=critical, reason='multimedia exfiltration to known bad domain'
            ENDIF
          END FOR
  - question: Did a mobile device exfiltrate an unusually large volume of multimedia data to a new destination?
    context: This question uses anomaly detection to find suspicious exfiltration without relying on threat intelligence. For each device, we establish a baseline of its normal network behavior, including the domains it typically contacts and the amount of data it sends. An alert is triggered if the device sends a large volume of multimedia files (e.g., >10MB) to a domain it has not communicated with in its recent history (e.g., 30 days). This deviation from normal behavior is a strong indicator of potential data theft.
    answer_sources:
      - Zeek files.log
      - Zeek http.log
      - Zeek conn.log
      - Zeek dns.log
      - Network egress points monitoring traffic from mobile device subnets, including corporate Wi-Fi gateways, VPN concentrators, and Cloud Access Security Brokers (CASB).
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR EACH device:
            MAINTAIN 30-day_baseline of destination_domains
            SEARCH for connections with large multimedia transfers (>10MB)
            IF transfer_destination NOT IN device.baseline_domains THEN
              ALERT severity=high, reason='large multimedia transfer to new domain'
            ENDIF
          END FOR
  - question: Can we detect anomalous patterns in outbound multimedia traffic volume and connection characteristics?
    context: This question applies advanced analytics for more subtle threat detection. A time-series model (e.g., LSTM) is used to continuously forecast the expected volume of outbound multimedia data per device. If the actual volume significantly deviates from the forecast, it signals a temporal anomaly. To increase confidence, we can then apply a clustering algorithm (e.g., DBSCAN) to the network characteristics (duration, packet count, etc.) of the anomalous traffic. If these connections form a new, distinct cluster, it indicates a behavioral anomaly, strengthening the case for malicious exfiltration.
    answer_sources:
      - Zeek files.log
      - Zeek http.log
      - Zeek conn.log
      - Zeek dns.log
      - Network egress points monitoring traffic from mobile device subnets, including corporate Wi-Fi gateways, VPN concentrators, and Cloud Access Security Brokers (CASB).
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR EACH device:
            APPLY time-series model to hourly multimedia_byte_volume
            IF observed_volume is > 3 standard deviations from forecast THEN
              FLAG as temporal_anomaly
              CLUSTER connection features (duration, packets, etc.) for anomaly window
              IF connections form a new/sparse cluster THEN
                ALERT severity=high, reason='behavioral anomaly in multimedia exfiltration'
              ENDIF
            ENDIF
          END FOR