name: 'T1530: Data from Cloud Storage'
id: 'f47ac10b-58cc-4372-a567-0e02b2c3d479'
description: 'This playbook addresses the adversary technique of collecting data from cloud storage. It focuses on identifying malicious access patterns, anomalous data egress volumes, and suspicious user behaviors that indicate data theft. Detections include correlating access events with threat intelligence, analyzing process execution for known siphoning tools, monitoring for unusual data volumes and API call sequences, tracking contextual anomalies like impossible travel, and detecting reconnaissance activities such as high rates of access denied errors followed by a success.'
type: 'technique'
related:
  - 'TA0009: Collection'
contributors: 'Zachary Szewczyk, Ask Sage'
created: '2025-10-01'
modified: '2025-10-01'
version: '1.0'
tags: 'none'
questions:
  - question: 'Are cloud storage access events originating from known malicious IP addresses or using user-agents associated with malicious tools?'
    context: 'This question aims to detect straightforward data collection attempts where the adversary uses known malicious infrastructure (like TOR exit nodes or compromised servers from a threat intelligence feed) or common data exfiltration tools (like ''Rclone'' or ''S3Scanner''). A positive match provides a high-confidence signal of malicious activity.'
    answer_sources:
      - 'AWS CloudTrail logs'
      - 'Azure Storage Analytics logs'
      - 'Google Cloud Audit Logs'
      - 'Zeek conn.log'
      - 'Zeek http.log'
      - 'Cloud provider API gateways'
      - 'Internet gateway proxy servers'
      - 'Enterprise SIEM platform'
    range: 'last 90 days'
    queries:
      - 'pseudocode': 'SEARCH cloud_storage_logs OR zeek_logs | JOIN source_ip WITH threat_intelligence_feed | WHERE match_found | OR (SEARCH cloud_storage_logs OR zeek_http_logs | WHERE user_agent MATCHES malicious_tool_signatures)'
  - question: 'Is there a sudden decrease in the complexity (entropy) of a user''s User-Agent strings when accessing cloud storage, suggesting a switch to a programmatic tool?'
    context: 'This question seeks to identify behavioral shifts. Legitimate users often access cloud resources through various browsers and devices, resulting in diverse User-Agent strings and higher entropy. An adversary using a single script or tool (like Rclone) for bulk download would cause the User-Agent to become uniform, leading to a sharp drop in entropy. This is a statistical anomaly that can indicate automated, and potentially malicious, data collection.'
    answer_sources:
      - 'AWS CloudTrail logs'
      - 'Azure Storage Analytics logs'
      - 'Google Cloud Audit Logs'
      - 'Zeek http.log'
      - 'Cloud provider API gateways'
      - 'Internet gateway proxy servers'
      - 'Enterprise SIEM platform'
    range: 'last 90 days'
    queries:
      - 'pseudocode': 'FOR each principal IN cloud_logs | CALCULATE 30_day_baseline_entropy(user_agent) | CALCULATE 1_hour_window_entropy(user_agent) | IF 1_hour_entropy < 5th_percentile(baseline_entropy) | ALERT'
  - question: 'Can a machine learning model identify cloud storage access events as malicious based on contextual features like IP geolocation, ASN, and time of day?'
    context: 'This question leverages machine learning to build a predictive model that can distinguish between benign and malicious access patterns. By training on historical data, the model learns the characteristics of known malicious access and can score new events in real-time. This approach is powerful for detecting novel threats that may not match known signatures but exhibit malicious characteristics.'
    answer_sources:
      - 'AWS CloudTrail logs'
      - 'Azure Storage Analytics logs'
      - 'Google Cloud Audit Logs'
      - 'Zeek conn.log'
      - 'Zeek http.log'
      - 'Cloud provider API gateways'
      - 'Internet gateway proxy servers'
      - 'Enterprise SIEM platform'
    range: 'last 90 days'
    queries:
      - 'pseudocode': 'FOR each new access_event | EXTRACT features (ip_geo, asn, user_agent_properties, time_of_day) | SCORE event with logistic_regression_model | IF score > 0.9 | ALERT'
  - question: 'Are processes or command-line arguments consistent with known cloud data siphoning tools being executed on endpoints or observed in network traffic?'
    context: 'This question looks for direct evidence of an adversary using specific tools designed for cloud data theft (e.g., ''rclone.exe'', ''s4cmd.exe''). Detecting the execution of these processes, their command-line arguments containing cloud storage URIs, or their unique User-Agent strings in network logs is a strong indicator of a collection attempt.'
    answer_sources:
      - 'Windows Event ID 4688'
      - 'AWS CloudTrail logs'
      - 'Zeek http.log'
      - 'Zeek conn.log'
      - 'Critical asset endpoints (e.g., developer workstations, administrator servers)'
      - 'Cloud provider API gateways'
      - 'Network egress points'
    range: 'last 90 days'
    queries:
      - 'pseudocode': 'SEARCH process_creation_logs WHERE process_name IN (malicious_tool_list) OR command_line CONTAINS (''s3://'', ''az://'', ''gs://'') | OR SEARCH network_logs WHERE user_agent IN (malicious_tool_list)'
  - question: 'Is a user performing an unusually high number of reconnaissance API calls (e.g., ''ListBuckets'') compared to data retrieval calls (''GetObject'')?'
    context: 'This question aims to detect preparatory behavior. Before exfiltrating data, an adversary often needs to enumerate available resources (buckets, files, etc.). This results in a high ratio of ''list'' or ''describe'' calls to ''get'' or ''read'' calls. A spike in this ratio for a specific user, compared to their historical baseline, is anomalous and suggests they are mapping out data before attempting to steal it.'
    answer_sources:
      - 'AWS CloudTrail logs'
      - 'Zeek http.log'
      - 'Zeek conn.log'
      - 'Critical asset endpoints (e.g., developer workstations, administrator servers)'
      - 'Cloud provider API gateways'
      - 'Network egress points'
    range: 'last 90 days'
    queries:
      - 'pseudocode': 'FOR each principal | CALCULATE baseline_ratio(list_calls / get_calls) | CALCULATE current_ratio(list_calls / get_calls) in 5_min_window | IF current_ratio > 99th_percentile(baseline_ratio) | ALERT'
  - question: 'Are the sequences of API calls made by a user anomalous when compared to legitimate sequences learned by a machine learning model?'
    context: 'This question uses a sequence analysis model to understand the ''grammar'' of normal API interactions for different user roles. A legitimate user might have a predictable sequence of calls for their daily tasks. An adversary''s actions, such as rapidly listing many buckets and then downloading multiple files, would likely form a sequence that the model deems improbable. This detects suspicious workflows that might not be caught by simple ratio analysis.'
    answer_sources:
      - 'AWS CloudTrail logs'
      - 'Zeek http.log'
      - 'Zeek conn.log'
      - 'Critical asset endpoints (e.g., developer workstations, administrator servers)'
      - 'Cloud provider API gateways'
      - 'Network egress points'
    range: 'last 90 days'
    queries:
      - 'pseudocode': 'FOR each principal | CAPTURE real_time_api_sequence | CALCULATE probability_of_sequence with HMM/LSTM_model | IF probability is low | ALERT'
  - question: 'Has a user downloaded an amount of data from a highly sensitive storage location that exceeds a predefined static limit?'
    context: 'This question provides a simple, high-confidence detection method for the most critical data stores. By setting a hard limit (e.g., 1GB in one hour) on data egress for sensitive locations, any breach of this threshold can be immediately flagged as a potential high-severity incident, bypassing the need for complex behavioral analysis.'
    answer_sources:
      - 'AWS CloudTrail logs'
      - 'Azure Storage Analytics logs'
      - 'Zeek conn.log'
      - 'Cloud storage services (e.g., S3 buckets, Azure Blobs)'
      - 'Network flow data collectors at internet egress points'
      - 'SIEM aggregation platform'
    range: 'last 90 days'
    queries:
      - 'pseudocode': 'SEARCH cloud_storage_logs from sensitive_locations | AGGREGATE data_downloaded_bytes by principal over 1_hour | IF data_downloaded_bytes > 1GB | ALERT'
  - question: 'Has a user''s hourly data download volume or API call count significantly deviated from their own historical average?'
    context: 'This question focuses on detecting personal anomalies. Every user has a different data access pattern. This method establishes a ''normal'' baseline for each individual''s activity (e.g., average download volume per hour) and alerts when their current activity is a statistical outlier (e.g., more than 3 standard deviations above their average). This is effective for catching bulk downloads that might be large for one user but normal for another.'
    answer_sources:
      - 'AWS CloudTrail logs'
      - 'Azure Storage Analytics logs'
      - 'Zeek conn.log'
      - 'Cloud storage services (e.g., S3 buckets, Azure Blobs)'
      - 'Network flow data collectors at internet egress points'
      - 'SIEM aggregation platform'
    range: 'last 90 days'
    queries:
      - 'pseudocode': 'FOR each principal | CALCULATE 30_day_baseline(mean, std_dev of hourly_download_volume) | IF current_hourly_volume > (mean + 3 * std_dev) | ALERT'
  - question: 'Does a user''s data access volume represent a significant anomaly when compared to the normal rhythm and seasonality predicted by a time-series model?'
    context: 'This question uses a more sophisticated statistical approach to model the ''rhythm'' of a user''s activity, accounting for patterns like time of day, day of week, or monthly cycles. A time-series model (like ARIMA or Prophet) can predict an expected range of activity for any given time. An actual data volume that falls outside this predicted confidence interval is a strong indicator of an anomaly that simple averages might miss.'
    answer_sources:
      - 'AWS CloudTrail logs'
      - 'Azure Storage Analytics logs'
      - 'Zeek conn.log'
      - 'Cloud storage services (e.g., S3 buckets, Azure Blobs)'
      - 'Network flow data collectors at internet egress points'
      - 'SIEM aggregation platform'
    range: 'last 90 days'
    queries:
      - 'pseudocode': 'FOR each principal | FEED current_data_volume to time_series_model | IF current_volume is outside predicted_confidence_interval | ALERT'
  - question: 'Did a user log in from a location that is physically impossible to reach given the time and location of their previous login?'
    context: 'This question applies the classic ''impossible travel'' scenario to cloud access. If a user logs in from New York and then, 5 minutes later, logs in from London, it is a strong indicator that at least one of the credentials has been compromised. This is a high-fidelity alert for account takeover.'
    answer_sources:
      - 'AWS CloudTrail logs'
      - 'Azure Active Directory sign-in logs'
      - 'Windows Event ID 4624'
      - 'Zeek conn.log'
      - 'Identity and Access Management (IAM) systems'
      - 'Enterprise Identity Provider (e.g., ADFS, Okta)'
      - 'VPN concentrators'
      - 'Endpoint devices'
    range: 'last 90 days'
    queries:
      - 'pseudocode': 'FOR each successful_login | GET current_location and current_time | GET previous_location and previous_time | CALCULATE travel_time(current_location, previous_location) | IF (current_time - previous_time) < travel_time | ALERT'
  - question: 'Has a user''s login event accumulated a high-risk score based on multiple minor anomalies, such as an unusual time, a rare source network, or a new user agent?'
    context: 'This question recognizes that a single anomaly might not be suspicious, but a combination of several can be. It creates a risk score by adding points for each deviation from a user''s established ''pattern of life'' (e.g., unusual login hour, new device, rare network). If the total score crosses a threshold, it signals a high-risk event that warrants investigation, effectively identifying multifaceted attacks.'
    answer_sources:
      - 'AWS CloudTrail logs'
      - 'Azure Active Directory sign-in logs'
      - 'Windows Event ID 4624'
      - 'Zeek conn.log'
      - 'Identity and Access Management (IAM) systems'
      - 'Enterprise Identity Provider (e.g., ADFS, Okta)'
      - 'VPN concentrators'
      - 'Endpoint devices'
    range: 'last 90 days'
    queries:
      - 'pseudocode': 'FOR each login | risk_score = 0 | IF unusual_time | risk_score += 2 | IF rare_asn | risk_score += 3 | IF new_user_agent | risk_score += 1 | IF risk_score > 5 | ALERT'
  - question: 'Does a user''s login and access behavior deviate significantly from their normal ''pattern of life'' as identified by an unsupervised machine learning model?'
    context: 'This question uses advanced machine learning to detect complex behavioral changes. An unsupervised model like an Isolation Forest can learn a user''s multi-dimensional normal behavior (combining time, location, ASN, device, etc.). It can then flag events that are outliers in this high-dimensional space, even if no single attribute is grossly anomalous. This is effective at catching sophisticated adversaries trying to blend in.'
    answer_sources:
      - 'AWS CloudTrail logs'
      - 'Azure Active Directory sign-in logs'
      - 'Windows Event ID 4624'
      - 'Zeek conn.log'
      - 'Identity and Access Management (IAM) systems'
      - 'Enterprise Identity Provider (e.g., ADFS, Okta)'
      - 'VPN concentrators'
      - 'Endpoint devices'
    range: 'last 90 days'
    queries:
      - 'pseudocode': 'FOR each login_event | EXTRACT features (time, geo, asn, ua) | SCORE event with Isolation_Forest_model | IF model_flags_as_anomaly | ALERT'
  - question: 'Has an unauthenticated or anonymous user successfully accessed a non-public cloud storage object?'
    context: 'This question targets a critical misconfiguration or vulnerability. Non-public data should never be accessible to an anonymous user. A successful access event of this type is a high-severity indicator of a security failure and potential data breach, requiring immediate attention.'
    answer_sources:
      - 'AWS CloudTrail logs'
      - 'Azure Monitor logs'
      - 'Google Cloud Audit Logs'
      - 'Cloud provider IAM services'
      - 'Cloud storage configuration panels'
      - 'SIEM correlation engines'
    range: 'last 90 days'
    queries:
      - 'pseudocode': 'SEARCH cloud_api_logs WHERE principal = ''ANONYMOUS'' AND event_result = ''Success'' AND target_resource IS NOT public | ALERT'
  - question: 'Is a user generating an unusually high rate of ''Access Denied'' errors, followed shortly by a successful access to a previously denied resource?'
    context: 'This question seeks to identify privilege escalation or permission testing. An adversary may initially lack access and probe different resources, generating many ''Access Denied'' errors. A sudden successful access to one of those same resources suggests they have successfully escalated their privileges or found a misconfiguration to exploit. The pattern of ''many failures, then one success'' is highly suspicious.'
    answer_sources:
      - 'AWS CloudTrail logs'
      - 'Azure Monitor logs'
      - 'Google Cloud Audit Logs'
      - 'Cloud provider IAM services'
      - 'Cloud storage configuration panels'
      - 'SIEM correlation engines'
    range: 'last 90 days'
    queries:
      - 'pseudocode': 'FOR each principal | IF count(access_denied_errors) in 5_min > 99th_percentile(baseline) | MONITOR principal | IF successful_access to previously_denied_resource within 15_min | ALERT'
  - question: 'Does a user''s API activity fall into a cluster characterized by a high ratio of failed-to-successful calls and a wide variety of attempted actions, indicating reconnaissance?'
    context: 'This question uses clustering to group user sessions based on their behavior. Normal users typically have a low error rate and perform a limited set of actions. A session with a high error rate, a high variety of API calls, and many distinct resources being targeted is anomalous. A clustering algorithm can automatically identify these outlier sessions, which are indicative of an adversary performing reconnaissance or brute-forcing permissions.'
    answer_sources:
      - 'AWS CloudTrail logs'
      - 'Azure Monitor logs'
      - 'Google Cloud Audit Logs'
      - 'Cloud provider IAM services'
      - 'Cloud storage configuration panels'
      - 'SIEM correlation engines'
    range: 'last 90 days'
    queries:
      - 'pseudocode': 'CLUSTER user_sessions using DBSCAN on features (error_ratio, action_variety, resource_variety) | IDENTIFY principals in sparse, ''high error, high variety'' clusters | ALERT'