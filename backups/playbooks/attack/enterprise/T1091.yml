name: T1091: Replication Through Removable Media
id: 1a8c7b3e-0b4d-4f1a-9c8d-6e5f4a3b2c1d
description: |
  This playbook addresses the threat of adversaries using removable media for both initial access and lateral movement. It provides investigative questions to detect this activity by identifying suspicious process executions originating from removable drives, the creation of files associated with automatic execution (like autorun.inf or malicious .lnk files), the staging of known or novel malware onto drives, and subsequent malicious behavior such as network scanning or persistence attempts initiated by these processes.
type: technique
related:
  - TA0001: Initial Access
  - TA0008: Lateral Movement
contributors: Zachary Szewczyk, Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Is a process executing from a removable drive a known malicious file?
    context: |
      This question aims to identify straightforward attacks where an adversary uses known malware on a removable drive. By hashing the executable file launched from a removable drive and checking it against threat intelligence feeds, we can quickly detect recognized threats. A match provides a high-confidence indicator of compromise.
    answer_sources: |
      Sysmon Event ID 1, Windows Event ID 4688, Threat intelligence feeds, All endpoint devices (workstations, laptops), Kiosks and shared-use terminals, Physical entry points to sensitive or air-gapped networks, Visitor check-in stations
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          SEARCH process_creation_events
          WHERE image_path on removable_drive
          HASH image_file
          LOOKUP hash in threat_intel_feeds
          IF match THEN ALERT
  - question: Is an executable running from removable media statistically rare within the enterprise?
    context: |
      This question helps uncover potentially novel or targeted malware that is not present in threat intelligence feeds. By calculating the prevalence of every executable hash launched from removable media, we can isolate those that are uncommon. A very low prevalence might indicate a custom tool used in a targeted attack, warranting further investigation.
    answer_sources: |
      Sysmon Event ID 1, Windows Event ID 4688, All endpoint devices (workstations, laptops), Kiosks and shared-use terminals, Physical entry points to sensitive or air-gapped networks, Visitor check-in stations
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          SEARCH process_creation_events WHERE image_path on removable_drive over last 90 days
          STATS count(unique hosts) by image_hash
          CALCULATE prevalence_percentile for each hash
          FILTER percentile < 1
          FLAG for investigation
  - question: Does a process executing from removable media exhibit characteristics of malware based on a machine learning model?
    context: |
      This question uses a machine learning approach to detect malicious behavior that might evade simpler checks. By analyzing a feature set including file properties (entropy, PE header), command-line arguments, and process context (parent, user), a classification model can identify suspicious executions that may not be known threats or statistically rare but still behave maliciously.
    answer_sources: |
      Sysmon Event ID 1, Windows Event ID 4688, All endpoint devices (workstations, laptops), Kiosks and shared-use terminals, Physical entry points to sensitive or air-gapped networks, Visitor check-in stations
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each process_creation_event on removable_drive
          EXTRACT features (entropy, PE_header, args, parent_process, user)
          APPLY classification_model
          IF probability_malicious > 0.9 THEN ALERT
  - question: Has a file been created on a removable drive that is designed to facilitate automatic execution, such as 'autorun.inf' or a malicious .lnk file?
    context: |
      This question looks for classic Autorun/Autoplay abuse vectors. The creation of an 'autorun.inf' file is a direct attempt to configure automatic execution when the drive is inserted. Similarly, a specially crafted shortcut (.lnk) file can trick a user into running a payload stored on the same drive. Detecting the creation of these files is a strong indicator of an attempt to stage an attack.
    answer_sources: |
      Sysmon Event ID 11, Sysmon Event ID 1, Windows Event ID 4688, All endpoint devices with enabled USB ports, Systems used for imaging or deploying software, Vendor maintenance laptops
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          SEARCH file_creation_events on removable_drive
          IF filename == 'autorun.inf' THEN ALERT
          IF file_extension == '.lnk'
          PARSE lnk_file to get target_path
          IF target_path on same_removable_drive and is_executable THEN ALERT
  - question: Has a file with a suspicious, high-entropy filename been created on a removable drive?
    context: |
      This question aims to detect malware that uses randomized or obfuscated filenames to evade simple signature-based detection. By calculating the character-level entropy of filenames created on removable media and comparing it to a user's normal baseline, we can flag unusually complex names that may belong to malicious files.
    answer_sources: |
      Sysmon Event ID 11, All endpoint devices with enabled USB ports, Systems used for imaging or deploying software, Vendor maintenance laptops
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each file_creation_event on removable_drive
          CALCULATE filename_entropy
          COMPARE to user_baseline_entropy_distribution
          IF entropy > 99th_percentile of baseline THEN ALERT
  - question: Has a file been created on a removable drive that is anomalous based on its overall characteristics?
    context: |
      This question uses anomaly detection to find suspicious file staging activity that may not trigger specific rules. By using an Isolation Forest or similar model on features like filename length, entropy, extension, and parent process, we can identify outlier file creation events that deviate significantly from normal behavior and warrant investigation.
    answer_sources: |
      Sysmon Event ID 11, All endpoint devices with enabled USB ports, Systems used for imaging or deploying software, Vendor maintenance laptops
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each file_creation_event on removable_drive
          EXTRACT features (filename_length, filename_entropy, extension, parent_process, time_of_day)
          APPLY Isolation Forest model
          IF identified as strong anomaly THEN ALERT
  - question: Was a process executed from a removable drive automatically upon insertion, rather than by a user?
    context: |
      This question attempts to detect malicious Autorun activity by correlating the timing of a device connection event with a subsequent process execution. If a process is launched from the new drive within a very short time window (e.g., under 60 seconds) by a process other than the user's shell (like 'explorer.exe'), it strongly suggests an automated execution mechanism.
    answer_sources: |
      Sysmon Event ID 1, Microsoft-Windows-Kernel-PnP/Configuration Event ID 400, Microsoft-Windows-Kernel-PnP/Configuration Event ID 410, Windows Event ID 4688, All endpoint devices, High-security area workstations, Server room physical access points, Industrial Control System (ICS) Human-Machine Interfaces (HMIs)
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          CORRELATE PnP_connection_events with process_creation_events from same drive
          IF time_delta < 60 seconds AND parent_process is not 'explorer.exe'
          THEN ALERT
  - question: Was the time between a USB drive insertion and a process execution from that drive anomalously short for a given user?
    context: |
      This question provides a more nuanced way to detect automated execution by baselining user behavior. Every user has a typical interaction time between plugging in a drive and manually launching a file. An execution that occurs significantly faster than the user's personal baseline suggests the action was automated, not user-initiated.
    answer_sources: |
      Sysmon Event ID 1, Microsoft-Windows-Kernel-PnP/Configuration Event ID 400, Microsoft-Windows-Kernel-PnP/Configuration Event ID 410, Windows Event ID 4688, All endpoint devices, High-security area workstations, Server room physical access points, Industrial Control System (ICS) Human-Machine Interfaces (HMIs)
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each user, BASELINE distribution of time_delta between USB_insertion and process_execution
          FOR each new execution, CALCULATE time_delta
          IF time_delta < 5th_percentile of user's baseline THEN ALERT
  - question: Was there an anomalous spike in process executions from removable media immediately following a device connection?
    context: |
      This question uses time-series analysis to detect Autorun-based events at a macro level. A sudden, sharp increase in the rate of process executions from removable media on a host is suspicious. If this spike is temporally correlated with a recent device connection event, it provides strong evidence of an automated execution swarm, typical of some malware.
    answer_sources: |
      Sysmon Event ID 1, Microsoft-Windows-Kernel-PnP/Configuration Event ID 400, Microsoft-Windows-Kernel-PnP/Configuration Event ID 410, Windows Event ID 4688, All endpoint devices, High-security area workstations, Server room physical access points, Industrial Control System (ICS) Human-Machine Interfaces (HMIs)
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          MODEL rate of process_executions from removable_media per host
          DETECT anomalous spikes in the time-series
          CORRELATE spike with recent device_connection_event on same host
          IF correlation is strong THEN ALERT
  - question: Did a process originating from removable media perform high-risk follow-on activities like network connections to bad domains, registry persistence, or writing files to system directories?
    context: |
      This question helps confirm the maliciousness of a process from a removable drive by tracking its subsequent actions. By linking the initial process to later events like C2 communication, adding an autorun registry key, or dropping a payload in a system folder, we can create a high-fidelity alert that chains together the entire attack sequence.
    answer_sources: |
      Sysmon Event ID 1, Sysmon Event ID 3, Sysmon Event ID 11, Sysmon Event ID 13, Zeek conn.log, Zeek dns.log, Domain Controllers (for authentication logs), Network egress points (for C2 traffic), All endpoint devices, DNS Resolvers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR process from removable_media, get ProcessGUID
          TRACK subsequent events with same ProcessGUID
          IF event is network_connection to known_bad_IP/domain
          OR event is registry_write to autorun_key
          OR event is file_write of executable to SystemRoot
          THEN ALERT
  - question: Did a process launched from removable media accumulate a high risk score based on its child activities?
    context: |
      This question uses a risk-scoring model to flag suspicious processes that may not perform a single, definitively malicious action. By assigning points for various suspicious behaviors (e.g., connecting to a rare country, using a high-entropy domain, spawning PowerShell), we can identify processes whose cumulative activity profile is indicative of malware, even if each individual action is not.
    answer_sources: |
      Sysmon Event ID 1, Sysmon Event ID 3, Zeek conn.log, Zeek dns.log, Domain Controllers (for authentication logs), Network egress points (for C2 traffic), All endpoint devices, DNS Resolvers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR process from removable_media
          CALCULATE risk_score based on child activities (e.g., network_dest, DNS_query_entropy, child_process_name)
          COMPARE score to baseline of benign process scores
          IF score > 99th_percentile THEN ALERT
  - question: Does the entire activity tree of a process from a removable drive classify as malicious by a machine learning model?
    context: |
      This question takes a holistic view by analyzing the entire chain of activities spawned by the initial process. By representing the process and its descendants (including file, registry, and network events) as a tree, a tree-based ML model can classify the entire behavior pattern as malicious or benign, providing a more robust detection than looking at individual events.
    answer_sources: |
      Sysmon Event ID 1, Sysmon Event ID 3, Sysmon Event ID 11, Sysmon Event ID 13, Zeek conn.log, Zeek dns.log, Domain Controllers (for authentication logs), Network egress points (for C2 traffic), All endpoint devices, DNS Resolvers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR process from removable_media, build activity_tree of all descendant events
          EXTRACT features from tree (depth, breadth, node_types)
          APPLY tree-based classification_model
          IF classified as malicious with high confidence THEN ALERT
  - question: Is a file being written to a removable drive a known piece of malware?
    context: |
      This question aims to detect a compromised host attempting to stage malware onto a removable drive for lateral movement. By hashing files as they are written to a removable drive and checking them against threat intelligence, we can proactively identify a system trying to propagate a known threat.
    answer_sources: |
      Sysmon Event ID 11, Threat intelligence feeds, All internal workstations, File servers, Jump boxes, Systems in secure network enclaves
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          SEARCH file_creation_events on removable_drive
          HASH the created file
          LOOKUP hash in threat_intel_feeds
          IF match THEN ALERT
  - question: Is a host writing an anomalously high number of executable files to removable media?
    context: |
      This question helps detect automated replication behavior, such as a worm copying itself to a connected drive. By establishing a baseline for how many executable files a host or user typically writes to removable media, we can alert when this rate significantly increases, suggesting a non-manual, programmatic replication process.
    answer_sources: |
      Sysmon Event ID 11, All internal workstations, File servers, Jump boxes, Systems in secure network enclaves
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          BASELINE rate of executable file writes to removable_media per host/user
          MONITOR current rate
          IF current_rate > 3 standard deviations above mean
          THEN ALERT
  - question: Does a file written to a removable drive have features consistent with malware according to a machine learning classifier?
    context: |
      This question helps detect the staging of novel or unknown malware variants. By applying a pre-trained classifier to features of the file being written (e.g., entropy, PE import hash, file size), we can identify executables that are likely malicious even if their hash is not in any threat intelligence database.
    answer_sources: |
      Sysmon Event ID 11, All internal workstations, File servers, Jump boxes, Systems in secure network enclaves
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each executable file_creation_event on removable_drive
          EXTRACT features (entropy, import_hash, size, writing_process)
          APPLY file classification_model
          IF probability_malicious > 0.9 THEN ALERT
  - question: Is a file being written to a removable drive intended to enable Autorun or deceive a user?
    context: |
      This question looks for the creation of files designed to facilitate execution on a new host. This includes writing 'autorun.inf' for automated execution, or using deceptive filenames with double extensions or Right-to-Left-Override (RTLO) characters to trick users into running a malicious file.
    answer_sources: |
      Sysmon Event ID 11, Sysmon Event ID 1, All internal workstations and servers with USB access, Shared departmental file shares (as a source for files being copied)
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          SEARCH file_creation_events on removable_drive
          IF filename == 'autorun.inf' THEN ALERT
          IF filename contains RTLO_character (U+202E) THEN ALERT
          IF filename matches regex for double_extensions (e.g., \.pdf\.exe$) THEN ALERT
  - question: Is an executable file being written to a removable drive disguised as a document?
    context: |
      This question aims to detect social engineering attempts where malware is given a name similar to a benign document to trick users. By measuring the similarity (e.g., Levenshtein distance) between an executable's filename and common document-related terms ('report', 'invoice'), we can flag executables that are masquerading as something else.
    answer_sources: |
      Sysmon Event ID 11, All internal workstations and servers with USB access, Shared departmental file shares (as a source for files being copied)
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          SEARCH executable file_creation_events on removable_drive
          CALCULATE Levenshtein_distance between filename and list of document_terms
          IF distance is low THEN ALERT
  - question: Are multiple, slightly different variants of the same malware family being written to removable drives?
    context: |
      This question helps identify a single malware campaign that uses polymorphism to evade hash-based detection. By clustering files written to removable drives based on their features (like filename/file entropy and PE import hashes), we can group together anomalous files that are likely variations of the same malware.
    answer_sources: |
      Sysmon Event ID 11, All internal workstations and servers with USB access, Shared departmental file shares (as a source for files being copied)
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR files written to removable_drives, EXTRACT feature_vectors
          APPLY clustering algorithm (e.g., DBSCAN)
          INVESTIGATE anomalous clusters
  - question: Has a file, after being written to a removable drive on one host, been executed from a removable drive on a different host?
    context: |
      This is a high-confidence question for detecting successful lateral movement via removable media. By tracking file hashes, we can directly link a file-write event on a source host to a process-execution event on a destination host, proving the removable drive was used as a vector.
    answer_sources: |
      Sysmon Event ID 11, Sysmon Event ID 1, Windows Event ID 4688, All internal network segments containing multiple workstations or servers, Systems with high user mobility (e.g., shared operations centers), Air-gapped network transfer stations
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          MAINTAIN state_table of (Hash, SourceHost, Timestamp) for files written to removable_media
          ON process_execution from removable_media
          LOOKUP process_hash in state_table
          IF match found AND ExecutingHost != SourceHost THEN ALERT
  - question: Can we identify key "spreader" hosts in a removable media-based malware outbreak?
    context: |
      This question uses graph analysis to understand the propagation of malware across the network. By modeling hosts as nodes and file transfers via removable media as edges, we can identify which machines are responsible for spreading the infection (high out-degree) and which are central to the outbreak, helping to prioritize containment efforts.
    answer_sources: |
      Sysmon Event ID 11, Sysmon Event ID 1, Windows Event ID 4688, All internal network segments containing multiple workstations or servers, Systems with high user mobility (e.g., shared operations centers), Air-gapped network transfer stations
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          BUILD graph with hosts as nodes and file_transfers_via_USB as edges
          ANALYZE graph for nodes with high out-degree or high PageRank centrality
          FLAG these hosts as key spreaders
  - question: Was a file transfer and execution sequence between two hosts via removable media anomalous for the users involved?
    context: |
      This question uses a machine learning model to detect unusual lateral movement pathways. A sequence model can learn typical patterns of file sharing between users and hosts. An alert is triggered if a file from one user/host (e.g., Finance) is executed on a host in a different department (e.g., Engineering) where such sharing is not expected.
    answer_sources: |
      Sysmon Event ID 11, Sysmon Event ID 1, Windows Event ID 4688, All internal network segments containing multiple workstations or servers, Systems with high user mobility (e.g., shared operations centers), Air-gapped network transfer stations
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          TRAIN sequence model (e.g., LSTM) on normal (write_event, execute_event) pairs
          APPLY model to new sequences
          IF sequence of (source_user, dest_host) is anomalous THEN ALERT
  - question: Is a process that originated from a removable drive now scanning the internal network?
    context: |
      This question seeks to identify worm-like behavior where malware, after infecting a host via removable media, begins scanning for other vulnerable machines. By tracking the process spawned from the drive and its children, an alert can be triggered if it starts making an unusually high number of connections to internal hosts on common ports like SMB (445).
    answer_sources: |
      Sysmon Event ID 1, Sysmon Event ID 3, Zeek conn.log, Windows Event ID 4624, Internal network segments, Authentication servers (Domain Controllers), Network sensor tap points
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR process from removable_media, track its ProcessGUID and children
          COUNT unique internal hosts connected to on port 445 within 5 minutes
          IF count > 10 THEN ALERT
  - question: Does a process from a removable drive exhibit anomalous network behavior compared to benign processes?
    context: |
      This question provides a behavioral baseline approach to detecting malicious network activity. By profiling the typical number of distinct IPs and ports that benign processes from removable media connect to, we can flag any new process that significantly exceeds these norms, indicating potential scanning or C2 activity.
    answer_sources: |
      Sysmon Event ID 1, Sysmon Event ID 3, Zeek conn.log, Windows Event ID 4624, Internal network segments, Authentication servers (Domain Controllers), Network sensor tap points
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          BASELINE distribution of unique_IPs and unique_ports contacted by benign processes from removable_media
          FOR new process, measure these metrics
          IF metrics exceed 98th_percentile of baseline THEN ALERT
  - question: Is a process execution from removable media correlated with a spike in failed network logon attempts?
    context: |
      This question aims to detect if malware introduced via removable media is attempting to move laterally using credential-based attacks like password spraying. A sudden, anomalous increase in failed network logons (Logon Type 3) originating from a host shortly after a process was executed from a removable drive is a strong indicator of such an attempt.
    answer_sources: |
      Sysmon Event ID 1, Windows Event ID 4624, Internal network segments, Authentication servers (Domain Controllers), Network sensor tap points
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          MONITOR rate of failed_network_logons (Type 3) per source_host
          DETECT anomalous spikes in logon_failure_rate
          CORRELATE spike_timestamp with process_creation_from_removable_media on same host
          IF correlation within short time window THEN ALERT