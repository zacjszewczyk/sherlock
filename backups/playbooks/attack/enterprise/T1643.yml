name: T1643: Generate Traffic from Victim
id: 9c6a8f1e-3b7d-4c2a-9e0f-1d8a6b4c3d2e
description: This playbook helps to determine if an adversary is using managed mobile devices to generate fraudulent or malicious outbound traffic. It focuses on detecting two primary patterns of activity: 1) unusual SMS messages, such as those sent to known fraudulent or premium-rate numbers, or a high volume of messages sent from non-standard messaging applications, and 2) automated network activity characterized by high volumes of DNS queries or HTTP/S requests, low randomness (entropy) in DNS queries, and a high ratio of network connections to data transferred. This helps identify potential SMS fraud and automated click fraud or ad fraud campaigns originating from compromised devices.
type: technique
related:
  - TA0034: Impact
contributors: Zachary Szewczyk, Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Has a managed mobile device sent an SMS to a known fraudulent or premium-rate number?
    context: This question is crucial for detecting toll fraud, where adversaries use compromised devices to send messages to premium-rate numbers, generating revenue for themselves at the organization's expense. Identifying these messages quickly can prevent significant financial loss. The investigation focuses on matching outbound SMS destinations against a curated list of known malicious numbers from threat intelligence feeds.
    answer_sources:
      - Carrier billing records
      - Mobile Device Management (MDM) application inventory logs
      - MDM application permission logs
      - Managed mobile device fleet, MDM servers, and Telecommunications provider billing systems
      - Threat intelligence feeds for fraudulent and premium-rate numbers
    range: last 90 days
    queries:
      - pseudocode: FOR each outbound SMS record FROM carrier logs, JOIN with MDM data on device ID. IF SMS destination number IN threat_intel_list_of_fraudulent_numbers, THEN ALERT with device, user, destination, and application details.
  - question: Is a non-messaging application on a managed mobile device sending an anomalously high volume of SMS messages?
    context: This question helps identify malicious applications (malware) that have gained SMS permissions and are using them for nefarious purposes, such as sending spam, phishing links, or communicating with C2 servers, without the user's knowledge. By baselining normal behavior, analysts can spot significant deviations that indicate a compromise, even if the destination numbers are not on a known blocklist.
    answer_sources:
      - Carrier billing records
      - Mobile Device Management (MDM) application inventory logs
      - MDM application permission logs
      - Managed mobile device fleet, MDM servers, and Telecommunications provider billing systems
    range: last 90 days
    queries:
      - pseudocode: FOR each device, IDENTIFY non-messaging apps with SEND_SMS permission from MDM logs. CALCULATE 30-day 99th percentile baseline for daily SMS count per app from carrier logs. IF current daily SMS count > baseline, THEN ALERT with device, app, and count details.
  - question: Does an outbound SMS event exhibit characteristics of fraudulent activity based on a machine learning model?
    context: This question leverages a more sophisticated, multi-faceted approach to detecting SMS fraud. Instead of relying on a single indicator, a machine learning model can analyze a combination of factors (like the sending app, time, destination, and user history) to identify subtle patterns of malicious behavior. This is particularly effective against new or unknown threats that haven't been added to threat intelligence feeds yet. A high-confidence alert from the model suggests a strong likelihood of compromise, justifying an automated response like device quarantine.
    answer_sources:
      - Carrier billing records
      - Mobile Device Management (MDM) application inventory logs
      - MDM application permission logs
      - Managed mobile device fleet, MDM servers, and Telecommunications provider billing systems
      - Historical SMS data (labeled as fraudulent/benign)
    range: last 90 days
    queries:
      - pseudocode: FOR each outbound SMS event, GATHER features (app category, permissions, time of day, destination country, user history). INPUT features into trained classification model. IF model_output is 'fraudulent' AND confidence_score > 0.95, THEN ALERT and initiate quarantine.
  - question: Is a managed mobile device communicating with domains or URLs known to be associated with ad fraud, click fraud, or app-ranking manipulation?
    context: This question aims to detect if a device is being used as part of a botnet to generate illegitimate ad revenue or manipulate application store rankings. Such activity consumes device resources and network bandwidth and can be a precursor to more malicious actions. By cross-referencing network traffic with threat intelligence, analysts can quickly identify compromised devices participating in these fraudulent schemes.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Zeek http.log
      - Corporate Wi-Fi network gateways, DNS resolvers, and Internet web proxies
      - Threat intelligence feeds for ad/click fraud
    range: last 90 days
    queries:
      - pseudocode: FOR each DNS query or HTTP request from mobile IP range, CHECK domain/URL against threat_intel_list_of_fraud_domains. IF match found, THEN ALERT with source IP, destination, user_agent, and threat feed name.
  - question: Is a managed mobile device exhibiting a pattern of automated, non-random network behavior indicative of fraudulent traffic generation?
    context: This question targets the behavioral footprint of automated malicious activity. Bots often generate a high volume of small, repetitive connections, leading to a high connection-to-byte ratio. Their DNS lookups are typically not random (low entropy) as they contact a limited set of C2 or target domains. By baselining normal device behavior and looking for a simultaneous spike in connections and a drop in DNS randomness, analysts can detect this type of automated, bot-like traffic.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Zeek http.log
      - Corporate Wi-Fi network gateways, DNS resolvers, and Internet web proxies
    range: last 90 days
    queries:
      - pseudocode: ON an hourly basis for each device IP, CALCULATE connection count, DNS query entropy, and connection/byte ratio. COMPARE to 30-day baseline for that hour. IF (connection count > 95th percentile OR conn/byte ratio > 95th percentile) AND (DNS entropy < 5th percentile), THEN ALERT.
  - question: Is a managed mobile device's network traffic pattern significantly deviating from its established normal behavior, as identified by an anomaly detection model?
    context: This question uses an unsupervised machine learning approach to find 'unknown unknowns' in network traffic. By learning a device's unique multi-dimensional "normal" based on features like connection counts, port distribution, user agents, and DNS patterns, an anomaly detection model can flag any significant deviation. This is powerful for detecting novel or sophisticated attacks that don't match pre-defined rules or signatures. An anomalous score serves as a high-fidelity signal for an analyst to investigate a potential compromise.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Zeek http.log
      - Corporate Wi-Fi network gateways, DNS resolvers, and Internet web proxies
      - Historical (30+ days) Zeek log data for model training
    range: last 90 days
    queries:
      - pseudocode: FOR each 5-minute window per device IP, GATHER features (conn count, DNS entropy, distinct IPs, port distribution, etc.). INPUT features into trained anomaly detection model. IF anomaly_score exceeds threshold, THEN ALERT.