name: T1201: Password Policy Discovery
id: 5b1a3d9e-1f8c-4b6a-8e9d-2c7f4a1b0d3e
description: Is the adversary attempting to discover enterprise password policies? This playbook helps identify attempts to discover enterprise password policies through various methods. Indicators include the execution of known discovery tools identified by file hash, the use of specific command-line arguments (e.g., 'net accounts /domain', 'Get-ADDefaultDomainPasswordPolicy'), suspicious parent-child process relationships (e.g., 'net.exe' spawned by 'outlook.exe'), the execution of discovery commands outside of normal working hours, rapid sequences of discovery and credential access techniques, and unauthorized API calls to cloud password policy endpoints (e.g., AWS IAM, Azure AD).
type: technique
related:
  - TA0007: Discovery
contributors:
  - Zachary Szewczyk
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Are any processes being created whose executable hashes match known malicious tools on threat intelligence feeds?
    context: This question aims to identify the execution of known malicious discovery tools like PowerSploit or BloodHound by matching their file hashes against a threat intelligence feed. A match provides a high-confidence indicator of compromise and warrants immediate response, such as host quarantine.
    answer_sources:
      - Windows Security Event ID 4688
      - Sysmon Event ID 1
      - Domain Controllers
      - Member Servers
      - Privileged Access Workstations
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: SEARCH process_creation_events | JOIN file_hashes with threat_intelligence_feed ON hash | RETURN matched_processes
  - question: Are there any rarely seen executables running with command-line arguments related to password policy discovery?
    context: This question helps uncover unknown or custom tools by focusing on executables that have a very low footprint in the environment (low prevalence). Combining this rarity with suspicious command-line arguments (e.g., 'policy', 'password') helps filter out noise and pinpoint potential targeted discovery activity.
    answer_sources:
      - Windows Security Event ID 4688
      - Sysmon Event ID 1
      - Domain Controllers
      - Member Servers
      - Privileged Access Workstations
    range: last 30 days
    queries:
      - technology: Pseudocode
        query: SEARCH process_creation_events | CALCULATE prevalence of file_hash | FILTER prevalence < 1% AND command_line CONTAINS ('policy', 'password', 'net', 'accounts') | RETURN suspicious_processes
  - question: Can a machine learning model classify newly observed, unknown executables as malicious based on their execution characteristics?
    context: This question proposes a proactive, machine learning-based approach to detect novel threats. By training a model on the features of known-good and known-bad processes, it can predict the maliciousness of new executables that haven't been seen before, providing a defense against zero-day discovery tools.
    answer_sources:
      - Windows Security Event ID 4688
      - Sysmon Event ID 1
      - Domain Controllers
      - Member Servers
      - Privileged Access Workstations
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: SEARCH process_creation_events | EXTRACT features (parent_process, user, path_entropy) | SCORE with trained_ML_model | RETURN processes with high_malicious_score
  - question: Are non-administrative users executing commands known for password policy discovery?
    context: This question seeks to identify when users who are not system administrators run commands specifically used for discovering password policies. Since such actions are typically reserved for administrative roles, execution by a standard user is highly suspicious and could indicate a compromised account or insider threat.
    answer_sources:
      - Windows Security Event ID 4688
      - Windows PowerShell Event ID 4104
      - Sysmon Event ID 1
      - Zeek syslog.log
      - Domain Controllers
      - Linux/macOS Servers
      - End-user Workstations
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: SEARCH command_line_logs for discovery_patterns | FILTER user NOT IN 'System Administrators' group | RETURN suspicious_executions
  - question: Is any user executing password policy discovery commands at a rate that is anomalous for them or their peer group?
    context: This question focuses on detecting abnormal behavior by baselining normal activity. An alert is triggered when a user suddenly starts running policy discovery commands far more frequently than their own history or the average of their peers, which can indicate that their account is being used for reconnaissance.
    answer_sources:
      - Windows Security Event ID 4688
      - Windows PowerShell Event ID 4104
      - Sysmon Event ID 1
      - Zeek syslog.log
      - Domain Controllers
      - Linux/macOS Servers
      - End-user Workstations
    range: last 30 days
    queries:
      - technology: Pseudocode
        query: SEARCH discovery_command_executions | COMPARE daily_count to user_baseline and peer_group_baseline | RETURN executions where count > 99th_percentile
  - question: Can clustering algorithms identify new or obfuscated password policy discovery commands?
    context: This question uses an unsupervised machine learning approach to find novel threats. By grouping similar command-line arguments together, the analysis can isolate small, outlier clusters containing suspicious keywords. This helps analysts discover potentially obfuscated or previously unknown variants of discovery commands that might evade signature-based detections.
    answer_sources:
      - Windows Security Event ID 4688
      - Windows PowerShell Event ID 4104
      - Sysmon Event ID 1
      - Zeek syslog.log
      - Domain Controllers
      - Linux/macOS Servers
      - End-user Workstations
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: SEARCH process_creation_events | VECTORIZE command_line_arguments | APPLY DBSCAN clustering | ANALYZE outlier_clusters for suspicious_tokens
  - question: Are password policy discovery commands being spawned by unusual parent processes like office applications?
    context: This question identifies suspicious process lineage. Legitimate administrative commands are rarely, if ever, initiated by applications like Outlook or Word. Such an event strongly suggests a malicious payload, such as a macro in a phishing document, is executing discovery commands.
    answer_sources:
      - Windows Security Event ID 4688
      - Windows Security Event ID 4624
      - Sysmon Event ID 1
      - End-user Workstations
      - Application Servers
      - Domain Controllers
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: SEARCH discovery_process_executions | FILTER parent_process IN ('winword.exe', 'outlook.exe', 'chrome.exe') | RETURN suspicious_child_processes
  - question: Is any user executing password policy discovery commands at a time of day that is abnormal for their typical work schedule?
    context: This question leverages temporal analysis to detect anomalous behavior. By establishing a baseline of each user's normal working hours, the system can flag discovery command executions that occur at unusual times, such as late at night or on weekends. This could indicate a compromised account being used by an adversary in a different time zone.
    answer_sources:
      - Windows Security Event ID 4688
      - Windows Security Event ID 4624
      - Sysmon Event ID 1
      - End-user Workstations
      - Application Servers
      - Domain Controllers
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: SEARCH discovery_command_executions | CALCULATE Z-score of execution_time against user_hourly_baseline | RETURN executions where Z-score > 3.5
  - question: Can an anomaly detection model identify policy discovery command executions that are inconsistent with legitimate administrative sessions?
    context: This question applies a machine learning model to distinguish between legitimate and malicious administrative activity. By training a model on the features of known-benign sessions (e.g., user role, host, time), it can score new executions of policy discovery commands and flag those that deviate significantly from the established norm, indicating potential misuse.
    answer_sources:
      - Windows Security Event ID 4688
      - Windows Security Event ID 4624
      - Sysmon Event ID 1
      - End-user Workstations
      - Application Servers
      - Domain Controllers
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: SEARCH discovery_command_executions | SCORE session_features with Isolation_Forest_model | RETURN sessions with high_anomaly_score
  - question: Is a password policy discovery event quickly followed by other discovery or credential access techniques by the same user or on the same host?
    context: This question correlates different attack techniques to identify a broader campaign. A password policy discovery event followed closely by another reconnaissance or credential access activity (like enumerating domain admins or attempting to dump credentials) provides strong evidence of an active, progressing attack.
    answer_sources:
      - Windows Security Event ID 4688
      - Sysmon Event ID 1
      - Zeek conn.log
      - All hosts within the enterprise network
      - network egress points
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: ON T1201_alert, SEARCH for TA0007 or TA0006 techniques from same user/host within 60 minutes | RETURN correlated_alerts
  - question: Does the sequence of ATT&CK techniques in a user session, beginning with password policy discovery, indicate a higher probability of malicious intent?
    context: This question moves beyond single alerts to analyze the probability of attack sequences. By calculating the baseline probability of one technique following another, analysts can identify user sessions where a transition from password discovery (T1201) to a high-risk technique (like T1003 Credential Dumping) is statistically unlikely, thus elevating the session's risk score.
    answer_sources:
      - Windows Security Event ID 4688
      - Sysmon Event ID 1
      - Zeek conn.log
      - All hosts within the enterprise network
      - network egress points
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: CALCULATE baseline P(TechniqueB | T1201) | FOR each session with T1201, check if observed P(TechniqueB | T1201) exceeds baseline | RETURN high_risk_sessions
  - question: Can a sequence analysis model identify malicious command sequences that include a password policy discovery event?
    context: This question proposes using a sophisticated machine learning model (like an LSTM) to understand the grammar of benign command sequences. When a new sequence of commands containing a T1201 event is observed, the model can determine if that sequence is improbable or "out of character" for normal administrative behavior, flagging it as potentially malicious.
    answer_sources:
      - Windows Security Event ID 4688
      - Sysmon Event ID 1
      - Zeek conn.log
      - All hosts within the enterprise network
      - network egress points
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: TRAIN LSTM model on benign_command_sequences | FEED new command_sequences with T1201 event | RETURN sequences with low_benign_probability
  - question: Are unauthorized users or IP addresses making API calls to cloud password policy endpoints or sending CLI commands to network devices?
    context: This question extends discovery detection to cloud and network infrastructure. It checks for API calls (e.g., to AWS or Azure) or CLI commands (e.g., to routers) related to password policies. By cross-referencing the source against an allowlist of authorized administrators, it can quickly spot unauthorized reconnaissance.
    answer_sources:
      - Zeek http.log
      - Zeek syslog.log
      - Windows PowerShell Event ID 4104
      - AWS CloudTrail
      - Azure Activity Logs
      - Network backbone switches/routers
      - Cloud IAM infrastructure
      - Internet gateway
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: SEARCH cloud_or_network_logs for password_policy_queries | FILTER source_user_or_IP NOT IN admin_allowlist | RETURN unauthorized_queries
  - question: Has there been a sudden drop in the diversity of source IPs making DNS requests for cloud IAM endpoints?
    context: This question uses DNS query patterns to detect targeted reconnaissance. A sudden drop in the entropy (randomness) of source IPs querying cloud IAM domains can indicate that a single, compromised host is performing focused enumeration, as opposed to the normal, diverse pattern of many different legitimate clients.
    answer_sources:
      - Zeek http.log
      - Zeek syslog.log
      - Windows PowerShell Event ID 4104
      - AWS CloudTrail
      - Azure Activity Logs
      - Network backbone switches/routers
      - Cloud IAM infrastructure
      - Internet gateway
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: SEARCH dns.log for IAM_FQDNs | CALCULATE Shannon_entropy of source_IPs in 1-hour windows | ALERT on >50% drop from baseline
  - question: Is there an anomalous spike in the volume of cloud password policy API calls?
    context: This question uses time-series analysis to find unusual spikes in activity. By forecasting the expected volume of password policy API calls based on historical data, the system can automatically alert when the actual volume significantly exceeds the predicted amount, which could indicate a large-scale, automated discovery attempt.
    answer_sources:
      - Zeek http.log
      - Zeek syslog.log
      - Windows PowerShell Event ID 4104
      - AWS CloudTrail
      - Azure Activity Logs
      - Network backbone switches/routers
      - Cloud IAM infrastructure
      - Internet gateway
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: FORECAST hourly volume of policy_API_calls using ARIMA | ALERT if observed_volume > upper_confidence_interval