name: T1565.001: Stored Data Manipulation
id: a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d
description: This playbook helps investigate whether an adversary has manipulated stored data to impact business operations or conceal their activities. It focuses on detecting the execution of known data wiping tools, the misuse of legitimate system utilities for data destruction, unauthorized integrity changes to critical files, statistically abnormal rates of file modification or deletion, and mass file renaming activities characteristic of ransomware.
type: technique
related:
  - TA0040: Impact
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Has a known data wiper or manipulation tool been executed on the network?
    context: This question aims to identify the most direct evidence of a data manipulation attack by searching for executions of processes whose name or hash matches a known malicious tool. Tools like WhisperGate, NotPetya, and IsaacWiper are specifically designed for destructive purposes, and their presence is a high-confidence indicator of compromise and intent to cause impact. A match should be treated as a critical incident.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 4663
      - Zeek files.log
      - Domain Controllers
      - Database Servers
      - Critical Application Servers
      - Enterprise File Shares
      - Internet Gateways
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: SEARCH Windows Event ID 4688 WHERE ProcessName IN (threat_intel_list) OR ProcessHash IN (threat_intel_list)
  - question: Is any process exhibiting an anomalously high rate of file write or delete operations?
    context: This question seeks to uncover destructive behavior that may not involve a known malicious tool. By establishing a baseline of normal file operation rates for each host, we can statistically detect significant deviations ($$ > \mu + 4\sigma $$) that could indicate a process is rapidly destroying or altering data, regardless of its name or hash.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 4663
      - Zeek files.log
      - Domain Controllers
      - Database Servers
      - Critical Application Servers
      - Enterprise File Shares
      - Internet Gateways
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: SEARCH Windows Event ID 4663 | GROUP BY host, process | CALCULATE rate_per_minute | COMPARE rate_per_minute against historical_baseline | ALERT if rate > (mean + 4 * std_dev)
  - question: Can machine learning models classify any running processes as a malicious wiper based on its combined behaviors?
    context: This question leverages machine learning to provide a more sophisticated detection method. A classification model can analyze a combination of features—such as the process's origin, its command line, its file I/O patterns, and its network communications—to determine if it behaves like a malicious wiper. A positive classification from the model provides a high-confidence signal for automated response.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 4663
      - Zeek files.log
      - Domain Controllers
      - Database Servers
      - Critical Application Servers
      - Enterprise File Shares
      - Internet Gateways
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: STREAM process_events with features (parent, user, cmdline, file_io, net_conn) | APPLY ML_model (Gradient Boosting) | ALERT if classification == 'malicious_wiper'
  - question: Have legitimate system utilities been used with command-line arguments that indicate data destruction?
    context: Adversaries often abuse legitimate system tools ("living off the land") to avoid detection. This question focuses on identifying the misuse of utilities like 'cipher.exe', 'format.com', or 'sdelete.exe'. Specific command-line arguments (e.g., '/w:' for overwriting data) are highly indicative of malicious intent to destroy data.
    answer_sources:
      - Windows Event ID 4688
      - All Windows Endpoints and Servers, particularly those hosting sensitive data (e.g., financial records, intellectual property) or critical system configurations.
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: SEARCH Windows Event ID 4688 | REGEX CommandLine matches ('cipher.exe /w:', 'format.com /p:', 'sdelete.exe -p')
  - question: Are there statistically rare or anomalous executions of potentially destructive utilities?
    context: This question aims to find unusual usage of potentially harmful utilities that might not be caught by simple pattern matching. By calculating a rarity score for a command's execution (based on user, host, and historical frequency) and analyzing the complexity (Shannon entropy) of the command line, we can flag activity that deviates from normal administrative behavior.
    answer_sources:
      - Windows Event ID 4688
      - All Windows Endpoints and Servers, particularly those hosting sensitive data (e.g., financial records, intellectual property) or critical system configurations.
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: SEARCH Windows Event ID 4688 for utility_executions | CALCULATE rarity_score by user, host | CALCULATE entropy of CommandLine | ALERT if rarity_score > 99th_percentile OR entropy is anomalous
  - question: Does a machine learning model identify any executions of destructive utilities as anomalous based on the context of the user, host, and parent process?
    context: This question uses an anomaly detection model (like Isolation Forest) to identify outliers in process execution data. An execution that falls outside normal clusters of activity (based on user, host, parent process, command), especially one involving a destructive utility, is a strong signal of potential misuse.
    answer_sources:
      - Windows Event ID 4688
      - All Windows Endpoints and Servers, particularly those hosting sensitive data (e.g., financial records, intellectual property) or critical system configurations.
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: STREAM process_events with features (user, host, parent_process, command) | APPLY ML_model (Isolation Forest) | ALERT if event is anomaly
  - question: Have any critical system or configuration files been modified from their known-good state?
    context: This question addresses the core principle of file integrity monitoring (FIM). By maintaining a baseline of known-good cryptographic hashes for critical files, any unauthorized modification can be detected immediately upon a file write event. A hash mismatch is a high-fidelity indicator that the system's integrity has been compromised.
    answer_sources:
      - Windows Event ID 4663
      - File Integrity Monitoring (FIM) tool logs
      - Configuration-sensitive systems such as Domain Controllers, Public Key Infrastructure (PKI) Servers, Web Servers, Database Servers, and hosts with critical business applications.
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: ON EVENT (Windows Event ID 4663 for critical_file_list) | TRIGGER compute_hash(file) | COMPARE new_hash with baseline_hash | ALERT on mismatch
  - question: Has there been a statistically significant spike in file modifications on critical assets outside of a scheduled maintenance window?
    context: Legitimate changes to critical files typically occur during planned maintenance windows. This question seeks to identify suspicious activity by flagging bursts of file modifications that happen outside these approved timeframes. A sudden increase in changes exceeding a statistical threshold (e.g., 98th percentile of a 30-day average) suggests unauthorized activity.
    answer_sources:
      - Windows Event ID 4663
      - File Integrity Monitoring (FIM) tool logs
      - Configuration-sensitive systems such as Domain Controllers, Public Key Infrastructure (PKI) Servers, Web Servers, Database Servers, and hosts with critical business applications.
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: SEARCH file_modification_events on critical_assets | IF event_time NOT IN maintenance_window | CALCULATE event_count_per_hour | ALERT if count > 98th_percentile_of_30day_average
  - question: Can a machine learning model identify illegitimate file modification events on critical files based on contextual features?
    context: This question uses a classification model to assess the legitimacy of each file change. The model considers factors like the modifying process, user privileges, time of day, and maintenance window status to assign a legitimacy score, allowing analysts to focus on high-risk events.
    answer_sources:
      - Windows Event ID 4663
      - File Integrity Monitoring (FIM) tool logs
      - Configuration-sensitive systems such as Domain Controllers, Public Key Infrastructure (PKI) Servers, Web Servers, Database Servers, and hosts with critical business applications.
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: STREAM file_modification_events with features (process, user, time, in_maintenance_window) | APPLY ML_model (Random Forest) | ALERT if legitimacy_score is low
  - question: Has any single user deleted an excessive number of files from a critical file share in a short time?
    context: This question uses a threshold-based rule to detect bulk data destruction. Deleting hundreds of files (e.g., >500 in 5 minutes) is highly unusual and can indicate a ransomware attack, a disgruntled insider, or an automated wiping script. This rule provides a clear, actionable alert for an obvious sign of impact.
    answer_sources:
      - Windows Event ID 4663
      - Windows Event ID 4659
      - Windows Event ID 4660
      - Zeek smb_files.log
      - High-value file shares
      - document management systems
      - source code repositories
      - database servers
      - backup storage volumes.
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: SEARCH delete_events (Event ID 4660 or Zeek smb_files.log) | COUNT events by user over 5_minute_window | ALERT if count > 500
  - question: Is the rate of file modifications or deletions by any user on any host statistically anomalous compared to their normal behavior?
    context: This question uses a dynamic, behavioral approach by establishing a personalized baseline of file activity for each user/host combination. An alert is triggered when a user's activity significantly deviates from their own established norm ($$ > \mu + 3\sigma $$), making it effective at detecting unusual behavior for all types of users.
    answer_sources:
      - Windows Event ID 4663
      - Windows Event ID 4659
      - Windows Event ID 4660
      - Zeek smb_files.log
      - High-value file shares
      - document management systems
      - source code repositories
      - database servers
      - backup storage volumes.
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: SEARCH file_mod/delete_events | CALCULATE rolling_baseline (mean, std_dev) per user, per host | COMPARE current_rate to baseline | ALERT if rate > (mean + 3 * std_dev)
  - question: Does a time-series forecasting model detect a significant deviation from the predicted volume of file activity on critical servers?
    context: This question applies time-series analysis (e.g., Prophet, ARIMA) to model the normal rhythm of file activity on critical servers. If the actual number of file modifications or deletions falls outside the model's predicted range and confidence interval, it indicates a statistically significant anomaly that warrants investigation.
    answer_sources:
      - Windows Event ID 4663
      - Windows Event ID 4659
      - Windows Event ID 4660
      - Zeek smb_files.log
      - High-value file shares
      - document management systems
      - source code repositories
      - database servers
      - backup storage volumes.
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: STREAM file_event_counts for critical_servers | APPLY ML_model (Prophet/ARIMA) to forecast expected_count | ALERT if actual_count is outside confidence_interval
  - question: Are files being renamed with extensions associated with known ransomware, and is this correlated with suspicious network activity?
    context: This question looks for a classic ransomware behavior: mass file renaming to a specific malicious extension. The detection is strengthened by correlating these file system events with network indicators on the same host, such as connections to known C2 servers or newly registered domains, providing a high-confidence alert.
    answer_sources:
      - Windows Event ID 4663
      - Zeek conn.log
      - Zeek dns.log
      - User workstations
      - file servers
      - backup servers
      - network egress points.
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: SEARCH rename_events (Event ID 4663) where new_extension IN (ransomware_extensions_list) | CORRELATE with network_events (Zeek) from same host to malicious_IPs/domains within 5 mins | ALERT on correlation
  - question: Has there been a sudden drop in the diversity of file extensions in any directory, suggesting mass renaming?
    context: This statistical method detects mass file renaming without a list of known malicious extensions. A directory normally has diverse file types. When ransomware renames all files to one extension, the statistical diversity (Shannon entropy) of extensions drops dramatically, which can be detected and flagged as suspicious.
    answer_sources:
      - Windows Event ID 4663
      - Zeek conn.log
      - Zeek dns.log
      - User workstations
      - file servers
      - backup servers
      - network egress points.
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: MONITOR file_extensions in directories | CALCULATE Shannon_entropy on rolling basis | ALERT if entropy drops sharply (e.g., below 20% of 24h_moving_average)
  - question: Can a clustering algorithm identify a dense group of file rename events indicative of a ransomware attack?
    context: This question uses a clustering technique (like DBSCAN) to find groups of tightly-packed, similar events. A ransomware attack performing mass renaming will create a dense cluster of 'rename' events to a new, single extension by the same process. The algorithm can automatically identify this anomalous cluster amidst normal file system noise.
    answer_sources:
      - Windows Event ID 4663
      - Zeek conn.log
      - Zeek dns.log
      - User workstations
      - file servers
      - backup servers
      - network egress points.
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: STREAM file_system_events with features (event_type, extension, process) | APPLY ML_model (DBSCAN) | ALERT if a dense cluster of 'rename' events is detected