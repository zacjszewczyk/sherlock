name: T1654: Log Enumeration
id: f47ac10b-58cc-4372-a567-0e02b2c3d479
description: This playbook focuses on detecting adversarial discovery techniques involving the enumeration of system logs. It covers methods such as the execution of known log enumeration tools followed by network exfiltration, the use of native 'living-off-the-land' utilities (e.g., wevtutil.exe, powershell.exe) with specific command-line arguments, direct access to multiple '.evtx' files, and the clearing of audit logs (Event ID 1102) to cover tracks. The playbook provides investigative questions and queries to identify these activities through symbolic, statistical, and machine learning approaches.
type: technique
related:
- TA0007: Discovery
contributors:
- Zachary Szewczyk
- Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
- question: Is a known log enumeration tool being executed, followed by communication to a known command-and-control server?
  context: This question aims to identify a high-confidence attack pattern where an adversary uses a specific tool for log discovery and immediately attempts to exfiltrate data or establish a C2 channel. Correlating the tool execution with suspicious network traffic within a short time window is a strong indicator of malicious activity.
  answer_sources:
  - Windows Event ID 4688
  - Zeek conn.log
  - Zeek dns.log
  - All Windows Endpoints and Servers; Network Egress Points; DNS Resolvers
  range: last 90 days
  queries:
  - pseudocode: SEARCH process events for known log enumeration tool hash. IF found, SEARCH network logs from same host within 5 minutes for connections to C2 IP/domain.
- question: Is a process associated with log enumeration making network connections to rare destinations or on non-standard ports?
  context: This question helps detect anomalies when an adversary uses a known log enumeration tool but communicates with a C2 server not yet on a threat feed. By baselining normal network behavior for these processes, we can spot deviations, such as connections to infrequently seen IP addresses or ports, which may indicate exfiltration or C2 activity.
  answer_sources:
  - Windows Event ID 4688
  - Zeek conn.log
  - Zeek dns.log
  - All Windows Endpoints and Servers; Network Egress Points; DNS Resolvers
  range: last 90 days
  queries:
  - pseudocode: FOR processes matching log enumeration tools, BASELINE destination IPs/ports. ALERT if new connection is to a rare IP (<1% enterprise-wide) AND on a non-standard port.
- question: Can a machine learning model classify a sequence of process and network events as malicious log exfiltration?
  context: This question leverages a machine learning model to identify complex, multi-event patterns that are indicative of malicious log enumeration and exfiltration. The model considers a rich feature set, including process details, network traffic characteristics, and threat intelligence, to provide a high-confidence verdict that is difficult to achieve with simple rules alone.
  answer_sources:
  - Windows Event ID 4688
  - Zeek conn.log
  - Zeek dns.log
  - All Windows Endpoints and Servers; Network Egress Points; DNS Resolvers
  range: last 90 days
  queries:
  - pseudocode: INPUT process and network features (process name, parent, user, cmdline entropy, bytes out, port, JA3, C2-IP-match) into Random Forest classifier. ALERT if classified as 'malicious log exfiltration' with score > 0.9.
- question: Are native Windows utilities like 'wevtutil.exe' or 'powershell.exe' being used with command-line arguments indicative of log querying or exporting?
  context: This question focuses on detecting "living-off-the-land" techniques, where adversaries use legitimate system tools to perform log enumeration. By searching for specific command-line arguments associated with log manipulation, we can identify this behavior while filtering out known, benign administrative activity.
  answer_sources:
  - Windows Event ID 4688
  - All Windows Endpoints and Servers; Domain Controllers; Administrator Workstations
  range: last 90 days
  queries:
  - pseudocode: SEARCH process creation events for 'wevtutil.exe' or 'powershell.exe' with command-line arguments matching regex for log enumeration (e.g., 'qe', 'epl', 'Get-WinEvent') and NOT on an admin script allowlist.
- question: Is a user executing commands with 'powershell.exe' or 'wevtutil.exe' that are statistically rare based on their own historical activity?
  context: This question helps uncover suspicious usage of native utilities by establishing a baseline of normal command-line activity for each user. An adversary's commands, or those of a compromised user account, are likely to contain tokens and combinations that are rare compared to the user's typical administrative tasks, allowing for anomaly detection.
  answer_sources:
  - Windows Event ID 4688
  - All Windows Endpoints and Servers; Domain Controllers; Administrator Workstations
  range: last 90 days
  queries:
  - pseudocode: FOR each user, BASELINE 'powershell.exe' and 'wevtutil.exe' command arguments over 30 days. TOKENIZE new commands and calculate token rarity. ALERT if command rarity is in the 99th percentile for that user.
- question: Can a natural language processing model classify command-line activity as malicious 'Log Enumeration'?
  context: This question applies advanced NLP to understand the intent behind a command line, rather than just matching keywords. A fine-tuned transformer model can recognize obfuscated or novel variations of log enumeration commands, providing a more robust detection method against evolving adversary tradecraft.
  answer_sources:
  - Windows Event ID 4688
  - All Windows Endpoints and Servers; Domain Controllers; Administrator Workstations
  range: last 90 days
  queries:
  - pseudocode: INPUT command-line strings from process creation events into a fine-tuned transformer model. ALERT if command is classified as 'Log Enumeration' with probability > 0.85.
- question: Is a single process rapidly accessing an unusually high number of distinct '.evtx' log files?
  context: This question aims to detect brute-force enumeration of log files. A legitimate process typically accesses only a few specific logs. A process quickly accessing many different '.evtx' files, especially by a non-system user account, is highly suspicious and indicative of a discovery script or tool trying to gather as much information as possible.
  answer_sources:
  - Windows Event ID 4663
  - File systems on Domain Controllers; File systems on critical servers; SIEM servers and Log Collectors
  range: last 90 days
  queries:
  - pseudocode: COUNT distinct '.evtx' files accessed per Process ID within a 60-second window. ALERT if count > 10 and user is not a system account.
- question: Is a process accessing a number of '.evtx' files that is a statistical anomaly compared to its historical baseline on that host?
  context: This question uses a statistical approach to identify abnormal log file access patterns. By baselining the activity for each process, we can detect significant deviations (e.g., a process that normally never touches log files suddenly accessing several). Analyzing the entropy of filenames can further help prioritize alerts by identifying enumeration of non-standard or unusual logs.
  answer_sources:
  - Windows Event ID 4663
  - File systems on Domain Controllers; File systems on critical servers; SIEM servers and Log Collectors
  range: last 90 days
  queries:
  - pseudocode: BASELINE hourly count of unique '.evtx' files accessed per process name. ALERT if new count has a Z-score > 3 from the baseline. INCREASE priority if entropy of filenames spikes.
- question: Is the rate of file access events for the Windows event log directory anomalous according to a time-series model?
  context: This question uses a time-series model to learn the normal rhythm of log access on a host, accounting for daily and weekly cycles. This allows for the detection of unusual spikes in log access activity that don't fit the established pattern, which could indicate an adversary's enumeration activity, even if the absolute number of accesses isn't high.
  answer_sources:
  - Windows Event ID 4663
  - File systems on Domain Controllers; File systems on critical servers; SIEM servers and Log Collectors
  range: last 90 days
  queries:
  - pseudocode: MODEL the rate of file access events for 'winevt\logs' directory using Seasonal-ARIMA. ALERT if observed rate is a significant deviation from the forecasted rate.
- question: Is access to '.evtx' log files followed shortly by a large data transfer to an unknown network destination?
  context: This question links log file discovery directly to potential exfiltration. The correlation of an internal discovery action (accessing logs) with an external network action (large upload to a new IP on a non-standard port) creates a high-fidelity alert for data theft.
  answer_sources:
  - Windows Event ID 4663
  - Windows Event ID 4688
  - Zeek conn.log
  - All Windows Endpoints and Servers; Network Egress Points; DNS Servers
  range: last 90 days
  queries:
  - pseudocode: IF '.evtx' file access is detected, MONITOR network connections from the same source IP for 5 minutes. ALERT if connection is to a new IP (not seen in 30 days) on a non-standard port with an outbound payload > 1MB.
- question: Following a log file access event, does the host initiate a network connection with an anomalously large outbound data volume?
  context: This question uses statistical baselining to detect potential exfiltration without relying on threat intelligence feeds. By knowing what constitutes a "normal" amount of outbound data for a given host, we can flag connections with unusually large payloads that occur right after log file access as suspicious.
  answer_sources:
  - Windows Event ID 4663
  - Windows Event ID 4688
  - Zeek conn.log
  - All Windows Endpoints and Servers; Network Egress Points; DNS Servers
  range: last 90 days
  queries:
  - pseudocode: BASELINE outbound data volume per process for each host. IF log file access occurs, CHECK subsequent connections from that host. ALERT if outbound byte count exceeds the 98th percentile of the baseline.
- question: Does a sequence of host events (process, file, network) match a machine learning model's definition of a 'Log Access to Exfiltration' attack path?
  context: This question uses a state-based model (HMM) to understand the progression of an attack. The model is trained to recognize a logical sequence of states, from benign activity to suspicious log access and finally to data exfiltration. An alert is triggered when an observed event sequence makes this malicious path the most likely explanation.
  answer_sources:
  - Windows Event ID 4663
  - Windows Event ID 4688
  - Zeek conn.log
  - All Windows Endpoints and Servers; Network Egress Points; DNS Servers
  range: last 90 days
  queries:
  - pseudocode: INPUT stream of host events into a Hidden Markov Model. ALERT if the most likely decoded state sequence is 'Benign' -> 'Suspicious Log Access' -> 'Potential Data Exfiltration'.
- question: Has the audit log been cleared (Windows Event ID 1102)?
  context: This question addresses a critical indicator of anti-forensic activity. The clearing of a security log is a deliberate action to hide malicious behavior. Due to its high-impact nature, this event should be treated as a confirmed compromise and trigger an immediate incident response.
  answer_sources:
  - Windows Event ID 1102
  - Windows Event ID 4624
  - Windows Event ID 4688
  - Domain Controllers; Security-critical servers (e.g., PKI, RADIUS); Workstations of Privileged Users
  range: last 90 days
  queries:
  - pseudocode: CREATE critical alert that fires immediately on detection of Event ID 1102. TRIGGER automated host isolation.
- question: Did a log clearing event (Event ID 1102) occur outside of an approved maintenance window or was it performed by an unauthorized user?
  context: This question adds context to the critical log clearing event to reduce false positives from legitimate administrative tasks. By filtering for events that happen at unexpected times or are performed by user accounts that shouldn't be clearing logs, we can increase the confidence and priority of the alert.
  answer_sources:
  - Windows Event ID 1102
  - Windows Event ID 4624
  - Windows Event ID 4688
  - Domain Controllers; Security-critical servers (e.g., PKI, RADIUS); Workstations of Privileged Users
  range: last 90 days
  queries:
  - pseudocode: ALERT on Event ID 1102. ELEVATE priority if event time is outside a defined maintenance window OR if the user account is not a designated Tier 0 administrator.
- question: Based on preceding events, what is the probability that a log clearing event was malicious?
  context: This question uses a probabilistic model to assess the likelihood of malicious intent behind a log clear event. By considering contextual events that occurred just before the log was cleared (like a login from a strange location or an obfuscated PowerShell command), the model can provide a confidence score, helping analysts prioritize the most likely malicious incidents.
  answer_sources:
  - Windows Event ID 1102
  - Windows Event ID 4624
  - Windows Event ID 4688
  - Domain Controllers; Security-critical servers (e.g., PKI, RADIUS); Workstations of Privileged Users
  range: last 90 days
  queries:
  - pseudocode: CALCULATE P(MaliciousClear | PrecedingEvents) using a Bayesian network with inputs like 'Atypical Geo Login' and 'Obfuscated PowerShell'. ALERT if probability > 0.9.