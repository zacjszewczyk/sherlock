name: 'T1213.005: Messaging Applications'
id: 'f8a1b2c3-d4e5-4f6a-7b8c-9d0e1f2a3b4c'
description: 'This playbook helps investigate whether an adversary is collecting sensitive data or information via messaging applications. It focuses on identifying several key indicators of malicious activity: network connections from messaging apps to known malicious hosts or unapproved destinations; the use of command-line arguments suggesting scripted or non-interactive automation; significant deviations from baseline data upload volumes; anomalous process execution, such as being spawned by an unusual parent process or running with elevated privileges; and connections from messaging apps to sensitive internal network assets like databases or domain controllers.'
type: 'technique'
related:
  - 'TA0009: Collection'
contributors:
  - 'Zachary Szewczyk, Ask Sage'
created: '2025-10-01'
modified: '2025-10-01'
version: '1.0'
tags: 'none'
questions:
  - question: 'Is a messaging application communicating with known malicious or unapproved external destinations?'
    context: 'This question aims to identify data exfiltration or command and control (C2) activity masquerading as legitimate messaging traffic. By correlating network connections from these applications with threat intelligence feeds, analysts can detect direct communication with known malicious infrastructure, such as C2 servers, TOR exit nodes, or unsanctioned cloud storage providers, providing a high-fidelity signal of a potential compromise.'
    answer_sources:
      - 'Zeek conn.log'
      - 'Zeek ssl.log'
      - 'Zeek dns.log'
      - 'Sysmon Event ID 3'
      - 'Windows Event ID 5156'
      - 'Network Egress Points (e.g., Firewalls, Proxies)'
      - 'DNS Resolvers'
      - 'User Endpoints'
    range: 'last 90 days'
    queries:
      - 'pseudocode: JOIN process_network_logs WITH network_flow_logs WHERE process is messaging_app; CHECK IF destination_ip OR destination_domain IN threat_intel_feed; ALERT on match.'
  - question: 'Is a user''s messaging application traffic being sent to a new or rare destination country or Autonomous System Number (ASN), especially with a high volume of data?'
    context: 'This question helps detect anomalous exfiltration patterns by baselining normal user behavior. Adversaries often exfiltrate data to destinations that are unusual for a specific user. By establishing a profile of typical destination countries and ASNs for each user''s messaging traffic, this query can flag deviations that represent a potential incident. A large data transfer to a rare destination is a strong indicator of malicious activity.'
    answer_sources:
      - 'Zeek conn.log'
      - 'Zeek ssl.log'
      - 'Network Egress Points (e.g., Firewalls, Proxies)'
      - 'DNS Resolvers'
      - 'User Endpoints'
    range: 'last 90 days'
    queries:
      - 'pseudocode: FOR each_user, BASELINE destination_ASN_frequency and destination_country_frequency from network_logs over 30_days; FOR new_connection, ALERT IF destination_ASN_frequency < 1% OR destination_country_frequency < 1%; INCREASE_SEVERITY IF data_transfer_volume > 95th_percentile.'
  - question: 'Are there anomalous network connections from messaging applications that deviate from learned legitimate traffic patterns?'
    context: 'This question uses machine learning to identify subtle anomalies that rule-based detections might miss. By training a model on features of legitimate messaging traffic (e.g., port, data volume, duration, destination), it can score new connections in real-time. Connections that the model flags as highly anomalous warrant manual investigation as they may represent sophisticated exfiltration techniques that blend in with normal traffic.'
    answer_sources:
      - 'Zeek conn.log'
      - 'Zeek ssl.log'
      - 'Network Egress Points (e.g., Firewalls, Proxies)'
      - 'DNS Resolvers'
      - 'User Endpoints'
    range: 'last 90 days'
    queries:
      - 'pseudocode: TRAIN anomaly_detection_model on features from legitimate messaging_app network_logs (port, volume, duration, ASN, country); DEPLOY model to score new connections; ALERT IF anomaly_score > 99th_percentile.'
  - question: 'Is a messaging application being executed with command-line arguments that suggest automated or scripted use?'
    context: 'This question looks for evidence of an adversary using scripts to automate interaction with messaging applications for data exfiltration or C2. Legitimate user interaction rarely involves complex command-line arguments. The presence of arguments related to file posting, API tokens, or specific channel interactions can be a strong indicator of non-interactive, malicious use.'
    answer_sources:
      - 'Windows Event ID 4688'
      - 'Sysmon Event ID 1'
      - 'User Endpoints (Workstations, Laptops)'
      - 'Servers with Messaging Clients Installed'
    range: 'last 90 days'
    queries:
      - 'pseudocode: SEARCH process_creation_logs WHERE process_name is messaging_app AND command_line contains keywords like "--post-file", "--token", "Content-Type: application/json"; ALERT on match.'
  - question: 'Are the command-line arguments used to launch a messaging application exhibiting unusually high entropy or length?'
    context: 'This question helps detect obfuscated or complex commands passed to messaging applications. Adversaries may encode scripts or pass long, unique API tokens in the command line. A sudden spike in command-line entropy or length, compared to the established baseline for that application, suggests that the arguments are not typical and may contain malicious instructions or credentials.'
    answer_sources:
      - 'Windows Event ID 4688'
      - 'Sysmon Event ID 1'
      - 'User Endpoints (Workstations, Laptops)'
      - 'Servers with Messaging Clients Installed'
    range: 'last 90 days'
    queries:
      - 'pseudocode: FOR each messaging_app, BASELINE command_line entropy and length over 30_days; FOR new_process_creation, CALCULATE entropy and length; ALERT IF entropy > 3_std_dev_above_mean OR length > 99th_percentile.'
  - question: 'Can process creation events for messaging applications be classified as malicious automation based on their features?'
    context: 'This question leverages a supervised machine learning model to distinguish between benign and malicious process automation. By training a model on features like parent process, command-line length, entropy, and specific keywords, the system can automatically classify new events. This provides a more sophisticated and adaptable detection method than static rules for identifying malicious scripting.'
    answer_sources:
      - 'Windows Event ID 4688'
      - 'Sysmon Event ID 1'
      - 'User Endpoints (Workstations, Laptops)'
      - 'Servers with Messaging Clients Installed'
    range: 'last 90 days'
    queries:
      - 'pseudocode: TRAIN classification_model on labeled process_creation_events with features (parent_process, cmd_length, cmd_entropy, keywords); DEPLOY model to classify new messaging_app process_events; ALERT on "malicious" classification.'
  - question: 'Has a messaging application been used to transfer an exceptionally large file in a single session?'
    context: 'This question acts as a simple but effective tripwire for bulk data exfiltration. While messaging applications are used for file transfers, a single transfer session exceeding a large, pre-defined threshold (e.g., 500 MB) is highly unusual for typical user behavior and warrants an immediate, high-severity alert for investigation into a potential data theft event.'
    answer_sources:
      - 'Zeek conn.log'
      - 'Zeek files.log'
      - 'Network Egress Points'
    range: 'last 90 days'
    queries:
      - 'pseudocode: SEARCH network_flow_logs WHERE service is messaging_app; ALERT IF single_connection_upload_bytes > 500MB.'
  - question: 'Is a user''s daily data upload volume or file transfer count via messaging applications significantly exceeding their historical baseline?'
    context: 'This question focuses on detecting anomalous data transfer volumes over time. By establishing an individual baseline for each user''s daily upload habits, the system can detect when a user suddenly starts sending much more data or many more files than usual. Such a deviation from the norm is a strong indicator of data staging and exfiltration.'
    answer_sources:
      - 'Zeek conn.log'
      - 'Zeek files.log'
      - 'Network Egress Points'
    range: 'last 90 days'
    queries:
      - 'pseudocode: FOR each_user, BASELINE daily_upload_volume and daily_file_count for messaging_apps over 30_days; ALERT IF today''s_volume > 99th_percentile_of_baseline OR today''s_file_count > 99th_percentile_of_baseline.'
  - question: 'Does a user''s hourly data upload volume to messaging services show a significant anomaly when compared to their typical time series pattern?'
    context: 'This question applies time series analysis to detect exfiltration attempts that may be hidden within daily totals but are anomalous at a more granular, hourly level. A model learns a user''s normal rhythm of activity (e.g., low traffic overnight, higher during business hours). An alert is triggered if a burst of activity occurs at an unusual time or with unusual magnitude, pointing to a potential automated exfiltration event.'
    answer_sources:
      - 'Zeek conn.log'
      - 'Zeek files.log'
      - 'Network Egress Points'
    range: 'last 90 days'
    queries:
      - 'pseudocode: FOR each_user, TRAIN time_series_model on hourly_upload_volume to messaging_services; ALERT IF observed_hourly_volume significantly exceeds model''s_predicted_confidence_bound.'
  - question: 'Is a messaging application being launched by an anomalous parent process or running with high system privileges?'
    context: 'This question seeks to identify when a messaging application is executed in a suspicious context. Normally, a user launches these applications from their desktop shell (explorer.exe). If it is spawned by a different process (like powershell.exe or svchost.exe) or runs as the high-privilege SYSTEM account, it strongly suggests it has been co-opted by an adversary for persistence or privileged operations.'
    answer_sources:
      - 'Windows Event ID 4688'
      - 'Sysmon Event ID 1'
      - 'User Endpoints'
      - 'Application Servers'
      - 'Domain Controllers'
    range: 'last 90 days'
    queries:
      - 'pseudocode: SEARCH process_creation_logs WHERE child_process is messaging_app; ALERT IF user_account is SYSTEM OR parent_process is NOT "explorer.exe" (with exceptions for known good installers).'
  - question: 'Is a messaging application being spawned by a parent process that has rarely or never been observed before in the environment?'
    context: 'This question identifies novel or rare process execution chains. By baselining all normal parent-child process relationships involving messaging applications across the enterprise, any new or highly infrequent pairing (e.g., wmic.exe launching slack.exe) can be flagged. This is an effective way to detect new attacker techniques that leverage legitimate software in unusual ways.'
    answer_sources:
      - 'Windows Event ID 4688'
      - 'Sysmon Event ID 1'
      - 'User Endpoints'
      - 'Application Servers'
      - 'Domain Controllers'
    range: 'last 90 days'
    queries:
      - 'pseudocode: CREATE frequency_table of all (parent_process, messaging_app) pairs over 30_days; ALERT IF a newly_observed_pair has a historical probability < 0.01%.'
  - question: 'Is a messaging application part of a process execution chain that is structurally anomalous?'
    context: 'This question uses graph-based analysis to find suspicious process execution trees. Normal software execution follows predictable patterns. By modeling these patterns as a graph, an anomaly detection algorithm can identify when a messaging application is involved in a structurally unusual chain, such as having a deep ancestry or being spawned by a core system process, which could indicate process injection or other advanced attack techniques.'
    answer_sources:
      - 'Windows Event ID 4688'
      - 'Sysmon Event ID 1'
      - 'User Endpoints'
      - 'Application Servers'
      - 'Domain Controllers'
    range: 'last 90 days'
    queries:
      - 'pseudocode: MODEL process_ancestry as a graph; TRAIN graph_anomaly_detection model on baseline activity; ALERT IF new execution_chain involving messaging_app is a structural_anomaly.'
  - question: 'Is a messaging application connecting to a sensitive internal service or host that is not on its approved communication list?'
    context: 'This question aims to detect lateral movement or internal data collection. A messaging client has no legitimate reason to connect directly to a database server, domain controller, or RDP port. This rule explicitly checks for connections from messaging apps to predefined sensitive internal zones and ports, providing a high-confidence alert for unauthorized internal network activity.'
    answer_sources:
      - 'Zeek conn.log'
      - 'Windows Event ID 5156'
      - 'Sysmon Event ID 3'
      - 'Internal Network Segments'
      - 'Sensitive Data Enclaves (e.g., Database Zones, Developer Networks)'
      - 'User Endpoints'
    range: 'last 90 days'
    queries:
      - 'pseudocode: SEARCH host_network_logs WHERE process is messaging_app AND destination_ip is in sensitive_internal_range AND destination_port is sensitive_service_port; ALERT IF (app, dest_ip, dest_port) not in allow_list.'
  - question: 'Is a messaging application making a rare or previously unseen connection to an internal destination IP address and port?'
    context: 'This question helps discover anomalous internal connections without pre-defined lists of sensitive assets. By creating a baseline of all internal destinations a messaging app normally communicates with (e.g., internal API gateways), any connection to a new or very rare internal IP/port can be flagged for investigation. This can reveal unexpected lateral movement or access to non-standard internal resources.'
    answer_sources:
      - 'Zeek conn.log'
      - 'Windows Event ID 5156'
      - 'Sysmon Event ID 3'
      - 'Internal Network Segments'
      - 'Sensitive Data Enclaves (e.g., Database Zones, Developer Networks)'
      - 'User Endpoints'
    range: 'last 90 days'
    queries:
      - 'pseudocode: FOR each messaging_app, BASELINE frequency of internal (IP, port) destinations over 30_days; ALERT IF a new connection is to a destination not in the top 99.9% of the baseline.'
  - question: 'Is a messaging application initiating a network connection that crosses established functional boundaries within the internal network?'
    context: 'This question uses network topology and community detection to identify policy violations. After clustering hosts into functional groups (e.g., "workstations," "database servers") based on traffic patterns, it alerts when a process from one community (a messaging app on a workstation) communicates with a host in a different, sensitive community. This indicates a violation of expected network segmentation and is a strong sign of lateral movement.'
    answer_sources:
      - 'Zeek conn.log'
      - 'Windows Event ID 5156'
      - 'Sysmon Event ID 3'
      - 'Internal Network Segments'
      - 'Sensitive Data Enclaves (e.g., Database Zones, Developer Networks)'
      - 'User Endpoints'
    range: 'last 90 days'
    queries:
      - 'pseudocode: MODEL internal_network as a graph; APPLY community_detection to cluster hosts; ALERT IF a connection from a messaging_app crosses from a "workstation" community to a "sensitive_server" community.'