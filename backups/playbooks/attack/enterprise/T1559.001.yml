name: "T1559.001: Component Object Model"
id: "c3d4e5f6-a7b8-4c9d-8e1f-2a3b4c5d6e7f"
description: "This playbook helps identify if an adversary is executing code using the Component Object Model (COM). It focuses on detecting several key indicators: the creation of processes with known malicious COM CLSIDs or ProgIDs; common COM host processes (like svchost.exe or dllhost.exe) spawning script interpreters or other suspicious child processes; COM server processes initiating unusual outbound network connections for C2 or exfiltration; lateral movement attempts via DCOM indicated by network logons following RPC port connections from unauthorized sources; and COM hijacking attempts where registry keys are modified to redirect execution to malicious payloads."
type: "technique"
related:
  - "TA0002: Execution"
contributors:
  - "Zachary Szewczyk"
  - "Ask Sage"
created: "2025-10-01"
modified: "2025-10-01"
version: "1.0"
tags: "none"
questions:
  - question: "Is a process being created with a command line that includes a known malicious COM CLSID or ProgID, or does its hash match a known malicious COM server binary?"
    context: "This question aims to detect the direct execution of malicious code via COM by searching for indicators of compromise (IOCs) in process creation events. Malicious CLSIDs, ProgIDs, or binary hashes are strong signals that an adversary is using a pre-existing or newly registered COM object for execution."
    answer_sources:
      - "Windows Event ID 4688"
      - "Threat Intelligence Feed"
      - "User Workstations, Critical Application Servers, Domain Controllers"
    range: "Last 90 days"
    queries:
      - "Symbolic: Search process creation logs (EID 4688) for command lines containing CLSIDs/ProgIDs from a threat intelligence list. Compare process hashes against a blocklist."
  - question: "Are there any rarely seen COM CLSIDs being used in process command lines across the enterprise?"
    context: "Adversaries may use novel or custom COM objects that are not yet on threat intelligence feeds. This question identifies statistical outliers by flagging CLSIDs that are uncommonly used within the environment. Such rarity can indicate a newly introduced malicious COM object used for execution."
    answer_sources:
      - "Windows Event ID 4688"
      - "User Workstations, Critical Application Servers, Domain Controllers"
    range: "Last 90 days"
    queries:
      - "Statistical: Parse CLSIDs from process command lines. Calculate the prevalence of each CLSID over the last 30 days. Flag CLSIDs with prevalence below a low-percentile threshold."
  - question: "Can a machine learning model classify a process creation event involving a COM object as malicious based on its features?"
    context: "This question leverages machine learning to move beyond simple IOCs or statistical rarity. By training a model on features like parent process, command-line entropy, and CLSID rarity, it's possible to identify complex, subtle patterns of malicious COM execution that might otherwise be missed."
    answer_sources:
      - "Windows Event ID 4688"
      - "User Workstations, Critical Application Servers, Domain Controllers"
    range: "Last 90 days"
    queries:
      - "Machine Learning: Extract features (parent process, command-line entropy, CLSID presence/rarity) from process creation events. Score events using a pre-trained classification model. Alert on high-confidence malicious classifications."
  - question: "Is a known COM host process, such as svchost.exe or dllhost.exe, spawning a suspicious child process like a script interpreter or a Living Off the Land Binary (LOLBAS)?"
    context: "Legitimate COM host processes typically have predictable child processes. An adversary can abuse COM to make these hosts execute malicious commands. This question looks for high-risk parent-child process relationships, which are strong indicators of COM-based execution of scripts or other tools."
    answer_sources:
      - "Windows Event ID 4688"
      - "User Workstations, Application Servers, Web Servers, Domain Controllers"
    range: "Last 90 days"
    queries:
      - "Symbolic: Search process creation logs (EID 4688) for parent processes like 'dllhost.exe', 'svchost.exe' spawning child processes like 'powershell.exe', 'cmd.exe', 'mshta.exe'."
  - question: "Is a COM host process spawning a child process with command-line arguments that deviate from its established baseline behavior?"
    context: "This question aims to detect anomalous process chains originating from COM hosts. By baselining normal child processes and their arguments, we can identify when an adversary uses a COM host to execute a command that is unusual for that specific parent-child combination, even if the child process itself is legitimate."
    answer_sources:
      - "Windows Event ID 4688"
      - "User Workstations, Application Servers, Web Servers, Domain Controllers"
    range: "Last 90 days"
    queries:
      - "Statistical: For each COM host, baseline its child processes and arguments over 30 days. Alert on new or rare parent-child-argument combinations."
  - question: "Are there clusters of anomalous child processes being spawned by COM hosts that differ significantly from normal activity?"
    context: "This question uses unsupervised machine learning to group the behavior of child processes spawned by COM hosts. Processes that do not fit into large, well-defined clusters of normal activity are flagged as outliers. This can reveal novel or sophisticated attacks where adversaries use COM to launch tools with unusual characteristics (e.g., high command-line entropy)."
    answer_sources:
      - "Windows Event ID 4688"
      - "User Workstations, Application Servers, Web Servers, Domain Controllers"
    range: "Last 90 days"
    queries:
      - "Machine Learning: Cluster child processes from COM hosts based on features like command-line length and entropy. Investigate processes classified as outliers or belonging to small clusters."
  - question: "Is a common COM host process initiating a network connection to a known malicious IP address or domain?"
    context: "COM objects can be used to establish command and control (C2) channels or exfiltrate data. This question correlates process activity with network logs to find COM hosts (e.g., dllhost.exe) communicating with destinations listed on threat intelligence feeds, which is a high-fidelity indicator of compromise."
    answer_sources:
      - "Windows Event ID 4688"
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Threat Intelligence Feed"
      - "Endpoint Devices, Network Egress Points (Firewalls/Gateways), DNS Servers"
    range: "Last 90 days"
    queries:
      - "Symbolic: Correlate process creation logs with network connection logs. Alert if a COM host process connects to a destination IP/domain from a threat intelligence list."
  - question: "Is a COM host process exhibiting anomalous network behavior, such as connecting to an unusual port or transferring an unusually large volume of data?"
    context: "This question seeks to detect malicious network activity from COM hosts by establishing a baseline of their normal behavior. Deviations from this baseline, such as a sudden increase in data sent or a connection to a non-standard port, can indicate C2 communication or data exfiltration, even if the destination is not on a blocklist."
    answer_sources:
      - "Zeek conn.log"
      - "Endpoint Devices, Network Egress Points (Firewalls/Gateways), DNS Servers"
    range: "Last 90 days"
    queries:
      - "Statistical: For each COM host, baseline destination ports and data volume over 30 days. Alert if a new connection exceeds the data volume percentile or uses a rare port."
  - question: "Does the time-series data for outbound connections from COM host processes show a sharp, anomalous spike?"
    context: "Adversaries often use COM for C2 beacons or data staging, which can create abnormalities in the volume and frequency of network traffic over time. This question applies time-series analysis to detect sudden, significant deviations from forecasted traffic patterns for COM hosts, which could signal a compromise."
    answer_sources:
      - "Zeek conn.log"
      - "Endpoint Devices, Network Egress Points (Firewalls/Gateways), DNS Servers"
    range: "Last 90 days"
    queries:
      - "Machine Learning: Model the time-series of outbound data volume and connection counts from COM hosts. Alert on significant deviations from the forecasted model."
  - question: "Did a network logon (Logon Type 3) occur on a server from an unauthorized source IP shortly after an RPC connection on TCP port 135?"
    context: "This sequence of events is a classic indicator of lateral movement using remote COM/DCOM. An adversary first connects to the RPC Endpoint Mapper (port 135) to negotiate a DCOM connection and then authenticates. This question checks if the source of this activity is an unauthorized system, which strongly suggests malicious intent."
    answer_sources:
      - "Zeek conn.log"
      - "Windows Event ID 4624"
      - "Domain Controllers, Member Servers, Internal Network Segments, VPN Concentrators"
    range: "Last 90 days"
    queries:
      - "Symbolic: Join network logs (port 135) with logon logs (Type 3). Alert if a logon occurs within 5 minutes of a port 135 connection from an IP not on the authorized admin list."
  - question: "Has a new or rare lateral movement path involving DCOM/RPC (TCP port 135) appeared between two hosts in the network?"
    context: "This question uses graph analysis to model normal lateral movement pathways in the environment. Adversaries creating new connections between systems that do not typically communicate via DCOM will create a new or very infrequent 'edge' in the graph. Detecting these rare connections helps uncover previously unseen lateral movement attempts."
    answer_sources:
      - "Zeek conn.log"
      - "Domain Controllers, Member Servers, Internal Network Segments, VPN Concentrators"
    range: "Last 90 days"
    queries:
      - "Statistical: Graph source-destination connections on TCP/135 over 30 days. Alert on the appearance of a new source-destination pair or a pair with very low frequency."
  - question: "Is a DCOM/RPC interaction occurring that bridges two previously separate communities or clusters of hosts within the network?"
    context: "This question applies community detection algorithms to a graph of network interactions to identify logically segmented groups of assets (e.g., HR systems, developer workstations). A DCOM connection that crosses the boundary between these established communities is highly anomalous and may represent an adversary moving laterally across segregated network zones."
    answer_sources:
      - "Zeek conn.log"
      - "Windows Event ID 4624"
      - "Domain Controllers, Member Servers, Internal Network Segments, VPN Concentrators"
    range: "Last 90 days"
    queries:
      - "Machine Learning: Model the network as a graph of DCOM/RPC interactions. Use a community detection algorithm to identify host clusters. Alert on new connections that bridge two distinct communities."
  - question: "Was a COM CLSID registry key modified shortly before the associated application was launched?"
    context: "This is the hallmark of a classic COM hijacking attack. An adversary modifies a registry key to point a legitimate COM object's server to a malicious binary. When a legitimate application tries to use the COM object, the malicious code is executed instead. This question looks for this specific, high-fidelity sequence of events."
    answer_sources:
      - "Windows Event ID 4688"
      - "Windows Event ID 4657"
      - "User Workstations, Terminal Servers, Enterprise Registry Hives"
    range: "Last 90 days"
    queries:
      - "Symbolic: Search for a registry write event (EID 4657) to a CLSID path followed within 5 minutes by a process creation event (EID 4688) for the associated application on the same host."
  - question: "Is a host experiencing an anomalously high rate of modifications to COM-related registry keys?"
    context: "While a single COM hijack is significant, an adversary might perform these actions at scale or as part of an automated script. This question establishes a baseline for the normal rate of COM registry modifications on a per-host basis. A sudden spike exceeding this baseline can indicate widespread or automated tampering with COM objects for persistence or execution."
    answer_sources:
      - "Windows Event ID 4657"
      - "User Workstations, Terminal Servers, Enterprise Registry Hives"
    range: "Last 90 days"
    queries:
      - "Statistical: Baseline the frequency of COM registry key modifications per host. Alert if the rate in a short time window exceeds a statistical threshold (e.g., >3 standard deviations from the mean)."
  - question: "Does a sequence of system events, including a COM registry modification, have a low probability of being legitimate based on a trained sequence analysis model?"
    context: "This question uses advanced machine learning to understand the normal 'grammar' of system events. A COM hijack involves a sequence of actions (e.g., file write, registry modify, process launch) that may appear normal in isolation but are highly improbable when viewed in sequence. A sequence analysis model can detect these unlikely combinations, flagging them as suspicious."
    answer_sources:
      - "Windows Event ID 4688"
      - "Windows Event ID 4657"
      - "User Workstations, Terminal Servers, Enterprise Registry Hives"
    range: "Last 90 days"
    queries:
      - "Machine Learning: Feed sequences of system events (process, file, registry) into a trained sequence analysis model (e.g., HMM, LSTM). Flag event sequences with a low probability score as anomalous."