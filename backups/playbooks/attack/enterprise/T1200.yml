name: T1200: Hardware Additions
id: 123e4567-e89b-12d3-a456-426614174000
description: This playbook helps investigate if an adversary has gained initial access via unauthorized hardware additions. It focuses on correlating hardware connection events with subsequent malicious activities, such as the installation of malicious drivers or services, suspicious network traffic to command-and-control servers, DHCP requests from known offensive hardware, keystroke injection payloads, the appearance of unregistered MAC addresses, or the creation of anomalous system processes.
type: technique
related:
  - TA0001: Initial Access
contributors:
  - Zachary Szewczyk
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Has a new hardware device installation been immediately followed by the installation of a malicious driver or service?
    context: This question aims to detect a common attack pattern where an adversary connects a malicious device that automatically installs malware. By correlating hardware connection events (Windows Event ID 6416) with new service creation (7045) and checking the associated file's hash and digital signature against deny lists, analysts can quickly identify trojanized hardware.
    answer_sources:
      - Windows Event ID 7045
      - Windows Event ID 6416
      - Sysmon Event ID 6
      - All corporate endpoint devices (laptops, desktops, servers), particularly those in sensitive areas like data centers or executive suites.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH (EventID 6416 OR EventID 7045) | CORRELATE with file creation events on same host | EXTRACT file_hash, certificate_subject | LOOKUP file_hash in threat_intel_feed | LOOKUP certificate_subject in certificate_deny_list | WHERE threat_intel_match OR certificate_deny_list_match
  - question: Has a newly installed driver associated with a hardware addition exhibited unusually high entropy, suggesting it might be packed or encrypted?
    context: Malicious payloads are often packed or encrypted to evade signature-based detection, which results in high file entropy (randomness). This question helps identify suspicious drivers by establishing a baseline for normal driver entropy in the environment and flagging statistical outliers. A driver with entropy significantly higher than the average is a strong candidate for a malicious payload.
    answer_sources:
      - Sysmon Event ID 6
      - Windows Event ID 6416
      - All corporate endpoint devices (laptops, desktops, servers), particularly those in sensitive areas like data centers or executive suites.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH (Sysmon EventID 6 AND associated with new hardware event) | CALCULATE entropy of driver_file | COMPARE entropy to baseline_mean_and_std_dev | WHERE entropy > (baseline_mean + 3 * baseline_std_dev)
  - question: Has a machine learning model classified a newly installed driver, associated with a new hardware event, as suspicious based on its features?
    context: This question leverages machine learning for a more nuanced analysis than simple signature or entropy checks. By training a model on various features like file size, imported functions, and signature reputation, it can learn the subtle characteristics that distinguish benign drivers from malicious ones, potentially catching novel threats.
    answer_sources:
      - Sysmon Event ID 6
      - Windows Event ID 6416
      - All corporate endpoint devices (laptops, desktops, servers), particularly those in sensitive areas like data centers or executive suites.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH new driver installations | EXTRACT features (file_size, entropy, imports, signature_validity, etc.) | INPUT features into ML_model | WHERE model_classification == 'suspicious'
  - question: Shortly after a new hardware device was connected, did the host initiate network traffic to a known malicious destination?
    context: Malicious hardware often needs to 'call home' to a command and control (C2) server. This question looks for this behavior by correlating a hardware installation event with outbound network traffic within a short time window (5 minutes). A match against a threat intelligence feed provides a high-confidence indicator of compromise.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Zeek ssl.log
      - Windows Event ID 6416
      - Network egress points, DNS resolvers, and endpoint devices.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH (EventID 6416) as hardware_event | CORRELATE with network logs from same host within 5 minutes | EXTRACT destination_ip, destination_domain, tls_server_name | LOOKUP indicators in threat_intel_feed | WHERE threat_intel_match
  - question: Following a new hardware installation, did the host exhibit rare or unusual network behavior, such as contacting a new IP/domain or using an uncommon JA3 hash?
    context: Adversaries often use new or unique infrastructure to avoid reputation-based blocking. This question helps detect such activity by focusing on rarity. A host connecting to an IP address never seen before, or using a client TLS fingerprint (JA3) that is rare across the enterprise, especially after a hardware event, is highly suspicious.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Zeek ssl.log
      - Windows Event ID 6416
      - Network egress points, DNS resolvers, and endpoint devices.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH (EventID 6416) as hardware_event | CORRELATE with network logs from same host within 5 minutes | CALCULATE prevalence of dest_ip, domain, ja3_hash | WHERE prevalence(dest_ip) < threshold OR prevalence(domain) < threshold OR prevalence(ja3_hash) < threshold
  - question: Did an anomalous spike in outbound network traffic volume occur on a host immediately after a new hardware device was connected?
    context: The installation of a malicious device might trigger data exfiltration or the download of a larger second-stage payload, resulting in a sudden increase in network traffic. This question uses time-series anomaly detection to identify such spikes, which might be missed by rules looking only at destinations.
    answer_sources:
      - Zeek conn.log
      - Windows Event ID 6416
      - Network egress points, DNS resolvers, and endpoint devices.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH (EventID 6416) as hardware_event | MONITOR outbound_traffic_volume on host | APPLY time-series_anomaly_model | WHERE anomalous_spike_detected post-hardware_event
  - question: Has a new DHCP request been observed from a device whose MAC address vendor (OUI) or hostname is associated with known offensive security hardware?
    context: Many commercial and open-source attack tools (like Hak5 or Flipper) have recognizable default hostnames or use MAC addresses from specific manufacturers. This question provides a simple but effective way to detect the presence of such tools on the network by matching DHCP request data against a known-bad list.
    answer_sources:
      - Zeek dhcp.log
      - Zeek conn.log
      - Core network switches, DHCP servers, and wireless network segments.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH dhcp.log | EXTRACT mac_address, hostname | LOOKUP OUI(mac_address) and hostname in offensive_hardware_list | WHERE match_found
  - question: Has a new DHCP request shown anomalous characteristics, such as a rare vendor OUI or an unusual hostname structure, compared to the established baseline?
    context: Beyond looking for known-bad hardware, this question seeks to identify any device that doesn't fit in. By profiling what is 'normal' for your network in terms of hardware vendors (OUIs) and device naming conventions, you can flag outliers that could represent unauthorized or custom malicious devices.
    answer_sources:
      - Zeek dhcp.log
      - Core network switches, DHCP servers, and wireless network segments.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH dhcp.log | EXTRACT OUI, hostname_syntax | CALCULATE rarity_score based on historical distribution | WHERE rarity_score > threshold
  - question: Has a machine learning model (isolation forest) identified a DHCP request as an outlier, suggesting it may be from an unauthorized or malicious device?
    context: This question uses an unsupervised machine learning model, the isolation forest, which is particularly good at anomaly detection. By training it on features of legitimate DHCP requests, it can efficiently 'isolate' and flag new requests that do not conform to the normal profile, providing a more robust method for detecting unknown threats.
    answer_sources:
      - Zeek dhcp.log
      - Core network switches, DHCP servers, and wireless network segments.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH dhcp.log | EXTRACT features (OUI, hostname_length, etc.) | INPUT features into isolation_forest_model | WHERE model_classification == 'outlier'
  - question: Within 10 seconds of a new Human Interface Device (HID) connection, was a suspicious command-line process (like PowerShell or Cmd) launched containing obfuscation or download keywords?
    context: This question targets "BadUSB" or keystroke injection attacks, where a device masquerading as a keyboard rapidly types and executes a malicious command. This analytic looks for the tell-tale signs, like a new HID connection immediately followed by a command shell with suspicious arguments like `-enc`, `IEX`, or `DownloadString`.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 6416
      - Sysmon Event ID 1
      - All corporate endpoint devices, especially workstations in common areas or those used by privileged users.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH new HID connection event | CORRELATE with process creation (powershell.exe, cmd.exe) on same host within 10 seconds | WHERE command_line CONTAINS ('-enc', '-w hidden', 'IEX', 'DownloadString', 'FromBase64String')
  - question: Did a command line executed immediately after a new HID connection have unusually high entropy, suggesting it was obfuscated?
    context: To bypass simple keyword-based detection, keystroke injection payloads are often heavily obfuscated or Base64-encoded. This results in a command-line string with high entropy (randomness). This question helps detect this by calculating the entropy of command lines following HID connections and flagging those that are statistical outliers.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 6416
      - Sysmon Event ID 1
      - All corporate endpoint devices, especially workstations in common areas or those used by privileged users.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH new HID connection event | CORRELATE with process creation on same host within 10 seconds | CALCULATE entropy of command_line | WHERE entropy > threshold (e.g., 99th percentile)
  - question: Has a Natural Language Processing (NLP) model classified a command line as malicious, where the command was executed immediately after a new HID connection?
    context: This question applies advanced machine learning to command-line analysis. An NLP model trained on benign and malicious commands can understand the structure and intent of a command string far better than keyword or entropy checks, allowing it to detect novel or complex obfuscation techniques with higher accuracy.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 6416
      - Sysmon Event ID 1
      - All corporate endpoint devices, especially workstations in common areas or those used by privileged users.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH new HID connection event | CORRELATE with process creation on same host within 10 seconds | INPUT command_line into NLP_model | WHERE model_classification == 'malicious' AND confidence > 0.9
  - question: Are there any devices active on the network whose MAC addresses are not registered in the authoritative asset management system (CMDB)?
    context: Every device on the corporate network should be known and tracked. By regularly comparing observed MAC addresses from network logs against a master list of approved assets, you can quickly identify unauthorized devices, which could be an employee's personal device or an adversary's implant.
    answer_sources:
      - Zeek dhcp.log
      - Zeek conn.log
      - Asset Management System Data (CSV/DB)
      - Network infrastructure (DHCP servers, core switches), Asset Management Database, Network Access Control (NAC) systems.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: GET all MACs from network_logs in last 15 mins | GET all MACs from CMDB | FIND MACs in network_logs NOT IN CMDB
  - question: Has there been an anomalous spike in the number of new, unregistered devices appearing on the network?
    context: While a few unregistered devices might appear from time to time, a sudden increase is a significant anomaly. This could indicate a systemic failure in device onboarding, a misconfigured network segment, or an adversary connecting multiple devices at once. This question uses statistical analysis to detect such abnormal surges.
    answer_sources:
      - Zeek dhcp.log
      - Zeek conn.log
      - Asset Management System Data (CSV/DB)
      - Network infrastructure (DHCP servers, core switches), Asset Management Database, Network Access Control (NAC) systems.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: CALCULATE hourly count of new, unregistered MACs | COMPARE count to 7-day moving average and std_dev | WHERE count > (mean + 3 * std_dev)
  - question: Has the daily number of new, unregistered devices significantly exceeded the number predicted by a forecasting model that accounts for historical trends and seasonality?
    context: Organizations have natural rhythms, such as onboarding new employees, which can cause predictable fluctuations in the appearance of new devices. This question uses a more sophisticated time-series model (like Prophet) to account for these patterns. An alert is triggered only when the number of new devices is statistically unexpected, reducing false positives.
    answer_sources:
      - Zeek dhcp.log
      - Zeek conn.log
      - Asset Management System Data (CSV/DB)
      - Network infrastructure (DHCP servers, core switches), Asset Management Database, Network Access Control (NAC) systems.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: GET daily count of new, unregistered MACs | INPUT to forecasting_model (e.g., Prophet) | WHERE actual_count > predicted_upper_bound
  - question: Within 60 seconds of a new hardware connection, was an anomalous parent-child process relationship observed, such as services.exe spawning cmd.exe?
    context: Malicious drivers or hardware-triggered payloads may launch processes in a way that deviates from normal system behavior. For example, the services.exe process should not typically spawn a command shell. This question looks for these unusual process ancestries immediately following a hardware event as a strong indicator of compromise.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 5156
      - Windows Event ID 6416
      - Sysmon Event ID 1
      - Sysmon Event ID 3
      - All corporate endpoint devices, Security Information and Event Management (SIEM) system.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH (EventID 6416) | CORRELATE with process creation (Sysmon EventID 1) on same host within 60 seconds | WHERE ParentImage is anomalous for ChildImage (e.g., ParentImage=='services.exe' AND Image=='cmd.exe')
  - question: After a new hardware event, did a process on the host exhibit uncharacteristic behavior, such as being launched by a rare parent process or making a first-time network connection to a non-corporate IP?
    context: This question uses behavioral profiling to detect anomalies. Instead of relying on fixed rules, it establishes a baseline of what is 'normal' for each process. Any activity after a hardware event that deviates from this learned profile, like a new parent process or a new network destination, is flagged as suspicious.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 5156
      - Windows Event ID 6416
      - Sysmon Event ID 1
      - Sysmon Event ID 3
      - All corporate endpoint devices, Security Information and Event Management (SIEM) system.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH (EventID 6416) | MONITOR subsequent process activity (Sysmon EventID 1, 3) | SCORE activity against historical process profile | WHERE anomaly_score > threshold
  - question: Has a graph-based anomaly detection model identified a sequence of events following a new hardware connection as a deviation from learned benign patterns?
    context: In this advanced approach, system activity is modeled as a graph (processes, files, etc. as nodes). By training a model on normal activity graphs, it can detect entire sequences of suspicious behavior (e.g., new hardware -> process launch -> registry modification) that would be difficult to define with individual rules.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 5156
      - Windows Event ID 6416
      - Sysmon Event ID 1
      - Sysmon Event ID 3
      - All corporate endpoint devices, Security Information and Event Management (SIEM) system.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH (EventID 6416) | BUILD graph of subsequent system activity | INPUT subgraph into graph_model | WHERE model identifies anomalous patterns