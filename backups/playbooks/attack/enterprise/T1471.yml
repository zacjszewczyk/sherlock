name: "T1471: Data Encrypted for Impact"
id: "f47ac10b-58cc-4372-a567-0e02b2c3d479"
description: "This playbook helps investigate if an adversary is encrypting data on corporate mobile devices for impact, a common ransomware behavior. It focuses on detecting several key indicators: an anomalously high rate of file write or rename operations originating from a single mobile process; the creation of files that match known ransom note patterns by filename or by content containing keywords related to cryptocurrency and data recovery; outbound network connections to known ransomware C2 infrastructure or suspicious domains (e.g., newly registered, high entropy) shortly after file encryption activity; and whether the process responsible for the encryption is an unmanaged, sideloaded, or statistically rare application within the device fleet."
type: "technique"
related:
  - "TA0034: Impact"
contributors:
  - "Zachary Szewczyk"
  - "Ask Sage"
created: "2025-10-01"
modified: "2025-10-01"
version: "1.0"
tags: "none"
questions:
  - question: "Has a single mobile process initiated an unusually high number of file rename operations in a short period?"
    context: "Ransomware often encrypts user files and renames them with a new, consistent extension (e.g., .crypted, .locked). A sudden burst of more than 20 file rename events from a single process within 60 seconds is a strong indicator of this malicious activity, especially if the original files are common user data types (.jpg, .pdf) and the new extensions are all identical."
    answer_sources:
      - "MobileEDR.FileEvents"
      - "MobileEDR.ProcessEvents"
      - "MDM.ApplicationLogs"
      - "NAI: User data directories on managed mobile devices, including Android standard directories (e.g., /storage/emulated/0/DCIM, /storage/emulated/0/Documents) and iOS App Sandbox container directories."
    range: "last 90 days"
    queries:
      - "Pseudocode: SEARCH MobileEDR.FileEvents | GROUP BY process_id, device_id | WHERE event_type = 'File Rename' AND count > 20 WITHIN 60s | FILTER original_extension IN target_list AND new_extension is consistent."
  - question: "Is a mobile application exhibiting a file write activity rate that significantly deviates from its historical baseline or its peer group?"
    context: "The encryption process involves reading original files and writing new, encrypted versions, causing a spike in file write I/O. This question aims to detect such anomalies by comparing an application's current file write rate against its own 30-day historical activity and against other applications in the same category (e.g., 'Productivity'). An alert is triggered if the activity exceeds the 99th percentile of its own baseline or the 95th percentile of its peers, indicating a significant deviation from normal behavior."
    answer_sources:
      - "MobileEDR.FileEvents"
      - "MobileEDR.ProcessEvents"
      - "MDM.ApplicationLogs"
      - "NAI: User data directories on managed mobile devices, including Android standard directories (e.g., /storage/emulated/0/DCIM, /storage/emulated/0/Documents) and iOS App Sandbox container directories."
    range: "last 90 days"
    queries:
      - "Pseudocode: CALCULATE 30-day_baseline(file_writes) for each app | ALERT IF current_writes > 99th_percentile(own_baseline) OR current_writes > 95th_percentile(peer_group_baseline) in a 1-minute window."
  - question: "Does a mobile application's file I/O rate show a sustained anomaly according to a time-series model?"
    context: "To reduce false positives from simple thresholding, this question uses a more advanced time-series model (like Prophet or LSTM) to learn the normal I/O patterns and seasonality of each application. An alert is generated only when the observed file write/rename rate exceeds the model's predicted upper confidence bound for a sustained period (e.g., three consecutive minutes), indicating a persistent anomaly that is less likely to be a benign, transient spike and more likely to be malicious encryption."
    answer_sources:
      - "MobileEDR.FileEvents"
      - "MobileEDR.ProcessEvents"
      - "MDM.ApplicationLogs"
      - "NAI: User data directories on managed mobile devices, including Android standard directories (e.g., /storage/emulated/0/DCIM, /storage/emulated/0/Documents) and iOS App Sandbox container directories."
    range: "last 90 days"
    queries:
      - "Pseudocode: INPUT file_io_rate_per_minute to time-series_model | ALERT IF observed_rate > predicted_upper_bound FOR >= 3 consecutive minutes."
  - question: "Have any files with names matching common ransom note patterns been created on a mobile device?"
    context: "After encrypting files, adversaries typically drop 'ransom notes' (e.g., 'readme.txt', 'decrypt_help.html') to provide instructions for payment. This question involves a direct search for the creation of files whose names match these well-known patterns using regular expressions. A match is a high-confidence indicator of a ransomware attack in progress."
    answer_sources:
      - "MobileEDR.FileEvents"
      - "DLP.FileScanContent"
      - "NAI: Root of user-accessible storage on mobile devices (e.g., /sdcard/, /storage/emulated/0/), directories containing recently modified user data, and application-specific data directories."
    range: "last 90 days"
    queries:
      - "Pseudocode: SEARCH MobileEDR.FileEvents | WHERE event_type = 'File Creation' AND filename MATCHES REGEX /(readme|recover|decrypt|help|restore).*\\.(txt|html)$/i | TRIGGER critical alert."
  - question: "If a potential ransom note file was created, did the responsible process create the same file in multiple directories?"
    context: "To ensure the victim sees the ransom note, attackers often place copies in multiple locations across the file system. This question checks for this 'fan-out' behavior. If a process that created a file matching a ransom note pattern is observed creating the same file in more than three different directories within a short time frame (5 minutes), it greatly increases the confidence that this is a true positive and the incident priority should be escalated."
    answer_sources:
      - "MobileEDR.FileEvents"
      - "DLP.FileScanContent"
      - "NAI: Root of user-accessible storage on mobile devices (e.g., /sdcard/, /storage/emulated/0/), directories containing recently modified user data, and application-specific data directories."
    range: "last 90 days"
    queries:
      - "Pseudocode: ON ransom_note_alert | COUNT unique_directories for same process_id and filename WITHIN 5 minutes | IF count > 3, ESCALATE_PRIORITY."
  - question: "Does the content of newly created text or HTML files contain language consistent with a ransomware note?"
    context: "Going beyond filenames, this question analyzes the actual content of newly created .txt and .html files. The file's text is passed to a pre-trained text classification model (e.g., fine-tuned BERT) to detect a high density of keywords related to cryptocurrency, payment deadlines, and data recovery. A high-confidence classification (>0.95) as a 'Ransomware Note' can trigger automated responses, such as quarantining the device via MDM API."
    answer_sources:
      - "MobileEDR.FileEvents"
      - "DLP.FileScanContent"
      - "NAI: Root of user-accessible storage on mobile devices (e.g., /sdcard/, /storage/emulated/0/), directories containing recently modified user data, and application-specific data directories."
    range: "last 90 days"
    queries:
      - "Pseudocode: ON new_file_creation(txt, html) | SEND file_content to text_classification_model | IF classification = 'Ransomware Note' AND confidence > 0.95, QUARANTINE_DEVICE."
  - question: "Following high-volume file I/O activity, did the device connect to a known ransomware command-and-control (C2) server?"
    context: "Ransomware often communicates with a C2 server to exfiltrate keys or receive commands. This question correlates file encryption alerts with subsequent network activity. By joining file I/O alerts with network logs within a 5-minute window, it checks if the device connected to a destination IP or domain present on a 'Ransomware C2' threat intelligence feed, providing a strong link between the on-device activity and malicious infrastructure."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Zeek ssl.log"
      - "MobileEDR.NetworkEvents"
      - "NAI: Corporate Wi-Fi access points, VPN concentrators, and cloud-based secure web gateways (SWG) that inspect mobile device traffic."
    range: "last 90 days"
    queries:
      - "Pseudocode: JOIN File_IO_alerts with NetworkEvents on device_id WITHIN 5 minutes | ALERT IF destination_ip/domain IN Ransomware_C2_Threat_Feed."
  - question: "Following potential encryption activity, did the device make DNS queries for newly registered domains (NRDs) or domains with high entropy?"
    context: "To evade detection, attackers often use newly registered domains (NRDs) or domains generated by algorithms (DGA), which appear random. This question analyzes DNS queries from a device that has a pending file encryption alert. If the device queries a domain registered less than 30 days ago or a domain with high character randomness (Shannon entropy > 3.5), it's a strong indicator of suspicious C2 communication, and the device's risk score should be increased."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Zeek ssl.log"
      - "MobileEDR.NetworkEvents"
      - "NAI: Corporate Wi-Fi access points, VPN concentrators, and cloud-based secure web gateways (SWG) that inspect mobile device traffic."
    range: "last 90 days"
    queries:
      - "Pseudocode: ON file_encryption_alert | ANALYZE subsequent DNS_queries | IF domain_entropy > 3.5 OR domain_age < 30 days, INCREASE_RISK_SCORE."
  - question: "Following potential encryption activity, did the device exhibit anomalous network traffic patterns?"
    context: "Even if a C2 destination is unknown, the network connection itself may be anomalous. This question uses an unsupervised machine learning model (e.g., Isolation Forest) trained on benign mobile traffic features (port, protocol, bytes transferred, JA3 hash). For a device with a pending encryption alert, its subsequent network connections are scored by this model. Connections flagged as anomalies indicate a deviation from normal behavior and can be used to escalate the original alert."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Zeek ssl.log"
      - "MobileEDR.NetworkEvents"
      - "NAI: Corporate Wi-Fi access points, VPN concentrators, and cloud-based secure web gateways (SWG) that inspect mobile device traffic."
    range: "last 90 days"
    queries:
      - "Pseudocode: ON file_encryption_alert | SCORE subsequent network_connections with anomaly_model | IF connection is anomaly, ESCALATE_ALERT."
  - question: "Was the process responsible for file encryption activity from an unmanaged or sideloaded application?"
    context: "Applications installed from outside official, managed channels ('sideloaded' or 'unmanaged') carry a much higher risk. This question enriches a file encryption alert by checking the responsible application's status in the Mobile Device Management (MDM) platform. If the app is found to be unmanaged or sideloaded, the alert's severity is automatically escalated, as the source is untrusted."
    answer_sources:
      - "MDM.AppInventoryLogs"
      - "MDM.AppPermissionLogs"
      - "MDM.ComplianceStatusLogs"
      - "NAI: Mobile Device Management (MDM) platform's application inventory database and policy compliance logs."
    range: "last 90 days"
    queries:
      - "Pseudocode: ON file_encryption_alert | QUERY MDM for process_name on device_id | IF app_source = 'Sideloaded' OR is_managed = false, ESCALATE_ALERT."
  - question: "Does the application responsible for file encryption have a statistically rare set of permissions compared to other apps in the environment?"
    context: "Malware often requests an unusual combination of permissions to function. This question involves baselining the permission sets of all applications across the device fleet. When a file encryption alert occurs, the permission set of the responsible application is checked against this baseline. If the combination of permissions is rare (e.g., present on less than 1% of devices), it is a strong indicator of an outlier and adds high-confidence enrichment to the alert."
    answer_sources:
      - "MDM.AppInventoryLogs"
      - "MDM.AppPermissionLogs"
      - "MDM.ComplianceStatusLogs"
      - "NAI: Mobile Device Management (MDM) platform's application inventory database and policy compliance logs."
    range: "last 90 days"
    queries:
      - "Pseudocode: ON file_encryption_alert | LOOKUP permission_set for app | IF permission_set_prevalence < 1st_percentile, ENRICH_ALERT."
  - question: "Does the application responsible for file encryption belong to a cluster of anomalous applications based on its metadata?"
    context: "This question uses machine learning to group applications based on their metadata (permissions, source, developer, etc.) to find 'anomalous clusters'—small groups of apps that don't fit with the mainstream. If an application causing a file encryption alert is found to belong to one of these small, outlier clusters, it provides another layer of evidence that the application is suspicious and the incident should be automatically escalated."
    answer_sources:
      - "MDM.AppInventoryLogs"
      - "MDM.AppPermissionLogs"
      - "MDM.ComplianceStatusLogs"
      - "NAI: Mobile Device Management (MDM) platform's application inventory database and policy compliance logs."
    range: "last 90 days"
    queries:
      - "Pseudocode: ON file_encryption_alert | IDENTIFY cluster for app_metadata | IF cluster is 'anomalous', ESCALATE_INCIDENT."