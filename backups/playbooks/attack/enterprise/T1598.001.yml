name: T1598.001: Spearphishing Service
id: f47ac10b-58cc-4372-a567-0e02b2c3d479
description: >-
  This playbook is designed to detect reconnaissance activities conducted via spearphishing services, as defined by MITRE ATT&CK technique T1598.001. It addresses the core investigative question: 'Is the adversary performing reconnaissance using spearphishing services against the enterprise?'. The playbook provides a multi-faceted approach to detection by analyzing various evidence types. This includes correlating inbound email metadata against threat intelligence feeds, identifying impersonation attempts of key personnel by checking for display name similarities and public webmail origins, scanning email subjects for suspicious keywords and statistically unusual terms, monitoring for new domains sending emails at an anomalous rate, and detecting coordinated link-clicking activity where multiple endpoints suddenly connect to a newly-observed domain. By combining symbolic, statistical, and machine learning-based queries, this playbook aims to provide comprehensive coverage against spearphishing-based reconnaissance.
type: technique
related:
  - TA0043: Reconnaissance
contributors:
  - Zachary Szewczyk
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Are inbound emails matching high-confidence threat intelligence indicators for phishing or reconnaissance?
    context: >-
      This question aims to detect known malicious activity by cross-referencing inbound email metadata (sender IP, domain, HELO string) against a curated list of threat intelligence IOCs. A match provides a strong signal that an email is part of a known phishing or reconnaissance campaign, allowing for immediate blocking or alerting.
    answer_sources:
      - Zeek conn.log
      - Zeek smtp.log
      - Corporate Email Gateway
      - Network Perimeter Firewalls
    range: last 90 days
    queries:
      - symbolic: Query: Join Zeek smtp.log and conn.log on UID. Alert if HELO, FROM domain, or source IP matches threat intelligence list.
  - question: Has a previously benign sender IP address started exhibiting behavior consistent with malicious activity?
    context: >-
      This question seeks to identify compromised or newly malicious infrastructure. It establishes a baseline of normal behavior for each sender IP address by tracking its historical ratio of threat intelligence matches to total email volume. A significant statistical deviation from this baseline suggests the sender's reputation has changed, warranting investigation even if it wasn't previously on a blocklist.
    answer_sources:
      - Zeek conn.log
      - Zeek smtp.log
      - Corporate Email Gateway
      - Network Perimeter Firewalls
    range: last 90 days, using a 30-day rolling baseline for calculations.
    queries:
      - statistical: Query: For each SMTP source IP, calculate the ratio of TI hits vs total emails. Alert if the current ratio is > 3 standard deviations from its 30-day rolling average.
  - question: Can we proactively predict if a new, unseen email is malicious based on its network characteristics?
    context: >-
      This question leverages machine learning to move beyond known indicators and identify novel threats. By training a classification model on features like HELO string entropy, sender TLD, and IP geolocation, the system can assign a risk score to every inbound email. This allows for the detection of suspicious emails that may not match any existing rule or signature, based on a probabilistic assessment of their characteristics.
    answer_sources:
      - Zeek conn.log
      - Zeek smtp.log
      - Corporate Email Gateway
      - Network Perimeter Firewalls
    range: last 90 days
    queries:
      - machine_learning: Query: For each email, extract features (HELO entropy, TLD, ASN, etc.). Input features into a trained classification model. Alert if the predicted malicious probability > 0.90.
  - question: Are we receiving emails where the sender's display name matches a key employee, but the email address is from a public webmail provider?
    context: >-
      This question targets a common impersonation tactic used in Business Email Compromise (BEC) and spearphishing. Adversaries use a familiar display name to build trust, while the actual sending address is from a disposable or generic public email service. This query performs a direct check for this mismatch, identifying blatant impersonation attempts.
    answer_sources:
      - Zeek smtp.log
      - Corporate Email Gateway
      - Human Resources Information System (for key personnel list)
    range: last 90 days
    queries:
      - symbolic: Query: Check smtp.log for emails where the display name is in the key personnel list but the sender domain is in the public webmail list. Flag for review.
  - question: Are we receiving emails from public webmail providers with display names that are highly similar, but not identical, to key personnel?
    context: >-
      This question aims to catch more subtle impersonation attempts that might evade exact-match rules, such as minor misspellings or variations in a name. By calculating the string similarity (Jaro-Winkler distance) between the sender's display name and an internal directory, it can flag suspicious emails from new, untrusted sources that are likely trying to impersonate an employee.
    answer_sources:
      - Zeek smtp.log
      - Corporate Email Gateway
      - Human Resources Information System (for key personnel list)
    range: last 180 days
    queries:
      - statistical: Query: For each email, calculate Jaro-Winkler similarity between sender display name and key personnel list. Flag if score > 0.95, sender is public webmail, and sender has no history in the last 180 days.
  - question: Can we generate a holistic risk score for Business Email Compromise (BEC) attempts based on multiple factors?
    context: >-
      This question uses a machine learning model to provide a comprehensive risk assessment for potential BEC attacks. Instead of relying on a single indicator, it synthesizes multiple features—such as display name similarity, sender domain reputation, use of urgent language, and communication history—to produce a single 'BEC Risk Score'. This allows for more nuanced and accurate detection of sophisticated impersonation campaigns.
    answer_sources:
      - Zeek smtp.log
      - Corporate Email Gateway
      - Human Resources Information System (for key personnel list)
    range: last 90 days
    queries:
      - machine_learning: Query: For each email, extract features (name similarity, domain category, subject keywords, etc.). Input into a trained model to generate a BEC risk score. Alert on high scores.
  - question: Are inbound emails from external, non-whitelisted domains using subject lines with reconnaissance-themed keywords?
    context: >-
      This question uses regular expressions to search for specific patterns and keywords in email subject lines that are commonly associated with reconnaissance activities (e.g., 'urgent request', 'confirm details'). It provides a straightforward method for flagging emails from unknown senders that are explicitly asking for information in a suspicious manner.
    answer_sources:
      - Zeek smtp.log
      - Corporate Email Gateway
    range: last 90 days
    queries:
      - symbolic: Query: Apply regex for reconnaissance keywords (e.g., /urgent.*request/) to the subject of emails in smtp.log from external, non-whitelisted domains. Alert on match.
  - question: Do inbound email subjects contain statistically uncommon terms that align with a reconnaissance lexicon?
    context: >-
      This question aims to find unusual or outlier language in email subjects that might indicate a targeted campaign. By using TF-IDF, it identifies terms that are rare across the entire organization's email traffic but may be common within a specific, potentially malicious, set of emails. This can highlight emerging campaign themes before they are widely known.
    answer_sources:
      - Zeek smtp.log
      - Corporate Email Gateway
    range: last 90 days, using a 30-day rolling window for TF-IDF calculation.
    queries:
      - statistical: Query: Calculate TF-IDF scores for all terms in inbound email subjects. Alert if an email contains high TF-IDF terms that are also in a reconnaissance word list.
  - question: Can we identify clusters of emails that belong to a reconnaissance-themed topic without pre-defining keywords?
    context: >-
      This question leverages unsupervised machine learning (NLP topic modeling) to discover emerging themes in email subjects automatically. Instead of relying on predefined keyword lists, the Latent Dirichlet Allocation (LDA) algorithm groups emails by semantic similarity. This allows analysts to identify and investigate clusters of emails related to reconnaissance, even if the attackers use novel language or phrasing.
    answer_sources:
      - Zeek smtp.log
      - Corporate Email Gateway
    range: last 90 days
    queries:
      - machine_learning: Query: Apply an LDA topic model to all inbound email subjects. Analyze the generated topics for reconnaissance-related keywords. Alert on emails belonging to suspicious topics.
  - question: Is a new, potentially recently registered domain sending email to an abnormally large number of recipients in a short time?
    context: >-
      This question aims to detect the 'blast' phase of a spearphishing campaign where an adversary uses a new domain to target many users at once. It uses a fixed threshold (e.g., >25 recipients in an hour) for a domain not seen in the last 90 days. Enriching this with WHOIS data to check the domain's registration date adds critical context, as newly registered domains are highly suspicious.
    answer_sources:
      - Zeek smtp.log
      - Zeek dns.log
      - Corporate Email Gateway
      - Internal DNS Resolvers
    range: last 90 days
    queries:
      - symbolic: Query: For any domain not seen in 90 days, alert if it sends to >25 unique recipients in one hour. Enrich alert with domain registration date from WHOIS/DNS data.
  - question: Is a new sending domain's outreach volume statistically anomalous compared to other new senders?
    context: >-
      This question refines the detection of high-volume sending from new domains by using a dynamic, statistical threshold instead of a fixed one. It establishes a baseline of normal behavior for 'new senders' by calculating the 99th percentile of recipients they contact. This approach is more resilient to normal fluctuations in email traffic and more accurately flags true outliers that represent a likely reconnaissance or phishing blast.
    answer_sources:
      - Zeek smtp.log
      - Zeek dns.log
      - Corporate Email Gateway
      - Internal DNS Resolvers
    range: last 90 days
    queries:
      - statistical: Query: Establish a baseline 99th percentile for recipient count/hour for new senders. Alert when a new sender exceeds this percentile.
  - question: Can we detect a coordinated email campaign by identifying anomalies in email volume and clustering the related messages?
    context: >-
      This question uses a multi-stage machine learning approach to detect stealthy campaigns. First, a time-series model detects unusual spikes in overall email volume that might otherwise be missed. Second, upon detection of an anomaly, a clustering algorithm is triggered to group all emails from that specific time window. This can reveal a coordinated attack by grouping messages with similar features (sender, subject, etc.) that were all sent during the anomalous spike.
    answer_sources:
      - Zeek smtp.log
      - Zeek dns.log
      - Corporate Email Gateway
      - Internal DNS Resolvers
    range: last 90 days
    queries:
      - machine_learning: Query: Use a time-series model (ARIMA) to detect anomalies in email volume. On anomaly, use a clustering algorithm (DBSCAN) on emails in that window to identify potential campaigns.
  - question: Are multiple hosts simultaneously visiting a new, non-categorized domain via a web browser?
    context: >-
      This question seeks to identify the successful outcome of a spearphishing campaign: multiple users clicking a malicious link. It correlates process creation events (a browser launching) with subsequent DNS queries from the same host. When a large number of distinct hosts all query for the same never-before-seen domain in a short time frame, it is a strong indicator of a coordinated spearphishing attack.
    answer_sources:
      - Zeek dns.log
      - Windows Event ID 4688
      - User Endpoints
      - Internal DNS Resolvers
      - Network Egress Points
    range: last 90 days
    queries:
      - symbolic: Query: Correlate process creation (browser.exe) with DNS logs. Alert if >10 hosts query the same new, non-whitelisted domain within 5 minutes.
  - question: Is there a statistically significant spike in the number of unique hosts querying for 'first-seen' domains?
    context: >-
      This question provides a broader, statistical view of potential link-clicking activity. It tracks the rate at which new, never-before-seen domains are being resolved across the enterprise. A sudden spike in this rate, exceeding a historical baseline, suggests that multiple users may have been tricked into clicking links to various malicious domains as part of one or more concurrent campaigns.
    answer_sources:
      - Zeek dns.log
      - Windows Event ID 4688
      - User Endpoints
      - Internal DNS Resolvers
      - Network Egress Points
    range: last 90 days, using a 30-day rolling baseline.
    queries:
      - statistical: Query: Maintain a count of unique hosts querying first-seen domains per minute. Alert when this count exceeds the 99.5th percentile of its 30-day baseline.
  - question: Can we use graph analysis to discover communities of users who have been targeted in a coordinated spearphishing campaign?
    context: >-
      This question models system activity as a graph to uncover complex relationships indicative of a coordinated attack. By representing users, processes, and domains as nodes, and their interactions as edges, community detection algorithms can find densely connected subgraphs. Such a subgraph, representing multiple users all launching browsers that resolve to a single uncommon domain, provides powerful, visualized evidence of a successful spearphishing attack.
    answer_sources:
      - Zeek dns.log
      - Windows Event ID 4688
      - User Endpoints
      - Internal DNS Resolvers
      - Network Egress Points
    range: last 90 days
    queries:
      - machine_learning: Query: Build a graph of users, processes, and domains from endpoint and DNS logs. Use a community detection algorithm to find clusters of users connecting to the same uncommon domain.