name: T1596.001: DNS / Passive DNS
id: a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d
description: This playbook helps investigate whether an adversary is conducting reconnaissance against the organization using passive DNS. This involves identifying external IP addresses from threat intelligence feeds scanning the organization's domains, detecting rapid queries for sensitive service discovery records (SRV), identifying unauthorized DNS zone transfer attempts (AXFR/IXFR), detecting high rates of NXDOMAIN responses indicative of subdomain enumeration, and observing sudden, significant increases in overall DNS query volume that are not attributable to legitimate business activity.
type: technique
related:
  - TA0043: Reconnaissance
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Are external IPs known for reconnaissance scanning our domains?
    context: This question aims to identify if IPs listed on threat intelligence feeds as 'reconnaissance' or 'scanner' are performing DNS queries for the organization's domains. A positive match is a strong indicator of targeted reconnaissance activity.
    answer_sources:
      - Zeek dns.log
      - Threat Intelligence Platform Feeds
      - Authoritative DNS Servers
      - Public-facing DNS Resolvers
      - Network Egress/Ingress Points (Firewalls)
      - Threat Intelligence Subscription Services
    range: last 90 days
    queries:
      - technology: pseudocode
        query: Search DNS logs for queries where source IP is in threat intel list of scanners.
  - question: Are known scanning IPs exhibiting unusually high query frequency against our domains?
    context: This question builds on the previous one by adding a frequency analysis layer. Adversaries often perform a high volume of queries in a short period. By identifying IPs that are both on a threat list and show high query rates (above the $$ 95^{th} $$ percentile), we can prioritize the most active and potentially dangerous reconnaissance efforts.
    answer_sources:
      - Zeek dns.log
      - Threat Intelligence Platform Feeds
      - Authoritative DNS Servers
      - Public-facing DNS Resolvers
      - Network Egress/Ingress Points (Firewalls)
      - Threat Intelligence Subscription Services
    range: last 90 days
    queries:
      - technology: pseudocode
        query: For IPs on threat intel list, calculate query frequency over 24 hours. Alert if frequency > 95th percentile of all other external DNS clients.
  - question: Can we predictively identify reconnaissance-related DNS queries using machine learning?
    context: This question explores a proactive, predictive approach. By training a machine learning model on features like IP reputation, ASN, query type, and FQDN patterns, the goal is to automatically classify and score incoming DNS queries. This allows for the detection of novel or subtle reconnaissance attempts. An investigation is warranted for queries flagged with high confidence ($$ > 0.90 $$).
    answer_sources:
      - Zeek dns.log
      - Threat Intelligence Platform Feeds
      - Authoritative DNS Servers
      - Public-facing DNS Resolvers
      - Network Egress/Ingress Points (Firewalls)
      - Threat Intelligence Subscription Services
    range: last 90 days
    queries:
      - technology: pseudocode
        query: Apply ML model to DNS queries. Alert if classification is 'reconnaissance' and confidence > 0.90.
  - question: Is any single external IP performing rapid queries for multiple sensitive service (SRV) records?
    context: Adversaries query for SRV records like `_gc._tcp`, `_ldap._tcp`, or `_kerberos._tcp` to map out internal Active Directory infrastructure. A single external source querying for several of these in a short time frame (e.g., more than 3 records in 5 minutes) is highly indicative of active reconnaissance to discover critical services.
    answer_sources:
      - Zeek dns.log
      - Authoritative DNS Servers
      - Network Egress/Ingress Points (Firewalls)
    range: last 90 days
    queries:
      - technology: pseudocode
        query: Search DNS logs for external IPs querying > 3 distinct sensitive SRV records within 5 minutes.
  - question: Are any external IPs showing a statistically anomalous ratio of SRV queries compared to their total DNS activity?
    context: This question aims to find outliers. Benign clients rarely query for SRV records, so an external IP with a high proportion of SRV queries relative to its other DNS activity is suspicious. Flagging IPs whose SRV query ratio exceeds the $$ 99.9^{th} $$ percentile helps to isolate potential reconnaissance actors from normal traffic patterns.
    answer_sources:
      - Zeek dns.log
      - Authoritative DNS Servers
      - Network Egress/Ingress Points (Firewalls)
    range: last 90 days
    queries:
      - technology: pseudocode
        query: For each external IP, calculate (SRV queries / total queries) over 1 hour. Alert if ratio > 99.9th percentile.
  - question: Do the sequences of DNS queries from any external IP match the patterns of known reconnaissance tools?
    context: This question uses machine learning to detect not just individual suspicious queries, but the entire sequence of queries. Tools like DNSenum have predictable patterns. A sequence analysis model (e.g., Hidden Markov Model) can learn these patterns and identify attackers even if their individual queries seem benign.
    answer_sources:
      - Zeek dns.log
      - Authoritative DNS Servers
      - Network Egress/Ingress Points (Firewalls)
    range: last 90 days
    queries:
      - technology: pseudocode
        query: Apply sequence analysis model to DNS query patterns per source IP. Alert if pattern matches known recon tools.
  - question: Are unauthorized external IPs attempting DNS zone transfers (AXFR/IXFR) from our authoritative servers?
    context: A DNS zone transfer (AXFR/IXFR) provides a complete copy of a DNS zone's records. These queries should only come from authorized secondary DNS servers. Any attempt from an unauthorized external IP is a critical security event and likely a direct reconnaissance attempt.
    answer_sources:
      - Zeek dns.log
      - Authoritative DNS Servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: Search DNS logs for qtype 'AXFR' or 'IXFR' where source IP is not in the approved allow-list.
  - question: Is any external IP sending a statistically unusual volume of 'ANY' type queries?
    context: An 'ANY' query asks a name server for all known information about a domain name. While it has legitimate uses, attackers often use it for initial reconnaissance. A single source sending a volume of 'ANY' queries that is significantly above the normal baseline (e.g., more than $$ 3\sigma $$) is highly suspicious.
    answer_sources:
      - Zeek dns.log
      - Authoritative DNS Servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: For external IPs, calculate 'ANY' query count over 1 hour. Alert if count is > 3 standard deviations above the mean.
  - question: Can we use machine learning to detect anomalous DNS queries based on rare types or unusual frequencies?
    context: This question applies unsupervised machine learning to find "needles in the haystack." Models like Isolation Forest can learn what normal DNS traffic looks like and automatically flag any activity that deviates significantly, such as an unexpected AXFR attempt or a burst of 'ANY' queries from a single source.
    answer_sources:
      - Zeek dns.log
      - Authoritative DNS Servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: Apply anomaly detection model to DNS traffic features (qtype, volume). Alert on outliers identified by the model.
  - question: Is any external IP generating a high rate of non-existent domain (NXDOMAIN) errors?
    context: Adversaries often try to discover valid subdomains by brute-forcing a large list of potential names. This technique results in a high percentage of queries for names that do not exist, returning an NXDOMAIN error. A source IP where over 80% of its queries (with a minimum of 50 total queries) result in NXDOMAIN is a strong indicator of subdomain enumeration.
    answer_sources:
      - Zeek dns.log
      - Authoritative DNS Servers
      - DNS Resolvers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: For each external IP, over a 5-min window, alert if (NXDOMAIN count / total queries) > 0.8 AND total queries > 50.
  - question: Are the subdomains being queried by any external IP showing signs of being algorithmically generated (high entropy)?
    context: Attackers can use Domain Generation Algorithms (DGAs) to create random-looking subdomains for enumeration. These algorithmically generated names have high character entropy. Calculating the Shannon entropy of queried subdomains ($$ H(X) = -\sum_{i=1}^{n} P(x_i) \log_2 P(x_i) $$) and flagging sources with unusually high scores (above the $$ 98^{th} $$ percentile) can help detect this advanced technique.
    answer_sources:
      - Zeek dns.log
      - Authoritative DNS Servers
      - DNS Resolvers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: For each external IP, calculate Shannon entropy of queried subdomains in a 10-min window. Alert if entropy > 98th percentile.
  - question: Can we use clustering to isolate groups of IPs exhibiting subdomain enumeration behavior?
    context: This question uses clustering to group DNS clients based on their behavior (query count, NXDOMAIN ratio, subdomain entropy). Normal clients will form dense clusters. Attackers performing subdomain enumeration will have distinct characteristics and will likely be classified as outliers or "noise" by the algorithm, making them easy to identify for investigation.
    answer_sources:
      - Zeek dns.log
      - Authoritative DNS Servers
      - DNS Resolvers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: Apply clustering algorithm to DNS traffic features (query count, NXDOMAIN ratio, entropy). Investigate IPs classified as outliers.
  - question: Has there been a sudden, sharp, and sustained increase in the overall DNS query rate?
    context: A dramatic spike in DNS query volume (e.g., a 300% increase over the recent average that lasts for several minutes) can indicate a distributed reconnaissance effort or the start of a denial-of-service attack. This rule provides an early warning of a significant change in traffic patterns.
    answer_sources:
      - Zeek dns.log
      - Authoritative DNS Servers
      - Network Egress/Ingress Points (Firewalls)
    range: last 90 days
    queries:
      - technology: pseudocode
        query: Monitor DNS query rate per minute. Alert if rate > 300% of 1-hour moving average for > 5 minutes.
  - question: Is the current total DNS query volume statistically anomalous compared to its long-term historical baseline?
    context: This question applies more rigorous statistical analysis to detect volume surges. By comparing current traffic levels to a 30-day rolling baseline, it can account for normal fluctuations. A surge that exceeds the historical mean by a large margin (e.g., $$ 4\sigma $$) is a strong statistical anomaly suggesting an unusual event.
    answer_sources:
      - Zeek dns.log
      - Authoritative DNS Servers
      - Network Egress/Ingress Points (Firewalls)
    range: last 90 days
    queries:
      - technology: pseudocode
        query: Calculate 30-day baseline (mean, std dev) of DNS query volume. Alert if current volume > mean + 4 standard deviations.
  - question: Is the current DNS query volume significantly different from what a time series forecasting model would predict?
    context: A time series model (like SARIMA) can learn complex patterns, including daily and weekly seasonality, and predict expected traffic volume. If the actual observed volume falls outside the model's $$ 99\% $$ confidence interval for a sustained period, it means a highly unexpected event is occurring that could be a coordinated reconnaissance campaign.
    answer_sources:
      - Zeek dns.log
      - Authoritative DNS Servers
      - Network Egress/Ingress Points (Firewalls)
    range: last 90 days
    queries:
      - technology: pseudocode
        query: Use time series model to predict DNS volume. Alert if observed volume is outside the 99% confidence interval for > 5 minutes.