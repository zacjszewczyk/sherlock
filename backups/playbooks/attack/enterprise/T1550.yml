name: "T1550: Use Alternate Authentication Material"
id: "a3e8f5b0-1c9d-4b7e-8a2f-9c0d1e3f4a5b"
description: "This playbook helps identify adversaries leveraging stolen authentication material (e.g., tickets, hashes, explicit credentials) to bypass access controls, evade defenses, and move laterally. It focuses on detecting the use of credential theft tools, anomalous Kerberos ticket requests, unusual use of explicit credentials, and patterns of lateral movement like logon chaining and anomalous privileged account activity."
type: "technique"
related:
  - "TA0005: Defense Evasion"
  - "TA0008: Lateral Movement"
contributors:
  - "Zachary Szewczyk"
  - "Ask Sage"
created: "2025-10-01"
modified: "2025-10-01"
version: 1.0
tags: "none"
investigative_questions:
  - question: "Are known credential theft tools (like Mimikatz or Rubeus) being executed on any hosts?"
    context: "This question aims to detect the presence of well-known credential dumping tools through signature-based methods. Adversaries use these tools to extract credentials from memory. This involves looking for specific process names (e.g., 'mimikatz.exe'), command-line arguments (e.g., 'sekurlsa::logonpasswords'), or network indicators like connections to malicious named pipes (e.g., '\\\\.\\pipe\\mimi')."
    answer_sources:
      - "Windows Event ID 4688"
      - "Windows Event ID 17 (Sysmon)"
      - "Windows Event ID 18 (Sysmon)"
      - "Zeek smb.log"
      - "Zeek dce_rpc.log"
      - "Domain Controllers"
      - "Member Servers"
      - "Privileged Access Workstations"
      - "File Servers"
    range: "last 90 days"
    queries:
      - "Search for process names ('mimikatz.exe') or specific command-line arguments ('sekurlsa::logonpasswords') in process creation logs. Search for known malicious named pipe connections."
  - question: "Are legitimate processes like PowerShell being used to run obfuscated or injected code indicative of credential theft?"
    context: "Adversaries often use legitimate system processes ('living off the land') like 'powershell.exe' or 'services.exe' to mask their activities. This question focuses on establishing a behavioral baseline for the command-line arguments of these processes. By monitoring for statistical outliers in argument length or entropy, we can detect potential code injection or obfuscation techniques used to hide credential theft activities."
    answer_sources:
      - "Windows Event ID 4688"
      - "Domain Controllers"
      - "Member Servers"
      - "Privileged Access Workstations"
      - "File Servers"
    range: "last 90 days"
    queries:
      - "For parent processes like 'powershell.exe', baseline command-line length and entropy over 30 days. Alert when a new event exceeds 3 standard deviations from the mean."
  - question: "Can a machine learning model identify previously unseen or highly evasive credential theft techniques based on process characteristics?"
    context: "This question proposes using a supervised machine learning model (e.g., Random Forest) for more advanced, non-signature-based detection. The model is trained on labeled data to recognize the subtle characteristics of malicious processes, such as command-line features, parent process relationships, and user context. This allows for the detection of novel or heavily obfuscated credential theft tools."
    answer_sources:
      - "Windows Event ID 4688"
      - "Sysmon Event ID 1"
      - "Domain Controllers"
      - "Member Servers"
      - "Privileged Access Workstations"
      - "File Servers"
    range: "last 90 days"
    queries:
      - "Score new process creation events using a pre-trained Random Forest model. Alert on events with a malicious confidence score > 0.9."
  - question: "Is a user requesting a Kerberos service ticket (TGS-REQ) without a recent, corresponding ticket-granting ticket (TGT-REQ) from the same IP, suggesting a stolen ticket is being used?"
    context: "This question targets the 'Pass-the-Ticket' technique. A legitimate user first authenticates to get a TGT (Event 4768) and then uses it to request service tickets (Event 4769). An attacker with a stolen ticket will skip the first step. This detection looks for a service ticket request (4769) that is not preceded by a TGT request (4768) from the same user and IP within a reasonable timeframe (e.g., 10 hours). The use of weak RC4 encryption is also a strong indicator."
    answer_sources:
      - "Windows Event ID 4769"
      - "Windows Event ID 4768"
      - "Zeek kerberos.log"
      - "Domain Controllers"
    range: "last 90 days"
    queries:
      - "For each Event ID 4769, look for a matching Event ID 4768 (same user/IP) within the last 10 hours. Alert if no match is found or if encryption is RC4-HMAC."
  - question: "Is a user account requesting access to a service (SPN) that is unusual for their role or history?"
    context: "Once an adversary has a stolen ticket, they may use it to access services they normally wouldn't. This question focuses on baselining the typical Service Principal Names (SPNs) requested by each user. By creating a historical profile, we can identify when a user requests access to a rare or unprecedented service for their account, indicating potential misuse of a stolen credential."
    answer_sources:
      - "Windows Event ID 4769"
      - "Zeek kerberos.log"
      - "Domain Controllers"
    range: "last 90 days"
    queries:
      - "Profile historical user-to-SPN request frequency. Alert when a user requests an SPN that is in the bottom 5th percentile of their historical activity."
  - question: "Is there an anomalous spike in the volume of Kerberos service ticket requests for a specific user, suggesting automated ticket usage by a tool?"
    context: "Adversary tools like Rubeus can automate the process of requesting and using Kerberos tickets, often resulting in a much higher volume of requests than a human user would generate. This question uses time-series anomaly detection to model the normal daily and weekly cadence of TGS requests for each user. A significant deviation from this learned pattern can indicate automated activity by a malicious tool."
    answer_sources:
      - "Windows Event ID 4769"
      - "Domain Controllers"
    range: "last 90 days"
    queries:
      - "Model TGS request volume per user over time. Alert when observed volume significantly deviates from the forecasted volume."
  - question: "Is a process authenticating with explicit credentials (Logon Type 9) when it is not an approved administrative tool or application?"
    context: "Logon Type 9 (NewCredentials) occurs when a process uses explicit credentials to run as a different user, a common tactic for adversaries who have stolen credentials. This question aims to identify illegitimate use by filtering for these events and checking the initiating process against an allowlist of known, approved applications (e.g., 'runas.exe', backup software) that legitimately use this functionality."
    answer_sources:
      - "Windows Event ID 4624"
      - "All Windows Endpoints and Servers, especially developer workstations and administrative servers."
    range: "last 90 days"
    queries:
      - "Filter for Event ID 4624 with Logon Type 9. Alert if the process name is not on a pre-defined allowlist."
  - question: "Is there an unusual frequency or a new combination of a process using explicit credentials for a specific account?"
    context: "Beyond checking against an allowlist, this question focuses on the frequency and novelty of Logon Type 9 events. By baselining which processes normally use explicit credentials for which accounts, we can detect two types of anomalies: a completely new combination of process and account, or a known combination being used with a frequency that is statistically unusual, suggesting abuse."
    answer_sources:
      - "Windows Event ID 4624"
      - "All Windows Endpoints and Servers, especially developer workstations and administrative servers."
    range: "last 90 days"
    queries:
      - "Baseline the frequency of Process/Account combinations for Logon Type 9 events. Alert on new combinations or frequencies exceeding the 99th percentile."
  - question: "Can anomalous use of explicit credentials (Logon Type 9) be detected by identifying unusual combinations of process, account, workstation, and time?"
    context: "This question employs an unsupervised machine learning model, such as an Isolation Forest, to find anomalous Logon Type 9 events. The model analyzes multiple features simultaneously (process, account, source workstation, time of day) to identify rare combinations that deviate from established patterns of administrative or application behavior, flagging them as potential credential abuse."
    answer_sources:
      - "Windows Event ID 4624"
      - "All Windows Endpoints and Servers, especially developer workstations and administrative servers."
    range: "last 90 days"
    queries:
      - "Use an Isolation Forest model to score Logon Type 9 events based on process, account, workstation, and time. Alert on events flagged as anomalous."
  - question: "Is a single user account logging into an abnormally high number of systems in a short period of time?"
    context: "This question aims to detect rapid lateral movement using a simple, threshold-based rule. When an adversary automates movement through the network using a stolen credential, they can often log into many distinct hosts in a very short time. This rule counts the number of unique source systems a user logs into within a small time window (e.g., 10 minutes) and alerts if it exceeds a static threshold (e.g., 5 hosts)."
    answer_sources:
      - "Windows Event ID 4624"
      - "Zeek conn.log"
      - "Log Aggregation Platform (SIEM)"
      - "Domain Controllers"
      - "Network Flow Data Collectors"
    range: "last 90 days"
    queries:
      - "Count distinct source IPs for user network logons (Type 3) in a 10-minute window. Alert if count > 5."
  - question: "Is a user's network logon activity (number of source systems) exceeding their personal historical baseline or the baseline of their peer group?"
    context: "This is a more advanced, behavioral approach to detecting rapid lateral movement. Instead of a static threshold, it establishes a dynamic baseline for each user's normal logon activity (e.g., number of systems accessed per hour). An alert is triggered if a user's activity exceeds their own historical 95th percentile, making the detection more sensitive and reducing false positives for power users."
    answer_sources:
      - "Windows Event ID 4624"
      - "Zeek conn.log"
      - "Log Aggregation Platform (SIEM)"
      - "Domain Controllers"
      - "Network Flow Data Collectors"
    range: "last 90 days"
    queries:
      - "Baseline the number of distinct source systems per user per hour. Alert if activity exceeds the user's 95th percentile."
  - question: "Does a user's logon pattern indicate a significant shift in behavior, suggesting their account is being used to access an entirely different set of resources?"
    context: "This question uses graph analysis to model relationships between users and the hosts they access. By applying community detection algorithms, we can cluster users and systems into groups based on normal access patterns. A significant behavioral shift, such as an attacker using a stolen account to access systems outside its normal community, would cause the user to be reclassified, triggering an alert."
    answer_sources:
      - "Windows Event ID 4624"
      - "Zeek conn.log"
      - "Log Aggregation Platform (SIEM)"
      - "Domain Controllers"
      - "Network Flow Data Collectors"
    range: "last 90 days"
    queries:
      - "Model user-host logons as a graph. Use community detection to classify users. Alert when a user's logon activity causes them to be reclassified into a new community."
  - question: "Is there evidence of remote service or process creation (e.g., via PsExec) immediately following a network connection to a remote administration pipe?"
    context: "This question provides a high-fidelity detection for lateral movement tools like PsExec by correlating network and host events. It looks for a network connection to a remote administration named pipe (like 'svcctl' or 'psexesvc') followed almost instantly by a new service (Event ID 7045) or process (Event ID 4688) being created on the target host by the source user."
    answer_sources:
      - "Windows Event ID 4688"
      - "Zeek dce_rpc.log"
      - "Zeek smb.log"
      - "Windows Event ID 7045"
      - "Member Servers"
      - "Privileged Access Workstations"
      - "Domain Controllers"
      - "Network Choke Points"
    range: "last 90 days"
    queries:
      - "Correlate network access to 'svcctl' or 'psexesvc' pipes with a subsequent service (7045) or process (4688) creation on the target host within 5 seconds."
  - question: "Is a statistically rare parent-child process relationship being observed, such as a web server process spawning a command shell?"
    context: "Adversaries often exploit a compromised application to execute code, leading to unusual parent-child process relationships. This question focuses on baselining normal process lineages on a host. An alert is triggered when a rare or anomalous relationship is observed (e.g., 'w3wp.exe' spawning 'powershell.exe'), indicating a potential pivot from a compromised application."
    answer_sources:
      - "Windows Event ID 4688"
      - "Member Servers"
      - "Privileged Access Workstations"
      - "Domain Controllers"
      - "Network Choke Points"
    range: "last 90 days"
    queries:
      - "Baseline parent-child process relationships over 30 days. Alert when a statistically rare relationship is observed (e.g., 'w3wp.exe' spawning 'powershell.exe')."
  - question: "Can a sequence of user actions (logon, RPC call, process creation) be identified as malicious by comparing it to models of benign administrative behavior?"
    context: "This question uses a Hidden Markov Model (HMM) to analyze the entire sequence of events within a user session, rather than individual events in isolation. By training the model on benign administrative sessions, it learns the probable sequences of actions. Malicious toolchains (like PsExec) often have a distinct, low-probability sequence that the model can flag as anomalous."
    answer_sources:
      - "Windows Event ID 4688"
      - "Zeek dce_rpc.log"
      - "Zeek smb.log"
      - "Windows Event ID 7045"
      - "Member Servers"
      - "Privileged Access Workstations"
      - "Domain Controllers"
      - "Network Choke Points"
    range: "last 90 days"
    queries:
      - "Use a trained Hidden Markov Model to score user event sequences. Alert on sequences with a low probability of being benign."
  - question: "Is a network logon using the NTLM protocol immediately followed by a process or service creation, indicating a potential Pass-the-Hash attack?"
    context: "This is a classic, high-confidence detection for Pass-the-Hash (PtH). The technique involves an NTLM network logon (Type 3) followed immediately by code execution (process or service creation) on the target. This stateful rule looks for this exact sequence of events, initiated by the same user account within a few seconds, which is a strong indicator of a successful PtH attempt."
    answer_sources:
      - "Windows Event ID 4624"
      - "Windows Event ID 4688"
      - "Windows Event ID 7045"
      - "All Windows Endpoints and Servers, particularly those not configured to disable NTLM."
    range: "last 90 days"
    queries:
      - "On a successful NTLM Logon Type 3 (Event 4624), check for a process (4688) or service (7045) creation by the same user within 2 seconds. Alert if found."
  - question: "Is there a significant increase in the ratio of NTLM to Kerberos authentications for a user or host, suggesting a potential NTLM downgrade attack?"
    context: "In environments where Kerberos is standard, adversaries using PtH must rely on the legacy NTLM protocol. This can lead to a detectable shift in the authentication patterns for a user or host. This question involves baselining the normal ratio of NTLM vs. Kerberos authentications and alerting on a statistically significant increase in NTLM usage, which may indicate an attacker is forcing a protocol downgrade."
    answer_sources:
      - "Windows Event ID 4624"
      - "All Windows Endpoints and Servers, particularly those not configured to disable NTLM."
    range: "last 90 days"
    queries:
      - "Baseline the NTLM vs. Kerberos authentication ratio per user/host. Alert on a statistically significant increase in the NTLM ratio."
  - question: "Can a machine learning model accurately distinguish between benign remote administration and malicious Pass-the-Hash activity?"
    context: "While the correlation rule for PtH is strong, it can sometimes overlap with legitimate administrative activity. This question proposes using a supervised ML model (e.g., a decision tree) to enrich the detection. By training the model on features like time delta between events, user privilege levels, and source/destination context, it can learn to better differentiate between benign and malicious sequences, providing a risk score for improved prioritization."
    answer_sources:
      - "Windows Event ID 4624"
      - "Windows Event ID 4688"
      - "Windows Event ID 7045"
      - "All Windows Endpoints and Servers, particularly those not configured to disable NTLM."
    range: "last 90 days"
    queries:
      - "Use a trained decision tree to classify Logon/Process event pairs. Alert on pairs classified as high-risk for Pass-the-Hash."
  - question: "Is a user account being used to 'hop' sequentially from one host to another across the network?"
    context: "This question aims to detect lateral movement by identifying 'logon chains'. This pattern occurs when an adversary uses a compromised account to log into Host B from Host A, and then from Host B to Host C, and so on. By joining logon events where the destination of one event becomes the source of the next for the same user, we can detect these 'hops' and alert on chains of a certain length."
    answer_sources:
      - "Windows Event ID 4624"
      - "Zeek conn.log"
      - "Log Aggregation Platform (SIEM)"
      - "Domain Controllers"
      - "Network Flow Collectors"
    range: "last 90 days"
    queries:
      - "Join logon events (Type 3) where a destination host becomes a source host for the same user. Alert on chains of 2+ hops within 60 minutes."
  - question: "Is a host exhibiting an anomalous number of incoming or outgoing logons, suggesting it is being used as a pivot point?"
    context: "This question applies graph theory concepts to identify key nodes in lateral movement activity. A compromised host is often used as a 'pivot point' to launch attacks on other systems (high out-degree) or may be a target for multiple compromised accounts (high in-degree). By baselining these metrics for each host, a sudden, anomalous spike can indicate its involvement in a lateral movement campaign."
    answer_sources:
      - "Windows Event ID 4624"
      - "Zeek conn.log"
      - "Log Aggregation Platform (SIEM)"
      - "Domain Controllers"
      - "Network Flow Collectors"
    range: "last 90 days"
    queries:
      - "Calculate the in-degree and out-degree of logon activity per host. Alert when a host's degree exceeds 3 standard deviations from its baseline."
  - question: "Is there an abnormal increase in the number of new lateral movement paths discovered in the network?"
    context: "This question provides a high-level, environmental view of lateral movement. It uses graph pathfinding algorithms to discover all unique multi-hop logon paths across the network daily. A time-series model is then used to forecast the expected number of *new* paths. A significant spike in newly discovered paths suggests a widespread, coordinated lateral movement campaign is underway."
    answer_sources:
      - "Windows Event ID 4624"
      - "Zeek conn.log"
      - "Log Aggregation Platform (SIEM)"
      - "Domain Controllers"
      - "Network Flow Collectors"
    range: "last 90 days"
    queries:
      - "Use BFS to discover logon paths daily. Use a time-series model to forecast the number of new paths. Alert when the actual number significantly exceeds the forecast."
  - question: "Is a highly privileged account logging on from a non-approved workstation?"
    context: "This is a critical, policy-based detection. A 'Tiered Access Model' dictates that highly privileged accounts (e.g., Domain Admins) should only log on from designated, hardened Privileged Access Workstations (PAWs). Any interactive or network logon from a privileged account originating from a non-PAW system is a severe security violation and a strong indicator of compromise."
    answer_sources:
      - "Windows Event ID 4624"
      - "Zeek conn.log"
      - "Domain Controllers"
      - "Privileged Access Workstations (PAWs)"
      - "Tier 0/1 Servers"
      - "Log Aggregation Platform (SIEM)"
    range: "last 90 days"
    queries:
      - "For Domain Admin logons (Type 3 or 10), alert if the source workstation is not on the approved PAW list."
  - question: "Is a privileged account being used in a way that deviates from its established behavioral profile (e.g., from a new location, at an odd time)?"
    context: "This question focuses on detecting misuse of privileged accounts through behavioral baselining. For each privileged account, a profile of normal activity is created, including typical source workstations, destination servers, and time of day. An alert is generated when a logon event occurs that falls outside of this established profile, such as an administrator logging in on a weekend for the first time."
    answer_sources:
      - "Windows Event ID 4624"
      - "Zeek conn.log"
      - "Domain Controllers"
      - "Privileged Access Workstations (PAWs)"
      - "Tier 0/1 Servers"
      - "Log Aggregation Platform (SIEM)"
    range: "last 90 days"
    queries:
      - "Baseline privileged account logons by source, destination, and time. Alert on any logon that falls outside the established 95% profile."
  - question: "Can a machine learning model detect subtle anomalies in privileged account logon activity that might indicate a compromised credential?"
    context: "This question applies an unsupervised anomaly detection model (e.g., One-Class SVM) specifically to privileged account logons. The model creates a complex, multi-dimensional boundary of what constitutes 'normal' behavior for each account. This approach is powerful for detecting novel or subtle attack patterns, as any new logon event that falls outside this learned boundary is flagged as a potential compromise."
    answer_sources:
      - "Windows Event ID 4624"
      - "Zeek conn.log"
      - "Domain Controllers"
      - "Privileged Access Workstations (PAWs)"
      - "Tier 0/1 Servers"
      - "Log Aggregation Platform (SIEM)"
    range: "last 90 days"
    queries:
      - "Score new privileged user logons using a trained One-Class SVM model. Alert on any logon classified as an outlier."