name: T1567.001: Exfiltration to Code Repository
id: a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d
description: |
  This playbook helps to determine if an adversary has exfiltrated data using code repository services. It addresses the primary information requirement: "Has the adversary exfiltrated data using code repository services?". Investigations focus on identifying network connections to suspicious or rare code repositories, detecting process execution sequences indicative of data staging (e.g., archiving followed by a 'git push'), analyzing network traffic for anomalous data volumes, and verifying that connections to code repositories originate from authorized users, hosts, and processes.
type: technique
related:
  - TA0010: Exfiltration
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Are there any outbound network connections to code repository domains or IPs that are listed on a threat intelligence feed?
    context: |
      Adversaries may use code repository services that are known to be malicious or have been flagged as suspicious. This question aims to identify direct connections to such blacklisted infrastructure by correlating network logs with threat intelligence feeds. A match is a high-fidelity indicator of malicious activity.
    answer_sources:
      - Zeek conn.log
      - Zeek ssl.log
      - Zeek dns.log
      - Internet Gateway, DNS Resolvers, and Egress Proxies
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          SEARCH network logs (Zeek dns.log, ssl.log, conn.log)
          EXTRACT destination domains and IPs
          JOIN with threat intelligence feed of code repository indicators
          WHERE destination is in threat feed
          RETURN alert
  - question: Have any hosts connected to statistically rare code repository domains compared to the rest of the enterprise?
    context: |
      While popular code repositories are used widely, adversaries may use lesser-known or newly created services to exfiltrate data. By calculating the access frequency of each code repository domain across the enterprise, we can identify outliers. Connections to domains that are accessed by a very small number of hosts are suspicious and warrant investigation.
    answer_sources:
      - Zeek ssl.log
      - Internet Gateway, DNS Resolvers, and Egress Proxies
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          SEARCH Zeek ssl.log over 24 hours
          CALCULATE frequency of each 'server_name'
          IDENTIFY 'server_name' associated with code repositories
          FLAG 'server_name' requested by < 1st percentile of hosts
  - question: Can we identify potentially malicious code repository domains based on their intrinsic characteristics and history?
    context: |
      This question involves proactively identifying malicious domains before they appear on threat feeds. By using a machine learning model to analyze features like domain name entropy, domain age (from WHOIS), and passive DNS history, we can score the likelihood of a domain being malicious and alert on high-scoring domains associated with code repositories.
    answer_sources:
      - Zeek ssl.log
      - Zeek dns.log
      - WHOIS data
      - Passive DNS data
      - Internet Gateway, DNS Resolvers, and Egress Proxies
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each new code repository domain observed
          GATHER features (string entropy, WHOIS, passive DNS)
          APPLY classification model
          IF maliciousness_score > threshold
          RETURN alert
  - question: Has any host executed a data archiving command followed by a 'git push' command within a short time frame?
    context: |
      Adversaries often compress and stage data into a single archive before exfiltrating it. The sequence of a data compression utility (like 7z.exe, zip.exe) being run, immediately followed by a 'git.exe push' command on the same host, is a strong indicator of data being staged for exfiltration via a code repository.
    answer_sources:
      - Windows Event ID 4688
      - Developer Workstations, Build Servers, and CI/CD Pipeline Servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          SEARCH process creation logs (EID 4688)
          TRIGGER on event with command line containing 'git.exe' and 'push'
          LOOKBACK 5 minutes for process creation of '7z.exe', 'rar.exe', etc. on same host/user
          IF found
          RETURN alert
  - question: Has a sequence of data archiving followed by a 'git push' occurred on a host where this behavior is historically anomalous?
    context: |
      While some legitimate developer workflows might involve archiving and pushing, it may not be common. This question focuses on identifying when this specific sequence of actions deviates from a host's or user's established baseline of behavior. An occurrence that is statistically rare for that entity is more likely to be malicious.
    answer_sources:
      - Windows Event ID 4688
      - Developer Workstations, Build Servers, and CI/CD Pipeline Servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each host
          BASELINE frequency of (archive process -> 'git push') co-occurrence within 5 mins
          MONITOR for new co-occurrences
          IF observed frequency is in bottom 5th percentile of historical data
          RETURN alert
  - question: Can we use a sequence analysis model to detect anomalous process execution chains that involve archiving and a 'git push'?
    context: |
      This question applies advanced sequence analysis models (like RNNs or HMMs) to learn the patterns of normal process activity on endpoints. The model can then assign a probability score to any new sequence of events. A sequence involving data archiving followed by a 'git push' that receives a low probability (high anomaly score) is flagged as a deviation from normal behavior and a potential threat.
    answer_sources:
      - Windows Event ID 4688
      - Developer Workstations, Build Servers, and CI/CD Pipeline Servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          TRAIN sequence model (RNN/HMM) on benign process logs
          FEED new process sequences into the model
          IF model assigns low probability to a sequence containing (archive -> git push)
          RETURN alert
  - question: Have there been any large, single-session data uploads to a code repository with a high outbound-to-inbound data ratio?
    context: |
      Legitimate code pushes are often incremental. A very large, one-way data transfer (e.g., >100MB) where the amount of data sent is significantly greater (e.g., >10x) than the data received is highly anomalous. This pattern suggests a bulk data exfiltration event rather than a typical software development activity.
    answer_sources:
      - Zeek conn.log
      - Internet Gateway and Core Network Taps
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          SEARCH network connection logs (Zeek conn.log) to known code repos
          WHERE 'orig_bytes' > 100MB AND ('orig_bytes' / 'resp_bytes') > 10
          RETURN alert
  - question: Has any host's daily outbound data volume to code repositories significantly exceeded its historical baseline?
    context: |
      This question seeks to identify volumetric anomalies. By establishing a 30-day rolling baseline of the total daily data a host sends to code repositories, we can detect sudden spikes. A day where the data volume exceeds the historical average by a significant margin (e.g., 3 standard deviations) is a strong indicator of an unusual, and potentially malicious, data transfer.
    answer_sources:
      - Zeek conn.log
      - Internet Gateway and Core Network Taps
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each source IP
          CALCULATE 30-day baseline (mean, stddev) of daily 'orig_bytes' to code repos
          MONITOR current day's total 'orig_bytes'
          IF current_volume > (mean + 3 * stddev)
          RETURN alert
  - question: Does the observed outbound data volume to code repositories for any host significantly deviate from what a time series model would predict?
    context: |
      This is a more sophisticated approach to detecting volumetric anomalies. A time series forecasting model (like ARIMA) can be used to predict the expected range of outbound data for a host. If the actual observed data volume falls significantly outside the model's predicted confidence interval, it signals a statistically significant anomaly that warrants investigation.
    answer_sources:
      - Zeek conn.log
      - Internet Gateway and Core Network Taps
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each host
          TRAIN time series model (e.g., ARIMA) on historical outbound volume
          FORECAST expected volume range for current period
          IF observed_volume > forecasted_upper_bound
          RETURN alert
  - question: Has a user or host not authorized for development activity initiated a connection to an external code repository?
    context: |
      Access to external services like GitHub should be controlled based on job function. A connection to a code repository from a user in a non-technical group (e.g., Finance, HR) or from a server that is not part of the CI/CD pipeline is highly suspicious. This indicates a potential account compromise or insider threat.
    answer_sources:
      - Zeek conn.log
      - Windows Event ID 4624
      - Windows Event ID 4688
      - Domain Controllers, Endpoint Devices (All Departments), and Identity and Access Management (IAM) Systems
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          MAINTAIN allow-list of AD groups authorized for code repo access
          CORRELATE network logs (destination) with logon events (user) and AD group membership
          IF user_group is NOT in allow-list
          RETURN alert
  - question: Has any user's network activity shown an anomalous increase in the variety of services accessed, specifically involving a new connection to a code repository?
    context: |
      Users tend to access a relatively stable set of online services for their job. A sudden increase in the diversity (Shannon entropy) of services accessed, especially when one of the new services is a code repository, can indicate that the user's account has been compromised and is being used for reconnaissance or exfiltration.
    answer_sources:
      - Zeek conn.log
      - Zeek ssl.log
      - Windows Event ID 4624
      - Windows Event ID 4688
      - Domain Controllers, Endpoint Devices (All Departments), and Identity and Access Management (IAM) Systems
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each user
          CALCULATE 30-day baseline for daily Shannon entropy of 'server_name' accessed
          IF current_day_entropy > (baseline + 2 * stddev) AND new 'server_name' is a code repo
          RETURN alert
  - question: Have any users whose network behavior typically clusters with non-technical groups initiated connections to code repositories?
    context: |
      This question uses unsupervised machine learning to group users based on their overall network behavior patterns (e.g., sites visited, data volumes). An alert is triggered if a user who is behaviorally clustered with, for example, the 'Sales' group suddenly initiates a connection to a code repository, flagging them as a cross-cluster anomaly.
    answer_sources:
      - Zeek conn.log
      - Windows Event ID 4624
      - Windows Event ID 4688
      - Domain Controllers, Endpoint Devices (All Departments), and Identity and Access Management (IAM) Systems
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          CLUSTER users based on network activity features (e.g., K-Means)
          IDENTIFY non-technical clusters
          IF a user in a non-technical cluster connects to a code repository
          RETURN alert
  - question: Has a non-developer process, such as a LOLBin (Living Off the Land Binary), initiated a network connection to a known code repository?
    context: |
      Legitimate connections to code repositories should originate from approved developer tools like 'git.exe' or an IDE. When a native Windows binary that can be abused by adversaries (e.g., 'powershell.exe', 'cscript.exe', 'rundll32.exe') makes such a connection, it is a strong indication that it is being used to bypass defenses for data exfiltration.
    answer_sources:
      - Windows Event ID 5156
      - Windows Event ID 4688
      - All Endpoint Devices and Servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          SEARCH network connection creation logs (EID 5156)
          WHERE 'Application' is in LOLBin list (powershell.exe, etc.)
          AND 'DestAddress' is a known code repository IP
          RETURN alert
  - question: Has a process on a host connected to a code repository for the first time?
    context: |
      This question relies on baselining normal process-to-destination network behavior on each host. Any new, never-before-seen pairing of a process connecting to a code repository IP is flagged. This can catch not only LOLBins but also legitimate developer tools that have been compromised or are being used in an unusual way on a particular machine.
    answer_sources:
      - Windows Event ID 5156
      - Windows Event ID 4688
      - All Endpoint Devices and Servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each host
          CREATE baseline of (Process Name, Destination IP) pairs over 30 days
          ALERT on any new pair where Destination IP is a code repository
          AND Process Name is not on a pre-approved developer tool list
  - question: Can we use a machine learning model to identify network connections from a host that are anomalous, specifically when they are directed to a code repository?
    context: |
      This question describes an advanced detection method where a model (like a one-class SVM) is trained to understand the boundary of 'normal' network connection behavior for each host. Any new connection that falls outside this learned boundary is classified as an anomaly. The alert is prioritized if the anomalous connection's destination is a code repository.
    answer_sources:
      - Windows Event ID 5156
      - Windows Event ID 4688
      - All Endpoint Devices and Servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each host
          TRAIN one-class SVM on features from normal network connection logs (EID 5156)
          CLASSIFY new connections using the model
          IF a connection is classified as an anomaly AND its destination is a code repo
          RETURN alert