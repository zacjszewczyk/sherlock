name: T1213.002: Data from Information Repositories: Sharepoint
id: 5a8a1b9e-6b0c-4c7d-8e5f-9a3b2c1d0e4f
description: This playbook focuses on detecting adversary collection of sensitive information from internal SharePoint repositories. It identifies anomalous access to documents containing sensitive keywords, the use of reconnaissance tools, statistically unusual volumes of file access, abuse of privileged accounts, and suspicious network activity following SharePoint access, such as data staging or exfiltration.
type: technique
related:
- TA0009: Collection
contributors:
- Zachary Szewczyk
- Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
- question: Are users without proper authorization accessing SharePoint documents that match a watchlist of sensitive keywords?
  context: This question aims to detect direct access to sensitive information by unauthorized personnel. By maintaining a list of keywords like 'password' or 'API_key' and cross-referencing access events with pre-approved Active Directory groups, we can create high-fidelity alerts for potential data theft. This is a direct method to catch adversaries targeting crown jewel data.
  answer_sources:
  - SharePoint Audit Logs (AuditData.Read)
  - Windows Event ID 4624
  - Zeek conn.log
  - SharePoint Farm Servers, Domain Controllers, Internet Gateway/VPN Concentrators, User Workstations
  range: last 90 days
  queries:
  - pseudocode: SEARCH SharePoint audit logs WHERE action is 'read' AND document_metadata MATCHES sensitive_keyword_watchlist AND user NOT IN approved_ad_group.
- question: Is any user accessing an anomalously high number of sensitive SharePoint documents compared to their own baseline or their peer group's activity?
  context: This question focuses on identifying unusual behavior from an individual user, even if they have some level of authorization. Adversaries often collect data in bulk, which deviates from normal, targeted access. By baselining a user's typical interaction with sensitive files and comparing it to their current activity and that of their peers, we can spot statistical outliers that may indicate malicious collection.
  answer_sources:
  - SharePoint Audit Logs (AuditData.Read)
  - Windows Event ID 4624
  - Zeek conn.log
  - SharePoint Farm Servers, Domain Controllers, Internet Gateway/VPN Concentrators, User Workstations
  range: last 90 days
  queries:
  - pseudocode: CALCULATE 30-day baseline (mean, stddev) of sensitive_doc_access per user. ALERT if daily_count > (mean + 3*stddev) OR daily_count > 95th_percentile_of_peer_group.
- question: Can machine learning classify user access to sensitive SharePoint documents as 'benign' or 'suspicious' in real-time?
  context: This question proposes a more advanced, context-aware detection method. Simple rules can generate false positives. A machine learning model can consider multiple features simultaneously (user role, IP reputation, time of day, etc.) to make a more nuanced decision. By training it on known good and bad examples, it can identify suspicious access patterns that might otherwise be missed.
  answer_sources:
  - SharePoint Audit Logs (AuditData.Read)
  - Windows Event ID 4624
  - Zeek conn.log
  - SharePoint Farm Servers, Domain Controllers, Internet Gateway/VPN Concentrators, User Workstations
  range: last 90 days
  queries:
  - pseudocode: INPUT user_role, source_ip_geo, time_of_day, access_frequency INTO classification_model. ALERT if prediction is 'suspicious' with high probability.
- question: Is there evidence of known SharePoint reconnaissance or enumeration tools being used in our environment?
  context: This question aims to detect the preparatory phase of an attack. Before exfiltrating data, adversaries often use specialized tools to map out the SharePoint environment. Detecting the unique signatures of these tools (e.g., specific User-Agents, API call patterns, or PowerShell cmdlets) allows for early-stage detection before significant data loss occurs.
  answer_sources:
  - Zeek http.log
  - Windows Event ID 4104
  - SharePoint Web Front-End Servers, User Workstations, Network Egress/Ingress Points
  range: last 90 days
  queries:
  - pseudocode: SEARCH http_logs for user_agent OR uri MATCHES regex(SharePointMapper_patterns). SEARCH powershell_logs for cmdlets LIKE 'Get-SPOSite' from non-admin_users.
- question: Are any source IPs generating SharePoint API requests with unusually high randomness, potentially indicating scanning or fuzzing activity?
  context: Automated scanning tools often generate randomized or programmatic URI parameters, which have a higher entropy (randomness) than human-generated traffic. By calculating the entropy of API requests from a specific IP over a short window and comparing it to a baseline, we can detect this automated behavior, which is a strong indicator of reconnaissance.
  answer_sources:
  - Zeek http.log
  - Windows Event ID 4104
  - SharePoint Web Front-End Servers, User Workstations, Network Egress/Ingress Points
  range: last 90 days
  queries:
  - pseudocode: CALCULATE shannon_entropy of URI_parameters per source_ip in 5-min windows. ALERT if entropy > (baseline_mean + 3*stddev).
- question: Are users or source IPs making sequences or volumes of SharePoint API calls that are anomalous compared to historical patterns?
  context: This question uses a time-series model to understand the rhythm of API interactions. An adversary's automated script will likely have a different cadence and sequence of API calls than a normal user. An LSTM Autoencoder can learn the normal sequences and flag sessions that deviate significantly, catching sophisticated enumeration attempts that might evade simple signature-based rules.
  answer_sources:
  - Zeek http.log
  - Windows Event ID 4104
  - SharePoint Web Front-End Servers, User Workstations, Network Egress/Ingress Points
  range: last 90 days
  queries:
  - pseudocode: INPUT sequence of API_calls_per_user INTO LSTM_autoencoder. ALERT if reconstruction_error > threshold.
- question: Has any user account accessed an egregious number of unique SharePoint files in a short time frame, triggering a high-threshold tripwire?
  context: This question establishes a simple, high-confidence rule to catch the most blatant "smash and grab" data collection attempts. A hard threshold (e.g., 1,000 unique files in an hour) is an unambiguous indicator of malicious activity and serves as a critical, low-false-positive alert for immediate response.
  answer_sources:
  - SharePoint Audit Logs (AuditData.Read)
  - Active Directory Logs
  - SharePoint Farm Servers, Domain Controllers
  range: last 90 days
  queries:
  - pseudocode: COUNT unique document_urls per user per hour. ALERT if count > 1000.
- question: Is any user accessing a statistically significant number of unique SharePoint files compared to their own history and their departmental peers?
  context: This question refines detection by using personalized, dynamic thresholds. By comparing a user's activity to their own past behavior (personal baseline) and to their colleagues (peer group baseline), we can detect subtler anomalies. This helps identify an adversary using a compromised account that is suddenly behaving differently from both its own history and its peers.
  answer_sources:
  - SharePoint Audit Logs (AuditData.Read)
  - Active Directory Logs
  - SharePoint Farm Servers, Domain Controllers
  range: last 90 days
  queries:
  - pseudocode: CALCULATE 30-day baseline (mean, stddev) of unique_docs_per_hour per user. ALERT if hourly_count > (mean + 3*stddev) AND hourly_count > 99th_percentile_of_peer_group.
- question: Can users be clustered based on their SharePoint access patterns to identify outliers who may be engaged in data collection?
  context: This question proposes an unsupervised machine learning approach to find "unknown unknowns." By clustering users based on features like the number and diversity of files they access, normal users will form dense clusters. Outliers who fall outside these clusters represent anomalous behavior that warrants investigation, which can detect novel attack patterns that don't fit pre-defined rules.
  answer_sources:
  - SharePoint Audit Logs (AuditData.Read)
  - Active Directory Logs
  - SharePoint Farm Servers, Domain Controllers
  range: last 90 days
  queries:
  - pseudocode: INPUT features (unique_files_per_hour, site_diversity, off_hours_ratio) into DBSCAN_model. INVESTIGATE users classified as noise/outliers.
- question: Is any highly privileged Active Directory account (e.g., Domain Admin) accessing SharePoint resources?
  context: This question is based on a strict security policy where privileged accounts have no legitimate reason to access user-facing data repositories like SharePoint. Any such access is a major security violation and a strong indicator of a severe compromise, warranting a high-priority, zero-tolerance alert.
  answer_sources:
  - SharePoint Audit Logs (AuditData.Read)
  - Windows Event ID 4624
  - Active Directory Logs
  - SharePoint Farm Servers, Domain Controllers
  range: last 90 days
  queries:
  - pseudocode: CREATE watchlist of privileged_ad_group_members. ALERT on ANY SharePoint access event where user is in watchlist.
- question: If a privileged account has an approved reason for SharePoint access, is it operating outside of its narrowly defined activity baseline?
  context: This question manages exceptions to the zero-tolerance rule. If a privileged account must access SharePoint for a specific task, that exact behavior should be baselined. Any deviation from this highly constrained, documented activity profile should trigger an alert, indicating potential misuse of the privileged account.
  answer_sources:
  - SharePoint Audit Logs (AuditData.Read)
  - Windows Event ID 4624
  - Active Directory Logs
  - SharePoint Farm Servers, Domain Controllers
  range: last 90 days
  queries:
  - pseudocode: DEFINE narrow baseline for approved privileged access (e.g., specific_doc_path, source_ip). ALERT if access event from privileged user deviates from this baseline.
- question: Can a one-class SVM model, trained only on legitimate privileged access, detect anomalous SharePoint activity from these accounts?
  context: This question proposes using a One-Class Support Vector Machine (SVM) to learn the boundary of "normal" behavior from only legitimate examples. Any access pattern by a privileged account that falls outside this learned boundary is automatically classified as an anomaly, providing a robust and automated way to enforce policy.
  answer_sources:
  - SharePoint Audit Logs (AuditData.Read)
  - Windows Event ID 4624
  - Active Directory Logs
  - SharePoint Farm Servers, Domain Controllers
  range: last 90 days
  queries:
  - pseudocode: TRAIN One-Class SVM on legitimate_admin_access_logs. ALERT if new access by privileged account is classified as anomaly.
- question: Following an alert for sensitive SharePoint document access, is the user's endpoint initiating suspicious network connections to internal file shares or external destinations?
  context: This question correlates SharePoint activity with potential data staging or exfiltration. By linking a sensitive file access alert with subsequent network activity (like an SMB connection to a new file share), we can increase the confidence and priority of the alert, as it shows a potential multi-stage attack in progress.
  answer_sources:
  - SharePoint Audit Logs (AuditData.Read)
  - Zeek conn.log
  - Windows Event ID 5145
  - Zeek dns.log
  - SharePoint Farm Servers, Internal File Servers, User Workstations, Network Core Switches, DNS Servers
  range: last 90 days
  queries:
  - pseudocode: CORRELATE 'sensitive_doc_access' alert with subsequent conn_logs from same source_ip within 30 mins. ESCALATE if destination is new internal share (port 445) or external IP.
- question: After accessing a sensitive SharePoint file, is a user connecting to internal or external network destinations that are new or rare for that user?
  context: This question adds behavioral baselining to correlation. An adversary, having collected data, will likely move it to a staging server or exfiltrate it, often involving connections to hosts the legitimate user has never touched. Detecting this deviation from the user's network baseline post-sensitive-file-access is a strong indicator of malicious intent.
  answer_sources:
  - SharePoint Audit Logs (AuditData.Read)
  - Zeek conn.log
  - Windows Event ID 5145
  - Zeek dns.log
  - SharePoint Farm Servers, Internal File Servers, User Workstations, Network Core Switches, DNS Servers
  range: last 90 days
  queries:
  - pseudocode: BASELINE user's common destination IPs and DNS queries. AFTER sensitive_doc_access, ALERT if user connects to a new/rare IP or queries a new/rare domain.
- question: Can a sequence analysis model detect malicious user action chains, such as 'access sensitive file' followed by 'connect to new internal share'?
  context: This question proposes modeling the entire chain of user actions. A Hidden Markov Model (HMM) can learn the probabilities of transitioning between states (e.g., 'browse SharePoint', 'connect to file share'). An attacker's sequence ('access sensitive file' -> 'connect to new share') would have a low probability under a model trained on normal behavior, generating a high-confidence alert.
  answer_sources:
  - SharePoint Audit Logs (AuditData.Read)
  - Zeek conn.log
  - Windows Event ID 5145
  - Zeek dns.log
  - SharePoint Farm Servers, Internal File Servers, User Workstations, Network Core Switches, DNS Servers
  range: last 90 days
  queries:
  - pseudocode: TRAIN HMM on sequences of user actions. ALERT if observed sequence 'access_sensitive' -> 'connect_new_host' has a low probability.
- question: Is a large data download from SharePoint followed by the execution of data archival utilities on the user's endpoint?
  context: This question looks for the common attacker behavior of "staging" data for exfiltration. After downloading many files, adversaries often compress them into a single archive. This correlation rule links a large download event with the subsequent use of tools like 7-Zip or WinRAR, providing strong evidence of data staging.
  answer_sources:
  - SharePoint Audit Logs (FileDownloaded)
  - Windows Event ID 4688
  - Zeek conn.log
  - SharePoint Farm Servers, User Workstations, Network Egress/Ingress Points
  range: last 90 days
  queries:
  - pseudocode: CORRELATE SharePoint 'FileDownloaded' > 500MB in 1 hour with subsequent process_creation event for '7z.exe' or 'rar.exe' from same user/host within 1 hour.
- question: Is any user downloading a statistically anomalous volume of data from SharePoint compared to their own historical baseline?
  context: This question focuses on detecting bulk data theft by monitoring download volume. It establishes a dynamic baseline for each user's typical daily download amount. A significant spike above this personal baseline (e.g., exceeding the 98th percentile) is a strong indicator that the user (or a compromised account) is performing an unusual bulk data collection.
  answer_sources:
  - SharePoint Audit Logs (FileDownloaded)
  - Windows Event ID 4688
  - Zeek conn.log
  - SharePoint Farm Servers, User Workstations, Network Egress/Ingress Points
  range: last 90 days
  queries:
  - pseudocode: CALCULATE 30-day baseline (mean, stddev, 98th_percentile) of daily_download_volume per user. ALERT if daily_volume > 98th_percentile OR > (mean + 3*stddev).
- question: After accounting for recent SharePoint download activity, is a user's total outbound network traffic significantly higher than predicted by a regression model?
  context: This question attempts to directly link SharePoint downloads to data exfiltration. A regression model can predict a user's normal daily outbound traffic. If an adversary downloads data and then exfiltrates it, the actual outbound traffic will be much higher than the model's prediction, resulting in a large "residual error" and a high-confidence alert.
  answer_sources:
  - SharePoint Audit Logs (FileDownloaded)
  - Windows Event ID 4688
  - Zeek conn.log
  - SharePoint Farm Servers, User Workstations, Network Egress/Ingress Points
  range: last 90 days
  queries:
  - pseudocode: PREDICT expected_outbound_volume using regression_model(user_role, sharepoint_downloads). ALERT if actual_outbound_volume >> predicted_volume.