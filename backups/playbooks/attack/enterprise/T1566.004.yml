name: T1566.004: Spearphishing Voice
id: f8e9a2b1-c3d4-4e5f-8a9b-0c1d2e3f4a5b
description: |
  This playbook helps determine if an adversary has gained initial access to the network via spearphishing voice (vishing). Vishing attacks involve an adversary using a voice call to manipulate a user into taking an action that compromises security. This can include tricking the user into visiting a malicious website, installing an unauthorized remote access tool, running a malicious script, or approving a fraudulent multi-factor authentication (MFA) request. Investigative activities focus on identifying network connections to malicious infrastructure, execution of unauthorized software, use of obfuscated command-line payloads, suspicious sequences of user and system activity, evidence of MFA fatigue attacks, and anomalous outbound network connections that may indicate command and control channels.
type: technique
related:
  - TA0001: Initial Access
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Are endpoints connecting to destination URLs, domains, or IP addresses known to be associated with vishing campaigns?
    context: |
      This query directly checks for connections to known malicious infrastructure identified in high-confidence threat intelligence feeds that specifically track vishing or social engineering campaigns. A match is a high-confidence indicator that a user has been successfully phished and has visited a malicious site as instructed by an attacker.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Zeek http.log
      - Network egress points (e.g., firewalls, web proxies)
      - Corporate DNS resolvers
      - VPN concentrators
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          SEARCH Zeek logs (dns.log, http.log, conn.log) FOR destination (query, host, id.resp_h) IN threat_intel_vishing_list
  - question: Have any endpoints communicated with rare or newly registered domains?
    context: |
      Adversaries often use new or obscure domains for phishing and command and control (C2) to evade reputation-based blocking. This question aims to identify these 'long-tail' domains by analyzing their prevalence across the enterprise. Further enrichment with WHOIS data helps pinpoint domains that are recently registered or have their ownership details hidden, which are common red flags for malicious infrastructure.
    answer_sources:
      - Zeek dns.log
      - Corporate DNS resolvers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          1. CALCULATE frequency of all domains in dns.log over 30 days.
          2. FILTER for domains in bottom 1% prevalence.
          3. ENRICH with WHOIS data.
          4. FLAG domains registered in last 30 days or with privacy protection.
  - question: Are there any non-allow-listed domains with lexical features suggesting malicious intent?
    context: |
      This question leverages machine learning to analyze the structure of domain names themselves. Malicious domains often exhibit specific patterns (e.g., high character entropy, unusual length, phonetic or misspelled brand names) that can be detected by a classification model. This approach helps find suspicious domains that are not yet present on threat intelligence feeds.
    answer_sources:
      - Zeek dns.log
      - Corporate DNS resolvers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          1. SCORE domains from dns.log using a lexical classification model.
          2. FILTER out allow-listed domains.
          3. INVESTIGATE domains with high malicious scores.
  - question: Has a non-approved remote access tool been executed by a process that is not an authorized IT administration tool?
    context: |
      Vishing attackers often trick users into installing and running legitimate remote access tools (e.g., AnyDesk, TeamViewer) for malicious purposes. This question looks for the execution of such tools where the parent process is not a standard software deployment or management tool (like SCCM or Intune), indicating a likely user-initiated, unauthorized installation.
    answer_sources:
      - Windows Event ID 4688
      - User workstations and laptops
      - Virtual Desktop Infrastructure (VDI) instances
      - Help desk operator consoles
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          SEARCH Windows Event ID 4688 WHERE NewProcessName IN unapproved_rat_list AND CreatorProcessName NOT IN admin_tool_allow_list.
  - question: Have any processes been executed that are statistically rare across the enterprise?
    context: |
      Adversary tools or one-off unauthorized software will often have a very low execution count across an entire organization compared to standard business applications. This question uses statistical analysis to find these outliers by calculating the prevalence of every executed process. A process running on a very small percentage of endpoints is a strong candidate for investigation.
    answer_sources:
      - Windows Event ID 4688
      - User workstations and laptops
      - Virtual Desktop Infrastructure (VDI) instances
      - Help desk operator consoles
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          1. CALCULATE prevalence of all NewProcessName from Event ID 4688 over 30 days.
          2. ALERT on processes with prevalence < 1%.
  - question: Are there anomalous clusters of process execution activity that deviate from known benign patterns?
    context: |
      This question uses unsupervised machine learning (clustering) to group process executions based on their characteristics (process name, parent process, command line, user context). The goal is to find small, distinct clusters of activity that do not match normal software behavior or administrative tasks, which could indicate a coordinated malicious action or the presence of a specific adversarial toolset.
    answer_sources:
      - Windows Event ID 4688
      - User workstations and laptops
      - Virtual Desktop Infrastructure (VDI) instances
      - Help desk operator consoles
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          1. CLUSTER Event ID 4688 data using features (process name, parent, user, etc.).
          2. INVESTIGATE small, dense clusters not matching known benign patterns.
  - question: Have any command-line interpreters been executed with obfuscated arguments or commands related to remote file downloads or security tampering?
    context: |
      Adversaries frequently use PowerShell and Command Prompt to execute malicious code. To evade signature-based detection, they often obfuscate their commands (e.g., using Base64) or use built-in functions to download more tools or disable security controls. This question uses pattern matching (regex) to find these specific, high-risk indicators in command-line logs.
    answer_sources:
      - Windows Event ID 4688
      - Windows PowerShell Event ID 4104
      - User workstations
      - Laptops
      - Application servers
      - Domain Controllers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          SEARCH Event ID 4688/4104 command lines/script blocks FOR regex patterns like '-enc', 'DownloadString', 'IEX', 'Set-MpPreference', etc.
  - question: Have there been any command-line executions with unusually high entropy or length?
    context: |
      Obfuscated commands are often more random-looking (higher entropy) and significantly longer than typical administrative commands. This question applies statistical methods to identify command-line outliers based on their information content (entropy) and length, which can effectively surface obfuscated payloads without relying on specific signatures.
    answer_sources:
      - Windows Event ID 4688
      - User workstations
      - Laptops
      - Application servers
      - Domain Controllers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          1. CALCULATE entropy and length for all cmd/powershell command lines.
          2. ESTABLISH baseline distribution.
          3. FLAG commands with entropy > 99th percentile or length > 3 standard deviations from user average.
  - question: Have any PowerShell script blocks been executed that are classified as malicious by a machine learning model?
    context: |
      This question involves a supervised machine learning approach. By training a model on known malicious and benign PowerShell scripts, it can learn to identify malicious behavior based on a wide range of features (keywords, character frequencies, function calls). This allows for the detection of novel or complex malicious scripts that might evade simpler signature- or rule-based methods.
    answer_sources:
      - Windows PowerShell Event ID 4104
      - User workstations
      - Laptops
      - Application servers
      - Domain Controllers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          1. SCORE PowerShell script blocks (Event ID 4104) using a trained classification model.
          2. ALERT on scripts classified as malicious with high confidence.
  - question: Has a suspicious sequence of events occurred, involving a web request to a risky domain, a file download, and the execution of that file from a user directory?
    context: |
      This question describes a classic phishing download-and-execute chain. A user is lured to a site, downloads a malicious file (like an executable or zip), and then runs it from their Downloads folder. By correlating network and endpoint events in a tight time window (e.g., 5 minutes), this rule can precisely detect this common attack pattern with high fidelity.
    answer_sources:
      - Zeek http.log
      - Zeek files.log
      - Windows Event ID 4688
      - User workstations and laptops
      - Network egress points (e.g., web proxies)
      - Cloud storage sync folders
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          CORRELATE (by host, within 5 mins):
          1. Zeek http.log to suspicious domain.
          2. Zeek files.log for exe/zip download.
          3. Event ID 4688 for process execution from user path matching downloaded file.
  - question: Have any statistically rare process chains been observed, such as a browser spawning an unexpected child process?
    context: |
      Normal user activity follows predictable process patterns (e.g., outlook.exe spawns winword.exe). Adversarial activity often creates unusual parent-child relationships, such as a browser (chrome.exe) directly spawning a command shell (cmd.exe) or a downloaded executable. This question seeks to identify these anomalous process lineages by looking for statistically rare sequences.
    answer_sources:
      - Windows Event ID 4688
      - User workstations and laptops
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          1. ANALYZE parent-child process relationships from Event ID 4688.
          2. FLAG rare sequences (e.g., chrome.exe -> downloaded_file.exe) with prevalence < 0.1%.
  - question: Has any user exhibited a sequence of actions (web requests, file downloads, process executions) that is anomalous compared to their own established behavior?
    context: |
      This question employs advanced user entity behavior analytics (UEBA). A sequence analysis model (like an LSTM) learns a user's normal "rhythm" of activity. It can then detect when a new sequence of events deviates significantly from this learned pattern, flagging it as an anomaly that could indicate the user is acting under duress from a vishing attacker.
    answer_sources:
      - Zeek http.log
      - Zeek files.log
      - Windows Event ID 4688
      - User workstations and laptops
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          1. MODEL sequences of user events (web, file, process) using an LSTM.
          2. SCORE new event sequences for anomaly against the user's baseline.
          3. ALERT on high anomaly scores.
  - question: Has any user account experienced a burst of failed MFA challenges immediately followed by a successful authentication?
    context: |
      This is the signature of an "MFA fatigue" or "push bombing" attack. The adversary, having stolen credentials, spams the user with MFA push notifications, hoping the user will accidentally approve one to stop the notifications. This rule specifically looks for that pattern of multiple denials or timeouts followed by a success in a short time window.
    answer_sources:
      - Azure AD Sign-in logs
      - Duo Authentication logs
      - Okta System Log
      - Windows Event ID 4624
      - Cloud identity provider platforms (e.g., Azure AD, Okta)
      - VPN concentrators
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          CORRELATE (by user, within 2 mins):
          1. COUNT(MFA denied/timeout) > 5.
          2. FOLLOWED BY 1 event of MFA success.
  - question: Has there been an anomalous spike in the volume of MFA prompts for a user, or did a successful login occur from a geographically unusual location?
    context: |
      This question uses statistical baselining to detect MFA abuse. It identifies unusual spikes (e.g., >3 standard deviations from the mean) in the number of MFA requests for a user, which could indicate a fatigue attack in progress. It adds geographic context by flagging successful logins that occur after such a spike from a location that is new or rare for that user.
    answer_sources:
      - Azure AD Sign-in logs
      - Duo Authentication logs
      - Okta System Log
      - Cloud identity provider platforms (e.g., Azure AD, Okta)
      - VPN concentrators
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          1. DETECT MFA prompt volume spikes for a user (>3 standard deviations from baseline).
          2. IF spike detected, CHECK if subsequent successful login IP is from a new/rare country/ASN for that user.
  - question: Has a user's MFA activity pattern deviated significantly from their normal, learned authentication rhythm?
    context: |
      This question uses time-series analysis to model the typical timing and frequency of a user's MFA events (e.g., more prompts during business hours, fewer on weekends). The model can then identify any sequence of MFA events that is a statistical outlier compared to the user's predicted normal rhythm, providing a more nuanced way to detect MFA fatigue attacks that may not be a simple burst.
    answer_sources:
      - Azure AD Sign-in logs
      - Duo Authentication logs
      - Okta System Log
      - Cloud identity provider platforms (e.g., Azure AD, Okta)
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          1. MODEL MFA event time-series per user (e.g., with SARIMA).
          2. ALERT on event sequences that are statistical outliers from the model's prediction.
  - question: Has any endpoint established a long-lived or high-volume connection over a non-standard port to a new external IP address?
    context: |
      After gaining access, adversaries often establish a command and control (C2) channel. These C2 connections can be identified by looking for unusual characteristics, such as being very long-lasting (>1 hour), transferring large amounts of data, using non-standard ports, and connecting to an IP address the organization has never communicated with before.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Zeek ssl.log
      - Network egress points (e.g., firewalls, web proxies)
      - User workstations and laptops
      - Server subnets
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          SEARCH Zeek conn.log WHERE destination_ip is new (last 90 days) AND destination_port NOT IN {80, 443, 53} AND duration > 3600s.
  - question: Are there any outbound connections that exceed the normal baseline for duration, data volume, or TLS fingerprint rarity for a specific host?
    context: |
      This question refines C2 detection by creating host-specific baselines. What's normal for a server might be anomalous for a workstation. By comparing new connections to a host's own history, we can more accurately detect outliers in connection duration and data volume. It also adds analysis of the TLS client fingerprint (JA3/JA3S), as malware often uses unique TLS libraries, resulting in a rare fingerprint.
    answer_sources:
      - Zeek conn.log
      - Zeek ssl.log
      - Network egress points (e.g., firewalls, web proxies)
      - User workstations and laptops
      - Server subnets
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          1. BASELINE connection duration/volume per host.
          2. ALERT on connections > 99th percentile.
          3. FLAG connections with JA3/JA3S hash seen in <0.01% of sessions.
  - question: Have any outbound network connections been identified as anomalous by an autoencoder model trained on normal connection data?
    context: |
      This question describes using an autoencoder, a type of neural network, for anomaly detection. The model is trained only on normal network connection data and learns to reconstruct it accurately. When a malicious or anomalous connection (e.g., C2) is fed to the model, it will be unable to reconstruct it well, resulting in a high "reconstruction error." This error score is a strong indicator of anomalous network behavior.
    answer_sources:
      - Zeek conn.log
      - Network egress points (e.g., firewalls, web proxies)
      - User workstations and laptops
      - Server subnets
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          1. PROCESS all new network connections through a trained autoencoder model.
          2. INVESTIGATE connections with a high reconstruction error score.