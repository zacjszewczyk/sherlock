name: T1637: Dynamic Resolution
id: 1e9a3c1f-4d6b-4f8a-9c7e-8a6f3b2d1c0a
description: This playbook helps investigate whether an adversary is maintaining command and control over a compromised mobile device using dynamic resolution techniques. It focuses on identifying DNS queries for algorithmically generated domains, network connections to recently registered and unpopular domains exhibiting C2 beaconing patterns, and the use of fast-flux DNS where a single domain rapidly resolves to many different IP addresses.
type: technique
related:
  - TA0037: Command and Control
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Are mobile devices querying domains known to be associated with Domain Generation Algorithms (DGAs) based on threat intelligence feeds?
    context: This question aims to detect the most straightforward indicator of DGA-based C2, a direct match against a known malicious domain. A positive match is a high-fidelity signal that a device is compromised and attempting to contact a C2 server whose domain was generated algorithmically.
    answer_sources:
      - Zeek dns.log
      - Mobile Device Management (MDM) DNS logs
      - Corporate Wi-Fi gateways
      - VPN concentrators
      - Guest network segments
    range: last 90 days
    queries:
      - search: pseudocode
        query: JOIN (DNS logs from mobile IP ranges) WITH (Threat intelligence feed of known DGA domains) ON (DNS query name == DGA domain). RETURN matches.
  - question: Are mobile devices querying domains that statistically appear to be algorithmically generated, based on high entropy and a high ratio of numbers to letters?
    context: Since threat intelligence can lag, this question seeks to proactively identify previously unseen DGA domains by analyzing their structural characteristics. Legitimate domains typically have lower entropy (are more 'word-like') and fewer random numbers. Domains that are outliers on both metrics are highly suspect.
    answer_sources:
      - Zeek dns.log
      - Mobile Device Management (MDM) DNS logs
      - DHCP logs
      - VPN logs
      - Corporate Wi-Fi gateways
      - VPN concentrators
      - Guest network segments
    range: last 90 days
    queries:
      - search: pseudocode
        query: FOR each domain in DNS logs from mobile IPs, CALCULATE Shannon entropy and numeric-to-alpha ratio. COMPARE to 30-day baseline. ALERT if both metrics > 98th percentile.
  - question: Can a machine learning model identify DNS queries from mobile devices that are likely DGA-based, even if they don't trigger simpler statistical rules?
    context: This question employs a more sophisticated, multi-faceted approach to DGA detection. A machine learning model can learn complex patterns from features like domain length, entropy, n-gram frequency, and character ratios to identify suspicious domains with higher accuracy and fewer false positives than single-metric checks.
    answer_sources:
      - Zeek dns.log
      - Mobile Device Management (MDM) DNS logs
      - Public DGA lists
      - High-confidence allow lists (e.g., Tranco Top 1M)
      - Corporate Wi-Fi gateways
      - VPN concentrators
      - Guest network segments
    range: last 90 days
    queries:
      - search: pseudocode
        query: APPLY pre-trained random forest classifier to DNS queries from mobile IPs. EXTRACT features (length, entropy, n-gram, etc.). ALERT if model prediction is 'DGA' with confidence > 0.90.
  - question: Are mobile devices communicating with domains or IP addresses that are on a blocklist of known command and control infrastructure?
    context: This question focuses on detecting connections to known-bad infrastructure. A match against a threat intelligence blocklist provides a strong, direct signal that a mobile device is communicating with an adversary's C2 server, warranting an immediate critical alert.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - Threat Intelligence Platform
      - External WHOIS Data
      - External Domain Prevalence Lists
      - Corporate Wi-Fi gateways
      - VPN concentrators
      - Guest network segments
      - External WHOIS services
    range: last 90 days
    queries:
      - search: pseudocode
        query: FOR each domain/IP in DNS/connection logs from mobile devices, QUERY threat intelligence API. ALERT on match.
  - question: Are mobile devices exhibiting beaconing behavior (low data volume, regular timing) to high-risk domains that are both recently registered and unpopular?
    context: Adversaries often use newly registered, obscure domains for C2. This question combines domain reputation (age, popularity) with network traffic patterns. Legitimate traffic is often bursty and high-volume, whereas C2 beaconing is typically low-volume and highly periodic. Identifying this combination helps uncover covert C2 channels.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - External WHOIS Data
      - External Domain Prevalence Lists (e.g., Tranco)
      - Corporate Wi-Fi gateways
      - VPN concentrators
      - Guest network segments
      - External WHOIS services
    range: last 90 days
    queries:
      - search: pseudocode
        query: 1. SCORE domains by registration date and popularity. 2. FOR high-risk domains, analyze connection logs for source IPs. 3. FLAG IPs with low data volume and regular connection intervals compared to baselines.
  - question: Can periodic C2 beaconing from mobile devices to high-risk domains be mathematically confirmed using autocorrelation analysis?
    context: This question provides a more rigorous method for confirming the 'periodicity' of network connections. An Autocorrelation Function (ACF) can mathematically prove if a time series of events (like connection attempts) is repeating at a regular interval. A strong peak in the ACF plot is a definitive indicator of automated, periodic beaconing.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - External WHOIS Data
      - External Domain Prevalence Lists
      - Corporate Wi-Fi gateways
      - VPN concentrators
      - Guest network segments
      - External WHOIS services
    range: last 90 days
    queries:
      - search: pseudocode
        query: FOR traffic to high-risk domains, CREATE time series of connection events per source IP. APPLY Autocorrelation Function. ALERT if ACF plot shows a distinct repeating peak at a non-zero lag.
  - question: Are mobile devices querying domains associated with known dynamic DNS (DDNS) providers?
    context: While DDNS has legitimate uses, adversaries frequently abuse these services to rapidly change the IP address of their C2 servers, making them harder to block. Flagging queries to known DDNS providers allows for proactive monitoring of potentially suspicious activity.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - External IP to ASN Database
      - Corporate Wi-Fi gateways
      - VPN concentrators
      - Guest network segments
      - DNS resolution infrastructure
    range: last 90 days
    queries:
      - search: pseudocode
        query: MATCH DNS queries from mobile IPs against a regex list of known DDNS provider domains (e.g., *.ddns.net, *.no-ip.com). ALERT on match.
  - question: Are any domains being queried by mobile devices exhibiting fast-flux characteristics, such as resolving to a high number of unique IPs and ASNs within a short time frame with a low TTL?
    context: This question targets the core of fast-flux DNS. An adversary's C2 infrastructure will rapidly cycle through a large number of compromised bots (flux agents) as resolvers. This results in a single domain name resolving to many different IPs across diverse networks (ASNs) in a short period, coupled with a low Time-To-Live (TTL) to ensure clients must re-query frequently. Detecting this combination is a strong indicator of a sophisticated C2 network.
    answer_sources:
      - Zeek dns.log
      - External IP to ASN Database
      - Corporate Wi-Fi gateways
      - VPN concentrators
      - Guest network segments
      - DNS resolution infrastructure
    range: last 90 days
    queries:
      - search: pseudocode
        query: OVER 1-hour windows, GROUP DNS logs by domain. COUNT unique IPs and ASNs. ALERT if counts for a domain exceed 99th percentile and average TTL < 300s.
  - question: Can clustering algorithms identify mobile devices making connections to a large, diverse set of destinations, which could indicate communication with a fast-flux network?
    context: This question looks at the client-side evidence of fast-flux. A device communicating with a fast-flux network will, over a short period, connect to many different IP addresses and ASNs that are all associated with the same C2 domain. Using a clustering algorithm like DBSCAN on connection logs can automatically group these disparate connections, revealing a pattern of activity that would be difficult to spot manually.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - External IP to ASN Database
      - Corporate Wi-Fi gateways
      - VPN concentrators
      - Guest network segments
      - DNS resolution infrastructure
    range: last 90 days
    queries:
      - search: pseudocode
        query: FOR each mobile IP, apply DBSCAN clustering to its outbound connections over 15 mins (features dest IP, dest port, dest ASN). ALERT if a large cluster with high diversity of IPs/ASNs is found.