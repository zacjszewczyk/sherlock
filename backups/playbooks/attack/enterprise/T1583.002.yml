name: T1583.002: DNS Server
id: c8a2b53f-7e94-4d2a-8b1c-3d9f0e6a7b4d
description: This playbook helps investigate whether an adversary is developing DNS infrastructure for their operations. It focuses on detecting suspicious DNS activity, such as queries for domains or IPs listed on threat intelligence feeds, queries for look-alike or homoglyph domains mimicking corporate assets, early resolution of newly registered domains with low TTLs, and multiple new domains pointing to the same IP address.
type: technique
related:
  - TA0042: Resource Development
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Are internal hosts querying domains or resolving to IP addresses that appear on high-confidence threat intelligence feeds?
    context: This question seeks to identify direct communication with known malicious infrastructure. Matching DNS queries or resolved IPs against a curated list of high-confidence indicators is a fundamental step in detecting adversary activity. A positive match provides a strong signal that an internal host may be compromised or attempting to connect to a command and control (C2) server, a phishing site, or other malicious resource.
    answer_sources:
      - Zeek dns.log
      - Windows Event ID 260
      - Network Egress Points
      - Enterprise DNS Resolvers
      - High-confidence threat intelligence feeds
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: FOR each DNS log entry, IF query_domain IN malicious_domain_feed OR resolved_ip IN malicious_ip_feed, THEN CREATE alert.
  - question: For domains matching a threat feed, is the query activity widespread or targeted to a small number of internal hosts?
    context: This question helps prioritize alerts by differentiating between widespread, possibly benign activity (like a popular but recently blocklisted CDN) and highly targeted activity. A malicious domain queried by only a few hosts is more likely to be part of a targeted attack, such as C2 communication from specific compromised systems, and warrants a more urgent investigation.
    answer_sources:
      - Zeek dns.log
      - Windows Event ID 260
      - Network Egress Points
      - Enterprise DNS Resolvers
      - High-confidence threat intelligence feeds
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: FOR each domain matching a threat feed, COUNT unique source_ips. IF count < 5th_percentile_of_all_domain_queries, THEN ESCALATE priority.
  - question: Can machine learning be used to automatically assess the confidence of a threat intelligence match and prioritize alerts?
    context: This question explores using machine learning to add a layer of automated triage. By training a model on features from both the threat intelligence (e.g., source reputation) and internal network data (e.g., query frequency), the system can learn to distinguish between high-fidelity alerts and those that may be false positives or originate from lower-quality feeds, thus focusing analyst attention on the most critical threats.
    answer_sources:
      - Zeek dns.log
      - Windows Event ID 260
      - Network Egress Points
      - Enterprise DNS Resolvers
      - High-confidence threat intelligence feeds
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: FOR each domain matching a threat feed, EXTRACT features (feed_reputation, query_frequency, etc.). PREDICT classification ('High-Confidence' or 'Vetting Required') using trained ML model. ROUTE alert based on prediction.
  - question: Are internal hosts querying domains that are typosquatted or homoglyph versions of our corporate, partner, or high-value brand domains?
    context: This question aims to detect phishing or brand impersonation attacks where adversaries register domains that look very similar to legitimate ones to trick users. By pre-generating and monitoring for these variations, we can proactively identify potential threats before users fall victim.
    answer_sources:
      - Zeek dns.log
      - Network Egress Points
      - Endpoint Devices
      - List of monitored domains
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: PRE-GENERATE typosquatted_domain_list from monitored_domains. FOR each DNS log entry, IF query_domain IN typosquatted_domain_list, THEN CREATE alert.
  - question: Can we statistically identify suspicious domains by combining similarity metrics (Levenshtein distance) with randomness metrics (Shannon entropy)?
    context: This question looks for domains that are not just similar to a known brand but also exhibit characteristics of randomness, which can be an indicator of maliciousness (e.g., algorithmically generated subdomains). A domain that is very close to a legitimate one but also has a high entropy score is more suspicious than a simple typo and should be investigated with higher priority.
    answer_sources:
      - Zeek dns.log
      - Network Egress Points
      - Endpoint Devices
      - List of monitored domains
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: FOR each queried domain, CALCULATE Levenshtein distance to monitored_domains. IF distance <= 2, THEN CALCULATE Shannon entropy. IF entropy > 90th_percentile, THEN INCREASE risk score and alert.
  - question: Can machine learning help identify clusters of algorithmically generated domains (DGAs) that are syntactically similar to each other but not to known-good domains?
    context: This question addresses the detection of Domain Generation Algorithms (DGAs), often used by malware for C2 communication. By clustering domains based on their character structure and then using anomaly detection, we can uncover groups of related malicious domains that might not be caught by simple pattern matching or reputation lists.
    answer_sources:
      - Zeek dns.log
      - Network Egress Points
      - Endpoint Devices
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: VECTORIZE all queried domains. CLUSTER vectors using DBSCAN. APPLY anomaly detection to clusters. ALERT on anomalous clusters.
  - question: Are internal hosts among the first to query newly registered domains (NRDs) that also have a low Time-to-Live (TTL) value?
    context: This question targets a common adversary tactic using 'burner' domains for short-lived campaigns. A newly registered domain, a low TTL (allowing for rapid IP changes to evade blocklists), and a very limited number of internal clients are a strong combination of indicators for C2 infrastructure. Identifying this pattern early can disrupt an attack in its initial stages.
    answer_sources:
      - Zeek dns.log
      - WHOIS data
      - Network Egress Points
      - Enterprise DNS Resolvers
      - Endpoint Devices of High-Value Targets
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: FOR each new domain query, GET domain_creation_date via WHOIS. IF age < 30 days AND TTL < 300 seconds AND total_internal_clients < 5, THEN CREATE alert.
  - question: Can a statistical risk score based on domain age and TTL value identify high-risk DNS queries that deviate from the norm?
    context: This question proposes a method to quantify the risk of a newly observed domain. By creating a score that is inversely proportional to both domain age and TTL, we can mathematically represent the 'suspiciousness' of a domain. Flagging scores that are statistical outliers (e.g., >3 standard deviations from the mean) provides a dynamic and data-driven way to detect potential threats.
    answer_sources:
      - Zeek dns.log
      - WHOIS data
      - Network Egress Points
      - Enterprise DNS Resolvers
      - Endpoint Devices of High-Value Targets
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: FOR each new domain, CALCULATE risk_score = (1/age) + (1/TTL). IF risk_score > (mean_risk_score + 3 * stddev_risk_score), THEN CREATE alert.
  - question: Can time-series forecasting predict the normal rate of newly registered domain (NRD) queries and detect anomalous spikes indicative of a campaign kickoff?
    context: This question uses machine learning to establish a baseline for 'normal' NRD activity in the environment. Adversary campaigns often begin with a burst of activity from newly created infrastructure. A time-series model can learn the typical patterns (e.g., time of day, day of week) and alert when a sudden, unexpected increase in NRD queries occurs, suggesting a coordinated attack is underway.
    answer_sources:
      - Zeek dns.log
      - WHOIS data
      - Network Egress Points
      - Enterprise DNS Resolvers
      - Endpoint Devices of High-Value Targets
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: MODEL hourly count of new NRD queries as a time series. PREDICT expected count for current hour. IF actual_count > prediction_interval_upper_bound, THEN CREATE alert.
  - question: Are multiple, distinct, newly registered domains resolving to the same IP address after being queried by our hosts?
    context: This question aims to uncover shared infrastructure. Adversaries often host multiple malicious domains on a single server or small IP range. Discovering that several unrelated, newly created domains all point to the same IP is a strong indicator that the IP is part of a malicious campaign infrastructure.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - WHOIS data
      - Network Egress Points
      - Passive DNS databases
      - Cloud Provider Network Infrastructure
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: CREATE table of (domain, resolved_ip, domain_age). FILTER for domain_age < 60 days. GROUP BY resolved_ip. IF unique_domain_count > 3, THEN CREATE alert.
  - question: For IPs resolving newly registered domains (NRDs), is the ratio of NRDs unusually high, and are the same internal hosts querying these different NRDs?
    context: This question adds two statistical dimensions to strengthen the signal. First, it identifies IPs that are disproportionately associated with NRDs, suggesting they are not general-purpose web servers. Second, it checks if the *same group* of internal hosts is accessing these different domains. A high Jaccard similarity in the client sets strongly implies a coordinated C2 mechanism where compromised hosts are cycling through a list of command servers.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - WHOIS data
      - Network Egress Points
      - Passive DNS databases
      - Cloud Provider Network Infrastructure
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: FOR each IP resolving NRDs, CALCULATE nrd_ratio. IF nrd_ratio > 99th_percentile, THEN CALCULATE Jaccard similarity of client sets for NRDs. IF similarity > 0.7, THEN CREATE alert.
  - question: Can graph analysis and community detection reveal hidden clusters of compromised hosts communicating with a shared set of C2 IPs?
    context: This question applies graph theory to model the relationships between internal clients and external IPs. Community detection algorithms can automatically find tightly-knit groups ('communities') in this graph. A community consisting of a specific set of internal hosts communicating with a small, distinct set of external IPs (especially if those IPs are known to host NRDs) provides a powerful visual and analytical method for identifying a C2 infrastructure and all the hosts communicating with it.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - WHOIS data
      - Network Egress Points
      - Passive DNS databases
      - Cloud Provider Network Infrastructure
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: BUILD bipartite graph of (internal_host, resolved_ip). RUN community detection algorithm. FOR each community, IF community contains NRD-hosting IPs and a distinct set of internal hosts, THEN CREATE alert.