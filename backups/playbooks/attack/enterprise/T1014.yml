name: "T1014: Rootkit"
id: "f47ac10b-58cc-4372-a567-0e02b2c3d479"
description: "This playbook helps investigate whether an adversary has deployed a rootkit to hide their presence and evade defenses. It focuses on identifying evidence of rootkit activity through several key indicators: persistent, low-volume network C2 beaconing; the loading of unsigned or suspicious kernel drivers; anomalous use of system utilities to install drivers/services; discrepancies between network logs and endpoint process logs; direct modification of boot configurations or raw disk access; and the targeted termination of security tools or a general increase in system instability."
type: "technique"
related:
  - "TA0005: Defense Evasion"
contributors:
  - "Zachary Szewczyk"
  - "Ask Sage"
created: "2025-10-01"
modified: "2025-10-01"
version: 1.0
tags: "none"
questions:
  - question: "Has a host established a network connection or made a DNS query to a known rootkit command and control (C2) server?"
    context: "This question aims to detect rootkit communication by matching outbound network traffic against a high-fidelity threat intelligence feed of known malicious infrastructure. A match provides a strong indication of a compromise."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Internet Gateway"
      - "DNS Resolvers"
      - "Network Security Monitoring (NSM) Sensor Grid"
    range: "Last 90 days"
    queries:
      - "Pseudocode: SEARCH (Zeek conn.log OR Zeek dns.log) WHERE destination_ip OR destination_domain IN (threat_intel_feed:rootkit_c2)"
  - question: "Is any internal host exhibiting automated, periodic network beaconing behavior indicative of a rootkit?"
    context: "This question seeks to identify covert C2 channels by looking for statistical anomalies in network traffic. Rootkits often use low-and-slow communication patterns, characterized by frequent connections with low data volume and regular intervals (low jitter), which can be distinguished from normal user activity."
    answer_sources:
      - "Zeek conn.log"
      - "Internet Gateway"
      - "DNS Resolvers"
      - "Network Security Monitoring (NSM) Sensor Grid"
    range: "Last 90 days"
    queries:
      - "Pseudocode: FROM Zeek conn.log | GROUP BY source_ip, destination_ip, 1h_window | CALCULATE connection_count, total_bytes, time_jitter | FILTER connection_count > 95th_percentile AND total_bytes < 5th_percentile AND time_jitter < 10th_percentile"
  - question: "Does any host's network traffic pattern significantly deviate from its established baseline, suggesting a potential rootkit infection?"
    context: "This question uses a time-series anomaly detection model to identify subtle changes in a host's network behavior. By learning what is normal for each host over time, the model can flag hours where metrics like connection count, data volume, and unique destinations are statistically unusual, which could indicate a newly activated rootkit."
    answer_sources:
      - "Zeek conn.log"
      - "Internet Gateway"
      - "DNS Resolvers"
      - "Network Security Monitoring (NSM) Sensor Grid"
    range: "Last 90 days"
    queries:
      - "Pseudocode: APPLY time_series_anomaly_detection_model ON (connection_count, total_bytes, unique_dest_ips) AGGREGATED per host, per hour | FLAG significant deviations from forecast"
  - question: "Has an unsigned, untrusted, or suspiciously named/located kernel driver been loaded on a Windows system?"
    context: "This question looks for direct evidence of a rootkit being installed or loaded into the kernel. Rootkits often use unsigned drivers or drivers with invalid signatures to gain privileged access. They may also masquerade as legitimate system files but be loaded from non-standard directories."
    answer_sources:
      - "Windows Event ID 7045"
      - "Windows Event ID 6 (Sysmon)"
      - "Windows Code Integrity Event IDs 3033, 3063, 3077"
      - "Domain Controllers"
      - "Critical Application Servers"
      - "Privileged User Workstations"
      - "All Windows Endpoints and Servers"
    range: "Last 90 days"
    queries:
      - "Pseudocode: SEARCH (Sysmon EID 6 WHERE Signed=false) OR (Code Integrity EID 3033, 3063, 3077) OR (Sysmon EID 6 WHERE ImageLoaded NOT IN system_dirs AND Filename IN system_driver_names)"
  - question: "Has a driver with a very low prevalence (rare signature or hash) been loaded, or is a driver's filename a potential typosquat of a legitimate one?"
    context: "This question uses rarity and string similarity to find suspicious drivers. A driver seen on only one or a few machines in an enterprise is statistically anomalous and warrants investigation. Similarly, a filename that is a close misspelling of a legitimate driver name is a common evasion tactic."
    answer_sources:
      - "Windows Event ID 6 (Sysmon)"
      - "Domain Controllers"
      - "Critical Application Servers"
      - "Privileged User Workstations"
      - "All Windows Endpoints and Servers"
    range: "Last 90 days"
    queries:
      - "Pseudocode: FROM Sysmon EID 6 | CALCULATE prevalence(Hash) and prevalence(Signature) | ALERT IF prevalence < 1% | CALCULATE Levenshtein_distance(Filename, known_good_drivers) | ALERT IF distance IN [1, 2]"
  - question: "Does a driver load event exhibit characteristics that a machine learning model classifies as malicious?"
    context: "This question leverages a supervised learning model trained to distinguish between benign and malicious driver loads. By analyzing a combination of features like signature status, hash prevalence, and path characteristics, the model can identify complex patterns associated with rootkits that may be missed by simpler rules."
    answer_sources:
      - "Windows Event ID 6 (Sysmon)"
      - "Domain Controllers"
      - "Critical Application Servers"
      - "Privileged User Workstations"
      - "All Windows Endpoints and Servers"
    range: "Last 90 days"
    queries:
      - "Pseudocode: APPLY classification_model ON features(Signed, Signature, HashPrevalence, PathEntropy) from Sysmon EID 6 | ALERT IF prediction is 'malicious'"
  - question: "Has a system utility like sc.exe or bcdedit.exe been used to install a driver or service from an unusual parent process?"
    context: "This question aims to detect rootkit installation attempts by monitoring the use of legitimate system tools. Adversaries often abuse these tools, and a key indicator of abuse is when they are executed by a process that normally wouldn't, such as a web browser or office application, suggesting process injection or a user-triggered exploit."
    answer_sources:
      - "Windows Event ID 4688"
      - "Windows Event ID 1 (Sysmon)"
      - "All Endpoints and Servers"
      - "especially user workstations and publicly accessible servers."
    range: "Last 90 days"
    queries:
      - "Pseudocode: SEARCH Sysmon EID 1 WHERE CommandLine MATCHES ('sc.exe create', 'bcdedit /set', 'PnPUtil /add-driver') AND ParentImage NOT IN (allowlist_of_admin_tools)"
  - question: "Has a rare or never-before-seen parent-child process relationship involving service or driver installation tools occurred?"
    context: "This question identifies malicious activity by baselining normal process lineages. A process like iexplore.exe spawning cmd.exe, which then spawns sc.exe, is a highly anomalous chain of events that deviates from standard administrative or user behavior and is a strong indicator of compromise."
    answer_sources:
      - "Windows Event ID 1 (Sysmon)"
      - "All Endpoints and Servers"
      - "especially user workstations and publicly accessible servers."
    range: "Last 90 days"
    queries:
      - "Pseudocode: FROM Sysmon EID 1 | BUILD frequency distribution of (ParentImage, Image) pairs | ALERT on new or rare pairs involving service/driver installation tools"
  - question: "Does the command line used to install a service or driver appear as a statistical outlier when compared to common administrative commands?"
    context: "This question uses clustering to find unusual command-line executions. By grouping all command lines into clusters of similar activity, commands that don't fit into any large, common cluster (i.e., outliers) can be flagged for review. This can reveal novel or obfuscated rootkit installation techniques."
    answer_sources:
      - "Windows Event ID 1 (Sysmon)"
      - "All Endpoints and Servers"
      - "especially user workstations and publicly accessible servers."
    range: "Last 90 days"
    queries:
      - "Pseudocode: APPLY clustering_algorithm ON TF-IDF vectors of command lines | IDENTIFY outlier clusters or singletons involving service/driver installation tools"
  - question: "Did a newly created service almost immediately initiate an external network connection to an unapproved destination?"
    context: "This question correlates service creation with network activity to spot malicious persistence mechanisms. A rootkit might install itself as a service that immediately calls home. This rule connects these two events in a short time window to provide a high-fidelity alert."
    answer_sources:
      - "Windows Event ID 7045"
      - "Windows Event ID 4688"
      - "Windows Event ID 3 (Sysmon)"
      - "Zeek conn.log"
      - "All Endpoints and Servers"
      - "Network Egress Points"
    range: "Last 90 days"
    queries:
      - "Pseudocode: CORRELATE (Windows EID 7045) with (Sysmon EID 3 OR Zeek conn.log) within 60 seconds WHERE destination NOT IN allowlist"
  - question: "Is there a statistical discrepancy on any host between network connections observed at the network layer and those reported by the operating system?"
    context: "This question aims to find evidence of a rootkit hiding its network activity from the OS. A discrepancy, where network logs (like Zeek) show a connection but the endpoint's own logging (like Sysmon) does not, suggests a kernel-level rootkit is intercepting and hiding its communication."
    answer_sources:
      - "Windows Event ID 3 (Sysmon)"
      - "Zeek conn.log"
      - "All Endpoints and Servers"
      - "Network Egress Points"
    range: "Last 90 days"
    queries:
      - "Pseudocode: JOIN Zeek conn.log and Sysmon EID 3 | COUNT connections in Zeek with no match in Sysmon per host | ALERT if count exceeds dynamic threshold (e.g., mean + 3*stddev)"
  - question: "Is there a process that initiated a network connection but is disconnected from the host's normal activity graph?"
    context: "This question models host activity as a graph to find outlier processes. Normal activity forms dense communities (e.g., a browser spawning tabs, which make connections). A process that makes a network connection but is not part of any such community is an anomaly, potentially indicating a process injected or hidden by a rootkit."
    answer_sources:
      - "Windows Event ID 1 (Sysmon)"
      - "Windows Event ID 3 (Sysmon)"
      - "All Endpoints and Servers"
      - "Network Egress Points"
    range: "Last 90 days"
    queries:
      - "Pseudocode: BUILD graph of process creations and network connections | APPLY community detection algorithm | IDENTIFY processes with network connections that are not part of any community"
  - question: "Has a tool known for modifying boot records been executed, or has an unauthorized process attempted to write directly to a physical disk?"
    context: "This question looks for direct attempts to install a bootkit, a type of rootkit that infects the master boot record (MBR). Any execution of tools like bootsect.exe or raw write access to PhysicalDrive0 by an unexpected process is a critical indicator of this highly persistent threat."
    answer_sources:
      - "Windows Event ID 4688"
      - "Windows Event ID 9 (Sysmon)"
      - "Windows Event ID 11 (Sysmon)"
      - "Windows Event ID 13 (Sysmon)"
      - "System Partitions on all hosts"
      - "Boot sectors of physical disks on servers and workstations."
    range: "Last 90 days"
    queries:
      - "Pseudocode: SEARCH (Sysmon EID 1 WHERE Image='bootsect.exe' or Image='fdisk.exe') OR (Sysmon EID 9 or 11 WHERE Device='\\\\.\\PhysicalDrive0' AND Image NOT IN allowlist)"
  - question: "Has a rare or previously unseen process performed a raw disk read?"
    context: "This question baselines the legitimate use of raw disk access to find anomalies. While some backup and forensic tools need this access, it is otherwise a rare and privileged operation. A process performing this action that has a low prevalence across the enterprise is highly suspicious and could be a rootkit scanning or modifying the disk."
    answer_sources:
      - "Windows Event ID 9 (Sysmon)"
      - "System Partitions on all hosts"
      - "Boot sectors of physical disks on servers and workstations."
    range: "Last 90 days"
    queries:
      - "Pseudocode: FROM Sysmon EID 9 | BUILD baseline of processes with raw disk access | ALERT if a new or low-prevalence process performs this action"
  - question: "Does a process execution event involving administrative tools appear as an outlier when compared to a model of benign administrative activity?"
    context: "This question uses a one-class SVM to model 'normal' administrative behavior. By training the model only on known-good examples, it becomes highly effective at flagging any deviation from that norm. An adversary using an administrative tool in a slightly different context would be flagged as an outlier."
    answer_sources:
      - "Windows Event ID 1 (Sysmon)"
      - "System Partitions on all hosts"
      - "Boot sectors of physical disks on servers and workstations."
    range: "Last 90 days"
    queries:
      - "Pseudocode: APPLY One-Class SVM model to process execution features (User, Parent, CommandLine) | ALERT on events flagged as outliers from the benign class"
  - question: "Has a process associated with a security tool (e.g., EDR, antivirus) been terminated?"
    context: "This question is a high-confidence indicator of defense evasion. Rootkits and other malware often attempt to disable security software to operate undetected. A direct termination event for a known security agent process is a critical alert that requires immediate investigation."
    answer_sources:
      - "Windows Event ID 5 (Sysmon)"
      - "All Endpoints and Servers"
      - "especially hosts with critical security agents installed."
    range: "Last 90 days"
    queries:
      - "Pseudocode: SEARCH Sysmon EID 5 WHERE TerminatedImage IN (list_of_security_tools)"
  - question: "Has any host experienced a statistically significant increase in application crashes or service failures?"
    context: "This question uses system stability metrics as a proxy for rootkit activity. A poorly written or aggressive rootkit can destabilize the operating system, leading to an unusual number of application or service crashes. By tracking the baseline crash rate for each host, a sudden spike can serve as an early warning sign."
    answer_sources:
      - "Windows Event ID 1000"
      - "Windows Event ID 1001"
      - "Windows Event ID 7031"
      - "Windows Event ID 7034"
      - "All Endpoints and Servers"
    range: "Last 90 days"
    queries:
      - "Pseudocode: FROM crash/failure events | CALCULATE hourly count per host | ALERT if count > (28-day_rolling_mean + 3*stddev) for that host/hour"
  - question: "Does a host show an anomalous combination of failure events and security tool terminations, as identified by an Isolation Forest model?"
    context: "This question uses an unsupervised anomaly detection model to find complex patterns of system instability. A rootkit might cause a slight increase in crashes and a few service failures. While each event alone might not cross a threshold, the combination is highly anomalous. An Isolation Forest is effective at isolating these 'abnormal' combinations of events."
    answer_sources:
      - "Windows Event ID 1000"
      - "Windows Event ID 1001"
      - "Windows Event ID 7031"
      - "Windows Event ID 7034"
      - "Windows Event ID 5 (Sysmon)"
      - "All Endpoints and Servers"
    range: "Last 90 days"
    queries:
      - "Pseudocode: APPLY Isolation Forest model on feature vector [count(EID 1000), count(EID 7031), count(security_agent_terminations)] per host, per hour | ALERT on instances flagged as anomalies"