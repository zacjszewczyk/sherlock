name: T1417.001: Keylogging
id: 1c2a3b4d-5e6f-4a7b-8c9d-0e1f2a3b4c5d
description: This playbook helps identify if an adversary is capturing user credentials or other sensitive information via keylogging on mobile devices. It focuses on detecting unauthorized or suspicious keyboard applications (Input Method Editors), abuse of powerful system permissions like Android's Accessibility Services, and anomalous network traffic patterns consistent with data exfiltration C2 beaconing.
type: technique
related:
  - TA0031: Credential Access
  - TA0035: Collection
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Is there an unauthorized or tampered-with keyboard application (IME) installed on any mobile device?
    context: Adversaries can deploy malicious Input Method Editors (IMEs) to capture all user keystrokes, including passwords and sensitive data. This question helps identify IMEs that are not on a corporate allowlist or whose digital signature or binary hash does not match the known-good version, which are strong indicators of a potential keylogger.
    answer_sources:
      - UEM/MDM Application Inventory Report
      - Mobile EDR Process Execution Logs
      - Corporate Application Allowlist Database
      - Threat Intelligence Hash/Signature Feeds
      - UEM/MDM platform's central database
      - Corporate application store
      - Threat intelligence vendor portals
    range: Last 90 days
    queries:
      - pseudocode: |
          SEARCH UEM/MDM logs FOR installed_apps
          JOIN with corporate_allowlist ON package_name, signature, hash
          WHERE app_is_ime AND on_allowlist=false OR hash_mismatch=true
          ALERT high_severity
  - question: Has a rare keyboard application been installed, or is there a statistically significant spike in installations for a rare keyboard?
    context: Malicious keyloggers are often not widely distributed across an enterprise. Identifying IMEs with very low installation prevalence ("rare keyboards") helps focus investigative efforts. Furthermore, a sudden, coordinated surge in installations of a rare keyboard can indicate a targeted campaign. This question uses statistical analysis to detect both rarity and anomalous installation velocity.
    answer_sources:
      - UEM/MDM Application Inventory Report
      - Mobile EDR Process Execution Logs
      - Corporate Application Allowlist Database
      - Threat Intelligence Hash/Signature Feeds
      - UEM/MDM platform's central database
      - Corporate application store
      - Threat intelligence vendor portals
    range: Last 90 days
    queries:
      - pseudocode: |
          SEARCH UEM/MDM logs FOR ime_apps
          CALCULATE prevalence
          FOR apps where prevalence < 1%
          CALCULATE 30-day_moving_avg_and_std_dev of daily_installs
          ALERT if daily_installs > (mean + 3*std_dev)
  - question: Does a machine learning model classify a newly detected or rare keyboard application as malicious?
    context: This leverages machine learning to proactively assess the risk of new or rare IMEs. By training a model on features like permissions, developer reputation, and user reviews, the system can predict malicious intent with a certain probability, allowing for automated incident creation when confidence is high (e.g., >90%). This provides a sophisticated, data-driven layer of defense.
    answer_sources:
      - UEM/MDM Application Inventory Report
      - Mobile EDR Process Execution Logs
      - Corporate Application Allowlist Database
      - Threat Intelligence Hash/Signature Feeds
      - UEM/MDM platform's central database
      - Corporate application store
      - Threat intelligence vendor portals
    range: Last 90 days
    queries:
      - pseudocode: |
          FOR new_or_rare_ime_app
          EXTRACT metadata_features
          INPUT to Random_Forest_Model
          IF prediction_probability(malicious) > 0.90
          CREATE critical_incident
  - question: Has the BIND_ACCESSIBILITY_SERVICE permission been granted to an unauthorized application on an Android device?
    context: The 'android.permission.BIND_ACCESSIBILITY_SERVICE' permission is extremely powerful and can be abused by malware to read screen content and capture input, effectively creating a keylogger. This question checks for any application not on a strict allowlist gaining this permission, which is a critical security event. [1]
    answer_sources:
      - UEM/MDM Device Permissions Report
      - Mobile EDR API Call Monitoring Logs
      - Android dumpsys accessibility output
      - UEM/MDM platform's device configuration and compliance database
      - EDR agent logs on managed Android devices
    range: Last 90 days
    queries:
      - pseudocode: |
          SEARCH UEM/MDM permission_logs FOR event=BIND_ACCESSIBILITY_SERVICE_granted
          JOIN with accessibility_allowlist ON package_name
          WHERE on_allowlist=false
          ALERT critical
  - question: Does an application with accessibility services enabled exhibit an unusually large or atypical set of permissions for its category?
    context: Malicious apps often request an excessive and diverse range of permissions unrelated to their purported function. This question uses information theory (Shannon entropy) and set theory (Jaccard distance) to statistically identify outliers. A high entropy score suggests an unusually broad permission set, while a large Jaccard distance indicates its permissions are very different from typical apps in its category, both of which are red flags.
    answer_sources:
      - UEM/MDM Device Permissions Report
      - Mobile EDR API Call Monitoring Logs
      - Android dumpsys accessibility output
      - UEM/MDM platform's device configuration and compliance database
      - EDR agent logs on managed Android devices
    range: Last 90 days
    queries:
      - pseudocode: |
          FOR apps_with_accessibility_service
          CALCULATE shannon_entropy(permission_set) and jaccard_distance(permission_set, category_median_set)
          ALERT if entropy > 99th_percentile OR jaccard_distance > 0.8
  - question: Is an application with accessibility services making anomalous sequences of API calls indicative of keylogging and exfiltration?
    context: This question focuses on the dynamic behavior of an application. By training an anomaly detection model (Isolation Forest) on normal API call sequences, we can identify when an application performs a suspicious chain of actions, such as reading text input and immediately trying to write it to a file or send it over the network. This behavioral analysis can catch active keylogging in progress.
    answer_sources:
      - UEM/MDM Device Permissions Report
      - Mobile EDR API Call Monitoring Logs
      - Android dumpsys accessibility output
      - UEM/MDM platform's device configuration and compliance database
      - EDR agent logs on managed Android devices
    range: Last 90 days
    queries:
      - pseudocode: |
          MONITOR api_call_stream for app_with_accessibility_service
          INPUT to Isolation_Forest_Model
          IF anomaly_score > 99th_percentile
          ALERT critical for potential_keylogging
  - question: Is any mobile device communicating with a known malicious command and control (C2) server?
    context: This is a fundamental check to see if a device is communicating with infrastructure known to be malicious. Keyloggers need to exfiltrate captured data, and they often do so by connecting to C2 servers. Correlating network logs with threat intelligence feeds is a highly effective way to detect this activity.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Mobile EDR Network Connection Logs
      - Threat Intelligence IP/Domain Feeds
      - WHOIS Registration Data
      - Network sensor logs from corporate Wi-Fi controllers, VPN concentrators, and internet gateway traffic mirrors
    range: Last 90 days
    queries:
      - pseudocode: |
          SEARCH Zeek logs (dns, conn) for mobile_ip_space
          JOIN with threat_intel_feed ON destination_ip, destination_fqdn
          WHERE match_found=true
          ALERT high_severity
  - question: Is a mobile device exhibiting a regular, low-volume 'heartbeat' of network traffic to an external destination, potentially indicating C2 communication?
    context: Automated malware, like keyloggers, often uses a "beacon" to check in with its C2 server. This beaconing traffic is characterized by high regularity (low jitter) and small data packets. This question seeks to identify this specific pattern of behavior, which is distinct from typical user-generated traffic. Enriching with WHOIS data to check for newly registered domains adds another layer of suspicion.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Mobile EDR Network Connection Logs
      - Threat Intelligence IP/Domain Feeds
      - WHOIS Registration Data
      - Network sensor logs from corporate Wi-Fi controllers, VPN concentrators, and internet gateway traffic mirrors
    range: Last 90 days
    queries:
      - pseudocode: |
          AGGREGATE Zeek conn.log by src_ip, dest_ip in 1-hour_windows
          CALCULATE std_dev(time_delta) and percentile(outbound_bytes, 95)
          ALERT medium if std_dev < 2s AND percentile < 1024B
          ENRICH with WHOIS
          ESCALATE to high if domain_age < 30_days
  - question: Does a mobile device's current network activity deviate significantly from its own established historical baseline?
    context: This question uses a sophisticated machine learning approach to create a personalized baseline of normal network behavior for each device. An LSTM Autoencoder learns the typical patterns of a device's traffic. When a keylogger is activated and begins exfiltrating data, this new activity will not match the learned baseline, resulting in a high "reconstruction error" and triggering an anomaly alert. This method is effective at detecting novel threats.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Mobile EDR Network Connection Logs
      - Threat Intelligence IP/Domain Feeds
      - WHOIS Registration Data
      - Network sensor logs from corporate Wi-Fi controllers, VPN concentrators, and internet gateway traffic mirrors
    range: Last 90 days
    queries:
      - pseudocode: |
          FOR each mobile_device
          FEED real-time_network_activity to trained_LSTM_Autoencoder_model
          IF reconstruction_error > 99th_percentile_of_historical_errors
          ALERT high_severity_anomaly