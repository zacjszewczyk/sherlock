name: T1136.001: Local Account
id: f47ac10b-58cc-4372-a567-0e02b2c3d479
description: This playbook helps determine if an adversary is maintaining persistence by creating local accounts. It focuses on identifying suspicious local account creation by correlating it with various indicators of malicious activity. These indicators include: communication with threat-listed IPs or domains shortly before or after account creation; chaining account creation and privilege escalation commands in a single line; immediate privilege escalation following account creation; new accounts being used for remote logon and reconnaissance activities; and anomalous network egress traffic from a host after a new account is created.
type: technique
related:
- TA0003: Persistence
contributors:
- Zachary Szewczyk
- Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
investigative_questions:
- question: Did a host that created a local account (Windows Event ID 4720) also communicate with a high-confidence threat IP or domain within the preceding 24 hours?
  context: This question seeks to connect two potentially malicious events: the creation of a new user account for persistence and communication with known command and control (C2) infrastructure. A positive finding is a strong indicator of compromise, as it suggests the account was created as part of an active intrusion.
  answer_sources:
  - Windows Event ID 4720
  - Zeek conn.log
  - Zeek dns.log
  - User Workstations
  - Member Servers
  - Internet Gateway
  - DNS Resolvers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      SEARCH for hosts with Windows Event ID 4720.
      FOR each host, CHECK network logs (Zeek conn.log, dns.log) for connections to threat-listed IPs/domains within the 24 hours prior to the event.
- question: Is there an anomalous rate of local account creation on a host, especially after it has communicated with a low-reputation IP or domain?
  context: Adversaries may create multiple accounts for redundancy. This question uses statistical analysis to detect unusual spikes in account creation activity. By first filtering for hosts that have already shown risky behavior (communicating with low-reputation destinations), the analysis is focused on systems more likely to be compromised, reducing false positives.
  answer_sources:
  - Windows Event ID 4720
  - Zeek conn.log
  - Zeek dns.log
  - User Workstations
  - Member Servers
  - Internet Gateway
  - DNS Resolvers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR each host, CALCULATE the 30-day baseline for daily local account creations.
      IDENTIFY hosts that communicated with low-reputation IPs.
      ALERT if these hosts create accounts at a rate exceeding the 95th percentile of their baseline.
- question: Can a machine learning model, based on features like account name entropy and recent network behavior, classify a local account creation event as malicious with high confidence?
  context: This question leverages machine learning to automate the detection of malicious account creation. By training a model on various features (e.g., unusual account names, time of creation, parent process, prior network connections), it can identify complex patterns that simple rules might miss, providing a more sophisticated and scalable detection method.
  answer_sources:
  - Windows Event ID 4720
  - Zeek conn.log
  - Zeek dns.log
  - User Workstations
  - Member Servers
  - Internet Gateway
  - DNS Resolvers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR each account creation event (4720), GATHER features: account name entropy, parent process, time of day, flag for recent comms with bad IPs.
      INPUT features into trained classification model.
      ALERT if 'malicious' score > 0.9.
- question: Is there a single command-line execution (Event ID 4688) that attempts to both create a local user and add them to a privileged group?
  context: Adversaries often chain commands to be more efficient and reduce their footprint. A single command that creates a user and immediately grants it administrative privileges is a highly suspicious and common persistence technique. This question aims to find this specific command-chaining behavior.
  answer_sources:
  - Windows Event ID 4688
  - Domain Controllers
  - Member Servers
  - User Workstations
  - Privileged Access Workstations
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      SEARCH process creation logs (4688) for command lines containing both 'net user ... /add' and 'net localgroup Administrators ... /add' using regex.
- question: Does a `net.exe` process creation event have an abnormally high command-line entropy, suggesting obfuscation?
  context: To evade simple keyword-based detections, adversaries may obfuscate their commands. High entropy (randomness) in a command-line string can be an indicator of such obfuscation. This question seeks to identify `net.exe` commands that are statistically unusual compared to a baseline of normal activity.
  answer_sources:
  - Windows Event ID 4688
  - Domain Controllers
  - Member Servers
  - User Workstations
  - Privileged Access Workstations
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR all 'net.exe' process events, CALCULATE entropy of the command line.
      ALERT if entropy is > 3 standard deviations above the mean of the baseline.
- question: Can an NLP-based model classify a command-line execution containing 'net user' and 'net localgroup' as malicious?
  context: This question applies Natural Language Processing (NLP) to understand the intent of a command line. Unlike simple regex, an NLP model can learn the structure and token patterns of malicious commands, making it more resilient to slight variations and obfuscation techniques.
  answer_sources:
  - Windows Event ID 4688
  - Domain Controllers
  - Member Servers
  - User Workstations
  - Privileged Access Workstations
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      INPUT command-line strings from process creation events (4688) into a trained NLP classifier.
      FLAG commands classified as malicious, especially those with 'net user' and 'net localgroup'.
- question: Was a new local account (Event ID 4720) added to a privileged group like 'Administrators' or 'Remote Desktop Users' (Event ID 4732) within 60 seconds of its creation?
  context: This question looks for the rapid, automated escalation of privileges for a newly created account. A short time window between account creation and addition to a privileged group is a strong sign of scripted adversary activity, as opposed to legitimate manual administrative action which typically takes longer.
  answer_sources:
  - Windows Event ID 4720
  - Windows Event ID 4732
  - Domain Controllers
  - Member Servers
  - Privileged Access Workstations
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      CORRELATE Event ID 4720 and 4732 on the same host.
      ALERT if 4720.TargetUserName == 4732.MemberName, 4732.GroupName is privileged, and the time difference is < 60 seconds.
- question: Did a rapid sequence of account creation (4720) and privilege addition (4732) originate from a non-standard parent process like 'cmd.exe' or 'powershell.exe'?
  context: Legitimate user management is often performed through specific administrative consoles (e.g., `mmc.exe`). When the parent process is a command shell, it's more likely to be part of a malicious script. This question refines the previous one by adding context about the parent process and comparing the timing to a baseline of legitimate activity.
  answer_sources:
  - Windows Event ID 4720
  - Windows Event ID 4732
  - Domain Controllers
  - Member Servers
  - Privileged Access Workstations
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      IDENTIFY correlated 4720/4732 event pairs.
      IF the parent process is not on an admin allowlist (e.g., 'cmd.exe') and the time delay is in the lowest 10th percentile of legitimate baselines, ALERT.
- question: Did the sequence of events on a host, specifically a transition from Event ID 4720 to a privileged Event ID 4732, have a very low probability based on the host's historical behavior?
  context: This question uses sequence analysis to model normal event patterns on a per-host basis. Every system has a typical flow of events. A transition that is highly improbable according to its own history, such as creating a user and immediately making them an admin, can be flagged as a significant anomaly indicative of malicious behavior.
  answer_sources:
  - Windows Event ID 4720
  - Windows Event ID 4732
  - Domain Controllers
  - Member Servers
  - Privileged Access Workstations
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      USING a Markov Chain model trained on host event logs, CALCULATE the transition probability from Event ID 4720 to a privileged 4732.
      ALERT if the probability is anomalously low.
- question: For a newly created local account, was its first logon a remote type (Type 3 or 10), and did its initial session involve running reconnaissance commands?
  context: This question aims to identify accounts created specifically for remote access and discovery. A legitimate new user account is typically first accessed locally for setup. An immediate remote logon, especially when followed by commands like 'whoami' or 'netstat', is highly indicative of an adversary establishing and exploring their new foothold.
  answer_sources:
  - Windows Event ID 4720
  - Windows Event ID 4624
  - Windows Event ID 4688
  - User Workstations
  - Member Servers
  - VPN Concentrators
  - Authentication Servers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      CREATE a watchlist of new users from Event ID 4720.
      ALERT if the first logon (4624) for a user on the list is Type 3 or 10.
      CORRELATE with process events (4688) from that logon and ALERT if recon commands are found.
- question: Does the set of processes executed in a new local account's first session have a high similarity to a predefined set of reconnaissance tools?
  context: This question provides a quantitative method to assess if a user's initial activity is focused on reconnaissance. By using the Jaccard similarity index, we can measure the overlap between the observed processes and a known list of recon tools, triggering an alert if the similarity score is unusually high.
  answer_sources:
  - Windows Event ID 4720
  - Windows Event ID 4624
  - Windows Event ID 4688
  - User Workstations
  - Member Servers
  - VPN Concentrators
  - Authentication Servers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR a new account's first logon session, COLLECT all executed process names.
      CALCULATE Jaccard similarity against a 'recon tools' set.
      ALERT if similarity score exceeds a defined threshold (e.g., > 0.5).
- question: Does the initial session activity of a newly created account fall into an anomalous cluster when compared to the typical initial activity of other new accounts?
  context: This question uses unsupervised machine learning to find 'outliers' without pre-defined rules. By clustering new account sessions based on features like logon type and processes run, sessions that don't fit into the large, dense clusters of normal activity can be automatically flagged for investigation as potential threats.
  answer_sources:
  - Windows Event ID 4720
  - Windows Event ID 4624
  - Windows Event ID 4688
  - User Workstations
  - Member Servers
  - VPN Concentrators
  - Authentication Servers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      CLUSTER first-session activity of new accounts using features like Logon Type, source IP, and process counts.
      INVESTIGATE sessions that are identified as outliers or part of a sparse cluster by the algorithm (e.g., DBSCAN).
- question: Following a local account creation (Event ID 4720), did the host connect to a threat-listed IP or a domain classified as a DGA?
  context: This question focuses on detecting command-and-control (C2) activity immediately following a persistence event. The creation of an account may be a prelude to the compromised machine 'calling home'. Monitoring network traffic for known indicators of C2, such as connections to threat intel IPs or DGA domains, provides a timely detection opportunity.
  answer_sources:
  - Windows Event ID 4720
  - Zeek conn.log
  - Zeek ssl.log
  - Zeek dns.log
  - Network Egress Points
  - Internet Gateway
  - Core Switches
  - Hosts with newly created accounts
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      UPON detecting Event ID 4720, MONITOR the host's IP.
      ALERT if, within the next hour, it connects to a threat intel IP or queries a DGA-classified domain in network logs.
- question: Did a host exhibit a statistically significant change in its outbound network behavior (e.g., data volume, unique destinations) shortly after a local account was created on it?
  context: This question looks for anomalous changes in a host's network patterns, which could indicate data exfiltration or C2 beaconing. By comparing post-event traffic to a historical baseline using a change-point detection algorithm, it can identify subtle but significant shifts that rule-based systems might miss.
  answer_sources:
  - Windows Event ID 4720
  - Zeek conn.log
  - Zeek ssl.log
  - Zeek dns.log
  - Network Egress Points
  - Internet Gateway
  - Core Switches
  - Hosts with newly created accounts
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      AFTER an Event ID 4720, APPLY a change-point detection algorithm (e.g., CUSUM) to the host's network metrics (outbound bytes, unique IPs).
      ALERT if a statistically significant change is detected.
- question: Following a local account creation, did the host generate any network connections that an autoencoder model flagged as having a high reconstruction error?
  context: This question uses an autoencoder, a type of neural network, to learn what 'normal' network traffic looks like for a host. When a new connection doesn't conform to this learned normality (resulting in a high reconstruction error), it is flagged as an anomaly. This is effective for detecting novel C2 channels or exfiltration methods that don't match known signatures.
  answer_sources:
  - Windows Event ID 4720
  - Zeek conn.log
  - Zeek ssl.log
  - Zeek dns.log
  - Network Egress Points
  - Internet Gateway
  - Core Switches
  - Hosts with newly created accounts
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      AFTER an Event ID 4720, FEED the host's subsequent network connection data into a trained autoencoder.
      ALERT if any connection produces a reconstruction error in the 99th percentile of historical errors.