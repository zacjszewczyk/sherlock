name: "T1555.003: Credentials from Web Browsers"
id: "f8a9b1c2-d3e4-4f5a-6b7c-8d9e0f1a2b3c"
description: "This playbook helps investigate whether an adversary has attempted to acquire credentials from web browsers on enterprise hosts. Adversaries may use specialized tools or custom scripts to locate and decrypt credentials stored by web browsers. This can involve directly querying credential databases, using known malicious tools (like Mimikatz or LaZagne), copying credential files to staging directories to bypass file locks, or running scripts that leverage system APIs to decrypt stored passwords. Successful acquisition provides the adversary with user credentials that can be used for lateral movement, privilege escalation, or accessing external resources."
type: "technique"
related:
  - "TA0006: Credential Access"
contributors:
  - "Zachary Szewczyk"
  - "Ask Sage"
created: "2025-10-01"
modified: "2025-10-01"
version: "1.0"
tags: "none"
questions:
  - question: "Are there any newly created processes on endpoints that match the file hashes of known credential theft tools, or are there any network connections to known malicious C2 infrastructure?"
    context: "This question uses a symbolic detection method, relying on high-confidence threat intelligence. By matching process file hashes against a known-bad list (e.g., for tools like LaZagne or Mimikatz) or matching outbound network destinations against a C2 feed, analysts can quickly identify confirmed malicious activity related to credential theft."
    answer_sources:
      - "Windows Event ID 4688"
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "User workstations, servers with interactive logins, and network egress points."
    range: "last 90 days"
    queries:
      - "SIEM: SEARCH process_creation_events (EventID 4688) | HASH executable | JOIN against known_credential_theft_tool_hashes_feed | ALERT on match"
      - "SIEM: SEARCH network_connection_logs (Zeek conn, dns) | JOIN destination_ip_or_domain against known_c2_feed | ALERT on match"
  - question: "Have any endpoints made network connections to statistically rare or low-prevalence domains shortly after an unusual process was launched?"
    context: "This question uses a statistical approach to uncover potential C2 activity not yet present in threat intelligence feeds. A connection to a domain that very few other hosts in the enterprise have ever contacted is anomalous. Correlating this rare network event with a preceding process creation on the same host can help identify the malicious process responsible for the suspicious communication."
    answer_sources:
      - "Windows Event ID 4688"
      - "Zeek dns.log"
      - "User workstations, servers with interactive logins, and network egress points."
    range: "last 90 days"
    queries:
      - "Data Analytics: CALCULATE prevalence_score for all domains in dns.log | IDENTIFY domains with prevalence < 1st percentile | CORRELATE by source_host and time (within 5 mins) with process_creation_events (EventID 4688) | FLAG for investigation"
  - question: "Has any host exhibited a significant and anomalous spike in outbound network traffic volume or frequency following a suspicious process creation event?"
    context: "This question leverages machine learning to establish a baseline of normal network behavior for each host. A time-series model can predict expected traffic patterns. A significant deviation from this prediction (e.g., a sudden, large data transfer) that occurs shortly after a new process is created can indicate data exfiltration, which is a common follow-on action after credential theft."
    answer_sources:
      - "Windows Event ID 4688"
      - "Zeek conn.log"
      - "User workstations, servers with interactive logins, and network egress points."
    range: "last 90 days"
    queries:
      - "ML Platform: FOR each host, APPLY time-series model to outbound_traffic_volume (from conn.log) | DETECT anomalies where actual traffic > predicted + 99th_percentile_error | CORRELATE anomaly with preceding process_creation_event (EventID 4688) | ALERT on correlation"
  - question: "Are there any command line executions or PowerShell script blocks containing specific strings, file paths, or API calls associated with accessing or decrypting browser credentials?"
    context: "This question focuses on finding direct, symbolic evidence of credential theft attempts within command line arguments and PowerShell scripts. Searching for keywords like 'Login Data', 'CryptUnprotectData', or 'sqlite3.exe' targeting browser databases can uncover the exact commands an adversary is using to steal credentials."
    answer_sources:
      - "Windows Event ID 4688"
      - "Windows Event ID 4104"
      - "All Windows endpoints and servers where PowerShell v5+ Script Block Logging is enabled."
    range: "last 90 days"
    queries:
      - "SIEM: SEARCH command_line_logs (EventID 4688) OR powershell_script_block_logs (EventID 4104) | APPLY regex for patterns like '*\\User Data\\*', 'CryptUnprotectData', 'logins.json' | ALERT on match"
  - question: "Have any command lines or PowerShell scripts been executed with an unusually high entropy score, suggesting obfuscation?"
    context: "This question uses a statistical measure, Shannon entropy, to detect obfuscated commands or scripts. Adversaries often use obfuscation to hide malicious code from simple keyword-based detections. A command or script with an entropy score significantly higher than the established baseline for normal activity is highly suspicious and warrants investigation for malicious content."
    answer_sources:
      - "Windows Event ID 4688"
      - "Windows Event ID 4104"
      - "All Windows endpoints and servers where PowerShell v5+ Script Block Logging is enabled."
    range: "last 90 days"
    queries:
      - "Data Analytics: CALCULATE Shannon_entropy for all command_lines and script_blocks | ESTABLISH baseline distribution | FLAG events with entropy > 98th percentile of baseline for review"
  - question: "Can a machine learning model classify any recent PowerShell script blocks as malicious based on features indicative of credential theft?"
    context: "This question applies a supervised machine learning model to automate the detection of malicious PowerShell scripts. By training a model on features like script length, keyword presence, API call frequency, and entropy, the system can learn to distinguish between benign and malicious scripts, providing a scalable way to find sophisticated attacks that might evade other detection methods."
    answer_sources:
      - "Windows Event ID 4104"
      - "All Windows endpoints and servers where PowerShell v5+ Script Block Logging is enabled."
    range: "last 90 days"
    queries:
      - "ML Platform: EXTRACT features (length, keywords, entropy, etc.) from new powershell_script_block logs (EventID 4104) | APPLY trained classification model | ALERT on scripts classified as 'malicious' with high confidence"
  - question: "Has any process not on the approved browser whitelist attempted to read a browser's credential database file?"
    context: "This question uses a symbolic, high-fidelity detection method based on access control auditing. By enabling SACLs on browser credential files, the system will log every read attempt. An alert is generated if the process reading the file is not a legitimate, whitelisted browser (like chrome.exe or firefox.exe), indicating a likely credential theft attempt by another tool."
    answer_sources:
      - "Windows Event ID 4663"
      - "Windows Event ID 4688"
      - "File systems on all user workstations and servers. This requires enabling SACLs on user profile directories containing browser data (e.g., '*\\AppData\\Local\\Google\\Chrome\\User Data\\*')."
    range: "last 90 days"
    queries:
      - "SIEM: SEARCH file_read_audit_events (EventID 4663) where target_file is a browser_credential_store AND access_type is 'read' | CHECK if process_name is NOT IN browser_whitelist | ALERT on non-whitelisted access"
  - question: "Have any statistically rare or infrequent processes accessed browser credential files?"
    context: "This question uses a statistical approach to identify anomalous access to sensitive credential files. While some non-browser processes might legitimately access files, a process that has never or very rarely done so before is suspicious. By tracking the frequency of which processes access these files, analysts can spot outliers that may represent a new or novel attack tool."
    answer_sources:
      - "Windows Event ID 4663"
      - "File systems on all user workstations and servers. This requires enabling SACLs on user profile directories containing browser data (e.g., '*\\AppData\\Local\\Google\\Chrome\\User Data\\*')."
    range: "last 90 days"
    queries:
      - "Data Analytics: For all processes accessing credential files (from EventID 4663), CALCULATE access frequency over 30 days | IDENTIFY processes with access frequency < 5th percentile | ALERT as medium priority"
  - question: "Has an anomaly detection model identified any unusual access patterns to browser credential files?"
    context: "This question uses an unsupervised machine learning model to learn the normal patterns of access to browser credential files. The model considers features like the process name, its parent process, the user account, and time of day. Any access event that significantly deviates from these learned 'normal' patterns is flagged as an anomaly, potentially indicating a stealthy adversary."
    answer_sources:
      - "Windows Event ID 4663"
      - "Windows Event ID 4688"
      - "File systems on all user workstations and servers. This requires enabling SACLs on user profile directories containing browser data (e.g., '*\\AppData\\Local\\Google\\Chrome\\User Data\\*')."
    range: "last 90 days"
    queries:
      - "ML Platform: EXTRACT features (process, parent, user, time) from file access events (EventID 4663) and parent process events (EventID 4688) | APPLY Isolation Forest or other anomaly detection model | FLAG events identified as significant anomalies"
  - question: "Have any processes been observed copying a browser credential store file to a temporary or staging directory?"
    context: "This question looks for a specific, symbolic behavior indicative of lock file evasion. Browsers often lock their credential databases while running. To bypass this, adversaries copy the file to a different location (like C:\\Windows\\Temp) and read the copy. Detecting this copy operation via command line monitoring is a high-confidence indicator of a credential theft attempt."
    answer_sources:
      - "Windows Event ID 4688"
      - "Temporary file locations (e.g., C:\\Windows\\Temp, C:\\Users\\Public, %APPDATA%\\Temp) and user profile directories on all Windows endpoints."
    range: "last 90 days"
    queries:
      - "SIEM: SEARCH process_creation_events (EventID 4688) for copy commands ('copy', 'xcopy', 'Copy-Item') | CHECK if source_path matches a browser_credential_file AND destination_path is a staging_directory | ALERT on match"
  - question: "Have any files with names or extensions typical of browser credential stores been created in unusual staging directories?"
    context: "This question uses a statistical method to find misplaced credential files. Staging directories like C:\\Windows\\Temp have predictable patterns of file types. The appearance of a file with a name or extension like 'Login Data' or '.sqlite' is highly anomalous for that location and suggests an adversary has copied it there for processing or exfiltration."
    answer_sources:
      - "File creation logs"
      - "Temporary file locations (e.g., C:\\Windows\\Temp, C:\\Users\\Public, %APPDATA%\\Temp) and user profile directories on all Windows endpoints."
    range: "last 90 days"
    queries:
      - "Data Analytics: PROFILE normal file extensions/names in staging directories | MONITOR for new files where name/extension is outside the 95th percentile of normal frequency (e.g., '.db', '.sqlite', 'Login Data') AND file_size is consistent with credential store (<10MB) | FLAG for review"
  - question: "Has a machine learning model detected the specific sequence of a browser credential file being copied and then read from its new location?"
    context: "This question uses a sequence analysis model (like a Hidden Markov Model) to detect a chain of events strongly indicative of credential theft. The model is trained to recognize the specific sequence: 1) a copy command on a credential file, 2) file creation in a staging area, and 3) a read access on that new file. Detecting this full sequence provides very strong evidence of malicious activity."
    answer_sources:
      - "Windows Event ID 4688"
      - "Windows Event ID 4663"
      - "Temporary file locations (e.g., C:\\Windows\\Temp, C:\\Users\\Public, %APPDATA%\\Temp) and user profile directories on all Windows endpoints."
    range: "last 90 days"
    queries:
      - "ML Platform: DEPLOY sequence analysis model to detect the chain: [Process A copies credential file (EventID 4688)] -> [New file created in staging dir] -> [Process A (or child) reads new file (EventID 4663)] | ALERT when the full sequence is observed with high probability"
  - question: "After a non-browser process read a credential file, did the same host immediately connect to a known malicious IP or domain?"
    context: "This question uses a stateful, symbolic correlation to link credential access directly to exfiltration. It creates a rule that triggers when two conditions are met in a short time window: first, a non-browser process reads a credential file, and second, the same host communicates with a destination on a threat intelligence feed. This provides a clear, actionable alert of compromise and data theft."
    answer_sources:
      - "Windows Event ID 4663"
      - "Windows Event ID 4688"
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Network egress points, firewalls, and host-level event logs on all endpoints where SACL auditing for browser credential files is enabled."
    range: "last 90 days"
    queries:
      - "SIEM: CREATE stateful rule | TRIGGER on EventID 4663 read access by non-browser process | IF within 5 minutes, the same host connects to a destination in C2_threat_feed (from Zeek logs) | GENERATE high-priority alert"
  - question: "Following a non-browser process reading a credential file, did the host connect to a statistically rare domain not commonly visited by the enterprise?"
    context: "This question uses statistical correlation to link credential access with suspicious exfiltration. After a non-whitelisted process reads a credential file, the playbook checks subsequent DNS queries from that host. A connection to a domain that is extremely uncommon across the enterprise (e.g., visited by less than 0.5% of hosts) is a strong indicator of exfiltration to a newly established C2 server."
    answer_sources:
      - "Windows Event ID 4663"
      - "Zeek dns.log"
      - "Network egress points, firewalls, and host-level event logs on all endpoints where SACL auditing for browser credential files is enabled."
    range: "last 90 days"
    queries:
      - "Data Analytics: ON EventID 4663 read by non-browser process | ANALYZE subsequent dns.log from same host | CALCULATE enterprise-wide prevalence of queried domains | IF domain prevalence < 0.5 percentile | FLAG as suspicious exfiltration"
  - question: "After a non-browser process accessed a credential file, did a machine learning model detect an anomalous spike in outbound data volume from that host?"
    context: "This question uses a machine learning model to detect exfiltration behavior following a credential access event. Once a suspicious file read is detected, a time-series anomaly detection model is focused on that host's outbound traffic. A sudden spike in data being sent, deviating significantly from the host's normal baseline, provides strong evidence that the stolen credentials or other data are being exfiltrated."
    answer_sources:
      - "Windows Event ID 4663"
      - "Zeek conn.log"
      - "Network egress points, firewalls, and host-level event logs on all endpoints where SACL auditing for browser credential files is enabled."
    range: "last 90 days"
    queries:
      - "ML Platform & SIEM: ON EventID 4663 read by non-whitelisted process | MONITOR host's outbound bytes ('orig_bytes' from conn.log) | IF anomalous spike > 3 standard deviations above 24hr rolling average occurs within 10 minutes | GENERATE high-priority alert"