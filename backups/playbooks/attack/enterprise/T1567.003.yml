name: T1567.003: Exfiltration to Text Storage Sites
id: f47ac10b-58cc-4372-a567-0e02b2c3d479
description: This playbook addresses the Primary Information Requirement - Has an adversary successfully exfiltrated data by uploading it to a public or private text storage site? It provides investigative steps to detect this activity by monitoring for several key indicators. These include outbound network connections (HTTP POST or TLS) to known text storage sites; command-line executions using tools like cURL or PowerShell with data upload arguments targeting these sites; anomalous data upload volumes or connection frequencies from a single host; network connections to these sites originating from non-browser processes; and correlated event sequences where a process accesses a sensitive file and then immediately connects to a text storage site.
type: technique
related:
  - TA0010: Exfiltration
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
investigative_questions:
  - question: Are there any network connections to known text storage sites, particularly those involving HTTP POST requests?
    context: This question aims to identify direct network evidence of data exfiltration using a symbolic, rule-based approach. By maintaining a threat intelligence list of domains, IPs, and certificate subjects associated with text storage sites, analysts can create high-fidelity alerts. An HTTP POST method is a strong indicator that data is being uploaded from the internal network to the external site, which is the primary action of this exfiltration technique.
    answer_sources:
      - Zeek conn.log
      - Zeek http.log
      - Zeek ssl.log
      - Network Egress Points
      - DNS Servers
      - Web Proxies
      - SIEM/Log Aggregator
    range: last 90 days
    queries:
      - search: "Pseudocode: SEARCH network logs (Zeek conn, http, ssl) WHERE destination_ip OR destination_hostname OR ssl_server_name IN (threat_intel_list_of_text_sites). IF http_log, HIGHLIGHT where http_method is 'POST'."
  - question: Has any host uploaded an anomalously large amount of data to a known text storage site compared to its own baseline?
    context: This question uses a statistical approach to find outliers that might be missed by simple symbolic rules. By establishing a baseline of normal outbound data volume for each host, we can detect when a connection to a text storage site involves an upload size that is statistically significant (e.g., in the 99th percentile), suggesting a bulk data transfer characteristic of exfiltration.
    answer_sources:
      - Zeek conn.log
      - Zeek http.log
      - Zeek ssl.log
      - Network Egress Points
      - DNS Servers
      - Web Proxies
      - SIEM/Log Aggregator
    range: last 90 days
    queries:
      - search: "Pseudocode: FOR each host, CALCULATE 99th_percentile of orig_bytes over 30 days. SEARCH Zeek conn.log WHERE destination IN (text_site_list) AND orig_bytes > host_specific_99th_percentile_threshold. ALERT."
  - question: Can a machine learning model identify network connections to text storage sites that are characteristic of malicious exfiltration?
    context: This question leverages machine learning to build a more nuanced detection model than static rules or simple statistics. By training a classifier (like a random forest) on various network connection features (bytes sent/received, duration, protocol, etc.), the model can learn the subtle patterns that differentiate benign traffic from malicious exfiltration. This is particularly useful for detecting novel or obfuscated exfiltration techniques.
    answer_sources:
      - Zeek conn.log
      - Zeek http.log
      - Zeek ssl.log
      - Network Egress Points
      - DNS Servers
      - Web Proxies
      - SIEM/Log Aggregator
    range: last 90 days
    queries:
      - search: "Pseudocode: SCORE live network connections using pre-trained random_forest_classifier. FEATURES include orig_bytes, resp_bytes, duration, destination_is_text_site, etc. ALERT on connections with a high malicious_probability_score."
  - question: Are there any command-line executions that use tools like cURL or PowerShell to upload data to a known text storage site?
    context: This question focuses on detecting the specific commands an adversary might use to perform exfiltration. By searching for the co-occurrence of command-line utilities (`curl.exe`, `powershell.exe`), data upload flags (`-d`, `-Method Post`), and URLs of text storage sites in process and script block logs, analysts can pinpoint the exact moment of execution, providing strong evidence of the technique.
    answer_sources:
      - Windows Event ID 4688
      - Windows PowerShell Event ID 4104
      - User Workstations
      - Production Servers
      - Domain Controllers
    range: last 90 days
    queries:
      - search: "Pseudocode: SEARCH command_line_logs (EID 4688, 4104) FOR process_name IN (curl, powershell, wget) AND command_line CONTAINS (upload_flags) AND command_line CONTAINS (text_site_url). ALERT."
  - question: Are there any command-line executions involving text storage sites that have an unusually high entropy, suggesting obfuscation or embedded data?
    context: This question applies a statistical measure, Shannon entropy, to detect suspicious commands. Adversaries may encode or embed data directly into a command line, or heavily obfuscate it, which significantly increases its entropy. Alerting on high-entropy commands that also reference a text storage site can uncover attempts to hide exfiltration activity within command-line arguments.
    answer_sources:
      - Windows Event ID 4688
      - Windows PowerShell Event ID 4104
      - User Workstations
      - Production Servers
      - Domain Controllers
    range: last 90 days
    queries:
      - search: "Pseudocode: FOR each command_line_event, CALCULATE shannon_entropy of the command string. ESTABLISH baseline_entropy_mean and std_dev per host. ALERT if command_line contains (text_site_url) AND entropy > (mean + 3 * std_dev)."
  - question: Can a machine learning model detect anomalous command-line invocations of tools like cURL or PowerShell that might be used for exfiltration?
    context: This question proposes using an anomaly detection model, such as a one-class SVM, to identify unusual command-line usage. The model is trained exclusively on 'normal' activity. Any new command that deviates significantly from this learned normality is flagged as an outlier. This is effective for catching never-before-seen malicious commands, especially when combined with other indicators like the presence of a text storage site URL.
    answer_sources:
      - Windows Event ID 4688
      - Windows PowerShell Event ID 4104
      - User Workstations
      - Production Servers
      - Domain Controllers
    range: last 90 days
    queries:
      - search: "Pseudocode: SCORE live command_line_events using pre-trained one_class_svm model. ALERT on any command flagged as an outlier, especially if it contains a text_site_url."
  - question: Has any single host exceeded a hard threshold for connections or data volume to text storage sites?
    context: This question uses simple, static thresholds as a first line of defense. While less sophisticated, hard limits (e.g., >10 connections in an hour, >10MB upload in one go) can be effective for catching blatant or unsophisticated exfiltration attempts. These rules are easy to implement but must be tuned to the specific environment to avoid false positives.
    answer_sources:
      - Zeek conn.log
      - Zeek http.log
      - Network Egress Points
      - SIEM/Log Aggregator
    range: last 90 days
    queries:
      - search: "Pseudocode: COUNT connections per host to text_site_category in 1hr windows. ALERT if count > 10. ALSO, SEARCH connections to text_sites and ALERT if orig_bytes > 10MB."
  - question: Has any host's daily data upload volume to text storage sites exceeded its own statistical baseline?
    context: This question moves beyond static thresholds to a more dynamic, host-centric statistical model. By tracking each host's daily upload volume to text storage sites over a 30-day period, a baseline of normal behavior can be established using the interquartile range (IQR). This method is robust against outliers and can effectively identify a day where a host's activity is statistically anomalous.
    answer_sources:
      - Zeek conn.log
      - Zeek http.log
      - Network Egress Points
      - SIEM/Log Aggregator
    range: last 90 days
    queries:
      - search: "Pseudocode: FOR each host, CALCULATE 30-day baseline of daily_upload_volume to text_sites (Q1, Q3, IQR). ALERT if today's_volume > Q3 + (1.5 * IQR)."
  - question: Does the aggregate network traffic volume to all text storage sites show a deviation from the historically learned rhythm, as identified by a time-series model?
    context: This question applies machine learning at a network-wide level. A time-series model (like ARIMA) learns the normal ebb and flow of traffic to text storage sites for the entire organization. This is useful for detecting coordinated or widespread exfiltration campaigns that might not trigger single-host alerts but create a noticeable spike in aggregate traffic.
    answer_sources:
      - Zeek conn.log
      - Zeek http.log
      - Network Egress Points
      - SIEM/Log Aggregator
    range: last 90 days
    queries:
      - search: "Pseudocode: APPLY time-series anomaly detection model (e.g., ARIMA) to aggregate hourly data volume to text_sites. ALERT if current volume is outside the model's predicted confidence interval."
  - question: Has a network connection to a known text storage site been initiated by a process that is not an approved web browser?
    context: This question aims to find suspicious behavior by checking the source process of network connections. Most legitimate connections to text sites come from browsers. When a non-browser process like `powershell.exe` or `cscript.exe` makes such a connection, it is highly suspicious and often indicative of a script or malware performing automated exfiltration.
    answer_sources:
      - Windows Sysmon Event ID 3
      - Windows Sysmon Event ID 1
      - Zeek conn.log
      - User Workstations
      - Application Servers
      - SIEM for correlation
    range: last 90 days
    queries:
      - search: "Pseudocode: SEARCH Sysmon EID 3 events WHERE destination IN (text_site_list) AND process_name NOT IN (approved_browser_list). ALERT."
  - question: Has a rare or statistically improbable process-destination pairing occurred, such as svchost.exe connecting to a text storage site?
    context: This question uses statistical analysis to identify anomalous process behavior on a per-host basis. By profiling which processes normally connect to which types of destinations, we can identify rare events. A process like `svchost.exe` connecting to a text storage site is an extremely unusual pairing and would have a very low frequency in a historical dataset, indicating potential masquerading.
    answer_sources:
      - Windows Sysmon Event ID 3
      - Windows Sysmon Event ID 1
      - Zeek conn.log
      - User Workstations
      - Application Servers
      - SIEM for correlation
    range: last 90 days
    queries:
      - search: "Pseudocode: PROFILE process-to-destination_category pairings per host over 30 days. CALCULATE frequency of each pair. ALERT if a new connection to a text_site involves a process whose pairing frequency is below the 1st percentile."
  - question: Can a machine learning classifier identify network connections as suspicious based on features like the initiating process and destination reputation?
    context: This question employs a supervised machine learning model to classify network connections. By training a classifier with features like the process name, user context, destination port, and IP reputation, the model can make an intelligent prediction. This approach is more robust than a static 'approved list' as it can generalize to new processes and consider multiple factors simultaneously.
    answer_sources:
      - Windows Sysmon Event ID 3
      - Windows Sysmon Event ID 1
      - Zeek conn.log
      - User Workstations
      - Application Servers
      - SIEM for correlation
    range: last 90 days
    queries:
      - search: "Pseudocode: SCORE live Sysmon EID 3 events using a pre-trained classifier (e.g., Logistic Regression). FEATURES include process_name, user, destination_port, destination_reputation. ALERT on connections with high suspicious_probability."
  - question: Is there a correlated sequence of events where a process accesses a sensitive file and then connects to a text storage site within a short time window?
    context: This question seeks to connect data access with data exfiltration using a time-based correlation rule. An adversary's tool must first read sensitive data (generating a file access event) before sending it out (generating a network event). Looking for this sequence from the same process within a tight timeframe (e.g., 5 minutes) provides a high-fidelity indicator of theft.
    answer_sources:
      - Windows Event ID 4663
      - Windows Sysmon Event ID 11
      - Windows Sysmon Event ID 1
      - Windows Sysmon Event ID 3
      - Zeek conn.log
      - File Servers
      - Databases
      - User Workstations with access to sensitive data
      - SIEM for correlation
    range: last 90 days
    queries:
      - search: "Pseudocode: CORRELATE logs in SIEM. TRIGGER on (Event 4663/Sysmon 11 from sensitive_file) by ProcessGuid X. IF (Sysmon 3 from ProcessGuid X to text_site) occurs within 5 minutes, ALERT."
  - question: Has a statistically rare sequence of 'sensitive file access followed by connection to text site' occurred?
    context: This question applies a probabilistic lens to event sequences. For any given process that accesses a sensitive file, there is a certain historical probability that it will then connect to a text storage site (this should be near zero for legitimate processes). By calculating the conditional probability of observed sequences, we can alert when a rare and thus suspicious chain of events occurs.
    answer_sources:
      - Windows Event ID 4663
      - Windows Sysmon Event ID 11
      - Windows Sysmon Event ID 1
      - Windows Sysmon Event ID 3
      - Zeek conn.log
      - File Servers
      - Databases
      - User Workstations with access to sensitive data
      - SIEM for correlation
    range: last 90 days
    queries:
      - search: "Pseudocode: CALCULATE historical P(Connect to Text Site | Access Sensitive File) for processes. ALERT if this sequence occurs and its observed probability is in the bottom 1st percentile of all sequential behaviors."
  - question: Can a sequence analysis model (like an HMM or RNN) detect an anomalous chain of events indicative of data access followed by exfiltration?
    context: This question proposes using advanced machine learning models designed to understand sequences of events. Models like HMMs or RNNs can be trained on log data to learn 'normal' workflows. They can then identify a sequence like `powershell.exe` -> `access_customer_data.csv` -> `connect_to_pastebin.com` as a significant deviation from any learned legitimate behavior, providing a powerful method for detecting complex attack chains.
    answer_sources:
      - Windows Event ID 4663
      - Windows Sysmon Event ID 11
      - Windows Sysmon Event ID 1
      - Windows Sysmon Event ID 3
      - Zeek conn.log
      - File Servers
      - Databases
      - User Workstations with access to sensitive data
      - SIEM for correlation
    range: last 90 days
    queries:
      - search: "Pseudocode: FEED endpoint event logs into a sequence analysis model (HMM/RNN). ALERT when the model flags a sequence of events as anomalous, especially if it involves sensitive file access and outbound connections to text sites."