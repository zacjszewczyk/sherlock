name: T1213.004: Customer Relationship Management Software
id: a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d
description: "This playbook helps investigate if an adversary is collecting sensitive data from Customer Relationship Management (CRM) software. This involves detecting suspicious network connections to CRM assets from malicious IPs or anomalous geolocations, identifying non-standard user agents or command-line tools used for data export, analyzing user authentications for impossible travel or other behavioral anomalies, monitoring for unusually large data transfers, and identifying service accounts performing actions inconsistent with their intended function, such as spawning interactive shells."
type: technique
related:
  - TA0009: Collection
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Is a connection to a CRM asset originating from a known malicious IP address?
    context: This question aims to identify direct connections from adversary infrastructure to CRM systems. By cross-referencing connection source IPs with high-confidence threat intelligence feeds, analysts can quickly detect sessions from known command and control (C2) servers, proxies, or anonymization services like TOR, which are strong indicators of compromise.
    answer_sources:
      - Zeek conn.log
      - Firewall Logs
      - Network sensors at internet gateways, VPN termination points, and server farm segments hosting CRM infrastructure.
    range: last 90 days
    queries:
      - "Pseudocode: JOIN Zeek conn.log `id.orig_h` with threat intelligence IP list WHERE destination IP is a CRM asset."
  - question: Is a connection to a CRM asset originating from an anomalous Autonomous System Number (ASN)?
    context: This question helps detect suspicious connections that may not be on a known threat feed. Adversaries often use virtual private servers (VPS) for operations. By baselining normal source ASNs, analysts can flag connections from new, rare, or non-business related ASNs (e.g., those belonging to consumer ISPs or VPS providers not used by the organization), which could indicate malicious activity.
    answer_sources:
      - Zeek conn.log
      - Firewall Logs
      - Network sensors at internet gateways, VPN termination points, and server farm segments hosting CRM infrastructure.
    range: last 90 days
    queries:
      - "Pseudocode: BASELINE source ASNs for CRM connections over 30 days. ALERT on new connections from ASNs that are new or have a frequency below the 5th percentile."
  - question: Does a network session to a CRM asset exhibit characteristics of a malicious connection based on a machine learning model?
    context: This question uses a machine learning model to identify subtle malicious patterns that symbolic or simple statistical rules might miss. By training a model on features like connection duration, protocol, bytes transferred, and IP reputation, analysts can score new connections for their likelihood of being malicious, providing a more sophisticated and adaptive detection method.
    answer_sources:
      - Zeek conn.log
      - Firewall Logs
      - Network sensors at internet gateways, VPN termination points, and server farm segments hosting CRM infrastructure.
    range: last 90 days
    queries:
      - "Pseudocode: APPLY trained classification model to new CRM connection data. ALERT on connections with a high malicious probability score."
  - question: Is a programmatic access tool (e.g., curl, Python) making HTTP requests to a CRM web interface instead of a standard web browser?
    context: This question seeks to identify automated scripts or tools interacting with the CRM, which is often a precursor to data exfiltration. Adversaries use tools like cURL or Python scripts for data collection. Detecting their User-Agent strings in web logs is a strong indicator of non-standard, potentially malicious access.
    answer_sources:
      - Zeek http.log
      - WAF Logs
      - Reverse Proxy Logs
      - Log collectors for WAFs, reverse proxies, and web servers hosting the CRM application front-end.
    range: last 90 days
    queries:
      - "Pseudocode: SEARCH Zeek http.log `user_agent` field for values matching a deny-list (curl, Wget, python-requests) where destination is a CRM URL."
  - question: Is an unusually rare User-Agent string being used to access CRM web assets?
    context: This question identifies outliers in User-Agent strings to find potentially malicious tools that may not be on a known deny-list. Normal user traffic generates a high volume of common browser User-Agents. A very infrequent User-Agent could represent a custom adversary tool or a legitimate but unauthorized automation script that requires investigation.
    answer_sources:
      - Zeek http.log
      - WAF Logs
      - Reverse Proxy Logs
      - Log collectors for WAFs, reverse proxies, and web servers hosting the CRM application front-end.
    range: last 90 days
    queries:
      - "Pseudocode: CALCULATE frequency of User-Agents over 24 hours. ALERT on User-Agents below a 0.1% threshold that are not on an allow-list."
  - question: Are there clusters of HTTP requests to CRM assets that are anomalous compared to normal user browser activity?
    context: This question uses unsupervised machine learning to group HTTP requests by their characteristics (User-Agent, method, URI, etc.). The goal is to find small, distinct clusters or outliers that do not fit the large, dense clusters representing normal user behavior. These anomalous clusters often correspond to automated or malicious activity.
    answer_sources:
      - Zeek http.log
      - WAF Logs
      - Reverse Proxy Logs
      - Log collectors for WAFs, reverse proxies, and web servers hosting the CRM application front-end.
    range: last 90 days
    queries:
      - "Pseudocode: CLUSTER HTTP request features using DBSCAN. INVESTIGATE small clusters or outliers not associated with normal browser traffic."
  - question: Is a process being executed on a CRM server with command-line arguments indicative of a bulk data export?
    context: This question looks for direct evidence of data collection on a CRM server. Adversaries may use native database utilities (like `sqlcmd`, `mysqldump`) or scripting tools (like PowerShell) to query and export large amounts of data. Monitoring process creation events for specific commands and arguments (`SELECT *`, `> *.csv`, `-out-file`) can catch this activity in the act.
    answer_sources:
      - Windows Event ID 4688
      - Windows PowerShell Event ID 4104
      - On-premise CRM application servers, On-premise CRM database servers.
    range: last 90 days
    queries:
      - "Pseudocode: MONITOR Event IDs 4688 and 4104 on CRM servers for database utility processes with command-line arguments matching export patterns."
  - question: Is there a statistically unusual frequency or complexity of command-line executions on CRM servers?
    context: This question aims to detect anomalous command-line usage that might indicate malicious activity, such as data gathering or obfuscation. A sudden spike in the execution of database utilities or a sharp increase in the complexity (entropy) of command-line arguments can signal an adversary attempting to exfiltrate data or hide their commands from simple signature-based detection.
    answer_sources:
      - Windows Event ID 4688
      - Windows PowerShell Event ID 4104
      - On-premise CRM application servers, On-premise CRM database servers.
    range: last 90 days
    queries:
      - "Pseudocode: BASELINE command-line frequency and argument entropy. ALERT when execution frequency exceeds 3 standard deviations or entropy increases sharply."
  - question: Does a command-line execution on a CRM server match the profile of a known malicious command based on a machine learning model?
    context: This question uses a text classification model to distinguish between benign administrative commands and malicious ones. By training a model on labeled examples of both, analysts can automatically classify new, unseen command-line executions, enabling the detection of novel or slightly modified malicious commands that might evade static rules.
    answer_sources:
      - Windows Event ID 4688
      - Windows PowerShell Event ID 4104
      - On-premise CRM application servers, On-premise CRM database servers.
    range: last 90 days
    queries:
      - "Pseudocode: APPLY trained text classification model to new command-line data from Event ID 4688. ALERT on commands classified as malicious."
  - question: Did a user account log into a CRM asset from a geographically impossible location relative to their previous login?
    context: This question detects 'impossible travel' scenarios, which are a strong indicator of a compromised account. If a user logs in from one location and then logs in from a distant location in a timeframe that is physically impossible for travel, it strongly suggests that at least one of the sessions is from an unauthorized party.
    answer_sources:
      - Windows Event ID 4624
      - Zeek conn.log
      - Cloud Identity Provider Logs (e.g., Azure AD Sign-in Logs)
      - Domain Controllers, Cloud identity providers, VPN concentrators, and CRM application and database servers (for local account logins).
    range: last 90 days
    queries:
      - "Pseudocode: FOR each successful login (Event ID 4624), compare timestamp and IP geolocation with the previous login. ALERT if travel time is physically impossible."
  - question: Does a user's login to a CRM asset deviate significantly from their established behavioral baseline?
    context: This question identifies suspicious logins by scoring them against a user's normal behavior profile. Deviations such as logging in at an unusual time, from a rare country, or via a new device can be individually weak signals. However, by combining them into a cumulative risk score, analysts can detect high-risk logins that warrant investigation, even if no single attribute is definitively malicious.
    answer_sources:
      - Windows Event ID 4624
      - Zeek conn.log
      - Cloud Identity Provider Logs (e.g., Azure AD Sign-in Logs)
      - Domain Controllers, Cloud identity providers, VPN concentrators, and CRM application and database servers (for local account logins).
    range: last 90 days
    queries:
      - "Pseudocode: BASELINE user login behavior (hours, location, etc.). SCORE new logins based on deviations. ALERT when cumulative risk score is anomalous (>98th percentile)."
  - question: Is a user's login session to a CRM asset classified as an anomaly by a machine learning model?
    context: This question uses an anomaly detection model to identify logins that do not conform to a user's established pattern of activity. The model learns a user's normal behavior across multiple features (time, location, ASN). Any new login that the model flags as a significant outlier is a strong candidate for a compromised account, providing a more holistic detection than single-variable statistical checks.
    answer_sources:
      - Windows Event ID 4624
      - Zeek conn.log
      - Cloud Identity Provider Logs (e.g., Azure AD Sign-in Logs)
      - Domain Controllers, Cloud identity providers, VPN concentrators, and CRM application and database servers (for local account logins).
    range: last 90 days
    queries:
      - "Pseudocode: APPLY a trained one-class anomaly detection model (e.g., Isolation Forest) to new user login features. ALERT on logins classified as anomalies."
  - question: Has an excessive amount of data been transferred from a CRM server in a single session?
    context: This question aims to catch blatant data exfiltration by looking for unusually large data transfers. While some legitimate activities may involve large files, a massive data transfer (e.g., over 500 MB) in a single connection from a CRM server is highly suspicious and could represent the exfiltration of an entire database or a large portion of customer records.
    answer_sources:
      - Zeek conn.log
      - Zeek http.log
      - Firewall Logs
      - Network sensors (e.g., Zeek) or firewalls monitoring traffic flows to and from CRM servers and database backends.
    range: last 90 days
    queries:
      - "Pseudocode: MONITOR `resp_bytes` in Zeek conn.log for connections from CRM servers. ALERT if `resp_bytes` exceeds a large static threshold (e.g., 500 MB)."
  - question: Is a user's daily data egress volume from CRM servers a statistical outlier compared to their own history or their peer group?
    context: This question detects more subtle data exfiltration by baselining data transfer volumes. An adversary might try to steal data over time in smaller chunks. By tracking a user's daily egress and comparing it to their historical average and the behavior of their peers, analysts can spot individuals whose data transfer patterns are anomalously high, indicating potential data theft.
    answer_sources:
      - Zeek conn.log
      - Zeek http.log
      - Firewall Logs
      - Network sensors (e.g., Zeek) or firewalls monitoring traffic flows to and from CRM servers and database backends.
    range: last 90 days
    queries:
      - "Pseudocode: BASELINE user's daily data egress from CRM servers. ALERT if daily total exceeds 4 standard deviations above their moving average or is in the 99th percentile of their peer group."
  - question: Is the aggregate data egress volume from CRM servers significantly higher than the forecasted volume from a time series model?
    context: This question looks for anomalies in the overall data transfer patterns from the CRM infrastructure. A time series model can learn the normal rhythm of data flow, including daily and weekly cycles. A significant deviation from the forecasted volume, outside the expected confidence interval, can indicate a large-scale data exfiltration event affecting the entire system.
    answer_sources:
      - Zeek conn.log
      - Zeek http.log
      - Firewall Logs
      - Network sensors (e.g., Zeek) or firewalls monitoring traffic flows to and from CRM servers and database backends.
    range: last 90 days
    queries:
      - "Pseudocode: APPLY a time series forecasting model (e.g., SARIMA) to aggregate CRM egress data. ALERT when observed volume significantly exceeds the forecast."
  - question: Did a non-interactive CRM service account spawn an interactive shell or a reconnaissance tool?
    context: This question aims to detect the misuse of service accounts. Service accounts are designed for automated, predictable tasks. If a service account is observed spawning interactive processes like `cmd.exe` or `powershell.exe`, or running discovery tools like `whoami.exe` or `net.exe`, it is a very strong indicator that the account has been compromised and is being used by an adversary for lateral movement or reconnaissance.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 4663
      - Database Audit Logs
      - CRM application and database servers, Active Directory, Centralized logging server collecting database audit logs.
    range: last 90 days
    queries:
      - "Pseudocode: MONITOR Event ID 4688 for child processes like `cmd.exe` or `whoami.exe` spawned by known CRM service accounts."
  - question: Is a CRM service account accessing a statistically unusual number of distinct database tables?
    context: This question seeks to identify database enumeration activity by a compromised service account. A service account typically accesses a small, consistent set of tables required for its function. A sudden spike in the number of unique tables accessed can indicate that an adversary is using the account to map out the database schema in preparation for data theft.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 4663
      - Database Audit Logs
      - CRM application and database servers, Active Directory, Centralized logging server collecting database audit logs.
    range: last 90 days
    queries:
      - "Pseudocode: PROFILE the number of unique database tables accessed by a service account per hour. ALERT if the count exceeds the 99th percentile of its historical activity."
  - question: Is a CRM service account executing a sequence of processes that is highly improbable based on its normal behavior model?
    context: This question uses sequence analysis to detect anomalous behavior that may not be captured by looking at individual actions. By modeling the normal sequences of processes executed by a service account (e.g., using a Hidden Markov Model), analysts can identify new, low-probability sequences that indicate a deviation from its programmed function, suggesting a compromise.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 4663
      - Database Audit Logs
      - CRM application and database servers, Active Directory, Centralized logging server collecting database audit logs.
    range: last 90 days
    queries:
      - "Pseudocode: MODEL the sequence of process executions for a service account. ALERT if a new sequence has a very low probability of occurring based on the model."