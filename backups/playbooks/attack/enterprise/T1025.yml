name: "T1025: Data from Removable Media"
id: "a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d"
description: "This playbook helps investigate whether an adversary is collecting data from removable media. It looks for suspicious processes launched from removable drives, the use of file copy utilities to move data from removable media, high-volume file read access from these drives, and correlations between removable media access and subsequent data staging or exfiltration activities."
type: "technique"
related:
  - "TA0009: Collection"
contributors:
  - "Zachary Szewczyk"
  - "Ask Sage"
created: "2025-10-01"
modified: "2025-10-01"
version: "1.0"
tags: "none"
questions:
  - question: "Are processes being launched from removable media that are identified as known data collection tools by threat intelligence?"
    context: "This question aims to identify malware executed directly from a removable drive. Adversaries may place malicious tools on USB drives to facilitate data collection. By cross-referencing executed processes with threat intelligence feeds, we can quickly spot known malicious binaries."
    answer_sources: "Windows Event ID 4688, Windows Event ID 1 (Sysmon), Endpoints (desktops, laptops) with USB ports, physical servers with USB access, and virtual machine hosts with USB passthrough enabled."
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: |
          SELECT *
          FROM process_creation_logs
          WHERE process_path MATCHES '^[D-Z]:\\.*'
          AND (process_name IN threat_intel_feed OR process_hash IN threat_intel_feed)
  - question: "Are there any rare or high-entropy processes being executed from removable media across the enterprise?"
    context: "This question seeks to uncover unknown or custom malware that wouldn't be caught by threat intelligence. Adversaries often use tools that are unique to their campaign. By identifying processes that have executed on very few machines or have randomly generated filenames (high entropy), we can flag potential custom data theft tools."
    answer_sources: "Windows Event ID 4688, Windows Event ID 1 (Sysmon), Endpoints (desktops, laptops) with USB ports, physical servers with USB access, and virtual machine hosts with USB passthrough enabled."
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: |
          // Query 1: Rarity
          SELECT process_hash, COUNT(DISTINCT host) AS host_count
          FROM process_creation_logs
          WHERE process_path MATCHES '^[D-Z]:\\.*'
          GROUP BY process_hash
          HAVING host_count < 5
          
          // Query 2: Entropy
          SELECT process_name, CALCULATE_ENTROPY(process_name) AS entropy
          FROM process_creation_logs
          WHERE process_path MATCHES '^[D-Z]:\\.*'
          AND entropy > high_threshold
  - question: "Can we use a machine learning model to classify processes launched from removable media as benign or malicious?"
    context: "This question proposes a more advanced, behavioral approach. A machine learning model can learn the nuanced characteristics of legitimate versus malicious process executions from removable media, such as their parent process, command-line arguments, and whether they are digitally signed. This allows for the detection of novel threats that evade signature-based and simple statistical methods."
    answer_sources: "Windows Event ID 4688, Windows Event ID 1 (Sysmon), Endpoints (desktops, laptops) with USB ports, physical servers with USB access, and virtual machine hosts with USB passthrough enabled."
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: |
          // Model Application
          APPLY classification_model
          ON process_creation_events
          WHERE process_path MATCHES '^[D-Z]:\\.*'
          FEATURES (parent_process, cmd_line_entropy, path_depth, is_signed)
          PREDICT is_malicious
  - question: "Are built-in file copy utilities (like xcopy, robocopy, or PowerShell's Copy-Item) being used to move files from a removable drive?"
    context: "Adversaries may use legitimate system utilities ('living off the land') to copy data from a removable drive to a local staging area or a network share. This question focuses on detecting the explicit use of these tools for this purpose by inspecting their command-line arguments for a source path on a removable drive."
    answer_sources: "Windows Event ID 4688, Windows Event ID 1 (Sysmon), Windows Event ID 4104, Endpoints (desktops, laptops) with USB ports, and command-line/scripting log collection infrastructure."
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: |
          SELECT *
          FROM (cmd_line_logs, powershell_logs)
          WHERE (process_name IN ('xcopy.exe', 'robocopy.exe', 'powershell.exe'))
          AND command_line MATCHES REGEX 'source_path=([D-Z]:\\\\.*)'
  - question: "Has any user exhibited an unusual volume or frequency of file copy operations from removable media compared to their own or their peer group's baseline?"
    context: "This question aims to identify anomalous user behavior. While copying files from a USB drive can be a normal activity, a sudden, significant increase in the volume or frequency of these operations for a specific user can indicate automated data collection. Comparing activity to a user's own history and their peer group helps to surface meaningful deviations."
    answer_sources: "Windows Event ID 4688, Windows Event ID 1 (Sysmon), Windows Event ID 4104, Endpoints (desktops, laptops) with USB ports, and command-line/scripting log collection infrastructure."
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: |
          // Baselining and Detection
          CALCULATE baseline_daily_copy_volume_from_removable_media per user
          FOR each new copy_event:
            IF copy_event_volume > 95th_percentile(user_baseline):
              ALERT
  - question: "Can an anomaly detection model identify suspicious command-line usage for file copy operations originating from removable media?"
    context: "This question leverages machine learning to find unusual command-line patterns that go beyond simple volume metrics. An anomaly detection model can learn what normal administrative and user copy commands look like (in terms of flags, wildcards, path structures) and flag executions that deviate, potentially indicating an adversary's attempt at bulk data collection."
    answer_sources: "Windows Event ID 4688, Windows Event ID 1 (Sysmon), Windows Event ID 4104, Endpoints (desktops, laptops) with USB ports, and command-line/scripting log collection infrastructure."
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: |
          // Model Application
          APPLY anomaly_detection_model
          ON file_copy_commands_from_removable_media
          FEATURES (wildcard_count, recursive_flags, file_extension_types, path_depth_ratio)
          PREDICT is_anomalous
  - question: "Has any single process read an abnormally high number of files from a removable drive in a short period?"
    context: "This question seeks to detect 'smash and grab' data collection, where a malicious process rapidly reads many files from a connected drive. This requires object access auditing to be enabled for file reads on removable media. A simple threshold-based rule can effectively catch this brute-force activity."
    answer_sources: "Windows Event ID 4663, Endpoints and file servers where sensitive data is stored and where object access auditing (SACL) for removable media file reads is enabled."
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: |
          SELECT process_id, COUNT(file_path) AS read_count
          FROM file_access_logs (EventID 4663)
          WHERE access_type = 'ReadData'
          AND file_path MATCHES '^[D-Z]:\\.*'
          GROUP BY process_id, time_window(60s)
          HAVING read_count > 100
  - question: "Are there users exhibiting an unusually high rate of file access or accessing an unusually diverse set of file types from removable media?"
    context: "This question uses statistical analysis to find more subtle signs of data gathering. Instead of a fixed threshold, it looks for users whose file access rate from a removable drive is in the top percentile of their historical behavior. It also analyzes the variety of file extensions being accessed; high entropy (variety) can suggest indiscriminate collection rather than targeted work."
    answer_sources: "Windows Event ID 4663, Endpoints and file servers where sensitive data is stored and where object access auditing (SACL) for removable media file reads is enabled."
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: |
          // Query 1: Access Rate
          CALCULATE baseline_file_access_rate_from_removable_media per user
          ALERT if current_rate > 99th_percentile(user_baseline)
          
          // Query 2: File Type Entropy
          CALCULATE shannon_entropy(accessed_file_extensions) per user_session
          ALERT if entropy > high_threshold
  - question: "Can a sequence analysis model detect abnormal patterns in the sequence of files being accessed from a removable drive?"
    context: "This question applies advanced sequence modeling to understand the *pattern* of file access, not just the volume. A model like an LSTM autoencoder can learn what a normal sequence of file interactions looks like (e.g., opening a few related documents). It can then flag anomalous sequences, such as rapid, automated traversal of a directory tree, which is characteristic of malicious data collection scripts."
    answer_sources: "Windows Event ID 4663, Endpoints and file servers where sensitive data is stored and where object access auditing (SACL) for removable media file reads is enabled."
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: |
          // Model Application
          TRAIN LSTM_autoencoder ON benign_file_access_sequences
          APPLY model to new_user_sessions
          CALCULATE reconstruction_error
          ALERT if reconstruction_error > threshold
  - question: "Following a suspected data collection event from removable media, is there evidence of data being staged (archived) or exfiltrated (sent over the network)?"
    context: "This question links the initial collection activity to subsequent steps in the attack chain. By creating a correlation rule, we can automatically connect the dots between a removable media access event and follow-on actions like creating a .zip or .rar file or making a network connection to a suspicious destination. This provides much stronger evidence of malicious intent."
    answer_sources: "Zeek conn.log, Windows Event ID 4688, Windows Event ID 1 (Sysmon), Windows Event ID 4104, Network egress points (e.g., firewalls, proxies), DNS servers, and endpoints with direct internet access."
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: |
          // Stateful Correlation
          DEFINE rule:
            TRIGGER on 'Data from Removable Media' alert for a host.
            WITHIN 30 minutes, LOOK FOR:
              1. Process creation of ('7z.exe', 'rar.exe', 'tar.exe') on same host.
              OR
              2. Outbound network connection from same host to low_reputation_IP.
            IF found, GENERATE correlated_alert.
  - question: "Is there an anomalous spike in outbound network traffic from a host shortly after a file copy operation from a removable drive?"
    context: "This question provides a statistical method for linking collection to exfiltration. It establishes a baseline of normal outbound traffic volume for each host in the minutes following a file copy from a removable drive. A significant deviation from this baseline (e.g., 3 standard deviations above the mean) suggests that the copied data is being immediately exfiltrated."
    answer_sources: "Zeek conn.log, Windows Event ID 4688, Windows Event ID 1 (Sysmon), Windows Event ID 4104, Network egress points (e.g., firewalls, proxies), DNS servers, and endpoints with direct internet access."
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: |
          FOR each host:
            CALCULATE baseline_outbound_traffic_volume in 15min window after removable_media_copy.
          FOR each new copy_event:
            MEASURE outbound_traffic in next 15min.
            IF measured_traffic > (baseline_mean + 3 * baseline_std_dev):
              ALERT
  - question: "Can a graph-based model identify malicious sub-graphs of activity that form around a removable media access event?"
    context: "This question proposes a sophisticated, holistic approach using graph analytics. It models endpoint and network events as a large graph of interconnected entities (hosts, processes, IPs). When a removable media access occurs, we can analyze the 'neighborhood' of activity that forms around it in the next 30 minutes. A graph neural network can be trained to recognize the structural properties of a malicious sub-graph (e.g., one containing removable media access, an archiving process, and a rare external IP) and classify it accordingly."
    answer_sources: "Zeek conn.log, Windows Event ID 4688, Windows Event ID 1 (Sysmon), Windows Event ID 4104, Network egress points (e.g., firewalls, proxies), DNS servers, and endpoints with direct internet access."
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: |
          // Model Application
          ON removable_media_access_event:
            EXTRACT sub-graph of related events in next 30min (processes, network connections).
            APPLY GNN_classifier to sub-graph.
            PREDICT is_malicious_activity_cluster.