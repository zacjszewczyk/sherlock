name: T1505: Server Software Component
id: 2a7e58a2-9e1b-4f9c-8a3d-6b5c1f0e9d4a
description: This playbook helps investigators determine if an adversary is maintaining persistence by adding, modifying, or abusing server software components. This can manifest as new server-side scripting files (.aspx, .jsp, .php) being written to web directories by unusual processes, a web server process itself writing a new executable after an HTTP POST request, or server applications like IIS or SQL Server spawning command-line shells (cmd.exe, powershell.exe). Other indicators include new components making suspicious outbound network connections (e.g., to rare IPs or with beaconing patterns) or unauthorized changes being made to critical server configuration files like web.config or httpd.conf.
type: technique
related:
  - TA0003: Persistence
contributors:
  - Zachary Szewczyk
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Have any new files with server-side scripting extensions (.aspx, .jsp, .php, .dll) been created in web or application server directories, and do their hashes match known malicious indicators?
    context: This question aims to find known malicious web shells or backdoors planted by adversaries for persistence. By monitoring file creation events in sensitive web directories and comparing file hashes against threat intelligence feeds, analysts can quickly identify the use of known malicious tools.
    answer_sources:
      - Windows Event ID 4663
      - Windows Event ID 4688
      - Zeek files.log
      - Web root, application plugin, and server extension directories on public-facing and internal web/application servers (e.g., C:\inetpub\wwwroot\, /var/www/html/, SharePoint 'Layouts', Confluence 'plugins-installed').
    range: last 90 days
    queries:
      - technology: SIEM
        query: SEARCH file creation events (WinEventID 4663) in monitored web directories WHERE file extension IN (.aspx, .jsp, .php, .dll) | HASH file | LOOKUP hash against threat intelligence feed | ALERT on match

  - question: Have any files been written to sensitive web or application server directories by statistically rare parent processes or with uncommon file extensions?
    context: This question helps detect novel or unusual persistence methods that may not involve known malicious files. Adversaries might use legitimate but uncommon system utilities to place backdoors. By baselining normal file creation activity and flagging statistically infrequent events, analysts can uncover suspicious activity that deviates from the norm.
    answer_sources:
      - Windows Event ID 4663
      - Windows Event ID 4688
      - Zeek files.log
      - Web root, application plugin, and server extension directories on public-facing and internal web/application servers (e.g., C:\inetpub\wwwroot\, /var/www/html/, SharePoint 'Layouts', Confluence 'plugins-installed').
    range: last 90 days
    queries:
      - technology: UBA/Statistical Analysis Engine
        query: BASELINE parent process and file extension frequency for file writes in web directories over 90 days | FOR each new file write event, CALCULATE frequency percentile of parent process and file extension | ALERT if percentile < 5

  - question: Can a machine learning model classify any recent file creation events in web or application directories as potentially malicious based on features like the parent process, file path, size, and time?
    context: This question leverages a machine learning model to identify complex patterns indicative of malicious file placement that are difficult to define with simple rules. By training a classifier on a rich feature set, the model can learn the subtle characteristics of both legitimate and malicious file writes, providing a high-confidence alert when it identifies an event as likely malicious.
    answer_sources:
      - Windows Event ID 4663
      - Windows Event ID 4688
      - Zeek files.log
      - Web root, application plugin, and server extension directories on public-facing and internal web/application servers (e.g., C:\inetpub\wwwroot\, /var/www/html/, SharePoint 'Layouts', Confluence 'plugins-installed').
    range: last 90 days
    queries:
      - technology: Machine Learning Platform
        query: FOR each new file write event in web directories, EXTRACT features (parent process, path entropy, extension, size, time) | SCORE event with pre-trained Random Forest model | ALERT if classification is 'malicious' AND confidence > 0.9

  - question: Has a known web server process (e.g., w3wp.exe, httpd.exe) written a new script file to its own content directories?
    context: This question focuses on a common web shell deployment pattern where a vulnerability allows the web server process itself to write a malicious file to a directory it serves. Creating a specific rule for this behavior provides a high-fidelity alert for potential server compromise.
    answer_sources:
      - Windows Event ID 4663
      - Windows Event ID 4688
      - Zeek http.log
      - File systems of public-facing web servers, particularly world-writable directories and web root folders.
    range: last 90 days
    queries:
      - technology: SIEM
        query: SEARCH file creation events (WinEventID 4663) WHERE source process IN ('w3wp.exe', 'httpd.exe', 'tomcat.exe') AND file extension IN (.aspx, .php, .jsp) AND file path is within web root | ALERT on event

  - question: Has a web server process written a file with an unusually high filename entropy or a statistically outlier file size?
    context: This question seeks to identify programmatically generated or obfuscated web shells. Attackers often use random filenames to avoid detection, which results in high entropy. Similarly, a web shell might be unusually large or small compared to legitimate files of the same type. Flagging these statistical outliers can uncover suspicious files even if their content is unknown.
    answer_sources:
      - Windows Event ID 4663
      - Windows Event ID 4688
      - Zeek http.log
      - File systems of public-facing web servers, particularly world-writable directories and web root folders.
    range: last 90 days
    queries:
      - technology: UBA/Statistical Analysis Engine
        query: FOR each file written by a web server process, CALCULATE filename Shannon entropy and size standard deviation from mean | ALERT if entropy > 3.0 OR size STDEV > 3

  - question: Has an unsupervised anomaly detection model flagged any file-write activities by web server processes as anomalous?
    context: This question uses a machine learning approach to find unusual file-write events that don't fit the established pattern of normal server behavior. An Isolation Forest model can effectively identify outliers in multi-dimensional data (file path, extension, size, associated HTTP method), flagging suspicious activities that symbolic or simple statistical rules might miss.
    answer_sources:
      - Windows Event ID 4663
      - Windows Event ID 4688
      - Zeek http.log
      - File systems of public-facing web servers, particularly world-writable directories and web root folders.
    range: last 90 days
    queries:
      - technology: Machine Learning Platform
        query: FOR each new file write event by a web server process, SCORE event with pre-trained Isolation Forest model | ALERT on anomalous scores

  - question: Has a server application process spawned a sensitive utility like cmd.exe or powershell.exe with a command line that does not match an approved administrative script?
    context: This question looks for a classic sign of post-exploitation activity where an attacker, having compromised a server application, uses it to spawn a shell for further command execution. By creating a rule that filters for specific parent-child process relationships and excludes known good command lines, analysts can generate high-fidelity alerts for malicious activity.
    answer_sources:
      - Windows Event ID 4688
      - Process execution logs on all critical servers, including web servers, database servers, application servers, and domain controllers.
    range: last 90 days
    queries:
      - technology: SIEM
        query: SEARCH process creation (WinEventID 4688) WHERE parent IN ('w3wp.exe', 'sqlservr.exe', 'httpd.exe') AND child IN ('cmd.exe', 'powershell.exe', 'whoami.exe') AND command line NOT IN (allowlist) | ALERT on event

  - question: Has a server application process spawned a child process that has never been seen before or is statistically rare?
    context: This question helps detect novel or unusual execution chains initiated by a compromised server application. By baselining normal parent-child process relationships over time, any new or very infrequent combination can be flagged as a potential indicator of compromise, even if the child process itself is a legitimate system utility.
    answer_sources:
      - Windows Event ID 4688
      - Process execution logs on all critical servers, including web servers, database servers, application servers, and domain controllers.
    range: last 90 days
    queries:
      - technology: UBA/Statistical Analysis Engine
        query: BASELINE frequency of parent-child-argument combinations over 30 days | FOR each new process creation event, LOOKUP combination | ALERT if combination is new or in bottom 5th percentile of frequency

  - question: Has a machine learning model classified any parent-child process pairs originating from a server application as high-risk or malicious?
    context: This question employs a sophisticated, feature-based approach to detect malicious process execution. A supervised model can learn the subtle differences between benign and malicious activity by analyzing features like command-line length and entropy. This allows for more accurate detection of obfuscated or complex commands that might evade simpler detection methods.
    answer_sources:
      - Windows Event ID 4688
      - Process execution logs on all critical servers, including web servers, database servers, application servers, and domain controllers.
    range: last 90 days
    queries:
      - technology: Machine Learning Platform
        query: FOR each process creation event, EXTRACT features (parent, child, command-line length, command-line entropy, user) | SCORE with Gradient Boosting model | ALERT on high-risk scores

  - question: Has a critical server made an outbound connection to a destination IP or domain that matches a known C2 server, a newly registered domain (NRD), or a TOR exit node?
    context: This question aims to detect command-and-control (C2) communications from a newly installed malicious component. By correlating outbound network connections from servers against multiple threat intelligence feeds, analysts can identify connections to known malicious infrastructure, which is a strong indicator of compromise.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Windows Event ID 5156
      - Network traffic logs at the network egress and host-level network monitoring on critical servers.
    range: last 90 days
    queries:
      - technology: SIEM/Threat Intel Platform
        query: SEARCH outbound connections from critical servers (Zeek conn.log) | LOOKUP destination IP/domain against C2, NRD, and TOR exit node feeds | ALERT on match

  - question: Has a server process made an outbound connection to a statistically rare destination ASN, or exhibited periodic 'beaconing' behavior with low time-delta jitter?
    context: This question helps find C2 channels that do not use known malicious IPs. Adversaries may use previously unknown infrastructure. Detecting connections to rare Autonomous Systems (ASNs) can highlight this. Additionally, analyzing the timing between connections can reveal automated beaconing, a hallmark of malware C2, which has a very low standard deviation in its connection intervals.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Windows Event ID 5156
      - Network traffic logs at the network egress and host-level network monitoring on critical servers.
    range: last 90 days
    queries:
      - technology: UBA/Statistical Analysis Engine
        query: BASELINE destination ASN prevalence for server processes | ALERT if new connection's ASN is in lowest 1% | For repeating connections, CALCULATE standard deviation of time between connections | ALERT if STDEV is unusually low

  - question: Has a time-series model detected an anomalous spike in outbound data volume, or has a clustering algorithm identified anomalous connection patterns?
    context: This question uses machine learning to identify abnormal network behavior that might indicate data exfiltration or unusual C2 activity. A time-series model can detect sudden, unexpected increases in data transfer, while a clustering algorithm like DBSCAN can isolate small groups of connections that don't fit the profile of normal traffic based on their combined attributes (port, protocol, duration, etc.).
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Windows Event ID 5156
      - Network traffic logs at the network egress and host-level network monitoring on critical servers.
    range: last 90 days
    queries:
      - technology: Machine Learning Platform
        query: FORECAST hourly outbound data volume with SARIMA model | ALERT if actual volume exceeds 99% confidence interval | CLUSTER connection metadata with DBSCAN | ALERT on small, outlier clusters

  - question: Has a critical server configuration file (e.g., web.config, httpd.conf) been modified by a process not on an approved allowlist of administrative tools?
    context: This question targets unauthorized changes to sensitive configuration files, which could be used to weaken security or install backdoors. By enabling file system auditing and creating an allowlist of legitimate processes for modifications, any write access from an unapproved process becomes a high-fidelity alert for potential malicious activity.
    answer_sources:
      - Windows Event ID 4663
      - Windows Event ID 4688
      - File system audit logs on directories containing configuration files for all web, application, and database servers.
    range: last 90 days
    queries:
      - technology: SIEM
        query: SEARCH file modification events (WinEventID 4663) on critical config files | ALERT if ProcessName is NOT IN (allowlist of admin tools)

  - question: Has a critical configuration file been modified outside a defined maintenance window or by a user who has rarely or never modified it before?
    context: This question helps detect suspicious modifications by focusing on the context of the change. Adversaries or insiders may perform unauthorized changes at odd hours or using accounts not typically associated with such tasks. By baselining normal change patterns (when and by whom), deviations can be flagged as suspicious even if the tool used is legitimate.
    answer_sources:
      - Windows Event ID 4663
      - Windows Event ID 4688
      - File system audit logs on directories containing configuration files for all web, application, and database servers.
    range: last 90 days
    queries:
      - technology: UBA/Statistical Analysis Engine
        query: BASELINE modification times and user accounts for critical config files | ALERT if modification occurs outside maintenance window OR by a user who has never modified the file

  - question: Has an anomaly detection model flagged any configuration file modifications as suspicious due to a high reconstruction error?
    context: This question uses an advanced machine learning model (a variational autoencoder) to learn the deep, multi-dimensional profile of a 'normal' configuration file change, including user, source IP, process, and time. When a new modification event occurs that the model cannot accurately 'reconstruct' based on what it has learned, it is flagged as a high-confidence anomaly, indicating it deviates significantly from established legitimate behavior.
    answer_sources:
      - Windows Event ID 4663
      - Windows Event ID 4688
      - File system audit logs on directories containing configuration files for all web, application, and database servers.
    range: last 90 days
    queries:
      - technology: Machine Learning Platform
        query: FOR each config file modification, EXTRACT features (user, source IP, process, time) | SCORE event with pre-trained VAE model | ALERT on high reconstruction error