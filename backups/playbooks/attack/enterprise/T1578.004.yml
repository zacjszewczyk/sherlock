name: T1578.004: Revert Cloud Instance
id: 5e9b3a1c-8f7d-4b6e-9c0a-2d1f3e4c5d6b
description: This playbook helps investigate whether an adversary is attempting to evade defenses by reverting a cloud instance to a previous state. This technique is often used for anti-forensics, where an attacker reverts an instance to a clean snapshot to remove evidence of their activities, such as malware installation, user creation, or data staging. Indicators include the direct use of cloud restoration APIs (e.g., 'Restore-AzVM', 'ec2 restore-snapshot') followed by a system shutdown; a spike in network traffic to cloud management endpoints or the instance metadata service just before a shutdown; a verifiable gap in host-based logs that masks a period of malicious activity; a system's clock being set to a significantly earlier time; or a system restart occurring shortly after a high-severity security alert was triggered for that host.
type: technique
related:
- TA0005: Defense Evasion
contributors:
- Zachary Szewczyk
- Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
- question: Are adversaries restoring cloud snapshots or resetting instances and then shutting them down to hide their activity?
  context: This question looks for the most direct evidence of this technique. It seeks to identify the use of cloud provider APIs specifically designed for restoring or resetting an instance, and then correlates that action with a subsequent, nearby system shutdown or loss of heartbeat. This combination strongly suggests an attacker is covering their tracks by reverting the machine to a known-clean state after their objectives are met.
  answer_sources:
  - AWS CloudTrail
  - Azure Activity Logs
  - GCP Audit Logs
  - Windows Event ID 4688
  - Windows Event ID 1074
  - Cloud provider audit log streams (e.g., CloudTrail, Azure Monitor); Cloud-hosted virtual machines (Windows); Centralized SIEM/Log Management Platform
  range: last 90 days
  queries:
  - symbolic: "SEARCH cloud_provider_logs for events like 'RestoreSnapshot', 'RestoreFromSnapshot', 'ResetInstance'. | CORRELATE with host_logs from the same instance within 30 minutes for shutdown (Event ID 1074) or loss of telemetry."
- question: Is any single administrative user or role performing an unusually high number of snapshot or revert-related API calls, especially outside of normal business hours?
  context: This question focuses on behavioral anomaly detection. By establishing a normal baseline for how often each administrative user performs revert-related actions, we can spot outliers. A sudden spike in this activity from a single user, especially a user who rarely performs such actions or does so outside of standard maintenance windows, can indicate a compromised account being used to erase evidence of an attack.
  answer_sources:
  - AWS CloudTrail
  - Azure Activity Logs
  - GCP Audit Logs
  - Windows Event ID 4688
  - Windows Event ID 1074
  - Cloud provider audit log streams (e.g., CloudTrail, Azure Monitor); Cloud-hosted virtual machines (Windows); Centralized SIEM/Log Management Platform
  range: last 90 days
  queries:
  - statistical: "FOR each admin_user, CALCULATE baseline frequency of revert API calls over 90 days. | ALERT IF current_frequency > 95th percentile of baseline, especially if occurring outside of business hours."
- question: Can machine learning models classify cloud audit log events to distinguish between benign change management and suspicious instance revert activity?
  context: This question proposes a proactive, advanced detection method. A machine learning classifier can be trained on a wide array of features from cloud audit logs (e.g., user identity, source IP, time of day, specific API call) to learn the subtle differences between legitimate administrative tasks and malicious activity. This allows for the automatic flagging of revert events that fit a suspicious pattern, improving detection speed and accuracy.
  answer_sources:
  - AWS CloudTrail
  - Azure Activity Logs
  - GCP Audit Logs
  - Windows Event ID 4688
  - Windows Event ID 1074
  - Cloud provider audit log streams (e.g., CloudTrail, Azure Monitor); Cloud-hosted virtual machines (Windows); Centralized SIEM/Log Management Platform
  range: last 90 days
  queries:
  - machine_learning: "TRAIN a classification model on cloud audit logs with features like user, source IP, and time of day. | USE model to PREDICT if new revert events are 'benign' or 'suspicious'. | ALERT on 'suspicious' classifications."
- question: Is a host connecting to cloud management APIs shortly before it shuts down or its network traffic ceases?
  context: This question investigates preparatory activity. Before reverting an instance, an attacker might need to interact with cloud management APIs to identify the correct snapshot or configure the revert action. This query looks for a burst of connections to known cloud API endpoints followed closely by a system shutdown or a complete drop in network traffic from that host, which can indicate a scripted or manual revert process.
  answer_sources:
  - Zeek conn.log
  - Zeek dns.log
  - Windows Event ID 1074
  - Windows Event ID 6005
  - Windows Event ID 6006
  - Cloud environment network gateways; Virtual network flow log collectors; Centralized SIEM/Log Management Platform
  range: last 90 days
  queries:
  - symbolic: "SEARCH network_logs for connections to cloud management API domains. | IF followed within 10 minutes by a shutdown event (Event ID 1074) or abrupt traffic cessation for the source host, ALERT."
- question: Is a cloud instance exhibiting a statistically significant spike in connection count or data volume to cloud management API endpoints?
  context: This question uses statistical analysis to find anomalous network behavior. By baselining the normal hourly traffic patterns from each instance to cloud management APIs, a sudden, sharp increase in the number of connections or volume of data transferred can be flagged. Such a spike, particularly if it occurs outside of a planned change window, suggests an unusual level of interaction with the cloud control plane, which could be part of a revert operation.
  answer_sources:
  - Zeek conn.log
  - Zeek dns.log
  - Windows Event ID 1074
  - Windows Event ID 6005
  - Windows Event ID 6006
  - Cloud environment network gateways; Virtual network flow log collectors; Centralized SIEM/Log Management Platform
  range: last 90 days
  queries:
  - statistical: "FOR each instance, BASELINE hourly connection count and data volume to cloud mgmt APIs. | ALERT if count or volume exceeds 3 standard deviations above the historical mean."
- question: Can a time-series anomaly detection model identify unusual spikes in connections to the instance metadata service prior to a system shutdown?
  context: This question focuses on a specific, high-value target: the instance metadata service (169.254.169.254). Attackers often query this service to gather context about the instance they have compromised before taking further action. A time-series model can detect anomalous spikes in this activity. When such a spike is followed by a system shutdown, it strongly suggests an attacker was gathering information just before attempting to erase their tracks via a revert.
  answer_sources:
  - Zeek conn.log
  - Zeek dns.log
  - Windows Event ID 1074
  - Windows Event ID 6005
  - Windows Event ID 6006
  - Cloud environment network gateways; Virtual network flow log collectors; Centralized SIEM/Log Management Platform
  range: last 90 days
  queries:
  - machine_learning: "DEPLOY a time-series anomaly detection model on connections to 169.254.169.254 for each host. | CORRELATE detected anomalies with subsequent shutdown events or heartbeat loss for the same host."
- question: Following a high-confidence security alert, is there a gap in the host's logs that corresponds with a system restart, indicating a potential revert to hide activity?
  context: This question tries to retroactively discover a revert by identifying its primary side effect: a gap in logs. If a high-confidence alert (like C2 communication) is observed, but the detailed host logs for that specific time frame are missing and there's a system restart event (Event ID 1074) bracketing the gap, it is highly probable that the instance was reverted to destroy the on-box evidence that would have corroborated the initial alert.
  answer_sources:
  - Zeek conn.log
  - Zeek dns.log
  - Windows Event ID 1074
  - Windows Event ID 4688
  - Windows Event ID 4624
  - EDR Alerts
  - Centralized SIEM/Log Management Platform; Network sensor data lake; Cloud-hosted virtual machines (Windows)
  range: last 90 days
  queries:
  - symbolic: "ON high-confidence network/EDR alert, QUERY SIEM for host logs from 15 mins before/after alert. | IF logs are missing AND a restart event (1074) is present, ALERT for likely revert."
- question: Is there an anomalous delay in log ingestion from a host into the SIEM immediately following a system restart?
  context: This question uses SIEM ingestion metrics as a proxy for identifying log gaps. By establishing a baseline for how quickly a host begins sending logs again after a normal restart, we can detect anomalies. If, after a restart event, the time it takes to receive the first new log from the host significantly exceeds this baseline, it may indicate that the host was reverted to an older state, creating a time and log gap that manifests as an ingestion delay.
  answer_sources:
  - Zeek conn.log
  - Zeek dns.log
  - Windows Event ID 1074
  - Windows Event ID 4688
  - Windows Event ID 4624
  - EDR Alerts
  - Centralized SIEM/Log Management Platform; Network sensor data lake; Cloud-hosted virtual machines (Windows)
  range: last 90 days
  queries:
  - statistical: "FOR each host, BASELINE log ingestion delay post-restart (Event ID 1074). | ALERT if the delay after a new restart significantly exceeds the 95th percentile of the baseline."
- question: Does a time-series model forecasting log volume show a significant deficit in actual logs received from a host after a restart event?
  context: This question applies machine learning to log volume analysis. A time-series model can be trained to predict the expected volume of logs from a host per minute. After a restart, the model's forecast for the pre-restart period can be compared to the logs that were actually received. If the actual volume is significantly lower than predicted, it indicates a high probability of a log gap caused by an instance revert.
  answer_sources:
  - Zeek conn.log
  - Zeek dns.log
  - Windows Event ID 1074
  - Windows Event ID 4688
  - Windows Event ID 4624
  - EDR Alerts
  - Centralized SIEM/Log Management Platform; Network sensor data lake; Cloud-hosted virtual machines (Windows)
  range: last 90 days
  queries:
  - machine_learning: "TRAIN a time-series model to forecast log volume per minute for each host. | AFTER a restart, COMPARE actual ingested log volume from the pre-restart period to the forecast. | ALERT if actual volume is significantly less than predicted."
- question: Has a host's system time been set to a significantly earlier time, as indicated by Windows Event ID 4616?
  context: This question looks for a very specific and high-fidelity indicator of tampering. A Windows Event ID 4616 is generated whenever the system time is changed. A legitimate change (e.g., from an NTP sync) is typically small and moves the clock forward. If an event shows the 'NewTime' is chronologically *before* the 'PreviousTime', it indicates a deliberate time rollback. This is a rare and suspicious event, often associated with attempts to disrupt logging or evade time-based detections, and can be a side effect of a revert.
  answer_sources:
  - Windows Event ID 4616
  - Windows Event ID 6005
  - Windows Event ID 1074
  - Cloud-hosted virtual machines (Windows); Active Directory Domain Controllers; Centralized SIEM/Log Management Platform
  range: last 90 days
  queries:
  - symbolic: "SEARCH for Windows Event ID 4616 where the 'NewTime' field is chronologically earlier than the 'PreviousTime' field. | TRIGGER high-priority alert immediately."
- question: Are there any system time rollback events that are statistical outliers compared to normal NTP time corrections?
  context: This question adds statistical rigor to the detection of time changes. While small, legitimate time corrections happen frequently, a large, backward jump in time is highly abnormal. This query establishes a baseline for normal time correction deltas and then flags any backward change that is a statistical outlier (e.g., greater than 4 standard deviations from the mean, or a hard threshold like 5 minutes), effectively separating malicious rollbacks from routine clock drift.
  answer_sources:
  - Windows Event ID 4616
  - Windows Event ID 6005
  - Windows Event ID 1074
  - Cloud-hosted virtual machines (Windows); Active Directory Domain Controllers; Centralized SIEM/Log Management Platform
  range: last 90 days
  queries:
  - statistical: "ANALYZE time delta for all Event ID 4616 to baseline normal NTP corrections. | ALERT if a backward time change exceeds a dynamic threshold (e.g., 4 standard deviations from mean) or a hard threshold (e.g., >5 minutes)."
- question: Can a clustering algorithm automatically identify anomalous system time rollbacks by separating them from routine NTP adjustments?
  context: This question proposes using an unsupervised machine learning approach to find time-tampering events. A clustering algorithm like DBSCAN can group events based on their properties (e.g., size of the time jump, process making the change). Normal, frequent NTP adjustments will form a large, dense cluster, while rare, significant, manual rollbacks will be isolated by the algorithm as anomalous outliers, requiring no pre-defined thresholds.
  answer_sources:
  - Windows Event ID 4616
  - Windows Event ID 6005
  - Windows Event ID 1074
  - Cloud-hosted virtual machines (Windows); Active Directory Domain Controllers; Centralized SIEM/Log Management Platform
  range: last 90 days
  queries:
  - machine_learning: "APPLY a clustering algorithm (e.g., DBSCAN) to Event ID 4616 data. | Features should include time delta and the responsible process. | INVESTIGATE events classified as outliers/anomalies."
- question: Is a host being unexpectedly restarted within an hour after a high-severity security alert was triggered for it?
  context: This question uses temporal correlation between a known bad event and a potential cleanup action. The premise is that an attacker, upon realizing their activity has been detected (e.g., by an EDR alert), may panic and quickly try to destroy evidence by reverting the machine. This query creates a specific link between a security alert and a subsequent, unexpected restart, elevating the suspicion level for that restart event significantly.
  answer_sources:
  - Windows Event ID 1074
  - Zeek conn.log
  - EDR Alerts
  - IDS Alerts
  - Centralized SIEM/Log Management Platform; EDR Management Console; IDS/IPS Management Console
  range: last 90 days
  queries:
  - symbolic: "CREATE a correlation rule that listens for high-priority EDR/IDS alerts. | IF an alert for a host is followed within 60 minutes by an unexpected shutdown (Event ID 1074) for the same host, ESCALATE to a new alert."
- question: Is a host restarting with anomalous frequency in the 24 hours following a security alert, compared to its own baseline or its peer group?
  context: This question looks for a behavioral change in a host's stability following a security incident. A normal server has a predictable restart frequency (e.g., for weekly patching). If, in the 24-hour window after a security alert, that same host begins restarting far more frequently than its historical baseline, it suggests an ongoing struggle or repeated attempts at anti-forensics by an attacker.
  answer_sources:
  - Windows Event ID 1074
  - Zeek conn.log
  - EDR Alerts
  - IDS Alerts
  - Centralized SIEM/Log Management Platform; EDR Management Console; IDS/IPS Management Console
  range: last 90 days
  queries:
  - statistical: "CALCULATE baseline restart frequency per host. | MONITOR for hosts where the restart frequency in the 24 hours after a security alert is in the 99th percentile compared to its baseline."
- question: Based on a combination of evidence like a security alert followed by an unexpected restart, what is the calculated probability that an instance revert has occurred?
  context: This question proposes a sophisticated, probabilistic approach to detection. Using a model like a Bayesian network, we can formally calculate the likelihood of an instance revert given various pieces of evidence. The occurrence of a high-severity EDR alert would increase the probability of a revert; a subsequent unexpected restart would increase it further. This allows an analyst to move from correlation to causation, providing a confidence score for the hypothesis that a revert took place.
  answer_sources:
  - Windows Event ID 1074
  - Zeek conn.log
  - EDR Alerts
  - IDS Alerts
  - Centralized SIEM/Log Management Platform; EDR Management Console; IDS/IPS Management Console
  range: last 90 days
  queries:
  - machine_learning: "TRAIN a Bayesian network where 'Instance Revert' is a hypothesis node. | INPUT evidence like 'EDR Alert' and 'Unexpected Restart' as observed nodes. | ALERT if the posterior probability P(Revert|Evidence) crosses a high-confidence threshold (e.g., > 0.8)."