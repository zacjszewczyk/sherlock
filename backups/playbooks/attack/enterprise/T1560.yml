name: "T1560: Archive Collected Data"
id: "f8a9b7c6-d5e4-4f32-8a1b-9c8d7e6f5a4b"
description: "Identifies if an adversary has archived collected data prior to exfiltration. This involves detecting the creation of archive files (e.g., .zip, .rar), the execution of archival utilities from anomalous parent processes, the creation of unusually large or suspiciously located archives, processes performing mass file reads before archival, the loading of cryptographic libraries by unexpected processes, and outbound network traffic that correlates in size and time to the creation of a new archive."
type: "technique"
related:
  - "TA0009: Collection"
contributors:
  - "Zachary Szewczyk, Ask Sage"
created: "2025-10-01"
modified: "2025-10-01"
version: "1.0"
tags: "none"
questions:
  - question: "Are newly created archive files (e.g., .zip, .rar) associated with known malicious indicators?"
    context: "This question seeks to identify data archival by matching newly created files against threat intelligence. Adversaries often use known malware or predictable naming patterns for staging data. Detecting these files by hash or name can provide a high-fidelity signal of compromise."
    answer_sources:
      - "Windows Event ID 4688"
      - "Windows Event ID 4663"
      - "Sysmon Event ID 11"
      - "User workstations"
      - "Staging servers"
      - "Publicly accessible web servers"
      - "Temporary file system locations"
    range: "last 90 days"
    queries:
      - "pseudocode: Search file creation events for archive extensions. For each, compare file hash and filename against threat intelligence feeds and malicious regex patterns."
  - question: "Are archive files being created with unusually random or high-entropy filenames?"
    context: "This question aims to detect malware that uses randomized filenames to evade simple signature-based detection. Calculating the Shannon entropy of filenames helps identify names that don't follow normal linguistic patterns, which is a common characteristic of algorithmically generated names."
    answer_sources:
      - "Windows Event ID 4688"
      - "User workstations"
      - "Staging servers"
      - "Publicly accessible web servers"
      - "Temporary file system locations"
    range: "last 90 days"
    queries:
      - "pseudocode: From process creation logs, extract filenames from archiver command lines. Calculate Shannon entropy for each filename. Alert on high-entropy outliers."
  - question: "Can machine learning models classify archive creation events as benign or suspicious based on their context?"
    context: "This question leverages a machine learning model to analyze the full context of an archive creation event. By considering features like the creating process, parent process, command line, and target path, the model can identify complex, subtle patterns of malicious archival that might be missed by simpler rules."
    answer_sources:
      - "Windows Event ID 4688"
      - "Sysmon Event ID 11"
      - "User workstations"
      - "Staging servers"
      - "Publicly accessible web servers"
      - "Temporary file system locations"
    range: "last 90 days"
    queries:
      - "pseudocode: Feed file creation event features (process, parent, command line, path, entropy) into a trained random forest classifier. Alert on events classified as 'suspicious'."
  - question: "Are legitimate archival tools being launched by anomalous parent processes?"
    context: "This question focuses on 'living-off-the-land' techniques, where adversaries use legitimate system tools for malicious purposes. An archiver being spawned by a web server, system service, or office application, rather than a user shell, is highly indicative of automation or post-exploitation activity."
    answer_sources:
      - "Windows Event ID 4688"
      - "Domain Controllers"
      - "Application servers"
      - "User workstations"
      - "Web servers"
    range: "last 90 days"
    queries:
      - "pseudocode: Search process creation events where child is a known archiver and parent is on a watchlist (e.g., wmiprvse.exe, powershell.exe, svchost.exe)."
  - question: "Are there statistically rare parent-child process relationships involving archiver utilities?"
    context: "This question aims to identify unusual process lineage by baselining normal activity. A parent process that has rarely or never spawned an archiver before is a statistical anomaly. This can uncover novel attack chains that don't match predefined rules."
    answer_sources:
      - "Windows Event ID 4688"
      - "Domain Controllers"
      - "Application servers"
      - "User workstations"
      - "Web servers"
    range: "last 90 days"
    queries:
      - "pseudocode: For archiver executions, calculate the historical frequency of the parent-child pair. Alert on pairs that are statistically rare (e.g., bottom 5th percentile)."
  - question: "Can graph-based anomaly detection identify unusual process execution chains that result in data archival?"
    context: "This question uses a more advanced technique to analyze entire process execution trees. By modeling process relationships as a graph, it can detect structurally anomalous chains of execution, such as a multi-step 'living-off-the-land' attack that culminates in running an archiver."
    answer_sources:
      - "Windows Event ID 4688"
      - "Domain Controllers"
      - "Application servers"
      - "User workstations"
      - "Web servers"
    range: "last 90 days"
    queries:
      - "pseudocode: Model process parent-child relationships as a graph. Use an anomaly detection algorithm to find subgraphs where an archiver is created in a structurally unusual execution chain."
  - question: "Are archive files being created in unusual or sensitive system directories?"
    context: "This question identifies suspicious activity based on the location of created archives. Adversaries may write archives to temporary or system directories (e.g., C:\\Windows\\Temp, C:\\ProgramData) to evade detection or leverage existing permissions. Creation of archives in these non-standard locations is a strong indicator of malicious intent."
    answer_sources:
      - "Windows Event ID 4663"
      - "Windows Event ID 4656"
      - "Sysmon Event ID 11"
      - "File servers"
      - "User home directories"
      - "Shared network drives"
      - "Temporary file system locations (e.g., C:\\Windows\\Temp, %APPDATA%\\Local\\Temp)"
    range: "last 90 days"
    queries:
      - "pseudocode: Monitor file creation events for archives in a static list of suspicious directories (e.g., C:\\Windows\\System32, C:\\ProgramData). Alert on any match."
  - question: "Are newly created archive files unusually large compared to historical baselines for the host or user?"
    context: "This question seeks to detect bulk data collection by identifying outlier file sizes. An adversary collecting large amounts of data will create an archive significantly larger than those typically created during normal user activity. Baselining normal sizes per-host or per-user allows for dynamic, context-aware detection."
    answer_sources:
      - "Windows Event ID 4663"
      - "Windows Event ID 4656"
      - "Sysmon Event ID 11"
      - "File servers"
      - "User home directories"
      - "Shared network drives"
      - "Temporary file system locations (e.g., C:\\Windows\\Temp, %APPDATA%\\Local\\Temp)"
    range: "last 90 days"
    queries:
      - "pseudocode: For each host/user, baseline archive file sizes. Alert if a new archive's size exceeds a dynamic threshold (e.g., 3 standard deviations above the mean)."
  - question: "Does time-series analysis reveal an abnormal burst or rhythm of archive creation activity on a host?"
    context: "This question looks for anomalies in the timing and volume of archival activity. Malicious data collection often occurs as a sudden, intense burst of activity that is inconsistent with the normal, periodic rhythm of a system's operations. A time-series model can learn this normal rhythm and flag significant deviations."
    answer_sources:
      - "Windows Event ID 4663"
      - "Windows Event ID 4656"
      - "Sysmon Event ID 11"
      - "File servers"
      - "User home directories"
      - "Shared network drives"
      - "Temporary file system locations (e.g., C:\\Windows\\Temp, %APPDATA%\\Local\\Temp)"
    range: "last 90 days"
    queries:
      - "pseudocode: Use a time-series model (e.g., ARIMA) on the volume and count of archives created per host per hour. Alert on significant deviations from the predicted pattern."
  - question: "Is a process reading an abnormally high number of files from diverse directories shortly before creating an archive?"
    context: "This question directly targets the 'smash and grab' behavior of data collection, where a malicious process rapidly reads many files before compressing them. By correlating a high volume of file reads with a subsequent archive creation by the same process, this provides strong evidence of data staging."
    answer_sources:
      - "Windows Event ID 4663"
      - "Windows Event ID 4688"
      - "Sysmon Event ID 11"
      - "Sensitive data repositories (e.g., SharePoint sites, finance department file shares)"
      - "User workstations of executives or developers"
      - "Database servers"
    range: "last 90 days"
    queries:
      - "pseudocode: Correlate events where a single PID performs >1000 file reads in <5 mins, followed by that PID (or its child) creating an archive file."
  - question: "Is a process accessing files from a wide and random-seeming set of directories before creating an archive?"
    context: "This question identifies processes that are 'trawling' the file system for data. A legitimate process usually accesses files in a few predictable locations. High entropy in the directory paths being read indicates the process is accessing many different, unrelated locations, which is characteristic of a data collection script."
    answer_sources:
      - "Windows Event ID 4663"
      - "Sysmon Event ID 11"
      - "Sensitive data repositories (e.g., SharePoint sites, finance department file shares)"
      - "User workstations of executives or developers"
      - "Database servers"
    range: "last 90 days"
    queries:
      - "pseudocode: Calculate Shannon entropy of directory paths read by a process in a time window. Alert on high-entropy outliers, especially if followed by archive creation."
  - question: "Can a sequence-based model detect the anomalous pattern of 'many file reads followed by one archive write'?"
    context: "This question uses a model that understands the order of operations. By learning normal sequences of file system events (read, write, create), it can identify a sequence that matches the malicious pattern of mass-reading followed by archival, even if the individual events are not anomalous on their own."
    answer_sources:
      - "Windows Event ID 4663"
      - "Windows Event ID 4688"
      - "Sysmon Event ID 11"
      - "Sensitive data repositories (e.g., SharePoint sites, finance department file shares)"
      - "User workstations of executives or developers"
      - "Database servers"
    range: "last 90 days"
    queries:
      - "pseudocode: Use a sequence-based model (e.g., HMM, RNN) to analyze file system event sequences per process. Alert on low-likelihood sequences matching the 'many reads -> one archive write' pattern."
  - question: "Are non-allowlisted processes loading cryptographic libraries?"
    context: "This question aims to detect the use of encryption to protect or password-protect collected data. Adversaries may use custom tools or scripts that load system cryptographic libraries. If a process that is not a known, legitimate application (like a browser or VPN client) loads a crypto DLL, it is highly suspicious."
    answer_sources:
      - "Sysmon Event ID 7"
      - "Windows Event ID 4688"
      - "All endpoints and servers, especially critical servers like Domain Controllers and Certificate Authorities"
    range: "last 90 days"
    queries:
      - "pseudocode: Monitor image load events for crypto DLLs. Alert if the loading process is not on an established allowlist."
  - question: "Are there statistically rare combinations of processes loading cryptographic libraries?"
    context: "This question identifies novel or unusual uses of cryptographic functions. By baselining which processes normally load which crypto DLLs, any new or infrequent pairing can be flagged. This is effective for detecting when a legitimate but rarely-used process is hijacked, or a new malicious tool is introduced."
    answer_sources:
      - "Sysmon Event ID 7"
      - "All endpoints and servers, especially critical servers like Domain Controllers and Certificate Authorities"
    range: "last 90 days"
    queries:
      - "pseudocode: Maintain a baseline of (Process, Crypto DLL) pairs. Alert when a statistically rare pair is observed."
  - question: "Can a machine learning model distinguish between benign and anomalous loading of cryptographic libraries?"
    context: "This question uses a model to learn the complex context of 'normal' crypto library usage. By creating a boundary around benign events based on features like process path, parent, and command line, the model can flag any new event that falls outside this boundary as a potential anomaly, without needing pre-defined rules."
    answer_sources:
      - "Sysmon Event ID 7"
      - "Windows Event ID 4688"
      - "All endpoints and servers, especially critical servers like Domain Controllers and Certificate Authorities"
    range: "last 90 days"
    queries:
      - "pseudocode: Train a one-class SVM or Isolation Forest on features of benign crypto library load events. Alert on any new event that the model flags as an outlier."
  - question: "Is a large outbound network transfer observed shortly after a large archive file is created on the source host?"
    context: "This question directly links the data staging (archival) to the exfiltration (network transfer). Correlating the creation of a large archive with a subsequent network flow of a nearly identical size is one of the strongest possible indicators of data exfiltration."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek notice.log"
      - "Sysmon Event ID 11"
      - "Network egress points (monitored by Zeek)"
      - "Internal hosts (endpoints and servers)"
      - "Firewall and proxy servers"
    range: "last 90 days"
    queries:
      - "pseudocode: Correlate file creation events with network flow logs. Alert if an archive >50MB is created, followed within 15 mins by an outbound flow from the same host with a size matching the file (+/- 10%)."
  - question: "Is a host sending an unusually large amount of data to a rare or never-before-seen destination after creating a large archive?"
    context: "This question adds reputational and historical context to the network exfiltration. An adversary's command-and-control server or drop zone is unlikely to be a common destination for the organization. Detecting a large data transfer to a new or rare destination, especially after data staging, increases confidence that the activity is malicious."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek notice.log"
      - "Sysmon Event ID 11"
      - "Network egress points (monitored by Zeek)"
      - "Internal hosts (endpoints and servers)"
      - "Firewall and proxy servers"
    range: "last 90 days"
    queries:
      - "pseudocode: Following a large archive creation, monitor outbound flows. Calculate a rarity score for the destination IP. Alert on large transfers to rare destinations."
  - question: "Does a regression model predict a significant and unexplained spike in outbound traffic from a host that recently created a large archive?"
    context: "This question uses a predictive model to identify abnormal network behavior. The model learns a host's normal traffic patterns. The recent creation of a large archive is then used as a feature. If the model sees a huge spike in traffic that it cannot explain with normal patterns, but which coincides with the archive creation, it can flag this as a highly suspicious exfiltration event."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek notice.log"
      - "Sysmon Event ID 11"
      - "Network egress points (monitored by Zeek)"
      - "Internal hosts (endpoints and servers)"
      - "Firewall and proxy servers"
    range: "last 90 days"
    queries:
      - "pseudocode: Use a regression model to predict outbound traffic volume. Add 'recent large archive created' as a feature. Alert if actual traffic significantly exceeds the prediction when this feature is true."