name: T1583.001: Domains
id: f47ac10b-58cc-4372-a567-0e02b2c3d479
description: This playbook helps determine if an adversary is acquiring or using malicious domains to support operations. It provides investigative questions to detect malicious domains by matching against threat intelligence feeds, identifying typosquatted or visually similar domains, flagging newly registered domains with suspicious TLS certificate attributes, detecting Domain Generation Algorithm (DGA) activity through high volumes of NXDOMAIN responses, and identifying Command and Control (C2) beaconing behavior.
type: technique
related:
  - TA0042: Resource Development
contributors:
  - Zachary Szewczyk
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Is an internal host communicating with a domain known to be malicious based on threat intelligence feeds?
    context: This involves real-time matching of DNS queries or network connections against a high-confidence list of malicious domains. An alert signifies direct communication with a known threat, which could be the result of a phishing click, malware C2, or other malicious activity.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - Corporate DNS Resolvers
      - Egress Web Proxies
      - Network Security Monitoring (NSM) Sensors
      - Firewall Egress Logs
      - Threat Intelligence Feeds
    range: last 90 days
    queries:
      - pseudocode: SEARCH dns_logs OR network_logs WHERE domain IN threat_intel_domain_list OR destination_ip IN threat_intel_ip_list
  - question: Has any internal host communicated with multiple unique malicious domains in a short time frame?
    context: This question aims to identify hosts that are likely compromised, as opposed to isolated, accidental clicks. Contacting multiple distinct malicious domains in a short window (e.g., 5 minutes) strongly suggests automated malicious activity, such as a malware infection attempting to connect to various C2 servers.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - Corporate DNS Resolvers
      - Egress Web Proxies
      - Network Security Monitoring (NSM) Sensors
      - Firewall Egress Logs
      - Threat Intelligence Feeds
    range: last 90 days
    queries:
      - pseudocode: SEARCH dns_logs OR network_logs | WHERE domain IN threat_intel_domain_list | GROUP BY source_ip, 5_minute_window | COUNT unique domains | WHERE unique_domain_count > 3
  - question: Has there been an anomalous enterprise-wide spike in communications to known malicious domains?
    context: This question shifts the focus from individual hosts to the entire organization to detect large-scale campaigns. A sudden, statistically significant increase in the total number of threat intelligence matches across the network can be an early indicator of a widespread phishing attack or a new malware outbreak.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - Corporate DNS Resolvers
      - Egress Web Proxies
      - Network Security Monitoring (NSM) Sensors
      - Firewall Egress Logs
      - Threat Intelligence Feeds
    range: last 90 days
    queries:
      - pseudocode: SEARCH threat_intel_matches | TIME_SERIES count by hour | DETECT ANOMALIES where count > 3_std_dev_from_24hr_avg
  - question: Is an internal host communicating with a pre-identified typosquatted or homograph version of our corporate domains?
    context: This question focuses on detecting impersonation attacks that use domains visually similar to legitimate ones. By pre-computing a list of likely typosquats and homographs and alerting on exact matches, security teams can quickly identify potential phishing or credential theft attempts.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - Corporate DNS Resolvers
      - Mail Gateway Logs
      - Egress Web Proxies
      - Endpoint DNS Cache
      - Network Security Monitoring (NSM) Sensors
      - Pre-computed typosquat list
    range: last 90 days
    queries:
      - pseudocode: SEARCH dns_logs WHERE query_domain IN precomputed_typosquat_list
  - question: Are internal hosts accessing domains that are algorithmically similar to our corporate domains but also contain unusual characters?
    context: This question seeks to dynamically identify potential typosquatted domains that were not pre-computed. A domain that is only one or two characters different from a legitimate one (low Levenshtein distance) but has a high percentage of non-alphanumeric characters is highly suspicious.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - Corporate DNS Resolvers
      - Mail Gateway Logs
      - Egress Web Proxies
      - Endpoint DNS Cache
      - Network Security Monitoring (NSM) Sensors
    range: last 90 days
    queries:
      - pseudocode: SEARCH dns_logs | CALCULATE levenshtein_distance from corporate_domains | WHERE distance IN [1, 2] | CALCULATE non_alnum_char_percentage | WHERE percentage > 10
  - question: Are internal hosts accessing domains that a machine learning model identifies as having a high probability of being a typosquat?
    context: This question leverages machine learning to automate the detection of typosquatting at scale. By training a model on features like n-gram frequency, entropy, and domain length, it can identify complex and novel typosquatting techniques that simpler heuristics might miss.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - Corporate DNS Resolvers
      - Mail Gateway Logs
      - Egress Web Proxies
      - Endpoint DNS Cache
      - Network Security Monitoring (NSM) Sensors
      - Machine Learning Model
    range: last 90 days
    queries:
      - pseudocode: STREAM dns_logs | APPLY ML_model to domain | WHERE typosquat_probability > 0.9
  - question: Is an internal host making a TLS connection to a recently registered domain using a free, short-lived certificate?
    context: Adversaries often use newly registered domains (e.g., < 30 days old) and secure them with free, short-validity certificates (e.g., < 90 days). This combination of indicators is a strong signal of malicious infrastructure.
    answer_sources:
      - Zeek dns.log
      - Zeek ssl.log
      - Zeek conn.log
      - Egress Web Proxies
      - Corporate DNS Resolvers
      - Certificate Transparency Log Feeds
      - Network Security Monitoring (NSM) Sensors
      - Passive DNS / WHOIS data
    range: last 90 days
    queries:
      - pseudocode: SEARCH ssl_logs | ENRICH with domain_registration_date | WHERE registration_age < 30_days AND issuer IS free_CA AND cert_validity <= 90_days
  - question: Are internal hosts connecting to external domains that have a high aggregate risk score based on age, WHOIS privacy, and TLS issuer?
    context: This question uses a risk-scoring model to flag suspicious domains. It aggregates weak signals (e.g., recent registration, private WHOIS, free CA) into a stronger, composite score. Connections to domains exceeding a statistical threshold are prioritized for review.
    answer_sources:
      - Zeek dns.log
      - Zeek ssl.log
      - Zeek conn.log
      - Egress Web Proxies
      - Corporate DNS Resolvers
      - Certificate Transparency Log Feeds
      - Network Security Monitoring (NSM) Sensors
      - WHOIS data
    range: last 90 days
    queries:
      - pseudocode: SEARCH network_connections | ENRICH with whois_data, tls_data | CALCULATE risk_score based on age, privacy, issuer | WHERE risk_score > 95th_percentile_of_last_24h
  - question: Are internal hosts connecting to domains that group with known malicious domains based on shared infrastructure characteristics?
    context: This question leverages unsupervised machine learning (clustering) to discover 'guilt by association.' By clustering domains based on features like registration age, ASN, and TLS attributes, it can identify groups of related malicious infrastructure.
    answer_sources:
      - Zeek dns.log
      - Zeek ssl.log
      - Zeek conn.log
      - Egress Web Proxies
      - Corporate DNS Resolvers
      - Certificate Transparency Log Feeds
      - Network Security Monitoring (NSM) Sensors
      - ASN Reputation Data
    range: last 90 days
    queries:
      - pseudocode: STREAM network_connections | EXTRACT domain_features (age, TLD, ASN, TLS) | APPLY clustering_model | IF domain_in_malicious_cluster, ALERT
  - question: Is a process on an internal host generating a high rate of non-existent domain (NXDOMAIN) errors?
    context: This question aims to detect Domain Generation Algorithms (DGAs). A high frequency of NXDOMAIN responses (> 20 in 60 seconds) from a single host is a classic DGA indicator. Correlating this network activity with the responsible process on the endpoint helps confirm if the activity is malicious.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - Windows Event ID 4688
      - Endpoint Processes
      - Corporate DNS Resolvers
      - Domain Controllers
      - Endpoint DNS Cache
    range: last 90 days
    queries:
      - pseudocode: SEARCH dns_logs for NXDOMAIN | GROUP BY source_ip, 60_sec_window | WHERE count > 20 | CORRELATE with process_logs on source_ip and timestamp | WHERE process_name NOT IN allowlist
  - question: Is any internal host exhibiting both a high ratio of NXDOMAIN errors and high-entropy domain queries compared to its own baseline?
    context: This provides a more robust method for detecting DGAs by combining the failure rate of DNS lookups with the randomness (Shannon entropy) of the domain names being queried. An alert based on a host deviating significantly from its own normal behavior in both metrics is a high-fidelity signal of malware.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - Windows Event ID 4688
      - Endpoint Processes
      - Corporate DNS Resolvers
      - Domain Controllers
      - Endpoint DNS Cache
    range: last 90 days
    queries:
      - pseudocode: SEARCH dns_logs | GROUP BY source_ip, 5_min_window | CALCULATE nxdomain_ratio and avg_entropy | WHERE nxdomain_ratio > 99th_percentile AND avg_entropy > 99th_percentile
  - question: Are internal hosts attempting to resolve domains that a deep learning model classifies as likely machine-generated (DGA)?
    context: This question applies advanced machine learning to classify domain names themselves. Deep learning models can learn the complex patterns of DGA-generated names. Classifying a domain as DGA with high confidence, especially when the lookup fails, provides a very direct signal for identifying infected hosts.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - Windows Event ID 4688
      - Endpoint Processes
      - Corporate DNS Resolvers
      - Domain Controllers
      - Endpoint DNS Cache
      - Deep Learning DGA Model
    range: last 90 days
    queries:
      - pseudocode: STREAM dns_logs | APPLY deep_learning_model to query_name | WHERE classification IS 'DGA' AND confidence > 0.95 AND response IS 'NXDOMAIN'
  - question: Are internal hosts using common application protocols over non-standard ports?
    context: This helps to identify C2 communication that is disguised by running over an unexpected port (e.g., HTTP traffic over port 8888). Alerting on this mismatch, while excluding known good exceptions, can uncover hidden C2 channels.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Windows Event ID 4688
      - Firewall Egress Logs
      - Egress Web Proxies
      - Network Sensor Taps
      - Endpoint Process Execution Logs
    range: last 90 days
    queries:
      - pseudocode: SEARCH network_logs | WHERE protocol_identified != default_port_for_protocol | EXCLUDE known_exceptions
  - question: Are there any highly periodic network connections (beacons) or connections with anomalously large data transfers from an internal host to an external destination?
    context: This question looks for two classic signs of C2 beaconing. First, automated malware often connects back to its C2 server at very regular intervals (low jitter). Second, data exfiltration or payload delivery can result in unusually large data transfers compared to a baseline.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Windows Event ID 4688
      - Firewall Egress Logs
      - Egress Web Proxies
      - Network Sensor Taps
      - Endpoint Process Execution Logs
    range: last 90 days
    queries:
      - pseudocode: SEARCH network_logs by src_dst_pair over 24h | CALCULATE time_delta_std_dev (jitter) | WHERE jitter < 1_sec | OR | SEARCH network_logs | WHERE sent_bytes > 95th_percentile_for_port
  - question: Are there network connections that are highly anomalous when compared to a machine learning model of normal network behavior?
    context: This question uses an autoencoder to learn what 'normal' network traffic looks like based on features like duration and bytes transferred. When a new connection cannot be accurately reconstructed by the model, it results in a high reconstruction error, flagging it as an anomaly and potential C2.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Windows Event ID 4688
      - Firewall Egress Logs
      - Egress Web Proxies
      - Network Sensor Taps
      - Endpoint Process Execution Logs
      - Autoencoder Model
    range: last 90 days
    queries:
      - pseudocode: STREAM network_connections | APPLY autoencoder_model | CALCULATE reconstruction_error | WHERE error > 99th_percentile_of_training_data