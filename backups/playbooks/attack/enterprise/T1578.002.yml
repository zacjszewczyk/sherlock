name: T1578.002: Create Cloud Instance
id: 1a8d4c9e-5b6f-4a3c-8d2e-1f9a0b8c7d6e
description: This playbook helps investigate whether an adversary is creating new cloud instances as part of a defense evasion strategy or to stage data. It addresses several key indicators of malicious activity, including instance creation from known malicious IP addresses or using unapproved public images; the use of suspicious instance names, tags, or User-Agent strings indicating tool usage or obfuscation; provisioning by dormant, newly created, or anomalously high-rate user principals; the creation of instances with statistically rare configurations like unused regions or overly permissive security groups; and suspicious sequences of API calls that suggest automated data staging or exfiltration.
type: technique
related:
- TA0005: Defense Evasion
contributors:
- Zachary Szewczyk
- Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
- question: Is a new cloud instance being created from a known malicious IP address or using a public image from a deny-list?
  context: This question aims to detect instance creation originating from infrastructure known to be associated with malicious actors or using pre-configured virtual machine images that are known to be malicious. A match on either a threat intelligence feed for the source IP or an internal deny-list for the image ID is a high-confidence indicator of an adversary's presence.
  answer_sources:
  - AWS CloudTrail
  - Azure Activity Logs
  - GCP Admin Activity audit logs
  - Threat Intelligence Feed
  - Zeek conn.log
  - Cloud provider management plane API endpoints, Threat Intelligence Platform, Internet Gateway
  range: last 90 days
  queries:
  - pseudocode: SEARCH cloud_audit_logs FOR instance_creation | JOIN sourceIPAddress with threat_intelligence_feed | ALERT on match
  - pseudocode: SEARCH cloud_audit_logs FOR instance_creation | LOOKUP imageId against image_deny_list | ALERT on match
- question: Is a new cloud instance being initiated from a geographically or network-wise anomalous location (ASN, country) compared to our organization's baseline?
  context: This question helps identify unusual activity that deviates from normal operational patterns. An adversary might operate from a region or Autonomous System Number (ASN) where the organization has no business presence. Flagging instance creation from these statistically rare sources helps to surface activity that is abnormal for the organization and potentially malicious.
  answer_sources:
  - AWS CloudTrail
  - Azure Activity Logs
  - GCP Admin Activity audit logs
  - Threat Intelligence Feed
  - Zeek conn.log
  - Cloud provider management plane API endpoints, Threat Intelligence Platform, Internet Gateway
  range: last 90 days
  queries:
  - pseudocode: SEARCH cloud_audit_logs FOR instance_creation | ENRICH sourceIPAddress with ASN and geolocation | CALCULATE frequency of ASN and country over last 90 days | FILTER where ASN_frequency < 1% OR country_frequency < 1%
- question: Does a machine learning model classify a new instance creation event as malicious based on its collective features?
  context: This question leverages machine learning to find complex patterns that simple rules might miss. By combining features like source IP geolocation, ASN, image owner, image public/private status, and time of day, a classification model can provide a probabilistic assessment of risk, allowing analysts to focus on the most likely threats that may not trigger any single, specific rule.
  answer_sources:
  - AWS CloudTrail
  - Azure Activity Logs
  - GCP Admin Activity audit logs
  - Threat Intelligence Feed
  - Zeek conn.log
  - Cloud provider management plane API endpoints, Threat Intelligence Platform, Internet Gateway
  range: last 90 days
  queries:
  - pseudocode: FOR each instance_creation_event | EXTRACT features (source_geo, asn, image_owner, time_of_day) | PREDICT with classification_model | IF prediction is 'malicious' AND confidence > 85% THEN ALERT
- question: Does the name, tag, or User-Agent of a new cloud instance contain suspicious keywords, tool signatures, or encoded strings?
  context: Adversaries may inadvertently leave traces of their tools (e.g., 'Pacu', 'CloudSploit') or use common placeholder names ('temp', 'test') in instance metadata. Scanning for these indicators, or for patterns like base64 encoding which can hide commands, can reveal attempts to use offensive tooling or obfuscate activity.
  answer_sources:
  - AWS CloudTrail
  - Azure Activity Logs
  - GCP Admin Activity audit logs
  - Cloud provider management plane, SIEM / Log Analytics Workspace, Organizational Naming Convention Policy Documents
  range: last 90 days
  queries:
  - pseudocode: SEARCH cloud_audit_logs FOR instance_creation | REGEX on userAgent, instance.name, instance.tags for known tool names, placeholders, or base64 patterns | ALERT on match
- question: Does a new cloud instance have a name with unusually high randomness (entropy), suggesting it was algorithmically generated?
  context: Malicious automation often uses randomly generated names for resources to avoid detection and naming collisions. A high Shannon entropy score indicates a lack of discernible pattern, which is abnormal for human-created names that typically follow conventions. This helps detect such automated, potentially malicious, activity.
  answer_sources:
  - AWS CloudTrail
  - Azure Activity Logs
  - GCP Admin Activity audit logs
  - Cloud provider management plane, SIEM / Log Analytics Workspace, Organizational Naming Convention Policy Documents
  range: last 90 days
  queries:
  - pseudocode: CALCULATE entropy_baseline for instance names from last 90 days | FOR each new instance_creation_event | CALCULATE entropy of instance.name | IF entropy > 99th_percentile of baseline THEN ALERT
- question: Does an NLP model flag a new instance's name or tags as non-conforming to the organization's established naming patterns?
  context: This question applies Natural Language Processing (NLP) to learn the 'language' of an organization's resource naming conventions. It can detect subtle deviations that regex might miss, flagging names that seem grammatically or structurally different from legitimate, historical examples, which could indicate an outsider's activity.
  answer_sources:
  - AWS CloudTrail
  - Azure Activity Logs
  - GCP Admin Activity audit logs
  - Cloud provider management plane, SIEM / Log Analytics Workspace, Organizational Naming Convention Policy Documents
  range: last 90 days
  queries:
  - pseudocode: TRAIN NLP classifier on historical legitimate instance names and tags | FOR each new instance_creation_event | PREDICT conformance of instance.name and instance.tags | IF similarity_score is low THEN ALERT
- question: Was a new cloud instance created by a dormant or newly created user principal?
  context: This is a classic indicator of compromise. Dormant accounts (e.g., inactive for >90 days) that are suddenly used can signal an account takeover. Similarly, newly created accounts (e.g., age <72 hours) being used for significant resource provisioning might indicate an adversary creating their own access to operate.
  answer_sources:
  - AWS CloudTrail
  - Azure Activity Logs
  - GCP Admin Activity audit logs
  - Azure AD Sign-in logs
  - Okta System Log
  - Cloud Identity and Access Management (IAM) service, IdP Administration Portal and Logs, Human Resources Information System (for peer grouping)
  range: last 90 days
  queries:
  - pseudocode: ON instance_creation_event | GET principalId | QUERY IAM/IdP for principal_creation_date and last_activity_date | IF (now - creation_date < 72h) OR (event_time - last_activity_date > 90d) THEN ALERT
- question: Is a user creating cloud instances at a rate that is statistically anomalous compared to their own history or that of their peer group?
  context: A sudden, significant spike in a user's activity, or activity that is far outside the norm for their role (e.g., a developer suddenly spinning up 100x more instances than their peers), can indicate a compromised account being used for malicious resource provisioning, such as for cryptojacking.
  answer_sources:
  - AWS CloudTrail
  - Azure Activity Logs
  - GCP Admin Activity audit logs
  - Azure AD Sign-in logs
  - Okta System Log
  - Cloud Identity and Access Management (IAM) service, IdP Administration Portal and Logs, Human Resources Information System (for peer grouping)
  range: last 90 days
  queries:
  - pseudocode: CALCULATE daily_instance_creations_per_user over 30 days | CALCULATE mean and std_dev for each user | IF current_daily_count > (mean + 3 * std_dev) THEN ALERT
- question: Does a user's overall cloud activity pattern mark them as an outlier when clustered with other users?
  context: This approach moves beyond single metrics to look at a user's holistic behavior (API call frequency, resource types accessed, active hours). Unsupervised learning can identify users whose behavior doesn't fit any established group pattern, flagging them as 'noise' or outliers who may represent a compromised account or an insider threat.
  answer_sources:
  - AWS CloudTrail
  - Azure Activity Logs
  - GCP Admin Activity audit logs
  - Azure AD Sign-in logs
  - Okta System Log
  - Cloud Identity and Access Management (IAM) service, IdP Administration Portal and Logs, Human Resources Information System (for peer grouping)
  range: last 90 days
  queries:
  - pseudocode: GATHER user activity features (API_call_frequency, resource_types, active_hours) | APPLY clustering algorithm (e.g., DBSCAN) | IF user is classified as 'noise' or outlier THEN ALERT
- question: Is a new cloud instance configured with a security group that allows unrestricted public ingress on a sensitive port?
  context: Exposing management ports like SSH (22) or RDP (3389) to the entire internet (`0.0.0.0/0`) is a major security risk and a common tactic for adversaries to gain or maintain access. This question directly checks for this high-risk misconfiguration, which violates security best practices.
  answer_sources:
  - AWS CloudTrail
  - Azure Activity Logs
  - GCP Admin Activity audit logs
  - AWS Config
  - Azure Policy
  - Cloud provider management plane, Virtual network configuration (VPC/VNet), Cloud Security Posture Management (CSPM) tool findings
  range: last 90 days
  queries:
  - pseudocode: SCAN new and modified security_groups | IF rule allows source '0.0.0.0/0' or '::/0' on sensitive port (e.g., 22, 3389, 5985) not on approved list THEN ALERT
- question: Is a new cloud instance being created with a combination of attributes (region, instance type, size) that is statistically rare for the organization?
  context: Adversaries may not know an organization's standard operating procedures. They might create an instance in a region the company never uses, or of a type that is not standard for any workload. By scoring the rarity of these attributes, we can flag configurations that are statistical outliers and therefore suspicious.
  answer_sources:
  - AWS CloudTrail
  - Azure Activity Logs
  - GCP Admin Activity audit logs
  - AWS Config
  - Azure Policy
  - Cloud provider management plane, Virtual network configuration (VPC/VNet), Cloud Security Posture Management (CSPM) tool findings
  range: last 180 days
  queries:
  - pseudocode: CALCULATE frequency distributions for region, instanceType, instanceSize from last 180 days | FOR each new instance_creation_event | CALCULATE combined rarity score | IF score > 98th percentile THEN ALERT
- question: Is there a sudden spike in the volume of instances being created in a specific region or family, deviating from forecasted trends?
  context: This question uses time-series analysis to model the normal rhythm of instance creation. A sudden, unexpected surge in provisioning volume, especially in a specific region or instance family, can indicate automated, large-scale malicious activity like cryptojacking or resource hijacking that deviates from the established forecast.
  answer_sources:
  - AWS CloudTrail
  - Azure Activity Logs
  - GCP Admin Activity audit logs
  - AWS Config
  - Azure Policy
  - Cloud provider management plane, Virtual network configuration (VPC/VNet), Cloud Security Posture Management (CSPM) tool findings
  range: last 90 days
  queries:
  - pseudocode: MODEL instance creation volume per region/family using time-series model (e.g., Prophet) | FOR each new data point | IF actual_volume > forecasted_upper_bound THEN ALERT
- question: Is a user quickly creating a snapshot, launching a new instance from it, and attaching a volume, especially if this occurs across different regions?
  context: This sequence of actions can be a signature for data exfiltration or staging. An adversary might snapshot a volume containing sensitive data, create a new instance in a region they control, and attach the data to it for exfiltration. Correlating these events in a short time window is key to detecting this tactic.
  answer_sources:
  - AWS CloudTrail
  - Azure Activity Logs
  - GCP Admin Activity audit logs
  - Cloud provider management plane, SIEM correlation engine, Cloud data storage services (e.g., AWS EBS, Azure Managed Disks)
  range: last 90 days
  queries:
  - pseudocode: CORRELATION RULE: ON CreateSnapshot by principal | LOOK FOR RunInstances and AttachVolume by same principal within 15 minutes | IF new_instance_region is different from snapshot_region THEN CRITICAL ALERT
- question: Is a sequence of related API calls (e.g., CreateSnapshot to RunInstances) occurring significantly faster than is typical for legitimate administrative workflows?
  context: Human administrators have a certain pace when performing tasks, whereas automated scripts run much faster. By baselining the time between related API calls for normal operations, we can detect sequences that are executed with machine speed, a strong indicator of a scripted, and potentially malicious, process.
  answer_sources:
  - AWS CloudTrail
  - Azure Activity Logs
  - GCP Admin Activity audit logs
  - Cloud provider management plane, SIEM correlation engine, Cloud data storage services (e.g., AWS EBS, Azure Managed Disks)
  range: last 90 days
  queries:
  - pseudocode: CALCULATE baseline time delta between related API calls (e.g., CreateSnapshot -> RunInstances) | FOR new sequences | IF time delta < 5th percentile of baseline THEN ALERT
- question: Does a sequence of cloud API calls have a low probability of being legitimate, according to a sequence analysis model (e.g., HMM, RNN)?
  context: This advanced technique models the 'grammar' of legitimate API call sequences. An adversary's actions, even if they use valid API calls, may form a sequence that is syntactically unlikely or has never been seen before in legitimate operations. The model can flag these improbable sequences as anomalous for investigation.
  answer_sources:
  - AWS CloudTrail
  - Azure Activity Logs
  - GCP Admin Activity audit logs
  - Cloud provider management plane, SIEM correlation engine, Cloud data storage services (e.g., AWS EBS, Azure Managed Disks)
  range: last 90 days
  queries:
  - pseudocode: TRAIN sequence analysis model (HMM/RNN) on legitimate API call sequences | FOR each new observed sequence | CALCULATE probability score | IF score is below threshold THEN ALERT