name: T1021.001: Remote Desktop Protocol
id: 5a8a6889-3544-4f40-a339-17367b7f3f18
description: This playbook helps determine if an adversary has moved laterally within the network using Remote Desktop Protocol (RDP). It focuses on identifying several key indicators of malicious RDP usage, including connections from known malicious IP addresses or compromised user accounts, the suspicious enabling of RDP on a host followed immediately by an outbound connection, anomalous fan-out activity where one account connects to many hosts, RDP connections that violate network segmentation policies or represent first-time communication between hosts, and the execution of suspicious reconnaissance or credential dumping tools immediately following a successful RDP login.
type: technique
related:
  - TA0008: Lateral Movement
contributors:
  - Zachary Szewczyk
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: How can I detect if a successful RDP authentication involves an IP or user account from a known threat watchlist?
    context: This question aims to identify high-confidence malicious activity by correlating RDP logins with active threat intelligence. An alert for a login from a known-bad IP address or a compromised user account is a strong indicator of an intrusion and requires immediate investigation.
    answer_sources:
      - Windows Event ID 4624
      - Zeek rdp.log
      - Zeek conn.log
      - Domain Controllers
      - Critical Application Servers
      - Threat Intelligence Feeds
      - VPN Concentrators
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH RDP_logins WHERE (source_ip IN threat_intel_ips) OR (username IN threat_intel_users) | ALERT
  - question: For an RDP connection from a watchlisted entity, how can I determine if the connection is anomalous based on historical behavior?
    context: This question helps prioritize alerts by adding behavioral context. A watchlisted IP connecting to a host for the first time is more suspicious than one that connects regularly. By baselining normal activity and looking for statistical outliers (e.g., using z-scores), analysts can focus on the most unusual and likely malicious connections.
    answer_sources:
      - Windows Event ID 4624
      - Zeek rdp.log
      - Zeek conn.log
      - Domain Controllers
      - Critical Application Servers
      - Threat Intelligence Feeds
      - VPN Concentrators
    range: last 90 days
    queries:
      - technology: pseudocode
        query: FOR each_alert | GET source_ip, destination_host | CALCULATE historical_connection_frequency(source_ip, destination_host) | IF frequency is_outlier | ESCALATE_ALERT
  - question: Can a machine learning model be used to predict the probability of maliciousness for RDP sessions originating from watchlisted entities?
    context: This question explores a more advanced, predictive approach. By training a model on features like IP subnet, user role, and time of day, the system can automatically score the risk of new RDP sessions. This helps automate the prioritization process and allows analysts to focus on the highest-probability threats.
    answer_sources:
      - Windows Event ID 4624
      - Zeek rdp.log
      - Zeek conn.log
      - Domain Controllers
      - Critical Application Servers
      - Threat Intelligence Feeds
      - VPN Concentrators
    range: last 90 days
    queries:
      - technology: pseudocode
        query: INPUT rdp_session_features | PREDICT probability_malicious using classification_model | IF probability > threshold | ALERT
  - question: How can I detect if a host has RDP enabled and then immediately initiates an outbound RDP connection?
    context: This sequence of events is highly suspicious. Adversaries often enable RDP on a compromised machine to establish a pivot point for further lateral movement. Correlating the configuration change (enabling RDP via registry or firewall) with the subsequent outbound RDP network traffic helps detect this specific tactic.
    answer_sources:
      - Windows Event ID 4657
      - Windows Event ID 4688
      - Zeek conn.log
      - Windows Security Event ID 4947
      - User Endpoints
      - Workstations
      - Servers not typically configured for RDP access
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH (registry_change_to_enable_RDP OR firewall_rule_for_port_3389) on host | FOLLOWED_BY (outbound_connection to port 3389 from host) within 10_minutes | ALERT
  - question: When RDP is enabled and used for an outbound connection, how can I determine if the command that enabled it was obfuscated?
    context: Adversaries often use obfuscated scripts (e.g., encoded PowerShell) to hide their actions. Analyzing the command line of the process that enabled RDP and calculating its entropy can reveal this obfuscation. High entropy suggests a randomized or encoded command, increasing the suspicion that the activity is malicious.
    answer_sources:
      - Windows Event ID 4657
      - Windows Event ID 4688
      - Zeek conn.log
      - Windows Security Event ID 4947
      - User Endpoints
      - Workstations
      - Servers not typically configured for RDP access
    range: last 90 days
    queries:
      - technology: pseudocode
        query: FOR each_alert | GET parent_process_command_line | CALCULATE shannon_entropy(command_line) | IF entropy > baseline_threshold | INCREASE_SEVERITY
  - question: Can a machine learning model identify the sequence of 'Enable RDP -> Execute Process -> Outbound RDP' as a rare and anomalous pattern of activity?
    context: This question proposes using a sequence analysis model (like an LSTM) to learn normal patterns of administrative activity. The model can then identify the specific sequence of enabling RDP followed by its use as a statistically rare event, providing a high-fidelity alert for potential lateral movement preparation.
    answer_sources:
      - Windows Event ID 4657
      - Windows Event ID 4688
      - Zeek conn.log
      - Windows Security Event ID 4947
      - User Endpoints
      - Workstations
      - Servers not typically configured for RDP access
    range: last 90 days
    queries:
      - technology: pseudocode
        query: INPUT event_sequence_on_host | PREDICT anomaly_score using sequence_model | IF sequence is 'Enable RDP -> Process -> Outbound RDP' AND score is_anomalous | ALERT
  - question: How can I detect if a single user or IP address is making RDP connections to an unusually large number of hosts within a short time frame?
    context: This behavior, often called 'fan-out,' is a strong indicator of an adversary scanning for or moving to multiple systems after gaining initial access. A static threshold rule provides a simple but effective way to detect this brute-force lateral movement attempt.
    answer_sources:
      - Windows Event ID 4624
      - Zeek rdp.log
      - Zeek conn.log
      - Internal network segments
      - Core Switches
      - Domain Controller security logs
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH RDP_logins in last_hour | GROUPBY source_ip, username | COUNT distinct destination_hosts | IF count > 5 | ALERT
  - question: How can I identify RDP fan-out behavior that is anomalous for a specific user or IP, rather than using a generic threshold?
    context: A static threshold might generate false positives for administrators or automated systems. This question addresses that by creating a dynamic baseline for each user/IP. An alert is triggered only when an entity's activity significantly deviates from its own normal behavior (e.g., exceeding the 99th percentile), resulting in more targeted and accurate alerts.
    answer_sources:
      - Windows Event ID 4624
      - Zeek rdp.log
      - Zeek conn.log
      - Internal network segments
      - Core Switches
      - Domain Controller security logs
    range: last 90 days
    queries:
      - technology: pseudocode
        query: FOR each_user, source_ip | CALCULATE historical_baseline(unique_RDP_destinations_per_hour) | MONITOR current_count_per_hour | IF current_count > 99th_percentile_of_baseline | ALERT
  - question: Can an unsupervised machine learning model, like DBSCAN, automatically identify anomalous RDP fan-out activity without predefined rules or baselines?
    context: This question explores using clustering to find outliers. DBSCAN groups 'normal' RDP connections into dense clusters based on features like source IP and connection frequency. Any connection that doesn't fit into a cluster is labeled as noise or an outlier, effectively flagging anomalous fan-out behavior that might be missed by threshold-based methods.
    answer_sources:
      - Windows Event ID 4624
      - Zeek rdp.log
      - Zeek conn.log
      - Internal network segments
      - Core Switches
      - Domain Controller security logs
    range: last 90 days
    queries:
      - technology: pseudocode
        query: INPUT RDP_connection_features | APPLY DBSCAN_clustering | IDENTIFY noise_points | ALERT on_noise_points
  - question: How can I detect RDP connections that violate predefined network segmentation policies?
    context: Network segmentation is a key security control. This question focuses on enforcing it by monitoring for violations. By enriching network data with asset roles and VLAN information, a SIEM can alert on unauthorized RDP traffic, such as a workstation from a user VLAN attempting to connect to a critical server in a database VLAN.
    answer_sources:
      - Zeek conn.log
      - Zeek rdp.log
      - Windows Event ID 4624
      - Network Firewalls
      - VLAN access control lists (ACLs)
      - Core Switches
      - Server and Endpoint logs
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH RDP_connections | ENRICH with source_segment, destination_segment | IF connection_violates_policy(source_segment, destination_segment) | ALERT
  - question: How can I identify RDP connections between two hosts that have never communicated via RDP before?
    context: This 'first-time seen' analysis is a powerful way to spot new and potentially unauthorized activity. While some first-time connections are legitimate, those involving high-value assets or occurring at odd hours are highly suspicious. Maintaining a historical baseline of known communication pairs allows for the immediate flagging of novel connections for investigation.
    answer_sources:
      - Zeek conn.log
      - Zeek rdp.log
      - Windows Event ID 4624
      - Network Firewalls
      - VLAN access control lists (ACLs)
      - Core Switches
      - Server and Endpoint logs
    range: last 90 days
    queries:
      - technology: pseudocode
        query: MAINTAIN lookup_table of historical_rdp_pairs | FOR each_new_RDP_connection(source, dest) | IF (source, dest) NOT IN lookup_table | ALERT as 'first_time_connection'
  - question: Can graph analysis and community detection identify RDP connections that bridge previously separate clusters of hosts?
    context: This advanced technique models the network as a graph to find logical groupings (communities) of hosts that frequently interact. A new RDP connection that links two separate communities is a very strong indicator of an adversary bridging security boundaries to move laterally, making it a high-confidence alert.
    answer_sources:
      - Zeek conn.log
      - Zeek rdp.log
      - Windows Event ID 4624
      - Network Firewalls
      - VLAN access control lists (ACLs)
      - Core Switches
      - Server and Endpoint logs
    range: last 90 days
    queries:
      - technology: pseudocode
        query: BUILD RDP_connection_graph | RUN community_detection_algorithm | MONITOR for new_edges | IF new_edge connects two_different_communities | ALERT
  - question: How can I detect when a user runs suspicious reconnaissance or credential dumping commands immediately after logging in via RDP?
    context: What an adversary does after logging in is a critical investigative clue. This question focuses on correlating an RDP logon session (via Logon ID) with subsequent process creations. If the user immediately runs commands like 'whoami', 'net user', or executes 'mimikatz.exe', it's a strong sign that the RDP session is malicious.
    answer_sources:
      - Windows Event ID 4624
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - Zeek conn.log
      - Zeek dns.log
      - Domain Controllers
      - Critical Servers
      - Privileged Access Workstations
      - DNS Servers
      - Endpoint Process Logs
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH RDP_login(LogonId) | CORRELATE with process_creation events with same LogonId | IF process_command IN suspicious_command_list | ALERT
  - question: How can I identify an RDP session as suspicious based on the execution of statistically rare processes or commands?
    context: Adversaries may use custom or less common tools to avoid signature-based detection. This question involves baselining all process and command-line activity across the enterprise to determine what is 'normal.' An RDP session that involves the execution of a command that is statistically rare is highly suspicious and warrants investigation.
    answer_sources:
      - Windows Event ID 4624
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - Zeek conn.log
      - Zeek dns.log
      - Domain Controllers
      - Critical Servers
      - Privileged Access Workstations
      - DNS Servers
      - Endpoint Process Logs
    range: last 90 days
    queries:
      - technology: pseudocode
        query: FOR each_RDP_session | GET child_processes_and_commands | CALCULATE command_prevalence across enterprise | IF command_prevalence is_rare | ALERT
  - question: Can a machine learning model be trained to score the overall risk of an RDP session based on a combination of post-login activities?
    context: This question proposes a holistic, ML-based approach to scoring RDP sessions. Instead of relying on a single indicator, a model can be trained on a rich set of features (e.g., number of recon commands, rare process executions, DNS query entropy) to calculate a comprehensive risk score. This allows analysts to prioritize their efforts on the sessions that are most likely to be malicious.
    answer_sources:
      - Windows Event ID 4624
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - Zeek conn.log
      - Zeek dns.log
      - Domain Controllers
      - Critical Servers
      - Privileged Access Workstations
      - DNS Servers
      - Endpoint Process Logs
    range: last 90 days
    queries:
      - technology: pseudocode
        query: FOR each_RDP_session | EXTRACT features (recon_commands, rare_processes, network_activity) | PREDICT malicious_probability using classifier_model | SORT alerts by probability