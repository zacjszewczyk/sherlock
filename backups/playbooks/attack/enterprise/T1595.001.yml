name: 'T1595.001: Scanning IP Blocks'
id: 'a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d'
description: 'This playbook helps investigate whether an adversary is conducting reconnaissance by scanning public-facing IP blocks. This involves checking for inbound connections from IPs on threat intelligence lists, looking for traffic patterns matching known scanning tools (like Nmap or masscan), and detecting anomalous scanning behaviors such as horizontal scans (one source to many hosts on one port), vertical scans (one source to many ports on one host), or IP sweeps (probing sequential IPs to find live hosts).'
type: 'technique'
related:
  - 'TA0043: Reconnaissance'
contributors: 'Zachary Szewczyk, Ask Sage'
created: '2025-10-01'
modified: '2025-10-01'
version: 1.0
tags: 'none'
questions:
  - question: 'Has an inbound connection originated from a source IP address known to be malicious based on threat intelligence feeds?'
    context: 'This question aims to identify low-hanging fruit by matching the source IP addresses of all inbound connections against curated lists of known scanners, botnet C2s, or TOR exit nodes. A direct match provides a high-confidence signal that the activity is suspicious and warrants further investigation.'
    answer_sources:
      - 'Zeek conn.log'
      - 'Zeek icmp.log'
      - 'Internet-facing firewalls'
      - 'network gateways'
      - 'Cloud Security Groups'
      - 'Network ACLs'
      - 'Threat Intelligence Feeds'
    range: 'last 90 days'
    queries:
      - search: 'pseudocode'
        query: 'FOR each inbound connection in conn.log/icmp.log, CHECK source_ip against threat_intel_feeds. ALERT on match.'
  - question: 'Are any inbound source IP addresses exhibiting a statistically significant malicious reputation based on their presence across multiple threat intelligence feeds?'
    context: 'This question moves beyond simple matching to score an IP''s reputation. An adversary might use an IP that is not on a single high-confidence list but appears on several lower-confidence ones. By assigning weights and summing scores, this method can uncover suspicious IPs that would be missed by a simple IOC match, identifying actors who rotate through less-known malicious infrastructure. An alert is triggered when an IP''s score is anomalously high compared to its peers.'
    answer_sources:
      - 'Zeek conn.log'
      - 'Zeek icmp.log'
      - 'Internet-facing firewalls'
      - 'network gateways'
      - 'Cloud Security Groups'
      - 'Network ACLs'
      - 'Multiple Threat Intelligence Feeds'
    range: 'last 90 days'
    queries:
      - search: 'pseudocode'
        query: 'FOR each source_ip, CALCULATE reputation_score from threat_feed_hits. IF score > 95th_percentile_baseline, ALERT.'
  - question: 'Can we classify an inbound source IP address as a ''malicious-scanner'' using a machine learning model?'
    context: 'This question leverages a predictive approach to identify scanners. A supervised model is trained on historical data, learning the complex characteristics of malicious scanners beyond simple IP lists. Features like ASN, country of origin, and past connection patterns allow the model to identify novel or previously unseen scanning infrastructure with high probability, providing a proactive detection capability.'
    answer_sources:
      - 'Zeek conn.log'
      - 'Zeek icmp.log'
      - 'Internet-facing firewalls'
      - 'network gateways'
      - 'Cloud Security Groups'
      - 'Network ACLs'
      - 'Labeled Historical Connection Data'
    range: 'last 90 days'
    queries:
      - search: 'pseudocode'
        query: 'INPUT source_ip_features (ASN, country, etc.) into trained_classifier_model. IF model_output_probability > threshold for ''malicious-scanner'', ALERT.'
  - question: 'Does inbound network traffic contain signatures, such as specific User-Agents, TCP flag combinations, or JA3/JA3S hashes, associated with known reconnaissance tools?'
    context: 'This question focuses on identifying scanning tools by their unique fingerprints. Tools like Nmap, masscan, or zmap often leave distinct traces in network logs. By searching for these specific signatures in HTTP headers, TCP flags, or TLS handshakes, analysts can directly identify the use of scanning tools against their infrastructure.'
    answer_sources:
      - 'Zeek http.log'
      - 'Zeek conn.log'
      - 'Zeek software.log'
      - 'Zeek ssl.log'
      - 'Web application servers'
      - 'internet-facing firewalls'
      - 'load balancers'
      - 'reverse proxies'
    range: 'last 90 days'
    queries:
      - search: 'pseudocode'
        query: 'SEARCH http.log for user_agents like ''Nmap'', ''masscan''. SEARCH conn.log for anomalous TCP_flags. SEARCH ssl.log for known-bad ja3/ja3s hashes. ALERT on match.'
  - question: 'Is a source IP address using statistically rare User-Agent strings or JA3 hashes in an attempt to evade signature-based detection?'
    context: 'Attackers may alter tool signatures to avoid simple pattern matching. This question aims to detect such evasion by analyzing the frequency of identifiers like User-Agents and JA3 hashes. A source IP using multiple, very rare identifiers is suspicious, as it suggests a deliberate attempt to look unique and bypass common blocklists.'
    answer_sources:
      - 'Zeek http.log'
      - 'Zeek ssl.log'
      - 'Web application servers'
      - 'internet-facing firewalls'
      - 'load balancers'
      - 'reverse proxies'
    range: 'last 90 days'
    queries:
      - search: 'pseudocode'
        query: 'CALCULATE frequency of all user_agents/ja3_hashes. FOR each source_ip, CALCULATE rarity_score of its identifiers. IF score indicates identifiers are below 1st_percentile_commonality, ALERT.'
  - question: 'Does the sequence of TCP connection states from an external IP deviate from normal behavior, as identified by a machine learning model?'
    context: 'This question analyzes the *behavior* of a TCP session, not just its static attributes. Scans often have a distinct connection pattern (e.g., SYN, SYN-ACK, RST) that differs from legitimate traffic. A Hidden Markov Model (HMM) can learn the ''grammar'' of normal sessions and flag sequences that are statistically unlikely, pointing to probing or scanning activity.'
    answer_sources:
      - 'Zeek conn.log'
      - 'Web application servers'
      - 'internet-facing firewalls'
      - 'load balancers'
      - 'reverse proxies'
    range: 'last 90 days'
    queries:
      - search: 'pseudocode'
        query: 'MODEL normal TCP connection_history sequences with HMM. FOR new connection_history from external_ip, CALCULATE log-likelihood. IF likelihood < anomaly_threshold, ALERT.'
  - question: 'Has a single external IP address connected to an unusually high number of internal hosts on the same port within a short time frame?'
    context: 'This is the classic definition of a horizontal scan. The question seeks to identify this behavior using a simple threshold. For example, if an external IP connects to more than 20 different internal hosts on port 445 within one minute, it''s a strong indicator of a host discovery or vulnerability scan.'
    answer_sources:
      - 'Zeek conn.log'
      - 'Demilitarized Zone (DMZ) network segments and externally exposed server subnets'
    range: 'last 90 days'
    queries:
      - search: 'pseudocode'
        query: 'WITHIN 1_minute_window, COUNT unique destination_ips per source_ip and destination_port. IF count > 20, ALERT.'
  - question: 'Is a source IP''s horizontal scanning activity statistically anomalous when compared to a dynamic, port-specific baseline?'
    context: 'A simple threshold for all ports can be noisy. Scanning port 443 is more common than scanning port 22. This question refines the detection by creating a dynamic baseline for each port based on normal traffic levels. An alert is triggered only when a source IP''s activity exceeds the 99th percentile for a *specific* port, reducing false positives.'
    answer_sources:
      - 'Zeek conn.log'
      - 'Demilitarized Zone (DMZ) network segments and externally exposed server subnets'
    range: 'last 90 days'
    queries:
      - search: 'pseudocode'
        query: 'FOR each destination_port, CALCULATE 99th_percentile_baseline of unique_dest_hosts_contacted per source_ip. IF source_ip_activity > port_baseline, ALERT.'
  - question: 'Does the volume of unique source-destination pairs for a high-value port represent a time-series anomaly indicative of a coordinated scan?'
    context: 'This question aims to detect large-scale or distributed scans that might not be caught by single-source IP rules. By modeling the total volume of connections to a port as a time series, a forecasting model can predict expected traffic. A sudden, significant spike above the predicted range can indicate a large-scale scanning event from one or many sources.'
    answer_sources:
      - 'Zeek conn.log'
      - 'Demilitarized Zone (DMZ) network segments and externally exposed server subnets'
    range: 'last 90 days'
    queries:
      - search: 'pseudocode'
        query: 'MODEL time_series of unique_src_dst_pairs per minute for high_value_port. FORECAST expected_volume. IF observed_volume is outlier compared to forecast, ALERT.'
  - question: 'Has a single external IP address attempted to connect to an unusually high number of distinct ports on a single internal host within a short time frame?'
    context: 'This question identifies a vertical or port scan using a simple threshold. An attacker probing a single server to find open ports will generate a high number of connection attempts to different ports in a short period. Alerting when this count exceeds a threshold (e.g., 50 ports in a minute) is a straightforward way to detect this activity.'
    answer_sources:
      - 'Zeek conn.log'
      - 'Public-facing application servers'
      - 'VPN concentrators'
      - 'externally-facing domain controllers'
    range: 'last 90 days'
    queries:
      - search: 'pseudocode'
        query: 'FOR each source_ip/destination_ip pair, COUNT unique destination_ports in 1_minute_window. IF count > 50, ALERT.'
  - question: 'Is the distribution of destination ports contacted by a source IP on a single host statistically random, as measured by entropy?'
    context: 'Legitimate traffic to a single host usually involves a few predictable ports. A port scan, however, often touches a wide and less predictable range of ports. This question uses Shannon entropy to measure this randomness. A high entropy score for the set of ports contacted by a source IP indicates a likely scan, triggering an alert when it exceeds a dynamically determined threshold.'
    answer_sources:
      - 'Zeek conn.log'
      - 'Public-facing application servers'
      - 'VPN concentrators'
      - 'externally-facing domain controllers'
    range: 'last 90 days'
    queries:
      - search: 'pseudocode'
        query: 'FOR each source_ip/destination_ip pair, CALCULATE shannon_entropy of destination_ports in 5_minute_window. IF entropy_score > 98th_percentile_baseline, ALERT.'
  - question: 'Can a clustering algorithm identify a dense group of connection events corresponding to a vertical scan?'
    context: 'This question uses an unsupervised machine learning approach to find scanning patterns without pre-defined rules. A density-based algorithm like DBSCAN can group log entries. A vertical scan will appear as a dense cluster of points with the same source and destination IP but high variance across the destination port dimension, allowing the algorithm to automatically isolate it from normal, sparse traffic.'
    answer_sources:
      - 'Zeek conn.log'
      - 'Public-facing application servers'
      - 'VPN concentrators'
      - 'externally-facing domain controllers'
    range: 'last 90 days'
    queries:
      - search: 'pseudocode'
        query: 'APPLY DBSCAN clustering on connection_logs using features (source_ip, dest_ip, dest_port). IDENTIFY dense clusters with same src/dst_ip but high dest_port variance. ALERT on cluster.'
  - question: 'Is an external source IP connecting to a sequential block of internal IP addresses?'
    context: 'This question looks for the most blatant form of an IP sweep. By converting destination IPs to integers and looking for a sequential run (e.g., 10 or more in a row), this method can definitively identify an adversary systematically walking through a subnet to find live hosts.'
    answer_sources:
      - 'Zeek conn.log'
      - 'Zeek icmp.log'
      - 'Public IP address ranges allocated to the organization and cloud network gateways'
    range: 'last 90 days'
    queries:
      - search: 'pseudocode'
        query: 'FOR each source_ip, BUFFER destination_ips over 1 minute. CONVERT IPs to integers. CHECK for sequential run of 10+. ALERT on detection.'
  - question: 'Are the destination IPs contacted by a single source statistically grouped together, suggesting a subnet sweep?'
    context: 'Attackers may not scan sequentially but may still focus on a specific subnet. This question identifies such behavior by analyzing the statistical distribution of destination IPs. A low standard deviation among the integer representations of the IPs indicates they are tightly clustered (e.g., within the same /24 block), which is anomalous compared to normal, more randomly distributed traffic patterns.'
    answer_sources:
      - 'Zeek conn.log'
      - 'Zeek icmp.log'
      - 'Public IP address ranges allocated to the organization and cloud network gateways'
    range: 'last 90 days'
    queries:
      - search: 'pseudocode'
        query: 'FOR each source_ip, COLLECT destination_ips over 5 minutes. CALCULATE standard_deviation of integer representations. IF std_dev is anomalously low compared to baseline, ALERT.'
  - question: 'Can an image recognition model classify the pattern of probed hosts on a subnet bitmap as a malicious sweep?'
    context: 'This is an advanced, visual approach to sweep detection. By representing a /24 subnet as a 256-pixel bitmap and "lighting up" pixels for each probed host, different scanning techniques create visually distinct patterns (e.g., a straight line for a sequential scan, a random spray of dots). A Convolutional Neural Network (CNN), trained on examples of these patterns, can classify new activity and identify sweeps even when they are slow, distributed, or non-sequential.'
    answer_sources:
      - 'Zeek conn.log'
      - 'Zeek icmp.log'
      - 'Public IP address ranges allocated to the organization and cloud network gateways'
    range: 'last 90 days'
    queries:
      - search: 'pseudocode'
        query: 'FOR each source_ip, CREATE a bitmap of probed hosts in a target /24 subnet over 10 minutes. INPUT bitmap into trained_cnn_model. IF model classifies bitmap as a sweep pattern, ALERT.'