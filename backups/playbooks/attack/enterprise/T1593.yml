name: 'T1593: Search Open Websites-Domains'
id: 'a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d'
description: 'This playbook helps investigate whether an adversary is performing reconnaissance by searching open websites and domains for information about the organization. This includes detecting connections from known malicious scanners, identifying high volumes of web requests with high error rates indicative of content discovery, spotting unauthorized DNS zone transfers or subdomain enumeration, and correlating increased failed login attempts with credentials found in public data breaches.'
type: 'technique'
related: 'TA0043: Reconnaissance'
contributors: 'Zachary Szewczyk, Ask Sage'
created: '2025-10-01'
modified: '2025-10-01'
version: 1.0
tags: 'none'
questions:
  - question: 'Are we observing inbound web traffic from IP addresses or using User-Agent strings associated with known malicious scanners or reconnaissance tools?'
    context: 'This question aims to detect initial reconnaissance activity by cross-referencing incoming web traffic against a high-confidence threat intelligence feed. Identifying traffic from known malicious tools like ZGrab or Nuclei can provide an early warning that an adversary is actively scanning our public-facing web assets for vulnerabilities or information.'
    answer_sources: 'Zeek http.log, Zeek conn.log, Threat Intelligence Feed, Public-facing web servers, Reverse proxies, Cloud-hosted web applications'
    range: 'last 90 days'
    queries:
      - 'SEARCH Zeek http.log AND conn.log WHERE source_ip IN threat_feed OR user_agent IN threat_feed'
  - question: 'Are there any statistically rare User-Agents making requests to our public web servers that are not associated with legitimate services?'
    context: 'This question helps identify potential reconnaissance tools or custom scripts that use uncommon User-Agent strings to evade simple signature-based detection. By baselining normal User-Agent activity and flagging outliers, we can uncover stealthier scanning attempts that do not rely on known malicious signatures.'
    answer_sources: 'Zeek http.log, Zeek conn.log, Public-facing web servers, Reverse proxies, Cloud-hosted web applications'
    range: 'last 90 days'
    queries:
      - 'CALCULATE frequency of user_agents over 30 days. ALERT on user_agents with frequency < 0.1% AND source_ip NOT IN known_good_crawlers_list'
  - question: 'Can we use a machine learning model to classify incoming web requests as malicious reconnaissance based on their features?'
    context: 'This question explores a more advanced, behavioral approach to detection. A machine learning model can learn the subtle characteristics of malicious requests (e.g., header count, entropy, IP reputation) and identify novel or obfuscated reconnaissance attempts that might be missed by rule-based or statistical methods.'
    answer_sources: 'Zeek http.log, Zeek conn.log, Threat Intelligence Feed, Public-facing web servers, Reverse proxies, Cloud-hosted web applications'
    range: 'last 90 days'
    queries:
      - 'APPLY ML model (Random Forest, etc.) to real-time web requests. ALERT on requests classified as malicious'
  - question: 'Is any single external IP address generating a high volume of "Not Found" (404) errors in a short period?'
    context: 'This question targets brute-force content discovery or directory enumeration attacks. An adversary attempting to find hidden files or directories will likely generate a large number of requests for non-existent resources, resulting in a spike of 404 errors from their IP address. This is a strong indicator of an active enumeration attempt.'
    answer_sources: 'Zeek http.log, Zeek conn.log, Public-facing web servers, API Gateways'
    range: 'last 90 days'
    queries:
      - 'COUNT requests by source_ip and status_code=404 over 1 minute. ALERT if count > 100 for any single IP'
  - question: 'Are any source IPs exhibiting anomalous request rates or a high ratio of error-to-success status codes compared to their own historical baseline?'
    context: 'This question uses personalized statistical baselining to detect deviations from an IP''s normal behavior. Unlike a static threshold, this method adapts to the typical traffic patterns of each source, making it more effective at identifying when a legitimate but noisy service or a previously benign IP begins to exhibit scanning behavior.'
    answer_sources: 'Zeek http.log, Zeek conn.log, Public-facing web servers, API Gateways'
    range: 'last 90 days'
    queries:
      - 'FOR each source_ip, calculate 95th percentile of request_rate and error_ratio over 10-min window. ALERT if current values exceed baseline by > 3 standard deviations'
  - question: 'Is the aggregated volume of 404 errors from any single source IP deviating significantly from what a time-series model would predict as normal?'
    context: 'This question applies time-series analysis to detect anomalies in the rate of 404 errors from a source IP. This method is powerful for identifying attacks that may not be intense enough to trigger simple threshold rules but represent a clear and sustained deviation from the expected, learned pattern of traffic for that source.'
    answer_sources: 'Zeek http.log, Zeek conn.log, Public-facing web servers, API Gateways'
    range: 'last 90 days'
    queries:
      - 'APPLY time-series model (ARIMA) to 404 error count per source_ip. ALERT if observed count deviates from forecasted range'
  - question: 'Are any unauthorized external IP addresses attempting to perform a full DNS zone transfer (AXFR/IXFR)?'
    context: 'This question addresses a classic reconnaissance technique where an adversary tries to download the entire DNS zone file for a domain. A successful zone transfer would reveal a complete list of all hosts and subdomains, providing a comprehensive map of the target network. Any attempt from an unapproved source is highly suspicious and requires immediate investigation.'
    answer_sources: 'Zeek dns.log, Authoritative external DNS servers'
    range: 'last 90 days'
    queries:
      - 'SEARCH Zeek dns.log WHERE (qtype = ''AXFR'' OR qtype = ''IXFR'') AND source_ip NOT IN approved_dns_servers_list'
  - question: 'Are any external IPs generating a high rate of DNS queries with high subdomain entropy or a high ratio of non-existent domain (NXDOMAIN) responses?'
    context: 'This question aims to detect subdomain enumeration attacks where adversaries use tools to guess or brute-force a list of potential subdomains. This activity is characterized by a high volume of queries for non-existent domains (high NXDOMAIN ratio) and often involves randomized or sequential subdomain names (high entropy), which differ significantly from normal DNS traffic patterns.'
    answer_sources: 'Zeek dns.log, Authoritative external DNS servers'
    range: 'last 90 days'
    queries:
      - 'FOR each source_ip over 5 mins, CALCULATE entropy of requested_subdomains and ratio of NXDOMAIN responses. ALERT if entropy > baseline OR nxdomain_ratio > 80%'
  - question: 'Can we use unsupervised machine learning (clustering) to identify groups of external IPs exhibiting DNS query patterns consistent with reconnaissance?'
    context: 'This question proposes using a clustering algorithm like DBSCAN to automatically group source IPs based on their DNS query behavior. Malicious scanners will naturally form distinct clusters characterized by high query rates, high NXDOMAIN ratios, and high entropy, separating them from clusters of legitimate traffic without needing pre-defined signatures or thresholds.'
    answer_sources: 'Zeek dns.log, Authoritative external DNS servers'
    range: 'last 90 days'
    queries:
      - 'APPLY clustering model (DBSCAN) to source_ips based on DNS query features. FLAG anomalous clusters with high query_rate, high nxdomain_ratio, and high entropy'
  - question: 'Are we seeing failed login attempts against our external services for user accounts that have recently appeared in public credential breaches?'
    context: 'This question directly links reconnaissance (finding credentials in breaches) with active attempts to use them (credential stuffing). Correlating failed logins with a threat intelligence feed of breached accounts provides high-fidelity alerts, indicating that an adversary is actively trying to exploit compromised credentials against our organization.'
    answer_sources: 'Windows Event ID 4625, Zeek conn.log, Threat Intelligence Breach Feed, VPN concentrators, Externally-facing authentication servers (e.g., ADFS, Exchange), Remote Desktop Gateway servers, Cloud Identity Providers (e.g., Azure AD)'
    range: 'last 90 days'
    queries:
      - 'SEARCH Windows Event ID 4625 (Logon Type 3) WHERE username IN breached_credential_feed_from_last_90_days'
  - question: 'For user accounts known to be in a public breach, are we observing a statistically significant increase in failed login attempts from external sources compared to their individual baseline?'
    context: 'This question focuses on detecting a change in login attempt patterns for a specific, compromised user. By establishing a personal baseline for each user''s failed logins, we can more accurately detect a credential stuffing attack against that account, even if the overall volume is not large enough to trigger global thresholds. Correlating this with new source IPs adds further evidence.'
    answer_sources: 'Windows Event ID 4625, Zeek conn.log, Threat Intelligence Breach Feed, VPN concentrators, Externally-facing authentication servers (e.g., ADFS, Exchange), Remote Desktop Gateway servers, Cloud Identity Providers (e.g., Azure AD)'
    range: 'last 90 days'
    queries:
      - 'FOR each user in breach_feed, MONITOR hourly failed logins (Event 4625). ALERT if count > (mean + 3 * std_dev) of user''s baseline'
  - question: 'Is a change point detection algorithm identifying a sudden and sustained shift in the rate of failed external logins for high-value or recently breached accounts?'
    context: 'This question uses advanced time-series analysis to automatically detect the onset of a credential stuffing attack. A change point detection algorithm can identify the exact moment a pattern shifts from normal to anomalous (e.g., a sudden, sustained increase in failed logins), providing a more precise and timely alert than simple thresholding or baselining.'
    answer_sources: 'Windows Event ID 4625, Zeek conn.log, Threat Intelligence Breach Feed, VPN concentrators, Externally-facing authentication servers (e.g., ADFS, Exchange), Remote Desktop Gateway servers, Cloud Identity Providers (e.g., Azure AD)'
    range: 'last 90 days'
    queries:
      - 'APPLY change point detection (CUSUM) to failed login time series for high-value/breached users. ALERT on detected change point'