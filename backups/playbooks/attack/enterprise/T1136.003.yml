name: T1136.003: Cloud Account
id: 3c5a1a1b-3f41-4e7b-8b9a-7d1c1e5f8a2d
description: This playbook helps investigate whether an adversary is using newly created or unauthorized cloud accounts to establish persistence. It focuses on detecting inbound network connections from cloud providers to internal assets, anomalous logons by cloud-synchronized or unprovisioned accounts, first-time privileged actions by cloud identities, and subsequent C2-like network traffic.
type: technique
related:
  - TA0003: Persistence
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Are there any established inbound network connections from known malicious cloud provider IP addresses to non-public internal assets?
    context: This question aims to detect initial access or command and control (C2) channels established from compromised cloud infrastructure. By filtering for successful connections from cloud provider IPs that are also on a threat intelligence feed, and targeting internal, non-public assets, we can identify high-confidence indicators of malicious activity that bypasses typical perimeter defenses.
    answer_sources:
      - Zeek conn.log
      - Threat Intelligence Feed
      - Internet Gateway
      - Perimeter Firewalls
      - Internal Network Segments
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: FILTER Zeek conn.log WHERE conn_state == 'SF' AND source_ip IN cloud_provider_ranges AND source_ip IN malicious_ip_feed AND destination_ip NOT IN public_server_list
  - question: Have any new or infrequent inbound connections from cloud provider IPs been observed targeting high-value internal assets or commonly exploited ports?
    context: This question seeks to identify anomalous connections that deviate from established baselines. Adversaries may use previously unseen cloud IP addresses for their attacks. By flagging connections from source IPs not seen in the last 30 days that target critical systems or sensitive ports (like RDP or SSH), and whose rarity exceeds a statistical threshold, we can uncover emerging threats that symbolic rules might miss.
    answer_sources:
      - Zeek conn.log
      - Threat Intelligence Feed
      - Internet Gateway
      - Perimeter Firewalls
      - Internal Network Segments
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: FOR each inbound_connection FROM cloud_provider_ranges CALCULATE frequency of source_ip to destination_port over last 30 days. ALERT if source_ip is new AND destination_is_high_value AND rarity > 99th percentile.
  - question: Can machine learning models classify inbound connections from cloud providers as potentially malicious based on their network traffic characteristics?
    context: This question leverages machine learning to score the risk of an inbound cloud connection. By training a model on features like connection duration, bytes transferred, service, and protocol, it can learn the subtle patterns that distinguish malicious traffic from benign traffic. This provides a probabilistic measure of risk for real-time alerting, helping to prioritize analyst attention on the most suspicious connections.
    answer_sources:
      - Zeek conn.log
      - Threat Intelligence Feed
      - Internet Gateway
      - Perimeter Firewalls
      - Internal Network Segments
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: INPUT connection_features (duration, bytes, service, etc.) INTO trained_classifier_model. ALERT if prediction_score > high_malicious_threshold.
  - question: Have any cloud-synchronized or temporary service accounts performed interactive or network logons to critical on-premises assets (Tier 0/1)?
    context: This question focuses on detecting the misuse of cloud-based identities to access high-value on-premises systems. By monitoring for specific logon types (Interactive, Network, RemoteInteractive) on critical assets and filtering for accounts with cloud-specific SIDs (`S-1-12-1-...`) or naming conventions (`AAD_*`, `svc-*`), we can directly identify potential lateral movement or persistence attempts originating from a compromised cloud identity.
    answer_sources:
      - Windows Event ID 4624
      - Domain Controllers
      - Member Servers hosting sensitive applications
      - Privileged Access Workstations (PAWs)
      - Certificate Authority Servers
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: FILTER Windows Event 4624 WHERE LogonType IN (2, 3, 10) AND TargetServer_is_Tier0_or_Tier1 AND (SecurityID matches '^S-1-12-1-.*' OR TargetUserName matches 'AAD_*', 'svc-*', etc.)
  - question: Are there statistically rare instances of cloud-synchronized accounts logging into specific on-premises servers for the first time?
    context: This question uses statistical analysis to find unusual logon behavior that might indicate credential abuse. A cloud account logging into a sensitive on-premises server for the very first time is a statistically rare event. By calculating the rarity of such logons compared to historical norms for that user or server, we can flag highly anomalous events that warrant immediate investigation, such as a first-ever interactive logon to a domain controller by a cloud service account.
    answer_sources:
      - Windows Event ID 4624
      - Domain Controllers
      - Member Servers hosting sensitive applications
      - Privileged Access Workstations (PAWs)
      - Certificate Authority Servers
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: FOR each logon_event BY cloud_account CALCULATE historical logon frequency to target_server. ALERT if logon is first_time_to_server AND rarity_score > 99th percentile.
  - question: Can unsupervised machine learning detect anomalous logon activities by cloud-characteristic accounts that deviate from normal behavior clusters?
    context: This question applies unsupervised learning to discover novel or evasive threats without relying on predefined rules. An Isolation Forest or similar algorithm can model 'normal' logon behavior based on features like time of day, source workstation, and logon type. It can then identify outliers, such as a cloud account logging in from an unusual location at an odd hour, which deviate significantly from established activity clusters for that user or their peers.
    answer_sources:
      - Windows Event ID 4624
      - Domain Controllers
      - Member Servers hosting sensitive applications
      - Privileged Access Workstations (PAWs)
      - Certificate Authority Servers
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: INPUT logon_features (LogonType, UserName_structure, Server, time) INTO IsolationForest model. ALERT if anomaly_score indicates outlier.
  - question: Have any user accounts logged into an on-premises system for the first time without a corresponding provisioning record in HR or ITSM systems within the last 72 hours?
    context: This question aims to identify potentially unauthorized or 'shadow' accounts. A legitimate new user should have a corresponding creation ticket in an ITSM or HR system. By cross-referencing successful first-time logons against a list of officially provisioned accounts, we can flag any user logon that lacks a legitimate business justification, which could indicate an adversary-created account.
    answer_sources:
      - Windows Event ID 4624
      - Zeek conn.log
      - ITSM/HR provisioning logs
      - Domain Controllers
      - VPN Concentrators
      - Identity and Access Management (IAM) systems
      - HR Information Systems (HRIS)
      - IT Service Management (ITSM) platforms
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: JOIN successful_logons (Event 4624) WITH new_provisioned_users_watchlist (from ITSM/HR). ALERT on any logon_username NOT IN watchlist from last 72 hours.
  - question: Has there been a statistically significant spike in the number of first-time account logons per hour?
    context: This question seeks to detect bulk account creation or brute-force success, which often manifests as a sudden increase in new account activity. By monitoring the rate of first-time logons and comparing it to a moving average, we can statistically identify abnormal spikes. An alert triggered when the rate exceeds a defined threshold (e.g., three standard deviations) can indicate a large-scale compromise or automated attack.
    answer_sources:
      - Windows Event ID 4624
      - Zeek conn.log
      - ITSM/HR provisioning logs
      - Domain Controllers
      - VPN Concentrators
      - Identity and Access Management (IAM) systems
      - HR Information Systems (HRIS)
      - IT Service Management (ITSM) platforms
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: CALCULATE 30-day moving_average and standard_deviation of first-time_logons_per_hour. ALERT if current_hour_count > (moving_average + 3 * standard_deviation).
  - question: Can a machine learning model assign a risk score to first-time logons to identify unprovisioned or malicious account activity?
    context: This question uses a supervised model to proactively assess the risk of every first-time logon. By training a model on features like the source IP's location, time of day, target system's role, and whether the account was officially provisioned, we can create a 'First Logon Risk Score'. High-risk scores for unprovisioned accounts would trigger an immediate investigation, allowing for faster response to potential threats.
    answer_sources:
      - Windows Event ID 4624
      - Zeek conn.log
      - ITSM/HR provisioning logs
      - Domain Controllers
      - VPN Concentrators
      - Identity and Access Management (IAM) systems
      - HR Information Systems (HRIS)
      - IT Service Management (ITSM) platforms
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: INPUT first_logon_features (IP_geolocation, time, target_role, provisioned_status) INTO logistic_regression_model. ALERT if risk_score > high_risk_threshold.
  - question: Has a cloud-native or hybrid account, not on an approved administrator list, added a member to a privileged group or cleared a security event log?
    context: This question targets explicit privilege escalation and defense evasion activities. Altering privileged group memberships (e.g., Domain Admins) or clearing security logs are high-impact, suspicious actions. By creating a specific rule to detect these event IDs when initiated by a cloud-identified account that is not an authorized administrator, we can catch blatant attempts to establish persistent, privileged access.
    answer_sources:
      - Windows Event ID 4624
      - Windows Event ID 4728
      - Windows Event ID 4732
      - Windows Event ID 4738
      - Windows Event ID 4756
      - Windows Event ID 1102
      - Domain Controllers
      - Active Directory Federation Services (ADFS) servers
      - Group Policy Management Servers
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: FILTER for EventIDs (4728, 4732, 4756, 1102) WHERE SubjectUserName is cloud_account AND SubjectUserName NOT IN approved_admin_list. ALERT.
  - question: Has a cloud-synced or dormant account suddenly performed a rare privileged action or exhibited a significant change in its activity patterns?
    context: This question uses information theory to detect subtle changes in user behavior. An adversary taking over an account will likely perform actions that are unusual for that user. By baselining each user's typical privileged activities and calculating the entropy of their actions, we can alert on sudden spikes in entropy or the performance of a low-frequency action (e.g., an action never performed before by that user), indicating a potential account compromise.
    answer_sources:
      - Windows Event ID 4624
      - Windows Event ID 4728
      - Windows Event ID 4732
      - Windows Event ID 4738
      - Windows Event ID 4756
      - Windows Event ID 1102
      - Domain Controllers
      - Active Directory Federation Services (ADFS) servers
      - Group Policy Management Servers
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: FOR each cloud_account BASELINE privileged action frequency over 90 days. CALCULATE Shannon entropy of actions. ALERT if new action is low-frequency OR entropy_score spikes.
  - question: Is a cloud-native account performing privileged actions that are characteristic of a different, more privileged peer group?
    context: This question uses peer group analysis to identify when an account is acting outside of its expected role. By clustering users based on the types of privileged actions they perform, we can define behavioral norms for different roles (e.g., 'Help Desk', 'Domain Admin'). An alert is triggered when a cloud-native account, behaviorally clustered with 'Standard Users', suddenly starts performing actions typical of the 'Domain Admin' cluster, indicating a likely privilege escalation.
    answer_sources:
      - Windows Event ID 4624
      - Windows Event ID 4728
      - Windows Event ID 4732
      - Windows Event ID 4738
      - Windows Event ID 4756
      - Windows Event ID 1102
      - Domain Controllers
      - Active Directory Federation Services (ADFS) servers
      - Group Policy Management Servers
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: CLUSTER users by privileged_action_vectors. IDENTIFY peer groups. ALERT if cloud_account's actions match a more privileged peer group than its own.
  - question: Following a successful logon by a cloud-native account, is there any subsequent network traffic from the same source IP to an internal host over a non-standard or unapproved port?
    context: This question correlates authentication events with network traffic to detect post-exploitation activity. An adversary often establishes a C2 channel immediately after gaining access. By linking a successful cloud account logon to subsequent network connections from the same IP within a short time window (10 minutes), and filtering for traffic to unapproved ports, we can identify likely C2 channel establishment.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Windows Event ID 4624
      - Network Egress/Ingress Points
      - DNS Servers
      - Internal Server Segments
      - Domain Controllers
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: JOIN Event 4624 (cloud_account_logon) with Zeek conn.log on source_ip and timestamp (within 10 mins). ALERT if connection destination_port NOT IN approved_ingress_ports.
  - question: Following a cloud account logon, are there any connections to internal hosts that exhibit statistically anomalous characteristics, such as rare destination ports or high data exfiltration ratios?
    context: This question uses statistical baselines to spot C2 traffic that might use standard ports but has other anomalous features. By baselining the typical destination ports and data transfer ratios for each internal host, we can detect deviations. An alert on a rare port or an unusually high outbound-to-inbound data ratio (`resp_bytes / orig_bytes`) can indicate C2 communication or data staging for exfiltration.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Windows Event ID 4624
      - Network Egress/Ingress Points
      - DNS Servers
      - Internal Server Segments
      - Domain Controllers
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: FOR each internal_host BASELINE inbound port frequency and data_transfer_ratios from cloud IPs. AFTER cloud_logon, ALERT if new_connection_port_frequency < 1st percentile OR data_ratio > 99th percentile.
  - question: Can time-series analysis of network connection logs detect periodic beaconing behavior indicative of C2 communication from a cloud source IP?
    context: This question applies signal processing techniques to network data to find the 'heartbeat' of malware. C2 agents often communicate with their controller at regular intervals (beaconing). By applying algorithms like Fast Fourier Transform (FFT) to the timestamps of connections from a single cloud IP to an internal host, we can detect these repeating patterns, providing strong evidence of an active C2 channel, even if the traffic volume is low.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Windows Event ID 4624
      - Network Egress/Ingress Points
      - DNS Servers
      - Internal Server Segments
      - Domain Controllers
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: FOR connections from single_source_ip to single_destination_host APPLY FFT/Autocorrelation to timestamp series. ALERT if strong periodic signal is detected.