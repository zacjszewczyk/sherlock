[
  {
    "information_requirement": "Is an adversary exfiltrating data from our mobile devices over unencrypted, non-C2 protocols? (PIR)",
    "tactic_id": "TA0036",
    "tactic_name": "Exfiltration",
    "indicators": [
      {
        "technique_id": "T1639.001",
        "name": "Exfiltration Over Unencrypted Non-C2 Protocol",
        "evidence": [
          {
            "description": "A series of DNS queries, often using TXT, CNAME, or NULL record types, originating from a single mobile device IP to a single parent domain. These queries exhibit characteristics of DNS Tunneling: the subdomain portion of the query is abnormally long (e.g., > 100 characters), has high Shannon entropy (e.g., > 4.5, indicating encoded data), and occurs at a high, sustained frequency (e.g., > 50 queries per minute).",
            "data_sources": [
              "Zeek dns.log",
              "Zeek conn.log"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Network egress points, DNS resolver logs, VPN concentrators, corporate Wi-Fi access point logs, Mobile Device Management (MDM) platforms, Cloud Access Security Broker (CASB) logs.",
            "action": "1. (Symbolic) Create a rule to generate a high-severity alert when the 'query' field in Zeek dns.log matches a domain on an intelligence feed of known DNS tunneling C2s. Also, alert on any query where the 'qtype_name' is NULL, as this is highly anomalous for legitimate mobile device traffic. 2. (Statistical) For each DNS query in Zeek dns.log, calculate the length and Shannon entropy of the subdomain. Establish a network-wide baseline for these metrics. Generate a medium-severity alert when a query's length exceeds the 99th percentile or its entropy is > 4.5. Concurrently, track the query rate per source IP to a specific second-level domain over a 1-minute rolling window. If this rate exceeds 3 standard deviations above the device's historical baseline, generate another alert. Correlate these alerts: if a single source IP triggers both a high-entropy/length alert and a high-frequency alert for the same domain within 5 minutes, escalate to a high-severity incident. 3. (Machine Learning) Train a Random Forest classifier to predict the probability of a DNS query being malicious. Features should include: query length, subdomain entropy, ratio of numeric to alphabetic characters, query type (one-hot encoded), historical rarity of the parent domain across the enterprise, and the entropy of query types from the source IP over the last hour. Flag queries with a predicted probability > 0.9 for analyst investigation. A supporting time-series anomaly detection model (e.g., SARIMA) on the volume of DNS TXT record queries per device can also detect uncharacteristic bursts indicative of exfiltration."
          },
          {
            "description": "An outbound HTTP POST or PUT request from a mobile device to a low-reputation or newly registered domain, where the request body size ('post_body_len') is anomalously large (e.g., > 5MB or > 99th percentile of user baseline). The request body content has high Shannon entropy (e.g., > 4.2), and the request may feature a non-standard User-Agent (e.g., 'curl/7.68.0', 'python-requests/2.25.1') or a suspicious 'Content-Type' header like 'application/octet-stream' directed to a non-API endpoint.",
            "data_sources": [
              "Zeek http.log",
              "Zeek conn.log",
              "Windows Event ID 4688"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Network egress points, API Gateways, web proxy logs, MDM/UEM logs with network activity, and Cloud Access Security Broker (CASB) logs.",
            "action": "1. (Symbolic) In Zeek http.log, alert on any POST/PUT request where the 'host' or destination IP matches a threat intelligence feed or has a domain registration age of < 30 days. Additionally, create a rule to flag any request where the 'user_agent' field contains substrings like 'curl', 'wget', 'python-requests', or is null, as these are atypical for standard mobile applications. 2. (Statistical) For each source IP, establish a baseline of outbound POST/PUT request body sizes ('post_body_len' in Zeek http.log) and the ratio of POST/PUT requests to GET requests for each destination domain. Alert when a request's size exceeds the 99th percentile of the IP's baseline or if the POST/GET ratio for a domain exceeds 3 standard deviations from the norm. Upon alert, automatically calculate the Shannon entropy of the request body; an entropy score > 4.2 should escalate the alert. 3. (Machine Learning) Use an Isolation Forest model to detect anomalous HTTP requests from mobile devices. The feature set should include: 'post_body_len', destination IP rarity, request body entropy, rarity of the 'user_agent' string, rarity of the 'Content-Type' header, and the POST-to-GET request ratio for the destination. Requests flagged as outliers require analyst review. A companion LSTM autoencoder model can monitor the time-series of outbound data volume per user to detect sudden, uncharacteristic spikes in data transfer."
          },
          {
            "description": "Any outbound FTP connection (port 21/TCP) from an IP address associated with a mobile device. This protocol is highly atypical for modern mobile applications and is considered suspicious by default. The suspicion is elevated if the session involves file upload commands like 'STOR' or transfers an unusually large volume of data (e.g., > 10MB).",
            "data_sources": [
              "Zeek ftp.log",
              "Zeek conn.log",
              "Windows Event ID 5156",
              "Windows Event ID 4624"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Network egress points, network firewalls, VPN concentrators, corporate Wi-Fi access points, and DMZ network segments.",
            "action": "1. (Symbolic) Implement a zero-tolerance rule in the SIEM to generate a critical alert for any connection from a mobile device IP range to an external destination on port 21/TCP, as logged in Zeek conn.log or Windows Event ID 5156 (Windows Filtering Platform permitted a connection). If Zeek ftp.log is available, escalate the alert to critical if the 'command' field is 'STOR' (store file). Correlate with Windows Event ID 4624 to identify the user and parent process that initiated the FTP client. 2. (Statistical) Upon a symbolic alert, analyze the total bytes transferred ('orig_bytes' + 'resp_bytes' in Zeek conn.log). If the data volume exceeds the 99.9th percentile of all of that device's network sessions over the past 30 days, or is simply greater than a hard threshold like 10MB, escalate the alert. A first-time use of FTP from the device in its recorded history also serves as a strong escalating factor. 3. (Machine Learning) Employ K-Means clustering for peer group analysis. For each device, create a feature vector including a count of distinct protocols used (e.g., DNS, HTTP, HTTPS), the entropy of destination IPs, and average daily outbound bytes. A mobile device falling into a cluster by itself, or one characterized by the presence of FTP usage, should be flagged as a high-confidence outlier requiring immediate investigation."
          }
        ]
      }
    ],
    "version": "1.3",
    "date_created": "2025-09-26",
    "last_updated": "2025-09-29",
    "contributors": [
      "Zachary Szewczyk",
      "Ask Sage"
    ]
  }
]