[
  {
    "information_requirement": "Is the adversary developing resources for operations, specifically DNS infrastructure?",
    "tactic_id": "TA0042",
    "tactic_name": "Resource Development",
    "indicators": [
      {
        "technique_id": "T1583.002",
        "name": "DNS Server",
        "evidence": [
          {
            "description": "An internal host sends a DNS query where the queried domain, or the IP address in the DNS answer, matches an entry on a high-confidence threat intelligence feed of known malicious infrastructure.",
            "data_sources": [
              "Zeek dns.log",
              "Windows Event ID 260"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Network Egress Points, Enterprise DNS Resolvers",
            "action": [
              "(Symbolic) Continuously ingest high-confidence threat intelligence feeds of malicious domains and DNS server IPs. Create a detection rule that performs a real-time match between the 'query' field in Zeek dns.log and the malicious domain feed, and between the 'answers' field (resolved IPs) and the malicious IP feed. Any match should trigger a high-severity alert for analyst review.",
              "(Statistical) For domains that match a threat feed, calculate the number of unique internal source IPs ('id.orig_h') that have queried it. If the count of unique clients is below the 5th percentile of query counts for all external domains (indicating targeted rather than widespread activity), automatically escalate the alert's priority.",
              "(Machine Learning) Train a binary classification model (e.g., Logistic Regression, Gradient Boosting) using features from the threat feed (e.g., feed source reputation, confidence score) and internal query data (e.g., query frequency, number of unique clients). Use the model to classify new matches as either 'High-Confidence True Positive' or 'Requires Analyst Vetting' to help prioritize alerts originating from lower-confidence intelligence feeds."
            ]
          },
          {
            "description": "A DNS query from an internal host is for a domain that has a low Levenshtein distance (e.g., <= 2) or is a visual homoglyph of a domain on a monitored list of corporate, partner, or high-value brand domains.",
            "data_sources": [
              "Zeek dns.log"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Network Egress Points, Endpoint Devices",
            "action": [
              "(Symbolic) Maintain a list of monitored corporate and partner domains. Use a script (e.g., dnstwist) to pre-generate common permutations and homoglyphs. Create a detection rule that matches the 'query' field in Zeek dns.log against this pre-generated list of suspicious domains. A match triggers a medium-severity alert.",
              "(Statistical) For all queried domains not on an allowlist, calculate the Levenshtein distance against the monitored domain list. Flag any domain with a distance of 2 or less. Separately, calculate the Shannon entropy of the flagged domain name; a domain with both high similarity (low distance) to a brand asset and high entropy (e.g., above the 90th percentile of all domains) should have its risk score significantly increased.",
              "(Machine Learning) Vectorize all queried domain names using character n-grams. Use a clustering algorithm like DBSCAN to group syntactically similar domains. Apply an anomaly detection model (e.g., Isolation Forest) to these clusters to identify domains that are syntactically similar to each other but not to any known-good domain, a pattern often associated with domain generation algorithms (DGAs)."
            ]
          },
          {
            "description": "An internal host is among the first five hosts in the organization to resolve a domain registered within the last 30 days, where the DNS answer has a Time-To-Live (TTL) value less than 300 seconds.",
            "data_sources": [
              "Zeek dns.log"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Network Egress Points, Enterprise DNS Resolvers, Endpoint Devices of High-Value Targets",
            "action": [
              "(Symbolic) For every unique domain in Zeek dns.log, perform a WHOIS lookup to get the creation date. Create a rule that alerts if a domain's creation date is less than 30 days old AND the DNS response TTL value is less than 300 seconds. Correlate with internal logs to confirm that fewer than five unique hosts have queried this domain before elevating the alert.",
              "(Statistical) Establish a baseline of 'first seen' domains. Calculate the 95th percentile for TTL values and the 5th percentile for domain age for all newly observed domains. Create a risk score where risk = (1 / age_in_days) + (1 / TTL). Alert on queries where this risk score exceeds 3 standard deviations above the mean risk score for new domains observed in a 24-hour period.",
              "(Machine Learning) Model the count of 'first seen' newly registered domains (NRDs) per hour as a time series. Use a forecasting model like SARIMA or Prophet to predict the expected number of new NRD queries. An observed count that significantly exceeds the model's prediction interval indicates a potential campaign kickoff involving newly created infrastructure and should trigger an investigation."
            ]
          },
          {
            "description": "More than three distinct domains, all registered within the last 60 days, resolve to the same IP address or to IP addresses within the same /24 subnet, after being queried by internal hosts.",
            "data_sources": [
              "Zeek dns.log",
              "Zeek conn.log"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Network Egress Points, Passive DNS databases, Cloud Provider Network Infrastructure",
            "action": [
              "(Symbolic) From Zeek dns.log, create a table of (domain, resolved_ip). Enrich this table with WHOIS data for domain age. Filter for domains younger than 60 days. Group by 'resolved_ip' and count unique domains. Create a rule that alerts if the count of unique domains is greater than 3 for a single IP address.",
              "(Statistical) For all IP addresses that resolve newly registered domains (NRDs), calculate the ratio of NRDs to total domains resolving to that IP. An IP address where this ratio is in the top 99th percentile is highly suspicious. Further, calculate the Jaccard similarity coefficient between the sets of internal hosts querying the different NRDs on that IP; a high similarity (e.g., > 0.7) indicates a coordinated group of compromised hosts.",
              "(Machine Learning) Construct a bipartite graph where nodes are 'internal hosts' and 'resolved IPs', with an edge drawn if a host queried a domain resolving to that IP. Use a community detection algorithm (e.g., Louvain Modularity) to find clusters. A community with a small number of IPs and a distinct set of internal hosts, where the IPs are known to host NRDs, strongly suggests a C2 cluster."
            ]
          }
        ]
      }
    ],
    "last_updated": "2025-09-30",
    "version": "2.3",
    "date_created": "2025-05-04",
    "contributors": [
      "Zachary Szewczyk",
      "Ask Sage"
    ]
  }
]