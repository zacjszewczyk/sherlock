[
  {
    "information_requirement": "Has the adversary leveraged information from closed sources to conduct reconnaissance or prepare for initial access?",
    "tactic_id": "TA0043",
    "tactic_name": "Reconnaissance",
    "indicators": [
      {
        "technique_id": "T1597",
        "name": "Search Closed Sources",
        "evidence": [
          {
            "description": "A successful (Windows Event ID 4624) or failed (Windows Event ID 4625) login attempt using a username that is present on a list of credentials known to be exposed in a third-party data breach, originating from an external IP address.",
            "data_sources": [
              "Windows Event ID 4624",
              "Windows Event ID 4625",
              "Zeek conn.log"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Externally-facing authentication services (e.g., VPN, OWA, M365), Domain Controllers, Cloud IAM services",
            "action": [
              "Query for all authentication events (Windows Event IDs 4624, 4625) where the source IP address is external (derived from Zeek conn.log context) and the target username appears on a pre-ingested threat intelligence list of breached accounts. Generate a high-severity alert for any match.",
              "For each account on the breached credentials list, establish a 30-day baseline of failed login counts (Event ID 4625) from external IP addresses. Using a sliding 24-hour window, calculate the z-score of the current failed login count against the baseline distribution. Generate an alert if the z-score exceeds 3, indicating a statistically significant increase in brute-force or credential stuffing activity.",
              "Train a supervised classification model (e.g., logistic regression or random forest) using historical login data. Features should include: a binary flag 'is_on_breach_list', a binary flag 'is_external_ip', 'time_of_day', 'day_of_week', 'source_ASN_rarity', and 'source_ip_reputation'. Deploy the model to score new login events in real-time and alert on those with a high probability of being malicious."
            ]
          },
          {
            "description": "A single external source IP address generating a high number of failed login attempts (Windows Event ID 4625) against a high number of unique usernames within a short time frame, characteristic of a password spraying attack.",
            "data_sources": [
              "Windows Event ID 4625",
              "Zeek conn.log"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Externally-facing authentication services, Perimeter firewalls and network gateways",
            "action": [
              "Create a SIEM rule to trigger an alert when a single source IP address (from Zeek conn.log) is associated with failed login events (Windows Event ID 4625) for more than 20 unique target usernames within a 10-minute window.",
              "For each external source IP, calculate the Shannon entropy of the set of unique target usernames from failed login events (Windows Event ID 4625) within a 1-hour sliding window. An entropy value that exceeds the 99th percentile of the historical distribution for all external IPs indicates a password spray, as the attacker is targeting a wide, non-repeating set of users.",
              "Apply a density-based clustering algorithm (e.g., DBSCAN) to authentication events. Use features such as source IP, event outcome (failure), and a numerical hash of the target username, aggregated over a 5-minute window. Isolate and alert on clusters characterized by a single source IP, a high count of unique usernames, and a high failure rate, which represent anomalous password spraying activity."
            ]
          },
          {
            "description": "A successful login (Windows Event ID 4624) to an account that has been inactive for an extended period (e.g., > 90 days), particularly when the login originates from an external or previously unseen source IP address.",
            "data_sources": [
              "Windows Event ID 4624",
              "Active Directory User Object Attributes (e.g., lastLogonTimestamp)",
              "Zeek conn.log"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Domain Controllers, Active Directory servers, Externally-facing authentication services",
            "action": [
              "Periodically query Active Directory to generate a watchlist of dormant accounts where the 'lastLogonTimestamp' is older than 90 days. Create a rule to generate a high-severity alert for any successful login (Windows Event ID 4624) by an account on this watchlist, especially if the source IP is external (context from Zeek conn.log).",
              "For each user account, calculate the mean and standard deviation of the time delta in days between their successful logins over the past year. For each new successful login, calculate the time since the previous login. Flag any login where this delta exceeds the user's personal mean by more than 3 standard deviations as a temporal anomaly.",
              "For each user, model their login activity as a time series. Apply an anomaly detection algorithm (e.g., Seasonal-Hybrid ESD or ARIMA) to forecast expected login behavior. A successful login (Windows Event ID 4624) that occurs during a period of predicted inactivity and is flagged as a significant anomaly by the model indicates a potential account compromise using old credentials."
            ]
          },
          {
            "description": "One or more connection attempts from an external IP address to a host or port on a curated list of non-public assets, where no legitimate external traffic is expected. These attempts are often identified in Zeek conn.log with a state of 'S0', 'REJ', or 'RSTO'.",
            "data_sources": [
              "Zeek conn.log",
              "Zeek notice.log"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Network DMZ, Internal server subnets, Cloud environment subnets hosting non-public services, Perimeter firewalls",
            "action": [
              "Maintain a reference set of IP addresses, subnets, and ports corresponding to non-public infrastructure. Create a high-severity alert for any connection log entry (e.g., from Zeek conn.log) where an external source IP attempts to connect to an asset in this reference set.",
              "Establish a baseline for connection attempts from external IPs to the non-public asset list (this baseline should be zero or near-zero). Implement a threshold-based alert that triggers if the count of connection attempts from a single external IP to these assets exceeds a low number (e.g., >5) within a 1-hour window. This may also correlate with Zeek's 'Intel::ADDR_IN_USE' or scanning notices.",
              "Train a One-Class SVM model on feature vectors derived from legitimate network traffic to the network perimeter. Features should include destination IP, destination port, protocol, and connection duration. Use the trained model to classify new, incoming connection attempts from external sources. Connections classified as anomalies, particularly those targeting non-public assets, indicate targeted reconnaissance."
            ]
          },
          {
            "description": "A successful login (Windows Event ID 4624) that exhibits multiple anomalous properties simultaneously when compared to the user's established behavioral baseline, such as originating from a rare geographic location, a new device, or occurring at an atypical time.",
            "data_sources": [
              "Windows Event ID 4624",
              "Zeek conn.log"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Externally-facing authentication services, VPN concentrators, Domain Controllers",
            "action": [
              "For each user, maintain a dynamic safelist of known source countries and ASNs based on their login history over the last 30-60 days. Create a rule to alert on any successful login (Windows Event ID 4624) that originates from a country or ASN not present in the user's individual safelist.",
              "For each user, build a multi-faceted profile from their last 90 days of login data, including: a set of known source countries, a set of known source ASNs, and a distribution (mean, stddev) of login hours. For each new login, assign risk points for deviations: +1 for a new country, +1 for a new ASN, +1 if login hour z-score > 2. Alert if the total risk score for a single login event exceeds a defined threshold (e.g., 2).",
              "For each user, or for groups of users with similar roles, train an unsupervised anomaly detection model (e.g., Isolation Forest or a variational autoencoder) on login data. Use features like 'hour_of_day', 'day_of_week', a categorical hash of the source ASN, and a rarity score for the source country. The model will learn a representation of normal behavior and flag any login that has a high anomaly score, indicating it is dissimilar from the user's established patterns."
            ]
          }
        ]
      }
    ],
    "last_updated": "2025-09-30",
    "version": "2.3",
    "date_created": "2025-05-04",
    "contributors": [
      "Zachary Szewczyk",
      "Ask Sage"
    ]
  }
]