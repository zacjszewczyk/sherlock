[
  {
    "information_requirement": "Is the adversary creating cloud snapshots to evade defenses or prepare for data exfiltration?",
    "tactic_id": "TA0005",
    "tactic_name": "Defense Evasion",
    "indicators": [
      {
        "technique_id": "T1578.001",
        "name": "Create Snapshot",
        "evidence": [
          {
            "description": "A cloud snapshot API call (e.g., EC2 CreateSnapshot, Azure Snapshots Create Or Update, compute.snapshots.insert) originates from a source IP address present on a threat intelligence list, or the API call is made with a User-Agent string rarely seen in the environment.",
            "data_sources": [
              "AWS CloudTrail",
              "Azure Activity Logs",
              "Google Cloud Audit Logs",
              "Zeek conn.log",
              "Zeek http.log",
              "Zeek dns.log"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Cloud Management Plane, Internet Gateway, DNS Resolvers",
            "action": [
              "Symbolic: Join cloud provider API logs (e.g., CloudTrail) or network logs (Zeek conn.log) with a threat intelligence feed on source IP addresses. Generate an alert on any connection to a known cloud provider API endpoint (identified via Zeek dns.log or API log metadata) from a matched malicious IP that performs a snapshot creation action.",
              "Statistical: For all API calls related to snapshot creation, profile the User-Agent strings from Zeek http.log or cloud API logs. Calculate the frequency of each User-Agent across the organization over a 30-day baseline. A User-Agent that falls below the 1st percentile of frequency should be flagged for review.",
              "Machine Learning: Train a one-class SVM (Support Vector Machine) on feature vectors derived from cloud API logs, including (Source ASN, Source Geolocation, User-Agent, IAM Role/User). Use the model to score new snapshot creation API calls; scores indicating high deviation from the norm represent potential non-standard tool usage or unauthorized access."
            ]
          },
          {
            "description": "A process is created on an endpoint where the command-line arguments contain strings for creating, modifying, or sharing a cloud snapshot using a known CLI tool (aws.exe, az.cmd, gcloud.cmd).",
            "data_sources": [
              "Windows Event ID 4688",
              "Sysmon Event ID 1"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Administrator Workstations, CI/CD Pipeline Servers, Developer Endpoints, Jump Boxes/Bastion Hosts",
            "action": [
              "Symbolic: Using a SIEM rule, scan the 'ProcessCommandLine' or 'CommandLine' field in Windows Event ID 4688 or Sysmon Event ID 1 for regular expressions matching snapshot creation or modification commands (e.g., 'aws ec2 create-snapshot', 'az snapshot create', 'gcloud compute snapshots create', 'modify-snapshot-attribute', 'az snapshot grant-access'). Generate an alert for any match.",
              "Statistical: For processes matching cloud CLIs (aws.exe, az.cmd, gcloud.cmd), calculate the Shannon entropy of the command-line arguments. Establish a 90-day baseline entropy score for each user-host pair. Flag any execution where the entropy score exceeds 3 standard deviations above the baseline, as this may indicate obfuscation or non-standard parameters.",
              "Machine Learning: Deploy a pre-trained NLP classification model (e.g., a fine-tuned BERT model) to analyze command-line strings from cloud CLI tools. The model should classify each command as 'benign-admin-activity' or 'suspicious-snapshot-command'. Score and alert on commands classified as suspicious with high confidence."
            ]
          },
          {
            "description": "A snapshot creation event is followed within a 15-minute window by a subsequent API call that modifies the snapshot's permissions to be public, shares it with an unknown external account, or copies it to an unapproved geographic region.",
            "data_sources": [
              "AWS CloudTrail (CreateSnapshot, ModifySnapshotAttribute)",
              "Azure Activity Logs (Microsoft.Compute/snapshots/write, Microsoft.Compute/snapshots/beginGetAccess/action)",
              "Google Cloud Audit Logs (compute.snapshots.insert, compute.snapshots.setIamPolicy)",
              "Windows Event ID 4688",
              "Sysmon Event ID 1"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Cloud Management Plane, Cloud IAM Service, Cloud Storage Services",
            "action": [
              "Symbolic: Create a stateful correlation rule that triggers when a snapshot creation event (e.g., AWS 'CreateSnapshot') for a specific resource ID is followed within 15 minutes by a permission modification event (e.g., AWS 'ModifySnapshotAttribute') for the same resource ID. The rule should check if the modification adds a public group ('allUsers') or an account ID not on a pre-approved allow-list.",
              "Statistical: For each user, calculate the distribution of time deltas between 'snapshot creation' and 'snapshot sharing/copying' events over a 90-day period. Alert if a new time delta falls below the 5th percentile of that user's historical distribution, indicating an unusually rapid sequence of actions.",
              "Machine Learning: Model administrative workflows as sequences of cloud API calls using a Hidden Markov Model (HMM). Train the HMM on event logs from known-good administrative sessions. Analyze new event sequences in real-time; a sequence containing 'create-snapshot' followed by 'share-publicly' that has a low probability score from the trained model should generate a high-severity alert."
            ]
          },
          {
            "description": "A snapshot creation API call is initiated by a user account that has never performed this action before, or the action originates from a source IP, country, or ASN that is anomalous for that user's historical activity.",
            "data_sources": [
              "AWS CloudTrail",
              "Azure Activity Logs",
              "Google Cloud Audit Logs",
              "Windows Event ID 4624",
              "Zeek conn.log"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Cloud IAM Service, Cloud Management Plane, Authentication Servers, VPN Concentrators",
            "action": [
              "Symbolic: Maintain an allow-list of user accounts and IAM roles authorized to perform snapshot creation. Generate an alert for any snapshot creation event initiated by a user or role not on this list. Additionally, for any user, alert on the first time they ever perform the action ('First Seen' rule).",
              "Statistical: For each administrative user, build a historical profile of activity including source IP subnets, source ASNs, and time-of-day (hour buckets) over 90 days. For each new snapshot creation event, compare the event's features to the user's profile. If the source ASN is new and the time of day falls into a 0-activity bucket for that user, flag it as anomalous.",
              "Machine Learning: For each user, train an Isolation Forest model on features from their historical cloud API activity, including Source IP, User Agent, Time of Day, and Day of Week. Use the model to score each new snapshot creation event. An 'anomaly' score from the model indicates a significant deviation from the user's established behavioral patterns and warrants investigation."
            ]
          },
          {
            "description": "A snapshot creation event by a user or on a host occurs within 24 hours of other suspicious precursor activities on the same host, such as the execution of credential dumping tools, extensive discovery commands, or the download of new command-line utilities.",
            "data_sources": [
              "Windows Event ID 4688",
              "Sysmon Event ID 1",
              "Sysmon Event ID 10 (ProcessAccess for credential dumping)",
              "Zeek conn.log",
              "Zeek files.log"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Endpoint Devices (Workstations, Servers), CI/CD Pipeline Servers, Internet Gateway, Internal Network Segments",
            "action": [
              "Symbolic: Create a multi-stage correlation rule. Stage 1 triggers on a high-confidence alert for a precursor event (e.g., Sysmon Event ID 10 access to lsass.exe, download of 'aws.exe' from a non-corporate URL via Zeek files.log). If Stage 1 triggers, Stage 2 looks for a snapshot creation command (via Event ID 4688) from the same host or user within the next 24 hours and generates a high-priority incident.",
              "Statistical: Implement a host-based risk scoring model. Assign numerical risk points to precursor events: 'net user' command execution (+1), Mimikatz hash detected (+10), download of new executable from untrusted source (+5). Sum the points for each host over a rolling 24-hour window. If a snapshot creation event occurs on a host whose risk score exceeds the 95th percentile of all host scores, escalate for immediate review.",
              "Machine Learning: Train a Gradient Boosting classifier on time-windowed event sequences from hosts. Features should include counts of discovery commands, presence of credential access tool hashes, network connection counts to new IPs, and file creation events within a 24-hour window preceding a potential snapshot creation. The model will output a probability that the sequence leading to the snapshot event is malicious."
            ]
          }
        ]
      }
    ],
    "last_updated": "2025-09-30",
    "version": "2.3",
    "date_created": "2025-05-04",
    "contributors": [
      "Zachary Szewczyk"
    ]
  }
]