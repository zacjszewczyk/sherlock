[
  {
    "information_requirement": "Has the adversary impacted systems or data by defacing internal resources?",
    "tactic_id": "TA0040",
    "tactic_name": "Impact",
    "indicators": [
      {
        "technique_id": "T1491.001",
        "name": "Internal Defacement",
        "evidence": [
          {
            "description": "Detection of files on internal web servers or endpoints whose SHA256 hash, filename, or embedded content matches known defacement tools, scripts, or imagery signatures from threat intelligence feeds.",
            "data_sources": [
              "Windows Event ID 4663",
              "Zeek files.log",
              "Zeek http.log"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Internal Web Servers (e.g., SharePoint, Confluence, Intranet), File Servers, Endpoint Desktops",
            "action": [
              "Continuously scan files written to web server directories (monitored via Windows Event ID 4663) and files transferred over the network (Zeek files.log) by matching their SHA256 hashes against a threat intelligence feed of known defacement tool, image, or script hashes. Generate an alert upon a match.",
              "For HTTP POST/PUT requests observed in Zeek http.log targeting web servers, calculate the entropy of the transferred file payloads (from Zeek files.log). Flag file writes where the entropy is anomalously high (e.g., > 95th percentile of historical entropy for that server/URL path), suggesting packed or obfuscated scripts, or anomalously low, suggesting simple image/text files replacing complex pages.",
              "Develop a content classification model trained on known-good corporate web content and known-bad defacement pages (e.g., from public archives). Apply this classifier to the body of HTTP responses in Zeek http.log and to files written to web directories to detect content that is thematically or structurally inconsistent with expected corporate content, flagging potential defacement."
            ]
          },
          {
            "description": "Execution of command-line processes with arguments that directly modify system UI elements (e.g., desktop wallpaper) or overwrite web server content files.",
            "data_sources": [
              "Windows Event ID 4688",
              "Windows PowerShell Event ID 4104"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Domain Controllers (for login messages), All Windows Endpoints and Servers",
            "action": [
              "Create a SIEM rule to alert on process creation events (Windows Event ID 4688) where `reg.exe` modifies the `HKCU\\Control Panel\\Desktop\\Wallpaper` registry key, or where `powershell.exe` (via PowerShell Event ID 4104 script block logging) uses `Set-ItemProperty` for the same key. Also, flag command lines containing `copy`, `move`, or `echo` that overwrite common web root files like `index.html` or `default.aspx`.",
              "For each host, establish a baseline of parent-child process relationships. Monitor for anomalous process chains where a common user process (e.g., WINWORD.EXE, OUTLOOK.EXE) spawns a shell (cmd.exe, powershell.exe) which then executes a file copy or registry modification command targeting UI elements. Flag parent-child relationships that are statistically rare (e.g., occurring for the first time or falling below a 1% frequency threshold in the environment).",
              "Utilize a command-line analysis model (e.g., a logistic regression or decision tree classifier trained on benign and malicious command-line arguments) to score the maliciousness of all shell commands. The model should be trained on features like command length, presence of specific keywords (`copy`, `reg add`, `Set-ItemProperty`), file paths (`C:\\inetpub\\wwwroot`), and obfuscation patterns. A high score triggers an alert."
            ]
          },
          {
            "description": "A statistically significant deviation from baseline file modification patterns on internal web servers, measured by volume of writes, source IP address, file extension, or time of day.",
            "data_sources": [
              "Zeek http.log",
              "Zeek files.log",
              "Windows Event ID 4663"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Internal Web Server file systems (e.g., C:\\inetpub\\wwwroot), Network traffic segments leading to internal web servers",
            "action": [
              "Define a watchlist of critical web content files (e.g., `index.html`, `login.aspx`, `web.config`). Create a rule that triggers an immediate alert when a file modification event (Windows Event ID 4663) is logged for any file on this list originating from a process other than an approved deployment or content management service account/process.",
              "For each internal web server, create a time-series baseline of file modifications (from Windows Event ID 4663) and HTTP POST/PUT requests (from Zeek http.log), aggregated per hour. Alert when the volume of modifications exceeds a dynamic threshold, such as 3 standard deviations above the moving average for that hour of the day and day of the week. Additionally, use frequency analysis to flag modifications from source IP addresses or user accounts not in the top 95% of historical content modifiers.",
              "Employ a One-Class Support Vector Machine (OC-SVM) or Isolation Forest model trained on features from normal web update activity. Features should include source IP, user agent (from Zeek http.log), file extension, file size (from Zeek files.log), and process name (from Windows Event ID 4663). The model will identify and alert on any activity that falls outside the learned boundary of normal behavior, indicating a potential defacement attempt."
            ]
          },
          {
            "description": "Observation of a multi-stage behavioral sequence where a non-standard parent process spawns a child that writes a file, which is then used in a subsequent command to alter a system's visual interface.",
            "data_sources": [
              "Windows Event ID 4688",
              "Windows Event ID 4663",
              "Zeek files.log"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "User workstations, Terminal servers (e.g., Citrix), Internal web and application servers",
            "action": [
              "Create a correlation rule that triggers when, within a 60-second window on the same host: 1) A file with a common image extension (.jpg, .png, .bmp) is created (Windows Event ID 4663) by a non-system/non-approved process. 2) A process is created (Windows Event ID 4688) with a command line that references the newly created file's path and modifies a UI registry key.",
              "Calculate the prevalence of specific three-event sequences (e.g., network download -> file write -> registry modify) across the enterprise. Use a statistical measure like Pointwise Mutual Information (PMI) to score the strength of association between these event types. A sequence with an unusually high PMI score, especially if it's rare overall, indicates a strong, non-random behavioral pattern that warrants investigation for defacement.",
              "Use a sequence analysis model, such as a Long Short-Term Memory (LSTM) network, trained on streams of host events (process creation, file modification, registry access). Train the model to predict the 'next' event in a sequence. An alert is generated when the model observes a sequence associated with defacement (e.g., `powershell.exe` -> `file.write(.jpg)` -> `reg.exe modify wallpaper`) that it has learned is a high-risk pattern, or when it encounters a sequence with a very high prediction error, indicating novel, unclassifiable behavior."
            ]
          }
        ]
      }
    ],
    "version": "2.2",
    "date_created": "2025-05-04",
    "last_updated": "2025-09-30",
    "contributors": [
      "Zachary Szewczyk",
      "Ask Sage"
    ]
  }
]