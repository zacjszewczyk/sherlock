[
  {
    "information_requirement": "Has the adversary established persistence by abusing the Microsoft Office Test registry key?",
    "tactic_id": "TA0003",
    "tactic_name": "Persistence",
    "indicators": [
      {
        "technique_id": "T1137.002",
        "name": "Office Test",
        "evidence": [
          {
            "description": "The DLL file specified in the 'Office Test' registry key is unsigned, signed by an untrusted publisher, or has a file hash matching a known malicious indicator.",
            "data_sources": [
              "Windows Event ID 4657",
              "Sysmon Event ID 11"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "All Windows Endpoints and Servers",
            "action": [
              "Symbolic Logic: Upon detecting a modification to the 'Office test\\Special\\Perf' registry key (Windows Event ID 4657), extract the DLL path. For the corresponding file creation event (Sysmon Event ID 11), compare the file's SHA256 hash against a threat intelligence feed of known malicious file hashes. Alert on any match.",
              "Statistical Analysis: For the DLL identified, analyze its Authenticode signature. Calculate the prevalence of the signing publisher across the enterprise over the last 90 days. Alert if the publisher is in the bottom 1st percentile of all observed publishers, or if the DLL is unsigned.",
              "Machine Learning: Utilize a pre-trained classifier (e.g., Gradient Boosting, Random Forest) that uses file features such as PE header information, section entropy, and string analysis to predict the probability of the DLL being malicious. Alert if the model's output probability exceeds a predefined threshold (e.g., > 0.90)."
            ]
          },
          {
            "description": "Creation of or modification to the 'Perf' value within the 'HKEY_CURRENT_USER\\Software\\Microsoft\\Office test\\Special' or 'HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Office test\\Special' registry keys.",
            "data_sources": [
              "Windows Event ID 4657",
              "Sysmon Event ID 13"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "All Windows Endpoints and Servers, Domain Controllers",
            "action": [
              "Symbolic Logic: Create a high-fidelity alert that triggers on any write or create operation to a registry value within the key path '*\\Microsoft\\Office test\\Special\\Perf' using Sysmon Event ID 13 or Windows Event ID 4657. Since this key is not created by default, any modification is highly suspicious.",
              "Statistical Analysis: Profile the names of processes that write to the `\\Software\\Microsoft\\Office\\` registry path. Establish a baseline of common processes (e.g., msiexec.exe, setup.exe). Calculate the frequency of each process name. Trigger an alert if a process outside the top 99th percentile of frequency (e.g., a rare process like 'reg.exe' or 'powershell.exe') writes to the specific '...test\\Special\\Perf' key.",
              "Machine Learning: Implement a one-class SVM model trained on legitimate registry modification events, using features like process name, user context, and target key path. Use the model to detect outlier modifications targeting the Office Test key, which would be flagged as anomalies requiring investigation."
            ]
          },
          {
            "description": "A non-standard process, such as a command-line interpreter (cmd.exe, powershell.exe) or a process executing from a user-writable directory, modifies the 'Office Test' registry key.",
            "data_sources": [
              "Windows Event ID 4657",
              "Sysmon Event ID 13",
              "Sysmon Event ID 1"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "All Windows Endpoints and Servers",
            "action": [
              "Symbolic Logic: Alert when the 'ProcessName' field in a Sysmon Event ID 13 event (Registry Value Set) that modifies the Office Test key matches a blocklist of suspicious processes such as 'cmd.exe', 'powershell.exe', 'wscript.exe', 'cscript.exe', or 'rundll32.exe'.",
              "Statistical Analysis: For each modification to the Office Test key, analyze the associated process command line from Sysmon Event ID 1. Calculate the character entropy of the command line. A high entropy value, exceeding the 95th percentile for that specific process name, suggests obfuscation (e.g., Base64 encoding) and should be alerted on.",
              "Machine Learning: Train a decision tree classifier on features from process execution events (parent process, command-line arguments, user context, process path). Use the model to classify registry modification events as 'benign' (e.g., initiated by a known installer) or 'suspicious' (e.g., initiated by powershell.exe with an encoded command argument)."
            ]
          },
          {
            "description": "A Microsoft Office application (e.g., WINWORD.EXE) spawns a child process not typically associated with its normal operation, such as a command-line interpreter, and initiates external network connections.",
            "data_sources": [
              "Windows Event ID 4688",
              "Zeek conn.log",
              "Zeek dns.log"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "All Windows Endpoints, Network Egress Points, DNS Servers",
            "action": [
              "Symbolic Logic: Monitor Windows Event ID 4688 for instances where an Office application process (e.g., WINWORD.EXE, EXCEL.EXE, POWERPNT.EXE) is the parent process for a high-risk child process (e.g., 'cmd.exe', 'powershell.exe', 'rundll32.exe'). Correlate with Zeek conn.log to see if that process then makes an outbound connection to a non-Microsoft IP address.",
              "Statistical Analysis: For each Office application, build a baseline of normal child processes and their frequencies over a 30-day period. Alert when a child process is observed that occurs in less than 0.1% of all child process creations for that specific Office parent. Additionally, analyze associated DNS requests in Zeek dns.log and alert if the query is for a domain with a high entropy score (e.g., > 3.5), suggesting DGA activity.",
              "Machine Learning: Apply a time-series anomaly detection algorithm (e.g., ARIMA or Seasonal-Hybrid ESD) to the volume of outbound network traffic (bytes_out in Zeek conn.log) from a host immediately following an Office application launch. A sudden, anomalous spike in traffic volume compared to the user's historical baseline for that activity indicates suspicious behavior."
            ]
          },
          {
            "description": "A temporal correlation exists between the modification of the 'Office Test' registry key to point to a DLL in a non-standard directory (e.g., %APPDATA%, C:\\Users\\Public) and a subsequent network connection from the parent Office process to a low-reputation or newly registered domain.",
            "data_sources": [
              "Sysmon Event ID 13",
              "Windows Event ID 4688",
              "Zeek conn.log",
              "Sysmon Event ID 3"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "All Windows Endpoints and Servers, Network Egress Points",
            "action": [
              "Symbolic Logic: Create a correlated alert that fires when three events occur on the same host within a 5-minute window: 1. A registry value set (Sysmon Event ID 13) for the Office Test key. 2. A process creation (Windows Event ID 4688) for an Office application. 3. A network connection (Sysmon Event ID 3 or Zeek conn.log) from that Office process to an external IP address on a threat intelligence blocklist.",
              "Statistical Analysis: For DLLs loaded by Office applications, calculate the frequency of their file paths. Alert if a DLL is loaded from a path that falls in the bottom 5th percentile of rarity (e.g., C:\\ProgramData\\, %TEMP%). Correlate this with subsequent network connections and increase a risk score based on the rarity of the destination IP's Autonomous System Number (ASN) within the organization's traffic.",
              "Machine Learning: Use a graph-based analysis model where nodes represent processes, files, registry keys, and network connections. Search for a specific subgraph pattern: (Anomalous Process) -> [writes to] -> (Office Test Key) -> [loads] -> (DLL in rare path) -> [executed by] -> (Office Process) -> [connects to] -> (External IP). The discovery of this multi-step pattern using graph traversal algorithms provides a high-confidence indicator of compromise."
            ]
          }
        ]
      }
    ],
    "version": "2.2",
    "date_created": "2025-05-04",
    "last_updated": "2025-09-30",
    "contributors": [
      "Zachary Szewczyk",
      "Ask Sage"
    ]
  }
]