[
  {
    "information_requirement": "Is an adversary enumerating network shares to identify data for collection or hosts for lateral movement?",
    "tactic_id": "TA0007",
    "tactic_name": "Discovery",
    "indicators": [
      {
        "technique_id": "T1135",
        "name": "Network Share Discovery",
        "evidence": [
          {
            "description": "A process executes a script or binary whose file hash (e.g., SHA256) matches a known indicator of compromise (IOC) associated with network discovery tools (e.g., PowerView, BloodHound ingestors).",
            "data_sources": [
              "Windows Event ID 4688",
              "Windows Event ID 4104"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Endpoint Workstation Subnets, Server Subnets, Domain Controllers",
            "action": "Symbolic: Continuously monitor process creation events (Windows Event ID 4688) and PowerShell script block logs (Windows Event ID 4104). Upon execution, calculate the file hash for binaries or the script block hash. Compare the resulting hash against a threat intelligence feed of known malicious file hashes for discovery tools. Generate a high-severity alert upon a match. Statistical: Maintain a baseline of all executable and script block hashes seen in the environment. Calculate the prevalence (rarity) of each hash. A hash that is both rare (e.g., seen on < 0.1% of hosts) and not on an allowlist of known-good software should have its risk score elevated. ML: Implement a machine learning classifier (e.g., Gradient Boosting) that uses static file features (e.g., file entropy, imported functions, string analysis) to predict if an executable is a 'discovery tool'. Run this classifier on newly observed, low-prevalence files to proactively identify unknown threats."
          },
          {
            "description": "Execution of built-in network share discovery commands (e.g., `net view`, `net share`) or PowerShell equivalents (e.g., `Get-SmbShare`), particularly when initiated by an anomalous parent process (e.g., a web server, office application).",
            "data_sources": [
              "Windows Event ID 4688",
              "Windows Event ID 4104"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Endpoint Workstation Subnets, Server Subnets, Domain Controllers",
            "action": "Symbolic: Create detection rules that search process command-line arguments (from Event ID 4688) and PowerShell script block text (from Event ID 4104) for regular expressions matching discovery commands, such as `(?i)net\\.exe\\s+view`, `(?i)net\\.exe\\s+share`, or `Get-SmbShare`. Alert on any matches. Statistical: Profile all parent-child process relationships across the environment to establish a frequency baseline. Calculate the probability of a specific parent (e.g., `winword.exe`) spawning a child process that executes a discovery command. An execution from a parent process that falls below a low probability threshold (e.g., $$ P(\\text{child} | \\text{parent}) < 0.01 $$) should be flagged as anomalous. ML: Utilize a sequence-aware model (e.g., LSTM) trained on command-line histories per user session. The model learns normal sequences of activity. Flag sessions containing sequences that are statistically unlikely but characteristic of reconnaissance, such as `whoami` -> `ipconfig /all` -> `net view \\\\fileserver01`."
          },
          {
            "description": "A single source host establishes an anomalously high number of unique SMB session attempts (TCP/445) or share enumerations to distinct hosts on the network within a short time window.",
            "data_sources": [
              "Zeek conn.log",
              "Zeek smb.log",
              "Windows Event ID 5140"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Core Network Switches (for SPAN/TAP), File Servers, Domain Controllers",
            "action": "Symbolic: Implement a stateful rule that triggers when a single source IP (`id.orig_h` in Zeek conn.log) connects to more than 20 unique destination IPs (`id.resp_h`) on destination port 445 within a 5-minute window. This provides a simple threshold-based alert for broad scanning activity. Statistical: For each source host, aggregate SMB connection events (Zeek smb.log `tree_connect` or Windows Event ID 5140) over a 10-minute rolling window. Calculate the count of unique destination hosts accessed. Compare this count against a dynamically calculated 98th percentile for all hosts. A count exceeding this percentile indicates statistically significant scanning behavior. ML: Apply time-series anomaly detection (e.g., ARIMA) to the rate of new SMB connections originating from each host. The model will learn the normal 'heartbeat' of SMB traffic for each host and alert on sudden, unexplained spikes that deviate from the forecast. Alternatively, use a clustering algorithm like DBSCAN on features `(unique_dest_count, total_connections)` to identify outlier hosts that represent scanners."
          },
          {
            "description": "A user account or host accesses a set of network shares that is inconsistent with its established baseline of activity, such as accessing shares for the first time or shares belonging to a different business unit.",
            "data_sources": [
              "Zeek smb.log",
              "Windows Event ID 5140",
              "Windows Event ID 4624"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "File Servers, Domain Controllers (for authentication correlation), Application Servers with sensitive shares",
            "action": "Symbolic: Maintain a state table or lookup file of `(user, share)` access pairs seen over the last 30-60 days. Generate a low-severity alert whenever a new `(user, share)` pair is observed for the first time. Correlate this with other suspicious activity. Statistical: For each user, create a historical profile of accessed shares. On a daily basis, calculate the entropy of the shares accessed by the user: $$ H(X) = -\\sum_{i=1}^{n} P(x_i) \\log_2 P(x_i) $$. A sudden, sharp increase in entropy suggests the user is accessing a wider and more varied set of shares than usual. ML: Model the environment as a bipartite graph of users and shares. Use a graph-based anomaly detection algorithm (e.g., GraphSAGE) to learn embeddings for each user and share based on normal access patterns. Flag new access attempts (edges) that have a high anomaly score, indicating the access is inconsistent with the user's learned role."
          },
          {
            "description": "A non-administrative user account or a non-management host attempts to access administrative shares (e.g., C$, ADMIN$, IPC$) across one or more systems.",
            "data_sources": [
              "Zeek smb.log",
              "Windows Event ID 5140"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Endpoint Workstation Subnets, Server Subnets, Domain Controllers",
            "action": "Symbolic: Filter SMB access logs (Windows Event ID 5140 or Zeek smb.log) for attempts where the share name matches a regex like `\\\\\\\\\\\\[^\\\\]+\\\\\\(C|ADMIN|IPC)\\$`. Cross-reference the source user account with a list of privileged accounts. Generate a high-severity alert if the source user is not privileged. Statistical: Profile the set of source hosts that legitimately connect to administrative shares (e.g., SCCM servers, admin jump boxes). Alert when an admin share connection originates from a host not in this established baseline set. Calculate the ratio of admin share connections to total share connections per user; a ratio significantly higher than the user's historical norm is suspicious. ML: Train a classification model (e.g., Logistic Regression) to score each administrative share access event. Features can include `source_is_privileged_user`, `source_is_management_host`, `time_of_day`, and `target_is_domain_controller`. An event with a high probability score from the model indicates likely malicious activity."
          }
        ]
      }
    ],
    "version": "2.2",
    "date_created": "2025-05-04",
    "last_updated": "2025-09-29",
    "contributors": [
      "Zachary Szewczyk",
      "Ask Sage"
    ]
  }
]