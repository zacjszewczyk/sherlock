[
  {
    "information_requirement": "Is an adversary using web protocols for command and control on corporate mobile devices? (PIR)",
    "tactic_id": "TA0037",
    "tactic_name": "Command And Control",
    "indicators": [
      {
        "technique_id": "T1437.001",
        "name": "Web Protocols",
        "evidence": [
          {
            "description": "Anomalous web traffic from a managed mobile device indicating command and control, characterized by one or more of the following: periodic 'heartbeat' connections to a single destination (standard deviation of inter-arrival times less than 1.5 seconds); HTTP/S requests to low-reputation or newly registered domains; use of statistically rare HTTP User-Agent strings not on an established allowlist; high-entropy URI paths or query parameters (Shannon entropy score above the 98th percentile); a highly asymmetric ratio of bytes sent versus received (e.g., a ratio greater than 10.0 or less than 0.1); or unusually long or short connection durations compared to baseline.",
            "data_sources": [
              "Zeek conn.log",
              "Zeek http.log",
              "Zeek dns.log",
              "Zeek ssl.log"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Corporate Wi-Fi network egress points, VPN concentrators, Mobile Device Management (MDM) gateways, forward/reverse proxies, and central DNS resolvers that process traffic from managed mobile device subnets or enrolled devices.",
            "action": [
              "For all traffic from mobile device network segments, match destination fully qualified domain names (FQDNs) and IP addresses from Zeek dns.log and http.log against a threat intelligence feed of known command and control servers. An exact match triggers a high-priority alert for immediate investigation.",
              "For each mobile device source IP over a rolling 24-hour window: 1) From Zeek conn.log, calculate the standard deviation of inter-arrival times for connections to each destination IP, flagging destinations where the stddev is < 1.5 seconds as potential beaconing. 2) From Zeek conn.log, calculate the data transfer ratio (orig_bytes / resp_bytes) and flag sessions with a ratio > 10.0 or < 0.1. 3) From Zeek http.log, calculate the Shannon entropy of the 'uri' field and flag requests where the entropy exceeds the 98th percentile for that source device. An alert is generated if a single session triggers multiple statistical anomalies.",
              "Train an unsupervised anomaly detection model, such as an Isolation Forest, on a feature set derived from Zeek logs (conn.log, http.log, ssl.log). Features must include: connection duration, total bytes, originator vs. responder bytes ratio, URI length, User-Agent string frequency, JA3 hash frequency, and inter-arrival time standard deviation per destination. After training on a baseline of normal mobile device traffic, use the model to assign an anomaly score to new sessions. Supplement this by implementing a per-device time-series forecast (e.g., using ARIMA) on outbound data volume, alerting when observed volume significantly exceeds the predicted confidence interval."
            ]
          },
          {
            "description": "A TLS session from a managed mobile device presents a client (JA3) or server (JA3S) fingerprint that is indicative of malicious tooling. This is evidenced by: the JA3 or JA3S hash matching a known malicious hash on a threat intelligence feed; the JA3 hash being statistically rare within the enterprise (e.g., occurring in less than 1% of sessions) and not on an application allowlist; or the JA3S hash corresponding to a server certificate that is self-signed or has a validity period starting within the last 30 days.",
            "data_sources": [
              "Zeek ssl.log",
              "Zeek conn.log",
              "Zeek x509.log"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Network sensors at key chokepoints with visibility into traffic from managed mobile devices, including corporate Wi-Fi egress points, VPN concentrators, Mobile Device Management (MDM) gateways, and forward proxies capable of inspecting TLS handshakes to generate Zeek log data.",
            "action": [
              "Continuously match the 'ja3' and 'ja3s' fields from all Zeek ssl.log records against an updated threat intelligence feed of known malicious TLS fingerprints (e.g., from JA3er.com). An exact match generates a high-confidence alert.",
              "Calculate the frequency distribution of all 'ja3' hashes from Zeek ssl.log over a 30-day rolling window to establish a baseline of common clients. For each new TLS session from a mobile device, if its JA3 hash is not on an established allowlist of approved applications, flag it for review if its frequency falls below a rarity threshold (e.g., the 1st percentile). Enrich this finding by cross-referencing the session ID ('uid') with Zeek x509.log to determine if the server's certificate is self-signed or has a 'validation.not_before' date within the last 30 days.",
              "Develop a supervised classification model (e.g., Random Forest, XGBoost) to predict if a TLS session is malicious. Engineer features from the TLS Client Hello by one-hot encoding the ordered list of cipher suites, extensions, and supported elliptic curves. Train the model using a labeled dataset of known-good traffic (from allowlisted corporate apps) and known-malicious traffic (from malware sandboxes). Deploy the trained model to score new, unclassified sessions from mobile devices, generating an alert when the malicious probability score exceeds a tuned threshold (e.g., 0.90)."
            ]
          }
        ]
      }
    ],
    "last_updated": "2025-10-01",
    "version": "1.5",
    "date_created": "2025-09-26",
    "contributors": [
      "Zachary Szewczyk",
      "Ask Sage"
    ]
  }
]