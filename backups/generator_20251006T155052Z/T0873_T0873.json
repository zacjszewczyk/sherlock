[
  {
    "information_requirement": "Is an adversary attempting to achieve persistence by modifying ICS project files?",
    "tactic_id": "TA0110",
    "tactic_name": "Persistence",
    "indicators": [
      {
        "technique_id": "T0873",
        "name": "Project File Infection",
        "evidence": [
          {
            "description": "A file modification event (write, create, or delete) is observed targeting an Industrial Control System (ICS) project file (e.g., .ACD, .S7P, .L5K, .RSS, .ap16, .pro, .tpzip, .pcw, .wsp, .XEF) on a designated engineering workstation or project file server. The event is considered anomalous if it originates from a user or host not explicitly authorized for engineering functions, occurs outside a scheduled and documented maintenance window, or significantly deviates from the established baseline of file access patterns for that specific user.",
            "data_sources": [
              "Windows Event ID 4663",
              "Windows Event ID 4656",
              "Windows Event ID 5145",
              "Sysmon Event ID 11",
              "Zeek smb_files.log"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "ICS Project File Shares (e.g., dedicated SMB shares for engineering files) and Engineering Workstations (EWS) within the Corporate IT, DMZ, or Process Control Network (PCN).",
            "action": [
              "Construct a SIEM rule that filters file audit logs (Windows Event ID 4663, Sysmon Event ID 11) for events where the TargetFilename field ends with a known ICS project extension (.ACD, .S7P, .L5K, .tpzip, etc.). For each matching event, the rule must perform two checks: 1) Verify the SubjectUserName is a member of a specific 'Authorized_ICS_Engineers' Active Directory group. 2) Check if the event timestamp falls within a scheduled maintenance window by querying a change management system or calendar. Generate a high-severity alert if the user is unauthorized OR the activity is outside a maintenance window. Additionally, correlate with network share access logs (Windows Event ID 5145) to ensure the SourceAddress originates from an approved EWS asset.",
              "For each authorized user account, ingest file modification events (Sysmon Event ID 11) to establish a personal 30-day rolling baseline of activity. Calculate the mean and standard deviation for the count of unique project files accessed per hour. Generate a medium-severity alert if a user's hourly unique file access count exceeds 3 standard deviations from their personal baseline. Concurrently, calculate the Shannon entropy on the set of unique parent folder paths (e.g., 'C:\\Projects\\PlantA\\', 'C:\\Projects\\PlantB\\') accessed by each user on a weekly basis. A sharp increase in entropy compared to the user's previous 4-week average indicates they are accessing an unusually diverse set of project directories and should be flagged for review.",
              "Train an Isolation Forest model on a feature set derived from file access logs (Sysmon Event ID 11, Windows Event ID 4663). The feature vector for each event must include: User (categorical), Source Hostname (categorical), Process Name making the change (e.g., 'Studio5000.exe', 'powershell.exe') (categorical), Parent Process Name (categorical), hour of day (numerical), day of week (categorical), and file extension (categorical). Train the model on at least 90 days of logs representing normal engineering activity. In production, score each new file modification event. Events with anomaly scores in the top 1% percentile for the population should be flagged for analyst review, as they represent statistically rare combinations of user, host, process, and time."
            ]
          },
          {
            "description": "A network connection is established to a PLC's known engineering port (e.g., TCP/44818 for EtherNet/IP, TCP/102 for S7COMM, TCP/20000 for DNP3, TCP/502 for Modbus, TCP/1217 for CODESYS) from a source IP address not on the explicit allowlist of authorized Engineering Workstations (EWS). The anomaly also includes connections from authorized EWS that exhibit statistically unusual characteristics, such as unprecedented data volume or duration, suggesting a large project download rather than routine polling or status checks.",
            "data_sources": [
              "Zeek conn.log",
              "Windows Event ID 4688",
              "Windows Event ID 5156"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Network segments within the ICS DMZ (Level 3.5) and Process Control Network (Levels 2/1), and the Engineering Workstations that access them.",
            "action": [
              "Create a SIEM correlation rule that triggers on Zeek conn.log events where 'id.resp_p' is in the set of ICS engineering ports (102, 502, 1217, 20000, 44818) AND 'id.resp_h' is a tagged PLC asset. The rule must generate a high-severity alert if 'id.orig_h' is NOT in the 'Authorized_EWS' asset group. For connections from authorized EWS, the rule must correlate the connection's 5-tuple and timestamp with host logs (Windows Event ID 5156) to identify the responsible 'Application' and 'ProcessID'. Further correlate with process creation logs (Windows Event ID 4688) to ensure the process name is an approved engineering software executable (e.g., 'Studio5000.exe', 'TIA_Portal.exe') and not a generic utility like 'powershell.exe'.",
              "From Zeek conn.log, establish a 30-day baseline of all (id.orig_h, id.resp_h, id.resp_p) tuples where the destination is a PLC. Alert on any new tuple not seen in the baseline ('first time talker' anomaly). For existing, legitimate communication pairs, baseline the 'orig_bytes' and 'duration' fields. Calculate the 99th percentile for both metrics for each unique pair. Generate a medium-severity alert if a new connection's 'orig_bytes' OR 'duration' exceeds its specific 99th percentile threshold, which indicates a potential project download instead of a small status check.",
              "Use a DBSCAN clustering algorithm on Zeek conn.log data for connections to PLCs on engineering ports. Create a feature vector for each connection including 'duration' (numerical), 'orig_bytes' (numerical), 'resp_bytes' (numerical), 'service' (categorical, e.g., 's7', 'enet-ip'), 'hour_of_day' (numerical), and 'day_of_week' (categorical). The algorithm will group routine, low-data, short-duration polling connections into dense clusters. Connections that the model identifies as noise (not belonging to any cluster) are, by definition, anomalous and should be investigated. These outliers often represent high-volume, long-duration sessions typical of a project download or occur at unusual times."
            ]
          },
          {
            "description": "A PLC mode change command (e.g., from RUN to PROGRAM/REMOTE) is detected in deep packet inspection logs, or inferred from a sequence of commands, and is immediately followed by a high-volume data transfer to the same PLC within a short time window. This specific sequence of 'change mode, then write' is a strong indicator of a project file being downloaded to the controller.",
            "data_sources": [
              "Zeek conn.log",
              "Zeek s7comm.log",
              "Zeek enip.log",
              "Zeek dnp3.log",
              "Zeek modbus.log"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Process Control Network (Level 2/1) segments where PLCs and other field controllers reside and network traffic can be monitored via a TAP or SPAN port.",
            "action": [
              "Create a stateful SIEM rule that triggers when a PLC mode change is observed (e.g., `param.function == 'stop'` or `param.function == 'start'` in zeek.s7comm.log). Upon trigger, the rule must monitor Zeek conn.log for the next 5 minutes for connections to the same PLC IP ('id.resp_h') where the 'orig_bytes' value is greater than a dynamically determined threshold (e.g., 500KB or 4 standard deviations above the mean for that PLC). If both conditions are met, generate a high-severity alert containing the source host, destination PLC, function called, and connection byte count.",
              "For each PLC asset, ingest protocol-specific logs (e.g., s7comm.log) and conn.log. Create two related baselines: 1) the hourly frequency of 'write' or 'download' function codes for that PLC (e.g., 'write_tag' in s7comm.log, 'write_multiple_coils' in modbus.log), and 2) the 95th percentile of 'orig_bytes' for connections to that PLC. Create a rule that alerts when the count of 'write/download' functions in an hour exceeds 3 standard deviations from its baseline AND a corresponding connection's 'orig_bytes' exceeds the 95th percentile. This correlates an unusual number of write actions with an unusually large data transfer.",
              "Implement a sequence-based anomaly detection model, such as a Hidden Markov Model (HMM) or LSTM network, trained on event sequences per PLC. Abstract network logs into a stream of discrete events, where an event is a tuple: (timestamp, event_type, event_value). Event types include 'PLC_MODE_CHANGE' (from s7comm.log 'start'/'stop'), 'PLC_FUNCTION_CALL' (from s7comm.log 'param.function'), and 'CONNECTION_STATS' (from conn.log 'orig_bytes', 'duration'). The model learns the normal probability of transitioning between states (e.g., the low probability of 'PLC_MODE_CHANGE' being followed by a 'CONNECTION_STATS' event with high byte count). A sequence of events with a very low probability score under the trained model indicates a highly anomalous series of actions requiring immediate investigation."
            ]
          }
        ]
      }
    ],
    "last_updated": "2025-09-30",
    "version": "1.5",
    "date_created": "2025-09-26",
    "contributors": [
      "Zachary Szewczyk",
      "Ask Sage"
    ]
  }
]