[
  {
    "information_requirement": "Is an adversary bypassing mobile application security controls by downloading and executing new code at runtime?",
    "tactic_id": "TA0030",
    "tactic_name": "Defense Evasion",
    "indicators": [
      {
        "technique_id": "T1407",
        "name": "Download New Code at Runtime",
        "evidence": [
          {
            "description": "A network session from a managed mobile device's IP address to a non-whitelisted destination is observed, involving the download of an executable file type. The destination IP/domain is considered suspicious if it is: a) present on a threat intelligence feed, b) has a reputation score below a defined threshold (e.g., 30/100), or c) was registered within the last 30 days. The downloaded file's MIME type, as observed in network traffic, is 'application/java-archive', 'application/x-dex', 'application/x-sharedlib', or 'application/octet-stream'.",
            "data_sources": [
              "Zeek conn.log",
              "Zeek http.log",
              "Zeek files.log",
              "Zeek ssl.log",
              "Zeek x509.log",
              "Zeek dns.log"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Corporate Wi-Fi network segments, VPN concentrators, and cloud-based secure web gateways used by mobile devices.",
            "action": [
              "Create a correlation rule that joins network connection logs (Zeek conn.log) with file transfer logs (Zeek files.log) using the session unique identifier (uid). Filter for traffic originating from the mobile device IP address range. Trigger a medium-severity alert if the destination Server Name Indication (SNI from Zeek ssl.log) or destination IP address matches a known malicious indicator from a threat intelligence feed, OR the domain's age (derived from WHOIS lookups on DNS requests in Zeek dns.log) is less than 30 days, AND the file MIME type in files.log is one of ('application/java-archive', 'application/x-dex', 'application/x-sharedlib', 'application/octet-stream').",
              "For all TLS sessions from the mobile NAI, maintain a 30-day rolling baseline of all JA3 and JA3S hash frequencies seen in Zeek ssl.log. Flag any session that uses a hash falling in the bottom 5th percentile of frequency as a 'rare client' anomaly. For HTTP sessions, calculate the Shannon entropy of the URI path and query parameters from Zeek http.log. Correlate 'rare client' anomalies with high URI entropy (e.g., score > 4.5) and an executable file download to generate a high-priority alert for an analyst to investigate potential use of DGA for payload delivery.",
              "Develop and deploy a Random Forest classifier trained on labeled historical network sessions (benign vs. malicious downloads). Engineer features such as: destination domain age, threat intelligence match (binary), reputation score, JA3/JA3S hash prevalence (as a percentile), URI Shannon entropy, file MIME type (one-hot encoded), file size, presence of a self-signed certificate (binary, from Zeek x509.log), ratio of vowels to consonants in the domain name, and number of subdomains. The model should score new sessions in near-real-time and generate a high-confidence alert for sessions classified as 'malicious dynamic code download' with a probability score greater than 0.85."
            ]
          },
          {
            "description": "A Mobile Threat Defense (MTD) agent on a managed Android device reports an API call to a function used for dynamic code loading, specifically 'dalvik.system.DexClassLoader', 'java.lang.System.load', or the use of 'addJavascriptInterface' from 'android.webkit.WebView'. This activity is considered evidence when the calling application is not on the corporate allowlist or is a version of an approved application known to be vulnerable or previously compromised.",
            "data_sources": [
              "Mobile Threat Defense (MTD) API monitoring logs",
              "Mobile Device Management (MDM) Application Inventory Logs"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Managed Android mobile devices enrolled in MDM/MTD solutions.",
            "action": [
              "Implement a SIEM rule to generate a high-severity alert upon receiving an MTD log that explicitly identifies an API call to 'dalvik.system.DexClassLoader', 'java.lang.System.load', or 'addJavascriptInterface'. The rule must automatically enrich the alert by cross-referencing the source application's package name, hash, and version (from MDM inventory logs) against a maintained allowlist of approved applications and versions. If the application is not on the allowlist, escalate the alert priority.",
              "For each application across the managed Android fleet, use MTD/MDM telemetry to establish a 30-day rolling baseline of API call frequencies for dynamic code loading functions. Generate a medium-severity alert for two conditions: a) a 'first use' event where an application calls one of these APIs for the first time across the entire device fleet, or b) a 'frequency spike' where an individual user's application call count in a 24-hour period exceeds the 99th percentile or 3 standard deviations above its historical mean for that user/device.",
              "Train an Isolation Forest or Local Outlier Factor (LOF) model to detect anomalous application behavior. Use features derived from MTD telemetry, such as: the sequence of API calls (using n-grams), the inter-arrival time between calls, the set of permissions requested by the application, and the combination of APIs called within a 60-second window. Train the model on a dataset of known-good applications to define 'normal' behavior. Apply the model to streaming telemetry and flag any application whose behavior is classified as an anomaly, prioritizing anomalies that involve the use of dynamic code loading APIs for immediate analyst review."
            ]
          },
          {
            "description": "A managed iOS device initiates a network connection to a domain or IP address known for hosting malicious JSPatch scripts, as identified by mobile-specific threat intelligence feeds. Alternatively, an MTD agent reports that a running application is leveraging a known JSPatch library or a similar unapproved dynamic code loading framework. [1]",
            "data_sources": [
              "Mobile Threat Defense (MTD) logs",
              "Zeek dns.log",
              "Zeek conn.log",
              "MDM Application Inventory Logs"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Managed iOS mobile devices enrolled in MDM/MTD solutions and their associated network traffic.",
            "action": [
              "Ingest and continuously update a high-fidelity threat intelligence feed of domains, IPs, and file hashes associated with malicious JSPatch or similar iOS code-loading frameworks. Create a SIEM correlation rule that triggers a high-severity alert when a DNS query (Zeek dns.log) or a network connection (Zeek conn.log) from the iOS device IP range matches an indicator on this feed. Create a parallel rule to alert when an MTD log explicitly identifies the use of a JSPatch function within a non-allowlisted application.",
              "For all DNS queries from the iOS NAI (Zeek dns.log), calculate the Shannon entropy for all newly observed domains (not seen in the last 30 days). Flag domains with an entropy score > 4.0. Concurrently, analyze the Top-Level Domain (TLD) and flag queries to rare or suspicious TLDs (e.g., .zip, .mov, .link) not associated with legitimate business functions. Correlate a high-entropy or rare-TLD domain query from a non-browser application with a subsequent large file download (>1MB) to the same device to increase alert fidelity.",
              "Implement a time-series forecasting model (e.g., ARIMA or Prophet) for each critical or widely used application on iOS devices to predict the expected volume of outbound network connections per hour. Train the model using at least 30 days of historical data from Zeek conn.log, aggregated by source device and application identifier (if available from MTD/MDM). Generate a medium-severity alert when the actual connection volume for an application exceeds the model's predicted upper confidence interval by more than 50% for a sustained period (e.g., 10 minutes), especially if this anomaly coincides with other symbolic or statistical triggers related to dynamic code loading."
            ]
          }
        ]
      }
    ],
    "version": "1.4",
    "date_created": "2025-09-26",
    "last_updated": "2025-10-01",
    "contributors": [
      "Zachary Szewczyk",
      "Ask Sage"
    ]
  }
]