[
  {
    "information_requirement": "Has the adversary escalated privileges by modifying domain or tenant policy? (PIR)",
    "tactic_id": "TA0004",
    "tactic_name": "Privilege Escalation",
    "indicators": [
      {
        "technique_id": "T1484",
        "name": "Domain or Tenant Policy Modification",
        "evidence": [
          {
            "description": "An update to a Group Policy Object's script or scheduled task configuration, such as in gpt.ini or ScheduledTasks.xml, introduces a file path, command, domain, or IP address that matches a known malicious indicator, or contains a script with abnormally high entropy.",
            "data_sources": [
              "Windows Event ID 5136",
              "Windows Event ID 5137",
              "Windows Event ID 4688",
              "Zeek conn.log",
              "Zeek http.log"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Domain Controllers, All Domain-joined Endpoints and Servers, Network Egress Points",
            "action": [
              "Symbolic: Parse GPO modification events (Windows Event ID 5136, 5137) to extract file paths, domain names, IP addresses, and commands from script content or scheduled task XML located in the SYSVOL share. Correlate these extracted observables against a threat intelligence feed of known malicious entities. Generate a high-severity alert for any match.",
              "Statistical: For any script content (e.g., .ps1, .vbs) embedded within a modified GPO, calculate its Shannon entropy score. Establish a baseline entropy score for all legitimate administrative scripts used in the environment. Flag any new or modified script with an entropy score exceeding the 95th percentile of the baseline, as this suggests potential obfuscation or packing.",
              "Machine Learning: Train a classification model (e.g., Random Forest) on features extracted from GPO modifications, including script length, frequency of keywords like 'Invoke-Expression' or 'DownloadString', entropy score, modifying account, and time of day. The model will predict the probability of a modification being malicious. Flag modifications classified as malicious with a confidence score above a set threshold, such as 0.85."
            ]
          },
          {
            "description": "A GPO modification event (Windows Event ID 5136) is recorded for an object with a class of 'groupPolicyContainer', where the 'gPCUserRightsAssignment' attribute is changed to grant a sensitive user right, such as SeBackupPrivilege or SeDebugPrivilege, to a user or group not on an approved list of administrators.",
            "data_sources": [
              "Windows Event ID 5136",
              "Windows Event ID 5141"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Domain Controllers, Organizational Units (OUs) containing high-value systems",
            "action": [
              "Symbolic: Monitor GPO modification events (Windows Event ID 5136) where the 'LDAP-Display-Name' attribute is 'gPCUserRightsAssignment'. Parse the 'Value' field to identify the added principal (user or group) and the granted right. Alert if a principal not on a pre-defined list of administrators is granted a right from a watchlist (e.g., SeBackupPrivilege, SeDebugPrivilege, SeTakeOwnershipPrivilege, SeTcbPrivilege).",
              "Statistical: For each sensitive user right, baseline the set of principals (users and groups) assigned to it. Track the size of this set over time using a moving average. An increase in assigned principals that is more than two standard deviations above the moving average indicates an anomalous, and potentially widespread, privilege assignment.",
              "Machine Learning: Use a graph-based anomaly detection model representing the Active Directory structure where users, groups, and GPOs are nodes and memberships or links are edges. A newly created edge representing a non-standard user being granted high privileges via a GPO link would be identified by the model as a low-probability structural anomaly requiring investigation."
            ]
          },
          {
            "description": "A GPO modification (Windows Event ID 5136), creation (5137), or link change (5139) is observed on a critical GPO, such as the Default Domain Policy, or a GPO linked to a sensitive OU, and the modification is performed by an account not on a pre-approved list of Domain Admins or outside a designated change control window.",
            "data_sources": [
              "Windows Event ID 5136",
              "Windows Event ID 5137",
              "Windows Event ID 5139",
              "Windows Event ID 5141"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Domain Controllers, Administrative Workstations",
            "action": [
              "Symbolic: Maintain an explicit allow-list of user accounts authorized to modify a watchlist of critical GPOs, identified by their unique GUIDs (e.g., Default Domain Policy, Default Domain Controllers Policy). Trigger an alert for any modification, creation, or link event (Windows Event ID 5136, 5137, 5139, 5141) on a watched GPO where the 'Subject User Name' is not on the allow-list.",
              "Statistical: For each authorized administrator, baseline their GPO modification activity by hour of day and day of week. Use a percentile-based approach to flag modifications occurring at unusual times, such as outside the 5th-95th percentile of their historical activity timestamps, which could indicate a potential account compromise or insider threat.",
              "Machine Learning: Apply a one-class SVM (Support Vector Machine) model trained on legitimate GPO modification events. Use features including the modifying account, target GPO distinguished name, OU link path, and time of day. Any new modification that the model classifies as an outlier is flagged as a suspicious deviation from normal administrative behavior."
            ]
          },
          {
            "description": "An Azure AD Audit log entry shows an 'Update domain' activity with 'Set domain authentication' or 'Set federation settings on domain' action types, or an on-premise ADFS event (Windows Event ID 307, 510) indicates the creation or modification of a Claims Provider Trust.",
            "data_sources": [
              "Windows Event ID 307",
              "Windows Event ID 510",
              "Azure AD Audit Logs"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Active Directory Federation Services (ADFS) Servers, Identity Provider (IdP) infrastructure, Azure AD Tenant",
            "action": [
              "Symbolic: Create a high-severity rule to alert on any Azure AD Audit log with an 'ActivityType' of 'Set federation settings on domain' or 'Set domain authentication'. Similarly, alert on any on-premise Windows Event ID 510 indicating a Claims Provider Trust was created or enabled. As these are exceptionally rare, high-impact administrative actions, any occurrence warrants immediate investigation.",
              "Statistical: Establish a baseline of zero for the count of domain authentication method changes per month. Any non-zero value is a critical anomaly. Separately, track the set of trusted identity provider issuer URIs; any addition to this set that is not part of a planned change is also a critical alert.",
              "Machine Learning: Use a state-change anomaly detection model. Model the domain's authentication state ('Managed' vs. 'Federated') and the set of trusted providers as a finite state machine. Any state transition that does not correlate with a pre-approved change request ID from a change management system within a 1-hour window is flagged as a high-confidence anomaly, suggesting unauthorized modification."
            ]
          }
        ]
      }
    ],
    "last_updated": "2025-09-30",
    "version": "2.3",
    "date_created": "2025-05-04",
    "contributors": [
      "Zachary Szewczyk"
    ]
  },
  {
    "information_requirement": "Is the adversary evading defenses by modifying domain or tenant policy? (PIR)",
    "tactic_id": "TA0005",
    "tactic_name": "Defense Evasion",
    "indicators": [
      {
        "technique_id": "T1484",
        "name": "Domain or Tenant Policy Modification",
        "evidence": [
          {
            "description": "A GPO modification event (Windows Event ID 5136) alters the registry-based policy for Windows Defender exclusions under 'SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Exclusions' to add a path, process, or file extension known to be associated with malware or living-off-the-land binaries.",
            "data_sources": [
              "Windows Event ID 5136",
              "Windows Event ID 5141"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Domain Controllers, All Domain-joined Endpoints and Servers",
            "action": [
              "Symbolic: Continuously parse GPO modification events (Windows Event ID 5136) that alter registry keys associated with security tool exclusions. Match the added exclusion values against a threat intelligence feed of known malicious file paths (e.g., 'C:\\Users\\Public\\'), process names, or extensions. Alert on any match.",
              "Statistical: Establish a baseline for the frequency of GPO-based exclusion modifications, which should be near zero in a mature environment. An event count exceeding a statistical threshold, such as more than 3 standard deviations above the mean, or any non-zero count in a 24-hour window, indicates anomalous activity.",
              "Machine Learning: Train a text classification model to distinguish between benign (e.g., 'C:\\Program Files\\App') and suspicious ('C:\\Users\\Public\\', '%TEMP%') exclusion paths. Features can include path depth, use of user-writable directories, and character distribution. A path classified as 'suspicious' with high confidence triggers an alert for review."
            ]
          },
          {
            "description": "A GPO's script content is modified to include PowerShell, VBScript, or command-line syntax that disables security tooling. Examples include reflection to patch AMSI, cmdlets to stop ETW providers, or reg.exe commands to disable logging.",
            "data_sources": [
              "Windows Event ID 5136",
              "Windows Event ID 5141",
              "Windows Event ID 4104"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Domain Controllers, All Domain-joined Endpoints and Servers",
            "action": [
              "Symbolic: Scan script content within modified GPOs, retrieved from the SYSVOL share, or from executed scripts in PowerShell logs (Windows Event ID 4104) using YARA rules designed to detect defense evasion techniques. Include patterns for 'AmsiUtils', '[System.Management.Automation.AmsiUtils]::Bypass()', 'Set-MpPreference -DisableRealtimeMonitoring $true', and 'wevtutil cl Security'. Alert on any rule match.",
              "Statistical: Calculate the Jaccard similarity between the tokenized content of new GPO scripts and a baseline set of known-good administrative scripts. Scripts with a similarity score below a certain percentile, such as the 10th percentile, are flagged as highly dissimilar and potentially malicious.",
              "Machine Learning: Use a Natural Language Processing (NLP) based classifier trained on a labeled dataset of benign and malicious PowerShell scripts. The model analyzes the sequence of cmdlets, arguments, and obfuscation patterns to predict the script's intent. A script classified as 'defense evasion' with high probability generates an alert."
            ]
          },
          {
            "description": "A GPO modification event (Windows Event ID 5136) alters the audit policy, stored in Audit.csv in SYSVOL, to disable a critical audit subcategory like Process Creation or Security Group Management, or modifies registry settings to reduce log retention.",
            "data_sources": [
              "Windows Event ID 5136",
              "Windows Event ID 5141"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Domain Controllers, Organizational Units (OUs) with sensitive systems",
            "action": [
              "Symbolic: Define a 'Golden Configuration' for audit policy settings within key GPOs. Monitor GPO modification events (Windows Event ID 5136) and alert on any deviation from this baseline, such as a change that disables 'Audit Process Creation' (Subcategory GUID {0CCE922B-69AE-11D9-BED3-505054503030}) from 'Success and Failure' to 'No Auditing'.",
              "Statistical: Monitor the volume of critical security events, such as Windows Event ID 4688 and 4732, from endpoint populations by OU. Correlate a GPO audit policy change event with a subsequent, statistically significant drop of more than 3 standard deviations below the moving average in the expected event log volume from the targeted OU.",
              "Machine Learning: Implement a multivariate time-series anomaly detection model for event log volumes, segmented by event ID and host group (OU). The model learns the normal daily and weekly seasonality of logging. An unexplainable drop in log volume following a GPO modification event (5136) would be flagged as a correlated anomaly, suggesting successful log tampering."
            ]
          },
          {
            "description": "Two GPO modification events (Windows Event ID 5136) for the same GPO GUID are observed within a short timeframe, such as under 30 minutes, where the GPO version number attribute changes and then reverts to its original value, indicating a 'flash' modification.",
            "data_sources": [
              "Windows Event ID 5136",
              "Windows Event ID 5141"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Domain Controllers",
            "action": [
              "Symbolic: For each GPO modification event (Windows Event ID 5136), cache the GPO's GUID and version number. If a subsequent modification event for the same GPO occurs within a 30-minute window and the version number reverts to a previously seen value, trigger a high-severity 'Flash GPO Modification' alert.",
              "Statistical: Analyze the time delta between consecutive modification events for the same GPO across the environment. Establish a baseline distribution of these deltas for normal administrative activity. Flag any modification-reversion sequence where the time delta falls below the 5th percentile of the normal distribution, indicating an unusually rapid change cycle.",
              "Machine Learning: Use a sequence analysis model, such as an LSTM autoencoder, to learn normal sequences of administrative actions related to GPOs. A sequence such as 'modify policy -> wait 5 minutes -> revert policy' would be flagged as an anomalous sequence when compared to normal patterns like 'modify policy -> link policy -> wait 24 hours'."
            ]
          }
        ]
      }
    ],
    "last_updated": "2025-09-30",
    "version": "2.3",
    "date_created": "2025-05-04",
    "contributors": [
      "Zachary Szewczyk"
    ]
  }
]