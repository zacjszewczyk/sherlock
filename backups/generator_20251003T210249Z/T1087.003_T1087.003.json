[
  {
    "information_requirement": "Is an adversary actively discovering email accounts or global address lists within the enterprise network? (PIR)",
    "tactic_id": "TA0007",
    "tactic_name": "Discovery",
    "indicators": [
      {
        "technique_id": "T1087.003",
        "name": "Email Account",
        "evidence": [
          {
            "description": "A process is created (Windows Event ID 4688) where the file hash (e.g., MD5, SHA256) matches a known indicator of compromise (IOC) for an email account enumeration tool.",
            "data_sources": [
              "Windows Event ID 4688"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Domain Controllers, Exchange Servers, Administrative Workstations, User Endpoints",
            "action": [
              "Query process creation logs (Windows Event ID 4688) and match the file hash (MD5, SHA256) or OriginalFileName against a threat intelligence feed of known email enumeration tools like MailSniper or ADFind. Generate an alert upon a match.",
              "For each new process execution not on a software allowlist, calculate the character entropy of its file name. Flag any process where the parent is a scripting engine (powershell.exe, cscript.exe) and the child process name entropy exceeds a threshold (e.g., > 3.5 bits/character), indicating potential obfuscation.",
              "Implement a binary classification model (e.g., Random Forest) trained on features from process creation events (e.g., parent process name, user context, command-line length, file path entropy). Use the model to score new, unseen processes. Flag processes with a high probability score (> 0.9) of being malicious enumeration tools for analyst investigation."
            ]
          },
          {
            "description": "A PowerShell script block (Windows Event ID 4104) or process command line (Windows Event ID 4688) contains specific cmdlets, functions, or strings used for querying Exchange or Active Directory for email accounts (e.g., 'Get-GlobalAddressList', 'Get-Recipient').",
            "data_sources": [
              "Windows Event ID 4688",
              "Windows Event ID 4104"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Domain Controllers, Exchange Servers, Microsoft 365 Tenant, User Endpoints",
            "action": [
              "Create a SIEM rule using regular expressions to search command-line arguments (Windows Event ID 4688) and PowerShell script block text (Windows Event ID 4104) for the literal strings 'Get-GlobalAddressList', 'Get-Recipient', 'Get-Mailbox', or LDAP filter patterns like '(objectCategory=person)'. Alert on any match.",
              "For each user account, build a historical baseline of executed PowerShell cmdlets over a 30-day period. Calculate the frequency of each cmdlet. Alert when a user executes a cmdlet (e.g., 'Get-GlobalAddressList') that falls within the 99th percentile of rarity for that specific user or is new to them entirely.",
              "Apply a topic modeling algorithm (e.g., Latent Dirichlet Allocation) to the corpus of PowerShell script block logs (Windows Event ID 4104). Label the resulting topics as 'benign admin', 'developer activity', 'reconnaissance', etc. Alert when a user's script execution is classified into a 'reconnaissance' topic, especially if this is anomalous for that user's role."
            ]
          },
          {
            "description": "An LDAP search request, observed in network traffic (Zeek ldap.log) or host logs (Windows Event ID 1644), contains a filter designed for bulk enumeration of user or email objects, such as `(objectClass=user)` or `(mail=*)`.",
            "data_sources": [
              "Zeek ldap.log",
              "Windows Event ID 1644"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Domain Controllers, Network segments monitoring traffic to Domain Controllers",
            "action": [
              "Monitor Zeek ldap.log files and Windows Event ID 1644 for LDAP search requests containing filters indicative of bulk enumeration, such as '(objectCategory=person)', '(objectClass=user)', or '(&(objectCategory=person)(objectClass=user)(mail=*))'. Alert on any occurrence.",
              "For each source IP address, establish a 30-day rolling baseline of the number of objects returned per LDAP query. Using Zeek ldap.log, alert when a single query from a source IP returns a number of objects that exceeds three standard deviations above its historical average, indicating a potential bulk export.",
              "Implement a time-series anomaly detection model (e.g., SARIMA) on the volume of LDAP search requests per host, aggregated per minute. Train the model on historical data from Zeek ldap.log. Alert when the observed request volume significantly deviates from the model's forecast, indicating an anomalous spike in activity."
            ]
          },
          {
            "description": "A single source IP address generates a volume of network connections to directory services (LDAP, DCERPC) or mail services (MAPI, EWS) that is statistically anomalous compared to its own baseline or the baseline of its peer group.",
            "data_sources": [
              "Zeek conn.log",
              "Zeek dce_rpc.log",
              "Zeek ldap.log"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Network traffic segments in front of Domain Controllers and Exchange/Mail servers",
            "action": [
              "Create a threshold-based rule that triggers an alert if a single source IP (from Zeek conn.log) initiates more than a fixed number of connections (e.g., 500) to Domain Controllers (port 389, 636) or Exchange servers (port 135, 443) within a 5-minute window.",
              "For each source IP, calculate a 30-day rolling baseline of the hourly connection count to directory and mail servers. Using the Inter-Quartile Range (IQR) method on Zeek conn.log data, flag any source IP whose connection count in a given hour exceeds the upper outlier fence (Q3 + 1.5 * IQR).",
              "Apply a density-based clustering algorithm (e.g., DBSCAN) to features extracted from Zeek conn.log, such as `orig_bytes`, `resp_bytes`, `duration`, and `service`. Profile large, dense clusters as 'normal' traffic patterns. Flag connections that are identified as noise points (outliers) by the model, as they represent activity that does not conform to any normal pattern."
            ]
          },
          {
            "description": "A process, identified by name or path in network connection logs (Windows Event ID 5156), initiates a connection to a mail or directory service (e.g., port 389, 443) and is not on a pre-defined allowlist of approved applications for such communication (e.g., outlook.exe, Microsoft Teams).",
            "data_sources": [
              "Windows Event ID 4688",
              "Windows Event ID 5156",
              "Zeek conn.log"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "User Endpoints, Application Servers, and network choke points monitoring traffic to directory/mail servers",
            "action": [
              "Correlate process context from Windows Event ID 4688 with network connection events from Windows Event ID 5156. Alert when the process name in event 5156 is not on a defined software allowlist (e.g., 'outlook.exe', 'teams.exe') AND the destination port is a known directory/mail service port (e.g., 135, 389, 443, 636).",
              "Across the enterprise, calculate the prevalence of each process name making connections to directory/mail services. Alert when a connection is initiated by a process name that falls in the bottom 1st percentile of prevalence (i.e., is extremely rare), especially if the process path is in a user-writable directory like C:\\Users\\* or C:\\Temp\\*.",
              "Train a one-class Support Vector Machine (OC-SVM) model on a dataset of legitimate process-network connection events. Use features like process name, user context, destination port, and data volume. Use the trained model to score new connection events in real-time. Flag any event classified as an outlier by the model for further investigation."
            ]
          }
        ]
      }
    ],
    "last_updated": "2025-09-30",
    "version": "2.3",
    "date_created": "2025-05-04",
    "contributors": [
      "Zachary Szewczyk",
      "Ask Sage"
    ]
  }
]