[
  {
    "Is the adversary maintaining persistence using Registry Run Keys or Startup Folder items? (TA0003 - Persistence)": {
      "Indicators": {
        "T1547.001 - Registry Run Keys - Startup Folder": {
          "Creation or modification of suspicious entries in Windows Registry Run/RunOnce/RunOnceEx keys.": {
            "Data": "Windows Event ID 4657",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 4657 for changes to Registry keys HKLM\\*Run*, HKCU\\*Run*, HKLM\\*RunOnce*, HKCU\\*RunOnce*, HKLM\\*RunServices*, HKCU\\*RunServices*, HKLM\\*Policies\\Explorer\\Run*, HKCU\\*Policies\\Explorer\\Run*, HKCU\\*Windows\\load*. Compare new/modified entries against a baseline of known legitimate applications and file paths. Flag entries referencing unknown executables or unusual file paths. Calculate the frequency of modifications to these keys across the environment and investigate outliers using descriptive statistics."
          },
          "Creation or modification of suspicious files or shortcuts in user or all-user Startup Folders.": {
            "Data": "Windows Event ID 4663",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 4663 with Object Type 'File' for operations (WriteData, AppendData, CreateFiles) targeting file paths matching user or all-user Startup Folders (e.g., `C:\\Users\\*\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\*`, `C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\StartUp\\*`). Filter for file extensions commonly used for execution (.exe, .vbs, .ps1, .lnk, .bat, .cmd). Flag creation/modification events not correlated with known legitimate software installations or updates. Use frequency analysis on file names and paths to identify rare additions."
          },
          "Network connections made by processes launched from Registry Run keys or Startup Folder paths to external or unusual internal destinations.": {
            "Data": "Windows Event ID 4688; Windows Event ID 5156; Zeek conn.log",
            "Data Platform": "Endpoints, Servers, Network devices",
            "NAI": "Insert site-specific NAI here",
            "Action": "Correlate process creation events (Windows Event ID 4688) where the process Command Line or Parent Process suggests execution from a Run key location or Startup Folder path with subsequent network connection events (Windows Event ID 5156, Zeek conn.log). Identify connections to external IPs, known malicious infrastructure (using TI feeds), or unusual internal destinations. Use frequency analysis on destination IPs/ports and correlate connection activity with process execution time using time series analysis to identify suspicious patterns."
          },
          "Execution of previously unseen or rare processes from Registry Run keys or Startup Folder locations.": {
            "Data": "Windows Event ID 4688",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Analyze Windows Event ID 4688 logs for processes created where the Parent Process Name or Command Line path corresponds to a Registry Run key or Startup Folder location. Establish a baseline of common processes starting from these locations. Identify and flag process names or full command lines that are new or occur with very low frequency (outliers) compared to historical data across the environment, using descriptive statistics and frequency analysis."
          }
        }
      },
      "version": "1.1",
      "last_updated": "2025-05-07"
    }
  },
  {
    "Is the adversary attempting to elevate privileges using Registry Run Keys or Startup Folder items? (TA0004 - Privilege Escalation)": {
      "Indicators": {
        "T1547.001 - Registry Run Keys - Startup Folder": {
          "Outlier processes executed at user login or system boot that originate from Registry Run keys or Startup Folder paths.": {
            "Data": "Windows Event ID 4688",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Analyze Windows Event ID 4688 logs specifically for processes starting shortly after user login or system boot (e.g., within 5 minutes of Windows Event ID 4624 Logon). Correlate these processes with known legitimate startup items (Registry Run keys, startup folders). Use descriptive statistics and outlier detection (e.g., box plots on process start times relative to user logon event or system boot) to identify processes starting unexpectedly or from suspicious locations. Evaluate correlation between process start and subsequent network connections (requires cross-referencing with Zeek conn.log)."
          },
          "Unauthorized modification of HKLM Registry Run keys or BootExecute key.": {
            "Data": "Windows Event ID 4657",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 4657 for SetValue operations specifically targeting HKEY_LOCAL_MACHINE Run* keys or HKLM\\System\\CurrentControlSet\\Control\\Session Manager\\BootExecute. Investigate modifications performed by non-system or non-trusted installer accounts. Use correlation analysis to link these registry changes to the creating process (ParentProcessName in Event ID 4657 details) or preceding events like successful exploitation or credential use."
          },
          "Process creation events from Registry Run keys or Startup Folder paths that execute with elevated privileges or exhibit unusual parent-child relationships.": {
            "Data": "Windows Event ID 4688",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Filter Windows Event ID 4688 for processes whose `Token Elevation Type` indicates elevated privileges (e.g., Type 3 - Full) and whose Parent Process or Command Line points to execution from a Run key or Startup Folder location. Analyze `ParentProcessName` for suspicious parents (e.g., not explorer.exe, userinit.exe, logonui.exe, services.exe). Use frequency analysis to identify rare or unique parent-child process relationships involving startup execution and elevated privileges, flagging combinations not seen before."
          },
          "Execution of unauthorized processes originating from the HKLM\\System\\CurrentControlSet\\Control\\Session Manager\\BootExecute Registry value.": {
            "Data": "Windows Event ID 4688",
            "Data Platform": "Servers, Endpoints",
            "NAI": "Insert site-specific NAI here",
            "Action": "Analyze Windows Event ID 4688 logs for processes starting during the early boot sequence (e.g., before Windows Event ID 4624 Logon events become frequent). Compare the command line of these early processes against the known legitimate `autocheck autochk *` entry in the `BootExecute` key. Flag any process whose command line differs or appears in addition to the legitimate one. Use time series analysis or process start order analysis relative to system boot event logs to identify suspicious early process execution that deviates from the established baseline order."
          }
        }
      },
      "version": "1.1",
      "last_updated": "2025-05-07"
    }
  }
]