[
  {
    "Has the adversary escalated privileges using access token manipulation? (TA0004 - Privilege-Escalation)": {
      "Indicators": {
        "T1134 - Access Token Manipulation": {
          "Inconsistencies in process/thread token information, such as processes owned by a standard user impersonating the SYSTEM account.": {
            "Data": "Windows Event ID 4688",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Analyze Windows Event ID 4688 for processes running under the SYSTEM account where the Parent Process is not a standard system process or was created by a non-SYSTEM user. Use correlation analysis between Event 4688 and potential service creation events (4697) or logon events (4624) to identify suspicious privilege escalations."
          },
          "Detection of the 'runas' command execution or suspicious process creation associated with token manipulation API calls.": {
            "Data": "Windows Event ID 4688",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Enable command-line auditing (Event ID 4688). Search for command lines containing 'runas'. Additionally, look for suspicious parent-child process relationships associated with common token manipulation tools or scripts by analyzing process trees derived from Event ID 4688 ParentProcessId. Use frequency analysis to identify rare parent-child relationships."
          },
          "Network connections attempting lateral movement (e.g., RDP, SMB) originating from processes running under SYSTEM or elevated user tokens that do not typically initiate such connections.": {
            "Data": "Windows Event ID 4624; Zeek conn.log",
            "Data Platform": "Endpoints, Servers, Network devices",
            "NAI": "Insert site-specific NAI here",
            "Action": "Identify successful network logons (Event ID 4624, Logon Type 3) or connections (Zeek conn.log for ports 3389, 445, 139) originating from processes or users identified as potentially running with manipulated tokens (e.g., SYSTEM processes with unusual PIDs/parents, or user processes impersonating SYSTEM based on Event 4688 analysis). Correlate network activity with potential token manipulation events. Use frequency analysis to identify source processes/users making network connections they historically do not make."
          },
          "Creation of new services or scheduled tasks by processes running under potentially manipulated tokens or unusual user contexts.": {
            "Data": "Windows Event ID 4697; Windows Event ID 4698; Windows Event ID 4688",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor for Service Creation (Event ID 4697) and Scheduled Task Creation (Event ID 4698). Correlate the creating Process ID/Name with process creation events (Event ID 4688) to identify the full command line and user context of the process that created the service/task. Flag creations by processes or users identified as potentially using manipulated tokens (e.g., SYSTEM process with unusual parent/command line, or user process impersonating SYSTEM) or those occurring under unusual SYSTEM or administrative accounts without a standard system process parent. Use correlation analysis to link these events to potential token manipulation activities."
          }
        }
      },
      "version": "1.1",
      "last_updated": "2025-05-07"
    }
  },
  {
    "Is the adversary evading defenses using access token manipulation? (TA0005 - Defense-Evasion)": {
      "Indicators": {
        "T1134 - Access Token Manipulation": {
          "Network connections originating from a process under an impersonated token that are inconsistent with the original user's normal activity or security context.": {
            "Data": "Windows Event ID 4688; Zeek conn.log",
            "Data Platform": "Endpoints, Servers, Network devices",
            "NAI": "Insert site-specific NAI here",
            "Action": "Identify processes potentially running under elevated or impersonated tokens (based on analysis of Event ID 4688). Correlate these processes with network connection logs (Zeek conn.log) originating from the host. Analyze network traffic patterns (destination, protocol, volume) using statistical methods (e.g., descriptive statistics, anomaly detection using IQR or percentiles) for connections made by these processes that deviate significantly from established baselines for the host or the original user."
          },
          "Discrepancies between the Parent Process ID (PPID) reported by different sources (e.g., Event ID 4688 vs. ETW data).": {
            "Data": "Windows Event ID 4688",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Analyze Windows Event ID 4688 (Process Creation). Reconstruct process trees using the Creator Process ID/Name and New Process Id fields. Look for breaks or inconsistencies in the process tree where a child process's reported parent does not logically match the actual process that initiated it, potentially indicating PPID spoofing or manipulation affecting audit trails. Use correlation analysis to identify patterns of such discrepancies."
          },
          "Unauthorized or unexpected successful network authentication attempts (e.g., SMB, WMI, WinRM) from a host using stolen or impersonated tokens for accounts that do not normally access that target or resource.": {
            "Data": "Windows Event ID 4624; Zeek conn.log",
            "Data Platform": "Endpoints, Servers, Network devices",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor successful network logons (Event ID 4624, Logon Type 3) targeting critical servers or domain controllers. Correlate logon events with the source process (via Event ID 4688 or other correlation means) and the source host's network connections (Zeek conn.log for ports like 445, 135, 5985, 5986). Use correlation analysis to identify successful authentications using accounts (especially elevated ones like SYSTEM or Administrator) from source processes or hosts not typically associated with such activity or target systems. Flag authentications associated with source processes linked to unusual token activity based on historical frequency."
          },
          "Network or resource access activity associated with processes launched using 'runas /netonly' or similar impersonation techniques.": {
            "Data": "Windows Event ID 4688; Zeek conn.log",
            "Data Platform": "Endpoints, Servers, Network devices",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 4688 for command lines containing 'runas /netonly'. Identify the PID of the launched process. Track network connections (Zeek conn.log) originating from this PID or subsequent child processes. Analyze destinations, protocols, and timing of these connections for suspicious activity, especially if targeting sensitive resources or external IPs. Correlate with the identity of the user account specified in the 'runas' command and compare against normal activity for the initiating user using frequency analysis."
          }
        }
      },
      "version": "1.1",
      "last_updated": "2025-05-07"
    }
  }
]