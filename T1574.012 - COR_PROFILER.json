[
  {
    "Is the adversary maintaining persistence using COR_PROFILER? (TA0003 - Persistence)": {
      "Indicators": {
        "T1574.012 - COR_PROFILER": {
          "Creation or modification of COR_ENABLE_PROFILING, COR_PROFILER, or COR_PROFILER_PATH Registry keys.": {
            "Data": "Windows Event ID 4657; Windows Event ID 4688",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 4657 for changes to HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Environment\\*COR_PROFILER* or HKEY_CURRENT_USER\\Environment\\*COR_PROFILER*. Identify processes making these changes (from Event 4688 via CorrelationId if available). Analyze the frequency of these changes across the environment and flag rare or unauthorized modifications using frequency analysis or anomaly detection."
          },
          "Process creation with COR_PROFILER or COR_PROFILER_PATH environment variables set.": {
            "Data": "Windows Event ID 4688",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 4688 for new processes. Extract command-line arguments and environment variables from the event data. Filter for processes where COR_PROFILER or COR_PROFILER_PATH environment variables are explicitly set. Correlate these events with subsequent process behavior (e.g., network connections from Zeek logs, new processes spawned from Event 4688) and flag unusual patterns using correlation analysis."
          },
          "Anomalous network connections or process behavior originating from a .NET process shortly after it starts with COR_PROFILER environment variables set.": {
            "Data": "Windows Event ID 4688; Zeek conn.log; Windows Event ID 5156",
            "Data Platform": "Endpoints, Servers, Network devices",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 4688 for .NET processes started with COR_PROFILER/COR_PROFILER_PATH set. Track their Process IDs. Within a short time window (e.g., 60 seconds) after the process start, look for unusual network connections (Zeek conn.log, Windows Event ID 5156) initiated by that process (correlating on Process ID/LUID). Look for connections to unexpected external IPs, known C2 patterns (via threat intelligence correlation), or high volume data transfers using frequency analysis or correlation analysis. Also, monitor subsequent process creation events (Event 4688) spawned by this process for suspicious activity."
          },
          "Unexpected termination of a .NET process that was launched with COR_PROFILER environment variables, particularly security software processes.": {
            "Data": "Windows Event ID 4688; Windows Event ID 4689",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 4688 for .NET processes started with COR_PROFILER/COR_PROFILER_PATH set. Track their Process IDs. Monitor Windows Event ID 4689 for process terminations. Correlate termination events (4689) with process start events (4688) where profiling was enabled. Flag unexpected or premature terminations of profiled .NET processes, especially if the process name corresponds to known security software. Use time series analysis or frequency analysis to identify terminations occurring outside of normal application shutdown cycles or sudden increases in unexpected terminations across multiple systems."
          }
        }
      },
      "version": "1.1",
      "last_updated": "2025-05-07"
    }
  },
  {
    "Is the adversary escalating privileges using COR_PROFILER? (TA0004 - Privilege-Escalation)": {
      "Indicators": {
        "T1574.012 - COR_PROFILER": {
          "Creation or modification of COR_PROFILER Registry keys by processes executing with high privileges.": {
            "Data": "Windows Event ID 4657; Windows Event ID 4688",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 4657 for changes to COR_PROFILER registry keys. Correlate these events with the integrity level or user context (e.g., SYSTEM, Administrator) of the process recorded in Windows Event ID 4688 (using CorrelationId). Prioritize investigation of changes made by processes running at higher integrity levels that are not part of standard OS updates or software installations. Use frequency analysis to identify rare changes by privileged processes."
          },
          "Process creation of a high-privilege .NET process with COR_PROFILER or COR_PROFILER_PATH environment variables set.": {
            "Data": "Windows Event ID 4688",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 4688 for processes started with high integrity levels (e.g., IntegrityLevel='System', 'High') or by privileged accounts. Check if COR_PROFILER or COR_PROFILER_PATH environment variables are present in the process creation event data. Flag high-integrity processes launched with these environment variables unless correlated with known legitimate software installers or updates. Use frequency analysis to identify rare occurrences."
          },
          "Anomalous network connections or process behavior originating from a .NET process shortly after it starts with COR_PROFILER environment variables set.": {
            "Data": "Windows Event ID 4688; Zeek conn.log; Windows Event ID 5156",
            "Data Platform": "Endpoints, Servers, Network devices",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 4688 for .NET processes started with COR_PROFILER/COR_PROFILER_PATH set. Track their Process IDs. Within a short time window (e.g., 60 seconds) after the process start, look for unusual network connections (Zeek conn.log, Windows Event ID 5156) initiated by that process (correlating on Process ID/LUID). Look for connections to unexpected external IPs, known C2 patterns (via threat intelligence correlation), or high volume data transfers using frequency analysis or correlation analysis. Also, monitor subsequent process creation events (Event 4688) spawned by this process for suspicious activity."
          },
          "Unexpected termination of a .NET process that was launched with COR_PROFILER environment variables, particularly security software processes.": {
            "Data": "Windows Event ID 4688; Windows Event ID 4689",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 4688 for .NET processes started with COR_PROFILER/COR_PROFILER_PATH set. Track their Process IDs. Monitor Windows Event ID 4689 for process terminations. Correlate termination events (4689) with process start events (4688) where profiling was enabled. Flag unexpected or premature terminations of profiled .NET processes, especially if the process name corresponds to known security software. Use time series analysis or frequency analysis to identify terminations occurring outside of normal application shutdown cycles or sudden increases in unexpected terminations across multiple systems."
          }
        }
      },
      "version": "1.1",
      "last_updated": "2025-05-07"
    }
  },
  {
    "Is the adversary evading defenses using COR_PROFILER? (TA0005 - Defense-Evasion)": {
      "Indicators": {
        "T1574.012 - COR_PROFILER": {
          "Creation or modification of COR_PROFILER Registry keys targeting specific security software processes/paths.": {
            "Data": "Windows Event ID 4657; Windows Event ID 4688",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 4657 for changes to COR_PROFILER registry keys. Examine the new value data (e.g., DLL path, CLSID) and correlate with process names (from Event 4688) targeting known security software paths or executable names. Flag changes that attempt to inject a profiler into security processes. Use frequency analysis to identify rare modifications targeting sensitive processes."
          },
          "Process creation of a security software .NET process with COR_PROFILER or COR_PROFILER_PATH environment variables set.": {
            "Data": "Windows Event ID 4688",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 4688 for processes whose executable path or name matches known security software (e.g., 'MsMpEng.exe', 'SophosEDR.exe'). Check if COR_PROFILER or COR_PROFILER_PATH environment variables are present in the process creation event data for these security processes. Flag security processes started with these profiling environment variables unless correlated with known legitimate software updates. Use frequency analysis to identify rare occurrences."
          },
          "Anomalous network connections or process behavior originating from a .NET process shortly after it starts with COR_PROFILER environment variables set.": {
            "Data": "Windows Event ID 4688; Zeek conn.log; Windows Event ID 5156",
            "Data Platform": "Endpoints, Servers, Network devices",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 4688 for .NET processes started with COR_PROFILER/COR_PROFILER_PATH set. Track their Process IDs. Within a short time window (e.g., 60 seconds) after the process start, look for unusual network connections (Zeek conn.log, Windows Event ID 5156) initiated by that process (correlating on Process ID/LUID). Look for connections to unexpected external IPs, known C2 patterns (via threat intelligence correlation), or high volume data transfers using frequency analysis or correlation analysis. Also, monitor subsequent process creation events (Event 4688) spawned by this process for suspicious activity."
          },
          "Unexpected termination of a .NET process that was launched with COR_PROFILER environment variables, particularly security software processes.": {
            "Data": "Windows Event ID 4688; Windows Event ID 4689",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 4688 for .NET processes started with COR_PROFILER/COR_PROFILER_PATH set. Track their Process IDs. Monitor Windows Event ID 4689 for process terminations. Correlate termination events (4689) with process start events (4688) where profiling was enabled. Flag unexpected or premature terminations of profiled .NET processes, especially if the process name corresponds to known security software. Use time series analysis or frequency analysis to identify terminations occurring outside of normal application shutdown cycles or sudden increases in unexpected terminations across multiple systems."
          }
        }
      },
      "version": "1.1",
      "last_updated": "2025-05-07"
    }
  }
]