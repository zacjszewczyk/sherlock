[
  {
    "Has the adversary escalated privileges by creating a process with a stolen or manipulated token? (TA0004 - Privilege Escalation)": {
      "Indicators": {
        "T1134.002 - Create Process with Token": {
          "Detection of 'runas' command or similar privilege escalation command-line usage.": {
            "Data": "Windows Event ID 4688",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 4688 for command-line arguments containing 'runas' or similar process creation/privilege commands. Analyze the parent process and user context of the 'runas' execution for anomalies."
          },
          "Creation of processes with different user tokens not initiated by standard OS functions or known legitimate applications, potentially via API calls.": {
            "Data": "Windows Event ID 4688; Windows Event ID 4624",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 4688 and 4624. Identify processes (Event ID 4688) where the 'SubjectUserSid' (creator) differs significantly from the 'NewProcessId's' user context or associated logon session (from correlating with Event ID 4624 using Logon ID). Look for process creations without a clear parent process or from unusual parent processes. Use correlation analysis between 4688 and 4624 events based on Logon ID."
          },
          "Process creation (especially privileged) with a token/user context that doesn't match the parent process's user, immediately followed by suspicious network activity.": {
            "Data": "Windows Event ID 4688; Windows Event ID 5156; Zeek conn.log",
            "Data Platform": "Endpoints, Servers, Network devices",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 4688 for processes created with unusual Logon ID/User compared to parent. Correlate these processes with outbound network connection attempts (Windows Event ID 5156, Zeek conn.log) occurring within seconds of the process creation time. Use correlation analysis to link the potentially token-created process to subsequent network activity, flagging connections to external or unusual destinations not typical for the host or user. Baseline typical network activity for standard processes and identify deviations."
          },
          "Process creation associated with an unusual or unexpected Windows Logon Type or a rapid change in user context/logon session without a standard logon event.": {
            "Data": "Windows Event ID 4688; Windows Event ID 4624; Windows Event ID 4648",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 4688. Correlate NewProcessId entries with Logon ID information derived from surrounding authentication events (Windows Event ID 4624, 4648). Analyze the Logon Type associated with the process's Logon ID. Flag process creations where the Logon Type is unusual for the parent process or execution context (e.g., a process seemingly created via interactive user action but associated with a Service or Batch logon type). Use frequency analysis to identify rare Logon Type/Parent Process combinations across the environment."
          }
        }
      },
      "version": "1.1",
      "last_updated": "2025-05-07"
    }
  },
  {
    "Is the adversary bypassing defenses by creating a process with a stolen or manipulated token? (TA0005 - Defense Evasion)": {
      "Indicators": {
        "T1134.002 - Create Process with Token": {
          "Use of 'runas' command or similar from unexpected processes or user contexts.": {
            "Data": "Windows Event ID 4688",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 4688 for processes executing 'runas'. Baseline normal 'runas' usage (user, parent process, frequency) for different systems/users using descriptive statistics. Flag executions where the user or parent process deviates significantly from the established baseline."
          },
          "Anomalous process creation where the parent-child process relationship or user token context is inconsistent with normal behavior, potentially indicating API use.": {
            "Data": "Windows Event ID 4688; Windows Event ID 4624",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Analyze Windows Event ID 4688 entries focusing on processes created with unusual token/logon information (correlate with 4624 by Logon ID). Examine process creation times and parent-child relationships using time series analysis or graphical representations of process trees to identify anomalous sequences not typical for the host or user."
          },
          "Process creation (especially privileged) with a token/user context that doesn't match the parent process's user, immediately followed by suspicious network activity.": {
            "Data": "Windows Event ID 4688; Windows Event ID 5156; Zeek conn.log",
            "Data Platform": "Endpoints, Servers, Network devices",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 4688 for processes created with unusual Logon ID/User compared to parent. Correlate these processes with outbound network connection attempts (Windows Event ID 5156, Zeek conn.log) occurring within seconds of the process creation time. Use correlation analysis to link the potentially token-created process to subsequent network activity, flagging connections to external or unusual destinations not typical for the host or user. Baseline typical network activity for standard processes and identify deviations."
          },
          "Process creation associated with an unusual or unexpected Windows Logon Type or a rapid change in user context/logon session without a standard logon event.": {
            "Data": "Windows Event ID 4688; Windows Event ID 4624; Windows Event ID 4648",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 4688. Correlate NewProcessId entries with Logon ID information derived from surrounding authentication events (Windows Event ID 4624, 4648). Analyze the Logon Type associated with the process's Logon ID. Flag process creations where the Logon Type is unusual for the parent process or execution context (e.g., a process seemingly created via interactive user action but associated with a Service or Batch logon type). Use frequency analysis to identify rare Logon Type/Parent Process combinations across the environment."
          }
        }
      },
      "version": "1.1",
      "last_updated": "2025-05-07"
    }
  }
]