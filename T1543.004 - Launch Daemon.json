[
  {
    "Is the adversary using Launch Daemons for persistence? (TA0003 - Persistence)": {
      "Indicators": {
        "T1543.004 - Launch Daemon": {
          "Creation or modification of new or existing plist files in /Library/LaunchDaemons/.": {
            "Data": "macOS File System Events",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor for file creation/modification events in /Library/LaunchDaemons/. Analyze file properties (creation time, size, content). Calculate frequency of file changes in this directory over time and flag deviations using time series analysis. Examine plist content for suspicious Program or ProgramArguments pointing to unexpected locations or unsigned binaries."
          },
          "Execution of unsigned or unusual executables launched via Launch Daemons.": {
            "Data": "macOS Process Creation Events; macOS Unified Logging",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor process creation events where the parent process is launchd and the executable path is listed in a Launch Daemon plist. Check executable code signing status. Correlate process launches with suspicious plist file activity. Identify processes launched from /Library/LaunchDaemons/ that are not part of known legitimate software or have unusual network connections (cross-referencing with network logs if available)."
          },
          "Detection of Launch Daemon plist files with the 'RunAtLoad' key set to true, pointing to executables in unusual or unexpected locations.": {
            "Data": "macOS File System Content; macOS Unified Logging",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Periodically scan or monitor `/Library/LaunchDaemons/` for plist files. Parse XML content to identify dictionaries containing the 'RunAtLoad' key with a value of 'true'. Extract the 'Program' or 'ProgramArguments' path. Compare these paths against a list of known legitimate locations (e.g., `/usr/local/bin`, `/Applications`) or standard system paths. Flag plists pointing to paths outside these known locations or within user home directories. Use frequency analysis on observed paths to identify rare occurrences."
          },
          "Changes to the executable file pointed to by an existing legitimate Launch Daemon plist file.": {
            "Data": "macOS File System Events; macOS Unified Logging",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Identify the 'Program' or 'ProgramArguments' paths specified in known legitimate Launch Daemon plists in `/Library/LaunchDaemons/`. Monitor these specific executable paths for file modification events (e.g., FSEvents). Compare the hash of the executable after modification to a known good baseline hash. Flag modifications of executables referenced by Launch Daemons, especially if the directory is not protected by System Integrity Protection (SIP)."
          }
        }
      },
      "version": "1.1",
      "last_updated": "2025-05-07"
    }
  },
  {
    "Has the adversary achieved privilege escalation via Launch Daemons? (TA0004 - Privilege-Escalation)": {
      "Indicators": {
        "T1543.004 - Launch Daemon": {
          "Execution of a process from /Library/LaunchDaemons/ with elevated privileges performing suspicious actions (e.g., modifying system files, creating privileged accounts).": {
            "Data": "macOS Process Execution Logs; macOS Audit Logs",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor processes launched by launchd from user-writeable Launch Daemon locations (/Library/LaunchDaemons/) that subsequently perform privileged operations (e.g., modifications to /etc, user additions via `dscl`, loading kernel extensions via `kextload`). Use correlation analysis to link the process launch event to subsequent suspicious system calls or file modifications logged in Audit Logs."
          },
          "Discovery of Launch Daemon plists configured to run malicious or unsigned code with RunAtLoad=true.": {
            "Data": "macOS File System Content; Configuration Audit Results",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Periodically audit or monitor for changes to Launch Daemon plist files in /Library/LaunchDaemons/. Parse plist files to identify RunAtLoad=true configurations. For such configurations, examine the Program or ProgramArguments paths. Flag plists pointing to non-standard locations or executables that are unsigned or do not match expected hashes. Compare current configurations to known good baselines using diff analysis."
          },
          "Privileged process launched by launchd (potentially via a Launch Daemon) creating child processes that perform administrative tasks or execute shell commands.": {
            "Data": "macOS Process Creation Events; macOS Audit Logs",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor process creation events (e.g., via Endpoint Security framework logs or Unified Logging). Identify processes whose parent is `launchd` and which execute with root privileges. Analyze the child processes spawned by these privileged `launchd` children. Flag instances where these privileged processes launch shell interpreters (`bash`, `zsh`) or execute commands commonly associated with privilege escalation or system modification (e.g., `sudo`, `defaults write /`, `dscl`). Use correlation analysis to link the privileged process launch event to subsequent suspicious child processes and actions."
          },
          "Detection of launchctl commands being used with elevated privileges to load or unload Launch Daemon plist files from /Library/LaunchDaemons/.": {
            "Data": "macOS Unified Logging; macOS Audit Logs",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor macOS Unified Logging and Audit Logs for executions of the `launchctl` command, specifically with the `load` or `unload` subcommands targeting paths in `/Library/LaunchDaemons/`. Filter for executions performed with elevated privileges (e.g., by the root user or via `sudo`). Use frequency analysis to identify infrequent or unexpected loading/unloading events, especially for newly created or modified plist files, which may indicate attempts to install or activate malicious daemons."
          }
        }
      },
      "version": "1.1",
      "last_updated": "2025-05-07"
    }
  }
]