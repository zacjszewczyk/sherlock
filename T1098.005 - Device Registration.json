[
  {
    "Is the adversary establishing persistent access by registering devices? (TA0003 - Persistence)": {
      "Indicators": {
        "T1098.005 - Device Registration": {
          "New device registered to an existing user account in the MFA system without user initiation or during unusual hours.": {
            "Data": "Zeek http.log; Zeek dns.log",
            "Data Platform": "Network devices",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Zeek http.log and dns.log for connections originating from internal IPs/users to known MFA provider domains (e.g., duo.com, okta.com). Identify sessions potentially indicating device registration based on URLs/request methods. Correlate with Windows Event ID 4624/4625 for the user (if available/relevant). Analyze frequency and timing of such events per user; flag events occurring outside typical work hours or locations using descriptive statistics and time series analysis."
          },
          "New device registered to Entra ID (Azure AD) or device management system (Intune) for an account.": {
            "Data": "Windows Event ID 4741; Zeek http.log",
            "Data Platform": "Servers, Network devices",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 4741 for computer account creation events (for hybrid join scenarios). Correlate with Zeek http.log for connections to Microsoft Entra ID endpoints (login.microsoftonline.com, enterpriseregistration.windows.net) around the same time from potentially new devices or unusual sources. Analyze registration sources (IP, user agent) and timestamps. Flag registrations for users not expected to add devices using frequency analysis."
          },
          "Successful MFA enrollment for a user account originating from an unusual source IP or device type/agent not previously associated with the user.": {
            "Data": "Zeek http.log; Zeek ssl.log",
            "Data Platform": "Network devices",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Zeek http.log and ssl.log for connections to known MFA provider enrollment endpoints (e.g., /enroll, /register, /factor). Extract source IP, user agent, and associated user (if identifiable). Compare source IP and user agent against a baseline of the user/account's historical values using correlation analysis. Flag enrollments from new or unusual IP/agent combinations as potentially malicious device registration for persistence."
          },
          "Registration of a device to Entra ID/Intune originating from an IP or network segment not typically used for device management enrollment.": {
            "Data": "Windows Event ID 4741; Zeek http.log",
            "Data Platform": "Servers, Network devices",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 4741 and Zeek http.log for events indicating device registration to Entra ID (e.g., connections to `enterpriseregistration.windows.net`). Identify source IP addresses and network segments. Compare against a baseline of known authorized IP ranges or locations for device enrollment using frequency or statistical analysis (e.g., IQR). Flag registrations originating from unusual or external IP ranges not typically used for this activity."
          }
        }
      },
      "version": "1.1",
      "last_updated": "2025-05-07"
    }
  },
  {
    "Is the adversary elevating privileges or bypassing policies by registering devices? (TA0004 - Privilege-Escalation)": {
      "Indicators": {
        "T1098.005 - Device Registration": {
          "Access to sensitive resources via a newly registered device bypassing conditional access policies.": {
            "Data": "Zeek conn.log; Windows Event ID 4624",
            "Data Platform": "Network devices, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Identify successful network logons (Windows Event ID 4624 network logon) or resource access sessions (Zeek conn.log) to sensitive assets originating from devices previously identified as newly registered (via Windows Event ID 4741 or Zeek logs). Correlate with expected conditional access policy behavior (e.g., requiring MFA from untrusted locations) to identify potential bypasses based on the connection details and the device's registered status."
          },
          "Spike in device registration activity originating from a small number of accounts or source IPs.": {
            "Data": "Windows Event ID 4741; Zeek http.log; Zeek dns.log",
            "Data Platform": "Servers, Network devices",
            "NAI": "Insert site-specific NAI here",
            "Action": "Aggregate Windows Event ID 4741 and Zeek http.log/dns.log events related to device registration activity. Calculate the rate of registration events per user and per source IP over time. Use statistical methods (e.g., moving average, IQR, entropy measures on source attributes) to identify statistically significant spikes or unusual concentrations in registration volume from a single user or source within a specific time window."
          },
          "Access to sensitive data sources (e.g., SharePoint sites, file shares) from a newly registered device that would normally be blocked or require additional authentication from untrusted devices.": {
            "Data": "Zeek conn.log; Windows Event ID 4624; Windows Event ID 5156",
            "Data Platform": "Servers, Network devices",
            "NAI": "Insert site-specific NAI here",
            "Action": "Identify sessions accessing sensitive resources (e.g., specific server IPs/ports, Sharepoint URLs via http.log) from devices previously identified as newly registered (via analysis in TA0003 E2 or TA0004 E2). Correlate with Windows Event ID 4624/5156 on resource servers or Zeek conn.log/http.log to verify access and connection details. Flag access instances where typical policy requirements (e.g., MFA, specific source IP/network) appear to have been bypassed, analyzing connection attributes using descriptive statistics."
          },
          "Outbound network activity or internal communication attempts originating from a newly registered device towards multiple internal users or systems, indicative of internal reconnaissance or exploitation attempts.": {
            "Data": "Zeek conn.log; Zeek smtp.log; Windows Event ID 5156",
            "Data Platform": "Endpoints, Network devices",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Zeek conn.log, smtp.log, and Windows Event ID 5156 for activity originating from devices identified as newly registered (via analysis in TA0003 E2 or TA0004 E2). Look for patterns of unusual internal network scanning (conn.log, 5156), bulk internal emails (smtp.log), or connections to internal infrastructure services from the new device. Use frequency analysis or graph analysis to identify connections or communications targeting a large number of internal destinations from a single source device."
          }
        }
      },
      "version": "1.1",
      "last_updated": "2025-05-07"
    }
  }
]