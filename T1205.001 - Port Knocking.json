[
  {
    "Is the adversary maintaining persistence using port knocking? (TA0003 - Persistence)": {
      "Indicators": {
        "T1205.001 - Port Knocking": {
          "Sequential connection attempts from a single source IP to a series of closed ports on a target system.": {
            "Data": "Zeek conn.log",
            "Data Platform": "Network devices",
            "NAI": "Insert site-specific NAI here",
            "Action": "Analyze Zeek conn.log for failed connection attempts (e.g., conn_state = 'REJ' or 'RSTO'). Group events by source IP and destination host. Identify sequences of connection attempts from a single source IP to multiple unique ports on the same destination within a short time frame. Use time series analysis on connection attempts from specific source IPs to identify sequential patterns across ports."
          },
          "Unusual network traffic patterns characterized by short bursts of connection attempts to non-standard or seemingly random ports, followed by successful connections.": {
            "Data": "Zeek conn.log",
            "Data Platform": "Network devices",
            "NAI": "Insert site-specific NAI here",
            "Action": "Identify external source IPs initiating multiple connection attempts (successful or failed) to a range of ports on internal systems. Use descriptive statistics (e.g., number of connections, range of ports, time delta between attempts) for each source IP. Compare these statistics to normal network behavior to find outliers potentially indicative of knocking patterns."
          },
          "Detection of raw socket usage or packet sniffing activity on a host correlating with receipt of suspicious inbound network traffic patterns.": {
            "Data": "Windows Event ID 4688; Zeek conn.log",
            "Data Platform": "Endpoints, Servers, Network devices",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor process creation logs (Windows Event ID 4688) for known packet sniffing tools or processes using raw sockets/low-level network APIs. Correlate these events with inbound network traffic patterns observed in Zeek conn.log that might match a port knocking sequence. Investigate if this activity is tied to user accounts or processes not normally authorized for such actions."
          },
          "Appearance of a new or previously inactive listening port on a host immediately following a suspected inbound port knocking sequence from an external source.": {
            "Data": "Windows Event ID 5158; Zeek conn.log",
            "Data Platform": "Servers, Endpoints, Network devices",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor host logs (Windows Event ID 5158) and network visibility logs (Zeek conn.log showing unexpected server states on a port, or specific listening logs if configured) for new listening ports appearing on internal systems, especially those bound by unusual processes. Correlate the time of the port becoming active with suspected inbound port knocking sequences from external IPs identified in Zeek conn.log failed connection attempts. Analyze temporal correlation."
          },
          "Attempted outbound connections to uncommon ports or destinations from an internal host after receiving a suspected inbound port knocking sequence.": {
            "Data": "Zeek conn.log",
            "Data Platform": "Network devices",
            "NAI": "Insert site-specific NAI here",
            "Action": "Correlate internal hosts receiving suspected inbound port knocking sequences (identified by unusual failed connection patterns in Zeek conn.log) with subsequent outbound connections initiated by the same host. Analyze these outbound connections for destinations on high or uncommon ports, or connections to suspicious external IPs/domains using correlation analysis with threat intelligence feeds. Use time series analysis to measure the delay between the completion of the knocking sequence and the initiation of the outbound connection."
          },
          "Changes to host firewall rules or listening services immediately following inbound traffic suspected of being a port knocking sequence.": {
            "Data": "Windows Event ID 5025; Windows Event ID 5031; Zeek conn.log",
            "Data Platform": "Servers, Endpoints, Network devices",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event IDs 5025/5031 (or similar logs indicating firewall rule changes or service activation) on internal hosts. Correlate these events with inbound traffic patterns in Zeek conn.log suspected of being port knocking sequences targeting the same host. Use temporal analysis to identify firewall/service changes occurring shortly after the suspected knocking sequence completes. Investigate the source IP of the traffic and the nature of the rule/service change."
          }
        }
      },
      "version": "1.1",
      "last_updated": "2025-05-07"
    }
  },
  {
    "Is the adversary evading defenses using port knocking? (TA0005 - Defense Evasion)": {
      "Indicators": {
        "T1205.001 - Port Knocking": {
          "Network sessions recorded with a small number of packets or unexpected flags/payloads that do not establish a standard TCP/UDP flow.": {
            "Data": "Zeek conn.log",
            "Data Platform": "Network devices",
            "NAI": "Insert site-specific NAI here",
            "Action": "Filter Zeek conn.log for connections with unusual conn_state values or short durations that don't represent established sessions. Correlate these with potential 'knocking' source IPs identified in other analyses. Use entropy measures on port sequences attempted by specific IPs to identify non-random or patterned probing."
          },
          "Detection of a previously closed port briefly opening or becoming active immediately after a suspected port knocking sequence from an external source.": {
            "Data": "Zeek conn.log",
            "Data Platform": "Network devices",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Zeek conn.log for successful connections to ports that are typically closed or inactive. Look for correlations between a successful connection to an unusual port and preceding sequences of failed connection attempts from the same source IP (identified as per Evidence 1 action). Analyze temporal correlation between failed sequences and subsequent successful connections."
          },
          "Network traffic flows containing packets with unusual characteristics (e.g., unexpected flags, small payloads) that don't fit standard protocol handshakes, potentially used for knocking.": {
            "Data": "Zeek conn.log",
            "Data Platform": "Network devices",
            "NAI": "Insert site-specific NAI here",
            "Action": "Analyze Zeek conn.log for sessions characterized by unusual TCP flags combinations or connection states indicating incomplete handshakes ('S0', 'SF' with very few packets). Filter for external source IPs and internal destinations. Use descriptive statistics on packet size, flags, and timing within potential knocking sequences to identify outliers or non-standard patterns."
          },
          "Observation of a successful connection to a port that was recently scanned or probed multiple times by the same external source IP without establishing a full session.": {
            "Data": "Zeek conn.log",
            "Data Platform": "Network devices",
            "NAI": "Insert site-specific NAI here",
            "Action": "Correlate entries in Zeek conn.log showing a successful connection (conn_state='SF') from an external IP to an internal host/port with preceding failed connection attempts ('REJ', 'RSTO', 'S0') from the same source IP to other ports on the same destination host within a recent time window. Analyze the temporal proximity and the specific sequence of attempted/failed ports leading to the successful connection."
          },
          "Inbound traffic patterns consisting of multiple short-lived connection attempts to different ports, none of which result in a full TCP handshake, followed by a successful connection to a specific hidden port.": {
            "Data": "Zeek conn.log",
            "Data Platform": "Network devices",
            "NAI": "Insert site-specific NAI here",
            "Action": "Analyze Zeek conn.log for inbound connections (conn_state='S0', 'REJ', 'RSTO') from a single source IP to a target host, attempting connections to a sequence of unique ports within a short duration. Use sequence analysis to identify if a successful connection (conn_state='SF') to a different port on the same host consistently follows the completion of a specific failed-attempt sequence from that same source IP. Use correlation analysis to link the sequence to the successful connection."
          },
          "Network traffic patterns containing very small packets or packets with unusual data payloads/sizes sent to closed ports, which are atypical for standard port scanning or reconnaissance.": {
            "Data": "Zeek conn.log",
            "Data Platform": "Network devices",
            "NAI": "Insert site-specific NAI here",
            "Action": "Filter Zeek conn.log for failed or incomplete connections (conn_state='S0', 'REJ', 'RSTO') to various ports from external IPs. Analyze the packet characteristics (e.g., orig_bytes, resp_bytes) associated with these sessions. Use descriptive statistics (mean, median packet size) and outlier analysis to identify traffic patterns with unusually small packet sizes or non-standard flag combinations compared to typical scan traffic. Correlate these patterns with source IPs exhibiting sequential connection attempts."
          }
        }
      },
      "version": "1.1",
      "last_updated": "2025-05-07"
    }
  },
  {
    "Is the adversary establishing command and control using port knocking? (TA0011 - Command And Control)": {
      "Indicators": {
        "T1205.001 - Port Knocking": {
          "Identification of outbound connections from an internal host to an external IP or domain known to be suspicious, immediately following a detected port knocking sequence targeting that host.": {
            "Data": "Zeek conn.log",
            "Data Platform": "Network devices",
            "NAI": "Insert site-specific NAI here",
            "Action": "Correlate suspicious outbound connections (e.g., to known malicious IPs/domains from threat intel) originating from internal hosts with inbound port knocking sequences targeting those same internal hosts. Use time series correlation to identify outbound C2 traffic occurring immediately after an inbound knock sequence is completed."
          },
          "Successful connections established to high or uncommon ports on internal systems that appear to be triggered by specific inbound traffic patterns from external sources.": {
            "Data": "Zeek conn.log",
            "Data Platform": "Network devices",
            "NAI": "Insert site-specific NAI here",
            "Action": "Identify successful inbound connections from external sources to high or non-standard ports. Analyze the preceding network traffic from the source IP to the destination host for patterns matching a known or suspected port knocking sequence (e.g., specific port orders or timing). Use sequence analysis techniques on connection attempts."
          },
          "Spikes in data transfer or unusual connection patterns on an internal host immediately following receipt of a suspected inbound port knocking sequence.": {
            "Data": "Zeek conn.log",
            "Data Platform": "Network devices",
            "NAI": "Insert site-specific NAI here",
            "Action": "For internal hosts targeted by suspected port knocking sequences (identified via prior evidence/actions), analyze subsequent Zeek conn.log entries for unusual outbound or inbound traffic patterns. Look for sudden increases in bytes transferred (orig_bytes, resp_bytes), connections to high/uncommon ports, or connections to suspicious external IPs/domains occurring within a short time window after the knocking sequence completes. Use time series analysis on data transfer volumes and connection counts."
          },
          "Outbound connection initiated from an internal host to an external destination immediately after a port knocking sequence was received and processed by that host.": {
            "Data": "Zeek conn.log",
            "Data Platform": "Network devices",
            "NAI": "Insert site-specific NAI here",
            "Action": "Correlate detected inbound port knocking sequences targeting an internal host with subsequent outbound connections initiated by that same internal host to external destinations within a short time frame (e.g., seconds to minutes). Analyze the destination IPs/domains of these outbound connections for known C2 infrastructure using threat intelligence feeds. Use temporal correlation analysis to link the inbound knock sequence to the outbound connection."
          },
          "Repeated, scheduled outbound connections from an internal host to an external destination, where each connection attempt is preceded by a successful port knocking sequence targeting that internal host.": {
            "Data": "Zeek conn.log",
            "Data Platform": "Network devices",
            "NAI": "Insert site-specific NAI here",
            "Action": "Identify suspected port knocking sequences targeting internal hosts using Zeek conn.log (failed connection patterns). Correlate the completion times of these sequences with the initiation times of outbound connections from the same internal host. Use time series analysis and correlation to identify internal hosts exhibiting recurring outbound connections (potentially to the same external destination) that are consistently preceded by a detected inbound port knocking sequence within a short, consistent time interval."
          },
          "Successful connection to a high or otherwise unusual port on an internal host from an external source, utilizing an uncommon protocol signature, immediately following a suspected port knocking sequence.": {
            "Data": "Zeek conn.log",
            "Data Platform": "Network devices",
            "NAI": "Insert site-specific NAI here",
            "Action": "Analyze Zeek conn.log for successful inbound connections from external IPs to high or unusual ports on internal hosts. For these successful connections, examine the identified protocol (service field or specific application logs) and data transfer patterns (orig_bytes, resp_bytes). Correlate these successful sessions with preceding inbound port knocking sequences from the same source IP. Use correlation analysis and descriptive statistics on flow characteristics to identify connections exhibiting signatures atypical for legitimate traffic on that port, occurring after a knock."
          }
        }
      },
      "version": "1.1",
      "last_updated": "2025-05-07"
    }
  }
]