[
  {
    "Is the adversary maintaining persistence using power settings? (TA0003 - Persistence)": {
      "Indicators": {
        "Execution of command-line utilities to modify power settings.": {
          "Monitor Windows Event ID 4688 for process creations containing 'powercfg.exe' or similar utilities executed with arguments designed to alter default power schemes, sleep, or hibernate settings. Filter events by user context and correlate with other process activity on the host.": {
            "Data": "Windows Event ID 4688",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 4688 for process creations containing 'powercfg.exe' or similar utilities executed with arguments designed to alter default power schemes, sleep, or hibernate settings. Filter events by user context and correlate with other process activity on the host."
          },
          "Specific `powercfg` command-line arguments used to disable hibernate, sleep, or change display timeouts.": {
            "Data": "Windows Event ID 4688",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Filter Windows Event ID 4688 where `New Process Name` ends with `powercfg.exe`. Analyze the `Command Line` field for arguments like `/hibernate off`, `/change standby-timeout-ac 0`, `/change monitor-timeout-ac 0`, `/x`, `/setactive`, `/duplicatescheme` followed by identifiers known to disable power-saving states. Use frequency analysis to identify unusual occurrences of these specific commands on a given host or across the network."
          },
          "`powercfg.exe` or other power management utilities launched by unusual parent processes (e.g., scripting interpreters, downloaded executables) rather than system processes or user shell.": {
            "Data": "Windows Event ID 4688",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 4688 for process creations where `New Process Name` is `powercfg.exe` or similar power management binaries. Identify the `Parent Process Name`. Establish a baseline of common parent processes for these utilities (e.g., `explorer.exe`, command prompts, PowerShell). Flag instances where the `Parent Process Name` is outside this baseline using frequency analysis or rule-based detection."
          }
        },
        "Attempts to disable screen lock or modify system timeouts.": {
          "Monitor Windows Event ID 4688 for processes modifying registry keys related to screen saver timeout, system lock, or hibernate/sleep timeouts (e.g., using 'reg.exe'). Monitor Windows Event ID 4656/4657 for access attempts (read/write/delete) on power-related system files. Use anomaly detection to flag hosts with unusual changes in these settings.": {
            "Data": "Windows Event ID 4688; Windows Event ID 4656; Windows Event ID 4657",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 4688 for processes modifying registry keys related to screen saver timeout, system lock, or hibernate/sleep timeouts (e.g., using 'reg.exe'). Monitor Windows Event ID 4656/4657 for access attempts (read/write/delete) on power-related system files. Use anomaly detection to flag hosts with unusual changes in these settings."
          },
          "Execution of `reg.exe` or `regedit.exe` modifying registry keys known to control power settings, screen lock, or timeouts.": {
            "Data": "Windows Event ID 4688",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 4688 for process creations where `New Process Name` ends with `reg.exe` or `regedit.exe`. Filter command lines for patterns indicating modification (`ADD`, `SET`, `DELETE`, `/v`, `/d`) to known registry paths controlling power settings, screen saver, or lock timeouts (e.g., `HKCU\\Control Panel\\Desktop\\ScreenSaveTimeout`, `HKCU\\Control Panel\\PowerCfg`, `HKLM\\SOFTWARE\\Policies\\Microsoft\\Power\\PowerSettings`). Flag these modifications, especially if the value is set to 0 or a very large number, as potential attempts to disable timeouts."
          },
          "Unusual network connection patterns (e.g., persistent connections, connections to C2 infrastructure) from a host where power settings have been recently modified.": {
            "Data": "Windows Event ID 4688; Zeek conn.log",
            "Data Platform": "Endpoints, Servers, Network devices",
            "NAI": "Insert site-specific NAI here",
            "Action": "Identify hosts exhibiting evidence of power setting modification via command line (WinEvent ID 4688 for powercfg/reg) or registry changes (WinEvent ID 4688 for reg/regedit). Within a time window (e.g., 30 minutes) following these events, examine Zeek conn.log for connections originating from these hosts. Look for persistent connections (long duration via time series analysis), connections to known malicious IPs (using threat intelligence feeds), or unusual destination ports/protocols. Use correlation analysis between host events and network events based on host IP and timestamp to identify systems potentially configured for persistent C2 access."
          }
        }
      },
      "version": "1.1",
      "last_updated": "2025-05-07"
    }
  }
]