[
  {
    "Is the adversary evading defenses using application access tokens? (TA0005 - Defense Evasion)": {
      "Indicators": {
        "T1550.001 - Application Access Token": {
          "Connections to SaaS/Cloud service APIs from internal or unexpected sources, potentially bypassing normal authentication flows.": {
            "Data": "Zeek conn.log; Zeek http.log",
            "Data Platform": "Network devices",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Zeek conn.log and http.log for connections to known SaaS/Cloud provider API endpoints. Identify connections originating from internal hosts that do not match typical user access patterns or expected service-to-service communication. Use correlation analysis to link these connections to specific hosts or users, especially if no preceding interactive authentication is observed."
          },
          "Network connections to sensitive SaaS/Cloud service APIs that do not follow typical interactive user login patterns.": {
            "Data": "Zeek conn.log; Zeek http.log",
            "Data Platform": "Network devices",
            "NAI": "Insert site-specific NAI here",
            "Action": "Analyze Zeek conn.log and http.log for successful connections to sensitive services. Compare connection patterns (source IP, time, protocol, user agent) against established baselines. Identify connections that occur without associated interactive login events or from IPs/user agents not typically used for interactive access, using time series analysis or outlier detection."
          },
          "API calls to sensitive services originating from unexpected user agents or clients that do not typically perform interactive logins for the associated user/account.": {
            "Data": "Zeek http.log; Zeek conn.log",
            "Data Platform": "Network devices",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Zeek http.log for API calls to sensitive SaaS/Cloud services. Baseline common 'user_agent' strings associated with legitimate API access or interactive logins for specific accounts or hosts using frequency analysis. Flag connections using unusual user agents or clients, especially if they originate from IP addresses not typically used by the associated account or occur outside normal working hours (using time series analysis on connection times per user/account)."
          },
          "Anomalous requests to cloud identity and access management (IAM) or security token services (e.g., AWS STS) for temporary credentials or access tokens.": {
            "Data": "Zeek http.log; Zeek conn.log",
            "Data Platform": "Network devices",
            "NAI": "Insert site-specific NAI here",
            "Action": "Filter Zeek http.log for requests targeting known AWS STS endpoints (`sts.*.amazonaws.com`) or GCP IAM/Service Account endpoints. Identify requests for temporary credentials (`AssumeRole`, `GetFederationToken`, `GetSessionToken`) or service account key usage. Establish a baseline for expected calls per account/host/role using frequency analysis. Flag calls from unusual source IPs, at unusual frequencies (outlier detection), or requesting tokens/credentials with excessive permissions compared to typical usage."
          }
        }
      },
      "version": "1.1",
      "last_updated": "2025-05-07"
    }
  },
  {
    "Is the adversary performing lateral movement using application access tokens? (TA0008 - Lateral Movement)": {
      "Indicators": {
        "T1550.001 - Application Access Token": {
          "Unusual network connections initiated from a host/account compromised via token access, targeting internal resources.": {
            "Data": "Zeek conn.log; Windows Event ID 4624; Windows Event ID 4688",
            "Data Platform": "Network devices, Servers, Endpoints",
            "NAI": "Insert site-specific NAI here",
            "Action": "Investigate Zeek conn.log for new or unusual internal network connections originating from hosts recently seen connecting to cloud/SaaS APIs. Correlate with Windows Event ID 4624/4688 on those hosts to identify processes or login activity potentially initiated via API access, using sequence analysis of events. Use graph analysis to map communication paths and identify deviations from normal patterns."
          },
          "Network traffic originating from hosts or network segments indicative of cloud API interaction, especially if associated with unexpected accounts or services.": {
            "Data": "Zeek conn.log; Windows Event ID 4688",
            "Data Platform": "Network devices, Servers, Endpoints",
            "NAI": "Insert site-specific NAI here",
            "Action": "Filter Zeek conn.log for connections to cloud provider API endpoints (e.g., AWS STS endpoints, GCP API endpoints). Identify unexpected source IPs or user agents. Monitor for connections to newly provisioned resources (visible in Zeek logs if internal hosts connect to them) and correlate with potential API calls triggering provisioning. Use frequency analysis to spot unusual volumes or types of API calls from specific sources."
          },
          "API calls or connections to internal services or unexpected external services initiated by a host/account using credentials obtained via token access, bypassing typical internal authentication.": {
            "Data": "Zeek conn.log; Zeek http.log; Windows Event ID 4624",
            "Data Platform": "Network devices, Servers, Endpoints",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Zeek conn.log and http.log for connections originating from hosts/accounts potentially compromised via API token access (identified through other detections). Look for new or unusual internal connections (lateral movement attempts) or connections to unexpected external destinations (C2, exfiltration). Correlate with Windows Event ID 4624 on target systems if login type 3 is observed. Use graph analysis to map communication paths from compromised hosts/accounts and identify deviations from normal patterns using baselines."
          },
          "Authentication attempts or access requests to disparate internal or external services (e.g., internal wiki, HR system, secondary SaaS app) originating from an account or source linked to a potentially compromised access token.": {
            "Data": "Zeek http.log; Windows Event ID 4624; Windows Event ID 4688",
            "Data Platform": "Network devices, Servers, Endpoints",
            "NAI": "Insert site-specific NAI here",
            "Action": "Correlate Zeek http.log showing API calls (potentially token-based) with subsequent authentication attempts (Windows Event ID 4624) or process execution (Windows Event ID 4688) targeting unrelated internal or external services using the same or related account. Identify patterns of accessing multiple different service types from a single source or account that are not typical user behavior using descriptive statistics and outlier detection to find unusual counts or variety of services accessed within a given timeframe."
          }
        }
      },
      "version": "1.1",
      "last_updated": "2025-05-07"
    }
  }
]