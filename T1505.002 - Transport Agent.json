[
  {
    "Is the adversary maintaining persistence using a malicious transport agent? (TA0003 - Persistence)": {
      "Indicators": {
        "T1505.002 - Transport Agent": {
          "Registration of a new or modified transport agent on an Exchange server.": {
            "Data": "Windows Event ID 4688",
            "Data Platform": "Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 4688 on Exchange servers for process creations related to Exchange management shell cmdlets, specifically `Install-TransportAgent` or `Enable-TransportAgent`. Analyze command-line arguments for unusual agent names or paths. Use frequency analysis to identify agents installed outside of standard maintenance windows."
          },
          "Creation or modification of files (e.g., .NET assemblies) in directories associated with Exchange transport agents.": {
            "Data": "Windows Event ID 4663",
            "Data Platform": "Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Configure SACLs on Exchange transport agent directories (e.g., `\\Exchange Server\\TransportRoles\\agents`) to log file creation/modification events (Windows Event ID 4663). Monitor these logs for new files or modifications to existing agent assemblies (.dll files) in these directories. Use time series analysis or deviation analysis to identify activity outside expected deployment windows."
          },
          "Anomalous file creation or modification events on an Exchange server originating from processes associated with transport agents.": {
            "Data": "Windows Event ID 4663; Windows Event ID 4688",
            "Data Platform": "Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 4663 on Exchange servers for file creation/modification events in potentially sensitive or staging directories (e.g., temp folders, public web folders). Correlate these file events with the process names associated with installed transport agents (identified via Event ID 4688 or known Exchange processes). Analyze the frequency and size of created/modified files, especially those occurring rapidly or outside normal file activity patterns, using descriptive statistics."
          },
          "Outbound network connections initiated by Exchange transport processes to unusual external IP addresses or domains.": {
            "Data": "Zeek conn.log; Windows Event ID 5156",
            "Data Platform": "Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Zeek conn.log and Windows Event ID 5156 on Exchange servers for outbound connections (destination is external IP). Filter these events by the process name of the Exchange transport service (e.g., `edgetransport.exe`, `msftesds.exe`). Compare destination IPs/domains against known good lists and threat intelligence feeds. Use frequency analysis to identify rare or new destinations, and correlation analysis to see if these connections align with specific email processing events (though email content isn't directly available in logs, timing might provide clues)."
          }
        }
      },
      "version": "1.1",
      "last_updated": "2025-05-07"
    }
  }
]