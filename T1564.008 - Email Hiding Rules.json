[
  {
    "Is the adversary using email rules to evade detection? (TA0005 - Defense Evasion)": {
      "Indicators": {
        "Creation or modification of email inbox rules via host processes (e.g., PowerShell).": {
          "Creation or modification of email inbox rules via host processes (e.g., PowerShell).": {
            "Data": "Windows Event ID 4688; Windows Event ID 4104",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Search Windows Event Logs (Event ID 4688 or 4104 if available) for processes running PowerShell with arguments containing \"New-InboxRule\" or \"Set-InboxRule\". Analyze the user, source host, and timestamp. Use time series analysis to identify spikes in rule creation activity or creation outside normal working hours."
          },
          "Abnormal access or modification of email client configuration files.": {
            "Data": "Windows Event ID 4663; Windows Event ID 4688",
            "Data Platform": "Endpoints",
            "NAI": "Insert site-specific NAI here",
            "Action": "If file auditing is enabled, search Windows Event Logs (Event ID 4663) for access or modification attempts on common email client configuration files by unusual processes or user accounts. Use correlation analysis to link file access events to specific user logon sessions (Event ID 4624) and identify potentially compromised accounts."
          },
          "Network connections initiated by email client processes or related system processes to unusual or external destinations shortly after rule modification.": {
            "Data": "Zeek conn.log; Windows Event ID 5156; Windows Event ID 4688",
            "Data Platform": "Endpoints, Network devices",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Zeek conn.log and Windows Event ID 5156 for network connections initiated by email client processes (e.g., outlook.exe) or svchost.exe (for Exchange MAPI/RPC) to external or unusual internal destinations. Correlate these network events with recent Windows Event ID 4688 showing processes that could modify rules (e.g., PowerShell, script interpreters). Use frequency analysis or time series analysis to identify connections to rare or suspicious destinations or sudden changes in connection patterns."
          },
          "PowerShell script block logs containing parameters for New-InboxRule or Set-InboxRule that filter based on suspicious keywords (e.g., 'malware', 'phish').": {
            "Data": "Windows Event ID 4104",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Search Windows Event ID 4104 logs for script blocks containing 'New-InboxRule' or 'Set-InboxRule'. Filter results for arguments like 'Subject', 'Body', 'From', 'FromAddress', 'Keywords' that include suspicious terms such as 'malware', 'phish', 'suspicious', 'alert', 'security', 'compromised'. Analyze the full script context and associated user account."
          }
        },
        "Abnormal access or modification of email client configuration files.": {
          "Creation or modification of email inbox rules via host processes (e.g., PowerShell).": {
            "Data": "Windows Event ID 4688; Windows Event ID 4104",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Search Windows Event Logs (Event ID 4688 or 4104 if available) for processes running PowerShell with arguments containing \"New-InboxRule\" or \"Set-InboxRule\". Analyze the user, source host, and timestamp. Use time series analysis to identify spikes in rule creation activity or creation outside normal working hours."
          },
          "Abnormal access or modification of email client configuration files.": {
            "Data": "Windows Event ID 4663; Windows Event ID 4688",
            "Data Platform": "Endpoints",
            "NAI": "Insert site-specific NAI here",
            "Action": "If file auditing is enabled, search Windows Event Logs (Event ID 4663) for access or modification attempts on common email client configuration files by unusual processes or user accounts. Use correlation analysis to link file access events to specific user logon sessions (Event ID 4624) and identify potentially compromised accounts."
          },
          "Access or modification of email client configuration files by unexpected processes or system utilities (e.g., cmd.exe, script interpreters, non-email client applications).": {
            "Data": "Windows Event ID 4663; Windows Event ID 4688",
            "Data Platform": "Endpoints",
            "NAI": "Insert site-specific NAI here",
            "Action": "If file system auditing is enabled, monitor Windows Event ID 4663 for write/modify operations targeting known email client configuration files (e.g., '.pst', '.ost', '.plist' on Mac, or relevant registry keys). Correlate 4663 events with Windows Event ID 4688 (Process Creation) to identify the process performing the access. Establish a baseline of legitimate processes accessing these files and flag access by any process outside this baseline using frequency analysis."
          },
          "Network traffic (e.g., SMB) showing external or unusual internal hosts accessing standard user profile paths containing email client configuration files.": {
            "Data": "Zeek smb_files.log; Zeek conn.log",
            "Data Platform": "Network devices",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Zeek smb_files.log and conn.log for SMB traffic targeting user profile directories containing email configuration files (e.g., '\\Users\\<username>\\AppData\\Local\\Microsoft\\Outlook\\'). Filter for connections originating from unexpected internal hosts (not the user's primary machine) or external sources. Use correlation analysis to link SMB file access events to user logon events (Windows Event ID 4624) to identify potential session hijacking or abuse of privileged access. Use frequency analysis to identify rare source/destination host pairs or unusual file access patterns."
          }
        }
      },
      "version": "1.1",
      "last_updated": "2025-05-07"
    }
  }
]