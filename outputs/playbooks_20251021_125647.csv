Playbook Name,Playbook ID,Type,Created,Modified,Contributors,Related,Tags,Question #,Question,Context,Answer Sources,Range,Queries,File
T1003.005: Cached Domain Credentials,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0006: Credential Access,n; o; n; e,1,Has a process executed with a hash matching a known credential dumping utility?,This question aims to identify the use of known malicious tools like Mimikatz or secretsdump.py by comparing the cryptographic hash of executed processes against a threat intelligence feed. A match is a high-confidence indicator of a credential dumping attempt.,"Windows Event ID 4688; Sysmon Event ID 1; Sysmon for Linux Event ID 1; All Windows and Linux Endpoints, Privileged Access Workstations, Critical Application Servers, and Domain Controllers.",last 90 days,: Search process execution logs. Filter where process hash matches a threat intelligence feed of known credential dumping tool hashes. Generate a high-severity alert on match.,playbooks/attack/enterprise/T1003.005.yml
T1003.005: Cached Domain Credentials,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0006: Credential Access,n; o; n; e,2,"Has a statistically rare process executed, potentially indicating an unknown credential dumping tool?","This question looks for anomalous process executions by calculating the enterprise-wide prevalence of a process hash. A process seen on very few hosts (e.g., <5) or not associated with a known software deployment could be a novel or obfuscated malicious tool. The risk is higher if it runs from a temporary or user-writable directory.","Windows Event ID 4688; Sysmon Event ID 1; Sysmon for Linux Event ID 1; All Windows and Linux Endpoints, Privileged Access Workstations, Critical Application Servers, and Domain Controllers.",last 90 days,": For each process execution, calculate enterprise-wide hash prevalence. Flag as risky if hash is seen on < 5 hosts or < 0.01% of fleet and not part of a known software deployment. Increase risk if path is temporary/user-writable.",playbooks/attack/enterprise/T1003.005.yml
T1003.005: Cached Domain Credentials,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0006: Credential Access,n; o; n; e,3,Can machine learning classify a process as a credential dumping tool based on its metadata?,"This question uses a supervised machine learning model to classify processes as benign or malicious. By analyzing features like hash prevalence, file path characteristics, parent process details, and code signing status, the model can identify suspicious processes that may not be caught by signature-based or simple statistical methods.","Windows Event ID 4688; Sysmon Event ID 1; Sysmon for Linux Event ID 1; All Windows and Linux Endpoints, Privileged Access Workstations, Critical Application Servers, and Domain Controllers.",last 90 days,": Extract features from process execution events (e.g., hash prevalence, path entropy, parent process name, is signed). Apply trained classification model (e.g., XGBoost) to classify process as benign or malicious.",playbooks/attack/enterprise/T1003.005.yml
T1003.005: Cached Domain Credentials,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0006: Credential Access,n; o; n; e,4,Has a process been executed with command-line arguments indicative of credential dumping?,"This question searches for specific text patterns and commands (e.g., 'sekurlsa::logonpasswords', 'reg.exe save HKLM\SECURITY') within process command-line arguments. These are strong signatures for known credential dumping techniques and tools.","Windows Event ID 4688; Sysmon Event ID 1; Auditd logs; All Windows Endpoints, Authentication Servers, Linux systems integrated with Active Directory",last 90 days,": Search process execution logs for command-line arguments. Apply a regex filter for known credential dumping patterns like 'sekurlsa::', 'lsadump::cache', 'reg.exe save HKLM\SECURITY', and 'tdbdump'. Alert on any match.",playbooks/attack/enterprise/T1003.005.yml
T1003.005: Cached Domain Credentials,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0006: Credential Access,n; o; n; e,5,Has a user or host executed a command with statistically rare argument patterns?,"This question aims to detect novel or obfuscated malicious commands by baselining normal command-line patterns for each user and host. A command whose structure is highly unusual (e.g., in the 99.5th percentile of rarity) for that context is flagged as anomalous and warrants investigation.","Windows Event ID 4688; Sysmon Event ID 1; Auditd logs; All Windows Endpoints, Authentication Servers, Linux systems integrated with Active Directory",last 90 days,": For each user/host, establish a 30-day baseline of command-line argument n-grams. Flag any new command whose pattern rarity is in the 99.5th percentile for that user or host.",playbooks/attack/enterprise/T1003.005.yml
T1003.005: Cached Domain Credentials,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0006: Credential Access,n; o; n; e,6,Can command-line arguments be clustered using NLP to identify malicious activity?,"This question applies Natural Language Processing (NLP) to group similar command-line arguments. By converting commands into numerical representations (embeddings) and clustering them, we can identify commands that fall into known malicious clusters or are outliers from all established benign clusters, indicating potentially new attack techniques.","Windows Event ID 4688; Sysmon Event ID 1; Auditd logs; All Windows Endpoints, Authentication Servers, Linux systems integrated with Active Directory",last 90 days,": Generate NLP embeddings for all command-line arguments. Use a clustering algorithm (e.g., K-Means) to group similar commands. Investigate commands in malicious clusters or those identified as outliers.",playbooks/attack/enterprise/T1003.005.yml
T1003.005: Cached Domain Credentials,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0006: Credential Access,n; o; n; e,7,"Has an unauthorized process attempted to read critical registry hives like SECURITY, SYSTEM, or SAM?","This question focuses on protecting registry hives that store credential material. By deploying monitoring (SACLs) and creating an allowlist of legitimate system processes (like lsass.exe), we can alert on any unauthorized process attempting to read these sensitive locations, which is a common step in credential dumping.","Windows Event ID 4656; Windows Event ID 4663; Sysmon Event ID 13; Domain Controllers, Windows Servers with cached credentials enabled, User Workstations",last 90 days,": Monitor for read handle requests (Event ID 4656/4663) to HKLM\SECURITY, HKLM\SYSTEM, and HKLM\SAM. Alert if the process image path is not on a pre-defined allowlist of legitimate system processes.",playbooks/attack/enterprise/T1003.005.yml
T1003.005: Cached Domain Credentials,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0006: Credential Access,n; o; n; e,8,Has a process from a statistically unusual file path accessed critical registry hives?,"This question identifies suspicious registry access by analyzing the file path of the accessing process. Malicious tools are often dropped in temporary or randomized locations, resulting in high-entropy file paths. A process accessing sensitive hives from such a path is highly suspect compared to legitimate system processes in predictable locations like C:\Windows\System32.","Windows Event ID 4656; Windows Event ID 4663; Sysmon Event ID 13; Domain Controllers, Windows Servers with cached credentials enabled, User Workstations",last 90 days,": For each process accessing critical hives, calculate the Shannon entropy of its file path. Flag events where the path entropy is statistically high compared to a baseline, indicating a potentially randomized or suspicious location.",playbooks/attack/enterprise/T1003.005.yml
T1003.005: Cached Domain Credentials,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0006: Credential Access,n; o; n; e,9,Can anomalous registry hive access be identified by clustering access events?,"This question uses unsupervised machine learning to find unusual patterns in registry hive access. By clustering events based on features like the process name, user context, and time of day, we can identify outlier events that do not fit into any established 'benign' cluster, representing a potential threat.","Windows Event ID 4656; Windows Event ID 4663; Sysmon Event ID 13; Domain Controllers, Windows Servers with cached credentials enabled, User Workstations",last 90 days,": Cluster registry hive access events using features like process name, user context, time of day, and parent process. Investigate outlier clusters or individual outlier events that do not belong to known benign clusters.",playbooks/attack/enterprise/T1003.005.yml
T1003.005: Cached Domain Credentials,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0006: Credential Access,n; o; n; e,10,Has an unauthorized process attempted to read the memory of the LSASS process?,This question detects a classic credential dumping technique: memory scraping of the Local Security Authority Subsystem Service (lsass.exe). We monitor for processes requesting specific memory access rights (like PROCESS_VM_READ) to lsass.exe and alert if the source process is not on a pre-defined allowlist of legitimate security and system tools.,"Sysmon Event ID 10; All Windows Endpoints and Servers, especially Domain Controllers",last 90 days,": Monitor Sysmon Event ID 10 where TargetImage is 'lsass.exe'. Alert if GrantedAccess includes '0x1010' (PROCESS_VM_READ) and SourceImage is not on an allowlist of approved tools (e.g., MsMpEng.exe).",playbooks/attack/enterprise/T1003.005.yml
T1003.005: Cached Domain Credentials,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0006: Credential Access,n; o; n; e,11,Has a new or rare process/user combination been observed accessing the LSASS process?,This question establishes a behavioral baseline of which processes and logon sessions normally interact with lsass.exe. Any 'first-seen' combination of a source process and logon ID accessing LSASS is flagged as anomalous. The suspicion level increases if the process itself is rare across the entire organization.,"Sysmon Event ID 10; All Windows Endpoints and Servers, especially Domain Controllers",last 90 days,": Establish a 30-day baseline of (SourceImage, LogonId) pairs that access lsass.exe. Alert on any new pair observed for the first time. Score severity based on the enterprise-wide rarity of the SourceImage.",playbooks/attack/enterprise/T1003.005.yml
T1003.005: Cached Domain Credentials,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0006: Credential Access,n; o; n; e,12,Can a machine learning model detect anomalous access to the LSASS process?,"This question uses a one-class SVM model, which is trained exclusively on legitimate LSASS access events. The model learns the boundary of 'normal' behavior. Any new access event that falls outside this learned boundary is classified as an anomaly, indicating a potential credential dumping attempt that might use novel methods.","Sysmon Event ID 10; All Windows Endpoints and Servers, especially Domain Controllers",last 90 days,: Train a one-class SVM model on feature vectors from legitimate LSASS access events. Use the model to identify any new access events that are classified as anomalous or novel.,playbooks/attack/enterprise/T1003.005.yml
T1003.005: Cached Domain Credentials,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0006: Credential Access,n; o; n; e,13,Has a credential dumping indicator been followed by anomalous network authentication activity from the same host?,"This question correlates multiple stages of an attack to increase detection confidence. It looks for a confirmed credential dumping indicator (like LSASS access) followed within a short time window (e.g., 60 minutes) by suspicious lateral movement, such as the same host suddenly authenticating to an unusual number of other internal systems.","Windows Event ID 4688; Sysmon Event ID 10; Windows Event ID 4624; Windows Event ID 4625; Zeek conn.log; Zeek dce_rpc.log; Enterprise-wide network traffic gateways, Authentication logs on all servers, Process execution logs on all endpoints",last 90 days,": Create a stateful rule. Trigger: LSASS access or suspicious command alert on a host. Condition: Within 60 minutes, the same host originates network logons (Logon Type 3) to >5 distinct internal hosts for the first time in 7 days. Action: Escalate to incident.",playbooks/attack/enterprise/T1003.005.yml
T1003.005: Cached Domain Credentials,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0006: Credential Access,n; o; n; e,14,"Following a credential dumping alert, did the host exhibit a statistically significant increase in network connections?","This question statistically validates suspected lateral movement after a credential dumping event. It compares the host's network behavior in the hour after the alert to its historical baseline. If the number of distinct destination IPs or ports exceeds a high percentile (e.g., 99th), it strongly suggests the stolen credentials are being used for network reconnaissance or movement.","Windows Event ID 4688; Sysmon Event ID 10; Windows Event ID 4624; Windows Event ID 4625; Zeek conn.log; Zeek dce_rpc.log; Enterprise-wide network traffic gateways, Authentication logs on all servers, Process execution logs on all endpoints",last 90 days,": Following a credential dumping alert on a host, analyze its subsequent network connections. If the host exceeds its historical 99th percentile of distinct destination IPs/ports per hour, flag for anomalous lateral movement.",playbooks/attack/enterprise/T1003.005.yml
T1003.005: Cached Domain Credentials,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0006: Credential Access,n; o; n; e,15,Can a sequence of security events be modeled to identify a likely transition from credential dumping to lateral movement?,"This question uses a Hidden Markov Model (HMM) to understand the sequence of attacker behaviors. The model is trained on event sequences to learn the probability of transitioning between states like 'Benign', 'Credential Dumping', and 'Lateral Movement'. An observed sequence of events that shows a high probability of this specific malicious transition path generates a high-confidence alert.","Windows Event ID 4688; Sysmon Event ID 10; Windows Event ID 4624; Windows Event ID 4625; Zeek conn.log; Zeek dce_rpc.log; Enterprise-wide network traffic gateways, Authentication logs on all servers, Process execution logs on all endpoints",last 90 days,": Use a Hidden Markov Model with states 'Benign', 'Credential Dumping', 'Lateral Movement'. Train on sequences of security events. An observed sequence with a high probability of 'Credential Dumping' -> 'Lateral Movement' transition generates an alert.",playbooks/attack/enterprise/T1003.005.yml
T1003.005: Cached Domain Credentials,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0006: Credential Access,n; o; n; e,16,Has a non-standard user or process accessed Linux credential cache files?,"This question looks for direct access to sensitive credential files on Linux systems integrated with Active Directory, such as SSSD or Quest/VAS caches. It uses signature-based rules to monitor for read access to these files by any user other than 'root' or the service account, or for the use of specific tools like 'tdbdump' against these files.",Auditd logs; Sysmon for Linux Event ID 1; bash_history; Linux servers and workstations integrated with Active Directory via SSSD or Quest/VAS.,last 90 days,": Monitor read access to '/var/lib/sss/db/cache_*.ldb' or '/var/opt/quest/vas/authcache/vas_auth.vdb'. Alert if accessing user is not 'root' or 'sssd'. Also, search command lines for 'tdbdump' on these paths.",playbooks/attack/enterprise/T1003.005.yml
T1003.005: Cached Domain Credentials,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0006: Credential Access,n; o; n; e,17,Has a rare process or command been used to access Linux credential cache files?,"This question identifies anomalous access to Linux credential caches by baselining the processes that normally interact with them. Any access from a process not on the baseline is suspicious. Furthermore, analyzing the command-line arguments for rarity can help detect novel or obfuscated tools being used for this purpose.",Auditd logs; Sysmon for Linux Event ID 1; bash_history; Linux servers and workstations integrated with Active Directory via SSSD or Quest/VAS.,last 90 days,": Baseline all processes that access credential cache file paths. Alert on any access from a process not in the baseline. Also, flag any command-line arguments seen for the first time accessing these files.",playbooks/attack/enterprise/T1003.005.yml
T1003.005: Cached Domain Credentials,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0006: Credential Access,n; o; n; e,18,Can a machine learning model classify access to Linux credential cache files as benign or malicious?,"This question uses a supervised classification model to distinguish between legitimate administrative access and malicious access to sensitive Linux credential files. By training on features like the user, their privileges, the process name, and time of day, the model can learn to identify suspicious access patterns that deviate from normal administrative behavior.",Auditd logs; Sysmon for Linux Event ID 1; bash_history; Linux servers and workstations integrated with Active Directory via SSSD or Quest/VAS.,last 90 days,": Train a classification model (e.g., Logistic Regression) on file access events. Use features like user name, privileges, process name, and parent process. Classify new events as benign or malicious.",playbooks/attack/enterprise/T1003.005.yml
T1020: Automated Exfiltration,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,1,"Have any internal hosts connected to external IP addresses or domains known to be associated with C2, exfiltration, or malware?","This question aims to detect direct communication with known malicious infrastructure. By joining network connection and DNS logs with threat intelligence feeds, we can identify hosts that are potentially compromised or actively exfiltrating data to adversary-controlled systems.",Zeek conn.log; Zeek dns.log; Internet Egress Points; Internal DNS Resolvers; Web Proxies; Threat Intelligence Feed,Last 90 days,"SEARCH network_logs JOIN dns_logs JOIN threat_intel WHERE indicator_category IN ('C2', 'Exfiltration', 'Malware')",playbooks/attack/enterprise/T1020.yml
T1020: Automated Exfiltration,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,2,Are there any unusually large outbound data transfers to low-reputation or suspicious domains?,"This question seeks to identify potential data exfiltration to destinations that are not yet on a threat intelligence list but exhibit suspicious characteristics (e.g., newly registered). By baselining normal traffic volumes to these categories, we can flag anomalous transfers that might represent exfiltration.",Zeek conn.log; Zeek dns.log; Internet Egress Points; Internal DNS Resolvers; Web Proxies,Last 90 days,"SEARCH network_logs WHERE destination_category IN ('Low Reputation', 'Dynamic DNS', 'Newly Registered') | CALCULATE total_bytes_out | ALERT IF total_bytes_out > 95th_percentile_for_category",playbooks/attack/enterprise/T1020.yml
T1020: Automated Exfiltration,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,3,Can we predictively identify network connections that are likely associated with data exfiltration based on their characteristics?,"This question uses a supervised machine learning model to proactively classify outbound network connections. By training a model on features like destination reputation, port, protocol, and data volume, it can learn the patterns of malicious exfiltration and identify new, previously unseen activity with high confidence.",Zeek conn.log; Zeek dns.log; Internet Egress Points; Internal DNS Resolvers; Web Proxies,Last 90 days,"CLASSIFY network_connections USING trained_exfil_model | FEATURES: dest_ip_rep, dest_port, protocol, duration, bytes_sent, bytes_received, state | ALERT IF classification == 'potential exfiltration' AND confidence > high_threshold",playbooks/attack/enterprise/T1020.yml
T1020: Automated Exfiltration,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,4,Are there any DNS queries or HTTP requests that match the signatures of known data exfiltration or tunneling tools?,"This question looks for specific, known-bad patterns associated with tools like Iodine, DNSCat2, or Cobalt Strike. Matching these signatures in DNS or HTTP traffic provides a strong indication that an adversary is using a specific tool to exfiltrate data.",Zeek dns.log; Zeek http.log; Internal DNS Resolvers; Web Proxies; Application Servers,Last 90 days,"SEARCH dns_logs, http_logs FOR regex_patterns IN (known_exfil_tool_signatures)",playbooks/attack/enterprise/T1020.yml
T1020: Automated Exfiltration,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,5,Are there any DNS queries with unusually high entropy or HTTP POST requests with high-entropy content?,"This question identifies attempts to conceal exfiltrated data within DNS queries (DNS tunneling) or HTTP requests. High entropy (randomness) often indicates that data has been encoded or encrypted. By baselining normal entropy levels, we can detect outliers that suggest hidden data channels.",Zeek dns.log; Zeek http.log; Internal DNS Resolvers; Web Proxies; Application Servers,Last 90 days,SEARCH dns_logs | CALCULATE entropy(query_name) | ALERT IF entropy > 4.5; SEARCH http_post_logs | CALCULATE entropy(request_body) | ALERT IF entropy > 99th_percentile,playbooks/attack/enterprise/T1020.yml
T1020: Automated Exfiltration,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,6,Can we identify clusters of anomalous DNS queries that may indicate DNS tunneling activity?,"This question uses unsupervised machine learning to find groups of DNS queries that behave differently from the norm. By clustering queries based on features like length, entropy, and character distribution, we can isolate suspicious clusters that might represent a DNS tunneling C2 channel without relying on pre-existing signatures.",Zeek dns.log; Internal DNS Resolvers; Web Proxies; Application Servers,Last 90 days,"CLUSTER dns_queries USING DBSCAN | FEATURES: query_length, query_entropy, char_frequency, query_type | INVESTIGATE outlier_clusters",playbooks/attack/enterprise/T1020.yml
T1020: Automated Exfiltration,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,7,"Has a known archiving tool been used to compress sensitive directories, followed immediately by a large data transfer from the same host?",This question correlates two distinct events to detect a classic 'smash and grab' exfiltration pattern. The adversary stages data by compressing it and then sends the archive out. Correlating the process creation with the subsequent large network transfer provides high-fidelity evidence of this specific tactic.,Windows Event ID 4688; Zeek conn.log; User Workstations; File Servers; Domain Controllers; Application Servers,Last 90 days,"CORRELATE process_events (process IN [7z.exe, rar.exe] AND command_line CONTAINS sensitive_dirs) WITH network_logs (orig_bytes > 50MB) FROM same_host WITHIN 15 minutes",playbooks/attack/enterprise/T1020.yml
T1020: Automated Exfiltration,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,8,Did a host's outbound traffic volume significantly deviate from its normal baseline shortly after an archiving tool was run?,"This question looks for anomalous outbound traffic spikes that are temporally linked to data staging activities. By establishing a normal traffic baseline for each host, a significant deviation (e.g., 3 standard deviations) following the use of an archiver strongly suggests the exfiltration of the newly created archive.",Windows Event ID 4688; Zeek conn.log; User Workstations; File Servers; Domain Controllers; Application Servers,Last 90 days,SEARCH process_events FOR archiver_process | MONITOR subsequent_network_traffic FROM same_host | ALERT IF outbound_volume > (daily_avg_baseline + 3 * std_dev) in next hour,playbooks/attack/enterprise/T1020.yml
T1020: Automated Exfiltration,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,9,Can a time-series model detect network traffic anomalies that are conditioned by preceding data archiving events?,"This question uses a sophisticated anomaly detection model (LSTM autoencoder) that understands a host's normal network traffic patterns over time. By feeding archival process events into the model, it can specifically look for traffic anomalies that occur right after staging, providing a more intelligent and context-aware detection method than simple statistical thresholds.",Windows Event ID 4688; Zeek conn.log; User Workstations; File Servers; Domain Controllers; Application Servers,Last 90 days,DETECT anomaly IN network_traffic_timeseries USING LSTM_autoencoder | INPUT archiver_process_events as exogenous_variable | ALERT on high reconstruction_error post-event,playbooks/attack/enterprise/T1020.yml
T1020: Automated Exfiltration,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,10,Has a scripting host like PowerShell or CScript been observed accessing an unusually large number of sensitive file types in a short period?,"This question targets a common data staging technique where adversaries use built-in scripting engines to rapidly collect sensitive files. Alerting on a single script process accessing over 100 documents, spreadsheets, or database files within a minute is a strong indicator of malicious collection activity.",Windows Event ID 4663; Windows Event ID 4688; Sensitive Data Repositories; User Workstations; Source Code Repositories; File Servers,Last 90 days,"SEARCH process_events (process IN [powershell.exe, cscript.exe]) | CORRELATE WITH file_access_events (file_extension IN ['.docx', '.pdf']) FROM same_process_id | ALERT IF file_count > 100 within 1 minute",playbooks/attack/enterprise/T1020.yml
T1020: Automated Exfiltration,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,11,Has any process accessed a number of files or a variety of file types that is statistically anomalous compared to its own historical behavior?,"This question establishes a behavioral baseline for every process on a host. It detects when a process, even a legitimate one, is used in an abnormal way, such as a web server process suddenly reading thousands of user documents. Alerting on deviations from the norm for both file count and file type variety helps catch compromised processes being used for data staging.",Windows Event ID 4663; Windows Event ID 4688; Sensitive Data Repositories; User Workstations; Source Code Repositories; File Servers,Last 90 days,BASELINE file_access_count AND file_extension_entropy per process | SEARCH file_access_events | ALERT IF access_count > 99th_percentile OR extension_entropy > 99th_percentile for that process,playbooks/attack/enterprise/T1020.yml
T1020: Automated Exfiltration,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,12,Can we identify anomalous process behaviors indicative of data staging using an unsupervised model?,"This question uses an Isolation Forest model to create a holistic profile of normal process behavior, including parent process, command line arguments, and file access patterns. This allows it to flag complex anomalies that might not trigger simple statistical thresholds, such as a legitimate process spawned with unusual arguments that begins accessing files in a strange pattern.",Windows Event ID 4663; Windows Event ID 4688; Sensitive Data Repositories; User Workstations; Source Code Repositories; File Servers,Last 90 days,"DETECT outliers IN process_behavior USING IsolationForest | FEATURES: parent_process, cmd_line_args, file_access_count, accessed_dirs | INVESTIGATE outliers for staging",playbooks/attack/enterprise/T1020.yml
T1020: Automated Exfiltration,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,13,"Has a known malicious script been executed across multiple hosts, followed by those hosts communicating with a common external destination?","This question looks for evidence of a widespread, automated exfiltration campaign using a specific tool or script. Identifying the same malicious file hash executing on many machines, which then all 'phone home' to the same IP address, is a clear sign of a coordinated attack.",Windows Event ID 4663; Windows Event ID 4688; Zeek conn.log; Entire Workstation Subnet; Server Farm; Internet Egress Points; Domain Controllers,Last 90 days,"SEARCH process_events FOR script_hash on > 5 hosts within 10 mins | IF found, QUERY network_logs for common_external_destination FROM those hosts",playbooks/attack/enterprise/T1020.yml
T1020: Automated Exfiltration,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,14,"Have an anomalous number of hosts within the same group begun accessing sensitive shares concurrently, followed by a traffic spike from that group to a single external IP?","This question detects coordinated internal data access, which may precede exfiltration. By baselining concurrent activity for a group of hosts (e.g., a subnet), a sudden spike in hosts accessing a file share, correlated with a new, shared external destination for their traffic, can uncover a distributed exfiltration effort.",Windows Event ID 4663; Windows Event ID 4688; Zeek conn.log; Entire Workstation Subnet; Server Farm; Internet Egress Points; Domain Controllers,Last 90 days,MONITOR concurrent_hosts_accessing_shares per group | ALERT IF count > (hourly_baseline + 3 * std_dev) | CORRELATE with concurrent_traffic_spike FROM same_group to single_external_IP,playbooks/attack/enterprise/T1020.yml
T1020: Automated Exfiltration,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,15,"Does graph analysis reveal a sudden convergence of multiple internal hosts connecting to a single, new external destination?","This question models the network as a graph to identify coordinated exfiltration. A sudden change in the graph structure, where many previously unrelated internal hosts all form connections to a single new external destination in a short time, creates a 'star' or 'hub-and-spoke' pattern that is highly indicative of a synchronized exfiltration event.",Windows Event ID 4663; Windows Event ID 4688; Zeek conn.log; Entire Workstation Subnet; Server Farm; Internet Egress Points; Domain Controllers,Last 90 days,"MODEL network as graph(nodes=[internal_IPs, external_IPs], edges=[connections]) | DETECT anomaly where many internal_nodes create new edges to single external_node in short time_window",playbooks/attack/enterprise/T1020.yml
T1021.002: SMB-Windows Admin Shares,c1a2e3f4-b5d6-4c7e-8f9a-0b1c2d3e4f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0008: Lateral Movement,n; o; n; e,1,Has a known-malicious file been transferred to a Windows administrative share and subsequently executed?,"This question aims to detect a common lateral movement pattern where an attacker copies a malicious tool to a hidden administrative share (like C$ or ADMIN$) and then runs it on the target system. Correlating a file write to an admin share with a known-bad file hash and a subsequent process creation provides a high-confidence indicator of compromise. The 5-minute window is critical for linking these events as part of a single, coordinated action.","Zeek smb_files.log; Zeek files.log; Windows Event ID 4688; Windows Event ID 5145; Asset Inventory for NAI: Domain Controllers, File Servers, Database Servers, Developer Workstations, Executive Laptops",Last 90 days,"Pseudocode: Correlate WinEvent 5145 (ShareName ends with '$') with Zeek smb_files.log (write to same host), join with threat intel on file hash, and link to WinEvent 4688 (process creation of same file) within 5 minutes.",playbooks/attack/enterprise/T1021.002.yml
T1021.002: SMB-Windows Admin Shares,c1a2e3f4-b5d6-4c7e-8f9a-0b1c2d3e4f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0008: Lateral Movement,n; o; n; e,2,"Have any executables transferred to administrative shares shown unusually high entropy, suggesting packing or encryption?",Attackers often pack or encrypt their malware to evade signature-based detection. This process typically increases the file's entropy (randomness). This question focuses on identifying executable files transferred over admin shares that have statistically anomalous entropy compared to a baseline of legitimate software. A high-entropy executable that is subsequently run is a strong signal of potentially malicious activity.,"Zeek smb_files.log; Zeek files.log; Windows Event ID 4688; Windows Event ID 5145; Asset Inventory for NAI: Domain Controllers, File Servers, Database Servers, Developer Workstations, Executive Laptops",Last 90 days,"Pseudocode: For each file in smb_files.log transferred to admin share, calculate entropy. Compare entropy to 98th percentile of historical baseline. Alert if higher. Increase severity if WinEvent 4688 shows execution.",playbooks/attack/enterprise/T1021.002.yml
T1021.002: SMB-Windows Admin Shares,c1a2e3f4-b5d6-4c7e-8f9a-0b1c2d3e4f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0008: Lateral Movement,n; o; n; e,3,Can we identify malicious file transfers to administrative shares using a machine learning model based on file and transfer characteristics?,"This question proposes a machine learning approach to move beyond simple rules and detect more nuanced malicious behavior. By training a model on various features like file entropy, PE header characteristics, user roles, and network context, we can assign a 'malice probability' to each file transfer. This allows for the detection of previously unseen malware and reduces reliance on static indicators, alerting on transfers that a model deems highly likely to be malicious.","Zeek smb_files.log; Zeek files.log; Windows Event ID 4688; Windows Event ID 5145; Asset Inventory for NAI: Domain Controllers, File Servers, Database Servers, Developer Workstations, Executive Laptops",Last 90 days,"Pseudocode: For each admin share file transfer, extract features (entropy, PE header, size, IP rep, etc.). Input features into trained classification model. Alert if malicious probability > 0.85.",playbooks/attack/enterprise/T1021.002.yml
T1021.002: SMB-Windows Admin Shares,c1a2e3f4-b5d6-4c7e-8f9a-0b1c2d3e4f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0008: Lateral Movement,n; o; n; e,4,Has a remote network logon been immediately followed by the creation of a service or named pipe associated with known lateral movement tools?,"This question targets the signature behavior of tools like PsExec and Cobalt Strike, which authenticate to a remote host and then create a service or named pipe to execute commands. Correlating a network logon (Type 3) with the creation of a service or pipe whose name matches known malicious patterns (e.g., 'PSEXESVC') within a short timeframe is a high-fidelity indicator of an attacker moving laterally.","Windows Event ID 7045; Sysmon Event ID 17; Sysmon Event ID 18; Windows Event ID 4624; Asset Inventory for NAI: Domain Controllers, File Servers, Critical Application Servers, Privileged User Workstations",Last 90 days,Pseudocode: Correlate WinEvent 4624 (Logon Type 3) with WinEvent 7045 or Sysmon 17 on same host within 5 mins. Alert if ServiceName/PipeName matches regex list of malicious tools.,playbooks/attack/enterprise/T1021.002.yml
T1021.002: SMB-Windows Admin Shares,c1a2e3f4-b5d6-4c7e-8f9a-0b1c2d3e4f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0008: Lateral Movement,n; o; n; e,5,Are there newly created services or named pipes with statistically unusual or rare names?,"Attackers often use randomly generated names for their services and named pipes to avoid static signature-based detection. This question uses a statistical approach (n-gram analysis) to identify names that do not conform to the established patterns of legitimate names in the environment. A name with a very low probability score is anomalous and warrants investigation, especially if created remotely by a non-standard account.","Windows Event ID 7045; Sysmon Event ID 17; Sysmon Event ID 18; Windows Event ID 4624; Asset Inventory for NAI: Domain Controllers, File Servers, Critical Application Servers, Privileged User Workstations",Last 90 days,Pseudocode: Build trigram frequency model on historical ServiceNames/PipeNames. Score each new name. Alert if score is below 5th percentile. Prioritize if user is non-standard admin.,playbooks/attack/enterprise/T1021.002.yml
T1021.002: SMB-Windows Admin Shares,c1a2e3f4-b5d6-4c7e-8f9a-0b1c2d3e4f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0008: Lateral Movement,n; o; n; e,6,Can we detect anomalous service or named pipe creation events by identifying outliers in multi-dimensional feature space?,"This question leverages unsupervised machine learning to find outliers without pre-existing labels. By converting each service or named pipe creation event into a set of numerical features (name length, entropy, user rarity, etc.), we can use clustering algorithms like DBSCAN to group 'normal' events. Any event that does not fit into a cluster (i.e., an outlier or 'noise') is, by definition, statistically unique and should be investigated as potentially malicious.","Windows Event ID 7045; Sysmon Event ID 17; Sysmon Event ID 18; Windows Event ID 4624; Asset Inventory for NAI: Domain Controllers, File Servers, Critical Application Servers, Privileged User Workstations",Last 90 days,"Pseudocode: Vectorize service/pipe creation events using features (name length, entropy, user rarity). Apply clustering algorithm (e.g., DBSCAN). Alert on events classified as outliers/noise.",playbooks/attack/enterprise/T1021.002.yml
T1021.002: SMB-Windows Admin Shares,c1a2e3f4-b5d6-4c7e-8f9a-0b1c2d3e4f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0008: Lateral Movement,n; o; n; e,7,"Has there been any administrative share access between two workstations, or by a non-privileged user account?","Access to administrative shares is typically performed by administrators from specific management servers to other servers. Access between two end-user workstations (workstation-to-workstation) is highly unusual and a common indicator of lateral movement. Similarly, a standard user account accessing an admin share is a significant red flag. This question seeks to identify these explicit policy violations, which are often precursors to further attacks.","Windows Event ID 4624; Windows Event ID 5145; Zeek conn.log; Asset Inventory for NAI: All Windows Servers, All Windows Workstations, Network East-West traffic monitoring points, VPN Concentrators",Last 90 days,"Pseudocode: Alert on WinEvent 5145 where ShareName ends in '$' AND source/dest are both 'workstations' in asset db, OR where user is not a privileged admin.",playbooks/attack/enterprise/T1021.002.yml
T1021.002: SMB-Windows Admin Shares,c1a2e3f4-b5d6-4c7e-8f9a-0b1c2d3e4f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0008: Lateral Movement,n; o; n; e,8,"Has any user, from a specific source, accessed an administrative share on a destination host for the first time, or has a single source accessed an unusually high number of hosts via admin shares?","This question aims to detect two types of anomalous behavior. First, it identifies 'first-time' access patterns (a user/source/destination combination never seen before), which could indicate an attacker using a compromised account to explore the network. Second, it detects 'fan-out' activity, where a single compromised host is used to access many other hosts in a short period, which is a classic sign of an automated lateral movement script or tool.","Windows Event ID 4624; Windows Event ID 5145; Zeek conn.log; Asset Inventory for NAI: All Windows Servers, All Windows Workstations, Network East-West traffic monitoring points, VPN Concentrators",Last 90 days,"Pseudocode: For each admin share access (WinEvent 5145), check if (user, source, dest) triplet exists in 90-day baseline. Alert if new. Separately, count distinct destinations per source per hour. Alert if count > 99th percentile of baseline.",playbooks/attack/enterprise/T1021.002.yml
T1021.002: SMB-Windows Admin Shares,c1a2e3f4-b5d6-4c7e-8f9a-0b1c2d3e4f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0008: Lateral Movement,n; o; n; e,9,"Is there a statistically significant spike in the number of new, first-time administrative share connections across the network?","This question models the network's administrative access patterns as a graph and looks for macro-level changes. A widespread lateral movement campaign will create many new connections (edges) in this graph as the attacker moves between systems. By using a time-series forecasting model, we can predict the 'normal' rate of new connections and alert when the actual number significantly exceeds this forecast, indicating a potential large-scale intrusion.","Windows Event ID 4624; Windows Event ID 5145; Zeek conn.log; Asset Inventory for NAI: All Windows Servers, All Windows Workstations, Network East-West traffic monitoring points, VPN Concentrators",Last 90 days,"Pseudocode: Model daily count of new (user, source, dest) admin access triplets using time-series forecast (e.g., ARIMA). Alert if actual daily count exceeds the model's upper confidence interval.",playbooks/attack/enterprise/T1021.002.yml
T1021.002: SMB-Windows Admin Shares,c1a2e3f4-b5d6-4c7e-8f9a-0b1c2d3e4f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0008: Lateral Movement,n; o; n; e,10,"Has the full behavioral sequence of remote logon, admin share access, file write, and process execution been observed from a single source to a single destination?","This question seeks to identify the entire attack chain for remote code execution via SMB admin shares. By correlating these four distinct events in a strict sequence and timeframe, we can create a very high-confidence alert. This stateful analysis moves beyond individual indicators to recognize the complete, multi-stage behavior, significantly reducing false positives and pinpointing active lateral movement.","Windows Event ID 4624; Windows Event ID 5145; Zeek smb_files.log; Windows Event ID 4688; Asset Inventory for NAI: Internal network segments, East-West traffic monitoring points, Domain Controllers, Critical Servers",Last 90 days,"Pseudocode: Correlate sequence from same source/user to same dest within 2 mins: 1) WinEvent 4624 (Logon 3), 2) WinEvent 5145 (Share ends in '$'), 3) Zeek smb_files write, 4) WinEvent 4688 (exec of written file). Alert on full sequence match.",playbooks/attack/enterprise/T1021.002.yml
T1021.002: SMB-Windows Admin Shares,c1a2e3f4-b5d6-4c7e-8f9a-0b1c2d3e4f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0008: Lateral Movement,n; o; n; e,11,Can we risk-score the sequence of an SMB file write followed by execution based on contextual factors?,"Not all remote file-write-and-execute sequences are malicious; some legitimate admin tools may use this pattern. This question introduces a risk-scoring system to prioritize the most suspicious sequences. By adding points for high-risk attributes—such as executable file types, writing to temporary directories, workstation-to-workstation traffic, and off-hours activity—we can focus analyst attention on events that accumulate a high risk score, tuning out more benign administrative behavior.","Windows Event ID 4624; Windows Event ID 5145; Zeek smb_files.log; Windows Event ID 4688; Asset Inventory for NAI: Internal network segments, East-West traffic monitoring points, Domain Controllers, Critical Servers",Last 90 days,"Pseudocode: For each [SMB Write -> Execute] sequence, calculate risk score. Add points for filetype, write location, WKS-to-WKS, off-hours. Alert if total score > 25.",playbooks/attack/enterprise/T1021.002.yml
T1021.002: SMB-Windows Admin Shares,c1a2e3f4-b5d6-4c7e-8f9a-0b1c2d3e4f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0008: Lateral Movement,n; o; n; e,12,Can a sequence-aware machine learning model identify user sessions that exhibit patterns consistent with lateral movement?,"This question proposes an advanced analytical method using models like RNNs or HMMs, which are specifically designed to understand sequences. By training on labeled benign and malicious user sessions, the model learns the typical 'grammar' of user actions. It can then analyze new, unseen sessions in real-time and flag those whose sequence of events (logon, file access, process creation, etc.) is highly probable to be malicious, allowing for the detection of novel or complex attack patterns.","Windows Event ID 4624; Windows Event ID 5145; Zeek smb_files.log; Windows Event ID 4688; Asset Inventory for NAI: Internal network segments, East-West traffic monitoring points, Domain Controllers, Critical Servers",Last 90 days,"Pseudocode: Feed user session event sequences (logon, file access, etc.) into a trained sequence model (e.g., RNN). Alert if the model classifies the sequence probability as 'malicious' or 'lateral movement'.",playbooks/attack/enterprise/T1021.002.yml
T1021.007: Cloud Services,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0008: Lateral Movement,n; o; n; e,1,Has a known compromised host authenticated to the network and immediately connected to a cloud service provider?,"This question aims to detect the initial pivot from a compromised on-premises system to the cloud. An adversary, having gained a foothold on a host, may use its credentials to access cloud resources. Correlating a network authentication from a watchlisted (compromised) IP with a subsequent, quick connection to a cloud provider is a strong indicator of this lateral movement technique.",Windows Event ID 4624; Zeek conn.log; Domain Controllers; ADFS Servers; Network Egress Points; Endpoint devices,Last 90 days,"SEARCH Windows Event ID 4624 (Logon Type 3) AND source_ip IN watchlist | JOIN source_ip, time (within 5 mins) with (SEARCH Zeek conn.log WHERE dest_ip IN cloud_provider_ranges) | RETURN user, source_ip, dest_ip, timestamp",playbooks/attack/enterprise/T1021.007.yml
T1021.007: Cloud Services,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0008: Lateral Movement,n; o; n; e,2,Has a user authenticated from an IP address that is historically rare for them and then immediately connected to a cloud service?,"This question identifies anomalous user behavior that could indicate account compromise or session hijacking. Adversaries may use stolen credentials from locations unfamiliar to the user. By baselining normal authentication sources for each user, we can flag logins from rare IPs, especially when they are immediately followed by cloud activity, as suspicious.",Windows Event ID 4624; Zeek conn.log; Domain Controllers; ADFS Servers; Network Egress Points; Endpoint devices,Last 90 days,"FOR each user, BASELINE source_ips from Windows Event ID 4624 over 90 days | SEARCH Windows Event ID 4624 (Logon Type 3) WHERE source_ip_rarity < 1st_percentile_for_user | JOIN user, time (within 5 mins) with (SEARCH Zeek conn.log WHERE dest_ip IN cloud_provider_ranges) | ALERT on match",playbooks/attack/enterprise/T1021.007.yml
T1021.007: Cloud Services,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0008: Lateral Movement,n; o; n; e,3,Does a machine learning model classify a combined on-premises authentication and subsequent cloud connection event as suspicious?,"This leverages machine learning to detect complex, non-obvious patterns of malicious activity. By training a model on various features like geolocation, time, and destination service from both authentication and network logs, we can identify events that, while not violating a simple rule, collectively appear suspicious based on historical data. This is useful for finding novel or evasive attack patterns.",Windows Event ID 4624; Zeek conn.log; Domain Controllers; ADFS Servers; Network Egress Points; Endpoint devices,Last 90 days,"INPUT features (user, source_geo, time_of_day, dest_cloud_service) from joined auth and network logs INTO trained_model | IF model_output == 'suspicious' AND confidence_score > 0.9 | ALERT event_details",playbooks/attack/enterprise/T1021.007.yml
T1021.007: Cloud Services,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0008: Lateral Movement,n; o; n; e,4,Has a cloud command-line tool been executed with command-line arguments indicating high-risk activities like remote execution or credential access?,"Adversaries often use legitimate cloud CLI tools for malicious purposes. This question focuses on detecting the use of these tools with specific commands or arguments that are rarely used in normal administrative tasks but are common in attacks, such as running commands on remote instances, accessing secrets, or modifying resources.",Windows Event ID 4688; User Workstations; Management Servers; CI/CD Pipeline Servers; Developer Endpoints,Last 90 days,"SEARCH Windows Event ID 4688 WHERE process_name IN ('aws.exe', 'az.exe', 'gcloud.cmd', 'Connect-AZAccount', 'Connect-MgGraph') AND command_line CONTAINS ('run-command', 'get-session-token', 'compute ssh', 'Invoke-Command') | RETURN hostname, user, process_name, command_line",playbooks/attack/enterprise/T1021.007.yml
T1021.007: Cloud Services,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0008: Lateral Movement,n; o; n; e,5,Has a cloud command-line tool been executed with an unusually long or complex (high entropy) command line compared to its historical baseline?,"Malicious commands, especially those that are obfuscated or contain embedded scripts/payloads, are often significantly longer or more random-looking (higher entropy) than typical administrative commands. By baselining the normal length and complexity for each CLI tool, we can flag outliers that may represent obfuscated or malicious usage.",Windows Event ID 4688; User Workstations; Management Servers; CI/CD Pipeline Servers; Developer Endpoints,Last 90 days,"FOR each cloud_cli_tool, BASELINE command_line_length and command_line_entropy over 30 days | SEARCH Windows Event ID 4688 | IF command_line_length > 98th_percentile OR command_line_entropy > 98th_percentile for that tool | ALERT process_details",playbooks/attack/enterprise/T1021.007.yml
T1021.007: Cloud Services,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0008: Lateral Movement,n; o; n; e,6,Does a machine learning model classify a specific cloud CLI execution as malicious based on its command-line arguments?,"This question uses a more sophisticated, content-aware approach to analyzing command lines. By converting the command-line arguments into numerical features (TF-IDF vectors), a model can learn the nuanced differences between benign and malicious commands, allowing it to detect threats that don't rely on simple keyword matching or length/entropy anomalies.",Windows Event ID 4688; User Workstations; Management Servers; CI/CD Pipeline Servers; Developer Endpoints,Last 90 days,INPUT TF-IDF_vector of command_line from Windows Event ID 4688 INTO trained_model | IF model_output == 'malicious_execution' | ALERT process_details,playbooks/attack/enterprise/T1021.007.yml
T1021.007: Cloud Services,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0008: Lateral Movement,n; o; n; e,7,Did an internal host perform extensive cloud API enumeration and then attempt to connect to another internal host using a common lateral movement protocol?,"This question aims to detect a specific attack chain: an adversary first uses cloud APIs to discover resources and gather information (enumeration), and then uses that information to pivot to another target within the on-premises network. The sequence of high-volume API calls followed by an internal connection on a high-risk port is a strong indicator of this behavior.",Zeek conn.log; Zeek http.log; Zeek dns.log; Network Egress Points; Internal network segments (East-West traffic); DNS servers,Last 90 days,"SEARCH Zeek http.log for source_ip with >50 unique URIs to cloud_api_hosts within 10 mins | WATCHLIST source_ip for 1 hour | IF watchlisted_ip connects to internal_dest_ip on ports (22, 445, 3389, 5985, 5986) in Zeek conn.log | HIGH_SEVERITY_ALERT",playbooks/attack/enterprise/T1021.007.yml
T1021.007: Cloud Services,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0008: Lateral Movement,n; o; n; e,8,"Has an internal host exhibited a sudden, anomalous spike in the number of unique cloud API endpoints it is contacting?",This question focuses on detecting the reconnaissance phase of an attack. A sudden burst of requests to many different API endpoints from a single host is abnormal and strongly suggests an adversary is enumerating cloud resources. This provides an early warning of potential malicious activity before lateral movement occurs.,Zeek conn.log; Zeek http.log; Zeek dns.log; Network Egress Points; Internal network segments (East-West traffic); DNS servers,Last 90 days,"FOR each source_ip, BASELINE hourly unique_cloud_api_uri_count over 30 days (moving average + std dev) | SEARCH Zeek http.log | IF current_hour_count > (moving_average + 3 * std_dev) | ALERT source_ip, count",playbooks/attack/enterprise/T1021.007.yml
T1021.007: Cloud Services,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0008: Lateral Movement,n; o; n; e,9,Has a host exhibiting outlier behavior in its cloud API access patterns subsequently connected to other internal assets on lateral movement ports?,"This uses unsupervised machine learning (clustering) to find hosts that 'don't fit in' with normal patterns of cloud API access. Instead of just looking at volume, this can identify anomalies across multiple dimensions (e.g., a strange User-Agent accessing a rare set of endpoints). Linking these outlier hosts to subsequent internal lateral movement attempts provides a powerful, data-driven detection method.",Zeek conn.log; Zeek http.log; Zeek dns.log; Network Egress Points; Internal network segments (East-West traffic); DNS servers,Last 90 days,"APPLY DBSCAN to (source_ip, dest_hostname, user_agent) from Zeek http.log in 15-min windows | IDENTIFY outlier source_ips | FOR each outlier_ip, SEARCH Zeek conn.log within next 60 mins for connections to internal_dest_ip on ports (22, 445, 3389, 5985, 5986) | ALERT on match",playbooks/attack/enterprise/T1021.007.yml
T1021.007: Cloud Services,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0008: Lateral Movement,n; o; n; e,10,"After a user authenticated from a brand-new source IP, did an inbound connection from a cloud provider connect to a different internal system?","This detects a potential 'pivot back' from the cloud. The scenario is: an adversary compromises a user's credentials, authenticates from a new location, uses the cloud access to initiate an action (like Run Command), which then results in a connection from the cloud provider's infrastructure back into the on-premises network, but to a different machine (the target).",Windows Event ID 4624; Zeek conn.log; Domain Controllers; ADFS Servers; Bastion Hosts; Network Firewalls/Gateways,Last 90 days,"MAINTAIN lookup of (user, source_ip) from last 90 days of auth logs | ON new auth, IF (user, source_ip) is new, FLAG session for 60 mins | IF inbound connection from cloud_ip_range to internal_ip_B (where internal_ip_B != flagged source_ip) occurs in window | ALERT",playbooks/attack/enterprise/T1021.007.yml
T1021.007: Cloud Services,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0008: Lateral Movement,n; o; n; e,11,"Has a risk score, combining the rarity of a user's authentication source IP with the sensitivity of a target host, exceeded a defined threshold following an inbound connection from a cloud provider?","This question enhances the previous one by adding risk scoring. Instead of a binary 'new/not new' check, it quantifies the rarity of the authentication source. It then combines this with the importance of the target system. This allows for more nuanced alerting, focusing analyst attention on events that pose the greatest potential risk.",Windows Event ID 4624; Zeek conn.log; Domain Controllers; ADFS Servers; Bastion Hosts; Network Firewalls/Gateways,Last 90 days,"ON new auth, CALCULATE rarity_score = (1 / frequency of source_ip for user) | IF inbound connection from cloud_ip to internal_ip_B within 30 mins | GET sensitivity_score for internal_ip_B | CALCULATE final_risk = rarity_score * sensitivity_score | IF final_risk > threshold | ALERT",playbooks/attack/enterprise/T1021.007.yml
T1021.007: Cloud Services,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0008: Lateral Movement,n; o; n; e,12,"Does a graph-based anomaly detection model identify a low-probability path representing a user authenticating from an on-prem host, connecting to the cloud, and the cloud then connecting back to a different on-prem host?","This question models the entire attack chain as a path in a graph database. By representing entities (users, hosts, cloud IPs) as nodes and actions (authentication, connections) as edges, we can use powerful graph algorithms to find anomalous paths that don't conform to normal operational patterns. This is highly effective at visualizing and detecting complex, multi-stage lateral movement.",Windows Event ID 4624; Zeek conn.log; Domain Controllers; ADFS Servers; Bastion Hosts; Network Firewalls/Gateways,Last 90 days,"CONSTRUCT graph with nodes (users, hosts, cloud_ips) and edges (authenticates_from, connects_to) | APPLY graph anomaly detection algorithm | IF path (user -> host_A -> cloud_ip -> host_B) has low probability score | ALERT path_details",playbooks/attack/enterprise/T1021.007.yml
T1021.007: Cloud Services,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0008: Lateral Movement,n; o; n; e,13,"Has a network security configuration change been made in the cloud that opens a sensitive port (e.g., RDP, SSH, WinRM) to the entire internet?",Adversaries who gain access to cloud management consoles may try to create backdoors or expose internal services by modifying firewall or network security group rules. Opening sensitive management ports like SSH or RDP to the world (`0.0.0.0/0`) is a high-risk action and a common misconfiguration that adversaries exploit.,"Cloud provider audit logs (e.g., AWS CloudTrail, Azure Activity Log); Zeek http.log; Cloud audit log aggregation platform; Network Egress Points; Cloud Management Consoles/APIs; Virtual Private Cloud (VPC) Flow Logs",Last 90 days,"SEARCH cloud_audit_logs WHERE event_name IN ('AuthorizeSecurityGroupIngress', 'CreateFirewall') AND source_range == '0.0.0.0/0' AND destination_port IN (22, 3389, 5985, 5986) | ALERT event_details",playbooks/attack/enterprise/T1021.007.yml
T1021.007: Cloud Services,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0008: Lateral Movement,n; o; n; e,14,"Has a user or service principal made an anomalously high number of network security changes, or a type of change they have never made before?","This question seeks to detect unusual behavior by a specific identity. While a single security group change might be legitimate, a flurry of changes by a user who rarely performs them, or a user making a type of change they've never made before, is highly suspicious and could indicate a compromised account.","Cloud provider audit logs (e.g., AWS CloudTrail, Azure Activity Log); Zeek http.log; Cloud audit log aggregation platform; Network Egress Points; Cloud Management Consoles/APIs; Virtual Private Cloud (VPC) Flow Logs",Last 90 days,"FOR each user, BASELINE frequency and type of network_config_changes over 90 days | SEARCH cloud_audit_logs for network_config_change | IF change_count_in_24h > 99th_percentile OR change_type is new for user | ALERT user, change_details",playbooks/attack/enterprise/T1021.007.yml
T1021.007: Cloud Services,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0008: Lateral Movement,n; o; n; e,15,"Does a machine learning model, trained on historical network configuration changes, flag a new change as an anomaly?","This question applies unsupervised machine learning to detect suspicious network changes that may not be caught by simple rules. The model can learn the normal combinations of who makes changes, from where, at what time, and to what resources. Any change that significantly deviates from this learned norm will be flagged as an anomaly for investigation.","Cloud provider audit logs (e.g., AWS CloudTrail, Azure Activity Log); Zeek http.log; Cloud audit log aggregation platform; Network Egress Points; Cloud Management Consoles/APIs; Virtual Private Cloud (VPC) Flow Logs",Last 90 days,"INPUT features (user, source_ASN, time_of_day, change_parameters) from cloud_audit_log into Isolation Forest model | IF model flags event as anomaly | ALERT event_details",playbooks/attack/enterprise/T1021.007.yml
T1021.008: Direct Cloud VM Connections,f8a9b7c6-d5e4-4f3a-2b1c-0d9e8f7a6b5c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0008: Lateral Movement,n; o; n; e,1,"Following a direct VM access event, did the VM connect to a known command-and-control (C2) server?","This question seeks to identify a common adversary pattern where, after gaining access to a cloud virtual machine, they establish a connection to their C2 infrastructure for further command execution or data exfiltration. Correlating a direct access event (like AWS SSM 'StartSession' or Azure 'RunCommand') with an immediate outbound network connection to an IP or domain on a threat intelligence feed provides a high-fidelity indicator of compromise.","AWS CloudTrail; Azure Activity Logs; Windows Event ID 4624; Zeek conn.log; Zeek dns.log; Cloud management plane (e.g., AWS CloudTrail, Azure Activity Logs); Cloud VM instances (e.g., Windows Event Logs); Virtual network traffic sensors (e.g., VPC Flow Logs, Zeek sensors); Egress network gateways",last 90 days,": FIND direct_vm_access_event (e.g., AWS SSM 'StartSession', Azure 'RunCommand') FOR vm_instance. WITHIN 30 minutes, FIND network_flow_event (e.g., Zeek conn.log) WHERE source_ip IS vm_instance.ip AND destination_ip OR destination_domain (from Zeek dns.log) IS IN c2_threat_feed.",playbooks/attack/enterprise/T1021.008.yml
T1021.008: Direct Cloud VM Connections,f8a9b7c6-d5e4-4f3a-2b1c-0d9e8f7a6b5c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0008: Lateral Movement,n; o; n; e,2,"Following a direct VM access event, did the VM exhibit an unusually random pattern of outbound destination ports?","This question aims to detect anomalous network behavior like port scanning or the use of random high-numbered ports for C2 communication, which can deviate from a VM's normal traffic profile. By establishing a baseline of destination port entropy and alerting on significant deviations after a direct access event, we can identify suspicious scanning or communication attempts that might indicate adversary activity.","AWS CloudTrail; Azure Activity Logs; Windows Event ID 4624; Zeek conn.log; Zeek dns.log; Cloud management plane (e.g., AWS CloudTrail, Azure Activity Logs); Cloud VM instances (e.g., Windows Event Logs); Virtual network traffic sensors (e.g., VPC Flow Logs, Zeek sensors); Egress network gateways",last 90 days,": FOR EACH vm_instance: BASELINE destination_port_entropy over 30 days. FIND direct_vm_access_event FOR vm_instance. WITHIN 60 minutes, CALCULATE new_destination_port_entropy. ALERT IF new_entropy > (baseline_mean + 3 * baseline_std_dev).",playbooks/attack/enterprise/T1021.008.yml
T1021.008: Direct Cloud VM Connections,f8a9b7c6-d5e4-4f3a-2b1c-0d9e8f7a6b5c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0008: Lateral Movement,n; o; n; e,3,"Following a direct VM access event, was there an anomalous spike in the volume of outbound data from the VM?","This question focuses on detecting potential data exfiltration. Adversaries often transfer large amounts of stolen data after gaining access. By using a time-series forecasting model to predict normal outbound data volume, we can flag any observed volume that significantly exceeds the prediction after a direct access event, which could indicate a data theft in progress.","AWS CloudTrail; Azure Activity Logs; Windows Event ID 4624; Zeek conn.log; Zeek dns.log; Cloud management plane (e.g., AWS CloudTrail, Azure Activity Logs); Cloud VM instances (e.g., Windows Event Logs); Virtual network traffic sensors (e.g., VPC Flow Logs, Zeek sensors); Egress network gateways",last 90 days,": FOR EACH vm_instance: TRAIN time-series model on hourly outbound_bytes. FIND direct_vm_access_event FOR vm_instance. FOR each subsequent hour, OBSERVE actual_outbound_bytes. ALERT IF actual_outbound_bytes > model_predicted_upper_bound.",playbooks/attack/enterprise/T1021.008.yml
T1021.008: Direct Cloud VM Connections,f8a9b7c6-d5e4-4f3a-2b1c-0d9e8f7a6b5c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0008: Lateral Movement,n; o; n; e,4,"Following a direct VM access event, were any known malicious tools or suspicious commands executed on the VM?","This question tries to identify the execution of post-exploitation tools or reconnaissance commands immediately after an adversary gains access. Correlating a direct login with the creation of a process matching a watchlist of malicious signatures (e.g., 'mimikatz.exe', 'powershell -enc') is a strong indicator that the access is being used for malicious purposes.","Windows Event ID 4688; Windows Event ID 4624; AWS CloudTrail; Azure Activity Logs; Cloud VM instance event logs (e.g., Windows Event Log, Linux auditd); Cloud management plane logs; EDR agent logs",last 90 days,": FIND direct_vm_access_event FOR vm_instance. WITHIN 60 minutes, FIND process_creation_event (e.g., WinEvent 4688) ON vm_instance WHERE process_name OR command_line MATCHES malicious_watchlist.",playbooks/attack/enterprise/T1021.008.yml
T1021.008: Direct Cloud VM Connections,f8a9b7c6-d5e4-4f3a-2b1c-0d9e8f7a6b5c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0008: Lateral Movement,n; o; n; e,5,"Following a direct VM access event, were any commands executed with unusually high complexity or obfuscation?","Adversaries often use obfuscation (e.g., Base64 encoding in PowerShell) to hide their commands. This question aims to detect such activity by analyzing the entropy of command-line arguments. A command with unusually high entropy for a common process like 'powershell.exe' after a direct login suggests an attempt to evade detection.","Windows Event ID 4688; Windows Event ID 4624; AWS CloudTrail; Azure Activity Logs; Cloud VM instance event logs (e.g., Windows Event Log, Linux auditd); Cloud management plane logs; EDR agent logs",last 90 days,: FOR EACH process_name: BASELINE command_line_entropy. FIND direct_vm_access_event FOR vm_instance. FIND subsequent process_creation_event ON vm_instance. CALCULATE new_command_line_entropy. ALERT IF new_entropy > 95th_percentile_for_process_name.,playbooks/attack/enterprise/T1021.008.yml
T1021.008: Direct Cloud VM Connections,f8a9b7c6-d5e4-4f3a-2b1c-0d9e8f7a6b5c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0008: Lateral Movement,n; o; n; e,6,"Following a direct VM access event, did a machine learning model classify any executed commands as malicious?","This question leverages a machine learning model trained to recognize malicious command-line patterns. By analyzing features like argument length, special characters, and n-gram frequency, the model can provide a probabilistic score of maliciousness. This approach can detect novel or sophisticated malicious commands that might not be on a static watchlist.","Windows Event ID 4688; Windows Event ID 4624; AWS CloudTrail; Azure Activity Logs; Cloud VM instance event logs (e.g., Windows Event Log, Linux auditd); Cloud management plane logs; EDR agent logs",last 90 days,": TRAIN ML model on command_line_features. FIND direct_vm_access_event FOR vm_instance. FOR each subsequent process_creation_event, FEED command_line to ML model. ALERT IF model_score > 0.9.",playbooks/attack/enterprise/T1021.008.yml
T1021.008: Direct Cloud VM Connections,f8a9b7c6-d5e4-4f3a-2b1c-0d9e8f7a6b5c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0008: Lateral Movement,n; o; n; e,7,Did a direct interactive login to a cloud VM originate from an unexpected or unapproved geographic location?,This question helps identify suspicious logins based on their geographic origin. An interactive login (like RDP) from a country where the organization has no presence or from which users do not typically connect is a strong indicator of a compromised account or an external threat actor.,"Windows Event ID 4624; Windows Event ID 4625; AWS CloudTrail; Azure Activity Logs; Zeek conn.log; Cloud VM instance authentication logs (e.g., Windows Security Log); Cloud management plane logs; Identity and Access Management (IAM) logs; Geolocation databases",last 90 days,": FIND interactive_login_event (e.g., WinEvent 4624, Logon Type 2 or 10) TO cloud_vm. GET source_ip_country. ALERT IF source_ip_country IS NOT IN country_allow_list.",playbooks/attack/enterprise/T1021.008.yml
T1021.008: Direct Cloud VM Connections,f8a9b7c6-d5e4-4f3a-2b1c-0d9e8f7a6b5c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0008: Lateral Movement,n; o; n; e,8,Did a successful login to a cloud VM exhibit multiple behavioral anomalies for that specific user?,"This question aims to detect 'impossible travel' scenarios or other deviations from a user's established behavior. By profiling a user's typical login patterns (source country, ISP, time of day) and scoring new logins against this profile, we can identify events that are highly uncharacteristic for that user, such as logging in from a new country at 3 AM, which might indicate account takeover.","Windows Event ID 4624; Windows Event ID 4625; AWS CloudTrail; Azure Activity Logs; Zeek conn.log; Cloud VM instance authentication logs (e.g., Windows Security Log); Cloud management plane logs; Identity and Access Management (IAM) logs; Geolocation databases",last 90 days,": FOR EACH user: PROFILE historical login behavior (country, ISP, hour). FOR each new login, CALCULATE risk_score based on deviations from profile. ALERT IF risk_score > 98th_percentile_for_user.",playbooks/attack/enterprise/T1021.008.yml
T1021.008: Direct Cloud VM Connections,f8a9b7c6-d5e4-4f3a-2b1c-0d9e8f7a6b5c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0008: Lateral Movement,n; o; n; e,9,Was a successful login to a cloud VM identified as an outlier compared to the organization's overall login patterns?,"This question uses unsupervised machine learning to find logins that don't fit any established pattern of normal activity across the organization. By clustering historical logins based on features like user, geolocation, and time, any new login that falls outside these clusters is considered an anomaly. This can help detect novel attack patterns that don't match a specific user's history but are unusual for the organization as a whole.","Windows Event ID 4624; Windows Event ID 4625; AWS CloudTrail; Azure Activity Logs; Zeek conn.log; Cloud VM instance authentication logs (e.g., Windows Security Log); Cloud management plane logs; Identity and Access Management (IAM) logs; Geolocation databases",last 90 days,": CLUSTER historical login data using DBSCAN on features (user, geo, time). FOR each new login, CHECK if it belongs to an existing cluster. ALERT IF login is an outlier (does not belong to any cluster).",playbooks/attack/enterprise/T1021.008.yml
T1021.008: Direct Cloud VM Connections,f8a9b7c6-d5e4-4f3a-2b1c-0d9e8f7a6b5c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0008: Lateral Movement,n; o; n; e,10,"Following a direct VM access event, did the VM attempt to resolve a domain associated with a dynamic DNS provider?",Adversaries often use dynamic DNS (DDNS) providers to host their C2 infrastructure because it allows them to change IP addresses frequently. This question aims to detect this TTP. A DNS query to a non-allow-listed DDNS service shortly after a direct login is highly suspicious and may indicate an attempt to establish a C2 channel.,"Zeek conn.log; Zeek dns.log; Windows Event ID 5156; Windows Event ID 4624; AWS CloudTrail; Azure Activity Logs; Network sensors capturing VPC/VNet flow data (e.g., Zeek sensors); Egress network gateways; Cloud VM network kernel logs (e.g., Windows Event ID 5156); DNS server logs",last 90 days,": FIND direct_vm_access_event FOR vm_instance. WITHIN 60 minutes, FIND dns_query_event (e.g., Zeek dns.log) FROM vm_instance WHERE queried_domain IS in known_ddns_provider_list AND NOT in organizational_allow_list.",playbooks/attack/enterprise/T1021.008.yml
T1021.008: Direct Cloud VM Connections,f8a9b7c6-d5e4-4f3a-2b1c-0d9e8f7a6b5c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0008: Lateral Movement,n; o; n; e,11,"Following a direct VM access event, did the VM's outbound data transfer exceed its own historical high-water mark?","This question provides a simple but effective method for detecting data exfiltration. By establishing a baseline of the normal peak hourly outbound traffic for each VM, any transfer that exceeds this threshold (e.g., the 99th percentile) after a direct login is a strong anomaly. This is a clear signal that an unusual amount of data is leaving the machine, warranting investigation.","Zeek conn.log; Zeek dns.log; Windows Event ID 5156; Windows Event ID 4624; AWS CloudTrail; Azure Activity Logs; Network sensors capturing VPC/VNet flow data (e.g., Zeek sensors); Egress network gateways; Cloud VM network kernel logs (e.g., Windows Event ID 5156); DNS server logs",last 90 days,": FOR EACH vm_instance: BASELINE 99th_percentile of hourly_outbound_bytes over 30 days. FIND direct_vm_access_event FOR vm_instance. IN subsequent hour, MEASURE total_outbound_bytes. ALERT IF total_outbound_bytes > baseline_99th_percentile.",playbooks/attack/enterprise/T1021.008.yml
T1021.008: Direct Cloud VM Connections,f8a9b7c6-d5e4-4f3a-2b1c-0d9e8f7a6b5c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0008: Lateral Movement,n; o; n; e,12,"Following a direct VM access event, did the VM's overall network profile (e.g., bytes sent, connection count, unique ports) deviate from its normal behavior?","This question uses a more sophisticated, holistic approach to anomaly detection. Instead of looking at a single metric, a multivariate model learns the complex relationships between various network indicators (like traffic volume, connection frequency, port usage). An alert from this model after a direct login indicates that the VM's network activity as a whole is abnormal, which can detect subtle or complex attack patterns that simpler rules might miss.","Zeek conn.log; Zeek dns.log; Windows Event ID 5156; Windows Event ID 4624; AWS CloudTrail; Azure Activity Logs; Network sensors capturing VPC/VNet flow data (e.g., Zeek sensors); Egress network gateways; Cloud VM network kernel logs (e.g., Windows Event ID 5156); DNS server logs",last 90 days,": FOR EACH vm_instance: TRAIN multivariate model on network metrics (bytes, connections, ports). FIND direct_vm_access_event FOR vm_instance. FEED subsequent network metrics to model. ALERT IF model flags behavior as anomalous.",playbooks/attack/enterprise/T1021.008.yml
T1021.008: Direct Cloud VM Connections,f8a9b7c6-d5e4-4f3a-2b1c-0d9e8f7a6b5c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0008: Lateral Movement,n; o; n; e,13,"Following a direct VM access, was there a sequence of discovery commands followed by an attempt to move laterally to another internal system?","This question looks for the classic 'login -> recon -> lateral movement' attack chain. Detecting this specific sequence of events—a direct login, followed by local reconnaissance commands (like 'whoami', 'ipconfig'), and then an attempt to connect to another internal machine on an admin port (like RDP or SSH)—provides extremely strong evidence of an adversary actively moving through the network.",Windows Event ID 4624; Windows Event ID 4688; Windows Event ID 4648; Zeek conn.log; AWS CloudTrail; Azure Activity Logs; Cloud VM instance logs (Security and System); Cloud management plane logs; Network sensors monitoring east-west traffic between internal segments; Domain Controller authentication logs,last 90 days,": WITHIN a 60-minute window on a single vm_instance: FIND direct_vm_access_event, THEN FIND >=2 process_creation_events for discovery_commands, THEN FIND outbound_connection to internal_ip on admin_port (22, 3389, 5985). ALERT on sequence.",playbooks/attack/enterprise/T1021.008.yml
T1021.008: Direct Cloud VM Connections,f8a9b7c6-d5e4-4f3a-2b1c-0d9e8f7a6b5c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0008: Lateral Movement,n; o; n; e,14,"Following a direct VM access, did a user execute an unusually high number of discovery commands compared to their peers?","This question aims to identify excessive reconnaissance activity by comparing a user's actions to a baseline for their role. While an administrator might run a few discovery commands, a long string of them could be suspicious. By flagging users who execute significantly more discovery commands than their peers shortly after logging in, we can pinpoint potential account misuse or adversary activity.",Windows Event ID 4624; Windows Event ID 4688; Windows Event ID 4648; Zeek conn.log; AWS CloudTrail; Azure Activity Logs; Cloud VM instance logs (Security and System); Cloud management plane logs; Network sensors monitoring east-west traffic between internal segments; Domain Controller authentication logs,last 90 days,: FOR EACH user_role: BASELINE count of discovery_commands in first 60 mins of session. FIND direct_vm_access_event for a user. COUNT discovery_commands in next 60 mins. ALERT IF count > 95th_percentile_for_user_role.,playbooks/attack/enterprise/T1021.008.yml
T1021.008: Direct Cloud VM Connections,f8a9b7c6-d5e4-4f3a-2b1c-0d9e8f7a6b5c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0008: Lateral Movement,n; o; n; e,15,"Following a direct VM access, did the sequence of user actions deviate from patterns of normal administrative sessions?","This question uses advanced machine learning to understand the 'grammar' of a normal user session. A model is trained on typical sequences of events (e.g., login -> start service -> edit config). When a new session after a direct login shows an unusual sequence (e.g., login -> run whoami -> run net user -> connect to file share), the model will have a high reconstruction error, flagging it as anomalous. This can detect novel attack paths that don't rely on specific signatures.",Windows Event ID 4624; Windows Event ID 4688; Windows Event ID 4648; Zeek conn.log; AWS CloudTrail; Azure Activity Logs; Cloud VM instance logs (Security and System); Cloud management plane logs; Network sensors monitoring east-west traffic between internal segments; Domain Controller authentication logs,last 90 days,": TRAIN sequence model (e.g., LSTM autoencoder) on normal event sequences. FIND direct_vm_access_event. CAPTURE subsequent event sequence. FEED sequence to model. ALERT IF model reconstruction_error is high.",playbooks/attack/enterprise/T1021.008.yml
T1027.007: Dynamic API Resolution,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,1,Is a process being created from an executable whose hash matches a known indicator for API obfuscation or packing?,"This question uses a high-fidelity symbolic check to identify known malware. By comparing the SHA256 hash of newly created process executables against a threat intelligence feed of hashes known for using packing or dynamic API resolution, analysts can quickly detect documented threats.","Windows Event ID 4688; Sysmon Event ID 1; All Windows endpoints and servers, particularly domain controllers, application servers, and developer workstations.",last 90 days,: SEARCH process_creation_logs | JOIN threat_intel_hashes ON file_hash | WHERE match_found | ALERT,playbooks/attack/enterprise/T1027.007.yml
T1027.007: Dynamic API Resolution,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,2,Is a low-prevalence executable being spawned by a process commonly associated with initial access?,"This question aims to find unknown or novel malware by focusing on rarity. An executable seen on very few hosts is suspicious. When such a rare executable is launched by a common initial access vector like an email client (outlook.exe) or web browser (chrome.exe), it strongly suggests a user was compromised and a malicious payload was executed.","Windows Event ID 4688; Sysmon Event ID 1; All Windows endpoints and servers, particularly domain controllers, application servers, and developer workstations.",last 90 days,": SEARCH process_creation_logs | STATS count(unique hosts) as prevalence by file_hash | WHERE prevalence < threshold AND parent_process in (outlook.exe, winword.exe, chrome.exe) | ALERT",playbooks/attack/enterprise/T1027.007.yml
T1027.007: Dynamic API Resolution,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,3,Does static analysis of a newly observed executable's PE file features classify it as packed or obfuscated?,"This question applies machine learning to detect evasion techniques directly from the file's structure. A model trained on PE file features (like a small IAT size or high section entropy) can identify executables that have been packed or obfuscated to hide their imports, even if the file's hash is not yet known to threat intelligence.","Windows Event ID 4688; Sysmon Event ID 1; All Windows endpoints and servers, particularly domain controllers, application servers, and developer workstations.",last 90 days,": FOR each new_executable_hash | EXTRACT PE_features (IAT_size, entropy) | SCORE with classification_model | WHERE probability(packed) > 0.85 | ALERT",playbooks/attack/enterprise/T1027.007.yml
T1027.007: Dynamic API Resolution,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,4,Is rundll32.exe being used to invoke a DLL function by its ordinal number instead of its name?,"Adversaries call DLL functions by ordinal number (e.g., '#123') to hide the function's purpose, as the number is not descriptive. This symbolic check specifically looks for this pattern in command-line arguments for rundll32.exe, which is a strong indicator of an attempt to obscure malicious activity.","Windows Event ID 4688; Sysmon Event ID 1; All Windows endpoints and servers, focusing on command line logging from user workstations.",last 90 days,": SEARCH process_creation_logs | WHERE process_name == 'rundll32.exe' AND command_line REGEX '.*\.dll,\s*#\d+' | ALERT",playbooks/attack/enterprise/T1027.007.yml
T1027.007: Dynamic API Resolution,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,5,Is a statistically rare rundll32.exe command line that uses an ordinal call being observed in the environment?,"This question identifies anomalous rundll32.exe usage by focusing on rarity. While some legitimate software may use ordinal calls, it is uncommon. By baselining all rundll32.exe command lines and flagging those containing an ordinal call that have been seen on very few hosts, analysts can uncover potentially malicious executions that deviate from the norm.","Windows Event ID 4688; Sysmon Event ID 1; All Windows endpoints and servers, focusing on command line logging from user workstations.",last 90 days,: SEARCH process_creation_logs WHERE process_name == 'rundll32.exe' AND command_line contains '#' | STATS count(unique hosts) as prevalence by command_line | WHERE prevalence < 5 | ALERT,playbooks/attack/enterprise/T1027.007.yml
T1027.007: Dynamic API Resolution,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,6,Is an anomaly detection model flagging a rundll32.exe command line as a significant outlier based on its structure?,"This question uses unsupervised machine learning to find suspicious rundll32.exe commands without predefined rules. By training a model on features like command length and character types from a baseline of normal activity, it can detect new commands that are structurally anomalous, which could indicate obfuscated or malicious intent.","Windows Event ID 4688; Sysmon Event ID 1; All Windows endpoints and servers, focusing on command line logging from user workstations.",last 90 days,: FOR each new_rundll32_command | EXTRACT structural_features | SCORE with anomaly_detection_model | WHERE score is outlier | ALERT,playbooks/attack/enterprise/T1027.007.yml
T1027.007: Dynamic API Resolution,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,7,Is a PE file being written to a temporary or user-writable directory and then quickly executed or loaded by the same process?,"This 'write-then-execute' behavior is a classic malware dropper pattern. An adversary's initial payload writes the next stage to a less-monitored location (like %TEMP% or %APPDATA%) and then immediately executes or loads it. Correlating a file creation event with a subsequent process creation or module load event from the same process within a short time window (e.g., < 60 seconds) is a strong indicator of compromise.","Windows Event ID 4688; Sysmon Event ID 11; Sysmon Event ID 7; User profile directories (%APPDATA%, %LOCALAPPDATA%, Downloads), temporary directories (%TEMP%, C:\Windows\Temp), and public-writable shares.",last 90 days,": JOIN file_create_events, (image_load_events OR process_create_events) ON ProcessGUID, file_path | WHERE event_time_delta < 60s AND file_path in (temp_dirs) | ALERT",playbooks/attack/enterprise/T1027.007.yml
T1027.007: Dynamic API Resolution,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,8,"Is a process exhibiting an unusually fast 'write-then-execute' behavior, or is a specific parent process performing this action more frequently than its baseline?","This question refines 'write-then-execute' detection with statistical analysis. It seeks outliers by identifying processes that execute files exceptionally quickly after writing them (bottom percentile of time deltas) or by flagging parent processes (like winword.exe) that suddenly start performing this behavior far more often than their historical baseline, suggesting they have been compromised.","Windows Event ID 4688; Sysmon Event ID 11; Sysmon Event ID 7; User profile directories (%APPDATA%, %LOCALAPPDATA%, Downloads), temporary directories (%TEMP%, C:\Windows\Temp), and public-writable shares.",last 90 days,: ANALYZE write-then-execute events | ALERT on time_delta in bottom 1st percentile OR parent_process_frequency > 2 * stddev from baseline,playbooks/attack/enterprise/T1027.007.yml
T1027.007: Dynamic API Resolution,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,9,"Does a sequence of events (e.g., network download -> file write -> execution) match a machine learning model trained to identify malicious process behavior chains?","This question uses machine learning to analyze the entire chain of actions for a process. A sequence analysis model can be trained to recognize the typical playbook of a malware infection, such as an inbound network connection followed by a file being created in a temp directory and then immediately loaded or executed. The model can then score new event sequences to determine if they match this malicious pattern.","Windows Event ID 4688; Sysmon Event ID 11; Sysmon Event ID 7; User profile directories (%APPDATA%, %LOCALAPPDATA%, Downloads), temporary directories (%TEMP%, C:\Windows\Temp), and public-writable shares.",last 90 days,: FOR each event_chain by ProcessGuid | SCORE with sequence_analysis_model | WHERE probability(malicious_chain) > threshold | ALERT,playbooks/attack/enterprise/T1027.007.yml
T1027.007: Dynamic API Resolution,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,10,"Is a process performing actions, like making a network connection, for which the necessary functions are not listed in its on-disk executable's Import Address Table (IAT)?","This is a direct method for detecting dynamic API resolution. If a process is observed performing an action (like initiating a network connection via Sysmon Event ID 3) but its executable file on disk does not import the required libraries (like ws2_32.dll), it strongly implies the process resolved those API functions at runtime to evade static analysis.","Windows Event ID 4688; Sysmon Event ID 1; Sysmon Event ID 3; Sysmon Event ID 22; Zeek conn.log; All Windows endpoints and servers, network egress points (for Zeek logs), and malware analysis sandboxes/threat intelligence feeds (for IAT data).",last 90 days,: FOR each process | EXTRACT IAT from on-disk_file | IF process has network_connection AND IAT lacks networking_imports | ALERT,playbooks/attack/enterprise/T1027.007.yml
T1027.007: Dynamic API Resolution,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,11,"Does a process have a high 'Behavior-IAT Mismatch Score,' indicating it performs many actions not declared in its static IAT?","This question quantifies the discrepancy between a process's runtime behavior and its static imports. By creating a 'mismatch score' (e.g., +1 for creating a child process without relevant APIs in IAT, +1 for network activity without network APIs), we can statistically identify processes with the largest gaps. Processes in the 99th percentile are prime candidates for investigation as they are likely using dynamic resolution extensively.","Windows Event ID 4688; Sysmon Event ID 1; Sysmon Event ID 3; Sysmon Event ID 22; Zeek conn.log; All Windows endpoints and servers, network egress points (for Zeek logs), and malware analysis sandboxes/threat intelligence feeds (for IAT data).",last 90 days,: FOR each process | CALCULATE mismatch_score based on (runtime_behaviors vs static_IAT) | FIND processes with scores in 99th percentile | ALERT,playbooks/attack/enterprise/T1027.007.yml
T1027.007: Dynamic API Resolution,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,12,"Does a machine learning model, using both static PE features and runtime behaviors, classify a process as malicious, especially if it has a minimal IAT?",This question uses a powerful hybrid ML approach. A classification model is trained with both static features from the executable (like IAT entries) and aggregated runtime features (like number of network connections). This allows the model to learn that a combination of a very small IAT and high-activity runtime behavior is a strong indicator of evasive malware.,"Windows Event ID 4688; Sysmon Event ID 1; Sysmon Event ID 3; Sysmon Event ID 22; Zeek conn.log; All Windows endpoints and servers, network egress points (for Zeek logs), and malware analysis sandboxes/threat intelligence feeds (for IAT data).",last 90 days,: FOR each process | GATHER static_features (IAT) AND runtime_features (net_conn_count) | SCORE with ML_model | WHERE probability(malicious) > threshold | ALERT,playbooks/attack/enterprise/T1027.007.yml
T1027.007: Dynamic API Resolution,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,13,"Is a core system process like lsass.exe or services.exe spawning a command-line interpreter (cmd.exe, powershell.exe)?","This is a high-confidence indicator of malicious activity, often related to process injection. Core Windows processes (lsass.exe, wininit.exe, etc.) have no legitimate reason to spawn interactive command shells. An alert on this behavior is a high-priority signal that a privileged process has been compromised and is being used to execute commands.","Windows Event ID 4688; Sysmon Event ID 1; Sysmon Event ID 3; Zeek conn.log; Zeek dns.log; Critical system processes on all Windows hosts, network traffic logs from perimeter firewalls and DNS servers.",last 90 days,": SEARCH process_creation_logs | WHERE parent_process in (lsass.exe, services.exe, wininit.exe) AND child_process in (cmd.exe, powershell.exe) | ALERT",playbooks/attack/enterprise/T1027.007.yml
T1027.007: Dynamic API Resolution,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,14,"Is a trusted system process, such as svchost.exe, creating a rare child process or connecting to a rare network destination?","This question detects process injection by baselining the behavior of normally noisy but trusted processes like svchost.exe and explorer.exe. By establishing what is 'normal' (common child processes, typical network destinations) for these processes across the enterprise, we can flag any statistically rare deviation, such as svchost.exe connecting to a never-before-seen domain, as a potential sign of compromise.","Windows Event ID 4688; Sysmon Event ID 1; Sysmon Event ID 3; Zeek conn.log; Zeek dns.log; Critical system processes on all Windows hosts, network traffic logs from perimeter firewalls and DNS servers.",last 90 days,": FOR each system_process (svchost.exe, explorer.exe) | BASELINE normal_child_processes, normal_network_destinations | ALERT on new behavior that is rare across enterprise",playbooks/attack/enterprise/T1027.007.yml
T1027.007: Dynamic API Resolution,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,15,"Does a time-series model detect a significant deviation from the normal behavioral patterns (e.g., network volume, process creation rate) of a critical system process?","This question applies time-series anomaly detection to the behavior of a single critical process over time. A model learns the normal daily and weekly rhythms of a process's activity (e.g., explorer.exe's network traffic). It can then flag a sudden, unexpected spike in activity that deviates from the predicted pattern, which could indicate that malicious code has been injected and is now active.","Windows Event ID 4688; Sysmon Event ID 1; Sysmon Event ID 3; Zeek conn.log; Zeek dns.log; Critical system processes on all Windows hosts, network traffic logs from perimeter firewalls and DNS servers.",last 90 days,": FOR each critical_process | MODEL metrics (net_volume, child_process_count) over time | ALERT on significant deviations from predicted values",playbooks/attack/enterprise/T1027.007.yml
T1027.009: Embedded Payloads,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,1,"Are file hashes from process creation events or network logs matching known malicious signatures, or are PE section names indicative of known packers?","This question aims to identify known malicious files using signature-based detection. By querying for file hashes from network traffic (Zeek files.log) and endpoint process creation events (Windows Event ID 4688) and comparing them against a threat intelligence feed, analysts can quickly spot known droppers, loaders, or packed malware. Additionally, searching for PE section names that match patterns of known packers (e.g., 'UPX', 'FSG!') in Zeek pe.log helps identify common evasion techniques.",Zeek files.log; Zeek pe.log; Windows Event ID 4688; Internet Gateway Firewalls; Web Proxies; Email Gateways; User Workstations; File Servers,last 90 days,"pseudocode: | // Query for file hashes from logs file_hashes = search(Zeek:files.log, WinEvent:4688).pluck('hash') // Compare against TI feed malicious_hashes = threat_intel_feed.match(file_hashes, tags=['dropper', 'loader', 'packed']) // Query for PE section names matching packer signatures packed_files = search(Zeek:pe.log).where('section_name').matches_regex('UPX[0-9]|FSG!|.aspack') // Alert on findings alert_on(malicious_hashes, packed_files)",playbooks/attack/enterprise/T1027.009.yml
T1027.009: Embedded Payloads,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,2,Are any Portable Executable (PE) files exhibiting unusually high entropy in their sections compared to a baseline of legitimate software?,"High entropy in a file section often indicates the presence of packed or encrypted data, a common technique for hiding malicious payloads. This question involves calculating the Shannon entropy for each executable section of PE files observed in Zeek pe.log. By establishing a baseline entropy distribution for legitimate executables in the environment, analysts can flag any file where a section's entropy is a statistical outlier (e.g., exceeds the 99th percentile), pointing to potential obfuscation.",Zeek pe.log; Internet Gateway Firewalls; Web Proxies; Email Gateways; User Workstations; File Servers,last 90 days,"pseudocode: | // For each PE file in Zeek pe.log foreach file in search(Zeek:pe.log): // Calculate entropy for each section entropies = calculate_shannon_entropy(file.sections) // Compare against baseline if any(entropies) > baseline.entropy_99th_percentile: alert('High entropy PE file detected', file)",playbooks/attack/enterprise/T1027.009.yml
T1027.009: Embedded Payloads,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,3,Can a machine learning model identify PE files that are likely to contain an embedded payload based on their structural features?,"This question leverages machine learning to detect novel or unknown threats that signature-based methods might miss. By training a classifier (e.g., logistic regression) on labeled PE file features (section count, names, entropy, import table, etc.) from Zeek pe.log, a predictive model can be created. This model can then score new, unseen files for their probability of containing an embedded payload, generating alerts for high-probability files.",Zeek pe.log; Internet Gateway Firewalls; Web Proxies; Email Gateways; User Workstations; File Servers,last 90 days,"pseudocode: | // Continuously process new PE files foreach file in stream(Zeek:pe.log): // Extract features features = extract_pe_features(file) // Get prediction from ML model probability = ml_model.predict_proba(features) // Alert if probability is high if probability > 0.9: alert('High probability of embedded payload detected', file)",playbooks/attack/enterprise/T1027.009.yml
T1027.009: Embedded Payloads,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,4,"Are any PE files being observed with an unusually large overlay size, potentially indicating an appended payload?","An overlay is data appended to the end of a PE file, outside of its defined structure. Adversaries often use large overlays to store malicious payloads. This question focuses on detecting PE files where the overlay is anomalously large, either by exceeding a fixed threshold (e.g., 500KB) or by being larger than the PE structure itself. This is often correlated with a low number of imported functions, as packed executables resolve imports dynamically.",Zeek pe.log; Zeek files.log; Windows Event ID 11 (Sysmon); Internet Gateway Firewalls; Web Proxies; Email Gateways; Endpoint temporary directories,last 90 days,"pseudocode: | // Join Zeek logs to get total size and PE info foreach file in join(Zeek:files.log, Zeek:pe.log): // Calculate overlay size overlay_size = file.total_bytes - file.pe_structure_size // Check against thresholds if overlay_size > 500KB or overlay_size > file.pe_structure_size: alert('Anomalously large PE overlay detected', file)",playbooks/attack/enterprise/T1027.009.yml
T1027.009: Embedded Payloads,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,5,"Do any PE files show a statistically anomalous ratio of overlay size to total file size, or have an unusually high number of sections compared to a baseline?","This question uses statistical analysis to identify abnormally structured PE files. By calculating the ratio of overlay size to total file size and the count of PE sections for all observed files, a baseline for legitimate software can be established. Alerts are then generated for files where these metrics are statistical outliers (e.g., overlay ratio > 95th percentile, section count > 2 standard deviations above the mean), as these are common characteristics of packed or modified malware.",Zeek pe.log; Internet Gateway Firewalls; Web Proxies; Email Gateways; Endpoint temporary directories,last 90 days,"pseudocode: | // For each PE file in Zeek pe.log foreach file in search(Zeek:pe.log): // Calculate metrics overlay_ratio = file.overlay_size / file.total_size section_count = count(file.sections) // Compare against statistical baseline if overlay_ratio > baseline.ratio_95th_percentile or section_count > baseline.section_count_mean + (2 * baseline.section_count_stddev): alert('Statistically anomalous PE structure detected', file)",playbooks/attack/enterprise/T1027.009.yml
T1027.009: Embedded Payloads,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,6,"Can an unsupervised machine learning model detect anomalous PE files based on structural features like section count, entropy, and overlay size?","This question applies unsupervised machine learning (e.g., Isolation Forest) to find outlier PE files without relying on pre-labeled data. The model is trained on a large corpus of network traffic to learn the characteristics of 'normal' PE files based on a feature set including section count, entropy, and overlay size ratio. It can then flag files that the model identifies as strong outliers, representing potentially malicious files that might otherwise evade detection.",Zeek pe.log; Internet Gateway Firewalls; Web Proxies; Email Gateways; Endpoint temporary directories,last 90 days,"pseudocode: | // Continuously process new PE files foreach file in stream(Zeek:pe.log): // Extract features features = extract_pe_features(file) // Get anomaly score from unsupervised model anomaly_score = unsupervised_model.predict(features) // Alert if identified as an outlier if anomaly_score == -1: // -1 often indicates an anomaly alert('Anomalous PE file detected by ML model', file)",playbooks/attack/enterprise/T1027.009.yml
T1027.009: Embedded Payloads,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,7,"Are PowerShell script logs showing the co-occurrence of in-memory execution functions with large, Base64-encoded text blocks?","This question targets a common PowerShell-based attack where a malicious payload is encoded (often in Base64) to evade static analysis, then decoded and executed directly in memory. The query searches PowerShell script block logs (Event ID 4104) for the simultaneous presence of keywords associated with decoding (`FromBase64String`) and execution (`Invoke-Expression`, `IEX`) alongside large blocks of encoded text (e.g., > 256 bytes).",Windows Event ID 4104; Windows Event ID 4103; User Workstations; Application Servers; Domain Controllers; Exchange Servers,last 90 days,"pseudocode: | // Search PowerShell logs search(WinEvent:4104).where('ScriptBlockText').contains(['FromBase64String', 'Invoke-Expression', 'IEX']) .and('ScriptBlockText').matches_regex('[A-Za-z0-9+/=]{256,}') .alert('Potential in-memory PowerShell execution detected')",playbooks/attack/enterprise/T1027.009.yml
T1027.009: Embedded Payloads,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,8,Are any PowerShell scripts exhibiting statistically high entropy or an unusual character distribution compared to a baseline of benign scripts?,"Legitimate administrative scripts usually have a predictable structure and character set, while obfuscated or encrypted malicious scripts often have high entropy and a different character frequency. This statistical approach involves establishing a baseline for these metrics from known-good scripts in the environment. Any new script from Event ID 4104 with an entropy score or character distribution that is a significant statistical outlier is flagged as suspicious.",Windows Event ID 4104; User Workstations; Application Servers; Domain Controllers; Exchange Servers,last 90 days,"pseudocode: | // For each new PowerShell script log foreach script in stream(WinEvent:4104): // Calculate metrics entropy = calculate_shannon_entropy(script.ScriptBlockText) // Compare to baseline if entropy > baseline.powershell_entropy_98th_percentile: alert('High entropy PowerShell script detected', script)",playbooks/attack/enterprise/T1027.009.yml
T1027.009: Embedded Payloads,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,9,Can a machine learning text classifier distinguish between malicious and benign PowerShell scripts based on their content?,"This question proposes using a supervised machine learning model (e.g., Naive Bayes) to automate the classification of PowerShell scripts. The model is trained on a labeled dataset of malicious and benign scripts, using features like keyword frequency (n-grams), API call mentions, entropy, and string length. Once deployed, it can classify incoming script blocks from Event ID 4104 in near real-time, providing a scalable way to identify malicious activity.",Windows Event ID 4104; User Workstations; Application Servers; Domain Controllers; Exchange Servers,last 90 days,"pseudocode: | // For each new PowerShell script log foreach script in stream(WinEvent:4104): // Extract features and classify features = extract_ps_features(script.ScriptBlockText) prediction = ps_classifier_model.predict(features) // Alert if classified as malicious if prediction == 'malicious': alert('Malicious PowerShell script classified by ML model', script)",playbooks/attack/enterprise/T1027.009.yml
T1027.009: Embedded Payloads,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,10,"Is a common productivity application injecting code into a legitimate system process, especially without a known start module?","This question looks for classic process injection, a technique where malware injects its code into the memory space of another process to hide. The query focuses on Sysmon Event ID 8 (CreateRemoteThread) where the source process is a common application (e.g., WINWORD.EXE, CHROME.EXE) and the target is a system process (e.g., svchost.exe). A null or non-standard value in the `StartModule` field is a strong indicator that the injected code is shellcode rather than a legitimate DLL.",Windows Event ID 8 (Sysmon); Windows Event ID 10 (Sysmon); Windows Event ID 4688; User Workstations; Critical Servers; Terminal Servers; Domain Controllers,last 90 days,"pseudocode: | // Search for process injection events search(Sysmon:8) .where('SourceImage').in(['WINWORD.EXE', 'CHROME.EXE', 'ACRORD32.EXE']) .and('TargetImage').in(['svchost.exe', 'explorer.exe', 'rundll32.exe']) .and('StartModule').is_null() .alert('Suspicious process injection detected')",playbooks/attack/enterprise/T1027.009.yml
T1027.009: Embedded Payloads,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,11,Are there any statistically rare or previously unseen process injection pairs (source process -> target process) occurring in the environment?,"Since some process injection is legitimate (e.g., by security software), this approach focuses on finding the unknown. By analyzing the frequency of all source-target process injection pairs from Sysmon Event ID 8 across the enterprise, a baseline of normal activity is established. Any injection pairs that are statistically rare (e.g., occurring fewer than 5 times in 90 days) or have never been seen before are flagged as highly suspicious and warrant investigation.",Windows Event ID 8 (Sysmon); User Workstations; Critical Servers; Terminal Servers; Domain Controllers,last 90 days,"pseudocode: | // Count all injection pairs over the last 90 days injection_pairs = search(Sysmon:8, time='-90d').count_by(['SourceImage', 'TargetImage']) // Find pairs with low counts rare_pairs = injection_pairs.where('count').is_less_than(5) // Alert on rare pairs alert('Statistically rare process injection pair detected', rare_pairs)",playbooks/attack/enterprise/T1027.009.yml
T1027.009: Embedded Payloads,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,12,Can a graph-based machine learning model detect anomalous process injection events by analyzing process interaction patterns?,"This question uses a more advanced approach by modeling process relationships as a graph, where processes are nodes and injections (Sysmon Event ID 8) are directed edges. By training a model on benign activity, it learns the normal process interaction graph structure. A new, anomalous edge (an injection) that deviates from these learned structural patterns, such as a browser process injecting into a kernel-level process, can be flagged as a high-fidelity alert.",Windows Event ID 8 (Sysmon); User Workstations; Critical Servers; Terminal Servers; Domain Controllers,last 90 days,"pseudocode: | // Continuously update process graph with Sysmon events foreach event in stream(Sysmon:8): graph.add_edge(event.SourceImage, event.TargetImage) // Use ML model to check if the new edge is an anomaly is_anomaly = graph_model.predict(graph) if is_anomaly: alert('Anomalous process injection detected by graph ML model', event)",playbooks/attack/enterprise/T1027.009.yml
T1027.009: Embedded Payloads,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,13,"Is an executable file, disguised with a non-executable extension (e.g., .jpg, .txt), being downloaded and then executed shortly after?","This question targets file masquerading, where an adversary renames a malicious executable to evade simple extension-based filters. The query correlates network file transfer logs (Zeek files.log) with endpoint process creation logs (Windows Event ID 4688). It triggers an alert when a file transferred with an executable MIME type (e.g., 'application/x-dosexec') but saved with a non-executable extension (e.g., .jpg, .txt) is executed on an endpoint within a short time window.",Windows Event ID 4688; Zeek files.log; Zeek conn.log; User Workstations; Web Proxies; Email Gateways; Network Egress Points; File Servers,last 90 days,"pseudocode: | // Join network and endpoint logs network_events = search(Zeek:files.log).where('mime_type') == 'application/x-dosexec' and 'filename'.ends_with('.jpg', '.txt', '.pdf') process_events = search(WinEvent:4688) // Correlate on filename/hash within a 5-minute window correlated_events = correlate(network_events, process_events, key='filename', window='5m') alert('Masqueraded file execution detected', correlated_events)",playbooks/attack/enterprise/T1027.009.yml
T1027.009: Embedded Payloads,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,14,Are processes being created from files with statistically rare or uncommon file extensions?,"Most legitimate processes are created from a predictable set of file extensions (e.g., .exe, .com, .bat). This statistical approach performs frequency analysis on the file extensions of all executed processes recorded in Event ID 4688 logs. By maintaining a dynamic list of the most common executable extensions (e.g., the top 95%), the query can alert whenever a process is created from a file with an extension that falls outside this common set, as this represents a statistical rarity.",Windows Event ID 4688; User Workstations; Web Proxies; Email Gateways; Network Egress Points; File Servers,last 90 days,"pseudocode: | // Get list of common executable extensions from baseline common_extensions = baseline.get_common_extensions(percentile=95) // Search for process creation events with rare extensions rare_executions = search(WinEvent:4688).where_not('ProcessName'.ends_with(common_extensions)) alert('Process created from file with rare extension', rare_executions)",playbooks/attack/enterprise/T1027.009.yml
T1027.009: Embedded Payloads,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,15,Can a time-series model detect an anomalous spike in the execution of a typically non-executed file type?,"This question uses a time-series anomaly detection model (e.g., ARIMA) to monitor the execution frequency of various file types over time. A sudden, coordinated attack might involve the execution of a file type that is normally dormant (e.g., .iso, .img, .dat). The model is trained on historical data to learn the normal temporal baseline for each extension and will flag any significant, sudden spike in executions as a potential coordinated attack.",Windows Event ID 4688; User Workstations; Web Proxies; Email Gateways; Network Egress Points; File Servers,last 90 days,"pseudocode: | // For each file extension, get execution counts over time timeseries_data = search(WinEvent:4688).time_series('count', '1h', by='extension') // Feed data into time-series model anomalies = timeseries_model.find_anomalies(timeseries_data) if anomalies: alert('Anomalous spike in execution frequency for extension', anomalies)",playbooks/attack/enterprise/T1027.009.yml
T1027.009: Embedded Payloads,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,16,Is a non-installer process (like a web browser or office application) creating and then immediately executing a new executable file?,"This question targets the 'drop and execute' behavior common in malware delivery from phishing or drive-by downloads. It correlates a file creation event (Sysmon ID 11) with a process creation event (Windows ID 4688) for the exact same file path, occurring within a very short window (e.g., < 60 seconds). The rule critically filters out legitimate parent processes (like 'setup.exe' or 'msiexec.exe') to focus on suspicious activity originating from non-installer applications.","Windows Event ID 4688; Windows Event ID 11 (Sysmon); User Workstations; Application Servers; Temporary File Directories (%TEMP%, %APPDATA%)",last 90 days,"pseudocode: | // Correlate file create and process create events correlated = correlate(Sysmon:11, WinEvent:4688, key='FilePath', window='1m') .where('event1.ProcessGuid == event2.ParentProcessGuid') .and_not('event2.ParentProcessName').in(installer_allowlist) alert('Suspicious drop-and-execute behavior detected', correlated)",playbooks/attack/enterprise/T1027.009.yml
T1027.009: Embedded Payloads,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,17,"Are there any 'file create -> process create' sequences with an unusually short time delay, initiated by a non-standard parent process?","This statistical approach quantifies the 'immediacy' of drop-and-execute behavior. For all observed sequences where a parent process creates a file and then executes it, the time delta between the two events is calculated. By establishing a baseline distribution of these deltas, analysts can flag sequences that fall in the lowest percentile (indicating automated, immediate execution) when the parent process is not a known installer or trusted system process.","Windows Event ID 4688; Windows Event ID 11 (Sysmon); User Workstations; Application Servers; Temporary File Directories (%TEMP%, %APPDATA%)",last 90 days,"pseudocode: | // Find create -> execute sequences sequences = correlate(Sysmon:11, WinEvent:4688, key='FilePath', window='5m') // Calculate time delta for each sequences.calculate('delta', 'event2.timestamp - event1.timestamp') // Find sequences with very small deltas from non-installers anomalies = sequences.where('delta').is_less_than(baseline.delta_5th_percentile) .and_not('ParentProcessName').in(installer_allowlist) alert('Anomalously fast drop-and-execute sequence detected', anomalies)",playbooks/attack/enterprise/T1027.009.yml
T1027.009: Embedded Payloads,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,18,"Can a sequence mining model detect anomalous post-download behavior, such as an unexpected drop-and-execute pattern?","This question applies sequence-aware machine learning (e.g., an LSTM-based autoencoder) to understand normal user and application behavior. The model is trained to learn the typical sequences of endpoint events (file creations, process creations, network connections) that follow a file download by a specific application like Chrome or Outlook. It can then detect and flag sequences that deviate significantly from this learned normal behavior, such as a browser suddenly creating and running an executable from a temp directory.","Windows Event ID 4688; Windows Event ID 11 (Sysmon); User Workstations; Application Servers; Temporary File Directories (%TEMP%, %APPDATA%)",last 90 days,"pseudocode: | // For each application (e.g., Chrome) foreach app in ['chrome.exe', 'outlook.exe']: // Get event sequences following a download sequences = get_event_sequences_after_download(app) // Use sequence model to find anomalies anomalous_sequences = sequence_model.find_anomalies(sequences) if anomalous_sequences: alert('Anomalous post-download event sequence detected', anomalous_sequences)",playbooks/attack/enterprise/T1027.009.yml
T1027.013: Encrypted-Encoded File,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,1,"How can we detect known malicious files, especially those associated with packers or droppers that use encryption, being transferred over the network or created on a host?","This question aims to identify threats at the entry point by matching file hashes against known malicious indicators. A multi-tiered approach is essential because attackers constantly repackage malware to change its hash. A symbolic check provides immediate hits on known threats. A statistical check detects surges in new malicious files, indicating a potential campaign. A machine learning model can proactively flag suspicious files based on their characteristics, even without a direct hash match, providing a predictive layer of defense.
",Zeek files.log; Windows Event ID 4663; Internet gateways; web proxies; email servers; user workstations; file servers; cloud storage synchronization folders,last 90 days,: ; : ; : ,playbooks/attack/enterprise/T1027.013.yml
T1027.013: Encrypted-Encoded File,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,2,Are there processes being created with command-line arguments or script content that indicate the use of decoding utilities or the execution of self-extracting archives from unusual locations?,"This question focuses on detecting the 'living-off-the-land' technique where adversaries use legitimate system tools (like certutil, openssl, PowerShell) to decode and execute malicious payloads. Monitoring command lines and script blocks is critical for catching this stage. A symbolic approach uses regular expressions to find explicit calls to these tools. A statistical approach baselines normal command-line length and complexity (entropy) for specific parent-child process relationships, flagging outliers. A machine learning model can be trained to recognize the nuanced patterns of malicious command-line invocations.
",Windows Event ID 4688; Windows Event ID 4104; user workstations; application servers; domain controllers; developer environments,last 90 days,: ; : ; : ,playbooks/attack/enterprise/T1027.013.yml
T1027.013: Encrypted-Encoded File,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,3,Can we identify files that have deceptive filenames with multiple extensions or manipulated Byte Order Marks (BOMs) to disguise their true nature?,"This question addresses a common social engineering tactic where an adversary tries to trick a user into running a malicious file by disguising it as a benign document (e.g., 'document.txt.js'). A symbolic regex search can catch common double-extension patterns. Statistical analysis helps find new or rare deceptive patterns by tracking the frequency of all observed extension combinations. A machine learning time-series model can detect sudden spikes in the creation of such files, which could indicate a widespread phishing or malware distribution campaign.
",Windows Event ID 4663; Zeek files.log; network shares; user home directories (%USERPROFILE%); email attachment directories; web download folders; removable media,last 90 days,: ; : ; : ,playbooks/attack/enterprise/T1027.013.yml
T1027.013: Encrypted-Encoded File,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,4,"Are files being created or transferred that exhibit unusually high Shannon entropy for their type or are password-protected, particularly in high-risk directories?","This question seeks to identify obfuscated payloads by analyzing their content characteristics. High Shannon entropy is a strong indicator of encryption or compression, which adversaries use to hide malicious code. A statistical approach establishes a normal entropy baseline for different file types (e.g., .txt, .ps1) and flags files that are significant outliers. A symbolic check can specifically identify password-protected archives, which are often used to bypass automated scanning. An unsupervised machine learning model like an Isolation Forest can combine multiple file features (entropy, size, location) to score files for anomalousness.
","Windows Event ID 4663; Zeek files.log; user profile temporary directories (e.g., %TEMP%, %LOCALAPPDATA%); web browser cache and download folders; network egress points; email quarantine systems",last 90 days,: ; : ; : ,playbooks/attack/enterprise/T1027.013.yml
T1027.013: Encrypted-Encoded File,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,5,"Are we observing encoded strings (e.g., Base64, Hex) in command lines, script logs, or network traffic that are anomalous in length or character distribution?","This question targets the use of encoded data for covert communication or payload delivery within otherwise legitimate channels like DNS queries or HTTP POST requests. A symbolic regex can find common encoding patterns. However, since encoding is also used for benign purposes, a statistical approach is needed to baseline the normal length and complexity of encoded strings in different contexts (e.g., a long encoded string in a DNS query is highly suspicious). A time-series model can monitor the volume of encoded data in specific channels, flagging unusual spikes that may indicate a C2 or exfiltration channel is active.
",Windows Event ID 4688; Windows Event ID 4104; Zeek http.log; Zeek dns.log; Domain Name System (DNS) infrastructure; web proxies and gateways; user workstations; application servers; API gateways,last 90 days,: ; : ; : ,playbooks/attack/enterprise/T1027.013.yml
T1027.013: Encrypted-Encoded File,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,6,"Can we detect a correlated sequence of events, such as a process reading a high-entropy file, then decoding it, and finally making a suspicious network connection, all within a short time frame?","This question focuses on detecting an attack chain by correlating seemingly disparate events. A single event, like a file write or a network connection, may not be malicious on its own, but their sequence can be a strong indicator of compromise. A symbolic correlation rule in a SIEM can detect a specific, predefined attack pattern. A statistical risk-scoring model can dynamically score process activity, escalating alerts as more suspicious actions are chained together. A graph-based machine learning model can analyze relationships between processes, files, and network activity to identify complex attack subgraphs in near-real-time.
","Windows Event ID 4663; Windows Event ID 4688; Zeek conn.log; user workstations; critical servers (e.g., Domain Controllers, database servers); network egress points; virtual desktop infrastructure (VDI) environments",last 90 days,: ; : ; : ,playbooks/attack/enterprise/T1027.013.yml
T1036.006: Space after Filename,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,1,Has a process been executed from a file with a trailing space whose hash is associated with known malware?,"This question aims to identify high-confidence threats. An adversary might use a file with a trailing space (e.g., ""malware.exe "") to evade simple filename-based blocklists. By cross-referencing the file's hash against threat intelligence feeds, we can confirm if this unusually named file is a known malicious payload, allowing for a swift and decisive response.
",Windows Event ID 4688; Sysmon Event ID 1; Centralized SIEM/log aggregator containing process creation logs; Threat intelligence feeds,last 90 days,": SEARCH process_creation_logs
WHERE process_name ENDS WITH "" ""
EXTRACT file_hash
LOOKUP file_hash in threat_intelligence_feeds
RETURN events where lookup is successful
",playbooks/attack/enterprise/T1036.006.yml
T1036.006: Space after Filename,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,2,Are there processes running from files with trailing spaces that are rare or unique within the environment?,"This question helps uncover targeted or newly introduced threats that may not yet be in threat intelligence feeds. Legitimate software is typically widespread, whereas malicious tools are often found on a small number of compromised hosts. By ""stack counting"" the file hashes of executables with trailing spaces, we can prioritize the rarest ones for investigation, as they are statistically more likely to be malicious.
",Windows Event ID 4688; Sysmon Event ID 1; Centralized SIEM/log aggregator containing process creation logs,last 90 days,": SEARCH process_creation_logs
WHERE process_name ENDS WITH "" ""
GROUP BY file_hash
COUNT distinct hosts per hash
RETURN hashes with host_count < 5
",playbooks/attack/enterprise/T1036.006.yml
T1036.006: Space after Filename,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,3,Can a machine learning model identify high-risk process executions involving trailing spaces based on contextual features?,"This question explores a proactive, automated approach to threat detection. Instead of relying on single indicators, a classification model can analyze a combination of features (filename properties, file hash prevalence, parent process details) to calculate a risk score. This helps analysts differentiate between benign anomalies and genuinely malicious activity, reducing false positives and focusing efforts on the most significant threats.
",Windows Event ID 4688; Sysmon Event ID 1; Centralized SIEM/log aggregator containing process creation logs,last 90 days,": // Model Training Phase
COLLECT features from historical process_creation_logs
(has_trailing_space, file_hash_prevalence, parent_process_info, etc.)
LABEL data as benign or malicious
TRAIN classification model (e.g., Random Forest)

// Inference Phase
FOR new process_creation_events with trailing space
  EXTRACT features
  PREDICT risk_score using trained model
  ALERT if risk_score > threshold
",playbooks/attack/enterprise/T1036.006.yml
T1036.006: Space after Filename,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,4,Is a process with a trailing space masquerading as a critical system process?,"Adversaries often try to blend in by naming their malware after legitimate Windows processes (e.g., ""svchost.exe"", ""lsass.exe""). Adding a trailing space is a subtle way to create a distinct file that visually resembles the real one. This question helps detect this specific masquerading technique by searching for executions of critical process names appended with a space, especially when they run from an unexpected directory like C:\Users instead of C:\Windows\System32.
",Windows Event ID 4688; Sysmon Event ID 1; SIEM containing process creation logs,last 90 days,": DEFINE watchlist = [""svchost.exe"", ""lsass.exe"", ""wininit.exe""]
SEARCH process_creation_logs
WHERE process_name IN (watchlist with "" "" appended)
AND file_path NOT IN (""C:\Windows\System32\"")
ALERT on any match
",playbooks/attack/enterprise/T1036.006.yml
T1036.006: Space after Filename,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,5,"Is a process with a trailing space, which mimics a legitimate system process, executing from an unusual file path or spawned by an anomalous parent process?","Legitimate system processes have predictable execution patterns, such as always running from C:\Windows\System32 and being spawned by specific parent processes. This question aims to identify masquerading attacks by baselining these normal patterns and then detecting deviations. An execution of ""svchost.exe "" from C:\Users\Public or being spawned by ""winword.exe"" is a statistical rarity and a strong indicator of compromise.
",Windows Event ID 4688; Sysmon Event ID 1; SIEM containing process creation logs,last 90 days,": // Baselining Phase
CREATE baseline of (process_name, file_path, parent_process) combinations for legitimate processes

// Detection Phase
SEARCH process_creation_logs
WHERE process_name ENDS WITH "" ""
AND (process_name, file_path, parent_process) combination is statistically rare compared to baseline
FLAG event for investigation
",playbooks/attack/enterprise/T1036.006.yml
T1036.006: Space after Filename,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,6,Can unsupervised machine learning (clustering) automatically identify a masquerading process with a trailing space as an outlier?,"This question proposes using clustering algorithms like DBSCAN to automatically group similar process execution events based on features like process name, command line, and parent process. Legitimate system processes will form large, dense clusters. A malicious process masquerading with a trailing space will likely have a unique combination of features, causing it to fall outside these normal clusters and be flagged as a noise point or an anomaly, enabling automated detection without predefined rules.
",Windows Event ID 4688; Sysmon Event ID 1; SIEM containing process creation logs,last 90 days,": // Model Training/Clustering Phase
COLLECT features from process_creation_events (process_name, command_line, parent_process, file_path)
APPLY clustering algorithm (e.g., DBSCAN) to group events

// Detection Phase
FOR new process_creation_events with trailing space
  EXTRACT features
  CHECK if event falls into an existing cluster
  IDENTIFY event as an outlier/noise if it does not belong to a cluster
",playbooks/attack/enterprise/T1036.006.yml
T1036.006: Space after Filename,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,7,Has a file with a trailing space been created in a common staging directory?,"Adversaries often drop or create their tools and payloads in temporary or user-writable locations ('C:\Windows\Temp\', user 'AppData' folders, etc.) before execution. This question focuses on the initial staging phase of an attack by monitoring for the creation of any file with a trailing space in these high-risk directories. Detecting the file at creation time can provide an early warning before the payload is executed.
",Windows Event ID 4663; Sysmon Event ID 11; Centralized log aggregator containing file system audit logs,last 90 days,": DEFINE high_risk_dirs = [""C:\Users\*\AppData\"", ""C:\Windows\Temp\"", ""C:\ProgramData\""]
SEARCH file_creation_logs
WHERE filename ENDS WITH "" ""
AND file_path IN high_risk_dirs
ALERT on any match
",playbooks/attack/enterprise/T1036.006.yml
T1036.006: Space after Filename,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,8,Is there a statistical anomaly in filename patterns or creation rates related to files with trailing spaces?,"This question seeks to identify suspicious staging activity by analyzing metadata rather than just the event itself. Adversaries may use randomized filenames to avoid simple signature-based detection, which increases filename entropy. A sudden spike in the average filename entropy for a user, or a user creating an unusually high number of files with trailing spaces compared to their peers, are statistical indicators of potential malicious activity.
",Windows Event ID 4663; Sysmon Event ID 11; Centralized log aggregator containing file system audit logs,last 90 days,": // Entropy Anomaly
FOR each user
  CALCULATE daily average filename entropy
  COMPARE to user's historical baseline (e.g., past 30 days)
  ALERT if current average > (baseline + 2 * standard_deviation)

// Rate Anomaly
FOR each user
  COUNT file creations with trailing spaces per day
  COMPARE to all users' counts
  ALERT if user's count is in top 95th percentile
",playbooks/attack/enterprise/T1036.006.yml
T1036.006: Space after Filename,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,9,Can a one-class machine learning model detect file creation events with trailing spaces as anomalous behavior?,"This question proposes using a model trained exclusively on ""normal"" data. A One-Class SVM learns the boundary of legitimate file creation activity in temp directories based on features like filename entropy, creating process, and file size. Any new file creation event, such as one involving a file with a trailing space, that falls outside this learned boundary is flagged as an outlier. This is useful for detecting novel threats without needing examples of malicious activity for training.
",Windows Event ID 4663; Sysmon Event ID 11; Centralized log aggregator containing file system audit logs,last 90 days,": // Model Training Phase
COLLECT features from legitimate file_creation_events in temp directories
TRAIN One-Class SVM model on this normal data

// Inference Phase
FOR new file_creation_events (including those with trailing spaces)
  EXTRACT features
  PREDICT if event is an outlier using the trained model
  ALERT if flagged as an outlier
",playbooks/attack/enterprise/T1036.006.yml
T1036.006: Space after Filename,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,10,Has a process launched from a file with a trailing space initiated a network connection to a known malicious IP or domain?,"This is a high-confidence indicator of compromise. After an adversary executes a payload (using a file with a trailing space), it will often establish a command-and-control (C2) channel. This question aims to detect this C2 activity by correlating the process execution event with subsequent network connections and checking the destination against threat intelligence feeds. A match confirms that the suspicious process is communicating with known malicious infrastructure.
",Windows Event ID 4688; Sysmon Event ID 1; Sysmon Event ID 3; Zeek conn.log; Zeek dns.log; SIEM; Threat intelligence feeds,last 90 days,": SEARCH process_creation_logs for process_name ENDING WITH "" ""
WITHIN 60 seconds, on the same host,
SEARCH network_connection_logs for destination_ip or destination_domain
LOOKUP destination in threat_intelligence_feeds
ALERT on any match
",playbooks/attack/enterprise/T1036.006.yml
T1036.006: Space after Filename,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,11,Is a process with a trailing space connecting to a statistically rare or suspicious domain?,"This question helps identify potential C2 infrastructure that is not yet on a threat intelligence list. Adversaries often use newly registered domains (NRDs) that have no reputation and are not widely visited. By analyzing properties like domain age (e.g., < 30 days old) and internal prevalence (e.g., visited by < 0.1% of hosts), we can identify connections from a process with a trailing space that are statistical outliers and therefore highly suspicious.
",Windows Event ID 4688; Sysmon Event ID 1; Sysmon Event ID 3; Zeek conn.log; Zeek dns.log; SIEM,last 90 days,": SEARCH process_creation_logs for process_name ENDING WITH "" ""
CORRELATE with network_connection_logs on the same host
EXTRACT destination_domain
ENRICH domain with age and internal_prevalence
ALERT if (domain_age < 30 days) AND (internal_prevalence < 0.1%)
",playbooks/attack/enterprise/T1036.006.yml
T1036.006: Space after Filename,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,12,"Following the execution of a process with a trailing space, is there an anomalous spike in outbound network traffic from the host?","This question aims to detect data exfiltration or heavy C2 communication by baselining a host's normal network behavior. A time series model can forecast the expected volume of outbound data for a given time. If a process with a trailing space runs and the actual outbound traffic significantly exceeds the forecasted amount (e.g., falls outside a 99% confidence interval), it signals an anomaly that could be related to the suspicious process's activity.
",Windows Event ID 4688; Sysmon Event ID 1; Sysmon Event ID 3; Zeek conn.log; SIEM,last 90 days,": // Model Training/Forecasting Phase
FOR each host
  TRAIN time series model (e.g., Prophet) on historical outbound_data_volume
  FORECAST expected volume and confidence interval

// Detection Phase
SEARCH for process_creation_events with trailing spaces
MONITOR subsequent outbound_data_volume on the same host
ALERT if actual_volume exceeds forecasted confidence interval
",playbooks/attack/enterprise/T1036.006.yml
T1036.006: Space after Filename,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,13,Was a process with a trailing space spawned by an unexpected parent process according to predefined rules?,"This question uses a rule-based approach to detect anomalous process lineage. Certain parent-child relationships are almost always legitimate (e.g., 'services.exe' spawning 'svchost.exe'), while others are highly irregular (e.g., 'winword.exe' spawning 'svchost.exe '). By creating a list of allowed or expected relationships, we can quickly flag any process with a trailing space that violates these rules, indicating a likely attempt to inject or launch a process from a compromised application.
",Windows Event ID 4688; Sysmon Event ID 1; SIEM,last 90 days,": DEFINE rule_set = { ""svchost.exe"": ""services.exe"", ""cmd.exe"": ""explorer.exe"" }
SEARCH process_creation_logs
WHERE child_process_name ENDS WITH "" ""
AND parent_process_name IS NOT the expected parent for child_process_name in rule_set
ALERT on any violation
",playbooks/attack/enterprise/T1036.006.yml
T1036.006: Space after Filename,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,14,Does the parent-child relationship of a process with a trailing space represent a statistically rare occurrence in the environment?,"This question moves beyond static rules to a data-driven approach. By analyzing all parent-child process relationships across the enterprise, we can establish a baseline of what's common. When a process with a trailing space is executed, we can check how frequently its parent-child pair has been seen before. If the pair is extremely rare (e.g., in the bottom 1st percentile), it is a statistical anomaly that warrants investigation, even if it doesn't violate a predefined rule.
",Windows Event ID 4688; Sysmon Event ID 1; SIEM,last 90 days,": // Baselining Phase
CREATE frequency table of all (parent_process, child_process) pairs over 30 days

// Detection Phase
SEARCH process_creation_logs for child_process_name ENDING WITH "" ""
LOOKUP its (parent_process, child_process) pair in the frequency table
ALERT if the pair's frequency is in the bottom 1st percentile
",playbooks/attack/enterprise/T1036.006.yml
T1036.006: Space after Filename,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,15,Can a process with a trailing space be identified as a structural anomaly within a graph of all process relationships?,"This question applies graph analysis to detect sophisticated attacks. By modeling all process executions as a large graph, we can use algorithms to find ""communities"" of normal, related activity. A malicious process, even one masquerading with a trailing space, will often create an unusual link in this graph—either by being isolated from all communities or by bridging two otherwise unrelated groups of processes. Identifying these structural anomalies provides a powerful way to find malicious execution chains.
",Windows Event ID 4688; Sysmon Event ID 1; SIEM,last 90 days,": // Graph Building & Analysis Phase
CREATE a graph of all process parent-child relationships
RUN a community detection algorithm (e.g., Louvain) on the graph

// Detection Phase
FOR new process_creation_events with a trailing space
  ADD the new process (node) and its relationship (edge) to the graph
  CHECK if the new node is part of a known community
  ALERT if the node is an outlier or an anomalous bridge between communities",playbooks/attack/enterprise/T1036.006.yml
T1036.010: Masquerade Account Name,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0005: Defense Evasion,n; o; n; e,1,Are new user accounts being created with names that appear on a blocklist of known malicious account names?,"This question aims to detect the most straightforward form of account masquerading, where an adversary uses a known-bad username. By comparing new account names from Windows Event ID 4720 against a threat intelligence blocklist, an analyst can quickly identify high-confidence threats without complex analysis. Answering this helps catch low-sophistication attacks and provides a clear signal of malicious intent.","W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 7; 2; 0; ,;  ; D; o; m; a; i; n;  ; C; o; n; t; r; o; l; l; e; r; s; ,;  ; M; e; m; b; e; r;  ; S; e; r; v; e; r; s; ,;  ; P; r; i; v; i; l; e; g; e; d;  ; W; o; r; k; s; t; a; t; i; o; n; s",last 90 days,": SEARCH EventID=4720
WHERE TargetAccountName IN (malicious_account_blocklist)
RETURN Hostname, CreatorAccountName, TargetAccountName, Timestamp
",playbooks/attack/enterprise/T1036.010.yml
T1036.010: Masquerade Account Name,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0005: Defense Evasion,n; o; n; e,2,Are newly created usernames exhibiting unusually high or low randomness compared to existing legitimate accounts?,"Adversaries may use programmatically generated account names, which can result in usernames that are either highly random (e.g., 'x7g3f_svc') or overly simplistic (e.g., 'a'). This question uses Shannon entropy to measure the randomness of new usernames found in Windows Event ID 4720. By comparing this entropy score to a baseline of normal accounts, analysts can flag statistical outliers that may indicate automated, and potentially malicious, account creation.","W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 7; 2; 0; ,;  ; D; o; m; a; i; n;  ; C; o; n; t; r; o; l; l; e; r; s; ,;  ; M; e; m; b; e; r;  ; S; e; r; v; e; r; s; ,;  ; P; r; i; v; i; l; e; g; e; d;  ; W; o; r; k; s; t; a; t; i; o; n; s",last 90 days,": SEARCH EventID=4720
CALCULATE entropy(TargetAccountName) as username_entropy
WHERE username_entropy > 95th_percentile_baseline OR username_entropy < 5th_percentile_baseline
RETURN Hostname, CreatorAccountName, TargetAccountName, username_entropy
",playbooks/attack/enterprise/T1036.010.yml
T1036.010: Masquerade Account Name,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0005: Defense Evasion,n; o; n; e,3,Can a machine learning model identify newly created user accounts as malicious based on their characteristics?,"This question leverages a supervised machine learning model to perform a multi-faceted analysis of new account creation events (Windows Event ID 4720). The model considers features like username length, character types, source of creation, and time of day to determine if a new account fits a malicious pattern. This provides a more sophisticated detection method than single-factor checks and can uncover complex masquerading attempts that might otherwise be missed.","W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 7; 2; 0; ,;  ; D; o; m; a; i; n;  ; C; o; n; t; r; o; l; l; e; r; s; ,;  ; M; e; m; b; e; r;  ; S; e; r; v; e; r; s; ,;  ; P; r; i; v; i; l; e; g; e; d;  ; W; o; r; k; s; t; a; t; i; o; n; s",last 90 days,": STREAM EventID=4720
EXTRACT features(Username, SourceHost, Creator, Timestamp)
SCORE with trained_classification_model
WHERE score > 0.9
ALERT with event_details, score
",playbooks/attack/enterprise/T1036.010.yml
T1036.010: Masquerade Account Name,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0005: Defense Evasion,n; o; n; e,4,Are accounts with names resembling standard service or admin accounts being created by unauthorized users?,"Adversaries often create accounts with names that mimic legitimate administrative or service accounts (e.g., 'backup_svc', 'sqladmin') to blend in. This question focuses on identifying such creations (via Windows Event ID 4720) and verifying if the creator is an authorized administrator. An alert is generated if a user not on the approved list creates an account matching these patterns, indicating a potential rogue admin account.","W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 7; 2; 0; ,;  ; D; o; m; a; i; n;  ; C; o; n; t; r; o; l; l; e; r; s; ,;  ; C; l; o; u; d;  ; I; A; M;  ; S; e; r; v; i; c; e; s;  ; (; e; .; g; .; ,;  ; A; z; u; r; e;  ; A; D; )",last 90 days,": SEARCH EventID=4720
WHERE TargetAccountName MATCHES_REGEX (admin_service_patterns)
AND CreatorAccountName NOT IN (authorized_admin_list)
RETURN Hostname, CreatorAccountName, TargetAccountName, Timestamp
",playbooks/attack/enterprise/T1036.010.yml
T1036.010: Masquerade Account Name,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0005: Defense Evasion,n; o; n; e,5,Are accounts with admin-like names being created at unusual times compared to historical norms?,"Legitimate administrative and service accounts are typically created during business hours by IT staff. Adversaries, however, may operate at odd hours to avoid detection. This question involves baselining the normal creation times for accounts with admin-like names. By analyzing new account creations (Windows Event ID 4720) that match these patterns, an alert can be triggered if the creation time is a statistical anomaly (e.g., late at night or on a weekend), suggesting illicit activity.","W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 7; 2; 0; ,;  ; D; o; m; a; i; n;  ; C; o; n; t; r; o; l; l; e; r; s; ,;  ; C; l; o; u; d;  ; I; A; M;  ; S; e; r; v; i; c; e; s;  ; (; e; .; g; .; ,;  ; A; z; u; r; e;  ; A; D; )",last 90 days,": SEARCH EventID=4720 AND TargetAccountName MATCHES_REGEX (admin_service_patterns)
COMPARE creation_time to historical_baseline_for_account_type
WHERE creation_time IS_ANOMALOUS
RETURN Hostname, CreatorAccountName, TargetAccountName, Timestamp
",playbooks/attack/enterprise/T1036.010.yml
T1036.010: Masquerade Account Name,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0005: Defense Evasion,n; o; n; e,6,"Is there a sudden, anomalous spike in the creation of accounts with admin-like names?","A sudden burst in the creation of multiple service or admin-style accounts can be a strong indicator of an automated attack script or a compromised administrative session. This question uses a time series model to forecast the expected number of such account creations. If the actual number of new accounts (from Windows Event ID 4720) significantly deviates from the forecast, it signals a potential mass-creation event that warrants immediate investigation.","W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 7; 2; 0; ,;  ; D; o; m; a; i; n;  ; C; o; n; t; r; o; l; l; e; r; s; ,;  ; C; l; o; u; d;  ; I; A; M;  ; S; e; r; v; i; c; e; s;  ; (; e; .; g; .; ,;  ; A; z; u; r; e;  ; A; D; )",last 90 days,": AGGREGATE count(EventID=4720 WHERE TargetAccountName MATCHES_REGEX (admin_service_patterns)) by hour
FEED into time_series_anomaly_model
ALERT if count > forecasted_upper_bound
RETURN time_bucket, actual_count, forecasted_count
",playbooks/attack/enterprise/T1036.010.yml
T1036.010: Masquerade Account Name,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0005: Defense Evasion,n; o; n; e,7,Are new or renamed accounts using special characters or mixed character sets to impersonate existing privileged accounts?,"This question addresses homoglyph attacks, where an adversary uses visually similar characters from different character sets (e.g., Cyrillic 'а' vs. Latin 'a') to create deceptive account names. By scanning new or renamed account names (from Windows Event IDs 4720 and 4781) for known homoglyphs or mixed scripts, analysts can flag suspicious accounts that require manual verification to determine if they are impersonating a legitimate, high-privilege user.","W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 7; 2; 0; ,;  ; W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 7; 8; 1; ,;  ; D; o; m; a; i; n;  ; C; o; n; t; r; o; l; l; e; r; s; ,;  ; H; R;  ; S; y; s; t; e; m; s; ,;  ; F; i; n; a; n; c; i; a; l;  ; S; y; s; t; e; m; s",last 90 days,": SEARCH EventID IN (4720, 4781)
WHERE TargetAccountName CONTAINS (homoglyph_characters) OR TargetAccountName CONTAINS (mixed_char_sets)
RETURN Hostname, EventID, CreatorAccountName, TargetAccountName, Timestamp
",playbooks/attack/enterprise/T1036.010.yml
T1036.010: Masquerade Account Name,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0005: Defense Evasion,n; o; n; e,8,"Do any new or renamed accounts, when normalized, closely match the name of an existing privileged account?","This question aims to programmatically uncover homoglyph and typosquatting attacks that might evade simple visual inspection. By converting both new account names (from events 4720 and 4781) and existing privileged account names to a 'normalized skeleton' (lowercase, alphanumeric only, with homoglyphs mapped to standard equivalents), we can use a string-distance algorithm like Levenshtein to find close matches. A very small distance (e.g., 1 or 2) between skeletons when the original names differ is a strong indicator of an impersonation attempt.","W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 7; 2; 0; ,;  ; W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 7; 8; 1; ,;  ; D; o; m; a; i; n;  ; C; o; n; t; r; o; l; l; e; r; s; ,;  ; H; R;  ; S; y; s; t; e; m; s; ,;  ; F; i; n; a; n; c; i; a; l;  ; S; y; s; t; e; m; s",last 90 days,": FOREACH new_account from EventID IN (4720, 4781):
  new_skeleton = normalize(new_account.TargetAccountName)
  FOREACH privileged_account in privileged_list:
    priv_skeleton = normalize(privileged_account.Name)
    distance = levenshtein(new_skeleton, priv_skeleton)
    IF distance <= 2 AND new_account.TargetAccountName != privileged_account.Name:
      ALERT with new_account, privileged_account, distance
",playbooks/attack/enterprise/T1036.010.yml
T1036.010: Masquerade Account Name,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0005: Defense Evasion,n; o; n; e,9,Can a neural network model detect anomalous character patterns in new or renamed usernames that are indicative of homoglyph attacks?,"This question proposes an advanced, unsupervised machine learning approach to detect unusual usernames. An autoencoder is trained to 'learn' the structure of legitimate usernames. When a new username from an account creation or rename event (4720, 4781) is fed into the model, it attempts to reconstruct it. A high reconstruction error suggests the username contains character patterns (like homoglyphs or other abnormalities) that the model has not seen in legitimate data, flagging it as anomalous for further review.","W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 7; 2; 0; ,;  ; W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 7; 8; 1; ,;  ; D; o; m; a; i; n;  ; C; o; n; t; r; o; l; l; e; r; s; ,;  ; H; R;  ; S; y; s; t; e; m; s; ,;  ; F; i; n; a; n; c; i; a; l;  ; S; y; s; t; e; m; s",last 90 days,": STREAM EventID IN (4720, 4781)
CALCULATE reconstruction_error = autoencoder_model.predict(TargetAccountName)
WHERE reconstruction_error > anomaly_threshold
ALERT with event_details, reconstruction_error
",playbooks/attack/enterprise/T1036.010.yml
T1036.010: Masquerade Account Name,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0005: Defense Evasion,n; o; n; e,10,Are new or renamed accounts being created that exactly match a pre-generated list of typosquatted critical account names?,"This question targets typosquatting, a common technique where an adversary registers a username with a minor misspelling of a privileged account (e.g., 'admnistrator'). By proactively generating a list of likely typos for critical accounts and monitoring account creation/rename events (4720, 4781) for exact matches against this list, security teams can create high-fidelity alerts for blatant impersonation attempts.","W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 7; 2; 0; ,;  ; W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 7; 8; 1; ,;  ; D; o; m; a; i; n;  ; C; o; n; t; r; o; l; l; e; r; s; ,;  ; P; r; i; v; i; l; e; g; e; d;  ; A; c; c; e; s; s;  ; W; o; r; k; s; t; a; t; i; o; n; s;  ; (; P; A; W; s; ); ,;  ; K; e; y;  ; I; T;  ; P; e; r; s; o; n; n; e; l;  ; E; n; d; p; o; i; n; t; s",last 90 days,": SEARCH EventID IN (4720, 4781)
WHERE TargetAccountName IN (pregenerated_typosquat_list)
RETURN Hostname, EventID, CreatorAccountName, TargetAccountName
",playbooks/attack/enterprise/T1036.010.yml
T1036.010: Masquerade Account Name,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0005: Defense Evasion,n; o; n; e,11,Are new account names being created that are unusually similar to existing privileged account names?,"This question provides a more dynamic way to detect typosquatting than a static list. It uses the Jaro-Winkler similarity algorithm, which is effective at scoring string similarity, to compare every new account name (from events 4720, 4781) against all known privileged accounts. A score that is exceptionally high (e.g., > 0.95) indicates that the new name is very close to a privileged one, which is a strong signal of a typosquatting attempt and should be investigated.","W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 7; 2; 0; ,;  ; W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 7; 8; 1; ,;  ; D; o; m; a; i; n;  ; C; o; n; t; r; o; l; l; e; r; s; ,;  ; P; r; i; v; i; l; e; g; e; d;  ; A; c; c; e; s; s;  ; W; o; r; k; s; t; a; t; i; o; n; s;  ; (; P; A; W; s; ); ,;  ; K; e; y;  ; I; T;  ; P; e; r; s; o; n; n; e; l;  ; E; n; d; p; o; i; n; t; s",last 90 days,": FOREACH new_account from EventID IN (4720, 4781):
  max_similarity = 0
  closest_match = """"
  FOREACH privileged_account in privileged_list:
    score = jaro_winkler(new_account.TargetAccountName, privileged_account.Name)
    IF score > max_similarity:
      max_similarity = score
      closest_match = privileged_account.Name
  IF max_similarity > 0.95:
    ALERT with new_account, closest_match, max_similarity
",playbooks/attack/enterprise/T1036.010.yml
T1036.010: Masquerade Account Name,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0005: Defense Evasion,n; o; n; e,12,"Do new account names fall outside of established naming convention clusters, indicating they are anomalous?","This question uses unsupervised clustering to identify anomalous usernames based on naming conventions. Legitimate accounts often follow patterns (e.g., 'firstname.lastname', 'svc-appname') and will form dense clusters when analyzed. An adversary-created name may not fit any of these patterns. By using an algorithm like DBSCAN on vector representations of all usernames, any new account that is classified as 'noise' (i.e., not belonging to a cluster) can be flagged as an anomaly for further investigation, especially if it also has high string similarity to a privileged account.","W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 7; 2; 0; ,;  ; W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 7; 8; 1; ,;  ; D; o; m; a; i; n;  ; C; o; n; t; r; o; l; l; e; r; s; ,;  ; P; r; i; v; i; l; e; g; e; d;  ; A; c; c; e; s; s;  ; W; o; r; k; s; t; a; t; i; o; n; s;  ; (; P; A; W; s; ); ,;  ; K; e; y;  ; I; T;  ; P; e; r; s; o; n; n; e; l;  ; E; n; d; p; o; i; n; t; s",last 90 days,": ON new account creation (EventID 4720 or 4781):
  username_vector = vectorize(TargetAccountName)
  cluster_label = dbscan_model.predict(username_vector)
  IF cluster_label == 'noise':
    ALERT on anomalous username
",playbooks/attack/enterprise/T1036.010.yml
T1036.010: Masquerade Account Name,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0005: Defense Evasion,n; o; n; e,13,Are newly created user accounts being immediately added to high-privilege groups?,"A very strong indicator of malicious activity is the rapid escalation of a brand-new account to a privileged status. This question looks for a specific sequence of events: a user creation (Event ID 4720) immediately followed by that same user being added to a critical administrative group like 'Domain Admins' (Event IDs 4728, 4732, 4756). Detecting this 'newborn admin' pattern within a very short time window (e.g., one hour) allows for the generation of a critical-severity alert for immediate response.","W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 7; 2; 0; ,;  ; W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 7; 8; 1; ,;  ; W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 6; 2; 4; ,;  ; W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 7; 2; 8; ,;  ; W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 7; 3; 2; ,;  ; W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 7; 5; 6; ,;  ; Z; e; e; k;  ; c; o; n; n; .; l; o; g; ,;  ; D; o; m; a; i; n;  ; C; o; n; t; r; o; l; l; e; r; s; ,;  ; N; e; t; w; o; r; k;  ; G; a; t; e; w; a; y; ,;  ; D; N; S;  ; S; e; r; v; e; r; s; ,;  ; E; n; d; p; o; i; n; t;  ; D; e; v; i; c; e; s",last 90 days,": JOIN (SEARCH EventID=4720) as creation_event
WITH (SEARCH EventID IN (4728, 4732, 4756) AND GroupName IN (privileged_groups)) as group_event
ON creation_event.TargetAccountName = group_event.TargetAccountName
WHERE group_event.Timestamp < creation_event.Timestamp + 1_hour
ALERT on 'Newborn Admin' activity
",playbooks/attack/enterprise/T1036.010.yml
T1036.010: Masquerade Account Name,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0005: Defense Evasion,n; o; n; e,14,Are newly created accounts logging in from geographically or network-level anomalous locations?,"This question seeks to identify suspicious activity from new accounts by analyzing their network behavior. After an account is created (Event ID 4720), its subsequent login activity (Event ID 4624) and network connections (Zeek conn.log) are monitored. If a new account logs in from a country or Autonomous System Number (ASN) that is rare for the organization, it is a significant anomaly. This suggests the account may be controlled by an external adversary, and its risk score should be increased accordingly.","W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 7; 2; 0; ,;  ; W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 7; 8; 1; ,;  ; W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 6; 2; 4; ,;  ; W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 7; 2; 8; ,;  ; W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 7; 3; 2; ,;  ; W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 7; 5; 6; ,;  ; Z; e; e; k;  ; c; o; n; n; .; l; o; g; ,;  ; D; o; m; a; i; n;  ; C; o; n; t; r; o; l; l; e; r; s; ,;  ; N; e; t; w; o; r; k;  ; G; a; t; e; w; a; y; ,;  ; D; N; S;  ; S; e; r; v; e; r; s; ,;  ; E; n; d; p; o; i; n; t;  ; D; e; v; i; c; e; s",last 90 days,": SEARCH EventID=4720 AND creation_time > now() - 7_days
JOIN with EventID=4624 AND LogonType IN (2, 10)
ENRICH SourceIP with GeoIP, ASN
WHERE login_event.SourceCountry NOT IN (common_countries) OR login_event.SourceASN NOT IN (common_asns)
ALERT on anomalous login location for new user
",playbooks/attack/enterprise/T1036.010.yml
T1036.010: Masquerade Account Name,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0005: Defense Evasion,n; o; n; e,15,Are new accounts performing their first privileged action significantly faster than normal?,"Legitimate new user accounts typically have a 'bedding-in' period before they perform sensitive actions. Adversaries, in contrast, will often use a newly created account to execute their objectives immediately. This question uses a model to establish a normal baseline for the time between account creation (Event ID 4720) and the first privileged action (e.g., RDP login, group change). If a new account performs such an action in an anomalously short time, it's a strong indicator of malicious intent.","W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 7; 2; 0; ,;  ; W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 7; 8; 1; ,;  ; W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 6; 2; 4; ,;  ; W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 7; 2; 8; ,;  ; W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 7; 3; 2; ,;  ; W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 7; 5; 6; ,;  ; Z; e; e; k;  ; c; o; n; n; .; l; o; g; ,;  ; D; o; m; a; i; n;  ; C; o; n; t; r; o; l; l; e; r; s; ,;  ; N; e; t; w; o; r; k;  ; G; a; t; e; w; a; y; ,;  ; D; N; S;  ; S; e; r; v; e; r; s; ,;  ; E; n; d; p; o; i; n; t;  ; D; e; v; i; c; e; s",last 90 days,": FOREACH new_account from EventID=4720:
  FIND first_privileged_action_event (e.g., RDP, group add) for new_account
  CALCULATE time_to_action = action_event.Timestamp - new_account.Timestamp
  COMPARE time_to_action with survival_analysis_model
  IF time_to_action IS ANOMALOUSLY_SHORT:
    ALERT on rapid privileged action",playbooks/attack/enterprise/T1036.010.yml
T1036: Masquerading,f4b1b1b0-5a1a-4b0a-8c1a-1b1b1b1b1b1b,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0005: Defense Evasion,n; o; n; e,1,"Is a process with a legitimate name (e.g., svchost.exe) executing with a file hash known to be malicious?",This question aims to detect a common masquerading technique where an adversary replaces a legitimate system file with malware but keeps the original filename to avoid suspicion. Answering this helps identify trojanized system binaries by comparing the file hash of running processes against threat intelligence feeds. A match indicates a high-confidence compromise.,"Windows Event ID 4688; Sysmon Event ID 1; All enterprise endpoints (workstations, servers), Domain Controllers, Certificate Authorities",last 90 days,: JOIN process creation logs with threat intelligence feed ON file_hash. WHERE process_name IN (common_system_binaries_watchlist) AND threat_feed_match IS NOT NULL.,playbooks/attack/enterprise/T1036.yml
T1036: Masquerading,f4b1b1b0-5a1a-4b0a-8c1a-1b1b1b1b1b1b,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0005: Defense Evasion,n; o; n; e,2,"Is a critical system process (e.g., lsass.exe) running with a file hash that has not been previously approved or seen in our environment?","This question focuses on identifying unauthorized or unknown versions of critical system files. By maintaining a baseline of known-good hashes for essential binaries (from a golden image or software inventory), any deviation can signal a potential file replacement attack, even if the new hash isn't in a threat intelligence feed yet.","Windows Event ID 4688; Sysmon Event ID 1; All enterprise endpoints (workstations, servers), Domain Controllers, Certificate Authorities",last 90 days,": FOR each process creation event, IF process_name IN (critical_binaries_list), CHECK if file_hash is in the known_good_hash_set for that process_name. ALERT if not found.",playbooks/attack/enterprise/T1036.yml
T1036: Masquerading,f4b1b1b0-5a1a-4b0a-8c1a-1b1b1b1b1b1b,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0005: Defense Evasion,n; o; n; e,3,"Can we predict if a process execution is a malicious masquerade based on its name, hash prevalence, and other execution properties?","This question explores a predictive approach to detecting masquerading. It's useful when symbolic rules are too rigid and statistical methods are too noisy. By training a model on features like process name, parent process, command-line length, and hash rarity, we can score new process events to find suspicious combinations that might indicate a sophisticated masquerade attempt.","Windows Event ID 4688; Sysmon Event ID 1; All enterprise endpoints (workstations, servers), Domain Controllers, Certificate Authorities",last 90 days,": SCORE process creation events using a trained classification model. FEATURES: process_name, parent_process, cmd_line_length, hash_prevalence, in_threat_intel. ALERT on high malicious score.",playbooks/attack/enterprise/T1036.yml
T1036: Masquerading,f4b1b1b0-5a1a-4b0a-8c1a-1b1b1b1b1b1b,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0005: Defense Evasion,n; o; n; e,4,"Is a process executing from a filename that uses deceptive formatting, such as a Right-to-Left-Override (RTLO) character, multiple extensions, or a trailing space?","Adversaries use these tricks to make malicious executables look like benign documents (e.g., 'report.exe.pdf' appearing as 'report.pdf.exe'). This question helps detect these explicit, rule-based attempts at user deception by scanning filenames for known deceptive patterns.","Windows Event ID 4688; Sysmon Event ID 1; All enterprise endpoints, email gateways, web proxies, and file shares",last 90 days,": SEARCH process creation logs WHERE process_name MATCHES REGEX for RTLO, multiple extensions (e.g., `\.(pdf|docx)\.exe$`), or trailing spaces.",playbooks/attack/enterprise/T1036.yml
T1036: Masquerading,f4b1b1b0-5a1a-4b0a-8c1a-1b1b1b1b1b1b,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0005: Defense Evasion,n; o; n; e,5,"Is a process running with a name that is a close misspelling of a legitimate critical system binary (e.g., 'svch0st.exe' instead of 'svchost.exe')?","This question aims to catch typosquatting, where an adversary uses a filename that is visually very similar to a real system file. By calculating the string similarity (e.g., Levenshtein distance) between a new process name and a list of known critical process names, we can flag suspicious, near-miss names for review.","Windows Event ID 4688; Sysmon Event ID 1; All enterprise endpoints, email gateways, web proxies, and file shares",last 90 days,": FOR each process creation, CALCULATE string_distance(process_name, critical_process_list). ALERT if distance is high but not an exact match.",playbooks/attack/enterprise/T1036.yml
T1036: Masquerading,f4b1b1b0-5a1a-4b0a-8c1a-1b1b1b1b1b1b,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0005: Defense Evasion,n; o; n; e,6,Can we use a machine learning model to classify filenames as suspicious based on their character-level patterns?,"Sophisticated adversaries may create deceptive filenames that don't match simple regex or typosquatting checks. This question proposes using a model (like a CNN) that learns the subtle sequence and structural patterns of malicious filenames from a large dataset, allowing it to identify novel or complex deceptive naming schemes.","Windows Event ID 4688; Sysmon Event ID 1; All enterprise endpoints, email gateways, web proxies, and file shares",last 90 days,: CLASSIFY new process filenames using a trained character-level CNN model. ALERT on 'suspicious' classification.,playbooks/attack/enterprise/T1036.yml
T1036: Masquerading,f4b1b1b0-5a1a-4b0a-8c1a-1b1b1b1b1b1b,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0005: Defense Evasion,n; o; n; e,7,"Is a legitimate system process (e.g., svchost.exe) executing from a non-standard file path?","System binaries are expected to run from specific, protected directories like C:\Windows\System32. An adversary may place a malicious file with the same name in a different, often user-writable, location (e.g., C:\Users\Public). This question helps detect such anomalies by comparing the execution path against a strict allowlist of known-good locations for that process name.","Windows Event ID 4688; Sysmon Event ID 1; All enterprise endpoints (workstations, servers), especially user-writable directories (e.g., C:\Users\*, C:\ProgramData, C:\Temp, C:\Perflogs)",last 90 days,: SEARCH process creation logs WHERE process_name is in critical_list AND execution_path is NOT in allowed_paths_for_process.,playbooks/attack/enterprise/T1036.yml
T1036: Masquerading,f4b1b1b0-5a1a-4b0a-8c1a-1b1b1b1b1b1b,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0005: Defense Evasion,n; o; n; e,8,Is a critical system process executing from a statistically rare file path compared to enterprise-wide activity?,"Even without a strict allowlist, normal system activity creates a predictable pattern of execution paths. This question helps find outliers by building a frequency distribution of execution locations for each critical process. An execution from a path that is statistically rare (e.g., in the bottom 1% of frequency) is highly suspicious and could indicate a masquerading attempt.","Windows Event ID 4688; Sysmon Event ID 1; All enterprise endpoints (workstations, servers), especially user-writable directories (e.g., C:\Users\*, C:\ProgramData, C:\Temp, C:\Perflogs)",last 90 days,": FOR each process, calculate frequency of its execution path. ALERT if frequency for a critical process is below a low percentile threshold (e.g., 1st percentile).",playbooks/attack/enterprise/T1036.yml
T1036: Masquerading,f4b1b1b0-5a1a-4b0a-8c1a-1b1b1b1b1b1b,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0005: Defense Evasion,n; o; n; e,9,Can we identify anomalous clusters of system binaries running from unusual locations?,"This question uses clustering algorithms to group process executions based on file path characteristics. Normal activity will form large, dense clusters (e.g., svchost.exe in System32). Masquerading attacks will often appear as small, isolated clusters in unusual locations (e.g., a few instances of rundll32.exe in a user's music folder), making them easy to spot as anomalies.","Windows Event ID 4688; Sysmon Event ID 1; All enterprise endpoints (workstations, servers), especially user-writable directories (e.g., C:\Users\*, C:\ProgramData, C:\Temp, C:\Perflogs)",last 90 days,": CLUSTER process executions using path-derived features (e.g., directory depth, path strings). INVESTIGATE small, outlier clusters of system binaries.",playbooks/attack/enterprise/T1036.yml
T1036: Masquerading,f4b1b1b0-5a1a-4b0a-8c1a-1b1b1b1b1b1b,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0005: Defense Evasion,n; o; n; e,10,Is a process running where its on-disk filename does not match the 'OriginalFilename' specified in its PE metadata?,"When a file is compiled, its original name is often embedded in the PE header metadata. Adversaries may rename a malicious file (e.g., 'malware.exe' to 'svchost.exe'), but they often neglect to change this internal metadata. This question checks for this discrepancy, which is a strong indicator that the file has been renamed to masquerade as something else.","Sysmon Event ID 1; All enterprise endpoints (workstations, servers), Domain Controllers",last 90 days,: SEARCH Sysmon Event ID 1 logs WHERE basename(Image) != OriginalFileName and process_name NOT IN exception_list.,playbooks/attack/enterprise/T1036.yml
T1036: Masquerading,f4b1b1b0-5a1a-4b0a-8c1a-1b1b1b1b1b1b,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0005: Defense Evasion,n; o; n; e,11,Are there new or rare combinations of on-disk filenames and internal PE metadata names appearing in the environment?,"This question seeks to identify masquerading by baselining all combinations of filenames and their internal PE names. A legitimate 'svchost.exe' will consistently have an internal name of 'svchost.exe'. A newly observed or extremely rare triplet (e.g., Image: 'svchost.exe', OriginalFileName: 'evil.exe') is highly indicative of a renamed malicious file.","Sysmon Event ID 1; All enterprise endpoints (workstations, servers), Domain Controllers",last 90 days,": BASELINE all (Image, OriginalFileName, InternalName) triplets. ALERT on new or low-frequency triplets.",playbooks/attack/enterprise/T1036.yml
T1036: Masquerading,f4b1b1b0-5a1a-4b0a-8c1a-1b1b1b1b1b1b,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0005: Defense Evasion,n; o; n; e,12,Can a machine learning model predict masquerading based on discrepancies between on-disk filenames and PE header metadata?,"This question proposes a predictive model to automate the detection of filename/metadata mismatches. By training a model on features like name equality flags, signer information, and file path, it can learn to score the likelihood of masquerading, providing a more nuanced detection than a simple rule and helping to prioritize alerts.","Sysmon Event ID 1; All enterprise endpoints (workstations, servers), Domain Controllers",last 90 days,": SCORE process executions using a trained decision tree. FEATURES: (Image_name == OriginalFileName), signer_info, path. ALERT on high masquerading score.",playbooks/attack/enterprise/T1036.yml
T1036: Masquerading,f4b1b1b0-5a1a-4b0a-8c1a-1b1b1b1b1b1b,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0005: Defense Evasion,n; o; n; e,13,Is a critical system process being launched by an atypical parent process?,"Legitimate system processes have predictable parent-child relationships (e.g., 'wininit.exe' is the only expected parent of 'lsass.exe'). An adversary might cause an unusual process, like Microsoft Word, to spawn a command shell (cmd.exe). This question looks for violations of these expected relationships, which are strong indicators of malicious activity.","Windows Event ID 4688; Sysmon Event ID 1; All enterprise endpoints, especially user workstations and application servers running software like Microsoft Office or Adobe Reader.",last 90 days,": SEARCH for forbidden parent-child process relationships (e.g., Parent: winword.exe, Child: cmd.exe; Parent: NOT wininit.exe, Child: lsass.exe).",playbooks/attack/enterprise/T1036.yml
T1036: Masquerading,f4b1b1b0-5a1a-4b0a-8c1a-1b1b1b1b1b1b,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0005: Defense Evasion,n; o; n; e,14,Are there any statistically rare or never-before-seen parent-child process relationships occurring?,"This question moves beyond a fixed list of bad relationships to a probabilistic approach. By modeling all parent-child process relationships over time, we can calculate the probability of any given pairing. A new pairing that has never been seen before or has an extremely low probability is highly anomalous and warrants immediate investigation.","Windows Event ID 4688; Sysmon Event ID 1; All enterprise endpoints, especially user workstations and application servers running software like Microsoft Office or Adobe Reader.",last 90 days,: CALCULATE P(Child | Parent) for all process executions. ALERT if probability is below a threshold or the pair is new.,playbooks/attack/enterprise/T1036.yml
T1036: Masquerading,f4b1b1b0-5a1a-4b0a-8c1a-1b1b1b1b1b1b,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0005: Defense Evasion,n; o; n; e,15,Can we detect anomalous process lineage using a graph-based model?,"This question models the entire enterprise's process activity as a graph, where nodes are processes and edges are parent-child relationships. This allows for the detection of unusual connections between different 'communities' in the graph, such as an edge suddenly appearing between an 'Office Application' community and a 'System Tool' community, which could signify malicious code execution.","Windows Event ID 4688; Sysmon Event ID 1; All enterprise endpoints, especially user workstations and application servers running software like Microsoft Office or Adobe Reader.",last 90 days,": MODEL process lineage as a graph. IDENTIFY low-weight edges connecting disparate communities (e.g., Office Apps -> System Tools).",playbooks/attack/enterprise/T1036.yml
T1036: Masquerading,f4b1b1b0-5a1a-4b0a-8c1a-1b1b1b1b1b1b,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0005: Defense Evasion,n; o; n; e,16,"Is a process with a known Microsoft binary name running but is unsigned, has an invalid signature, or is signed by a non-Microsoft publisher?",Legitimate Microsoft system binaries are digitally signed by Microsoft to guarantee their authenticity. An adversary might create a malicious file named 'explorer.exe' but it will lack a valid Microsoft signature. This question checks the signature status of critical processes to verify their integrity.,"Sysmon Event ID 1; Windows Event ID 4688; All enterprise endpoints (workstations, servers), code signing servers",last 90 days,": FOR critical Microsoft process names, ALERT if SignatureStatus is not 'Valid' or Signature is not from Microsoft.",playbooks/attack/enterprise/T1036.yml
T1036: Masquerading,f4b1b1b0-5a1a-4b0a-8c1a-1b1b1b1b1b1b,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0005: Defense Evasion,n; o; n; e,17,"Is a process that is almost always signed by Microsoft suddenly seen with a new, non-Microsoft signer or as unsigned?","This question uses a statistical approach to detect signature anomalies. While a simple rule checks for a valid Microsoft signature, this method baselines the signers for each process. If a process like 'lsass.exe', which is signed by Microsoft 99.9%+ of the time, is suddenly seen with a different signer or no signer, it is a high-confidence indicator of a problem.","Sysmon Event ID 1; Windows Event ID 4688; All enterprise endpoints (workstations, servers), code signing servers",last 90 days,": BASELINE all (Process Name, Signer) pairs. ALERT when a typically Microsoft-signed process appears with a new or null signer.",playbooks/attack/enterprise/T1036.yml
T1036: Masquerading,f4b1b1b0-5a1a-4b0a-8c1a-1b1b1b1b1b1b,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0005: Defense Evasion,n; o; n; e,18,Can a machine learning model flag executions where the combination of process name and signature information is anomalous?,This question leverages a machine learning model to find subtle signature anomalies. A technically valid signature from a lesser-known publisher on a critical system process might not violate a simple rule but is highly suspicious. A model can learn these normal and abnormal combinations of features to flag such unusual events.,"Sysmon Event ID 1; Windows Event ID 4688; All enterprise endpoints (workstations, servers), code signing servers",last 90 days,": USE a Naive Bayes classifier on features (process_name, is_signed, signer_name, signer_prevalence) to flag anomalous signature combinations.",playbooks/attack/enterprise/T1036.yml
T1036: Masquerading,f4b1b1b0-5a1a-4b0a-8c1a-1b1b1b1b1b1b,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0005: Defense Evasion,n; o; n; e,19,"Is a common system utility (e.g., powershell.exe, certutil.exe) being run with known obfuscated command-line arguments?","Adversaries abuse legitimate system utilities ('Living Off The Land' binaries) to execute malicious code. They often use specific command-line switches to run encoded or hidden commands (e.g., powershell.exe -encodedcommand). This question looks for these known malicious patterns in command-line logs.","Windows Event ID 4688; Sysmon Event ID 1; Zeek http.log; All enterprise endpoints (workstations, servers), DMZ servers, Domain Controllers, Web Proxies",last 90 days,": SEARCH process command lines for known obfuscation indicators like '-enc', 'FromBase64String', or suspicious LOLBAS usage patterns.",playbooks/attack/enterprise/T1036.yml
T1036: Masquerading,f4b1b1b0-5a1a-4b0a-8c1a-1b1b1b1b1b1b,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0005: Defense Evasion,n; o; n; e,20,Is a system utility being executed with command-line arguments that are abnormally long or have unusually high entropy?,"Benign use of system utilities typically involves short, readable commands. Adversaries often pass long, obfuscated, or encrypted scripts as command-line arguments. This results in arguments that are statistically anomalous in their length and character randomness (entropy). This question establishes a baseline for normal command lines and alerts on outliers.","Windows Event ID 4688; Sysmon Event ID 1; Zeek http.log; All enterprise endpoints (workstations, servers), DMZ servers, Domain Controllers, Web Proxies",last 90 days,": FOR each system utility, baseline command-line length and entropy. ALERT when a new execution exceeds the 98th percentile for either metric.",playbooks/attack/enterprise/T1036.yml
T1036: Masquerading,f4b1b1b0-5a1a-4b0a-8c1a-1b1b1b1b1b1b,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0005: Defense Evasion,n; o; n; e,21,Can we identify outlier clusters of command-line arguments for system utilities?,"This question uses clustering to group similar command-line arguments together. Normal administrative scripts and user activity will form large, well-defined clusters. Malicious and obfuscated commands are often unique and will form small, isolated clusters or be identified as noise, making them easy to spot and investigate.","Windows Event ID 4688; Sysmon Event ID 1; Zeek http.log; All enterprise endpoints (workstations, servers), DMZ servers, Domain Controllers, Web Proxies",last 90 days,": VECTORIZE command-line arguments with TF-IDF and run a clustering algorithm (e.g., K-Means). INVESTIGATE small, outlier clusters.",playbooks/attack/enterprise/T1036.yml
T1041: Exfiltration Over C2 Channel,f5d4a1b2-c3e4-4f5a-b6c7-d8e9f0a1b2c3,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,1,Are there network connections to known C2 servers with high outbound data volumes and ratios?,"Adversaries often reuse established C2 channels for data exfiltration. While beaconing traffic is typically small and regular, exfiltration involves sending large amounts of data out of the network. This question seeks to identify connections to known malicious infrastructure where the outbound data volume is significantly larger than the inbound, a classic indicator of data theft. A high static threshold helps catch blatant, large-scale exfiltration attempts.",Zeek conn.log; Zeek dns.log; Zeek http.log; Internet Gateway; DNS Resolvers; Web Proxies,last 90 days,: SEARCH conn.log WHERE dest_ip IN c2_intel_feed AND outbound_bytes > 1MB AND (outbound_bytes / inbound_bytes) > 10,playbooks/attack/enterprise/T1041.yml
T1041: Exfiltration Over C2 Channel,f5d4a1b2-c3e4-4f5a-b6c7-d8e9f0a1b2c3,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,2,Are there any connections to known C2 indicators that show a statistically significant increase in outbound data compared to their historical baseline?,"Sophisticated adversaries may try to blend in by avoiding large, single-session data transfers. This question aims to detect more subtle exfiltration by establishing a baseline of normal outbound traffic for each known C2 channel. An alert is triggered when a new connection's data volume significantly exceeds this established norm (e.g., 95th percentile), which can indicate exfiltration disguised as regular C2 communication.",Zeek conn.log; Zeek dns.log; Zeek http.log; Internet Gateway; DNS Resolvers; Web Proxies,last 90 days,": FOR each c2_indicator, baseline = 95th_percentile(outbound_bytes, last 30 days). SEARCH conn.log WHERE dest IN c2_indicator AND outbound_bytes > (baseline * 1.5).",playbooks/attack/enterprise/T1041.yml
T1041: Exfiltration Over C2 Channel,f5d4a1b2-c3e4-4f5a-b6c7-d8e9f0a1b2c3,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,3,Can machine learning models predict which connections to known C2 indicators are likely for data exfiltration versus normal beaconing?,"This question explores a proactive, predictive approach to identifying exfiltration. By training a classification model on features like data volume, byte ratios, and connection duration, it's possible to distinguish between routine C2 check-ins and active data theft. This method automates the detection of exfiltration patterns that might be too complex or subtle for simple threshold-based rules.",Zeek conn.log; Zeek dns.log; Zeek http.log; Internet Gateway; DNS Resolvers; Web Proxies,last 90 days,": features = [outbound_bytes, inbound_bytes, ratio, duration, packet_timing]. PREDICT connection_state using trained_model(features). ALERT if prediction is 'C2 Exfiltration'.",playbooks/attack/enterprise/T1041.yml
T1041: Exfiltration Over C2 Channel,f5d4a1b2-c3e4-4f5a-b6c7-d8e9f0a1b2c3,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,4,Are there any HTTP/S connections matching known C2 signatures that also exhibit a high outbound-to-inbound data ratio?,"C2 frameworks often have unique fingerprints in network traffic, such as specific User-Agents, URI patterns, or TLS JA3/S hashes. This question combines signature-based detection with volume analysis. By correlating traffic that matches a known C2 signature with a high outbound data ratio, analysts can more confidently identify that the C2 channel is being used for exfiltration.",Zeek http.log; Zeek ssl.log; Zeek conn.log; Internet Gateway; Application Servers; Web Proxies,last 90 days,": SEARCH http.log, ssl.log WHERE user_agent OR uri OR ja3s_hash IN c2_signatures. JOIN with conn.log ON connection_id. ALERT if (outbound_bytes / inbound_bytes) > 10.",playbooks/attack/enterprise/T1041.yml
T1041: Exfiltration Over C2 Channel,f5d4a1b2-c3e4-4f5a-b6c7-d8e9f0a1b2c3,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,5,"Do any web requests matching C2 signatures show high entropy in their URI or TLS server name, suggesting encoded data?","To hide exfiltrated data, adversaries may encode it within parts of an HTTP/S request, such as the URI path or TLS server name. This encoding often results in a high degree of randomness, which can be measured using Shannon entropy. This question seeks to identify C2-related traffic where these fields appear unusually random, suggesting they are being used as a covert channel for data transfer.",Zeek http.log; Zeek ssl.log; Zeek conn.log; Internet Gateway; Application Servers; Web Proxies,last 90 days,: SEARCH traffic WHERE signature IN c2_signatures. CALCULATE entropy(uri_path) or entropy(tls_server_name). ALERT if entropy_score > 3.5.,playbooks/attack/enterprise/T1041.yml
T1041: Exfiltration Over C2 Channel,f5d4a1b2-c3e4-4f5a-b6c7-d8e9f0a1b2c3,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,6,Can a machine learning classifier identify C2 exfiltration within TLS traffic based on connection and encryption features?,"Encrypted TLS traffic hides the content of exfiltrated data, making detection difficult. However, metadata can still be revealing. This question proposes using a machine learning model (like a Random Forest) to analyze TLS and connection metadata (JA3/S hash, cipher suite, duration, byte counts) to identify patterns indicative of exfiltration over C2, even without decrypting the traffic.",Zeek http.log; Zeek ssl.log; Zeek conn.log; Internet Gateway; Application Servers; Web Proxies,last 90 days,": features = [ja3s_hash, cipher, tls_version, duration, outbound_bytes, ratio]. PREDICT session_type using trained_rf_model(features). ALERT if prediction is 'C2-Exfil' with confidence > 0.90.",playbooks/attack/enterprise/T1041.yml
T1041: Exfiltration Over C2 Channel,f5d4a1b2-c3e4-4f5a-b6c7-d8e9f0a1b2c3,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,7,"Has any host initiated an unusually large, single-session data transfer over a common C2 port?","A straightforward method of exfiltration is to send a large amount of data in a single connection over a common, often-allowed port like 80 (HTTP), 443 (HTTPS), or 53 (DNS). This question looks for these blatant exfiltration attempts by flagging any single connection that exceeds a high static threshold (e.g., 500MB), while filtering out known legitimate services like corporate backups.",Zeek conn.log; Zeek dns.log; Zeek http.log; Internet Gateway; Core Network Switches; Servers hosting sensitive data,last 90 days,": SEARCH conn.log WHERE dest_port IN (80, 443, 53) AND outbound_bytes > 500MB AND dest_ip NOT IN allowlist.",playbooks/attack/enterprise/T1041.yml
T1041: Exfiltration Over C2 Channel,f5d4a1b2-c3e4-4f5a-b6c7-d8e9f0a1b2c3,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,8,Has any host's hourly outbound data volume for a specific service significantly exceeded its own historical baseline?,"This question focuses on detecting anomalous behavior at the host level. By creating a historical baseline of outbound traffic for each host and service (port), it's possible to spot deviations from normal activity. An alert is triggered if a host suddenly starts sending much more data than it usually does over a particular service, which could indicate that a compromised machine is being used for exfiltration.",Zeek conn.log; Zeek dns.log; Zeek http.log; Internet Gateway; Core Network Switches; Servers hosting sensitive data,last 90 days,": FOR each host, service_port, baseline = 99th_percentile(hourly_outbound_bytes, last 30 days). SEARCH aggregated_logs WHERE hourly_outbound_bytes > baseline.",playbooks/attack/enterprise/T1041.yml
T1041: Exfiltration Over C2 Channel,f5d4a1b2-c3e4-4f5a-b6c7-d8e9f0a1b2c3,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,9,Can a time-series anomaly detection model identify abnormal spikes in a host's egress traffic?,"Host network traffic often follows predictable daily and weekly patterns (seasonality). This question proposes using a time-series model (like ARIMA) to learn these patterns for each host. The model can then predict the expected range of traffic volume for any given time. An alert is generated when the actual traffic falls outside this predicted range, indicating a statistically significant anomaly that could be exfiltration.",Zeek conn.log; Zeek dns.log; Zeek http.log; Internet Gateway; Core Network Switches; Servers hosting sensitive data,last 90 days,": FOR each host, train time_series_model on 15-min outbound_byte_counts. PREDICT confidence_interval for current_time. ALERT if observed_bytes is outside interval.",playbooks/attack/enterprise/T1041.yml
T1041: Exfiltration Over C2 Channel,f5d4a1b2-c3e4-4f5a-b6c7-d8e9f0a1b2c3,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,10,Was a process creation event for an archiving tool followed shortly by a large outbound network connection from the same host?,"Before exfiltrating data, adversaries often collect and compress it into a single archive file. This is known as staging. This question seeks to correlate on-host staging activity (e.g., running 7z.exe, tar) with subsequent network activity. An alert is triggered if a large outbound connection occurs within a short window (e.g., 15 minutes) after an archiving tool is used, providing strong evidence of a ""smash and grab"" exfiltration event.",Windows Event ID 4688; Zeek conn.log; User Endpoints; File Servers; Domain Controllers; Application Servers,last 90 days,": SEARCH process_events WHERE process_name IN (7z.exe, rar.exe, zip.exe). CORRELATE with network_logs FROM same_host within 15 mins. ALERT if outbound_bytes > 100MB.",playbooks/attack/enterprise/T1041.yml
T1041: Exfiltration Over C2 Channel,f5d4a1b2-c3e4-4f5a-b6c7-d8e9f0a1b2c3,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,11,"Following the use of an archiving tool on a host, did that host make a network connection that was statistically anomalous in size compared to its normal behavior?","Instead of using a fixed threshold for data size, this question uses the host's own behavior as a baseline. After detecting potential staging activity (use of an archiving tool), it analyzes subsequent network connections from that host. A connection is flagged as suspicious if its size is a statistical outlier (e.g., more than 3 standard deviations from the mean), indicating an unusually large data transfer for that specific host immediately after data was likely staged.",Windows Event ID 4688; Zeek conn.log; User Endpoints; File Servers; Domain Controllers; Application Servers,last 90 days,": ON process_event for archiving_tool, baseline = mean/std_dev(outbound_bytes) for host. SEARCH network_logs FROM same_host within 30 mins. ALERT if outbound_bytes > (mean + 3*std_dev).",playbooks/attack/enterprise/T1041.yml
T1041: Exfiltration Over C2 Channel,f5d4a1b2-c3e4-4f5a-b6c7-d8e9f0a1b2c3,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,12,Can sequence analysis of event logs identify high-risk patterns of staging followed by exfiltration?,"Adversary actions often follow a logical sequence (e.g., run whoami, run 7z.exe, create network connection). This question proposes using advanced analytics like sequence mining or Hidden Markov Models to learn these multi-step attack patterns from various log sources. Once a high-risk sequence is learned, the model can proactively identify and alert on new activity that matches the ""staging and exfiltration"" pattern.",Windows Event ID 4688; Zeek conn.log; User Endpoints; File Servers; Domain Controllers; Application Servers,last 90 days,": TRAIN sequence_model on event_logs (process_create, file_create, network_connect). APPLY model to new event sequences. ALERT if sequence matches 'staging_exfil_pattern' with high probability.",playbooks/attack/enterprise/T1041.yml
T1041: Exfiltration Over C2 Channel,f5d4a1b2-c3e4-4f5a-b6c7-d8e9f0a1b2c3,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,13,Are there any long-duration network connections with a highly asymmetric outbound-to-inbound data ratio?,"Some exfiltration techniques, often called ""low and slow,"" involve sending data over a very long-lived connection to avoid detection based on traffic volume spikes. This question targets such activity by searching for connections that last for an unusually long time (e.g., > 10 minutes) and consistently send far more data than they receive (e.g., 20:1 ratio), which is uncharacteristic of most legitimate interactive services.",Zeek conn.log; Internet Gateway; VPN Concentrators; Egress Firewalls,last 90 days,: SEARCH conn.log WHERE duration > 600s AND (outbound_bytes / inbound_bytes) > 20 AND dest_ip NOT IN allowlist.,playbooks/attack/enterprise/T1041.yml
T1041: Exfiltration Over C2 Channel,f5d4a1b2-c3e4-4f5a-b6c7-d8e9f0a1b2c3,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,14,"For long-duration connections, does the outbound-to-inbound byte ratio exceed the normal baseline for that specific destination port?","Different services naturally have different traffic profiles. A long-lived SSH session will look different from a long-lived database replication stream. This question refines the detection of ""low and slow"" exfiltration by creating a dynamic baseline. It calculates the normal byte ratio for long-running connections on a per-port basis. An alert is then triggered only if a new long-lived connection's byte ratio is a statistical outlier for its specific port.",Zeek conn.log; Internet Gateway; VPN Concentrators; Egress Firewalls,last 90 days,": FOR each dest_port, baseline_ratio = 99th_percentile(byte_ratio) for connections where duration > 600s. SEARCH conn.log WHERE duration > 600s and byte_ratio > baseline_ratio.",playbooks/attack/enterprise/T1041.yml
T1041: Exfiltration Over C2 Channel,f5d4a1b2-c3e4-4f5a-b6c7-d8e9f0a1b2c3,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,15,Can clustering algorithms identify anomalous network connections that do not fit any normal traffic profile?,"This question proposes an unsupervised machine learning approach to find novel or unusual exfiltration methods. By applying a clustering algorithm (like DBSCAN) to all network connections based on features like duration, byte counts, and protocol, we can group them into clusters of ""normal"" behavior. Any connection that doesn't fit into a cluster (identified as noise or an anomaly) is a strong candidate for investigation, as its characteristics are unlike any other typical traffic on the network.",Zeek conn.log; Internet Gateway; VPN Concentrators; Egress Firewalls,last 90 days,": features = [duration, outbound_bytes, inbound_bytes, ratio, proto]. APPLY DBSCAN clustering on all connections. INVESTIGATE points classified as noise/anomalies.",playbooks/attack/enterprise/T1041.yml
T1047: Windows Management Instrumentation,f4d4f8e8-3a1b-4b9c-8f0a-1e2d3c4b5a6b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,1,"Are there any WMI-related command-line arguments or PowerShell script blocks that match known malicious strings, commands, or obfuscation flags?","This question aims to find direct evidence of malicious WMI usage by searching for specific, known-bad indicators. Adversaries often use commands like ""wmic.exe shadowcopy delete"" to destroy backups or ""process call create"" for execution. Similarly, PowerShell obfuscation flags like ""-e"", ""-enc"", or ""-EncodedCommand"" are common techniques to hide malicious payloads executed via WMI. Detecting these provides a high-confidence signal of compromise.",Windows Event ID 4688; Windows PowerShell Event ID 4104; Windows PowerShell Event ID 4103; Applicable to All Windows Endpoints and Servers,last 90 days,: ,playbooks/attack/enterprise/T1047.yml
T1047: Windows Management Instrumentation,f4d4f8e8-3a1b-4b9c-8f0a-1e2d3c4b5a6b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,2,Are there any WMI-related command lines or PowerShell script blocks with unusually high character entropy compared to the host-specific baseline?,"Adversaries frequently obfuscate or encode their commands to evade simple string-based detections. This obfuscation often results in a command line with high character randomness, or entropy. By calculating the entropy of WMI command lines and comparing it to a learned baseline for each host, we can detect potentially obfuscated malicious commands that would otherwise be missed. An alert on a high entropy score suggests an attempt to hide execution.",Windows Event ID 4688; Windows PowerShell Event ID 4104; Windows PowerShell Event ID 4103; Applicable to All Windows Endpoints and Servers,last 90 days,: ,playbooks/attack/enterprise/T1047.yml
T1047: Windows Management Instrumentation,f4d4f8e8-3a1b-4b9c-8f0a-1e2d3c4b5a6b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,3,"Have any WMI-related command lines been classified as malicious by a machine learning model based on features like length, entropy, and keyword presence?","This question leverages a machine learning model to provide a more nuanced and adaptive detection method than static rules or simple statistical thresholds. By training a classifier on a variety of features (e.g., command length, entropy, specific keywords), the model can identify complex patterns indicative of malicious activity. A high probability score from the model serves as a strong indicator that a WMI command is malicious, even if it uses novel obfuscation techniques.",Windows Event ID 4688; Windows PowerShell Event ID 4104; Windows PowerShell Event ID 4103; Applicable to All Windows Endpoints and Servers,last 90 days,: ,playbooks/attack/enterprise/T1047.yml
T1047: Windows Management Instrumentation,f4d4f8e8-3a1b-4b9c-8f0a-1e2d3c4b5a6b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,4,Has WMI been used to create a persistent event subscription or to directly create a process or delete shadow copies?,"This question looks for specific, high-confidence indicators of malicious WMI usage for persistence, execution, and defense evasion. Creating a WMI event subscription via ""__FilterToConsumerBinding"" is a well-known persistence technique. Similarly, direct calls to ""Win32_Process.Create"" for execution or ""Win32_ShadowCopy.Delete"" to destroy backups are strong signs of malicious intent.","Microsoft-Windows-WMI-Activity/Operational Event ID 5861; Windows Event ID 4688; Windows PowerShell Event ID 4104; Applicable to Domain Controllers, Critical Application Servers, Management Servers",last 90 days,: ,playbooks/attack/enterprise/T1047.yml
T1047: Windows Management Instrumentation,f4d4f8e8-3a1b-4b9c-8f0a-1e2d3c4b5a6b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,5,Has any user or host invoked a WMI class and method pair that is statistically rare for that entity or for the entire organization?,"Legitimate software and administrative tasks tend to use a predictable set of WMI classes and methods. Adversaries, however, may use less common combinations for malicious purposes. By baselining normal WMI activity for each user and host, we can identify deviations. An alert on a statistically rare WMI class/method pair suggests an unusual action that may be part of an attack, such as lateral movement or reconnaissance.","Microsoft-Windows-WMI-Activity/Operational Event ID 5861; Windows Event ID 4688; Windows PowerShell Event ID 4104; Applicable to Domain Controllers, Critical Application Servers, Management Servers",last 90 days,: ,playbooks/attack/enterprise/T1047.yml
T1047: Windows Management Instrumentation,f4d4f8e8-3a1b-4b9c-8f0a-1e2d3c4b5a6b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,6,"Have any sequences of WMI calls been observed that deviate significantly from learned normal behavior, as identified by an autoencoder model?","This question uses an unsupervised learning approach to detect novel attack patterns. An autoencoder is trained to ""reconstruct"" normal sequences of WMI calls. When it encounters a malicious sequence that does not fit the learned patterns (e.g., reconnaissance followed by execution), it will fail to reconstruct it accurately, resulting in a high ""reconstruction error."" This technique can flag sophisticated, multi-step WMI-based attacks that might not trigger individual rule-based alerts.","Microsoft-Windows-WMI-Activity/Operational Event ID 5861; Windows Event ID 4688; Windows PowerShell Event ID 4104; Applicable to Domain Controllers, Critical Application Servers, Management Servers",last 90 days,: ,playbooks/attack/enterprise/T1047.yml
T1047: Windows Management Instrumentation,f4d4f8e8-3a1b-4b9c-8f0a-1e2d3c4b5a6b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,7,"Are there any network connections on WMI-related ports (135, 5985, 5986) between hosts that are not on the approved communication allow-list?","This question aims to detect lateral movement using WMI by enforcing network segmentation rules. Legitimate remote WMI usage typically originates from a small set of dedicated management servers. Any WMI traffic between hosts that are not on this pre-approved list, especially workstation-to-workstation traffic, is highly suspicious and could indicate an adversary moving through the network.","Zeek conn.log; Zeek dce_rpc.log; Applicable to Network Egress/Ingress Points, Core Network Switches, Server VLANs",last 90 days,: ,playbooks/attack/enterprise/T1047.yml
T1047: Windows Management Instrumentation,f4d4f8e8-3a1b-4b9c-8f0a-1e2d3c4b5a6b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,8,Has the volume of network traffic on WMI-related ports significantly exceeded the statistically forecasted baseline for any network segment or key server?,"Adversaries using WMI for large-scale lateral movement (e.g., deploying ransomware) or data exfiltration will generate a significant spike in network traffic. This question uses time-series analysis to model normal traffic patterns on WMI ports. A sudden, anomalous increase in byte volume or connection counts that exceeds the forecasted norm is a strong indicator of a widespread, automated attack.","Zeek conn.log; Zeek dce_rpc.log; Applicable to Network Egress/Ingress Points, Core Network Switches, Server VLANs",last 90 days,: ,playbooks/attack/enterprise/T1047.yml
T1047: Windows Management Instrumentation,f4d4f8e8-3a1b-4b9c-8f0a-1e2d3c4b5a6b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,9,"Does the network communication graph show anomalous new connections between host communities or a sudden increase in a host's importance, suggesting WMI-based lateral movement?","This question models the network as a graph to identify sophisticated lateral movement patterns. In this model, hosts are nodes and WMI connections are edges. An adversary moving between different network segments (e.g., from a compromised development machine to a finance server) creates a new, anomalous edge in the graph. Similarly, if an adversary uses a single machine to pivot to many others, that machine's ""centrality"" in the graph will spike. This approach detects the structural changes in communication patterns caused by an attack.","Zeek conn.log; Zeek dce_rpc.log; Applicable to Network Egress/Ingress Points, Core Network Switches, Server VLANs",last 90 days,: ,playbooks/attack/enterprise/T1047.yml
T1047: Windows Management Instrumentation,f4d4f8e8-3a1b-4b9c-8f0a-1e2d3c4b5a6b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,10,Has a remote network logon been immediately followed by WMI-based process execution originating from the same source IP address?,"This question correlates two distinct events to build a high-fidelity picture of remote execution. A remote logon (Logon Type 3) followed closely by WMI-based process creation from the same source IP is the classic signature for an adversary using WMI for lateral movement. By linking the authentication event with the execution event, we can confidently identify remote attacks in progress. This becomes especially critical if the source is not a known management server.","Windows Event ID 4624; Windows Event ID 4688; Windows PowerShell Event ID 4104; Zeek conn.log; Applicable to Authentication Servers (Domain Controllers), High-Value Servers, Endpoint Subnets",last 90 days,: ,playbooks/attack/enterprise/T1047.yml
T1047: Windows Management Instrumentation,f4d4f8e8-3a1b-4b9c-8f0a-1e2d3c4b5a6b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,11,"Has a user account initiated a remote WMI session from an unusual source host, to an unusual destination host, or at an unusual time compared to their established profile?","This question seeks to identify credential abuse by baselining user-specific remote WMI behavior. System administrators typically have predictable patterns of remote access. If an adversary compromises an administrator's account, they are likely to use it in ways that deviate from this pattern—for example, logging in from a different workstation, accessing a server they don't normally manage, or performing actions outside of normal business hours. Detecting these statistical outliers can reveal a compromised account.","Windows Event ID 4624; Windows Event ID 4688; Windows PowerShell Event ID 4104; Zeek conn.log; Applicable to Authentication Servers (Domain Controllers), High-Value Servers, Endpoint Subnets",last 90 days,: ,playbooks/attack/enterprise/T1047.yml
T1047: Windows Management Instrumentation,f4d4f8e8-3a1b-4b9c-8f0a-1e2d3c4b5a6b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,12,Have any remote WMI sessions been identified as anomalous because they do not fit into any established cluster of normal activity?,"This question uses unsupervised clustering to automatically define ""normal"" remote WMI activity without pre-defined rules. The DBSCAN algorithm groups historical sessions into clusters based on multiple features (source location, destination role, user role, time). A new WMI session that does not fit into any of these learned clusters is flagged as ""noise"" or an anomaly. This is a powerful method for detecting novel attack vectors, as it identifies activity that is fundamentally different from anything seen before.","Windows Event ID 4624; Windows Event ID 4688; Windows PowerShell Event ID 4104; Zeek conn.log; Applicable to Authentication Servers (Domain Controllers), High-Value Servers, Endpoint Subnets",last 90 days,: ,playbooks/attack/enterprise/T1047.yml
T1047: Windows Management Instrumentation,f4d4f8e8-3a1b-4b9c-8f0a-1e2d3c4b5a6b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,13,"Has a WMI-related process (wmic.exe, powershell.exe) been launched by a parent process that is not on the approved list of standard shells and administrative tools?","This question focuses on detecting suspicious process ancestry. Legitimate WMI execution is almost always initiated by a user in a command shell, a system service, or a management console. If a process like Microsoft Word (WINWORD.EXE) or a web browser spawns a WMI process, it is a very strong indicator of a phishing attack or drive-by download where a malicious macro or exploit is attempting to execute code.",Windows Event ID 4688; Windows PowerShell Event ID 4104; Applicable to All Windows Endpoints and Servers,last 90 days,: ,playbooks/attack/enterprise/T1047.yml
T1047: Windows Management Instrumentation,f4d4f8e8-3a1b-4b9c-8f0a-1e2d3c4b5a6b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,14,Has a WMI-related process been spawned by a parent process where that specific parent-child relationship is statistically rare across the enterprise?,"This question moves beyond a static allow-list to a probabilistic approach. By analyzing vast amounts of process creation data, we can determine the normal probability of any given parent process launching a WMI-related child. A process lineage that is extremely rare (e.g., has a very low calculated probability) is highly suspicious. This can help uncover novel or environment-specific attack techniques that might not be caught by a generic allow-list.",Windows Event ID 4688; Windows PowerShell Event ID 4104; Applicable to All Windows Endpoints and Servers,last 90 days,: ,playbooks/attack/enterprise/T1047.yml
T1047: Windows Management Instrumentation,f4d4f8e8-3a1b-4b9c-8f0a-1e2d3c4b5a6b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,15,"Has a machine learning model predicted that a WMI-related process creation event is malicious based on its full context (parent process, command line, user, etc.)?","This question employs a sophisticated classifier to make a holistic judgment about a process creation event. Instead of just looking at the parent process name, a random forest model can evaluate a wide array of features simultaneously, such as the parent's file path, its integrity level, the user who initiated the action, and the full command line of the child process. This allows it to detect subtle and complex malicious patterns that would be nearly impossible to define with rules or simple statistics.",Windows Event ID 4688; Windows PowerShell Event ID 4104; Applicable to All Windows Endpoints and Servers,last 90 days,: ,playbooks/attack/enterprise/T1047.yml
T1052: Exfiltration Over Physical Medium,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,1,Did a known malicious process write a file to a removable media device?,This question aims to identify high-confidence threats by correlating file write events to removable media with processes whose executable hashes are on a blocklist. A match indicates that a known malicious tool is attempting to exfiltrate data via a physical medium.,"Windows Event ID 4663; Windows Event ID 4688; Sysmon Event ID 1; Threat intelligence feeds; All endpoints (desktops, laptops), servers with accessible physical ports (e.g., USB), and workstations used by privileged accounts or users with access to sensitive data repositories.",last 90 days,"pseudocode: SEARCH file write events to removable media (WinEvent 4663). FOR EACH event, GET process ID. FIND process creation event (WinEvent 4688, Sysmon 1) with matching process ID. HASH the process executable. CHECK hash against threat intelligence blocklist. ALERT on match.",playbooks/attack/enterprise/T1052.yml
T1052: Exfiltration Over Physical Medium,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,2,Has a statistically rare or previously unseen process written files to a removable media device?,This question seeks to uncover anomalous activity by identifying processes that rarely or never write to removable media. Such behavior could indicate a legitimate but compromised process or a novel malicious tool being used for exfiltration.,"Windows Event ID 4663; Windows Event ID 4688; Sysmon Event ID 1; All endpoints (desktops, laptops), servers with accessible physical ports (e.g., USB), and workstations used by privileged accounts or users with access to sensitive data repositories.",last 90 days,"pseudocode: GET all processes that wrote to removable media in the last 90 days. CALCULATE frequency of each process name. ESTABLISH baseline. FOR new events, CHECK if the writing process is a statistical outlier (e.g., bottom 5% frequency) or has not been seen before. ALERT on outliers.",playbooks/attack/enterprise/T1052.yml
T1052: Exfiltration Over Physical Medium,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,3,Does a machine learning model classify a removable media write event as suspicious based on its process and file characteristics?,"This question leverages a machine learning model to classify the risk of a file write to removable media. The model analyzes a combination of features (process name, parent, integrity level, file type, signature) to identify complex patterns indicative of malicious exfiltration that might be missed by simple rules.","Windows Event ID 4663; Windows Event ID 4688; Sysmon Event ID 1; All endpoints (desktops, laptops), servers with accessible physical ports (e.g., USB), and workstations used by privileged accounts or users with access to sensitive data repositories.",last 90 days,"pseudocode: FOR each removable media write event, EXTRACT features (process name, parent process, integrity level, file extension, signature status). INPUT features into pre-trained classification model. ALERT if the model predicts 'suspicious' with high confidence.",playbooks/attack/enterprise/T1052.yml
T1052: Exfiltration Over Physical Medium,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,4,Was a command-line utility used to copy files from a sensitive location to a removable media drive?,"This question checks for explicit copy commands (e.g., xcopy, robocopy, Copy-Item) moving data from monitored sensitive directories to a removable drive, which is a direct indicator of potential data theft.","Windows Event ID 4688; Windows PowerShell Event ID 4104; Sysmon Event ID 1; All endpoints and servers with command-line auditing enabled, administrative jump boxes, developer workstations, and servers hosting critical data.",last 90 days,"pseudocode: SEARCH process creation logs for file transfer utilities (xcopy, robocopy, etc.). CHECK if source argument matches a sensitive path AND destination argument matches a removable drive path. ALERT on match.",playbooks/attack/enterprise/T1052.yml
T1052: Exfiltration Over Physical Medium,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,5,Did a command-line file copy operation to removable media involve unusually complex paths or an anomalously large number of files?,"This question aims to detect obfuscation or bulk data theft by analyzing command-line arguments. High path entropy can indicate attempts to hide file origins, and copying an unusually large number of files compared to a user's baseline suggests bulk exfiltration.","Windows Event ID 4688; Windows PowerShell Event ID 4104; Sysmon Event ID 1; All endpoints and servers with command-line auditing enabled, administrative jump boxes, developer workstations, and servers hosting critical data.",last 90 days,"pseudocode: FOR command-line copy operations to removable media, CALCULATE Shannon entropy of file paths. COMPARE to baseline. CALCULATE number of files being copied. COMPARE to user's historical average. ALERT if entropy or file count are statistical outliers.",playbooks/attack/enterprise/T1052.yml
T1052: Exfiltration Over Physical Medium,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,6,Does a sequence-based machine learning model identify a command-line operation involving removable media as anomalous?,"This question uses an anomaly detection model (like an LSTM autoencoder) to learn the structure of normal command-line usage. A command that deviates significantly from learned patterns, especially one involving removable media, is flagged as suspicious, catching novel or unusual exfiltration techniques.","Windows Event ID 4688; Windows PowerShell Event ID 4104; Sysmon Event ID 1; All endpoints and servers with command-line auditing enabled, administrative jump boxes, developer workstations, and servers hosting critical data.",last 90 days,"pseudocode: TOKENIZE new command lines involving removable media. INPUT token sequence into a trained sequence model (e.g., LSTM autoencoder). CALCULATE reconstruction error. ALERT if error is high, indicating an anomalous command structure.",playbooks/attack/enterprise/T1052.yml
T1052: Exfiltration Over Physical Medium,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,7,Was an archive file created and then immediately copied to a removable media device on the same host?,"This question identifies a classic ""stage-and-exfiltrate"" pattern where an adversary first collects and compresses data into an archive file before copying it to a physical device. Correlating these two events within a short time window is a strong indicator of malicious intent.","Windows Event ID 4688; Windows Event ID 4663; Sysmon Event ID 11; User workstations, file servers, staging servers, and temporary directories on application servers.",last 90 days,"pseudocode: WATCH for archive file creation events (Sysmon 11, or process creation for 7z.exe, etc.). IF detected, WATCH for a file write event (WinEvent 4663) for the same file name to a removable drive on the same host within 10 minutes. ALERT on this correlated sequence.",playbooks/attack/enterprise/T1052.yml
T1052: Exfiltration Over Physical Medium,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,8,Did a 'stage-and-copy' to removable media sequence involve an unusually large file size or occur with an unusually short time delay between staging and copying?,"This question refines the 'stage-and-copy' detection by looking for statistical extremes. An exceptionally large archive (e.g., >1 GB) or a very rapid copy after creation (e.g., <30 seconds) suggests an automated or deliberate bulk data theft operation, rather than a casual user action.","Windows Event ID 4688; Windows Event ID 4663; Sysmon Event ID 11; User workstations, file servers, staging servers, and temporary directories on application servers.",last 90 days,"pseudocode: FOR correlated 'stage-and-copy' events, ANALYZE archive file size and time delta between creation and copy. COMPARE to historical baselines. ALERT if file size is in the top percentile and/or time delta is in the bottom percentile.",playbooks/attack/enterprise/T1052.yml
T1052: Exfiltration Over Physical Medium,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,9,Does a time-series anomaly detection model flag the sequence of events corresponding to staging and copying a file to removable media as abnormal for a given host?,"This approach models all system activity on a host as a time series. It aims to detect the specific temporal pattern of 'create archive -> copy to USB' as a rare sequence that stands out from the host's normal operational rhythm, providing a sophisticated method for detecting this exfiltration technique.","Windows Event ID 4688; Windows Event ID 4663; Sysmon Event ID 11; User workstations, file servers, staging servers, and temporary directories on application servers.",last 90 days,"pseudocode: MODEL host event stream (process, file create, file write) as a time series. TRAIN anomaly detection model (e.g., Isolation Forest) on normal behavior. ALERT if the model identifies the specific sequence of 'archive creation followed by removable media write' as a rare, anomalous pattern.",playbooks/attack/enterprise/T1052.yml
T1052: Exfiltration Over Physical Medium,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,10,"Did a user write an excessive number of high-risk file types (e.g., .pst, .bak, .sql) to a removable media device within a short time frame?","This question focuses on the sensitivity of the data being exfiltrated. A rule that alerts when a user copies multiple sensitive file types (like email archives, database backups, or key stores) to a USB drive within an hour can quickly identify potential theft of critical information.","Windows Event ID 4663; Windows Event ID 4656; All endpoints with object access auditing enabled for removable storage, particularly those used by privileged users, executives, or personnel in sensitive roles (e.g., HR, Finance, R&D).",last 90 days,"pseudocode: FOR each user, MONITOR file writes to removable media. COUNT writes of files with high-risk extensions (.pst, .bak, .sql, etc.) within a 1-hour window. ALERT if the count exceeds a predefined threshold (e.g., >5 files).",playbooks/attack/enterprise/T1052.yml
T1052: Exfiltration Over Physical Medium,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,11,"Has a user's daily activity of writing to removable media deviated significantly from their established 30-day baseline across multiple metrics like data volume, file count, or file types?","This question establishes a profile of a user's normal behavior regarding removable media usage. An alert is triggered when a user's activity for a given day shows a multi-faceted deviation (e.g., unusually high volume AND high file count) from their own historical baseline, indicating a significant and suspicious change in behavior.","Windows Event ID 4663; Windows Event ID 4656; All endpoints with object access auditing enabled for removable storage, particularly those used by privileged users, executives, or personnel in sensitive roles (e.g., HR, Finance, R&D).",last 90 days,"pseudocode: MAINTAIN a 30-day rolling baseline for each user's daily removable media writes (volume, file count, etc.). FOR current day's activity, CALCULATE Z-score for each metric against the baseline. ALERT if two or more metrics have a Z-score > 3.",playbooks/attack/enterprise/T1052.yml
T1052: Exfiltration Over Physical Medium,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,12,Does a machine learning clustering model identify a user's removable media write activity as an outlier or as having shifted to a higher-risk peer group?,"This question uses peer group analysis to find anomalous user behavior. By clustering users based on their daily removable media activity, the model can identify individuals who either don't fit into any normal group (outliers) or who have suddenly moved from a low-activity group to a high-activity/high-risk group, suggesting a potential account compromise or insider threat.","Windows Event ID 4663; Windows Event ID 4656; All endpoints with object access auditing enabled for removable storage, particularly those used by privileged users, executives, or personnel in sensitive roles (e.g., HR, Finance, R&D).",last 90 days,"pseudocode: DAILY, featurize each user's removable media activity. USE a clustering algorithm (e.g., DBSCAN) to group users. ALERT on users identified as outliers (noise points) or users who have moved to a higher-risk cluster compared to their previous patterns.",playbooks/attack/enterprise/T1052.yml
T1055.002: Portable Executable Injection,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,1,Has a remote thread been created in a critical system process by an untrusted source?,"A common method of PE injection involves a process creating a remote thread in a high-privilege target process, such as 'lsass.exe' or 'services.exe'. Identifying instances where the source process is not a standard system utility (e.g., not located in 'C:\Windows\System32\') provides a high-fidelity signal for this malicious activity.","Sysmon Event ID 8; Windows Event ID 4688; All Windows Endpoints and Servers, especially Privileged Access Workstations (PAWs) and Domain Controllers.",last 90 days,"SEARCH Sysmon (EventID=8) WHERE (SourceImage NOT IN ('C:\Windows\System32\*') AND TargetImage IN ('lsass.exe', 'services.exe', 'wininit.exe', 'csrss.exe')) | CREATE_ALERT HighSeverity",playbooks/attack/enterprise/T1055.002.yml
T1055.002: Portable Executable Injection,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,2,Have any statistically rare remote thread creation events occurred?,"Attackers may use novel source-to-target process combinations for remote thread creation to evade simple signature-based rules. By establishing a baseline of all 'CreateRemoteThread' events across the enterprise, analysts can identify statistically rare pairs that warrant manual review, potentially uncovering new or targeted attack patterns.","Sysmon Event ID 8; Windows Event ID 4688; All Windows Endpoints and Servers, especially Privileged Access Workstations (PAWs) and Domain Controllers.",last 90 days,"SEARCH Sysmon (EventID=8) | STATS count by SourceImage, TargetImage | WHERE count < 5 OR is_outlier | REVIEW_MANUALLY",playbooks/attack/enterprise/T1055.002.yml
T1055.002: Portable Executable Injection,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,3,Can a machine learning model identify high-risk remote thread creation events indicative of PE injection?,"To move beyond simple rules, a classification model can analyze multiple features of a remote thread creation event (e.g., source/target paths, user context, reputation of the start function address) to generate a holistic risk score. This approach helps prioritize the most suspicious events that are likely to be malicious PE injection.","Sysmon Event ID 8; Windows Event ID 4688; All Windows Endpoints and Servers, especially Privileged Access Workstations (PAWs) and Domain Controllers.",last 90 days,"INPUT Sysmon (EventID=8) | APPLY_ML_MODEL (features=[SourceImage, TargetImage, User, StartFunction]) | CREATE_ALERT where score > threshold",playbooks/attack/enterprise/T1055.002.yml
T1055.002: Portable Executable Injection,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,4,Has a process been created from an executable matching a known malicious hash associated with injection tools?,"Adversaries often reuse known malware droppers, loaders, or frameworks like Cobalt Strike that perform PE injection. Correlating file hashes from process creation events with a threat intelligence feed of known IOCs is a direct method to detect the use of these malicious tools in the environment.","Windows Event ID 4688; Sysmon Event ID 1; Domain Controllers, Privileged Access Workstations (PAWs), Critical Application Servers, general user endpoints.",last 90 days,"SEARCH ProcessLogs (EventID=1 OR EventID=4688) | LOOKUP ThreatIntel on FileHash | WHERE ThreatIntel.tag IN ('injector', 'loader', 'Cobalt Strike') | CREATE_ALERT",playbooks/attack/enterprise/T1055.002.yml
T1055.002: Portable Executable Injection,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,5,Has a rare process been executed from a user-writable directory?,"Attackers often place custom or packed executables in non-standard, user-writable locations like 'C:\Temp\' or '%APPDATA%'. Identifying processes whose file hash is rare across the enterprise and that execute from these directories can help uncover suspicious binaries that may be used for PE injection.","Windows Event ID 4688; Sysmon Event ID 1; Domain Controllers, Privileged Access Workstations (PAWs), Critical Application Servers, general user endpoints.",last 90 days,"SEARCH ProcessLogs | STATS prevalence(FileHash) | WHERE prevalence < 0.1% AND FilePath IN ('C:\Users\Public\*', 'C:\Temp\*', '%APPDATA%\*') | CREATE_ALERT MediumPriority",playbooks/attack/enterprise/T1055.002.yml
T1055.002: Portable Executable Injection,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,6,Can a machine learning model identify malicious process creations that subsequently access high-privilege processes?,"This approach combines two key investigative steps. First, a machine learning model flags a newly created process as potentially malicious based on its features. Second, this suspicion is confirmed and its priority elevated if that same process is then observed accessing a sensitive process like 'lsass.exe' (via Sysmon Event ID 10), a common target for credential theft post-injection.","Windows Event ID 4688; Sysmon Event ID 1; Domain Controllers, Privileged Access Workstations (PAWs), Critical Application Servers, general user endpoints.",last 90 days,"INPUT ProcessLogs | APPLY_ML_MODEL (features=[FilePath, ParentProcess, User, CommandLine]) | IF score > threshold AND process accesses('lsass.exe') | ELEVATE_PRIORITY",playbooks/attack/enterprise/T1055.002.yml
T1055.002: Portable Executable Injection,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,7,Are there any processes being executed with command-line arguments that indicate an attempt to inject into another process?,"Injection tools are often invoked with specific command-line arguments, such as a flag to specify the target Process ID (PID). Scanning process creation logs for these patterns (e.g., '--pid 1234') or for the misuse of legitimate utilities like 'rundll32.exe' can directly reveal the execution of an injection tool.",Windows Event ID 4688; Sysmon Event ID 1; All Windows Endpoints and Servers.,last 90 days,"SEARCH ProcessLogs | REGEX CommandLine on ('--pid [0-9]+', '/pid:[0-9]+', 'rundll32.exe ...') | CREATE_ALERT",playbooks/attack/enterprise/T1055.002.yml
T1055.002: Portable Executable Injection,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,8,Have any statistically rare or anomalous parent-child process relationships been observed?,"Malicious injection can lead to unnatural process behaviors, such as a non-interactive service ('services.exe') spawning an interactive command shell ('cmd.exe'). By baselining normal parent-child process relationships, analysts can flag statistically rare pairs that deviate from expected system behavior and indicate compromise.",Windows Event ID 4688; Sysmon Event ID 1; All Windows Endpoints and Servers.,last 90 days,"SEARCH ProcessLogs | STATS frequency(ParentProcess, ChildProcess) | WHERE frequency < 1st_percentile AND ChildProcess IN ('cmd.exe', 'powershell.exe') | CREATE_ALERT",playbooks/attack/enterprise/T1055.002.yml
T1055.002: Portable Executable Injection,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,9,Has an unusual sequence of child processes been spawned by a common parent process?,"After injecting code, an adversary often executes a sequence of discovery commands (e.g., 'whoami.exe', 'net.exe'). A sequence analysis model can learn the normal chains of child processes for a given parent and flag significant deviations, such as 'explorer.exe' spawning a PowerShell script that then runs 'net.exe', as a potential post-injection attack chain.",Windows Event ID 4688; Sysmon Event ID 1; All Windows Endpoints and Servers.,last 90 days,INPUT ProcessLogs | APPLY_SEQUENCE_MODEL on child_process_sequence | IF sequence_is_anomalous | CREATE_ALERT,playbooks/attack/enterprise/T1055.002.yml
T1055.002: Portable Executable Injection,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,10,"Has a core system process, which should not have network access or spawn children, initiated a network connection or created a child process?","Core Windows processes like 'lsass.exe', 'wininit.exe', and 'csrss.exe' have extremely predictable, constrained behaviors. Any deviation, such as initiating an outbound network connection or spawning a child process, is a high-confidence indicator that the process has been compromised via injection.","Zeek conn.log; Windows Event ID 4688; Sysmon Event ID 1; Sysmon Event ID 3; Network Egress Points (Firewalls/Gateways), Critical System Servers (e.g., Domain Controllers).",last 90 days,"SEARCH (NetworkLogs OR ProcessLogs) WHERE ProcessName IN ('lsass.exe', 'csrss.exe', 'wininit.exe') AND (is_outbound_connection OR has_child_process) | CREATE_ALERT Critical",playbooks/attack/enterprise/T1055.002.yml
T1055.002: Portable Executable Injection,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,11,"Has a critical process like 'svchost.exe' exhibited anomalous network behavior, such as connecting to a low-reputation destination or transferring an unusual amount of data?","While some system processes like 'svchost.exe' are expected to make network connections, this activity is generally predictable. By baselining this behavior, analysts can use percentile-based thresholds to detect outliers, such as a connection to a risky IP or an unusually large data transfer, which may indicate C2 or exfiltration from an injected thread.","Zeek conn.log; Windows Event ID 4688; Sysmon Event ID 1; Sysmon Event ID 3; Network Egress Points (Firewalls/Gateways), Critical System Servers (e.g., Domain Controllers).",last 90 days,SEARCH NetworkLogs WHERE ProcessName='svchost.exe' | IF destination_reputation < 5th_percentile OR data_volume > 99th_percentile | CREATE_ALERT,playbooks/attack/enterprise/T1055.002.yml
T1055.002: Portable Executable Injection,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,12,Can a multi-feature anomaly detection model identify suspicious network activity from critical system processes?,"Rather than relying on single-feature thresholds, an anomaly detection model like an Isolation Forest can analyze a combination of network features (process name, destination port, protocol, bytes sent) simultaneously. This allows it to identify subtle, complex deviations from normal behavior that are indicative of malicious activity within a critical process.","Zeek conn.log; Windows Event ID 4688; Sysmon Event ID 1; Sysmon Event ID 3; Network Egress Points (Firewalls/Gateways), Critical System Servers (e.g., Domain Controllers).",last 90 days,"INPUT (ProcessLogs, NetworkLogs) | APPLY_ANOMALY_MODEL (features=[process, port, protocol, bytes]) | IF is_anomaly | CREATE_ALERT",playbooks/attack/enterprise/T1055.002.yml
T1055.002: Portable Executable Injection,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,13,"Has a trusted process, not typically used for browsing, connected to a known malicious domain or IP address?","To evade detection, adversaries inject into legitimate processes like 'notepad.exe' or 'svchost.exe' to blend their C2 traffic with normal system activity. Alerting when these non-browsing processes connect to destinations on a threat intelligence list helps to unmask this masquerading behavior.","Zeek conn.log; Zeek dns.log; Zeek ssl.log; Sysmon Event ID 3; Network Egress Points, DNS Resolvers, Web Proxies, Host-based network sensors.",last 90 days,"SEARCH NetworkLogs WHERE ProcessName IN ('svchost.exe', 'notepad.exe') | LOOKUP ThreatIntel on DestinationIP | WHERE ThreatIntel.is_malicious | CREATE_ALERT HighPriority",playbooks/attack/enterprise/T1055.002.yml
T1055.002: Portable Executable Injection,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,14,Has a trusted process connected to a newly registered or algorithmically generated domain?,"Adversaries frequently use newly registered domains (NRDs) or employ domain generation algorithms (DGAs) for their C2 infrastructure. A trusted process connecting to a domain that was registered within the last 30 days or has a high-entropy name is highly suspicious and deviates from normal behavior, where processes connect to established, well-known domains.","Zeek conn.log; Zeek dns.log; Zeek ssl.log; Sysmon Event ID 3; Network Egress Points, DNS Resolvers, Web Proxies, Host-based network sensors.",last 90 days,SEARCH NetworkLogs | IF (domain_age < 30_days OR domain_entropy > 3.5) AND ProcessName IS trusted | CREATE_ALERT,playbooks/attack/enterprise/T1055.002.yml
T1055.002: Portable Executable Injection,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,15,Has a trusted process shown a sudden spike in data transfer volume to a low-reputation domain?,"A sudden, anomalous increase in the volume of data sent from a trusted process to a low-reputation domain can be a sign of data exfiltration. A time-series anomaly detection model can monitor for these spikes, which deviate from the forecasted baseline of normal activity, indicating potential data theft from an injected process.","Zeek conn.log; Zeek dns.log; Zeek ssl.log; Sysmon Event ID 3; Network Egress Points, DNS Resolvers, Web Proxies, Host-based network sensors.",last 90 days,INPUT DataVolume from trusted_process to low_rep_domain | APPLY_TIMESERIES_MODEL | IF spike_is_anomaly | CREATE_ALERT,playbooks/attack/enterprise/T1055.002.yml
T1055.002: Portable Executable Injection,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,16,Has a document-handling or office application spawned a command shell or a living-off-the-land binary?,"It is highly anomalous for processes like 'WINWORD.EXE' or 'outlook.exe' to spawn child processes such as 'cmd.exe', 'powershell.exe', or known LOLBins. This behavior is a classic indicator of malicious code execution, often stemming from a malicious macro or an exploited vulnerability, leading to further actions on the host.","Windows Event ID 4688; Sysmon Event ID 1; User Workstations, Application Servers, Virtual Desktop Infrastructure (VDI).",last 90 days,"SEARCH ProcessLogs WHERE ParentProcess IN ('WINWORD.EXE', 'explorer.exe', 'outlook.exe') AND ChildProcess IN ('cmd.exe', 'powershell.exe', 'net.exe', 'whoami.exe') | CREATE_ALERT",playbooks/attack/enterprise/T1055.002.yml
T1055.002: Portable Executable Injection,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,17,Has a trusted process spawned a child with a highly obfuscated or complex command line?,Attackers use command-line obfuscation to hide their payloads from signature-based defenses. Calculating the Shannon entropy of command-line arguments can quantify this complexity. A command with an entropy score significantly higher than the baseline for that parent-child pair suggests obfuscation and malicious intent.,"Windows Event ID 4688; Sysmon Event ID 1; User Workstations, Application Servers, Virtual Desktop Infrastructure (VDI).",last 90 days,SEARCH ProcessLogs | CALCULATE entropy(CommandLine) | IF entropy > 95th_percentile for parent-child pair | CREATE_ALERT,playbooks/attack/enterprise/T1055.002.yml
T1055.002: Portable Executable Injection,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,18,Has a command-line interpreter been executed with an unusual syntax or combination of arguments?,"Advanced attackers may use legitimate tools like PowerShell with unusual argument combinations or syntax to evade detection. A machine learning model trained on the structure of normal command lines can identify these 'grammatically' strange but valid commands, flagging them as potential abuse that would be missed by simple pattern matching.","Windows Event ID 4688; Sysmon Event ID 1; User Workstations, Application Servers, Virtual Desktop Infrastructure (VDI).",last 90 days,INPUT CommandLine | APPLY_NLP_MODEL | IF command_structure_is_anomalous | CREATE_ALERT,playbooks/attack/enterprise/T1055.002.yml
T1055.002: Portable Executable Injection,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,19,Is a trusted process making a TLS connection using a self-signed or mismatched certificate?,"Adversaries often use self-signed SSL/TLS certificates for their C2 infrastructure as a low-cost way to encrypt traffic. A trusted process making a TLS connection where the certificate is self-signed, or where the certificate's common name does not match the server name, is a strong signal of a connection to a malicious endpoint.","Zeek conn.log; Zeek ssl.log; Zeek x509.log; Sysmon Event ID 3; Network Egress Points, Correlated Host Logs.",last 90 days,SEARCH SSL_Logs | WHERE (is_self_signed OR subject_cn != sni) AND ProcessName IS trusted | CREATE_ALERT,playbooks/attack/enterprise/T1055.002.yml
T1055.002: Portable Executable Injection,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,20,"Is a process exhibiting periodic, low-jitter network beaconing, especially using a rare JA3/JA3S hash?","Malicious implants often beacon back to their C2 server at regular intervals, resulting in a low standard deviation (jitter) in the time between connections. Combining this temporal analysis with the rarity of the connection's JA3/JA3S fingerprint (which profiles the TLS client) creates a high-fidelity signature for automated C2 communication.","Zeek conn.log; Zeek ssl.log; Zeek x509.log; Sysmon Event ID 3; Network Egress Points, Correlated Host Logs.",last 90 days,"SEARCH NetworkLogs | CALCULATE time_delta_stddev per (host, process, dest) | IF stddev < 2s AND prevalence(JA3_hash) < 1% | CREATE_ALERT",playbooks/attack/enterprise/T1055.002.yml
T1055.002: Portable Executable Injection,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,21,Does a process have a cluster of network activity that is anomalous compared to its normal behavior?,"By applying a clustering algorithm like DBSCAN to network connection metadata, we can group all of a process's connections into clusters of similar behavior. Normal activity forms a large, dense cluster, while malicious C2 or exfiltration will likely appear as a distinct, small outlier cluster that can be automatically flagged for investigation.","Zeek conn.log; Zeek ssl.log; Zeek x509.log; Sysmon Event ID 3; Network Egress Points, Correlated Host Logs.",last 90 days,"INPUT NetworkLogs per process | APPLY DBSCAN(features=[duration, bytes, port, JA3]) | IF cluster is outlier | INVESTIGATE_CLUSTER",playbooks/attack/enterprise/T1055.002.yml
T1055.002: Portable Executable Injection,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,22,Has the 'dropper -> injection -> beacon' sequence of events been observed on a single host?,"This question hunts for the full attack lifecycle on a single host within a short time window. Detecting the correlated sequence of (1) an initial access process, (2) a short-lived dropper that downloads a file, and (3) a persistent, legitimate process beginning to beacon to a new domain provides a high-confidence alert of a successful compromise via injection.","Windows Event ID 4688; Sysmon Event ID 1; Zeek conn.log; Zeek http.log; Zeek files.log; User Workstations, Email Gateway Servers, Web Proxy Servers.",last 90 days,"CORRELATE events on host | FIND SEQUENCE: (outlook.exe -> child_A), (child_A downloads file AND terminates < 60s), (explorer.exe starts beaconing to new domain within 2 mins) | CREATE_ALERT",playbooks/attack/enterprise/T1055.002.yml
T1055.002: Portable Executable Injection,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,23,"Has a host experienced a sudden spike in the creation of short-lived processes, followed by anomalous activity?","A sudden burst in the rate of short-lived processes (e.g., those lasting less than 60 seconds) can indicate the execution of a malicious script or a series of setup commands. Using change point detection to identify such a burst and then analyzing the subsequent network and process activity on that host can reveal the compromise that follows.","Windows Event ID 4688; Sysmon Event ID 1; Zeek conn.log; Zeek http.log; Zeek files.log; User Workstations, Email Gateway Servers, Web Proxy Servers.",last 90 days,INPUT count(short_lived_processes) per host over time | APPLY ChangePointDetection | IF change_point_detected | ANALYZE subsequent activity for anomalies,playbooks/attack/enterprise/T1055.002.yml
T1055.002: Portable Executable Injection,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,24,Can a stateful model (HMM) classify a host's threat state as 'Injected' based on a sequence of observed events?,"A Hidden Markov Model (HMM) is well-suited for this problem because it can infer a hidden state (e.g., 'Benign', 'Injected') from a sequence of observable events (process creations, network connections). By training the model on known attack scenarios, it can learn to classify the real-time threat state of a host, providing a probabilistic assessment of compromise.","Windows Event ID 4688; Sysmon Event ID 1; Zeek conn.log; Zeek http.log; Zeek files.log; User Workstations, Email Gateway Servers, Web Proxy Servers.",last 90 days,INPUT event_stream per host | APPLY HMM_Classifier | IF current_state='Injected' | CREATE_ALERT,playbooks/attack/enterprise/T1055.002.yml
T1055.005: Thread Local Storage,f7b3c1d0-a8e9-4f6c-b2d1-5a9e8f7c6b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,1,Is a known malicious process requesting write or execute access to a critical system process like lsass.exe or services.exe?,"This question aims to detect a classic injection technique where a process, already identified as malicious by its hash, attempts to gain control over a high-privilege system process. Gaining this access allows the adversary to execute code with system-level privileges, effectively escalating their permissions. The query specifically looks for handle requests with memory writing or thread creation flags, which are necessary for this type of injection.","Windows Event ID 4656; Windows Event ID 4688; Sysmon Event ID 10; Sysmon Event ID 1; Monitored on: Domain Controllers, Critical Application Servers, Privileged User Workstations",Last 90 days,"Symbolic: SEARCH (EventID=4656 OR SysmonID=10) AND TargetProcess IN (lsass.exe, services.exe, wininit.exe) AND AccessMask CONTAINS (PROCESS_VM_WRITE OR PROCESS_VM_OPERATION OR PROCESS_CREATE_THREAD). JOIN SourceProcessID with (EventID=4688 OR SysmonID=1) to get ProcessHash. CHECK ProcessHash against threat intel feeds. ALERT if match.",playbooks/attack/enterprise/T1055.005.yml
T1055.005: Thread Local Storage,f7b3c1d0-a8e9-4f6c-b2d1-5a9e8f7c6b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,2,Is a process with an unusually obfuscated or randomized file path requesting access to a critical system process?,"Adversaries often place their tools in unexpected or randomized directories to evade simple path-based detection rules. This question uses Shannon entropy to statistically measure the randomness of the source process's file path. A high entropy score compared to a historical baseline suggests the path may be algorithmically generated or intentionally obfuscated, which is a common characteristic of malware droppers attempting to inject into privileged processes.","Windows Event ID 4656; Sysmon Event ID 10; Monitored on: Domain Controllers, Critical Application Servers, Privileged User Workstations",Last 90 days,"Statistical: SEARCH (EventID=4656 OR SysmonID=10) AND TargetProcess IN (lsass.exe, services.exe, wininit.exe). CALCULATE Shannon entropy of SourceProcessPath. COMPARE to 30-day baseline. ALERT if entropy is in top 98th percentile.",playbooks/attack/enterprise/T1055.005.yml
T1055.005: Thread Local Storage,f7b3c1d0-a8e9-4f6c-b2d1-5a9e8f7c6b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,3,Can a machine learning model predict with high confidence that a handle request to a critical system process is malicious based on its characteristics?,"This question leverages a machine learning model to perform a more sophisticated, multi-faceted analysis of handle request events. By considering features like process path entropy, command-line details, digital signature status, and parent process information, the model can identify complex patterns indicative of malicious injection attempts that might be missed by simpler rules. A high probability score from the model provides a strong signal of a potential privilege escalation attempt.","Sysmon Event ID 1; Sysmon Event ID 10; Monitored on: Domain Controllers, Critical Application Servers, Privileged User Workstations",Last 90 days,"Machine Learning: FOR EACH (SysmonID=10) event: EXTRACT features (source path entropy, cmdline length/entropy, is_signed, access_rights, is_target_privileged, parent_process). INPUT features into trained logistic regression model. ALERT if prediction probability > 0.9.",playbooks/attack/enterprise/T1055.005.yml
T1055.005: Thread Local Storage,f7b3c1d0-a8e9-4f6c-b2d1-5a9e8f7c6b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,4,Did a privileged process spawn a shell or initiate a network connection shortly after being accessed by an unsigned process?,This question looks for the direct aftermath of a successful process injection. An unsigned process gaining write access to a privileged process is suspicious. If that privileged process then behaves abnormally—like spawning a command shell or making a network call—it's a strong indicator that it has been compromised and is now executing the adversary's payload. The 60-second time window is critical for correlating the cause (injection) with the effect (malicious activity).,"Windows Event ID 4656; Sysmon Event ID 10; Windows Event ID 5156; Sysmon Event ID 3; Windows Event ID 4688; Sysmon Event ID 1; Zeek conn.log; Monitored on: Domain Controllers, Enterprise DNS Servers, Network Egress Points",Last 90 days,"Symbolic: ON (EventID=4656 OR SysmonID=10) from unsigned SourceProcess to privileged TargetProcess: WATCH TargetPID for 60 seconds. ALERT if TargetPID creates child process (cmd.exe, powershell.exe) OR initiates network connection.",playbooks/attack/enterprise/T1055.005.yml
T1055.005: Thread Local Storage,f7b3c1d0-a8e9-4f6c-b2d1-5a9e8f7c6b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,5,"Following a write-access handle request, did a privileged process exhibit statistically rare behavior, such as spawning an uncommon child process or connecting to a new IP address?","This question aims to detect post-injection activity by baselining the normal behavior of privileged processes. Legitimate system processes typically have a very predictable set of child processes and network destinations. Any deviation from this baseline, especially after a potentially compromising write-access event, is highly suspicious. Flagging activity in the bottom 1% of historical frequency helps to identify these 'never-seen-before' or 'rarely-seen' actions.","Windows Event ID 4656; Sysmon Event ID 10; Windows Event ID 5156; Sysmon Event ID 3; Windows Event ID 4688; Sysmon Event ID 1; Zeek conn.log; Monitored on: Domain Controllers, Enterprise DNS Servers, Network Egress Points",Last 90 days,Statistical: ON (EventID=4656 OR SysmonID=10) with write access to privileged TargetProcess: MONITOR subsequent activity from TargetPID. COMPARE child process name and destination IP to 30-day historical baseline for TargetProcess. ALERT if activity is in bottom 1% frequency.,playbooks/attack/enterprise/T1055.005.yml
T1055.005: Thread Local Storage,f7b3c1d0-a8e9-4f6c-b2d1-5a9e8f7c6b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,6,Does a time-series model detect an anomalous spike in network output from a critical process that correlates with a recent write-access event?,"This question uses a time-series model to detect subtle changes in a critical process's network behavior that might indicate data exfiltration or command-and-control communication following an injection. The model learns the normal rhythm of network traffic (e.g., volume of bytes, unique destinations). A significant, unexplained spike that occurs shortly after a write-access handle request suggests the process's networking capabilities have been hijacked.","Windows Event ID 4656; Sysmon Event ID 10; Windows Event ID 5156; Sysmon Event ID 3; Zeek conn.log; Monitored on: Domain Controllers, Enterprise DNS Servers, Network Egress Points",Last 90 days,"Machine Learning: FOR EACH critical process: MONITOR network metrics (bytes_out, unique_dest_ips) using a time-series anomaly detection model. ON (EventID=4656 OR SysmonID=10) with write access to that process: CHECK for a correlated anomaly spike from the model. ALERT if found.",playbooks/attack/enterprise/T1055.005.yml
T1055.005: Thread Local Storage,f7b3c1d0-a8e9-4f6c-b2d1-5a9e8f7c6b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,7,Is a critical system process like lsass.exe making any external network connection?,"This is a zero-tolerance detection. Critical system processes like lsass.exe, smss.exe, or wininit.exe have no legitimate reason to initiate outbound network connections to external addresses. Any such activity is a high-fidelity indicator of compromise, likely resulting from process injection or another form of subversion.","Windows Event ID 5156; Sysmon Event ID 3; Zeek conn.log; Zeek dns.log; Monitored on: Network Egress Points, Domain Controllers, DNS Servers",Last 90 days,"Symbolic: ALERT on (EventID=5156 OR SysmonID=3 OR Zeek conn) where SourceProcess IN (lsass.exe, smss.exe, wininit.exe, csrss.exe) AND DestinationIP is_external.",playbooks/attack/enterprise/T1055.005.yml
T1055.005: Thread Local Storage,f7b3c1d0-a8e9-4f6c-b2d1-5a9e8f7c6b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,8,"Is a system process like services.exe making a statistically anomalous network connection, such as to a high port or a newly registered domain?","This question targets processes that may have legitimate but rare network activity, making a zero-tolerance rule impractical. It uses a Z-score to identify statistically significant outliers in connection patterns (e.g., an unusually high number of connections to a non-standard port). Correlating this with DNS lookups for newly registered domains further increases confidence that the activity is malicious.","Windows Event ID 5156; Sysmon Event ID 3; Zeek conn.log; Zeek dns.log; Monitored on: Network Egress Points, Domain Controllers, DNS Servers",Last 90 days,Statistical: FOR services.exe connections: CALCULATE Z-score on daily connection count per destination port. ALERT if Z > 3. CORRELATE with Zeek DNS logs for domains < 30 days old.,playbooks/attack/enterprise/T1055.005.yml
T1055.005: Thread Local Storage,f7b3c1d0-a8e9-4f6c-b2d1-5a9e8f7c6b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,9,Can a one-class SVM model classify a network connection from a system process as anomalous?,"This question uses a machine learning model (One-Class SVM) that is trained exclusively on legitimate network behavior for system processes. It creates a boundary of 'normalcy'. Any new connection that falls outside this learned boundary is classified as an anomaly. This is effective for detecting novel C2 techniques without prior knowledge of what 'bad' looks like, using features like port, protocol, and SSL/TLS fingerprints.","Zeek conn.log; Zeek ssl.log; Monitored on: Network Egress Points, Domain Controllers, DNS Servers",Last 90 days,"Machine Learning: TRAIN One-Class SVM on legit system process network connections (features: dest_port, protocol, bytes_sent, duration, JA3). FOR new connections: CLASSIFY with model. ALERT if classified as anomaly.",playbooks/attack/enterprise/T1055.005.yml
T1055.005: Thread Local Storage,f7b3c1d0-a8e9-4f6c-b2d1-5a9e8f7c6b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,10,"Is a process running from a suspicious, user-writable directory requesting full access to a privileged process?","This is a classic indicator of malware behavior. Adversaries often drop their payloads into non-standard, user-writable locations like C:\Users\...\AppData or C:\ProgramData to ensure execution permissions and evade detection. From there, the malware attempts to inject into a privileged process by requesting full access rights (PROCESS_ALL_ACCESS), making this sequence a high-confidence alert.","Windows Event ID 4656; Sysmon Event ID 10; Windows Event ID 4688; Sysmon Event ID 1; Monitored on: User Workstations, Terminal Servers, Application Servers",Last 90 days,Symbolic: SEARCH (EventID=4656 OR SysmonID=10) with AccessMask=PROCESS_ALL_ACCESS to privileged process. JOIN SourcePID to get SourcePath. ALERT if SourcePath matches regex for user-writable/temp locations.,playbooks/attack/enterprise/T1055.005.yml
T1055.005: Thread Local Storage,f7b3c1d0-a8e9-4f6c-b2d1-5a9e8f7c6b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,11,Is a process from a statistically rare file path attempting to inject into a privileged process?,"This question helps find outlier behavior without relying on predefined lists of 'bad' directories. By calculating the frequency of all process paths that request handles to privileged processes, we can identify paths that are rarely seen. A process executing from a rare path that then attempts to write to a privileged process is highly suspicious and could indicate a novel malware location.","Windows Event ID 4656; Sysmon Event ID 10; Windows Event ID 4688; Sysmon Event ID 1; Monitored on: User Workstations, Terminal Servers, Application Servers",Last 90 days,Statistical: CALCULATE frequency of all SourceProcessPaths that request handles to privileged processes. ALERT if a request comes from a path in the bottom 5th percentile of frequency.,playbooks/attack/enterprise/T1055.005.yml
T1055.005: Thread Local Storage,f7b3c1d0-a8e9-4f6c-b2d1-5a9e8f7c6b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,12,Is a process that exhibits anomalous execution behavior (based on clustering) attempting to inject into a privileged process?,"This is a two-step approach using machine learning. First, a clustering algorithm like DBSCAN groups all process executions based on features like path, parent, and command line to find anomalous clusters of activity. Second, if any process from one of these anomalous clusters is later observed attempting to inject into a privileged process, it generates a high-confidence alert, effectively linking suspicious execution to a privilege escalation attempt.","Sysmon Event ID 1; Sysmon Event ID 10; Monitored on: User Workstations, Terminal Servers, Application Servers",Last 90 days,"Machine Learning: CLUSTER Sysmon 1 events (features: path tokens, parent process, cmdline). IDENTIFY anomalous clusters. ALERT if a process from an anomalous cluster later appears in a Sysmon 10 event targeting a privileged process.",playbooks/attack/enterprise/T1055.005.yml
T1055.005: Thread Local Storage,f7b3c1d0-a8e9-4f6c-b2d1-5a9e8f7c6b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,13,Is a known malicious process attempting to inject into a common host process like explorer.exe to masquerade its activity?,"This question aims to detect known malware that uses process injection for defense evasion. The adversary injects into a common, trusted process like explorer.exe or svchost.exe to hide its malicious activities (e.g., C2 communication) within the noise of normal system behavior. The query first identifies a known-bad process by its hash and then alerts if that process attempts to gain write/execute access to a common host process.","Windows Event ID 4656; Sysmon Event ID 10; Windows Event ID 4688; Sysmon Event ID 1; Monitored on: All Enterprise Workstations and Servers, VDI Environments",Last 90 days,"Symbolic: ON (EventID=4688/Sysmon 1): CHECK hash against threat intel. IF match, WATCH PID. ALERT if PID is source of (EventID=4656/Sysmon 10) targeting explorer.exe/svchost.exe with write access.",playbooks/attack/enterprise/T1055.005.yml
T1055.005: Thread Local Storage,f7b3c1d0-a8e9-4f6c-b2d1-5a9e8f7c6b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,14,Is a statistically rare process requesting write access to a common injection target like explorer.exe?,"This question establishes a behavioral baseline of which processes normally interact with common injection targets like explorer.exe. By profiling legitimate handle requests, it can flag any request coming from a source process that is statistically rare or has never been seen before. This is effective for detecting new or unknown malware attempting to use common processes for masquerading.","Windows Event ID 4656; Sysmon Event ID 10; Monitored on: All Enterprise Workstations and Servers, VDI Environments",Last 90 days,Statistical: FOR explorer.exe/svchost.exe: PROFILE legitimate source processes requesting handles. ALERT on write-access requests from a source process not in the top 95% of frequent requesters.,playbooks/attack/enterprise/T1055.005.yml
T1055.005: Thread Local Storage,f7b3c1d0-a8e9-4f6c-b2d1-5a9e8f7c6b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,15,Can a Random Forest model predict that a handle request to explorer.exe or svchost.exe is malicious?,"This question applies a supervised machine learning model to classify handle requests to common host processes. By training on a rich feature set—including details about the source process, its parent, its command line, and signature status—the model can learn the subtle differences between benign and malicious interactions, providing a probabilistic score to alert on high-risk events that might evade simpler rules.","Sysmon Event ID 1; Sysmon Event ID 10; Monitored on: All Enterprise Workstations and Servers, VDI Environments",Last 90 days,"Machine Learning: FOR EACH handle request to explorer.exe/svchost.exe: EXTRACT features (source process details, parent, cmdline, signature, access mask). SCORE with Random Forest model. ALERT if score > threshold.",playbooks/attack/enterprise/T1055.005.yml
T1055.005: Thread Local Storage,f7b3c1d0-a8e9-4f6c-b2d1-5a9e8f7c6b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,16,Did a common process like explorer.exe spawn a command shell immediately after another process gained write access to it?,"This is a classic post-injection indicator for defense evasion. The adversary injects code into a common process like explorer.exe, and that code's first action is often to spawn a command shell (cmd.exe, powershell.exe) for the attacker to use. This query correlates the write-access event with the subsequent suspicious child process creation within a short time window.","Windows Event ID 4656; Sysmon Event ID 10; Windows Event ID 4688; Sysmon Event ID 1; Monitored on: User Workstations, Terminal Servers",Last 90 days,"Symbolic: ON (EventID=4656/Sysmon 10) with write access to TargetProcess (e.g., explorer.exe): WATCH TargetPID for 60s. ALERT if TargetPID spawns child (cmd.exe, powershell.exe).",playbooks/attack/enterprise/T1055.005.yml
T1055.005: Thread Local Storage,f7b3c1d0-a8e9-4f6c-b2d1-5a9e8f7c6b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,17,"After a write-access handle request, did a common process spawn a statistically rare child process?","This question detects post-injection activity by baselining normal parent-child relationships. Common processes like chrome.exe or explorer.exe typically spawn a predictable set of child processes. If, after a write-access event, one of these processes spawns a child that is statistically rare (e.g., ftp.exe, whoami.exe), it is a strong indication that the parent process has been hijacked.","Windows Event ID 4656; Sysmon Event ID 10; Windows Event ID 4688; Sysmon Event ID 1; Monitored on: User Workstations, Terminal Servers",Last 90 days,"Statistical: FOR common processes (explorer.exe, chrome.exe): BASELINE child process frequency. ON write-access handle request to one of these: if it spawns a child in the bottom 5th percentile of frequency, ALERT.",playbooks/attack/enterprise/T1055.005.yml
T1055.005: Thread Local Storage,f7b3c1d0-a8e9-4f6c-b2d1-5a9e8f7c6b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,18,Can a graph-based anomaly detection model identify an anomalous process execution chain originating from a process that recently had a handle opened to it?,"This question models process activity as a graph, where processes are nodes and parent-child relationships are edges. It can identify anomalous structures, such as a browser spawning a shell which then spawns a network utility. By correlating the appearance of these unusual process trees with a preceding handle request event to the root of that tree, it can link a potential injection to its malicious consequence with high confidence.","Sysmon Event ID 1; Sysmon Event ID 10; Monitored on: User Workstations, Terminal Servers",Last 90 days,Machine Learning: MODEL process lineage (Sysmon 1) as a graph. DETECT anomalous subgraphs. CORRELATE appearance of anomalous subgraph with preceding Sysmon 10 event to the root process of the subgraph. ALERT on correlation.,playbooks/attack/enterprise/T1055.005.yml
T1055.005: Thread Local Storage,f7b3c1d0-a8e9-4f6c-b2d1-5a9e8f7c6b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,19,Is a common user-facing process like a web browser connecting to a known-bad or newly registered domain?,"This question seeks to detect C2 communication that is being masqueraded through a legitimate, user-facing process. After injecting into a process like chrome.exe, the adversary's code will initiate a connection to their C2 server. This query detects such activity by checking the destination against threat intelligence feeds for bad reputation or by identifying domains that were registered very recently (a common tactic for attackers).","Sysmon Event ID 3; Zeek conn.log; Zeek dns.log; Monitored on: User Workstations, Network Egress Points, DNS Servers",Last 90 days,"Symbolic: ENRICH Zeek logs with threat intel (reputation, domain age). ALERT if common process (explorer.exe, chrome.exe) connects to destination with bad rep OR domain age < 30 days.",playbooks/attack/enterprise/T1055.005.yml
T1055.005: Thread Local Storage,f7b3c1d0-a8e9-4f6c-b2d1-5a9e8f7c6b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,20,"Is a process connecting to a 'first seen' domain for that host that also has high entropy, suggesting DGA?","This question aims to detect connections to domains generated by a Domain Generation Algorithm (DGA), a common C2 technique. It combines two statistical properties: 1) the domain is new to the specific host ('first seen'), and 2) the domain name itself is random-looking (high Shannon entropy). A domain that is both new and has high entropy is very likely to be part of a DGA-based C2 infrastructure.","Zeek dns.log; Monitored on: User Workstations, Network Egress Points, DNS Servers",Last 90 days,Statistical: MAINTAIN baseline of domains per host. ON connection to 'first seen' domain: CALCULATE domain entropy. ALERT if entropy is in top 5th percentile.,playbooks/attack/enterprise/T1055.005.yml
T1055.005: Thread Local Storage,f7b3c1d0-a8e9-4f6c-b2d1-5a9e8f7c6b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,21,Does a time-series model detect anomalous network traffic patterns from a common application?,"This question uses an unsupervised machine learning model to learn the normal 'rhythm' of network traffic from common applications on a per-host basis. It monitors metrics like bytes sent, connection frequency, and SSL/TLS fingerprints. A significant deviation from the learned pattern (a high reconstruction error) indicates an anomaly. If this anomaly coincides with connections to new destinations, it strongly suggests the application's network activity has been hijacked by injected code.","Sysmon Event ID 3; Zeek conn.log; Zeek ssl.log; Monitored on: User Workstations, Network Egress Points, DNS Servers",Last 90 days,"Machine Learning: TRAIN LSTM autoencoder on normal network traffic patterns per host/app. MONITOR for high reconstruction error on new traffic. ALERT on significant deviation, especially to new destinations or with unusual JA3 hash.",playbooks/attack/enterprise/T1055.005.yml
T1055.005: Thread Local Storage,f7b3c1d0-a8e9-4f6c-b2d1-5a9e8f7c6b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,22,Did a non-installer process like Microsoft Word write an executable to disk and then attempt to inject into another process?,"This question targets a common attack chain known as 'drop and inject,' often initiated from a malicious document macro. A process like WINWORD.EXE or OUTLOOK.EXE, which should not be creating executable files, first 'drops' a malicious DLL or EXE to disk. Then, the same process attempts to 'inject' it into another host process. Detecting this specific sequence provides a high-fidelity alert for this TTP.","Sysmon Event ID 11; Windows Event ID 4656; Sysmon Event ID 10; Monitored on: User Workstations, Download Directories, Temporary File Locations",Last 90 days,Symbolic: ON file creation (Sysmon 11) of .exe/.dll by non-installer (winword.exe): WATCH PID for 5 mins. ALERT if PID is source of handle request (Sysmon 10) with write access.,playbooks/attack/enterprise/T1055.005.yml
T1055.005: Thread Local Storage,f7b3c1d0-a8e9-4f6c-b2d1-5a9e8f7c6b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,23,"Did a statistically uncommon process create an executable file, especially in an unusual location, before attempting process injection?","This question uses a statistical approach to find 'dropper' behavior. It builds a frequency table of which processes normally create executables (e.g., installers, updaters). If a process that rarely creates executables (like a browser or office app) is observed writing a .dll or .exe, it's flagged as an anomaly. The anomaly score is increased if this is followed by an injection attempt from the same process, indicating a likely 'drop and inject' attack.","Sysmon Event ID 11; Sysmon Event ID 10; Monitored on: User Workstations, Download Directories, Temporary File Locations",Last 90 days,"Statistical: PROFILE which processes create .exe/.dll files. ALERT if a process outside the top 95% of creators writes an executable, especially if followed by an injection attempt from the same PID.",playbooks/attack/enterprise/T1055.005.yml
T1055.005: Thread Local Storage,f7b3c1d0-a8e9-4f6c-b2d1-5a9e8f7c6b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,24,Can a machine learning model identify a 'drop and inject' sequence based on file creation and subsequent process interaction events?,"This question leverages a machine learning classifier to specifically recognize the 'drop and inject' pattern. The model is trained on features describing the file creation event (e.g., creating process, file type, location) and whether that event was followed by a process injection attempt within a short window. This allows the model to learn the specific combination of features that represent this malicious sequence with high confidence.","Sysmon Event ID 11; Sysmon Event ID 10; Monitored on: User Workstations, Download Directories, Temporary File Locations",Last 90 days,"Machine Learning: TRAIN Gradient Boosting model on features (creating process, file ext, target dir, subsequent injection attempt). ALERT if model predicts a high probability of a malicious drop-and-inject sequence.",playbooks/attack/enterprise/T1055.005.yml
T1055.012: Process Hollowing,a4b1c8d0-9e7f-4a6b-8c5d-1f2a3b4c5d6e,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,1,Are there any process creation events that violate established known-good parent-child relationships for critical system binaries?,"This question aims to detect a common process hollowing indicator where a legitimate process is spawned by an unusual parent. For example, svchost.exe should be created by services.exe. If it's created by winword.exe, it's highly suspicious. By maintaining a whitelist of expected relationships, any deviation can be quickly identified as a potential threat.",Windows Event ID 4688; Sysmon Event ID 1; Domain Controllers; User Workstations; Member Servers,last 90 days,"pseudocode: SEARCH process_creation_logs | WHERE child_process IN (critical_binaries) AND parent_child_pair NOT IN (known_good_pairs) | RETURN host, parent_process, child_process, timestamp",playbooks/attack/enterprise/T1055.012.yml
T1055.012: Process Hollowing,a4b1c8d0-9e7f-4a6b-8c5d-1f2a3b4c5d6e,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,2,Have any statistically rare parent-child process pairs been observed across the environment?,"This question uses a statistical approach to find anomalies without a predefined whitelist. By baselining all parent-child process relationships over a period, we can identify pairs that occur very infrequently. Such rare events are often indicative of malicious activity, like process hollowing, that deviates from normal system behavior. The threshold $$ P(pair) < P_{1} $$ flags the rarest 1% of relationships for investigation.",Windows Event ID 4688; Sysmon Event ID 1; Domain Controllers; User Workstations; Member Servers,last 90 days,"pseudocode: SEARCH process_creation_logs | STATS count BY parent_process, child_process | EVENTSTATS total(count) as total_events | EVAL frequency = count/total_events | WHERE frequency < 1st_percentile | RETURN parent_process, child_process, frequency",playbooks/attack/enterprise/T1055.012.yml
T1055.012: Process Hollowing,a4b1c8d0-9e7f-4a6b-8c5d-1f2a3b4c5d6e,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,3,Has an unsupervised machine learning model detected any anomalous process creation events based on parent-child features?,This question leverages machine learning to automate the detection of unusual process creations. An unsupervised model like an Isolation Forest can learn the complex patterns of normal behavior from features like parent/child names and paths. Events that the model flags with a high anomaly score are significant deviations from this learned baseline and are strong candidates for process hollowing attempts.,Windows Event ID 4688; Sysmon Event ID 1; Domain Controllers; User Workstations; Member Servers,last 90 days,"pseudocode: SEARCH process_creation_logs | INPUT to anomaly_detection_model(features=[parent, child, parent_path]) | WHERE anomaly_score > threshold | RETURN host, parent_process, child_process, anomaly_score",playbooks/attack/enterprise/T1055.012.yml
T1055.012: Process Hollowing,a4b1c8d0-9e7f-4a6b-8c5d-1f2a3b4c5d6e,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,4,Has a commonly hollowed process exceeded a static time threshold between its creation and its first subsequent activity?,"This question seeks to identify processes created in a suspended state, a key step in process hollowing. Adversaries suspend a process to modify its memory before resuming it. This results in an abnormally long delay between the process creation event and its first action, such as a network connection or loading a module. A static threshold (e.g., > 5 seconds) for watchlist processes provides a simple but effective detection method.",Windows Event ID 4688; Sysmon Event ID 1; Sysmon Event ID 7; Zeek conn.log; User Workstations; Critical Application Servers; Network Egress Points,last 90 days,"pseudocode: CORRELATE process_creation_logs with (network_logs OR child_process_logs OR module_load_logs) | CALCULATE time_delta = first_activity_time - creation_time | WHERE child_process IN (hollowing_watchlist) AND time_delta > 5_seconds | RETURN host, process_name, time_delta",playbooks/attack/enterprise/T1055.012.yml
T1055.012: Process Hollowing,a4b1c8d0-9e7f-4a6b-8c5d-1f2a3b4c5d6e,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,5,"Has any process exhibited an abnormally long startup delay, exceeding the 99th percentile of its historical distribution?","This question uses a statistical approach to detect suspended processes by dynamically baselining the startup time for every process. Instead of a static threshold, it compares the time delta between creation and first activity ($$ \Delta t $$) to the historical behavior of that specific process. An instance where the delay exceeds a high percentile (e.g., $$ P_{99} $$) is a strong statistical anomaly, suggesting potential manipulation like process hollowing.",Windows Event ID 4688; Sysmon Event ID 1; Sysmon Event ID 7; Zeek conn.log; User Workstations; Critical Application Servers; Network Egress Points,last 90 days,"pseudocode: CORRELATE process_creation_logs with subsequent_activity_logs | CALCULATE time_delta | FOR each process_name, calculate 99th_percentile(time_delta) as threshold | WHERE time_delta > threshold | RETURN host, process_name, time_delta, threshold",playbooks/attack/enterprise/T1055.012.yml
T1055.012: Process Hollowing,a4b1c8d0-9e7f-4a6b-8c5d-1f2a3b4c5d6e,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,6,Has a clustering model classified any new process event as having 'suspended' startup behavior?,"This question applies unsupervised machine learning to group process startup behaviors. By using a clustering algorithm like DBSCAN on features like time-to-first-action and parent process, the system can automatically identify distinct clusters. These clusters can be labeled as 'normal' or 'suspended'. Any new process event that falls into a 'suspended' cluster is flagged as a high-risk anomaly indicative of process hollowing.",Windows Event ID 4688; Sysmon Event ID 1; Sysmon Event ID 7; Zeek conn.log; User Workstations; Critical Application Servers; Network Egress Points,last 90 days,"pseudocode: GATHER process_startup_features (time_delta, parent, cmd_entropy) | INPUT to clustering_model | WHERE cluster_label == 'suspended' | RETURN host, process_name, cluster_label",playbooks/attack/enterprise/T1055.012.yml
T1055.012: Process Hollowing,a4b1c8d0-9e7f-4a6b-8c5d-1f2a3b4c5d6e,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,7,Has a parent process been observed accessing its newly created child process with memory write permissions?,"This question targets a direct indicator of process hollowing: a parent process writing to the memory of its child. This is detected by correlating a Sysmon Process Creation event (EID 1) with a subsequent Process Access event (EID 10). An alert is triggered if the source of the access is the parent, the target is the child, and the access rights (`GrantedAccess`) explicitly permit memory modification (e.g., `PROCESS_VM_WRITE` or `PROCESS_VM_OPERATION`).",Sysmon Event ID 1; Sysmon Event ID 10; Domain Controllers; User Workstations; Member Servers,last 90 days,"pseudocode: CORRELATE (Sysmon EID 1 as P1) with (Sysmon EID 10 as P2) | WHERE P1.pid == P2.source_pid AND P1.new_pid == P2.target_pid AND P2.granted_access IN (memory_write_flags) | RETURN host, source_process, target_process, granted_access",playbooks/attack/enterprise/T1055.012.yml
T1055.012: Process Hollowing,a4b1c8d0-9e7f-4a6b-8c5d-1f2a3b4c5d6e,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,8,Have any parent-child process pairs been observed using statistically rare memory access codes?,"This question identifies anomalous memory access by baselining the `GrantedAccess` codes used between specific parent-child process pairs. While some access is normal, certain codes, especially those for writing to virtual memory, are rarely used in legitimate operations. By flagging pairs that use access codes with a very low frequency (e.g., <0.1%), we can uncover suspicious memory manipulation attempts characteristic of process hollowing.",Sysmon Event ID 1; Sysmon Event ID 10; Domain Controllers; User Workstations; Member Servers,last 90 days,"pseudocode: SEARCH Sysmon_EID_10 | STATS count by parent_process, child_process, granted_access | GROUP by parent_child_pair | IDENTIFY rare granted_access codes per pair | ALERT on usage of rare codes",playbooks/attack/enterprise/T1055.012.yml
T1055.012: Process Hollowing,a4b1c8d0-9e7f-4a6b-8c5d-1f2a3b4c5d6e,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,9,Has a sequence analysis model detected an anomalous event sequence indicative of a parent process writing to a child's memory?,"This question uses a sophisticated sequence model (like an LSTM or HMM) to learn the normal temporal patterns of Sysmon events on a host. The model can then identify event sequences that are highly improbable. A sequence of [Process Create] followed by [Process Access with write rights] is a classic pattern for process hollowing, and if the model flags this sequence as anomalous for the involved processes, it provides a strong signal of malicious activity.",Sysmon Event ID 1; Sysmon Event ID 10; Domain Controllers; User Workstations; Member Servers,last 90 days,"pseudocode: STREAM Sysmon_events per host | INPUT to sequence_model | WHERE sequence_pattern == [create -> access_write] AND probability < threshold | RETURN host, anomalous_sequence, probability",playbooks/attack/enterprise/T1055.012.yml
T1055.012: Process Hollowing,a4b1c8d0-9e7f-4a6b-8c5d-1f2a3b4c5d6e,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,10,Has a process with an anomalous parent connected to a destination known to be malicious?,"This question seeks to find a strong indicator of compromise by correlating two suspicious events. First, a process is created by an unexpected parent (e.g., svchost.exe not spawned by services.exe), suggesting it may have been hollowed. Second, this suspicious process makes a network connection to an IP or domain on a threat intelligence feed. The combination of these two events is a high-fidelity indicator that a compromised process is communicating with a command-and-control server.",Zeek conn.log; Zeek dns.log; Windows Event ID 4688; Sysmon Event ID 1; Network Egress Points; DNS Servers; User Workstations,last 90 days,"pseudocode: JOIN (process_creation_logs WHERE parent_is_anomalous) with (network_logs) on process_id | LOOKUP destination_ip in threat_intel_feed | WHERE match_found | RETURN host, process, parent, destination_ip",playbooks/attack/enterprise/T1055.012.yml
T1055.012: Process Hollowing,a4b1c8d0-9e7f-4a6b-8c5d-1f2a3b4c5d6e,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,11,Has a newly created process exhibited signs of algorithmic domain generation or connected using a rare JA3/JA3S hash?,"This question looks for indicators of sophisticated command-and-control (C2) communication. High Shannon entropy ($$ H(X) = -\sum_{i=1}^{n} P(x_i) \log_2 P(x_i) $$) in queried domain names can reveal Domain Generation Algorithms (DGAs). Additionally, a rare JA3S hash (server-side TLS fingerprint) suggests the process is communicating with a non-standard, possibly malicious server. Both are strong indicators that a hollowed process is being used for C2.",Zeek conn.log; Zeek dns.log; Zeek ssl.log; Windows Event ID 4688; Sysmon Event ID 1; Network Egress Points; DNS Servers; User Workstations,last 90 days,"pseudocode: SEARCH network_logs near process_creation_time | CALCULATE shannon_entropy(queried_domains) OR CHECK rarity(JA3S_hash) | WHERE entropy > threshold OR rarity < threshold | RETURN host, process, indicator_type",playbooks/attack/enterprise/T1055.012.yml
T1055.012: Process Hollowing,a4b1c8d0-9e7f-4a6b-8c5d-1f2a3b4c5d6e,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,12,"Has a graph-based anomaly detection model identified a rare relationship between processes, hosts, and network destinations?","This question uses graph analysis to uncover complex, multi-hop attack patterns that are difficult to spot with simple rules. By modeling processes, hosts, and IPs as a graph, the system can learn what normal system interactions look like. The emergence of a rare subgraph—for instance, an Office app spawning calculator.exe which then connects to a low-reputation IP—represents a significant structural anomaly highly indicative of a successful process hollowing attack.",Zeek conn.log; Windows Event ID 4688; Sysmon Event ID 1; Network Egress Points; DNS Servers; User Workstations,last 90 days,pseudocode: CONSTRUCT graph from process and network logs | INPUT graph to anomaly_detection_model | WHERE subgraph is flagged as rare | RETURN anomalous_subgraph_details,playbooks/attack/enterprise/T1055.012.yml
T1055.012: Process Hollowing,a4b1c8d0-9e7f-4a6b-8c5d-1f2a3b4c5d6e,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,13,Have any process creation events contained command-line arguments that match known malicious patterns or YARA rules?,"This question focuses on signature-based detection by scanning the command-line arguments of all new processes. Many malware families and attack tools (like Formbook or Dridex) use specific, recognizable command-line flags or structures when performing process hollowing. By matching these against a library of YARA or regex rules, we can quickly identify known threats.",Windows Event ID 4688; Sysmon Event ID 1; All Windows Endpoints and Servers,last 90 days,"pseudocode: SEARCH process_creation_logs | SCAN command_line with YARA_ruleset | WHERE match_found | RETURN host, process, command_line, matched_rule",playbooks/attack/enterprise/T1055.012.yml
T1055.012: Process Hollowing,a4b1c8d0-9e7f-4a6b-8c5d-1f2a3b4c5d6e,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,14,Have any processes been created with command-line arguments exhibiting unusually high entropy or a strange character ratio?,"This question aims to detect obfuscated or randomized command-line arguments, a common technique to hide malicious payloads. By establishing a baseline for the normal complexity (entropy) and character composition for each process's command line, we can flag significant deviations. A command line with entropy or a character ratio more than 3 standard deviations from its process's norm suggests obfuscation and warrants investigation.",Windows Event ID 4688; Sysmon Event ID 1; All Windows Endpoints and Servers,last 90 days,"pseudocode: SEARCH process_creation_logs | CALCULATE entropy(command_line), char_ratio(command_line) | COMPARE to historical_baseline for that process | WHERE value > (mean + 3*stdev) | RETURN host, process, command_line, anomalous_metric",playbooks/attack/enterprise/T1055.012.yml
T1055.012: Process Hollowing,a4b1c8d0-9e7f-4a6b-8c5d-1f2a3b4c5d6e,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,15,Has a machine learning model classified any process command lines as malicious?,"This question leverages a supervised machine learning model to distinguish between benign and malicious command lines. By training on a large, labeled dataset, a text classification model can learn the subtle features and structures that indicate malicious intent, even for previously unseen commands. This provides a scalable way to score all new process creation events and automatically flag suspicious ones with high confidence.",Windows Event ID 4688; Sysmon Event ID 1; All Windows Endpoints and Servers,last 90 days,"pseudocode: STREAM process_creation_logs | INPUT command_line to text_classification_model | WHERE prediction == 'malicious' AND confidence > threshold | RETURN host, process, command_line, confidence_score",playbooks/attack/enterprise/T1055.012.yml
T1055.012: Process Hollowing,a4b1c8d0-9e7f-4a6b-8c5d-1f2a3b4c5d6e,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,16,"Has a process that should never have network activity (e.g., calculator.exe) been observed making an outbound connection?","This question implements a simple but highly effective rule. Certain system utilities and applications, like calculator.exe or notepad.exe, have no legitimate reason to make network connections. By maintaining a blacklist of such processes and alerting anytime one is seen in network logs, we can reliably detect when it has been compromised or hollowed to act as a C2 channel.",Windows Event ID 4688; Sysmon Event ID 1; Zeek conn.log; Network Egress Points; User Workstations; Application Servers,last 90 days,"pseudocode: SEARCH network_logs | LOOKUP process_name in no_network_blacklist | WHERE match_found | RETURN host, process_name, destination_ip, destination_port",playbooks/attack/enterprise/T1055.012.yml
T1055.012: Process Hollowing,a4b1c8d0-9e7f-4a6b-8c5d-1f2a3b4c5d6e,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,17,Has a process exhibited network behavior that deviates significantly from its historical baseline?,"This question focuses on behavioral anomaly detection for processes that do have legitimate network activity. For a process like svchost.exe, we can build a profile of its normal destination ports, protocols, and data volumes. An alert is triggered if a new connection deviates from this norm, such as using a port outside the top 99.9% of its historical usage. This can detect a hollowed process being used for non-standard C2 communication.",Windows Event ID 4688; Sysmon Event ID 1; Zeek conn.log; Zeek dns.log; Network Egress Points; User Workstations; Application Servers,last 90 days,"pseudocode: SEARCH network_logs | COMPARE connection_details (port, proto, bytes) to historical_baseline for process_name | WHERE deviation > threshold (e.g., port not in top 99.9%) | RETURN host, process, connection_details",playbooks/attack/enterprise/T1055.012.yml
T1055.012: Process Hollowing,a4b1c8d0-9e7f-4a6b-8c5d-1f2a3b4c5d6e,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,18,Has an autoencoder model detected an anomalous network connection based on a high reconstruction error?,"This question applies a neural network approach to find anomalous network connections. An autoencoder is trained on features of normal connections (process name, port, protocol, etc.) and learns to reconstruct them with low error. When a new connection, potentially from a hollowed process, has features that differ from the norm, the model will struggle to reconstruct it, resulting in a high reconstruction error. This high error serves as a powerful anomaly signal.",Windows Event ID 4688; Sysmon Event ID 1; Zeek conn.log; Zeek dns.log; Network Egress Points; User Workstations; Application Servers,last 90 days,"pseudocode: STREAM network_connection_features | INPUT to autoencoder_model | CALCULATE reconstruction_error | WHERE reconstruction_error > threshold | RETURN host, process, connection_details, error_score",playbooks/attack/enterprise/T1055.012.yml
T1055.012: Process Hollowing,a4b1c8d0-9e7f-4a6b-8c5d-1f2a3b4c5d6e,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,19,Has a parent process terminated within a very short time (< 2 seconds) after creating a child process?,"This question looks for the 'dropper' pattern, where a loader process creates and injects into a new process and then immediately terminates to cover its tracks. By correlating process creation (Event ID 4688) and termination (Event ID 4689) events, we can detect when a parent's lifespan is suspiciously short after spawning a child. A fixed threshold (e.g., < 2 seconds) can effectively catch this behavior.",Windows Event ID 4688; Windows Event ID 4689; All Windows Endpoints and Servers,last 90 days,"pseudocode: CORRELATE (EID 4688 as child_create), (EID 4689 as parent_terminate) on parent_pid | CALCULATE time_delta = parent_terminate_time - child_create_time | WHERE time_delta < 2_seconds | RETURN host, parent_process, child_process, time_delta",playbooks/attack/enterprise/T1055.012.yml
T1055.012: Process Hollowing,a4b1c8d0-9e7f-4a6b-8c5d-1f2a3b4c5d6e,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,20,"Has a parent process exhibited an abnormally fast termination after spawning a child, relative to its own historical behavior?","This question refines the previous one by using a statistical baseline instead of a fixed threshold. It calculates the 'parent post-spawn lifespan' for every process creation event and compares it to the historical distribution for that specific parent process name. An instance where the lifespan falls into a very low percentile (e.g., the 1st percentile) indicates that the parent terminated abnormally quickly, a strong sign of a dropper or loader.",Windows Event ID 4688; Windows Event ID 4689; All Windows Endpoints and Servers,last 90 days,"pseudocode: CALCULATE parent_lifespan_post_spawn for all events | FOR each parent_process, calculate 1st_percentile(lifespan) as threshold | WHERE current_lifespan < threshold | RETURN host, parent_process, child_process, lifespan",playbooks/attack/enterprise/T1055.012.yml
T1055.012: Process Hollowing,a4b1c8d0-9e7f-4a6b-8c5d-1f2a3b4c5d6e,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,21,Has a sequence analysis model flagged a 'create-child-then-terminate' event sequence as having a low probability?,This question uses a Recurrent Neural Network (RNN) or similar model to understand the normal sequences of endpoint events. The model learns the probability of transitions between events like process creation and termination. A sequence where a parent process creates a child and then immediately terminates might be normal for some processes (like updaters) but highly anomalous for others. The model can distinguish between these cases and flag low-probability occurrences as high-risk.,Windows Event ID 4688; Windows Event ID 4689; All Windows Endpoints and Servers,last 90 days,"pseudocode: STREAM endpoint_events per host | INPUT to sequence_model | WHERE event_sequence matches 'create->terminate' pattern AND sequence_probability is low | RETURN host, parent, child, probability",playbooks/attack/enterprise/T1055.012.yml
T1055.012: Process Hollowing,a4b1c8d0-9e7f-4a6b-8c5d-1f2a3b4c5d6e,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,22,Has a Sysmon Event ID 8 (CreateRemoteThread) been observed where the source and target processes are different?,"This question targets a primary method of code injection. A CreateRemoteThread event where the source and target processes differ indicates that one process is injecting a thread into another. While this can be legitimate (e.g., debuggers, AV), it is often malicious, especially when the target is a common system process like explorer.exe and the source is not a known-good tool. This rule provides a broad net to catch suspicious cross-process injection.",Sysmon Event ID 8; Sysmon Event ID 1; User Workstations; Terminal Servers; Critical Application Servers,last 90 days,"pseudocode: SEARCH Sysmon_EID_8 | WHERE source_image != target_image AND target_image IN (common_system_processes) AND source_image NOT IN (known_good_injectors) | RETURN host, source_image, target_image",playbooks/attack/enterprise/T1055.012.yml
T1055.012: Process Hollowing,a4b1c8d0-9e7f-4a6b-8c5d-1f2a3b4c5d6e,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,23,Has a statistically rare source-target pair been observed in a CreateRemoteThread event?,"This question refines the detection of malicious thread injection by baselining normal activity. By profiling which `(SourceImage, TargetImage)` pairs are common in CreateRemoteThread events, we can flag any pair that is statistically rare (e.g., seen < 5 times in 90 days). This helps filter out the noise of legitimate tools and focuses on novel, potentially malicious injection events, especially if the source process is running from an unusual location like AppData.",Sysmon Event ID 8; Sysmon Event ID 1; User Workstations; Terminal Servers; Critical Application Servers,last 90 days,"pseudocode: SEARCH Sysmon_EID_8 | STATS count by source_image, target_image | WHERE count < 5 | RETURN host, source_image, target_image, count",playbooks/attack/enterprise/T1055.012.yml
T1055.012: Process Hollowing,a4b1c8d0-9e7f-4a6b-8c5d-1f2a3b4c5d6e,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,24,Has a machine learning model classified a CreateRemoteThread event as likely malicious?,"This question uses a supervised model like a Random Forest to automate the classification of CreateRemoteThread events. By training on features like the source/target process names, their reputation, and whether the source path is user-writable, the model can learn to accurately predict malicious injection. This provides a powerful, automated way to score all Event ID 8 occurrences and alert on those with a high probability of being malicious.",Sysmon Event ID 8; Sysmon Event ID 1; User Workstations; Terminal Servers; Critical Application Servers,last 90 days,"pseudocode: STREAM Sysmon_EID_8_events | EXTRACT features (source, target, path, reputation) | INPUT to classification_model | WHERE prediction == 'malicious' | RETURN host, source, target, confidence_score",playbooks/attack/enterprise/T1055.012.yml
T1056.002: GUI Input Capture,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0006: Credential Access; TA0009: Collection,n; o; n; e,1,Is a process associated with a known GUI-based credential theft tool running on the endpoint?,"This question aims to identify the most direct evidence of a GUI input capture attack by checking for the execution of tools specifically designed for this purpose. By comparing the file hash of newly created processes against a curated list of Indicators of Compromise (IoCs) for tools like PowerSploit, Mimikatz variants, or other credential phishing executables, an analyst can quickly confirm a high-confidence compromise. A match indicates an active attempt to spoof a GUI prompt and steal user credentials.",Windows Event ID 4688; Sysmon Event ID 1; User workstations; Remote Desktop servers; Citrix servers; Virtual Desktop Infrastructure (VDI) instances; SIEM correlation engine,Last 90 days,"Search process creation events (WEF 4688, Sysmon 1). FOR EACH event, EXTRACT file hash (MD5, SHA256). COMPARE hash against IoC list of known GUI credential theft tools. IF match found, ALERT with hostname, user, process name, and hash.",playbooks/attack/enterprise/T1056.002.yml
T1056.002: GUI Input Capture,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0006: Credential Access; TA0009: Collection,n; o; n; e,2,"Has a rare or previously unseen process been spawned by a common user application, potentially indicating a disguised credential phisher?",Adversaries may use custom or packed tools that do not have a known malicious hash. This question helps uncover such tools by focusing on rarity. A process spawned by a common application like a web browser or email client that has only run on a very small number of endpoints across the enterprise is highly suspicious. This statistical anomaly suggests the process is not standard software and could be a custom-built tool for GUI-based credential theft.,Windows Event ID 4688; Sysmon Event ID 1; User workstations; Remote Desktop servers; Citrix servers; Virtual Desktop Infrastructure (VDI) instances; SIEM correlation engine,Last 90 days,"FROM process creation events, GROUP BY process hash. CALCULATE prevalence of each hash across all endpoints over the last 30 days. FILTER for processes spawned by common user applications (e.g., OUTLOOK.EXE, WINWORD.EXE). IF prevalence is below threshold (e.g., < 0.1% of hosts), FLAG as rare and suspicious for investigation.",playbooks/attack/enterprise/T1056.002.yml
T1056.002: GUI Input Capture,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0006: Credential Access; TA0009: Collection,n; o; n; e,3,Does a newly created process exhibit characteristics of a known credential phishing tool based on a machine learning model?,"This question leverages a machine learning model to identify malicious processes that may evade hash-based and simple statistical detections. The model analyzes a combination of features like the parent process, command-line arguments, and user context to classify a process's intent. An alert from this model indicates that the process's behavior profile strongly matches patterns seen in previously identified GUI credential phishing attacks, even if the specific file or command is new.",Windows Event ID 4688; Sysmon Event ID 1; User workstations; Remote Desktop servers; Citrix servers; Virtual Desktop Infrastructure (VDI) instances; SIEM correlation engine,Last 90 days,"INPUT process creation event features (parent process, path, command-line length/entropy, user) into a pre-trained classification model. IF model output score is > confidence threshold (e.g., 0.90), CLASSIFY as credential phisher and ALERT.",playbooks/attack/enterprise/T1056.002.yml
T1056.002: GUI Input Capture,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0006: Credential Access; TA0009: Collection,n; o; n; e,4,Is a scripting interpreter being used to generate a GUI element for potential credential capture?,"This question looks for adversaries using scripting languages like PowerShell to dynamically create fake login prompts. The presence of specific keywords related to GUI creation (e.g., 'System.Windows.Forms', 'Show-Dialog') in a script's command line or code block is a strong indicator of this technique. It's particularly suspicious if the script is not launched from a development environment (like powershell_ise.exe), as it suggests an attempt to run a malicious GUI-spoofing script on a user's machine.",Windows Event ID 4688; Sysmon Event ID 1; Windows PowerShell Event ID 4104; User workstations; Domain Controllers; Application servers; Exchange servers,Last 90 days,"SEARCH command-line arguments (WEF 4688, Sysmon 1) and PowerShell script blocks (WEF 4104) for keywords like 'System.Windows.Forms', 'Show-Dialog', etc. IF keywords are found AND parent process is not a known IDE, ALERT.",playbooks/attack/enterprise/T1056.002.yml
T1056.002: GUI Input Capture,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0006: Credential Access; TA0009: Collection,n; o; n; e,5,Is a script being executed that is unusually long or complex compared to the baseline for that user or host?,"Adversaries often obfuscate or embed large payloads (like GUI generation code) within their scripts, making them statistically different from typical, simple administrative scripts. This question aims to detect these outliers by analyzing the length and character entropy (randomness) of script blocks. A script that is significantly longer or more complex than the established norm for a given user or host is suspicious and may contain malicious code for GUI spoofing.",Windows PowerShell Event ID 4104; User workstations; Domain Controllers; Application servers; Exchange servers,Last 90 days,"FOR EACH PowerShell script execution (WEF 4104), CALCULATE script block length and entropy. ESTABLISH baseline distribution for these metrics per user/host. IF a new script's metrics exceed a high percentile (e.g., 98th) of its baseline, FLAG for review.",playbooks/attack/enterprise/T1056.002.yml
T1056.002: GUI Input Capture,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0006: Credential Access; TA0009: Collection,n; o; n; e,6,Does the content of a PowerShell script block classify as malicious based on a machine learning model trained to detect credential theft scripts?,"This question applies a sophisticated machine learning model to the full text of PowerShell scripts to identify malicious behavior. The model is trained to recognize the patterns, functions, and structures commonly found in credential-stealing scripts, including those that generate spoofed GUI prompts. An alert indicates that the script's content is highly similar to known malicious examples, providing a high-confidence detection that can bypass simple keyword or statistical checks.",Windows PowerShell Event ID 4104; User workstations; Domain Controllers; Application servers; Exchange servers,Last 90 days,"INPUT tokenized PowerShell script block content (WEF 4104) into a pre-trained classification model. IF model classifies the script as malicious with high probability, ALERT.",playbooks/attack/enterprise/T1056.002.yml
T1056.002: GUI Input Capture,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0006: Credential Access; TA0009: Collection,n; o; n; e,7,Has a common document-based application (like Word or Outlook) spawned a scripting interpreter?,"This question targets a common infection vector where a user opens a malicious document or email, which then launches a script to perform further actions. Applications like Microsoft Word, Outlook, or Adobe Reader should not normally spawn processes like powershell.exe or cmd.exe. Observing such a parent-child process relationship is a high-fidelity indicator of compromise, often representing the initial stage of an attack that could lead to GUI-based credential theft.",Windows Event ID 4688; Sysmon Event ID 1; User workstations; File servers hosting Office documents; Mail servers; SIEM correlation engine,Last 90 days,"MONITOR process creation events (WEF 4688, Sysmon 1). IF parent process is in list [WINWORD.EXE, OUTLOOK.EXE, AcroRd32.exe] AND child process is in list [powershell.exe, cmd.exe, wscript.exe], trigger a high-severity ALERT.",playbooks/attack/enterprise/T1056.002.yml
T1056.002: GUI Input Capture,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0006: Credential Access; TA0009: Collection,n; o; n; e,8,Has a rare or never-before-seen parent-child process relationship occurred on the endpoint?,"Adversaries may use less common applications or scripts to evade simple rules. This question establishes a baseline of all normal parent-child process relationships across the enterprise and then looks for deviations. Any relationship that has never been seen before or is extremely infrequent is flagged as an anomaly. This can uncover novel attack paths, such as a legitimate but rarely used application being exploited to launch a malicious script or tool for credential capture.",Windows Event ID 4688; Sysmon Event ID 1; User workstations; File servers hosting Office documents; Mail servers; SIEM correlation engine,Last 90 days,"BUILD frequency table of all parent-child process pairs over 30 days. IF a newly observed pair is 'first seen' or its frequency is in the bottom percentile (e.g., < 1%), ALERT as a rare process chain.",playbooks/attack/enterprise/T1056.002.yml
T1056.002: GUI Input Capture,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0006: Credential Access; TA0009: Collection,n; o; n; e,9,Does a process creation event deviate significantly from the normal process activity patterns learned by an anomaly detection model?,"This question uses an unsupervised machine learning model to learn the complex web of normal process interactions on endpoints. The model considers factors like parent process, child process, user, and time of day. Any new process creation event that the model flags as a high-scoring anomaly represents a significant deviation from established behavior. This is a powerful way to detect sophisticated attacks that use legitimate tools in illegitimate ways (living-off-the-land) to initiate a credential capture sequence.",Windows Event ID 4688; Sysmon Event ID 1; User workstations; File servers hosting Office documents; Mail servers; SIEM correlation engine,Last 90 days,"INPUT features from parent-child process events (parent name, child name, user, time) into an unsupervised anomaly detection model (e.g., Isolation Forest). IF the event receives a high anomaly score, FLAG for investigation.",playbooks/attack/enterprise/T1056.002.yml
T1056.002: GUI Input Capture,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0006: Credential Access; TA0009: Collection,n; o; n; e,10,Did a host that recently triggered a credential capture alert make an outbound connection to a known malicious IP or domain?,"This question directly links a suspected credential capture event with potential data exfiltration. By correlating a high-risk process alert with subsequent network traffic from the same host, an analyst can confirm the attack's progression. A connection to a destination on a threat intelligence blocklist within minutes of the initial alert is strong evidence that captured data is being sent to an adversary-controlled command-and-control (C2) server.","Zeek conn.log; Zeek http.log; Zeek dns.log; Windows Event ID 4688; Sysmon Event ID 1; Sysmon Event ID 3; Network egress points (firewalls, proxies); DNS servers; Endpoints; SIEM correlation engine",Last 90 days,"CORRELATE credential capture alerts with network connection logs (Sysmon 3, Zeek). IF source host of alert initiates outbound connection within 5 minutes to a destination on a threat intel blocklist, ESCALATE to incident.",playbooks/attack/enterprise/T1056.002.yml
T1056.002: GUI Input Capture,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0006: Credential Access; TA0009: Collection,n; o; n; e,11,"Following a credential capture alert, did the host make DNS requests for statistically unusual domains (e.g., newly registered, high entropy)?","Adversaries often use newly created or algorithmically generated domains for their C2 infrastructure to evade blocklists. This question aims to detect such activity by analyzing the characteristics of domains requested by a potentially compromised host. Domains that are very new, have random-looking names (high entropy), or are rarely visited by anyone else in the enterprise are statistically anomalous and likely malicious. This is a strong indicator of C2 communication for data exfiltration.","Zeek dns.log; Network egress points (firewalls, proxies); DNS servers; Endpoints; SIEM correlation engine",Last 90 days,"ON host with recent credential capture alert, ANALYZE subsequent DNS queries (Zeek dns.log). CALCULATE domain features (age, entropy, rarity). IF domain is anomalous (e.g., age < 30 days, entropy > 3.5), FLAG as potential C2.",playbooks/attack/enterprise/T1056.002.yml
T1056.002: GUI Input Capture,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0006: Credential Access; TA0009: Collection,n; o; n; e,12,"Did a host, after a suspected GUI capture event, attempt to resolve a domain that a machine learning model classifies as a likely Domain Generation Algorithm (DGA) domain?","This question uses a specialized machine learning model to detect a specific C2 technique Domain Generation Algorithms (DGAs). These algorithms create large numbers of pseudo-random domain names, with the malware trying to connect to them until it finds one that the adversary has registered. A DGA detection model can identify these algorithmically generated names. A positive hit on a host that recently had a credential capture alert is a high-confidence indicator of active C2 communication.","Zeek dns.log; Network egress points (firewalls, proxies); DNS servers; Endpoints; SIEM correlation engine",Last 90 days,"INPUT all DNS queries (Zeek dns.log) into a DGA detection model. IF a domain is classified as DGA AND the query comes from a host with a recent GUI capture alert, ALERT.",playbooks/attack/enterprise/T1056.002.yml
T1056.002: GUI Input Capture,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0006: Credential Access; TA0009: Collection,n; o; n; e,13,Is an unusual process (not a web browser) sending an HTTP/S POST request containing credential-like data patterns?,"This question targets the exfiltration of credentials over the common web protocols HTTP or HTTPS. With TLS inspection, the body of the request can be scanned for keywords like 'username=' or 'password='. Even without inspection, identifying the process that initiated the request is key. A process like powershell.exe or an unsigned binary making an HTTP POST is highly irregular, as these processes do not typically perform web-based authentication. This is a strong sign of data exfiltration.",Zeek http.log; Zeek ssl.log; Windows Event ID 4688; Sysmon Event ID 1; Web proxies with TLS inspection; Network TAPs at egress points; Endpoints,Last 90 days,"WITH TLS inspection, SCAN HTTP POST request bodies for credential patterns (e.g., /user|pass=/i). CORRELATE with process logs to find originating process. IF process is not a whitelisted browser, ALERT.",playbooks/attack/enterprise/T1056.002.yml
T1056.002: GUI Input Capture,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0006: Credential Access; TA0009: Collection,n; o; n; e,14,Did a non-browser process make an HTTP POST request with a body size that is both small and a statistical outlier for that process?,"This question helps detect credential exfiltration without needing to inspect the encrypted traffic payload. The logic is that exfiltrated credentials constitute a small amount of data. By establishing a baseline for the normal size of HTTP POST requests made by each process, we can spot anomalies. A very small POST request from a process that normally sends larger data chunks (or none at all) is a statistical outlier and could represent a credential theft event.",Zeek http.log; Windows Event ID 4688; Sysmon Event ID 1; Web proxies with TLS inspection; Network TAPs at egress points; Endpoints,Last 90 days,"FOR all HTTP POST requests, CALCULATE request body size. ESTABLISH per-process baseline of POST sizes. IF request from non-browser has small size (e.g., < 1KB) AND is a statistical outlier (> 3 std dev from mean), FLAG as potential exfiltration.",playbooks/attack/enterprise/T1056.002.yml
T1056.002: GUI Input Capture,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0006: Credential Access; TA0009: Collection,n; o; n; e,15,Is an HTTP/S connection being classified as malicious by a machine learning model based on its metadata and originating process?,"This question uses a machine learning model to holistically evaluate an HTTP/S connection for maliciousness, even without decrypting the traffic. The model considers features like the process that made the connection, the destination server name (SNI), the structure of the URI, and the TLS handshake fingerprint (JA3/JA3S). An alert from this model indicates that the entire connection profile matches known malicious patterns, providing a robust method for detecting C2 communication and data exfiltration.",Zeek http.log; Zeek ssl.log; Windows Event ID 4688; Sysmon Event ID 1; Web proxies with TLS inspection; Network TAPs at egress points; Endpoints,Last 90 days,"INPUT connection features (process name, SNI, URI, JA3 hash) into a pre-trained classifier. IF connection is classified as malicious with high confidence, ALERT.",playbooks/attack/enterprise/T1056.002.yml
T1056.002: GUI Input Capture,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0006: Credential Access; TA0009: Collection,n; o; n; e,16,Is there evidence of data exfiltration via covert channels like DNS or ICMP shortly after a suspected credential capture event?,"This question looks for adversaries trying to sneak data out using protocols not designed for file transfer. By encoding data into long DNS subdomains or hiding it in ICMP packet payloads, they can bypass some network security controls. Detecting unusually long DNS queries or ICMP packets with payloads, and correlating them in time and source host with a prior credential capture alert, provides strong evidence of a stealthy exfiltration attempt.",Zeek dns.log; Zeek conn.log; Zeek icmp.log; Windows Event ID 4688; Sysmon Event ID 1; DNS resolvers; Network egress points (firewalls); Endpoints; SIEM correlation engine,Last 90 days,"MONITOR DNS logs for long FQDNs (>100 chars) or ICMP logs for packets with payload > 0. CORRELATE source host with recent credential capture alerts. IF match, ALERT.",playbooks/attack/enterprise/T1056.002.yml
T1056.002: GUI Input Capture,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0006: Credential Access; TA0009: Collection,n; o; n; e,17,Has a host's DNS query behavior suddenly spiked in a way that suggests DNS tunneling?,"DNS tunneling for data exfiltration generates a distinct and anomalous traffic pattern. This question aims to detect that pattern by baselining a host's normal DNS activity (e.g., query length, number of subdomains). A sudden and sustained increase in these metrics, deviating significantly from the host's own historical norm, is a strong statistical indicator that the DNS protocol is being abused to exfiltrate data, likely credentials captured in a preceding attack phase.",Zeek dns.log; DNS resolvers; Network egress points (firewalls); Endpoints; SIEM correlation engine,Last 90 days,"CREATE time series of host's DNS metrics (avg query length, unique subdomains). IF a sudden spike is > 3 standard deviations from the 30-day baseline, FLAG as potential DNS tunneling.",playbooks/attack/enterprise/T1056.002.yml
T1056.002: GUI Input Capture,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0006: Credential Access; TA0009: Collection,n; o; n; e,18,"Is a host's DNS traffic generating a high anomaly score from a machine learning model, indicating behavior consistent with data exfiltration?","This question uses an unsupervised anomaly detection model to create a sophisticated, multi-faceted profile of a host's normal DNS behavior. The model learns the typical patterns of query types, sizes, and label entropy. Any real-time traffic that significantly deviates from this learned normal profile will receive a high anomaly score. This is an effective way to catch DNS exfiltration techniques that may be too subtle for simple statistical thresholds, providing a more robust detection of covert channel activity.",Zeek dns.log; DNS resolvers; Network egress points (firewalls); Endpoints; SIEM correlation engine,Last 90 days,"INPUT per-host DNS traffic features (query sizes, label entropy, type distribution) into an unsupervised anomaly detection model. IF traffic generates a high anomaly score, ALERT for potential exfiltration.",playbooks/attack/enterprise/T1056.002.yml
T1059.001: PowerShell,f8c3b3e0-642d-4b5a-9d1e-8f3a7c6b9e1a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,1,"Has a PowerShell script block been observed that matches known malicious indicators, such as a known bad hash or a C2 indicator (IP, domain, URL)?",This question aims to identify overtly malicious PowerShell activity by matching script content against curated threat intelligence. A match provides a high-confidence signal that an attacker is using a known malicious script or connecting to known malicious infrastructure.,Windows Event ID 4104; Windows Event ID 4688; Zeek conn.log; Zeek dns.log; All Windows Endpoints and Servers; DNS Resolvers; Network Egress Points,last 90 days,": FOR each new Event ID 4104:
  script_hash = SHA256(script_block_content)
  IF script_hash IN known_bad_hashes:
    ALERT ""Malicious PowerShell script hash detected""
  extracted_iocs = EXTRACT_IOCS(script_block_content)
  FOR ioc IN extracted_iocs:
    IF ioc IN threat_intel_feed:
      ALERT ""Malicious C2 indicator found in PowerShell script""
",playbooks/attack/enterprise/T1059.001.yml
T1059.001: PowerShell,f8c3b3e0-642d-4b5a-9d1e-8f3a7c6b9e1a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,2,"Has a statistically rare PowerShell script been executed, and did its execution coincide with network activity to suspicious domains?",This question helps uncover unknown or unique malicious scripts by focusing on rarity. Adversaries often use custom scripts that will not appear on many systems. Correlating the execution of a rare script with connections to newly registered or low-reputation domains can indicate C2 communication or payload delivery.,Windows Event ID 4104; Windows Event ID 4688; Zeek conn.log; Zeek dns.log; All Windows Endpoints and Servers; DNS Resolvers; Network Egress Points,last 90 days,": # Calculate prevalence over a 30-day window
script_prevalence = COUNT_UNIQUE(hostname) by SHA256(script_block) over 30d
rare_scripts = FILTER script_prevalence WHERE count < 5
FOR each rare_script_execution:
  t_start = execution_time - 1m
  t_end = execution_time + 1m
  suspicious_dns = SEARCH Zeek dns.log WHERE hostname = rare_script.hostname AND timestamp between t_start, t_end AND (domain_is_NRD OR domain_reputation < low_threshold)
  IF suspicious_dns:
    ALERT ""Rare PowerShell script execution correlated with suspicious DNS query""
",playbooks/attack/enterprise/T1059.001.yml
T1059.001: PowerShell,f8c3b3e0-642d-4b5a-9d1e-8f3a7c6b9e1a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,3,Can machine learning models classify observed PowerShell script blocks as malicious based on their textual features?,"This question leverages machine learning to automate the detection of malicious scripts that may not be caught by signature or rarity analysis. By training a model on features like script length, entropy, and keyword presence, it can learn the subtle characteristics of malicious code and score new scripts in real-time.",Windows Event ID 4104; Windows Event ID 4688; Zeek conn.log; Zeek dns.log; All Windows Endpoints and Servers; DNS Resolvers; Network Egress Points,last 90 days,": FOR each new Event ID 4104:
  features = EXTRACT_FEATURES(script_block_content)
  prediction_score = ML_MODEL.predict(features)
  IF prediction_score > 0.85:
    ALERT ""PowerShell script classified as malicious by ML model""
",playbooks/attack/enterprise/T1059.001.yml
T1059.001: PowerShell,f8c3b3e0-642d-4b5a-9d1e-8f3a7c6b9e1a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,4,"Is there evidence of PowerShell command-line or script block obfuscation using common techniques like encoding, expression invocation, or suspicious string manipulation?","This question targets common methods adversaries use to hide their PowerShell commands from simple keyword-based detections. Identifying patterns like Base64 encoding flags, `Invoke-Expression`, or string concatenation is a strong indicator that the script's author is intentionally trying to evade defenses.",Windows Event ID 4104; Windows Event ID 4688; All Windows Endpoints and Servers,last 90 days,": SEARCH Event ID 4688 OR Event ID 4104 WHERE command_line/script_block MATCHES REGEX '(-e|-enc|-encodedcommand|IEX|Invoke-Expression|New-Object Net.WebClient|FromBase64String)'
  ALERT ""Suspicious obfuscation pattern detected in PowerShell""
",playbooks/attack/enterprise/T1059.001.yml
T1059.001: PowerShell,f8c3b3e0-642d-4b5a-9d1e-8f3a7c6b9e1a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,5,"Are there PowerShell scripts with abnormally high entropy or unusual character ratios, suggesting they are packed or obfuscated?","This question uses statistical properties of the script text to find obfuscation. High entropy often indicates that data is compressed or encrypted, which is a common technique for hiding malicious payloads within a script. Comparing these metrics against a baseline of normal activity can surface these outliers.",Windows Event ID 4104; Windows Event ID 4688; All Windows Endpoints and Servers,last 90 days,": # Establish baseline entropy and char ratio
baseline_stats = CALCULATE_STATS(benign_scripts)
FOR each new Event ID 4104:
  script_entropy = CALCULATE_ENTROPY(script_block)
  script_char_ratio = CALCULATE_CHAR_RATIO(script_block)
  IF script_entropy > baseline_stats.entropy_95th_percentile OR script_char_ratio > baseline_stats.ratio_mean + 3*std_dev:
    ALERT ""High entropy or abnormal character ratio detected in PowerShell script""
",playbooks/attack/enterprise/T1059.001.yml
T1059.001: PowerShell,f8c3b3e0-642d-4b5a-9d1e-8f3a7c6b9e1a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,6,Can a machine learning classifier identify obfuscated PowerShell scripts based on their structural and statistical features?,"This question applies machine learning to the specific problem of detecting obfuscation. By training on features like character/word entropy and the frequency of obfuscation-related tokens, a model can learn to distinguish between normal and intentionally obscured scripts, even if the specific obfuscation method is novel.",Windows Event ID 4104; Windows Event ID 4688; All Windows Endpoints and Servers,last 90 days,": FOR each new Event ID 4104:
  features = EXTRACT_OBFUSCATION_FEATURES(script_block_content)
  prediction = OBFUSCATION_ML_MODEL.predict(features)
  IF prediction == 'obfuscated':
    ALERT ""PowerShell script classified as obfuscated by ML model""
",playbooks/attack/enterprise/T1059.001.yml
T1059.001: PowerShell,f8c3b3e0-642d-4b5a-9d1e-8f3a7c6b9e1a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,7,"Has PowerShell been used to execute a 'download cradle', a command that downloads and runs code directly from the internet?",This question looks for the classic fileless execution pattern where PowerShell is used to fetch a second-stage payload from a remote server and execute it in memory without writing it to disk. Correlating this command with immediate outbound network activity provides strong evidence of this technique.,Windows Event ID 4104; Windows Event ID 4688; Zeek http.log; Zeek conn.log; Zeek dns.log; All Windows Endpoints and Servers; Network Egress Points; Web Proxies; DNS Resolvers,last 90 days,": SEARCH Event ID 4688 or 4104 WHERE (command_line/script_block CONTAINS 'IEX' OR 'Invoke-Expression') AND (command_line/script_block CONTAINS 'DownloadString' OR 'DownloadFile' OR 'Invoke-WebRequest')
  FOR each match:
    t_start = event_time
    t_end = event_time + 10s
    network_conn = SEARCH Zeek conn.log/dns.log WHERE source_host = event.host AND timestamp between t_start, t_end AND dest_ip is external
    IF network_conn:
      ALERT ""PowerShell download cradle detected with subsequent network connection""
",playbooks/attack/enterprise/T1059.001.yml
T1059.001: PowerShell,f8c3b3e0-642d-4b5a-9d1e-8f3a7c6b9e1a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,8,"Is the powershell.exe process making an anomalous number of network connections, or is it connecting to unusual destinations with a PowerShell user-agent?","This question uses behavioral analysis to detect suspicious PowerShell network activity. A sudden spike in connections from powershell.exe, or connections to non-allowlisted domains using the default PowerShell user-agent, can indicate that the process is being used for C2 or data exfiltration.",Windows Event ID 4104; Windows Event ID 4688; Zeek http.log; Zeek conn.log; Zeek dns.log; All Windows Endpoints and Servers; Network Egress Points; Web Proxies; DNS Resolvers,last 90 days,": # Anomaly Detection
powershell_conn_baseline = CALCULATE_DAILY_CONN_BASELINE(powershell.exe) by host
MONITOR for daily_count > baseline.99th_percentile
# Rule-based detection
SEARCH Zeek http.log WHERE user_agent CONTAINS 'WindowsPowerShell' AND destination_domain NOT IN allowlist
  ALERT ""PowerShell user-agent connected to non-allowlisted domain""
",playbooks/attack/enterprise/T1059.001.yml
T1059.001: PowerShell,f8c3b3e0-642d-4b5a-9d1e-8f3a7c6b9e1a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,9,"Is the volume of outbound network traffic from powershell.exe processes deviating significantly from its normal, learned pattern?","This question applies time-series analysis to detect data exfiltration via PowerShell. A model learns the expected rhythm of network traffic volume for powershell.exe on each host. A significant, unexplained spike in outbound data can signal that an attacker is using PowerShell to steal data.",Windows Event ID 4104; Windows Event ID 4688; Zeek http.log; Zeek conn.log; Zeek dns.log; All Windows Endpoints and Servers; Network Egress Points; Web Proxies; DNS Resolvers,last 90 days,": FOR each host:
  # Train model on historical powershell.exe bytes_out
  traffic_model = TRAIN_TIMESERIES_MODEL(host_traffic_data)
  # Monitor in real-time
  current_traffic = GET_CURRENT_TRAFFIC(host)
  is_anomaly = traffic_model.detect_anomaly(current_traffic)
  IF is_anomaly:
    ALERT ""Anomalous network traffic volume from powershell.exe detected""
",playbooks/attack/enterprise/T1059.001.yml
T1059.001: PowerShell,f8c3b3e0-642d-4b5a-9d1e-8f3a7c6b9e1a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,10,Has the core PowerShell DLL (System.Management.Automation.dll) been loaded by an unauthorized process?,"This question aims to detect ""unmanaged PowerShell,"" where an adversary injects PowerShell capabilities into a legitimate process (like Word or rundll32.exe) to bypass defenses focused on powershell.exe. Alerting when this DLL is loaded by any process not on a strict allowlist is a high-fidelity way to find this activity.",Sysmon Event ID 7; Windows Event ID 4104; Windows Event ID 4688; All Windows Endpoints and Servers; Microsoft Office applications,last 90 days,": allowlist = ['powershell.exe', 'powershell_ise.exe', 'pwsh.exe']
SEARCH Sysmon Event ID 7 WHERE ImageLoaded ENDS WITH 'System.Management.Automation.dll' AND ProcessImage NOT IN allowlist
  ALERT ""Unmanaged PowerShell detected: DLL loaded by non-standard host""
",playbooks/attack/enterprise/T1059.001.yml
T1059.001: PowerShell,f8c3b3e0-642d-4b5a-9d1e-8f3a7c6b9e1a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,11,Are there rare or unique processes loading the PowerShell DLL across the enterprise?,"This question uses rarity analysis to find suspicious host processes for unmanaged PowerShell. While some legitimate third-party applications might use the PowerShell engine, an adversary's chosen host process is likely to be unique or appear on very few machines. This approach helps identify those outliers for investigation.",Sysmon Event ID 7; Windows Event ID 4104; Windows Event ID 4688; All Windows Endpoints and Servers; Microsoft Office applications,last 90 days,": # Calculate prevalence over 30-day window
loader_prevalence = COUNT_UNIQUE(hostname) by ProcessImage WHERE ImageLoaded ENDS WITH 'System.Management.Automation.dll' over 30d
rare_loaders = FILTER loader_prevalence WHERE count < 5 AND ProcessImage NOT IN allowlist
  FOR each rare_loader:
    ALERT ""Rare process loading PowerShell DLL detected""
",playbooks/attack/enterprise/T1059.001.yml
T1059.001: PowerShell,f8c3b3e0-642d-4b5a-9d1e-8f3a7c6b9e1a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,12,Has an anomalous process-to-DLL load relationship involving the PowerShell DLL been observed?,"This question uses a graph model to formalize the detection of unusual process/DLL interactions. By learning the ""normal"" graph of which processes load which DLLs, the model can immediately flag a new, previously unseen edge (e.g., wscript.exe loading System.Management.Automation.dll) as a high-confidence anomaly.",Sysmon Event ID 7; Windows Event ID 4104; Windows Event ID 4688; All Windows Endpoints and Servers; Microsoft Office applications,last 90 days,": # Train model on historical Sysmon Event ID 7 data
graph_model = TRAIN_GRAPH_MODEL(process_dll_load_data)
# Monitor for new loads
FOR each new Sysmon Event ID 7:
  IF event.ImageLoaded ENDS WITH 'System.Management.Automation.dll':
    is_anomalous_edge = graph_model.check_edge(event.ProcessImage, event.ImageLoaded)
    IF is_anomalous_edge:
      ALERT ""Anomalous process-DLL graph relationship detected for PowerShell""
",playbooks/attack/enterprise/T1059.001.yml
T1059.001: PowerShell,f8c3b3e0-642d-4b5a-9d1e-8f3a7c6b9e1a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,13,"Has a PowerShell process been launched with arguments designed to bypass execution policies, hide windows, or run non-interactively?","This question focuses on command-line arguments that are highly indicative of malicious intent. Parameters like `-ExecutionPolicy Bypass`, `-WindowStyle Hidden`, and `-NonInteractive` are staples of attacker tradecraft used to ensure their scripts run without user interaction or security restrictions.",Windows Event ID 4688; Windows Event ID 4104; Windows Event ID 4105; All Windows Endpoints and Servers; Domain Controllers; Tier 0 assets,last 90 days,": SEARCH Event ID 4688 WHERE ProcessName == 'powershell.exe' AND command_line MATCHES REGEX '(-ep bypass|-w hidden|-noni|-e|-enc)'
  ALERT ""PowerShell launched with suspicious arguments""
",playbooks/attack/enterprise/T1059.001.yml
T1059.001: PowerShell,f8c3b3e0-642d-4b5a-9d1e-8f3a7c6b9e1a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,14,"Has a user executed PowerShell with a suspicious argument (e.g., -EncodedCommand, -Bypass) for the first time?","This question uses ""first use"" analysis to detect behavioral changes. A regular user or administrator typically has a consistent pattern of PowerShell usage. The first time they use a high-risk argument could indicate that their account has been compromised or that they are performing an unusual, potentially malicious action.",Windows Event ID 4688; Windows Event ID 4104; Windows Event ID 4105; All Windows Endpoints and Servers; Domain Controllers; Tier 0 assets,last 90 days,": # Maintain historical set of arguments per user over 90d
user_arg_history = GET_USER_ARG_HISTORY()
suspicious_args = ['-EncodedCommand', '-Bypass', '-w hidden']
FOR each new Event ID 4688:
  FOR arg in suspicious_args:
    IF arg IN event.command_line AND arg NOT IN user_arg_history[event.user]:
      ALERT ""First time use of suspicious PowerShell argument by user""
      UPDATE user_arg_history
",playbooks/attack/enterprise/T1059.001.yml
T1059.001: PowerShell,f8c3b3e0-642d-4b5a-9d1e-8f3a7c6b9e1a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,15,Has a user's PowerShell usage pattern anomalously shifted to a profile associated with more complex or suspicious commands?,"This question uses unsupervised machine learning to automatically group users by their PowerShell behavior. It can identify when an account, which normally exhibits simple or no PowerShell usage, suddenly shifts to a cluster characterized by complex, obfuscated, or suspicious commands, suggesting a potential account takeover.",Windows Event ID 4688; Windows Event ID 4104; Windows Event ID 4105; All Windows Endpoints and Servers; Domain Controllers; Tier 0 assets,last 90 days,": # Periodically re-cluster users
user_features = FEATURIZE_POWERSHELL_USAGE_BY_USER()
user_clusters = DBSCAN(user_features)
# Monitor for cluster changes
MONITOR for user moving from 'benign_cluster' to 'suspicious_cluster'
  ALERT ""User has anomalously shifted to a suspicious PowerShell behavior cluster""
",playbooks/attack/enterprise/T1059.001.yml
T1059.001: PowerShell,f8c3b3e0-642d-4b5a-9d1e-8f3a7c6b9e1a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,16,Does a PowerShell script block contain a large Base64-encoded segment that decodes to a Windows executable (PE file) or shellcode?,"This question targets a specific method of payload delivery where an entire executable or shellcode is embedded directly within the PowerShell script. By looking for large script blocks and then specifically for PE file headers ('MZ') or shellcode patterns within decoded Base64 strings, this provides a very high-confidence detection of an embedded payload.",Windows Event ID 4104; All Windows Endpoints and Servers,last 90 days,": FOR each Event ID 4104 WHERE script_block_size > 4096:
  base64_strings = EXTRACT_BASE64(script_block)
  FOR b64_string in base64_strings:
    decoded_data = DECODE_BASE64(b64_string)
    IF decoded_data STARTS WITH 'MZ' OR decoded_data CONTAINS SHELLCODE_PATTERN:
      ALERT ""Embedded PE file or shellcode detected in PowerShell script""
",playbooks/attack/enterprise/T1059.001.yml
T1059.001: PowerShell,f8c3b3e0-642d-4b5a-9d1e-8f3a7c6b9e1a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,17,"Does a PowerShell script exhibit a bimodal entropy distribution, indicating a mix of normal script text and a large, high-entropy block characteristic of an embedded payload?","This question uses a more nuanced statistical approach to find embedded payloads. Unlike benign scripts which have uniformly low entropy, a script carrying an encrypted or compressed payload will have two distinct regions a low-entropy region for the script logic and a high-entropy region for the payload. Identifying this bimodal distribution is a strong sign of an embedded payload.",Windows Event ID 4104; All Windows Endpoints and Servers,last 90 days,": FOR each Event ID 4104:
  entropy_distribution = CALCULATE_SLIDING_WINDOW_ENTROPY(script_block)
  is_bimodal = CHECK_FOR_BIMODAL_DISTRIBUTION(entropy_distribution)
  IF is_bimodal:
    ALERT ""Bimodal entropy distribution detected in PowerShell script, suggesting embedded payload""
",playbooks/attack/enterprise/T1059.001.yml
T1059.001: PowerShell,f8c3b3e0-642d-4b5a-9d1e-8f3a7c6b9e1a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,18,"Does a PowerShell script have an abnormal structure (Abstract Syntax Tree) that causes a high reconstruction error in an autoencoder model, suggesting an embedded payload?","This question uses advanced machine learning to detect structural anomalies in PowerShell scripts. An autoencoder trained on the ASTs of normal scripts learns what ""normal"" script structure looks like. A script with an embedded payload will have a very abnormal AST (e.g., a single, massive string literal node), which the model will fail to reconstruct accurately. A high reconstruction error is therefore a strong indicator of a structurally anomalous, and likely malicious, script.",Windows Event ID 4104; All Windows Endpoints and Servers,last 90 days,": # Train model on benign script ASTs
ast_autoencoder = TRAIN_AUTOENCODER(benign_script_asts)
# Monitor new scripts
FOR each new Event ID 4104:
  script_ast = GENERATE_AST(script_block)
  reconstruction_error = ast_autoencoder.get_reconstruction_error(script_ast)
  IF reconstruction_error > error_threshold:
    ALERT ""High AST reconstruction error suggests structurally abnormal PowerShell script""",playbooks/attack/enterprise/T1059.001.yml
T1059.003: Windows Command Shell,1e8a9b0f-7c1d-4e8a-9b0f-7c1d4e8a9b0f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,1,Are there any cmd.exe process command lines containing known indicators of compromise (IOCs)?,"This question aims to find direct evidence of known malicious activity. Adversaries may use cmd.exe to run commands that reference malicious IP addresses, domains, or files. By extracting these artifacts from command lines and comparing them against high-confidence threat intelligence, analysts can quickly identify and confirm a compromise with a low false-positive rate.
",Windows Event ID 4688; Zeek conn.log; Zeek dns.log; All Windows Endpoints and Servers; DNS and Web Proxy logs; Threat Intelligence Platform feeds,last 90 days,": SEARCH process_creation_events WHERE process_name = 'cmd.exe'
| EXTRACT artifacts (IPs, domains, hashes) from command_line
| LOOKUP artifacts in threat_intelligence_feed
| RETURN events with matching artifacts
",playbooks/attack/enterprise/T1059.003.yml
T1059.003: Windows Command Shell,1e8a9b0f-7c1d-4e8a-9b0f-7c1d4e8a9b0f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,2,Have any rare domains been observed in cmd.exe command lines?,"This question helps uncover unknown or novel threats by focusing on statistical rarity. Legitimate software and administrative activities typically involve a set of common, high-prevalence domains. A domain that appears very infrequently across the enterprise, especially when executed from a command line, is suspicious and could be part of a new C2 infrastructure. Corroborating this with DNS logs helps confirm if the domain is truly rare network-wide.
",Windows Event ID 4688; Zeek dns.log; All Windows Endpoints and Servers; DNS and Web Proxy logs,last 90 days,": SEARCH process_creation_events WHERE process_name = 'cmd.exe'
| EXTRACT domains from command_line
| CALCULATE prevalence of each domain across the enterprise over 30 days
| RETURN commands with domains below a low percentile threshold
",playbooks/attack/enterprise/T1059.003.yml
T1059.003: Windows Command Shell,1e8a9b0f-7c1d-4e8a-9b0f-7c1d4e8a9b0f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,3,Have any cmd.exe command lines been classified as malicious by a string classification model?,"This question leverages machine learning to detect malicious commands that may not contain known IOCs or use obvious obfuscation. A model trained on the characteristics of thousands of malicious and benign commands can identify subtle patterns and combinations of strings that indicate malicious intent, providing a proactive and scalable detection method.
",Windows Event ID 4688; All Windows Endpoints and Servers,last 90 days,": STREAM process_creation_events WHERE process_name = 'cmd.exe'
| APPLY string_classification_model to command_line
| RETURN commands classified as malicious with high probability
",playbooks/attack/enterprise/T1059.003.yml
T1059.003: Windows Command Shell,1e8a9b0f-7c1d-4e8a-9b0f-7c1d4e8a9b0f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,4,Are there any cmd.exe command lines that exhibit known obfuscation patterns?,"Adversaries frequently obfuscate commands to evade simple keyword-based detections. This question focuses on identifying the tell-tale signs of obfuscation, such as excessive use of carets (`^`), string construction with environment variables, or redirection to `nul`. Detecting these patterns is a strong indication that an actor is attempting to hide their actions.
",Windows Event ID 4688; All Windows Endpoints and Servers,last 90 days,": SEARCH process_creation_events WHERE process_name = 'cmd.exe'
| APPLY a library of regex for known obfuscation patterns to the command_line
| RETURN events where the command_line matches a pattern
",playbooks/attack/enterprise/T1059.003.yml
T1059.003: Windows Command Shell,1e8a9b0f-7c1d-4e8a-9b0f-7c1d4e8a9b0f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,5,Are there any cmd.exe command lines with unusually high character entropy?,"This question provides a way to detect obfuscated or encrypted commands without relying on specific patterns. Obfuscated commands often have a higher degree of character randomness (entropy) than legitimate commands. By establishing a baseline for normal entropy in an environment, commands that are statistical outliers can be flagged for review, helping to uncover novel obfuscation techniques.
",Windows Event ID 4688; All Windows Endpoints and Servers,last 90 days,": SEARCH process_creation_events WHERE process_name = 'cmd.exe'
| CALCULATE character_entropy for each command_line
| ESTABLISH baseline entropy from historical data
| RETURN commands with entropy scores exceeding a high percentile threshold (e.g., 95th)
",playbooks/attack/enterprise/T1059.003.yml
T1059.003: Windows Command Shell,1e8a9b0f-7c1d-4e8a-9b0f-7c1d4e8a9b0f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,6,Are there any cmd.exe command lines that fall into anomalous clusters based on their structural features?,"This question uses unsupervised machine learning to find suspicious commands that ""don't look like the others."" By grouping all command lines based on features like length, character counts, and n-grams, most commands will form large, dense clusters representing normal activity. Small, isolated clusters are anomalous and likely represent malicious or at least non-standard activity worth investigating.
",Windows Event ID 4688; All Windows Endpoints and Servers,last 90 days,": SEARCH process_creation_events WHERE process_name = 'cmd.exe'
| CREATE feature_vectors for all command_lines (length, char_counts, entropy, etc.)
| CLUSTER the vectors using an algorithm like DBSCAN
| RETURN commands belonging to small, sparse, or outlier clusters
",playbooks/attack/enterprise/T1059.003.yml
T1059.003: Windows Command Shell,1e8a9b0f-7c1d-4e8a-9b0f-7c1d4e8a9b0f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,7,Has a single parent process rapidly spawned multiple cmd.exe instances to run common reconnaissance commands?,"This question targets a common adversary behavior: running a quick series of discovery commands (`whoami`, `ipconfig`, `net user`, etc.) to orient themselves on a newly compromised host. Detecting a burst of these commands from a single parent process within a short time window is a strong indicator of active, hands-on-keyboard reconnaissance.
",Windows Event ID 4688; All Windows Endpoints and Servers,last 90 days,": SEARCH process_creation_events where child_process = 'cmd.exe' and command_line contains discovery_command
| GROUP by ParentProcessID over a 5-minute window
| COUNT distinct discovery commands per group
| RETURN groups where the count is >= 3
",playbooks/attack/enterprise/T1059.003.yml
T1059.003: Windows Command Shell,1e8a9b0f-7c1d-4e8a-9b0f-7c1d4e8a9b0f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,8,Has any user executed a statistically rare sequence of commands?,"This question aims to detect deviations from established user behavior. While a single command might be benign, a sequence of commands may be highly anomalous for a specific user or their peer group. By baselining normal command sequences, this method can flag an accountant running commands typically only seen from a developer, or any user running a sequence for the very first time.
",Windows Event ID 4688; All Windows Endpoints and Servers,last 90 days,": FOR each user:
| BASELINE frequency of 3-command sequences from historical process_creation_events
| MONITOR new command sequences
| RETURN any sequence that is statistically rare or has never been seen for that user/peer group
",playbooks/attack/enterprise/T1059.003.yml
T1059.003: Windows Command Shell,1e8a9b0f-7c1d-4e8a-9b0f-7c1d4e8a9b0f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,9,Have any observed sequences of user commands been flagged as anomalous by a sequence prediction model?,"This is an advanced technique for detecting anomalous user behavior. By modeling command execution as a sequence (using a Markov chain or LSTM), we can learn the normal transition probabilities between commands for a user. A sequence that has a very low probability of occurring according to the model is highly suspicious and could indicate an account takeover or malicious insider.
",Windows Event ID 4688; All Windows Endpoints and Servers,last 90 days,": FOR each user:
| TRAIN a sequence model (e.g., Markov chain) on their historical command activity
| FOR each new command, calculate the probability of the current sequence
| RETURN any sequence with a probability below a learned threshold
",playbooks/attack/enterprise/T1059.003.yml
T1059.003: Windows Command Shell,1e8a9b0f-7c1d-4e8a-9b0f-7c1d4e8a9b0f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,10,"Has cmd.exe been launched by a process not typically associated with command-line activity, such as an Office application or web browser?","This question targets a very common initial access and execution pattern. It is highly irregular for applications like Microsoft Word, Excel, Outlook, or web browsers to spawn a command shell. An alert on this activity is a high-fidelity indicator that a user likely opened a malicious document or visited a compromised website.
",Windows Event ID 4688; All Windows workstations,last 90 days,": SEARCH process_creation_events WHERE child_process_name = 'cmd.exe'
| FILTER where parent_process_name is in [WINWORD.EXE, EXCEL.EXE, POWERPNT.EXE, OUTLOOK.EXE, chrome.exe, firefox.exe, AcroRd32.exe]
| RETURN all matching events
",playbooks/attack/enterprise/T1059.003.yml
T1059.003: Windows Command Shell,1e8a9b0f-7c1d-4e8a-9b0f-7c1d4e8a9b0f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,11,Has cmd.exe been launched by a parent process that has rarely or never launched it before across the enterprise?,"This question moves beyond a static watchlist of parent processes to a dynamic, learned approach. By baselining all parent-child relationships across the environment, we can detect when a process launches cmd.exe for the first time, or very rarely. This can uncover novel attack vectors that don't use the common Office-based lures.
",Windows Event ID 4688; All Windows workstations,last 90 days,": CALCULATE frequency of all parent-child process pairs over the last 90 days
| SEARCH for new process_creation_events where child_process_name = 'cmd.exe'
| RETURN events where the parent-child pair frequency is below a low threshold (e.g., 1st percentile) or is new
",playbooks/attack/enterprise/T1059.003.yml
T1059.003: Windows Command Shell,1e8a9b0f-7c1d-4e8a-9b0f-7c1d4e8a9b0f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,12,Have any cmd.exe process creation events been classified as suspicious by a parent-child relationship model?,"This question applies machine learning for a more nuanced detection of suspicious cmd.exe launches. A model can consider a wide range of features—not just the parent name, but its file path, the user context, logon type, etc.—to generate a risk score. This allows for the detection of suspicious events that might not be caught by simple frequency analysis alone.
",Windows Event ID 4688; All Windows workstations,last 90 days,": STREAM process_creation_events where child_process_name = 'cmd.exe'
| EXTRACT features (parent_name, parent_path, user_context, etc.)
| APPLY classification_model to the feature set
| RETURN events that are classified as 'suspicious' with high confidence
",playbooks/attack/enterprise/T1059.003.yml
T1059.003: Windows Command Shell,1e8a9b0f-7c1d-4e8a-9b0f-7c1d4e8a9b0f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,13,Has a cmd.exe process been observed making a direct outbound network connection to an external IP address?,"The command shell itself (cmd.exe) should not be making outbound network connections. This behavior is a strong indicator of a C2 channel or data exfiltration. This question seeks to find direct proof of this activity by correlating process creation events for cmd.exe with network connection events originating from the same process ID.
",Windows Event ID 4688; Windows Event ID 5156; Zeek conn.log; Network egress points; Endpoints and servers,last 90 days,": JOIN (process_creation events where process_name='cmd.exe') with (network_connection events) on ProcessID
| FILTER where destination_ip is external and not whitelisted
| RETURN correlated events
",playbooks/attack/enterprise/T1059.003.yml
T1059.003: Windows Command Shell,1e8a9b0f-7c1d-4e8a-9b0f-7c1d4e8a9b0f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,14,Has a cmd.exe process made a network connection to a geographically or organizationally rare destination?,"This question adds context to network connections from cmd.exe. Even if some outbound traffic is expected, a connection to a country or Autonomous System (ASN) that the host has never contacted before is highly suspicious. This helps prioritize alerts and can point to a new or different C2 infrastructure than previously observed.
",Zeek conn.log; Windows Event ID 4688; Network egress points,last 90 days,": SEARCH network_connections where process_name = 'cmd.exe'
| ENRICH with GeoIP and ASN data for destination_ip
| BASELINE destination countries/ASNs per host
| RETURN connections to a country/ASN that is rare or new for that host
",playbooks/attack/enterprise/T1059.003.yml
T1059.003: Windows Command Shell,1e8a9b0f-7c1d-4e8a-9b0f-7c1d4e8a9b0f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,15,Has there been an anomalous spike in the volume of outbound data from a cmd.exe process?,"This question focuses on detecting data exfiltration. While a C2 connection from cmd.exe might involve small amounts of data, a large, sudden spike in outbound data volume is a significant anomaly. Applying time-series analysis to the byte count of these connections can effectively detect when a large amount of data is being transferred out of the network via a command shell.
",Zeek conn.log; Windows Event ID 4688; Network egress points,last 90 days,": AGGREGATE outbound_bytes from 'cmd.exe' network connections over 5-minute intervals
| APPLY time-series anomaly detection model (e.g., SARIMA)
| RETURN intervals with significant positive anomalies (spikes)
",playbooks/attack/enterprise/T1059.003.yml
T1059.003: Windows Command Shell,1e8a9b0f-7c1d-4e8a-9b0f-7c1d4e8a9b0f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,16,Has a batch file been written to a temporary or world-writable directory and then executed shortly after?,"This question targets the common adversary tactic of ""living off the land"" by dropping and executing scripts. Adversaries often write batch files (.bat, .cmd) to non-standard, world-writable locations like %TEMP% or C:\Users\Public and then immediately execute them. Correlating a file write event with a subsequent process execution of that same file is a high-fidelity indicator of this technique.
","Windows Event ID 4688; Windows Event ID 4663; User profile directories, temporary file locations, and public folders",last 90 days,": MONITOR for file_write events (4663) where object_name ends in .bat/.cmd and is in a high-risk directory
| IF a write is found, look for a process_creation event (4688) for the same file path within 2 minutes
| RETURN any correlated write-then-execute pairs
",playbooks/attack/enterprise/T1059.003.yml
T1059.003: Windows Command Shell,1e8a9b0f-7c1d-4e8a-9b0f-7c1d4e8a9b0f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,17,Have any newly created and executed batch files had filenames with unusually high entropy?,"This question helps detect malware that programmatically generates random filenames for its scripts to evade signature-based detection. A filename like 'uwhf73gd.bat' has a much higher character randomness (entropy) than a human-created one like 'install.bat'. High filename entropy for an executed script is a strong signal of automation and malicious intent.
",Windows Event ID 4688; Windows Event ID 4663; User profile directories and temporary file locations,last 90 days,": MONITOR for file_creation events (4663) for .bat/.cmd files
| CALCULATE Shannon entropy of the filename
| IF entropy is above a baseline threshold AND the file is executed (4688), RETURN the event
",playbooks/attack/enterprise/T1059.003.yml
T1059.003: Windows Command Shell,1e8a9b0f-7c1d-4e8a-9b0f-7c1d4e8a9b0f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,18,Has a batch file been created and executed in a file path that is classified as suspicious?,"This question uses machine learning to assess the ""suspiciousness"" of a script's location. Rather than relying on a simple list of ""bad"" directories, a model can learn from features of the entire file path (e.g., path depth, presence of temp-like tokens, directory permissions) to score how likely it is that a script in that location is malicious. This provides a more robust and adaptable method for detecting dropped scripts.
",Windows Event ID 4688; Windows Event ID 4663; User profile directories and temporary file locations,last 90 days,": MONITOR for executed (.bat/.cmd) files (4688)
| EXTRACT features from the file's full path
| APPLY a pre-trained path classification model
| RETURN events where the file path is classified as 'suspicious' with high confidence",playbooks/attack/enterprise/T1059.003.yml
T1059.004: Unix Shell,d8a2b1c0-4e5f-4a9b-8c7d-6f5e4d3c2b1a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,1,Has a successful interactive SSH login been followed by network connections to known command and control (C2) infrastructure within five minutes?,This question aims to detect a common attack pattern where an adversary gains interactive access via SSH and immediately establishes a connection to their C2 server for further commands or data exfiltration. Correlating the login with outbound traffic to known malicious destinations provides a high-fidelity signal of compromise.,Zeek conn.log; Zeek ssh.log; Zeek http.log; Zeek dns.log; DMZ Web Servers; Internal Linux Application Servers; SSH Jump Boxes; VPN Concentrators; Crown Jewel Asset Subnets; Network Egress Points,last 90 days,": FOR each successful SSH login event in ssh.log
  GET source_host and timestamp
  SEARCH conn.log, dns.log, http.log for outbound traffic from source_host
  WHERE event_timestamp is within 5 minutes of SSH login timestamp
  AND (destination_ip OR dns_query OR http_host) in threat_intel_feed
  RETURN alert
",playbooks/attack/enterprise/T1059.004.yml
T1059.004: Unix Shell,d8a2b1c0-4e5f-4a9b-8c7d-6f5e4d3c2b1a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,2,"Following a successful SSH login, is the host exhibiting anomalous outbound network behavior, such as connecting to an unusual number of ports or destination IPs?",Adversaries often perform network reconnaissance or connect to multiple C2 channels after gaining access. This question seeks to identify such activity by comparing post-login network patterns to a historical baseline. A sudden increase in the variety of destination ports or the entropy of destination IPs can indicate scanning or other non-standard behavior that deviates from normal operations.,Zeek conn.log; Zeek ssh.log; Zeek http.log; Zeek dns.log; DMZ Web Servers; Internal Linux Application Servers; SSH Jump Boxes; VPN Concentrators; Crown Jewel Asset Subnets; Network Egress Points,last 90 days,": FOR each host
  CALCULATE 30-day baseline of (distinct destination ports per hour) and (entropy of destination IPs)
FOR each successful SSH login
  MONITOR outbound connections for 1 hour
  CALCULATE post-login metrics
  IF post-login_ports > 95th_percentile_baseline OR post-login_ip_entropy > 3_std_dev_from_baseline
  RETURN alert
",playbooks/attack/enterprise/T1059.004.yml
T1059.004: Unix Shell,d8a2b1c0-4e5f-4a9b-8c7d-6f5e4d3c2b1a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,3,Is a host exfiltrating an unusually large volume of data following a successful SSH login event?,"Data exfiltration is a key objective for many adversaries. This question uses a time-series model to predict a host's normal outbound data volume. An alert is triggered if the actual data volume significantly and persistently exceeds the prediction after an SSH login, suggesting that an attacker may be staging or exfiltrating sensitive information.",Zeek conn.log; Zeek ssh.log; Zeek http.log; Zeek dns.log; DMZ Web Servers; Internal Linux Application Servers; SSH Jump Boxes; VPN Concentrators; Crown Jewel Asset Subnets; Network Egress Points,last 90 days,": FOR each host, TRAIN time-series model on historical outbound data volume
FOR each successful SSH login
  MONITOR outbound data volume per minute
  IF observed_volume > 99%_prediction_interval for > 10 consecutive minutes
  RETURN alert
",playbooks/attack/enterprise/T1059.004.yml
T1059.004: Unix Shell,d8a2b1c0-4e5f-4a9b-8c7d-6f5e4d3c2b1a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,4,"Has a Unix shell process on a Windows host been executed with command-line arguments that attempt to download and run a remote script (e.g., 'curl | bash')?","This question looks for the 'living-off-the-land' technique where an attacker uses legitimate tools like WSL, curl, or wget to download and execute malicious payloads directly in memory. Searching for these specific command-line patterns in process creation logs can directly uncover this type of attack, often referred to as a 'dropper'.",Windows Event ID 4688; Sysmon Event ID 1; Developer Workstations; Administrator Workstations; Windows Servers with WSL enabled; Build and CI/CD Servers,last 90 days,": SEARCH process creation logs
WHERE (process_name == 'wsl.exe' OR process_name == 'bash.exe')
AND command_line MATCHES REGEX ('curl .* | bash', 'wget .* | sh', 'bash -c .*base64')
RETURN alert
",playbooks/attack/enterprise/T1059.004.yml
T1059.004: Unix Shell,d8a2b1c0-4e5f-4a9b-8c7d-6f5e4d3c2b1a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,5,"Are there any Unix shell commands on Windows hosts that are unusually long or have high character entropy, suggesting obfuscation?",Adversaries often obfuscate their commands using encoding (like Base64) or by embedding complex scripts directly on the command line to evade simple signature-based detection. This question aims to identify such commands by establishing a baseline for normal command length and entropy. Commands that are statistical outliers are highly suspicious and warrant investigation.,Windows Event ID 4688; Sysmon Event ID 1; Developer Workstations; Administrator Workstations; Windows Servers with WSL enabled; Build and CI/CD Servers,last 90 days,": CALCULATE baseline of command_line length and entropy for all shell processes
FOR each new shell process creation event
  CALCULATE current command_line length and entropy
  IF length > 98th_percentile_baseline OR entropy > 98th_percentile_baseline
  RETURN alert
",playbooks/attack/enterprise/T1059.004.yml
T1059.004: Unix Shell,d8a2b1c0-4e5f-4a9b-8c7d-6f5e4d3c2b1a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,6,Has a machine learning model classified a Unix shell command executed on a Windows host as potentially malicious?,"This question leverages a more advanced, behavioral approach to detection. By training a model on features extracted from known benign and malicious commands (e.g., length, argument count, presence of keywords), it can identify novel or complex malicious commands that might evade simpler rule-based methods. A high confidence score from the model indicates a strong likelihood of malicious intent.",Windows Event ID 4688; Sysmon Event ID 1; Developer Workstations; Administrator Workstations; Windows Servers with WSL enabled; Build and CI/CD Servers,last 90 days,": FOR each new shell process creation event
  EXTRACT features (length, arg_count, keywords, etc.) from command_line
  SCORE features with classification model
  IF score > 0.9
  RETURN alert
",playbooks/attack/enterprise/T1059.004.yml
T1059.004: Unix Shell,d8a2b1c0-4e5f-4a9b-8c7d-6f5e4d3c2b1a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,7,"Has a Unix shell process been spawned by an unusual parent process, such as a Microsoft Office application, web browser, or PDF reader?","Legitimate shell usage typically originates from a predictable set of parent processes (e.g., explorer.exe, cmd.exe). When an application like Word or Chrome spawns a shell, it is a strong indicator of compromise, often resulting from a user opening a malicious document or clicking a malicious link. This question uses an allowlist of normal behavior to detect these highly anomalous and suspicious process chains.",Windows Event ID 4688; Sysmon Event ID 1; User Workstations (Windows); Virtual Desktop Infrastructure (VDI); Microsoft Office and Web Servers; Terminal Servers,last 90 days,": DEFINE allowlist of parent-child pairs for shells
SEARCH process creation logs
WHERE child_process is a Unix shell
AND (parent_process, child_process) NOT IN allowlist
RETURN alert
",playbooks/attack/enterprise/T1059.004.yml
T1059.004: Unix Shell,d8a2b1c0-4e5f-4a9b-8c7d-6f5e4d3c2b1a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,8,Has a Unix shell process been created by a parent process that is statistically rare across the enterprise?,"Instead of a manually maintained allowlist, this question uses a data-driven approach to find anomalies. It identifies all parent-child process relationships in the environment and flags those that are exceptionally infrequent. This can uncover novel attack vectors or misconfigurations that lead to unexpected process executions, without the overhead of maintaining a static list.",Windows Event ID 4688; Sysmon Event ID 1; User Workstations (Windows); Virtual Desktop Infrastructure (VDI); Microsoft Office and Web Servers; Terminal Servers,last 90 days,": CALCULATE 30-day frequency distribution of all parent-child process pairs
FOR each new shell process creation event
  GET parent_process
  IF frequency of (parent_process, shell_process) is in bottom 1%
  RETURN alert
",playbooks/attack/enterprise/T1059.004.yml
T1059.004: Unix Shell,d8a2b1c0-4e5f-4a9b-8c7d-6f5e4d3c2b1a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,9,Does an unsupervised machine learning model identify the creation of a Unix shell process as part of an anomalous process cluster?,"This question uses clustering algorithms to group similar process execution events based on features like parent process, child process, and user context. Normal, high-volume activities will form large, dense clusters. Malicious or rare activities, such as a specific user's web browser spawning a shell, will form small, isolated clusters, making them easy to identify as anomalies worth investigating.",Windows Event ID 4688; Sysmon Event ID 1; User Workstations (Windows); Virtual Desktop Infrastructure (VDI); Microsoft Office and Web Servers; Terminal Servers,last 90 days,": APPLY clustering algorithm (e.g., DBSCAN) on process creation events
USING features like parent_process, child_process, user_id
INVESTIGATE small, isolated clusters containing shell processes
RETURN alert for members of anomalous clusters
",playbooks/attack/enterprise/T1059.004.yml
T1059.004: Unix Shell,d8a2b1c0-4e5f-4a9b-8c7d-6f5e4d3c2b1a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,10,Has an interactive SSH login from a geographically anomalous location been followed by suspicious DNS lookups?,"This question aims to identify access from unexpected or high-risk locations, which is a common indicator of an external threat. By enriching login data with GeoIP information and correlating it with subsequent activity like queries to dynamic DNS domains (often used by attackers), security teams can quickly flag potentially unauthorized access.","Zeek ssh.log; Zeek conn.log; Zeek dns.log; Critical Linux/Unix Servers (e.g., database, application); Network Egress Points; Authentication Servers; Internal Network Segments",last 90 days,": FOR each successful SSH login
  ENRICH source_ip with GeoIP data
  IF source_country is not in business_presence_list
    AND subsequent DNS query is for a dynamic DNS domain
    RETURN alert
",playbooks/attack/enterprise/T1059.004.yml
T1059.004: Unix Shell,d8a2b1c0-4e5f-4a9b-8c7d-6f5e4d3c2b1a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,11,"Following an SSH login that is anomalous for a specific user (based on time or network location), is there evidence of network scanning from the compromised host?","Attackers often perform internal reconnaissance after gaining a foothold. This question identifies this behavior by first flagging user logins that deviate from their established patterns (e.g., logging in at 3 AM from a new network). It then correlates this anomalous login with signs of port scanning, such as a high rate of failed connection attempts (Zeek 'S0' state), to detect post-compromise discovery activity.","Zeek ssh.log; Zeek conn.log; Zeek dns.log; Critical Linux/Unix Servers (e.g., database, application); Network Egress Points; Authentication Servers; Internal Network Segments",last 90 days,": FOR each user, BASELINE login hours and source ASNs
FOR each successful SSH login
  IF login_hour or source_ASN is anomalous for that user
    MONITOR subsequent connections
    IF ratio of 'S0' connections to total connections spikes
    RETURN alert
",playbooks/attack/enterprise/T1059.004.yml
T1059.004: Unix Shell,d8a2b1c0-4e5f-4a9b-8c7d-6f5e4d3c2b1a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,12,"Is there evidence of periodic, machine-like network beaconing to a single destination following an anomalous SSH login?","Command and control malware often communicates with its server at regular intervals (beaconing). This periodic traffic can be identified using signal processing techniques like FFT. This question seeks to detect this pattern by analyzing the timestamps of connections to a specific destination. A strong, regular signal following a suspicious login is a classic indicator of C2 communication.","Zeek ssh.log; Zeek conn.log; Zeek dns.log; Critical Linux/Unix Servers (e.g., database, application); Network Egress Points; Authentication Servers; Internal Network Segments",last 90 days,": FOR each anomalous SSH login
  FOR each source-destination IP pair in subsequent traffic
    APPLY FFT to the time series of connection timestamps
    IF a strong periodic signal is detected
    RETURN alert
",playbooks/attack/enterprise/T1059.004.yml
T1059.004: Unix Shell,d8a2b1c0-4e5f-4a9b-8c7d-6f5e4d3c2b1a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,13,Has a file downloaded via 'curl' or 'wget' been followed by a new connection to a known malicious destination?,"This question targets the 'curl-pipe-shell' attack pattern where a script is downloaded and executed. The initial download is often a stager that, once run, initiates a connection to a C2 server. By detecting the initial download and correlating it with a subsequent connection to a known-bad IP or domain, we can identify this multi-stage attack.",Zeek http.log; Zeek conn.log; Zeek files.log; Zeek dns.log; Network Egress Points; Internal network segments containing Linux/Unix systems; Developer and DevOps Subnets; Cloud VPC Flow Logs,last 90 days,": SEARCH http.log for user_agent 'curl' or 'wget'
IF file is downloaded (from files.log)
  MONITOR client IP for 60 seconds
  IF new connection to destination in threat_intel_feed
  RETURN alert
",playbooks/attack/enterprise/T1059.004.yml
T1059.004: Unix Shell,d8a2b1c0-4e5f-4a9b-8c7d-6f5e4d3c2b1a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,14,"Has a host made a new outbound connection almost immediately after downloading a file via HTTP, especially to a raw IP address?","Automated scripts, like those used by attackers, execute tasks much faster than humans. This question leverages that fact by looking for an extremely short time delay between a file download and a subsequent network connection. This near-instantaneous action is a strong indicator of an automated script executing. Connections to raw IP addresses are also suspicious as they bypass DNS and are common in malware.",Zeek http.log; Zeek conn.log; Zeek files.log; Zeek dns.log; Network Egress Points; Internal network segments containing Linux/Unix systems; Developer and DevOps Subnets; Cloud VPC Flow Logs,last 90 days,": BASELINE time delta between (HTTP download) and (new outbound connection) per host
FOR each HTTP download
  CALCULATE time to next new outbound connection
  IF time_delta is in lowest 1st percentile OR http_host is a raw IP
  RETURN alert
",playbooks/attack/enterprise/T1059.004.yml
T1059.004: Unix Shell,d8a2b1c0-4e5f-4a9b-8c7d-6f5e4d3c2b1a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,15,Has a sequence analysis model detected the specific chain of events corresponding to a 'curl-pipe-shell' attack?,"This question aims to increase detection fidelity by looking for a specific sequence of events in order: a DNS query for a new domain, an HTTP GET request with a 'curl' agent, a small file download, and finally a new connection to a different IP. Using a sequence model like an HMM can piece together these disparate logs into a single, high-confidence alert for a complete attack chain.",Zeek http.log; Zeek conn.log; Zeek files.log; Zeek dns.log; Network Egress Points; Internal network segments containing Linux/Unix systems; Developer and DevOps Subnets; Cloud VPC Flow Logs,last 90 days,": USE sequence model (e.g., HMM) to find the pattern:
[1] DNS query for new/uncategorized domain
[2] HTTP GET from curl to that domain
[3] Small file download (<50KB)
[4] New outbound connection to different IP within 30s
IF sequence is detected
RETURN alert
",playbooks/attack/enterprise/T1059.004.yml
T1059.004: Unix Shell,d8a2b1c0-4e5f-4a9b-8c7d-6f5e4d3c2b1a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,16,Has a new script or executable been created or modified in a known Linux persistence location by a process other than a standard package manager?,"Adversaries establish persistence by placing scripts or binaries in locations that ensure their code is executed automatically (e.g., on boot or a schedule). This question monitors these sensitive directories for any changes not made by legitimate software installation or update processes (like 'yum' or 'apt'). Such unauthorized modifications are a strong sign of a persistence attempt.","auditd logs; Sysmon for Linux Event ID 11; Sysmon for Linux Event ID 1; System-level persistence locations on critical Linux servers (/etc/cron.d, /etc/init.d, /etc/rc.local, /etc/systemd/system, /etc/profile.d); User-specific persistence locations (~/.bashrc, ~/.profile, /var/spool/cron/)",last 90 days,": SEARCH file/process creation logs in persistence directories
(e.g., /etc/cron.d/, /etc/systemd/system/)
IF creating_process is NOT ('yum', 'apt', 'dpkg', etc.)
AND change is not authorized
RETURN alert
",playbooks/attack/enterprise/T1059.004.yml
T1059.004: Unix Shell,d8a2b1c0-4e5f-4a9b-8c7d-6f5e4d3c2b1a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,17,Does a new script created in a persistence location have unusually high entropy or other signs of obfuscation?,"To evade detection, attackers often pack, encrypt, or obfuscate their persistence scripts. These techniques increase the file's Shannon entropy, making it appear more random than a typical text-based script. This question analyzes new scripts for high entropy or other indicators like very long strings to identify these obfuscation attempts.","auditd logs; Sysmon for Linux Event ID 11; Sysmon for Linux Event ID 1; System-level persistence locations on critical Linux servers (/etc/cron.d, /etc/init.d, /etc/rc.local, /etc/systemd/system, /etc/profile.d); User-specific persistence locations (~/.bashrc, ~/.profile, /var/spool/cron/)",last 90 days,": FOR each new script in persistence location
  CALCULATE file content entropy
  COMPARE to baseline entropy for benign scripts
  IF entropy > 3 standard deviations from mean
  RETURN alert
",playbooks/attack/enterprise/T1059.004.yml
T1059.004: Unix Shell,d8a2b1c0-4e5f-4a9b-8c7d-6f5e4d3c2b1a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,18,Has a machine learning model classified a new script in a persistence location as malicious based on its text content?,"This question uses Natural Language Processing (NLP) to understand the *intent* of a script. By training a model on a large set of good and bad scripts, it can learn to recognize patterns and keywords associated with malicious activity (e.g., reverse shells, disabling security tools, data exfiltration). This provides a powerful way to detect malicious logic even in novel scripts.","auditd logs; Sysmon for Linux Event ID 11; Sysmon for Linux Event ID 1; System-level persistence locations on critical Linux servers (/etc/cron.d, /etc/init.d, /etc/rc.local, /etc/systemd/system, /etc/profile.d); User-specific persistence locations (~/.bashrc, ~/.profile, /var/spool/cron/)",last 90 days,": FOR each new script in persistence location
  ANALYZE script content with NLP model
  (trained on keywords like 'nc', 'base64 -d', 'unset HISTFILE')
  IF model classifies script as malicious
  RETURN alert",playbooks/attack/enterprise/T1059.004.yml
T1059: Command and Scripting Interpreter,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,1,"Are script interpreters executing commands that contain known malicious indicators like IP addresses, domains, or file hashes from threat intelligence feeds?",This question seeks to identify direct evidence of compromise by matching command-line artifacts against a curated list of known bad indicators. A match provides a high-confidence signal that an adversary is using known malicious infrastructure or tools within the environment.,Sysmon Event ID 1; Windows Event ID 4688; Windows Event ID 4104; Zeek conn.log; Zeek dns.log; User Workstations; Application Servers; Domain Controllers; Network Egress Points,last 90 days,": SEARCH process_creation_events AND powershell_script_logs | EXTRACT IPs, domains, hashes from command_line | LOOKUP against threat_intelligence_feeds | WHERE match_found",playbooks/attack/enterprise/T1059.yml
T1059: Command and Scripting Interpreter,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,2,Are script interpreters executing commands containing statistically rare domains or IP addresses within the enterprise?,"This question helps uncover new or targeted malicious infrastructure not yet present in threat intelligence feeds. Adversaries often use unique domains for each campaign. By identifying domains and IPs that are rarely seen across the organization, we can flag potential C2 channels that would otherwise be missed. This is a form of anomaly detection based on prevalence.",Sysmon Event ID 1; Windows Event ID 4688; Windows Event ID 4104; Zeek conn.log; Zeek dns.log; User Workstations; Application Servers; Domain Controllers; Network Egress Points,last 90 days,": SEARCH command_line_logs | EXTRACT domain, IP | CALCULATE frequency of each domain/IP over 30 days | ALERT if frequency < 5th_percentile",playbooks/attack/enterprise/T1059.yml
T1059: Command and Scripting Interpreter,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,3,"Can we use a machine learning model to classify command-line executions as malicious based on features like length, entropy, and keyword presence?","This question proposes a more advanced, programmatic approach to detection. By training a model on features of known benign and malicious commands (e.g., character distribution, length, presence of suspicious terms like 'IEX' or '-enc'), we can create a system that scores and flags new commands in real-time, adapting to novel adversary techniques that may not match simple signatures.",Sysmon Event ID 1; Windows Event ID 4688; Windows Event ID 4104; Zeek conn.log; Zeek dns.log; User Workstations; Application Servers; Domain Controllers; Network Egress Points,last 90 days,": PIPELINE new_command_line -> FEATURE_ENGINEERING(length, entropy, keywords) -> CLASSIFIER_MODEL -> RETURN probability_score | ALERT if score > threshold",playbooks/attack/enterprise/T1059.yml
T1059: Command and Scripting Interpreter,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,4,"Are there any command-line arguments containing patterns known to be malicious, such as PowerShell download cradles or Base64 encoding flags?","This question focuses on detecting specific malicious tradecraft using pattern matching. Adversaries frequently use recognizable templates for downloading and executing payloads (e.g., IEX(New-Object Net.WebClient).DownloadString) or for obfuscating commands (e.g., -encodedCommand). Using regular expressions to scan for these patterns is a highly effective way to find 'living-off-the-land' attacks.",Sysmon Event ID 1; Windows Event ID 4688; Windows Event ID 4104; User Workstations; Web Servers; Mail Servers; Domain Controllers,last 90 days,: SEARCH command_line_logs | APPLY regex_library_for_malicious_patterns | ALERT on match,playbooks/attack/enterprise/T1059.yml
T1059: Command and Scripting Interpreter,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,5,Are there command-line executions with unusually high character entropy or length compared to their historical baseline?,"This question aims to detect obfuscated commands. Adversaries often encode or encrypt payloads within a command line to evade simple keyword-based detection. This process significantly increases the character randomness (entropy) and length of the command string. By baselining normal activity for a given process on a host and flagging significant deviations, we can identify these obfuscated payloads.",Sysmon Event ID 1; Windows Event ID 4688; Windows Event ID 4104; User Workstations; Web Servers; Mail Servers; Domain Controllers,last 90 days,": FOREACH command_line_event | CALCULATE entropy, length | COMPARE to historical_baseline for host/process | ALERT if entropy OR length > 98th_percentile",playbooks/attack/enterprise/T1059.yml
T1059: Command and Scripting Interpreter,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,6,Are there command lines with anomalous character sequences that deviate from models of normal command syntax?,"This question leverages n-gram analysis, a machine learning technique, to detect unknown or novel obfuscation methods. By building a model of what 'normal' command-line character sequences look like, we can measure how surprising or 'perplexing' a new command is. Highly perplexing commands likely contain syntax or character patterns never seen in benign operations, indicating potential malice.",Sysmon Event ID 1; Windows Event ID 4688; Windows Event ID 4104; User Workstations; Web Servers; Mail Servers; Domain Controllers,last 90 days,: FOREACH new_command_line | CALCULATE perplexity_score using n-gram_model | ALERT if score > anomaly_threshold,playbooks/attack/enterprise/T1059.yml
T1059: Command and Scripting Interpreter,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,7,"Has a command interpreter (like cmd.exe or powershell.exe) been launched by a process that typically should not, such as an Office application or web browser?","This question aims to detect a common attack vector where malware delivered via a phishing document or a browser exploit spawns a command shell to execute subsequent commands. Legitimate parent-child relationships are usually predictable (e.g., explorer.exe -> cmd.exe). A process like WINWORD.EXE spawning powershell.exe is highly suspicious and is a strong indicator of initial compromise.",Sysmon Event ID 1; Windows Event ID 4688; User Workstations; Remote Desktop Servers; Mail Servers,last 90 days,": SEARCH process_creation_events | IF parent_process IN [winword.exe, excel.exe, chrome.exe] AND child_process IN [cmd.exe, powershell.exe] | ALERT",playbooks/attack/enterprise/T1059.yml
T1059: Command and Scripting Interpreter,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,8,Have we observed any new or statistically rare parent-child process relationships involving a script interpreter?,"This question provides a dynamic way to detect suspicious process chains beyond a static blacklist. By tracking every parent-child process pair observed in the environment, we can flag the first-ever occurrence of a new relationship (e.g., a custom application spawning cmd.exe for the first time). This helps detect novel attacker techniques and compromised legitimate software.",Sysmon Event ID 1; Windows Event ID 4688; User Workstations; Remote Desktop Servers; Mail Servers,last 90 days,": SEARCH process_creation_events | CREATE tuple (parent, child) | IF tuple is first_seen_globally OR frequency < 1st_percentile | ALERT",playbooks/attack/enterprise/T1059.yml
T1059: Command and Scripting Interpreter,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,9,Can graph-based analysis identify anomalous process execution chains that deviate from the normal activity baseline?,"This question proposes modeling the entirety of process activity as a large-scale graph to find complex, multi-step attacks. Instead of looking at single parent-child pairs, this method analyzes entire execution chains. An anomalous subgraph, such as one starting from an Office app, going through a script interpreter, and then making a network connection, would stand out against the baseline of normal process flow graphs.",Sysmon Event ID 1; Windows Event ID 4688; User Workstations; Remote Desktop Servers; Mail Servers,last 90 days,: MODEL process_events as a graph | IDENTIFY subgraphs that deviate from baseline_graph_structure | ALERT on anomalous subgraphs,playbooks/attack/enterprise/T1059.yml
T1059: Command and Scripting Interpreter,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,10,Has a script file been written to a world-writable directory (like %TEMP%) and then immediately executed by an interpreter?,"This question targets a classic malware staging technique known as 'write-then-execute.' Adversaries often drop a script (e.g., a .ps1 or .bat file) into a temporary or public directory and then immediately invoke an interpreter to run it. Correlating a file creation event with a subsequent process execution event for the same file path within a very short time window is a high-fidelity indicator of this behavior.",Sysmon Event ID 11; Sysmon Event ID 1; User Workstations; File Servers; Web Application Servers,last 90 days,: CORRELATE file_creation_events (Sysmon 11) with process_creation_events (Sysmon 1) | WHERE file_path matches AND time_delta < 10s AND directory is world-writable | ALERT,playbooks/attack/enterprise/T1059.yml
T1059: Command and Scripting Interpreter,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,11,Are scripts being executed from directory paths that are statistically rare across the enterprise?,"This question helps to identify scripts running from unusual or suspicious locations that may not be on a static list of temporary directories. By analyzing the execution paths of all scripts (e.g., .ps1, .bat) and calculating the frequency of each parent directory, we can flag executions from directories that are rarely, if ever, used for legitimate scripting activity, indicating a potential adversary staging location.",Sysmon Event ID 11; Sysmon Event ID 1; User Workstations; File Servers; Web Application Servers,last 90 days,: SEARCH script_execution_events | EXTRACT directory_path | CALCULATE frequency of each path | ALERT if frequency < 5th_percentile,playbooks/attack/enterprise/T1059.yml
T1059: Command and Scripting Interpreter,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,12,Has there been an anomalous spike in the rate of script file creation in critical system directories?,"This question aims to detect malware dropper activity or the replacement of legitimate system utilities with malicious scripts (a 'living-off-the-land' binary technique). By monitoring the rate of file creation for script files in sensitive directories like C:\Windows\System32 and applying time-series anomaly detection, we can identify sudden bursts of activity that are inconsistent with normal system patching or administrative tasks.",Sysmon Event ID 11; Sysmon Event ID 1; User Workstations; File Servers; Web Application Servers,last 90 days,: MONITOR rate of script_file_creation in critical_directories | APPLY time-series_anomaly_detection_model | ALERT on significant spikes,playbooks/attack/enterprise/T1059.yml
T1059: Command and Scripting Interpreter,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,13,Is a script interpreter process making a network connection to a destination IP or domain known to be malicious?,"This question seeks to directly identify command-and-control (C2) or data exfiltration activity by correlating network connections made by interpreters (like powershell.exe) with threat intelligence. When a process that can execute arbitrary code makes a connection to a known-bad destination, it is a very strong signal of malicious activity.",Sysmon Event ID 3; Zeek conn.log; Zeek dns.log; Zeek ssl.log; Network Egress Points; DNS Servers; User Workstations; DMZ Servers,last 90 days,: SEARCH network_connection_events (Sysmon 3) WHERE process is script_interpreter | EXTRACT destination_ip | LOOKUP against threat_intelligence_feeds | ALERT on match,playbooks/attack/enterprise/T1059.yml
T1059: Command and Scripting Interpreter,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,14,Are script interpreters making network connections using rare TLS fingerprints (JA3/JA3S) or uncommon destination ports?,"This question helps detect malicious C2 channels by looking for anomalies in the connection metadata. Adversaries may use custom cryptographic libraries or non-standard ports to evade detection. A JA3/JA3S hash represents the client's TLS configuration, and a rare hash indicates a non-standard client. Combining this with uncommon port usage for a given process (e.g., powershell.exe connecting over port 53) can uncover covert C2 channels.",Sysmon Event ID 3; Zeek conn.log; Zeek dns.log; Zeek ssl.log; Network Egress Points; DNS Servers; User Workstations; DMZ Servers,last 90 days,": SEARCH network_connections by script_interpreters | EXTRACT ja3_hash, destination_port | CALCULATE frequency of ja3/port per process | ALERT if frequency < 1st_percentile",playbooks/attack/enterprise/T1059.yml
T1059: Command and Scripting Interpreter,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,15,"Can we identify anomalous network connection behaviors, such as C2 beaconing or data exfiltration, by clustering connection metrics?","This question applies machine learning to network traffic metadata to find patterns of malicious behavior. C2 beaconing often appears as regular, small connections over a long period. Data exfiltration might be a single, large outbound transfer. By clustering connections based on features like data volume, duration, and frequency, we can automatically group them into 'normal' and 'abnormal' clusters, flagging the abnormal ones for investigation.",Sysmon Event ID 3; Zeek conn.log; Zeek dns.log; Zeek ssl.log; Network Egress Points; DNS Servers; User Workstations; DMZ Servers,last 90 days,": FOR each process-destination pair, gather connection_metrics (bytes, duration, frequency) | APPLY clustering_algorithm (DBSCAN) | ALERT on outlier clusters or noise points",playbooks/attack/enterprise/T1059.yml
T1069.002: Domain Groups,c1e2f3a4-b5c6-4d7e-8f9a-0b1c2d3e4f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0007: Discovery,n; o; n; e,1,"Is a known malicious domain enumeration tool being used, based on specific command-line arguments or PowerShell function names?","This question aims to find direct, high-fidelity evidence of malicious reconnaissance. Tools like AdFind, PowerView, and BloodHound have unique command signatures. Detecting these signatures is a strong indicator of an adversary actively mapping out the domain's group structure.","Windows Event ID 4688; Windows Event ID 4104; Domain Controllers, Member Servers, Privileged User Workstations",last 90 days,"Search process command lines (4688) and PowerShell script blocks (4104) for known malicious tool signatures (e.g., 'AdFind.exe -f', 'Get-NetGroup', 'SharpHound.exe').",playbooks/attack/enterprise/T1069.002.yml
T1069.002: Domain Groups,c1e2f3a4-b5c6-4d7e-8f9a-0b1c2d3e4f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0007: Discovery,n; o; n; e,2,"Is a PowerShell script exhibiting unusually high entropy, potentially indicating obfuscation of domain enumeration activity?",Adversaries often obfuscate their scripts to evade signature-based detection. High Shannon entropy can be a statistical indicator of obfuscation. This question helps uncover hidden malicious scripts by focusing on their structure rather than their exact content.,"Windows Event ID 4104; Domain Controllers, Member Servers, Privileged User Workstations",last 90 days,"For each PowerShell script block (4104), calculate Shannon entropy. Alert if entropy exceeds the 95th percentile of the established baseline.",playbooks/attack/enterprise/T1069.002.yml
T1069.002: Domain Groups,c1e2f3a4-b5c6-4d7e-8f9a-0b1c2d3e4f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0007: Discovery,n; o; n; e,3,"Does a process command line exhibit characteristics of malicious domain enumeration, as identified by a machine learning model?","This question uses a machine learning model to classify command-line activity. The model is trained on features like command length, character frequency, and keywords to distinguish between benign administrative commands and malicious enumeration attempts that might not use a known tool signature.","Windows Event ID 4688; Domain Controllers, Member Servers, Privileged User Workstations",last 90 days,Classify new process command lines (4688) using a trained model. Alert on commands classified as malicious with high confidence.,playbooks/attack/enterprise/T1069.002.yml
T1069.002: Domain Groups,c1e2f3a4-b5c6-4d7e-8f9a-0b1c2d3e4f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0007: Discovery,n; o; n; e,4,Has a single user or process executed an unusual sequence of native domain group discovery commands in a short period?,"While single discovery commands can be legitimate, a rapid succession of different enumeration commands (e.g., 'net group /domain' followed by 'Get-ADGroupMember') by one entity is highly suspicious and indicative of automated or scripted reconnaissance.","Windows Event ID 4688; Windows Event ID 4104; All Endpoints and Servers, especially Domain Controllers and administrative workstations",last 90 days,Correlate process (4688) and PowerShell (4104) logs. Alert if a single user/process runs >3 distinct enumeration commands from one host within 5 minutes.,playbooks/attack/enterprise/T1069.002.yml
T1069.002: Domain Groups,c1e2f3a4-b5c6-4d7e-8f9a-0b1c2d3e4f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0007: Discovery,n; o; n; e,5,Is a user executing discovery-related commands at a rate that is statistically anomalous compared to their own historical baseline?,"This question aims to detect changes in individual user behavior. An administrator might run discovery commands occasionally, but a sudden, sharp increase in this activity for that specific user, deviating from their normal pattern, can signal a compromised account or insider threat.","Windows Event ID 4688; Windows Event ID 4104; All Endpoints and Servers, especially Domain Controllers and administrative workstations",last 90 days,"For each user, baseline their command frequency. Alert if the hourly count of discovery commands exceeds 3 standard deviations above their moving average.",playbooks/attack/enterprise/T1069.002.yml
T1069.002: Domain Groups,c1e2f3a4-b5c6-4d7e-8f9a-0b1c2d3e4f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0007: Discovery,n; o; n; e,6,Does a sequence of command-line executions match a pattern classified as 'Reconnaissance' by a Hidden Markov Model?,This question models the *sequence* of actions rather than just the volume. An HMM can learn the typical transitions between different types of commands. An observed sequence that has a high probability of being in a 'Reconnaissance' state suggests a structured attack is underway.,"Windows Event ID 4688; Windows Event ID 4104; All Endpoints and Servers, especially Domain Controllers and administrative workstations",last 90 days,"Using a trained HMM, calculate the probability that an observed command sequence corresponds to a 'Reconnaissance' state. Alert if the probability exceeds a threshold.",playbooks/attack/enterprise/T1069.002.yml
T1069.002: Domain Groups,c1e2f3a4-b5c6-4d7e-8f9a-0b1c2d3e4f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0007: Discovery,n; o; n; e,7,Is an LDAP query targeting Active Directory group objects using a filter known to be associated with reconnaissance tools like BloodHound?,"This question looks for highly specific, malicious LDAP query patterns. BloodHound and other tools use unique, complex filters to efficiently gather AD data. These filters are almost never used in legitimate operations, making them a very high-fidelity indicator of compromise.",Zeek ldap.log; Zeek conn.log; Network segments monitoring traffic to and from Domain Controllers,last 90 days,Scan Zeek ldap.log for LDAP queries with filters known to be used by BloodHound or for broad queries like '(objectCategory=group)'.,playbooks/attack/enterprise/T1069.002.yml
T1069.002: Domain Groups,c1e2f3a4-b5c6-4d7e-8f9a-0b1c2d3e4f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0007: Discovery,n; o; n; e,8,Is a host generating a volume of LDAP search requests that is anomalous compared to its own history or its peer group?,"This question identifies reconnaissance by looking for unusual network traffic patterns. A sudden spike in LDAP queries from a single host, or a host that queries far more than its functional peers (e.g., other workstations), points to large-scale enumeration.",Zeek ldap.log; Zeek conn.log; Network segments monitoring traffic to and from Domain Controllers,last 90 days,"For each source IP in Zeek ldap.log, calculate hourly LDAP search counts. Alert if a host's count exceeds the 99th percentile of its baseline or is an outlier in its peer group.",playbooks/attack/enterprise/T1069.002.yml
T1069.002: Domain Groups,c1e2f3a4-b5c6-4d7e-8f9a-0b1c2d3e4f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0007: Discovery,n; o; n; e,9,Is the volume of LDAP queries from a host significantly exceeding the predicted volume from a time-series forecasting model?,"This question uses a forecasting model to predict what 'normal' LDAP traffic volume should look like for a given host. An alert is generated when the actual traffic volume is significantly higher than the prediction's upper confidence limit, indicating a sudden, unexpected burst of activity that is likely malicious.",Zeek ldap.log; Zeek conn.log; Network segments monitoring traffic to and from Domain Controllers,last 90 days,Model LDAP query volume for each host as a time series. Alert if observed volume significantly exceeds the forecasted upper confidence bound.,playbooks/attack/enterprise/T1069.002.yml
T1069.002: Domain Groups,c1e2f3a4-b5c6-4d7e-8f9a-0b1c2d3e4f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0007: Discovery,n; o; n; e,10,Has a sensitive Active Directory group's membership been read by a user or from a host that is not on an explicit allow list?,"This question provides a high-fidelity alert by tightly controlling access to critical groups like Domain Admins. By pre-defining who *should* be accessing these groups, any access from an unauthorized user or system is immediately flagged as a high-priority security event. This requires enabling specific audit policies (SACLs) on the AD objects.",Windows Event ID 4662; Windows Event ID 4624; Domain Controllers,last 90 days,"After enabling SACLs on sensitive AD groups, alert on Event ID 4662 if the access is from a user or host not on the predefined allow list.",playbooks/attack/enterprise/T1069.002.yml
T1069.002: Domain Groups,c1e2f3a4-b5c6-4d7e-8f9a-0b1c2d3e4f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0007: Discovery,n; o; n; e,11,Is an authorized administrator accessing sensitive groups at an unusual time or from an unfamiliar workstation?,"Even legitimate users can have their credentials stolen. This question helps detect such a compromise by baselining the normal behavior of privileged accounts. If an authorized admin suddenly accesses a sensitive group at 3 AM from a marketing team's PC, it's a strong anomaly worth investigating, even if the account itself is on the allow list.",Windows Event ID 4662; Windows Event ID 4624; Domain Controllers,last 90 days,"For authorized users, baseline access patterns (hours, workstations). Alert if access occurs outside normal profiled hours or from a new workstation.",playbooks/attack/enterprise/T1069.002.yml
T1069.002: Domain Groups,c1e2f3a4-b5c6-4d7e-8f9a-0b1c2d3e4f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0007: Discovery,n; o; n; e,12,Does an access event to a sensitive group show anomalous characteristics when compared to a model of legitimate administrative behavior?,"This question uses an anomaly detection model (like a one-class SVM) to learn a complex, multi-dimensional profile of 'normal' privileged access. The model considers user, host, logon type, time, and day simultaneously. Any access event that doesn't fit this learned profile is flagged as anomalous, catching subtle deviations that rule-based systems might miss.",Windows Event ID 4662; Windows Event ID 4624; Domain Controllers,last 90 days,"Train a one-class SVM or Isolation Forest on legitimate access events (4662, 4624). Score new access events and alert on any flagged as an anomaly.",playbooks/attack/enterprise/T1069.002.yml
T1069.002: Domain Groups,c1e2f3a4-b5c6-4d7e-8f9a-0b1c2d3e4f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0007: Discovery,n; o; n; e,13,Is domain group enumeration activity originating from a user or host whose business function does not require it?,"This question leverages organizational knowledge to detect suspicious activity. A web server or a user from the finance department has no legitimate reason to be enumerating domain groups. By creating rules based on user/host roles, this approach can quickly identify out-of-place actions that strongly suggest a compromised asset.","Windows Event ID 4688; Windows Event ID 4104; Zeek ldap.log; All Endpoints and Servers, particularly non-IT/developer workstations and single-function servers like Web Servers or Database Servers",last 90 days,"Maintain a user/host role inventory. Alert if enumeration commands (4688, 4104) originate from a user/host not in an authorized role.",playbooks/attack/enterprise/T1069.002.yml
T1069.002: Domain Groups,c1e2f3a4-b5c6-4d7e-8f9a-0b1c2d3e4f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0007: Discovery,n; o; n; e,14,Is a user's discovery activity score a statistical outlier compared to their peer group?,"This question identifies anomalous behavior within a functional group. While some discovery activity might be normal for a group of system administrators, if one admin's activity score is dramatically higher than their peers', it could indicate that their account is being used for broader, more aggressive reconnaissance.","Windows Event ID 4688; Windows Event ID 4104; Zeek ldap.log; All Endpoints and Servers, particularly non-IT/developer workstations and single-function servers like Web Servers or Database Servers",last 90 days,"Group users by role. Calculate a weekly discovery activity score for each user. Alert if a user's score is an outlier (e.g., >95th percentile) within their group.",playbooks/attack/enterprise/T1069.002.yml
T1069.002: Domain Groups,c1e2f3a4-b5c6-4d7e-8f9a-0b1c2d3e4f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0007: Discovery,n; o; n; e,15,"Has a host, automatically clustered into a specific functional role, performed an action (like domain enumeration) that deviates from its cluster's typical behavior?","This question uses unsupervised machine learning to automatically define host roles based on behavior. A clustering algorithm can group servers based on their network traffic and running processes. If a host in the 'web server' cluster suddenly starts running 'net group /domain', the model flags it as an outlier, indicating a significant and suspicious deviation from its established role.","Windows Event ID 4688; Windows Event ID 4104; Zeek ldap.log; All Endpoints and Servers, particularly non-IT/developer workstations and single-function servers like Web Servers or Database Servers",last 90 days,"Use a clustering algorithm (e.g., DBSCAN) on host activity data to define functional roles. Flag any host that executes enumeration commands as an outlier if it deviates from its cluster's profile.",playbooks/attack/enterprise/T1069.002.yml
T1083: File and Directory Discovery,c8a0b1d2-5e7f-4b0a-8d6c-3f9e2a1b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,1,Are known malicious discovery tools (like Seatbelt or SharpHound) being executed on enterprise systems?,"This question focuses on detecting the direct execution of known malicious discovery tools by their process names or file hashes. A match is a high-confidence indicator of compromise, as these tools are specifically designed for reconnaissance within a compromised network. Alerting on these helps catch adversaries early in their discovery phase.","Windows Event ID 4688; Sysmon Event ID 1; Log aggregation platform (SIEM) containing process execution logs from all enterprise endpoints and servers, with a focus on high-value assets like Domain Controllers, file servers, and developer workstations.",last 90 days,SEARCH process_creation_logs WHERE process_name IN (watchlist_of_discovery_tools) OR file_hash IN (watchlist_of_discovery_tool_hashes),playbooks/attack/enterprise/T1083.yml
T1083: File and Directory Discovery,c8a0b1d2-5e7f-4b0a-8d6c-3f9e2a1b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,2,"Is an unusually rare process being executed from an interactive shell, potentially indicating an unknown or custom discovery tool?","This question aims to find unknown or custom discovery tools by looking for processes that are statistically rare in the environment. Adversaries often use custom-compiled or less common tools to evade signature-based detection. A low-prevalence executable launched from a command shell (`cmd.exe`, `powershell.exe`) is a strong anomaly worth investigating.","Windows Event ID 4688; Sysmon Event ID 1; Log aggregation platform (SIEM) containing process execution logs from all enterprise endpoints and servers, with a focus on high-value assets like Domain Controllers, file servers, and developer workstations.",last 90 days,"CALCULATE prevalence of all process_hashes. SEARCH process_creation_logs WHERE parent_process IN ('powershell.exe', 'cmd.exe') AND process_hash_prevalence < 5 hosts.",playbooks/attack/enterprise/T1083.yml
T1083: File and Directory Discovery,c8a0b1d2-5e7f-4b0a-8d6c-3f9e2a1b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,3,Can machine learning models identify suspicious process executions indicative of discovery activity based on their characteristics?,"This question leverages a machine learning approach to identify malicious discovery activity that might not be caught by simple rules. By analyzing features like process name entropy (randomness), parent process, and command-line length, a model can score the likelihood of a process being malicious, providing a more nuanced and robust detection method than static indicators alone.","Windows Event ID 4688; Sysmon Event ID 1; Log aggregation platform (SIEM) containing process execution logs from all enterprise endpoints and servers, with a focus on high-value assets like Domain Controllers, file servers, and developer workstations.",last 90 days,"FOR EACH process_creation_event, SCORE with ML_model(features=[process_name_entropy, parent_process, cmd_line_length, hash_prevalence]). ALERT if score > 0.9.",playbooks/attack/enterprise/T1083.yml
T1083: File and Directory Discovery,c8a0b1d2-5e7f-4b0a-8d6c-3f9e2a1b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,4,"Are native command-line utilities like 'dir', 'tree', or 'find' being used with arguments that suggest wide-scale or sensitive file discovery?","This question focuses on detecting the misuse of legitimate, built-in system tools for discovery. Adversaries use these 'living-off-the-land' binaries (LOLBins) to blend in. Searching for specific command-line patterns, like recursive searches (`/s`), output redirection (`> file.txt`), or searches for sensitive file extensions (`.pem`, `.kdbx`), can uncover this malicious activity.","Windows Event ID 4688; Sysmon Event ID 1; Log aggregation platform (SIEM) containing process execution logs from all endpoints and servers, particularly those where interactive command-line use is rare or should be highly scrutinized (e.g., web servers, database servers, application servers).",last 90 days,"SEARCH process_creation_logs WHERE process_name IN ('dir.exe', 'tree.com', 'find.exe') AND command_line MATCHES REGEX ('/s.*>', 'findstr .pem .kdbx')",playbooks/attack/enterprise/T1083.yml
T1083: File and Directory Discovery,c8a0b1d2-5e7f-4b0a-8d6c-3f9e2a1b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,5,Are users or hosts executing discovery commands with arguments that are anomalous compared to their own historical behavior?,"This question aims to detect unusual discovery activity by baselining normal command-line usage for each user and host. A user who typically uses simple `dir` commands and suddenly executes a complex, recursive search is an anomaly. This behavioral approach can catch sophisticated adversaries who are attempting to blend in by using legitimate tools in a non-standard way.","Windows Event ID 4688; Sysmon Event ID 1; Log aggregation platform (SIEM) containing process execution logs from all endpoints and servers, particularly those where interactive command-line use is rare or should be highly scrutinized (e.g., web servers, database servers, application servers).",last 90 days,"FOR EACH user_host_pair, BASELINE command_line_arguments. FOR EACH new_execution, CALCULATE Jaccard_distance_from_baseline. ALERT if distance > 98th_percentile.",playbooks/attack/enterprise/T1083.yml
T1083: File and Directory Discovery,c8a0b1d2-5e7f-4b0a-8d6c-3f9e2a1b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,6,"Does the sequence of commands executed by a user deviate from normal workflow patterns, especially when discovery commands are involved?","This question looks beyond single commands to analyze the entire sequence of actions within a user session. A benign user might run `dir` then edit a file. An adversary might run `dir`, then `whoami`, then `net user`, then `tree`. A sequence analysis model can learn these normal patterns and flag sessions that contain an illogical or suspicious flow of commands, indicating reconnaissance activity.","Windows Event ID 4688; Sysmon Event ID 1; Log aggregation platform (SIEM) containing process execution logs from all endpoints and servers, particularly those where interactive command-line use is rare or should be highly scrutinized (e.g., web servers, database servers, application servers).",last 90 days,"FOR EACH user_session, ANALYZE command_sequence with LSTM_model. ALERT if sequence_probability is low AND sequence contains ('dir', 'tree', 'find').",playbooks/attack/enterprise/T1083.yml
T1083: File and Directory Discovery,c8a0b1d2-5e7f-4b0a-8d6c-3f9e2a1b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,7,"Has a user or process generated a burst of file access events or discovery commands that exceeds a fixed, high-volume threshold?","This question uses a simple, high-volume threshold to detect brute-force discovery activity. While potentially noisy, a massive spike (e.g., thousands of file accesses or hundreds of `dir` commands in minutes) is a strong indicator of automated scanning or scripting, which is characteristic of an adversary quickly mapping out a system's file structure.","Windows Event ID 4688; Windows Event ID 4663; Sysmon Event ID 1; Sysmon Event ID 11; Log aggregation platform (SIEM) containing process creation and file audit logs from critical assets like file servers, SharePoint servers, source code repositories, and Domain Controllers.",last 90 days,COUNT file_access_events (4663) and discovery_commands (4688) by user/process over 5min. ALERT if file_access_count > 1000 OR discovery_command_count > 100.,playbooks/attack/enterprise/T1083.yml
T1083: File and Directory Discovery,c8a0b1d2-5e7f-4b0a-8d6c-3f9e2a1b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,8,Is a user or host exhibiting a statistically significant increase in file access or discovery command activity compared to their own baseline?,"This question refines the volume-based approach by creating a dynamic baseline for each user and host. Instead of a fixed number, it alerts when activity is abnormal *for that specific entity*. This is more effective at finding unusual behavior, as what's normal for a backup service would be highly anomalous for a regular user account.","Windows Event ID 4688; Windows Event ID 4663; Sysmon Event ID 1; Sysmon Event ID 11; Log aggregation platform (SIEM) containing process creation and file audit logs from critical assets like file servers, SharePoint servers, source code repositories, and Domain Controllers.",last 90 days,"FOR EACH user_host, BASELINE hourly file_access and discovery_command counts. ALERT if current_hour_count > (mean + 3 * std_dev) of baseline.",playbooks/attack/enterprise/T1083.yml
T1083: File and Directory Discovery,c8a0b1d2-5e7f-4b0a-8d6c-3f9e2a1b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,9,Does the time series of file access events for a user or process show an anomaly that cannot be explained by normal daily or weekly patterns (seasonality)?,"This question applies advanced time-series analysis to detect subtle anomalies in file access patterns. Algorithms like SARIMA or Prophet can model complex seasonal behavior (e.g., higher activity during work hours, lower on weekends). An alert is triggered only when activity deviates significantly from what the model *predicts*, making it highly effective at filtering out normal business operations and spotting true outliers.","Windows Event ID 4688; Windows Event ID 4663; Sysmon Event ID 1; Sysmon Event ID 11; Log aggregation platform (SIEM) containing process creation and file audit logs from critical assets like file servers, SharePoint servers, source code repositories, and Domain Controllers.",last 90 days,MODEL time_series of file_access_events (4663) per user/process using SARIMA/Prophet. ALERT if actual_count exceeds predicted_confidence_interval.,playbooks/attack/enterprise/T1083.yml
T1083: File and Directory Discovery,c8a0b1d2-5e7f-4b0a-8d6c-3f9e2a1b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,10,Is a single process or user rapidly accessing multiple pre-defined sensitive directories or files?,"This question focuses on 'canary' files and directories. By creating a watchlist of known sensitive locations (like where password hashes are stored or private keys reside), an alert can be triggered when a single entity starts 'hopping' between them. This behavior is highly suspicious as legitimate access is typically confined to a single, relevant sensitive location at a time.","Windows Event ID 4663; Windows Event ID 4688; Sysmon Event ID 11; File audit logs (Event ID 4663) from servers hosting sensitive departmental data (Finance, HR, Legal), Domain Controllers (SYSVOL, NTDS.dit location), and source code repositories.",last 90 days,SEARCH file_access_logs (4663) for paths in critical_directory_watchlist. COUNT distinct directories accessed by process in 1min. ALERT if count > 3.,playbooks/attack/enterprise/T1083.yml
T1083: File and Directory Discovery,c8a0b1d2-5e7f-4b0a-8d6c-3f9e2a1b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,11,"Is a process exhibiting unusually broad or random directory traversal, as measured by the entropy of the paths it accesses?","This question uses information theory to detect widespread discovery. High entropy in accessed directory paths suggests the process is not following a predictable, narrow workflow but is instead touching many different, unrelated parts of the file system. This is a strong mathematical indicator of automated scanning or an adversary manually exploring the system.","Windows Event ID 4663; Windows Event ID 4688; Sysmon Event ID 11; File audit logs (Event ID 4663) from servers hosting sensitive departmental data (Finance, HR, Legal), Domain Controllers (SYSVOL, NTDS.dit location), and source code repositories.",last 90 days,"FOR EACH process, CALCULATE Shannon_entropy of accessed_directory_paths over 10min. ALERT if entropy > 99th_percentile for that process_name/user.",playbooks/attack/enterprise/T1083.yml
T1083: File and Directory Discovery,c8a0b1d2-5e7f-4b0a-8d6c-3f9e2a1b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,12,Does a user's file access behavior fall outside of the normal clusters of activity established by their peers?,"This question uses clustering to find behavioral outliers. By grouping users with similar file access patterns (e.g., the HR department accessing HR folders, developers accessing source code), any user whose activity doesn't fit into a defined cluster is flagged as an anomaly. This is a powerful way to spot compromised accounts being used for purposes outside their normal role.","Windows Event ID 4663; Windows Event ID 4688; Sysmon Event ID 11; File audit logs (Event ID 4663) from servers hosting sensitive departmental data (Finance, HR, Legal), Domain Controllers (SYSVOL, NTDS.dit location), and source code repositories.",last 90 days,"CLUSTER users based on vectorized file_access_patterns using DBSCAN. ALERT on users classified as outliers, especially if their activity involves sensitive directories.",playbooks/attack/enterprise/T1083.yml
T1083: File and Directory Discovery,c8a0b1d2-5e7f-4b0a-8d6c-3f9e2a1b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,13,"Is a single host attempting to connect to an unusually high number of network shares, especially administrative shares (C$, ADMIN$)?","This question aims to detect network-level file and directory discovery. An adversary, having compromised one host, will often use it to scan the network for open and accessible file shares. A large number of connection attempts to unique shares from a single source, particularly to administrative shares, is a classic sign of lateral movement and reconnaissance.","Zeek smb_files.log; Zeek conn.log; Zeek smb_mapping.log; Windows Event ID 5145; Network traffic data from network taps monitoring East-West traffic between subnets. Zeek sensors deployed at key network chokepoints (e.g., data center core, user access layer). Windows Security logs from all file servers and domain controllers.",last 90 days,"SEARCH smb_logs (Zeek smb_mapping.log, Win 5145). COUNT unique host/share combinations per source_IP in 5min. ALERT if count > 10. INCREASE severity if share_name IN ('C$', 'ADMIN$').",playbooks/attack/enterprise/T1083.yml
T1083: File and Directory Discovery,c8a0b1d2-5e7f-4b0a-8d6c-3f9e2a1b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,14,Is a host exhibiting an anomalous 'fan-out' of SMB (port 445) connections compared to its peers?,"This question focuses on the network connection pattern itself, rather than the share names. It identifies hosts that are connecting to a much larger number of other machines over SMB than is typical for their role (e.g., a workstation suddenly connecting to 50 other workstations). This 'fan-out' behavior is a strong indicator of an automated SMB scanning tool being run from the source host.","Zeek smb_files.log; Zeek conn.log; Zeek smb_mapping.log; Windows Event ID 5145; Network traffic data from network taps monitoring East-West traffic between subnets. Zeek sensors deployed at key network chokepoints (e.g., data center core, user access layer). Windows Security logs from all file servers and domain controllers.",last 90 days,COUNT unique destination_IPs on port 445 per source_IP per hour. BASELINE this 'fan-out' metric for peer groups. ALERT if a host's fan-out > 95th_percentile of its peer group.,playbooks/attack/enterprise/T1083.yml
T1083: File and Directory Discovery,c8a0b1d2-5e7f-4b0a-8d6c-3f9e2a1b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,15,"Are new SMB connections forming that are unusual from a network graph perspective, such as bridging otherwise separate user groups or showing a sudden increase in centrality?","This question applies graph analysis to network traffic to find structural anomalies. Normal traffic often forms distinct communities (e.g., finance servers talk to finance workstations). An adversary moving laterally will create new connections that bridge these communities or cause a compromised node to suddenly become much more 'central' in the graph. This detects the structural change in communication patterns caused by an attack.","Zeek smb_files.log; Zeek conn.log; Zeek smb_mapping.log; Windows Event ID 5145; Network traffic data from network taps monitoring East-West traffic between subnets. Zeek sensors deployed at key network chokepoints (e.g., data center core, user access layer). Windows Security logs from all file servers and domain controllers.",last 90 days,"BUILD graph with hosts as nodes, SMB connections as edges. IDENTIFY communities. ALERT on new edges that bridge communities OR on nodes with a sudden increase in degree centrality.",playbooks/attack/enterprise/T1083.yml
T1083: File and Directory Discovery,c8a0b1d2-5e7f-4b0a-8d6c-3f9e2a1b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,16,"Has a host exhibited a correlated sequence of events indicative of the reconnaissance-to-staging attack chain (e.g., local discovery -> network discovery -> data compression)?","This question seeks to identify a multi-stage attack pattern by correlating different types of events over time. An adversary's workflow often follows a logical progression: first, they discover files locally; next, they discover files on the network; finally, they package the discovered data for exfiltration. A stateful rule that looks for this specific sequence provides a very high-fidelity alert for an active intrusion.","Windows Event ID 4688; Windows Event ID 4663; Sysmon Event ID 11; Zeek smb_mapping.log; Zeek conn.log; Centralized log management platform (e.g., SIEM, data lake) capable of correlating events from disparate sources, including endpoint process logs (Windows, Sysmon) and network traffic logs (Zeek).",last 90 days,"CREATE stateful rule. IF host performs (recursive dir) AND THEN (SMB enum >5 servers) AND THEN (creates .zip/.rar/.7z) within 1hr, ALERT.",playbooks/attack/enterprise/T1083.yml
T1083: File and Directory Discovery,c8a0b1d2-5e7f-4b0a-8d6c-3f9e2a1b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,17,"Has a host accumulated a high risk score by performing a series of individually suspicious, but not necessarily malicious, actions in a short period?","This question uses a risk-scoring model to detect attacks. Instead of relying on one high-severity event, it aggregates risk from multiple lower-severity events. A recursive `dir` might be low risk on its own, as might a single SMB connection. But when a host does both, plus accesses a sensitive file, its cumulative risk score can cross a threshold, indicating a likely compromise that would be missed by looking at each event in isolation.","Windows Event ID 4688; Windows Event ID 4663; Sysmon Event ID 11; Zeek smb_mapping.log; Zeek conn.log; Centralized log management platform (e.g., SIEM, data lake) capable of correlating events from disparate sources, including endpoint process logs (Windows, Sysmon) and network traffic logs (Zeek).",last 90 days,"DEFINE risk scores for events (e.g., recursive_dir=5, smb_scan=15). SUM risk score for each host over 30min. ALERT if total_score > threshold (e.g., 4 std_dev above peer group mean).",playbooks/attack/enterprise/T1083.yml
T1083: File and Directory Discovery,c8a0b1d2-5e7f-4b0a-8d6c-3f9e2a1b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,18,"Can a probabilistic model, like a Hidden Markov Model, infer that a host has transitioned into a 'Reconnaissance' or 'Staging' attack phase based on its sequence of observed security events?","This question applies a sophisticated probabilistic model to infer the adversary's intent. An HMM assumes there are hidden 'states' (like 'Benign' or 'Reconnaissance') that can only be inferred through 'observations' (the security events we log). By feeding the stream of events from a host into the model, we can calculate the probability that the host is in a malicious state, allowing for detection even when the individual events themselves are ambiguous.","Windows Event ID 4688; Windows Event ID 4663; Sysmon Event ID 11; Zeek smb_mapping.log; Zeek conn.log; Centralized log management platform (e.g., SIEM, data lake) capable of correlating events from disparate sources, including endpoint process logs (Windows, Sysmon) and network traffic logs (Zeek).",last 90 days,"FEED stream of events per host into HMM. MODEL calculates probability of hidden states ('Benign', 'Recon', 'Staging'). ALERT if P(state='Recon' or 'Staging') > threshold.",playbooks/attack/enterprise/T1083.yml
T1087.001: Local Account,a6b5a3e1-8f5b-43e3-9565-5022a8684699,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,1,Has a process been executed whose file hash matches a known malicious discovery tool?,"This question aims to detect the use of well-known adversary tools like PowerSploit, BloodHound, or Mimikatz. By hashing every new process and checking it against a threat intelligence feed, we can identify the execution of malicious binaries used for local account enumeration with high confidence. A match indicates an active threat on the endpoint.",Windows Event ID 4688; User workstations; Member servers; Domain controllers; Endpoint Detection and Response (EDR) platform; SIEM/Log Aggregator; Threat Intelligence Feeds,last 90 days,": FOR each new process event, COMPUTE file hash. QUERY threat intel feed for hash. IF match exists, ALERT.",playbooks/attack/enterprise/T1087.001.yml
T1087.001: Local Account,a6b5a3e1-8f5b-43e3-9565-5022a8684699,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,2,Has a rare or anomalous process been executed on the system?,"This question helps identify potentially malicious, unknown, or custom tools that are not present in threat intelligence feeds. By calculating the prevalence of a process hash across the enterprise, very rare executions (e.g., bottom 1st percentile) can be flagged as suspicious. This is especially relevant if the parent process is unusual for spawning new processes, such as a Microsoft Office application, or if the process is unsigned.",Windows Event ID 4688; User workstations; Member servers; Domain controllers; Endpoint Detection and Response (EDR) platform; SIEM/Log Aggregator; Process hash prevalence data,last 90 days,": FOR each new process event, COMPUTE file hash. CALCULATE prevalence of hash across enterprise over last 30 days. IF prevalence is in bottom 1st percentile AND parent process is anomalous, ALERT.",playbooks/attack/enterprise/T1087.001.yml
T1087.001: Local Account,a6b5a3e1-8f5b-43e3-9565-5022a8684699,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,3,Does a machine learning model classify a new process execution as malicious based on its characteristics?,"This question leverages machine learning to score the likelihood of a process being malicious, moving beyond simple hash lookups or prevalence counts. The model considers a richer set of features, including the process name, parent process, user context, and command-line arguments, to identify sophisticated or obfuscated threats that might otherwise be missed. An alert is generated when the model's confidence score surpasses a set threshold.",Windows Event ID 4688; User workstations; Member servers; Domain controllers; Endpoint Detection and Response (EDR) platform; SIEM/Log Aggregator; ML model output,last 90 days,": FOR each new process event, EXTRACT features (process name, parent, user, cmdline). INPUT features into ML classification model. IF model score > threshold, ALERT.",playbooks/attack/enterprise/T1087.001.yml
T1087.001: Local Account,a6b5a3e1-8f5b-43e3-9565-5022a8684699,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,4,Has a command been executed that is commonly used for local account enumeration?,"This question looks for the direct execution of commands that adversaries use to discover local accounts. By monitoring process command-line arguments for specific strings like `net user`, `Get-LocalUser`, or `wmic useraccount get`, we can detect explicit enumeration attempts. Alerts should be prioritized if these commands are spawned by unusual parent processes like Microsoft Office applications or web browsers, which can indicate a compromised user session.",Windows Event ID 4688; User workstations; Member servers; Domain controllers; Terminal servers; SIEM/Log Aggregator,last 90 days,": FOR each new process event, SEARCH command line for regex patterns like 'net user', 'Get-LocalUser'. IF match found, ALERT.",playbooks/attack/enterprise/T1087.001.yml
T1087.001: Local Account,a6b5a3e1-8f5b-43e3-9565-5022a8684699,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,5,Is a user executing commands that are anomalous compared to their historical baseline activity?,This question seeks to identify unusual command-line behavior on a per-user or per-host basis. It uses two methods: analyzing the complexity (Shannon entropy) of a command string to detect obfuscation and tracking the frequency of discovery-related commands. An alert is triggered if a command is significantly more complex or if the frequency of discovery commands deviates sharply from the established norm for that specific user or host.,Windows Event ID 4688; User workstations; Member servers; Domain controllers; Terminal servers; SIEM/Log Aggregator; User/Host command history baseline,last 90 days,": FOR each new command, CALCULATE Shannon entropy. IF entropy > 3 std dev from user's average, ALERT. ALSO, TRACK frequency of discovery commands. IF frequency > 99th percentile of user's history, ALERT.",playbooks/attack/enterprise/T1087.001.yml
T1087.001: Local Account,a6b5a3e1-8f5b-43e3-9565-5022a8684699,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,6,Has a user executed a sequence of commands that matches a known malicious pattern?,"This question moves beyond single commands to analyze the entire sequence of actions within a user session. A sequence analysis model (like an LSTM) can be trained to recognize the ""grammar"" of an attack, such as reconnaissance commands (`whoami`, `net user`) followed by lateral movement or privilege escalation. This helps identify malicious intent even when individual commands, viewed in isolation, might appear benign.",Windows Event ID 4688; User workstations; Member servers; Domain controllers; Terminal servers; SIEM/Log Aggregator; Command sequence analysis model,last 90 days,": INPUT user's command sequence into sequence analysis model. IF model flags sequence as matching a malicious pattern, ALERT.",playbooks/attack/enterprise/T1087.001.yml
T1087.001: Local Account,a6b5a3e1-8f5b-43e3-9565-5022a8684699,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,7,Has a user or host executed an excessive number of discovery commands within a short time frame?,"This question is designed to detect brute-force or rapid enumeration activity. By counting the number of discovery-related commands (identified via regex) from a single source user or host within a short window (e.g., 5 minutes) and comparing it to a static threshold, we can quickly identify high-volume, noisy enumeration attempts.",Windows Event ID 4688; Source host initiating discovery; Target hosts being enumerated; Security Information and Event Management (SIEM) system,last 90 days,": COUNT discovery commands per source user/host in 5-minute windows. IF count > 10, ALERT.",playbooks/attack/enterprise/T1087.001.yml
T1087.001: Local Account,a6b5a3e1-8f5b-43e3-9565-5022a8684699,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,8,Has the rate of discovery commands from a user or host significantly deviated from their established baseline?,"This question refines the previous one by using a dynamic, per-entity baseline instead of a single static threshold. This approach is more effective at detecting adversaries who are attempting to stay ""under the radar"" by using a volume of commands that might be normal for a system administrator but is highly unusual for a typical user. An alert is triggered when an entity's activity exceeds its own historical norm by a significant margin (e.g., 3 standard deviations).",Windows Event ID 4688; Source host initiating discovery; Target hosts being enumerated; Security Information and Event Management (SIEM) system; User/Host command frequency baseline,last 90 days,": FOR each 5-minute window, COUNT discovery commands per user/host. IF count > 3 std dev from that entity's historical mean, ALERT.",playbooks/attack/enterprise/T1087.001.yml
T1087.001: Local Account,a6b5a3e1-8f5b-43e3-9565-5022a8684699,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,9,"Can sparse, ""low and slow"" enumeration events across multiple hosts and times be grouped into a single coordinated campaign?","This question addresses the challenge of detecting sophisticated, ""low and slow"" enumeration where an adversary spreads their activity across multiple targets over a longer period to evade simple frequency-based alerts. By using a clustering algorithm like DBSCAN, we can group these seemingly unrelated events based on features like source, command type, and time proximity, revealing the broader, coordinated campaign.",Windows Event ID 4688; Source host initiating discovery; Target hosts being enumerated; Security Information and Event Management (SIEM) system,last 90 days,": INPUT discovery event features (source, target, user, command, time) into DBSCAN clustering algorithm. IF a cluster of related events is identified, ALERT as a coordinated campaign.",playbooks/attack/enterprise/T1087.001.yml
T1087.001: Local Account,a6b5a3e1-8f5b-43e3-9565-5022a8684699,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,10,Did a local account discovery attempt from a source host precede a local logon attempt from that same source within a 60-minute window?,"This question aims to link reconnaissance activity directly to a potential follow-on action. A local account discovery command (`net user`) followed shortly by a local logon attempt (successful or failed) from the same source is a strong indicator that the adversary is acting on the information they just gathered. This correlation provides critical context, turning two separate, lower-priority events into a single high-priority alert.",Windows Event ID 4688; Windows Event ID 4624; Windows Event ID 4625; Zeek conn.log; Authentication servers; Domain Controllers; High-value servers; User workstations; SIEM system,last 90 days,": ON discovery event from source IP, START 60-minute timer. IF local logon event (Type 2) from same source IP occurs within window, ALERT.",playbooks/attack/enterprise/T1087.001.yml
T1087.001: Local Account,a6b5a3e1-8f5b-43e3-9565-5022a8684699,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,11,"Following a discovery and logon attempt, was the target account one that is rarely used or dormant?","This question adds a layer of risk scoring to the previous correlation. If an adversary discovers and then attempts to use a local account, targeting a dormant or infrequently used account is particularly suspicious, as these are less likely to be monitored and more likely to have weak or unchanged passwords. By checking the logon history, we can significantly increase the priority of alerts involving these high-risk dormant accounts.",Windows Event ID 4688; Windows Event ID 4624; Windows Event ID 4625; Zeek conn.log; Authentication servers; Domain Controllers; High-value servers; User workstations; SIEM system; Account logon history data,last 90 days,": ON correlated discovery/logon alert, QUERY logon history for target account. IF time since last logon is in 95th percentile (dormant), INCREASE alert risk score.",playbooks/attack/enterprise/T1087.001.yml
T1087.001: Local Account,a6b5a3e1-8f5b-43e3-9565-5022a8684699,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,12,"Does a machine learning model predict a logon attempt is malicious, especially when it is preceded by a discovery event?","This question operationalizes the correlation between discovery and logon as a feature in a machine learning model. The model learns to assess the risk of a logon based on multiple factors (time of day, source IP, etc.), but the presence of a recent discovery event from the same source acts as a powerful feature, significantly increasing the model's maliciousness score. This provides a probabilistic, automated way to flag high-risk logon attempts.",Windows Event ID 4688; Windows Event ID 4624; Windows Event ID 4625; Zeek conn.log; Authentication servers; Domain Controllers; High-value servers; User workstations; SIEM system; ML model output,last 90 days,": FOR each logon event, CREATE feature set including a boolean 'preceded_by_discovery_in_60_min'. INPUT to ML model. IF score > threshold, ALERT.",playbooks/attack/enterprise/T1087.001.yml
T1087.001: Local Account,a6b5a3e1-8f5b-43e3-9565-5022a8684699,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,13,"Has there been an attempt to access or save the SAM database, followed by a network file transfer of that data?","This question looks for a common credential theft technique: dumping the Security Account Manager (SAM) database for offline cracking. The analytic correlates host-based events indicating SAM access (e.g., `reg.exe save hklm\\sam` or direct file access) with network-based events (e.g., from Zeek) showing a file of the same name or hash being exfiltrated. This provides end-to-end visibility of the theft.",Windows Event ID 4688; Windows Event ID 4663; Zeek conn.log; Zeek files.log; Domain Controllers; Critical application servers; Network egress points; File servers,last 90 days,": ON SAM access event (EID 4688/4663), MONITOR network file logs for outbound transfer of a file with matching name/hash. IF found, ALERT.",playbooks/attack/enterprise/T1087.001.yml
T1087.001: Local Account,a6b5a3e1-8f5b-43e3-9565-5022a8684699,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,14,"After a suspected SAM database access, did the host exhibit anomalous outbound network traffic volume?","This question provides an alternative way to detect exfiltration when file-level network visibility isn't available. After a SAM access event is detected on a host, we analyze its subsequent network connections. A connection with an unusually large amount of outbound data, when compared to that specific host's baseline, is a strong indicator that a large file (like the SAM database) has been exfiltrated.",Windows Event ID 4688; Windows Event ID 4663; Zeek conn.log; Zeek files.log; Domain Controllers; Critical application servers; Network egress points; File servers; Host network traffic baseline,last 90 days,": ON SAM access event, MONITOR outbound connections from host for 15 mins. IF connection outbound bytes > 99th percentile for that host, ALERT.",playbooks/attack/enterprise/T1087.001.yml
T1087.001: Local Account,a6b5a3e1-8f5b-43e3-9565-5022a8684699,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,15,Does an anomaly detection model flag a spike in outbound traffic from a critical asset that is temporally correlated with a SAM access event?,"This question uses a more sophisticated, unsupervised machine learning approach to detect exfiltration from critical assets like Domain Controllers. An anomaly detection model (like Isolation Forest) is trained on normal network behavior. It can then flag anomalous patterns in traffic (e.g., spikes in outbound bytes, unusual protocols, or connection durations) that, when correlated in time with a host-based SAM access alert, provide a high-confidence signal of credential theft.",Windows Event ID 4688; Windows Event ID 4663; Zeek conn.log; Zeek files.log; Domain Controllers; Critical application servers; Network egress points; File servers; Anomaly detection model output,last 90 days,": CONTINUOUSLY run anomaly detection model on DC network traffic. IF model alerts AND a SAM access event occurred on the DC recently, ESCALATE alert.",playbooks/attack/enterprise/T1087.001.yml
T1087.003: Email Account,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,1,Are any processes being created that match the file hash or name of known email enumeration tools from our threat intelligence feeds?,"This question aims to identify the direct use of known malicious tools for email account discovery. Matching process creations against a list of known bad hashes or filenames (like MailSniper or ADFind) is a high-fidelity method for detecting adversary activity early in the reconnaissance phase. A positive match provides strong evidence of malicious intent.
",Windows Event ID 4688; Domain Controllers; Exchange Servers; Administrative Workstations; User Endpoints,last 90 days,": SEARCH process_creation_logs (EventID=4688)
JOIN threat_intel_feed ON file_hash OR file_name
IF match FOUND, ALERT
",playbooks/attack/enterprise/T1087.003.yml
T1087.003: Email Account,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,2,"Are there any newly executed processes, spawned by scripting engines, with high-entropy (potentially obfuscated) file names?","Adversaries often use obfuscated or randomized file names to evade simple signature-based detection. This question focuses on identifying processes spawned by common scripting engines (like PowerShell) that have unusually complex or random-looking names. High character entropy can be a strong indicator of an attempt to hide a malicious payload or script used for enumeration.
",Windows Event ID 4688; Domain Controllers; Exchange Servers; Administrative Workstations; User Endpoints,last 90 days,": SEARCH process_creation_logs (EventID=4688)
WHERE parent_process IN ('powershell.exe', 'cscript.exe')
CALCULATE entropy(process_name)
IF entropy > 3.5, ALERT
",playbooks/attack/enterprise/T1087.003.yml
T1087.003: Email Account,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,3,Have any newly created processes been classified by our machine learning model as highly probable email enumeration tools?,"This question leverages a machine learning model to detect novel or unknown enumeration tools that might not be caught by signature-based methods. The model analyzes various features of a process creation event (parent process, user, command line, etc.) to predict its likelihood of being malicious. A high probability score suggests the process exhibits characteristics strongly associated with enumeration tools and warrants immediate investigation.
",Windows Event ID 4688; Domain Controllers; Exchange Servers; Administrative Workstations; User Endpoints,last 90 days,": FOR each new process_creation_event (EventID=4688)
SCORE event with ML_model
IF score > 0.9, ALERT
",playbooks/attack/enterprise/T1087.003.yml
T1087.003: Email Account,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,4,"Are there any command-line or PowerShell script block logs containing specific keywords (e.g., 'Get-GlobalAddressList', 'Get-Recipient') used for email account discovery?","This question looks for the explicit use of PowerShell cmdlets or string patterns commonly associated with querying Active Directory or Exchange for user and mailbox information. Finding these specific terms in execution logs is a direct indicator that an actor is attempting to enumerate email accounts.
",Windows Event ID 4688; Windows Event ID 4104; Domain Controllers; Exchange Servers; Microsoft 365 Tenant; User Endpoints,last 90 days,": SEARCH command_line_logs (EventID=4688) OR powershell_script_logs (EventID=4104)
REGEX for 'Get-GlobalAddressList', 'Get-Recipient', 'Get-Mailbox', or LDAP filters
IF match FOUND, ALERT
",playbooks/attack/enterprise/T1087.003.yml
T1087.003: Email Account,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,5,"Has any user executed a rare or novel PowerShell cmdlet (e.g., 'Get-GlobalAddressList') that is anomalous compared to their own historical activity?","This question aims to detect unusual behavior by establishing a baseline of normal PowerShell activity for each user. An administrator might rarely, if ever, use a cmdlet like 'Get-GlobalAddressList'. Its sudden appearance in their activity, especially if it's statistically rare for them, can signal a compromised account being used for reconnaissance.
",Windows Event ID 4688; Windows Event ID 4104; Domain Controllers; Exchange Servers; Microsoft 365 Tenant; User Endpoints,last 90 days,": FOR each user
BUILD baseline of powershell_cmdlet_frequency
FOR each new cmdlet_execution
IF cmdlet is rare for user (e.g., 99th percentile), ALERT
",playbooks/attack/enterprise/T1087.003.yml
T1087.003: Email Account,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,6,Has a topic modeling analysis of PowerShell script logs classified any user's activity as 'reconnaissance'?,"This question uses an unsupervised machine learning approach to categorize PowerShell scripts into topics. By identifying a 'reconnaissance' topic that includes enumeration cmdlets, the system can flag users whose script activity suddenly aligns with this topic, even if the exact commands are obfuscated or varied. This is useful for detecting suspicious patterns of behavior that may not be obvious from single commands.
",Windows Event ID 4688; Windows Event ID 4104; Domain Controllers; Exchange Servers; Microsoft 365 Tenant; User Endpoints,last 90 days,": APPLY topic_model (LDA) to powershell_logs (EventID=4104)
CLASSIFY scripts into topics like 'benign admin', 'reconnaissance'
IF script topic is 'reconnaissance' for a user, ALERT
",playbooks/attack/enterprise/T1087.003.yml
T1087.003: Email Account,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,7,"Have any LDAP search requests been observed with filters designed for bulk enumeration of user or email objects (e.g., '(objectClass=user)', '(mail=*)')?","This question targets the specific LDAP queries an adversary would use to dump large numbers of user accounts or email addresses from Active Directory. Monitoring for these filter patterns in network traffic or domain controller logs provides a direct and high-confidence indicator of an attempt to gather directory information.
",Zeek ldap.log; Windows Event ID 1644; Domain Controllers; Network segments monitoring traffic to Domain Controllers,last 90 days,": SEARCH ldap_logs (Zeek ldap.log, EventID=1644)
REGEX for filters like '(objectCategory=person)', '(objectClass=user)', '(mail=*)'
IF match FOUND, ALERT
",playbooks/attack/enterprise/T1087.003.yml
T1087.003: Email Account,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,8,Has any source IP address performed an LDAP query that returned a number of objects significantly higher than its historical average?,"This question aims to detect bulk data exfiltration via LDAP by focusing on the *result* of the query, not just the query itself. A legitimate query might return a few objects, but an enumeration attempt will return hundreds or thousands. By baselining the typical number of objects returned per query for a given source, we can spot anomalous queries that return an unusually large dataset, indicating a bulk export.
",Zeek ldap.log; Windows Event ID 1644; Domain Controllers; Network segments monitoring traffic to Domain Controllers,last 90 days,": FOR each source_ip
BUILD 30-day baseline of objects_returned per LDAP_query
FOR each new query
IF objects_returned > (3 * stdev(baseline)), ALERT
",playbooks/attack/enterprise/T1087.003.yml
T1087.003: Email Account,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,9,Has a time-series analysis detected an anomalous spike in the volume of LDAP search requests from any host?,"This question focuses on the rate of LDAP activity rather than the content of individual queries. An adversary attempting to enumerate a directory will likely issue many queries in a short period. A time-series model can learn the normal rhythm of LDAP traffic and alert when a sudden, statistically significant spike occurs, which could indicate an automated enumeration script is running.
",Zeek ldap.log; Windows Event ID 1644; Domain Controllers; Network segments monitoring traffic to Domain Controllers,last 90 days,": MODEL volume of LDAP_requests over time using SARIMA
FOR each new time_window
IF observed_volume deviates significantly from forecast, ALERT
",playbooks/attack/enterprise/T1087.003.yml
T1087.003: Email Account,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,10,Has any single source IP address initiated an excessive number of connections to directory or mail services within a short time frame?,"This question uses a simple but effective threshold to detect brute-force or rapid connection-based enumeration attempts. By setting a high-water mark for the number of connections allowed from one IP to sensitive services (like Domain Controllers or Exchange) in a small window, we can catch automated tools that try to connect many times in quick succession.
",Zeek conn.log; Zeek dce_rpc.log; Zeek ldap.log; Network traffic segments in front of Domain Controllers and Exchange/Mail servers,last 90 days,": COUNT connections from source_ip to DC/Exchange_ports within 5_minutes
IF count > 500, ALERT
",playbooks/attack/enterprise/T1087.003.yml
T1087.003: Email Account,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,11,Is any source IP's hourly connection count to directory and mail services a statistical outlier compared to its own 30-day baseline?,"This question provides a more dynamic approach than a fixed threshold by creating a personalized baseline for each IP address. Using a statistical method like Inter-Quartile Range (IQR) helps identify what is 'too many' connections for a *specific* host, rather than a universal number. This reduces false positives from normally chatty servers and better highlights anomalous behavior from quiet endpoints.
",Zeek conn.log; Zeek dce_rpc.log; Zeek ldap.log; Network traffic segments in front of Domain Controllers and Exchange/Mail servers,last 90 days,": FOR each source_ip
CALCULATE hourly_connection_baseline (30-day) and IQR
FOR each new hour
IF connection_count > (Q3 + 1.5 * IQR), ALERT
",playbooks/attack/enterprise/T1087.003.yml
T1087.003: Email Account,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,12,Have our clustering algorithms identified any network connections to directory/mail services as outliers that do not conform to normal traffic patterns?,"This question employs a machine learning technique (DBSCAN) to define 'normal' by grouping similar connections into clusters based on features like duration, bytes transferred, and service. Any connection that doesn't fit into a well-defined cluster is flagged as noise or an outlier. This is powerful for detecting novel or unusual enumeration techniques that don't look like any previously seen legitimate or malicious traffic.
",Zeek conn.log; Zeek dce_rpc.log; Zeek ldap.log; Network traffic segments in front of Domain Controllers and Exchange/Mail servers,last 90 days,": APPLY DBSCAN clustering to connection_logs features (bytes, duration, etc.)
PROFILE dense clusters as 'normal'
FLAG connections identified as noise/outliers, ALERT
",playbooks/attack/enterprise/T1087.003.yml
T1087.003: Email Account,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,13,Is a process that is not on our approved software allowlist initiating network connections to directory or mail services?,"This question seeks to identify unauthorized software communicating with sensitive directory and mail infrastructure. By correlating the process that initiates a network connection with a predefined list of approved applications (e.g., Outlook), we can immediately flag any unknown or unapproved executable, such as a custom adversary tool, attempting to perform reconnaissance.
",Windows Event ID 4688; Windows Event ID 5156; Zeek conn.log; User Endpoints; Application Servers; network choke points monitoring traffic to directory/mail servers,last 90 days,": CORRELATE process_creation (EventID=4688) with network_connection (EventID=5156)
IF process_name NOT IN allowlist AND destination_port IN (135, 389, 443, 636), ALERT
",playbooks/attack/enterprise/T1087.003.yml
T1087.003: Email Account,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,14,"Has a statistically rare process initiated a connection to directory or mail services, especially from a user-writable directory?","This question focuses on identifying outlier processes based on their prevalence across the enterprise. A process like `outlook.exe` connecting to Exchange is common; a process named `svchost.exe` from `C:\Users\*` or a randomly named executable doing the same is extremely rare and highly suspicious. Flagging connections from the least common processes provides a powerful heuristic for finding adversary tools.
",Windows Event ID 4688; Windows Event ID 5156; Zeek conn.log; User Endpoints; Application Servers; network choke points monitoring traffic to directory/mail servers,last 90 days,": CALCULATE prevalence of all process_names connecting to DC/Mail servers
IF connecting_process_prevalence is in bottom 1st percentile, ALERT
",playbooks/attack/enterprise/T1087.003.yml
T1087.003: Email Account,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,15,Has our One-Class SVM model classified any process-network connection event as an outlier compared to the baseline of legitimate activity?,"This question uses a machine learning model trained exclusively on 'good' or legitimate process-network connection behavior. The model learns the boundary of normal activity. Any new event that falls outside this boundary is flagged as an anomaly. This is effective for detecting previously unseen enumeration tools or legitimate tools being used in an illegitimate context, without needing prior examples of malicious behavior.
",Windows Event ID 4688; Windows Event ID 5156; Zeek conn.log; User Endpoints; Application Servers; network choke points monitoring traffic to directory/mail servers,last 90 days,": TRAIN One-Class SVM on legitimate process-network_events
SCORE new events in real-time
IF event is classified as outlier, ALERT",playbooks/attack/enterprise/T1087.003.yml
T1087: Account Discovery,f5d8a8a4-3b7c-4c0e-8d1a-9f6b3e2c1d0b,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0007: Discovery,n; o; n; e,1,"Has a known malicious account discovery tool been executed, identified by its file hash or original filename?","This question aims to detect the use of well-known hacking tools like AdFind or SharpHound. By comparing process execution logs against a threat intelligence feed of known malicious file hashes and names, analysts can quickly identify blatant discovery attempts. A match provides high-confidence evidence of malicious intent.","Windows Event ID 4688 from Domain Controllers, Member Servers, Privileged Access Workstations",last 90 days,SEARCH process_creation_events (event_id=4688) WHERE (process_hash IN known_discovery_tool_hashes OR original_filename IN known_discovery_tool_names),playbooks/attack/enterprise/T1087.yml
T1087: Account Discovery,f5d8a8a4-3b7c-4c0e-8d1a-9f6b3e2c1d0b,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0007: Discovery,n; o; n; e,2,Has a statistically rare or never-before-seen process been executed that is not on the corporate allow-list?,"Adversaries may rename common discovery tools to evade name-based detections. This question addresses that by focusing on rarity. It helps analysts find processes that are statistical outliers within the environment. By baselining normal application usage, any process that is exceptionally rare becomes suspicious, potentially indicating a custom or renamed malicious tool.","Windows Event ID 4688 from Domain Controllers, Member Servers, Privileged Access Workstations",last 90 days,SEARCH process_creation_events (event_id=4688) | CALCULATE prevalence of original_filename per host | FILTER prevalence < 0.01% AND original_filename NOT IN (enterprise_app_allowlist),playbooks/attack/enterprise/T1087.yml
T1087: Account Discovery,f5d8a8a4-3b7c-4c0e-8d1a-9f6b3e2c1d0b,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0007: Discovery,n; o; n; e,3,Does a machine learning model classify a new process execution as a malicious discovery activity based on its combined features?,"This question moves beyond single indicators to a more holistic, context-aware detection. By training a model on a variety of features—such as command-line complexity, the process parent, user context, and rarity—analysts can identify suspicious activity that might not trigger simpler rules. This approach is effective at finding novel or obfuscated tools.","Windows Event ID 4688 from Domain Controllers, Member Servers, Privileged Access Workstations",last 90 days,"STREAM process_creation_events (event_id=4688) | SCORE with classification_model (features: cmd_entropy, parent_process, user, rarity) | ALERT if score > high_probability_threshold",playbooks/attack/enterprise/T1087.yml
T1087: Account Discovery,f5d8a8a4-3b7c-4c0e-8d1a-9f6b3e2c1d0b,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0007: Discovery,n; o; n; e,4,"Has a command-line interpreter been used with arguments specific to user, group, or access enumeration?","This question targets the ""living off the land"" technique, where adversaries use built-in system utilities like `net.exe` or `powershell.exe` to perform discovery. By searching for specific command-line patterns (e.g., `net user /domain`, `Get-ADUser`), analysts can pinpoint when these utilities are being leveraged for reconnaissance rather than routine administration.","Windows Event ID 4688 from All Windows Endpoints, Domain Controllers, Application Servers, Cloud Tenant Environments",last 90 days,"SEARCH process_creation_events (event_id=4688) WHERE command_line MATCHES REGEX (`net user`, `net group`, `Get-ADUser`, `az ad user list`)",playbooks/attack/enterprise/T1087.yml
T1087: Account Discovery,f5d8a8a4-3b7c-4c0e-8d1a-9f6b3e2c1d0b,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0007: Discovery,n; o; n; e,5,Is a user or system executing an anomalously high number of enumeration commands compared to their historical baseline?,"While a single enumeration command might be legitimate, a rapid succession of them is highly suspicious. This question helps detect this by establishing a ""normal"" baseline of command usage for each user and host. An alert is triggered when activity exceeds this baseline by a significant margin (e.g., 3 standard deviations), catching attackers who are systematically mapping out the environment.","Windows Event ID 4688 from All Windows Endpoints, Domain Controllers, Application Servers, Cloud Tenant Environments",last 90 days,"SEARCH process_creation_events (event_id=4688) with enumeration_commands | AGGREGATE count by user, host, time_window | ALERT if count > (historical_average + 3 * std_dev)",playbooks/attack/enterprise/T1087.yml
T1087: Account Discovery,f5d8a8a4-3b7c-4c0e-8d1a-9f6b3e2c1d0b,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0007: Discovery,n; o; n; e,6,Has an unsupervised machine learning model identified a command-line execution as a statistical outlier?,"Adversaries often obfuscate commands to bypass simple keyword or regex-based detections. This question uses unsupervised learning (like an Isolation Forest) to find these hidden threats. The model analyzes the structure of command lines, flagging those that are statistically different from the vast majority of legitimate commands, uncovering novel or obfuscated techniques.","Windows Event ID 4688 from All Windows Endpoints, Domain Controllers, Application Servers, Cloud Tenant Environments",last 90 days,"STREAM process_creation_events (event_id=4688) | VECTORIZE command_line (e.g., TF-IDF) | SCORE with anomaly_detection_model (e.g., Isolation Forest) | ALERT if command is outlier",playbooks/attack/enterprise/T1087.yml
T1087: Account Discovery,f5d8a8a4-3b7c-4c0e-8d1a-9f6b3e2c1d0b,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0007: Discovery,n; o; n; e,7,"Has a command-line interpreter (like cmd.exe or powershell.exe) been launched by an unusual parent process, such as an Office application or web browser?","This question targets a common sign of compromise from phishing or web-based exploits. Legitimate administrative activity rarely involves launching a command prompt from within Microsoft Word. Detecting these high-risk parent-child process relationships (e.g., `WINWORD.EXE` -> `powershell.exe`) provides a high-fidelity signal of malicious code execution.","Windows Event ID 4688 from User Workstations, Web Servers, Microsoft Exchange Servers, Virtual Desktop Infrastructure (VDI)",last 90 days,"SEARCH process_creation_events (event_id=4688) WHERE parent_process IN (`WINWORD.EXE`, `chrome.exe`, `w3wp.exe`) AND child_process IN (`cmd.exe`, `powershell.exe`)",playbooks/attack/enterprise/T1087.yml
T1087: Account Discovery,f5d8a8a4-3b7c-4c0e-8d1a-9f6b3e2c1d0b,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0007: Discovery,n; o; n; e,8,Has a parent-child process relationship occurred that is statistically rare across the entire enterprise?,"This question expands on the previous one by using data-driven analysis instead of a manually curated list of ""bad"" parents. By profiling all parent-child process relationships, a probability can be assigned to each pair. Any new process creation that represents an extremely low-probability pairing is flagged as suspicious, uncovering novel attack chains.","Windows Event ID 4688 from User Workstations, Web Servers, Microsoft Exchange Servers, Virtual Desktop Infrastructure (VDI)",last 90 days,SEARCH process_creation_events (event_id=4688) | CALCULATE conditional_probability(child|parent) for all pairs | ALERT if new event has probability < 0.001%,playbooks/attack/enterprise/T1087.yml
T1087: Account Discovery,f5d8a8a4-3b7c-4c0e-8d1a-9f6b3e2c1d0b,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0007: Discovery,n; o; n; e,9,Did a user's session contain a sequence of process creations that a machine learning model deems anomalous?,"Attacks often unfold as a sequence of actions. This question uses a model (like an LSTM Autoencoder) to learn what ""normal"" sequences of process creations look like. It can then spot deviations from this norm, such as a sequence like `OUTLOOK.EXE` -> `powershell.exe` -> `net.exe`, which breaks from typical user behavior.","Windows Event ID 4688 from User Workstations, Web Servers, Microsoft Exchange Servers, Virtual Desktop Infrastructure (VDI)",last 90 days,GROUP process_creation_events by user_session | MODEL sequence with LSTM_Autoencoder | ALERT if reconstruction_error > threshold,playbooks/attack/enterprise/T1087.yml
T1087: Account Discovery,f5d8a8a4-3b7c-4c0e-8d1a-9f6b3e2c1d0b,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0007: Discovery,n; o; n; e,10,"Have specific, high-risk directory service enumeration operations (like SAMR EnumDomainUsers) been observed on the network?",This question focuses on detecting discovery at the network level by monitoring protocols like SAMR and Kerberos. Certain RPC calls (`EnumDomainUsers`) and Kerberos errors (from Kerberoasting) are almost exclusively used for malicious reconnaissance. Alerting on these provides a strong indication that an attacker is mapping Active Directory.,"Zeek conn.log, Zeek ldap.log, Zeek dce_rpc.log, Zeek kerberos.log, Windows Event ID 4662 from Network segments fronting Domain Controllers, The Domain Controllers themselves",last 90 days,"SEARCH dce_rpc_logs WHERE endpoint=`samr` AND operation IN (`EnumDomainUsers`, `QueryDisplayInfo`) OR SEARCH kerberos_logs WHERE error_code=`KDC_ERR_S_PRINCIPAL_UNKNOWN`",playbooks/attack/enterprise/T1087.yml
T1087: Account Discovery,f5d8a8a4-3b7c-4c0e-8d1a-9f6b3e2c1d0b,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0007: Discovery,n; o; n; e,11,Has a host sent an unusually high volume or variety of LDAP queries to a domain controller?,"Tools like BloodHound generate a large volume of diverse LDAP queries. This question detects this behavior statistically. By baselining the normal volume and measuring the ""randomness"" (entropy) of LDAP filters from each host, analysts can spot sudden spikes and broad, non-standard queries that indicate enumeration.","Zeek conn.log, Zeek ldap.log, Zeek dce_rpc.log, Zeek kerberos.log, Windows Event ID 4662 from Network segments fronting Domain Controllers, The Domain Controllers themselves",last 90 days,SEARCH ldap_logs | CALCULATE requests_per_10min and filter_entropy by source_ip | ALERT if requests > 95th_percentile OR entropy shows spike,playbooks/attack/enterprise/T1087.yml
T1087: Account Discovery,f5d8a8a4-3b7c-4c0e-8d1a-9f6b3e2c1d0b,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0007: Discovery,n; o; n; e,12,Is a host's directory service query behavior anomalous compared to its functionally similar peers?,"This question enhances anomaly detection with peer group analysis. Systems with similar roles should have similar network behavior. By clustering hosts into peer groups, a model can build a more accurate baseline. An alert is triggered if one host starts behaving differently from its peers, indicating a potential compromise.","Zeek conn.log, Zeek ldap.log, Zeek dce_rpc.log, Zeek kerberos.log, Windows Event ID 4662 from Network segments fronting Domain Controllers, The Domain Controllers themselves",last 90 days,"CLUSTER hosts into peer_groups based on network_traffic | For each host, MODEL query_volume with time_series_forecast | ALERT if actual_volume deviates significantly from peer_group_forecast",playbooks/attack/enterprise/T1087.yml
T1087: Account Discovery,f5d8a8a4-3b7c-4c0e-8d1a-9f6b3e2c1d0b,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0007: Discovery,n; o; n; e,13,"Has any activity been detected involving a decoy user account, file, or other honeytoken?","This question represents a high-fidelity detection method. Honeytokens are decoy assets (like a fake user account) that have no legitimate reason to be accessed. By placing these traps and enabling auditing, any access attempt becomes an immediate, high-priority alert, as it almost certainly indicates an adversary is snooping.","Windows Event ID 4663, Windows Event ID 5145, Windows Event ID 4720 from File Servers, SharePoint Sites, Network-accessible Script Repositories, Domain Controllers",last 90 days,"SEARCH audit_logs WHERE target_object IN (decoy_file_list, decoy_user_list) | ALERT on any access",playbooks/attack/enterprise/T1087.yml
T1087: Account Discovery,f5d8a8a4-3b7c-4c0e-8d1a-9f6b3e2c1d0b,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0007: Discovery,n; o; n; e,14,Has a single user or process accessed an anomalously high number of unique user home directories or profile folders in a short period?,"Adversaries often iterate through user directories on file servers to find data. This behavior is distinct from normal activity. This question establishes a baseline for how many unique user directories are normally accessed per hour. An alert is triggered when this number is significantly exceeded, suggesting automated enumeration.","Windows Event ID 4663, Windows Event ID 5145, Windows Event ID 4720 from File Servers, SharePoint Sites, Network-accessible Script Repositories, Domain Controllers",last 90 days,"SEARCH file_access_logs (event_id=4663/5145) | AGGREGATE count of unique_user_directories_accessed by user, process, per_hour | ALERT if count > (historical_average + 3 * std_dev)",playbooks/attack/enterprise/T1087.yml
T1087: Account Discovery,f5d8a8a4-3b7c-4c0e-8d1a-9f6b3e2c1d0b,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0007: Discovery,n; o; n; e,15,Does a machine learning model classify a sequence of file access events as anomalous?,"This question uses machine learning to find subtle signs of discovery within file access logs. By training a model on features of ""normal"" file access, it can identify outlier events that do not fit the pattern. This can catch sophisticated attackers who try to ""blend in"" by accessing data slowly, an activity that might be missed by simple threshold-based alerts.","Windows Event ID 4663, Windows Event ID 5145, Windows Event ID 4720 from File Servers, SharePoint Sites, Network-accessible Script Repositories, Domain Controllers",last 90 days,"STREAM file_access_logs (event_id=4663/5145) | SCORE with One-Class_SVM_model (features: process, user, path_entropy) | ALERT if event is outlier",playbooks/attack/enterprise/T1087.yml
T1090.002: External Proxy,d3b1b3b0-5b9a-4e3a-8f7b-9c7d1e2f3a4b,technique,2025-10-01,2025-10-01,Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k,T; A; 0; 0; 1; 1; :;  ; C; o; m; m; a; n; d;  ; a; n; d;  ; C; o; n; t; r; o; l,n; o; n; e,1,"Are any outbound network connections matching known malicious proxy, VPN, or TOR node indicators from our threat intelligence feeds?","This question aims to identify direct connections to known malicious infrastructure. Adversaries often use publicly known or compromised proxy, VPN, or Tor services to hide their true origin. By continuously comparing outbound destination IPs and DNS queries against a threat intelligence feed, we can detect these attempts in real-time. A match provides a high-fidelity signal that an internal host is communicating with a potentially malicious anonymization service, which is a common C2 tactic.","Z; e; e; k;  ; c; o; n; n; .; l; o; g; ,;  ; Z; e; e; k;  ; d; n; s; .; l; o; g; ,;  ; E; g; r; e; s; s;  ; N; e; t; w; o; r; k;  ; G; a; t; e; w; a; y; s;  ; a; n; d;  ; C; o; r; p; o; r; a; t; e;  ; D; N; S;  ; R; e; s; o; l; v; e; r; s",last 90 days,: JOIN (SELECT dest_ip FROM zeek_conn_logs) WITH (SELECT indicator FROM threat_intel_feed) ON dest_ip = indicator; JOIN (SELECT domain FROM zeek_dns_logs) WITH (SELECT indicator FROM threat_intel_feed) ON domain = indicator; ALERT on match.,playbooks/attack/enterprise/T1090.002.yml
T1090.002: External Proxy,d3b1b3b0-5b9a-4e3a-8f7b-9c7d1e2f3a4b,technique,2025-10-01,2025-10-01,Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k,T; A; 0; 0; 1; 1; :;  ; C; o; m; m; a; n; d;  ; a; n; d;  ; C; o; n; t; r; o; l,n; o; n; e,2,Has any external destination Autonomous System Number (ASN) experienced a sudden and significant spike in the number of unique internal hosts connecting to it?,"This question seeks to uncover new or previously unknown proxy services by looking for behavioral anomalies. A legitimate service typically has a stable user base. If a large, anomalous number of internal hosts suddenly start connecting to the same, previously unpopular ASN, it could indicate that adversaries have set up a new proxy service within that network block and are directing compromised hosts to it. This statistical approach helps detect services not yet present in threat intelligence feeds.","Z; e; e; k;  ; c; o; n; n; .; l; o; g; ,;  ; Z; e; e; k;  ; d; n; s; .; l; o; g; ,;  ; E; g; r; e; s; s;  ; N; e; t; w; o; r; k;  ; G; a; t; e; w; a; y; s;  ; a; n; d;  ; C; o; r; p; o; r; a; t; e;  ; D; N; S;  ; R; e; s; o; l; v; e; r; s",last 90 days,": FOR each destination_asn: BASELINE = COUNT(unique source_host) over last 30 days. CURRENT = COUNT(unique source_host) today. IF CURRENT > (3 * STDEV(BASELINE)) OR CURRENT > 99th_PERCENTILE(BASELINE), ALERT on destination_asn.",playbooks/attack/enterprise/T1090.002.yml
T1090.002: External Proxy,d3b1b3b0-5b9a-4e3a-8f7b-9c7d1e2f3a4b,technique,2025-10-01,2025-10-01,Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k,T; A; 0; 0; 1; 1; :;  ; C; o; m; m; a; n; d;  ; a; n; d;  ; C; o; n; t; r; o; l,n; o; n; e,3,Can we identify outbound connections that exhibit characteristics of proxy-like behavior using a machine learning model?,"This question uses a machine learning classifier to identify subtle patterns in network traffic that are indicative of proxy usage, even for unknown services. By training a model on features like connection duration, data volume, protocol, and DNS query characteristics, we can score new connections for their likelihood of being proxy-related. This helps catch sophisticated adversaries using custom or encrypted tunneling methods that evade simpler signature-based and statistical checks.","Z; e; e; k;  ; c; o; n; n; .; l; o; g; ,;  ; Z; e; e; k;  ; d; n; s; .; l; o; g; ,;  ; E; g; r; e; s; s;  ; N; e; t; w; o; r; k;  ; G; a; t; e; w; a; y; s;  ; a; n; d;  ; C; o; r; p; o; r; a; t; e;  ; D; N; S;  ; R; e; s; o; l; v; e; r; s",last 90 days,": FEATURES = extract(duration, bytes_sent, bytes_received, protocol, dest_port, dns_ttl, dns_query_length) from conn_logs and dns_logs. MODEL = train_classifier(labeled_data). FOR each new_connection: SCORE = MODEL.predict_proba(features). IF SCORE > threshold, ALERT on connection.",playbooks/attack/enterprise/T1090.002.yml
T1090.002: External Proxy,d3b1b3b0-5b9a-4e3a-8f7b-9c7d1e2f3a4b,technique,2025-10-01,2025-10-01,Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k,T; A; 0; 0; 1; 1; :;  ; C; o; m; m; a; n; d;  ; a; n; d;  ; C; o; n; t; r; o; l,n; o; n; e,4,Are processes being created that match known proxy or tunneling tool names or file hashes?,"This question looks for the most direct evidence of proxy tool usage: the execution of the tool itself. By comparing the names and file hashes of all newly created processes against a curated list of known tools (e.g., ngrok, chisel), analysts can quickly identify blatant attempts to establish external proxies. An alert from this check is a high-confidence indicator of malicious activity.","W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 6; 8; 8; ,;  ; S; y; s; m; o; n;  ; E; v; e; n; t;  ; I; D;  ; 1; ,;  ; A; l; l;  ; E; n; d; p; o; i; n; t; s;  ; a; n; d;  ; S; e; r; v; e; r; s",last 90 days,: SEARCH process_creation_logs WHERE process_name IN (known_proxy_tools_list) OR process_hash IN (known_proxy_hashes_list). ALERT on match.,playbooks/attack/enterprise/T1090.002.yml
T1090.002: External Proxy,d3b1b3b0-5b9a-4e3a-8f7b-9c7d1e2f3a4b,technique,2025-10-01,2025-10-01,Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k,T; A; 0; 0; 1; 1; :;  ; C; o; m; m; a; n; d;  ; a; n; d;  ; C; o; n; t; r; o; l,n; o; n; e,5,Are any rare or uncommon processes being executed across the enterprise that could be custom proxy tools?,"Adversaries may use custom-compiled or renamed proxy tools to evade signature-based detection. This question helps find these tools by identifying statistical outliers. A process that runs on only a handful of machines (or just one) is inherently more suspicious than common software. By flagging processes with very low enterprise-wide prevalence, analysts can focus on potentially unauthorized or malicious software that could be used for proxying.","W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 6; 8; 8; ,;  ; S; y; s; m; o; n;  ; E; v; e; n; t;  ; I; D;  ; 1; ,;  ; A; l; l;  ; E; n; d; p; o; i; n; t; s;  ; a; n; d;  ; S; e; r; v; e; r; s",last 90 days,": FOR each process_name: PREVALENCE = COUNT(unique hosts executing process) / COUNT(total hosts) over 30 days. IF PREVALENCE < 0.001, ALERT on process_name.",playbooks/attack/enterprise/T1090.002.yml
T1090.002: External Proxy,d3b1b3b0-5b9a-4e3a-8f7b-9c7d1e2f3a4b,technique,2025-10-01,2025-10-01,Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k,T; A; 0; 0; 1; 1; :;  ; C; o; m; m; a; n; d;  ; a; n; d;  ; C; o; n; t; r; o; l,n; o; n; e,6,Are there any anomalously executed processes that might be unknown proxy tools?,"This question uses machine learning to find unknown proxy tools by focusing on the context of their execution, rather than just the name. An anomaly detection model can learn what normal process behavior looks like based on features like the parent process, file path, and whether the file is signed. Executions that deviate significantly from this learned baseline are flagged as anomalous, providing a powerful way to uncover novel or heavily obfuscated malware.","W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 6; 8; 8; ,;  ; S; y; s; m; o; n;  ; E; v; e; n; t;  ; I; D;  ; 1; ,;  ; A; l; l;  ; E; n; d; p; o; i; n; t; s;  ; a; n; d;  ; S; e; r; v; e; r; s",last 90 days,": FEATURES = extract(process_name_entropy, parent_process, file_path_depth, is_signed) from process_logs. MODEL = train_anomaly_detector(baseline_data). FOR each new_process: SCORE = MODEL.predict(features). IF SCORE is ""anomaly"", ALERT on process.",playbooks/attack/enterprise/T1090.002.yml
T1090.002: External Proxy,d3b1b3b0-5b9a-4e3a-8f7b-9c7d1e2f3a4b,technique,2025-10-01,2025-10-01,Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k,T; A; 0; 0; 1; 1; :;  ; C; o; m; m; a; n; d;  ; a; n; d;  ; C; o; n; t; r; o; l,n; o; n; e,7,Are processes being launched with command-line arguments characteristic of establishing a network proxy or tunnel?,"Proxy and tunneling tools require specific command-line arguments to configure their operation (e.g., specifying a port to listen on or a remote server to connect to). This question involves scanning process command lines for these tell-tale switches, keywords, and syntax patterns. A match is a strong indicator that a process, regardless of its name, is being used to create a network tunnel.","W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 6; 8; 8; ,;  ; S; y; s; m; o; n;  ; E; v; e; n; t;  ; I; D;  ; 1; ,;  ; A; l; l;  ; E; n; d; p; o; i; n; t; s;  ; a; n; d;  ; S; e; r; v; e; r; s",last 90 days,": SEARCH process_creation_logs FOR command_line MATCHES regex_patterns(""-proxy"", ""-listen"", ""-R:[0-9]:"", etc.). ALERT on match.",playbooks/attack/enterprise/T1090.002.yml
T1090.002: External Proxy,d3b1b3b0-5b9a-4e3a-8f7b-9c7d1e2f3a4b,technique,2025-10-01,2025-10-01,Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k,T; A; 0; 0; 1; 1; :;  ; C; o; m; m; a; n; d;  ; a; n; d;  ; C; o; n; t; r; o; l,n; o; n; e,8,Are any processes being executed with unusually high-entropy command-line arguments?,"To evade detection, adversaries may obfuscate or encode the command-line arguments passed to their tools. This often results in command lines with high character-level entropy (i.e., they appear more random). This question establishes a baseline for the normal command-line entropy of common processes and flags executions that significantly exceed it. This can reveal the use of packers, obfuscated scripts, or encoded payloads used to configure a proxy tool.","W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 6; 8; 8; ,;  ; S; y; s; m; o; n;  ; E; v; e; n; t;  ; I; D;  ; 1; ,;  ; A; l; l;  ; E; n; d; p; o; i; n; t; s;  ; a; n; d;  ; S; e; r; v; e; r; s",last 90 days,": FOR each process_name: BASELINE_ENTROPY = calculate_historical_entropy(command_lines). FOR each new_execution: CURRENT_ENTROPY = calculate_entropy(command_line). IF CURRENT_ENTROPY > 98th_PERCENTILE(BASELINE_ENTROPY), ALERT on execution.",playbooks/attack/enterprise/T1090.002.yml
T1090.002: External Proxy,d3b1b3b0-5b9a-4e3a-8f7b-9c7d1e2f3a4b,technique,2025-10-01,2025-10-01,Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k,T; A; 0; 0; 1; 1; :;  ; C; o; m; m; a; n; d;  ; a; n; d;  ; C; o; n; t; r; o; l,n; o; n; e,9,Are any process command lines being classified into suspicious topics related to networking or remote access?,"This question applies Natural Language Processing (NLP) to discover suspicious activity. By treating the entire corpus of command-line arguments as a text document, topic modeling algorithms like LDA can identify clusters of related terms. Analysts can then examine these topics to find ones related to networking, proxying, and remote access. New process executions whose command lines fit these suspicious topics can then be flagged for review, even if they dont use specific known keywords.","W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 6; 8; 8; ,;  ; S; y; s; m; o; n;  ; E; v; e; n; t;  ; I; D;  ; 1; ,;  ; A; l; l;  ; E; n; d; p; o; i; n; t; s;  ; a; n; d;  ; S; e; r; v; e; r; s",last 90 days,": CORPUS = all_command_lines_from_logs. TOPICS = lda_model(CORPUS). IDENTIFY ""suspicious_topics"". FOR each new_process: IF command_line has high_probability for ""suspicious_topics"", ALERT on process.",playbooks/attack/enterprise/T1090.002.yml
T1090.002: External Proxy,d3b1b3b0-5b9a-4e3a-8f7b-9c7d1e2f3a4b,technique,2025-10-01,2025-10-01,Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k,T; A; 0; 0; 1; 1; :;  ; C; o; m; m; a; n; d;  ; a; n; d;  ; C; o; n; t; r; o; l,n; o; n; e,10,Are we observing any outbound SSL/TLS connections with JA3/JA3S hashes matching known malicious or proxying tools?,"The way a client or server initiates an SSL/TLS session creates a fingerprint (JA3/JA3S hash) that can be unique to the application generating the traffic. This question involves matching these fingerprints against a threat intelligence feed of hashes known to be associated with C2 frameworks and proxy tools. This allows for the detection of specific malicious tools, even when their traffic is encrypted and destined for an unknown IP.","Z; e; e; k;  ; s; s; l; .; l; o; g; ,;  ; Z; e; e; k;  ; x; 5; 0; 9; .; l; o; g; ,;  ; E; g; r; e; s; s;  ; N; e; t; w; o; r; k;  ; G; a; t; e; w; a; y; s",last 90 days,: SEARCH ssl_logs WHERE ja3_hash IN (known_malicious_ja3_list) OR ja3s_hash IN (known_malicious_ja3s_list). ALERT on match.,playbooks/attack/enterprise/T1090.002.yml
T1090.002: External Proxy,d3b1b3b0-5b9a-4e3a-8f7b-9c7d1e2f3a4b,technique,2025-10-01,2025-10-01,Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k,T; A; 0; 0; 1; 1; :;  ; C; o; m; m; a; n; d;  ; a; n; d;  ; C; o; n; t; r; o; l,n; o; n; e,11,Are there any new or very rare JA3/JA3S hashes appearing in the environment?,"Beyond looking for known-bad fingerprints, this question seeks to identify unknown or custom tools by finding new and rare JA3/JA3S hashes. Most legitimate applications in an enterprise generate a predictable set of common fingerprints. A hash that is new to the environment or seen from a very small number of hosts is statistically anomalous and warrants investigation, as it could represent a new C2 tool or proxy client.","Z; e; e; k;  ; s; s; l; .; l; o; g; ,;  ; Z; e; e; k;  ; x; 5; 0; 9; .; l; o; g; ,;  ; E; g; r; e; s; s;  ; N; e; t; w; o; r; k;  ; G; a; t; e; w; a; y; s",last 90 days,": BASELINE_HASHES = get_all_ja3_hashes from last 30 days. FOR each new_connection: IF ja3_hash is not in BASELINE_HASHES, ALERT on connection. CALCULATE prevalence for all hashes; IF prevalence < 0.0005, ALERT on hash.",playbooks/attack/enterprise/T1090.002.yml
T1090.002: External Proxy,d3b1b3b0-5b9a-4e3a-8f7b-9c7d1e2f3a4b,technique,2025-10-01,2025-10-01,Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k,T; A; 0; 0; 1; 1; :;  ; C; o; m; m; a; n; d;  ; a; n; d;  ; C; o; n; t; r; o; l,n; o; n; e,12,Can we identify clusters of suspicious SSL/TLS sessions that do not conform to known-good traffic patterns?,"This question uses unsupervised machine learning to find groups of suspicious connections without relying on predefined signatures. By clustering SSL/TLS sessions based on a combination of features—such as the JA3 hash, cipher suites used, certificate details, and SNI—the model can group similar traffic together. Analysts can then investigate these clusters to find groups of connections that look different from typical benign traffic, potentially revealing a coordinated C2 channel using a custom proxy tool.","Z; e; e; k;  ; s; s; l; .; l; o; g; ,;  ; Z; e; e; k;  ; x; 5; 0; 9; .; l; o; g; ,;  ; E; g; r; e; s; s;  ; N; e; t; w; o; r; k;  ; G; a; t; e; w; a; y; s",last 90 days,": FEATURES = extract(ja3, ciphers, cert_issuer, cert_validity, sni) from ssl_logs. CLUSTERS = dbscan(FEATURES). ANALYZE clusters for outliers or groups with suspicious characteristics (e.g., self-signed certs, unusual ciphers). ALERT on suspicious clusters.",playbooks/attack/enterprise/T1090.002.yml
T1090.002: External Proxy,d3b1b3b0-5b9a-4e3a-8f7b-9c7d1e2f3a4b,technique,2025-10-01,2025-10-01,Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k,T; A; 0; 0; 1; 1; :;  ; C; o; m; m; a; n; d;  ; a; n; d;  ; C; o; n; t; r; o; l,n; o; n; e,13,Is any process not on our explicit network allowlist initiating an outbound connection?,"This question is based on a principle of least privilege for network access. In a well-managed environment, only a specific set of applications (like web browsers and email clients) should be making outbound network connections. By creating an allowlist of these expected processes and alerting on any connection from a process not on the list, analysts can quickly spot unauthorized software, scripts, or living-off-the-land binaries being used to communicate externally.","W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 6; 8; 8; ,;  ; S; y; s; m; o; n;  ; E; v; e; n; t;  ; I; D;  ; 3; ,;  ; Z; e; e; k;  ; c; o; n; n; .; l; o; g; ,;  ; A; l; l;  ; E; n; d; p; o; i; n; t; s;  ; a; n; d;  ; S; e; r; v; e; r; s; ,;  ; E; g; r; e; s; s;  ; N; e; t; w; o; r; k;  ; G; a; t; e; w; a; y; s",last 90 days,": CORRELATE process_creation_logs with network_connection_logs. IF network_connection.process_name is NOT IN (network_allowlist), ALERT on connection.",playbooks/attack/enterprise/T1090.002.yml
T1090.002: External Proxy,d3b1b3b0-5b9a-4e3a-8f7b-9c7d1e2f3a4b,technique,2025-10-01,2025-10-01,Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k,T; A; 0; 0; 1; 1; :;  ; C; o; m; m; a; n; d;  ; a; n; d;  ; C; o; n; t; r; o; l,n; o; n; e,14,"Is any process exhibiting anomalous network behavior, such as connecting to new ports or ASNs for the first time?","Even legitimate processes tend to have predictable network behavior. For example, an Outlook client typically connects to a known set of Microsoft ASNs on standard email ports. This question establishes a behavioral baseline for each process, tracking the destination ports and ASNs it normally communicates with. An alert is generated if a process suddenly connects to a port or ASN it has never been seen contacting before, which could indicate that the process has been hijacked or is being used for proxying.","W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 6; 8; 8; ,;  ; S; y; s; m; o; n;  ; E; v; e; n; t;  ; I; D;  ; 3; ,;  ; Z; e; e; k;  ; c; o; n; n; .; l; o; g; ,;  ; A; l; l;  ; E; n; d; p; o; i; n; t; s;  ; a; n; d;  ; S; e; r; v; e; r; s; ,;  ; E; g; r; e; s; s;  ; N; e; t; w; o; r; k;  ; G; a; t; e; w; a; y; s",last 90 days,": FOR each process_name: BASELINE_PORTS = historical_dest_ports over 30 days. BASELINE_ASNS = historical_dest_asns over 30 days. FOR each new_connection: IF dest_port not in BASELINE_PORTS OR dest_asn not in BASELINE_ASNS, ALERT on connection.",playbooks/attack/enterprise/T1090.002.yml
T1090.002: External Proxy,d3b1b3b0-5b9a-4e3a-8f7b-9c7d1e2f3a4b,technique,2025-10-01,2025-10-01,Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k,T; A; 0; 0; 1; 1; :;  ; C; o; m; m; a; n; d;  ; a; n; d;  ; C; o; n; t; r; o; l,n; o; n; e,15,"Are any processes classified as ""suspicious"" based on their execution context also making network connections?","This question combines two different signals for a higher-fidelity alert. It first uses a machine learning model to classify process executions as benign or suspicious based on context like file path and parent process. It then correlates this information with network connection data. A process that is already deemed suspicious and then also makes a network connection is a much stronger indicator of malicious activity than either signal alone, helping to prioritize alerts for analysts.","W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 6; 8; 8; ,;  ; S; y; s; m; o; n;  ; E; v; e; n; t;  ; I; D;  ; 3; ,;  ; Z; e; e; k;  ; c; o; n; n; .; l; o; g; ,;  ; A; l; l;  ; E; n; d; p; o; i; n; t; s;  ; a; n; d;  ; S; e; r; v; e; r; s; ,;  ; E; g; r; e; s; s;  ; N; e; t; w; o; r; k;  ; G; a; t; e; w; a; y; s",last 90 days,": MODEL = train_classifier on process execution features. FOR each new_process: IF MODEL.predict(process) is ""suspicious"" AND process makes_network_connection, ALERT on process.",playbooks/attack/enterprise/T1090.002.yml
T1090.002: External Proxy,d3b1b3b0-5b9a-4e3a-8f7b-9c7d1e2f3a4b,technique,2025-10-01,2025-10-01,Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k,T; A; 0; 0; 1; 1; :;  ; C; o; m; m; a; n; d;  ; a; n; d;  ; C; o; n; t; r; o; l,n; o; n; e,16,Are there any indications of protocol tunneling or evasion in weird network logs?,"This question leverages the built-in analysis of network sensors like Zeek, which are designed to spot protocol anomalies. Zeek's ""weird.log"" specifically flags unusual traffic that violates protocol standards, such as finding non-SSL traffic on port 443 (ssl_not_ssl) or other signs of tunneling. Reviewing these logs provides a direct, signature-based method for identifying attempts to hide a protocol within another.","Z; e; e; k;  ; c; o; n; n; .; l; o; g; ,;  ; Z; e; e; k;  ; w; e; i; r; d; .; l; o; g; ,;  ; E; g; r; e; s; s;  ; N; e; t; w; o; r; k;  ; G; a; t; e; w; a; y; s",last 90 days,": SEARCH weird_logs for notices like ""ssl_not_ssl"", ""possible_split_routing"", ""http_on_unusual_port"". CORRELATE with conn_logs to identify hosts and ALERT.",playbooks/attack/enterprise/T1090.002.yml
T1090.002: External Proxy,d3b1b3b0-5b9a-4e3a-8f7b-9c7d1e2f3a4b,technique,2025-10-01,2025-10-01,Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k,T; A; 0; 0; 1; 1; :;  ; C; o; m; m; a; n; d;  ; a; n; d;  ; C; o; n; t; r; o; l,n; o; n; e,17,Are we observing connections with highly periodic beaconing behavior or extremely skewed data transfer ratios?,"Command and control traffic often has distinct statistical properties. C2 beacons tend to be highly periodic (e.g., a connection every 60 seconds, with very little jitter), which can be detected by measuring the standard deviation of inter-arrival times. Furthermore, some proxy channels may involve sending small commands and receiving larger outputs, or vice-versa, leading to a skewed ratio of bytes sent to received. This question looks for these statistical outliers in flow data to find potential C2 channels.","Z; e; e; k;  ; c; o; n; n; .; l; o; g; ,;  ; Z; e; e; k;  ; w; e; i; r; d; .; l; o; g; ,;  ; E; g; r; e; s; s;  ; N; e; t; w; o; r; k;  ; G; a; t; e; w; a; y; s",last 90 days,": FOR each source-dest pair: CALCULATE STDEV of inter-connection times. IF STDEV is near zero, ALERT. CALCULATE ratio of bytes_sent/bytes_received. IF ratio > 10 or < 0.1, ALERT.",playbooks/attack/enterprise/T1090.002.yml
T1090.002: External Proxy,d3b1b3b0-5b9a-4e3a-8f7b-9c7d1e2f3a4b,technique,2025-10-01,2025-10-01,Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k,T; A; 0; 0; 1; 1; :;  ; C; o; m; m; a; n; d;  ; a; n; d;  ; C; o; n; t; r; o; l,n; o; n; e,18,Are any hosts exhibiting anomalous changes in their overall network traffic volume patterns over time?,"This question applies time-series analysis to a host's overall network traffic to find deviations from normal behavior. A host typically has a predictable daily and weekly traffic pattern (seasonality). A sudden, sustained increase in data being sent or received that breaks from this established pattern could indicate a large data exfiltration event or the active use of a C2 proxy channel. Anomaly detection algorithms can automatically flag these deviations for review.","Z; e; e; k;  ; c; o; n; n; .; l; o; g; ,;  ; Z; e; e; k;  ; w; e; i; r; d; .; l; o; g; ,;  ; E; g; r; e; s; s;  ; N; e; t; w; o; r; k;  ; G; a; t; e; w; a; y; s",last 90 days,": FOR each host: MODEL = train_timeseries_model (e.g., Prophet) on historical traffic volume. PREDICT expected traffic for current period. IF actual_traffic significantly deviates from prediction, ALERT on host.",playbooks/attack/enterprise/T1090.002.yml
T1090.002: External Proxy,d3b1b3b0-5b9a-4e3a-8f7b-9c7d1e2f3a4b,technique,2025-10-01,2025-10-01,Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k,T; A; 0; 0; 1; 1; :;  ; C; o; m; m; a; n; d;  ; a; n; d;  ; C; o; n; t; r; o; l,n; o; n; e,19,"Are any user endpoints making direct connections on ports 80 or 443 to external IPs, bypassing the corporate web proxy?","In many corporate environments, all web traffic from user endpoints is required to go through a designated web proxy for security inspection and policy enforcement. A direct connection from a user machine to an external IP on port 80 or 443 is a policy violation and a potential security risk. This question creates a simple rule to detect these bypass attempts, which could be an adversary trying to establish a C2 channel that avoids security controls.","Z; e; e; k;  ; c; o; n; n; .; l; o; g; ,;  ; U; s; e; r;  ; E; n; d; p; o; i; n; t;  ; S; u; b; n; e; t; s; ,;  ; E; g; r; e; s; s;  ; N; e; t; w; o; r; k;  ; G; a; t; e; w; a; y; s; ,;  ; D; N; S;  ; R; e; s; o; l; v; e; r; s",last 90 days,": SEARCH network_logs WHERE source_ip is in user_subnets AND dest_port in (80, 443) AND dest_ip is NOT in corporate_proxy_ips. ALERT on connection.",playbooks/attack/enterprise/T1090.002.yml
T1090.002: External Proxy,d3b1b3b0-5b9a-4e3a-8f7b-9c7d1e2f3a4b,technique,2025-10-01,2025-10-01,Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k,T; A; 0; 0; 1; 1; :;  ; C; o; m; m; a; n; d;  ; a; n; d;  ; C; o; n; t; r; o; l,n; o; n; e,20,"Is any host showing a significant increase in direct connections to public cloud, hosting, or VPN provider ASNs?","While some direct connections to cloud providers are normal, adversaries often leverage these same providers to host their C2 infrastructure. This question establishes a baseline for each host's normal connection activity to ASNs known to belong to cloud, hosting, or VPN providers. A host that suddenly starts making significantly more connections to these ASNs than its historical average may be communicating with a newly established C2 proxy.","Z; e; e; k;  ; c; o; n; n; .; l; o; g; ,;  ; U; s; e; r;  ; E; n; d; p; o; i; n; t;  ; S; u; b; n; e; t; s; ,;  ; E; g; r; e; s; s;  ; N; e; t; w; o; r; k;  ; G; a; t; e; w; a; y; s; ,;  ; D; N; S;  ; R; e; s; o; l; v; e; r; s",last 90 days,": FOR each host: BASELINE = daily_connection_count to cloud_ASNs over 30 days. CURRENT = today's_connection_count to cloud_ASNs. IF CURRENT > (3 * STDEV(BASELINE)), ALERT on host.",playbooks/attack/enterprise/T1090.002.yml
T1090.002: External Proxy,d3b1b3b0-5b9a-4e3a-8f7b-9c7d1e2f3a4b,technique,2025-10-01,2025-10-01,Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k,T; A; 0; 0; 1; 1; :;  ; C; o; m; m; a; n; d;  ; a; n; d;  ; C; o; n; t; r; o; l,n; o; n; e,21,"Can we detect small communities of internal hosts all connecting to the same, non-mainstream external IP address?","This question uses graph analysis to find evidence of shared C2 infrastructure. By building a graph of connections between internal hosts and external IPs, community detection algorithms can find tightly-knit groups. A small cluster of internal hosts that are all communicating with the same, otherwise unpopular external IP is highly suspicious. This pattern often represents a group of compromised machines all reporting to the same C2 controller or proxy, and this method can uncover it without any prior signatures.","Z; e; e; k;  ; c; o; n; n; .; l; o; g; ,;  ; U; s; e; r;  ; E; n; d; p; o; i; n; t;  ; S; u; b; n; e; t; s; ,;  ; E; g; r; e; s; s;  ; N; e; t; w; o; r; k;  ; G; a; t; e; w; a; y; s; ,;  ; D; N; S;  ; R; e; s; o; l; v; e; r; s",last 90 days,": GRAPH = create_graph(nodes=all_ips, edges=all_connections). COMMUNITIES = find_communities(GRAPH). FOR each community: IF community contains multiple internal_hosts and one external_ip, ALERT on community.",playbooks/attack/enterprise/T1090.002.yml
T1092: Communication Through Removable Media,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,1,Are files being written to removable media that match known-bad indicators from threat intelligence?,"This question aims to detect the most direct evidence of C2 via removable media by identifying files with filenames or hashes that are explicitly listed in threat intelligence feeds as being associated with such activity. For example, some C2 frameworks use specific staging filenames like 'tasks.dat'. Matching against these known indicators provides a high-confidence signal that an adversary is attempting to use a removable drive for command and control.","Windows Event ID 4663; Sysmon Event ID 11; User workstations, servers with USB ports, air-gapped systems, and high-security network segments.",last 90 days,pseudocode: SEARCH file_creation_events WHERE (device_type = 'removable_media') | JOIN threat_intel_feed ON (file_hash OR file_name) | IF match THEN ALERT,playbooks/attack/enterprise/T1092.yml
T1092: Communication Through Removable Media,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,2,Are files with unusually rare filenames being written to removable media?,"This question seeks to identify potentially malicious files by focusing on statistical anomalies. Adversaries may use randomized or unique filenames to evade signature-based detection. By establishing a baseline of common filenames written to removable media across the enterprise, we can flag files with names that are statistical outliers (e.g., in the bottom 1st percentile of frequency). This approach can uncover novel or obfuscated staging files that are not yet in threat intelligence feeds.","Windows Event ID 4663; Sysmon Event ID 11; User workstations, servers with USB ports, air-gapped systems, and high-security network segments.",last 90 days,pseudocode: 1. BUILD baseline_model of filename frequencies from file_creation_events on removable_media over 30 days. 2. FOR each new file_creation_event: CALCULATE filename_frequency in baseline_model. 3. IF frequency < 1st_percentile THEN ALERT.,playbooks/attack/enterprise/T1092.yml
T1092: Communication Through Removable Media,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,3,Can a machine learning model identify file write events to removable media that are likely malicious?,"This question leverages a supervised machine learning model to provide a more sophisticated and context-aware detection method. By training a model on features like filename entropy, length, extension, the parent process, and whether the hash is known, it can learn complex patterns that distinguish malicious activity from benign. This allows for the detection of suspicious events that might not trigger simpler symbolic or statistical rules, providing a probabilistic score of maliciousness for analysts to prioritize.","Windows Event ID 4663; Sysmon Event ID 11; User workstations, servers with USB ports, air-gapped systems, and high-security network segments.",last 90 days,"pseudocode: FOR each new file_creation_event on removable_media: EXTRACT features (entropy, length, extension, parent_process, etc.). | SCORE event with trained_classification_model. | IF score > 0.90 THEN ALERT.",playbooks/attack/enterprise/T1092.yml
T1092: Communication Through Removable Media,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,4,Are high-risk executable or script files being written to removable media by unusual programs?,"This question focuses on identifying suspicious file drops onto removable drives. Standard user activity rarely involves programs like web browsers or office applications writing executable files (.exe, .dll, .ps1) directly to a USB stick. This rule-based approach whitelists common, legitimate processes (like ''explorer.exe'') and alerts on any other process creating high-risk file types, which is a strong indicator of a malware dropper or a user inadvertently saving a malicious payload.","Windows Event ID 4663; Windows Event ID 4688; Sysmon Event ID 11; Sysmon Event ID 1; All endpoint devices with removable media access, administrative jump boxes, and developer workstations.",last 90 days,pseudocode: SEARCH file_creation_events ON removable_media | IF file_extension IN high_risk_list AND parent_process NOT IN whitelist THEN ALERT.,playbooks/attack/enterprise/T1092.yml
T1092: Communication Through Removable Media,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,5,Are we observing statistically rare combinations of processes writing specific file types to removable media?,"This question moves beyond a static whitelist to a dynamic, data-driven approach. It statistically models the relationship between every process and the file extensions it writes to removable media across the organization. An alert is triggered when a process writes a file type it has rarely or never written before (e.g., a PDF reader writing a .bat file). This can detect novel or targeted attacks where an adversary uses a compromised but legitimate process for a malicious purpose.","Windows Event ID 4663; Windows Event ID 4688; Sysmon Event ID 11; Sysmon Event ID 1; All endpoint devices with removable media access, administrative jump boxes, and developer workstations.",last 90 days,pseudocode: 1. BUILD baseline_model of P(extension|process) for file writes to removable media. 2. FOR each new file_write_event: CALCULATE P(event_extension|event_process). 3. IF probability < 0.01 THEN ALERT.,playbooks/attack/enterprise/T1092.yml
T1092: Communication Through Removable Media,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,6,"Can an unsupervised machine learning model detect anomalous file creation events on removable media based on process, file type, and attributes?","This question uses unsupervised learning (clustering) to find outliers without pre-labeled data. By grouping similar events based on the parent process, file extension, and file attributes (like ''hidden''), the algorithm can identify events that do not fit into any normal cluster. These ''noise'' points or members of very small clusters represent rare and potentially suspicious activities that deviate from established patterns of behavior, warranting analyst investigation.","Windows Event ID 4663; Windows Event ID 4688; Sysmon Event ID 11; Sysmon Event ID 1; All endpoint devices with removable media access, administrative jump boxes, and developer workstations.",last 90 days,"pseudocode: FOR each new file_creation_event on removable_media: CREATE feature_vector (parent_process, extension, is_hidden). | APPLY clustering_algorithm (DBSCAN). | IF event is classified as noise/outlier THEN ALERT.",playbooks/attack/enterprise/T1092.yml
T1092: Communication Through Removable Media,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,7,Is a process reading from a removable drive and then immediately communicating with a known-malicious C2 server?,"This is a high-fidelity question that directly links an action on a removable drive (reading a file) with subsequent suspicious network activity. By correlating file access with network connections from the same process within a short time frame and checking the destination against C2 threat intelligence, we can detect payloads that execute from a USB drive and ''call home'' for instructions or to exfiltrate data.","Windows Event ID 4663; Sysmon Event ID 3; Zeek conn.log; Internet-connected workstations with USB access, network egress points (firewalls, proxies), and DNS servers.",last 90 days,pseudocode: ON file_read_event from removable_media: MONITOR process for network_connection within 5 minutes. | IF network_destination IN C2_threat_intel_feed THEN ALERT.,playbooks/attack/enterprise/T1092.yml
T1092: Communication Through Removable Media,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,8,"After reading from a removable drive, is a process exhibiting anomalous network behavior, such as sending an unusually large amount of data or connecting to a rare port?","This question looks for behavioral changes in a process after it interacts with a removable drive. Even if the destination isn''t on a threat list, the behavior itself can be suspicious. For example, a process that normally sends very little data suddenly sending megabytes after reading a USB file could indicate data exfiltration. Similarly, connecting to a non-standard port could be a sign of a C2 channel. This method helps detect unknown or custom C2 protocols.","Windows Event ID 4663; Sysmon Event ID 3; Zeek conn.log; Internet-connected workstations with USB access, network egress points (firewalls, proxies), and DNS servers.",last 90 days,"pseudocode: 1. BUILD baseline of process network behavior (avg_bytes_sent, common_ports). 2. ON file_read from removable_media: MONITOR subsequent network connections from process. 3. IF bytes_sent > 95th_percentile_baseline OR destination_port is rare THEN ALERT.",playbooks/attack/enterprise/T1092.yml
T1092: Communication Through Removable Media,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,9,"Is a process exhibiting periodic, 'heartbeat'-like network traffic (beaconing) after reading from a removable drive?","This question uses signal processing techniques to detect C2 beaconing, which is a common characteristic of malware. Malware often communicates with its C2 server at regular intervals. By analyzing the time between a process''s network connections after it has read from a removable drive, we can use algorithms like FFT to identify these regular, machine-like patterns that are distinct from normal, sporadic user-driven traffic.","Windows Event ID 4663; Sysmon Event ID 3; Zeek conn.log; Internet-connected workstations with USB access, network egress points (firewalls, proxies), and DNS servers.",last 90 days,pseudocode: ON file_read from removable_media: COLLECT timestamps of subsequent network connections from process. | CALCULATE time_deltas between connections. | APPLY FFT or autocorrelation to time_delta_series. | IF strong periodic signal detected THEN ALERT.,playbooks/attack/enterprise/T1092.yml
T1092: Communication Through Removable Media,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,10,Is a single process reading a large number of local files and then writing a compressed archive file to a removable drive?,"This question targets the classic ''smash and grab'' data theft pattern. An adversary''s script or tool will often collect many files of interest from a local disk, package them into a single archive (like a .zip or .rar) for easier exfiltration, and then write that archive to a removable drive. This rule looks for this specific sequence of events: mass file reads followed by a single archive write to a USB device by the same process, which is a strong indication of data staging.","Windows Event ID 4663; Sysmon Event ID 11; File servers, database servers, user workstations containing sensitive project data, and developer workstations with source code access.",last 90 days,pseudocode: MONITOR for process with >500 file_read_events in 5 mins. | IF same process then writes file with archive_extension to removable_media in same window THEN ALERT.,playbooks/attack/enterprise/T1092.yml
T1092: Communication Through Removable Media,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,11,Are files with unusually high-entropy (random-looking) filenames being written to removable media?,"This question seeks to identify staged files that have been given randomized names to avoid detection. Malware often generates random strings for filenames to evade simple keyword or name-based blocklists. By calculating the Shannon entropy of filenames being written to removable media and comparing it to a baseline, we can flag those that are statistically likely to be machine-generated and potentially malicious.","Windows Event ID 4663; Sysmon Event ID 11; File servers, database servers, user workstations containing sensitive project data, and developer workstations with source code access.",last 90 days,pseudocode: 1. BUILD baseline distribution of filename_entropy for files written to removable media. 2. FOR each new file_write_event: CALCULATE filename_entropy. 3. IF entropy > 98th_percentile_baseline THEN ALERT.,playbooks/attack/enterprise/T1092.yml
T1092: Communication Through Removable Media,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,12,Can an autoencoder model detect anomalous process behavior indicative of data staging for exfiltration via removable media?,"This question uses an autoencoder, a type of neural network, to learn what ''normal'' process behavior looks like in terms of file and network activity. The model is trained on vectors representing normal activity (e.g., counts of file reads, writes, network connections). When a process exhibits an unusual pattern, like a huge number of file reads followed by a single write to a removable drive and no other activity, the autoencoder will have a high ''reconstruction error'' because it has never seen this pattern before. This high error score flags the process as anomalous for investigation.","Windows Event ID 4663; Sysmon Event ID 11; File servers, database servers, user workstations containing sensitive project data, and developer workstations with source code access.",last 90 days,"pseudocode: 1. TRAIN autoencoder on feature vectors of normal process activity (local_reads, removable_writes, net_conns). 2. IN PRODUCTION: for each process, feed activity vector to autoencoder. 3. MEASURE reconstruction_error. | IF error is anomalously high THEN ALERT.",playbooks/attack/enterprise/T1092.yml
T1092: Communication Through Removable Media,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,13,Are any unsigned executables being run directly from a removable drive?,"This question addresses a very common malware execution vector. Legitimate software is almost always digitally signed by its publisher. An adversary, however, will often place an unsigned malicious executable on a USB drive to be run on a target system. This rule provides a straightforward, high-confidence alert by triggering on any process creation event where the executable file is on a removable drive and lacks a valid digital signature.","Windows Event ID 4688; Sysmon Event ID 1; Windows Event ID 4663; All endpoint devices, particularly those used by privileged users or in physically unsecured areas.",last 90 days,pseudocode: SEARCH process_creation_events | IF process_image_path is on removable_drive AND process_is_signed = 'false' THEN ALERT.,playbooks/attack/enterprise/T1092.yml
T1092: Communication Through Removable Media,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,14,Are we observing rare or never-before-seen parent-child process relationships where the child process is executing from a removable drive?,"This question looks for anomalous execution chains. While a user running an executable from a USB drive via ''explorer.exe'' might be normal, a system service like ''svchost.exe'' or a web server process spawning a process from a removable drive is highly irregular. By baselining all parent-child process relationships across the environment, we can flag new or extremely infrequent relationships involving execution from removable media as suspicious.","Windows Event ID 4688; Sysmon Event ID 1; Windows Event ID 4663; All endpoint devices, particularly those used by privileged users or in physically unsecured areas.",last 90 days,pseudocode: 1. BUILD baseline of parent-child process relationship frequencies where child is on removable_drive. 2. FOR each new process_creation_event from removable_drive: CHECK frequency of parent-child pair in baseline. 3. IF pair is new or frequency is below threshold THEN ALERT.,playbooks/attack/enterprise/T1092.yml
T1092: Communication Through Removable Media,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,15,Can a machine learning model predict whether a process executed from removable media is malicious based on its execution context?,"This question uses a supervised model to make a holistic judgment about the legitimacy of a process executed from a removable drive. It considers multiple features at once—such as the parent process, whether the file is signed, the command-line arguments used, and the file''s name entropy—to calculate a probability of maliciousness. This approach is more robust than a single rule and can catch sophisticated threats that might evade simpler checks by, for example, using a signed but vulnerable application.","Windows Event ID 4688; Sysmon Event ID 1; Windows Event ID 4663; All endpoint devices, particularly those used by privileged users or in physically unsecured areas.",last 90 days,"pseudocode: FOR each process_creation_event from removable_media: EXTRACT features (parent_process, is_signed, cmd_line, etc.). | SCORE event with trained_classification_model. | IF score > 0.85 THEN ALERT.",playbooks/attack/enterprise/T1092.yml
T1095: Non-Application Layer Protocol,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0011: Command and Control,n; o; n; e,1,"Are internal hosts communicating with known C2 IP addresses using ICMP, raw UDP, or TCP?",This question aims to detect direct communication with known malicious infrastructure. Matching outbound traffic against a high-fidelity threat intelligence feed is a primary method for identifying active C2 channels.,"Zeek conn.log; Zeek icmp.log; Network Egress Points (e.g., Internet Gateway, VPN Concentrators)",last 90 days,"SEARCH Zeek logs (conn, icmp) WHERE protocol in (icmp, udp, tcp) | JOIN destination_ip WITH threat_intel_feed ON ip_address | ALERT if match",playbooks/attack/enterprise/T1095.yml
T1095: Non-Application Layer Protocol,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0011: Command and Control,n; o; n; e,2,Is any internal host contacting an anomalously high number of unique external IPs via ICMP?,"This question seeks to identify hosts that exhibit scanning behavior or are using a wide-spread C2 infrastructure. A sudden spike in the number of unique destinations contacted via ICMP, compared to the host's normal behavior, is a strong indicator of compromise.","Zeek conn.log; Zeek icmp.log; Network Egress Points (e.g., Internet Gateway, VPN Concentrators)",last 90 days,FOR EACH source_ip | CALCULATE daily_unique_destination_ip_count FOR ICMP traffic | COMPARE count to 30-day rolling average + 3*std_dev | ALERT if count > threshold,playbooks/attack/enterprise/T1095.yml
T1095: Non-Application Layer Protocol,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0011: Command and Control,n; o; n; e,3,Are internal hosts connecting to external IPs predicted to be C2 servers by a machine learning model?,"This question uses predictive analytics to identify potential C2 servers that may not yet be on known threat intelligence lists. By analyzing various network and enriched features, a machine learning model can flag suspicious destinations with high confidence, enabling proactive threat detection.","Zeek conn.log; Zeek icmp.log; Network Egress Points (e.g., Internet Gateway, VPN Concentrators)",last 90 days,"FOR EACH outbound_connection | EXTRACT features (duration, bytes, proto, ASN, geo, etc.) | INPUT features into pre-trained classification model | ALERT if classification is 'C2' with high confidence",playbooks/attack/enterprise/T1095.yml
T1095: Non-Application Layer Protocol,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0011: Command and Control,n; o; n; e,4,Is any ICMP traffic matching signatures of known ICMP tunneling C2 tools?,"This question aims to detect the use of specific, known tools that tunnel C2 communications over ICMP. By inspecting ICMP packet payloads for unique byte sequences or patterns, we can identify malware like 'icmpsh' or 'Loki' with high precision.",Zeek icmp.log; Internal Network Segments and Core Switches,last 90 days,SEARCH Zeek icmp.log | APPLY regex/signature matching on payload FOR known ICMP C2 tools | ALERT on match,playbooks/attack/enterprise/T1095.yml
T1095: Non-Application Layer Protocol,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0011: Command and Control,n; o; n; e,5,Are there any ICMP flows with a highly skewed ratio of echo-requests to echo-replies?,"This question identifies anomalous ICMP communication patterns. Legitimate 'ping' activity typically has a request-to-reply ratio near 1:1. A highly imbalanced ratio suggests one-way data transfer, a common characteristic of ICMP tunneling for data exfiltration or command delivery.",Zeek icmp.log; Internal Network Segments and Core Switches,last 90 days,"FOR EACH source_dest_ip_pair | CALCULATE ratio of ICMP echo-requests to echo-replies over 1-hour window | ALERT if ratio is highly skewed (e.g., >10 or <0.1)",playbooks/attack/enterprise/T1095.yml
T1095: Non-Application Layer Protocol,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0011: Command and Control,n; o; n; e,6,Does any ICMP traffic exhibit sequential anomalies detected by an RNN/LSTM model?,"This question uses advanced anomaly detection to find subtle, stateful C2 communication over ICMP. An RNN/LSTM model learns the normal sequence of ICMP packet characteristics (size, timing, type) and can flag new sequences that deviate significantly, indicating a hidden communication channel.",Zeek icmp.log; Internal Network Segments and Core Switches,last 90 days,"FOR EACH ICMP flow | CREATE time-series of features (payload_length, inter-arrival_time, type/code) | INPUT to trained RNN/LSTM model | ALERT if reconstruction error is high",playbooks/attack/enterprise/T1095.yml
T1095: Non-Application Layer Protocol,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0011: Command and Control,n; o; n; e,7,"Are there any outbound ICMP, UDP, or TCP flows with unusually large payloads?","This question helps find hidden data transfers. ICMP packets and non-standard UDP/TCP flows typically have small payloads. An unusually large payload can indicate that an attacker is tunneling data, such as exfiltrating files or receiving large command blocks.",Zeek icmp.log; Zeek conn.log; Network Egress Points,last 90 days,SEARCH Zeek icmp/conn logs for outbound traffic | ALERT if ICMP payload > 1024 bytes OR if UDP/TCP on non-standard port has average packet size > 1024 bytes,playbooks/attack/enterprise/T1095.yml
T1095: Non-Application Layer Protocol,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0011: Command and Control,n; o; n; e,8,"Are there any outbound ICMP, UDP, or TCP flows with unusually high payload entropy?","This question aims to detect encrypted or compressed C2 traffic. High Shannon entropy indicates a high degree of randomness, which is characteristic of encrypted or packed data. Finding this in protocols or on ports where it's not expected is a strong indicator of malicious activity.",Zeek icmp.log; Zeek conn.log; Network Egress Points,last 90 days,"FOR EACH outbound flow (ICMP, UDP, TCP) | CALCULATE Shannon entropy of payload | COMPARE to historical baseline for that protocol | ALERT if entropy > 99th percentile",playbooks/attack/enterprise/T1095.yml
T1095: Non-Application Layer Protocol,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0011: Command and Control,n; o; n; e,9,Can unsupervised clustering identify anomalous groups of network flows?,"This question uses machine learning to find 'unknown unknowns'. By grouping all network flows based on their characteristics, clustering algorithms can automatically identify small, outlier clusters that do not conform to normal traffic patterns. These outlier clusters often represent suspicious or malicious activity, such as C2, that warrants investigation.",Zeek icmp.log; Zeek conn.log; Network Egress Points,last 90 days,"COLLECT network flows with features (proto, port, bytes, avg_size, entropy) | APPLY clustering algorithm (e.g., DBSCAN) | INVESTIGATE outlier clusters",playbooks/attack/enterprise/T1095.yml
T1095: Non-Application Layer Protocol,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0011: Command and Control,n; o; n; e,10,Is a non-standard application initiating outbound ICMP connections?,"This question focuses on host-level evidence to identify abuse of the ICMP protocol. While network tools like 'ping.exe' are expected to create ICMP traffic, an application like 'powershell.exe' or a document reader doing so is highly suspicious and could indicate a process has been compromised to act as a C2 agent.",Windows Event ID 5156; Windows Event ID 4688; User Workstations and Critical Servers,last 90 days,"SEARCH for Event ID 5156 with Protocol=1 (ICMP) | IF 'Application Name' is NOT in allowlist (ping.exe, etc.) | CORRELATE with Event ID 4688 for process details | ALERT",playbooks/attack/enterprise/T1095.yml
T1095: Non-Application Layer Protocol,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0011: Command and Control,n; o; n; e,11,Are rare or unique processes initiating ICMP connections across the enterprise?,This question uses the 'stack counting' or 'least frequency of occurrence' analysis method to find outliers. A process that very few machines use to make ICMP connections is inherently suspicious. This technique is effective at finding novel malware or living-off-the-land techniques without prior signatures.,Windows Event ID 5156; Windows Event ID 4688; User Workstations and Critical Servers,last 90 days,"AGGREGATE all processes making ICMP connections across all endpoints | CALCULATE rarity of each process | ALERT on least frequent processes (e.g., bottom 1%)",playbooks/attack/enterprise/T1095.yml
T1095: Non-Application Layer Protocol,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0011: Command and Control,n; o; n; e,12,Is a machine learning model flagging any process-network connection events as malicious?,"This question leverages a predictive model to evaluate the context surrounding a network connection. By considering not just the process and protocol, but also its parent, its path, and recent file system activity, a model can make a more informed decision about whether a connection is legitimate or part of a malicious toolchain.",Windows Event ID 5156; Windows Event ID 4688; User Workstations and Critical Servers,last 90 days,FOR EACH network connection event (EID 5156) | ENRICH with process metadata (EID 4688) and behavioral features | INPUT features to trained classification model | ALERT if classified as malicious with high confidence,playbooks/attack/enterprise/T1095.yml
T1095: Non-Application Layer Protocol,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0011: Command and Control,n; o; n; e,13,Has Zeek detected any weird or non-standard network behavior for UDP or ICMP traffic?,"This question leverages the built-in anomaly detection capabilities of Zeek. Notices in 'weird.log' often point to protocol violations or unusual behaviors that don't fit standard models, which can be a strong indicator of custom C2 protocols designed to evade typical firewalls and IDS/IPS systems.",Zeek weird.log; Network Egress Points and Internal Network Segments,last 90 days,SEARCH Zeek weird.log for notices like 'active_connection_without_SYN' or 'data_before_established' | FILTER for UDP/ICMP protocols | ALERT on any match,playbooks/attack/enterprise/T1095.yml
T1095: Non-Application Layer Protocol,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0011: Command and Control,n; o; n; e,14,"Are there any network flows with highly regular, periodic connection intervals?","This question seeks to identify the 'heartbeat' of malware C2 communications. Automated tools often communicate at very precise intervals (e.g., every 60 seconds). A very low standard deviation in the time between connections is a classic sign of this machine-generated beaconing, distinguishing it from human-driven traffic.",Zeek conn.log; Zeek icmp.log; Network Egress Points and Internal Network Segments,last 90 days,"FOR EACH source_dest_pair (ICMP/UDP) | CALCULATE standard deviation of time between connections | ALERT if std_dev is below a low threshold (e.g., < 1 second)",playbooks/attack/enterprise/T1095.yml
T1095: Non-Application Layer Protocol,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0011: Command and Control,n; o; n; e,15,Can frequency analysis (FFT) detect periodic signaling in any network flows?,"This question uses a more sophisticated signal processing technique to detect beaconing, even if it's 'jittered' or has some variation. A Fast Fourier Transform (FFT) can convert a time series of network events into the frequency domain, making it easy to spot a dominant, repeating frequency that represents a C2 beacon.",Zeek conn.log; Zeek icmp.log; Network Egress Points and Internal Network Segments,last 90 days,"FOR EACH source_dest_flow | CREATE time-series of connection events | APPLY FFT algorithm | ALERT if a strong, dominant frequency is detected",playbooks/attack/enterprise/T1095.yml
T1110.003: Password Spraying,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,1,Are authentication failures or web requests originating from IP addresses on threat intelligence feeds or using user-agents associated with password spraying tools?,"This question helps detect initial spraying attempts by correlating authentication failure logs (Windows Event IDs 4625, 4771) and connection logs (Zeek conn.log) with high-confidence threat intelligence. It also checks for known malicious User-Agent strings in web traffic (Zeek http.log) to identify the use of specific attack tools. A positive match is a strong indicator of a targeted attack.","Zeek conn.log; Zeek http.log; Windows Event ID 4625; Windows Event ID 4771; Threat Intelligence Feed; Internet gateway; Externally-facing web applications; Domain Controllers; VPN concentrators; Cloud Authentication Services (e.g., Azure AD, Okta)",last 90 days,": FOR each auth failure or web request, GET source IP and user agent. CHECK source IP against CTI feed. CHECK user agent against known spraying tool list. IF match, ALERT.",playbooks/attack/enterprise/T1110.003.yml
T1110.003: Password Spraying,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,2,"For an IP matched on a CTI feed, is it targeting an unusually diverse set of user accounts, suggesting a spraying pattern?","This question aims to confirm a password spraying attempt after an initial CTI match. By calculating the Shannon entropy of usernames targeted by a suspicious IP within a short timeframe (15 minutes), we can quantify the randomness or diversity of the targets. A high entropy score, exceeding a statistical baseline (95th percentile), indicates the IP is not targeting one or two accounts but spraying across many, which is a hallmark of this attack.","Zeek conn.log; Zeek http.log; Windows Event ID 4625; Windows Event ID 4771; Threat Intelligence Feed; Internet gateway; Externally-facing web applications; Domain Controllers; VPN concentrators; Cloud Authentication Services (e.g., Azure AD, Okta)",last 90 days,": ON CTI IP match, GET all usernames targeted by IP in last 15 mins. CALCULATE Shannon entropy of unique usernames. IF entropy > baseline_95th_percentile, ALERT.",playbooks/attack/enterprise/T1110.003.yml
T1110.003: Password Spraying,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,3,Can we classify external authentication attempts as malicious in real-time based on their characteristics?,"This question explores a proactive, probabilistic approach to detection. By using a machine learning model (e.g., Logistic Regression) to score each external authentication attempt based on features like IP reputation, ASN, geolocation, time of day, and User-Agent prevalence, the system can identify and alert on attempts classified as 'malicious' with high probability, potentially stopping an attack in progress.","Zeek conn.log; Zeek http.log; Windows Event ID 4625; Windows Event ID 4771; Threat Intelligence Feed; Internet gateway; Externally-facing web applications; Domain Controllers; VPN concentrators; Cloud Authentication Services (e.g., Azure AD, Okta)",last 90 days,": FOR each external auth attempt, CREATE feature vector (IP reputation, ASN, geo, time, User-Agent). SCORE with ML model. IF score > threshold, ALERT.",playbooks/attack/enterprise/T1110.003.yml
T1110.003: Password Spraying,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,4,Has a single source IP address generated a high number of Kerberos pre-authentication failures (0x18) across many different accounts in a short time?,This question provides a simple but effective rule to detect a clear password spraying pattern against Kerberos. It looks for a single source IP address that generates Windows Event ID 4771 with Failure Code '0x18' (indicating pre-authentication failed) for more than 10 distinct user accounts within a 5-minute window. This hard-coded threshold is designed to catch obvious spraying activity with high confidence.,Windows Event ID 4771; Domain Controllers,last 90 days,": COUNT distinct users with Event 4771/Code 0x18 from a single IP in 5 mins. IF count > 10, ALERT.",playbooks/attack/enterprise/T1110.003.yml
T1110.003: Password Spraying,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,5,Is any single source IP responsible for an anomalously high number of distinct accounts failing Kerberos pre-authentication compared to a baseline?,"This question uses a statistical approach instead of a fixed threshold. It filters for Kerberos pre-authentication failures (Event ID 4771, Code '0x18'), groups them by source IP, and counts the distinct target accounts over a 10-minute sliding window. By comparing this count to a baseline distribution of normal activity, it can alert when a source IP's activity exceeds the 99th percentile, indicating an anomalously broad and suspicious targeting pattern.",Windows Event ID 4771; Domain Controllers,last 90 days,": FOR each source IP, COUNT distinct users with Event 4771/Code 0x18 over 10 mins. IF count > 99th_percentile_baseline, ALERT.",playbooks/attack/enterprise/T1110.003.yml
T1110.003: Password Spraying,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,6,Can we identify clusters of Kerberos pre-authentication failures that indicate a coordinated password spraying attack?,"This question applies unsupervised machine learning (e.g., DBSCAN) to detect attacks. By streaming Kerberos failure events (Event ID 4771, Code '0x18') into a clustering model, we can group events based on features like source IP and target account. A dense cluster identified by the model, characterized by a single source IP and a high number of unique target accounts, represents a password spraying attack with high confidence.",Windows Event ID 4771; Domain Controllers,last 90 days,": STREAM Event 4771/Code 0x18 to DBSCAN model. FEATURES: source IP, timestamp, target account hash. IF dense cluster with single IP and many accounts is found, ALERT.",playbooks/attack/enterprise/T1110.003.yml
T1110.003: Password Spraying,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,7,Is a single source IP causing authentication failures for a large number of unique user accounts within a 15-minute window?,This question poses a straightforward threshold-based rule for detecting less stealthy NTLM or Kerberos spraying attacks. It triggers an alert if a single source IP is responsible for failed authentications (Windows Event ID 4625) for more than 20 unique user accounts within a 15-minute period. This simple threshold is effective at catching noisy or unsophisticated spray attacks.,Windows Event ID 4625; Windows Event ID 4771; Domain Controllers; Member Servers; VPN concentrators; Any server accepting network logons,last 90 days,": COUNT distinct users with Event 4625 from a single IP in 15 mins. IF count > 20, ALERT.",playbooks/attack/enterprise/T1110.003.yml
T1110.003: Password Spraying,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,8,Is a source IP exhibiting both a high count of distinct failed accounts and a high ratio of distinct accounts to total attempts?,"This question refines detection by looking for two conditions highly characteristic of password spraying: breadth (many distinct accounts) and depth (few attempts per account). By calculating the distinct account count and the ratio of distinct accounts to total attempts for each source IP, we can alert when an IP exceeds a statistical baseline (98th percentile) for the count and has a high ratio (e.g., > 0.8). This helps reduce false positives from legitimate users making multiple failed login attempts.",Windows Event ID 4625; Windows Event ID 4771; Domain Controllers; Member Servers; VPN concentrators; Any server accepting network logons,last 90 days,": FOR each IP in 30 mins, CALC distinct_failed_users and ratio = distinct_failed_users / total_failures. IF distinct_failed_users > 98th_percentile AND ratio > 0.8, ALERT.",playbooks/attack/enterprise/T1110.003.yml
T1110.003: Password Spraying,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,9,Does the pattern of authentication failures from a source IP appear anomalous when compared to normal network traffic?,"This question leverages an anomaly detection model (e.g., Isolation Forest) to find subtle attack patterns. A feature vector is created for each source IP over a 15-minute window, including counts of different failure events, unique account counts, and the standard deviation of time between attempts. The model, trained on normal traffic, assigns an anomaly score. Scores exceeding a threshold indicate a high likelihood of password spraying.",Windows Event ID 4625; Windows Event ID 4771; Domain Controllers; Member Servers; VPN concentrators; Any server accepting network logons,last 90 days,": FOR each IP in 15 mins, CREATE feature vector (failure counts, unique account counts, time deviation). SCORE with Isolation Forest model. IF score > threshold, ALERT.",playbooks/attack/enterprise/T1110.003.yml
T1110.003: Password Spraying,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,10,Has a successful login occurred from an IP address that was recently responsible for numerous failed logins against other accounts?,This is a critical question for identifying a successful password spray. It uses a stateful rule that directly links a pattern of failures to a subsequent success. A high-severity alert is triggered when a source IP generates more than 10 failed logins (Event ID 4625/4771) across distinct accounts and then has a successful login (Event ID 4624) within 30 minutes. This provides a high-confidence alert and identifies the compromised account.,Windows Event ID 4624; Windows Event ID 4625; Windows Event ID 4771; Zeek conn.log; Domain Controllers; Member Servers; VPN concentrators; Endpoints; Externally-facing web applications,last 90 days,": IF a source IP has >10 distinct failed logins (4625/4771) AND a successful login (4624) within 30 mins, ALERT on success.",playbooks/attack/enterprise/T1110.003.yml
T1110.003: Password Spraying,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,11,Has a successful authentication originated from an IP that is on a watchlist for recent suspicious failed login activity?,"This question describes a stateful, statistical approach to confirming a compromise. A state table or watchlist is maintained for source IPs that have recently exceeded a statistical threshold for failed authentications (e.g., 95th percentile of distinct failed accounts). When a successful authentication (Event ID 4624) occurs, the source IP is checked against this watchlist. A match escalates the event as a high-confidence successful password spray.",Windows Event ID 4624; Windows Event ID 4625; Windows Event ID 4771; Zeek conn.log; Domain Controllers; Member Servers; VPN concentrators; Endpoints; Externally-facing web applications,last 90 days,": MAINTAIN watchlist of IPs with high failure rates. ON successful login (4624), CHECK if source IP is on watchlist. IF yes, ALERT.",playbooks/attack/enterprise/T1110.003.yml
T1110.003: Password Spraying,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,12,Does the sequence of authentication events (failures and successes) from a source IP appear anomalous?,"This question uses sequence-aware algorithms (e.g., HMM, LSTM) to analyze the narrative of an authentication session. The model is trained on benign sequences of events. An attack sequence, characterized by a high volume of failures across many accounts followed by a sudden success, will be recognized by the model as a low-probability, anomalous sequence, thus triggering an alert.",Windows Event ID 4624; Windows Event ID 4625; Windows Event ID 4771; Zeek conn.log; Domain Controllers; Member Servers; VPN concentrators; Endpoints; Externally-facing web applications,last 90 days,": MODEL auth event sequences per IP with LSTM/HMM. IF model flags a sequence of (many failures -> 1 success) as anomalous, ALERT.",playbooks/attack/enterprise/T1110.003.yml
T1110.003: Password Spraying,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,13,"Has the overall volume of authentication failures across the entire network exceeded a critical, pre-defined threshold?","This question proposes a 'tripwire' rule for detecting large-scale, noisy attacks. It sets a high, fixed threshold for the total count of authentication failures (Windows Event IDs 4625 and 4771) across all domain controllers within a given timeframe (e.g., 5000 events in 1 hour). While not subtle, it serves as an effective last-resort detector for a massive password spraying campaign that might otherwise be missed.",Zeek conn.log; Windows Event ID 4625; Windows Event ID 4771; Internet gateway; Domain Controllers; VPN concentrators; Network backbone sensors,last 90 days,": SUM all 4625 and 4771 events across network over 1 hour. IF sum > 5000, ALERT.",playbooks/attack/enterprise/T1110.003.yml
T1110.003: Password Spraying,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,14,"Is the current hourly count of authentication failures statistically unusual when compared to a historical, seasonal baseline?","This question moves beyond a fixed threshold to a more intelligent statistical one. It aggregates authentication failure counts into hourly bins and creates a baseline model that accounts for normal business cycles (seasonality). An alert is triggered if the current hour's count exceeds the forecasted value by a significant margin (e.g., more than 3 standard deviations of the model's error), indicating a statistically significant anomaly.",Zeek conn.log; Windows Event ID 4625; Windows Event ID 4771; Internet gateway; Domain Controllers; VPN concentrators; Network backbone sensors,last 90 days,": MODEL hourly auth failure counts with seasonality. FORECAST expected count for current hour. IF actual_count > (forecast + 3*stdev), ALERT.",playbooks/attack/enterprise/T1110.003.yml
T1110.003: Password Spraying,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,15,Does the observed volume of authentication failures or failed connection attempts fall outside the predicted range of a time-series forecasting model?,"This question describes the most sophisticated approach to volume-based detection. It uses advanced time-series forecasting models (e.g., Prophet, SARIMA) trained on at least 90 days of historical data to predict the expected volume of failures for the next interval. If the observed volume falls outside the model's prediction interval (e.g., 99% confidence), it triggers an alert, indicating a statistically significant and unexpected event.",Zeek conn.log; Windows Event ID 4625; Windows Event ID 4771; Internet gateway; Domain Controllers; VPN concentrators; Network backbone sensors,last 90 days,": TRAIN SARIMA/Prophet model on 90-day history of auth failure counts. FORECAST next interval with 99% confidence interval. IF observed_count is outside interval, ALERT.",playbooks/attack/enterprise/T1110.003.yml
T1134.003: Make and Impersonate Token,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,1,"Are known malicious processes creating new, higher-privileged logon sessions within a short timeframe?","This question attempts to identify a classic privilege escalation chain. A malicious executable, identified by its file hash, runs and then immediately impersonates a more powerful user. Detecting this sequence of a known bad file followed by a privilege-increasing logon is a high-fidelity indicator of compromise.",Windows Event ID 4688; Windows Event ID 4624; Domain Controllers; Member Servers; Administrative Workstations; SIEM/Log Aggregator,last 90 days,": SEARCH process_creation (EID 4688) where hash in malicious_hash_list | JOIN logon_events (EID 4624, LogonType=9) where logon.host = process.host AND logon.time is within 60s of process.time | FILTER logon.TargetUser.privileges > process.SubjectUser.privileges",playbooks/attack/enterprise/T1134.003.yml
T1134.003: Make and Impersonate Token,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,2,Are processes impersonating users they have rarely or never impersonated before?,"This question aims to detect anomalous impersonation behavior by statistically profiling normal activity. Adversaries often use legitimate processes to perform malicious actions. By identifying which processes typically impersonate which users, we can flag rare combinations as suspicious. A process like svchost.exe impersonating a domain administrator for the first time is a significant anomaly that warrants investigation.",Windows Event ID 4688; Windows Event ID 4624; Domain Controllers; Member Servers; Administrative Workstations; SIEM/Log Aggregator,last 90 days,": FOR each logon_event (EID 4624, LogonType=9): GET parent_process_name, target_user | LOOKUP historical frequency of (parent_process_name, target_user) pair | IF frequency is in bottom 1st percentile, ALERT",playbooks/attack/enterprise/T1134.003.yml
T1134.003: Make and Impersonate Token,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,3,Can we predict if a new logon session is part of a malicious privilege escalation chain based on its characteristics?,"This question uses a machine learning model to proactively identify malicious token impersonation. By training a model on features from both the logon event and its parent process (e.g., command line entropy, process rarity, privilege increase), the system can assign a risk score to each new logon session, allowing analysts to focus on the most probable threats.",Windows Event ID 4688; Windows Event ID 4624; Domain Controllers; Member Servers; Administrative Workstations; SIEM/Log Aggregator,last 90 days,": FOR each logon_event (EID 4624, LogonType=9): EXTRACT features (parent process entropy, rarity, privilege delta, etc.) | INPUT features into trained classification model | IF model_output_probability > threshold, ALERT",playbooks/attack/enterprise/T1134.003.yml
T1134.003: Make and Impersonate Token,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,4,Are suspicious or non-standard processes creating new logon sessions?,"This question looks for processes that should not normally be creating impersonation logon sessions. For example, a web server process (w3wp.exe) or Microsoft Word (WINWORD.EXE) creating a new logon session is highly irregular and could indicate a compromised application or a document-based attack vector attempting to escalate privileges.",Windows Event ID 4624; Windows Event ID 4688; Application Servers; Web Servers; User Workstations; SIEM/Log Aggregator,last 90 days,": SEARCH logon_events (EID 4624, LogonType=9) | GET parent_process_name | IF parent_process_name in suspicious_process_list, ALERT",playbooks/attack/enterprise/T1134.003.yml
T1134.003: Make and Impersonate Token,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,5,Is a process suddenly starting to impersonate a much wider and more diverse set of users?,"This question detects when a process's impersonation behavior changes. A process that normally impersonates a small, consistent set of accounts but suddenly begins creating sessions for many different new accounts could be compromised. This is measured by a significant increase in the entropy of target usernames for that parent process.",Windows Event ID 4624; Windows Event ID 4688; Application Servers; Web Servers; User Workstations; SIEM/Log Aggregator,last 90 days,": FOR each logon_event (EID 4624, LogonType=9): GET parent_process_name, target_user | CALCULATE entropy of target_user set for parent_process_name over 30 days | IF new_entropy is a statistical outlier, ALERT",playbooks/attack/enterprise/T1134.003.yml
T1134.003: Make and Impersonate Token,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,6,Are there clusters of anomalous logon and parent process behaviors that differ from normal activity?,"This question uses unsupervised machine learning to find outliers without pre-defined rules. By clustering logon events based on features like process names, user names, and command line attributes, the model can identify small, isolated clusters or 'noise' points that represent rare and potentially malicious impersonation activity distinct from common administrative patterns.",Windows Event ID 4624; Windows Event ID 4688; Application Servers; Web Servers; User Workstations; SIEM/Log Aggregator,last 90 days,": EXTRACT features (process, user, cmdline) from logon events (EID 4624, Type 9) | APPLY clustering algorithm (e.g., DBSCAN) | ANALYZE small clusters and noise points as anomalies",playbooks/attack/enterprise/T1134.003.yml
T1134.003: Make and Impersonate Token,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,7,Is a low-privilege user impersonating a high-privilege user and then immediately accessing sensitive system resources?,"This question looks for a specific, high-impact attack chain: a non-privileged account creates a logon session for a privileged account and then uses that session to access credentials from memory (LSASS). Correlating the logon event with the subsequent sensitive object access provides strong evidence of a credential dumping attack.",Windows Event ID 4624; Windows Event ID 4688; Windows Event ID 4656; Windows Event ID 4657; Domain Controllers; High-Value Asset Servers; Tier 0 Administrator Workstations; Certificate Authorities,last 90 days,": SEARCH logon_event (EID 4624, LogonType=9) where TargetUser.privileges > SubjectUser.privileges | CORRELATE logon_event.TargetLogonId with object_access_event (EID 4656) on lsass.exe within 5 minutes",playbooks/attack/enterprise/T1134.003.yml
T1134.003: Make and Impersonate Token,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,8,Is a user impersonating an account with a privilege level that is a significant outlier compared to their normal behavior?,"This question establishes a baseline of impersonation behavior for each user. An alert is triggered if a user impersonates an account where the 'privilege gap' between their own account and the target account is statistically unusual for them. This helps distinguish between routine administrative tasks and anomalous, potentially malicious privilege escalation.",Windows Event ID 4624; Windows Event ID 4688; Windows Event ID 4656; Windows Event ID 4657; Domain Controllers; High-Value Asset Servers; Tier 0 Administrator Workstations; Certificate Authorities,last 90 days,": FOR each logon_event (EID 4624, LogonType=9): CALCULATE privilege_gap_score(TargetUser, SubjectUser) | IF score > 99th percentile of historical scores for SubjectUser, ALERT",playbooks/attack/enterprise/T1134.003.yml
T1134.003: Make and Impersonate Token,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,9,Does the sequence of actions following a logon impersonation event match known attack patterns?,"This question uses a time-series model to analyze the 'story' of a logon session. After a user is impersonated, the model tracks the sequence of events associated with that session ID. Sequences that are improbable or that closely match known malicious kill chains (e.g., access credentials, create scheduled task, connect to C2) are flagged as high-risk.",Windows Event ID 4624; Windows Event ID 4688; Windows Event ID 4656; Windows Event ID 4657; Domain Controllers; High-Value Asset Servers; Tier 0 Administrator Workstations; Certificate Authorities,last 90 days,": AFTER logon_event (EID 4624, LogonType=9): MONITOR sequence of subsequent events for that TargetLogonId | INPUT event sequence into anomaly detection model | IF model flags sequence as improbable or malicious, ALERT",playbooks/attack/enterprise/T1134.003.yml
T1134.003: Make and Impersonate Token,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,10,Is 'runas.exe /netonly' being used by a web server or other unusual process to connect to internal systems?,This question looks for adversaries using 'runas.exe /netonly' for lateral movement after compromising a server. A web server process spawning 'runas' to authenticate to other internal machines is a strong indicator that an attacker is using a web shell to expand their foothold within the network.,Windows Event ID 4688; Windows Event ID 4624; Zeek conn.log; Internal-facing Servers; Staging Servers; User Workstations; Network Egress Points,last 90 days,": SEARCH process_creation (EID 4688) for 'runas.exe' with '/netonly' in command line | IF parent_process is 'w3wp.exe' or similar | CORRELATE with outbound network connections to internal IPs on ports 445, 3389, 5985",playbooks/attack/enterprise/T1134.003.yml
T1134.003: Make and Impersonate Token,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,11,Is 'runas.exe /netonly' being used by an anomalous user or to connect to a rare destination?,"This question establishes a baseline for legitimate use of 'runas.exe /netonly' and alerts on deviations. An alert is triggered if a service account uses it for the first time, or if a legitimate user employs it to connect to a destination host they have never accessed before, suggesting the command is being used for reconnaissance or lateral movement.",Windows Event ID 4688; Windows Event ID 4624; Zeek conn.log; Internal-facing Servers; Staging Servers; User Workstations; Network Egress Points,last 90 days,": SEARCH for 'runas.exe /netonly' usage | IF user or source_host is not in baseline OR destination_host is rare for that user/host pair, ALERT",playbooks/attack/enterprise/T1134.003.yml
T1134.003: Make and Impersonate Token,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,12,Does a graph of process and network interactions show a suspicious path involving 'runas.exe /netonly'?,"This question models system activity as a graph to find anomalous attack paths. A sequence like 'web server -> command shell -> runas.exe /netonly -> critical database' forms a path in the graph. If this path is rare or has never been seen before, it is flagged as a potential threat, indicating a web shell performing lateral movement.",Windows Event ID 4688; Windows Event ID 4624; Zeek conn.log; Internal-facing Servers; Staging Servers; User Workstations; Network Egress Points,last 90 days,": MODEL activity as a graph (nodes=users,processes,hosts) | SEARCH for paths like 'w3wp.exe -> cmd.exe -> runas.exe /netonly -> DB_SERVER' | IF path is statistically anomalous, ALERT",playbooks/attack/enterprise/T1134.003.yml
T1134.003: Make and Impersonate Token,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,13,Is 'runas.exe /savecred' being executed from a non-interactive session or a suspicious file path?,"This question targets the malicious use of '/savecred' to persist credentials. Execution by a non-interactive process (like a Windows Service) or from a user-writable temporary directory is highly suspicious, as it suggests an automated script or malware is trying to save credentials for later use, rather than a legitimate administrator.","Windows Event ID 4688; User Workstations; Multi-user Servers (e.g., Citrix, RDS); SIEM/Log Aggregator",last 90 days,": SEARCH process_creation (EID 4688) for 'runas.exe' with '/savecred' | IF SubjectLogonId is non-interactive OR ParentProcessPath is in a temp/suspicious location, ALERT",playbooks/attack/enterprise/T1134.003.yml
T1134.003: Make and Impersonate Token,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,14,Is 'runas.exe /savecred' being launched from a process with a high-entropy or rare file path?,This question uses statistical properties of the parent process path to find malware. Adversaries often place tools in randomly named folders or deeply nested temporary directories. A high-entropy path or a path that is statistically rare across the enterprise can indicate that 'runas.exe /savecred' is being launched by malware rather than a legitimate tool.,"Windows Event ID 4688; User Workstations; Multi-user Servers (e.g., Citrix, RDS); SIEM/Log Aggregator",last 90 days,": FOR each 'runas.exe /savecred' execution: CALCULATE entropy and rarity of parent process path | IF path_entropy or path_rarity is a statistical outlier, ALERT",playbooks/attack/enterprise/T1134.003.yml
T1134.003: Make and Impersonate Token,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,15,Can we distinguish malicious 'runas.exe /savecred' executions from legitimate ones based on their context?,"This question applies a machine learning model to classify the legitimacy of '/savecred' usage. By analyzing features like the parent process, user context (interactive vs. service), and path characteristics, the model can learn the patterns of normal administrative use and flag executions that deviate, indicating potential credential theft.","Windows Event ID 4688; User Workstations; Multi-user Servers (e.g., Citrix, RDS); SIEM/Log Aggregator",last 90 days,": FOR each 'runas.exe /savecred' execution: EXTRACT features (parent process, user context, path attributes) | INPUT to classification model | IF model flags as malicious, ALERT",playbooks/attack/enterprise/T1134.003.yml
T1134.003: Make and Impersonate Token,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,16,Is a new logon impersonation session immediately followed by connections to known malicious domains?,This question links token impersonation directly to network-based indicators of compromise. An attacker may impersonate a user to inherit their network permissions or to obfuscate the source of malicious traffic. Correlating a Logon Type 9 event with immediate DNS queries or connections to known C2 servers is a strong signal of active compromise.,Windows Event ID 4624; Windows Event ID 5156; Zeek conn.log; Zeek dns.log; Network Egress Points; DNS Servers; Critical Asset Subnets; Proxy Logs,last 90 days,": ON logon_event (EID 4624, LogonType=9), CORRELATE ProcessId with DNS queries and network connections within 60s | IF destination domain is on C2 blocklist or newly registered, ALERT",playbooks/attack/enterprise/T1134.003.yml
T1134.003: Make and Impersonate Token,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,17,"After a user is impersonated, does their network behavior become anomalous?","This question establishes a baseline of normal network activity for each user (e.g., common destinations, ports, protocols). If, after an impersonation event, the network traffic associated with that user suddenly deviates—such as connecting to a new country or using a rare port—it suggests the impersonated session is being used by an attacker for command and control or data exfiltration.",Windows Event ID 4624; Windows Event ID 5156; Zeek conn.log; Zeek dns.log; Network Egress Points; DNS Servers; Critical Asset Subnets; Proxy Logs,last 90 days,": AFTER logon_event (EID 4624, LogonType=9), MONITOR subsequent network traffic for the user | IF traffic deviates from user's historical baseline (e.g., new country, rare port, high entropy domain), ALERT",playbooks/attack/enterprise/T1134.003.yml
T1134.003: Make and Impersonate Token,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,18,Is there an unpredicted spike in outbound network traffic immediately following a logon impersonation event?,"This question uses a time-series forecasting model to predict a host's normal network traffic volume. A significant, unpredicted spike in outbound data immediately following a Logon Type 9 event is a strong anomaly, suggesting that an attacker has impersonated a user and is now using that session for a high-volume activity like data exfiltration.",Windows Event ID 4624; Windows Event ID 5156; Zeek conn.log; Zeek dns.log; Network Egress Points; DNS Servers; Critical Asset Subnets; Proxy Logs,last 90 days,": FORECAST host's outbound traffic volume using time-series model | AFTER logon_event (EID 4624, LogonType=9), COMPARE actual traffic to forecast | IF actual traffic significantly exceeds forecast, ALERT",playbooks/attack/enterprise/T1134.003.yml
T1134.003: Make and Impersonate Token,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,19,Has the SYSTEM account been impersonated immediately before security logs were cleared?,"This is a high-fidelity detection for a common defense evasion sequence. An attacker impersonates the highly privileged SYSTEM account and then uses those privileges to clear the security event log (wevtutil.exe cl Security or Event ID 1102), effectively erasing their tracks. Chaining these two events together provides a very strong indication of malicious activity.",Windows Event ID 4624; Windows Event ID 4688; Windows Event ID 1102; Windows Event ID 4663; Log Aggregation Servers; Domain Controllers; Security Appliance Management Interfaces; EDR servers,last 90 days,": SEARCH for logon_event (EID 4624, LogonType=9, TargetUser='SYSTEM') | IF within 2 minutes, a log clear event (EID 1102) OR process_creation of 'wevtutil.exe cl' occurs on the same host, ALERT",playbooks/attack/enterprise/T1134.003.yml
T1134.003: Make and Impersonate Token,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,20,Is there a statistically unusual temporal relationship between a privileged impersonation and a log clearing event?,"This question looks for log clearing events that happen anomalously soon after a privileged account is impersonated. While both events might occur legitimately, an attacker's automated script will often clear logs immediately after gaining privileges. An alert is triggered if the time delta between these events is a statistical outlier (e.g., unusually short), suggesting automated evasion.",Windows Event ID 4624; Windows Event ID 4688; Windows Event ID 1102; Windows Event ID 4663; Log Aggregation Servers; Domain Controllers; Security Appliance Management Interfaces; EDR servers,last 90 days,": CALCULATE baseline for time delta between privileged Logon Type 9 events and log clear events (EID 1102) | IF a new time delta is a statistical outlier (e.g., in the 1st percentile), ALERT",playbooks/attack/enterprise/T1134.003.yml
T1134.003: Make and Impersonate Token,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,21,Does a sequence of security events match the pattern of impersonation followed by defense evasion?,"This question uses a state-transition model (HMM) to understand the narrative of an attack. The model learns the probability of moving from one state to another (e.g., 'Normal' -> 'Impersonation' -> 'Evasion'). A sequence of events like 'Logon Type 9 for SYSTEM', followed by 'Access to EDR process', then 'Terminate Process', represents a low-probability path through the model, triggering a high-confidence alert for a sophisticated evasion attempt.",Windows Event ID 4624; Windows Event ID 4688; Windows Event ID 1102; Windows Event ID 4663; Log Aggregation Servers; Domain Controllers; Security Appliance Management Interfaces; EDR servers,last 90 days,": INPUT sequence of security events into a trained Hidden Markov Model | IF model identifies a low-probability path corresponding to an attack pattern (e.g., Logon -> Terminate Security Tool -> Clear Logs), ALERT",playbooks/attack/enterprise/T1134.003.yml
T1137: Office Application Startup,b1d4f2e8-c9a1-4b7e-9d0f-5a2c8f6b3e1d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0003: Persistence,n; o; n; e,1,Are known malicious files or add-ins being written to Office startup paths or registered as add-ins?,"This question seeks to identify persistence attempts using symbolic, high-confidence indicators. Adversaries may place malicious files (like VBS scripts or DLLs) in Office startup directories (`STARTUP`, `Templates`) so they execute when the application launches. They can also register malicious COM add-ins in the registry. This query looks for file hashes matching threat intelligence feeds or registry values matching watchlists of known malicious add-ins.",Windows Event ID 4663; Windows Event ID 4657; Windows Event ID 4688; User workstations; Terminal servers; File servers hosting shared Office templates,last 90 days,: SEARCH file creation events (4663) in Office startup paths. HASH created file. JOIN hash against threat intel feed. ALERT on match. SEARCH registry modification events (4657) for Office add-in keys. MATCH value/data against known malicious add-in watchlist. ALERT on match.,playbooks/attack/enterprise/T1137.yml
T1137: Office Application Startup,b1d4f2e8-c9a1-4b7e-9d0f-5a2c8f6b3e1d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0003: Persistence,n; o; n; e,2,Are there any files with unusually high entropy or any rarely seen add-in paths being used in Office startup locations?,"This question uses statistical analysis to find outliers that may indicate malicious activity. High file name entropy can suggest an adversary is trying to obfuscate file names to avoid detection. Similarly, an add-in pointing to a DLL in an uncommon location or a DLL that is present on very few systems enterprise-wide is suspicious and could be a custom malicious tool.",Windows Event ID 4663; Windows Event ID 4657; Windows Event ID 4688; User workstations; Terminal servers; File servers hosting shared Office templates,last 90 days,: SEARCH file creation events (4663) in Office startup paths. CALCULATE file name entropy. ALERT on entropy > 99th percentile. SEARCH registry modification events (4657) for Office add-ins. CALCULATE prevalence of add-in DLL paths. ALERT on path prevalence < 1%.,playbooks/attack/enterprise/T1137.yml
T1137: Office Application Startup,b1d4f2e8-c9a1-4b7e-9d0f-5a2c8f6b3e1d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0003: Persistence,n; o; n; e,3,Is there an anomalous volume of file or registry modifications in sensitive Office startup locations for any user?,This question leverages machine learning to detect unusual spikes in activity. Adversaries setting up persistence may generate a burst of file and registry writes that deviates from a user's normal behavior. A time-series model can learn a user's baseline activity and flag significant deviations that could represent a persistence installation.,Windows Event ID 4663; Windows Event ID 4657; Windows Event ID 4688; User workstations; Terminal servers; File servers hosting shared Office templates,last 90 days,: MODEL time-series of file (4663) and registry (4657) modifications in Office startup locations per user. ALERT on volume > predicted confidence interval.,playbooks/attack/enterprise/T1137.yml
T1137: Office Application Startup,b1d4f2e8-c9a1-4b7e-9d0f-5a2c8f6b3e1d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0003: Persistence,n; o; n; e,4,Are Office applications spawning child processes with command lines containing known obfuscation or download patterns?,"This seeks to find explicit evidence of malicious code execution. Office applications spawning processes like PowerShell with encoded commands (`-enc`), download commands (`DownloadString`), or inline execution (`IEX`) is a common TTP for executing a payload after a user opens a malicious document. This query uses regular expressions to find these high-confidence malicious patterns.",Windows Event ID 4688; Zeek conn.log; User workstations; Terminal servers; Internet gateway,last 90 days,": SEARCH process creation events (4688) where parent is Office app. APPLY regex for '-enc', '-nop', 'IEX', 'DownloadString', base64 patterns to command line. ALERT on match.",playbooks/attack/enterprise/T1137.yml
T1137: Office Application Startup,b1d4f2e8-c9a1-4b7e-9d0f-5a2c8f6b3e1d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0003: Persistence,n; o; n; e,5,Are Office applications spawning child processes with unusually long or high-entropy command lines?,"This uses statistical measures to identify suspicious command lines. Malicious scripts, especially encoded ones, are often significantly longer and have higher character entropy than benign commands. By baselining normal command line characteristics for specific parent-child process pairs (e.g., `winword.exe` -> `powershell.exe`), we can flag outliers that are more than 3 standard deviations from the mean.",Windows Event ID 4688; Zeek conn.log; User workstations; Terminal servers; Internet gateway,last 90 days,: SEARCH process creation events (4688) where parent is Office app. BASELINE command line length and entropy per parent-child pair. ALERT on values > 3 standard deviations from mean.,playbooks/attack/enterprise/T1137.yml
T1137: Office Application Startup,b1d4f2e8-c9a1-4b7e-9d0f-5a2c8f6b3e1d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0003: Persistence,n; o; n; e,6,Can we predict if a command line spawned by an Office application is malicious based on its features?,"This question applies a machine learning classification model to automate the detection of malicious command lines. By training a model (like Random Forest) on features such as keyword presence, n-grams, and entropy from a labeled dataset, the model can score new, unseen command lines for their probability of being malicious, allowing for more nuanced and scalable detection than simple regex.",Windows Event ID 4688; Zeek conn.log; User workstations; Terminal servers; Internet gateway,last 90 days,": MODEL classification of command lines from Office child processes using features (keywords, n-grams, entropy). ALERT on high probability of maliciousness.",playbooks/attack/enterprise/T1137.yml
T1137: Office Application Startup,b1d4f2e8-c9a1-4b7e-9d0f-5a2c8f6b3e1d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0003: Persistence,n; o; n; e,7,Are Office applications spawning known high-risk child processes like `net.exe` or `regsvr32.exe`?,"This question focuses on a simple but effective detection method. Benign Office application usage rarely involves spawning system or network utilities. This query checks for instances where an Office process (`winword.exe`, `excel.exe`, etc.) creates a child process from a denylist of tools commonly abused by adversaries for reconnaissance or execution, such as `net.exe`, `whoami.exe`, or `powershell.exe`.",Windows Event ID 4688; User workstations; Terminal servers,last 90 days,": SEARCH process creation events (4688). ALERT if parent is Office app and child is on denylist (net.exe, whoami.exe, regsvr32.exe, etc.).",playbooks/attack/enterprise/T1137.yml
T1137: Office Application Startup,b1d4f2e8-c9a1-4b7e-9d0f-5a2c8f6b3e1d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0003: Persistence,n; o; n; e,8,Are Office applications spawning child processes that are new or rare in the environment?,"This question aims to find anomalous process relationships. By establishing a baseline of all parent-child process relationships across the enterprise, we can flag any new or very infrequent pairings. An Office application spawning a process that has never been seen before, or only on a handful of hosts, is highly suspicious and warrants investigation.",Windows Event ID 4688; User workstations; Terminal servers,last 90 days,: SEARCH process creation events (4688). CALCULATE frequency of all parent-child pairs. ALERT on new pairs or pairs with prevalence < 0.1% or seen on < 5 hosts.,playbooks/attack/enterprise/T1137.yml
T1137: Office Application Startup,b1d4f2e8-c9a1-4b7e-9d0f-5a2c8f6b3e1d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0003: Persistence,n; o; n; e,9,Are there any process creation events involving Office applications that do not fit into established clusters of normal behavior?,"This question uses unsupervised machine learning to find anomalous process events. A clustering algorithm like DBSCAN can group similar process events based on features like parent/child names, user, and host. Events that do not belong to any established cluster are considered outliers or noise, and in this context, they represent potentially malicious activity that deviates from normal patterns.",Windows Event ID 4688; User workstations; Terminal servers,last 90 days,": MODEL clustering of process creation events (parent, child, user, host). ALERT on new events that do not fit into an existing cluster.",playbooks/attack/enterprise/T1137.yml
T1137: Office Application Startup,b1d4f2e8-c9a1-4b7e-9d0f-5a2c8f6b3e1d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0003: Persistence,n; o; n; e,10,Are suspicious processes like `powershell.exe` or `cmd.exe` writing executable or script files to Office startup directories?,"This question looks for a specific, high-fidelity indicator of persistence. While Office applications or installers might legitimately write template files, other processes like `powershell.exe` or `cmd.exe` writing files with extensions like `.dll`, `.vbs`, or `.ps1` to these locations is highly indicative of an adversary dropping a persistence mechanism. This query correlates file write events with the process that performed the write and alerts if that process is on a denylist.",Windows Event ID 4663; Windows Event ID 4688; User workstations; File servers hosting shared templates; Terminal servers,last 90 days,": SEARCH file write events (4663) in Office startup paths. CORRELATE ProcessID to process logs (4688). ALERT if writing process is on denylist (powershell.exe, cmd.exe, etc.) and file extension is script/executable.",playbooks/attack/enterprise/T1137.yml
T1137: Office Application Startup,b1d4f2e8-c9a1-4b7e-9d0f-5a2c8f6b3e1d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0003: Persistence,n; o; n; e,11,"Are there any new or rare processes writing files, or files with rare extensions, to Office startup directories?","This question uses statistical rarity to uncover threats. By baselining which processes normally write to Office startup paths, we can immediately spot an anomaly when a new process performs this action. Similarly, while `.dotm` might be common, an `.exe` or `.dll` being written to these directories is statistically rare and suspicious. This query flags writes from new processes or files with uncommon extensions.",Windows Event ID 4663; Windows Event ID 4688; User workstations; File servers hosting shared templates; Terminal servers,last 90 days,": BASELINE processes that write to Office startup paths. ALERT on writes from a new process. BASELINE file extensions in these paths. ALERT on statistically rare extensions (.exe, .dll).",playbooks/attack/enterprise/T1137.yml
T1137: Office Application Startup,b1d4f2e8-c9a1-4b7e-9d0f-5a2c8f6b3e1d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0003: Persistence,n; o; n; e,12,Do event sequences preceding a file write to an Office startup path deviate from normal user behavior patterns?,"This question uses ML to analyze the chain of events leading to a suspicious action. A normal file write might be preceded by launching Word and clicking 'Save As'. A malicious write might be preceded by a network connection from a rare IP, followed by a PowerShell execution. A sequence analysis model (like an HMM) can learn these normal sequences and flag chains of events that are anomalous, providing richer context than a single event.",Windows Event ID 4663; Windows Event ID 4688; User workstations; File servers hosting shared templates; Terminal servers,last 90 days,": MODEL sequence of events (e.g., network connection, process creation) preceding file writes (4663) to startup paths. ALERT on sequences that deviate from learned normal models.",playbooks/attack/enterprise/T1137.yml
T1137: Office Application Startup,b1d4f2e8-c9a1-4b7e-9d0f-5a2c8f6b3e1d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0003: Persistence,n; o; n; e,13,Are Office add-in registry keys being modified by non-standard processes like `cmd.exe` or `reg.exe`?,This question seeks to identify when a persistence mechanism is being installed via the registry by an unusual process. Legitimate add-ins are typically installed by `msiexec.exe` or application updaters. An adversary might use a command-line tool like `reg.exe` or `powershell.exe` to create the necessary keys. This query alerts when a process from a denylist modifies these specific registry keys.,Windows Event ID 4657; Windows Event ID 4688; User workstations; Domain Controllers; Terminal servers,last 90 days,": SEARCH registry modifications (4657) to Office add-in keys. CORRELATE ProcessID to process logs (4688). ALERT if modifying process is on denylist (cmd.exe, powershell.exe, reg.exe).",playbooks/attack/enterprise/T1137.yml
T1137: Office Application Startup,b1d4f2e8-c9a1-4b7e-9d0f-5a2c8f6b3e1d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0003: Persistence,n; o; n; e,14,Are any newly installed Office add-ins statistically rare across the enterprise?,"This question uses prevalence analysis to find suspicious software. Most legitimate Office add-ins will be installed on a significant portion of the user base. A custom malicious add-in, however, will be rare. By baselining all add-in names and their DLL paths, we can flag any new add-in that is entirely new or has a very low prevalence (e.g., installed on less than 1% of systems), as it is a strong indicator of a targeted tool.",Windows Event ID 4657; Windows Event ID 4688; User workstations; Domain Controllers; Terminal servers,last 90 days,: BASELINE all Office add-in FriendlyNames and DLL paths across enterprise. CALCULATE prevalence of each. ALERT on new add-ins with prevalence < 1% or that are previously unseen.,playbooks/attack/enterprise/T1137.yml
T1137: Office Application Startup,b1d4f2e8-c9a1-4b7e-9d0f-5a2c8f6b3e1d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0003: Persistence,n; o; n; e,15,Do any registry modifications related to Office add-ins appear as significant outliers compared to normal software installation profiles?,"This question uses an unsupervised ML model to find anomalous registry modification events without pre-defined rules. By feeding features like the process name, username, time of day, and the add-in's prevalence score into a model like Isolation Forest, the model can learn what a 'normal' add-in installation looks like. It can then flag events that are outliers, such as a rare add-in being installed by an unusual process at 3 AM.",Windows Event ID 4657; Windows Event ID 4688; User workstations; Domain Controllers; Terminal servers,last 90 days,": MODEL anomaly detection on registry modification events (4657) for add-ins using features (process, user, time, add-in prevalence). ALERT on events flagged as outliers.",playbooks/attack/enterprise/T1137.yml
T1137: Office Application Startup,b1d4f2e8-c9a1-4b7e-9d0f-5a2c8f6b3e1d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0003: Persistence,n; o; n; e,16,Has an Outlook rule been created that is configured to launch an external application or script?,"This question targets a classic persistence technique where an adversary creates an Outlook rule to automatically run a malicious program or script when a specific email is received. This query looks for the explicit creation of such rules, either through M365 audit logs (checking for the `New-InboxRule` cmdlet with the `-RunAnApplication` parameter) or by monitoring the endpoint registry where rule data is stored and scanning for keywords like `.exe` or `.vbs`.",Windows Event ID 4657; Windows Event ID 4663; Microsoft 365 Unified Audit Log; User workstations; Microsoft Exchange servers; Office 365 tenant,last 90 days,: SEARCH M365 audit logs for 'New-InboxRule' with '-RunAnApplication' parameter. OR MONITOR registry modifications (4657) for Outlook rules and scan content for script/executable keywords. ALERT on match.,playbooks/attack/enterprise/T1137.yml
T1137: Office Application Startup,b1d4f2e8-c9a1-4b7e-9d0f-5a2c8f6b3e1d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0003: Persistence,n; o; n; e,17,"Are there any new Outlook rules with suspicious names, or is any user creating an unusually high number of rules?","This question uses statistical methods to find suspicious Outlook rules. Adversaries often use inconspicuous or obfuscated names for their malicious rules, such as a single dot '.' or a high-entropy random string, to evade detection. This query flags rules with such names. Additionally, it tracks the rate of rule creation per user and alerts on a sudden spike, which could indicate automated rule creation by malware.",Windows Event ID 4657; Windows Event ID 4663; Microsoft 365 Unified Audit Log; User workstations; Microsoft Exchange servers; Office 365 tenant,last 90 days,: CALCULATE entropy of new Outlook rule names. ALERT on entropy > 99th percentile or non-alphanumeric names. TRACK rule creation rate per user. ALERT if rate > 3 standard deviations from user's baseline.,playbooks/attack/enterprise/T1137.yml
T1137: Office Application Startup,b1d4f2e8-c9a1-4b7e-9d0f-5a2c8f6b3e1d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0003: Persistence,n; o; n; e,18,"Is there an anomalous spike in Outlook rule creation activity, or can we predict if a rule is malicious based on its properties?","This question applies machine learning to detect malicious rule activity. A time-series model can monitor the overall volume of rule modifications across the organization and alert on unusual spikes that might indicate a widespread campaign. Separately, a classification model could be trained on features like rule name entropy, the type of action (e.g., run application vs. move to folder), and condition complexity to predict the likelihood that a specific rule is malicious.",Windows Event ID 4657; Windows Event ID 4663; Microsoft 365 Unified Audit Log; User workstations; Microsoft Exchange servers; Office 365 tenant,last 90 days,": MODEL time-series of Outlook rule modifications (New-InboxRule, Set-InboxRule). ALERT on anomalous spikes. OR MODEL classification of rules based on features (name entropy, action type) to predict maliciousness.",playbooks/attack/enterprise/T1137.yml
T1190: Exploit Public-Facing Application,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0001: Initial Access,n; o; n; e,1,Has network traffic targeting our public-facing services matched signatures of known exploits?,"This question aims to detect direct exploitation attempts by matching network traffic against a database of signatures for known vulnerabilities (e.g., specific CVEs). A positive match from an Intrusion Detection/Prevention System (IDS/IPS) is a high-fidelity indicator of a targeted attack against a specific service, providing a clear and immediate signal for investigation.","Zeek conn.log; Zeek http.log; IDS/IPS Alerts; DMZ; Network Gateway; External-facing servers (VPN, Citrix, etc.)",last 90 days,: SEARCH IDS/IPS logs FOR alert.signature MATCHING known_cve_patterns AND destination.ip IN public_services_ip_list,playbooks/attack/enterprise/T1190.yml
T1190: Exploit Public-Facing Application,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0001: Initial Access,n; o; n; e,2,"Are there any web requests to our public-facing services with unusually high URI or parameter entropy, suggesting scanning or fuzzing?","This question looks for automated scanning or fuzzing attempts. Attackers often use tools that generate long, random, or complex strings in URIs and parameters to discover vulnerabilities. These requests have a higher character entropy than normal human-generated traffic. Detecting requests with entropy scores that are statistical outliers compared to an established baseline can proactively identify pre-exploitation probing.","Zeek conn.log; Zeek http.log; DMZ; Network Gateway; External-facing servers (VPN, Citrix, etc.)",last 90 days,: SEARCH http.logs | CALCULATE entropy of uri_path and uri_query | ALERT where entropy > baseline_99th_percentile,playbooks/attack/enterprise/T1190.yml
T1190: Exploit Public-Facing Application,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0001: Initial Access,n; o; n; e,3,Have our remote services experienced a volume of connection attempts that significantly exceeds the predicted normal levels?,"This question seeks to identify brute-force attacks or large-scale scanning by analyzing connection volumes. A time-series model can predict the expected number of connections to a service based on historical patterns. When the actual observed volume significantly surpasses the model's prediction, it indicates an anomalous event that could be a coordinated attack.","Zeek conn.log; Zeek http.log; DMZ; Network Gateway; External-facing servers (VPN, Citrix, etc.)",last 90 days,: FORECAST connection_count by port using time-series_model | ALERT if actual_count > predicted_upper_bound,playbooks/attack/enterprise/T1190.yml
T1190: Exploit Public-Facing Application,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0001: Initial Access,n; o; n; e,4,Have any of our public-facing applications been accessed by IP addresses known to be malicious?,"This question provides a high-confidence method for identifying threats by cross-referencing inbound connection logs with threat intelligence feeds. A successful connection from an IP address with a known bad reputation (e.g., associated with botnets, scanners, or previous attacks) to a public-facing asset is a strong indicator of malicious intent.",Zeek conn.log; Zeek signatures.log; Threat Intelligence Feeds; Network perimeter firewalls; DMZ network segments; Internet-facing web servers,last 90 days,": SEARCH conn.logs where conn_state is not ""REJ"" | JOIN source.ip with threat_intel_feed | ALERT on match",playbooks/attack/enterprise/T1190.yml
T1190: Exploit Public-Facing Application,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0001: Initial Access,n; o; n; e,5,Has any single source IP triggered an unusual number of high-severity CVE-related IDS signatures in a short time frame?,"This question helps to distinguish targeted attacks from random internet background noise. While a single IDS alert could be a false positive, an IP address that repeatedly triggers a specific high-severity signature in a short period is likely performing a deliberate and targeted scan or exploit attempt against that particular vulnerability.",Zeek conn.log; Zeek signatures.log; Network perimeter firewalls; DMZ network segments; Cloud security group flow logs,last 90 days,: SEARCH signatures.logs for high-severity CVEs | COUNT signature_id by source.ip over 1-hour window | ALERT if count > 3_std_dev_from_mean,playbooks/attack/enterprise/T1190.yml
T1190: Exploit Public-Facing Application,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0001: Initial Access,n; o; n; e,6,"Are there incoming network connections that a machine learning model classifies as a ""suspicious-exploit-attempt""?","This question leverages a supervised machine learning model, trained on historical data, to identify suspicious connections that may not trigger traditional signatures. By analyzing a combination of features (e.g., port, protocol, duration, data size), the model can flag new or evolving attack techniques that deviate from established benign patterns.",Zeek conn.log; Zeek signatures.log; Network perimeter firewalls; VPN concentrators,last 90 days,": STREAM conn.logs to classification_model | ALERT if prediction is ""suspicious-exploit-attempt""",playbooks/attack/enterprise/T1190.yml
T1190: Exploit Public-Facing Application,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0001: Initial Access,n; o; n; e,7,Are there any HTTP requests containing patterns of known scanners or common web attack payloads like SQLi or LFI?,"This question involves searching for tell-tale signs of web attacks within HTTP traffic. By using regular expressions to scan URIs, user agents, and POST bodies for strings associated with scanning tools (e.g., 'sqlmap', 'nmap') or common exploit payloads (e.g., '../', '<script>'), analysts can detect active reconnaissance or exploitation attempts.",Zeek http.log; Zeek files.log; Web Application Firewalls (WAFs); Public-facing web servers; Reverse proxies,last 90 days,": SEARCH http.logs where uri OR user_agent OR post_body MATCHES regex(""sqlmap|nmap|../|<script>"")",playbooks/attack/enterprise/T1190.yml
T1190: Exploit Public-Facing Application,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0001: Initial Access,n; o; n; e,8,Has a web server process spawned a command shell or an unexpected utility?,"This is a critical question for detecting post-exploitation activity. A web server process (like w3wp.exe or httpd.exe) should not be spawning command-line interpreters (cmd.exe, bash) or network reconnaissance tools (whoami.exe, net.exe). Such an event is a very strong indicator that an attacker has successfully exploited the server and is executing commands.",Windows Event ID 4688; Sysmon Event ID 1; Public-facing web servers; Application servers in the DMZ; Container hosts running public applications,last 90 days,": SEARCH process_creation_logs WHERE parent_process IN (""w3wp.exe"", ""httpd.exe"") AND child_process IN (""cmd.exe"", ""powershell.exe"", ""whoami.exe"")",playbooks/attack/enterprise/T1190.yml
T1190: Exploit Public-Facing Application,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0001: Initial Access,n; o; n; e,9,Have we observed a rare or never-before-seen parent-child process relationship on a public-facing server?,"This question aims to detect anomalous behavior by baselining normal process activity. By tracking all parent-child process relationships over time, the system can identify when a new or extremely infrequent relationship occurs. For example, if a web server suddenly spawns a process it has never spawned before, it is highly suspicious and warrants immediate investigation.",Windows Event ID 4688; Sysmon Event ID 1; Public-facing web servers; Application servers in the DMZ,last 90 days,: SEARCH process_creation_logs | LOOKUP parent_child_pair in historical_baseline | ALERT if pair is new OR frequency < 1st_percentile,playbooks/attack/enterprise/T1190.yml
T1190: Exploit Public-Facing Application,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0001: Initial Access,n; o; n; e,10,"Has a public-facing server initiated an outbound connection to a new or unusual destination port or country, or transferred an anomalously large amount of data?","This question focuses on detecting command-and-control (C2) communication or data exfiltration. Public-facing servers typically have predictable outbound traffic patterns. An alert on a connection to a never-before-seen country or a non-standard port, or a transfer of an unusually large volume of data, can indicate that a compromised server is communicating with an attacker.",Zeek conn.log; Zeek dns.log; Windows Event ID 5156; DMZ network segments; Egress points of the network; Host-based firewalls on public-facing servers,last 90 days,: SEARCH outbound conn.logs from public_servers | ALERT if destination.port or destination.country is not in baseline OR bytes_transferred > baseline_99th_percentile,playbooks/attack/enterprise/T1190.yml
T1190: Exploit Public-Facing Application,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0001: Initial Access,n; o; n; e,11,Has there been a sudden spike in server-side errors (HTTP 5xx) for a specific application?,This question investigates application health as an indicator of attack. A sudden increase in HTTP 5xx errors can mean an attacker's malformed requests are causing the application to crash. Monitoring for a high volume of these errors within a short time window can be an early warning sign of an ongoing exploit attempt.,"Zeek http.log; Application error logs (e.g., Apache error.log, IIS Failed Request Tracing); Public-facing web servers; Web Application Firewalls (WAFs); Load balancers",last 90 days,: SEARCH http.logs | COUNT by status_code over 1-minute window | ALERT if status_code >= 500 AND count > 50,playbooks/attack/enterprise/T1190.yml
T1190: Exploit Public-Facing Application,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0001: Initial Access,n; o; n; e,12,"Has the mix of HTTP request methods (GET, POST, etc.) for an application significantly changed compared to its normal baseline?","This question uses statistical analysis to find deviations in user behavior. Normal users create a predictable distribution of HTTP methods (e.g., mostly GETs, some POSTs). A scanning tool or an exploit might cause a significant shift in this distribution (e.g., a spike in HEAD or PUT requests). A Chi-squared test can statistically validate if the current traffic pattern is anomalous compared to a historical baseline.",Zeek http.log; Application error logs; Public-facing web servers; WAFs; Load balancers,last 90 days,: COMPARE hourly HTTP method distribution to 7-day baseline using Chi-squared test | ALERT if result is statistically significant,playbooks/attack/enterprise/T1190.yml
T1200: Hardware Additions,8f9a2b1c-3d4e-4f5a-6b7c-8d9e0f1a2b3c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0001: Initial Access,n; o; n; e,1,Is there evidence of a malicious driver or service being installed immediately after a new hardware connection?,"This question aims to detect adversaries using malicious hardware that installs a persistent backdoor or payload. By correlating hardware connection events (Windows Event ID 6416) with the subsequent creation of new drivers or services (Windows Event ID 7045), we can examine the associated executable files. If the file's hash is known to be malicious via threat intelligence, or if it's signed by an untrusted or revoked certificate, it's a strong indicator of compromise.","Windows Event ID 7045; Windows Event ID 6416; Sysmon Event ID 6; All corporate endpoint devices (laptops, desktops, servers), particularly those in sensitive areas like data centers or executive suites.",last 90 days,: SEARCH for (Windows Event ID 6416 OR Windows Event ID 7045) and related file creation events. EXTRACT file hash and certificate details. CHECK file hash against threat intelligence feeds. CHECK certificate against a deny list. ALERT on match.,playbooks/attack/enterprise/T1200.yml
T1200: Hardware Additions,8f9a2b1c-3d4e-4f5a-6b7c-8d9e0f1a2b3c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0001: Initial Access,n; o; n; e,2,"Are newly installed drivers exhibiting unusually high entropy, suggesting they are packed or encrypted?","Malicious payloads are often packed or encrypted to evade static analysis. This results in high entropy (randomness) in the file. This question involves calculating the entropy of all new driver files associated with hardware installations (Sysmon Event ID 6) and comparing it to a baseline of known-good drivers. A significant deviation from the norm (e.g., 3 standard deviations above the mean) can indicate a suspicious file that requires further investigation.","Windows Event ID 7045; Windows Event ID 6416; Sysmon Event ID 6; All corporate endpoint devices (laptops, desktops, servers), particularly those in sensitive areas like data centers or executive suites.",last 90 days,": ON new driver file creation (Sysmon Event ID 6), CALCULATE file entropy. COMPARE entropy value to a pre-calculated baseline of legitimate driver entropy. ALERT if the value exceeds the baseline threshold (e.g., mean + 3 * standard deviation).",playbooks/attack/enterprise/T1200.yml
T1200: Hardware Additions,8f9a2b1c-3d4e-4f5a-6b7c-8d9e0f1a2b3c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0001: Initial Access,n; o; n; e,3,Does a machine learning model classify newly installed drivers as suspicious based on their file features?,"This question leverages machine learning to automate the detection of malicious drivers. A model, such as a random forest classifier, can be trained on various features extracted from driver files (e.g., file size, entropy, imported functions, digital signature status, signer reputation). When a new driver is installed, these features are extracted and fed to the model. A 'suspicious' classification from the model triggers an alert for an analyst to review.","Windows Event ID 7045; Windows Event ID 6416; Sysmon Event ID 6; All corporate endpoint devices (laptops, desktops, servers), particularly those in sensitive areas like data centers or executive suites.",last 90 days,": ON new driver installation, EXTRACT features (file size, entropy, imports, signature). INPUT features into trained random forest model. ALERT if classification is 'suspicious' with high confidence.",playbooks/attack/enterprise/T1200.yml
T1200: Hardware Additions,8f9a2b1c-3d4e-4f5a-6b7c-8d9e0f1a2b3c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0001: Initial Access,n; o; n; e,4,Is a host initiating network connections to known malicious destinations shortly after a new hardware device is connected?,"Malicious hardware may immediately 'call home' to an adversary's command and control (C2) server. This question involves correlating a new device installation event (Windows Event ID 6416) on a host with its subsequent network activity within a short time frame (e.g., 5 minutes). If the host connects to a destination IP, domain, or TLS server name that is present on a threat intelligence feed, it is a strong signal of malicious activity.","Zeek conn.log; Zeek dns.log; Zeek ssl.log; Windows Event ID 6416; Network egress points, DNS resolvers, and endpoint devices.",last 90 days,": SEARCH for new device installation (Windows Event ID 6416). Within a 5-minute window, monitor network logs (Zeek) from that host. CHECK destination IP, DNS query, and TLS server name against threat intelligence feeds. ALERT on match.",playbooks/attack/enterprise/T1200.yml
T1200: Hardware Additions,8f9a2b1c-3d4e-4f5a-6b7c-8d9e0f1a2b3c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0001: Initial Access,n; o; n; e,5,"Following a device installation, is the host making network connections that are rare or anomalous for the enterprise?","Adversaries often use infrastructure that has not been seen before in the target environment. Instead of relying solely on known-bad indicators, this question focuses on rarity. After a device installation, we analyze the subsequent network connections from that host. By calculating the enterprise-wide prevalence of the destination IP, requested domain, and JA3 hash, we can identify connections that are highly unusual. A combination of rare indicators can generate a risk score, triggering an alert for review.","Zeek conn.log; Zeek dns.log; Zeek ssl.log; Windows Event ID 6416; Network egress points, DNS resolvers, and endpoint devices.",last 90 days,": ON new device installation, within 5 minutes, CALCULATE enterprise-wide prevalence of destination IP, domain, and JA3 hash from the host's network traffic. GENERATE a risk score based on rarity. ALERT if the score exceeds a defined threshold.",playbooks/attack/enterprise/T1200.yml
T1200: Hardware Additions,8f9a2b1c-3d4e-4f5a-6b7c-8d9e0f1a2b3c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0001: Initial Access,n; o; n; e,6,Is there an anomalous spike in outbound network traffic volume from a host immediately after a new hardware device is connected?,"A malicious hardware device might initiate data exfiltration or download a larger second-stage payload, causing a sudden increase in network traffic. This question applies time-series anomaly detection models (like ARIMA) to a host's outbound traffic volume. An alert is triggered if an anomalous spike is detected immediately following a hardware installation event, prompting further inspection of the traffic.","Zeek conn.log; Zeek dns.log; Zeek ssl.log; Windows Event ID 6416; Network egress points, DNS resolvers, and endpoint devices.",last 90 days,": APPLY a time-series anomaly detection model to a host's outbound network traffic volume. ON new hardware installation (Windows Event ID 6416), check for a detected anomalous spike. ALERT on anomaly.",playbooks/attack/enterprise/T1200.yml
T1200: Hardware Additions,8f9a2b1c-3d4e-4f5a-6b7c-8d9e0f1a2b3c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0001: Initial Access,n; o; n; e,7,Is a new device requesting a DHCP lease using a MAC address or hostname associated with known offensive security hardware?,"Specialized offensive hardware often has default hostnames or uses MAC addresses from specific vendor blocks (OUIs). This question involves monitoring DHCP logs (e.g., Zeek dhcp.log) for new requests. If the MAC address's OUI or the client hostname matches a curated list of known penetration testing or hacking hardware (like Hak5, Pwnie Express, Flipper), an alert should be generated for immediate investigation.","Zeek dhcp.log; Zeek conn.log; Core network switches, DHCP servers, and wireless network segments.",last 90 days,: MONITOR DHCP logs for new requests. EXTRACT MAC address and hostname. COMPARE the OUI (from MAC) and hostname against a list of known offensive hardware identifiers. ALERT on match.,playbooks/attack/enterprise/T1200.yml
T1200: Hardware Additions,8f9a2b1c-3d4e-4f5a-6b7c-8d9e0f1a2b3c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0001: Initial Access,n; o; n; e,8,Is a new DHCP request exhibiting an anomalous MAC address vendor (OUI) or hostname structure compared to the baseline?,"This question seeks to identify unknown or custom offensive hardware by looking for statistical anomalies in DHCP requests. By profiling the typical distribution of OUIs and hostname structures (length, character sets, patterns) across the network, we can score each new DHCP request for rarity. A request with a never-before-seen OUI and an unusual hostname syntax would receive a high anomaly score, indicating a potentially unauthorized device.","Zeek dhcp.log; Zeek conn.log; Core network switches, DHCP servers, and wireless network segments.",last 90 days,": PROFILE legitimate DHCP requests to create a baseline of OUI distribution and hostname syntax. ON new DHCP request, calculate an anomaly score based on its OUI and hostname structure against the baseline. ALERT on high score.",playbooks/attack/enterprise/T1200.yml
T1200: Hardware Additions,8f9a2b1c-3d4e-4f5a-6b7c-8d9e0f1a2b3c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0001: Initial Access,n; o; n; e,9,Does a machine learning model (isolation forest) identify a new DHCP request as an outlier based on its features?,"This question uses an unsupervised machine learning model, like an isolation forest, to detect anomalous DHCP requests. The model is trained on features from legitimate DHCP requests (OUI, hostname length, character distribution). It can then identify new requests that do not conform to the learned profile of 'normal' activity, flagging them as outliers for investigation. This is effective at finding novel or unusual devices without relying on predefined signatures.","Zeek dhcp.log; Zeek conn.log; Core network switches, DHCP servers, and wireless network segments.",last 90 days,: TRAIN an isolation forest model on features of legitimate DHCP requests. USE the model to score new DHCP requests. ALERT if a request is identified as an outlier.,playbooks/attack/enterprise/T1200.yml
T1200: Hardware Additions,8f9a2b1c-3d4e-4f5a-6b7c-8d9e0f1a2b3c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0001: Initial Access,n; o; n; e,10,"Following a new HID connection, is a process created with command-line arguments indicative of a keystroke injection attack?","Adversaries can use malicious Human Interface Devices (HIDs), like a Rubber Ducky, to inject keystrokes that execute commands. This question correlates a new HID connection with subsequent process creation events (e.g., powershell.exe, cmd.exe) within seconds. The command line is inspected for high-risk indicators of keystroke injection payloads, such as `-enc`, `IEX`, `DownloadString`, or other obfuscation techniques.","Windows Event ID 4688; Windows Event ID 6416; Sysmon Event ID 1; All corporate endpoint devices, especially workstations in common areas or those used by privileged users.",last 90 days,": SEARCH for new HID connection. Within 10 seconds, look for process creation (powershell.exe, cmd.exe). ANALYZE command line for suspicious substrings like '-enc', 'IEX', 'DownloadString'. ALERT on match.",playbooks/attack/enterprise/T1200.yml
T1200: Hardware Additions,8f9a2b1c-3d4e-4f5a-6b7c-8d9e0f1a2b3c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0001: Initial Access,n; o; n; e,11,"Does a command line executed shortly after a new HID connection have unusually high entropy, suggesting obfuscation?","Keystroke injection payloads often use encoding (like Base64) to bypass simple keyword-based detections, which results in a high-entropy command-line string. This question involves calculating the entropy of any command line executed within 10 seconds of a new HID connection. If the entropy value is in the 99th percentile of typical command-line entropy, it strongly suggests obfuscation and should be flagged for review.","Windows Event ID 4688; Windows Event ID 6416; Sysmon Event ID 1; All corporate endpoint devices, especially workstations in common areas or those used by privileged users.",last 90 days,": ON new HID connection, within 10 seconds, CALCULATE entropy of any spawned process command line. COMPARE to a baseline of normal command-line entropy. ALERT if entropy is in the 99th percentile.",playbooks/attack/enterprise/T1200.yml
T1200: Hardware Additions,8f9a2b1c-3d4e-4f5a-6b7c-8d9e0f1a2b3c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0001: Initial Access,n; o; n; e,12,Does an NLP model classify a command line executed immediately after a HID connection as malicious?,"This question applies advanced natural language processing (NLP) to command-line analysis. A sophisticated transformer-based model, pre-trained on a vast dataset of benign and malicious commands, can classify new command lines with high accuracy. Any command executed immediately after a HID connection is fed to the model. An alert is generated if the model classifies the command as malicious with high confidence, providing a powerful detection method for novel or complex injection attacks.","Windows Event ID 4688; Windows Event ID 6416; Sysmon Event ID 1; All corporate endpoint devices, especially workstations in common areas or those used by privileged users.",last 90 days,": ON new HID connection, within 10 seconds, pass any spawned command line to a pre-trained NLP classification model. ALERT if the model returns 'malicious' with >90% confidence.",playbooks/attack/enterprise/T1200.yml
T1200: Hardware Additions,8f9a2b1c-3d4e-4f5a-6b7c-8d9e0f1a2b3c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0001: Initial Access,n; o; n; e,13,Is a new MAC address observed on the network that is not registered in the asset management system?,"This is a fundamental security hygiene check to detect unauthorized devices. The question involves periodically extracting all unique MAC addresses seen in network logs (DHCP, general traffic) and comparing them against an authoritative list of approved MAC addresses from a CMDB or NAC system. Any MAC address found on the network but not in the approved list should trigger an alert for an unauthorized device.","Zeek dhcp.log; Zeek conn.log; Asset Management System Data (CSV/DB); Network infrastructure (DHCP servers, core switches), Asset Management Database, Network Access Control (NAC) systems.",last 90 days,": SCHEDULED JOB (e.g., every 15 mins): EXTRACT unique MACs from network logs. JOIN against approved MACs from asset database. ALERT on any MAC present in logs but not in the database.",playbooks/attack/enterprise/T1200.yml
T1200: Hardware Additions,8f9a2b1c-3d4e-4f5a-6b7c-8d9e0f1a2b3c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0001: Initial Access,n; o; n; e,14,"Is there an anomalous increase in the number of new, unregistered MAC addresses appearing on the network?","While a single unregistered device is a concern, a sudden flood of them could indicate a more significant event, such as an adversary connecting multiple devices or a physical breach. This question involves tracking the count of new, unregistered MAC addresses over time (e.g., hourly). By establishing a baseline using a moving average, an alert can be triggered if the hourly count suddenly exceeds a statistical threshold (e.g., 3 standard deviations above the mean).","Zeek dhcp.log; Zeek conn.log; Asset Management System Data (CSV/DB); Network infrastructure (DHCP servers, core switches), Asset Management Database, Network Access Control (NAC) systems.",last 90 days,": TRACK the hourly count of new, unregistered MAC addresses. ESTABLISH a baseline with a 7-day moving average. ALERT if the hourly count exceeds 3 standard deviations above the average.",playbooks/attack/enterprise/T1200.yml
T1200: Hardware Additions,8f9a2b1c-3d4e-4f5a-6b7c-8d9e0f1a2b3c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0001: Initial Access,n; o; n; e,15,"Does the number of new, unregistered devices significantly exceed the forecasted amount for a given period?","Organizations have natural rhythms for adding new devices, such as onboarding new employees. This question uses a time-series forecasting model (like Prophet or LSTM) to predict the expected number of new, unregistered devices, accounting for these seasonal trends. An alert is generated only when the actual number of new devices significantly surpasses the model's predicted upper confidence bound, indicating a truly anomalous event rather than expected business activity.","Zeek dhcp.log; Zeek conn.log; Asset Management System Data (CSV/DB); Network infrastructure (DHCP servers, core switches), Asset Management Database, Network Access Control (NAC) systems.",last 90 days,": USE a forecasting model (e.g., Prophet) to predict the daily number of new unregistered devices. ALERT if the actual count significantly exceeds the model's forecasted upper confidence interval.",playbooks/attack/enterprise/T1200.yml
T1200: Hardware Additions,8f9a2b1c-3d4e-4f5a-6b7c-8d9e0f1a2b3c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0001: Initial Access,n; o; n; e,16,"Following a new hardware connection, is a process created with an unusual or suspicious parent-child relationship?","Malicious hardware drivers or payloads may launch processes in a way that deviates from normal system behavior. This question involves creating a correlation that looks for a new device connection (Windows Event ID 6416) followed quickly by a process creation (Sysmon Event ID 1) with an anomalous parent-child relationship (e.g., services.exe spawning cmd.exe, which is highly irregular). This is a strong indicator that the new hardware triggered a malicious action.","Windows Event ID 4688; Windows Event ID 5156; Windows Event ID 6416; Sysmon Event ID 1; Sysmon Event ID 3; All corporate endpoint devices, Security Information and Event Management (SIEM) system.",last 90 days,": ON new device connection (Event ID 6416), within 60 seconds, CHECK for process creation (Sysmon ID 1) with a parent-child relationship that is on a list of known-bad or rare pairs. ALERT on match.",playbooks/attack/enterprise/T1200.yml
T1200: Hardware Additions,8f9a2b1c-3d4e-4f5a-6b7c-8d9e0f1a2b3c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0001: Initial Access,n; o; n; e,17,"After a new hardware event, is a legitimate system process exhibiting uncharacteristic behavior, such as an unusual parent or a new type of network connection?","Adversaries often abuse legitimate system processes to hide their activity. This question focuses on profiling the normal behavior of every process on an endpoint (e.g., its typical parent, its network destinations). After a new hardware event, any subsequent process activity is scored for anomalies. A high score, generated if a process like svchost.exe is launched by an unusual parent or makes a network connection to a rare IP, indicates potential compromise.","Windows Event ID 4688; Windows Event ID 5156; Windows Event ID 6416; Sysmon Event ID 1; Sysmon Event ID 3; All corporate endpoint devices, Security Information and Event Management (SIEM) system.",last 90 days,": MAINTAIN profiles of normal process behavior (parent process, network connections). ON new hardware event, score subsequent process activity (Sysmon ID 1, 3) for deviations from its profile. ALERT on high anomaly score.",playbooks/attack/enterprise/T1200.yml
T1200: Hardware Additions,8f9a2b1c-3d4e-4f5a-6b7c-8d9e0f1a2b3c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0001: Initial Access,n; o; n; e,18,Does a graph-based analysis of system activity following a new hardware event reveal an anomalous sequence of events?,"Modern attacks are often a chain of seemingly disparate events. This question uses a graph-based model where nodes represent entities like processes, files, and network connections. By training the model on graphs of normal system activity, it can learn benign patterns. When a new hardware event occurs, the subgraph of subsequent activity is analyzed. The model can identify anomalous sequences (e.g., new device -> process creation -> registry run key modification) that deviate from normal behavior.","Windows Event ID 4688; Windows Event ID 5156; Windows Event ID 6416; Sysmon Event ID 1; Sysmon Event ID 3; All corporate endpoint devices, Security Information and Event Management (SIEM) system.",last 90 days,": AFTER a new hardware event, CONSTRUCT a graph of subsequent process, file, and network activity. ANALYZE the graph for sequences that deviate from a trained model of benign patterns. ALERT on anomalous sequences.",playbooks/attack/enterprise/T1200.yml
T1201: Password Policy Discovery,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0007: Discovery,n; o; n; e,1,Is a process being created with a file hash known to be associated with malicious discovery tools?,"This question aims to identify the execution of known malicious discovery tools like PowerSploit or BloodHound by matching process creation event file hashes against a threat intelligence feed. A match is a high-fidelity indicator of malicious activity and warrants immediate response, such as host quarantine.",Windows Security Event ID 4688; Sysmon Event ID 1; Domain Controllers; Member Servers; Privileged Access Workstations,last 90 days,: SEARCH process_creation_events | JOIN file_hash with threat_intel_feed | WHERE threat_intel_match=true,playbooks/attack/enterprise/T1201.yml
T1201: Password Policy Discovery,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0007: Discovery,n; o; n; e,2,Are there any rarely seen executables running with command-line arguments related to password policy discovery?,"This question helps uncover unknown or custom discovery tools by focusing on low-prevalence executables. Adversaries often use tools that are not widespread in the environment. Combining low prevalence with suspicious command-line keywords ('policy', 'password', 'net', 'accounts') helps to filter out noise and pinpoint potential threats.",Windows Security Event ID 4688; Sysmon Event ID 1; Domain Controllers; Member Servers; Privileged Access Workstations,last 30 days,": SEARCH process_creation_events | CALCULATE prevalence of file_hash | WHERE prevalence < 1% AND command_line CONTAINS ('policy', 'password', 'net', 'accounts')",playbooks/attack/enterprise/T1201.yml
T1201: Password Policy Discovery,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0007: Discovery,n; o; n; e,3,"Can machine learning classify a newly observed, unknown executable as a malicious discovery tool based on its execution characteristics?","This question leverages machine learning to proactively identify novel threats. By training a model on the features of known-good and known-bad tools, it can predict the maliciousness of new executables that haven't been seen before, based on context like parent process, user, and file path entropy.",Windows Security Event ID 4688; Sysmon Event ID 1; Domain Controllers; Member Servers; Privileged Access Workstations,last 90 days,": INPUT process_creation_features (parent_process, user, etc.) INTO classification_model | OUTPUT prediction (benign/malicious)",playbooks/attack/enterprise/T1201.yml
T1201: Password Policy Discovery,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0007: Discovery,n; o; n; e,4,Is a non-administrator user executing known password policy discovery commands?,"This question focuses on detecting the explicit use of built-in or common password policy discovery commands. Since these commands might be used for legitimate administrative purposes, the query filters for executions by users who are not part of a designated administrators group, significantly increasing the likelihood that the activity is malicious.",Windows Security Event ID 4688; Windows PowerShell Event ID 4104; Sysmon Event ID 1; Zeek syslog.log; Domain Controllers; Linux/macOS Servers; End-user Workstations,last 90 days,": SEARCH command_line_logs WHERE command_line MATCHES ('net accounts', 'Get-ADDefaultDomainPasswordPolicy', etc.) AND user NOT IN (admin_group)",playbooks/attack/enterprise/T1201.yml
T1201: Password Policy Discovery,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0007: Discovery,n; o; n; e,5,Is a user executing password policy discovery commands more frequently than their historical baseline or their peer group's baseline?,"This question aims to detect anomalous behavior even from users who might legitimately run discovery commands. By establishing a baseline of normal activity for each user and their peer group, it can flag unusual spikes in execution frequency, which could indicate a compromised account or an insider threat.",Windows Security Event ID 4688; Windows PowerShell Event ID 4104; Sysmon Event ID 1; Zeek syslog.log; Domain Controllers; Linux/macOS Servers; End-user Workstations,last 30 days,": SEARCH discovery_command_executions | GROUP BY user, day | COMPARE daily_count to user_baseline and peer_group_baseline | WHERE daily_count > 99th_percentile",playbooks/attack/enterprise/T1201.yml
T1201: Password Policy Discovery,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0007: Discovery,n; o; n; e,6,Are there any unusual or outlier command-line executions that appear related to password policy discovery?,"This question uses unsupervised machine learning to find novel or obfuscated discovery commands. By clustering all command-line arguments, commands that don't fit into common, large clusters (i.e., outliers) can be isolated. Analyzing these outliers for suspicious keywords can reveal new adversary techniques that would be missed by signature-based rules.",Windows Security Event ID 4688; Windows PowerShell Event ID 4104; Sysmon Event ID 1; Zeek syslog.log; Domain Controllers; Linux/macOS Servers; End-user Workstations,last 90 days,: INPUT command_line_vectors INTO clustering_model (DBSCAN) | IDENTIFY outlier_clusters | ANALYZE outliers for discovery_keywords,playbooks/attack/enterprise/T1201.yml
T1201: Password Policy Discovery,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0007: Discovery,n; o; n; e,7,"Has a password policy discovery command been spawned by an unusual parent process, such as a web browser or office application?",This question seeks to identify suspicious process chains. Legitimate administrative commands are typically spawned from an interactive shell or a management console. A discovery command being launched by an application like Outlook or Chrome is highly anomalous and a strong indicator of a phishing payload or a drive-by download executing a malicious script.,Windows Security Event ID 4688; Windows Security Event ID 4624; Sysmon Event ID 1; End-user Workstations; Application Servers; Domain Controllers,last 90 days,": SEARCH discovery_command_executions | WHERE parent_process IN ('outlook.exe', 'chrome.exe', 'winword.exe', etc.)",playbooks/attack/enterprise/T1201.yml
T1201: Password Policy Discovery,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0007: Discovery,n; o; n; e,8,Is a user executing a password policy discovery command at a time of day or day of week that is unusual for them?,"This question aims to detect activity outside of a user's normal behavior patterns. By modeling each user's typical working hours based on historical process execution data, it's possible to flag policy discovery commands executed at statistically improbable times (e.g., late at night or on a weekend), which could indicate a compromised account.",Windows Security Event ID 4688; Windows Security Event ID 4624; Sysmon Event ID 1; End-user Workstations; Application Servers; Domain Controllers,last 90 days,: SEARCH discovery_command_executions | COMPARE execution_time to user_time_baseline | CALCULATE Z-score | WHERE Z-score > 3.5,playbooks/attack/enterprise/T1201.yml
T1201: Password Policy Discovery,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0007: Discovery,n; o; n; e,9,"Does the context of a password policy discovery command execution (user, parent process, host, time) deviate from established patterns of legitimate administrative activity?","This question uses an anomaly detection model to score the overall context of an event, rather than just a single attribute. An Isolation Forest model, trained on known-good administrative sessions, can identify executions of discovery commands that are anomalous across multiple features simultaneously, providing a more robust detection method.",Windows Security Event ID 4688; Windows Security Event ID 4624; Sysmon Event ID 1; End-user Workstations; Application Servers; Domain Controllers,last 90 days,": INPUT execution_context (user, parent, host, time) INTO isolation_forest_model | OUTPUT anomaly_score | WHERE score > threshold",playbooks/attack/enterprise/T1201.yml
T1201: Password Policy Discovery,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0007: Discovery,n; o; n; e,10,"Following a password policy discovery event, did the same user or host perform additional discovery or credential access activities within a short time frame?","This question looks for attack chaining. Password policy discovery is often a precursor to other malicious actions. By correlating a T1201 event with subsequent discovery or credential access activities by the same user or on the same host, we can identify a developing attack sequence and escalate the priority of the alert.",Windows Security Event ID 4688; Sysmon Event ID 1; Zeek conn.log; All hosts within the enterprise network; network egress points,last 90 days,": SEARCH for T1201_alert | WITHIN 60m ON same user/host, SEARCH for TA0007_or_TA0006_activity | TRIGGER alert if found",playbooks/attack/enterprise/T1201.yml
T1201: Password Policy Discovery,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0007: Discovery,n; o; n; e,11,"Did a password policy discovery event lead to a statistically unlikely follow-on technique, compared to enterprise-wide baselines?","This question uses probabilistic analysis to identify high-risk attack paths. By understanding the normal probability of one technique following another (P(B|A)), we can flag user sessions where a transition from T1201 to a high-impact technique like T1003 (Credential Dumping) occurs with a much higher probability than the baseline.",Windows Security Event ID 4688; Sysmon Event ID 1; Zeek conn.log; All hosts within the enterprise network; network egress points,last 90 days,": CALCULATE P(Technique B | T1201) baseline | FOR each session, IF P(Observed Technique | T1201) >> baseline, THEN increase risk_score",playbooks/attack/enterprise/T1201.yml
T1201: Password Policy Discovery,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0007: Discovery,n; o; n; e,12,Does a sequence of commands including a password policy discovery event appear anomalous when compared to models of benign administrative command sequences?,"This question leverages sequence analysis to understand the narrative of an attack. An LSTM model can learn the typical order of benign command sequences. When a new sequence containing a T1201 event is observed, the model can determine if the entire sequence is probable or anomalous, catching sophisticated attackers who interleave malicious and benign commands.",Windows Security Event ID 4688; Sysmon Event ID 1; Zeek conn.log; All hosts within the enterprise network; network egress points,last 90 days,": INPUT command_sequence INTO LSTM_model | WHERE sequence CONTAINS T1201_event | IF model_probability < threshold, THEN flag as anomalous",playbooks/attack/enterprise/T1201.yml
T1201: Password Policy Discovery,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0007: Discovery,n; o; n; e,13,Is an unauthorized user or IP address attempting to query cloud password policies via API calls?,This question extends discovery detection to cloud environments. This query specifically looks for API calls related to password policy discovery in AWS and Azure and alerts if the request originates from a user or IP that is not on an approved list of administrators or bastion hosts.,Zeek http.log; Zeek syslog.log; Windows PowerShell Event ID 4104; AWS CloudTrail; Azure Activity Logs; Network backbone switches/routers; Cloud IAM infrastructure; Internet gateway,last 90 days,: SEARCH cloud_api_logs for 'GetAccountPasswordPolicy' OR 'Get-MgDomain' | WHERE source_user OR source_ip NOT IN allowlist,playbooks/attack/enterprise/T1201.yml
T1201: Password Policy Discovery,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0007: Discovery,n; o; n; e,14,Is there a sudden focus of DNS queries for cloud identity management domains from a small number of hosts?,"This question aims to detect the preparatory phase of cloud reconnaissance. Normally, DNS requests for cloud IAM endpoints come from varied sources. A sudden drop in the entropy (randomness) of source IPs suggests that one or a few hosts are performing targeted enumeration, a potential indicator of an impending attack.",Zeek http.log; Zeek syslog.log; Windows PowerShell Event ID 4104; AWS CloudTrail; Azure Activity Logs; Network backbone switches/routers; Cloud IAM infrastructure; Internet gateway,last 90 days,: SEARCH DNS_logs for cloud_IAM_domains | CALCULATE entropy of source_IPs per hour | ALERT if entropy drops > 50% from baseline,playbooks/attack/enterprise/T1201.yml
T1201: Password Policy Discovery,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0007: Discovery,n; o; n; e,15,Is there an anomalous spike in the volume of API calls related to cloud password policies?,"This question uses time series analysis to detect unusual volumes of activity. By forecasting the expected number of password policy API calls, the model can automatically flag any significant deviation from the norm. This can catch brute-force or large-scale programmatic reconnaissance that might otherwise be missed in a high-volume environment.",Zeek http.log; Zeek syslog.log; Windows PowerShell Event ID 4104; AWS CloudTrail; Azure Activity Logs; Network backbone switches/routers; Cloud IAM infrastructure; Internet gateway,last 90 days,: MODEL volume of cloud_policy_API_calls with ARIMA | ALERT if current_volume > upper_confidence_bound,playbooks/attack/enterprise/T1201.yml
T1202: Indirect Command Execution,a4b1c23d-4e56-4789-a0b1-c2d3e4f5a6b7,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,1,"Has a process associated with indirect command execution (e.g., forfiles.exe, pcalua.exe) spawned a child process whose hash is known to be malicious?",This question uses a high-fidelity symbolic logic rule to detect when a utility associated with T1202 (like forfiles.exe) creates a child process whose file hash matches an entry in a threat intelligence feed. A positive match is a strong indicator that a known malicious payload is being executed via a legitimate proxy utility to bypass defenses.,Windows Event ID 4688; Sysmon Event ID 1; Domain Controllers; Member Servers; User Workstations; Privileged Access Workstations (PAWs); Application Servers,last 90 days,"pseudocode: SEARCH process_creation_events WHERE (parent_process_name IN ('forfiles.exe', 'pcalua.exe', 'scriptrunner.exe', 'ssh.exe') AND child_process_hash IN threat_intelligence_feed)",playbooks/attack/enterprise/T1202.yml
T1202: Indirect Command Execution,a4b1c23d-4e56-4789-a0b1-c2d3e4f5a6b7,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,2,Has a statistically rare parent-child process relationship involving an indirect command execution utility been observed?,"This question aims to detect unknown or novel threats by statistically analyzing process relationships. It involves baselining the frequency of all child processes spawned by T1202-related parent processes over 90 days. An alert is triggered for parent-child pairs that are exceptionally rare (e.g., in the bottom 5th percentile), especially if the child process name has high entropy, suggesting it may be a randomly named malware executable.",Windows Event ID 4688; Sysmon Event ID 1; Domain Controllers; Member Servers; User Workstations; Privileged Access Workstations (PAWs); Application Servers,last 90 days,pseudocode: FOR each T1202_utility: CALCULATE frequency_distribution of child_processes over 90_days. ALERT if new_process_pair_frequency < 5th_percentile.,playbooks/attack/enterprise/T1202.yml
T1202: Indirect Command Execution,a4b1c23d-4e56-4789-a0b1-c2d3e4f5a6b7,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,3,Can a machine learning model identify a malicious process creation event originating from an indirect command execution utility?,"This question leverages a supervised machine learning model to provide a more nuanced and context-aware detection than simple rules. The model is trained on labeled historical data, using features like process names, command-line length, keyword counts, and execution directory, to learn the characteristics of malicious versus benign process creation events following indirect command execution.",Windows Event ID 4688; Sysmon Event ID 1; Domain Controllers; Member Servers; User Workstations; Privileged Access Workstations (PAWs); Application Servers,last 90 days,"pseudocode: PREDICT is_malicious from process_creation_event_features (parent_name, child_entropy, cmd_line_length, etc.) using trained_classification_model. ALERT if prediction is 'malicious' with high confidence.",playbooks/attack/enterprise/T1202.yml
T1202: Indirect Command Execution,a4b1c23d-4e56-4789-a0b1-c2d3e4f5a6b7,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,4,"Has an indirect command execution utility (e.g., forfiles.exe, pcalua.exe) been run with command-line arguments matching known malicious patterns?","This question focuses on identifying the misuse of T1202 utilities by searching for specific, known-malicious command-line patterns. Using regular expressions on process creation event data, this method can quickly spot documented abuse techniques, such as 'forfiles /c' or 'pcalua -a', providing a reliable, signature-based detection for common attacks.",Windows Event ID 4688; Sysmon Event ID 1; Domain Controllers; Member Servers; User Workstations; Jump Servers,last 90 days,"pseudocode: SEARCH process_creation_events WHERE command_line MATCHES REGEX ('forfiles\.exe /p .* /c', 'pcalua\.exe -a .*', etc.)",playbooks/attack/enterprise/T1202.yml
T1202: Indirect Command Execution,a4b1c23d-4e56-4789-a0b1-c2d3e4f5a6b7,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,5,Has an indirect command execution utility been executed with an unusually long or complex command line compared to its historical baseline?,"This question seeks to identify anomalous command-line usage by establishing a statistical baseline. By profiling the normal length and argument count for T1202 utilities over a 30-day period, we can flag executions that exceed a high percentile (e.g., 95th or 99th) of this baseline. Such deviations often indicate an adversary is passing complex, obfuscated, or multi-stage commands through the utility.",Windows Event ID 4688; Sysmon Event ID 1; Domain Controllers; Member Servers; User Workstations; Jump Servers,last 90 days,pseudocode: FOR each T1202_utility: CALCULATE baseline of cmd_line_length and arg_count. ALERT if new_execution > 95th_percentile.,playbooks/attack/enterprise/T1202.yml
T1202: Indirect Command Execution,a4b1c23d-4e56-4789-a0b1-c2d3e4f5a6b7,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,6,Can a machine learning model identify anomalous command-line usage for an indirect command execution utility by clustering legitimate patterns?,"This question applies unsupervised machine learning to find novel attack patterns without relying on predefined signatures. By vectorizing command-line arguments (using TF-IDF) and clustering them (using DBSCAN), the model learns what constitutes 'normal' usage. Any command that does not fit into a legitimate cluster is flagged as an anomaly, providing a powerful way to detect previously unseen malicious techniques.",Windows Event ID 4688; Sysmon Event ID 1; Domain Controllers; Member Servers; User Workstations; Jump Servers,last 90 days,pseudocode: VECTORIZE T1202_utility command_lines with TF-IDF. CLUSTER vectors with DBSCAN. ALERT on any command_line classified as noise/outlier.,playbooks/attack/enterprise/T1202.yml
T1202: Indirect Command Execution,a4b1c23d-4e56-4789-a0b1-c2d3e4f5a6b7,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,7,Has a process associated with indirect command execution initiated a network connection to a known malicious IP address?,This question aims to detect command-and-control (C2) or payload download activity. It involves monitoring for network connections (Sysmon Event ID 3) made by T1220-related utilities and enriching the destination IP address with threat intelligence. A connection to an IP on a C2 blocklist is a high-confidence indicator of malicious activity.,"Sysmon Event ID 3; Zeek conn.log; Zeek ssl.log; Zeek notice.log; Network Egress Points (e.g., Firewalls, Proxies); DNS Servers; Host-based firewalls; Host-level Network Telemetry on critical servers and workstations",last 90 days,"pseudocode: SEARCH network_connection_events WHERE process_name IN ('forfiles.exe', 'pcalua.exe', etc.) AND destination_ip IN threat_intelligence_feed.",playbooks/attack/enterprise/T1202.yml
T1202: Indirect Command Execution,a4b1c23d-4e56-4789-a0b1-c2d3e4f5a6b7,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,8,Has an indirect command execution process made a network connection to a destination country or Autonomous System (AS) not previously associated with that host and process?,"This question detects anomalous network behavior by profiling geographic and network-level destinations. By maintaining a baseline of countries and ASNs that each host/process pair communicates with, the system can flag any connection from a T1202 utility to a 'first-seen' location. This can indicate communication with an unusual or newly established adversary infrastructure.","Sysmon Event ID 3; Zeek conn.log; Zeek ssl.log; Zeek notice.log; Network Egress Points (e.g., Firewalls, Proxies); DNS Servers; Host-based firewalls; Host-level Network Telemetry on critical servers and workstations",last 90 days,pseudocode: FOR each host/process_pair: MAINTAIN baseline of destination_countries and destination_ASNs. ALERT if T1202_utility connects to a never-before-seen country or ASN.,playbooks/attack/enterprise/T1202.yml
T1202: Indirect Command Execution,a4b1c23d-4e56-4789-a0b1-c2d3e4f5a6b7,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,9,Has the outbound network traffic volume from an indirect command execution process shown an anomalous spike indicative of unexpected data transfer?,"This question uses a time-series anomaly detection model to spot unusual data transfer activity. An LSTM autoencoder is trained on the normal outbound traffic volume patterns of T1202-related processes. If the actual traffic volume significantly deviates from the model's prediction (i.e., high reconstruction error), it is flagged as a temporal anomaly, which could represent data exfiltration or a large payload download.","Sysmon Event ID 3; Zeek conn.log; Zeek ssl.log; Zeek notice.log; Network Egress Points (e.g., Firewalls, Proxies); DNS Servers; Host-based firewalls; Host-level Network Telemetry on critical servers and workstations",last 90 days,pseudocode: MODEL time_series of outbound_bytes for each T1202_process using LSTM_autoencoder. ALERT if reconstruction_error exceeds dynamic_threshold.,playbooks/attack/enterprise/T1202.yml
T1202: Indirect Command Execution,a4b1c23d-4e56-4789-a0b1-c2d3e4f5a6b7,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,10,"Has a known malicious process chain involving an indirect command execution utility, such as Word spawning forfiles.exe which then spawns cmd.exe, been observed?","This question uses specific, high-fidelity rules to detect well-known malicious process execution chains. By monitoring parent-child process relationships, it can instantly flag sequences like an Office application spawning a T1202 utility, which in turn spawns a command shell. This is a classic pattern for attacks originating from malicious documents.","Windows Event ID 4688; Sysmon Event ID 1; User Workstations; Virtual Desktop Infrastructure (VDI); Application Servers (e.g., Citrix, SharePoint); Web Servers",last 90 days,"pseudocode: SEARCH process_creation_events for chain: parent_process IN ('WINWORD.EXE', 'OUTLOOK.EXE') -> child_process IN ('forfiles.exe', etc.) -> grandchild_process IN ('cmd.exe', 'powershell.exe').",playbooks/attack/enterprise/T1202.yml
T1202: Indirect Command Execution,a4b1c23d-4e56-4789-a0b1-c2d3e4f5a6b7,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,11,Has a statistically rare three-process execution chain involving an indirect command execution utility occurred?,"This question aims to find unusual execution flows by calculating the rarity of process chains. By creating a graph of all parent-child relationships, we can calculate the conditional probability of any given three-process chain (A -> B -> C). Chains with a very low probability score are flagged as anomalous, helping to uncover novel attack paths that don't match predefined rules.","Windows Event ID 4688; Sysmon Event ID 1; User Workstations; Virtual Desktop Infrastructure (VDI); Application Servers (e.g., Citrix, SharePoint); Web Servers",last 90 days,pseudocode: CALCULATE path_rarity_score for all three-process chains (P(B|A) * P(C|B)). ALERT if score for a chain involving a T1202_utility is below a rarity_threshold.,playbooks/attack/enterprise/T1202.yml
T1202: Indirect Command Execution,a4b1c23d-4e56-4789-a0b1-c2d3e4f5a6b7,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,12,Can a Graph Neural Network model detect an anomalous process execution subgraph involving an indirect command execution utility?,"This question applies advanced machine learning to detect structurally anomalous process behavior. A Graph Neural Network (GNN) is trained to learn the typical structure of process subgraphs. It can then identify new process chains that are structurally different from all known benign patterns, flagging them as suspicious. This is a powerful method for detecting novel and complex execution flows.","Windows Event ID 4688; Sysmon Event ID 1; User Workstations; Virtual Desktop Infrastructure (VDI); Application Servers (e.g., Citrix, SharePoint); Web Servers",last 90 days,"pseudocode: TRAIN a GNN model on subgraphs of benign process activity. FOR new process chains, generate subgraph_embedding. ALERT if cosine_distance to known_benign_embeddings is large.",playbooks/attack/enterprise/T1202.yml
T1210: Exploitation of Remote Services,5f8a9e6b-8d7c-4a1e-9b0a-3d9f1c2b0e4a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0008: Lateral Movement,n; o; n; e,1,"Are NIDS signatures for known remote service exploits firing, and what is the full session context of the associated network traffic?","This question aims to identify explicit, known attack patterns against services like SMB, RDP, or vCenter. By correlating a high-fidelity NIDS alert (e.g., for EternalBlue) with detailed network session logs (like Zeek's conn.log), an analyst can move beyond a simple alert to understand the full scope of the connection, including duration, data transferred, and connection state, which is crucial for verifying the exploit's success and identifying the attacker's source.","Zeek conn.log; Zeek dce_rpc.log; Zeek rdp.log; Zeek files.log; Network sensors (e.g., Zeek) monitoring East-West traffic between server subnets, at the network perimeter, and within the DMZ.; Network Intrusion Detection System (NIDS) alerts",last 90 days,"pseudocode: JOIN NIDS_alerts ON (4-tuple, timestamp) WITH Zeek_conn_logs WHERE NIDS_signature CONTAINS 'known_exploit_CVE'",playbooks/attack/enterprise/T1210.yml
T1210: Exploitation of Remote Services,5f8a9e6b-8d7c-4a1e-9b0a-3d9f1c2b0e4a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0008: Lateral Movement,n; o; n; e,2,"Are there any remote service connections exhibiting statistically anomalous metrics, such as unusually high data transfer or long duration, compared to their historical baseline?","This question seeks to uncover exploit attempts or post-exploitation data transfers that don't match a known signature but deviate significantly from normal behavior. By baselining connection metrics (duration, bytes transferred) for each host and service, we can flag outliers (e.g., connections in the 99th percentile) that could represent a large exploit payload being delivered or a large volume of data being exfiltrated, even if the payload itself is unknown or encrypted.","Zeek conn.log; Zeek dce_rpc.log; Zeek rdp.log; Zeek files.log; Network sensors (e.g., Zeek) monitoring East-West traffic between server subnets, at the network perimeter, and within the DMZ.",last 90 days,"pseudocode: FOR EACH host, service: CALCULATE baseline (avg, stddev) of conn_duration, total_bytes. FIND connections WHERE metrics > baseline + (N * stddev).",playbooks/attack/enterprise/T1210.yml
T1210: Exploitation of Remote Services,5f8a9e6b-8d7c-4a1e-9b0a-3d9f1c2b0e4a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0008: Lateral Movement,n; o; n; e,3,Can a machine learning model identify malicious network traffic patterns associated with remote service exploitation that lack known signatures?,"This question leverages machine learning to find novel or obfuscated attacks that signature-based and statistical methods might miss. By training a classifier on a rich set of network flow features (like packet sizes, timing, and entropy), the model learns the subtle, complex characteristics of malicious traffic. This allows it to flag suspicious connections that look different from the vast amount of benign traffic, providing a powerful tool for discovering zero-day exploits or custom attacker tools.","Zeek conn.log; Zeek dce_rpc.log; Zeek rdp.log; Zeek files.log; Network sensors (e.g., Zeek) monitoring East-West traffic between server subnets, at the network perimeter, and within the DMZ.",last 90 days,pseudocode: APPLY trained_classifier_model TO live_network_flows. REVIEW connections flagged as 'malicious' with high confidence.,playbooks/attack/enterprise/T1210.yml
T1210: Exploitation of Remote Services,5f8a9e6b-8d7c-4a1e-9b0a-3d9f1c2b0e4a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0008: Lateral Movement,n; o; n; e,4,Are there any process creations or service installations indicative of common lateral movement tools like PsExec or WMIC?,"This question focuses on detecting the direct evidence of remote execution tools being used. By searching for specific command-line arguments ('wmic /node:', 'process call create'), service names ('PSEXESVC'), or files written to administrative shares ('ADMIN$'), analysts can find high-confidence indicators of an adversary moving laterally after a potential exploit.","Windows Event ID 4688; Windows Event ID 4697; Windows Event ID 5145; Zeek smb_files.log; Endpoint Detection and Response (EDR) logs from Domain Controllers, application servers, management servers (e.g., vCenter), and high-value user workstations.",last 90 days,pseudocode: SEARCH process_creation_logs WHERE command_line CONTAINS 'wmic /node:' OR command_line CONTAINS 'PSEXESVC.exe'. CORRELATE with service_install_logs and smb_file_logs.,playbooks/attack/enterprise/T1210.yml
T1210: Exploitation of Remote Services,5f8a9e6b-8d7c-4a1e-9b0a-3d9f1c2b0e4a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0008: Lateral Movement,n; o; n; e,5,"Are any extremely rare command-line arguments being executed on servers, particularly by network service accounts?","This question aims to find unknown or custom attacker tools by focusing on rarity. Most system activity is repetitive and predictable. A command line that has been seen only a few times (or never before) across the entire enterprise, especially when executed by a sensitive account, is highly suspicious and warrants investigation as it could be a sign of post-exploitation activity.","Windows Event ID 4688; Windows Event ID 4697; Windows Event ID 5145; Zeek smb_files.log; Endpoint Detection and Response (EDR) logs from Domain Controllers, application servers, management servers (e.g., vCenter), and high-value user workstations.",last 90 days,"pseudocode: CALCULATE frequency of all command_lines. ALERT on command_lines with frequency in bottom 1st percentile, especially if user is a service account.",playbooks/attack/enterprise/T1210.yml
T1210: Exploitation of Remote Services,5f8a9e6b-8d7c-4a1e-9b0a-3d9f1c2b0e4a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0008: Lateral Movement,n; o; n; e,6,Are there anomalous sequences of process creations following an inbound remote service connection that deviate from normal operational workflows?,"This question uses machine learning to understand the 'story' of what happens after a remote connection. Normal administrative activity follows a predictable sequence of process events. An attacker's actions will likely deviate from this norm. By training a model on benign sequences, we can detect any new sequence with high reconstruction error, indicating it is abnormal and possibly malicious post-exploitation behavior.","Windows Event ID 4688; Windows Event ID 4697; Windows Event ID 5145; Zeek smb_files.log; Endpoint Detection and Response (EDR) logs from Domain Controllers, application servers, management servers (e.g., vCenter), and high-value user workstations.",last 90 days,"pseudocode: FOR each host, IDENTIFY process sequences after inbound remote connections. APPLY LSTM_autoencoder_model. ALERT on sequences with high reconstruction_error.",playbooks/attack/enterprise/T1210.yml
T1210: Exploitation of Remote Services,5f8a9e6b-8d7c-4a1e-9b0a-3d9f1c2b0e4a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0008: Lateral Movement,n; o; n; e,7,"Is a critical network service process (e.g., lsass.exe, services.exe) spawning unexpected child processes like cmd.exe or powershell.exe?",This question looks for a classic sign of exploitation where a vulnerable service is manipulated to execute arbitrary code. A process like 'lsass.exe' should never have a child process. A service host like 'services.exe' spawning a command shell is highly anomalous and a strong indicator that an adversary has successfully exploited the service to gain code execution on the system.,"Windows Event ID 4688; Zeek conn.log; Process creation logs from critical service hosts such as Domain Controllers, Exchange servers, VMware vCenter servers, and internet-facing web servers.",last 90 days,pseudocode: SEARCH process_creation_logs WHERE (parent_process IS 'lsass.exe') OR (parent_process IS 'services.exe' AND child_process IS 'cmd.exe' OR 'powershell.exe').,playbooks/attack/enterprise/T1210.yml
T1210: Exploitation of Remote Services,5f8a9e6b-8d7c-4a1e-9b0a-3d9f1c2b0e4a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0008: Lateral Movement,n; o; n; e,8,Are there any parent-child process relationships occurring that are statistically rare or have never been seen before for that specific parent process?,"This question provides a way to generalize the detection of anomalous process relationships beyond a few hardcoded rules. By creating a frequency distribution of all observed parent-child process pairs, we can statistically identify any new or extremely rare combination. This helps find novel attacker techniques that use unexpected processes to spawn shells or other tools.","Windows Event ID 4688; Zeek conn.log; Process creation logs from critical service hosts such as Domain Controllers, Exchange servers, VMware vCenter servers, and internet-facing web servers.",last 90 days,"pseudocode: FOR each parent_process, CREATE baseline of child_process frequencies. ALERT on any new parent-child pair or pairs in the lowest 1% frequency.",playbooks/attack/enterprise/T1210.yml
T1210: Exploitation of Remote Services,5f8a9e6b-8d7c-4a1e-9b0a-3d9f1c2b0e4a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0008: Lateral Movement,n; o; n; e,9,"Can a machine learning model distinguish between benign and malicious parent-child process pairs, even for novel combinations?","This question applies supervised learning to add more context to the analysis of process relationships. Simple statistical rarity can be noisy. A classification model can learn from features like process names, command line characteristics, and user context to make a more intelligent decision about whether a specific parent-child event is malicious, helping to reduce false positives and find more subtle threats.","Windows Event ID 4688; Zeek conn.log; Process creation logs from critical service hosts such as Domain Controllers, Exchange servers, VMware vCenter servers, and internet-facing web servers.",last 90 days,pseudocode: EXTRACT features from parent-child process events. APPLY trained_classifier_model. REVIEW pairs flagged as 'malicious' with high confidence.,playbooks/attack/enterprise/T1210.yml
T1210: Exploitation of Remote Services,5f8a9e6b-8d7c-4a1e-9b0a-3d9f1c2b0e4a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0008: Lateral Movement,n; o; n; e,10,Are critical services crashing or logging errors immediately after receiving an inbound connection from an internal source?,"This question seeks to identify failed exploit attempts or exploits that cause instability. A failed buffer overflow or other exploit attempt can often cause the target service to crash. By correlating service crash events (like Event ID 1000) with recent inbound network connections to that service, analysts can pinpoint the likely source of the attack attempt.","Windows Event ID 7031; Windows Event ID 7034; Windows Event ID 1000; Zeek conn.log; Windows Event Logs from externally-facing application servers and internal servers running potentially vulnerable remote services (e.g., RDP, SMB).",last 90 days,"pseudocode: SEARCH for service_crash_events. IF found, LOOKUP network_logs for inbound connections to the crashed service port from the last 5 minutes.",playbooks/attack/enterprise/T1210.yml
T1210: Exploitation of Remote Services,5f8a9e6b-8d7c-4a1e-9b0a-3d9f1c2b0e4a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0008: Lateral Movement,n; o; n; e,11,Is there a statistically significant increase in the rate of service errors on a host that correlates with a spike in inbound connection attempts?,"This question helps detect brute-force or scanning activity that may not crash a service but causes it to generate errors. By monitoring the rate of service errors and comparing it to a moving average baseline, we can detect anomalous spikes. Correlating this with a corresponding spike in connection attempts from a single source strengthens the evidence of a targeted attack or enumeration attempt.","Windows Event ID 7031; Windows Event ID 7034; Windows Event ID 1000; Zeek conn.log; Windows Event Logs from externally-facing application servers and internal servers running potentially vulnerable remote services (e.g., RDP, SMB).",last 90 days,"pseudocode: FOR each host, MONITOR rate of service_error_events. ALERT if rate > 3 * stddev of 24hr_moving_average. CORRELATE with connection_rate_spikes.",playbooks/attack/enterprise/T1210.yml
T1210: Exploitation of Remote Services,5f8a9e6b-8d7c-4a1e-9b0a-3d9f1c2b0e4a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0008: Lateral Movement,n; o; n; e,12,Does a time-series anomaly detection model identify a cause-and-effect relationship between spikes in inbound connections and subsequent service error events?,"This question uses a more advanced analytical technique to formally link network activity to service instability. By modeling both the inbound connection rate and the service error rate as time-series data, an anomaly detection algorithm can identify when anomalous events in both streams occur in close succession, providing strong, automated evidence of a cause-and-effect relationship indicative of an exploit attempt.","Windows Event ID 7031; Windows Event ID 7034; Windows Event ID 1000; Zeek conn.log; Windows Event Logs from externally-facing application servers and internal servers running potentially vulnerable remote services (e.g., RDP, SMB).",last 90 days,pseudocode: APPLY SARIMA model to time-series of (connection_counts) and (error_counts). ALERT on correlated anomalies detected in both series.,playbooks/attack/enterprise/T1210.yml
T1210: Exploitation of Remote Services,5f8a9e6b-8d7c-4a1e-9b0a-3d9f1c2b0e4a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0008: Lateral Movement,n; o; n; e,13,Is a host that recently received a remote service connection now initiating a large number of connections to other internal hosts?,"This question aims to detect a common post-exploitation step: internal reconnaissance. After an adversary compromises a machine via a remote service, they often use it as a pivot point to scan the internal network. This rule looks for that specific sequence of events: an inbound exploit followed by outbound scanning, by flagging a host that contacts many unique internal IPs shortly after being compromised.",Zeek conn.log; Zeek notice.log; Core network switches and traffic sensors monitoring East-West traffic between internal subnets.,last 90 days,"pseudocode: FIND hosts with recent inbound remote_service connection. For those hosts, CHECK if they initiated connections to > 20 unique IPs in a 1-minute window.",playbooks/attack/enterprise/T1210.yml
T1210: Exploitation of Remote Services,5f8a9e6b-8d7c-4a1e-9b0a-3d9f1c2b0e4a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0008: Lateral Movement,n; o; n; e,14,"Is any host exhibiting a sudden, statistically significant increase in the entropy of its destination IP addresses, indicating a shift to scanning behavior?","This question provides a more robust, mathematical way to detect scanning. Normal hosts talk to a small, regular set of other hosts (low entropy). A host that begins scanning talks to many different, random-seeming hosts (high entropy). By monitoring the entropy of a host's destination IPs, we can detect a sudden shift from normal behavior to scanning behavior without relying on a fixed threshold.",Zeek conn.log; Zeek notice.log; Core network switches and traffic sensors monitoring East-West traffic between internal subnets.,last 90 days,"pseudocode: FOR each source_IP, CALCULATE Shannon entropy of destination_IPs in 5-min windows. ALERT if entropy increases > 2 stddev from its baseline.",playbooks/attack/enterprise/T1210.yml
T1210: Exploitation of Remote Services,5f8a9e6b-8d7c-4a1e-9b0a-3d9f1c2b0e4a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0008: Lateral Movement,n; o; n; e,15,Can a clustering algorithm identify hosts that are behaving as network scanners by detecting them as outliers or noise points in network traffic patterns?,"This question uses unsupervised machine learning to find scanners by identifying hosts that don't fit in. Normal traffic (e.g., a web server talking to its database) forms dense clusters of communication. A compromised host scanning the network connects from one source to many disparate destinations, a pattern that does not fit any normal cluster. A density-based algorithm like DBSCAN will naturally label this scanning activity as 'noise' or an outlier, making it easy to spot.",Zeek conn.log; Zeek notice.log; Core network switches and traffic sensors monitoring East-West traffic between internal subnets.,last 90 days,"pseudocode: APPLY DBSCAN clustering on network_logs using (src_IP, dst_IP, dst_port) as features. INVESTIGATE points classified as 'noise'.",playbooks/attack/enterprise/T1210.yml
T1211: Exploitation for Defense Evasion,f4d8c1b0-6b7e-4b0d-8c1a-9f0e2d3c4b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,1,Are there network connections to or from our security agents that match known exploit signatures or indicators of compromise (IOCs)?,"This question seeks to identify direct attacks against security infrastructure. Adversaries may use known exploits for vulnerabilities in security products or connect from malicious infrastructure to manipulate or disable agents. Detecting this involves querying logs for specific signatures (e.g., from ET Pro, Suricata) or connections matching IP addresses and domains associated with active exploit campaigns.","Zeek conn.log; Zeek http.log; Zeek files.log; Zeek notice.log; Network egress points, VPN concentrators, internal network segments monitoring security tool management servers, and Cloud VPC flow logs monitoring traffic to/from security service management planes.",last 90 days,": SEARCH Zeek notice.log WHERE notice.note MATCHES 'known_exploit_signatures'
SEARCH Zeek conn.log, http.log WHERE destination_ip OR destination_domain IN 'active_exploit_campaign_iocs'",playbooks/attack/enterprise/T1211.yml
T1211: Exploitation for Defense Evasion,f4d8c1b0-6b7e-4b0d-8c1a-9f0e2d3c4b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,2,"Have any security agents exhibited anomalous network communication patterns, such as unusually large or high-entropy payloads?","This question aims to find subtle signs of compromise that don't match known signatures. An attacker might inject shellcode or use obfuscated commands, which can alter the size and randomness (entropy) of the data being sent. By baselining normal communication and alerting on significant deviations (e.g., above the 99.5th percentile), we can detect these potentially malicious payloads.","Zeek conn.log; Network egress points, VPN concentrators, internal network segments monitoring security tool management servers, and Cloud VPC flow logs monitoring traffic to/from security service management planes.",last 90 days,": FOR each security_agent:
  BASELINE = CALCULATE 30-day baseline of payload_size and entropy from Zeek conn.log
  ALERT if new_connection.payload_size > 99.5th_percentile(BASELINE.payload_size) OR new_connection.entropy > 99.5th_percentile(BASELINE.entropy)",playbooks/attack/enterprise/T1211.yml
T1211: Exploitation for Defense Evasion,f4d8c1b0-6b7e-4b0d-8c1a-9f0e2d3c4b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,3,Can a machine learning model identify abnormal network behavior from security agents that might indicate compromise or disablement?,"This question uses advanced anomaly detection to spot complex patterns indicative of an exploit. A compromised agent might be used for data exfiltration, leading to unusually high traffic volumes, or it could be disabled, resulting in a sudden drop in communication. A multivariate time-series model can learn the normal relationships between features like bytes sent/received and connection duration, flagging significant deviations as potential security incidents.","Zeek conn.log; Network egress points, VPN concentrators, internal network segments monitoring security tool management servers, and Cloud VPC flow logs monitoring traffic to/from security service management planes.",last 90 days,": MODEL = TRAIN multivariate time-series anomaly detection model (e.g., VAR, LSTM) on features (bytes_sent, bytes_received, duration) from Zeek conn.log
APPLY MODEL to new traffic
ALERT on high anomaly_score",playbooks/attack/enterprise/T1211.yml
T1211: Exploitation for Defense Evasion,f4d8c1b0-6b7e-4b0d-8c1a-9f0e2d3c4b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,4,"Are processes being created with command-line arguments intended to stop, delete, or disable our security services?","This question looks for explicit attempts by an adversary to disable defenses using built-in system utilities like 'sc.exe' or 'powershell.exe'. The query searches for process creation events where the command line contains keywords like 'stop' or 'disable' paired with the names of known security services (e.g., 'WinDefend', 'Sense'), or the execution of known security bypass tools.","Windows Event ID 4688; Sysmon Event ID 1; Endpoint workstations and servers, particularly those hosting security management consoles, critical applications, and Domain Controllers.",last 90 days,": SEARCH Windows Event 4688, Sysmon Event 1 WHERE process_name IN ('sc.exe', 'powershell.exe', etc.) AND command_line CONTAINS ('stop', 'delete', 'config', 'disable') AND command_line CONTAINS ('WinDefend', 'Sense', etc.)
SEARCH for execution of known bypass tools ('zemana.exe', 'av_killer.exe')",playbooks/attack/enterprise/T1211.yml
T1211: Exploitation for Defense Evasion,f4d8c1b0-6b7e-4b0d-8c1a-9f0e2d3c4b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,5,Have legitimate system utilities like 'sc.exe' or 'powershell.exe' been used to interact with security services in a statistically rare or unusual way?,"This question aims to find abuse of legitimate tools that might not be caught by specific keyword matching. By analyzing the frequency of all command-line arguments used with these utilities across the enterprise, we can identify commands that are rarely ever used. A command targeting a security service that falls into a low-frequency bucket (e.g., bottom 1%) is highly suspicious and likely represents malicious activity.","Windows Event ID 4688; Sysmon Event ID 1; Endpoint workstations and servers, particularly those hosting security management consoles, critical applications, and Domain Controllers.",last 90 days,": CALCULATE frequency of all unique command-line combinations for ('sc.exe', 'net.exe', 'powershell.exe') interacting with services.
ALERT if a command targets a security_service AND its frequency is in the bottom 1%.",playbooks/attack/enterprise/T1211.yml
T1211: Exploitation for Defense Evasion,f4d8c1b0-6b7e-4b0d-8c1a-9f0e2d3c4b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,6,Can a machine learning model classify command lines targeting security processes as malicious?,"This question leverages supervised machine learning to distinguish between benign and malicious command-line activity. By training a model on features like character entropy, length, obfuscation patterns (e.g., base64), and argument structure, it can learn to identify malicious commands even if they are novel or heavily obfuscated. Applying this model to new process creation events provides a probabilistic score of maliciousness.","Windows Event ID 4688; Sysmon Event ID 1; Endpoint workstations and servers, particularly those hosting security management consoles, critical applications, and Domain Controllers.",last 90 days,": MODEL = TRAIN classification model (e.g., Random Forest) on labeled benign/malicious command lines.
APPLY MODEL to new Sysmon Event 1 data.
ALERT if model_prediction is 'malicious' with high probability AND command targets a security process.",playbooks/attack/enterprise/T1211.yml
T1211: Exploitation for Defense Evasion,f4d8c1b0-6b7e-4b0d-8c1a-9f0e2d3c4b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,7,"Has a security service unexpectedly crashed or terminated, followed shortly by suspicious reconnaissance or network activity on the same host?","This question seeks to connect the dots between a potential defense evasion event (a service crash) and subsequent malicious actions. A successful exploit might cause the security tool to terminate, giving the attacker a window to perform discovery (e.g., running `whoami.exe`) or establish a C2 connection. This query correlates a service termination event with subsequent process creation or network connections to unknown destinations within a short time frame (e.g., 5 minutes).","Windows Event ID 1000; Windows Event ID 1001; Windows Event ID 4688; Windows Event ID 7034; Zeek conn.log; Sysmon Event ID 3; Endpoint workstations and servers, especially Domain Controllers and other high-value assets.",last 90 days,": TRIGGER on security service crash/termination (Event ID 7034, 1000, 1001).
WITHIN 5 minutes on same host, CHECK FOR:
  a) Process creation (Event ID 4688) of recon tools ('whoami.exe', 'net.exe')
  OR
  b) Network connection (Sysmon Event 3) to an IP not seen in last 30 days.
ALERT on match.",playbooks/attack/enterprise/T1211.yml
T1211: Exploitation for Defense Evasion,f4d8c1b0-6b7e-4b0d-8c1a-9f0e2d3c4b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,8,Is there a statistically significant spike in security service crash events on any single host?,"This question aims to detect repeated, potentially unsuccessful attempts to exploit a security service. A brute-force or unstable exploit might cause the target service to crash multiple times in a short period. By tracking the rolling average of crash events per host, we can alert when the number of crashes in a given window exceeds a statistical threshold (e.g., 3 standard deviations above the mean), indicating an abnormal and suspicious pattern.","Windows Event ID 1000; Windows Event ID 1001; Windows Event ID 7034; Endpoint workstations and servers, especially Domain Controllers and other high-value assets.",last 90 days,": FOR each host:
  CALCULATE 24-hour rolling average and std_dev of security service crashes (Event ID 7034, 1000).
  ALERT if crash_count in a 1-hour window > (average + 3 * std_dev).",playbooks/attack/enterprise/T1211.yml
T1211: Exploitation for Defense Evasion,f4d8c1b0-6b7e-4b0d-8c1a-9f0e2d3c4b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,9,Can a sequence analysis model detect abnormal event sequences that include a security process termination?,"This question uses machine learning to understand the normal 'story' of events on a host and identify deviations. A typical exploit chain might involve a security process terminating, followed by a file being written to a temporary directory, and then a new outbound network connection. A sequence analysis model (like a Markov chain or LSTM) can learn normal event sequences and flag these low-probability, multi-stage attack chains as highly anomalous.","Windows Event ID 1000; Windows Event ID 1001; Windows Event ID 4688; Windows Event ID 7034; Zeek conn.log; Sysmon Event ID 3; Endpoint workstations and servers, especially Domain Controllers and other high-value assets.",last 90 days,": MODEL = TRAIN sequence analysis model (e.g., LSTM autoencoder) on normal host event sequences (Sysmon, Windows Events).
APPLY MODEL to new event sequences.
ALERT on low-probability sequences, especially those containing: security_process_termination -> file_creation -> new_external_network_connection.",playbooks/attack/enterprise/T1211.yml
T1211: Exploitation for Defense Evasion,f4d8c1b0-6b7e-4b0d-8c1a-9f0e2d3c4b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,10,"Have we observed a successful process execution or network connection involving an indicator (file hash, IP, domain) that was previously blocked by one of our security tools?","This question looks for direct evidence of a security control failure or bypass. If a firewall blocks a malicious IP but a host is later seen communicating with it, the control has been evaded. This query involves checking all successful activity logs (process execution, network connections) in real-time against a cached list of indicators that have recently triggered a 'block' alert.","Windows Event ID 4688; Sysmon Event ID 1; Sysmon Event ID 3; Zeek conn.log; Security tool alert logs; Log aggregation platform (SIEM), endpoint workstations and servers, network egress points (Firewalls/Proxies).",last 90 days,": CACHE 'block' alerts from all security tools (EDR, firewall, etc.)
FOR each new successful process (Sysmon EID 1) or network connection (Zeek conn.log):
  CHECK if indicator (hash, IP, domain) exists in CACHE.
  ALERT on match.",playbooks/attack/enterprise/T1211.yml
T1211: Exploitation for Defense Evasion,f4d8c1b0-6b7e-4b0d-8c1a-9f0e2d3c4b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,11,"Has there been a sudden and sustained drop in the alert volume for a specific, previously active security rule?","This question tries to detect a disabled security control by observing its silence. If a rule that consistently generates alerts suddenly stops, it may have been disabled or bypassed by an adversary. Using a change point detection algorithm on the time-series data of alert counts for each rule can automatically identify the exact moment such a significant drop occurs, pointing to a potential evasion.","Security tool alert logs; Log aggregation platform (SIEM), endpoint workstations and servers, network egress points (Firewalls/Proxies).",last 90 days,": STREAM alert counts for each security rule into a time-series database.
APPLY change point detection algorithm (e.g., PELT) to the time-series.
ALERT on a detected change point that corresponds to a sudden, sustained drop in alert volume.",playbooks/attack/enterprise/T1211.yml
T1211: Exploitation for Defense Evasion,f4d8c1b0-6b7e-4b0d-8c1a-9f0e2d3c4b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,12,Are there any high-volume security alerts whose current counts have fallen significantly below their forecasted levels?,"This question uses forecasting to predict the expected number of alerts and identify 'silent failures'. A time-series forecasting model can learn the normal patterns of alert volumes, including daily and weekly seasonality. If the actual number of alerts drops below the model's predicted lower bound for a sustained period, it suggests that the control is no longer functioning as expected, possibly due to adversary interference.","Security tool alert logs; Log aggregation platform (SIEM), endpoint workstations and servers, network egress points (Firewalls/Proxies).",last 90 days,": MODEL = TRAIN time-series forecasting model (e.g., Prophet) for each high-volume alert type.
ALERT if actual_alert_count falls below model's forecasted lower confidence interval for a sustained period.",playbooks/attack/enterprise/T1211.yml
T1211: Exploitation for Defense Evasion,f4d8c1b0-6b7e-4b0d-8c1a-9f0e2d3c4b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,13,"Has a process handling external content, like an email client or browser, written a file that was then loaded as a module by a security process?","This question targets a specific exploitation technique where an attacker tricks a user into opening a malicious document or visiting a webpage, which then drops a malicious file (e.g., a DLL). This malicious file is subsequently loaded by a trusted security process, effectively bypassing application controls. The query correlates a file creation event from a process like Outlook or Chrome with a subsequent module load event of that same file by a security tool process.","Sysmon Event ID 7; Sysmon Event ID 11; Endpoint workstations and servers, user home directories, temporary file locations (e.g., C:\Users\<user>\AppData\Local\Temp), and the C:\ProgramData folder.",last 90 days,": JOIN events on the same host within 1 minute:
  1. File creation (Sysmon EID 11) by parent process ('WINWORD.EXE', 'CHROME.EXE') in a world-writable path.
  2. Image load (Sysmon EID 7) where loaded_image_path from Event 2 matches created_file_path from Event 1, AND loading_process is a known security tool.
ALERT on match.",playbooks/attack/enterprise/T1211.yml
T1211: Exploitation for Defense Evasion,f4d8c1b0-6b7e-4b0d-8c1a-9f0e2d3c4b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,14,Has any security process loaded a DLL from a statistically rare or suspicious file path?,"This question focuses on identifying anomalous module loading behavior based on file location. Security tools typically load their modules from protected system directories (e.g., Program Files). A security process loading a DLL from a user's temporary folder or download directory is extremely unusual and a strong indicator of compromise. This query involves baselining legitimate module load paths and alerting on any load from a statistically improbable location.","Sysmon Event ID 7; Endpoint workstations and servers, user home directories, temporary file locations (e.g., C:\Users\<user>\AppData\Local\Temp), and the C:\ProgramData folder.",last 90 days,": BASELINE legitimate DLL paths loaded by each security process from Sysmon Event 7.
CALCULATE rarity of each loaded DLL's path.
ALERT if a security process loads a DLL from a path with near-zero legitimate frequency (e.g., 'C:\\Users\\*\\AppData\\Local\\Temp\\*').",playbooks/attack/enterprise/T1211.yml
T1211: Exploitation for Defense Evasion,f4d8c1b0-6b7e-4b0d-8c1a-9f0e2d3c4b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,15,Can a graph-based anomaly detection model identify event chains corresponding to a security tool being exploited?,"This question models host activity as an event graph to uncover complex attack paths. A sequence like an Office application creating a DLL, which is then loaded by an anti-virus engine, which then makes a new external network connection, forms a highly suspicious subgraph. Graph-based anomaly detection can automatically surface these improbable event chains, providing strong evidence of a successful exploit and bypass.","Sysmon Event ID 7; Sysmon Event ID 11; Sysmon Event ID 3; Zeek conn.log; Endpoint workstations and servers, user home directories, temporary file locations (e.g., C:\Users\<user>\AppData\Local\Temp), and the C:\ProgramData folder.",last 90 days,": CONSTRUCT a process-file-module-network event graph for each host.
APPLY graph-based anomaly detection to identify improbable subgraphs.
ALERT on high-scoring anomalous subgraphs, e.g., 'OUTLOOK.EXE -> creates -> payload.dll -> loaded by -> MsMpEng.exe -> connects to -> [Rare External IP]'.",playbooks/attack/enterprise/T1211.yml
T1216.001: PubPrn,c5d1e8f0-5b7a-4c1d-9f3a-8e2b7c6d4a1b,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,1,Is `pubprn.vbs` being executed with a URL that matches a known malicious indicator from threat intelligence?,"This question aims to identify the most direct evidence of malicious activity. Adversaries often use `pubprn.vbs` to download and execute payloads from servers they control. By comparing the URL used in the command line against a curated list of known malicious domains and IPs, analysts can quickly confirm if the execution is tied to a known threat campaign.","Windows Event ID 4688; Zeek conn.log; Zeek dns.log; Endpoint devices (workstations and servers); Enterprise DNS resolvers; Network egress points (e.g., firewalls, proxies)",last 90 days,": SEARCH process creation logs (EID 4688)
WHERE process_name in ('cscript.exe', 'wscript.exe') AND command_line contains 'pubprn.vbs' AND command_line contains 'script:'
EXTRACT URL from command_line
JOIN URL's domain/IP with threat_intelligence_feed
RETURN matching events
",playbooks/attack/enterprise/T1216.001.yml
T1216.001: PubPrn,c5d1e8f0-5b7a-4c1d-9f3a-8e2b7c6d4a1b,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,2,Is `pubprn.vbs` being used to contact a newly registered or algorithmically generated domain?,"Threat actors frequently use newly registered domains (NRDs) or domain generation algorithms (DGAs) to host malicious payloads, as these domains are less likely to be on static blocklists. Identifying executions that contact NRDs or high-entropy domains serves as a strong statistical indicator of suspicious activity, even without a direct threat intelligence match.","Windows Event ID 4688; Zeek conn.log; Zeek dns.log; Endpoint devices (workstations and servers); Enterprise DNS resolvers; Network egress points (e.g., firewalls, proxies)",last 90 days,": SEARCH process creation logs (EID 4688) for pubprn.vbs executions
EXTRACT domain from URL in command_line
FOR each domain:
  QUERY WHOIS data for registration_date
  CALCULATE domain entropy
  ALERT if registration_date < 60 days OR entropy > baseline_95th_percentile
",playbooks/attack/enterprise/T1216.001.yml
T1216.001: PubPrn,c5d1e8f0-5b7a-4c1d-9f3a-8e2b7c6d4a1b,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,3,Does the URL associated with a `pubprn.vbs` execution exhibit characteristics of a malicious URL based on a machine learning model?,"This question leverages machine learning to detect subtle malicious patterns in URLs that may not be caught by symbolic or simple statistical methods. By analyzing features like domain length, character distribution, and n-grams, a classification model can identify URLs that are structurally similar to known malicious ones, providing a probabilistic assessment of risk.","Windows Event ID 4688; Zeek conn.log; Zeek dns.log; Endpoint devices (workstations and servers); Enterprise DNS resolvers; Network egress points (e.g., firewalls, proxies)",last 90 days,": ON pubprn.vbs execution events:
  EXTRACT URL from command_line
  GENERATE features (length, TLD, char_frequency, n-grams) from URL
  INPUT features into malicious_url_classifier_model
  ALERT if model_score > 0.90
",playbooks/attack/enterprise/T1216.001.yml
T1216.001: PubPrn,c5d1e8f0-5b7a-4c1d-9f3a-8e2b7c6d4a1b,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,4,Is `pubprn.vbs` being executed with a non-LDAP protocol handler like 'http:' or 'https:'?,"The legitimate use of `pubprn.vbs` involves publishing a printer to Active Directory using the 'ldap:' protocol handler. The use of any other handler, particularly 'http:' or 'https:', is a high-fidelity indicator of abuse, as it signifies an attempt to fetch a remote script from a web server instead of interacting with a directory service.","Windows Event ID 4688; All enterprise workstations and servers, particularly legacy systems (Windows < 10) where this technique is viable.",last 90 days,": SEARCH process creation logs (EID 4688)
WHERE process_name in ('cscript.exe', 'wscript.exe')
AND command_line contains 'pubprn.vbs'
AND (command_line contains 'script:http' OR command_line contains 'script:https')
ALERT on any match
",playbooks/attack/enterprise/T1216.001.yml
T1216.001: PubPrn,c5d1e8f0-5b7a-4c1d-9f3a-8e2b7c6d4a1b,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,5,Are there any observed executions of `pubprn.vbs` using a protocol handler that deviates from the established baseline of 'ldap:'?,"This question applies a statistical lens to detect abuse. By establishing that the only legitimate protocol handler used with `pubprn.vbs` in the environment is 'ldap:', any deviation from this norm becomes a zero-frequency event. This makes it a statistically significant anomaly that is highly indicative of malicious intent.","Windows Event ID 4688; All enterprise workstations and servers, particularly legacy systems (Windows < 10) where this technique is viable.",last 30 days,": SEARCH process creation logs (EID 4688) for 'pubprn.vbs' executions over 30 days
EXTRACT protocol_handler after 'script:'
CALCULATE frequency of each handler
ALERT if any handler is not 'ldap:'
",playbooks/attack/enterprise/T1216.001.yml
T1216.001: PubPrn,c5d1e8f0-5b7a-4c1d-9f3a-8e2b7c6d4a1b,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,6,Can a machine learning model classify `pubprn.vbs` command lines as malicious based on the presence of specific keywords?,"This question explores using a simple classifier to automate the detection of malicious `pubprn.vbs` usage. By training a model on binary features representing the presence or absence of keywords like 'pubprn.vbs', 'script:', 'http:', and 'ldap:', the model can learn the simple rule that 'script:' without 'ldap:' is malicious, providing a fast and efficient real-time detection capability.","Windows Event ID 4688; All enterprise workstations and servers, particularly legacy systems (Windows < 10) where this technique is viable.",last 90 days,": ON process creation events:
  EXTRACT command_line
  GENERATE binary features for keywords ('pubprn.vbs', 'script:', 'http:', 'ldap:')
  INPUT features to command_line_classifier
  ALERT if classification is 'malicious'
",playbooks/attack/enterprise/T1216.001.yml
T1216.001: PubPrn,c5d1e8f0-5b7a-4c1d-9f3a-8e2b7c6d4a1b,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,7,Did a `cscript.exe` process executing `pubprn.vbs` spawn a known LOLBin or command shell?,"After `pubprn.vbs` executes a remote script, the next step is often to launch another tool to continue the attack chain. This question looks for this follow-on activity by checking if the `cscript.exe` process that ran `pubprn.vbs` spawns suspicious child processes like `powershell.exe`, `cmd.exe`, or `rundll32.exe`. This is a strong indicator that the initial execution was malicious.",Windows Event ID 4688; All enterprise workstations and servers with process relationship logging enabled.,last 90 days,": SEARCH process creation logs (EID 4688) for parent-child relationships
WHERE parent_process_name is 'cscript.exe' AND parent_command_line contains 'pubprn.vbs'
AND child_process_name is in watchlist ('powershell.exe', 'cmd.exe', 'rundll32.exe', 'regsvr32.exe', 'certutil.exe', 'mshta.exe')
ALERT on match
",playbooks/attack/enterprise/T1216.001.yml
T1216.001: PubPrn,c5d1e8f0-5b7a-4c1d-9f3a-8e2b7c6d4a1b,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,8,Is the child process spawned by a `pubprn.vbs` execution a statistically rare event in the environment?,"This question aims to find malicious activity by identifying unusual process behaviors. Legitimate software tends to have predictable process relationships. By baselining all parent-child process pairs, an analyst can spot when a `cscript.exe` process running `pubprn.vbs` spawns a child process that has rarely or never been seen before, flagging it as a potential anomaly worth investigating.",Windows Event ID 4688; All enterprise workstations and servers with process relationship logging enabled.,last 90 days,": MAINTAIN baseline of all parent-child process pair frequencies over 90 days
ON a 'cscript.exe' ('pubprn.vbs') -> child_process event:
  CALCULATE the pair's historical frequency
  ALERT if frequency is below a rarity threshold (e.g., < 1st percentile or seen on < 3 hosts)
",playbooks/attack/enterprise/T1216.001.yml
T1216.001: PubPrn,c5d1e8f0-5b7a-4c1d-9f3a-8e2b7c6d4a1b,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,9,Is the process execution chain initiated by `pubprn.vbs` considered improbable or anomalous by a machine learning model?,"This question models process activity as sequences of events to detect sophisticated attacks. By treating process names as 'words' in a sentence, an n-gram model can learn the probability of certain sequences. A malicious sequence, like `cscript.exe` (running `pubprn.vbs`) followed by `powershell.exe`, would likely have a very low probability compared to benign sequences, allowing the model to flag it as anomalous.",Windows Event ID 4688; All enterprise workstations and servers with process relationship logging enabled.,last 90 days,": MODEL process execution sequences using n-gram analysis to establish probabilities
ON a new sequence starting with 'cscript.exe' ('pubprn.vbs'):
  CALCULATE its probability
  ALERT if probability is below a learned threshold
",playbooks/attack/enterprise/T1216.001.yml
T1216.001: PubPrn,c5d1e8f0-5b7a-4c1d-9f3a-8e2b7c6d4a1b,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,10,"Following a `pubprn.vbs` execution, did the `cscript.exe` process make a network connection to a known malicious IP or domain?","This question connects endpoint process activity with network logs to confirm malicious communication. An adversary using `pubprn.vbs` will cause the `cscript.exe` process to connect to a command-and-control (C2) server. By correlating the process execution with outbound network connections and checking the destination against threat intelligence, analysts can verify that the process is communicating with a known malicious entity.","Windows Event ID 4688; Zeek conn.log; Zeek http.log; Zeek files.log; Endpoint devices (workstations and servers); Network egress points (e.g., firewalls, proxies); Network TAPs/SPANs generating Zeek data.",last 90 days,": SEARCH for 'cscript.exe' ('pubprn.vbs') process events (EID 4688)
WITHIN 2 minutes of event, SEARCH network logs (Zeek conn.log) for connections from the same source_ip
JOIN destination_ip/domain with threat_intelligence_feed
ALERT on match
",playbooks/attack/enterprise/T1216.001.yml
T1216.001: PubPrn,c5d1e8f0-5b7a-4c1d-9f3a-8e2b7c6d4a1b,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,11,"Did the network connection following a `pubprn.vbs` execution involve a statistically anomalous destination port, country, or file download size?","This question seeks to identify suspicious network behavior by baselining normal activity for the `cscript.exe` process. Malicious C2 communication or payload downloads may occur over unusual ports, to servers in atypical geographic locations, or involve unexpectedly large files. Alerting on deviations from the established baseline for a host can uncover malicious activity without prior knowledge of the destination's reputation.","Windows Event ID 4688; Zeek conn.log; Zeek http.log; Zeek files.log; Endpoint devices (workstations and servers); Network egress points (e.g., firewalls, proxies); Network TAPs/SPANs generating Zeek data.",last 90 days,": AFTER a 'pubprn.vbs' execution, monitor the associated network connection
COMPARE destination_port, destination_country, and downloaded_file_size against historical baselines for the host/process
ALERT if any value is statistically rare (e.g., > 95th percentile)
",playbooks/attack/enterprise/T1216.001.yml
T1216.001: PubPrn,c5d1e8f0-5b7a-4c1d-9f3a-8e2b7c6d4a1b,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,12,Was there an anomalous spike in outbound network traffic from a host shortly after a `pubprn.vbs` execution?,"This question uses time-series analysis to detect data exfiltration or large payload downloads. A sudden, unexpected spike in a host's outbound network traffic volume that is temporally correlated with a `pubprn.vbs` execution is highly suspicious. A time-series anomaly detection model can automatically identify such spikes against the host's normal traffic patterns, signaling a potential malicious event.","Windows Event ID 4688; Zeek conn.log; Zeek http.log; Zeek files.log; Endpoint devices (workstations and servers); Network egress points (e.g., firewalls, proxies); Network TAPs/SPANs generating Zeek data.",last 90 days,": APPLY time-series anomaly detection model to host's outbound traffic (bytes_out from Zeek conn.log)
CORRELATE process creation events (EID 4688) for 'pubprn.vbs'
ALERT if an anomalous traffic spike occurs within 2 minutes after the process execution
",playbooks/attack/enterprise/T1216.001.yml
T1216.001: PubPrn,c5d1e8f0-5b7a-4c1d-9f3a-8e2b7c6d4a1b,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,13,Was `pubprn.vbs` executed by an unauthorized user or on a system not designated as a print server?,This question focuses on policy and role-based access control to identify abuse. The legitimate use of `pubprn.vbs` is typically restricted to printer administrators and performed on print servers. Any execution that violates this policy—such as by a standard user on a regular workstation—is a strong indication of misuse or compromise.,Windows Event ID 4688; Active Directory security logs; All enterprise workstations and servers; Domain Controllers; Identity and Access Management (IAM) systems; Asset Inventory Database.,last 90 days,": ON 'pubprn.vbs' execution (EID 4688):
  GET user and hostname
  CHECK if user is in 'Printer Administrators' AD group
  CHECK if hostname is in 'Print Servers' asset list
  ALERT if either check fails
",playbooks/attack/enterprise/T1216.001.yml
T1216.001: PubPrn,c5d1e8f0-5b7a-4c1d-9f3a-8e2b7c6d4a1b,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,14,Is the frequency of `pubprn.vbs` execution by a specific user or on a host statistically unusual?,"This question uses frequency analysis to detect anomalous behavior. Even if a user is authorized, a sudden burst of `pubprn.vbs` executions could indicate a compromised account or a malicious script running in a loop. By baselining the normal execution frequency for each user and host, analysts can detect significant deviations (e.g., exceeding 3 standard deviations) or first-time executions, which warrant investigation.",Windows Event ID 4688; Active Directory security logs; All enterprise workstations and servers; Domain Controllers; Identity and Access Management (IAM) systems; Asset Inventory Database.,last 90 days,": MAINTAIN 90-day rolling baseline of 'pubprn.vbs' execution counts per user and per host
ON new execution:
  COMPARE count to user/host baseline
  ALERT if count > (mean + 3 * stdev) OR if baseline count is zero
",playbooks/attack/enterprise/T1216.001.yml
T1216.001: PubPrn,c5d1e8f0-5b7a-4c1d-9f3a-8e2b7c6d4a1b,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,15,Does a `pubprn.vbs` execution fall outside the cluster of normal administrative activity as determined by a machine learning model?,"This question uses unsupervised machine learning to define 'normal' behavior based on multiple features simultaneously. By clustering executions based on user role, host type, time of day, and parent process, a model can identify the typical pattern of legitimate printer administration. Any `pubprn.vbs` execution that does not fit into this dense cluster is flagged as an outlier, representing a deviation from normalcy that requires analyst review.",Windows Event ID 4688; Active Directory security logs; All enterprise workstations and servers; Domain Controllers; Identity and Access Management (IAM) systems; Asset Inventory Database.,last 90 days,": CLUSTER historical process execution events using features (user_role, host_role, time_of_day, parent_process)
APPLY model to new 'pubprn.vbs' executions
ALERT if an execution is classified as an outlier or noise by the clustering algorithm (e.g., DBSCAN)",playbooks/attack/enterprise/T1216.001.yml
T1216: System Script Proxy Execution,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,1,"Is a script proxy process (e.g., cscript.exe, pubprn.vbs) being executed with a command line containing an indicator (URL, IP, domain, hash) from a high-confidence threat intelligence feed?","This question aims to find the most direct evidence of malicious activity by matching command-line arguments against known-bad indicators. A match provides strong evidence that a legitimate system tool is being co-opted to download, execute, or communicate with malicious infrastructure, a common defense evasion technique.",Windows Event ID 4688; User Endpoints; Application Servers; Jump Servers; Domain Controllers,last 90 days,"search process_creation_events | parse command_line for indicators (urls, domains, ips, hashes) | join indicators with threat_intelligence_feed | where process_name in ('cscript.exe', 'wscript.exe', 'forfiles.exe', 'pubprn.vbs', 'mshta.exe')",playbooks/attack/enterprise/T1216.yml
T1216: System Script Proxy Execution,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,2,Is a script proxy executing with a command line containing a domain or IP that is statistically rare within the enterprise?,"This question helps uncover previously unknown malicious infrastructure. Adversaries often use new or unique domains/IPs for their operations. By identifying script proxy executions involving domains or IPs that have rarely or never been seen in the environment, analysts can flag suspicious activity that lacks a known-bad signature.",Windows Event ID 4688; User Endpoints; Application Servers; Jump Servers; Domain Controllers,last 90 days,search process_creation_events where process_name is script_proxy | parse command_line for domain/ip | calculate frequency of domain/ip over 90 days | filter for frequency < 5th percentile,playbooks/attack/enterprise/T1216.yml
T1216: System Script Proxy Execution,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,3,Can a machine learning model classify a script proxy execution as malicious based on its command-line features and context?,"This question leverages machine learning to build a predictive model for detecting malicious script proxy executions. By training on features like the presence and type of IOC, threat intelligence reputation, script name, and user context, the model can identify complex patterns that are difficult to define with simple rules, thus detecting novel or sophisticated attacks.",Windows Event ID 4688; User Endpoints; Application Servers; Jump Servers; Domain Controllers,last 90 days,"run ML_model on process_creation_events where process_name is script_proxy | input_features: has_ioc, ioc_type, ioc_reputation, script_name, user_context | alert if prediction_score > 0.85",playbooks/attack/enterprise/T1216.yml
T1216: System Script Proxy Execution,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,4,Is a script proxy being created with a command-line structure that matches a known malicious regular expression pattern?,"This question focuses on identifying specific adversary TTPs (Tactics, Techniques, and Procedures) that have been codified into regular expression patterns. For example, the pubprn.vbs script can be used to execute remote scripts using a distinct `script:http://...` syntax. Matching these patterns provides high-fidelity alerts for known attack methods.","Windows Event ID 4688; User Endpoints; Application Servers; systems enforcing Application Control (e.g., AppLocker)",last 90 days,search process_creation_events | filter command_line matches malicious_regex_library for T1216 | alert on match,playbooks/attack/enterprise/T1216.yml
T1216: System Script Proxy Execution,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,5,"Does the command line of a script proxy execution exhibit unusually high entropy, suggesting obfuscation?","Adversaries often obfuscate or encode commands to evade signature-based detection. This question uses Shannon entropy as a measure of randomness to detect such obfuscation. A command line with abnormally high entropy compared to a baseline of legitimate activity is a strong indicator of a malicious, hidden payload.",,last 90 days,search process_creation_events where process_name is script_proxy | calculate shannon_entropy of command_line_arguments | filter entropy > 95th percentile of baseline,playbooks/attack/enterprise/T1216.yml
T1216: System Script Proxy Execution,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,6,Can a machine learning model classify a script proxy command line as malicious based on its structural and content-based features?,"This question uses a machine learning classifier to distinguish between malicious and benign command lines. By analyzing a combination of features like length, character counts, presence of indicators, and entropy, the model can learn the subtle characteristics of malicious commands, enabling the detection of novel attack variations.","Windows Event ID 4688; User Endpoints; Application Servers; systems enforcing Application Control (e.g., AppLocker)",last 90 days,"run ML_model on script_proxy command_lines | input_features: length, special_chars, has_url_ip, arg_count, entropy | alert if classified as malicious with high confidence",playbooks/attack/enterprise/T1216.yml
T1216: System Script Proxy Execution,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,7,"Did a script proxy process (e.g., wscript.exe) spawn a child process that is not on an established allow-list of legitimate child processes?","This question helps detect when a script proxy is used to launch a subsequent malicious stage. Legitimate scripts typically have predictable child processes. By maintaining an allow-list of normal behavior, any deviation, such as spawning `powershell.exe`, `cmd.exe`, or an unsigned binary in a temp directory, can be immediately flagged as highly suspicious.",Windows Event ID 4688; User Endpoints; Jump Servers; Development/Test Environment Servers,last 90 days,search process_creation_events | identify parent_child_relationships where parent is script_proxy | alert if child_process not in (allow_list) or child_process in (high_risk_list),playbooks/attack/enterprise/T1216.yml
T1216: System Script Proxy Execution,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,8,Has a script proxy spawned a child process that is statistically rare for that specific host or its peer group?,"This question moves beyond a global allow-list to a more context-aware, statistical approach. A parent-child process relationship might be legitimate in one context (e.g., a developer machine) but highly anomalous in another (e.g., a domain controller). By baselining normal behavior on a per-host or per-peer-group basis, this method can detect contextually inappropriate activity.",Windows Event ID 4688; User Endpoints; Jump Servers; Development/Test Environment Servers,last 90 days,search process_creation_events | build baseline of parent(script_proxy)-child pairs per host | alert if new pair frequency is < 1st percentile for host or peer_group,playbooks/attack/enterprise/T1216.yml
T1216: System Script Proxy Execution,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,9,"Has a host's script proxy process behavior deviated significantly from its normal, clustered behavior profile?","This question uses unsupervised machine learning to detect anomalous system behavior. By clustering hosts with similar process relationship patterns, the model can identify when a single host begins to behave differently from its peers or its own historical norm. This shift, identified as an outlier, can indicate a compromise without relying on predefined rules or signatures.",Windows Event ID 4688; User Endpoints; Jump Servers; Development/Test Environment Servers,last 90 days,"run clustering_model on hosts using process_relationship features | features: child_processes, file_paths, signature_status | alert if host becomes an outlier or moves to a new cluster",playbooks/attack/enterprise/T1216.yml
T1216: System Script Proxy Execution,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,10,"Did a script proxy process, or its immediate child, initiate an outbound network connection to a known malicious IP or domain?","This question aims to detect command and control (C2) or data exfiltration activity by correlating process execution with network logs. By linking a script proxy process to an outbound connection and checking the destination against a C2 blocklist, analysts can find strong evidence of a successful compromise.","Windows Event ID 4688; Zeek conn.log; Zeek dns.log; Network Egress Points (Firewalls, Proxies); DNS Resolvers; User Endpoints; Internet-facing Servers",last 90 days,correlate process_events with network_logs by process_guid/timestamp | join with dns_logs | alert if destination_ip or destination_domain is on C2_blocklist,playbooks/attack/enterprise/T1216.yml
T1216: System Script Proxy Execution,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,11,Did a script proxy process initiate a network connection to a destination IP or domain that is exceptionally rare for the enterprise?,"This question helps uncover C2 channels that are not yet on threat intelligence feeds. Adversary infrastructure is often new and not widely connected to. By identifying connections from script proxies to destinations that are in the bottom percentile of access frequency across the entire enterprise, analysts can pinpoint suspicious communications that warrant investigation.","Windows Event ID 4688; Zeek conn.log; Zeek dns.log; Network Egress Points (Firewalls, Proxies); DNS Resolvers; User Endpoints; Internet-facing Servers",last 90 days,search network_connections from script_proxy_processes | calculate enterprise_wide frequency of destination_ip/fqdn | alert if frequency < 1st percentile,playbooks/attack/enterprise/T1216.yml
T1216: System Script Proxy Execution,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,12,Is there a statistically significant anomaly in the time series data of outbound network connections from script proxy processes?,"This question applies anomaly detection to network traffic patterns to spot malicious activity. A compromised host might exhibit a sudden spike in the number of connections, data volume, or unique destinations contacted by script proxies. A time series model can learn the normal rhythm of this traffic and automatically alert on deviations that signify a potential C2 beaconing or data staging event.","Windows Event ID 4688; Zeek conn.log; Zeek dns.log; Network Egress Points (Firewalls, Proxies); DNS Resolvers; User Endpoints; Internet-facing Servers",last 90 days,"run time_series_anomaly_detection on network_traffic from script_proxies | features: connection_count, unique_destinations, bytes_sent | alert on significant deviation from seasonal baseline",playbooks/attack/enterprise/T1216.yml
T1216: System Script Proxy Execution,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,13,"Is a script proxy executing a script from a high-risk or unusual file path, such as a temporary directory or user downloads folder?","This question focuses on the location of the executed script. Adversaries often drop scripts into world-writable or non-standard locations like temporary directories, public folders, or user download folders to bypass execution restrictions and hide from casual observation. Executing from these locations is a strong indicator of malicious intent.","Windows Event ID 4688; User Endpoints; Multi-user Servers (e.g., Citrix, RDS); Network File Shares",last 90 days,search process_creation_events where process_name is script_proxy | parse script_path from command_line | alert if script_path in (high_risk_directories_list),playbooks/attack/enterprise/T1216.yml
T1216: System Script Proxy Execution,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,14,Is a script proxy executing a script from a file path that has high entropy or is located in a rarely used directory?,"This question uses statistical properties of the file path to detect suspicious activity. High entropy in a path can indicate randomization used to evade detection, while execution from a directory that is rarely used across the enterprise suggests an attacker has created a non-standard location for their tools. The combination of these two factors is highly suspicious.","Windows Event ID 4688; User Endpoints; Multi-user Servers (e.g., Citrix, RDS); Network File Shares",last 90 days,search script_proxy_executions | calculate entropy of script_path and frequency of parent_directory | alert if path_entropy > 95th percentile or directory_frequency < 5th percentile,playbooks/attack/enterprise/T1216.yml
T1216: System Script Proxy Execution,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,15,"Can a one-class SVM model, trained on legitimate script paths, identify a new script execution path as an anomaly?","This question employs an anomaly detection model to learn the characteristics of all ""normal"" script execution paths in the environment. By modeling features like path depth and directory naming conventions, the one-class SVM can identify any new execution path that falls outside this learned boundary of normalcy, flagging it as a potential threat without prior knowledge of what is ""bad"".","Windows Event ID 4688; User Endpoints; Multi-user Servers (e.g., Citrix, RDS); Network File Shares",last 90 days,"run one_class_svm_model on script_execution_paths | features: path_depth, token_counts, file_extension | alert if path is classified as an anomaly (outside learned boundary)",playbooks/attack/enterprise/T1216.yml
T1218.005: Mshta,9d8c3b7a-6f5e-4d3c-2b1a-0e9f8d7c6b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,1,"Is an mshta.exe process communicating with known malicious IPs or domains, or executing a known malicious HTA file?","This question aims to detect direct evidence of malicious activity by correlating mshta.exe process creation events with network traffic and threat intelligence. A match against a known malicious IP, domain, or file hash is a high-confidence indicator of compromise.",Windows Event ID 4688; Zeek conn.log; Zeek dns.log; Zeek files.log; All enterprise endpoints and servers; Network gateways and proxies; Threat Intelligence Platforms,last 90 days,: ,playbooks/attack/enterprise/T1218.005.yml
T1218.005: Mshta,9d8c3b7a-6f5e-4d3c-2b1a-0e9f8d7c6b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,2,Is mshta.exe communicating with unusually rare or newly observed domains?,"Adversaries often use newly registered or obscure domains for command and control. By baselining normal domain traffic associated with mshta.exe and alerting on statistical outliers (rare or first-seen domains), this question helps uncover potentially malicious C2 channels that are not yet on threat intelligence feeds.",Zeek dns.log; All enterprise endpoints and servers; Network gateways and proxies; Threat Intelligence Platforms,last 90 days,: ,playbooks/attack/enterprise/T1218.005.yml
T1218.005: Mshta,9d8c3b7a-6f5e-4d3c-2b1a-0e9f8d7c6b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,3,Can we predict if a domain contacted by mshta.exe is malicious based on its intrinsic properties?,"This question applies machine learning to proactively identify malicious domains. Instead of relying on known bad indicators, a model analyzes features like domain name length, character randomness (entropy), and age to calculate a maliciousness score. This helps detect algorithmically generated domains (DGAs) and other suspicious domains.",Zeek dns.log; All enterprise endpoints and servers; Network gateways and proxies; Threat Intelligence Platforms,last 90 days,: ,playbooks/attack/enterprise/T1218.005.yml
T1218.005: Mshta,9d8c3b7a-6f5e-4d3c-2b1a-0e9f8d7c6b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,4,Is mshta.exe being launched with command-line arguments that indicate inline script execution or remote file fetching?,"Legitimate use of mshta.exe typically involves opening a local .hta file. Adversaries abuse it by passing scripts directly on the command line using protocol handlers (`javascript:`, `vbscript:`) or encoded payloads (`data:text/html;base64,`). Detecting these patterns is a high-fidelity indicator of malicious execution.",Windows Event ID 4688; All enterprise endpoints and servers with command-line logging enabled,last 90 days,: ,playbooks/attack/enterprise/T1218.005.yml
T1218.005: Mshta,9d8c3b7a-6f5e-4d3c-2b1a-0e9f8d7c6b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,5,Does an mshta.exe command line exhibit unusually high complexity or length compared to normal activity?,"Long and complex command lines often indicate obfuscation or embedded scripts. By establishing a baseline of normal command line length and entropy, we can use statistical anomaly detection (e.g., 3-sigma rule) to flag suspicious executions that deviate significantly from the norm.",Windows Event ID 4688; All enterprise endpoints and servers with command-line logging enabled,last 90 days,: ,playbooks/attack/enterprise/T1218.005.yml
T1218.005: Mshta,9d8c3b7a-6f5e-4d3c-2b1a-0e9f8d7c6b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,6,Can a machine learning model be trained to distinguish between benign and malicious mshta.exe command lines?,"This question proposes a supervised machine learning approach. By training a classifier on a labeled dataset of known good and bad command lines, the model can learn the subtle patterns and feature combinations (like keyword counts and n-grams) that differentiate them, enabling automated classification of new, unseen command lines.",Windows Event ID 4688; All enterprise endpoints and servers with command-line logging enabled,last 90 days,: ,playbooks/attack/enterprise/T1218.005.yml
T1218.005: Mshta,9d8c3b7a-6f5e-4d3c-2b1a-0e9f8d7c6b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,7,"Was mshta.exe spawned by an unusual parent process, such as a Microsoft Office application, email client, or web browser?",Mshta.exe is not typically launched directly by Office applications or browsers. This execution chain is a common pattern in phishing attacks. Monitoring for this specific parent-child relationship is a highly effective detection strategy.,"Windows Event ID 4688; All enterprise endpoints and servers, particularly user workstations",last 90 days,: ,playbooks/attack/enterprise/T1218.005.yml
T1218.005: Mshta,9d8c3b7a-6f5e-4d3c-2b1a-0e9f8d7c6b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,8,Is mshta.exe being launched by a statistically rare parent process in our environment?,"Beyond a static list of suspicious parents, this question seeks to identify anomalous parent-child relationships based on their historical frequency. By baselining all processes that spawn mshta.exe, we can automatically flag any rare or first-seen parent, which could indicate a novel attack vector.","Windows Event ID 4688; All enterprise endpoints and servers, particularly user workstations",last 90 days,: ,playbooks/attack/enterprise/T1218.005.yml
T1218.005: Mshta,9d8c3b7a-6f5e-4d3c-2b1a-0e9f8d7c6b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,9,Does a new mshta.exe execution event fall outside established clusters of normal activity?,"This question uses unsupervised machine learning to define ""normal"" mshta.exe execution behavior based on multiple features like parent process, user, and host. Any new execution that does not fit into these established clusters is treated as an outlier, indicating a potential anomaly that warrants investigation.","Windows Event ID 4688; All enterprise endpoints and servers, particularly user workstations",last 90 days,: ,playbooks/attack/enterprise/T1218.005.yml
T1218.005: Mshta,9d8c3b7a-6f5e-4d3c-2b1a-0e9f8d7c6b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,10,"Does the mshta.exe command line contain long encoded strings, such as Base64 or hexadecimal?","Adversaries often encode payloads directly in the command line to bypass simple signature-based detections. Searching for long strings that match encoding patterns (Base64, hex) is a specific and effective way to find these embedded payloads, which are highly indicative of malicious intent.",Windows Event ID 4688; All enterprise endpoints and servers with command-line logging,last 90 days,: ,playbooks/attack/enterprise/T1218.005.yml
T1218.005: Mshta,9d8c3b7a-6f5e-4d3c-2b1a-0e9f8d7c6b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,11,Is the character entropy of an mshta.exe command line in the top percentile of historical values?,"High entropy in a command line suggests randomness, which is characteristic of encrypted or compressed data, and thus a strong indicator of an obfuscated payload. Comparing a command line's entropy to a dynamic percentile of recent activity provides a robust anomaly detection method.",Windows Event ID 4688; All enterprise endpoints and servers with command-line logging,last 90 days,: ,playbooks/attack/enterprise/T1218.005.yml
T1218.005: Mshta,9d8c3b7a-6f5e-4d3c-2b1a-0e9f8d7c6b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,12,"Can an autoencoder neural network, trained on benign command lines, identify a new mshta.exe command line as anomalous?","An autoencoder learns to reconstruct ""normal"" data. When presented with anomalous data (like a malicious command line), it struggles to reconstruct it accurately, resulting in a high ""reconstruction error."" This advanced technique can detect novel and sophisticated variations of malicious command lines.",Windows Event ID 4688; All enterprise endpoints and servers with command-line logging,last 90 days,: ,playbooks/attack/enterprise/T1218.005.yml
T1218.005: Mshta,9d8c3b7a-6f5e-4d3c-2b1a-0e9f8d7c6b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,13,"Is network traffic originating from an mshta.exe process using an incorrect, missing, or non-standard User-Agent string?","Legitimate mshta.exe processes identify themselves with a specific User-Agent string. Malicious scripts often fail to set this correctly, resulting in a blank, null, or different User-Agent. Detecting this discrepancy is a strong indicator of malicious network activity.","Windows Event ID 4688; Zeek conn.log; Zeek http.log; Zeek ssl.log; Network egress points, web proxies, and all enterprise endpoints",last 90 days,: ,playbooks/attack/enterprise/T1218.005.yml
T1218.005: Mshta,9d8c3b7a-6f5e-4d3c-2b1a-0e9f8d7c6b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,14,Is mshta.exe communicating over uncommon network ports or using rare TLS fingerprints (JA3/JA3S)?,"Adversaries may use non-standard ports for C2 communication. Similarly, malicious tools often have unique or rare TLS fingerprints (JA3/JA3S). Alerting on rare ports or fingerprints associated with mshta.exe can uncover hidden C2 channels.","Windows Event ID 4688; Zeek conn.log; Zeek http.log; Zeek ssl.log; Network egress points, web proxies, and all enterprise endpoints",last 90 days,: ,playbooks/attack/enterprise/T1218.005.yml
T1218.005: Mshta,9d8c3b7a-6f5e-4d3c-2b1a-0e9f8d7c6b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,15,"Does network traffic from an mshta.exe process show signs of periodic, ""heartbeat"" beaconing to a single destination?","Malware often communicates with its C2 server at regular intervals (a ""heartbeat""). By analyzing the timing between connections from a host to a specific destination, we can use time-series analysis to detect this machine-like periodicity, which is a hallmark of automated C2 activity.","Windows Event ID 4688; Zeek conn.log; Zeek http.log; Zeek ssl.log; Network egress points, web proxies, and all enterprise endpoints",last 90 days,: ,playbooks/attack/enterprise/T1218.005.yml
T1218.005: Mshta,9d8c3b7a-6f5e-4d3c-2b1a-0e9f8d7c6b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,16,"Is mshta.exe executing an HTA file from a suspicious location like a temp folder, download directory, or public user folder?","Adversaries often drop payloads into user-writable and often-unmonitored locations such as temp directories or download folders. Alerting on HTA execution from these specific, high-risk paths is a simple and effective detection tactic.",Windows Event ID 4688; All enterprise endpoints and servers; File servers hosting user profiles or public shares,last 90 days,: ,playbooks/attack/enterprise/T1218.005.yml
T1218.005: Mshta,9d8c3b7a-6f5e-4d3c-2b1a-0e9f8d7c6b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,17,Is mshta.exe executing an HTA file from a directory path that is statistically rare or has never been seen before in the environment?,"This question moves beyond a static list of ""bad"" directories to a data-driven approach. By baselining all directory paths from which HTA files are normally executed, we can automatically identify and alert on executions from new or infrequent locations.",Windows Event ID 4688; All enterprise endpoints and servers; File servers hosting user profiles or public shares,last 90 days,: ,playbooks/attack/enterprise/T1218.005.yml
T1218.005: Mshta,9d8c3b7a-6f5e-4d3c-2b1a-0e9f8d7c6b5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,18,"Can a one-class SVM model, trained on normal HTA file paths, identify an execution path as anomalous?","A One-Class SVM is an unsupervised learning algorithm ideal for anomaly detection. By training it on features of legitimate HTA execution paths, it learns a boundary of ""normal."" Any new execution path that falls outside this boundary is flagged as an anomaly, providing a sophisticated way to detect unusual file locations.",Windows Event ID 4688; All enterprise endpoints and servers; File servers hosting user profiles or public shares,last 90 days,: ,playbooks/attack/enterprise/T1218.005.yml
T1218.013: Mavinject,b9c8d5e0-65f5-4e3a-8f8d-7e4a5b6c7d8e,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,1,"Is a malicious DLL being injected via mavinject.exe, identified by its hash?",Adversaries may use mavinject.exe to load and execute a malicious DLL. This question aims to identify such activity by extracting the hash of the injected DLL and cross-referencing it with a threat intelligence platform. A match provides a high-confidence indicator that the mavinject.exe execution was malicious.,"Windows Event ID 4688; Zeek conn.log; Zeek dns.log; Zeek files.log; All Windows endpoints and servers; Network egress points (e.g., perimeter firewalls, web proxies); Threat Intelligence Platform (TIP)",last 90 days,": FOR each process creation event WHERE process_name == 'mavinject.exe'
  EXTRACT injected_dll_path from command_line
  GET file_hash for injected_dll_path from file creation logs or endpoint tool
  QUERY threat_intel_platform for file_hash
  IF match found THEN ALERT
",playbooks/attack/enterprise/T1218.013.yml
T1218.013: Mavinject,b9c8d5e0-65f5-4e3a-8f8d-7e4a5b6c7d8e,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,2,Is a process injected by mavinject.exe making low-reputation network connections?,"After injecting code into a target process, adversaries often use that process to establish command and control (C2) communications. This question seeks to detect this behavior by identifying the process targeted by mavinject.exe, monitoring its subsequent network activity, and evaluating the reputation of the destination IPs. Connections to low-reputation endpoints are a strong indicator of compromise.","Windows Event ID 4688; Zeek conn.log; Zeek dns.log; Zeek files.log; All Windows endpoints and servers; Network egress points (e.g., perimeter firewalls, web proxies); Threat Intelligence Platform (TIP)",last 90 days,": FOR each process creation event WHERE process_name == 'mavinject.exe'
  EXTRACT target_pid from command_line
  SEARCH for network connections from target_pid within 5 minutes of execution
  FOR each destination_ip
    GET reputation_score from threat_intel_platform
  CALCULATE average_reputation_score
  IF average_reputation_score < 20 THEN ALERT
",playbooks/attack/enterprise/T1218.013.yml
T1218.013: Mavinject,b9c8d5e0-65f5-4e3a-8f8d-7e4a5b6c7d8e,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,3,Can machine learning classify network connections from processes injected by mavinject.exe as malicious?,"This question proposes a more advanced, proactive approach using a machine learning model to classify network behavior from injected processes. By training a classifier on features like destination reputation, port entropy, connection duration, and data volume ratios, this method can detect subtle or novel malicious C2 patterns that might be missed by simple reputation lookups alone.","Windows Event ID 4688; Zeek conn.log; Zeek dns.log; Zeek files.log; All Windows endpoints and servers; Network egress points (e.g., perimeter firewalls, web proxies); Threat Intelligence Platform (TIP)",last 90 days,": APPLY trained logistic regression model to network connections from processes injected by mavinject.exe
MODEL_FEATURES: destination_reputation, port_entropy, connection_duration, sent_vs_received_ratio
IF model_prediction == 'malicious' THEN ALERT
",playbooks/attack/enterprise/T1218.013.yml
T1218.013: Mavinject,b9c8d5e0-65f5-4e3a-8f8d-7e4a5b6c7d8e,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,4,Is mavinject.exe being used to inject a DLL from a suspicious or non-standard directory?,"Adversaries often place malicious payloads in directories that are world-writable or less scrutinized, such as temporary folders or public user directories. This question focuses on detecting mavinject.exe executions that use the '/INJECTRUNNING' or '/HMODULE' flags to load a DLL from a watchlist of known suspicious locations (e.g., C:\Windows\Temp, %APPDATA%).",Windows Event ID 4688; All Windows endpoints and servers; User profile directories (C:\Users\*); System temporary folders (C:\Windows\Temp),last 90 days,": DEFINE suspicious_dirs = ['C:\\Windows\\Temp', '%APPDATA%', 'C:\\Users\\Public']
FOR each process creation event WHERE process_name == 'mavinject.exe' AND (command_line CONTAINS '/INJECTRUNNING' OR command_line CONTAINS '/HMODULE')
  EXTRACT injected_dll_path from command_line
  IF directory of injected_dll_path IN suspicious_dirs THEN ALERT
",playbooks/attack/enterprise/T1218.013.yml
T1218.013: Mavinject,b9c8d5e0-65f5-4e3a-8f8d-7e4a5b6c7d8e,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,5,Is mavinject.exe injecting a DLL from a directory that is statistically rare across the enterprise?,"This question provides a dynamic alternative to static watchlists by baselining directory usage. It involves calculating the prevalence of all directories from which DLLs are injected over a 90-day period. An injection originating from a directory that is very uncommon (e.g., in the bottom 5th percentile of prevalence) is flagged as suspicious, as it deviates from established software behavior across the enterprise.",Windows Event ID 4688; All Windows endpoints and servers; User profile directories (C:\Users\*); System temporary folders (C:\Windows\Temp),last 90 days,": MAINTAIN 90-day baseline of injection source directory prevalence
FOR each mavinject.exe injection event
  EXTRACT source_directory from command_line
  CALCULATE prevalence_percentile for source_directory from baseline
  IF prevalence_percentile < 5 THEN ALERT
",playbooks/attack/enterprise/T1218.013.yml
T1218.013: Mavinject,b9c8d5e0-65f5-4e3a-8f8d-7e4a5b6c7d8e,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,6,Can an anomaly detection model identify suspicious DLL file paths used in mavinject.exe injections?,"This question describes using an unsupervised machine learning model, such as an Isolation Forest, to detect anomalous DLL file paths. Rather than relying on directory names or prevalence, this model analyzes intrinsic features of the path itself—such as depth, string entropy, and the presence of keywords—to identify paths that do not conform to learned patterns of normalcy.",Windows Event ID 4688; All Windows endpoints and servers; User profile directories (C:\Users\*); System temporary folders (C:\Windows\Temp),last 90 days,": APPLY trained Isolation Forest model to new mavinject.exe injection file paths
MODEL_FEATURES: path_depth, directory_name_entropy, keyword_presence ('temp', 'public')
IF anomaly_score is high THEN ALERT
",playbooks/attack/enterprise/T1218.013.yml
T1218.013: Mavinject,b9c8d5e0-65f5-4e3a-8f8d-7e4a5b6c7d8e,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,7,Is mavinject.exe being launched from a common user application to inject into a critical system process?,"A process chain where a standard user application (like Microsoft Word or PowerShell) spawns mavinject.exe to inject code into a critical system process (like lsass.exe) is a classic and high-fidelity indicator of malicious activity, often related to credential theft or defense evasion. This question aims to create a specific detection rule for this suspicious ancestry.",Windows Event ID 4688; Domain Controllers; Critical application servers; Process creation logs from all Windows endpoints,last 90 days,": DEFINE suspicious_parents = ['winword.exe', 'excel.exe', 'powershell.exe']
DEFINE sensitive_targets = ['lsass.exe', 'csrss.exe', 'services.exe']
FOR each event WHERE process_name == 'mavinject.exe'
  RESOLVE target_process_name from target_pid in command_line
  IF parent_process_name IN suspicious_parents AND target_process_name IN sensitive_targets THEN ALERT
",playbooks/attack/enterprise/T1218.013.yml
T1218.013: Mavinject,b9c8d5e0-65f5-4e3a-8f8d-7e4a5b6c7d8e,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,8,Are there statistically rare process execution chains involving mavinject.exe?,"Building on the previous question, this uses a statistical approach to find anomalous process chains. It involves baselining the frequency of all (Parent Process, mavinject.exe, Target Process) triplets over 90 days. A triplet that has rarely or never been observed (e.g., in the bottom 1st percentile of frequency) is flagged as suspicious, allowing for the detection of novel attack paths not covered by static rules.",Windows Event ID 4688; Domain Controllers; Critical application servers; Process creation logs from all Windows endpoints,last 90 days,": MAINTAIN 90-day baseline of (Parent, Child, Target) process triplet frequency
FOR each mavinject.exe execution
  CONSTRUCT triplet = (ParentProcess, 'mavinject.exe', TargetProcess)
  GET frequency_percentile of triplet from baseline
  IF frequency_percentile < 1 THEN ALERT
",playbooks/attack/enterprise/T1218.013.yml
T1218.013: Mavinject,b9c8d5e0-65f5-4e3a-8f8d-7e4a5b6c7d8e,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,9,Can a graph-based anomaly detection model identify suspicious process ancestry involving mavinject.exe?,"This question describes an advanced technique for modeling process relationships as a graph. By representing processes as nodes and parent-child relationships as edges, graph-based anomaly detection algorithms can identify and score unusual paths. An event chain like 'winword.exe -> mavinject.exe -> lsass.exe' would appear as a high-scoring anomalous path, providing a strong, context-rich signal of malicious activity.",Windows Event ID 4688; Domain Controllers; Critical application servers; Process creation logs from all Windows endpoints,last 90 days,": INGEST process creation logs into a graph database
NODES = processes, EDGES = parent-child relationships
RUN graph anomaly detection algorithm to score paths
ALERT on high-scoring paths involving 'mavinject.exe'
",playbooks/attack/enterprise/T1218.013.yml
T1218.013: Mavinject,b9c8d5e0-65f5-4e3a-8f8d-7e4a5b6c7d8e,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,10,Has mavinject.exe executed for the first time on a host?,"The initial appearance of a tool like mavinject.exe on a host where it has never been seen before is a significant event that warrants investigation. This question involves maintaining a stateful list of hosts that have previously run mavinject.exe and triggering an alert when an execution occurs on any host not on that list, which could indicate the initial stages of a compromise.",Windows Event ID 4688; Enterprise-wide process execution logs stored in a SIEM; Host-based asset inventory; Baselining data for normal process counts,last 90 days,": MAINTAIN lookup of hosts with mavinject.exe executions in last 90 days
FOR each new mavinject.exe execution event
  IF hostname NOT IN lookup THEN
    ALERT on 'First time seen execution'
    ADD hostname to lookup
",playbooks/attack/enterprise/T1218.013.yml
T1218.013: Mavinject,b9c8d5e0-65f5-4e3a-8f8d-7e4a5b6c7d8e,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,11,Is there a statistically significant spike in the enterprise-wide execution of mavinject.exe?,"A sudden, widespread increase in mavinject.exe executions can signal a large-scale, automated attack. This question aims to detect such events by calculating a 30-day moving average and standard deviation for hourly mavinject.exe execution counts. An alert is generated if the current hourly count exceeds the baseline by a significant threshold (e.g., 3 standard deviations).",Windows Event ID 4688; Enterprise-wide process execution logs stored in a SIEM; Host-based asset inventory; Baselining data for normal process counts,last 90 days,": CALCULATE 30-day moving average (MA) and standard deviation (SD) of hourly mavinject.exe executions
GET current_hourly_count
IF current_hourly_count > (MA + 3*SD) THEN ALERT
",playbooks/attack/enterprise/T1218.013.yml
T1218.013: Mavinject,b9c8d5e0-65f5-4e3a-8f8d-7e4a5b6c7d8e,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,12,Can a time-series model detect anomalous bursts in mavinject.exe execution activity?,"This question outlines a more sophisticated method for detecting unusual spikes in activity. By applying a time-series decomposition model (e.g., STL), the execution data is broken down into trend, seasonality, and residual components. This allows for the detection of significant spikes in the residual component, which represents unexplained variance, thereby filtering out normal periodic fluctuations to identify true anomalies.",Windows Event ID 4688; Enterprise-wide process execution logs stored in a SIEM; Host-based asset inventory; Baselining data for normal process counts,last 90 days,": APPLY time-series decomposition model to hourly mavinject.exe execution counts
EXTRACT residual component from model
IF residual value exceeds a learned threshold THEN ALERT on anomalous burst",playbooks/attack/enterprise/T1218.013.yml
T1219.002: Remote Desktop Software,f4b3a4e8-8e6d-4c3a-9b1f-7d1e8c0b2a9c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,1,Are there outbound network connections to known malicious C2 domains/IPs or unsanctioned remote desktop services?,"This question aims to identify direct C2 communication by cross-referencing network logs with threat intelligence. A match provides a high-confidence indicator of a policy violation at minimum, or an active compromise if the destination is a known malicious C2 server. This is a foundational, indicator-based detection method.","Zeek conn.log; Zeek dns.log; Corporate network egress points (firewalls, proxies); DNS resolvers; Network sensor grid",last 90 days,: ,playbooks/attack/enterprise/T1219.002.yml
T1219.002: Remote Desktop Software,f4b3a4e8-8e6d-4c3a-9b1f-7d1e8c0b2a9c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,2,"Are hosts making DNS queries for remote desktop service subdomains with unusually high entropy, possibly indicating DGA usage?","Adversaries may use Domain Generation Algorithms (DGAs) to create random-looking subdomains for C2 communication, making blocklisting difficult. Calculating the Shannon entropy of subdomains for known RDP services (e.g., *.anydesk.com) can reveal these algorithmically generated names, which appear more random than human-created ones. High entropy suggests potential DGA-based C2.",Zeek dns.log; DNS resolvers; Network sensor grid,last 90 days,: ,playbooks/attack/enterprise/T1219.002.yml
T1219.002: Remote Desktop Software,f4b3a4e8-8e6d-4c3a-9b1f-7d1e8c0b2a9c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,3,"Can a machine learning model identify malicious, long-lived connections to unknown external IP addresses masquerading as legitimate traffic?","This question addresses the detection of unknown or novel C2 channels that bypass indicator-based searches. By training a classification model (e.g., Random Forest) on connection metadata (duration, bytes, protocol), the model can learn to distinguish the characteristics of malicious traffic from benign traffic, even when the destination is not on a known blocklist.","Zeek conn.log; Corporate network egress points (firewalls, proxies); Network sensor grid",last 90 days,: ,playbooks/attack/enterprise/T1219.002.yml
T1219.002: Remote Desktop Software,f4b3a4e8-8e6d-4c3a-9b1f-7d1e8c0b2a9c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,4,Is remote desktop software being executed from a non-standard file path or spawned by an unusual parent process?,"Legitimate applications are typically installed in standard directories like 'C:\Program Files\'. An adversary might drop a portable version of an RDP tool into a temporary or user-writable directory. Detecting executions from non-standard paths or from unusual parent processes (e.g., 'wscript.exe' instead of 'explorer.exe') is a strong indicator of malicious activity.",Windows Event ID 4688; Endpoint Detection and Response (EDR) agents on workstations and servers; SIEM log collectors for Windows Event Logs,last 90 days,: ,playbooks/attack/enterprise/T1219.002.yml
T1219.002: Remote Desktop Software,f4b3a4e8-8e6d-4c3a-9b1f-7d1e8c0b2a9c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,5,Is a remote desktop process being spawned by a statistically rare parent process?,"This question aims to find anomalous execution chains. By establishing a baseline of normal parent-child process relationships on each host, you can identify when an RDP tool is launched by a process that has rarely or never launched it before. This can uncover attempts by malware or scripts to initiate a remote session.",Windows Event ID 4688; Endpoint Detection and Response (EDR) agents on workstations and servers,last 90 days,: ,playbooks/attack/enterprise/T1219.002.yml
T1219.002: Remote Desktop Software,f4b3a4e8-8e6d-4c3a-9b1f-7d1e8c0b2a9c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,6,Can an anomaly detection model identify illegitimate executions of remote desktop software?,"This question seeks to identify malicious executions that deviate from established normal behavior. A one-class SVM model can be trained on features of known-good RDP software executions (e.g., user context, parent process, file path). The model can then flag new executions that are classified as outliers, indicating a potentially unauthorized or malicious use case.",Windows Event ID 4688; Endpoint Detection and Response (EDR) agents on workstations and servers,last 90 days,: ,playbooks/attack/enterprise/T1219.002.yml
T1219.002: Remote Desktop Software,f4b3a4e8-8e6d-4c3a-9b1f-7d1e8c0b2a9c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,7,Is remote desktop software being executed with command-line arguments that indicate silent installation or unattended access configuration?,"Adversaries need to install and configure remote access tools without alerting the user. They often use specific command-line flags like '--silent', '--set-password', or '--start-with-win'. Searching for these flags in process creation logs provides direct evidence of an attempt to establish persistent, unattended remote access.",Windows Event ID 4688; All Windows endpoints (workstations and servers) forwarding process creation logs,last 90 days,: ,playbooks/attack/enterprise/T1219.002.yml
T1219.002: Remote Desktop Software,f4b3a4e8-8e6d-4c3a-9b1f-7d1e8c0b2a9c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,8,Are statistically rare command-line arguments being used with authorized remote desktop applications?,"This question addresses the misuse of legitimate, sanctioned software. Even an approved RDP tool can be used maliciously. By profiling the frequency of all command-line arguments used across the enterprise, you can detect when an employee or attacker uses a rare argument, especially one related to unattended access, which might signal misuse.",Windows Event ID 4688; All Windows endpoints (workstations and servers) forwarding process creation logs,last 90 days,: ,playbooks/attack/enterprise/T1219.002.yml
T1219.002: Remote Desktop Software,f4b3a4e8-8e6d-4c3a-9b1f-7d1e8c0b2a9c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,9,Can topic modeling on command-line arguments reveal malicious remote desktop software usage?,"This question explores the semantic context of command-line usage. Latent Dirichlet Allocation (LDA) can be used to discover 'topics' from a large set of command-line arguments. Some topics will naturally correspond to malicious activity (e.g., a topic containing terms like 'password', 'silent', 'wget'). New RDP process commands can be scored against these topics to identify malicious intent.",Windows Event ID 4688; All Windows endpoints (workstations and servers) forwarding process creation logs,last 90 days,: ,playbooks/attack/enterprise/T1219.002.yml
T1219.002: Remote Desktop Software,f4b3a4e8-8e6d-4c3a-9b1f-7d1e8c0b2a9c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,10,"Has a host exhibited a correlated sequence of downloading, executing, and connecting to a remote desktop service within a short time window?","This question looks for a common attack chain: drop, execute, and connect. By creating a stateful rule that links a file download, a subsequent process execution of that file, and a new outbound network connection from that process, all within a few minutes, you can create a high-fidelity alert for a fresh RDP tool deployment.","Zeek http.log; Zeek files.log; Windows Event ID 4688; Zeek conn.log; User workstations, Network egress points, DNS resolvers, EDR-enabled endpoints",last 90 days,: ,playbooks/attack/enterprise/T1219.002.yml
T1219.002: Remote Desktop Software,f4b3a4e8-8e6d-4c3a-9b1f-7d1e8c0b2a9c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,11,"Has a download-execute-connect sequence involving a specific remote desktop tool been observed for the first time on a host, and is this sequence rare across the enterprise?","This question adds statistical rarity to the correlation rule to reduce false positives from legitimate first-time installations. If the download-execute-connect sequence is a first for a particular host AND that specific tool's installation is rare across the entire organization, the likelihood of it being malicious is significantly higher.","Zeek http.log; Zeek files.log; Windows Event ID 4688; Zeek conn.log; User workstations, Network egress points, DNS resolvers, EDR-enabled endpoints",last 90 days,: ,playbooks/attack/enterprise/T1219.002.yml
T1219.002: Remote Desktop Software,f4b3a4e8-8e6d-4c3a-9b1f-7d1e8c0b2a9c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,12,Can a sequence analysis model detect the pattern of a malicious remote desktop software installation in real-time?,"This question involves using advanced models (like RNNs or HMMs) to detect attack patterns that may be more complex or varied than a simple A->B->C sequence. By training a model on event streams from both benign and malicious activities, it can learn to identify when a host's real-time event stream indicates it is in a 'malicious RDP install' state with a certain probability.","Zeek http.log; Zeek files.log; Windows Event ID 4688; Zeek conn.log; User workstations, Network egress points, DNS resolvers, EDR-enabled endpoints",last 90 days,: ,playbooks/attack/enterprise/T1219.002.yml
T1219.002: Remote Desktop Software,f4b3a4e8-8e6d-4c3a-9b1f-7d1e8c0b2a9c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,13,Are there any connections to remote desktop services with excessively long durations or suspicious connection history flags?,"This question aims to find C2 channels that an attacker leaves open for extended periods. A simple rule can flag any RDP connection that lasts longer than a reasonable workday (e.g., 24 hours). Additionally, Zeek's 'history' field can contain flags indicating protocol anomalies or potential tunneling within the session, which are also strong indicators of non-standard use.","Zeek conn.log; Network flow collectors (e.g., Zeek sensors) at network egress points and internal network chokepoints",last 90 days,: ,playbooks/attack/enterprise/T1219.002.yml
T1219.002: Remote Desktop Software,f4b3a4e8-8e6d-4c3a-9b1f-7d1e8c0b2a9c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,14,Is a host exhibiting anomalous outbound data volume or connection duration for a remote desktop session compared to its own baseline?,"This question seeks to find anomalies by comparing a host's activity against its own past behavior. A large data exfiltration event over an RDP session would generate a much higher outbound byte count than normal interactive use. By baselining each host's typical RDP session duration and data volume, you can detect significant deviations that suggest misuse.","Zeek conn.log; Network flow collectors (e.g., Zeek sensors) at network egress points and internal network chokepoints",last 90 days,: ,playbooks/attack/enterprise/T1219.002.yml
T1219.002: Remote Desktop Software,f4b3a4e8-8e6d-4c3a-9b1f-7d1e8c0b2a9c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,15,Can a time-series model detect anomalous traffic patterns within an active remote desktop session?,"This question focuses on detecting anomalies within the traffic flow of a live RDP session. An LSTM autoencoder can learn the normal 'rhythm' (bytes/sec, packets/sec) of an interactive session. A significant deviation from this learned pattern, such as the steady flow of a large file transfer, will cause a spike in the model's reconstruction error, triggering an alert for anomalous in-session activity.","Zeek conn.log; Network flow collectors (e.g., Zeek sensors) at network egress points and internal network chokepoints",last 90 days,: ,playbooks/attack/enterprise/T1219.002.yml
T1219.002: Remote Desktop Software,f4b3a4e8-8e6d-4c3a-9b1f-7d1e8c0b2a9c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,16,Has a remote interactive logon occurred from a user-host combination that is not on an explicit allow-list?,"This question provides a high-confidence detection method for environments with strict access controls. By maintaining an explicit list of which users are authorized to remotely access which hosts, any interactive logon (Logon Type 10) that does not match an entry on this list is an immediate and actionable security alert.","Windows Event ID 4624; Domain Controllers, RADIUS/authentication servers, and endpoint logs from user workstations and servers",last 90 days,: ,playbooks/attack/enterprise/T1219.002.yml
T1219.002: Remote Desktop Software,f4b3a4e8-8e6d-4c3a-9b1f-7d1e8c0b2a9c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,17,"Has a user performed a remote logon that deviates from their established behavioral profile in terms of time, source IP, or source hostname?","This question seeks to identify suspicious logons by building a 'pattern of life' for each user. A new remote logon is scored based on how much it deviates from the user's normal behavior (e.g., logon at 3 AM, from a new country, or from a server they've never accessed before). A high risk score indicates a logon that is highly anomalous for that specific user and warrants investigation.","Windows Event ID 4624; Zeek conn.log; Domain Controllers, RADIUS/authentication servers, and endpoint logs from user workstations and servers",last 90 days,: ,playbooks/attack/enterprise/T1219.002.yml
T1219.002: Remote Desktop Software,f4b3a4e8-8e6d-4c3a-9b1f-7d1e8c0b2a9c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,18,Can a clustering algorithm identify anomalous remote logons that do not fit a user's normal 'pattern of life'?,"This question uses machine learning to formalize 'pattern of life' analysis. A clustering algorithm like DBSCAN can group a user's past logons into clusters of normal activity. A new logon that does not fall into any of these clusters is considered an outlier or 'noise' and represents a significant deviation from all previously observed behaviors for that user, triggering an alert.","Windows Event ID 4624; Domain Controllers, RADIUS/authentication servers, and endpoint logs from user workstations and servers",last 90 days,: ,playbooks/attack/enterprise/T1219.002.yml
T1219: Remote Access Tools,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0011: Command and Control,n; o; n; e,1,Are any internal assets communicating with known malicious Remote Access Software C2 infrastructure?,"This question aims to detect direct communication with adversary-controlled servers by comparing outbound network traffic (IP addresses, domains, and SSL/TLS Server Name Indication) against threat intelligence feeds of known malicious RAT C2 indicators. A direct match is a high-fidelity indicator of a potential compromise and warrants immediate investigation.","Zeek conn.log; Zeek dns.log; Zeek ssl.log; Network egress points (e.g., firewalls, proxies), DNS resolvers",last 90 days,"SEARCH network_logs (conn, dns, ssl) WHERE destination_ip OR destination_domain OR server_name IN threat_intel_feed_of_rat_c2",playbooks/attack/enterprise/T1219.yml
T1219: Remote Access Tools,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0011: Command and Control,n; o; n; e,2,Is an internal asset connecting to a domain that is typosquatting a legitimate remote access service?,"Adversaries often register domains that are visually similar to legitimate ones (e.g., 'anydesl.com' instead of 'anydesk.com') to trick users or evade simple blocklists. This question uses the Levenshtein distance algorithm to find such 'look-alike' domains in TLS traffic (SNI field), which can indicate an attempt to masquerade malicious infrastructure as a legitimate service.","Zeek ssl.log; Network egress points (e.g., firewalls, proxies), DNS resolvers",last 90 days,"FOR EACH outbound_tls_connection: CALCULATE levenshtein_distance(connection.sni, known_good_rat_domains). IF distance > 0 AND distance <= 2, ALERT.",playbooks/attack/enterprise/T1219.yml
T1219: Remote Access Tools,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0011: Command and Control,n; o; n; e,3,Are internal assets attempting to resolve domains that appear to be generated by a Domain Generation Algorithm (DGA)?,"Malware, including some RATs, uses Domain Generation Algorithms (DGAs) to create a large, rotating set of potential C2 domains, making it difficult for defenders to block them all. This question involves using a pre-trained machine learning model to analyze newly observed DNS queries and identify domains that have the linguistic characteristics of being algorithmically generated, which are highly suspicious.","Zeek dns.log; Network egress points (e.g., firewalls, proxies), DNS resolvers",last 90 days,"FOR EACH new_domain IN dns_logs: IF dga_detection_model(domain) > confidence_threshold, ALERT.",playbooks/attack/enterprise/T1219.yml
T1219: Remote Access Tools,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0011: Command and Control,n; o; n; e,4,Has a remote access tool been installed silently and configured for persistence as a service or via a registry run key?,"Adversaries often install RATs using silent or unattended flags to avoid user interaction and then immediately create a persistence mechanism (like a new Windows Service or a Registry Run key) to ensure the tool runs automatically on system startup. This question looks for this specific chain of events occurring on the same host within a short time frame (e.g., 5 minutes), which strongly indicates a malicious installation rather than legitimate administrative use.","Windows Event ID 4688; Windows Event ID 7045; Windows Event ID 4657; Endpoint devices (workstations, servers), Domain Controllers (for Group Policy changes)",last 90 days,"CORRELATE process_creation (event 4688, process=rat.exe, args='--silent') with service_creation (event 7045) OR registry_mod (event 4657) for same executable WITHIN 5 minutes ON same_host.",playbooks/attack/enterprise/T1219.yml
T1219: Remote Access Tools,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0011: Command and Control,n; o; n; e,5,Is an authorized remote access tool being executed in a statistically unusual manner?,"Even legitimate, authorized tools can be used maliciously ('living off the land'). This question aims to find this abuse by first establishing a baseline of normal usage patterns, such as common parent processes and command-line arguments. Executions that deviate significantly from this established norm, such as a RAT being launched by an uncommon parent process or with rare arguments (e.g., in the bottom 5th percentile of historical frequency), are flagged as anomalous and potentially malicious.","Windows Event ID 4688; Endpoint devices (workstations, servers), Domain Controllers (for Group Policy changes)",last 90 days,"BASELINE frequency of (parent_process, command_line) for each authorized_rat. ALERT IF current_execution_combination_frequency < 5th_percentile.",playbooks/attack/enterprise/T1219.yml
T1219: Remote Access Tools,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0011: Command and Control,n; o; n; e,6,Does a machine learning model classify a specific remote access tool execution event as malicious?,"This question leverages a supervised machine learning model (e.g., a Random Forest classifier) trained to distinguish between benign and malicious RAT executions. By analyzing a combination of features like the process name, parent process, command-line complexity (entropy), and the presence of suspicious keywords ('install', 'password'), the model can provide a confidence score for whether a given execution is malicious, helping to automate the detection of sophisticated abuse.","Windows Event ID 4688; Endpoint devices (workstations, servers), Domain Controllers (for Group Policy changes)",last 90 days,"FOR EACH rat_process_creation_event: SCORE event using classification_model. IF score > 0.90, ALERT.",playbooks/attack/enterprise/T1219.yml
T1219: Remote Access Tools,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0011: Command and Control,n; o; n; e,7,Has a remote access tool been launched from a suspicious parent process or an atypical file path?,"Legitimate remote access tools are typically launched by administrators or their tools from standard installation directories like 'Program Files'. Adversaries, however, often drop and run RATs from user-writable temporary locations (e.g., AppData, Temp) or as child processes of compromised applications like web browsers or Microsoft Office documents. This question creates a rule to detect these highly suspicious execution patterns.","Windows Event ID 4688; Endpoint devices (workstations, servers)",last 90 days,"SEARCH process_creation (event 4688) WHERE (child_process=rat.exe AND parent_process IN [office_apps, browsers, script_interpreters]) OR (child_process=rat.exe AND path NOT IN ['C:\Program Files\', 'C:\Program Files (x86)\']).",playbooks/attack/enterprise/T1219.yml
T1219: Remote Access Tools,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0011: Command and Control,n; o; n; e,8,"Is a remote access tool being executed by a statistically improbable parent process, or is it running from a file path with unusually high entropy?","This question uses statistical analysis to find anomalies. It identifies RAT executions by parent processes that rarely, if ever, launch them, indicating a break in normal operational patterns. It also looks for high-entropy (random-looking) file paths in standard system directories, which is a common tactic for malware trying to hide its payload by giving it a randomized name within a trusted location.","Windows Event ID 4688; Endpoint devices (workstations, servers)",last 90 days,CALCULATE parent-child_probabilities. ALERT IF P(rat.exe | parent_process) < 0.0001. CALCULATE shannon_entropy(file_path). ALERT IF path in system_dirs AND entropy > threshold.,playbooks/attack/enterprise/T1219.yml
T1219: Remote Access Tools,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0011: Command and Control,n; o; n; e,9,Can remote access tool executions be clustered into 'normal' and 'outlier' groups to identify suspicious activity?,"This question applies unsupervised machine learning (e.g., DBSCAN clustering) to group all remote access tool executions based on their characteristics (file path, parent process, command line). The assumption is that legitimate administrative use will form large, dense clusters, while malicious activity will appear as small, isolated outlier clusters. This helps analysts focus their attention on the most unusual and likely malicious events without prior labeling.","Windows Event ID 4688; Endpoint devices (workstations, servers)",last 90 days,"CLUSTER rat_execution_events using DBSCAN on features (path, parent, cmdline). INVESTIGATE events in outlier clusters.",playbooks/attack/enterprise/T1219.yml
T1219: Remote Access Tools,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0011: Command and Control,n; o; n; e,10,Is there network traffic on common remote access ports originating from a restricted network segment or exhibiting an unusually long duration?,"This question uses policy and duration-based rules to find suspicious RAT activity. It checks for traffic on default RAT ports (e.g., 5938 for TeamViewer) originating from network zones where it should not exist based on security policy (e.g., server VLANs). It also flags connections that are active for an exceptionally long time (e.g., over 48 hours), which can indicate a persistent C2 channel rather than a temporary administrative session.","Zeek conn.log; Network egress points, internal network sensor grid (e.g., core switch SPAN ports)",last 90 days,"SEARCH conn_logs WHERE port IN [5938, 6568] AND ((source_ip IN server_vlan) OR (duration > 48_hours)).",playbooks/attack/enterprise/T1219.yml
T1219: Remote Access Tools,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0011: Command and Control,n; o; n; e,11,"Is any host sending an anomalous amount of data to a remote access service, or is the traffic pattern indicative of data exfiltration?","Legitimate remote access is interactive and typically has a balanced ratio of data sent and received. Adversaries using RATs for data exfiltration will send far more data than they receive. This question establishes a 30-day baseline of normal traffic volume for each host and alerts on significant deviations (e.g., exceeding the 99th percentile) or highly asymmetric traffic ratios (e.g., 20:1 sent to received), both of which are strong indicators of data theft.","Zeek conn.log; Network egress points, internal network sensor grid (e.g., core switch SPAN ports)",last 90 days,BASELINE outbound_bytes per host for 30 days. ALERT IF daily_outbound_bytes > 99th_percentile. ALERT IF (bytes_sent / bytes_received) > 20.,playbooks/attack/enterprise/T1219.yml
T1219: Remote Access Tools,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0011: Command and Control,n; o; n; e,12,"Is there an anomalous spike in overall remote access tool activity across the enterprise, especially during non-business hours?","This question takes a macro view by analyzing enterprise-wide RAT traffic patterns over time. A time-series model (e.g., ARIMA) learns the normal 'heartbeat' of business activity (e.g., high activity during the workday, low activity at night and on weekends/holidays). Alerts are generated for significant deviations from this learned rhythm, which could indicate a widespread, coordinated malicious campaign operating outside of normal business hours.","Zeek conn.log; Network egress points, internal network sensor grid (e.g., core switch SPAN ports)",last 90 days,"MODEL hourly RAT activity using ARIMA. ALERT IF current_activity is an anomaly based on the model, especially during off-hours.",playbooks/attack/enterprise/T1219.yml
T1219: Remote Access Tools,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0011: Command and Control,n; o; n; e,13,"Has a common initial access sequence (e.g., Office macro to PowerShell) been observed, immediately followed by the download and execution of a remote access tool?","This question aims to detect a classic adversary kill chain on an endpoint. It correlates events across different data sources (process logs, network logs) to identify a specific, high-confidence attack pattern: a user-facing application (like Word) launching a script interpreter (like PowerShell), which then makes a network connection to download a file, followed by the execution of a known RAT, all within a very short timeframe (e.g., 2 minutes).","Windows Event ID 4688; Zeek http.log; Zeek files.log; Endpoint devices (workstations, servers), Web proxy/gateway",last 90 days,CORRELATE (process1: office_app -> powershell) with (network: powershell downloads file) with (process2: rat.exe execution) ON same_host WITHIN 2 minutes.,playbooks/attack/enterprise/T1219.yml
T1219: Remote Access Tools,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0011: Command and Control,n; o; n; e,14,Has a remote access tool been launched by a script interpreter with a time delay that suggests automated execution rather than manual user interaction?,"Humans have a natural delay when typing commands in a shell. Automated scripts, however, execute commands almost instantaneously. This question analyzes the time delta between a script interpreter (like PowerShell) starting and it launching a child process (like a RAT). An extremely short delay (e.g., under 500 milliseconds) is a strong indicator that the action was scripted and automated, which is characteristic of malware execution.","Windows Event ID 4688; Endpoint devices (workstations, servers), Web proxy/gateway",last 90 days,CALCULATE time_delta between parent (script) and child (rat) process creation. ALERT IF time_delta < 500ms.,playbooks/attack/enterprise/T1219.yml
T1219: Remote Access Tools,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0011: Command and Control,n; o; n; e,15,Does a sequence-based machine learning model classify a chain of process executions as a known malicious pattern involving a remote access tool?,"This question uses a more advanced sequence-aware model (like a Hidden Markov Model) to understand the 'story' of process executions. The model is trained to recognize entire chains of events that are characteristic of attacks. It can then flag real-time event streams that match a malicious sequence, such as the state transition from an Office App -> to a Scripting Engine -> to a Remote Access Tool, even if each individual step might seem benign in isolation.","Windows Event ID 4688; Endpoint devices (workstations, servers), Web proxy/gateway",last 90 days,"FEED process_event_stream into HMM. ALERT IF sequence probability for malicious_path (e.g., Office->Script->RAT) > threshold.",playbooks/attack/enterprise/T1219.yml
T1222.001: Windows File and Directory Permissions Modification,2d8b4a7e-1f8c-4e5a-9d6f-7c1b8a0d3e9f,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,1,"Are known malicious versions of permission modification tools (icacls.exe, cacls.exe, takeown.exe, attrib.exe) being executed?",Adversaries may replace legitimate system utilities with malicious versions or use trojanized tools that masquerade as legitimate ones. This question aims to detect the execution of these specific permission-modifying tools by checking their file hashes against a threat intelligence feed. A match is a high-confidence indicator of compromise.,"Windows Event ID 4688; All Windows endpoints and servers, with a focus on Domain Controllers, authentication servers, critical application servers, and file servers.",last 90 days,": SEARCH process_creation_events (e.g., EventID 4688)
WHERE process_name IN ('icacls.exe', 'cacls.exe', 'takeown.exe', 'attrib.exe')
FOR_EACH event:
  image_hash = HASH(event.process_path)
  is_malicious = QUERY_THREAT_INTEL_API(image_hash)
  IF is_malicious == TRUE:
    ALERT ""Known malicious permission modification tool executed""
",playbooks/attack/enterprise/T1222.001.yml
T1222.001: Windows File and Directory Permissions Modification,2d8b4a7e-1f8c-4e5a-9d6f-7c1b8a0d3e9f,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,2,Are permission modification tools being executed with unusually complex or obfuscated command lines?,"High Shannon entropy in command-line arguments can indicate obfuscation, a common technique used by adversaries to hide their commands from simple signature-based detection. This question looks for executions of permission modification tools where the command-line arguments are statistically unusual compared to a learned baseline of normal administrative activity, suggesting malicious intent.","Windows Event ID 4688; All Windows endpoints and servers, with a focus on Domain Controllers, authentication servers, critical application servers, and file servers.",last 90 days,": SEARCH process_creation_events (e.g., EventID 4688)
WHERE process_name IN ('icacls.exe', 'cacls.exe', 'takeown.exe', 'attrib.exe')
FOR_EACH event:
  entropy = CALCULATE_ENTROPY(event.command_line)
  baseline_entropy = GET_BASELINE_ENTROPY(event.user_role)
  IF entropy > 95th_percentile(baseline_entropy):
    ALERT ""Anomalous command-line entropy for permission modification tool""
",playbooks/attack/enterprise/T1222.001.yml
T1222.001: Windows File and Directory Permissions Modification,2d8b4a7e-1f8c-4e5a-9d6f-7c1b8a0d3e9f,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,3,Can we use machine learning to classify executions of permission modification tools as benign or malicious based on multiple contextual features?,"This question proposes a more advanced, holistic detection method. Instead of relying on a single indicator, a supervised machine learning model can analyze a combination of features (e.g., parent process, user context, command-line length, command-line entropy) to make a more nuanced decision, potentially reducing false positives and detecting novel threats that evade simpler rules.","Windows Event ID 4688; All Windows endpoints and servers, with a focus on Domain Controllers, authentication servers, critical application servers, and file servers.",last 90 days,": SEARCH process_creation_events (e.g., EventID 4688)
WHERE process_name IN ('icacls.exe', 'cacls.exe', 'takeown.exe', 'attrib.exe')
FOR_EACH event:
  features = EXTRACT_FEATURES(event)
  prediction = ML_MODEL.predict(features)
  IF prediction == 'malicious':
    ALERT ""ML model classified permission modification as malicious""
",playbooks/attack/enterprise/T1222.001.yml
T1222.001: Windows File and Directory Permissions Modification,2d8b4a7e-1f8c-4e5a-9d6f-7c1b8a0d3e9f,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,4,Are overly permissive access rights being granted to broad user groups on critical system files or directories?,"Adversaries often grant ""Full Control"" or ""Modify"" permissions to groups like ""Everyone"" or ""Authenticated Users"" on critical system directories (e.g., C:\Windows\System32) to facilitate persistence or further privilege escalation. This question specifically hunts for command-line evidence of this activity using regular expressions to find these dangerous permission grants.","Windows Event ID 4688; Critical system directories such as C:\Windows\System32, C:\Windows\SysWOW64, C:\ProgramData, and user profile directories on all Windows endpoints and servers.",last 90 days,": SEARCH process_creation_events (e.g., EventID 4688)
WHERE process_name IN ('icacls.exe', 'cacls.exe', 'powershell.exe')
AND command_line MATCHES REGEX `/(grant|g).*(Everyone|Authenticated Users|Users).*:([Ff]|[Mm])/`
AND target_path IN (critical_directory_list)
ALERT ""Overly permissive rights granted on critical directory""
",playbooks/attack/enterprise/T1222.001.yml
T1222.001: Windows File and Directory Permissions Modification,2d8b4a7e-1f8c-4e5a-9d6f-7c1b8a0d3e9f,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,5,Is any user modifying permissions on critical directories at a rate that is anomalous for their role?,"While some permission changes are normal, a sudden spike in this activity for a specific user, especially when compared to their peers or their own historical behavior, can be suspicious. This question aims to detect such statistical outliers, which might indicate automated scripting by an adversary or a compromised account.","Windows Event ID 4688; Critical system directories such as C:\Windows\System32, C:\Windows\SysWOW64, C:\ProgramData, and user profile directories on all Windows endpoints and servers.",last 90 days,": BASELINE modification counts per user role per hour on critical directories.
FOR_EACH user:
  current_hour_count = COUNT modifications on critical dirs in last hour
  role_baseline = GET_BASELINE(user.role)
  IF current_hour_count > 99th_percentile(role_baseline):
    ALERT ""Anomalous frequency of permission modifications for user role""
",playbooks/attack/enterprise/T1222.001.yml
T1222.001: Windows File and Directory Permissions Modification,2d8b4a7e-1f8c-4e5a-9d6f-7c1b8a0d3e9f,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,6,Can we use a natural language processing (NLP) model to identify suspicious command-line structures used in permission modifications?,"This question leverages advanced AI to understand the ""language"" of command-line arguments. By fine-tuning a model like BERT on known good and bad examples, it can learn to identify subtle, complex, or novel malicious patterns that regular expressions or simple entropy checks might miss, providing a more robust detection capability.","Windows Event ID 4688; Critical system directories such as C:\Windows\System32, C:\Windows\SysWOW64, C:\ProgramData, and user profile directories on all Windows endpoints and servers.",last 90 days,": SEARCH process_creation_events (e.g., EventID 4688)
WHERE process_name IN ('icacls.exe', 'cacls.exe', 'powershell.exe')
FOR_EACH event:
  command_string = event.command_line
  suspicious_score = NLP_MODEL.score(command_string)
  IF suspicious_score > threshold:
    ALERT ""NLP model detected suspicious command-line for permission modification""
",playbooks/attack/enterprise/T1222.001.yml
T1222.001: Windows File and Directory Permissions Modification,2d8b4a7e-1f8c-4e5a-9d6f-7c1b8a0d3e9f,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,7,Have the permissions been modified on critical accessibility feature binaries or logon scripts?,"Adversaries frequently abuse accessibility features (like Sticky Keys via sethc.exe) for persistence by replacing them with a command prompt. To do this, they must first modify the file's permissions. This question focuses on detecting permission changes (Event ID 4670) on these specific, high-value targets, as any such modification is extremely suspicious and requires immediate investigation.","Windows Event ID 4670; File system locations on Windows hosts containing accessibility feature binaries (e.g., C:\Windows\System32\) and logon/startup script directories (e.g., C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp).",last 90 days,": ENABLE SACL auditing for 'Write DAC' on watchlist files.
SEARCH security_events (e.g., EventID 4670)
WHERE ObjectName IN (critical_file_watchlist: ['sethc.exe', 'Utilman.exe', ...])
ALERT ""Permissions modified on critical persistence-related file""
",playbooks/attack/enterprise/T1222.001.yml
T1222.001: Windows File and Directory Permissions Modification,2d8b4a7e-1f8c-4e5a-9d6f-7c1b8a0d3e9f,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,8,Has there been *any* recent permission modification on files that are almost never legitimately changed?,"This is a simple but effective thresholding strategy. For files like sethc.exe or Utilman.exe, legitimate permission changes are so rare that any single occurrence within a month is a strong indicator of compromise. This approach is easy to implement and has a very low false positive rate, making it a high-confidence alert.","Windows Event ID 4670; File system locations on Windows hosts containing accessibility feature binaries (e.g., C:\Windows\System32\) and logon/startup script directories (e.g., C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp).",last 30 days,": SEARCH security_events (e.g., EventID 4670) over last 30 days
WHERE ObjectName IN (critical_file_watchlist)
count = COUNT(events)
IF count > 0:
  ALERT ""Rare permission modification detected on critical file""
",playbooks/attack/enterprise/T1222.001.yml
T1222.001: Windows File and Directory Permissions Modification,2d8b4a7e-1f8c-4e5a-9d6f-7c1b8a0d3e9f,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,9,Can an unsupervised machine learning model identify anomalous permission changes on critical files without prior labeling?,"This question proposes using an anomaly detection model like Isolation Forest to find unusual permission modifications. The model learns what ""normal"" looks like from a baseline of activity and then flags events that deviate significantly based on features like the user, process, and time of day. This is useful for detecting novel attack patterns on critical files, even if they do not match pre-defined rules.","Windows Event ID 4670; File system locations on Windows hosts containing accessibility feature binaries (e.g., C:\Windows\System32\) and logon/startup script directories (e.g., C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp).",last 90 days,": SEARCH security_events (e.g., EventID 4670)
WHERE ObjectName IN (critical_file_watchlist)
FOR_EACH event:
  features = EXTRACT_FEATURES(event)
  anomaly_score = ANOMALY_MODEL.predict(features)
  IF anomaly_score is high:
    ALERT ""Unsupervised model detected anomalous permission change on critical file""
",playbooks/attack/enterprise/T1222.001.yml
T1222.001: Windows File and Directory Permissions Modification,2d8b4a7e-1f8c-4e5a-9d6f-7c1b8a0d3e9f,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,10,"Is there a sudden, high-volume burst of file permission modifications from a single user or process?","Adversaries sometimes perform ""permission bombing"" where they rapidly change permissions on a large number of files to disrupt access or hide their tracks. This question aims to detect such brute-force activity by looking for a high count (e.g., >50) of permission change events (Event ID 4670) in a short time window (10 minutes).","Windows Event ID 4670; File servers, document management systems, and developer workstations where bulk file operations may occur, providing a baseline for normal activity.",last 10 minutes,": SEARCH security_events (e.g., EventID 4670)
GROUP BY SubjectUserName, ComputerName
COUNT events over a 10-minute sliding window
IF count > 50:
  ALERT ""Potential permission bombing detected""
",playbooks/attack/enterprise/T1222.001.yml
T1222.001: Windows File and Directory Permissions Modification,2d8b4a7e-1f8c-4e5a-9d6f-7c1b8a0d3e9f,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,11,Is a user's rate of file permission modifications statistically anomalous compared to their own normal behavior?,"This question refines the previous one by using a dynamic, user-specific baseline instead of a fixed global threshold. By calculating a Z-score, it identifies activity that is unusual *for that specific user*, making it more effective at spotting compromised accounts that are being used atypically, while reducing false positives from administrators who normally perform many changes.","Windows Event ID 4670; File servers, document management systems, and developer workstations where bulk file operations may occur, providing a baseline for normal activity.",last 90 days,": FOR_EACH user:
  ESTABLISH baseline (avg, stdev) of EventID 4670 counts per hour.
  current_hour_count = COUNT events in last hour for user.
  z_score = (current_hour_count - avg) / stdev
  IF z_score > 3:
    ALERT ""Statistically significant spike in permission modifications for user""
",playbooks/attack/enterprise/T1222.001.yml
T1222.001: Windows File and Directory Permissions Modification,2d8b4a7e-1f8c-4e5a-9d6f-7c1b8a0d3e9f,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,12,Can we use clustering algorithms to automatically identify groups of bulk file permission modifications?,"This question proposes using a density-based clustering algorithm like DBSCAN to automatically find ""hotspots"" of activity. Unlike simple thresholding, this method can identify bursts of activity without a predefined count, flagging any unusually dense group of permission changes by the same user/process in a short time as a potential bulk operation.","Windows Event ID 4670; File servers, document management systems, and developer workstations where bulk file operations may occur, providing a baseline for normal activity.",last 90 days,": GATHER EventID 4670 data (timestamp, user, process).
RUN DBSCAN clustering algorithm on the data.
FOR_EACH cluster identified:
  IF cluster is dense (many points in short time with same user/process):
    ALERT ""Anomalous cluster of permission modification events detected""
",playbooks/attack/enterprise/T1222.001.yml
T1222.001: Windows File and Directory Permissions Modification,2d8b4a7e-1f8c-4e5a-9d6f-7c1b8a0d3e9f,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,13,"Is there a sequence of events where a directory's permissions are changed, a new process is run from it, and that process makes an external network connection?","This question hunts for a classic attack chain: modify permissions to a directory, drop and execute a payload from that directory, and have the payload connect back to a command-and-control server. Correlating these three distinct events (permission change, process execution, network connection) in a short time window provides a very high-fidelity indicator of compromise.","Windows Event ID 4670; Windows Event ID 4688; Zeek conn.log; Internet-facing systems, DMZ servers, and developer workstations with direct internet access, which are common staging points for post-compromise activity.",within 15 minutes,": CORRELATE events within 15 minutes on the same host:
IF (EventID 4670 for directory D)
FOLLOWED BY (EventID 4688 for process P in directory D)
FOLLOWED BY (Network connection from process P to public IP)
THEN ALERT ""Suspicious sequence: Perm-Change -> Proc-Exec -> Net-Conn""
",playbooks/attack/enterprise/T1222.001.yml
T1222.001: Windows File and Directory Permissions Modification,2d8b4a7e-1f8c-4e5a-9d6f-7c1b8a0d3e9f,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,14,"When a suspicious process makes an outbound connection, is it using an uncommon destination port?","This question serves as an enrichment step for other detections. Adversaries often use non-standard ports for C2 communication to evade simple firewall rules. By checking if the destination port is rare for the organization (e.g., in the bottom 5th percentile of usage), we can increase our confidence that the activity is malicious and prioritize the alert accordingly.","Zeek conn.log; Internet-facing systems, DMZ servers, and developer workstations with direct internet access, which are common staging points for post-compromise activity.",last 30 days,": FOR_EACH alert from a correlated rule:
  port = alert.destination_port
  port_frequency_baseline = GET_ALL_OUTBOUND_PORT_COUNTS()
  IF port is in bottom 5% of frequency_baseline:
    INCREASE_RISK_SCORE(alert, 50%)
    ALERT ""Suspicious sequence involves rare destination port""
",playbooks/attack/enterprise/T1222.001.yml
T1222.001: Windows File and Directory Permissions Modification,2d8b4a7e-1f8c-4e5a-9d6f-7c1b8a0d3e9f,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,15,"Does the sequence of a permission change, process execution, and network connection deviate from normal, learned patterns of user behavior?","This question proposes a sophisticated, sequence-aware machine learning approach. An LSTM autoencoder can learn the normal ""rhythm"" and order of events in a user session. When it encounters a sequence like [file modification -> process execution -> network connection], which is rare in normal behavior, it will fail to ""reconstruct"" it accurately, resulting in a high anomaly score and a strong signal of malicious activity.","Windows Event ID 4670; Windows Event ID 4688; Zeek conn.log; Internet-facing systems, DMZ servers, and developer workstations with direct internet access, which are common staging points for post-compromise activity.",last 90 days,": observed_sequence = [Event4670, Event4688, NetConnEvent]
reconstruction_error = LSTM_AUTOENCODER.predict(observed_sequence)
IF reconstruction_error > threshold:
  ALERT ""Sequence-based anomaly detection model flagged malicious activity chain""",playbooks/attack/enterprise/T1222.001.yml
T1222.002: Linux and Mac File and Directory Permissions Modification,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,1,"Have any high-risk chmod or chown commands been executed, especially by web servers or low-privileged users?","Adversaries often use `chmod` or `chown` to weaken security settings. This question focuses on detecting specific high-risk patterns, such as granting universal permissions (e.g., 777) or changing ownership of critical system files. It's particularly suspicious if these actions are initiated by processes that shouldn't be modifying permissions, like a web server, or by users with limited privileges, as this could indicate a compromised process or privilege escalation.","EDR Process Creation Logs; Linux auditd logs; macOS Endpoint Security Framework events; Zeek conn.log; Named Areas of Interest: Crown jewel servers (e.g., authentication, database, code repositories), web servers, developer endpoints, and shared file servers.",Last 90 days,": SEARCH process_creation_logs WHERE command_line MATCHES 'chmod .* (777|666|u+s|g+s)' OR command_line MATCHES 'chown .* /etc/' AND parent_process IN ('apache2', 'nginx', 'php-fpm') OR user_privilege IS 'low'",playbooks/attack/enterprise/T1222.002.yml
T1222.002: Linux and Mac File and Directory Permissions Modification,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,2,"Is there an anomalous frequency of chmod or chown executions by any user or host, or a sudden drop in parent process entropy?","Beyond looking at single commands, this question aims to detect abnormal behavior over time. A sudden spike in `chmod` or `chown` activity by a user, compared to their own or their peers' baseline, can indicate malicious scripting. A sharp decrease in the variety of parent processes calling these commands suggests a single, repetitive script is at work, which is often a sign of automated adversary tools.","EDR Process Creation Logs; Linux auditd logs; macOS Endpoint Security Framework events; Zeek conn.log; Named Areas of Interest: Crown jewel servers (e.g., authentication, database, code repositories), web servers, developer endpoints, and shared file servers.",Last 90 days,": FOR each user, CALCULATE baseline of chmod/chown frequency. ALERT if current_frequency > 99th_percentile(historical_frequency). THEN, for each user, CALCULATE entropy of parent_process names. ALERT if entropy drops significantly.",playbooks/attack/enterprise/T1222.002.yml
T1222.002: Linux and Mac File and Directory Permissions Modification,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,3,"Have any anomalous chmod or chown executions been detected by the Isolation Forest model, and are they correlated with new network connections?","This question uses a machine learning approach (Isolation Forest) to find outlier `chmod`/`chown` events that don't fit normal patterns. It considers features like the user, parent process, target path, and time of day. An event flagged as an anomaly is even more suspicious if it is immediately followed by network connections to a new, previously unseen external IP address, as this could indicate data exfiltration or C2 communication following a defense evasion action.","EDR Process Creation Logs; Linux auditd logs; macOS Endpoint Security Framework events; Zeek conn.log; Named Areas of Interest: Crown jewel servers (e.g., authentication, database, code repositories), web servers, developer endpoints, and shared file servers.",Last 90 days,": SCORE new chmod/chown events with Isolation Forest model. FOR high-scoring events, CHECK for outbound network connections from the same host to a new IP within 5 minutes. ALERT on match.",playbooks/attack/enterprise/T1222.002.yml
T1222.002: Linux and Mac File and Directory Permissions Modification,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,4,Has the chattr command been used to make files immutable or append-only outside of approved administrative scripts or directories?,"Adversaries can use `chattr +i` (immutable) or `chattr +a` (append-only) to protect their malicious files from being removed or to prevent system logs from being altered. This question looks for any use of these commands that isn't part of a known, legitimate administrative task (e.g., run by Ansible/Puppet) or doesn't target an expected directory (e.g., log rotation scripts). Unapproved use is a strong indicator of malicious persistence or anti-forensic activity.","EDR Process Creation Logs; Linux auditd logs; Named Areas of Interest: System binary directories (/usr/bin, /bin), configuration directories (/etc), user home directories (/home/*/.bashrc), and log directories (/var/log).",Last 90 days,": SEARCH process_creation_logs WHERE command_line MATCHES 'chattr .*(+i|+a).*' AND target_path NOT IN (allow_list) AND parent_process NOT IN ('ansible', 'puppet'). ALERT on match.",playbooks/attack/enterprise/T1222.002.yml
T1222.002: Linux and Mac File and Directory Permissions Modification,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,5,Has chattr been used on a file in a rare or previously unseen directory location?,"Legitimate use of `chattr` tends to occur in predictable system directories. This question aims to detect when `chattr` is used in an unusual location. By comparing the target file's directory to a historical baseline of all directories where `chattr` has been used before, a low similarity score can highlight an execution in a novel and therefore suspicious path, potentially where an adversary has staged tools or malware.","EDR Process Creation Logs; Linux auditd logs; Named Areas of Interest: System binary directories (/usr/bin, /bin), configuration directories (/etc), user home directories (/home/*/.bashrc), and log directories (/var/log).",Last 90 days,": FOR each new 'chattr' event, GET target_directory. CALCULATE Jaccard similarity between target_directory and all historical_chattr_directories. ALERT if similarity < 0.1.",playbooks/attack/enterprise/T1222.002.yml
T1222.002: Linux and Mac File and Directory Permissions Modification,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,6,"Have any chattr executions been flagged as anomalous by the one-class SVM model, and were they preceded by a recent file write?","This question employs a one-class SVM model to identify `chattr` executions that deviate from established normal behavior, based on features like the user, process, and file characteristics. An anomaly score by itself is suspicious, but its significance is greatly increased if the same process wrote to the target file just before making it immutable. This pattern strongly suggests an adversary dropped a malicious file and is now locking it to prevent removal.","EDR Process Creation Logs; Linux auditd logs; Named Areas of Interest: System binary directories (/usr/bin, /bin), configuration directories (/etc), user home directories (/home/*/.bashrc), and log directories (/var/log).",Last 90 days,": SCORE new 'chattr' events with one-class SVM model. FOR anomalous events, CHECK for file_write events to the same target_path by the same process_id just before the 'chattr' event. ALERT on match.",playbooks/attack/enterprise/T1222.002.yml
T1222.002: Linux and Mac File and Directory Permissions Modification,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,7,Has a single process generated a high volume (over 100) of permission or ownership modification syscalls within a 1-minute window?,"A large number of permission changes (`chmod`, `chown`, etc.) executed by a single process in a short time is highly indicative of a malicious script. Legitimate system operations rarely perform such bulk changes so rapidly. This question aims to catch these 'storm' events by counting relevant syscalls per process over a 1-minute window, especially when the changes are concentrated within a common directory.","EDR File Modification Events; Linux auditd logs; Zeek conn.log; Named Areas of Interest: Web application directories, user home directories on shared systems, directories containing sensitive configuration files.",Last 90 days,": GROUP syscalls by process_id over 1-minute windows. COUNT 'chmod', 'fchmod*', 'chown*' syscalls. ALERT if count > 100 AND target files share a common parent directory.",playbooks/attack/enterprise/T1222.002.yml
T1222.002: Linux and Mac File and Directory Permissions Modification,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,8,"Has there been a statistically significant spike in file modification syscalls on any host, concentrated within a single directory?","This question looks for statistical anomalies in the rate of file permission modifications on a host. A sudden burst of activity that is several standard deviations above the normal rolling average is a red flag. The signal is made stronger by using the Gini coefficient to measure if these modifications are focused on a single directory. A low Gini coefficient means high concentration, pointing to a targeted, scripted attack rather than random, system-wide activity.","EDR File Modification Events; Linux auditd logs; Zeek conn.log; Named Areas of Interest: Web application directories, user home directories on shared systems, directories containing sensitive configuration files.",Last 90 days,": CALCULATE rolling average and standard deviation of file modification syscalls per minute. ALERT if current_minute_count > (average + 4 * std_dev). THEN, CALCULATE Gini coefficient for target parent directories. PRIORITIZE alert if Gini is near 0.",playbooks/attack/enterprise/T1222.002.yml
T1222.002: Linux and Mac File and Directory Permissions Modification,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,9,"Does DBSCAN clustering reveal a dense group of file modification events from a non-system process, and does that process show signs of C2 communication?","This question uses the DBSCAN clustering algorithm to find dense pockets of activity in time. A tight cluster of file modification events, all linked to the same process, suggests a rapid, automated script. If this process is not a known system utility (like a package manager), it is highly suspicious. The investigation is further prioritized by correlating the process with any network traffic that has a regular, 'heartbeat' pattern, which is a common characteristic of command-and-control (C2) channels.","EDR File Modification Events; Linux auditd logs; Zeek conn.log; Named Areas of Interest: Web application directories, user home directories on shared systems, directories containing sensitive configuration files.",Last 90 days,": RUN DBSCAN on file modification events over 10-minute windows. IDENTIFY dense clusters from non-system processes. FOR process_id in cluster, SEARCH network logs for periodic 'heartbeat' connections from the same host. ALERT on match.",playbooks/attack/enterprise/T1222.002.yml
T1484.002: Trust Modification,f9e1b3a2-4c5d-4e6f-8b7a-9d0c1e2f3a4b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,1,Has a new AD FS signing certificate been added that matches a known-malicious thumbprint?,"This question aims to identify the direct use of malicious infrastructure. Adversaries may add a new signing certificate to an AD FS server to forge security tokens. By comparing the thumbprint of newly added certificates against a list of known-bad indicators from threat intelligence, we can quickly detect a known attack pattern for privilege escalation.",Windows Event ID 259; Windows Event ID 4104; Active Directory Federation Services (AD FS) servers; Threat Intelligence Feeds,last 90 days,: SEARCH for EventID 259. EXTRACT certificate_thumbprint. LOOKUP certificate_thumbprint in threat_intel_feed. ALERT on match.,playbooks/attack/enterprise/T1484.002.yml
T1484.002: Trust Modification,f9e1b3a2-4c5d-4e6f-8b7a-9d0c1e2f3a4b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,2,"Has a new AD FS signing certificate been added with statistically anomalous properties, such as high entropy or being added by a non-administrative user?","This question seeks to find outliers that may indicate a malicious certificate crafted to evade simple signature-based detection. Legitimate certificates often have predictable patterns in their subject and issuer fields. A certificate with unusually high entropy might be algorithmically generated. Furthermore, certificate additions by non-standard user accounts are highly suspicious and could indicate a compromised account being used to establish persistence or escalate privileges.",Windows Event ID 259; Windows Event ID 4104; Active Directory Federation Services (AD FS) servers; Certificate Property Baselines,last 90 days,": SEARCH for EventID 259. CALCULATE entropy(certificate_subject), entropy(certificate_issuer). COMPARE to baseline. ALERT if > 95th percentile. CHECK if user is non-admin. ALERT if true.",playbooks/attack/enterprise/T1484.002.yml
T1484.002: Trust Modification,f9e1b3a2-4c5d-4e6f-8b7a-9d0c1e2f3a4b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,3,Can a machine learning model classify a newly added AD FS signing certificate as malicious based on its features?,"This question leverages machine learning to perform a more sophisticated, multi-faceted analysis of new certificates. By training a model on various features like validity period, key size, and issuer details, the system can learn the subtle characteristics of both benign and malicious certificates. This allows for the detection of novel threats that don't match known bad thumbprints or simple statistical anomalies.",Windows Event ID 259; Windows Event ID 4104; Active Directory Federation Services (AD FS) servers; ML Certificate Classification Model,last 90 days,": ON EventID 259, EXTRACT certificate_features. INPUT features into ML_model. IF model_score > threshold, ALERT.",playbooks/attack/enterprise/T1484.002.yml
T1484.002: Trust Modification,f9e1b3a2-4c5d-4e6f-8b7a-9d0c1e2f3a4b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,4,Has an AD FS claim issuance policy been modified to include high-privilege SIDs or rules that bypass MFA?,"This question looks for specific, high-confidence indicators of an adversary manipulating claim rules for privilege escalation. By adding a high-privilege SID like the Administrators SID to a token, or by inserting a claim that falsely indicates the user is on the corporate network to bypass MFA, an attacker can gain unauthorized access to sensitive applications. This is a direct method of privilege escalation within a federated environment.",Windows Event ID 501; Windows Event ID 4104; Active Directory Federation Services (AD FS) servers,last 90 days,: SEARCH for EventID 501. REGEX search event_data for 'S-1-5-32-544' or 'multipleauthn' or 'insidecorpenetwork'. ALERT on match.,playbooks/attack/enterprise/T1484.002.yml
T1484.002: Trust Modification,f9e1b3a2-4c5d-4e6f-8b7a-9d0c1e2f3a4b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,5,"Has a claim issuance policy been modified in a statistically unusual way, such as a significant increase in rule length or complexity, or by an unauthorized account?","This question aims to detect suspicious policy changes that may not contain an obvious malicious string. A significant, unexpected increase in the complexity or length of a rule could indicate an adversary is embedding obfuscated logic. Tracking which accounts perform these changes and flagging modifications by accounts that have never done so before helps identify compromised accounts being used to alter security policies.",Windows Event ID 501; Windows Event ID 4104; Active Directory Federation Services (AD FS) servers; Policy Change Baselines,last 90 days,: SEARCH for EventID 501. CALCULATE length/entropy of new rule. COMPARE to baseline. ALERT if > 3 stddev. CHECK if user is first-time modifier. ALERT if true.,playbooks/attack/enterprise/T1484.002.yml
T1484.002: Trust Modification,f9e1b3a2-4c5d-4e6f-8b7a-9d0c1e2f3a4b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,6,Can a machine learning model classify a claim issuance policy modification as unauthorized based on its context?,"This question uses a supervised learning model to differentiate between legitimate administrative changes and malicious modifications. By training on features like the user, time of day, and the content of the change, the model can learn the patterns of authorized activity. This allows it to flag changes that, while potentially performed by a privileged account, are inconsistent with normal operational behavior and may be unauthorized.",Windows Event ID 501; Windows Event ID 4104; Active Directory Federation Services (AD FS) servers; Change Management Records; ML Policy Change Model,last 90 days,": ON EventID 501, EXTRACT change_features (user, time, content). INPUT features into ML_model. IF model_classifies as 'unauthorized', ALERT.",playbooks/attack/enterprise/T1484.002.yml
T1484.002: Trust Modification,f9e1b3a2-4c5d-4e6f-8b7a-9d0c1e2f3a4b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,7,Has a domain trust modification been immediately followed by a network logon from the new trust to a high-value asset?,This question seeks to identify the immediate abuse of a newly created or modified domain trust. An adversary might establish a trust to gain access to resources in another domain. A correlation rule that detects a trust modification followed by a successful network logon to a critical server (like a Domain Controller) from the source domain is a strong indicator of malicious activity.,Windows Event ID 4703; Windows Event ID 4624; Zeek conn.log; Domain Controllers; Network traffic flow points between domain security boundaries,last 90 days,: CORRELATE (EventID 4703) with (EventID 4624 AND LogonType 3 AND destination is high_value_asset) within 60 minutes. ENRICH with network logs. ALERT on correlation.,playbooks/attack/enterprise/T1484.002.yml
T1484.002: Trust Modification,f9e1b3a2-4c5d-4e6f-8b7a-9d0c1e2f3a4b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,8,Has a new or modified domain trust resulted in a statistically significant increase in cross-domain authentications?,"This question aims to detect the abuse of a domain trust by observing its usage patterns. Legitimate trust relationships typically have a predictable volume of authentication traffic. A sudden, anomalous spike in cross-domain authentications from a newly trusted domain, when compared to a historical baseline, suggests the trust is being exploited, possibly for lateral movement or data access.",Windows Event ID 4703; Windows Event ID 4624; Domain Controllers; Network traffic flow points between domain security boundaries; Authentication Baselines,last 90 days,": ON EventID 4703, MONITOR hourly count of (EventID 4624 AND LogonType 3) from source_domain for 24 hours. COMPARE count to historical baseline. ALERT if > 99th percentile.",playbooks/attack/enterprise/T1484.002.yml
T1484.002: Trust Modification,f9e1b3a2-4c5d-4e6f-8b7a-9d0c1e2f3a4b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,9,Is a time-series anomaly detection model flagging a spike in cross-domain authentications that is temporally linked to a trust modification event?,"This question uses a time-series model to forecast expected authentication volumes and detect deviations. By treating a trust modification event as an influencing factor (an exogenous variable), the model can more accurately determine if a subsequent spike in authentications is anomalous or expected. This advanced method helps to identify sophisticated attacks that might be missed by simpler statistical checks.",Windows Event ID 4703; Windows Event ID 4624; Domain Controllers; Network traffic flow points between domain security boundaries; ML Time-Series Model,last 90 days,": INPUT authentication volume and EventID 4703 occurrences into time-series_model. IF actual_volume > forecast_prediction_interval after EventID 4703, ALERT.",playbooks/attack/enterprise/T1484.002.yml
T1484.002: Trust Modification,f9e1b3a2-4c5d-4e6f-8b7a-9d0c1e2f3a4b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,10,Has a domain's authentication method been changed to 'Federated' by an account not on the authorized allow-list?,"This question targets unauthorized changes to a domain's authentication method, which is a critical security setting. An adversary might change a domain from 'Managed' to 'Federated' to redirect authentication to a server they control. By maintaining a strict allow-list of accounts authorized to make this change, any deviation can be immediately flagged as a high-priority security incident.",Windows Event ID 307; Windows Event ID 510; Windows Event ID 4688; Windows Event ID 4104; Domain Controllers; AD FS Servers; Administrator Workstations,last 90 days,: SEARCH for PowerShell cmdlets 'Set-MsolDomainFederationSettings' or EventID 307/510. CHECK if user is NOT in authorized_admin_list. ALERT on unauthorized user.,playbooks/attack/enterprise/T1484.002.yml
T1484.002: Trust Modification,f9e1b3a2-4c5d-4e6f-8b7a-9d0c1e2f3a4b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,11,Has a domain federation setting been changed at a statistically anomalous time?,"This question focuses on the timing of administrative actions to spot outliers. Critical changes like modifying federation settings are typically performed during standard business hours or scheduled maintenance windows. A change that occurs late at night or on a weekend, when compared to a historical baseline of legitimate changes, is highly suspicious and warrants investigation, even if performed by a seemingly authorized account.",Windows Event ID 307; Windows Event ID 510; Windows Event ID 4688; Windows Event ID 4104; Domain Controllers; AD FS Servers; Administrator Workstations; Activity Time Baselines,last 90 days,: SEARCH for federation change events. EXTRACT timestamp. COMPARE to baseline of normal change times. ALERT if timestamp is outside 5th-95th percentile.,playbooks/attack/enterprise/T1484.002.yml
T1484.002: Trust Modification,f9e1b3a2-4c5d-4e6f-8b7a-9d0c1e2f3a4b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,12,Has a UEBA model detected that a federation setting modification was part of an anomalous session for a privileged administrator?,"This question leverages User and Entity Behavior Analytics (UEBA) to provide deep contextual analysis of administrator actions. A UEBA model builds a profile of normal behavior for each user. It can detect if an administrator modifies federation settings from a new or unusual workstation, at an odd time, or in conjunction with other strange activities. This flags the action as a high-risk anomaly, even if the account has the necessary permissions, pointing to a potential account compromise.",Windows Event ID 307; Windows Event ID 510; Windows Event ID 4688; Windows Event ID 4104; Domain Controllers; AD FS Servers; Administrator Workstations; UEBA Platform,last 90 days,": INGEST federation change events into UEBA_model. IF user_session is flagged as anomalous, ALERT with high risk.",playbooks/attack/enterprise/T1484.002.yml
T1484.002: Trust Modification,f9e1b3a2-4c5d-4e6f-8b7a-9d0c1e2f3a4b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,13,Has a new trusted federation realm been added whose domain matches a known-malicious indicator?,This question aims to detect the addition of a malicious federated trust by checking the new realm's domain against threat intelligence. Adversaries may establish a federated trust with a domain they control to gain access. A direct match of the domain against a feed of known-malicious domains is a high-confidence indicator of an attack.,Windows Event ID 307; Windows Event ID 510; Windows Event ID 4104; Zeek dns.log; Zeek intel.log; AD FS Servers; Domain Controllers; DNS Servers; Network Gateways,last 90 days,": ON EventID 307/510/4104, EXTRACT trusted_realm_uri. LOOKUP domain from URI in threat_intel_feed. ALERT on match.",playbooks/attack/enterprise/T1484.002.yml
T1484.002: Trust Modification,f9e1b3a2-4c5d-4e6f-8b7a-9d0c1e2f3a4b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,14,Has a new trusted federation realm been added whose domain is newly registered or has high character entropy?,"This question seeks to identify suspicious domains used for federation that aren't on threat intelligence feeds yet. Adversaries often use newly registered domains for their campaigns. A domain registered within the last 30 days is a significant red flag. Additionally, algorithmically generated domains often have high character entropy, so flagging domains with anomalous entropy scores can help uncover malicious infrastructure.",Windows Event ID 307; Windows Event ID 510; Windows Event ID 4104; Passive DNS/WHOIS data; Domain Property Baselines,last 90 days,": ON new trusted realm, QUERY WHOIS for domain_registration_date. ALERT if < 30 days old. CALCULATE entropy(domain_name). COMPARE to baseline. ALERT if > 95th percentile.",playbooks/attack/enterprise/T1484.002.yml
T1484.002: Trust Modification,f9e1b3a2-4c5d-4e6f-8b7a-9d0c1e2f3a4b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,15,Does a machine learning model classify a newly added trusted realm URI as likely malicious?,"This question uses machine learning, specifically a Domain Generation Algorithm (DGA) detector, to proactively identify malicious domains. These models are trained on the lexical features of millions of domains and can classify a domain as benign or malicious without prior knowledge. This is effective against adversaries who use DGAs to create a large number of command-and-control domains.",Windows Event ID 307; Windows Event ID 510; Windows Event ID 4104; ML DGA Detection Model,last 90 days,": ON new trusted realm, EXTRACT domain. INPUT domain into DGA_model. IF model_score > threshold, ALERT.",playbooks/attack/enterprise/T1484.002.yml
T1484.002: Trust Modification,f9e1b3a2-4c5d-4e6f-8b7a-9d0c1e2f3a4b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,16,Has a PowerShell cmdlet for updating federation settings been executed with a non-approved issuer URI or signing certificate?,"This question looks for direct evidence of an adversary hijacking the federation trust by injecting their own settings. By monitoring PowerShell logs for cmdlets like 'Update-MSOLFederatedDomain' and inspecting the parameters, we can detect if an attacker is attempting to set the issuer URI to a domain they control or inject a rogue token-signing certificate. This is a critical defense evasion and privilege escalation technique.",Windows Event ID 4688; Windows Event ID 4104; AD FS Servers; Domain Controllers; Administrator Workstations,last 90 days,": SEARCH EventID 4104 for 'Update-MSOLFederatedDomain'. REGEX parse parameters. IF IssuerUri is NOT in allow-list OR SigningCertificate is NOT from internal PKI, ALERT.",playbooks/attack/enterprise/T1484.002.yml
T1484.002: Trust Modification,f9e1b3a2-4c5d-4e6f-8b7a-9d0c1e2f3a4b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,17,Has a PowerShell cmdlet for updating federation settings been executed with a statistically rare parameter or combination of parameters?,"This question aims to find unusual executions of administrative commands that might indicate misuse. While an adversary might use legitimate cmdlets, they may use them with parameters or in combinations that are rare in normal administrative activity. By baselining common usage and alerting on statistical outliers, it's possible to flag suspicious command executions that warrant further review.",Windows Event ID 4688; Windows Event ID 4104; AD FS Servers; Domain Controllers; Administrator Workstations; Cmdlet Usage Baselines,last 90 days,": ANALYZE historical usage of federation cmdlets. ON new execution, check if parameter or parameter_combination is rare (<1% of invocations). ALERT if true.",playbooks/attack/enterprise/T1484.002.yml
T1484.002: Trust Modification,f9e1b3a2-4c5d-4e6f-8b7a-9d0c1e2f3a4b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,18,Can an anomaly detection model identify an unusual execution of a federation settings cmdlet based on its full context?,"This question uses an unsupervised machine learning model to detect anomalous command executions. The model considers a wide range of features, including the command, its parameters, the user who ran it, and the source host. This allows it to identify novel or unusual invocations that deviate from established patterns, which could represent an adversary using legitimate tools for malicious purposes.",Windows Event ID 4688; Windows Event ID 4104; AD FS Servers; Domain Controllers; Administrator Workstations; ML Anomaly Detection Model,last 90 days,": INPUT command_execution_features (command, params, user, host) into Isolation_Forest_model. IF model identifies as anomaly, ALERT.",playbooks/attack/enterprise/T1484.002.yml
T1484.002: Trust Modification,f9e1b3a2-4c5d-4e6f-8b7a-9d0c1e2f3a4b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,19,Has a domain trust been modified by a privileged account from a geographically unapproved location?,"This question uses geofencing as a simple but effective control for privileged access. If a trust modification event is preceded by a logon from an IP address that maps to a country where the business does not operate or from which administrators do not work, it is a strong indicator of a compromised account. This helps detect adversaries operating from foreign locations.",Windows Event ID 4703; Windows Event ID 307; Windows Event ID 4624; Zeek conn.log; Domain Controllers; AD FS Servers; VPN Concentrators,last 90 days,": CORRELATE trust modification event with preceding logon (EventID 4624). GET source_ip from logon. GEO-IP lookup. IF country is NOT in allow-list, ALERT.",playbooks/attack/enterprise/T1484.002.yml
T1484.002: Trust Modification,f9e1b3a2-4c5d-4e6f-8b7a-9d0c1e2f3a4b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,20,Has a domain trust been modified by a privileged account at an unusual time or from a new location based on their individual baseline?,"This question moves beyond simple geofencing to personalized behavioral baselining. By analyzing each privileged user's historical login times and locations, we can detect deviations from their personal norm. A trust modification performed by a user logging in at 3 AM when they always work 9-to-5, or from a new country, is highly suspicious and can be flagged even if the location is generally approved for the company.",Windows Event ID 4703; Windows Event ID 307; Windows Event ID 4624; Zeek conn.log; Domain Controllers; AD FS Servers; User Login Baselines,last 90 days,": ON trust modification, get user. CHECK preceding logon time and location against user's baseline. IF time > 2 stddev from mean OR location is new in 90 days, increase risk_score. ALERT if score > threshold.",playbooks/attack/enterprise/T1484.002.yml
T1484.002: Trust Modification,f9e1b3a2-4c5d-4e6f-8b7a-9d0c1e2f3a4b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,21,Has a UEBA platform flagged a user's session as anomalous during which a domain trust modification occurred?,"This question leverages a comprehensive UEBA solution to detect sophisticated account compromises. A UEBA model analyzes a user's entire session, including login, resource access, and commands run. If it flags a session as anomalous, any high-impact action like a trust modification that occurs within that session should be treated as a critical alert, as it suggests an attacker is in control of the account.",Windows Event ID 4703; Windows Event ID 307; Windows Event ID 4624; Zeek conn.log; Domain Controllers; AD FS Servers; UEBA Platform,last 90 days,": INGEST user session data into UEBA_model. IF session containing a trust modification event is flagged as anomalous, ALERT.",playbooks/attack/enterprise/T1484.002.yml
T1484.002: Trust Modification,f9e1b3a2-4c5d-4e6f-8b7a-9d0c1e2f3a4b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,22,"Following a trust modification, did an AD FS server connect to an external IP whose SNI is not on a pre-approved list?","This question seeks to identify post-modification network activity that indicates communication with a malicious external identity provider (IdP). After modifying a trust, an adversary's IdP may need to communicate with the internal AD FS server. By maintaining an allow-list of legitimate partner IdP Server Name Indications (SNIs) and alerting on connections to any SNI not on the list, we can detect this suspicious outbound communication.",Zeek conn.log; Zeek ssl.log; Windows Event ID 307; Windows Event ID 501; AD FS Servers; Network Perimeter Firewalls,last 90 days,": CORRELATE trust modification event with subsequent SSL connection from AD FS server within 5 mins. EXTRACT SNI from SSL log. IF SNI not in approved_list, ALERT.",playbooks/attack/enterprise/T1484.002.yml
T1484.002: Trust Modification,f9e1b3a2-4c5d-4e6f-8b7a-9d0c1e2f3a4b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,23,"Following a trust modification, was there a statistically significant spike in data volume transferred from an AD FS server to external IdP endpoints?","This question aims to detect anomalous data transfers that may occur after a trust is compromised. An adversary might use the new trust to exfiltrate data via the federation channel. By baselining the normal volume of data transferred between AD FS servers and external identity providers, a sudden spike that is temporally correlated with a trust modification can indicate malicious activity.",Zeek conn.log; Windows Event ID 307; Windows Event ID 501; AD FS Servers; Network Perimeter Firewalls; Data Transfer Baselines,last 90 days,": ON trust modification, MONITOR data transfer volume from AD FS server for 30 mins. COMPARE to hourly baseline. ALERT if volume > 3 stddev above baseline.",playbooks/attack/enterprise/T1484.002.yml
T1484.002: Trust Modification,f9e1b3a2-4c5d-4e6f-8b7a-9d0c1e2f3a4b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,24,Did a time-series model forecast an anomalous spike in new connections from an AD FS server immediately following a trust modification?,"This question uses advanced time-series forecasting to detect subtle anomalies in network connection patterns. An adversary might test a newly configured malicious trust by initiating a series of connections. A forecasting model can predict the normal rate of new connections, and if the actual count significantly exceeds the model's prediction right after a trust modification event, it can be flagged as a correlated anomaly requiring investigation.",Zeek conn.log; Windows Event ID 307; Windows Event ID 501; AD FS Servers; Network Perimeter Firewalls; ML Time-Series Model,last 90 days,": INPUT connection count and trust modification events into time-series_model. IF actual_count exceeds prediction_interval after a modification event, ALERT.",playbooks/attack/enterprise/T1484.002.yml
T1505: Server Software Component,e2b8c5a4-9e1f-4d3c-8a7b-6f9d0e1a2b3c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0003: Persistence,n; o; n; e,1,Are known malicious web shells or backdoors being written to web or application server directories?,"This question seeks to identify persistence attempts where an adversary places a pre-identified malicious file (like a web shell) onto a server. By querying for file creation events for specific script types (.aspx, .jsp, etc.) in sensitive web directories and comparing their hashes against threat intelligence, we can detect known threats with high confidence. This is a direct, signature-based approach to finding malicious server components.","Windows Event ID 4663; Windows Event ID 4688; Zeek files.log; Web root, application plugin, and server extension directories on public-facing and internal web/application servers (e.g., C:\inetpub\wwwroot\, /var/www/html/, SharePoint 'Layouts', Confluence 'plugins-installed').",last 90 days,": Search file creation events in web directories for extensions (.aspx, .jsp, .php, .dll). | For each file, get hash. | Compare hash against threat intel feed. | Alert on match.",playbooks/attack/enterprise/T1505.yml
T1505: Server Software Component,e2b8c5a4-9e1f-4d3c-8a7b-6f9d0e1a2b3c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0003: Persistence,n; o; n; e,2,"Are there statistically unusual file write events in web or application server directories, based on the parent process or file extension?","Adversaries may use legitimate but uncommon processes (like cmd.exe) to write malicious files, or use file types not typically seen in a given directory. This question aims to find these outliers by baselining normal activity. By profiling which processes write which file types to sensitive directories, we can flag events that deviate significantly from the established norm, potentially indicating a novel or evasive persistence technique.","Windows Event ID 4663; Windows Event ID 4688; Zeek files.log; Web root, application plugin, and server extension directories on public-facing and internal web/application servers (e.g., C:\inetpub\wwwroot\, /var/www/html/, SharePoint 'Layouts', Confluence 'plugins-installed').",last 90 days,": For each server, profile historical parent processes and file extensions for writes to web directories. | Monitor new file write events. | If parent process or file extension frequency is in the bottom 5th percentile, flag as anomalous.",playbooks/attack/enterprise/T1505.yml
T1505: Server Software Component,e2b8c5a4-9e1f-4d3c-8a7b-6f9d0e1a2b3c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0003: Persistence,n; o; n; e,3,Can a machine learning model classify new file creation events in web or application server directories as malicious?,"This question leverages a supervised machine learning model to provide a more nuanced detection than simple rules or statistical thresholds. By training a classifier on features like the parent process, file path entropy, and file size, the model learns the complex patterns of both legitimate and malicious file writes. This allows it to identify sophisticated attacks that might otherwise evade detection.","Windows Event ID 4663; Windows Event ID 4688; Zeek files.log; Web root, application plugin, and server extension directories on public-facing and internal web/application servers (e.g., C:\inetpub\wwwroot\, /var/www/html/, SharePoint 'Layouts', Confluence 'plugins-installed').",last 90 days,": For new file write events in web directories, extract features (parent process, path entropy, file extension, size, time). | Score event with trained Random Forest model. | Alert if score > 0.9.",playbooks/attack/enterprise/T1505.yml
T1505: Server Software Component,e2b8c5a4-9e1f-4d3c-8a7b-6f9d0e1a2b3c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0003: Persistence,n; o; n; e,4,"Is a known web server process (e.g., w3wp.exe, httpd.exe) writing a script file into its own content directories?","Web server processes should typically serve content, not create it. This question focuses on the suspicious behavior of a web server process itself writing a new scriptable file (.aspx, .php, etc.) to a directory it manages. This is a strong indicator of a web shell being dropped through a vulnerability in the web application itself.","Windows Event ID 4663; Windows Event ID 4688; Zeek http.log; File systems of public-facing web servers, particularly world-writable directories and web root folders.",last 90 days,": Monitor file creation events. | Alert if parent process is a web server process (w3wp.exe, httpd.exe) AND file has a script extension (.aspx, .php) AND location is within a web content directory.",playbooks/attack/enterprise/T1505.yml
T1505: Server Software Component,e2b8c5a4-9e1f-4d3c-8a7b-6f9d0e1a2b3c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0003: Persistence,n; o; n; e,5,Are web server processes writing files with statistically anomalous filenames or sizes?,"Adversaries often use randomly generated filenames for their tools and web shells to avoid simple signature-based detection. This question aims to detect this behavior by analyzing the entropy (randomness) of filenames. A high entropy score, or a file size that is a significant outlier compared to similar files, suggests the file is not a standard component and warrants investigation.","Windows Event ID 4663; Windows Event ID 4688; Zeek http.log; File systems of public-facing web servers, particularly world-writable directories and web root folders.",last 90 days,": For files written by web server processes, calculate filename Shannon entropy. | Alert if entropy > 3.0. | Also, compare file size to historical mean for that file type. | Alert if size > 3 standard deviations from mean.",playbooks/attack/enterprise/T1505.yml
T1505: Server Software Component,e2b8c5a4-9e1f-4d3c-8a7b-6f9d0e1a2b3c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0003: Persistence,n; o; n; e,6,Can an unsupervised machine learning model detect anomalous file-write activities by web server processes?,"This question uses an unsupervised model, like an Isolation Forest, to identify novel or unusual file-write events without relying on pre-labeled malicious data. The model learns the profile of 'normal' activity based on features like file path, size, and associated HTTP requests. Any event that significantly deviates from this learned normal profile is flagged as a potential threat, making this approach effective against zero-day exploits or custom malware.","Windows Event ID 4663; Windows Event ID 4688; Zeek http.log; File systems of public-facing web servers, particularly world-writable directories and web root folders.",last 90 days,": Train Isolation Forest model on legitimate web server file-write features (path, extension, size, HTTP method). | Score new file-write events in real-time. | Alert on events flagged as significant anomalies.",playbooks/attack/enterprise/T1505.yml
T1505: Server Software Component,e2b8c5a4-9e1f-4d3c-8a7b-6f9d0e1a2b3c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0003: Persistence,n; o; n; e,7,"Are server application processes (e.g., w3wp.exe, sqlservr.exe) spawning suspicious child processes like cmd.exe or powershell.exe?","Server applications like web or database servers should not typically spawn command shells or reconnaissance tools. This question looks for this explicit, high-confidence indicator of compromise. If a process like 'sqlservr.exe' spawns 'whoami.exe', it strongly suggests that an attacker has achieved code execution and is performing discovery.","Windows Event ID 4688; Process execution logs on all critical servers, including web servers, database servers, application servers, and domain controllers.",last 90 days,": Monitor process creation events. | Alert if ParentProcessName is a server app (w3wp.exe, sqlservr.exe) AND ProcessName is a sensitive utility (cmd.exe, powershell.exe) AND command line does not match an allowlisted script.",playbooks/attack/enterprise/T1505.yml
T1505: Server Software Component,e2b8c5a4-9e1f-4d3c-8a7b-6f9d0e1a2b3c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0003: Persistence,n; o; n; e,8,Are server applications spawning child processes that are statistically rare or have never been seen before?,"Beyond a simple blocklist of child processes, this question seeks to identify anomalous behavior by baselining all parent-child process relationships on a server. An attacker might use a legitimate but rarely used tool to evade detection. By alerting on process pairs or command-line arguments that are infrequent or entirely new, we can detect deviations from normal administrative and application behavior.","Windows Event ID 4688; Process execution logs on all critical servers, including web servers, database servers, application servers, and domain controllers.",last 90 days,: Baseline all parent-child process relationships and arguments for server apps over 30 days. | Monitor new process creation events. | Alert if a new parent-child-argument combination is observed or its frequency is in the bottom 5th percentile.,playbooks/attack/enterprise/T1505.yml
T1505: Server Software Component,e2b8c5a4-9e1f-4d3c-8a7b-6f9d0e1a2b3c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0003: Persistence,n; o; n; e,9,Can a machine learning model predict whether a process creation event originating from a server application is malicious?,"This question applies a supervised learning model to the complex task of identifying malicious process execution. By analyzing a rich set of features including the processes involved, command-line characteristics (length, entropy), and user context, the model can learn to distinguish between benign administrative tasks and malicious attacker activity with greater accuracy than static rules.","Windows Event ID 4688; Process execution logs on all critical servers, including web servers, database servers, application servers, and domain controllers.",last 90 days,": For each server process creation event, extract features (parent name, child name, cmdline length/entropy, user). | Score the event with a trained Gradient Boosting model. | Alert on high-risk scores.",playbooks/attack/enterprise/T1505.yml
T1505: Server Software Component,e2b8c5a4-9e1f-4d3c-8a7b-6f9d0e1a2b3c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0003: Persistence,n; o; n; e,10,Are server processes making outbound network connections to known malicious destinations?,"This question aims to detect command and control (C2) communication by cross-referencing outbound network traffic from critical servers against threat intelligence. A connection from a server to an IP or domain known to be a C2 server, a TOR exit node, or a newly registered domain (NRD) is a high-fidelity indicator of a compromise.","Zeek conn.log; Zeek dns.log; Windows Event ID 5156; Network traffic logs at the network egress (e.g., firewalls, proxies) and host-level network monitoring on critical servers.",last 90 days,": Filter network connection and DNS logs for traffic from critical servers. | Compare destination IPs and domains against threat intel feeds (C2, NRDs, TOR). | Alert on any match.",playbooks/attack/enterprise/T1505.yml
T1505: Server Software Component,e2b8c5a4-9e1f-4d3c-8a7b-6f9d0e1a2b3c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0003: Persistence,n; o; n; e,11,"Are server processes exhibiting statistically anomalous outbound network behavior, such as connecting to rare destinations or beaconing?","Attackers often use C2 infrastructure that is not yet on a threat intelligence list. This question seeks to find these unknown C2 channels by identifying statistical anomalies. This includes connections to very rare autonomous systems (ASNs) or traffic patterns that exhibit regular, machine-like 'beaconing' behavior (connections with very low jitter), which is characteristic of malware callbacks.","Zeek conn.log; Zeek dns.log; Windows Event ID 5156; Network traffic logs at the network egress (e.g., firewalls, proxies) and host-level network monitoring on critical servers.",last 90 days,": Baseline outbound connection patterns (dest ASN, port) for each server process. | Alert if a new connection's destination ASN is in the bottom 1% of prevalence. | Analyze time between connections to the same destination; alert if the standard deviation is very low (beaconing).",playbooks/attack/enterprise/T1505.yml
T1505: Server Software Component,e2b8c5a4-9e1f-4d3c-8a7b-6f9d0e1a2b3c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0003: Persistence,n; o; n; e,12,Can machine learning models detect anomalies in outbound network traffic volume or connection patterns from critical servers?,"This question employs machine learning to detect subtle changes in network behavior that might indicate data exfiltration or C2. A time-series model can forecast expected data volumes and alert on significant excess, while a clustering model can group connections by their metadata, automatically identifying small, distinct clusters that represent anomalous activity different from the bulk of normal traffic.","Zeek conn.log; Zeek dns.log; Windows Event ID 5156; Network traffic logs at the network egress (e.g., firewalls, proxies) and host-level network monitoring on critical servers.",last 90 days,": Forecast outbound data volume per hour using a SARIMA model; alert if actual volume exceeds the 99% confidence interval. | Cluster connection metadata (port, protocol, duration, bytes) using DBSCAN; alert on small, outlier clusters.",playbooks/attack/enterprise/T1505.yml
T1505: Server Software Component,e2b8c5a4-9e1f-4d3c-8a7b-6f9d0e1a2b3c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0003: Persistence,n; o; n; e,13,"Are critical server configuration files (e.g., web.config, httpd.conf) being modified by unauthorized processes?","Modification of critical configuration files is a powerful persistence mechanism, allowing an attacker to alter server behavior. This question uses a direct, rule-based approach to detect this. By enabling file system auditing on a watchlist of key files, we can alert on any write operation that doesn't originate from a pre-approved administrative tool or deployment script, indicating a potential unauthorized change.","Windows Event ID 4663; Windows Event ID 4688; File system audit logs on directories containing configuration files for all web, application, and database servers.",last 90 days,: Enable file system auditing on critical config files. | Monitor for 'WriteData' or 'AppendData' events. | Alert if the modifying ProcessName is not on an approved allowlist.,playbooks/attack/enterprise/T1505.yml
T1505: Server Software Component,e2b8c5a4-9e1f-4d3c-8a7b-6f9d0e1a2b3c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0003: Persistence,n; o; n; e,14,Are server configuration files being modified at unusual times or by unusual user accounts?,"Legitimate changes to configuration files typically happen within predictable patterns, such as during scheduled maintenance windows or by specific administrative accounts. This question aims to detect unauthorized changes by identifying statistical deviations from these patterns. A modification made by a user who has never touched the file before, or a change occurring outside of normal business/maintenance hours, is highly suspicious.","Windows Event ID 4663; Windows Event ID 4688; File system audit logs on directories containing configuration files for all web, application, and database servers.",last 90 days,": Baseline users, processes, and times for config file modifications. | Alert if a modification occurs outside a defined maintenance window. | Alert if the modifying user is statistically rare or has never modified the file before.",playbooks/attack/enterprise/T1505.yml
T1505: Server Software Component,e2b8c5a4-9e1f-4d3c-8a7b-6f9d0e1a2b3c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0003: Persistence,n; o; n; e,15,Can a machine learning model distinguish between legitimate and suspicious modifications to server configuration files?,"This question uses an advanced anomaly detection model (a variational autoencoder) to build a sophisticated profile of what a 'normal' configuration change looks like. By considering a combination of features like the user, their source IP, the process used, and the time of day, the model can identify changes that do not conform to the established pattern of legitimacy, flagging them as potential threats even if they don't violate a simple rule.","Windows Event ID 4663; Windows Event ID 4688; File system audit logs on directories containing configuration files for all web, application, and database servers.",last 90 days,": Train a VAE model on features of legitimate config file modifications (user, source IP, process, time). | Score new modification events based on their reconstruction error. | Alert on events with a high reconstruction error.",playbooks/attack/enterprise/T1505.yml
T1538: Cloud Service Dashboard,f5d8e9c0-a1b2-4c3d-8e4f-5a6b7c8d9e0f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,1,"Is a cloud console login originating from a known malicious IP address, TOR exit node, or anonymizing proxy?","This question aims to identify logins from sources with a pre-existing negative reputation. An adversary might use compromised infrastructure or anonymizing services to hide their true origin, and a match against threat intelligence is a strong indicator of malicious activity.",AWS CloudTrail logs (ConsoleLogin event); Azure SignIn Logs; Google Cloud Audit Logs (Admin Activity); Zeek conn.log; Windows Security Event ID 4624; Cloud IAM infrastructure; Internet gateways and proxies; Endpoint devices of privileged users; Threat Intelligence Feeds,Last 90 days,: SEARCH cloud_login_events | EXTRACT source_ip | LOOKUP threat_intel_feeds ON source_ip | WHERE is_malicious=true | ALERT,playbooks/attack/enterprise/T1538.yml
T1538: Cloud Service Dashboard,f5d8e9c0-a1b2-4c3d-8e4f-5a6b7c8d9e0f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,2,"Has a user logged into the cloud console from a geographic location, Autonomous System (AS), or at a time of day that is statistically rare for them?","This question seeks to detect deviations from a user's established behavioral baseline. Adversaries, especially external ones, are unlikely to perfectly mimic a legitimate user's typical location, network, and working hours. A login that is an outlier in these aspects could indicate a compromised account.",AWS CloudTrail logs (ConsoleLogin event); Azure SignIn Logs; Google Cloud Audit Logs (Admin Activity); Zeek conn.log; Windows Security Event ID 4624; Cloud IAM infrastructure; Internet gateways and proxies; Endpoint devices of privileged users,Last 90 days,": SEARCH cloud_login_events | BASELINE user, source_country, source_asn, login_hour over 90d | COMPARE new_login to baseline | WHERE frequency < 5th_percentile | ALERT",playbooks/attack/enterprise/T1538.yml
T1538: Cloud Service Dashboard,f5d8e9c0-a1b2-4c3d-8e4f-5a6b7c8d9e0f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,3,Did a user's cloud console logins occur from geographically distant locations in a time frame that would be physically impossible?,"This question identifies a classic indicator of account compromise known as ""impossible travel."" If a user logs in from one location and then minutes later from a location thousands of miles away, it's a strong sign that at least one of the sessions is fraudulent, as two different entities are likely using the same credentials.",AWS CloudTrail logs (ConsoleLogin event); Azure SignIn Logs; Google Cloud Audit Logs (Admin Activity); Zeek conn.log; Windows Security Event ID 4624; Cloud IAM infrastructure; Internet gateways and proxies; Endpoint devices of privileged users,Last 90 days,: SEARCH cloud_login_events by user | SORT by time | FOR each consecutive_login | CALCULATE distance_km / time_delta_hours | WHERE speed_kph > 800 | ALERT,playbooks/attack/enterprise/T1538.yml
T1538: Cloud Service Dashboard,f5d8e9c0-a1b2-4c3d-8e4f-5a6b7c8d9e0f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,4,"Is a cloud console session associated with a User-Agent string matching known offensive security tools, unauthorized scripts, or headless browsers?",This question looks for specific toolmarks left by adversaries. Attackers often use specialized tools (like Pacu) or automation scripts for reconnaissance and exploitation. Their User-Agent strings are often distinct from those of standard web browsers and can be a direct indicator of malicious intent.,"AWS CloudTrail logs; Azure Activity Logs; Google Cloud Audit Logs (Admin Activity); Zeek http.log; Cloud management consoles (e.g., AWS Management Console, Azure Portal); Internet gateways and proxies; Cloud API endpoints",Last 90 days,: SEARCH cloud_activity_logs | EXTRACT user_agent | MATCH user_agent against regex_list_of_malicious_tools | WHERE match_found=true | ALERT,playbooks/attack/enterprise/T1538.yml
T1538: Cloud Service Dashboard,f5d8e9c0-a1b2-4c3d-8e4f-5a6b7c8d9e0f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,5,Is a user's cloud console session using a User-Agent string that is both new for that specific user and rare across the entire organization?,"This question helps detect anomalous activity that might not match a known malicious signature. A User-Agent that a user has never used before, and which is also uncommon organization-wide, suggests the use of a non-standard client, which could be an adversary's tool or an unauthorized script.","AWS CloudTrail logs; Azure Activity Logs; Google Cloud Audit Logs (Admin Activity); Zeek http.log; Cloud management consoles (e.g., AWS Management Console, Azure Portal); Internet gateways and proxies; Cloud API endpoints",Last 90 days,: SEARCH cloud_activity_logs | BASELINE user_agents by user over 90d | FOR new_login | IF new_user_agent not in user_baseline AND global_prevalence(new_user_agent) < 1% | ALERT,playbooks/attack/enterprise/T1538.yml
T1538: Cloud Service Dashboard,f5d8e9c0-a1b2-4c3d-8e4f-5a6b7c8d9e0f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,6,Does a machine learning model classify the User-Agent from a cloud console session as potentially malicious?,"This question leverages machine learning to move beyond simple signature or rarity checks. A trained model can learn the subtle characteristics of malicious User-Agents and identify novel or obfuscated strings that might evade other detection methods, providing a more robust and scalable approach.","AWS CloudTrail logs; Azure Activity Logs; Google Cloud Audit Logs (Admin Activity); Zeek http.log; Cloud management consoles (e.g., AWS Management Console, Azure Portal); Internet gateways and proxies; Cloud API endpoints",Last 90 days,: STREAM cloud_activity_logs | EXTRACT user_agent | INPUT user_agent to ml_model | WHERE model_prediction == 'malicious-tool' | ALERT,playbooks/attack/enterprise/T1538.yml
T1538: Cloud Service Dashboard,f5d8e9c0-a1b2-4c3d-8e4f-5a6b7c8d9e0f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,7,Has a single user session generated an abnormally high volume and variety of read-only API calls across multiple cloud services in a short period?,"This question is designed to detect the broad reconnaissance common after an initial compromise. An attacker will often try to enumerate as many resources as possible (users, roles, instances, databases) very quickly. This behavior contrasts sharply with normal administrative activity, which is typically more focused.","AWS CloudTrail logs (List*, Describe*, Get* events); Azure Activity Logs (Microsoft.Resources/subscriptions/resourceGroups/read); Google Cloud Audit Logs (Data Access); Cloud API endpoints; Cloud management consoles; Specific cloud service infrastructure (e.g., S3, EC2, RDS)",Last 90 days,": SEARCH cloud_api_logs | FILTER event_name matches 'List*', 'Describe*', 'Get*' | GROUPBY session_id, user over 15m_window | COUNT distinct event_name as event_count, COUNT distinct service as service_count | WHERE event_count > 100 AND service_count > 5 | ALERT",playbooks/attack/enterprise/T1538.yml
T1538: Cloud Service Dashboard,f5d8e9c0-a1b2-4c3d-8e4f-5a6b7c8d9e0f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,8,Is the diversity of API calls within a user's session (as measured by Shannon entropy) statistically unusual compared to their historical behavior?,"This question provides a more nuanced way to measure the unusualness of a session's activity. High entropy indicates a wide variety of different actions are being taken, which is characteristic of broad reconnaissance. Flagging sessions with abnormally high entropy compared to the user's own baseline can uncover sophisticated enumeration that might not trigger simple volume-based thresholds.","AWS CloudTrail logs (List*, Describe*, Get* events); Azure Activity Logs (Microsoft.Resources/subscriptions/resourceGroups/read); Google Cloud Audit Logs (Data Access); Cloud API endpoints; Cloud management consoles; Specific cloud service infrastructure (e.g., S3, EC2, RDS)",Last 90 days,": SEARCH cloud_api_logs | GROUPBY session_id, user over 10m_window | CALCULATE shannon_entropy(event_name) | COMPARE current_entropy to user_historical_entropy_baseline | WHERE current_entropy > 99th_percentile | ALERT",playbooks/attack/enterprise/T1538.yml
T1538: Cloud Service Dashboard,f5d8e9c0-a1b2-4c3d-8e4f-5a6b7c8d9e0f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,9,Does the sequence of API calls in a user's session deviate significantly from patterns learned by a sequence-based anomaly detection model?,"This question aims to detect anomalies in the order of operations, not just the volume or variety. Legitimate administrative tasks often follow predictable workflows. An attacker's reconnaissance may follow a different, opportunistic path. A sequence model can learn the normal ""grammar"" of API calls and flag sessions that don't conform.","AWS CloudTrail logs (List*, Describe*, Get* events); Azure Activity Logs (Microsoft.Resources/subscriptions/resourceGroups/read); Google Cloud Audit Logs (Data Access); Cloud API endpoints; Cloud management consoles; Specific cloud service infrastructure (e.g., S3, EC2, RDS)",Last 90 days,: STREAM cloud_api_logs by session_id | CREATE event_name_sequence | INPUT sequence to lstm_autoencoder_model | CALCULATE reconstruction_error | WHERE reconstruction_error > threshold | ALERT,playbooks/attack/enterprise/T1538.yml
T1538: Cloud Service Dashboard,f5d8e9c0-a1b2-4c3d-8e4f-5a6b7c8d9e0f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,10,"Is a user who is not part of an authorized administrative group attempting to discover sensitive resources like secrets, encryption keys, or IAM policies?","This question implements a direct, high-fidelity check based on the principle of least privilege. Access to discover sensitive configuration and data should be tightly controlled. Any attempt by a non-privileged user to list secrets or view detailed authorization policies is highly suspicious and warrants immediate investigation.","AWS CloudTrail logs (e.g., secretsmanager:ListSecrets, iam:GetAccountAuthorizationDetails); Azure Activity Logs (e.g., Microsoft.KeyVault/vaults/secrets/list/action); Google Cloud Audit Logs (Data Access); Secrets management services (e.g., AWS Secrets Manager, Azure Key Vault); IAM infrastructure; Data storage services hosting sensitive information",Last 90 days,": SEARCH cloud_api_logs | FILTER event_name in sensitive_api_watchlist | GET user_group_membership | WHERE user_group NOT IN ('Cloud Security Admin', 'Cloud Auditor') | ALERT",playbooks/attack/enterprise/T1538.yml
T1538: Cloud Service Dashboard,f5d8e9c0-a1b2-4c3d-8e4f-5a6b7c8d9e0f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,11,"Has a user made a sensitive API call that has never, or very rarely, been made by anyone with their assigned role?","This question uses role-based access control (RBAC) baselining to find privileged access abuse. Even if a user is an administrator, they may have a specific function. If a database administrator suddenly starts listing IAM policies, it's a deviation from their role's expected behavior and could indicate a compromised privileged account being used for reconnaissance.","AWS CloudTrail logs (e.g., secretsmanager:ListSecrets, iam:GetAccountAuthorizationDetails); Azure Activity Logs (e.g., Microsoft.KeyVault/vaults/secrets/list/action); Google Cloud Audit Logs (Data Access); Secrets management services (e.g., AWS Secrets Manager, Azure Key Vault); IAM infrastructure; Data storage services hosting sensitive information",Last 180 days,": SEARCH cloud_api_logs | FILTER event_name in sensitive_api_watchlist | BASELINE role, event_name over 180d | COMPARE new_event to baseline | WHERE invocation_frequency_for_role == 0 | ALERT",playbooks/attack/enterprise/T1538.yml
T1538: Cloud Service Dashboard,f5d8e9c0-a1b2-4c3d-8e4f-5a6b7c8d9e0f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,12,Did a graph-based anomaly detection model identify a low-probability access event between a user and a sensitive resource?,"This question applies graph analytics to model complex relationships between users, roles, and resources. This approach can uncover subtle anomalies that are difficult to define with rules. For example, it can learn that ""developers"" access ""dev-keys"" but not ""prod-keys."" A new access event that creates an ""unlikely"" link in this graph is a powerful indicator of a potential threat.","AWS CloudTrail logs (e.g., secretsmanager:ListSecrets, iam:GetAccountAuthorizationDetails); Azure Activity Logs (e.g., Microsoft.KeyVault/vaults/secrets/list/action); Google Cloud Audit Logs (Data Access); Secrets management services (e.g., AWS Secrets Manager, Azure Key Vault); IAM infrastructure; Data storage services hosting sensitive information",Last 90 days,": STREAM cloud_access_logs | CONSTRUCT user_resource_graph | FOR new_access_event (user, resource) | CALCULATE link_prediction_probability | WHERE probability < low_threshold | ALERT",playbooks/attack/enterprise/T1538.yml
T1552.005: Cloud Instance Metadata API,d8d73b5f-2a3b-4c9f-8e1d-9c0a6b7e8f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,1,"Has a public-facing web server, after receiving a connection from a known malicious IP, immediately made a connection to the cloud instance metadata API?","This question aims to detect potential Server-Side Request Forgery (SSRF) attacks. An adversary might exploit a vulnerability in a web application to force the server to make a request on their behalf. A common target for SSRF is the internal metadata API (169.254.169.254) to steal credentials. Correlating an inbound connection from a malicious source with a subsequent outbound connection to the metadata API within a very short timeframe (e.g., 5 seconds) is a strong indicator of this technique.","Zeek conn.log; Zeek http.log; Public-facing web application servers; Cloud network flow logs (e.g., VPC Flow Logs); Network traffic logs from virtual network taps",last 90 days,: JOIN (http_logs WHERE src_ip IN threat_intel_feed) WITH (conn_logs WHERE dest_ip = '169.254.169.254') ON (http_logs.dest_ip = conn_logs.src_ip) WHERE (conn_logs.timestamp - http_logs.timestamp <= 5_seconds),playbooks/attack/enterprise/T1552.005.yml
T1552.005: Cloud Instance Metadata API,d8d73b5f-2a3b-4c9f-8e1d-9c0a6b7e8f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,2,"Has a public-facing web server shown a statistically significant spike in connections to the cloud instance metadata API, especially following traffic from a low-reputation IP?","This question uses statistical analysis to identify anomalous behavior that might indicate an SSRF attack. Instead of relying on known malicious IPs, it establishes a normal baseline for how often a server communicates with the metadata API. A sudden, sharp increase in this traffic, particularly when correlated with inbound requests from suspicious or low-reputation sources, can signal that an attacker is exploiting a vulnerability to repeatedly query the metadata service.","Zeek conn.log; Zeek http.log; Public-facing web application servers; Cloud network flow logs (e.g., VPC Flow Logs); Network traffic logs from virtual network taps",last 90 days,": FOR each web_server, CALCULATE baseline_rate of connections to '169.254.169.254'. ALERT if current_rate > (baseline_mean + 3 * baseline_std_dev) AND recent_inbound_traffic_from_low_reputation_ip.",playbooks/attack/enterprise/T1552.005.yml
T1552.005: Cloud Instance Metadata API,d8d73b5f-2a3b-4c9f-8e1d-9c0a6b7e8f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,3,Can machine learning models predict or detect anomalous access to the metadata API based on features of inbound HTTP requests or the volume of requests over time?,"This question explores advanced, model-driven detection of SSRF attacks targeting the metadata API. A classification model can be trained to recognize malicious inbound HTTP requests (e.g., by analyzing unusual User-Agents, parameters, or headers) that are likely precursors to an SSRF. Separately, a time-series anomaly detection model can monitor the volume of requests to the metadata API, flagging any sudden, uncharacteristic spikes that deviate from learned normal patterns, which could indicate an automated exploit.","Zeek conn.log; Zeek http.log; Public-facing web application servers; Cloud network flow logs (e.g., VPC Flow Logs); Network traffic logs from virtual network taps",last 90 days,: APPLY trained_classifier to inbound_http_request_features. ALERT on 'malicious' prediction. MONITOR request_volume_to_metadata_api with time_series_model. ALERT on detected_anomaly.,playbooks/attack/enterprise/T1552.005.yml
T1552.005: Cloud Instance Metadata API,d8d73b5f-2a3b-4c9f-8e1d-9c0a6b7e8f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,4,Has a process been created on a cloud instance that explicitly uses a network utility to query the instance metadata API via the command line?,"This question looks for direct, command-line evidence of an adversary or script attempting to access the metadata API. Attackers often use common utilities like curl, wget, or PowerShell's Invoke-WebRequest to make HTTP requests. Searching process creation logs (like Windows Event ID 4688) for command lines containing both a network utility and the metadata API IP address (169.254.169.254) is a high-fidelity way to detect this activity.","Windows Event ID 4688; Cloud compute instances (VMs, containers); CI/CD pipeline runners; Endpoint Detection and Response (EDR) logs on cloud instances",last 90 days,: SEARCH process_creation_logs WHERE command_line MATCHES REGEX '(?i)(curl|wget|powershell|pwsh|python|Invoke-WebRequest|iwr).*(169\\.254\\.169\\.254)',playbooks/attack/enterprise/T1552.005.yml
T1552.005: Cloud Instance Metadata API,d8d73b5f-2a3b-4c9f-8e1d-9c0a6b7e8f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,5,Has a historically rare process on a specific host been executed to connect to the cloud instance metadata API?,"This question aims to find unusual or novel processes accessing the metadata API. While some legitimate applications might query the API, an attacker might use a custom tool or a built-in utility that is not typically used for network activity on that host. By baselining common processes and flagging executions involving '169.254.169.254' by statistically rare processes (e.g., those in the bottom 5th percentile of historical frequency), we can identify suspicious activity that deviates from the norm for that specific system.","Windows Event ID 4688; Cloud compute instances (VMs, containers); CI/CD pipeline runners; Endpoint Detection and Response (EDR) logs on cloud instances",last 90 days,": FOR each host, CALCULATE frequency of all process_names. FOR process_creation_events involving '169.254.169.254', ALERT if process_name_frequency is in bottom 5th percentile.",playbooks/attack/enterprise/T1552.005.yml
T1552.005: Cloud Instance Metadata API,d8d73b5f-2a3b-4c9f-8e1d-9c0a6b7e8f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,6,Can a machine learning model classify process creation events involving network connections as benign or suspicious metadata access based on command-line features?,"This question leverages machine learning to distinguish between legitimate and malicious command-line access to the metadata API. By extracting features from the command line itself—such as the number of arguments, presence of IP addresses, specific keywords (e.g., 'credentials'), and entropy (randomness)—a model can be trained to score the likelihood that a given command is malicious. This moves beyond simple string matching to a more nuanced, context-aware detection.","Windows Event ID 4688; Cloud compute instances (VMs, containers); CI/CD pipeline runners; Endpoint Detection and Response (EDR) logs on cloud instances",last 90 days,: EXTRACT features from process_command_line. APPLY trained_classifier to features. ALERT if classification is 'suspicious metadata access'.,playbooks/attack/enterprise/T1552.005.yml
T1552.005: Cloud Instance Metadata API,d8d73b5f-2a3b-4c9f-8e1d-9c0a6b7e8f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,7,Has a network connection to the metadata API been initiated by a process or user account that is not on a pre-defined allowlist for that instance's role?,"This question focuses on policy enforcement to detect unauthorized access. In a well-managed cloud environment, only specific applications and service accounts should need to access the metadata API. By creating and maintaining allowlists of authorized processes and users for each instance role, any connection to '169.254.169.254' from an entity not on the list can be treated as a high-confidence security alert, indicating either misconfiguration or malicious activity.","Windows Event ID 5156; Windows Event ID 4688; Zeek conn.log; Sysmon Event ID 3; Cloud compute instances (VMs, containers); Authentication and identity management servers; Host-based firewall logs",last 90 days,": FOR network_connection_event to '169.254.169.254', GET source_process_name and source_user. GET instance_role. ALERT if source_process_name OR source_user NOT IN allowlist_for_instance_role.",playbooks/attack/enterprise/T1552.005.yml
T1552.005: Cloud Instance Metadata API,d8d73b5f-2a3b-4c9f-8e1d-9c0a6b7e8f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,8,Has the set of unique processes connecting to the metadata API on a given instance significantly deviated from its historical baseline?,"This question uses a statistical approach to detect changes in behavior without requiring a manually maintained allowlist. It works by first learning the ""normal"" set of processes that access the metadata API on an instance over a baseline period. It then periodically compares the current set of active processes to this baseline. A low similarity score (e.g., using the Jaccard index) indicates that new, previously unseen processes are now accessing the API, which is a strong anomaly signal.","Windows Event ID 5156; Windows Event ID 4688; Zeek conn.log; Sysmon Event ID 3; Cloud compute instances (VMs, containers); Authentication and identity management servers; Host-based firewall logs",last 90 days,": FOR each instance, CREATE baseline_set of processes connecting to '169.254.169.254'. PERIODICALLY GET current_set of connecting processes. CALCULATE jaccard_similarity(baseline_set, current_set). ALERT if similarity_score < threshold.",playbooks/attack/enterprise/T1552.005.yml
T1552.005: Cloud Instance Metadata API,d8d73b5f-2a3b-4c9f-8e1d-9c0a6b7e8f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,9,Can unsupervised machine learning identify outlier processes or users accessing the metadata API by clustering normal behavior?,"This question applies unsupervised learning to automatically discover what ""normal"" access to the metadata API looks like and flag anything that doesn't fit. By clustering connection events based on features like process name, parent process, user context, and command line, the model can identify large, dense clusters representing common, legitimate activity. Any connection that falls into a very small cluster or is classified as noise (an outlier) by the algorithm is flagged as anomalous and worthy of investigation.","Windows Event ID 5156; Windows Event ID 4688; Zeek conn.log; Sysmon Event ID 3; Cloud compute instances (VMs, containers); Authentication and identity management servers; Host-based firewall logs",last 90 days,": EXTRACT features from processes connecting to '169.254.169.254'. APPLY clustering_algorithm (e.g., DBSCAN) to features. LABEL large clusters as 'normal'. ALERT on processes in small clusters or classified as noise.",playbooks/attack/enterprise/T1552.005.yml
T1552.005: Cloud Instance Metadata API,d8d73b5f-2a3b-4c9f-8e1d-9c0a6b7e8f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,10,"Is an instance making non-standard or repeated failing requests to the metadata API, suggesting reconnaissance or brute-force enumeration?","This question seeks to identify adversary reconnaissance against the metadata API. Legitimate requests are almost always HTTP GET requests. An alert on any other method (like POST or PUT) is highly suspicious. Additionally, attackers often probe for available data by trying different URI paths. A pattern of multiple '404 Not Found' errors followed by requests to slightly different paths is a classic sign of enumeration or brute-forcing and should be investigated.","Zeek http.log; Cloud instance virtual network interfaces (VNICs); Network traffic inspection points (e.g., Zeek sensors); Cloud provider-native traffic mirroring services",last 90 days,: SEARCH http_logs WHERE dest_ip = '169.254.169.254'. ALERT if http_method != 'GET'. DETECT sequences of (http_status=404 followed by new_uri_request) from same source.,playbooks/attack/enterprise/T1552.005.yml
T1552.005: Cloud Instance Metadata API,d8d73b5f-2a3b-4c9f-8e1d-9c0a6b7e8f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,11,"Has an instance exhibited a statistical anomaly in its requests to the metadata API, such as accessing an unusually high number of unique URI paths or using URIs with high entropy?","This question uses statistical metrics to detect reconnaissance activity that might be missed by simple rules. By establishing a baseline for each instance, we can detect when it starts behaving abnormally. A sudden spike in the number of unique URI paths accessed per hour (exceeding the 99th percentile) suggests enumeration. Similarly, a significant increase in the Shannon entropy of the requested URIs can indicate an attacker is using randomized or obfuscated paths to probe the API.","Zeek http.log; Cloud instance virtual network interfaces (VNICs); Network traffic inspection points (e.g., Zeek sensors); Cloud provider-native traffic mirroring services",last 90 days,": FOR each source_ip, CALCULATE baseline of unique_uri_count_per_hour and uri_shannon_entropy. ALERT if current_unique_uri_count > 99th_percentile OR current_entropy > (baseline_mean + 2 * baseline_std_dev).",playbooks/attack/enterprise/T1552.005.yml
T1552.005: Cloud Instance Metadata API,d8d73b5f-2a3b-4c9f-8e1d-9c0a6b7e8f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,12,Does the observed volume of requests or data transfer from an instance to the metadata API significantly exceed the volume predicted by a time-series forecasting model?,"This question aims to detect data exfiltration or large-scale reconnaissance by modeling expected traffic volumes. A time-series model (like Prophet or LSTM) can learn the normal, cyclical patterns of an instance's communication with the metadata API. If the actual volume of requests or, more importantly, the size of the data transferred back from the API, suddenly and significantly exceeds the model's prediction and its confidence interval, it could indicate that a script is exfiltrating a large amount of sensitive data (like credentials for many roles).","Zeek http.log; Cloud instance virtual network interfaces (VNICs); Network traffic inspection points (e.g., Zeek sensors); Cloud provider-native traffic mirroring services",last 90 days,": FOR each instance, USE time_series_model to predict request_volume and data_transfer_size to '169.254.169.254'. ALERT if actual_volume > predicted_volume_upper_confidence_bound.",playbooks/attack/enterprise/T1552.005.yml
T1552.005: Cloud Instance Metadata API,d8d73b5f-2a3b-4c9f-8e1d-9c0a6b7e8f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,13,"After accessing the IAM security credential endpoint in the metadata API, did the same instance then initiate a new connection to a sensitive cloud provider API endpoint within five minutes?","This question directly ties the theft of credentials to their potential use. Accessing the '/iam/security-credentials/' path is a clear sign of intent to retrieve credentials. If this action is immediately followed by the same instance making a new connection to a major cloud management endpoint (like s3.amazonaws.com or management.azure.com), it strongly suggests the adversary has successfully obtained credentials and is now using them to interact with other cloud services. This two-stage detection provides high-confidence evidence of a successful attack.","Zeek conn.log; Zeek dns.log; Zeek http.log; Cloud compute instances (VMs, containers); Egress network gateways; DNS resolvers; VPC network access control lists (NACLs)",last 90 days,": FIND http_requests to '169.254.169.254' with uri containing '/iam/security-credentials/'. FOR each event, SEARCH conn_logs and dns_logs for outbound connections from same source_ip to cloud_api_endpoints within 5 minutes.",playbooks/attack/enterprise/T1552.005.yml
T1552.005: Cloud Instance Metadata API,d8d73b5f-2a3b-4c9f-8e1d-9c0a6b7e8f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,14,"Following a metadata credential access event, did the instance connect to a cloud API endpoint that is statistically rare for its specific role?","This question enhances the previous one by adding role-based context. Not all connections to cloud APIs are malicious. This approach establishes a baseline of which cloud APIs are normally contacted by instances of a certain role (e.g., a web server role typically only accesses S3). If, after fetching credentials, an instance from that web server role suddenly connects to a rare destination for its role (e.g., the IAM API to create new users), it should be assigned a high risk score, as this is a significant deviation from its expected behavior.","Zeek conn.log; Zeek dns.log; Zeek http.log; Cloud compute instances (VMs, containers); Egress network gateways; DNS resolvers; VPC network access control lists (NACLs)",last 90 days,": FOR each instance_role, CREATE baseline of normal_api_destinations. AFTER metadata_credential_access event, MONITOR subsequent outbound connections. ALERT if destination_api NOT IN baseline for that instance_role.",playbooks/attack/enterprise/T1552.005.yml
T1552.005: Cloud Instance Metadata API,d8d73b5f-2a3b-4c9f-8e1d-9c0a6b7e8f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,15,"Did an instance exhibit a sequence of network connections, starting with metadata credential access, that is flagged as anomalous by a state transition model?","This question uses a more sophisticated modeling technique to understand sequences of behavior. A Markov chain or similar model can be trained on benign network traffic to learn the probable sequences of connections (e.g., a web server connects to a database, then to a caching service). The model learns what state transitions are normal. An observed transition from the state 'Accessed Metadata Credentials' to a rare or forbidden state, such as 'Accessed IAM User Creation API', would be identified by the model as a highly improbable and therefore highly suspicious sequence of events.","Zeek conn.log; Zeek dns.log; Zeek http.log; Cloud compute instances (VMs, containers); Egress network gateways; DNS resolvers; VPC network access control lists (NACLs)",last 90 days,: TRAIN state_transition_model on normal network connection sequences. FEED live connection data into model. ALERT if model flags transition from 'Accessing Metadata Credentials' to a low-probability next state as an anomaly.,playbooks/attack/enterprise/T1552.005.yml
T1552.008: Chat Messages,b9d4c2a1-8e6f-4b0a-9d7c-3e5f6a1b0c8d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,1,Is a known credential theft tool that targets chat applications running on any endpoints?,"This question aims to identify the most direct evidence of credential theft from chat applications. Adversaries often use publicly available or custom tools (e.g., Slack-Pirate, Teams-Stealer) designed specifically to parse and steal credentials from local chat client data stores. A direct match on a process name or file hash from a reliable threat intelligence source is a high-confidence indicator of compromise.",Windows Event ID 4688; Sysmon Event ID 1; Endpoint file systems on user workstations and VDI instances where chat clients are installed. Monitored directories include temporary download folders and user profile directories.,last 90 days,: SEARCH process_creation_logs WHERE (process_name IN threat_intel_watchlist OR file_hash IN threat_intel_watchlist),playbooks/attack/enterprise/T1552.008.yml
T1552.008: Chat Messages,b9d4c2a1-8e6f-4b0a-9d7c-3e5f6a1b0c8d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,2,Are there any newly executed processes with a low prevalence across the enterprise?,"This question uses rarity as an indicator of potential malicious activity. Standard enterprise software is typically widespread, whereas custom malware or attacker tools will often appear on a very small number of compromised hosts. Identifying processes with a file hash present on fewer than 5 hosts or less than 1% of the environment can uncover non-standard or unauthorized tooling that warrants investigation.",Windows Event ID 4688; Sysmon Event ID 1; Endpoint file systems on user workstations and VDI instances where chat clients are installed. Monitored directories include temporary download folders and user profile directories.,last 30 days,": FOR each new_process_hash, COUNT distinct_hosts. IF host_count < 5, ALERT.",playbooks/attack/enterprise/T1552.008.yml
T1552.008: Chat Messages,b9d4c2a1-8e6f-4b0a-9d7c-3e5f6a1b0c8d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,3,Have any process execution events been flagged as malicious by a machine learning model?,"This question leverages machine learning to detect suspicious process behavior that may not match known signatures. By analyzing features like command-line length, process name entropy, parent process rarity, and code signing status, a classifier can identify characteristics common to malware. A high confidence score from the model indicates that a process is exhibiting multiple anomalous traits, suggesting it could be a previously unseen threat.",Windows Event ID 4688; Sysmon Event ID 1; Endpoint file systems on user workstations and VDI instances where chat clients are installed. Monitored directories include temporary download folders and user profile directories.,last 90 days,": SEARCH process_creation_logs | APPLY ml_model | WHERE model_confidence_score > 0.9, ALERT.",playbooks/attack/enterprise/T1552.008.yml
T1552.008: Chat Messages,b9d4c2a1-8e6f-4b0a-9d7c-3e5f6a1b0c8d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,4,"Is a scripting engine (e.g., PowerShell, Python) being used to search for credential-related keywords within chat application data directories?","This question looks for 'living-off-the-land' techniques where adversaries use legitimate scripting tools already present on a system to perform malicious actions. Specifically, it checks for command lines or script content that simultaneously references common credential terms ('password', 'token') and file paths associated with chat clients (Slack, Teams), which is a strong indicator of a targeted credential harvesting attempt.",Windows Event ID 4688; Sysmon Event ID 1; Windows PowerShell Event ID 4104; Endpoint command-line logs and PowerShell script block logs. Key locations for monitoring include user workstations and any servers where administrative scripts are run. Relevant GPOs for logging are managed on Domain Controllers.,last 90 days,": SEARCH (process_creation_logs OR script_block_logs) WHERE process_name IN (powershell.exe, python.exe) AND (command_line CONTAINS 'password' OR 'token') AND (command_line CONTAINS '%APPDATA%\\Slack' OR '%APPDATA%\\Microsoft\\Teams')",playbooks/attack/enterprise/T1552.008.yml
T1552.008: Chat Messages,b9d4c2a1-8e6f-4b0a-9d7c-3e5f6a1b0c8d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,5,Have any executed PowerShell scripts exhibited unusually high entropy?,"This question aims to detect obfuscated scripts. Adversaries often encode or compress their malicious scripts to evade signature-based detection. This obfuscation results in a higher-than-normal Shannon entropy score (a measure of randomness). By baselining the entropy of typical administrative scripts, we can flag outliers that are likely obfuscated and malicious.",Windows PowerShell Event ID 4104; Endpoint command-line logs and PowerShell script block logs. Key locations for monitoring include user workstations and any servers where administrative scripts are run. Relevant GPOs for logging are managed on Domain Controllers.,last 90 days,": SEARCH script_block_logs | CALCULATE shannon_entropy(script_content) | WHERE entropy_score > baseline_95th_percentile, ALERT.",playbooks/attack/enterprise/T1552.008.yml
T1552.008: Chat Messages,b9d4c2a1-8e6f-4b0a-9d7c-3e5f6a1b0c8d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,6,Has a Natural Language Processing (NLP) model classified any script or command-line execution as 'Credential Harvesting'?,"This question uses advanced NLP to understand the semantic intent of a script, going beyond simple keyword matching. A model trained on malicious and benign scripts can recognize the patterns, functions, and argument structures indicative of credential harvesting, even if specific keywords are avoided or obfuscated. A high-confidence classification from such a model is a powerful indicator of malicious intent.",Windows Event ID 4688; Sysmon Event ID 1; Windows PowerShell Event ID 4104; Endpoint command-line logs and PowerShell script block logs. Key locations for monitoring include user workstations and any servers where administrative scripts are run. Relevant GPOs for logging are managed on Domain Controllers.,last 90 days,": SEARCH (process_creation_logs OR script_block_logs) | APPLY nlp_classifier | WHERE classification == 'Credential Harvesting' AND confidence > 0.9, ALERT.",playbooks/attack/enterprise/T1552.008.yml
T1552.008: Chat Messages,b9d4c2a1-8e6f-4b0a-9d7c-3e5f6a1b0c8d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,7,Has any process not on the approved allow-list attempted to read files from protected chat application data directories?,"This question focuses on unauthorized access to sensitive data stores. By defining an explicit allow-list of processes that are expected to access chat data (e.g., the chat client itself, system indexers), any other process attempting to read from these directories becomes highly suspicious. This method can effectively detect custom or unknown tools trying to access chat history or credential files.","Windows Event ID 4663; Sysmon Event ID 1; Endpoint file systems where chat client data is stored. Specific NAIs include user profile directories such as '%APPDATA%\Microsoft\Teams', '%APPDATA%\Slack', and '%LOCALAPPDATA%\Microsoft\Teams' on Windows workstations.",last 90 days,": SEARCH file_access_logs WHERE target_directory IN ('%APPDATA%\\Slack', '%APPDATA%\\Microsoft\\Teams') AND access_type == 'Read' AND process_name NOT IN (allow_list)",playbooks/attack/enterprise/T1552.008.yml
T1552.008: Chat Messages,b9d4c2a1-8e6f-4b0a-9d7c-3e5f6a1b0c8d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,8,Has a process accessed a chat data directory for the first time in the last 30 days?,"This question uses behavioral baselining to detect deviations from normal activity. Over time, a stable pattern of processes accessing chat directories will emerge. A process accessing one of these directories for the very first time represents an anomaly that could indicate the introduction of a new, potentially malicious tool on the endpoint. This approach helps find threats without relying on pre-defined signatures or allow-lists.","Windows Event ID 4663; Endpoint file systems where chat client data is stored. Specific NAIs include user profile directories such as '%APPDATA%\Microsoft\Teams', '%APPDATA%\Slack', and '%LOCALAPPDATA%\Microsoft\Teams' on Windows workstations.",last 30 days,": FOR each new_file_access_event, CHECK if process_name has accessed target_directory in last 30 days. IF first_time_access, ALERT.",playbooks/attack/enterprise/T1552.008.yml
T1552.008: Chat Messages,b9d4c2a1-8e6f-4b0a-9d7c-3e5f6a1b0c8d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,9,Have any file access events on chat data directories been identified as anomalous outliers by a clustering model?,"This question applies unsupervised machine learning to identify unusual file access patterns. By clustering 'normal' access events based on features like the process, user, and time of day, any event that doesn't fit into a cluster (i.e., is an outlier) can be flagged. This is effective at finding novel attack techniques that differ significantly from established benign behaviors.","Windows Event ID 4663; Endpoint file systems where chat client data is stored. Specific NAIs include user profile directories such as '%APPDATA%\Microsoft\Teams', '%APPDATA%\Slack', and '%LOCALAPPDATA%\Microsoft\Teams' on Windows workstations.",last 90 days,": SEARCH file_access_logs | APPLY dbscan_clustering_model | WHERE cluster_label == 'outlier', ALERT.",playbooks/attack/enterprise/T1552.008.yml
T1552.008: Chat Messages,b9d4c2a1-8e6f-4b0a-9d7c-3e5f6a1b0c8d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,10,Are any endpoints communicating with suspicious or typosquatted domains mimicking legitimate chat services?,"This question aims to detect command and control (C2) or data exfiltration channels masquerading as legitimate services. Adversaries may register domains like 'teams-login.com' or 'slack-auth.net' to trick users or evade simple network filters. Monitoring DNS and TLS records for connections to domains that are similar to, but not exactly matching, approved service domains can reveal these malicious communication attempts.","Zeek conn.log; Zeek http.log; Zeek ssl.log; Zeek dns.log; Network sensor data from egress points, including perimeter firewalls and network taps. DNS server logs, web proxy logs, and Cloud Access Security Broker (CASB) logs are also key NAIs.",last 90 days,": SEARCH (dns_logs OR tls_logs) WHERE query_domain SIMILAR TO approved_chat_domains AND query_domain NOT IN approved_chat_domains_list, ALERT.",playbooks/attack/enterprise/T1552.008.yml
T1552.008: Chat Messages,b9d4c2a1-8e6f-4b0a-9d7c-3e5f6a1b0c8d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,11,Has any host exhibited a significant spike in the volume of data sent to approved chat services?,"This question seeks to identify bulk data exfiltration. While normal chat usage involves a steady flow of data, an adversary scraping chat history or uploading stolen files would likely generate a large, anomalous spike in outbound traffic. By establishing a baseline of normal data volume for each host and alerting on significant deviations (e.g., more than 3 standard deviations above the average), we can detect potential data theft.","Zeek conn.log; Network sensor data from egress points, including perimeter firewalls and network taps. DNS server logs, web proxy logs, and Cloud Access Security Broker (CASB) logs are also key NAIs.",last 90 days,": FOR each host, CALCULATE daily_bytes_sent_to_chat_services. IF daily_bytes_sent > (30_day_avg + 3 * 30_day_stddev), ALERT.",playbooks/attack/enterprise/T1552.008.yml
T1552.008: Chat Messages,b9d4c2a1-8e6f-4b0a-9d7c-3e5f6a1b0c8d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,12,"Have any hosts shown a statistically significant deviation from their normal communication patterns with chat services, as determined by a time-series model?","This question uses a more sophisticated anomaly detection method to find subtle changes in behavior. A time-series model (like ARIMA or LSTM) learns the complex, hour-by-hour patterns of a user's communication (e.g., connection frequency, data volume). It can then predict the expected behavior and flag any real-time activity that falls outside the normal predicted range. This can detect attacks that are less obvious than a simple volume spike, such as a 'low and slow' data drip.","Zeek conn.log; Network sensor data from egress points, including perimeter firewalls and network taps. DNS server logs, web proxy logs, and Cloud Access Security Broker (CASB) logs are also key NAIs.",last 90 days,": FOR each host_service_pair, APPLY time_series_model. IF observed_activity OUTSIDE 99%_prediction_interval, ALERT.",playbooks/attack/enterprise/T1552.008.yml
T1555.003: Credentials from Web Browsers,6f5b9d3a-1c8e-4a7f-8b2c-9d0e1f7a4b6c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0006: Credential Access,n; o; n; e,1,Are there any process creation events matching known credential theft tool hashes or network connections to known malicious C2 infrastructure?,"This question uses threat intelligence to find high-confidence indicators of compromise. It checks if any executed files on endpoints are known credential theft tools (e.g., LaZagne, Mimikatz, WebBrowserPassView) by comparing their file hashes against a known-bad list. Simultaneously, it monitors all outbound network traffic for connections to IP addresses or domains that are identified on a threat intelligence feed as Command and Control (C2) servers.","Windows Event ID 4688; Zeek conn.log; Zeek dns.log; User workstations, servers with interactive logins, and network egress points.",last 90 days,: SEARCH Windows Event ID 4688 | HASH(process_executable) | LOOKUP credential_thief_hashes WHERE match=true; SEARCH Zeek conn.log OR Zeek dns.log | LOOKUP c2_indicators WHERE match=true,playbooks/attack/enterprise/T1555.003.yml
T1555.003: Credentials from Web Browsers,6f5b9d3a-1c8e-4a7f-8b2c-9d0e1f7a4b6c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0006: Credential Access,n; o; n; e,2,Have any hosts made connections to rare domains shortly after an unusual process was launched?,"This question uses statistical analysis to uncover potentially malicious activity without relying on known indicators. It identifies domains that are very rarely visited across the entire enterprise. A connection to such a domain is suspicious. The suspicion level is increased significantly if this rare connection occurs within a few minutes of a new or unusual process starting on the same host, suggesting the process initiated the connection.","Windows Event ID 4688; Zeek dns.log; User workstations, servers with interactive logins, and network egress points.",last 90 days,": SEARCH Zeek dns.log | STATS count(host) by domain | WHERE count < enterprise_1st_percentile | JOIN host, time (within 5 mins) with (SEARCH Windows Event ID 4688)",playbooks/attack/enterprise/T1555.003.yml
T1555.003: Credentials from Web Browsers,6f5b9d3a-1c8e-4a7f-8b2c-9d0e1f7a4b6c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0006: Credential Access,n; o; n; e,3,Has a host exhibited a significant deviation from its baseline outbound network traffic patterns following a suspicious process creation event?,"This question uses machine learning to detect anomalous network behavior that could signal C2 communication. A time-series model learns the normal pattern of outbound network traffic (e.g., volume, frequency) for each host. An alert is generated if the model observes a significant spike or change in traffic that deviates from its prediction, especially if this anomaly occurs right after a suspicious process was created on that host.","Windows Event ID 4688; Zeek conn.log; User workstations, servers with interactive logins, and network egress points.",last 90 days,: TRAIN time_series_model on Zeek conn.log per host | PREDICT traffic | DETECT anomaly where actual_traffic > forecast_error_99th_percentile | CORRELATE with recent suspicious process from Event ID 4688,playbooks/attack/enterprise/T1555.003.yml
T1555.003: Credentials from Web Browsers,6f5b9d3a-1c8e-4a7f-8b2c-9d0e1f7a4b6c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0006: Credential Access,n; o; n; e,4,"Do any command line executions or PowerShell script blocks contain strings, file paths, or API calls associated with accessing browser credentials?","This question looks for direct evidence of credential theft attempts within command line arguments and PowerShell scripts. It uses regular expressions to search for specific keywords, such as default paths to browser credential databases (e.g., '...\Google\Chrome\User Data\Default\Login Data'), the use of tools like 'sqlite3.exe' to query these databases, or calls to Windows APIs like 'CryptUnprotectData' used to decrypt stored credentials.",Windows Event ID 4688; Windows Event ID 4104; All Windows endpoints and servers where PowerShell v5+ Script Block Logging is enabled.,last 90 days,": SEARCH (Event ID 4688 OR Event ID 4104) | WHERE command_line or script_block MATCHES REGEX ('Login Data', 'sqlite3.exe', 'CryptUnprotectData')",playbooks/attack/enterprise/T1555.003.yml
T1555.003: Credentials from Web Browsers,6f5b9d3a-1c8e-4a7f-8b2c-9d0e1f7a4b6c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0006: Credential Access,n; o; n; e,5,"Have there been any command line or PowerShell executions with unusually high entropy scores, suggesting obfuscation?","This question aims to detect malicious code that has been intentionally obscured to evade signature-based detection. Shannon entropy measures the randomness of data; highly obfuscated or encrypted code has high entropy. By establishing a baseline for normal scripts and commands, this method can flag executions with abnormally high entropy scores for further investigation.",Windows Event ID 4688; Windows Event ID 4104; All Windows endpoints and servers where PowerShell v5+ Script Block Logging is enabled.,last 90 days,: SEARCH (Event ID 4688 OR Event ID 4104) | CALCULATE entropy(command_line or script_block) | WHERE entropy > baseline_98th_percentile,playbooks/attack/enterprise/T1555.003.yml
T1555.003: Credentials from Web Browsers,6f5b9d3a-1c8e-4a7f-8b2c-9d0e1f7a4b6c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0006: Credential Access,n; o; n; e,6,Can a machine learning model classify any PowerShell script blocks as malicious based on features indicative of credential theft?,"This question leverages a supervised machine learning model to automatically identify malicious PowerShell scripts. The model is trained on a dataset of known benign and malicious scripts, learning to recognize patterns based on features like script length, the frequency of suspicious keywords (e.g., 'Unprotect', 'logins.json'), API call patterns, and entropy. It can then classify new, unseen scripts in real-time.",Windows Event ID 4104; All Windows endpoints and servers where PowerShell v5+ Script Block Logging is enabled.,last 90 days,": INPUT Event ID 4104 script_block | EXTRACT features (length, keywords, entropy) | PREDICT classification using trained_model | ALERT where prediction=malicious and confidence > threshold",playbooks/attack/enterprise/T1555.003.yml
T1555.003: Credentials from Web Browsers,6f5b9d3a-1c8e-4a7f-8b2c-9d0e1f7a4b6c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0006: Credential Access,n; o; n; e,7,Has a non-browser process attempted to read a browser's credential database file?,"This is a high-fidelity detection method that requires enabling specific file access auditing (SACLs) on browser credential store files. Once enabled, the system will log every read attempt (Event ID 4663). This question filters those logs to alert any time a process that is NOT on a pre-defined whitelist of legitimate web browsers (e.g., chrome.exe, firefox.exe) accesses these sensitive files.","Windows Event ID 4663; Windows Event ID 4688; File systems on all user workstations and servers. This requires enabling SACLs on user profile directories containing browser data (e.g., '*\AppData\Local\Google\Chrome\User Data\*').",last 90 days,: SEARCH Event ID 4663 | WHERE target_file MATCHES browser_credential_paths AND access_type=read AND process_name NOT IN (browser_whitelist),playbooks/attack/enterprise/T1555.003.yml
T1555.003: Credentials from Web Browsers,6f5b9d3a-1c8e-4a7f-8b2c-9d0e1f7a4b6c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0006: Credential Access,n; o; n; e,8,Has a statistically rare process accessed a browser credential file?,"This question identifies suspicious access by focusing on rarity. Over a baseline period (e.g., 30 days), it calculates how frequently different processes access browser credential files. An alert is generated if a process that very rarely or has never accessed these files before (e.g., 'powershell.exe', 'cscript.exe') suddenly does so, as this deviates from normal operational behavior.","Windows Event ID 4663; Windows Event ID 4688; File systems on all user workstations and servers. This requires enabling SACLs on user profile directories containing browser data (e.g., '*\AppData\Local\Google\Chrome\User Data\*').",last 90 days,: SEARCH Event ID 4663 for browser_credential_paths | STATS frequency(process_name) over 30d | ALERT where current_access_process_frequency < 5th_percentile,playbooks/attack/enterprise/T1555.003.yml
T1555.003: Credentials from Web Browsers,6f5b9d3a-1c8e-4a7f-8b2c-9d0e1f7a4b6c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0006: Credential Access,n; o; n; e,9,"Does an anomaly detection model identify any unusual access patterns to browser credential files, considering the process, parent process, user, and time?","This question uses an unsupervised machine learning model (e.g., Isolation Forest) to learn the complex, multi-featured patterns of normal access to browser credential files. The model considers who (user), what (process and parent process), and when (time of day) access typically occurs. It can then flag any access event that deviates significantly from this learned norm as a potential anomaly, without needing pre-defined rules.","Windows Event ID 4663; Windows Event ID 4688; File systems on all user workstations and servers. This requires enabling SACLs on user profile directories containing browser data (e.g., '*\AppData\Local\Google\Chrome\User Data\*').",last 90 days,": INPUT features (process_name, parent_process, user, time_of_day) from Event ID 4663/4688 | PREDICT anomaly_score using isolation_forest_model | ALERT on high anomaly_score",playbooks/attack/enterprise/T1555.003.yml
T1555.003: Credentials from Web Browsers,6f5b9d3a-1c8e-4a7f-8b2c-9d0e1f7a4b6c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0006: Credential Access,n; o; n; e,10,Has a process been observed copying a browser credential store file to a temporary or staging directory?,"This question targets a common adversary technique used to bypass file locks. Since browsers often lock their credential databases while running, adversaries copy the file to a different location (like C:\Windows\Temp) to read it. This analytic looks for process creation events where a copy command ('copy', 'xcopy', 'Copy-Item') is used with a browser credential file as the source and a known staging directory as the destination.","Windows Event ID 4688; Windows Event ID 4663; Temporary file locations (e.g., C:\Windows\Temp, C:\Users\Public, %APPDATA%\Temp) and user profile directories on all Windows endpoints.",last 90 days,": SEARCH Event ID 4688 | WHERE command_line MATCHES ('copy', 'xcopy', 'Copy-Item') AND source_path MATCHES browser_credential_paths AND destination_path MATCHES staging_dirs",playbooks/attack/enterprise/T1555.003.yml
T1555.003: Credentials from Web Browsers,6f5b9d3a-1c8e-4a7f-8b2c-9d0e1f7a4b6c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0006: Credential Access,n; o; n; e,11,"Have any files with unusual names or extensions, consistent with browser credential stores, been created in common staging directories?","This question provides an alternative way to detect the file staging technique. Instead of watching the copy command, it monitors file creation events within common temporary directories (e.g., C:\Windows\Temp). It flags the creation of any file that has a name or extension that is statistically rare for that directory but is consistent with browser credential files (e.g., 'Login Data', '.db', '.sqlite').","Windows Event ID 4688; Windows Event ID 4663; Temporary file locations (e.g., C:\Windows\Temp, C:\Users\Public, %APPDATA%\Temp) and user profile directories on all Windows endpoints.",last 90 days,: SEARCH file_creation_events in staging_dirs | STATS frequency(file_extension) | ALERT where new_file_extension is rare OR file_name matches ('Login Data'),playbooks/attack/enterprise/T1555.003.yml
T1555.003: Credentials from Web Browsers,6f5b9d3a-1c8e-4a7f-8b2c-9d0e1f7a4b6c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0006: Credential Access,n; o; n; e,12,Has a machine learning model detected the specific sequence of a credential file being copied to a staging area and then read by a process?,"This question uses a more advanced model to detect a specific multi-step attack chain. It looks for a sequence of events in order: (1) a process executes a command to copy a browser credential file, (2) a new file is created in a staging area, and (3) the same process (or its child) reads the newly created file. Detecting this entire sequence with high probability provides very strong evidence of malicious activity.","Windows Event ID 4688; Windows Event ID 4663; Temporary file locations (e.g., C:\Windows\Temp, C:\Users\Public, %APPDATA%\Temp) and user profile directories on all Windows endpoints.",last 90 days,": DETECT sequence: [Event 4688: copy browser_db], THEN [File Create: staging_dir], THEN [Event 4663: read new_file] by same/child process | ALERT if sequence probability is high",playbooks/attack/enterprise/T1555.003.yml
T1555.003: Credentials from Web Browsers,6f5b9d3a-1c8e-4a7f-8b2c-9d0e1f7a4b6c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0006: Credential Access,n; o; n; e,13,"Has a non-browser process read a credential file, followed shortly by an outbound network connection from the same host to a known malicious destination?","This question correlates host-based activity with network activity for a high-confidence alert. It creates a rule that triggers when two conditions are met on the same host within a short time window (e.g., 5 minutes): (1) a non-browser process reads a credential file, and (2) the host initiates a network connection to a destination IP or domain that is on a threat intelligence feed of known C2 servers.","Windows Event ID 4663; Windows Event ID 4688; Zeek conn.log; Zeek dns.log; Network egress points, firewalls, and host-level event logs on all endpoints where SACL auditing for browser credential files is enabled.",last 90 days,": TRIGGER on Event 4663 where process is not browser and target is credential_file | WITHIN 5 mins on same host, SEARCH Zeek logs for connection to destination on C2_feed",playbooks/attack/enterprise/T1555.003.yml
T1555.003: Credentials from Web Browsers,6f5b9d3a-1c8e-4a7f-8b2c-9d0e1f7a4b6c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0006: Credential Access,n; o; n; e,14,"Following a non-browser process reading a credential file, did the host make DNS queries for statistically rare domains?","This question correlates suspicious file access with suspicious network behavior using statistical rarity instead of threat intelligence. It first identifies when a non-browser process reads a credential file. It then examines the subsequent DNS queries from that same host. If the host queries for a domain that is very rarely visited by any other host in the enterprise, the activity is flagged as potential exfiltration to a non-standard destination.","Windows Event ID 4663; Windows Event ID 4688; Zeek conn.log; Zeek dns.log; Network egress points, firewalls, and host-level event logs on all endpoints where SACL auditing for browser credential files is enabled.",last 90 days,: TRIGGER on Event 4663 where process is not browser | SEARCH subsequent Zeek dns.log from same host | LOOKUP domain_prevalence | ALERT if prevalence < 0.5%,playbooks/attack/enterprise/T1555.003.yml
T1555.003: Credentials from Web Browsers,6f5b9d3a-1c8e-4a7f-8b2c-9d0e1f7a4b6c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0006: Credential Access,n; o; n; e,15,"After a credential file was accessed by a non-whitelisted process, did an ML model detect an anomalous spike in outbound data volume from that host?","This question uses a machine learning model to specifically look for signs of data exfiltration immediately following credential access. When the trigger event occurs (a non-browser process reads a credential file), a time-series model begins monitoring the outbound data volume for that host. If the model detects a sudden, anomalous spike in bytes sent that exceeds a dynamic threshold, it generates a high-priority alert.","Windows Event ID 4663; Windows Event ID 4688; Zeek conn.log; Zeek dns.log; Network egress points, firewalls, and host-level event logs on all endpoints where SACL auditing for browser credential files is enabled.",last 90 days,": TRIGGER on Event 4663 where process is not browser | MONITOR Zeek conn.log 'orig_bytes' for that host | ALERT if time-series_model detects anomaly (e.g., > 3 std dev) within 10 mins",playbooks/attack/enterprise/T1555.003.yml
T1558.005: Ccache Files,8c6d1a5b-9f8e-4b2a-8c7d-3e4f5a6b7c8d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,1,Is a new logon session (Logon Type 9) being initiated by a known credential theft tool?,"This question attempts to identify a high-fidelity indicator of credential abuse. Adversary tools like Mimikatz, Rubeus, and Kekeo are often used to inject stolen Kerberos tickets (from ccache files or other means) into memory to create a new logon session as the victim user. This query looks for the direct link between the execution of a known malicious tool (from a watchlist) and the immediate creation of a Logon Type 9 event, which strongly suggests a pass-the-ticket attack is in progress.","Windows Event ID 4688; Windows Event ID 4624; Privileged access workstations, member servers, domain controllers, Tier 0 assets",last 90 days,search: Find process creation (4688) for tool in watchlist. Correlate process ID with logon event (4624) where logon type is 9.,playbooks/attack/enterprise/T1558.005.yml
T1558.005: Ccache Files,8c6d1a5b-9f8e-4b2a-8c7d-3e4f5a6b7c8d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,2,Is a statistically rare process initiating a new logon session (Logon Type 9)?,"While Logon Type 9 events are common for legitimate tools like `runas.exe`, they are not typically initiated by a wide variety of processes. This question aims to uncover credential abuse by identifying outliers. By establishing a baseline of normal processes that create these logon sessions, analysts can flag any process that falls into a rare percentile (e.g., a script, a custom binary, or an office application) as highly suspicious, as it may indicate an adversary is using a non-standard method to leverage stolen credentials.","Windows Event ID 4624; Windows Event ID 4688; Privileged access workstations, member servers, domain controllers, Tier 0 assets",last 90 days,"search: From logon events (4624) with type 9, find parent process. Compare process frequency against historical baseline. Alert on rare processes.",playbooks/attack/enterprise/T1558.005.yml
T1558.005: Ccache Files,8c6d1a5b-9f8e-4b2a-8c7d-3e4f5a6b7c8d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,3,Does a new logon session (Logon Type 9) and its parent process exhibit characteristics of malicious activity based on a trained machine learning model?,"This question leverages a supervised machine learning model to detect more subtle or novel variations of credential abuse. The model is trained on features from both the process creation event (e.g., command-line entropy, parent process) and the subsequent logon event (e.g., user context, source workstation). By learning the complex patterns of both benign and known-malicious activity, the model can score new events in real-time and alert on those that are classified as suspicious with high confidence, even if they don't match a specific signature or watchlist.","Windows Event ID 4688; Windows Event ID 4624; Privileged access workstations, member servers, domain controllers, Tier 0 assets",last 90 days,search: Extract features from correlated process creation (4688) and logon (4624) events. Score with ML model. Alert on high suspicion score.,playbooks/attack/enterprise/T1558.005.yml
T1558.005: Ccache Files,8c6d1a5b-9f8e-4b2a-8c7d-3e4f5a6b7c8d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,4,Is a process being executed with command-line arguments indicative of Kerberos ticket manipulation or pass-the-ticket attacks?,"This question focuses on finding direct evidence of credential theft tools being used via their command-line artifacts. Tools like Rubeus and Mimikatz use specific keywords and argument structures (e.g., `ptt /ticket:`, `tgs::ask`, `convert /ccache`) to perform actions on Kerberos tickets. This query uses regular expressions to search for these patterns, as well as for long, base64-encoded strings that are characteristic of embedded tickets, providing a strong signal of malicious activity.","Windows Event ID 4688; Zeek conn.log; Linux/macOS systems with command-line logging, Windows systems used for ticket conversion, domain controllers",last 90 days,"search: Search process creation logs (4688) for command lines matching regex patterns for ticket manipulation (e.g., 'ptt /ticket:', base64 strings).",playbooks/attack/enterprise/T1558.005.yml
T1558.005: Ccache Files,8c6d1a5b-9f8e-4b2a-8c7d-3e4f5a6b7c8d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,5,"Is a process being executed with unusually long or high-entropy command-line arguments, suggesting an embedded Kerberos ticket?","This question provides a way to detect ticket manipulation when specific tool signatures are unknown or obfuscated. Kerberos tickets, when passed as arguments, are often base64-encoded, resulting in long strings with high Shannon entropy (a measure of randomness). By establishing a baseline for normal command-line entropy across the environment, this query can flag any command whose arguments are a statistical outlier, which is a strong indicator that a ticket or other encoded blob is being passed.","Windows Event ID 4688; Linux/macOS systems with command-line logging, Windows systems used for ticket conversion, domain controllers",last 90 days,search: Calculate entropy for command-line arguments in process creation logs (4688). Compare against historical baseline. Alert on high-entropy outliers.,playbooks/attack/enterprise/T1558.005.yml
T1558.005: Ccache Files,8c6d1a5b-9f8e-4b2a-8c7d-3e4f5a6b7c8d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,6,Does a command-line execution exhibit anomalous characteristics when compared to a learned baseline of normal activity?,"This question uses an unsupervised anomaly detection model to identify novel or evasive command-line attacks. Instead of relying on specific signatures, the model learns the normal patterns of command-line usage based on features like length, argument count, character distribution, and entropy. It can then flag any new command that deviates significantly from these learned baselines, making it effective against custom tools or obfuscated versions of known tools.","Windows Event ID 4688; Linux/macOS systems with command-line logging, Windows systems used for ticket conversion, domain controllers",last 90 days,"search: Extract features from command lines (length, entropy, etc.). Score with unsupervised anomaly detection model. Alert on high anomaly score.",playbooks/attack/enterprise/T1558.005.yml
T1558.005: Ccache Files,8c6d1a5b-9f8e-4b2a-8c7d-3e4f5a6b7c8d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,7,"Is a file matching Kerberos ccache naming conventions being transferred over the network, particularly to an external destination?","This question aims to detect the exfiltration of credential material. Kerberos ccache files (e.g., `krb5cc_` or `krb5.ccache`) contain sensitive ticket-granting tickets and should almost never be transferred over the network, especially to an external IP address. This query monitors network file transfer logs (e.g., from Zeek) for these specific filenames and generates a high-severity alert if such a transfer is observed, as it is a strong sign of credential theft.","Zeek files.log; Zeek conn.log; Zeek ftp.log; Zeek smb_files.log; File servers hosting Linux user home directories, network egress points, Linux developer workstations",last 90 days,search: Monitor network file transfer logs (Zeek) for filenames matching 'krb5cc_*' or 'krb5.ccache'. Alert if destination is external or not on allowlist.,playbooks/attack/enterprise/T1558.005.yml
T1558.005: Ccache Files,8c6d1a5b-9f8e-4b2a-8c7d-3e4f5a6b7c8d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,8,"Is a statistically rare process accessing Kerberos ccache files, or is a normal process accessing an unusually high number of them?","This question detects credential harvesting on a host by baselining file access patterns. Legitimate access to ccache files is typically limited to a small set of system processes (e.g., `sshd`). This query identifies anomalous behavior by flagging access from any process that is statistically rare (like `powershell.exe` or a script) or by alerting when a legitimate process accesses a volume of ccache files that is significantly above its normal behavior, which could indicate a sweeping or harvesting action.","Windows Event ID 4663; File servers hosting Linux user home directories, network egress points, Linux developer workstations",last 90 days,"search: From file access logs (4663) for ccache files, baseline accessing processes. Alert on rare processes or unusually high access counts per process.",playbooks/attack/enterprise/T1558.005.yml
T1558.005: Ccache Files,8c6d1a5b-9f8e-4b2a-8c7d-3e4f5a6b7c8d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,9,"Does the relationship between a user, a process, a ccache file, and a network destination represent an improbable or anomalous path?","This question uses graph-based analysis to uncover complex attack chains that might appear benign in isolated events. It models relationships between entities (users, processes, files, IPs) to identify highly improbable sequences of actions. For example, a web service account running a process that accesses a domain administrator's ccache file and then makes a connection to an external IP represents an anomalous path that would be flagged, indicating a potential multi-stage credential theft and exfiltration attack.","Windows Event ID 4663; Zeek files.log; Zeek conn.log; File servers hosting Linux user home directories, network egress points, Linux developer workstations",last 90 days,"search: Model user, process, file, and network events in a graph. Use graph algorithms to find and alert on anomalous paths involving ccache files.",playbooks/attack/enterprise/T1558.005.yml
T1558.005: Ccache Files,8c6d1a5b-9f8e-4b2a-8c7d-3e4f5a6b7c8d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,10,"Has a user or system executed a sequence of commands indicative of locating, packaging, and exfiltrating Kerberos tickets?","This question looks for a logical chain of adversary actions related to credential theft. The query defines a stateful rule that triggers if a specific sequence of events occurs in a short time window on a single host: (1) listing tickets with `klist`, (2) accessing the ccache file, (3) compressing or encoding the file, and (4) making an outbound network connection. Detecting this full sequence provides strong, contextual evidence of an active attempt to steal and exfiltrate Kerberos credentials.","Windows Event ID 4688; Windows Event ID 4663; Zeek conn.log; User workstations, bastion hosts, servers with interactive logins",last 90 days,"search: Detect sequence: klist execution (4688), then ccache file access (4663), then compress/encode command (4688), then outbound network connection (Zeek).",playbooks/attack/enterprise/T1558.005.yml
T1558.005: Ccache Files,8c6d1a5b-9f8e-4b2a-8c7d-3e4f5a6b7c8d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,11,Has a user executed a statistically improbable sequence of commands involving Kerberos utilities?,"This question focuses on detecting behavioral anomalies in command-line activity. Using N-gram analysis, it models the typical sequences of commands for each user. An alert is generated when a user executes a command sequence that has a very low probability based on their historical behavior. A sequence like `klist` followed by `powershell -enc` would be highly unusual for most users and would be flagged as a deviation indicative of credential harvesting and preparation for exfiltration.","Windows Event ID 4688; User workstations, bastion hosts, servers with interactive logins",last 90 days,search: Model user command sequences using N-grams from process logs (4688). Alert on sequences with very low probability based on historical data.,playbooks/attack/enterprise/T1558.005.yml
T1558.005: Ccache Files,8c6d1a5b-9f8e-4b2a-8c7d-3e4f5a6b7c8d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,12,"Does a sequence of user or system events (process, file, network) have a high reconstruction error when processed by a sequence-based anomaly detection model?","This question uses a sophisticated deep learning model (like an LSTM autoencoder) to learn the normal 'rhythm' of activity for a user or host, including process executions, file accesses, and network connections. The model can then identify anomalous sequences that deviate from this learned norm. An event sequence with a high reconstruction error—meaning the model finds it highly unpredictable—such as `klist` being run by an unusual parent process followed by an outbound connection, would be flagged as a significant anomaly.","Windows Event ID 4688; Windows Event ID 4663; Zeek conn.log; User workstations, bastion hosts, servers with interactive logins",last 90 days,search: Feed sequences of user/host events into a trained LSTM autoencoder. Alert on sequences with high reconstruction error.,playbooks/attack/enterprise/T1558.005.yml
T1558.005: Ccache Files,8c6d1a5b-9f8e-4b2a-8c7d-3e4f5a6b7c8d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,13,Is a Kerberos Ticket-Granting Ticket (TGT) for the krbtgt service being requested from a machine that is not a Domain Controller?,"This question is designed to detect a Golden Ticket attack, a powerful persistence mechanism often enabled by credentials stolen via ccache files or other means. A service ticket request for the `krbtgt` principal should only originate from a Domain Controller. Any request for this service from a non-DC client address is a very high-fidelity indicator that an adversary has forged a TGT to gain unrestricted access to the domain.","Windows Event ID 4769; Zeek kerberos.log; Domain controllers, critical application servers, network choke points",last 90 days,search: Monitor Kerberos ticket requests (4769). Alert if Service Name is 'krbtgt' and Client Address is not a Domain Controller.,playbooks/attack/enterprise/T1558.005.yml
T1558.005: Ccache Files,8c6d1a5b-9f8e-4b2a-8c7d-3e4f5a6b7c8d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,14,"Is a user authenticating from an unusual location, to an unusual service, or at an unusual time, based on their historical profile?","This question aims to detect the malicious use of a stolen Kerberos ticket (pass-the-ticket) by identifying behavioral anomalies. It works by building a historical profile for each user, mapping their typical source IP subnets, accessed services (SPNs), and logon times. Any new authentication that deviates significantly from this established baseline—such as logging in from a new country or accessing a critical server for the first time—is flagged as suspicious, as it may indicate an attacker is impersonating that user.","Zeek kerberos.log; Windows Event ID 4769; Windows Event ID 4624; Domain controllers, critical application servers, network choke points",last 90 days,"search: Profile user authentication behavior (source IP, service, time) from logs (4769). Score new authentications against the profile. Alert on high deviation.",playbooks/attack/enterprise/T1558.005.yml
T1558.005: Ccache Files,8c6d1a5b-9f8e-4b2a-8c7d-3e4f5a6b7c8d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,15,Does a Kerberos authentication event fall outside of normal activity clusters for the enterprise?,"This question uses unsupervised clustering to find anomalous logons without pre-built profiles. The algorithm groups all authentication events based on features like user, source IP, and destination service, identifying dense clusters that represent normal 'peer group' activity. Any event that does not fit into a cluster is classified as a noise point or outlier. These outliers are strong candidates for investigation, as they represent activity that is abnormal compared to all other observed behaviors, such as the first instance of a pass-the-ticket attack.","Windows Event ID 4624; Windows Event ID 4769; Domain controllers, critical application servers, network choke points",last 90 days,"search: Cluster authentication events (4624/4769) based on user, source, destination, and time. Alert on events that do not belong to any cluster (noise points).",playbooks/attack/enterprise/T1558.005.yml
T1562.006: Indicator Blocking,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,1,Has a process been created whose file hash matches a known indicator blocking tool from a threat intelligence feed?,"This question is crucial for detecting the direct execution of known malicious tools. By comparing file hashes of all new processes against a curated list of indicator blocking tools, analysts can quickly identify and respond to the deployment of recognized threats, providing a high-fidelity signal of defense evasion activity.","Windows Event ID 4688; Sysmon Event ID 1; Endpoint workstations, Critical servers (e.g., Domain Controllers, file servers), Log aggregation servers",last 90 days,SEARCH process_creation_events | JOIN file_hashes WITH threat_intel_feed ON hash | WHERE match_found,playbooks/attack/enterprise/T1562.006.yml
T1562.006: Indicator Blocking,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,2,"Have any rare executables, potentially unknown indicator blocking tools, been deployed across multiple systems within a short time frame?","This question helps uncover novel or custom tools that are not yet in threat intelligence feeds. By tracking the prevalence of new file hashes, analysts can spot executables that are rare across the enterprise but deployed to multiple hosts, a strong indicator of a targeted attack or tool staging.","Windows Event ID 4688; Sysmon Event ID 1; Endpoint workstations, Critical servers (e.g., Domain Controllers, file servers), Log aggregation servers",last 90 days,SEARCH process_creation_events | CALCULATE prevalence(file_hash) by host | FILTER prevalence < threshold AND host_count > 1 within 24h,playbooks/attack/enterprise/T1562.006.yml
T1562.006: Indicator Blocking,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,3,"Are there processes being executed that exhibit characteristics of malicious indicator blocking tools, even if their hash is unknown?","This question leverages machine learning to proactively identify suspicious processes that evade hash-based detection. By analyzing features like parent process, user context, and file metadata, a classification model can score and flag new processes that behave like malicious tools, enabling detection of zero-day or obfuscated threats.","Windows Event ID 4688; Sysmon Event ID 1; Endpoint workstations, Critical servers (e.g., Domain Controllers, file servers), Log aggregation servers",last 90 days,"SEARCH process_creation_events | EXTRACT features(parent_process, user, entropy) | SCORE with ML_model | FILTER score > high_probability_threshold",playbooks/attack/enterprise/T1562.006.yml
T1562.006: Indicator Blocking,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,4,Have any command-line arguments or PowerShell scripts been executed containing keywords or patterns associated with blocking indicators?,"This question focuses on detecting defense evasion attempts directly through command-line activity. Adversaries often use built-in utilities like 'wevtutil.exe', 'netsh', or PowerShell cmdlets to clear logs, disable security services, or alter firewall rules. Scanning for these specific patterns provides direct evidence of an attempt to tamper with security controls.","Windows Event ID 4688; Sysmon Event ID 1; Windows PowerShell Event ID 4104; Endpoint workstations, Servers with local administrative privileges, PowerShell execution environments",last 90 days,"SEARCH command_line_events OR powershell_script_blocks | REGEX for keywords ('wevtutil cl', 'Clear-EventLog', 'Set-EtwTraceProvider', 'sc stop Sysmon64', 'netsh advfirewall')",playbooks/attack/enterprise/T1562.006.yml
T1562.006: Indicator Blocking,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,5,"Has a common administrative process like powershell.exe or cmd.exe been executed with an unusually long or complex command line, suggesting obfuscation?","This question aims to detect obfuscated commands that might bypass simple keyword matching. By baselining the normal length and entropy of command-line arguments for legitimate processes and users, analysts can identify statistical outliers that may represent malicious, encoded, or unusually complex commands used for defense evasion.","Windows Event ID 4688; Sysmon Event ID 1; Windows PowerShell Event ID 4104; Endpoint workstations, Servers with local administrative privileges, PowerShell execution environments",last 90 days,SEARCH command_line_events | BASELINE entropy and length per user/process | ALERT on executions exceeding 99th percentile,playbooks/attack/enterprise/T1562.006.yml
T1562.006: Indicator Blocking,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,6,Can machine learning models identify command-line executions that are semantically similar to known malicious defense evasion techniques?,"This question uses advanced natural language processing to understand the intent behind a command, rather than just matching keywords. A model trained on the structure and semantics of commands can differentiate between a benign administrative action and a malicious one, even if they use similar utilities, by considering the full context of the command.","Windows Event ID 4688; Sysmon Event ID 1; Windows PowerShell Event ID 4104; Endpoint workstations, Servers with local administrative privileges, PowerShell execution environments",last 90 days,SEARCH command_line_events | ANALYZE with semantic_ML_model | FILTER for high probability of malicious_intent,playbooks/attack/enterprise/T1562.006.yml
T1562.006: Indicator Blocking,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,7,"Has a high-fidelity indicator blocking event occurred, such as the audit log being cleared or the Sysmon configuration being changed?","This question targets unambiguous and critical events that are strong indicators of compromise. Events like the security log being cleared (Event ID 1102) or a Sysmon configuration change (Event ID 16) have very few, if any, legitimate use cases and warrant immediate investigation as they signal a direct attempt to erase tracks or disable monitoring.","Sysmon Event ID 16; Windows Security Event ID 1102; Windows Firewall Event ID 4947; Windows Security Event ID 5152; All Windows endpoints and servers, Domain Controllers, Systems with host-based firewalls enabled, Network gateways",last 90 days,SEARCH for EventID 1102 OR EventID 16 | CREATE critical_alert,playbooks/attack/enterprise/T1562.006.yml
T1562.006: Indicator Blocking,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,8,"Has an anomalous firewall rule modification been made, such as a manual change by a non-admin user or a rule blocking telemetry to log collectors?","This question helps differentiate between legitimate firewall changes (e.g., via Group Policy) and malicious ones. By baselining normal modification activity, analysts can spot outliers, such as a rule added manually to block communication with SIEM collectors, which is a classic defense evasion tactic.","Sysmon Event ID 16; Windows Security Event ID 1102; Windows Firewall Event ID 4947; Windows Security Event ID 5152; All Windows endpoints and servers, Domain Controllers, Systems with host-based firewalls enabled, Network gateways",last 90 days,"SEARCH firewall_rule_modification_events | COMPARE with baseline | ALERT on statistical outliers (e.g., manual change, destination is log_collector)",playbooks/attack/enterprise/T1562.006.yml
T1562.006: Indicator Blocking,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,9,"Has an anomalous sequence of events occurred on a host, such as a suspicious login followed by a log clearing event and a drop in telemetry?","This question seeks to identify indicator blocking by analyzing the context of surrounding events. A single event might be ambiguous, but a sequence—like a remote login, followed by clearing the event log, and then a sudden silence from the host—provides strong, contextually-validated evidence of a malicious actor trying to cover their tracks.","Sysmon Event ID 16; Windows Security Event ID 1102; Windows Firewall Event ID 4947; Windows Security Event ID 5152; All Windows endpoints and servers, Domain Controllers, Systems with host-based firewalls enabled, Network gateways",last 90 days,"MODEL event sequences per host | SEARCH for anomalous sequences (e.g., login -> log_clear -> telemetry_drop)",playbooks/attack/enterprise/T1562.006.yml
T1562.006: Indicator Blocking,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,10,Has a host that is active on the network suddenly stopped sending logs to the central collector?,"This question addresses the complete cessation of logging from an endpoint, a strong sign that telemetry has been disabled or blocked. By correlating the absence of logs with network flow data showing the host is still active, analysts can confirm the issue is not a network outage or shutdown and escalate it as a potential defense evasion attempt.","Zeek conn.log; SIEM/Log Aggregator ingestion health logs; Network chokepoints (e.g., core switches, internet gateway), SIEM/Log Aggregator ingestion points, All log-generating endpoints and servers",last 90 days,"SEARCH for hosts with no logs in last 30min | QUERY network_flow_data for same host IP | IF network_traffic_exists, ALERT",playbooks/attack/enterprise/T1562.006.yml
T1562.006: Indicator Blocking,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,11,Has the log volume from a specific host dropped significantly below its expected baseline for a sustained period?,"This question helps detect more subtle forms of indicator blocking where logging isn't stopped entirely but is significantly reduced. By modeling the expected log volume for each host and source, this method can identify statistically significant drops that might indicate a service was stopped, a filter was applied, or specific logs are being suppressed.","Zeek conn.log; SIEM/Log Aggregator ingestion health logs; Network chokepoints (e.g., core switches, internet gateway), SIEM/Log Aggregator ingestion points, All log-generating endpoints and servers",last 90 days,MODEL log volume per host/source using time-series | ALERT if volume drops > 3 std deviations from mean,playbooks/attack/enterprise/T1562.006.yml
T1562.006: Indicator Blocking,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,12,"Has an advanced anomaly detection model identified a sudden, unexpected drop in log ingestion rates from a host, accounting for normal daily or weekly fluctuations?","This question employs sophisticated anomaly detection to improve the accuracy of 'silent host' detection. Unsupervised models can automatically learn the complex seasonal patterns of log ingestion for each host, allowing them to detect sudden drops with higher precision and fewer false positives compared to simple thresholding.","Zeek conn.log; SIEM/Log Aggregator ingestion health logs; Network chokepoints (e.g., core switches, internet gateway), SIEM/Log Aggregator ingestion points, All log-generating endpoints and servers",last 90 days,APPLY Isolation Forest or Seasonal-ESD model to log ingestion rates per host | ALERT on detected anomalies indicating a drop,playbooks/attack/enterprise/T1562.006.yml
T1562.006: Indicator Blocking,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,13,Has a discovery command (like 'tasklist') been executed shortly before a termination command (like 'taskkill') targeting a known security service on the same host?,"This question looks for a common adversary behavior pattern: discovering which security tools are running and then immediately attempting to disable them. Correlating these two actions within a short time window provides strong evidence of an active, hands-on-keyboard attempt to evade endpoint defenses.","Windows Event ID 4688; Sysmon Event ID 1; Endpoint workstations, Servers with interactive user logins, Privileged Access Workstations (PAWs)",last 90 days,CORRELATE process_events on same host/session | ALERT if 'tasklist' or 'sc query' is followed by 'taskkill' or 'sc stop' on a security service within 5 mins,playbooks/attack/enterprise/T1562.006.yml
T1562.006: Indicator Blocking,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,14,"Has a statistically rare sequence of commands, such as 'tasklist' followed by 'taskkill', been observed for a particular user or across the enterprise?","This question uses statistical analysis to find unusual command pairings that might indicate malicious activity. While an administrator might occasionally use 'tasklist' and 'taskkill', the sequence is often rare. Flagging these low-probability sequences, especially when the target is a security tool, helps uncover suspicious behavior that might otherwise be missed.","Windows Event ID 4688; Sysmon Event ID 1; Endpoint workstations, Servers with interactive user logins, Privileged Access Workstations (PAWs)",last 90 days,"ANALYZE command sequences using n-grams | CALCULATE conditional probability of ('tasklist', 'taskkill') | ALERT on rare sequences",playbooks/attack/enterprise/T1562.006.yml
T1562.006: Indicator Blocking,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,15,"Has a machine learning model detected an anomalous sequence of process creations for a user session, such as the 'discover-then-kill' pattern?","This question applies advanced sequence modeling to learn a user's normal command-line behavior. By training a model to recognize typical sequences of actions, it can flag any significant deviation, such as the unusual pattern of discovering and then killing a process. This provides a powerful way to detect novel or unexpected adversary techniques.","Windows Event ID 4688; Sysmon Event ID 1; Endpoint workstations, Servers with interactive user logins, Privileged Access Workstations (PAWs)",last 90 days,TRAIN LSTM autoencoder on process sequences per session | ALERT when reconstruction error for a new sequence is high,playbooks/attack/enterprise/T1562.006.yml
T1562.009: Safe Mode Boot,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,1,Has a process been executed whose file hash matches a known malicious tool used for safe mode boot configuration?,"This question aims to identify the initial execution of known malicious tools. By correlating process execution events with threat intelligence feeds, we can detect the presence of malware designed to manipulate the system's boot process to evade defenses. A match is a strong indicator of compromise.","Windows Event ID 4688; Threat Intelligence Feed; All Windows Endpoints, Critical Application Servers, Domain Controllers, Executive Workstations",last 90 days,"SEARCH Process_Creation_Events (e.g., WinEventID 4688) | CALCULATE file_hash | JOIN with Threat_Intelligence_Feed ON file_hash | WHERE match_found",playbooks/attack/enterprise/T1562.009.yml
T1562.009: Safe Mode Boot,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,2,"If a malicious process associated with safe mode boot was executed, was it spawned by an uncommon parent process?","Malicious processes are often spawned by legitimate applications (e.g., a Word document macro spawning a tool). This question helps prioritize alerts by identifying statistically rare parent-child process relationships. A common process like explorer.exe spawning bcdedit.exe might be normal, but winword.exe doing so is highly suspicious.","Windows Event ID 4688; All Windows Endpoints, Critical Application Servers, Domain Controllers, Executive Workstations",last 90 days,"SEARCH Process_Creation_Events with malicious_child_hash | GROUPBY parent_process, child_process | CALCULATE historical_prevalence | WHERE prevalence < 10th_percentile",playbooks/attack/enterprise/T1562.009.yml
T1562.009: Safe Mode Boot,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,3,Can we predict if a new process execution is part of a 'Safe Mode Boot' attack using a machine learning model?,"This leverages a supervised model trained on various features (process name, parent, command line, user, threat intel match) to provide a probabilistic score of maliciousness. It goes beyond simple rules to identify complex patterns indicative of an attack, even with previously unseen tools or variations.","Windows Event ID 4688; Threat Intelligence Feed; All Windows Endpoints, Critical Application Servers, Domain Controllers, Executive Workstations",last 90 days,"STREAM Process_Creation_Events | ENRICH with features (parent_process, command_line_args, user_context, threat_intel_match) | APPLY classification_model | WHERE prediction == 'Safe Mode Boot Attack'",playbooks/attack/enterprise/T1562.009.yml
T1562.009: Safe Mode Boot,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,4,Has a boot configuration utility like 'bcdedit.exe' been executed with command-line arguments to enable safe mode?,This is a direct method adversaries use to configure the system for a safe mode boot. Monitoring for the specific execution of 'bcdedit.exe' or 'bootcfg.exe' with the 'safeboot' argument provides a high-fidelity indicator of this technique.,"Windows Event ID 4688; All Windows Endpoints, Domain Controllers, Infrastructure Servers",last 90 days,"SEARCH Process_Creation_Events (e.g., WinEventID 4688) | WHERE process_name IN ('bcdedit.exe', 'bootcfg.exe') AND command_line CONTAINS 'safeboot'",playbooks/attack/enterprise/T1562.009.yml
T1562.009: Safe Mode Boot,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,5,"Has there been an anomalous spike in 'bcdedit.exe' executions for a specific user or host, or has it been used with rare command-line arguments?","While 'bcdedit.exe' can be used for legitimate administration, its frequent or unusual use can indicate malicious activity. This question establishes a baseline of normal usage and flags deviations, such as a user who never uses the tool suddenly executing it multiple times, or the use of an argument combination never seen before in the environment.","Windows Event ID 4688; All Windows Endpoints, Domain Controllers, Infrastructure Servers",last 90 days,"SEARCH Process_Creation_Events for 'bcdedit.exe' | BASELINE execution_count per user, per host over 30 days | ALERT if current_day_count > 99th_percentile | ANALYZE command_line_prevalence | FLAG if args_prevalence < 5th_percentile",playbooks/attack/enterprise/T1562.009.yml
T1562.009: Safe Mode Boot,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,6,"Does a recent execution of 'bcdedit.exe' appear anomalous when compared to historical, legitimate administrative activity?","This uses an unsupervised anomaly detection model to distinguish between normal and suspicious 'bcdedit.exe' usage. By modeling features like command-line properties, parent process, and user context, it can identify outliers that don't fit the pattern of typical administrative tasks, even if the command doesn't explicitly contain 'safeboot'.","Windows Event ID 4688; All Windows Endpoints, Domain Controllers, Infrastructure Servers",last 90 days,"STREAM 'bcdedit.exe' executions | EXTRACT features (cmdline_length, arg_count, parent_process, user_type, time_of_day) | APPLY anomaly_detection_model | ALERT on high_anomaly_score",playbooks/attack/enterprise/T1562.009.yml
T1562.009: Safe Mode Boot,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,7,Has the Windows Registry been modified to add a new service/driver to the SafeBoot configuration or to add a program to run in safe mode?,"Adversaries can achieve persistence in safe mode by directly manipulating the registry. This question targets specific, high-fidelity modifications, such as adding entries to 'HKLM\...\Control\SafeBoot\' or creating a 'Run' key value prefixed with an asterisk, which forces execution in safe mode.","Windows Event ID 4657; All Windows Endpoints, Critical Application Servers, Domain Controllers",last 90 days,"SEARCH Registry_Modification_Events (e.g., WinEventID 4657) | WHERE object_name CONTAINS '\Control\SafeBoot\' OR (object_name CONTAINS '\Run' AND value_name STARTSWITH '*')",playbooks/attack/enterprise/T1562.009.yml
T1562.009: Safe Mode Boot,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,8,Was a 'SafeBoot' registry key modified by a process that does not typically perform such actions?,"System updates and software installations might legitimately modify these keys. This question helps reduce false positives by creating an allowlist of known-good processes (like 'TrustedInstaller.exe'). Any modification by a process not on this list is considered suspicious, especially if that process has rarely or never modified the registry before.","Windows Event ID 4657; All Windows Endpoints, Critical Application Servers, Domain Controllers",last 90 days,SEARCH 'SafeBoot'_Registry_Modifications | FILTER process_name NOT IN allowlist | CALCULATE historical_modification_frequency for process_name | FLAG if frequency is novel or > 3_std_dev_from_baseline,playbooks/attack/enterprise/T1562.009.yml
T1562.009: Safe Mode Boot,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,9,Can a machine learning model classify a registry modification to 'SafeBoot' keys as benign or malicious?,"This question applies a supervised model to differentiate between legitimate system changes and malicious tampering. By analyzing features like the modifying process and its lineage, the model can learn the nuances of benign activity and more accurately identify malicious modifications, reducing analyst fatigue from false positives.","Windows Event ID 4657; All Windows Endpoints, Critical Application Servers, Domain Controllers",last 90 days,"STREAM 'SafeBoot'_Registry_Modifications | EXTRACT features (process_name, parent_process, user_context, data_written) | APPLY classification_model | ALERT if prediction == 'Malicious'",playbooks/attack/enterprise/T1562.009.yml
T1562.009: Safe Mode Boot,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,10,"After a system boot, in a state where security tools appear disabled, are there any suspicious process executions or network connections?","A key goal of booting into safe mode is to disable security software. This question looks for the combination of a system reboot followed by the absence of expected security agent activity. In this degraded state, the presence of scripting engines or connections to low-reputation IPs is highly indicative of malicious activity.","Windows Event ID 6009; Windows Event ID 4624; Windows Event ID 4688; Zeek conn.log; All Windows Endpoints, Network Egress Points, Authentication Servers",last 90 days,"DETECT boot_event (WinEventID 6009) | CHECK for absence of security_agent_starts | IF absent, MONITOR for subsequent execution of ('powershell.exe', 'cscript.exe') OR network_connection to low_reputation_IP",playbooks/attack/enterprise/T1562.009.yml
T1562.009: Safe Mode Boot,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,11,Does the process or network activity immediately following a system boot deviate statistically from that host's normal boot behavior?,Every host has a typical 'boot profile' of processes and network activity. This question establishes a baseline for the first 15 minutes after a boot. A sudden increase in the number of unique processes or a significant change in the variety of outbound network ports can indicate that a malicious payload is executing post-reboot.,"Windows Event ID 6009; Windows Event ID 4688; Zeek conn.log; All Windows Endpoints, Network Egress Points, Authentication Servers",last 90 days,"FOR each host, BASELINE post-boot (first 15min) unique_process_count and destination_port_entropy | AFTER new boot_event, CALCULATE metrics | ALERT if metrics > 95th_percentile_of_baseline",playbooks/attack/enterprise/T1562.009.yml
T1562.009: Safe Mode Boot,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,12,Does the time-series data signature of a system's boot sequence match the pattern of a known malicious boot?,"This uses a sophisticated time-series model (LSTM Autoencoder) to learn the complex, multi-variate signature of a normal boot sequence (CPU, network, process creation rate, etc.). A high reconstruction error from the model indicates that the current boot sequence is a significant outlier from all previously observed normal boots, suggesting a deep system compromise.","Windows Event ID 6009; Windows Event ID 4688; Zeek conn.log; All Windows Endpoints, Network Egress Points, Authentication Servers",last 90 days,"STREAM post-boot time-series_data (process_rate, network_io, cpu_usage) | APPLY LSTM_autoencoder_model | ALERT on high_reconstruction_error",playbooks/attack/enterprise/T1562.009.yml
T1562.009: Safe Mode Boot,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,13,Has a boot configuration modification been followed by a system reboot on the same host within a short time frame?,This question chains together the preparatory action (modifying boot config) with the execution action (rebooting). Observing this specific sequence (`bcdedit` or registry write -> reboot) on a single host within 30 minutes is a very high-fidelity indicator of a Safe Mode Boot attack in progress.,"Windows Event ID 4688; Windows Event ID 4657; Windows Event ID 1074; All Windows Endpoints and Servers, Domain Controllers",last 90 days,CORRELATE on host over 30min: (Event A: 'bcdedit /set safeboot' OR 'SafeBoot' registry_write) FOLLOWED BY (Event B: user-initiated_reboot) | GENERATE high-fidelity_alert,playbooks/attack/enterprise/T1562.009.yml
T1562.009: Safe Mode Boot,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,14,Can we create a cumulative risk score for a sequence of events related to a potential safe mode boot?,"This moves beyond a single trigger to a multi-stage risk assessment. It assigns points for each suspicious event in a chain: an initial `bcdedit` command, extra points if the parent process is rare, and more points if the subsequent reboot is followed by anomalous network traffic. An alert is only fired if the total risk score crosses a threshold, reducing noise from isolated, low-risk events.","Windows Event ID 4688; Windows Event ID 4657; Windows Event ID 1074; Zeek conn.log; All Windows Endpoints and Servers, Domain Controllers",last 90 days,"DEFINE risk_score_model | ON trigger_event (e.g., 'bcdedit'), assign base_score | ADD points for rare_parent_process | ADD points for post-reboot_network_anomaly | ALERT if cumulative_score > threshold",playbooks/attack/enterprise/T1562.009.yml
T1562.009: Safe Mode Boot,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,15,Does a sequence of events on a host match the state transitions of a Hidden Markov Model trained to detect the full Safe Mode Boot attack pattern?,"This question applies sequence analysis to model the entire attack lifecycle. The HMM learns the probable transitions between states (e.g., from 'Benign' to 'Defense Evasion Setup' to 'Reboot'). It can then calculate the probability that a new, incoming sequence of events from a host matches this malicious pattern, providing a sophisticated, context-aware detection method.","Windows Event ID 4688; Windows Event ID 4657; Windows Event ID 1074; All Windows Endpoints and Servers, Domain Controllers",last 90 days,STREAM host_event_sequences | APPLY Hidden_Markov_Model | CALCULATE probability of matching 'malicious' state_transition_path | ALERT if probability > threshold,playbooks/attack/enterprise/T1562.009.yml
T1562: Impair Defenses,f4a4b4e4-7b7c-4a3d-8b0a-1b1e2e3d4f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,1,Are there any process creation events that match known defense impairment tools or malware?,"This question aims to detect the use of well-known defense evasion tools by matching their file hashes against a curated threat intelligence feed. A match for tools like PCHunter, GMER, or other known malware provides a high-confidence indicator that an adversary is attempting to disable or bypass security controls on an endpoint. This is a foundational, high-fidelity detection method.
","Windows Event ID 4688; Domain Controllers; Critical Application Servers; User Endpoints; Security Infrastructure Servers (e.g., EDR/SIEM management consoles)",last 90 days,": SEARCH process_creation_events (e.g., EventID 4688)
JOIN with threat_intel_feed on file_hash
WHERE threat_intel_feed.category = 'defense_impairment_tool'
ALERT on any match
",playbooks/attack/enterprise/T1562.yml
T1562: Impair Defenses,f4a4b4e4-7b7c-4a3d-8b0a-1b1e2e3d4f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,2,"Have any new, rare executables been observed with a high execution count on a single host?","This question seeks to identify custom or unknown defense impairment tools not present in threat intelligence feeds. The rationale is that a targeted attack may use a tool that is unique to the victim's environment. By calculating the prevalence of every new executable, we can flag those that are extremely rare across the enterprise but are executed frequently on a single machine, suggesting a specialized tool deployed for a specific purpose.
","Windows Event ID 4688; Domain Controllers; Critical Application Servers; User Endpoints; Security Infrastructure Servers (e.g., EDR/SIEM management consoles)",last 90 days,": FOR each new_file_hash in process_creation_events:
  CALCULATE prevalence = (count(distinct hosts with hash) / count(all hosts)) * 100
  IF prevalence < 0.1% AND count(executions on single host) > threshold:
    ALERT as rare_high_frequency_executable
",playbooks/attack/enterprise/T1562.yml
T1562: Impair Defenses,f4a4b4e4-7b7c-4a3d-8b0a-1b1e2e3d4f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,3,Have any previously unseen executables been classified as malicious by a machine learning model?,"This question leverages machine learning to proactively identify novel threats. Instead of relying on known-bad signatures, a classifier analyzes an executable's static features (like its structure, imported functions, and entropy) to predict its likelihood of being malicious. This is crucial for detecting zero-day malware or custom tools designed to impair defenses, as it focuses on the intrinsic characteristics of the file itself.
","Windows Event ID 4688; Domain Controllers; Critical Application Servers; User Endpoints; Security Infrastructure Servers (e.g., EDR/SIEM management consoles)",last 90 days,": FOR each new_executable_file:
  EXTRACT static_features
  SCORE file with ML_classifier_model
  IF score > malicious_threshold AND executed_by_non_system_account:
    ALERT for investigation
",playbooks/attack/enterprise/T1562.yml
T1562: Impair Defenses,f4a4b4e4-7b7c-4a3d-8b0a-1b1e2e3d4f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,4,Are there any process creation events with command-line arguments matching known defense evasion commands?,"This question aims to detect adversaries using legitimate system utilities for malicious purposes (i.e., Living-off-the-Land). By monitoring command-line arguments in process creation events for specific patterns (e.g., using `sc.exe` to disable a service, `netsh.exe` to alter firewall rules, `auditpol.exe` to clear audit policies), analysts can catch direct attempts to weaken a system's security posture.
",Windows Event ID 4688; Windows Event ID 4657; Windows Event ID 7036; Domain Controllers; User Endpoints; Application Servers; Windows-based Firewalls,last 90 days,": SEARCH process_creation_events (e.g., EventID 4688)
WHERE command_line MATCHES REGEX ('sc.*config.*start= disabled', 'taskkill.*im.*<av_process>', 'netsh.*advfirewall.*set', 'auditpol.*clear')
ALERT on any match
",playbooks/attack/enterprise/T1562.yml
T1562: Impair Defenses,f4a4b4e4-7b7c-4a3d-8b0a-1b1e2e3d4f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,5,Has any user or host shown an abnormal frequency or complexity of commands related to system configuration utilities?,"This question seeks to identify anomalous usage of powerful system utilities like `sc.exe`, `netsh.exe`, and `auditpol.exe`. The rationale is that legitimate administrators have a relatively stable pattern of use. A sudden spike in the frequency of these commands for a specific user, or the use of unusually complex and obfuscated command strings (detectable via high entropy), can indicate that an adversary has compromised an account and is using it to disable defenses.
",Windows Event ID 4688; Windows Event ID 4657; Windows Event ID 7036; Domain Controllers; User Endpoints; Application Servers; Windows-based Firewalls,last 90 days,": FOR each user, host:
  BASELINE normal frequency and command_line entropy for utilities like 'sc.exe', 'netsh.exe'
  MONITOR real-time usage
  IF current_frequency > (mean + 3 * stdev) OR current_entropy > baseline_entropy_threshold:
    ALERT for anomalous utility usage
",playbooks/attack/enterprise/T1562.yml
T1562: Impair Defenses,f4a4b4e4-7b7c-4a3d-8b0a-1b1e2e3d4f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,6,Have any command-line arguments been classified as malicious by a sequence-based machine learning model?,"This question uses advanced machine learning to understand the syntax and structure of command-line arguments, allowing it to distinguish between benign and malicious usage. Unlike simple regex, a sequence-based model (like an LSTM) can detect novel or obfuscated commands that are functionally malicious but syntactically different from known patterns. This is valuable for catching sophisticated adversaries who customize their evasion techniques.
",Windows Event ID 4688; Windows Event ID 4657; Windows Event ID 7036; Domain Controllers; User Endpoints; Application Servers; Windows-based Firewalls,last 90 days,": FOR each command_line in process_creation_events:
  CLASSIFY command_line with sequence_model
  IF classification_score > malicious_threshold:
    ALERT for malicious command-line
",playbooks/attack/enterprise/T1562.yml
T1562: Impair Defenses,f4a4b4e4-7b7c-4a3d-8b0a-1b1e2e3d4f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,7,Have there been any high-fidelity events indicating that event logs have been cleared?,"This question focuses on detecting one of the most blatant forms of anti-forensics: clearing event logs. The action is almost always malicious and is a strong indicator of an adversary attempting to cover their tracks. This is achieved by creating non-suppressible, high-priority alerts for specific indicators like Windows Event ID 1102, or the execution of `wevtutil.exe cl` or PowerShell's `Clear-EventLog`.
","Windows Event ID 4688; Windows Event ID 1102; Windows PowerShell Operational Event ID 4104; All Windows Hosts, especially Domain Controllers and critical servers where logs are paramount.",last 90 days,": SEARCH for (EventID = 1102) OR (process_name = 'wevtutil.exe' AND command_line CONTAINS 'cl') OR (powershell_log CONTAINS 'Clear-EventLog')
CREATE high-priority alert
",playbooks/attack/enterprise/T1562.yml
T1562: Impair Defenses,f4a4b4e4-7b7c-4a3d-8b0a-1b1e2e3d4f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,8,Has a log clearing action been performed by a user or on a host where such an action is historically rare?,"This question adds crucial context to a log clearing event. While any such event is suspicious, its significance increases dramatically if performed by an entity that does not normally perform this action. By analyzing the historical rarity of log clearing for a specific user or host, we can prioritize investigations, focusing on events that represent a true deviation from normal administrative behavior.
","Windows Event ID 4688; Windows Event ID 1102; Windows PowerShell Operational Event ID 4104; All Windows Hosts, especially Domain Controllers and critical servers where logs are paramount.",last 90 days,": ON log_clear_event:
  CALCULATE historical frequency of this action for the user and host
  IF frequency is zero or extremely low:
    INCREASE alert severity and priority
",playbooks/attack/enterprise/T1562.yml
T1562: Impair Defenses,f4a4b4e4-7b7c-4a3d-8b0a-1b1e2e3d4f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,9,Did a log clearing event occur as part of a broader chain of suspicious activities on a host?,"This question moves beyond single events to analyze behavioral chains. A log clearing event in isolation is suspicious, but one that follows a file download from the internet, execution from a temporary directory, and establishing persistence is a near-certain indicator of a successful compromise. By using a model to score event sequences, we can assign the highest risk to chains that culminate in an adversary covering their tracks.
","Windows Event ID 4688; Windows Event ID 1102; Windows PowerShell Operational Event ID 4104; All Windows Hosts, especially Domain Controllers and critical servers where logs are paramount.",last 90 days,": MODEL event sequences on each host
IF sequence [Suspicious_Download -> Process_Create -> Log_Clear] occurs within short time_window:
  ASSIGN highest risk score and ALERT
",playbooks/attack/enterprise/T1562.yml
T1562: Impair Defenses,f4a4b4e4-7b7c-4a3d-8b0a-1b1e2e3d4f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,10,Has any critical host or log source stopped sending logs for a defined time interval without a scheduled maintenance event?,"This question aims to detect 'silent hosts'—systems that have stopped logging unexpectedly. This is achieved with a simple 'heartbeat' rule in the SIEM that expects logs from every critical asset within a set interval (e.g., 15 minutes). If logs cease and there is no corresponding maintenance ticket, it generates a critical alert, as this could indicate that a logging agent has been terminated or the host is otherwise compromised.
",Zeek conn.log; Windows Event ID 7036; Windows Event ID 4688; Log Aggregation/SIEM Infrastructure; Network Egress Points; All log-generating hosts,last 90 days,": FOR each critical_log_source:
  SCHEDULE check every 15 minutes
  IF last_log_timestamp < (now - 15 minutes) AND no_maintenance_ticket_exists:
    ALERT for 'Silent Host'
",playbooks/attack/enterprise/T1562.yml
T1562: Impair Defenses,f4a4b4e4-7b7c-4a3d-8b0a-1b1e2e3d4f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,11,Has the log volume from any source dropped below a statistically significant threshold compared to its historical baseline?,"This question looks for more subtle forms of log tampering. Instead of logs stopping completely, an adversary might misconfigure a service to reduce its logging level. By creating a time series model of expected log volume (accounting for time-of-day cycles), we can detect when the actual volume drops to a statistically significant low (e.g., below the 5th percentile) for a sustained period, indicating a potential issue.
",Zeek conn.log; Windows Event ID 7036; Windows Event ID 4688; Log Aggregation/SIEM Infrastructure; Network Egress Points; All log-generating hosts,last 90 days,": FOR each log_source:
  CREATE time_series_baseline of log_volume
  IF current_log_volume < 5th_percentile_of_baseline for >10 minutes:
    ALERT for anomalous log volume drop
",playbooks/attack/enterprise/T1562.yml
T1562: Impair Defenses,f4a4b4e4-7b7c-4a3d-8b0a-1b1e2e3d4f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,12,"Has a time series forecasting model predicted a significant, unexplained drop in log volume from a host that is still active on the network?","This question combines time series forecasting with network data for high-fidelity detection. A model (like ARIMA) predicts the expected log volume for the next interval. If the actual volume is significantly lower, an anomaly is flagged. This is then correlated with network flow data (e.g., from Zeek) to confirm the host is still communicating. A host that is active on the network but not logging as predicted is a high-confidence indicator of defense impairment.
",Zeek conn.log; Windows Event ID 7036; Windows Event ID 4688; Log Aggregation/SIEM Infrastructure; Network Egress Points; All log-generating hosts,last 90 days,": FOR each log_source:
  PREDICT expected_log_volume with forecasting_model
  CALCULATE anomaly_score = |actual_volume - predicted_volume|
  IF anomaly_score > threshold:
    CHECK network_logs for recent host_activity
    IF host is active:
      ALERT for silent but active host
",playbooks/attack/enterprise/T1562.yml
T1562: Impair Defenses,f4a4b4e4-7b7c-4a3d-8b0a-1b1e2e3d4f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,13,Has a suspicious process creation been followed by a defense impairment action on the same host within a short time window?,"This question uses stateful correlation to link a suspicious initial action to a subsequent defense impairment. The rule looks for a specific, timed sequence: a process being created from a non-standard location (e.g., %TEMP%), immediately followed by an event like a security service stopping or logs being cleared. This directly connects a likely malicious payload to the act of disabling defenses on the compromised host.
",Windows Event ID 4688; Windows Event ID 7036; Windows Event ID 1102; Windows Event ID 4657; User Endpoints; Servers; Domain Controllers,last 90 days,": CREATE correlation_rule
TRIGGER on process_creation (EventID 4688) from low-reputation_path
WITHIN 5 minutes on same host, LOOK FOR (service_stop OR log_clear OR security_registry_modify)
IF sequence found, ALERT
",playbooks/attack/enterprise/T1562.yml
T1562: Impair Defenses,f4a4b4e4-7b7c-4a3d-8b0a-1b1e2e3d4f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,14,"Has the conditional probability of a defense impairment event, given a preceding suspicious process, significantly increased?","This question uses statistical analysis to find new attack patterns. It continuously calculates the conditional probability of a defense impairment event (like a service stop) occurring right after a specific process is created (e.g., `P(ServiceStop | Parent=wscript.exe)`). If this probability for a certain pair of events suddenly spikes far above the organizational baseline, it suggests that a normally benign process is now being weaponized as part of an attack chain.
",Windows Event ID 4688; Windows Event ID 7036; Windows Event ID 1102; Windows Event ID 4657; User Endpoints; Servers; Domain Controllers,last 90 days,": CALCULATE global baseline of P(ImpairmentEvent | PrecedingProcess)
FOR each host, continuously calculate this probability
IF host_probability >> global_baseline:
  ALERT on statistical anomaly in event chaining
",playbooks/attack/enterprise/T1562.yml
T1562: Impair Defenses,f4a4b4e4-7b7c-4a3d-8b0a-1b1e2e3d4f5a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,15,Has a sequence-aware machine learning model detected an anomalous chain of system events indicative of defense impairment?,"This question applies machine learning to detect anomalous sequences of behavior. A model like a Hidden Markov Model (HMM) is trained on vast amounts of event data to learn what ""normal"" sequences of system activity look like. When a live event stream from a host shows a low-probability sequence (e.g., download -> execute from temp -> stop AV service), the model flags it as a high-confidence anomaly because it deviates significantly from learned normal behavior.
",Windows Event ID 4688; Windows Event ID 7036; Windows Event ID 1102; Windows Event ID 4657; User Endpoints; Servers; Domain Controllers,last 90 days,": TRAIN HMM model on normal event sequences
FOR each host's real-time event stream:
  CALCULATE probability of observed sequence
  IF probability < anomaly_threshold:
    ALERT for anomalous behavioral chain",playbooks/attack/enterprise/T1562.yml
T1564.003: Hidden Window,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,1,Are there process creation events where the executable's hash matches a known malicious hash associated with hidden window techniques?,"This question aims to identify known threats at the point of execution. By cross-referencing file hashes from process creation events against a curated threat intelligence feed of malware known to use T1564.003, analysts can detect specific, identified malware families attempting to operate stealthily.","Windows Event ID 4688; All managed Windows endpoints, including user workstations, Virtual Desktop Infrastructure (VDI) instances, and application servers.",last 90 days,": SEARCH process_creation_events | JOIN file_hash with threat_intel_hashes | WHERE technique = 'T1564.003' | RETURN hostname, process_name, file_hash",playbooks/attack/enterprise/T1564.003.yml
T1564.003: Hidden Window,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,2,Have any executables with a low enterprise-wide prevalence been executed recently?,"This question helps uncover novel or targeted malware that is not yet in threat intelligence feeds. Since legitimate software is typically widespread, an executable appearing on only a handful of systems is anomalous and suspicious. This is a powerful hunting technique to find previously unknown threats, especially when combined with checks for valid digital signatures.","Windows Event ID 4688; All managed Windows endpoints, including user workstations, Virtual Desktop Infrastructure (VDI) instances, and application servers.",last 30 days,": SEARCH process_creation_events in last 30d | STATS distinct_count(hostname) as prevalence by file_hash | WHERE prevalence < 5 | RETURN file_hash, prevalence",playbooks/attack/enterprise/T1564.003.yml
T1564.003: Hidden Window,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,3,Has a machine learning model identified any newly executed files as having a high probability of being malicious based on their static features?,"This question leverages machine learning to detect malicious files based on their intrinsic properties, rather than relying on signatures or prevalence. By analyzing features like file structure, entropy, and imported functions, this approach can identify packed, obfuscated, or entirely new malware designed to evade traditional detection methods.","Windows Event ID 4688; All managed Windows endpoints, including user workstations, Virtual Desktop Infrastructure (VDI) instances, and application servers.",last 90 days,": SEARCH file_classification_alerts | WHERE model_score > 0.9 AND technique_prediction = 'T1564.003' | RETURN hostname, file_path, model_score",playbooks/attack/enterprise/T1564.003.yml
T1564.003: Hidden Window,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,4,Have any processes been launched with command-line arguments that explicitly hide the application window?,This question directly targets the technique's implementation. Adversaries often use built-in scripting capabilities (like PowerShell's `-WindowStyle Hidden` or CScript's `//B` batch mode) to run malicious code without a visible window. Searching for these specific command-line patterns is a high-fidelity way to detect this activity.,"Windows Event ID 4688; Windows PowerShell Event ID 4104; All Windows endpoints and servers with enabled scripting engines (e.g., PowerShell, WScript, CScript), particularly administrative workstations and jump boxes.",last 90 days,": SEARCH process_creation_events OR powershell_script_block_logs | REGEX command_line contains '(-WindowStyle Hidden|//B)' | RETURN hostname, process_name, command_line",playbooks/attack/enterprise/T1564.003.yml
T1564.003: Hidden Window,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,5,Have any scripting processes been executed with command lines that are anomalously long or complex?,"This question seeks to identify obfuscated or complex commands indicative of malicious activity. Adversaries often embed entire scripts or encoded payloads into the command line, resulting in unusually high length and entropy compared to benign administrative commands. Baselining normal activity and alerting on statistical outliers can uncover these hidden payloads.","Windows Event ID 4688; Windows PowerShell Event ID 4104; All Windows endpoints and servers with enabled scripting engines (e.g., PowerShell, WScript, CScript), particularly administrative workstations and jump boxes.",last 90 days,": SEARCH process_creation_events WHERE process_name IN ('powershell.exe', 'cmd.exe', 'cscript.exe') | COMPARE command_line_length, command_line_entropy against historical_baseline | WHERE deviation > 99th_percentile | RETURN hostname, process_name, command_line",playbooks/attack/enterprise/T1564.003.yml
T1564.003: Hidden Window,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,6,Has a machine learning model classified any command lines as malicious with high confidence?,"This question applies machine learning to command-line analysis to detect malicious intent. By training a model on features that distinguish benign commands from malicious ones (like those used in fileless malware), it can identify suspicious command lines in real-time, even if they use novel obfuscation techniques not caught by simple regex.","Windows Event ID 4688; Windows PowerShell Event ID 4104; All Windows endpoints and servers with enabled scripting engines (e.g., PowerShell, WScript, CScript), particularly administrative workstations and jump boxes.",last 90 days,": SEARCH command_line_analysis_alerts | WHERE model_score > 0.95 AND is_malicious = true | RETURN hostname, process_name, command_line, model_score",playbooks/attack/enterprise/T1564.003.yml
T1564.003: Hidden Window,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,7,Has a typically non-interactive system process (like svchost.exe) spawned a process that is normally launched by a user (like chrome.exe)?,"This question looks for anomalous parent-child process relationships. Legitimate user applications are almost always spawned by `explorer.exe`. When a system service or other non-interactive process spawns a user application, it is a strong indicator of privilege escalation or a stealth technique where malware injects into a system process to launch its components.","Windows Event ID 4688; Zeek conn.log; User workstations, application servers, and network egress points instrumented with Zeek sensors.",last 90 days,": SEARCH process_creation_events | WHERE parent_process IN (non_interactive_list) AND child_process IN (interactive_list) | RETURN hostname, parent_process, child_process",playbooks/attack/enterprise/T1564.003.yml
T1564.003: Hidden Window,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,8,"Have any rare or new parent-child process relationships been observed across the enterprise, especially if the child process makes external network connections?","This question uses statistical rarity to find suspicious process execution chains. Most process relationships in an enterprise are common and repetitive. A new or extremely rare parent-child pair is inherently suspicious. Enriching this finding with network connection data helps prioritize investigation on anomalous process chains that are also communicating externally, a common pattern for malware.","Windows Event ID 4688; Zeek conn.log; User workstations, application servers, and network egress points instrumented with Zeek sensors.",last 30 days,": SEARCH parent_child_pairs in last 30d | STATS count by parent_process, child_process | WHERE count < 5 | JOIN child_process_pid with network_logs on pid within 60s | RETURN hostname, parent_process, child_process, destination_ip",playbooks/attack/enterprise/T1564.003.yml
T1564.003: Hidden Window,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,9,Has graph-based anomaly detection identified any process execution chains that are structurally different from the established baseline of normal activity?,"This question employs advanced graph analytics to model and detect abnormal process behavior. Instead of looking at individual parent-child pairs, this method analyzes entire execution chains. It can detect complex adversary behaviors like multi-stage process injection or living-off-the-land techniques that create structurally unusual process trees, which would be missed by simpler rule-based logic.","Windows Event ID 4688; Zeek conn.log; User workstations, application servers, and network egress points instrumented with Zeek sensors.",last 90 days,": SEARCH graph_anomaly_alerts | WHERE anomaly_score > threshold AND has_network_connection = true | RETURN hostname, anomalous_process_chain, anomaly_score",playbooks/attack/enterprise/T1564.003.yml
T1564.003: Hidden Window,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,10,Has a second `explorer.exe` process been launched in a user session without a corresponding new interactive logon event?,"This question targets a specific technique for creating a hidden desktop. Each interactive user session should have only one `explorer.exe` process. The appearance of a second one, not associated with a new RDP or console logon, strongly suggests an adversary has created a separate, hidden desktop environment within the existing session to conceal their activities and GUI tools from the legitimate user.","Windows Event ID 4688; Windows Event ID 4624; User Workstations, Remote Desktop Session Hosts, Virtual Desktop Infrastructure (VDI) servers.",last 90 days,": TRACK explorer_process_count by user_session_id | ALERT when count becomes 2 | EXCLUDE if recent (1m) logon_event (type 2 or 10) for same user_session_id | RETURN hostname, user, session_id",playbooks/attack/enterprise/T1564.003.yml
T1564.003: Hidden Window,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,11,Has the number of running `explorer.exe` processes on a single host deviated significantly from its historical average?,"This question provides a statistical approach to detecting an anomalous number of `explorer.exe` processes. While most workstations will have a stable count (usually 0 or 1), a sudden spike can indicate malicious activity like hidden desktop creation. This method is useful for identifying outliers without needing to track individual session IDs, though it should exclude multi-user systems like terminal servers where multiple `explorer.exe` instances are normal.","Windows Event ID 4688; Windows Event ID 4624; User Workstations, Remote Desktop Session Hosts, Virtual Desktop Infrastructure (VDI) servers.",last 90 days,": SEARCH process_counts for 'explorer.exe' per host | COMPARE current_count to moving_average and std_dev | WHERE current_count > (mean + 3*std_dev) AND host NOT IN (terminal_server_list) | RETURN hostname, current_count",playbooks/attack/enterprise/T1564.003.yml
T1564.003: Hidden Window,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,12,Have any running `explorer.exe` processes been identified as anomalous outliers by a clustering algorithm?,"This question uses unsupervised machine learning to find `explorer.exe` processes that don't fit the normal pattern. Legitimate instances share common features (parent is `userinit.exe`, empty command line, etc.) and will form a dense cluster. A malicious instance, perhaps with a different parent or command-line arguments, will be flagged as a 'noise point' by the algorithm, effectively isolating it for investigation.","Windows Event ID 4688; Windows Event ID 4624; User Workstations, Remote Desktop Session Hosts, Virtual Desktop Infrastructure (VDI) servers.",last 90 days,": RUN DBSCAN on running_explorer_processes with features (parent, session_id, command_line) | IDENTIFY noise_points | RETURN hostname, process_id, parent_process of noise_points",playbooks/attack/enterprise/T1564.003.yml
T1564.003: Hidden Window,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,13,Has the `explorer.exe` process been observed making network connections to a known command-and-control (C2) server?,This question seeks high-confidence indicators of compromise. The `explorer.exe` process should never make direct external network connections. A connection from `explorer.exe` to an IP or domain on a C2 threat intelligence list is a strong signal that the process has been compromised or hijacked for malicious communication.,"Sysmon Event ID 3; Zeek conn.log; All Windows endpoints with Sysmon installed, and network egress points instrumented with Zeek sensors.",last 90 days,": SEARCH network_connections WHERE process_name = 'explorer.exe' | JOIN destination_ip with threat_intel_c2_list | RETURN hostname, destination_ip, destination_port",playbooks/attack/enterprise/T1564.003.yml
T1564.003: Hidden Window,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,14,Has the `explorer.exe` process exhibited periodic network beaconing behavior to an external destination?,"This question aims to detect C2 communication by its behavior rather than by signature. Malware often 'beacons' out to its C2 server at regular intervals. By analyzing the timing between connections from `explorer.exe` to a single destination, we can identify this machine-like periodicity. A very low standard deviation in the time between connections is a classic indicator of automated C2 beaconing.","Sysmon Event ID 3; Zeek conn.log; All Windows endpoints with Sysmon installed, and network egress points instrumented with Zeek sensors.",last 90 days,": SEARCH network_connections WHERE process_name = 'explorer.exe' | GROUP by hostname, destination_ip | CALCULATE std_dev of time_between_connections | WHERE connection_count > 10 AND std_dev < 5s | RETURN hostname, destination_ip, std_dev",playbooks/attack/enterprise/T1564.003.yml
T1564.003: Hidden Window,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,15,Has a machine learning model detected any anomalous network connections originating from `explorer.exe`?,"This question uses anomaly detection to identify any network activity from `explorer.exe`, which is itself an anomaly. Since `explorer.exe` should have little to no legitimate network traffic, a one-class model can be trained on this 'normal' state of no activity. Any new network connection will be flagged as a significant deviation from the baseline, providing a powerful method for detecting process injection or hijacking.","Sysmon Event ID 3; Zeek conn.log; All Windows endpoints with Sysmon installed, and network egress points instrumented with Zeek sensors.",last 90 days,": SEARCH network_connection_anomaly_alerts WHERE process_name = 'explorer.exe' | RETURN hostname, destination_ip, destination_port, anomaly_score",playbooks/attack/enterprise/T1564.003.yml
T1564.005: Hidden File System,d8c4b1a0-6b7c-4d5e-9f3a-2e1c9b8d7a6f,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,1,"Is a known hidden file system creation utility being transferred over the network, identified by its hash, name, or metadata?","This question aims to detect the acquisition of tools used for creating hidden file systems. The approach involves creating and maintaining a watchlist of file hashes, names, and embedded metadata for known utilities. By querying network file transfer logs (e.g., Zeek files.log), an alert can be generated when a downloaded file matches an entry on the watchlist. Correlating these alerts with connection logs helps identify the source and destination of the transfer.",Zeek files.log; Zeek conn.log; Zeek http.log; Internet gateways and network egress points,last 90 days,SEARCH network_file_logs WHERE file_hash IN (watchlist) OR file_name IN (watchlist_names) | CORRELATE with connection_logs to find source and destination,playbooks/attack/enterprise/T1564.005.yml
T1564.005: Hidden File System,d8c4b1a0-6b7c-4d5e-9f3a-2e1c9b8d7a6f,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,2,"Is an executable file with an unusually high-entropy filename being transferred over the network, suggesting obfuscation?","This question seeks to identify obfuscated or randomized filenames, which can be a sign of malicious tools. The approach is to calculate the Shannon entropy for all executable filenames observed in network traffic. By establishing a rolling 30-day baseline of filename entropy, an alert can be generated for any executable filename whose entropy exceeds a high percentile (e.g., 95th) of the baseline and is not on an allow-list.",Zeek files.log; Zeek conn.log; Zeek http.log; Internet gateways and network egress points,last 90 days,CALCULATE entropy for filenames in network_file_logs | ALERT where entropy > 95th_percentile_baseline AND filename NOT IN allowlist,playbooks/attack/enterprise/T1564.005.yml
T1564.005: Hidden File System,d8c4b1a0-6b7c-4d5e-9f3a-2e1c9b8d7a6f,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,3,Does a machine learning model classify a network file transfer as high-risk or malicious based on its characteristics?,"This question leverages machine learning to identify potentially malicious file transfers that may not be caught by signature-based methods. A classification model is trained on labeled network log data using features like IP reputation, ASN rarity, port, file MIME type, size, and filename entropy. The deployed model scores new file transfers in near real-time, alerting on any transfer classified as high-risk.",Zeek files.log; Zeek conn.log; Zeek http.log; Internet gateways and network egress points,last 90 days,"SCORE new_file_transfers with ML_model(features: ip_rep, asn, port, mime_type, size, etc.) | ALERT where score is high_risk",playbooks/attack/enterprise/T1564.005.yml
T1564.005: Hidden File System,d8c4b1a0-6b7c-4d5e-9f3a-2e1c9b8d7a6f,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,4,"Are disk management utilities (`mountvol.exe`, `diskpart.exe`, `fsutil.exe`) being executed with command-line arguments indicative of hidden volume creation or manipulation?","This question focuses on detecting the direct use of native OS tools to manipulate volumes and create hidden file systems. The approach is to create a detection rule that triggers on process creation events (Windows Event ID 4688) for specific utilities with suspicious arguments, such as `mountvol.exe /d` (delete mount point) or `fsutil.exe file createnew`. The rule should be tuned to exclude known administrative scripts.","Windows Event ID 4688; Domain Controllers, File Servers, Critical application servers, and Administrator workstations",last 90 days,SEARCH process_creation_logs WHERE (process_name = 'mountvol.exe' AND command_line CONTAINS '/d') OR (process_name = 'diskpart.exe' AND script CONTAINS 'create partition') OR (process_name = 'fsutil.exe' AND command_line CONTAINS 'createnew') AND parent_process NOT IN allowlist,playbooks/attack/enterprise/T1564.005.yml
T1564.005: Hidden File System,d8c4b1a0-6b7c-4d5e-9f3a-2e1c9b8d7a6f,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,5,Are disk management utilities being executed by rare parent processes or with uncommon command-line arguments compared to an enterprise-wide baseline?,"This question uses statistical analysis to find anomalous executions of legitimate disk utilities. The method involves profiling the parent processes and command-line arguments for tools like `diskpart.exe` from process creation logs. By calculating the frequency of each parent-process/command-line pair across the enterprise, an alert can be triggered when a rare combination is observed, especially if the parent is not a standard administrative tool.","Windows Event ID 4688; Domain Controllers, File Servers, Critical application servers, and Administrator workstations",last 90 days,PROFILE parent_process and command_line for disk_utilities | CALCULATE frequency | ALERT where frequency < threshold AND parent_process NOT IN (standard_admin_tools),playbooks/attack/enterprise/T1564.005.yml
T1564.005: Hidden File System,d8c4b1a0-6b7c-4d5e-9f3a-2e1c9b8d7a6f,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,6,Does a sequence of commands within a shell session indicate anomalous disk reconnaissance followed by modification?,"This question aims to identify malicious intent by analyzing the sequence of commands. A sequence analysis model (e.g., LSTM) is trained on normal sequences of administrative commands within parent processes like `cmd.exe`. The model can then flag any session containing an anomalous sequence, particularly those involving disk reconnaissance (`wmic partition get`) immediately followed by partition modification (`diskpart`).","Windows Event ID 4688; Domain Controllers, File Servers, Critical application servers, and Administrator workstations",last 90 days,"MODEL command_sequences in shell_sessions | ALERT where sequence is anomalous (e.g., recon followed by modification)",playbooks/attack/enterprise/T1564.005.yml
T1564.005: Hidden File System,d8c4b1a0-6b7c-4d5e-9f3a-2e1c9b8d7a6f,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,7,"Has a new kernel driver service been created that is unsigned, located outside the standard drivers directory, or has been explicitly blocked by Code Integrity?","This question looks for the installation of potentially malicious kernel drivers, which can be used to hide file systems. The approach is to alert on new service creation events (Windows Event ID 7045) where the service is a kernel driver (`ServiceType` 0x1) and its `ImagePath` is outside the normal `\System32\drivers\` directory. This is supplemented by high-severity alerts on any Code Integrity Event ID 3033, which indicates a blocked unsigned driver.","Windows Event ID 7045; Microsoft-Windows-CodeIntegrity/Operational Event ID 3033; Windows Event ID 4688; All Windows endpoints and servers, particularly Domain Controllers",last 90 days,SEARCH service_creation_logs WHERE service_type = 'kernel_driver' AND image_path NOT LIKE '%\\System32\\drivers\\%' | ENRICH with signature_check; ALERT on code_integrity_block_events (EventID 3033),playbooks/attack/enterprise/T1564.005.yml
T1564.005: Hidden File System,d8c4b1a0-6b7c-4d5e-9f3a-2e1c9b8d7a6f,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,8,Has a new kernel driver been installed that is rare across the enterprise or has a high-entropy service name?,"This question uses statistical methods to find unusual driver installations. By aggregating all kernel driver service creation events over a period, we can calculate the prevalence of each driver's `ImagePath` (how many hosts it's on). An alert is generated for any new driver with very low prevalence (e.g., <1%) that isn't part of a known deployment. High-entropy service names are also flagged as suspicious.","Windows Event ID 7045; Microsoft-Windows-CodeIntegrity/Operational Event ID 3033; Windows Event ID 4688; All Windows endpoints and servers, particularly Domain Controllers",last 90 days,AGGREGATE driver_installations | CALCULATE prevalence of ImagePath and entropy of ServiceName | ALERT where prevalence < 1% OR entropy > 98th_percentile,playbooks/attack/enterprise/T1564.005.yml
T1564.005: Hidden File System,d8c4b1a0-6b7c-4d5e-9f3a-2e1c9b8d7a6f,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,9,Does a machine learning model classify a new driver installation as anomalous based on its features?,"This question applies machine learning to detect suspicious driver installations. An anomaly detection model (e.g., Isolation Forest) is trained on features from legitimate driver installation events. Features can include file path depth, entropy of the service and file names, and whether the path contains 'System32'. The model then scores new installations, flagging any that are identified as anomalous.","Windows Event ID 7045; Microsoft-Windows-CodeIntegrity/Operational Event ID 3033; Windows Event ID 4688; All Windows endpoints and servers, particularly Domain Controllers",last 90 days,"SCORE new_driver_installations with anomaly_detection_model(features: path_depth, path_entropy, name_entropy) | ALERT if anomalous",playbooks/attack/enterprise/T1564.005.yml
T1564.005: Hidden File System,d8c4b1a0-6b7c-4d5e-9f3a-2e1c9b8d7a6f,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,10,Has an unauthorized process attempted to read or write directly to a raw physical disk or volume?,"This question aims to detect processes bypassing the file system to interact directly with the disk, a technique used to access hidden partitions. This requires configuring System Access Control Lists (SACLs) on raw disk objects (`\.\PhysicalDrive*`) to log access attempts (Windows Event ID 4656/4663). A rule then alerts when a process not on an allow-list of approved disk utilities requests `ReadData` or `WriteData` access.","Windows Event ID 4663; Windows Event ID 4656; Windows Event ID 4688; SACL-monitored raw disk objects (\\.\\PhysicalDrive*) on all Windows endpoints and servers, especially database servers, file servers, and domain controllers.",last 90 days,"SEARCH disk_access_logs WHERE object_name LIKE '\\.\\PhysicalDrive*' AND access_type IN ('ReadData', 'WriteData') AND process_name NOT IN allowlist",playbooks/attack/enterprise/T1564.005.yml
T1564.005: Hidden File System,d8c4b1a0-6b7c-4d5e-9f3a-2e1c9b8d7a6f,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,11,Is a statistically rare process accessing raw disk objects?,"This question identifies unusual raw disk access by baselining normal activity. Based on access events (Windows Event ID 4656/4663), a profile of all processes that access raw disk objects is established across the enterprise. The prevalence of each process is calculated, and an alert is triggered if a process with very low prevalence (e.g., seen on <2% of systems) performs this action, especially if its parent process is also rare.","Windows Event ID 4663; Windows Event ID 4656; Windows Event ID 4688; SACL-monitored raw disk objects (\\.\\PhysicalDrive*) on all Windows endpoints and servers, especially database servers, file servers, and domain controllers.",last 90 days,BASELINE raw_disk_access_by_process | CALCULATE prevalence | ALERT when accessing_process_prevalence < threshold,playbooks/attack/enterprise/T1564.005.yml
T1564.005: Hidden File System,d8c4b1a0-6b7c-4d5e-9f3a-2e1c9b8d7a6f,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,12,Does a raw disk access event belong to an anomalous cluster of activity?,"This question uses machine learning to distinguish normal from abnormal raw disk access. A clustering algorithm (e.g., DBSCAN) groups events based on features like process name, parent process, and access mask. Large, dense clusters typically represent legitimate activity (like backups). Small, sparse clusters or singleton events that do not fit into any known group are flagged as anomalies for investigation.","Windows Event ID 4663; Windows Event ID 4656; Windows Event ID 4688; SACL-monitored raw disk objects (\\.\\PhysicalDrive*) on all Windows endpoints and servers, especially database servers, file servers, and domain controllers.",last 90 days,"CLUSTER disk_access_events using features(process, parent_process, access_mask) | ALERT on small or sparse clusters",playbooks/attack/enterprise/T1564.005.yml
T1564.005: Hidden File System,d8c4b1a0-6b7c-4d5e-9f3a-2e1c9b8d7a6f,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,13,Have critical registry keys related to file systems or boot processes been modified by an unauthorized process?,This question targets attempts to manipulate system behavior at a low level by modifying the registry. High-priority alerts are created for any modification event (Windows Event ID 4657) to critical keys like `HKLM\SYSTEM\CurrentControlSet\Services\Ntfs` or `HKLM\...\BootExecute`. An alert is triggered if the process responsible for the change is not an approved system process like `TrustedInstaller.exe`.,Windows Event ID 4657; Windows Event ID 4663; Boot sectors of physical disks and Windows Registry hives on all Windows assets,last 90 days,SEARCH registry_modification_logs WHERE key_path IN (critical_boot_keys) AND process_name NOT IN allowlist,playbooks/attack/enterprise/T1564.005.yml
T1564.005: Hidden File System,d8c4b1a0-6b7c-4d5e-9f3a-2e1c9b8d7a6f,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,14,Has a host experienced a statistically unusual number of modifications to registry keys related to system services?,"This question seeks to identify a burst of suspicious registry activity. The approach is to track the frequency of modification events (Windows Event ID 4657) to the `HKLM\SYSTEM\CurrentControlSet\Services` key and its subkeys. By establishing a baseline for the daily count of these modifications per host, an alert can be generated when a host's activity exceeds a statistical threshold (e.g., 3 standard deviations above its mean), especially outside of normal patch windows.",Windows Event ID 4657; Windows Event ID 4663; Boot sectors of physical disks and Windows Registry hives on all Windows assets,last 90 days,TRACK daily_count of modifications to 'HKLM\\SYSTEM\\CurrentControlSet\\Services' per host | ALERT if count > (mean + 3*stdev) or count > 99th_percentile,playbooks/attack/enterprise/T1564.005.yml
T1564.005: Hidden File System,d8c4b1a0-6b7c-4d5e-9f3a-2e1c9b8d7a6f,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,15,Does a time-series model detect an anomalous spike in registry modifications related to boot or service configuration?,"This question uses forecasting models to find abnormal spikes in registry modifications. A time-series model (e.g., SARIMA) is trained on the aggregate count of modification events for critical system keys. The model learns normal patterns, including weekly and monthly seasonality (like Patch Tuesday). It then alerts on any spike in activity that it flags as a significant, unexpected anomaly.",Windows Event ID 4657; Windows Event ID 4663; Boot sectors of physical disks and Windows Registry hives on all Windows assets,last 90 days,MODEL time_series of aggregate registry_mod_events | ALERT on spikes flagged as anomalous by the model,playbooks/attack/enterprise/T1564.005.yml
T1564.005: Hidden File System,d8c4b1a0-6b7c-4d5e-9f3a-2e1c9b8d7a6f,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,16,"Is there a significant discrepancy between a disk's total size and the sum of its allocated partitions, suggesting hidden unallocated space?","This question seeks to find hidden file systems by identifying unaccounted-for disk space. A recurring script is scheduled on endpoints to compare the total disk size (from `wmic diskdrive get size`) with the sum of all partition sizes (`wmic partition get size`). A rule then parses these logs and calculates the unallocated space, alerting if this value is greater than a nominal threshold (e.g., 1GB).",Windows Event ID 4688; Custom Script Output; Physical disks on all Windows endpoints and servers,last 90 days,RUN script to compare total_disk_size and sum_of_partition_sizes | CALCULATE unallocated_space | ALERT if unallocated_space > threshold,playbooks/attack/enterprise/T1564.005.yml
T1564.005: Hidden File System,d8c4b1a0-6b7c-4d5e-9f3a-2e1c9b8d7a6f,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,17,"Has a host's unallocated disk space suddenly increased, as identified by a change point detection algorithm?","This question focuses on detecting the moment a hidden partition might be created. The periodically calculated 'UnallocatedSpace' value for each host is ingested into a time-series database. A change point detection algorithm is then applied to this data series to automatically alert when a statistically significant, positive change in the unallocated space is detected.",Windows Event ID 4688; Custom Script Output; Physical disks on all Windows endpoints and servers,last 90 days,STORE unallocated_space over time | APPLY change_point_detection algorithm | ALERT on significant positive change,playbooks/attack/enterprise/T1564.005.yml
T1564.005: Hidden File System,d8c4b1a0-6b7c-4d5e-9f3a-2e1c9b8d7a6f,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,18,"Has a host's disk layout profile anomalously changed, causing it to shift from its normal cluster of similar machines?","This question uses machine learning to spot anomalous changes in a computer's disk configuration. Hosts are grouped into clusters (e.g., 'Standard Laptop', 'Dev VM') based on their disk layout profiles (total size, number of partitions, etc.). If a host's profile changes and it unexpectedly migrates to a different cluster, it is flagged for investigation as a potential unauthorized disk modification.",Windows Event ID 4688; Custom Script Output; Physical disks on all Windows endpoints and servers,last 90 days,CLUSTER hosts by disk_layout_profile | MONITOR for cluster migration | ALERT if host moves to an unexpected cluster,playbooks/attack/enterprise/T1564.005.yml
T1564.009: Resource Forking,a7b3c9d1-e8f6-4a2b-9c8d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,1,Has a file's resource fork been written with content matching a known malicious hash?,"This question aims to identify the direct use of resource forks to store known malware. By hashing the content of a resource fork during file write or creation events and comparing it against threat intelligence feeds, analysts can detect if a malicious payload has been hidden using this technique. A match is a strong indicator of compromise.","ES_EVENT_TYPE_NOTIFY_CREATE file creation events; ES_EVENT_TYPE_NOTIFY_WRITE file write events; File system audit logs; User workstations (macOS), macOS-based servers, Development environments, common staging directories like /tmp/, ~/Downloads/, ~/Documents/",Last 90 days,"pseudocode: FOR file_event IN (creation, write) | WHERE file_event has resource_fork | CALCULATE sha256 of resource_fork | LOOKUP hash in threat_intel_feed | IF match, ALERT.",playbooks/attack/enterprise/T1564.009.yml
T1564.009: Resource Forking,a7b3c9d1-e8f6-4a2b-9c8d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,2,"Does a file's resource fork have an unusually high entropy, suggesting it is packed or encrypted?","Adversaries often pack or encrypt payloads to evade signature-based detection. High entropy is a mathematical indicator of randomness, which is characteristic of compressed or encrypted data. This question focuses on flagging files where the resource fork's content deviates from the normal entropy baseline of legitimate applications, pointing to potentially obfuscated malicious code.","ES_EVENT_TYPE_NOTIFY_CREATE file creation events; ES_EVENT_TYPE_NOTIFY_WRITE file write events; File system audit logs; User workstations (macOS), macOS-based servers, Development environments, common staging directories like /tmp/, ~/Downloads/, ~/Documents/",Last 90 days,"pseudocode: FOR file IN filesystem | WHERE file has non-zero resource_fork | CALCULATE entropy of resource_fork | IF entropy > baseline_95th_percentile, ALERT.",playbooks/attack/enterprise/T1564.009.yml
T1564.009: Resource Forking,a7b3c9d1-e8f6-4a2b-9c8d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,3,Can a machine learning model identify file modification events that are likely associated with malicious resource fork usage?,"This question proposes a proactive, behavioral detection method. Instead of relying on single indicators, a machine learning model can analyze multiple features in concert (e.g., fork size, entropy, parent process, file permissions) to determine the likelihood of malicious activity. This helps identify novel or complex variations of the resource forking technique that might evade simpler rules.","ES_EVENT_TYPE_NOTIFY_CREATE file creation events; ES_EVENT_TYPE_NOTIFY_WRITE file write events; File system audit logs; User workstations (macOS), macOS-based servers, Development environments, common staging directories like /tmp/, ~/Downloads/, ~/Documents/",Last 90 days,"pseudocode: ON file_modification_event | EXTRACT features (fork_size, entropy, parent_process, etc.) | SCORE event with ML_model | IF score > threshold, ALERT.",playbooks/attack/enterprise/T1564.009.yml
T1564.009: Resource Forking,a7b3c9d1-e8f6-4a2b-9c8d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,4,"Is a suspicious process, such as a command-line utility or office application, writing to a file's resource fork?","Typically, only specific system utilities like Finder should be modifying resource forks. This question aims to detect when processes not designed for this purpose, such as download tools (curl, wget), interpreters (python, bash), or document editors, write to a resource fork. Such behavior is highly anomalous and may indicate an adversary is staging a payload.","ES_EVENT_TYPE_NOTIFY_FORK process fork events; ES_EVENT_TYPE_NOTIFY_EXEC process execution events; ES_EVENT_TYPE_NOTIFY_WRITE file write events; User workstations (macOS), macOS-based servers, Development environments",Last 90 days,"pseudocode: FOR file_write_event | WHERE target is resource_fork AND process_name IN (curl, wget, python, etc.), ALERT.",playbooks/attack/enterprise/T1564.009.yml
T1564.009: Resource Forking,a7b3c9d1-e8f6-4a2b-9c8d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,5,Has a rare or never-before-seen process written to a resource fork?,"This question uses statistical analysis to find the 'needle in the haystack.' By baselining which processes normally write to resource forks and how often, analysts can spot outliers. A process that rarely or never performs this action but suddenly does is suspicious, as it could represent a custom malicious tool or a legitimate tool being used in an unusual, malicious way.","ES_EVENT_TYPE_NOTIFY_FORK process fork events; ES_EVENT_TYPE_NOTIFY_EXEC process execution events; ES_EVENT_TYPE_NOTIFY_WRITE file write events; User workstations (macOS), macOS-based servers, Development environments",Last 90 days,"pseudocode: AGGREGATE process_names from resource_fork_writes over 30 days | CALCULATE frequency | IF process_name NOT IN allowlist AND frequency < 5th_percentile, ALERT.",playbooks/attack/enterprise/T1564.009.yml
T1564.009: Resource Forking,a7b3c9d1-e8f6-4a2b-9c8d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,6,"Does a process chain leading to a resource fork write deviate from normal, established patterns of behavior?","This question focuses on the context of the action, not just the action itself. Malicious activity often has an anomalous process lineage (e.g., a browser spawns a shell, which downloads a file and writes to its resource fork). By modeling normal process chains, a clustering algorithm can identify and flag these abnormal sequences as outliers, indicating a potential compromise.","ES_EVENT_TYPE_NOTIFY_FORK process fork events; ES_EVENT_TYPE_NOTIFY_EXEC process execution events; ES_EVENT_TYPE_NOTIFY_WRITE file write events; User workstations (macOS), macOS-based servers, Development environments",Last 90 days,"pseudocode: MODEL process_lineage_graphs for resource_fork_writes | USE clustering (DBSCAN) to find normal clusters | IF new_process_chain is an outlier, ALERT.",playbooks/attack/enterprise/T1564.009.yml
T1564.009: Resource Forking,a7b3c9d1-e8f6-4a2b-9c8d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,7,Has an executable file been created or modified to contain a non-empty resource fork?,"While some legacy macOS applications used resource forks, it is highly unusual for modern executables. This question seeks to identify files that are both executable and have data stored in their resource fork. This combination is suspicious because it's a known method for smuggling malicious code or data alongside a seemingly legitimate executable.","ES_EVENT_TYPE_NOTIFY_SETATTR file attribute modification events; ES_EVENT_TYPE_NOTIFY_CREATE file creation events; ES_EVENT_TYPE_NOTIFY_WRITE file write events; User workstations (macOS), macOS-based servers, Staging directories (e.g., /tmp, ~/Downloads)",Last 90 days,"pseudocode: FOR file_event IN (creation, attribute_modification) | IF file is executable AND resource_fork_size > 0, ALERT.",playbooks/attack/enterprise/T1564.009.yml
T1564.009: Resource Forking,a7b3c9d1-e8f6-4a2b-9c8d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,8,Does an executable file have a resource fork that is statistically anomalous in size compared to its peers?,"This question uses statistical outlier detection to find suspicious executables. By establishing a baseline for the typical size of resource forks in executables (which is often zero), a file with a resource fork significantly larger than the average can be flagged. This points to an executable that is likely carrying an unusual, and potentially malicious, data payload in its fork.","ES_EVENT_TYPE_NOTIFY_SETATTR file attribute modification events; ES_EVENT_TYPE_NOTIFY_CREATE file creation events; ES_EVENT_TYPE_NOTIFY_WRITE file write events; User workstations (macOS), macOS-based servers, Staging directories (e.g., /tmp, ~/Downloads)",Last 90 days,"pseudocode: MONITOR resource_fork_size for all executables | CALCULATE moving_average and std_dev | IF executable.resource_fork_size > (moving_average + 3*std_dev), ALERT.",playbooks/attack/enterprise/T1564.009.yml
T1564.009: Resource Forking,a7b3c9d1-e8f6-4a2b-9c8d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,9,Has there been a sudden spike in the creation of executable files with non-empty resource forks on a host?,"This question aims to detect large-scale or automated malicious activity. A single executable with a resource fork might be an isolated event, but a sudden increase in the number of such files on a single host within a short period is a strong indicator of a malware dropper or automated script. Time-series analysis can distinguish this spike from normal system activity.","ES_EVENT_TYPE_NOTIFY_SETATTR file attribute modification events; ES_EVENT_TYPE_NOTIFY_CREATE file creation events; ES_EVENT_TYPE_NOTIFY_WRITE file write events; User workstations (macOS), macOS-based servers, Staging directories (e.g., /tmp, ~/Downloads)",Last 90 days,"pseudocode: AGGREGATE count of new executables with non-zero resource_forks per host per hour | APPLY time-series anomaly detection (SARIMA) | IF count is an anomaly, ALERT.",playbooks/attack/enterprise/T1564.009.yml
T1564.009: Resource Forking,a7b3c9d1-e8f6-4a2b-9c8d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,10,"Has a file been downloaded, had its resource fork modified, and then been executed in a short time frame?","This question reconstructs a common attack chain. Adversaries often download a file, inject a payload into its resource fork, and then execute it. By correlating network download events with endpoint file modification and process execution events, analysts can detect this entire 'download-fork-execute' sequence, providing high-fidelity evidence of a compromise.","Zeek conn.log; Zeek files.log; ES_EVENT_TYPE_NOTIFY_WRITE file write events; ES_EVENT_TYPE_NOTIFY_EXEC process execution events; Network egress points, User workstations (macOS), User download folders",Last 90 days,"pseudocode: CORRELATE network_download, resource_fork_write, and process_execution for same file_path on same host within 5 minutes | IF sequence exists, ALERT.",playbooks/attack/enterprise/T1564.009.yml
T1564.009: Resource Forking,a7b3c9d1-e8f6-4a2b-9c8d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,11,Did a 'download-fork-execute' sequence occur faster than typical user-initiated actions?,"This question adds a behavioral heuristic to increase confidence. Automated malicious scripts execute their steps extremely quickly. A human user typically takes longer to download, interact with, and run a file. By flagging sequences that happen almost instantaneously, analysts can prioritize alerts that are more likely to be automated and malicious.","Zeek conn.log; Zeek files.log; ES_EVENT_TYPE_NOTIFY_WRITE file write events; ES_EVENT_TYPE_NOTIFY_EXEC process execution events; Network egress points, User workstations (macOS), User download folders",Last 90 days,"pseudocode: FOR each 'download-fork-execute' sequence | CALCULATE time_delta(execution - download) | IF time_delta < 15 seconds (or 5th percentile), RAISE_ALERT_PRIORITY.",playbooks/attack/enterprise/T1564.009.yml
T1564.009: Resource Forking,a7b3c9d1-e8f6-4a2b-9c8d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,12,Can a machine learning model trained on normal event sequences identify a 'download-fork-execute' chain as a high-risk anomaly?,"This question proposes a sophisticated, data-driven approach to detect complex attack patterns. A sequence analysis model learns the 'grammar' of normal system and user behavior. The specific, ordered sequence of a download, followed by a resource fork write, followed by an execution is highly abnormal and would be assigned a very low probability by a trained model, allowing for its detection.","Zeek conn.log; Zeek files.log; ES_EVENT_TYPE_NOTIFY_WRITE file write events; ES_EVENT_TYPE_NOTIFY_EXEC process execution events; Network egress points, User workstations (macOS), User download folders",Last 90 days,"pseudocode: FEED event_stream (network, file, process) to sequence_model (LSTM) | IF model flags 'download->fork_write->exec' sequence as low_probability_anomaly, ALERT.",playbooks/attack/enterprise/T1564.009.yml
T1564: Hide Artifacts,5e9f1b2c-8d7e-4a6f-a1b3-c4d5e6f7a8b9,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,1,Have any processes or files been created that match the names or hashes of known artifact-hiding tools or rootkits?,"This question aims to directly detect the execution or presence of malicious tools specifically designed to conceal an adversary's activities. Identifying tools like Slacker, Transmo, or various rootkits via process creation (Event ID 4688) or file creation (Event ID 4663) is a high-fidelity indicator of a defense evasion attempt. An alert on such a match provides a strong starting point for an investigation.","Windows Event ID 4688; Windows Event ID 4663; All Windows Endpoints, All Windows Servers, Domain Controllers",last 90 days,: SEARCH process_creation_events OR file_creation_events WHERE (process_name IN known_hiding_tools_list OR file_hash IN known_rootkit_hashes),playbooks/attack/enterprise/T1564.yml
T1564: Hide Artifacts,5e9f1b2c-8d7e-4a6f-a1b3-c4d5e6f7a8b9,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,2,Are there any unusual parent-child process relationships or potentially typosquatted process names that suggest hidden execution?,"Adversaries often abuse legitimate processes to launch malicious tools, a technique known as masquerading. This question looks for statistical anomalies, such as an office application (e.g., Word, Outlook) spawning a command shell, which is highly irregular. It also seeks to identify typosquatting, where an adversary names a malicious tool very similarly to a legitimate system process (e.g., 'svch0st.exe' instead of 'svchost.exe') to blend in. Detecting these statistical deviations can uncover hidden activities that symbolic checks might miss.","Windows Event ID 4688; All Windows Endpoints, All Windows Servers, Domain Controllers",last 90 days,": SEARCH process_creation_events WHERE (parent_process IN [word.exe, outlook.exe] AND child_process IN [cmd.exe, powershell.exe]) OR (levenshtein_distance(process_name, system_process_list) <= 2)",playbooks/attack/enterprise/T1564.yml
T1564: Hide Artifacts,5e9f1b2c-8d7e-4a6f-a1b3-c4d5e6f7a8b9,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,3,"Can we identify process creation events that are likely to be malicious tool executions based on a combination of features like name entropy, command-line complexity, and parent process rarity?","This question leverages machine learning to build a more nuanced detection capability. By training on known good and bad process events, the model learns complex patterns associated with malicious behavior, such as unusually long or random command-line arguments, execution by a rare parent process, or high-entropy process names. This approach helps find novel or obfuscated hiding techniques that don't match simple rules.","Windows Event ID 4688; All Windows Endpoints, All Windows Servers, Domain Controllers",last 90 days,": SCORE process_creation_events USING classification_model(features=[entropy(process_name), length(command_line), entropy(command_line), rarity(parent_process)]) WHERE score > threshold",playbooks/attack/enterprise/T1564.yml
T1564: Hide Artifacts,5e9f1b2c-8d7e-4a6f-a1b3-c4d5e6f7a8b9,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,4,"Are there any command-line executions using utilities like 'attrib.exe', 'icacls.exe', or PowerShell to hide files, deny access, or manipulate Alternate Data Streams (ADS)?","Adversaries frequently use built-in Windows tools ('living off the land') to hide their artifacts. This question seeks to detect specific command-line patterns indicative of this behavior. For example, 'attrib.exe +h' makes a file hidden, 'icacls.exe /deny' can block security tools from accessing a file, and PowerShell or 'type' commands can be used to write malicious code into an ADS, which is a hidden stream of data attached to a file. Finding these specific command patterns is a strong indicator of defense evasion.","Windows Event ID 4688; All Windows Endpoints, File Servers, Application Servers",last 90 days,: SEARCH process_creation_events WHERE command_line MATCHES REGEX ('attrib\.exe.*\+h' OR 'icacls\.exe.*\/deny' OR 'Set-Content.*-Stream' OR 'type .*>.*:.*'),playbooks/attack/enterprise/T1564.yml
T1564: Hide Artifacts,5e9f1b2c-8d7e-4a6f-a1b3-c4d5e6f7a8b9,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,5,"Are legitimate system utilities like 'attrib.exe', 'icacls.exe', or 'powershell.exe' being used with statistically rare or unusual command-line arguments?","While adversaries use legitimate tools, their methods of use are often abnormal. This question focuses on identifying these statistical outliers. By baselining the common command-line arguments for utilities over time, we can flag new, rare combinations. An administrator might use 'icacls.exe' for routine tasks, but using it with a '/deny' flag against a system file is highly unusual and suspicious. This approach helps find abuse of legitimate tools without relying on exact, predefined malicious patterns.","Windows Event ID 4688; All Windows Endpoints, File Servers, Application Servers",last 90 days,": SEARCH process_creation_events FOR utilities IN [attrib.exe, icacls.exe, powershell.exe] | CALCULATE frequency of command_line_arguments | FILTER frequency < 5th_percentile",playbooks/attack/enterprise/T1564.yml
T1564: Hide Artifacts,5e9f1b2c-8d7e-4a6f-a1b3-c4d5e6f7a8b9,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,6,Can we detect anomalous command-line structures that deviate from normal patterns using an unsupervised machine learning model?,"This question applies unsupervised learning to find 'unknown unknowns' in command-line data. A model like a variational autoencoder or isolation forest learns the deep structure of what constitutes a 'normal' command. When an adversary uses a novel or heavily obfuscated command, it won't fit this learned structure and will be flagged as an anomaly. This is powerful for detecting new or evolving techniques for hiding artifacts via the command line.","Windows Event ID 4688; All Windows Endpoints, File Servers, Application Servers",last 90 days,: SCORE process_creation_events USING anomaly_detection_model(features=tokenize(command_line)) WHERE anomaly_score > threshold,playbooks/attack/enterprise/T1564.yml
T1564: Hide Artifacts,5e9f1b2c-8d7e-4a6f-a1b3-c4d5e6f7a8b9,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,7,Has a known timestomping tool or PowerShell command been executed immediately before a file's metadata was modified on the same host?,"Timestomping is a technique used to modify the timestamps of a file to make it look older, blending in with legitimate system files and evading timeline-based analysis. This question uses a correlation rule to link the execution of a tool capable of timestomping with an actual file modification event happening moments later on the same machine. This direct, time-based correlation provides strong evidence that timestomping has occurred.","Windows Event ID 4688; Windows Event ID 4663; Windows PowerShell Event ID 4104; Critical System Directories (e.g., System32), User Profile Directories, Temporary File Locations",last 90 days,: CORRELATE process_creation_events (for timestomp_tools) WITH file_modification_events ON host WHERE time_difference < 5_seconds,playbooks/attack/enterprise/T1564.yml
T1564: Hide Artifacts,5e9f1b2c-8d7e-4a6f-a1b3-c4d5e6f7a8b9,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,8,"Have any files been modified in a way that their new timestamp is in the past, or exactly matches the timestamp of an unrelated system file?","This question looks for the statistical artifacts left behind by timestomping. Normally, a file's modification timestamp should be very close to the time of the event that modified it. If the new timestamp is significantly in the past, it's a clear sign of manipulation. Another common tactic is to copy the timestamp from a legitimate system file (like kernel32.dll) to make a malicious file appear as part of the OS. Detecting these statistical impossibilities can uncover timestomping without seeing the tool that performed it.","Windows Event ID 4663; Critical System Directories (e.g., System32), User Profile Directories, Temporary File Locations",last 90 days,: SEARCH file_modification_events | CALCULATE delta = new_modified_timestamp - event_timestamp | FILTER delta < 0 OR new_modified_timestamp IN (SELECT timestamp FROM system_files),playbooks/attack/enterprise/T1564.yml
T1564: Hide Artifacts,5e9f1b2c-8d7e-4a6f-a1b3-c4d5e6f7a8b9,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,9,Are there any anomalies in the time-series data of file metadata that indicate a timestamp has been unnaturally altered?,This question treats file timestamps as a time-series and applies anomaly detection to find deviations. File timestamps should naturally progress forward monotonically. A time-series model (like ARIMA) can learn this expected progression. Any event that causes a timestamp to go backward or jump to a value that is statistically impossible based on its history would be flagged as an anomaly. This advanced method is highly effective at detecting subtle metadata manipulation.,"Windows Event ID 4663; File Integrity Monitoring logs; Critical System Directories (e.g., System32), User Profile Directories, Temporary File Locations",last 90 days,: SCORE file_modification_events USING time_series_model(feature=file_timestamps) WHERE anomaly_score > threshold,playbooks/attack/enterprise/T1564.yml
T1564: Hide Artifacts,5e9f1b2c-8d7e-4a6f-a1b3-c4d5e6f7a8b9,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,10,"Has a process launched from a suspicious or hidden directory (e.g., Recycle Bin, Temp folders, ADS) made an outbound network connection to a known malicious IP address?","Adversaries often place their malware in non-standard or hidden locations to avoid scrutiny. When this malware executes, it typically needs to establish a command and control (C2) channel. This question correlates two high-confidence indicators: execution from a suspicious location and communication with a known-bad destination. A successful correlation provides strong evidence of a malicious implant attempting to 'phone home.'","Windows Event ID 4688; Windows Event ID 5156; Zeek conn.log; All Windows Endpoints, Network Egress Points (Firewalls, Proxies), DNS Servers",last 90 days,": CORRELATE process_creation_events (where path matches suspicious_locations_regex) WITH network_connection_events (where destination_ip IN threat_intel_feed) ON host, time",playbooks/attack/enterprise/T1564.yml
T1564: Hide Artifacts,5e9f1b2c-8d7e-4a6f-a1b3-c4d5e6f7a8b9,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,11,"Are there any processes with a high composite risk score, based on a combination of rare execution paths, non-standard network behavior, and other suspicious attributes?","This question moves beyond single indicators to a risk-based approach. It calculates the statistical rarity of a process's execution path and combines it with other suspicious factors like the process being unsigned or communicating over an unusual port. A process that accumulates a high composite risk score is highly likely to be malicious, even if no single attribute is definitively 'bad.'","Windows Event ID 4688; Windows Event ID 5156; Zeek conn.log; All Windows Endpoints, Network Egress Points (Firewalls, Proxies), DNS Servers",last 90 days,: SEARCH process_creation_events | SCORE risk = rarity(path) + is_unsigned(process) + is_non_standard(port) + is_new(destination_ip) | FILTER risk > threshold,playbooks/attack/enterprise/T1564.yml
T1564: Hide Artifacts,5e9f1b2c-8d7e-4a6f-a1b3-c4d5e6f7a8b9,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,12,"Can we identify suspicious chains of activity, such as a process from a rare file path connecting to a new external IP, using a graph-based machine learning model?","This question uses a graph-based approach to model the complex relationships between entities (processes, files, IPs). By representing activity as a graph, a Graph Neural Network (GNN) can learn 'normal' interaction patterns. It can then identify and score anomalous subgraphs, such as the sequence of a file in a temp directory spawning a process that connects to a new domain. This method excels at finding complex, multi-stage attack behaviors.","Windows Event ID 4688; Windows Event ID 5156; Zeek conn.log; All Windows Endpoints, Network Egress Points (Firewalls, Proxies), DNS Servers",last 90 days,": CONSTRUCT graph from process, file, network events | SCORE subgraphs using GNN_anomaly_detector | FILTER score > threshold",playbooks/attack/enterprise/T1564.yml
T1564: Hide Artifacts,5e9f1b2c-8d7e-4a6f-a1b3-c4d5e6f7a8b9,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,13,Have any new user accounts or scheduled tasks been created with names that are typosquatted versions of legitimate system or service accounts?,"Adversaries create accounts or scheduled tasks with names very similar to legitimate ones (e.g., 'Administartor') to blend in and achieve persistence. This question aims to detect this 'typosquatting' by calculating the Levenshtein distance (a measure of string similarity) between new account/task names and a list of known-good, critical names. A low distance (e.g., 1 or 2) indicates a likely attempt to masquerade.","Windows Event ID 4720; Windows Event ID 4698; Domain Controllers, Active Directory Servers, All Windows Endpoints and Servers",last 90 days,": SEARCH account_creation_events OR task_creation_events | CALCULATE distance = levenshtein_distance(new_name, critical_names_list) | FILTER distance <= 2",playbooks/attack/enterprise/T1564.yml
T1564: Hide Artifacts,5e9f1b2c-8d7e-4a6f-a1b3-c4d5e6f7a8b9,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,14,Have any new user accounts or scheduled tasks been created with names that have an unusually high degree of randomness (high entropy)?,"Adversaries may use randomly generated names for accounts or tasks created by their tools. These names often look like gibberish (e.g., 'x7z2k9p') and have high Shannon entropy. This question focuses on calculating the entropy for each new name and comparing it to a baseline of normal names in the environment. A name with an entropy score in the top percentile is statistically anomalous and likely machine-generated, warranting investigation.","Windows Event ID 4720; Windows Event ID 4698; Domain Controllers, Active Directory Servers, All Windows Endpoints and Servers",last 90 days,: SEARCH account_creation_events OR task_creation_events | CALCULATE entropy_score = shannon_entropy(new_name) | FILTER entropy_score > 95th_percentile,playbooks/attack/enterprise/T1564.yml
T1564: Hide Artifacts,5e9f1b2c-8d7e-4a6f-a1b3-c4d5e6f7a8b9,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,15,Can we detect anomalous new account or scheduled task names that do not conform to the patterns of known legitimate names using a machine learning model?,"This question employs a one-class classification model (like a one-class SVM) to build a sophisticated profile of what 'normal' account and task names look like. The model is trained exclusively on known-good names, learning their typical characteristics. When a new name is created, the model determines if it fits within this learned profile. Any name classified as an 'outlier' is flagged as suspicious, allowing for the detection of both typosquatted and randomized names.","Windows Event ID 4720; Windows Event ID 4698; Domain Controllers, Active Directory Servers, All Windows Endpoints and Servers",last 90 days,": SCORE new account/task names USING one_class_svm_model(features=[length, ngrams, entropy]) WHERE classification == 'outlier'",playbooks/attack/enterprise/T1564.yml
T1565.002: Transmitted Data Manipulation,a7b1c1d8-e9f0-4a1b-8c2d-3e4f5a6b7c8d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0040: Impact,n; o; n; e,1,"Has a critical internal asset established a network connection with a known malicious proxy, anonymizer, or Man-in-the-Middle (MitM) command-and-control (C2) server?","This question aims to detect direct communication from high-value internal systems (like payment processors or database servers) to known malicious infrastructure. Such connections are highly anomalous and could indicate that data is being exfiltrated or manipulated by an adversary intercepting the traffic. The symbolic approach provides a high-confidence alert by matching outbound traffic against a curated list of threat intelligence.
",Zeek conn.log; Zeek dns.log; Internet gateway; Core network switches monitoring traffic from critical assets; DNS servers; DMZ firewalls,last 90 days,Pseudocode: JOIN Zeek conn.log destination IPs WITH threat intelligence feed of malicious proxy/MitM IPs WHERE source IP is in critical asset range. ALERT on match.,playbooks/attack/enterprise/T1565.002.yml
T1565.002: Transmitted Data Manipulation,a7b1c1d8-e9f0-4a1b-8c2d-3e4f5a6b7c8d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0040: Impact,n; o; n; e,2,Has a critical internal asset initiated a network connection to a statistically rare external destination?,"This question helps identify suspicious communications that may not involve known malicious IPs. By baselining normal communication patterns for critical assets, we can flag connections to new or infrequent destinations. This could uncover previously unknown C2 servers or data staging points used in a data manipulation attack.
",Zeek conn.log; Zeek dns.log; Internet gateway; Core network switches monitoring traffic from critical assets; DNS servers; DMZ firewalls,last 90 days,"Pseudocode: FOR each critical asset, PROFILE destination IP/ASN frequency over 30 days. ALERT if new connection destination is in bottom 5% frequency.",playbooks/attack/enterprise/T1565.002.yml
T1565.002: Transmitted Data Manipulation,a7b1c1d8-e9f0-4a1b-8c2d-3e4f5a6b7c8d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0040: Impact,n; o; n; e,3,"Does a network connection from a critical asset exhibit characteristics indicative of malicious redirection or data manipulation, based on a machine learning risk score?","This question uses a machine learning model to provide a more nuanced detection capability than symbolic or statistical methods alone. By analyzing multiple features of a network connection (duration, bytes transferred, service, IP context), the model can identify complex patterns that suggest malicious activity, such as traffic being rerouted through an adversary's infrastructure. This helps detect sophisticated attacks that might otherwise blend in with normal traffic.
",Zeek conn.log; Zeek dns.log; Internet gateway; Core network switches monitoring traffic from critical assets; DNS servers; DMZ firewalls,last 90 days,"Pseudocode: FOR each connection, EXTRACT features (duration, service, bytes, threat intel). COMPUTE risk score using trained classification model. ALERT if score > threshold.",playbooks/attack/enterprise/T1565.002.yml
T1565.002: Transmitted Data Manipulation,a7b1c1d8-e9f0-4a1b-8c2d-3e4f5a6b7c8d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0040: Impact,n; o; n; e,4,Has an SSL/TLS connection to a critical internal service used a certificate from an unapproved Certificate Authority or a JA3/JA3S hash matching a known MitM tool?,"This question seeks to identify classic signs of a TLS interception attack. A valid connection to an internal service should use a certificate issued by a trusted internal CA. The presence of a self-signed certificate, a certificate from an unexpected issuer, or a client/server fingerprint (JA3/JA3S) associated with interception tools like Burp Suite strongly indicates a MitM attack is in progress.
",Zeek ssl.log; Zeek x509.log; Zeek weird.log; Application servers; Load balancers; VPN concentrators; Web proxies; Network segments between clients and critical services,last 90 days,Pseudocode: ALERT IF (ssl.log ja3/ja3s IN known_mitm_hashes) OR (x509.log certificate.issuer NOT IN approved_ca_list for critical service).,playbooks/attack/enterprise/T1565.002.yml
T1565.002: Transmitted Data Manipulation,a7b1c1d8-e9f0-4a1b-8c2d-3e4f5a6b7c8d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0040: Impact,n; o; n; e,5,Has an SSL/TLS connection to a critical service presented a statistically rare certificate issuer or subject?,"This question helps detect subtle certificate anomalies that might not be caught by a simple allowlist. By baselining the certificate details (issuer and subject) normally seen for each critical service, we can flag connections that use an infrequent or never-before-seen certificate. This could indicate an adversary has managed to issue a fraudulent certificate from a compromised or less-common CA to perform a MitM attack.
",Zeek ssl.log; Zeek x509.log; Zeek weird.log; Application servers; Load balancers; VPN concentrators; Web proxies; Network segments between clients and critical services,last 90 days,"Pseudocode: FOR each critical service, PROFILE historical certificate issuer/subject frequency. ALERT if new connection's certificate pair is in bottom 1% frequency.",playbooks/attack/enterprise/T1565.002.yml
T1565.002: Transmitted Data Manipulation,a7b1c1d8-e9f0-4a1b-8c2d-3e4f5a6b7c8d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0040: Impact,n; o; n; e,6,Are there clusters of SSL/TLS sessions with anomalous characteristics that could indicate Man-in-the-Middle activity?,"This question uses unsupervised machine learning to find outliers among SSL/TLS sessions. Instead of looking for specific bad signatures, a clustering algorithm groups sessions by their overall characteristics (cipher suite, TLS version, certificate validity, etc.). Sessions that don't fit into any normal cluster are flagged as anomalous, potentially representing a novel or sophisticated MitM attack that uses non-standard TLS parameters.
",Zeek ssl.log; Zeek x509.log; Zeek weird.log; Application servers; Load balancers; VPN concentrators; Web proxies; Network segments between clients and critical services,last 90 days,Pseudocode: VECTORIZE SSL/TLS session features. APPLY DBSCAN clustering. INVESTIGATE sessions classified as noise/outliers.,playbooks/attack/enterprise/T1565.002.yml
T1565.002: Transmitted Data Manipulation,a7b1c1d8-e9f0-4a1b-8c2d-3e4f5a6b7c8d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0040: Impact,n; o; n; e,7,"Has a non-standard process accessed the memory of a critical application and granted itself permissions to write memory or create a remote thread, immediately before that application made a network connection?","This question looks for a common attack chain where an adversary uses a utility like PowerShell to inject code into a legitimate, network-aware application (e.g., a database client). This allows the adversary's malicious code to run within the trusted process, inheriting its network permissions and firewall rules to manipulate or exfiltrate data. Correlating memory access with a subsequent network connection is key to identifying this specific behavior.
","Windows Event ID 4688; Sysmon Event ID 8; Sysmon Event ID 10; Windows Event ID 4656; Critical application servers (e.g., financial, ERP); Database servers; Developer workstations; User workstations handling sensitive data (e.g., finance, HR)",last 90 days,Pseudocode: ALERT IF (Sysmon EID 10 from non-allowlisted SourceImage to critical TargetImage with write/create-thread access) AND (subsequent network connection from TargetImage within 5s).,playbooks/attack/enterprise/T1565.002.yml
T1565.002: Transmitted Data Manipulation,a7b1c1d8-e9f0-4a1b-8c2d-3e4f5a6b7c8d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0040: Impact,n; o; n; e,8,Has a statistically rare instance of process memory access occurred on a host?,"This question aims to detect unusual process interaction by baselining which processes typically access the memory of other processes. An alert is generated for a triplet (source process, target process, access type) that has never been seen before or is extremely rare. This can uncover novel process injection techniques or the use of legitimate but uncommonly used tools for malicious purposes.
","Windows Event ID 4688; Sysmon Event ID 8; Sysmon Event ID 10; Windows Event ID 4656; Critical application servers (e.g., financial, ERP); Database servers; Developer workstations; User workstations handling sensitive data (e.g., finance, HR)",last 90 days,"Pseudocode: BASELINE frequency of (SourceImage, TargetImage, GrantedAccess) triplets per host. ALERT if a new observed triplet is previously unseen or in bottom 1% frequency.",playbooks/attack/enterprise/T1565.002.yml
T1565.002: Transmitted Data Manipulation,a7b1c1d8-e9f0-4a1b-8c2d-3e4f5a6b7c8d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0040: Impact,n; o; n; e,9,"Has a user's sequence of actions (logon, process creation, memory access, network connection) deviated significantly from their normal, learned behavior?","This question moves beyond single events to analyze the entire sequence of user actions. By modeling a user's typical workflow, a machine learning model can detect when a sequence of events is abnormal, even if each individual event is not inherently suspicious. For example, a user who normally never uses PowerShell to access a database client's memory would trigger an alert, indicating a potential account compromise or insider threat.
","Windows Event ID 4688; Sysmon Event ID 8; Sysmon Event ID 10; Windows Event ID 4656; Critical application servers (e.g., financial, ERP); Database servers; Developer workstations; User workstations handling sensitive data (e.g., finance, HR)",last 90 days,Pseudocode: MODEL user behavior by training a sequence-based autoencoder on event chains. ALERT if the reconstruction error for a new sequence exceeds the learned threshold.,playbooks/attack/enterprise/T1565.002.yml
T1565.002: Transmitted Data Manipulation,a7b1c1d8-e9f0-4a1b-8c2d-3e4f5a6b7c8d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0040: Impact,n; o; n; e,10,Has a TCP content gap been detected during a network session involving a critical application server?,"This question focuses on a specific network anomaly that can indicate data manipulation at the packet level. A 'content_gap' in Zeek means there is a discrepancy between the TCP sequence numbers and the actual data payload delivered. This can be a direct indicator of an adversary injecting, modifying, or dropping packets in transit, which is a core component of transmitted data manipulation.
",Zeek conn.log; Zeek http.log; Zeek files.log; Zeek weird.log; Data center network fabric; Connections between application and database tiers; Primary and backup data replication links,last 90 days,Pseudocode: ALERT IF Zeek weird.log shows 'name' == 'content_gap' AND session involves a critical application server IP.,playbooks/attack/enterprise/T1565.002.yml
T1565.002: Transmitted Data Manipulation,a7b1c1d8-e9f0-4a1b-8c2d-3e4f5a6b7c8d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0040: Impact,n; o; n; e,11,"Has the volume of data in a recurring, automated transfer between internal systems deviated significantly from its historical average?","This question is designed to detect anomalies in predictable, machine-to-machine data flows, such as database replication or batch file transfers. By establishing a tight baseline for the expected size of these transfers, a significant deviation (e.g., more than 3 standard deviations) can indicate that data is being illegitimately added (padded) or removed (truncated) in transit.
",Zeek conn.log; Zeek http.log; Zeek files.log; Zeek weird.log; Data center network fabric; Connections between application and database tiers; Primary and backup data replication links,last 90 days,"Pseudocode: FOR critical periodic data flows, BASELINE mean/stddev of total_bytes. ALERT if new transfer's total_bytes > (mean + 3 * stddev).",playbooks/attack/enterprise/T1565.002.yml
T1565.002: Transmitted Data Manipulation,a7b1c1d8-e9f0-4a1b-8c2d-3e4f5a6b7c8d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0040: Impact,n; o; n; e,12,"Using a time series model, has the volume of a high-value data flow shown an anomalous spike or drop?","This question applies a more sophisticated time series analysis to detect anomalies in data transfer volumes. Unlike a simple standard deviation check, models like SARIMA or Prophet can account for seasonality and trends in the data. This allows for more accurate detection of unexpected changes in traffic volume that could be caused by data manipulation, especially for flows that have complex but predictable patterns.
",Zeek conn.log; Zeek http.log; Zeek files.log; Zeek weird.log; Data center network fabric; Connections between application and database tiers; Primary and backup data replication links,last 90 days,"Pseudocode: AGGREGATE total bytes per minute for a data flow. TRAIN time series model (e.g., Prophet). ALERT if observed volume falls outside the model's predicted confidence interval.",playbooks/attack/enterprise/T1565.002.yml
T1565.002: Transmitted Data Manipulation,a7b1c1d8-e9f0-4a1b-8c2d-3e4f5a6b7c8d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0040: Impact,n; o; n; e,13,"Have any explicit data integrity errors, such as 'Checksum Mismatch' or 'Transaction Rollback', been logged by critical applications or databases?","This question looks for the most direct evidence of data manipulation: the applications themselves reporting that the data they received is corrupt or invalid. These error messages are high-fidelity indicators that the integrity of the data has been compromised at some point, and investigating them is critical.
","Application Logs; Database Logs; Zeek files.log; Windows Event Logs; File servers; Database servers logging transaction failures; Application servers processing data uploads; Systems participating in data replication (e.g., Domain Controllers, backup servers)",last 90 days,"Pseudocode: CREATE SIEM rule to ALERT on log messages containing strings like 'Data Integrity Error', 'Checksum validation failed', or 'Hash mismatch'.",playbooks/attack/enterprise/T1565.002.yml
T1565.002: Transmitted Data Manipulation,a7b1c1d8-e9f0-4a1b-8c2d-3e4f5a6b7c8d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0040: Impact,n; o; n; e,14,Has there been a statistically significant spike in the rate of data integrity errors on any single host?,"This question aims to detect a sudden increase in data integrity errors that might otherwise be lost in the noise of normal operations. By calculating a moving average of these errors, we can identify when the current error rate on a host is abnormally high (e.g., more than 4 standard deviations above average), which could signal an active attack or malfunction caused by data manipulation.
","Application Logs; Database Logs; Zeek files.log; Windows Event Logs; File servers; Database servers logging transaction failures; Application servers processing data uploads; Systems participating in data replication (e.g., Domain Controllers, backup servers)",last 90 days,Pseudocode: COUNT integrity errors per host per hour. CALCULATE 7-day moving average/stddev. ALERT if current hour's count > (moving_avg + 4 * stddev).,playbooks/attack/enterprise/T1565.002.yml
T1565.002: Transmitted Data Manipulation,a7b1c1d8-e9f0-4a1b-8c2d-3e4f5a6b7c8d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0040: Impact,n; o; n; e,15,Has an unsupervised anomaly detection model identified an unusual pattern or an enterprise-wide increase in the frequency of data integrity errors?,"This question uses machine learning to detect coordinated, low-and-slow attacks that might not trigger single-host statistical thresholds. An algorithm like Isolation Forest can analyze the time series of integrity errors across the entire enterprise and identify periods where the overall pattern is anomalous. This is effective for finding distributed attacks or subtle, widespread data corruption issues.
","Application Logs; Database Logs; Zeek files.log; Windows Event Logs; File servers; Database servers logging transaction failures; Application servers processing data uploads; Systems participating in data replication (e.g., Domain Controllers, backup servers)",last 90 days,Pseudocode: CREATE time series of enterprise-wide integrity errors per 5 minutes. APPLY Isolation Forest. ALERT on points flagged as anomalies.,playbooks/attack/enterprise/T1565.002.yml
T1566.003: Spearphishing via Service,3a4f8b1c-9d0e-4a6f-b8e7-1c2d3e4f5a6b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0001: Initial Access,n; o; n; e,1,Has a file downloaded from a third-party service been identified as malicious by threat intelligence?,"This question aims to directly identify known threats by correlating network download logs (Zeek files.log, http.log) from non-corporate, third-party services with high-confidence threat intelligence feeds. A match on a file hash or destination host provides a strong, direct indicator of a malicious file delivery attempt, allowing for rapid response.",Zeek files.log; Zeek http.log; Zeek conn.log; Network Security Monitoring (NSM) sensors at internet egress points; Centralized log aggregator (SIEM); Threat intelligence platform.,last 90 days,Search network file logs for downloads from third-party services. Correlate file hashes and destination hosts against threat intelligence feeds. Alert on matches.,playbooks/attack/enterprise/T1566.003.yml
T1566.003: Spearphishing via Service,3a4f8b1c-9d0e-4a6f-b8e7-1c2d3e4f5a6b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0001: Initial Access,n; o; n; e,2,Is there an anomalous spike in threat intelligence matches for downloads from a specific third-party service?,"This question seeks to identify a targeted campaign that may be leveraging a specific third-party service for payload delivery. By establishing a baseline of ""normal"" threat intelligence match rates for each service, a significant deviation from this baseline (e.g., exceeding the 99th percentile) can indicate a concentrated attack effort, even if the individual indicators are not new.",Zeek files.log; Zeek http.log; Zeek conn.log; Network Security Monitoring (NSM) sensors at internet egress points; Centralized log aggregator (SIEM); Threat intelligence platform.,last 90 days,"For each third-party service, calculate the hourly rate of threat intel matches. Compare this rate to a historical 30-day baseline. Alert if the current rate exceeds the 99th percentile.",playbooks/attack/enterprise/T1566.003.yml
T1566.003: Spearphishing via Service,3a4f8b1c-9d0e-4a6f-b8e7-1c2d3e4f5a6b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0001: Initial Access,n; o; n; e,3,Has a machine learning model predicted that a file downloaded from a third-party service is malicious?,"This question leverages a predictive approach to identify potentially unknown or zero-day threats. By training a classification model on various features from network logs (MIME type, file size, domain reputation, etc.), it is possible to score downloads for maliciousness in near real-time. An alert on a high-confidence score can surface threats that might be missed by signature-based detection alone.",Zeek files.log; Zeek http.log; Zeek conn.log; Network Security Monitoring (NSM) sensors at internet egress points; Centralized log aggregator (SIEM); Threat intelligence platform.,last 90 days,Score all file downloads from third-party services using a trained ML model. Alert on any download with a malicious score > 0.90.,playbooks/attack/enterprise/T1566.003.yml
T1566.003: Spearphishing via Service,3a4f8b1c-9d0e-4a6f-b8e7-1c2d3e4f5a6b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0001: Initial Access,n; o; n; e,4,Did an office application spawn a shell or scripting engine shortly after a file was downloaded from a third-party service?,This question identifies a classic malware execution pattern. Legitimate office applications rarely spawn command-line interpreters like powershell.exe or cmd.exe. Correlating a file download from a web service with this suspicious post-execution behavior on the endpoint within a short time window (5 minutes) strongly indicates that a malicious document or payload was opened by the user.,Windows Event ID 4688; Zeek files.log; Zeek http.log; Endpoint Detection and Response (EDR) agents on user workstations; Virtual Desktop Infrastructure (VDI) environment; Centralized Security Information and Event Management (SIEM) system.,last 90 days,Correlate network download logs from third-party services with endpoint process creation logs. Alert if an office process spawns a shell/scripting process on the same host within 5 minutes of the download.,playbooks/attack/enterprise/T1566.003.yml
T1566.003: Spearphishing via Service,3a4f8b1c-9d0e-4a6f-b8e7-1c2d3e4f5a6b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0001: Initial Access,n; o; n; e,5,Has an office application spawned an anomalous child process or a process with unusually complex command-line arguments after a download from a third-party service?,"This question aims to detect stealthier execution techniques by baselining normal user and application behavior. Adversaries may use legitimate but unusual process chains. By profiling what child processes are normally spawned by parent processes like winword.exe for each user, any deviation from this baseline—such as a new child process or one with abnormally high command-line entropy—can signal malicious activity.",Windows Event ID 4688; Zeek files.log; Zeek http.log; Endpoint Detection and Response (EDR) agents on user workstations; Virtual Desktop Infrastructure (VDI) environment; Centralized Security Information and Event Management (SIEM) system.,last 90 days,"Following a third-party download, compare child processes spawned by office applications against a 90-day user/parent process baseline. Alert on new child processes or command-line entropy > 3 standard deviations from the norm.",playbooks/attack/enterprise/T1566.003.yml
T1566.003: Spearphishing via Service,3a4f8b1c-9d0e-4a6f-b8e7-1c2d3e4f5a6b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0001: Initial Access,n; o; n; e,6,"Following a download from a third-party service, did a graph-based model identify the subsequent process execution chain as a high-scoring anomaly?","This question uses advanced analytics to detect sophisticated attacks. By modeling entire process execution trees (parent-child-grandchild relationships) as a graph, it becomes possible to identify anomalous chains that might appear benign when looking at individual process pairs. A high anomaly score for a process tree originating from an office application after a download is a strong indicator of a complex, multi-stage payload execution.",Windows Event ID 4688; Zeek files.log; Zeek http.log; Endpoint Detection and Response (EDR) agents on user workstations; Virtual Desktop Infrastructure (VDI) environment; Centralized Security information and Event Management (SIEM) system.,last 90 days,"After a third-party download, analyze the subsequent process tree on the endpoint using a graph anomaly detection model. Alert on any chain originating from an office app that is flagged as a high-scoring outlier.",playbooks/attack/enterprise/T1566.003.yml
T1566.003: Spearphishing via Service,3a4f8b1c-9d0e-4a6f-b8e7-1c2d3e4f5a6b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0001: Initial Access,n; o; n; e,7,"Was a file with a high-risk file type or a deceptive filename (e.g., double extension) downloaded from a third-party service?","This question targets common social engineering tricks used in filenames and file types. Adversaries often use double extensions (e.g., report.pdf.exe) to disguise executable files or use high-risk types like HTA files or macro-enabled documents. Directly alerting on the download of such files from external services provides an early warning of a potential spearphishing attempt before the user even executes the file.",Zeek files.log; Zeek http.log; Network Security Monitoring (NSM) sensors at the network perimeter; Web content filters; Centralized log aggregator (SIEM).,last 90 days,Monitor file download logs from third-party services. Alert if filename matches a double-extension regex or if the MIME type is on a high-risk blocklist.,playbooks/attack/enterprise/T1566.003.yml
T1566.003: Spearphishing via Service,3a4f8b1c-9d0e-4a6f-b8e7-1c2d3e4f5a6b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0001: Initial Access,n; o; n; e,8,Is there an anomalous increase in the proportion of high-risk file types being downloaded from a specific third-party service?,"This question helps detect a potential campaign focused on a specific service. While occasional high-risk file downloads might be normal, a sudden surge in their proportion relative to benign files from a single service is abnormal. Exceeding a statistical threshold (98th percentile) of the historical baseline suggests a targeted attack leveraging that service.",Zeek files.log; Zeek http.log; Network Security Monitoring (NSM) sensors at the network perimeter; Web content filters; Centralized log aggregator (SIEM).,last 90 days,"For each third-party service, calculate the hourly proportion of high-risk vs. benign MIME types. Compare to a 30-day baseline. Alert if the proportion exceeds the 98th percentile.",playbooks/attack/enterprise/T1566.003.yml
T1566.003: Spearphishing via Service,3a4f8b1c-9d0e-4a6f-b8e7-1c2d3e4f5a6b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0001: Initial Access,n; o; n; e,9,"Has a machine learning model, based on file metadata, predicted a high probability of malicious intent for a file downloaded from a third-party service?","This question uses predictive analytics on file characteristics to spot malicious downloads. Features like filename entropy, length, and the presence of keywords like 'invoice' or 'urgent', combined with MIME type, can be powerful predictors of maliciousness. A model trained on this metadata can flag suspicious files for review, even if the file hash is not yet known to be malicious.",Zeek files.log; Zeek http.log; Network Security Monitoring (NSM) sensors at the network perimeter; Web content filters; Centralized log aggregator (SIEM).,last 90 days,"Score all files from third-party services using an ML model trained on file metadata (name, entropy, keywords, MIME type). Flag files with a high malicious probability score.",playbooks/attack/enterprise/T1566.003.yml
T1566.003: Spearphishing via Service,3a4f8b1c-9d0e-4a6f-b8e7-1c2d3e4f5a6b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0001: Initial Access,n; o; n; e,10,Did a host connect to a newly registered domain (NRD) within 5 minutes of downloading a file from a third-party service?,"This question links a potential malware download to subsequent command-and-control (C2) activity. Adversaries frequently use newly registered domains for C2 infrastructure. Detecting a connection to a domain less than 30 days old, immediately following a file download from an external service, is a very strong indicator that the downloaded file was malicious and has initiated a callback.",Zeek files.log; Zeek conn.log; Zeek dns.log; DNS logs from internal resolvers; Firewall logs from egress points; Network Security Monitoring (NSM) sensors; Threat intelligence feeds.,last 90 days,Correlate file downloads from third-party services with subsequent DNS queries from the same host. Enrich DNS queries with WHOIS data. Alert if a query is made to a domain <30 days old within 5 minutes of the download.,playbooks/attack/enterprise/T1566.003.yml
T1566.003: Spearphishing via Service,3a4f8b1c-9d0e-4a6f-b8e7-1c2d3e4f5a6b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0001: Initial Access,n; o; n; e,11,"Following a file download from a third-party service, did the host query a rare domain with high character entropy?","This question aims to detect algorithmically generated domains (DGAs), a common technique for C2 communication. DGA domains often appear as random, high-entropy strings. Identifying a DNS query for a domain that is both rare for the organization and has high entropy, shortly after a file download, strongly suggests malware attempting to contact its C2 server.",Zeek files.log; Zeek conn.log; Zeek dns.log; DNS logs from internal resolvers; Firewall logs from egress points; Network Security Monitoring (NSM) sensors; Threat intelligence feeds.,last 90 days,"After a third-party download, analyze DNS queries from the host. Calculate domain name entropy. Alert if entropy is > 3.5 and the domain is not in the top 95% of historically accessed domains.",playbooks/attack/enterprise/T1566.003.yml
T1566.003: Spearphishing via Service,3a4f8b1c-9d0e-4a6f-b8e7-1c2d3e4f5a6b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0001: Initial Access,n; o; n; e,12,"After a file download from a third-party service, did the host exhibit an anomalous increase in outbound network traffic compared to its forecast?","This question seeks to identify C2 beaconing or data exfiltration by looking for changes in the volume of network traffic. By creating a time series forecast of a host's normal outbound traffic, any significant, unexpected spike after a file download can indicate malicious activity. This method can catch beaconing that uses common ports and protocols, which might otherwise be missed.",Zeek files.log; Zeek conn.log; Zeek dns.log; DNS logs from internal resolvers; Firewall logs from egress points; Network Security Monitoring (NSM) sensors; Threat intelligence feeds.,last 90 days,"Model a host's expected outbound traffic volume using a time series forecast. After a third-party download, compare actual outbound traffic to the forecast. Alert on significant positive deviations.",playbooks/attack/enterprise/T1566.003.yml
T1566.003: Spearphishing via Service,3a4f8b1c-9d0e-4a6f-b8e7-1c2d3e4f5a6b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0001: Initial Access,n; o; n; e,13,Have an unusually large number of hosts downloaded the exact same file from a third-party service in a short timeframe?,"This question is designed to detect the 'fan-out' of a coordinated spearphishing campaign. It is highly unusual for more than a few hosts to download the identical file (same hash) from a service like personal webmail within an hour. Detecting this pattern, for example, with a threshold of >10 hosts, is a powerful indicator of a widespread, targeted attack in progress.",Zeek http.log; Zeek files.log; Zeek conn.log; Centralized logging infrastructure (SIEM); Network traffic monitoring points at the network perimeter.,last 90 days,"Count the number of distinct internal IPs downloading the same file hash from a third-party service within a one-hour window. Alert if the count exceeds a set threshold (e.g., 10).",playbooks/attack/enterprise/T1566.003.yml
T1566.003: Spearphishing via Service,3a4f8b1c-9d0e-4a6f-b8e7-1c2d3e4f5a6b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0001: Initial Access,n; o; n; e,14,Is there a statistically significant spike in the number of unique hosts connecting to a specific third-party service?,"This question identifies a coordinated campaign by observing anomalous access patterns to the service itself. A threat actor might direct many users to the same service to download different payloads. A sudden surge in unique internal hosts connecting to that service, exceeding a statistical baseline by several standard deviations, can reveal the campaign's delivery infrastructure.",Zeek http.log; Zeek files.log; Zeek conn.log; Centralized logging infrastructure (SIEM); Network traffic monitoring points at the network perimeter.,last 90 days,Establish a 30-day baseline of unique source IPs connecting to each third-party service per hour. Alert if the current hourly count exceeds the baseline by >3 standard deviations.,playbooks/attack/enterprise/T1566.003.yml
T1566.003: Spearphishing via Service,3a4f8b1c-9d0e-4a6f-b8e7-1c2d3e4f5a6b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0001: Initial Access,n; o; n; e,15,"Has a clustering algorithm detected an anomalous, dense grouping of connections from many internal hosts to a new or rare third-party service?",This question uses unsupervised machine learning to discover coordinated access patterns. A density-based algorithm like DBSCAN can analyze connection data and identify clusters. A dense cluster showing many unique internal hosts all connecting to a previously uncommon third-party domain in a tight time window is a strong signal of a campaign staging or delivery point.,Zeek http.log; Zeek files.log; Zeek conn.log; Centralized logging infrastructure (SIEM); Network traffic monitoring points at the network perimeter.,last 90 days,"Apply a density-based clustering algorithm (e.g., DBSCAN) to network connection logs. Flag dense clusters showing many unique source IPs connecting to the same rare/new third-party service in a short time.",playbooks/attack/enterprise/T1566.003.yml
T1567.001: Exfiltration to Code Repository,f9e7b3a0-1c6d-4b8a-9e0f-1a2b3c4d5e6f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,1,Have any network connections been made to code repository domains or IPs flagged by threat intelligence?,This question aims to detect direct connections to known malicious or suspicious code repository infrastructure. Adversaries may use compromised or purpose-built repositories for data exfiltration. Matching network logs against a threat intelligence feed provides a high-fidelity signal for this specific TTP.,Zeek conn.log; Zeek ssl.log; Zeek dns.log; Internet Gateway; DNS Resolvers; Egress Proxies,last 90 days,"SEARCH network_logs (dns, ssl, conn) WHERE destination_ip OR destination_domain IN threat_intel_feed_of_code_repos;",playbooks/attack/enterprise/T1567.001.yml
T1567.001: Exfiltration to Code Repository,f9e7b3a0-1c6d-4b8a-9e0f-1a2b3c4d5e6f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,2,Are any hosts connecting to statistically rare or uncommon code repository domains compared to the rest of the enterprise?,"This question helps identify outlier activity. If only a few hosts are connecting to a specific code repository, it could indicate unauthorized or malicious activity, as legitimate development work often involves common, widely-used repositories. This is a statistical approach to find needles in the haystack without relying solely on known-bad indicators.",Zeek ssl.log; Internet Gateway; DNS Resolvers; Egress Proxies,last 90 days,SEARCH ssl_logs | GROUPBY server_name | CALCULATE host_count_per_domain | FILTER domain is_code_repo AND host_count < 1st_percentile_of_all_repo_counts;,playbooks/attack/enterprise/T1567.001.yml
T1567.001: Exfiltration to Code Repository,f9e7b3a0-1c6d-4b8a-9e0f-1a2b3c4d5e6f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,3,Have any new code repository domains been observed that have characteristics of malicious domains?,"This question proactively identifies potentially malicious, newly created code repository domains that may not yet be on threat intelligence feeds. By analyzing features like domain name entropy, age, and DNS history, a machine learning model can score the likelihood of a domain being malicious, enabling detection of emergent threats.",Zeek ssl.log; WHOIS data; Passive DNS; Internet Gateway; DNS Resolvers; Egress Proxies,last 90 days,"FOR each new_domain in ssl_logs | IF is_code_repo(new_domain) | SCORE domain_features (entropy, age, etc.) with ML_model | ALERT if score > threshold;",playbooks/attack/enterprise/T1567.001.yml
T1567.001: Exfiltration to Code Repository,f9e7b3a0-1c6d-4b8a-9e0f-1a2b3c4d5e6f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,4,Has any host executed a data archiving command followed by a 'git push' command within a short time frame?,This question looks for the common adversary pattern of staging and exfiltrating data. An adversary will often compress sensitive data into a single archive file before pushing it to a remote repository. Detecting this specific sequence of events on a host is a strong indicator of potential data exfiltration.,Windows Event ID 4688; Developer Workstations; Build Servers; CI/CD Pipeline Servers,last 90 days,"SEARCH process_events (EID 4688) | SEQUENCE by host, user [process is archive_tool] followed by [process is 'git.exe' and command_line contains 'push'] within 5 minutes;",playbooks/attack/enterprise/T1567.001.yml
T1567.001: Exfiltration to Code Repository,f9e7b3a0-1c6d-4b8a-9e0f-1a2b3c4d5e6f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,5,"Has an unusual or rare sequence of data archiving followed by a 'git push' occurred on any host, based on its historical behavior?","This question identifies anomalous process sequences on a per-host basis. While a developer might occasionally archive and push code, a sequence that is highly unusual for a specific host or user could signal malicious activity. This statistical approach helps differentiate between normal developer workflow and potential data theft.",Windows Event ID 4688; Developer Workstations; Build Servers; CI/CD Pipeline Servers,last 90 days,FOR each host | BASELINE frequency of (archive_tool -> git_push) sequence | SEARCH process_events | ALERT if observed sequence frequency is in bottom 5th percentile of baseline;,playbooks/attack/enterprise/T1567.001.yml
T1567.001: Exfiltration to Code Repository,f9e7b3a0-1c6d-4b8a-9e0f-1a2b3c4d5e6f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,6,Has a machine learning model detected an anomalous sequence of process executions involving data archiving and a 'git push'?,This question leverages advanced sequence analysis to detect sophisticated attacks. A model trained on normal process activity can identify subtle deviations that might indicate a malicious actor attempting to hide their actions. An alert on a low-probability sequence involving archiving and git pushing provides a data-driven signal of a potential threat.,Windows Event ID 4688; Developer Workstations; Build Servers; CI/CD Pipeline Servers,last 90 days,FOR each new_process_sequence on host | SCORE sequence with RNN/HMM model | IF sequence contains (archive -> git_push) and score is low_probability | ALERT;,playbooks/attack/enterprise/T1567.001.yml
T1567.001: Exfiltration to Code Repository,f9e7b3a0-1c6d-4b8a-9e0f-1a2b3c4d5e6f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,7,"Has there been any large, single network session to a code repository where the amount of data sent was significantly greater than the data received?","This question targets bulk data exfiltration. A normal 'git push' might involve sending a moderate amount of data, but a session where hundreds of megabytes are sent with very little data received in return is highly suspicious. This rule looks for this asymmetric data flow, which is a classic indicator of data being uploaded or exfiltrated.",Zeek conn.log; Internet Gateway; Core Network Taps,last 90 days,SEARCH conn_logs WHERE destination is_code_repo AND sent_bytes > 100MB AND (sent_bytes / received_bytes) > 10;,playbooks/attack/enterprise/T1567.001.yml
T1567.001: Exfiltration to Code Repository,f9e7b3a0-1c6d-4b8a-9e0f-1a2b3c4d5e6f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,8,Has any host sent an anomalously large volume of data to code repositories today compared to its own 30-day baseline?,"This question helps detect unusual spikes in data exfiltration on a per-host basis. By establishing what is 'normal' for each host's daily upload volume to code repositories, we can automatically flag days where the activity is statistically significant. This helps catch exfiltration that might be spread across multiple connections but is anomalous in total volume.",Zeek conn.log; Internet Gateway; Core Network Taps,last 90 days,"FOR each host | CALCULATE 30-day_baseline (mean, stddev) of daily_upload_volume_to_repos | IF today_volume > (mean + 3*stddev) | ALERT;",playbooks/attack/enterprise/T1567.001.yml
T1567.001: Exfiltration to Code Repository,f9e7b3a0-1c6d-4b8a-9e0f-1a2b3c4d5e6f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,9,Has a time series model forecasted that today's outbound data volume to code repositories is significantly higher than expected for a given host?,"This question uses predictive analytics to identify abnormal data transfers. Unlike a simple standard deviation, a time series model can account for trends, seasonality, and other complex patterns in a host's behavior. An alert from this model indicates that the current data volume is not just high, but unexpectedly high given its recent historical context.",Zeek conn.log; Internet Gateway; Core Network Taps,last 90 days,FOR each host | FORECAST expected_upload_volume_range with ARIMA_model | IF actual_volume > upper_bound_of_forecast | ALERT;,playbooks/attack/enterprise/T1567.001.yml
T1567.001: Exfiltration to Code Repository,f9e7b3a0-1c6d-4b8a-9e0f-1a2b3c4d5e6f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,10,Has a user or host not explicitly authorized for development activity connected to an external code repository?,"This question enforces policy-based access control as a detection mechanism. By defining which users and groups (e.g., 'Developers') are allowed to access code repositories, any connection from an unauthorized entity (e.g., a user from the 'Marketing' department) is an immediate policy violation and a strong indicator of a compromised account or insider threat.",Zeek conn.log; Windows Event ID 4624; Windows Event ID 4688; Domain Controllers; Endpoint Devices (All Departments); Identity and Access Management (IAM) Systems,last 90 days,SEARCH network_connections to code_repos | CORRELATE with user_logon_data and AD_group_membership | ALERT if user_group NOT IN developer_allow_list;,playbooks/attack/enterprise/T1567.001.yml
T1567.001: Exfiltration to Code Repository,f9e7b3a0-1c6d-4b8a-9e0f-1a2b3c4d5e6f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,11,"Has any user's web browsing behavior shown an anomalous increase in variety, specifically involving a new connection to a code repository?","This question seeks to identify behavioral changes in a user's network activity. A user typically visits a relatively stable set of domains. A sudden increase in the variety (entropy) of domains visited, especially when the new domain is a code repository, can indicate that the user's account has been compromised and is being used for activities outside its normal profile.",Zeek ssl.log; Domain Controllers; Endpoint Devices (All Departments); Identity and Access Management (IAM) Systems,last 90 days,"FOR each user | CALCULATE 30-day_baseline (mean, stddev) of daily_domain_entropy | IF today_entropy > (mean + 2*stddev) AND new_domain is_code_repo | ALERT;",playbooks/attack/enterprise/T1567.001.yml
T1567.001: Exfiltration to Code Repository,f9e7b3a0-1c6d-4b8a-9e0f-1a2b3c4d5e6f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,12,Are any users whose overall network behavior profiles them as 'non-technical' making connections to code repositories?,"This question uses unsupervised machine learning to find users acting outside their peer group. By clustering users based on their typical network activity, we can establish behavioral profiles (e.g., 'Sales', 'Engineering'). A user who belongs to a non-technical cluster but suddenly connects to a code repository is a cross-cluster anomaly, suggesting a potential account takeover or policy violation.",Zeek conn.log; Zeek ssl.log; Domain Controllers; Endpoint Devices (All Departments); Identity and Access Management (IAM) Systems,last 90 days,CLUSTER users based on network_activity_features | FOR each user in non_technical_cluster | IF user connects_to_code_repo | ALERT as cross-cluster_anomaly;,playbooks/attack/enterprise/T1567.001.yml
T1567.001: Exfiltration to Code Repository,f9e7b3a0-1c6d-4b8a-9e0f-1a2b3c4d5e6f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,13,Has a known Living-Off-the-Land Binary (LOLBin) initiated a network connection to a code repository?,"This question focuses on detecting the abuse of legitimate system tools for malicious purposes. Adversaries use LOLBins like 'powershell.exe' or 'cscript.exe' to evade defenses. A connection to a code repository from one of these processes, instead of a standard developer tool like 'git.exe', is highly indicative of malicious activity and an attempt to exfiltrate data covertly.",Windows Event ID 5156; Windows Event ID 4688; All Endpoint Devices and Servers,last 90 days,SEARCH network_connection_events (EID 5156) WHERE process_name IN LOLBin_list AND destination_ip is_code_repo;,playbooks/attack/enterprise/T1567.001.yml
T1567.001: Exfiltration to Code Repository,f9e7b3a0-1c6d-4b8a-9e0f-1a2b3c4d5e6f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,14,"Has any process that is not an approved developer tool made a new, never-before-seen connection to a code repository from a specific host?","This question establishes a baseline of normal process-to-destination network behavior on a per-host basis. It helps detect when a process communicates with a code repository for the first time. This is especially powerful for identifying when a legitimate but non-developer tool (e.g., 'winword.exe') is compromised and used to exfiltrate data, as this behavior would be a clear deviation from its established baseline.",Windows Event ID 5156; Windows Event ID 4688; All Endpoint Devices and Servers,last 90 days,"FOR each host | BASELINE known (process, destination_ip) pairs | SEARCH new_connection_events | IF (process, destination_ip) is new AND destination_ip is_code_repo AND process NOT IN dev_tool_allow_list | ALERT;",playbooks/attack/enterprise/T1567.001.yml
T1567.001: Exfiltration to Code Repository,f9e7b3a0-1c6d-4b8a-9e0f-1a2b3c4d5e6f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,15,Has a machine learning model detected an anomalous network connection to a code repository based on the initiating process and connection details?,"This question uses anomaly detection to identify unusual network connections originating from a host. A One-Class SVM model learns the 'normal' boundary of network activity for a host. Any connection that falls outside this boundary, particularly one destined for a code repository, is flagged as an anomaly. This can catch novel or sophisticated attempts to use unexpected processes for data exfiltration.",Windows Event ID 5156; Windows Event ID 4688; All Endpoint Devices and Servers,last 90 days,FOR each host | TRAIN one-class_SVM_model on normal_connection_features | FOR each new_connection | IF model_classifies as anomaly AND destination is_code_repo | ALERT;,playbooks/attack/enterprise/T1567.001.yml
T1567: Exfiltration Over Web Service,f9d9d3a7-6b6f-4a0e-8c3b-2d1f0e9b8c7a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,1,Are outbound network connections being made to destinations known to be malicious or associated with data exfiltration?,"This question aims to identify direct evidence of data exfiltration by correlating network logs (DNS, HTTP/S, general connections) with threat intelligence feeds. A match provides a high-confidence signal that an internal host is communicating with an adversary-controlled infrastructure for exfiltration purposes.",Zeek conn.log; Zeek http.log; Zeek ssl.log; Zeek dns.log; Internet Gateway Firewalls; DNS Resolvers; Web Proxies; Network Security Monitoring Sensors,last 90 days,"SEARCH (Zeek conn.log OR dns.log OR http.log OR ssl.log) | JOIN destination_ip, domain, server_name WITH threat_intelligence_feed ON indicator | WHERE match_found",playbooks/attack/enterprise/T1567.yml
T1567: Exfiltration Over Web Service,f9d9d3a7-6b6f-4a0e-8c3b-2d1f0e9b8c7a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,2,"Are there any newly observed external domains being contacted by a very small number of internal hosts, suggesting targeted or non-widespread activity?","This question seeks to uncover potentially malicious domains that are not yet present in threat intelligence feeds. By calculating the prevalence of a domain across the internal network, we can flag domains with very low prevalence as suspicious. This could indicate a newly registered C2 domain or a specific exfiltration endpoint used by an adversary against a limited set of targets.",Zeek conn.log; Zeek dns.log; Zeek http.log; Zeek ssl.log; Internet Gateway Firewalls; DNS Resolvers; Web Proxies; Network Security Monitoring Sensors,last 90 days,SEARCH (Zeek dns.log OR http.log) | CALCULATE prevalence_score = (distinct_source_hosts / total_internal_hosts) over 24h | FILTER prevalence_score < 0.01,playbooks/attack/enterprise/T1567.yml
T1567: Exfiltration Over Web Service,f9d9d3a7-6b6f-4a0e-8c3b-2d1f0e9b8c7a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,3,Are hosts attempting to resolve or connect to domains that are algorithmically generated (DGA) or have a poor reputation?,"This question uses machine learning to proactively identify malicious domains. DGA detection models can spot patterns indicative of malware C2 channels, while domain reputation models assess risk based on factors like age and registration details. This helps find threats without relying on known bad indicators.",Zeek dns.log; Internet Gateway Firewalls; DNS Resolvers; Web Proxies; Network Security Monitoring Sensors,last 90 days,"SEARCH Zeek dns.log | APPLY dga_detection_model to query | APPLY domain_reputation_model to query | FILTER classification == ""dga"" OR reputation_score < ""suspicious_threshold""",playbooks/attack/enterprise/T1567.yml
T1567: Exfiltration Over Web Service,f9d9d3a7-6b6f-4a0e-8c3b-2d1f0e9b8c7a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,4,"Are non-interactive command-line tools (e.g., curl, wget) being used to make outbound HTTP/S requests from non-interactive shells?","This question looks for the use of common data transfer utilities, like cURL or Wget, which are often used by adversaries for scripted exfiltration. By correlating network traffic showing these tools' User-Agents with process logs on the source host, we can confirm if a non-interactive process (like cmd.exe or powershell.exe) initiated the transfer, which is highly suspicious for a user workstation.",Zeek http.log; Zeek ssl.log; Windows Event ID 4688; Endpoints (Workstations and Servers); Application Servers; DMZ Web Servers; API Gateways,last 90 days,"SEARCH Zeek http.log WHERE user_agent matches ('curl', 'wget', 'python-requests') | CORRELATE source_ip, timestamp with Windows Event ID 4688 logs | FILTER parent_process in ('cmd.exe', 'powershell.exe')",playbooks/attack/enterprise/T1567.yml
T1567: Exfiltration Over Web Service,f9d9d3a7-6b6f-4a0e-8c3b-2d1f0e9b8c7a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,5,"Are there rare or uncommon User-Agent strings observed in outbound web traffic, suggesting the use of non-standard software?","This question identifies anomalous software by baselining User-Agent strings across the enterprise. A User-Agent seen on a very small percentage of hosts could indicate custom malware, a specialized hacking tool, or unauthorized software being used for exfiltration.",Zeek http.log; Endpoints (Workstations and Servers); Application Servers; DMZ Web Servers; API Gateways,last 90 days,SEARCH Zeek http.log | CALCULATE rarity of user_agent over 30 days | FILTER host_count_for_user_agent < (0.005 * total_endpoints),playbooks/attack/enterprise/T1567.yml
T1567: Exfiltration Over Web Service,f9d9d3a7-6b6f-4a0e-8c3b-2d1f0e9b8c7a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,6,Can we detect web traffic originating from non-browser applications on standard user workstations using a machine learning model?,This question applies a classification model to distinguish between legitimate browser traffic and traffic from other applications based on User-Agent string characteristics. Flagging 'non-browser' traffic from workstations provides a scalable way to find potentially unauthorized or malicious data transfers that might otherwise be missed.,Zeek http.log; Endpoints (Workstations and Servers); Application Servers; DMZ Web Servers; API Gateways,last 90 days,"SEARCH Zeek http.log from user_workstations | APPLY user_agent_classifier_model | FILTER classification == ""non-browser""",playbooks/attack/enterprise/T1567.yml
T1567: Exfiltration Over Web Service,f9d9d3a7-6b6f-4a0e-8c3b-2d1f0e9b8c7a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,7,"Are there any outbound web connections with a highly asymmetric data flow, where the amount of data sent is significantly larger than the data received?","This question targets a classic sign of data exfiltration: large uploads with minimal downloads. A simple rule checking for a high ratio of sent-to-received bytes, combined with a minimum total volume, can effectively catch bulk data transfers disguised as web traffic.",Zeek conn.log; Zeek http.log; Internet Gateway; Core Network Switches; Servers hosting sensitive data; Database Servers,last 90 days,SEARCH Zeek conn.log | FILTER (orig_bytes > 20 * resp_bytes) AND (orig_bytes > 50MB),playbooks/attack/enterprise/T1567.yml
T1567: Exfiltration Over Web Service,f9d9d3a7-6b6f-4a0e-8c3b-2d1f0e9b8c7a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,8,Do any web connections exhibit data upload volumes or byte ratios that are statistically anomalous compared to their historical baseline?,"This question moves beyond static thresholds by creating dynamic baselines for each host-destination pair. It identifies deviations from normal behavior, such as a host suddenly sending a much larger HTTP POST request to a specific website than it ever has before. This is effective at finding subtle exfiltration that might not trigger a simple high-volume alert.",Zeek conn.log; Zeek http.log; Internet Gateway; Core Network Switches; Servers hosting sensitive data; Database Servers,last 90 days,SEARCH (Zeek conn.log OR http.log) | COMPARE current_orig_bytes_ratio OR current_request_body_len WITH 30-day_98th_percentile_baseline for host-destination_pair | FILTER current > baseline,playbooks/attack/enterprise/T1567.yml
T1567: Exfiltration Over Web Service,f9d9d3a7-6b6f-4a0e-8c3b-2d1f0e9b8c7a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,9,Is any host's total hourly outbound data volume significantly exceeding its predicted normal amount based on a time-series forecast?,"This question uses time-series forecasting to model the normal 'rhythm' of a host's data output, including daily and weekly patterns. An alert is triggered when the actual data volume deviates significantly from this learned pattern, which can detect bulk exfiltration events that occur at unusual times or in unusual amounts.",Zeek conn.log; Zeek http.log; Internet Gateway; Core Network Switches; Servers hosting sensitive data; Database Servers,last 90 days,FOR_EACH host | APPLY time-series_forecasting_model to outbound_volume_per_hour | FILTER actual_volume > predicted_upper_confidence_bound,playbooks/attack/enterprise/T1567.yml
T1567: Exfiltration Over Web Service,f9d9d3a7-6b6f-4a0e-8c3b-2d1f0e9b8c7a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,10,Are processes not on an approved list of web-enabled applications making outbound connections over ports 80 or 443?,"This question aims to identify unauthorized software making web connections. By correlating process creation events with network connection events on an endpoint, we can pinpoint the exact process responsible for the traffic. If that process is not an approved browser or other legitimate application, it is highly suspicious and could be malware exfiltrating data.",Zeek conn.log; Windows Event ID 4688; Windows Event ID 5156; Domain Controllers; File Servers; User Workstations; Critical System Servers; Developer Machines,last 90 days,SEARCH Windows Event ID 5156 (port 80/443) | JOIN ProcessID with Windows Event ID 4688 | FILTER Process_Image_Name NOT IN approved_app_list,playbooks/attack/enterprise/T1567.yml
T1567: Exfiltration Over Web Service,f9d9d3a7-6b6f-4a0e-8c3b-2d1f0e9b8c7a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,11,"Is any running process exhibiting network behavior (e.g., data volume, number of destinations) that deviates significantly from its own historical baseline?","This question profiles the normal network activity for every process. It can detect when a legitimate, but compromised, process (like powershell.exe) begins acting abnormally, such as sending more data or connecting to more destinations than it usually does. This helps spot abuse of legitimate tools.",Zeek conn.log; Windows Event ID 4688; Windows Event ID 5156; Domain Controllers; File Servers; User Workstations; Critical System Servers; Developer Machines,last 90 days,"FOR_EACH process_name | CALCULATE baseline of network_behavior (mean/stddev of bytes, destinations) | FILTER current_activity > (baseline_mean + 3 * baseline_stddev)",playbooks/attack/enterprise/T1567.yml
T1567: Exfiltration Over Web Service,f9d9d3a7-6b6f-4a0e-8c3b-2d1f0e9b8c7a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,12,Can we identify anomalous process executions related to network activity using clustering algorithms?,This question uses unsupervised machine learning to group normal process activities into clusters. Any process activity that doesn't fit into an established cluster (an outlier) is flagged for review. This is useful for finding novel or unusual execution chains that an adversary might use to initiate a network connection for exfiltration.,Zeek conn.log; Windows Event ID 4688; Windows Event ID 5156; Domain Controllers; File Servers; User Workstations; Critical System Servers; Developer Machines,last 90 days,"SEARCH process_execution_data | APPLY clustering_model on features (process_name, parent_process, cmd_line, net_conn_count) | FILTER classification == ""outlier""",playbooks/attack/enterprise/T1567.yml
T1567: Exfiltration Over Web Service,f9d9d3a7-6b6f-4a0e-8c3b-2d1f0e9b8c7a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,13,"Are any hosts making outbound web connections to a single destination with highly regular time intervals, indicative of automated beaconing?","This question searches for the classic 'heartbeat' of malware command and control (C2) or automated exfiltration scripts. A sustained series of connections to the same destination with a nearly constant delay between them (e.g., every 5 minutes) is unnatural for human behavior and is a strong indicator of an automated process.",Zeek conn.log; All internal network segments; VPN Concentrators; Remote Access Servers; IoT/OT Network Segments,last 90 days,"SEARCH Zeek conn.log | GROUP by source_ip, dest_ip, dest_port | CALCULATE time_delta between connections | FILTER count > 10 AND stddev(time_delta) < 5_seconds",playbooks/attack/enterprise/T1567.yml
T1567: Exfiltration Over Web Service,f9d9d3a7-6b6f-4a0e-8c3b-2d1f0e9b8c7a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,14,Are hosts exhibiting strong connection periodicity or making an unusual number of connections during off-hours?,"This question uses statistics to find beaconing and other automated activity. A low standard deviation in the time between connections indicates regularity. Additionally, profiling normal connection times for a host allows for the detection of anomalous activity during hours when the user is typically inactive, such as overnight.",Zeek conn.log; All internal network segments; VPN Concentrators; Remote Access Servers; IoT/OT Network Segments,last 90 days,"SEARCH Zeek conn.log | CALCULATE stddev of time_deltas per source-dest pair | FILTER stddev < 5_seconds OR (connection_count > threshold AND hour IN (1,2,3,4,5))",playbooks/attack/enterprise/T1567.yml
T1567: Exfiltration Over Web Service,f9d9d3a7-6b6f-4a0e-8c3b-2d1f0e9b8c7a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,15,Can a time-series anomaly detection model identify sequences of network connections that deviate from a host's normal learned patterns?,"This question employs a sophisticated machine learning model (like an LSTM autoencoder) to learn the complex temporal patterns of a host's network activity. The model can detect subtle anomalies in the sequence, frequency, and timing of connections that would be missed by simpler statistical methods, providing a powerful way to uncover novel C2 channels.",Zeek conn.log; All internal network segments; VPN Concentrators; Remote Access Servers; IoT/OT Network Segments,last 90 days,FOR_EACH host | APPLY LSTM_autoencoder_model to connection_event_stream | FILTER reconstruction_error > threshold,playbooks/attack/enterprise/T1567.yml
T1567: Exfiltration Over Web Service,f9d9d3a7-6b6f-4a0e-8c3b-2d1f0e9b8c7a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,16,"Are files with common archive extensions (.zip, .rar) being uploaded to non-corporate or uncategorized web services?","This question provides a simple, high-fidelity check for policy violations and potential data exfiltration. Adversaries often compress and archive data before exfiltrating it. By monitoring for common archive file types being sent to destinations not approved for business use (like personal cloud storage), we can catch blatant attempts to move stolen data.",Zeek http.log; Zeek files.log; Network Egress Points; Web Application Firewalls (WAFs); Servers permitted to upload files to external sites; Managed File Transfer Systems,last 90 days,"SEARCH Zeek files.log | FILTER file_extension IN ('.zip', '.rar', '.7z') AND destination_domain NOT IN corporate_allowlist",playbooks/attack/enterprise/T1567.yml
T1567: Exfiltration Over Web Service,f9d9d3a7-6b6f-4a0e-8c3b-2d1f0e9b8c7a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,17,Are any outbound file transfers or HTTP POST requests exhibiting data entropy levels that are statistically anomalous for that specific destination?,"This question aims to detect encrypted or compressed data by measuring its randomness (Shannon entropy). Since different web services have different normal data types, we establish a per-destination baseline for entropy. An alert is triggered when a transfer to a site that normally handles text suddenly shows high-entropy data, suggesting that encrypted data is being hidden within a seemingly legitimate connection.",Zeek http.log; Zeek files.log; Network Egress Points; Web Application Firewalls (WAFs); Servers permitted to upload files to external sites; Managed File Transfer Systems,last 90 days,SEARCH (Zeek http.log OR files.log) | CALCULATE shannon_entropy of payload | COMPARE current_entropy with 30-day_99th_percentile_baseline for destination_domain | FILTER current_entropy > baseline,playbooks/attack/enterprise/T1567.yml
T1567: Exfiltration Over Web Service,f9d9d3a7-6b6f-4a0e-8c3b-2d1f0e9b8c7a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0010: Exfiltration,n; o; n; e,18,"Can a machine learning model classify the content type of data uploads and identify when the content (e.g., an encrypted blob) is inappropriate for the destination service?","This question uses a content classifier to identify the true nature of uploaded data (e.g., text, image, archive, encrypted). This is more robust than just checking file extensions. If data classified as 'encrypted' or 'archive' is sent to a service that should only receive simple text (like a paste site), it is a strong signal of malicious activity, such as staging stolen data.",Zeek http.log; Zeek files.log; Network Egress Points; Web Application Firewalls (WAFs); Servers permitted to upload files to external sites; Managed File Transfer Systems,last 90 days,"SEARCH http.log POST requests | APPLY content_classifier_model to payload | FILTER destination is ""paste_site"" AND classification IN ('archive', 'encrypted_blob', 'executable')",playbooks/attack/enterprise/T1567.yml
T1568.003: DNS Calculation,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0011: Command and Control,n; o; n; e,1,Is a host making a network connection to a port that was algorithmically calculated from a recent DNS query response?,"This question aims to proactively detect C2 activity where the communication port is not fixed but is instead calculated from the octets of a resolved IP address. By scripting checks that simulate known calculation algorithms (e.g., sum of octets, XOR operations) and correlating them with network connection logs within a short time window, analysts can identify this evasive technique.",Zeek dns.log; Zeek conn.log; Internal DNS Resolvers; Egress Network Gateways; Endpoint Devices,Last 90 days,"Pseudocode: FOR each successful DNS A-record, simulate known C2 port calculation algorithms on the resolved IP. SEARCH network connection logs within 60 seconds for an outbound connection from the same source host to the same resolved IP, but on the calculated port. ALERT on any match.",playbooks/attack/enterprise/T1568.003.yml
T1568.003: DNS Calculation,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0011: Command and Control,n; o; n; e,2,Are there hosts consistently connecting to high-numbered ports where the port number has a fixed mathematical relationship with the resolved IP address?,"This question provides a reactive method to discover DNS calculation. It works backward from observed connections on non-standard ports (>1024). By correlating these connections to recent DNS queries and calculating the difference between the port and various arithmetic combinations of the IP's octets, analysts can identify hosts where this difference is consistently a small, fixed value, suggesting a static calculation algorithm is in use.",Zeek dns.log; Zeek conn.log; Internal DNS Resolvers; Egress Network Gateways; Endpoint Devices,Last 90 days,"Pseudocode: FOR every connection to a port > 1024, find the most recent DNS query for that destination IP from the same source. CALCULATE the delta between the port and combinations of the IP's octets. USE a moving average to FLAG hosts where this delta is consistently near zero across multiple connections.",playbooks/attack/enterprise/T1568.003.yml
T1568.003: DNS Calculation,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0011: Command and Control,n; o; n; e,3,Can we use machine learning to detect outlier network connections that are likely the result of DNS calculation for C2?,"This question proposes an advanced, model-based approach to detection. By creating a feature set for DNS/network events (domain entropy, IP reputation, port number, vector of calculated values) and feeding it to an unsupervised learning model like Isolation Forest, analysts can identify anomalous connections that deviate from normal behavior. This is effective for detecting novel or complex algorithms that evade simple rule-based logic.",Zeek dns.log; Zeek conn.log; Internal DNS Resolvers; Egress Network Gateways; Endpoint Devices,Last 90 days,"Pseudocode: CREATE a feature set from correlated DNS and network events, including domain entropy, IP reputation, destination port, and a vector of calculated values from the IP. TRAIN an unsupervised learning model on this data. ISOLATE and ALERT on outliers where ports show strong correlation with the calculated vector.",playbooks/attack/enterprise/T1568.003.yml
T1568.003: DNS Calculation,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0011: Command and Control,n; o; n; e,4,"Is a host connecting to a non-standard, high-numbered port immediately after resolving a known malicious or suspicious domain?","This question focuses on correlating suspicious DNS activity with subsequent network behavior. Adversaries often pair DNS calculation with domains from threat intelligence feeds. This query creates a rule to specifically look for the sequence of a DNS query for a known C2 domain followed within 60 seconds by a connection to a non-standard port (>1024), which is a strong indicator of compromise.",Zeek dns.log; Zeek conn.log; Egress Firewalls/Proxies; Internal DNS Resolvers; Endpoint Devices,Last 90 days,Pseudocode: CREATE a rule that joins DNS logs with network connection logs. ALERT when a connection to a port > 1024 (and not on an approved list) occurs within 60 seconds of a DNS query for a domain that is present on a C2 threat intelligence feed.,playbooks/attack/enterprise/T1568.003.yml
T1568.003: DNS Calculation,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0011: Command and Control,n; o; n; e,5,Is a host connecting to an unusually high port number for our organization after querying a low-reputation or high-entropy domain?,"This question aims to identify anomalous port usage by establishing a baseline of normal behavior. By calculating the 99th percentile of destination ports used across the organization, analysts can create a dynamic threshold for 'unusual' ports. An alert is triggered when a host connects to a port exceeding this percentile shortly after querying a domain that is algorithmically generated (high entropy) or has a poor reputation, indicating a likely C2 channel.",Zeek dns.log; Zeek conn.log; Egress Firewalls/Proxies; Internal DNS Resolvers; Endpoint Devices,Last 90 days,Pseudocode: ESTABLISH a baseline of destination port usage and calculate the 99th percentile. ALERT when a host makes a connection to a port exceeding this percentile within 60 seconds of querying a domain with high entropy or a low reputation score.,playbooks/attack/enterprise/T1568.003.yml
T1568.003: DNS Calculation,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0011: Command and Control,n; o; n; e,6,Can we detect anomalous spikes in connections to high-numbered ports that are preceded by suspicious DNS activity?,"This question uses time-series analysis to detect changes in behavior over time. A model can learn the normal rate of connections to high ports (>1024) for each host. By enriching this model with data about preceding DNS queries (like domain age or entropy), it can flag statistically significant deviations from the forecast, especially when those deviations follow suspicious DNS lookups.",Zeek dns.log; Zeek conn.log; Egress Firewalls/Proxies; Internal DNS Resolvers; Endpoint Devices,Last 90 days,Pseudocode: DEPLOY a time-series anomaly detection model to monitor the rate of connections to ports > 1024 per host. ENRICH the model with features from preceding DNS queries. ALERT on temporal anomalies that deviate from the forecasted normal behavior.,playbooks/attack/enterprise/T1568.003.yml
T1568.003: DNS Calculation,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0011: Command and Control,n; o; n; e,7,Are hosts querying for domains that are not on our enterprise allowlist but are present on known DGA threat intelligence feeds?,"This question addresses the use of Domain Generation Algorithms (DGAs) which are often a precursor to DNS calculation. This is a high-fidelity check that compares all DNS queries against a corporate allowlist of known-good domains. Any domain not on the list is then checked against threat intelligence feeds for known DGA patterns, with any match triggering a high-priority alert.",Zeek dns.log; Microsoft-Windows-DNS-Client/Operational Event ID 3008; Internal DNS Resolvers; Domain Controllers; Endpoint Devices,Last 90 days,"Pseudocode: FOR each FQDN in DNS logs, CHECK if it is on the enterprise allowlist. IF NOT, query threat intelligence feeds for known DGA families. ALERT on any match.",playbooks/attack/enterprise/T1568.003.yml
T1568.003: DNS Calculation,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0011: Command and Control,n; o; n; e,8,Are hosts querying for domains that have an unusually high Shannon entropy score compared to normal traffic?,"This question uses a statistical property, Shannon entropy, to identify algorithmically generated domains. A baseline for entropy is established from the last 30 days of known-good, allowlisted domains. Any new domain not on the allowlist that has an entropy score exceeding the 98th percentile of this baseline is flagged, as its randomness is a strong indicator of DGA activity.",Zeek dns.log; Microsoft-Windows-DNS-Client/Operational Event ID 3008; Internal DNS Resolvers; Domain Controllers; Endpoint Devices,Last 90 days,"Pseudocode: FOR all domains not on the enterprise allowlist, CALCULATE the Shannon entropy of the second-level domain. ESTABLISH a baseline entropy from known-good domains. ALERT on domains with entropy scores exceeding the 98th percentile of the baseline.",playbooks/attack/enterprise/T1568.003.yml
T1568.003: DNS Calculation,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0011: Command and Control,n; o; n; e,9,Can a machine learning model classify queried domains as legitimate or DGA-generated based on their linguistic features?,"This question leverages a more sophisticated, supervised machine learning approach to DGA detection. A pre-trained classification model (e.g., Random Forest) can analyze various features of a domain—such as length, entropy, n-gram frequency, and vowel-to-consonant ratio—to make a probabilistic determination of whether it was generated by a machine or a human. Domains classified as DGA with high confidence are flagged for investigation.",Zeek dns.log; Microsoft-Windows-DNS-Client/Operational Event ID 3008; Internal DNS Resolvers; Domain Controllers; Endpoint Devices,Last 90 days,"Pseudocode: APPLY a pre-trained classification model to domains from DNS logs. The model should use features like domain length, entropy, and n-gram frequency. FLAG domains classified as DGA with a confidence score > 0.9.",playbooks/attack/enterprise/T1568.003.yml
T1568.003: DNS Calculation,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0011: Command and Control,n; o; n; e,10,Is any host generating an abnormally high rate and ratio of DNS queries that result in a Non-Existent Domain (NXDOMAIN) response?,"This question helps detect DGA-based C2, where malware cycles through a list of potential domains until it finds one that resolves. This behavior results in a large number of failed DNS lookups. This query establishes a simple threshold-based rule to alert if a single host's NXDOMAIN count and its ratio of NXDOMAIN to total queries exceed a set limit (e.g., >50 queries and >80% ratio) within a short 5-minute window.",Zeek dns.log; Internal DNS Resolvers; Endpoint Devices,Last 90 days,Pseudocode: COUNT DNS queries by source IP and response code over a 5-minute window. ALERT if the NXDOMAIN count for a host exceeds 50 and the ratio of NXDOMAIN to total queries for that host exceeds 0.8.,playbooks/attack/enterprise/T1568.003.yml
T1568.003: DNS Calculation,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0011: Command and Control,n; o; n; e,11,Is any host exhibiting a statistically significant increase in its NXDOMAIN query ratio compared to its own historical baseline?,"This question provides a more robust, baseline-driven approach to detecting abnormal NXDOMAIN activity. Instead of a fixed threshold, it calculates the z-score of a host's current NXDOMAIN ratio against its own 30-day rolling average. A z-score greater than 3 indicates a significant statistical deviation from normal behavior, providing a more reliable alert and reducing false positives from hosts that may normally have a higher NXDOMAIN rate.",Zeek dns.log; Internal DNS Resolvers; Endpoint Devices,Last 90 days,"Pseudocode: FOR each host, calculate the z-score of its current 1-hour NXDOMAIN ratio against its 30-day rolling average. ALERT if the z-score exceeds 3 and the raw NXDOMAIN count is above a nominal threshold.",playbooks/attack/enterprise/T1568.003.yml
T1568.003: DNS Calculation,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0011: Command and Control,n; o; n; e,12,Can we identify hosts whose DNS behavior profile has shifted to one characterized by a high rate of NXDOMAIN responses?,"This question uses unsupervised clustering to identify behavioral shifts. Hosts are grouped based on their daily DNS response code profiles (e.g., vector of counts for NOERROR, NXDOMAIN, etc.). An alert is triggered when a host moves from a large, stable cluster representing 'normal' behavior to a smaller, more volatile cluster defined by a high proportion of NXDOMAIN responses, indicating a potential compromise.",Zeek dns.log; Internal DNS Resolvers; Endpoint Devices,Last 90 days,Pseudocode: USE time-series clustering to group hosts by their daily DNS response code profiles. IDENTIFY and ALERT on any host that transitions from a 'normal' cluster to a cluster characterized by a high NXDOMAIN ratio.,playbooks/attack/enterprise/T1568.003.yml
T1568.003: DNS Calculation,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0011: Command and Control,n; o; n; e,13,"Is a host making highly regular, periodic connections to a destination that was resolved from a suspicious DNS query?","This question aims to identify C2 beaconing activity that often follows a successful DNS resolution. After a suspicious DNS event is flagged, this query looks for subsequent connections from the source host that have a machine-like regularity. It specifically checks for consistent time intervals (low jitter) between connections over an extended period (e.g., one hour), which is characteristic of automated C2 callbacks.",Zeek conn.log; Zeek dns.log; Zeek ssl.log; Egress Network Gateways; Core Network Switches; Endpoint Devices,Last 90 days,"Pseudocode: FOR destination IPs associated with flagged suspicious DNS activity, IDENTIFY repeating connections from a single source. ALERT if the time between consecutive connections is consistent (e.g., every 300s +/- 5s) over at least one hour.",playbooks/attack/enterprise/T1568.003.yml
T1568.003: DNS Calculation,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0011: Command and Control,n; o; n; e,14,Are there any source-destination communication pairs exhibiting extremely low deviation in both timing and packet size?,"This question uses statistical analysis to find machine-like C2 beaconing. It calculates the standard deviation of the time deltas between connections and the standard deviation of the packet sizes for every source-destination pair. Pairs that fall into the lowest percentile for both metrics are flagged. This combination of highly regular timing and consistent data volume is a strong signal of automated, non-human communication.",Zeek conn.log; Zeek dns.log; Zeek ssl.log; Egress Network Gateways; Core Network Switches; Endpoint Devices,Last 90 days,"Pseudocode: FOR each source-destination IP pair, calculate the standard deviation of the time deltas between connections and the standard deviation of packet sizes. FLAG pairs that fall into the lowest 1st percentile for both metrics.",playbooks/attack/enterprise/T1568.003.yml
T1568.003: DNS Calculation,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0011: Command and Control,n; o; n; e,15,Can a sequence analysis model detect anomalous patterns of DNS queries followed by beaconing-like network connections?,"This question proposes using a deep learning model, such as an LSTM autoencoder, to understand normal sequences of network events for a host. The model is trained on vast amounts of normal traffic data. It can then be used to identify and alert on anomalous sequences, such as a DNS query followed by a series of small, regularly timed connections to the resolved IP, which the model would flag as a deviation from learned normal behavior.",Zeek conn.log; Zeek dns.log; Zeek ssl.log; Egress Network Gateways; Core Network Switches; Endpoint Devices,Last 90 days,"Pseudocode: TRAIN an LSTM autoencoder on sequences of normal network events per host. USE the model to identify anomalous sequences, such as a DNS query followed by repeated, small, and regularly timed connections to the resolved IP. ALERT on these anomalies.",playbooks/attack/enterprise/T1568.003.yml
T1572: Protocol Tunneling,f8a1b2c3-d4e5-4f6a-7b8c-9d0e1f2a3b4c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0011: Command and Control,n; o; n; e,1,Are internal hosts connecting to external IPs or domains known to be C2 servers that utilize protocol tunneling?,This question aims to detect direct C2 communication by matching network traffic against a high-confidence threat intelligence feed. A match provides a strong signal that an internal host is compromised and communicating with a known malicious infrastructure using protocol tunneling.,Zeek conn.log; Zeek dns.log; Threat Intelligence Feed; Egress firewalls and proxies; Recursive DNS servers; Network sensor grid,last 90 days,JOIN Zeek conn.log (destination IP) AND Zeek dns.log (domain) WITH Threat Intel Feed (C2 indicators). ALERT on match.,playbooks/attack/enterprise/T1572.yml
T1572: Protocol Tunneling,f8a1b2c3-d4e5-4f6a-7b8c-9d0e1f2a3b4c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0011: Command and Control,n; o; n; e,2,"Is any host exhibiting an unusually high rate of connections to new, never-before-seen domains?","This question seeks to identify algorithmically generated domains (DGAs) often used for C2. Adversaries use DGAs to create a large, rotating set of C2 domains, making blocklisting difficult. A sudden spike in connections to new domains from a single host is a strong indicator of this behavior, which is often paired with protocol tunneling.",Zeek conn.log; Zeek dns.log; Egress firewalls and proxies; Recursive DNS servers; Network sensor grid,last 90 days,"FOR each host, CALCULATE hourly rate of connections to new domains. COMPARE rate to 95th percentile of baseline. ALERT if exceeded.",playbooks/attack/enterprise/T1572.yml
T1572: Protocol Tunneling,f8a1b2c3-d4e5-4f6a-7b8c-9d0e1f2a3b4c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0011: Command and Control,n; o; n; e,3,Can we classify network connections as malicious C2 traffic using machine learning models trained on connection metadata?,"This question leverages a supervised machine learning model to detect subtle characteristics of tunneled C2 traffic that may not be caught by signature-based or simple statistical methods. By analyzing features like connection duration, data volume, service type, and TLS/SSL fingerprints (JA3/JA3S), the model can identify new or unknown C2 channels with a high degree of accuracy.",Zeek conn.log; Zeek ssl.log; Egress firewalls and proxies; Recursive DNS servers; Network sensor grid,last 90 days,EXTRACT features from Zeek conn.log/ssl.log. APPLY trained classification model. FLAG connections with high malicious probability score.,playbooks/attack/enterprise/T1572.yml
T1572: Protocol Tunneling,f8a1b2c3-d4e5-4f6a-7b8c-9d0e1f2a3b4c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0011: Command and Control,n; o; n; e,4,Are any processes being created that are known tunneling tools or legitimate utilities with command-line arguments indicative of tunneling?,"This question focuses on detecting the execution of tools used for protocol tunneling. It looks for either the direct use of known malicious tunneling software (e.g., plink.exe, chisel.exe) or the misuse of legitimate system tools (e.g., ssh.exe, powershell.exe) with specific flags (-L, -R, -D, -EncodedCommand) that enable tunneling capabilities.",Windows Event ID 4688; Zeek conn.log; Zeek ssh.log; User workstations; Application servers; Domain Controllers; Developer endpoints,last 90 days,MONITOR Process Creation events (4688). ALERT if process name is on watchlist OR command line contains tunneling flags.,playbooks/attack/enterprise/T1572.yml
T1572: Protocol Tunneling,f8a1b2c3-d4e5-4f6a-7b8c-9d0e1f2a3b4c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0011: Command and Control,n; o; n; e,5,Are legitimate processes like 'ssh.exe' being executed with unusually long or complex command-line arguments?,"This question aims to find obfuscated or complex commands hidden within the execution of legitimate tools. Adversaries may use long, encoded, or high-entropy command-line arguments to hide their tunneling parameters. By baselining normal usage and flagging statistical deviations in argument length or character randomness (entropy), we can uncover this suspicious activity.",Windows Event ID 4688; User workstations; Application servers; Domain Controllers; Developer endpoints,last 90 days,"FOR legitimate processes, CALCULATE baseline for command-line entropy/length. ALERT if execution exceeds 3 standard deviations from the norm.",playbooks/attack/enterprise/T1572.yml
T1572: Protocol Tunneling,f8a1b2c3-d4e5-4f6a-7b8c-9d0e1f2a3b4c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0011: Command and Control,n; o; n; e,6,Can we use unsupervised machine learning to identify anomalous process executions that may represent tunneling activity?,"This question uses clustering algorithms to find outlier process executions without prior knowledge of what is 'bad'. By grouping all process command lines into clusters of 'normal' activity, any execution that doesn't fit into a large, established cluster is flagged as an anomaly. This is effective for finding unique, one-off commands used by an adversary to set up a tunnel.",Windows Event ID 4688; User workstations; Application servers; Domain Controllers; Developer endpoints,last 90 days,"TOKENIZE command-line arguments. APPLY clustering algorithm (e.g., DBSCAN). FLAG process executions classified as noise or belonging to very small clusters.",playbooks/attack/enterprise/T1572.yml
T1572: Protocol Tunneling,f8a1b2c3-d4e5-4f6a-7b8c-9d0e1f2a3b4c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0011: Command and Control,n; o; n; e,7,Are there DNS queries matching patterns known to be associated with DNS tunneling tools?,"This question seeks to identify DNS tunneling by looking for specific, signature-like patterns in DNS queries. DNS tunneling tools like Iodine and dnscat2 often use specific domain structures or encode data in subdomains (e.g., using hexadecimal characters). This query searches for these known malicious patterns in DNS logs.",Zeek dns.log; Internal DNS resolvers; Egress network gateways,last 90 days,SCAN Zeek dns.log for queries matching regex or domains associated with known DNS tunneling tools.,playbooks/attack/enterprise/T1572.yml
T1572: Protocol Tunneling,f8a1b2c3-d4e5-4f6a-7b8c-9d0e1f2a3b4c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0011: Command and Control,n; o; n; e,8,"Are there DNS queries with statistically unusual characteristics, such as high subdomain entropy, excessive length, or an abnormal ratio of TXT/NULL to A/AAAA records?","This question targets the statistical byproducts of DNS tunneling. Because data is often encoded in subdomains, these queries tend to be longer and more random (higher entropy) than normal queries. They also frequently use TXT or NULL records to exfiltrate data. By baselining normal DNS traffic and flagging outliers in these metrics, we can detect potential DNS tunneling.",Zeek dns.log; Internal DNS resolvers; Egress network gateways,last 90 days,CALCULATE subdomain entropy/length and TXT/A query ratio per source/domain. ESTABLISH 30-day baseline. ALERT on deviations > 3 stddev or > 99th percentile.,playbooks/attack/enterprise/T1572.yml
T1572: Protocol Tunneling,f8a1b2c3-d4e5-4f6a-7b8c-9d0e1f2a3b4c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0011: Command and Control,n; o; n; e,9,Is any host generating a volume of DNS queries that significantly exceeds its forecasted normal behavior?,"This question uses time-series forecasting to detect a sudden, anomalous increase in DNS query volume from a single host. Active DNS tunneling for C2 can generate a large number of DNS requests in a short period. By modeling the expected 'normal' query volume for each host, we can flag significant, unexpected spikes that are strong indicators of tunneling.",Zeek dns.log; Internal DNS resolvers; Egress network gateways,last 90 days,"MODEL expected DNS query volume per host using time-series forecasting (e.g., ARIMA). ALERT when actual volume significantly exceeds forecast.",playbooks/attack/enterprise/T1572.yml
T1572: Protocol Tunneling,f8a1b2c3-d4e5-4f6a-7b8c-9d0e1f2a3b4c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0011: Command and Control,n; o; n; e,10,Are internal hosts making DNS queries for domains or resolving to IPs known to be C2 servers that utilize protocol tunneling?,This question aims to detect DNS-based C2 communication by matching DNS queries and their resolved IPs against a high-confidence threat intelligence feed. A match provides a strong signal that an internal host is compromised and attempting to resolve or communicate with a known malicious infrastructure using protocol tunneling.,Zeek conn.log; Zeek dns.log; Threat Intelligence Feed; Internal DNS resolvers; Egress network gateways,last 90 days,JOIN Zeek conn.log (destination IP) AND Zeek dns.log (domain) WITH Threat Intel Feed (C2 indicators). ALERT on match.,playbooks/attack/enterprise/T1572.yml
T1572: Protocol Tunneling,f8a1b2c3-d4e5-4f6a-7b8c-9d0e1f2a3b4c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0011: Command and Control,n; o; n; e,11,"Are there any unencrypted network connections containing known tunneling tool artifacts, or SSH connections showing signs of port forwarding to untrusted destinations?","This question looks for specific artifacts within network traffic that indicate tunneling. For unencrypted protocols, it involves deep packet inspection for signatures of tools like Chisel. For SSH, it inspects connection logs for the establishment of forwarding channels, which is a core mechanism of SSH tunneling, especially when directed to non-standard or untrusted external systems.","Zeek conn.log; Zeek ssh.log; Network core switches; Egress points; Servers hosting common services (e.g., HTTP, DNS)",last 90 days,SCAN unencrypted payloads for tunneling tool headers. INSPECT Zeek ssh.log for channel forwarding to untrusted destinations.,playbooks/attack/enterprise/T1572.yml
T1572: Protocol Tunneling,f8a1b2c3-d4e5-4f6a-7b8c-9d0e1f2a3b4c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0011: Command and Control,n; o; n; e,12,"Are there network connections with an anomalous ratio of outbound-to-inbound data or exhibiting periodic, low-jitter timing indicative of C2 heartbeats?","This question identifies two key statistical indicators of C2 tunneling. First, an unusual data ratio (e.g., large uploads over a protocol that is typically download-heavy like DNS) suggests data exfiltration via tunneling. Second, small, regularly timed packets over a long-lived connection (low jitter) are characteristic of automated 'heartbeat' check-ins from malware to its C2 server.","Zeek conn.log; Network core switches; Egress points; Servers hosting common services (e.g., HTTP, DNS)",last 90 days,CALCULATE outbound/inbound byte ratio per connection; flag outliers (>99th percentile) for the protocol. CALCULATE packet inter-arrival time standard deviation for long sessions; flag very low values.,playbooks/attack/enterprise/T1572.yml
T1572: Protocol Tunneling,f8a1b2c3-d4e5-4f6a-7b8c-9d0e1f2a3b4c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0011: Command and Control,n; o; n; e,13,"Can a machine learning model, trained on network connection metadata, distinguish and flag tunneled C2 traffic from benign traffic?","This question uses a supervised machine learning model to perform a holistic assessment of a network connection. By training on a comprehensive set of features (protocol, duration, data volumes, connection state, IP reputation), the model can learn the complex, non-linear patterns that differentiate legitimate traffic from various forms of tunneled C2, allowing it to score and identify suspicious connections in real-time.","Zeek conn.log; Zeek ssl.log; Network core switches; Egress points; Servers hosting common services (e.g., HTTP, DNS)",last 90 days,"EXTRACT features from Zeek conn.log. APPLY trained classification model (e.g., Random Forest). FLAG connections with high malicious probability score.",playbooks/attack/enterprise/T1572.yml
T1572: Protocol Tunneling,f8a1b2c3-d4e5-4f6a-7b8c-9d0e1f2a3b4c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0011: Command and Control,n; o; n; e,14,"Is a process that is not expected to make network connections (e.g., notepad.exe) initiating an outbound connection, or is a process being created by an unexpected parent?","This question enforces a strict 'known good' policy for process behavior. It flags clear violations, such as a simple utility like Calculator making a network connection, or a critical system process being launched by an unusual parent. These events are high-fidelity indicators of compromise, often resulting from process injection used to establish a C2 tunnel.","Windows Event ID 4688; Windows Event ID 5156; Zeek conn.log; Critical infrastructure (e.g., Domain Controllers, database servers); User endpoint devices; Application servers",last 90 days,MONITOR process creation (4688) and network connection (5156) events. ALERT if a process on a no-network watchlist makes a connection OR a parent-child relationship violates a defined policy.,playbooks/attack/enterprise/T1572.yml
T1572: Protocol Tunneling,f8a1b2c3-d4e5-4f6a-7b8c-9d0e1f2a3b4c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0011: Command and Control,n; o; n; e,15,"Are common system processes (e.g., svchost.exe) making network connections to unusual destination ports or at a frequency that deviates from their normal baseline?","This question focuses on detecting the abuse of legitimate system processes for C2. Adversaries often inject code into trusted processes like 'svchost.exe' to bypass firewalls. By creating a statistical baseline of normal network activity for these processes (common ports, connection frequency), we can flag any connection that is a statistical outlier, indicating potential misuse for tunneling.","Windows Event ID 5156; Critical infrastructure (e.g., Domain Controllers, database servers); User endpoint devices; Application servers",last 90 days,"BASELINE normal network behavior (ports, frequency) for common processes from event 5156. ALERT if a connection deviates > 3 stddev or uses a port outside the 95th percentile.",playbooks/attack/enterprise/T1572.yml
T1572: Protocol Tunneling,f8a1b2c3-d4e5-4f6a-7b8c-9d0e1f2a3b4c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0011: Command and Control,n; o; n; e,16,"Can an unsupervised machine learning model detect anomalous combinations of process, parent process, and network connection details?","This question uses an autoencoder, a type of neural network, to learn a deep representation of 'normal' system activity by training on a baseline of process creation and network connection events. When a new event occurs (e.g., a process connects to a new IP), it is fed to the model. If the model cannot accurately reconstruct the event, it has a high 'reconstruction error' and is flagged as an anomaly. This is powerful for detecting novel malicious behaviors, such as a compromised svchost.exe communicating with a new C2 server.","Windows Event ID 4688; Windows Event ID 5156; Critical infrastructure (e.g., Domain Controllers, database servers); User endpoint devices; Application servers",last 90 days,"TRAIN autoencoder on baseline of (process, parent, cmd hash, dest IP, dest port) tuples. FEED live events to model. FLAG events with high reconstruction error.",playbooks/attack/enterprise/T1572.yml
T1573.001: Symmetric Cryptography,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,1,Is there network traffic to IPs or domains known to be malicious C2 infrastructure?,"This question seeks to identify direct communication with known command and control servers. By ingesting a threat intelligence feed of C2 infrastructure, we can create a rule to join Zeek conn.log destination IPs and Zeek dns.log queried domains against this feed. A match provides a high-confidence indicator of a potential compromise.
",Zeek conn.log; Zeek dns.log; Threat Intelligence Feed; Network Egress Points; DNS Resolvers,last 90 days,": JOIN (
  SELECT dest_ip FROM zeek_conn_log
  UNION
  SELECT queried_domain FROM zeek_dns_log
) AS network_activity
ON network_activity.destination = threat_intel_feed.indicator
WHERE threat_intel_feed.tag = 'C2'
RETURN network_activity.destination, threat_intel_feed.indicator
",playbooks/attack/enterprise/T1573.001.yml
T1573.001: Symmetric Cryptography,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,2,Are any known-bad C2 domains being queried by an unusually small number of internal hosts?,"This question aims to find stealthy C2 communications. Adversaries often use dedicated infrastructure for a limited number of targets. By calculating the number of unique internal hosts querying each domain from a CTI feed, we can identify domains contacted by very few hosts (e.g., below the 5th percentile). These rare communications to known-bad domains are highly suspicious and warrant escalation.
",Zeek dns.log; Threat Intelligence Feed; DNS Resolvers,last 90 days,": // Step 1: Count hosts per domain
domain_counts = SELECT domain, COUNT(DISTINCT source_host) AS host_count
                FROM zeek_dns_log
                WHERE domain IN (SELECT indicator FROM threat_intel_feed WHERE tag = 'C2')
                GROUP BY domain

// Step 2: Find the 5th percentile threshold
percentile_threshold = CALCULATE_PERCENTILE(domain_counts.host_count, 5)

// Step 3: Find rare domains
SELECT domain, host_count
FROM domain_counts
WHERE host_count <= percentile_threshold
",playbooks/attack/enterprise/T1573.001.yml
T1573.001: Symmetric Cryptography,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,3,"Can we predict if new, unseen IP addresses are malicious C2 infrastructure based on connection characteristics?","This question uses machine learning to proactively identify potential C2 servers not yet on threat intelligence feeds. A supervised classification model (like Random Forest) is trained on labeled historical data (Zeek connection logs and CTI feeds). Features like destination port, protocol, and bytes transferred help the model learn the patterns of malicious C2 traffic. Applying this model to new connections allows for the prediction of maliciousness, alerting when the probability score is high.
",Zeek conn.log; Historical Threat Intelligence Data; Network Egress Points,last 90 days,": // Training Phase
features = SELECT dest_port, protocol, bytes_sent, bytes_received FROM zeek_conn_log
labels = SELECT is_malicious FROM historical_cti_data
model = TRAIN RandomForestClassifier(features, labels)

// Prediction Phase
new_features = SELECT dest_port, protocol, bytes_sent, bytes_received FROM new_zeek_conn_log
predictions = model.PREDICT_PROBA(new_features)
ALERT WHERE predictions.probability > 0.85
",playbooks/attack/enterprise/T1573.001.yml
T1573.001: Symmetric Cryptography,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,4,Has a known malicious process or a process from a suspicious location initiated an outbound network connection?,"This question looks for malware execution that leads to C2 communication. By monitoring process creation events (Windows Event ID 4688), we can check if the process hash is on a blocklist or if it originates from a temporary or user-writable directory. Correlating this with an outbound network connection from the same host within a short time frame (e.g., 5 minutes) strongly indicates malicious activity.
",Windows Event ID 4688; Zeek conn.log; Malicious Hash Feed; User Workstations; Critical Application Servers; Domain Controllers,last 90 days,": suspicious_procs = SELECT host, timestamp, process_hash, process_path
                   FROM win_event_4688
                   WHERE process_hash IN (malicious_hashes) OR process_path MATCHES '.*\\Temp\\.*'

outbound_conns = SELECT host, timestamp FROM zeek_conn_log

JOIN suspicious_procs, outbound_conns
ON suspicious_procs.host = outbound_conns.host
WHERE outbound_conns.timestamp BETWEEN suspicious_procs.timestamp AND suspicious_procs.timestamp + 5_minutes
",playbooks/attack/enterprise/T1573.001.yml
T1573.001: Symmetric Cryptography,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,5,Is a process executing from a rare file path and then making a network connection?,"This question seeks to identify anomalous process behavior that might indicate malware attempting to hide. By baselining common process execution paths, we can calculate the rarity of any new process execution. An execution from an extremely rare path (e.g., below the 1st percentile) that is immediately followed by an outbound network connection is a significant anomaly that should be investigated.
",Windows Event ID 4688; Zeek conn.log; User Workstations; Critical Application Servers; Domain Controllers,last 90 days,": // Step 1: Baseline execution paths
path_frequencies = CALCULATE_FREQUENCY(win_event_4688.process_path)
rarity_threshold = CALCULATE_PERCENTILE(path_frequencies, 1)

// Step 2: Find rare executions and correlate with network connections
rare_procs = SELECT host, timestamp, process_path
             FROM win_event_4688
             WHERE FREQUENCY(process_path) < rarity_threshold
// JOIN logic with network logs is then applied
",playbooks/attack/enterprise/T1573.001.yml
T1573.001: Symmetric Cryptography,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,6,Can we detect malicious processes based on their command-line arguments before they establish persistent C2?,"This question focuses on detecting obfuscated or suspicious process execution through its command-line arguments. An anomaly detection model (like Isolation Forest) can be trained on features derived from command lines, such as length, character entropy (randomness), and the presence of encoded strings. Processes that receive a high anomaly score and also initiate network traffic are strong candidates for being malicious.
",Windows Event ID 4688; Zeek conn.log; User Workstations; Critical Application Servers; Domain Controllers,last 90 days,": // Training Phase
features = EXTRACT_FEATURES(win_event_4688.command_line) // e.g., length, entropy
model = TRAIN IsolationForest(features)

// Prediction Phase
new_features = EXTRACT_FEATURES(new_win_event_4688.command_line)
anomaly_scores = model.PREDICT(new_features)

// Correlate high scores with network activity
ALERT WHERE anomaly_scores > threshold AND process initiated network connection
",playbooks/attack/enterprise/T1573.001.yml
T1573.001: Symmetric Cryptography,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,7,Is there non-TLS traffic occurring over a standard TLS port like 443?,"This question aims to find C2 traffic masquerading as legitimate encrypted traffic. Adversaries often use standard ports like 443 to bypass firewall rules. A symbolic rule can be created to identify any connection logged by Zeek on port 443 that does not have a corresponding entry in the ssl.log. This mismatch indicates that the traffic is not valid TLS, a common tactic for custom encrypted C2 channels.
",Zeek conn.log; Zeek ssl.log; Network Egress Points; Internal Network Segments,last 90 days,": SELECT c.*
FROM zeek_conn_log c
LEFT JOIN zeek_ssl_log s ON c.uid = s.uid
WHERE c.dest_port = 443 AND s.uid IS NULL
",playbooks/attack/enterprise/T1573.001.yml
T1573.001: Symmetric Cryptography,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,8,Is there network traffic on any given port with unusually high payload entropy?,"This question helps detect encrypted or packed data where it is not expected. By establishing a baseline of normal payload entropy for each destination port over a 30-day window, we can then alert on any new connection whose entropy exceeds the 95th percentile. This is particularly powerful when combined with the protocol-mismatch rule, as it suggests the traffic is not only non-standard but also likely encrypted.
",Zeek files.log; Zeek conn.log; Network Egress Points; Internal Network Segments,last 90 days,": // Step 1: Calculate baseline entropy per port
entropy_thresholds = SELECT dest_port, PERCENTILE(entropy, 95) AS threshold
                     FROM zeek_files_log
                     GROUP BY dest_port

// Step 2: Find connections exceeding the threshold
SELECT *
FROM zeek_files_log f
JOIN entropy_thresholds t ON f.dest_port = t.dest_port
WHERE f.entropy > t.threshold
",playbooks/attack/enterprise/T1573.001.yml
T1573.001: Symmetric Cryptography,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,9,Can we predict and detect anomalous spikes in payload entropy for high-traffic ports?,"This question applies time-series forecasting to detect subtle anomalies in high-volume traffic. For busy ports like 80 and 443, a simple percentile might be too noisy. A model like ARIMA can learn the normal daily and weekly patterns of payload entropy. It can then forecast the expected entropy for a given time. An alert is generated when the observed entropy significantly deviates (e.g., more than 3 standard deviations) from the forecast, indicating a statistical anomaly that could be custom encrypted C2 traffic.
",Zeek files.log; Zeek conn.log; Network Egress Points; Internal Network Segments,last 90 days,": // Training Phase (per port)
timeseries_data = SELECT timestamp, entropy FROM zeek_files_log WHERE dest_port = 443
model = TRAIN ARIMA(timeseries_data)

// Prediction Phase
forecast = model.FORECAST(next_time_period)
observed_entropy = GET_CURRENT_ENTROPY(dest_port=443)

ALERT WHERE ABS(observed_entropy - forecast.value) > 3 * forecast.std_dev
",playbooks/attack/enterprise/T1573.001.yml
T1573.001: Symmetric Cryptography,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,10,"Is any internal host communicating with an external destination in a periodic, repeating 'heartbeat' pattern?","This question aims to detect the classic C2 beaconing behavior. Malware often 'phones home' at regular intervals to check for new commands. A symbolic rule can analyze connection timestamps and data sizes for each source-destination pair. An alert is triggered if a host makes a series of connections (e.g., more than 5) to the same destination at regular intervals (e.g., every 5 minutes) with a consistent payload size, indicating a likely automated C2 channel.
",Zeek conn.log; Network Egress Points,last 90 days,": GROUP connections by source_ip, dest_ip
FOR each group:
  CALCULATE time_delta between consecutive connections
  CALCULATE size_delta between consecutive connections
  IF count > 5 AND STDEV(time_delta) < threshold AND STDEV(size_delta) < threshold:
    ALERT ""Beaconing detected""
",playbooks/attack/enterprise/T1573.001.yml
T1573.001: Symmetric Cryptography,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,11,Are there any network connections with a highly unusual ratio of data sent versus data received for that port?,"This question identifies anomalous data transfer patterns. For most protocols and ports, there is a typical ratio of sent vs. received bytes. By establishing a statistical baseline for this ratio on a per-port basis, we can flag connections that deviate significantly (e.g., by more than 3 standard deviations). This could indicate C2 activity, such as a small check-in packet followed by a large command download, or a large data exfiltration upload with a small acknowledgement.
",Zeek conn.log; Network Egress Points,last 90 days,": // Step 1: Calculate baseline ratio stats per port
port_baselines = SELECT dest_port, AVG(sent_bytes / received_bytes) AS mean_ratio, STDEV(sent_bytes / received_bytes) AS stdev_ratio
                 FROM zeek_conn_log
                 GROUP BY dest_port

// Step 2: Find connections with anomalous ratios
SELECT *
FROM zeek_conn_log c
JOIN port_baselines b ON c.dest_port = b.dest_port
WHERE ABS((c.sent_bytes / c.received_bytes) - b.mean_ratio) > 3 * b.stdev_ratio
",playbooks/attack/enterprise/T1573.001.yml
T1573.001: Symmetric Cryptography,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,12,Can we use time-series analysis to automatically detect repeating signals indicative of C2 beaconing?,"This question applies a more advanced mathematical approach to beacon detection. For each source-destination pair, the timestamps of their connections can be treated as a time series. An autocorrelation function measures how correlated the series is with a delayed copy of itself. A high autocorrelation score indicates a strong, repeating, periodic signal (a beacon). This method can find beaconing even when the intervals are not perfectly fixed, and is especially useful for flagging activity to low-reputation destinations.
",Zeek conn.log; Network Egress Points,last 90 days,": GROUP connections by source_ip, dest_ip
FOR each group:
  timestamps = GET_TIMESTAMPS(connections)
  autocorrelation_score = AUTOCORRELATE(timestamps)
  IF autocorrelation_score > threshold:
    ALERT ""Periodic signal detected via autocorrelation""
",playbooks/attack/enterprise/T1573.001.yml
T1573.001: Symmetric Cryptography,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,13,"Is an unapproved process making a suspicious network connection, such as non-TLS traffic on port 443?","This question combines process and network validation to find high-fidelity threats. It correlates two distinct symbolic alerts: one for a process execution whose hash is not on a software allowlist, and another for a network connection that shows signs of protocol mismatch (e.g., non-TLS on port 443). When both events originate from the same host in a close time window, it's a strong indicator of unauthorized software performing C2 communications.
",Windows Event ID 4688; Zeek conn.log; Zeek ssl.log; Software Allowlist; User Workstations; Critical Application Servers; Network Egress Points,last 90 days,": unapproved_procs = SELECT host, timestamp
                   FROM win_event_4688
                   WHERE process_hash NOT IN (software_allowlist)

protocol_mismatch = SELECT host, timestamp
                    FROM non_tls_on_443_alert_log

JOIN unapproved_procs, protocol_mismatch
ON unapproved_procs.host = protocol_mismatch.host
WHERE ABS(unapproved_procs.timestamp - protocol_mismatch.timestamp) < 5_minutes
",playbooks/attack/enterprise/T1573.001.yml
T1573.001: Symmetric Cryptography,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,14,Can we create a composite risk score to identify processes exhibiting multiple suspicious behaviors at once?,"This question moves beyond single indicators to a holistic risk assessment. Instead of separate alerts, a composite score is calculated for each network-connected process. Points are awarded for various statistically anomalous attributes: executing from a rare path, high network traffic entropy, exhibiting beaconing behavior, or having an anomalous data transfer ratio. If a process's cumulative score surpasses a threshold (e.g., 3), it is flagged for investigation as a multi-faceted threat.
",Windows Event ID 4688; Zeek conn.log; Zeek files.log; User Workstations; Critical Application Servers; Network Egress Points,last 90 days,": FOR each process with network activity:
  score = 0
  IF path_rarity < 5th_percentile: score += 1
  IF network_entropy > 95th_percentile: score += 1
  IF is_beaconing: score += 2
  IF data_ratio_stdev > 3: score += 1

  IF score > 3:
    ALERT ""High risk score process detected""
",playbooks/attack/enterprise/T1573.001.yml
T1573.001: Symmetric Cryptography,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,15,Can we use unsupervised machine learning to find outlier processes based on a combination of process and network features?,"This question uses clustering to find 'unknown unknowns'. An unsupervised algorithm like DBSCAN can group processes based on a wide set of features, including both process data (path rarity) and network data (entropy, beaconing stability, data ratio). Normal activity will form large, dense clusters. Malicious processes, exhibiting a unique combination of these behaviors, will be flagged as outliers or small, distant clusters, identifying them as multi-faceted behavioral anomalies that require investigation.
",Windows Event ID 4688; Zeek conn.log; Zeek ssl.log; Zeek files.log; User Workstations; Critical Application Servers; Network Egress Points,last 90 days,": // Feature Engineering
features = COMBINE(
  process_path_rarity,
  network_entropy,
  beaconing_interval_stdev,
  data_ratio
)

// Clustering
model = TRAIN DBSCAN(features)
clusters = model.FIT_PREDICT(features)

ALERT WHERE cluster_label = -1 // DBSCAN outlier label",playbooks/attack/enterprise/T1573.001.yml
T1573: Encrypted Channel,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,1,Are any outbound SSL/TLS connections matching known malicious indicators from our threat intelligence feeds?,"This question seeks to find high-confidence evidence of C2 by directly matching outbound connection artifacts (destination IPs, Server Name Indication, certificate hashes) against curated lists of known malicious indicators. A successful match is a strong signal of compromise.","Zeek conn.log; Zeek ssl.log; Network egress points (e.g., firewalls, proxies); Threat intelligence platform",Last 90 days,"pseudocode: | JOIN (conn_logs, ssl_logs) ON connection_uid; JOIN result WITH threat_intel_feed ON (dest_ip, sni, cert_hash); RETURN matches;",playbooks/attack/enterprise/T1573.yml
T1573: Encrypted Channel,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,2,Are there any recently registered domains receiving a high volume of connections from a very small number of internal hosts?,This helps detect potential C2 domains not yet in threat intelligence feeds. A low ratio of unique source hosts to total connections suggests one or a few infected machines repeatedly contacting a C2 server. Correlating this with a recent domain registration date increases the likelihood of maliciousness.,"Zeek conn.log; Zeek ssl.log; Network egress points (e.g., firewalls, proxies); Threat intelligence platform",Last 90 days,pseudocode: | CALCULATE host_to_connection_ratio per domain; FILTER for ratio < 0.1; CHECK domain registration_date < 60 days; RETURN suspicious_domains;,playbooks/attack/enterprise/T1573.yml
T1573: Encrypted Channel,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,3,Can we use a machine learning model to identify malicious SSL/TLS connections based on their network and certificate features?,"This proactive approach uses machine learning to score and identify potentially malicious traffic that may evade signature-based detection. It learns the characteristics of both benign and malicious connections (e.g., duration, data volume, SNI entropy, certificate properties) to predict the nature of new, unseen traffic.","Zeek conn.log; Zeek ssl.log; Network egress points (e.g., firewalls, proxies); Threat intelligence platform",Last 90 days,"pseudocode: | SCORE new SSL/TLS connections with trained_model; FEATURES = [duration, bytes_sent, sni_entropy, cert_validity, is_self_signed]; ALERT if score > 0.9;",playbooks/attack/enterprise/T1573.yml
T1573: Encrypted Channel,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,4,Are we observing any TLS client (JA3) or server (JA3S) fingerprints that are known to be associated with malware or malicious tools?,"JA3 and JA3S hashes act as fingerprints for the cryptographic client and server applications. Malicious tools often use specific libraries, resulting in unique, identifiable fingerprints. Matching these hashes against a feed of known malicious fingerprints can directly identify malware families like Cobalt Strike or Metasploit.","Zeek ssl.log; Network sensors capturing TLS handshakes (e.g., Zeek sensors at network chokepoints)",Last 90 days,"pseudocode: | EXTRACT ja3, ja3s from ssl_logs; JOIN with malicious_ja3_feed; ALERT on match;",playbooks/attack/enterprise/T1573.yml
T1573: Encrypted Channel,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,5,Are there any rare JA3 hashes present on only a few hosts within the enterprise?,"This question hunts for anomalies by identifying non-standard TLS clients. Widespread, legitimate software produces common JA3 hashes. A JA3 hash observed on only a handful of machines suggests the presence of unusual software, which could be a malicious tool and warrants investigation.","Zeek ssl.log; Network sensors capturing TLS handshakes (e.g., Zeek sensors at network chokepoints)",Last 90 days,pseudocode: | CALCULATE frequency of each JA3 hash in 24h; FILTER for hosts_count < 3 AND total_connections_percent < 0.01; RETURN rare_ja3_hashes for investigation;,playbooks/attack/enterprise/T1573.yml
T1573: Encrypted Channel,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,6,"Can we identify groups of hosts exhibiting similar, rare TLS client behavior through clustering?","This uses unsupervised machine learning to find groups of potentially compromised hosts. By clustering rare JA3 hashes along with other connection metadata (destination port, ASN), we can uncover coordinated activity where multiple machines use the same non-standard client, possibly indicating a single malware campaign.","Zeek ssl.log; Network sensors capturing TLS handshakes (e.g., Zeek sensors at network chokepoints)",Last 90 days,"pseudocode: | CLUSTER ja3 hashes with metadata (port, ASN, TLD) using DBSCAN; ANALYZE small, dense clusters of rare hashes; RETURN suspicious_clusters;",playbooks/attack/enterprise/T1573.yml
T1573: Encrypted Channel,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,7,Are any external SSL/TLS connections using self-signed certificates or certificates with generic subject information?,"While self-signed certificates have legitimate internal uses, their use for external connections is highly suspicious and a common tactic for malware C2. Likewise, certificates with empty or generic subject names are a red flag, as legitimate entities provide valid identifying information.",Zeek x509.log; Zeek ssl.log; Network egress points with SSL/TLS inspection capabilities; Certificate Transparency logs,Last 90 days,pseudocode: | FILTER x509_logs for (issuer == subject) OR (subject_cn is generic); CHECK connection is external; ALERT on matches;,playbooks/attack/enterprise/T1573.yml
T1573: Encrypted Channel,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,8,"Are we observing SSL/TLS certificates with unusually short or long validity periods, or with low-entropy subject names?",Legitimate certificates typically have validity periods between 90 and 398 days. Significant deviations can indicate a hastily created or non-standard certificate used for malicious purposes. Low-entropy (random-looking) subject common names are also a common indicator of auto-generated C2 certificates.,Zeek x509.log; Zeek ssl.log; Network egress points with SSL/TLS inspection capabilities; Certificate Transparency logs,Last 90 days,pseudocode: | CALCULATE validity_period distribution; FLAG certs in <5th or >95th percentile; CALCULATE subject_cn_entropy distribution; FLAG certs in <5th percentile; RETURN anomalous_certs;,playbooks/attack/enterprise/T1573.yml
T1573: Encrypted Channel,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,9,Can a machine learning model be used to classify newly observed certificates as 'benign' or 'suspicious' based on their attributes?,"This question proposes a proactive method to automatically vet all new SSL/TLS certificates. By training a model on features like self-signed status, validity period, and key length, the system can learn to distinguish legitimate certificates from those used by adversaries, flagging them for review.",Zeek x509.log; Zeek ssl.log; Network egress points with SSL/TLS inspection capabilities; Certificate Transparency logs,Last 90 days,"pseudocode: | SCORE new certificates with trained_model; FEATURES = [is_self_signed, validity_period, subject_entropy, key_length]; ALERT if classified as 'suspicious';",playbooks/attack/enterprise/T1573.yml
T1573: Encrypted Channel,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,10,Are any internal hosts making an unusually high number of connections to external destinations that are not major cloud or CDN providers?,"Malware often communicates with its C2 server frequently. This question aims to catch this 'noisy' behavior by looking for a high connection count to a single destination. By excluding well-known services (like Akamai, Cloudflare, AWS), we can focus on high-frequency connections to more obscure destinations, which are more likely to be malicious.","Zeek conn.log; Client subnets, servers with direct internet access; Network flow collectors at key network boundaries",Last 90 days,pseudocode: | COUNT connections per src-dest pair in 24h; IF count > 100 AND port == 443 AND SNI is not in (CDN_allow_list); FLAG for review;,playbooks/attack/enterprise/T1573.yml
T1573: Encrypted Channel,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,11,Are there any communication channels exhibiting highly regular time intervals (beaconing) and consistent data sizes between connections?,"This question looks for the classic sign of automated malware: beaconing. By calculating the time difference between consecutive connections to the same destination, a very low standard deviation indicates a machine-like, periodic signal. Low variance in payload sizes further strengthens this hypothesis.","Zeek conn.log; Client subnets, servers with direct internet access; Network flow collectors at key network boundaries",Last 90 days,pseudocode: | GROUP connections by src-dest; CALCULATE time_delta_std_dev; CALCULATE payload_size_std_dev; IF time_delta_std_dev < 1s; ALERT for beaconing;,playbooks/attack/enterprise/T1573.yml
T1573: Encrypted Channel,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,12,"Can we use frequency analysis (FFT) to detect periodic beaconing signals, even if they are jittered or hidden in noisy traffic?","This is an advanced technique to detect beaconing where attackers add random delays ('jitter') to evade simple time-delta analysis. A Fast Fourier Transform (FFT) can reveal a strong underlying periodic signal even with jitter, providing a high-fidelity way to detect automated C2 communication.","Zeek conn.log; Client subnets, servers with direct internet access; Network flow collectors at key network boundaries",Last 90 days,pseudocode: | CREATE time_series of connections for each src-dest channel; APPLY FFT to time_series; IF strong peak in frequency domain; ALERT for periodic beaconing;,playbooks/attack/enterprise/T1573.yml
T1573: Encrypted Channel,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,13,"Are any non-browser or unapproved processes initiating outbound SSL/TLS connections, especially from unusual file paths?","Legitimate encrypted traffic usually originates from standard applications like web browsers. This question seeks to identify connections made by any other process. Such activity is highly suspicious, especially if the process runs from a temporary or user-writable directory (e.g., C:\Users\Public\), a common malware tactic.","Windows Event ID 4688; Windows Event ID 5156; Zeek conn.log; User workstations and critical servers (e.g., Domain Controllers, Application Servers); EDR agent logs",Last 90 days,pseudocode: | CORRELATE process_creation (EID 4688) with network_connection (EID 5156); IF process_name NOT in (browser_allow_list) AND connection is external; ALERT;,playbooks/attack/enterprise/T1573.yml
T1573: Encrypted Channel,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,14,Are any network-connected processes being spawned by an unusual parent process or running from a rare file path?,"Malware often uses legitimate processes to launch its components (e.g., winword.exe spawning powershell.exe). This question looks for these anomalous parent-child process relationships. It also uses 'long-tail analysis' to find processes running from paths that are rare across the enterprise, which can indicate a malicious tool placed in an obscure location.","Windows Event ID 4688; Windows Event ID 5156; Zeek conn.log; User workstations and critical servers (e.g., Domain Controllers, Application Servers); EDR agent logs",Last 90 days,"pseudocode: | BASELINE normal parent-child relationships; ALERT on deviations (e.g., winword.exe -> powershell.exe with network conn); FIND rare process paths and investigate network activity;",playbooks/attack/enterprise/T1573.yml
T1573: Encrypted Channel,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,15,Can we use an anomaly detection model to identify suspicious processes that initiate network connections?,"This question proposes using machine learning to automatically flag suspicious network-initiating processes. By training a model on normal process behavior (process name, parent, command line entropy, signature status), it can identify outliers that deviate from this baseline, which may represent malicious activity.","Windows Event ID 4688; Windows Event ID 5156; Zeek conn.log; User workstations and critical servers (e.g., Domain Controllers, Application Servers); EDR agent logs",Last 90 days,"pseudocode: | SCORE new network-initiating processes with Isolation Forest model; FEATURES = [process_name, parent_name, cmd_line_entropy, is_unsigned]; ALERT on anomalies;",playbooks/attack/enterprise/T1573.yml
T1573: Encrypted Channel,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,16,"Is SSL/TLS traffic occurring on non-standard ports, or are there any protocol violation warnings associated with TLS handshakes?","While most TLS traffic uses port 443, adversaries may use non-standard ports to evade simple firewall rules. Detecting TLS on an unexpected port is a strong indicator of suspicious activity. Associated protocol warnings (e.g., from Zeek's weird.log) can further indicate a non-standard or malicious TLS implementation.",Zeek conn.log; Zeek weird.log; Network egress points and internal network segment gateways,Last 90 days,"pseudocode: | FILTER conn_logs where service is 'ssl'/'tls' AND dest_port NOT in {443, 465, 587, 993, 995, 8443}; INCREASE severity if related 'ssl_weird' alert exists; ALERT;",playbooks/attack/enterprise/T1573.yml
T1573: Encrypted Channel,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,17,Are there any rarely used destination ports being used for SSL/TLS communication?,"This question uses frequency analysis to find anomalous port usage. By identifying which ports are very rarely used for SSL/TLS across the enterprise, analysts can focus their attention on these outliers. An adversary's C2 channel is likely to appear as a low-frequency, anomalous event in this analysis.",Zeek conn.log; Zeek weird.log; Network egress points and internal network segment gateways,Last 90 days,pseudocode: | CALCULATE frequency of all destination ports for SSL/TLS traffic; FLAG ports in the <1st percentile of usage; INVESTIGATE traffic to these rare ports;,playbooks/attack/enterprise/T1573.yml
T1573: Encrypted Channel,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0011: Command and Control,n; o; n; e,18,Can an anomaly detection model identify SSL/TLS connections that deviate from a baseline of 'normal' traffic?,"This question suggests building a model of what constitutes normal SSL/TLS traffic (e.g., on port 443, with a valid cert, common JA3). Any connection that falls outside this learned boundary is flagged as an outlier. This can effectively catch traffic on non-standard ports or with other anomalous properties without needing pre-defined rules.",Zeek conn.log; Zeek weird.log; Network egress points and internal network segment gateways,Last 90 days,"pseudocode: | TRAIN One-Class SVM on normal SSL/TLS traffic; FEATURES = [port, ja3_prevalence, cert_validity_flags]; USE model to classify new connections; ALERT on outliers;",playbooks/attack/enterprise/T1573.yml
T1574.004: Dylib Hijacking,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0003: Persistence; TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,1,Is a newly created dynamic library (dylib) malicious based on its hash or code signature?,"This question aims to detect the initial placement of a malicious dylib. Adversaries can achieve persistence by writing a malicious dylib to a location where a legitimate, auto-starting application will load from. By checking the file's hash against threat intelligence and examining its code signature, analysts can identify dylibs that are known-malicious, unsigned, ad-hoc signed, or signed by untrusted developers, which are common characteristics of hijacked libraries.","macOS Endpoint Security Framework (ES_EVENT_TYPE_NOTIFY_CREATE); osquery file table (path, sha256); osquery authenticode table; macOS endpoints, specifically LaunchAgent/LaunchDaemon plists in /Library/LaunchDaemons, /Library/LaunchAgents, ~/Library/LaunchAgents, and application bundles in /Applications/, ~/Applications/, and user-writable library paths like ~/Library/.",last 90 days,": SEARCH dylib file creation events
FOR each event:
  CALCULATE sha256_hash
  GET code_signature
  IF sha256_hash IN threat_intel_feed
  OR code_signature IN ('unsigned', 'ad-hoc', 'untrusted_developer')
  THEN ALERT (event_details)
",playbooks/attack/enterprise/T1574.004.yml
T1574.004: Dylib Hijacking,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0003: Persistence; TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,2,Has the set of dylibs loaded by an auto-starting application changed significantly from its historical baseline?,"This question seeks to identify dylib hijacking by detecting deviations from normal application behavior. By establishing a baseline of dylibs that an auto-starting application normally loads, analysts can spot when a new, unexpected dylib is introduced into its search path. A low Jaccard similarity score between the current dylib set and the baseline indicates a potential hijack.","macOS Endpoint Security Framework (ES_EVENT_TYPE_NOTIFY_CREATE); osquery file table (path, sha256); osquery authenticode table; osquery process_open_files table; macOS endpoints, specifically LaunchAgent/LaunchDaemon plists in /Library/LaunchDaemons, /Library/LaunchAgents, ~/Library/LaunchAgents, and application bundles in /Applications/, ~/Applications/, and user-writable library paths like ~/Library/.",last 30 days,": DEFINE baseline_dylibs for each auto-start app over 30 days
ON new dylib load by auto-start app:
  GET current_dylibs_loaded
  CALCULATE jaccard_similarity(current_dylibs_loaded, baseline_dylibs)
  IF jaccard_similarity < 0.95 THEN ALERT
",playbooks/attack/enterprise/T1574.004.yml
T1574.004: Dylib Hijacking,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0003: Persistence; TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,3,Can machine learning predict if a dylib file write event is malicious based on its context?,"This question leverages a machine learning model to proactively identify high-risk dylib write events. The model analyzes features like the file path's randomness (entropy), the process responsible for the write (e.g., 'curl'), and the writability of the path to score the event's maliciousness. This helps automate detection of sophisticated placement techniques that might evade simpler rules.","macOS Endpoint Security Framework (ES_EVENT_TYPE_NOTIFY_CREATE); osquery file table (path, sha256); osquery authenticode table; macOS endpoints, specifically LaunchAgent/LaunchDaemon plists in /Library/LaunchDaemons, /Library/LaunchAgents, ~/Library/LaunchAgents, and application bundles in /Applications/, ~/Applications/, and user-writable library paths like ~/Library/.",last 90 days,": ON dylib file write event:
  EXTRACT features (path_entropy, writing_process, is_user_writable, time_delta_to_app_launch)
  SCORE event with Random Forest model
  IF score > 0.9 THEN ALERT
",playbooks/attack/enterprise/T1574.004.yml
T1574.004: Dylib Hijacking,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0003: Persistence; TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,4,Is a process started by launchd (PID 1) loading a dylib from a user-writable directory?,"This question targets a common persistence pattern where a malicious dylib is placed in a non-standard, user-writable location like '/Users/Shared/' or '/tmp/'. Since system processes initiated by launchd should typically load libraries from protected system directories, loading one from a user-writable location is highly suspicious and indicative of a hijack.","macOS Endpoint Security Framework (ES_EVENT_TYPE_NOTIFY_MMAP); osquery process_open_files table; osquery processes table (for parent PID); macOS endpoints, focusing on processes spawned by launchd (PID 1) and their file open/memory map events, specifically monitoring user-writable locations like /tmp/, /Users/Shared/, and user home directories.",last 90 days,": SEARCH for process events where parent_pid is 1
FILTER for events loading a .dylib file
IF dylib_path starts with '/Users/Shared/', '/tmp/', or '/Users/*/'
AND process_name NOT IN allowlist
THEN ALERT
",playbooks/attack/enterprise/T1574.004.yml
T1574.004: Dylib Hijacking,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0003: Persistence; TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,5,Is an auto-starting process loading a dylib from a statistically rare file path?,"This question uses environmental baselining to find outliers. By calculating the frequency of all dylib load paths across the entire organization, analysts can identify loads from paths that are exceptionally uncommon. An auto-starting process loading a library from a very rare path is a strong anomaly signal, suggesting an adversary is using an unusual location to evade detection.","macOS Endpoint Security Framework (ES_EVENT_TYPE_NOTIFY_MMAP); osquery process_open_files table; osquery processes table (for parent PID); macOS endpoints, focusing on processes spawned by launchd (PID 1) and their file open/memory map events, specifically monitoring user-writable locations like /tmp/, /Users/Shared/, and user home directories.",last 30 days,": CALCULATE frequency of all dylib load paths globally over 30 days
FOR each dylib load by a process with parent_pid 1:
  GET path_frequency_score
  IF path_frequency_score is in bottom 5th percentile THEN ALERT
",playbooks/attack/enterprise/T1574.004.yml
T1574.004: Dylib Hijacking,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0003: Persistence; TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,6,"Does a graph-based model show a new, high-risk relationship between an auto-starting process and a dylib?","This question applies graph analytics to detect anomalies in process-file interactions. A graph representing 'who loads what from where' is built from a baseline of normal activity. A new edge in the graph, such as one connecting a trusted auto-start process like 'CalendarAgent' to a dylib in a suspicious path like '~/Downloads/', represents a structural change in behavior and a potential hijack.","macOS Endpoint Security Framework (ES_EVENT_TYPE_NOTIFY_MMAP); osquery process_open_files table; osquery processes table (for parent PID); macOS endpoints, focusing on processes spawned by launchd (PID 1) and their file open/memory map events, specifically monitoring user-writable locations like /tmp/, /Users/Shared/, and user home directories.",last 90 days,": MAINTAIN a graph of (process)-[loads_from]->(dylib) at (path)
ON new dylib load event:
  IF the new edge connects an auto-start process to a dylib in a user-writable path
  AND edge did not exist in baseline
  THEN ALERT
",playbooks/attack/enterprise/T1574.004.yml
T1574.004: Dylib Hijacking,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0003: Persistence; TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,7,"Is an auto-starting process, which normally doesn't use the network, making external network connections?","This question helps detect when a hijacked process is used for command and control or data exfiltration. By maintaining a list of auto-starting processes that are not expected to make network connections, any attempt by them to communicate with an external IP address becomes a high-fidelity alert, suggesting their normal function has been subverted.","macOS Endpoint Security Framework (ES_EVENT_TYPE_NOTIFY_EXEC); Zeek conn.log; Zeek dns.log; Network egress points, DNS servers, and macOS endpoints (for process context).",last 90 days,": DEFINE non-networking_process_allowlist
SEARCH network connection logs
FOR each connection:
  GET process_name from endpoint logs using timestamp and source_ip
  IF process_name IN non-networking_process_allowlist
  AND destination_ip is external
  THEN ALERT
",playbooks/attack/enterprise/T1574.004.yml
T1574.004: Dylib Hijacking,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0003: Persistence; TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,8,Is an auto-starting process exhibiting anomalous network behavior compared to its baseline?,"This question identifies subtle signs of hijacking by profiling the normal network activity of auto-starting processes. Even for processes that are expected to use the network, a significant deviation from their baseline—such as connecting to a new ASN, using a strange port, or transferring an unusually large amount of data—can indicate that the process has been compromised and is being used for malicious purposes.","macOS Endpoint Security Framework (ES_EVENT_TYPE_NOTIFY_EXEC); Zeek conn.log; Zeek dns.log; Network egress points, DNS servers, and macOS endpoints (for process context).",last 90 days,": FOR each auto-start process:
  CREATE network baseline (dest_asn, dest_port, protocol, ja3, daily_volume)
  MONITOR new connections
  IF new connection features deviate significantly from baseline
  OR data volume > (average + 4 * std_dev)
  THEN ALERT
",playbooks/attack/enterprise/T1574.004.yml
T1574.004: Dylib Hijacking,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0003: Persistence; TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,9,"Is an auto-starting application's network traffic volume significantly higher than its forecasted amount, especially after a system start?","This question uses time-series forecasting to detect unexpected bursts of network activity, a potential sign of a hijacked process communicating with a C2 server or exfiltrating data. By modeling the expected traffic volume per hour, any observed traffic that dramatically exceeds the forecast's confidence interval, particularly right after a user logs in, can be flagged as a high-risk anomaly.","macOS Endpoint Security Framework (ES_EVENT_TYPE_NOTIFY_EXEC); Zeek conn.log; Zeek dns.log; Network egress points, DNS servers, and macOS endpoints (for process context).",last 90 days,": FOR each auto-start app:
  TRAIN ARIMA model on hourly network traffic volume
  CONTINUOUSLY forecast expected volume
  GET real-time traffic volume
  IF real-time_volume > forecasted_volume_confidence_interval
  (especially within 1 hour of boot/login)
  THEN ALERT
",playbooks/attack/enterprise/T1574.004.yml
T1574.004: Dylib Hijacking,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0003: Persistence; TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,10,Was a dylib created by a non-root user in a world-writable directory just before a vulnerable SUID binary was executed?,"This question targets a specific privilege escalation sequence. An adversary with standard user permissions may write a malicious dylib to a shared location like '/tmp' and then trigger a vulnerable SUID-enabled program. The privileged program then inadvertently loads the malicious dylib, executing the adversary's code with elevated permissions. Correlating these two events within a short time window is key to detection.","macOS Endpoint Security Framework (ES_EVENT_TYPE_NOTIFY_CREATE, ES_EVENT_TYPE_NOTIFY_EXEC); osquery suid_bin table; system.log; macOS endpoints, focusing on SUID/GUID binaries, privileged helper tools, and world-writable directories such as /tmp/ and /Users/Shared/.",last 90 days,": DEFINE vulnerable_suid_binaries_list
SEARCH for dylib creation events where user_id > 500 AND path is world-writable
IF a process from vulnerable_suid_binaries_list is executed on same host within 60 seconds
THEN ALERT
",playbooks/attack/enterprise/T1574.004.yml
T1574.004: Dylib Hijacking,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0003: Persistence; TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,11,Is a process running as root loading a dylib from a new or user-writable path not seen in its baseline?,"This question focuses on detecting privilege escalation by monitoring the integrity of root-level processes. These processes should be highly predictable. By baselining the legitimate dylibs they load, any deviation—especially loading a dylib from a user-writable path or a path never seen before—is a critical indicator that the root process has been hijacked to load malicious code.","macOS Endpoint Security Framework (ES_EVENT_TYPE_NOTIFY_CREATE, ES_EVENT_TYPE_NOTIFY_EXEC); osquery suid_bin table; system.log; macOS endpoints, focusing on SUID/GUID binaries, privileged helper tools, and world-writable directories such as /tmp/ and /Users/Shared/.",last 90 days,": FOR each process running with eUID 0:
  ESTABLISH baseline of legitimate dylib load paths
  MONITOR for dylib load events
  IF loaded_dylib_path NOT IN baseline
  AND (path is user-writable OR dylib_creation_time is recent)
  THEN ALERT
",playbooks/attack/enterprise/T1574.004.yml
T1574.004: Dylib Hijacking,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0003: Persistence; TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,12,"Does a sequence of endpoint events, captured by an LSTM model, indicate a dylib-based privilege escalation?","This question uses a sophisticated sequence-aware model (LSTM) to detect privilege escalation tactics. The model learns the normal sequences of process creations and file writes that occur on an endpoint. An anomalous sequence, such as a user process writing a dylib immediately followed by the execution of a privileged SUID binary, would be flagged by the model as a deviation from learned legitimate behavior.","macOS Endpoint Security Framework (ES_EVENT_TYPE_NOTIFY_CREATE, ES_EVENT_TYPE_NOTIFY_EXEC); osquery suid_bin table; system.log; macOS endpoints, focusing on SUID/GUID binaries, privileged helper tools, and world-writable directories such as /tmp/ and /Users/Shared/.",last 90 days,": TRAIN LSTM model on sequences of (process_exec, file_create) events
FEED live event stream into model
IF model flags a sequence as anomalous
AND sequence matches (user_writes_dylib -> privileged_process_executes)
THEN ALERT
",playbooks/attack/enterprise/T1574.004.yml
T1574.004: Dylib Hijacking,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0003: Persistence; TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,13,Did a standard user process write a dylib to a SIP-protected system directory?,"This question identifies a critical security boundary violation. System Integrity Protection (SIP) is designed to prevent modification of core system directories, even by the root user. A successful dylib creation in a path like '/System/Library/' by a non-root process (UID > 0) implies a SIP bypass or a severe system misconfiguration has been exploited, representing a high-severity privilege escalation event.","macOS Endpoint Security Framework (ES_EVENT_TYPE_NOTIFY_CREATE); osquery file_events table; Protected macOS directories such as /System/, /Library/, /usr/bin/, /usr/sbin/, and privileged Application bundles in /Applications/.",last 90 days,": SEARCH for file creation events
IF file_name ends with '.dylib'
AND file_path starts with '/System/', '/Library/', '/usr/lib/'
AND process_euid > 0
THEN CREATE CRITICAL ALERT
",playbooks/attack/enterprise/T1574.004.yml
T1574.004: Dylib Hijacking,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0003: Persistence; TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,14,Is a user process writing files to a directory path that is statistically rare for that user?,"This question uses user-specific behavioral baselining to spot anomalies. While a user writing to '/tmp' might be normal, that same user writing a dylib to a subdirectory of another user's home directory or a deep system path would be highly unusual. By identifying writes to paths that are rare for a specific user, analysts can uncover attempts to stage malicious files in unexpected locations as part of a privilege escalation attempt.","macOS Endpoint Security Framework (ES_EVENT_TYPE_NOTIFY_CREATE); osquery file_events table; Protected macOS directories such as /System/, /Library/, /usr/bin/, /usr/sbin/, and privileged Application bundles in /Applications/.",last 90 days,": FOR each user:
  BASELINE frequency of file write paths
  MONITOR new file write events
  IF write_path is in bottom 1% of frequency for that user
  AND file is a .dylib
  THEN ALERT
",playbooks/attack/enterprise/T1574.004.yml
T1574.004: Dylib Hijacking,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0003: Persistence; TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,15,Does a one-class SVM model classify a dylib creation in a system path by a user process as an anomaly?,"This question employs anomaly detection to find malicious file write activity that deviates from established norms. A One-Class SVM is trained on legitimate file modification events by non-root users to learn a 'boundary' of normal behavior. Any new file write, especially a dylib creation in a system directory, that falls outside this boundary is flagged as a potential exploit, providing a powerful way to detect novel or obfuscated privilege escalation techniques.","macOS Endpoint Security Framework (ES_EVENT_TYPE_NOTIFY_CREATE); osquery file_events table; Protected macOS directories such as /System/, /Library/, /usr/bin/, /usr/sbin/, and privileged Application bundles in /Applications/.",last 90 days,": TRAIN One-Class SVM on legitimate file write events (path, process, extension)
SCORE new file write events with the model
IF model classifies event as anomaly
AND event is dylib creation in system path by non-root user
THEN ALERT
",playbooks/attack/enterprise/T1574.004.yml
T1574.004: Dylib Hijacking,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0003: Persistence; TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,16,"Is a trusted, signed macOS process making a network connection to a known malicious destination?","This question seeks to uncover defense evasion, where an adversary hijacks a trusted process (like Safari or a security tool) to blend in their C2 traffic. By cross-referencing network logs with threat intelligence feeds, a connection from a trusted Apple-signed binary to a malicious IP becomes a high-fidelity indicator that the trusted process has been compromised via dylib hijacking.","Zeek conn.log (id.resp_h, ja3, ja3s); Zeek dns.log (query, answers); macOS Endpoint Security Framework logs (for process name and path); Network egress points, DNS servers, and macOS endpoints running trusted, signed applications.",last 90 days,": SEARCH network logs for destination_ip in C2_threat_feed
FOR each match:
  CORRELATE with endpoint logs to find source_process_name
  IF source_process_name is a trusted, signed binary (e.g., path starts with /System/Applications/)
  THEN CREATE CRITICAL ALERT
",playbooks/attack/enterprise/T1574.004.yml
T1574.004: Dylib Hijacking,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0003: Persistence; TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,17,Is a trusted process making a network connection that is statistically abnormal based on its multi-feature profile?,"This question uses advanced statistical analysis to find subtle signs of process hijacking. It creates a detailed baseline of normal network behavior for each trusted process, including destination ports, protocols, and TLS fingerprints (JA3). The Mahalanobis distance is then used to score how much a new connection deviates from this multi-dimensional norm. A high score indicates a significant anomaly, suggesting the process's behavior has been altered by malicious code.","Zeek conn.log (id.resp_h, ja3, ja3s); Zeek dns.log (query, answers); macOS Endpoint Security Framework logs (for process name and path); Network egress points, DNS servers, and macOS endpoints running trusted, signed applications.",last 90 days,": FOR each trusted process:
  CREATE network profile baseline (port, protocol, JA3, JA3S)
  FOR each new connection:
    CALCULATE Mahalanobis distance from baseline
    IF distance is high THEN ALERT
",playbooks/attack/enterprise/T1574.004.yml
T1574.004: Dylib Hijacking,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0003: Persistence; TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,18,Does an autoencoder model flag a network connection from a trusted application as anomalous?,"This question applies a deep learning approach to detect defense evasion. An autoencoder is trained to 'reconstruct' legitimate network connection patterns from trusted apps. When a hijacked process makes a malicious connection, its features (process, port, protocol, etc.) will differ from the training data. The autoencoder will fail to reconstruct this anomalous pattern accurately, resulting in a high reconstruction error and triggering an alert.","Zeek conn.log (id.resp_h, ja3, ja3s); Zeek dns.log (query, answers); macOS Endpoint Security Framework logs (for process name and path); Network egress points, DNS servers, and macOS endpoints running trusted, signed applications.",last 90 days,": TRAIN autoencoder on legitimate connection metadata
FOR each new connection from a trusted app:
  CALCULATE reconstruction_error using the autoencoder
  IF reconstruction_error > threshold THEN ALERT
",playbooks/attack/enterprise/T1574.004.yml
T1574.004: Dylib Hijacking,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0003: Persistence; TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,19,Is a legitimate macOS application running from a user-writable directory instead of its proper installation path?,"This question detects a common setup for dylib side-loading. Adversaries often copy a legitimate, trusted application (like 'Safari' or 'Calculator') to a user-writable directory (like '~/Downloads'). They then place a malicious dylib in the same directory. When the copied application is executed, it loads the malicious dylib from its local path instead of the legitimate one. Detecting a trusted app running from an unusual location is a strong precursor to this attack.","macOS Endpoint Security Framework (ES_EVENT_TYPE_NOTIFY_EXEC); osquery process_events table (path, cmdline); User-writable directories on macOS endpoints, such as ~/Downloads, ~/Documents, /Users/Shared/, and /tmp/.",last 90 days,": DEFINE trusted_app_names (e.g., 'Safari', 'Calculator')
SEARCH process execution events
IF process_name IN trusted_app_names
AND process_path is in a user-writable directory (e.g., /Users/*, /tmp/)
THEN ALERT
",playbooks/attack/enterprise/T1574.004.yml
T1574.004: Dylib Hijacking,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0003: Persistence; TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,20,Is a known-good process executing from a path with unusually high entropy?,"This question aims to detect adversaries who randomize file paths to evade simple path-based detection rules. While a process like 'Safari' normally runs from a predictable, low-entropy path (e.g., '/System/Applications/Safari.app/...'), an adversary might place it in a deeply nested, randomized directory to hide it. A high path entropy score for a known-good process name is a strong indicator of such evasive staging.","macOS Endpoint Security Framework (ES_EVENT_TYPE_NOTIFY_EXEC); osquery process_events table (path, cmdline); User-writable directories on macOS endpoints, such as ~/Downloads, ~/Documents, /Users/Shared/, and /tmp/.",last 90 days,": FOR each process execution:
  CALCULATE Shannon entropy of process_path
  GET baseline entropy for that process_name
  IF path_entropy > 99th percentile for that process_name THEN ALERT
",playbooks/attack/enterprise/T1574.004.yml
T1574.004: Dylib Hijacking,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0003: Persistence; TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,21,"Does a clustering algorithm identify a small, dense group of anomalous process executions?","This question uses unsupervised machine learning to find outliers that rule-based methods might miss. By clustering process executions based on features like path, parent process, and user, the DBSCAN algorithm can automatically group normal activities into large clusters. Small, isolated clusters often represent rare and suspicious behaviors, such as a trusted application being executed from a strange location by an unusual parent process, which is a hallmark of a side-loading attack.","macOS Endpoint Security Framework (ES_EVENT_TYPE_NOTIFY_EXEC); osquery process_events table (path, cmdline); User-writable directories on macOS endpoints, such as ~/Downloads, ~/Documents, /Users/Shared/, and /tmp/.",last 90 days,": CLUSTER process execution events using DBSCAN on features (path, parent_name, user_id)
REVIEW small, dense clusters flagged as anomalies
IF cluster represents trusted app in unusual location THEN ALERT
",playbooks/attack/enterprise/T1574.004.yml
T1574.004: Dylib Hijacking,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0003: Persistence; TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,22,Is a typically non-network-facing application (like Calculator) making network connections or spawning a shell?,"This question identifies blatant behavioral anomalies that indicate a process hijack. Applications like TextEdit or Calculator have no legitimate reason to initiate network connections or spawn shell processes (bash, zsh). If such an event occurs, it is a very high-confidence indicator that the application's code execution flow has been hijacked by a malicious dylib to perform unauthorized actions.","macOS Endpoint Security Framework (ES_EVENT_TYPE_NOTIFY_EXEC, ES_EVENT_TYPE_NOTIFY_FORK); Zeek conn.log; Zeek dns.log; macOS endpoints and network egress points.",last 90 days,": DEFINE non-networking_app_list ('Calculator.app', 'TextEdit.app')
SEARCH for process events where parent_process in non-networking_app_list
IF child_process is in ('zsh', 'bash', 'sh', 'osascript') THEN ALERT
SEARCH network logs for connections from processes in non-networking_app_list
IF connection to external IP exists THEN ALERT
",playbooks/attack/enterprise/T1574.004.yml
T1574.004: Dylib Hijacking,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0003: Persistence; TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,23,Is a non-network-facing application spawning a statistically rare child process?,"This question looks for subtler signs of hijacking by analyzing process lineage. By creating a frequency distribution of all parent-child process relationships, analysts can spot when an application like 'Font Book' spawns a child process it has never spawned before, or one that is extremely rare (like 'curl' or 'python'). This deviation from normal process creation behavior suggests the parent has been compromised.","macOS Endpoint Security Framework (ES_EVENT_TYPE_NOTIFY_EXEC, ES_EVENT_TYPE_NOTIFY_FORK); Zeek conn.log; Zeek dns.log; macOS endpoints and network egress points.",last 30 days,": BASELINE parent-child process relationships over 30 days
FOR each new process creation event:
  IF parent is non-network-facing app
  AND child process is statistically rare for that parent (<0.01% frequency)
  THEN ALERT
",playbooks/attack/enterprise/T1574.004.yml
T1574.004: Dylib Hijacking,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0003: Persistence; TA0004: Privilege Escalation; TA0005: Defense Evasion,n; o; n; e,24,Does a graph-based model detect the creation of an anomalous process parent-child relationship?,"This question uses a graph neural network (like GraphSAGE) to understand the normal context of process relationships. The model learns embeddings that represent a process's typical behavior within the process lineage graph. When a new, unexpected relationship is formed—such as an edge appearing between 'TextEdit' and 'zsh'—the model flags it as a contextual anomaly, indicating a likely hijack that simpler frequency analysis might miss.","macOS Endpoint Security Framework (ES_EVENT_TYPE_NOTIFY_EXEC, ES_EVENT_TYPE_NOTIFY_FORK); Zeek conn.log; Zeek dns.log; macOS endpoints and network egress points.",last 90 days,": TRAIN GraphSAGE model on legitimate process parent-child graph
MONITOR for new process creation events (new edges)
IF a new edge (e.g., TextEdit -> zsh) is flagged as anomalous by the model
THEN ALERT",playbooks/attack/enterprise/T1574.004.yml
T1583: Acquire Infrastructure,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,1,"Are internal hosts connecting to external destinations (IPs, domains) or using certificates that are on a known malicious infrastructure threat intelligence feed?","This question aims to perform a direct match of outbound network traffic against a high-confidence list of known malicious Indicators of Compromise (IOCs). This is a foundational step in threat detection, as a positive match provides a strong signal of malicious activity. By continuously monitoring destination IPs, domains, and SSL/TLS certificate hashes, an organization can quickly identify communication with adversary-controlled C2 servers.","Zeek conn.log; Zeek dns.log; Zeek ssl.log; Zeek x509.log; Threat Intelligence C2 Feed; Enterprise network egress points (Firewalls, Proxies); Internal DNS resolvers and forwarders; VPN concentrators; Cloud IaaS/PaaS VPC egress gateways",last 90 days,: FROM network_logs JOIN threat_intel_feed ON (network_logs.destination_ip = threat_intel_feed.ip OR network_logs.domain = threat_intel_feed.domain OR network_logs.cert_hash = threat_intel_feed.hash) GENERATE high_priority_alert,playbooks/attack/enterprise/T1583.yml
T1583: Acquire Infrastructure,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,2,"If a connection to a known malicious indicator is found, is the activity widespread across the network?","This question helps an analyst assess the scope of a potential compromise. A single host connecting to a malicious IOC might indicate an isolated infection, but multiple distinct hosts connecting to the same IOC suggests a widespread campaign. By calculating the frequency of connections from unique internal sources and comparing it to a baseline, we can automatically escalate the priority for incidents that appear to be more broadly impacting the enterprise.","Zeek conn.log; Zeek dns.log; Zeek ssl.log; Zeek x509.log; Threat Intelligence C2 Feed; Enterprise network egress points (Firewalls, Proxies); Internal DNS resolvers and forwarders; VPN concentrators; Cloud IaaS/PaaS VPC egress gateways",last 90 days,": FOR each matched_ioc, COUNT distinct source_ip over 24h. IF count > 95th_percentile_of_all_external_destinations, ESCALATE alert_priority.",playbooks/attack/enterprise/T1583.yml
T1583: Acquire Infrastructure,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,3,"Can we proactively identify high-risk outbound connections that resemble malicious infrastructure communication, even without a direct IOC match?","This question addresses the challenge of detecting threats from new or unknown infrastructure not yet present in threat intelligence feeds. By using a machine learning model to assign a risk score to all outbound connections based on a combination of features (e.g., IP reputation, domain age, ASN, certificate details), we can identify suspicious activity that shares characteristics with known malicious infrastructure. This provides a proactive detection capability beyond simple IOC matching.","Zeek conn.log; Zeek dns.log; Zeek ssl.log; Zeek x509.log; Threat Intelligence C2 Feed; Enterprise network egress points (Firewalls, Proxies); Internal DNS resolvers and forwarders; VPN concentrators; Cloud IaaS/PaaS VPC egress gateways",last 90 days,": FOR each outbound_connection, CALCULATE risk_score using classification_model(features). IF risk_score > 0.85, FLAG for investigation.",playbooks/attack/enterprise/T1583.yml
T1583: Acquire Infrastructure,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,4,Is there any outbound SSL/TLS traffic matching the fingerprint (JA3/JA3S) or certificate details of known malicious C2 frameworks?,"This question leverages the concept of TLS fingerprinting to identify specific malware families or adversary tools. The way a client initiates a TLS session creates a unique fingerprint (JA3/JA3S). By comparing these fingerprints against a known list of malicious ones, we can detect C2 communication even if the destination IP and domain are unknown. Additionally, checking for default or suspicious values in self-signed certificates (e.g., 'localhost') can reveal lazy adversary setups.",Zeek conn.log; Zeek ssl.log; Zeek x509.log; Threat Intelligence JA3/C2 Certificate Feed; Enterprise network egress points; SSL/TLS inspection appliances; Demilitarized Zone (DMZ) servers; Application delivery controllers (ADCs),last 90 days,: FROM ssl_logs JOIN ja3_watchlist ON (ssl_logs.ja3_hash = ja3_watchlist.hash) OR (ssl_logs.cert_subject CONTAINS 'suspicious_string') GENERATE alert.,playbooks/attack/enterprise/T1583.yml
T1583: Acquire Infrastructure,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,5,Are there statistical anomalies in the diversity of SSL/TLS client fingerprints (JA3) that suggest a specific tool or malware is becoming more prevalent?,"This question uses statistical analysis to find C2 activity without relying on pre-existing indicators. A healthy network has a wide variety of TLS clients, resulting in high entropy of JA3 hashes. If a specific malware is deployed across many machines, they will all use the same TLS client, causing a sudden spike in one JA3 hash's frequency and a decrease in overall entropy. Monitoring for these statistical shifts can reveal this 'homogenization' of C2 channels.",Zeek conn.log; Zeek ssl.log; Zeek x509.log; Threat Intelligence JA3/C2 Certificate Feed; Enterprise network egress points; SSL/TLS inspection appliances; Demilitarized Zone (DMZ) servers; Application delivery controllers (ADCs),last 90 days,": FOR each ja3_hash, CALCULATE hourly_count. IF hourly_count > (30_day_moving_average + 3 * std_dev), FLAG as anomalous.",playbooks/attack/enterprise/T1583.yml
T1583: Acquire Infrastructure,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,6,Can we identify unknown or novel C2 communication by finding clusters of SSL/TLS traffic that are anomalous compared to normal application traffic?,"This question focuses on discovering novel threats using unsupervised machine learning. By clustering SSL/TLS sessions based on their features (JA3, certificate details, cipher suites, etc.), we can group traffic from similar applications. Any small, distinct clusters that do not group with known-good applications (like browsers or updaters) are inherently anomalous and warrant investigation as potential C2 channels.",Zeek conn.log; Zeek ssl.log; Zeek x509.log; Threat Intelligence JA3/C2 Certificate Feed; Enterprise network egress points; SSL/TLS inspection appliances; Demilitarized Zone (DMZ) servers; Application delivery controllers (ADCs),last 90 days,: APPLY DBSCAN clustering on ssl_session_features. ANALYZE clusters that are not associated with known_good_applications.,playbooks/attack/enterprise/T1583.yml
T1583: Acquire Infrastructure,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,7,Are internal hosts connecting to newly registered domains (NRDs) that also exhibit other suspicious characteristics like WHOIS privacy or hosting on a malicious ASN?,"Adversaries frequently use newly registered domains (NRDs) for their campaigns, as these domains have no prior reputation. This question aims to identify connections to these NRDs (e.g., registered < 30 days ago) and increase confidence by correlating this with other risk factors, such as the use of WHOIS privacy services to hide ownership or hosting on an Autonomous System Number (ASN) known for malicious activity. This multi-factored approach reduces false positives from legitimate new domains.",Zeek conn.log; Zeek dns.log; Passive DNS and WHOIS Data Feed; Internal DNS resolvers and forwarders; Enterprise network egress points; External domain registration data providers,last 90 days,": FROM dns_logs ENRICH with whois_data. IF domain_age < 30d AND (has_whois_privacy OR is_on_risky_asn), FLAG connection.",playbooks/attack/enterprise/T1583.yml
T1583: Acquire Infrastructure,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,8,Is there an unusually high number of internal hosts ('flocking') connecting to a specific newly registered domain?,"While a single host connecting to an NRD might be benign, a large number of internal clients suddenly connecting to the same NRD is a strong indicator of a coordinated campaign. This behavior, often called 'flocking,' can signify that a piece of malware has been activated across multiple endpoints, all reaching out to the same C2 domain. This question seeks to detect this anomaly by baselining normal NRD traffic and alerting when a specific NRD exceeds a high-percentile threshold for unique clients or traffic volume.",Zeek conn.log; Zeek dns.log; Passive DNS and WHOIS Data Feed; Internal DNS resolvers and forwarders; Enterprise network egress points; External domain registration data providers,last 90 days,": FOR each NRD, COUNT unique_clients_per_day. IF count > 99th_percentile_of_all_NRDs, GENERATE alert for flocking_behavior.",playbooks/attack/enterprise/T1583.yml
T1583: Acquire Infrastructure,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,9,"Is there a sudden, unexpected spike in the overall number of new NRDs being accessed across the enterprise, suggesting a broad new campaign?","This question takes a macro view to detect large-scale campaigns. Instead of looking at a single NRD, it analyzes the total volume of new, previously unseen NRDs being accessed across the enterprise. By using a time series forecasting model, we can predict the expected number of new NRDs for any given day. A significant deviation from this forecast (i.e., a much higher observed count) could indicate that an adversary has activated a large batch of new domains for a widespread attack.",Zeek conn.log; Zeek dns.log; Passive DNS and WHOIS Data Feed; Internal DNS resolvers and forwarders; Enterprise network egress points; External domain registration data providers,last 90 days,": FORECAST daily_new_nrd_count using ARIMA model. IF observed_count > forecast_upper_confidence_bound, GENERATE alert.",playbooks/attack/enterprise/T1583.yml
T1583: Acquire Infrastructure,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,10,Is a non-standard or suspicious process on an endpoint making an outbound network connection?,"This question pivots to the endpoint to identify the origin of suspicious network traffic. Legitimate user-initiated traffic usually comes from web browsers. Outbound connections originating from processes like PowerShell, WScript, or unknown executables running from temporary directories are highly suspect. By correlating network connection events (Windows Event ID 5156) with process creation events (Event ID 4688), we can link suspicious traffic to its source process and command line for a full investigative picture.","Zeek conn.log; Windows Event ID 4688; Windows Event ID 5156; Endpoint devices (workstations and servers); Network egress points and flow collectors; Cloud provider network boundaries (e.g., VPC Flow Logs)",last 90 days,": JOIN event_4688 with event_5156 ON process_id. IF process_name NOT IN ('browser.exe') AND destination_ip NOT IN (allowlist), GENERATE alert.",playbooks/attack/enterprise/T1583.yml
T1583: Acquire Infrastructure,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,11,"Is there any network traffic exhibiting a periodic 'heartbeat' or 'beaconing' pattern, characteristic of C2 communication?","This question seeks to identify the machine-like regularity of automated C2 communications. Malware often 'calls home' to its C2 server on a fixed schedule (e.g., every 5 minutes) with a similarly sized payload. This results in a very low standard deviation in both the time between connections and the amount of data sent. By analyzing these metrics for all source-destination pairs, we can statistically identify these highly regular 'beacons' that stand out from more random human-driven traffic.","Zeek conn.log; Windows Event ID 4688; Windows Event ID 5156; Endpoint devices (workstations and servers); Network egress points and flow collectors; Cloud provider network boundaries (e.g., VPC Flow Logs)",last 90 days,": FOR each src_dst_pair, CALCULATE std_dev(inter_arrival_time) and std_dev(byte_size) over 1h. IF both values < 5th_percentile, FLAG as beaconing.",playbooks/attack/enterprise/T1583.yml
T1583: Acquire Infrastructure,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,12,Can we use a machine learning model to detect anomalous outbound connections that don't conform to the patterns of known-good traffic?,"This question proposes using an anomaly detection model, such as an autoencoder, to find unknown C2 activity. The model is trained exclusively on features from known-good network sessions. It learns to 'reconstruct' this normal traffic with high accuracy. When the trained model is then applied to all new traffic, any session that it cannot reconstruct accurately (resulting in a high 'reconstruction error') is flagged as an anomaly. This is a powerful technique for finding novel threats that do not match any known patterns.","Zeek conn.log; Windows Event ID 4688; Windows Event ID 5156; Endpoint devices (workstations and servers); Network egress points and flow collectors; Cloud provider network boundaries (e.g., VPC Flow Logs)",last 90 days,": FOR each new_connection, CALCULATE reconstruction_error using trained_autoencoder_model. IF reconstruction_error > threshold, FLAG as anomalous.",playbooks/attack/enterprise/T1583.yml
T1584.001: Domains,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,1,Are internal hosts querying or connecting to domains identified as malicious by threat intelligence feeds?,"This question aims to detect direct communication with known-bad infrastructure, such as command and control (C2) servers, hijacked domains, or newly registered domains (NRDs) often used in phishing. Matching against curated threat intelligence lists is a high-fidelity method for identifying potential compromises or initial access attempts.
",Zeek dns.log; Zeek conn.log; Windows Event ID 5156; Enterprise DNS resolvers; Outbound web proxies and firewalls; Endpoint devices,last 90 days,pseudocode: SEARCH dns_logs OR connection_logs WHERE domain IN threat_intel_blocklist,playbooks/attack/enterprise/T1584.001.yml
T1584.001: Domains,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,2,"Is a newly registered domain (NRD) from a threat feed receiving an unusually high number of connections from unique internal hosts, suggesting a coordinated event?","Adversaries often use NRDs for short-lived campaigns. A sudden spike in connections from many internal hosts to a single NRD shortly after its registration can indicate a widespread, coordinated attack, such as a phishing campaign where many users click a link simultaneously. This helps differentiate targeted attacks from isolated clicks.
",Zeek dns.log; Zeek conn.log; Windows Event ID 5156; Enterprise DNS resolvers; Outbound web proxies and firewalls; Endpoint devices,last 90 days,pseudocode: SEARCH connections_to_NRD in first_24h_of_registration | COUNT unique source_ip | COMPARE count to 95th_percentile_baseline,playbooks/attack/enterprise/T1584.001.yml
T1584.001: Domains,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,3,Can we use machine learning to score and prioritize alerts from threat intelligence matches based on connection characteristics?,"Threat intelligence feeds can generate a high volume of alerts, including false positives. This question proposes using a machine learning model (Random Forest) to analyze various features of a connection (e.g., domain age, data transfer volume, connection duration) to assign a probability score. This allows analysts to focus their efforts on the highest-risk alerts, improving efficiency.
",Zeek dns.log; Zeek conn.log; Windows Event ID 5156; Enterprise DNS resolvers; Outbound web proxies and firewalls; Endpoint devices,last 90 days,"pseudocode: INPUT threat_intel_match_features (domain_age, connection_count, bytes_transferred) | APPLY random_forest_model | OUTPUT maliciousness_score",playbooks/attack/enterprise/T1584.001.yml
T1584.001: Domains,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,4,"Are hosts querying for domains that combine our organization's name with suspicious keywords, suggesting a combosquatting attack?","Combosquatting involves registering domains that add words like 'login,' 'support,' or 'hr' to a legitimate domain (e.g., 'yourcompany-support.com'). This analytic checks DNS queries against an allow-list of known good domains and uses regular expressions to find these combosquatting patterns, which are often used for phishing or credential theft.
",Zeek dns.log; Certificate Transparency Logs; Enterprise DNS resolvers; Certificate Transparency log aggregators,last 90 days,pseudocode: SEARCH dns_logs WHERE domain NOT IN org_allowlist AND domain MATCHES combosquat_regex_patterns,playbooks/attack/enterprise/T1584.001.yml
T1584.001: Domains,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,5,Are hosts querying for domains that are structurally very similar to our domains (typosquats) or use visually deceptive characters (homographs)?,"This question targets two types of domain impersonation. Typosquatting relies on misspellings (e.g., 'gogle.com'). Homograph attacks use characters from different alphabets that look identical (e.g., Cyrillic 'а' for Latin 'a'). By calculating string distance (Damerau-Levenshtein) and character randomness (Shannon entropy), we can programmatically detect these subtle but effective impersonation techniques.
",Zeek dns.log; Certificate Transparency Logs; Enterprise DNS resolvers; Certificate Transparency log aggregators,last 90 days,"pseudocode: FOREACH domain NOT IN org_allowlist | CALCULATE levenshtein_distance to nearest_allowlist_domain | IF distance <= 2 OR shannon_entropy is high with punycode, ALERT",playbooks/attack/enterprise/T1584.001.yml
T1584.001: Domains,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,6,Can a machine learning model be trained to predict the likelihood that a newly observed domain is a typosquat?,"This moves beyond simple rules to a more sophisticated, predictive approach. By training a model on features of known legitimate and typosquatted domains (like character patterns, string distance, and keyword presence), the system can score any new, non-allow-listed domain in real-time. This provides a probabilistic assessment, helping to identify novel or complex typosquatting attempts that rules might miss.
",Zeek dns.log; Certificate Transparency Logs; Enterprise DNS resolvers; Certificate Transparency log aggregators,last 90 days,"pseudocode: INPUT new_domain_features (n_grams, char_ratio, levenshtein_distance) | APPLY logistic_regression_model | OUTPUT typosquat_probability",playbooks/attack/enterprise/T1584.001.yml
T1584.001: Domains,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,7,"Is there DNS activity for subdomains of our company-owned domains that are not part of our official, inventoried list?","Domain shadowing occurs when an adversary compromises a domain's DNS records to create malicious subdomains under a legitimate, trusted domain. This question aims to detect this by comparing all observed subdomain queries against a master inventory of known, valid subdomains. A query for an unknown subdomain is a strong indicator of a potential compromise of the domain's DNS management.
",Zeek dns.log; Windows Event ID 22; Public-facing DNS records; Internal DNS resolvers; Endpoint devices,last 90 days,"pseudocode: SEARCH dns_queries for company_domains | FOREACH query | IF subdomain NOT IN known_subdomain_inventory, ALERT",playbooks/attack/enterprise/T1584.001.yml
T1584.001: Domains,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,8,"Do any non-inventoried subdomains exhibit a high degree of randomness, suggesting they are algorithmically generated for C2 communications?","Adversaries using domain shadowing often use Domain Generation Algorithms (DGAs) to create a large number of random-looking subdomains for C2. This question focuses on identifying these by measuring the character randomness (Shannon entropy) of any newly discovered subdomain. A score significantly higher than the baseline for legitimate subdomains is a strong signal of DGA activity.
",Zeek dns.log; Windows Event ID 22; Public-facing DNS records; Internal DNS resolvers; Endpoint devices,last 90 days,"pseudocode: FOREACH unknown_subdomain | CALCULATE shannon_entropy | IF entropy > 98th_percentile_of_legit_subdomains, ALERT",playbooks/attack/enterprise/T1584.001.yml
T1584.001: Domains,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,9,"Has there been an anomalous spike in the rate of discovery of new, previously unseen subdomains for our domains?","This question uses time-series analysis to establish a normal baseline for how often new, legitimate subdomains are created. A sudden, sharp increase in the number of new subdomains appearing within a short time frame would deviate significantly from this baseline. Such a spike could indicate that an adversary has activated a large number of shadowed subdomains for a campaign, providing an early warning of active malicious use.
",Zeek dns.log; Windows Event ID 22; Public-facing DNS records; Internal DNS resolvers; Endpoint devices,last 90 days,"pseudocode: MODEL new_subdomain_rate_per_hour | FORECAST prediction_interval | IF current_rate > 99%_prediction_interval, ALERT",playbooks/attack/enterprise/T1584.001.yml
T1584.001: Domains,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,10,Are any of our company-owned domains resolving to IP addresses outside of our organization's approved IP space?,"This is a direct check for DNS hijacking. By maintaining an allow-list of all legitimate IP addresses and CIDR blocks for company domains, any DNS response that points to an unauthorized IP is a critical indicator that the domain's DNS record has been maliciously altered. This could be redirecting users to a malicious site or intercepting traffic like email.
","Zeek dns.log; External DNS Monitoring Service Logs; Internal DNS resolvers; External DNS monitoring services (e.g., distributed probes)",last 90 days,"pseudocode: SEARCH dns_responses for company_domains | IF resolved_ip NOT IN approved_ip_allowlist, TRIGGER_CRITICAL_ALERT",playbooks/attack/enterprise/T1584.001.yml
T1584.001: Domains,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,11,Are our critical domains suddenly resolving from new or unexpected network locations (ASNs) or countries?,"Beyond just the IP address, the network context (like the Autonomous System Number and geographic location) provides a stable baseline. A legitimate domain will typically resolve from a predictable set of hosting providers and countries. A sudden shift to a completely new ASN or country, especially one with a poor reputation, is a strong signal of a hijack, even if the IP itself is unknown.
","Zeek dns.log; External DNS Monitoring Service Logs; Internal DNS resolvers; External DNS monitoring services (e.g., distributed probes)",last 90 days,"pseudocode: BASELINE historical_asn_and_country for critical_domains | MONITOR current_resolutions | IF new_asn OR new_country NOT IN baseline, ALERT",playbooks/attack/enterprise/T1584.001.yml
T1584.001: Domains,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,12,Can an anomaly detection model identify DNS resolutions for our critical domains that are statistically different from historical norms?,"This question proposes using an unsupervised machine learning model (like Isolation Forest) to learn the normal patterns of DNS resolutions for critical domains, considering features like the IP, ASN, country, and TTL value. The model can then flag any new resolution that is a statistical outlier from this learned norm. This can detect subtle or novel hijacking techniques that might not be caught by static rules.
","Zeek dns.log; External DNS Monitoring Service Logs; Internal DNS resolvers; External DNS monitoring services (e.g., distributed probes)",last 90 days,"pseudocode: TRAIN isolation_forest_model on historical_dns_data (ip, asn, country, ttl) | SCORE live_dns_resolutions | IF anomaly_score > threshold, ALERT",playbooks/attack/enterprise/T1584.001.yml
T1584.001: Domains,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,13,"Are internal hosts connecting to a domain that is new to our environment, has a very recent SSL certificate, and uses a low DNS TTL value?","Adversaries often set up infrastructure just before an attack. This combination of attributes is highly suspicious: a new domain (first time seen), a fresh SSL certificate (often free and automated), and a low TTL (allowing for quick changes to evade blocking). Correlating these individual, weaker signals into a single, high-confidence alert is an effective way to detect newly staged malicious infrastructure.
",Zeek dns.log; Zeek ssl.log; Zeek conn.log; Zeek x509.log; Outbound web proxies and firewalls; Certificate Transparency logs; Enterprise DNS resolvers,last 90 days,pseudocode: SEARCH for connections WHERE (is_new_domain AND cert_age < 72h AND dns_ttl < 300s),playbooks/attack/enterprise/T1584.001.yml
T1584.001: Domains,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,14,Can we create a composite risk score for new connections by combining multiple suspicious attributes to identify the highest-risk activity?,"Rather than a binary alert, this question proposes a flexible risk-scoring system. By assigning points to various suspicious indicators (e.g., domain age, certificate issuer, TTL value, domain name randomness), we can calculate a total risk score for every new connection. This allows for more nuanced detection and prioritization, as analysts can focus on connections that accumulate the highest scores, representing the most suspicious activity.
",Zeek dns.log; Zeek ssl.log; Zeek conn.log; Zeek x509.log; Outbound web proxies and firewalls; Certificate Transparency logs; Enterprise DNS resolvers,last 90 days,"pseudocode: FOREACH new_connection | CALCULATE risk_score (weighted_sum_of_attributes) | IF score > 99th_percentile_of_historical_scores, ALERT",playbooks/attack/enterprise/T1584.001.yml
T1584.001: Domains,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,15,Can we use unsupervised clustering to automatically group newly observed domains and identify clusters that exhibit malicious characteristics?,"This question leverages unsupervised machine learning (DBSCAN) to discover patterns without pre-existing labels. By grouping new domains based on their features (TTL, cert age, entropy, etc.), the system can identify natural clusters. An analyst can then investigate and label these clusters (e.g., 'benign SaaS services', 'suspicious DGA-like domains'). Once labeled, any new domain falling into a 'suspicious' cluster can be automatically flagged, effectively automating the discovery of new threat patterns.
",Zeek dns.log; Zeek ssl.log; Zeek conn.log; Zeek x509.log; Outbound web proxies and firewalls; Certificate Transparency logs; Enterprise DNS resolvers,last 90 days,"pseudocode: FEATURIZE new_domains (ttl, cert_age, entropy) | APPLY DBSCAN clustering | IF domain in suspicious_cluster, ALERT",playbooks/attack/enterprise/T1584.001.yml
T1584.002: DNS Server,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,1,"Are internal clients receiving DNS responses containing known malicious IP addresses, or are administrative connections being made to DNS servers from these IPs?","This question aims to detect direct communication with adversary infrastructure. If a DNS query resolves to a known malicious IP, it suggests a client is attempting to connect to a C2 server or a malicious site. Similarly, an administrative connection from a malicious IP to a DNS server could indicate the server itself is compromised or under attack.",Zeek dns.log; Zeek conn.log; Windows Event ID 4624; Windows Event ID 4625; Internal recursive DNS servers; External-facing authoritative DNS servers; Network egress points; DNS server management consoles,last 90 days,": SEARCH dns_logs WHERE answer_ip IN threat_feed_ips; SEARCH connection_logs WHERE dest_port IN [22, 3389, 5985, 5986] AND source_ip IN threat_feed_ips",playbooks/attack/enterprise/T1584.002.yml
T1584.002: DNS Server,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,2,Are domains resolving to IP addresses in new or statistically rare Autonomous Systems (ASNs) for that specific domain?,"Adversaries often use newly provisioned or compromised infrastructure that resides in different network blocks (ASNs) than a legitimate service. By baselining the normal ASNs for a given domain, we can detect DNS hijacking or domain shadowing when a domain suddenly resolves to an IP in a rare or unprecedented ASN, indicating a potential redirection to malicious infrastructure.",Zeek dns.log; Zeek conn.log; Windows Event ID 4624; Windows Event ID 4625; Internal recursive DNS servers; External-facing authoritative DNS servers; Network egress points; DNS server management consoles,last 90 days,: BASELINE domain_ip_asn_combinations; SCORE rarity of new resolutions; AGGREGATE risk by client_ip; ALERT on high scores,playbooks/attack/enterprise/T1584.002.yml
T1584.002: DNS Server,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,3,Is there a statistically significant spike in the volume of DNS resolutions to IPs flagged as 'suspicious' by reputation providers?,"A sudden, anomalous increase in queries to suspicious IPs across the organization can indicate a widespread campaign, such as a phishing attack or malware outbreak, where multiple hosts are attempting to contact the same malicious infrastructure. Time-series analysis helps distinguish a coordinated attack from random, baseline noise.",Zeek dns.log; Zeek conn.log; Windows Event ID 4624; Windows Event ID 4625; Internal recursive DNS servers; External-facing authoritative DNS servers; Network egress points; DNS server management consoles,last 90 days,: MODEL dns_volume_to_suspicious_ips using time_series; ALERT on significant deviation from forecast,playbooks/attack/enterprise/T1584.002.yml
T1584.002: DNS Server,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,4,Are DNS zone transfers (AXFR/IXFR) being requested by unauthorized source IPs?,"Zone transfers are used to replicate DNS databases between servers. An adversary can use a zone transfer request to map an organization's entire network infrastructure. This question checks if these powerful requests are coming from IPs that are not on a pre-approved list of secondary DNS servers or administrative hosts, which is a strong indicator of reconnaissance.",Zeek dns.log; Zeek conn.log; Internal recursive DNS servers; External-facing authoritative DNS servers,last 90 days,": SEARCH dns_logs WHERE query_type IN ['AXFR', 'IXFR'] AND source_ip NOT IN authorized_ip_list; ALERT on match",playbooks/attack/enterprise/T1584.002.yml
T1584.002: DNS Server,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,5,"Are there anomalous patterns in zone transfer activity, such as requests from new sources or unusual frequency from authorized sources?","Beyond simple allowlists, this question seeks to behaviorally baseline zone transfer activity. A request from a historically unknown IP is a high-confidence alert. Additionally, a sudden spike in requests from an authorized server could indicate that the server itself has been compromised and is being used to exfiltrate DNS data.",Zeek dns.log; Zeek conn.log; Internal recursive DNS servers; External-facing authoritative DNS servers,last 90 days,: BASELINE axfr_source_ips_and_frequency; ALERT on new_source_ip OR frequency > 99.5th_percentile,playbooks/attack/enterprise/T1584.002.yml
T1584.002: DNS Server,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,6,Can we predictively classify DNS zone transfer attempts as 'unauthorized' in real-time?,"This leverages machine learning to build a more sophisticated detection mechanism than static rules. By training a model on features like source IP/ASN, time of day, and target server, the system can learn the subtle characteristics of legitimate versus illegitimate requests, potentially catching novel or evasive reconnaissance attempts.",Zeek dns.log; Zeek conn.log; Internal recursive DNS servers; External-facing authoritative DNS servers,last 90 days,": MODEL zone_transfer_requests with features (source_ip, asn, time); CLASSIFY new requests; ALERT on 'unauthorized'",playbooks/attack/enterprise/T1584.002.yml
T1584.002: DNS Server,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,7,Is the primary DNS server process ('dns.exe') spawning suspicious child processes like command shells or script interpreters?,"The Windows DNS server process ('dns.exe') should not normally spawn child processes, especially not command shells (cmd.exe) or PowerShell. Such an event is a very strong indicator that the DNS server has been compromised and an adversary is executing commands, likely through a vulnerability or a previously established backdoor.",Windows Event ID 4688; Sysmon Event ID 1; DNS Server infrastructure (both authoritative and recursive); Domain Controller servers (if running DNS role),last 90 days,": SEARCH process_creation_logs WHERE parent_process = 'dns.exe' AND child_process IN ['cmd.exe', 'powershell.exe', ...]; ALERT on match",playbooks/attack/enterprise/T1584.002.yml
T1584.002: DNS Server,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,8,"Has a new, never-before-seen parent-child process relationship involving 'dns.exe' appeared on a DNS server?","This question uses historical data to define normalcy. By creating a baseline of all legitimate parent-child process relationships on a DNS server, any new relationship involving 'dns.exe' as the parent is, by definition, anomalous. This can detect novel attack tools or techniques that don't use common shell names.",Windows Event ID 4688; Sysmon Event ID 1; DNS Server infrastructure (both authoritative and recursive); Domain Controller servers (if running DNS role),last 90 days,: BASELINE parent_child_process_pairs; ALERT on new pair where parent_process = 'dns.exe',playbooks/attack/enterprise/T1584.002.yml
T1584.002: DNS Server,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,9,Can an unsupervised machine learning model identify anomalous process creation events on DNS servers?,"This approach automates the detection of outliers in process activity. An Isolation Forest or similar model can learn the multi-dimensional profile of normal process events (parent, child, command line, user) and automatically flag any new event that deviates significantly from this learned baseline, indicating potential compromise.",Windows Event ID 4688; Sysmon Event ID 1; DNS Server infrastructure (both authoritative and recursive); Domain Controller servers (if running DNS role),last 90 days,": MODEL process_events with features (parent, child, cmdline); SCORE new events; ALERT on outlier_score",playbooks/attack/enterprise/T1584.002.yml
T1584.002: DNS Server,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,10,Has a successful administrative login to a DNS server occurred from a geographically forbidden location?,This is a straightforward but effective security control. Many organizations have policies prohibiting administrative access from certain countries. This question verifies that control by checking if any successful admin logins to critical DNS servers originate from IPs that geolocate to a country on this deny-list.,Windows Event ID 4624; Zeek conn.log; DNS Server infrastructure; Domain Controllers; VPN concentrators; Network egress points,last 90 days,: SEARCH admin_logins (LogonType 3 or 10); GEO-IP lookup source_ip; ALERT if country IN deny_list,playbooks/attack/enterprise/T1584.002.yml
T1584.002: DNS Server,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,11,Has an administrator logged into a DNS server from a country or network (ASN) that is rare or new for that specific user?,"This moves beyond a static deny-list to user-specific behavioral analytics. An administrator might legitimately log in from two or three different countries or networks. However, a login from a fourth, never-before-seen country or a very rare ASN for that user is suspicious and could indicate a compromised account. This is a classic 'impossible travel' or 'anomalous location' scenario.",Windows Event ID 4624; Zeek conn.log; DNS Server infrastructure; Domain Controllers; VPN concentrators; Network egress points,last 90 days,": BASELINE login_attributes (ip, asn, country) per_user; ALERT if new_login_country not in user_baseline OR new_login_asn is rare for user",playbooks/attack/enterprise/T1584.002.yml
T1584.002: DNS Server,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,12,Does a recent administrative login to a DNS server fall outside the user's normal cluster of behavior?,"This is an advanced UEBA technique. A clustering model groups a user's past logins based on multiple features (time, source IP, etc.) to define 'normal' behavior. A new login that doesn't fit into any existing cluster is flagged as an outlier. This can detect more subtle anomalies than single-factor checks, such as a login from a known location but at a highly unusual time.",Windows Event ID 4624; Zeek conn.log; DNS Server infrastructure; Domain Controllers; VPN concentrators; Network egress points,last 90 days,": MODEL user_logins with features (time, source_ip, etc.) using clustering; SCORE new logins; ALERT if login is not in a normal cluster",playbooks/attack/enterprise/T1584.002.yml
T1584.002: DNS Server,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,13,"Are critical external domains (e.g., SSO provider, Office 365) resolving to IPs or ASNs that are not on the approved allowlist?","DNS hijacking of critical services is a high-impact threat. This question aims to detect it by verifying that DNS responses for vital external domains *only* contain IPs from a pre-vetted list of known-good addresses and networks. Any deviation is a critical alert, suggesting a Man-in-the-Middle (MitM) attack or DNS cache poisoning.",Zeek dns.log; Network egress points; Internal recursive DNS servers; Endpoint devices,last 90 days,: SEARCH dns_logs WHERE domain IN critical_domains AND resolved_ip NOT IN allowlist; ALERT on match,playbooks/attack/enterprise/T1584.002.yml
T1584.002: DNS Server,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,14,Has the diversity (entropy) of resolved IP addresses for a critical domain suddenly and significantly dropped?,"Large, legitimate services (like CDNs) use many IP addresses, resulting in high entropy in DNS responses across an organization. If an attacker hijacks the domain to point to a single malicious IP, the entropy of resolved IPs will plummet. This question seeks to detect that sudden drop, which is a strong statistical indicator of a hijack.",Zeek dns.log; Network egress points; Internal recursive DNS servers; Endpoint devices,last 90 days,: CALCULATE rolling_entropy of resolved_ips per critical_domain; ALERT on significant drop vs. baseline,playbooks/attack/enterprise/T1584.002.yml
T1584.002: DNS Server,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,15,Is the number of unique IPs resolved for a critical domain significantly different from the forecasted number?,"This is another statistical method to detect hijacking. A time-series model learns the normal daily or hourly pattern of unique IP resolutions for a domain. A hijack could cause this number to collapse to one (or a few) or, in a domain shadowing scenario, explode to many new IPs. An actual count falling far outside the model's prediction signals an anomaly.",Zeek dns.log; Network egress points; Internal recursive DNS servers; Endpoint devices,last 90 days,: MODEL unique_ip_count_per_domain using time_series; ALERT if actual_count is outside prediction_interval,playbooks/attack/enterprise/T1584.002.yml
T1584.002: DNS Server,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,16,Are internal clients querying newly registered or DGA-flagged domains that resolve to known malicious IPs?,"This question combines multiple risk factors for a high-confidence alert. Malware often uses Domain Generation Algorithms (DGAs) to create rendezvous points, and adversaries frequently use newly registered domains (NRDs) for campaigns. Combining this with a query that resolves to a known bad IP address creates a strong signal of a malware-infected host.",Zeek dns.log; Network egress points; Endpoint devices; Internal recursive DNS servers,last 90 days,: SEARCH dns_logs WHERE (domain_age < 30d OR is_dga) AND ip_reputation = 'malicious'; ALERT on match,playbooks/attack/enterprise/T1584.002.yml
T1584.002: DNS Server,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,17,Are high-entropy (likely DGA) domains being queried that also resolve to an IP in a completely new or rare ASN?,"This question aims to find DGA activity without relying on pre-existing DGA feeds. DGA domains have high character randomness (high entropy). Combining a high-entropy domain name with a resolution to an IP in an ASN the organization has never seen traffic from before creates a strong, self-contained signal of potential C2 communication.",Zeek dns.log; Network egress points; Endpoint devices; Internal recursive DNS servers,last 90 days,: CALCULATE entropy of domain_names; FLAG high_entropy_domains; ALERT if flagged_domain resolves to IP in new_ASN,playbooks/attack/enterprise/T1584.002.yml
T1584.002: DNS Server,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,18,"Can a deep learning model classify a queried domain as DGA, and does that domain resolve to an IP associated with other DGA domains?","This is an advanced, machine learning-based approach to DGA detection. An LSTM model can learn the sequential patterns of characters in domain names to identify DGAs more accurately than simple entropy. The detection is further strengthened by correlating the finding with the reputation of the resolved IP, specifically if that IP is a 'hotspot' for other domains also classified as DGAs.",Zeek dns.log; Network egress points; Endpoint devices; Internal recursive DNS servers,last 90 days,: MODEL domain_names with LSTM; CLASSIFY as DGA; CLUSTER DGA-resolved IPs; ALERT if new DGA resolves to known DGA_IP_cluster,playbooks/attack/enterprise/T1584.002.yml
T1585: Establish Accounts,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0042: Resource Development,n; o; n; e,1,Has an inbound email been received from an IP address or domain that is on a threat intelligence watchlist?,"This question aims to identify direct communication from known malicious infrastructure. Adversaries often reuse command and control (C2) servers, phishing domains, or other infrastructure across campaigns. Matching an inbound email's source IP or domain against a high-confidence threat intelligence feed provides a strong, initial indicator of malicious activity, allowing for rapid response and containment.
",Zeek conn.log; Zeek smtp.log; Cloud-based Email Security Service; On-premise Mail Transfer Agent (MTA); Network Egress/Ingress Points (Firewalls/Proxies),last 90 days,": SEARCH Zeek conn.log FOR id.orig_h IN threat_intel_watchlist
SEARCH Zeek smtp.log FOR sender_domain IN threat_intel_watchlist
IF match THEN ALERT high_severity
",playbooks/attack/enterprise/T1585.yml
T1585: Establish Accounts,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0042: Resource Development,n; o; n; e,2,Can we risk-score inbound emails based on the threat intelligence associated with their source?,"Not all threat intelligence indicators carry the same weight. This question moves beyond simple matching to a more nuanced risk assessment. By scoring indicators based on the intelligence provider's reliability and the indicator's age, analysts can prioritize alerts more effectively. A dynamic threshold based on recent activity helps adapt to changing threat landscapes and reduces alert fatigue from stale or low-confidence IOCs.
",Zeek conn.log; Zeek smtp.log; Cloud-based Email Security Service; On-premise Mail Transfer Agent (MTA); Network Egress/Ingress Points (Firewalls/Proxies),last 90 days,": FOR each IOC_match FROM threat_intel_feed:
  CALCULATE risk_score = (weight_of_feed * (1 / age_of_IOC))
  CALCULATE threshold = 95th_percentile_of_scores_last_7_days
  IF risk_score > threshold THEN ALERT
",playbooks/attack/enterprise/T1585.yml
T1585: Establish Accounts,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0042: Resource Development,n; o; n; e,3,Can a machine learning model predict if an inbound email connection is malicious based on network and CTI features?,"This question seeks to proactively identify malicious activity that may not yet be present in threat intelligence feeds. By training a classification model on features like IP geolocation, ASN, protocol, port, and domain reputation, the system can learn the characteristics of malicious connections. This allows for the detection of novel threats and provides a probabilistic score for each connection, enabling analysts to focus on the most likely malicious inbound traffic.
",Zeek conn.log; Zeek smtp.log; Cloud-based Email Security Service; On-premise Mail Transfer Agent (MTA); Network Egress/Ingress Points (Firewalls/Proxies),last 90 days,": FOR each new inbound_connection:
  EXTRACT features (geolocation, ASN, protocol, sender_rep, etc.)
  PREDICT probability_malicious = ML_model(features)
  IF probability_malicious > 0.90 THEN ALERT
",playbooks/attack/enterprise/T1585.yml
T1585: Establish Accounts,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0042: Resource Development,n; o; n; e,4,Has an inbound email been received from a typosquatted domain or a domain registered within the last 30 days?,"Adversaries frequently register domains that are visually similar to legitimate ones (typosquatting) or use newly created domains for phishing campaigns to evade reputation-based blocking. This question aims to detect these two common techniques. By checking against a list of known typosquat variations and querying the WHOIS registration date of sender domains, we can identify suspicious emails that might otherwise appear legitimate.
",Zeek smtp.log; Zeek dns.log; External WHOIS Data; Email Gateway; Internal/External DNS Resolvers; Domain Registrar Data Feeds,last 90 days,": FOR each new email in smtp.log:
  IF sender_domain IN typosquat_list THEN ALERT
  PERFORM WHOIS_lookup(sender_domain)
  IF domain_creation_date < 30_days_ago THEN ALERT
",playbooks/attack/enterprise/T1585.yml
T1585: Establish Accounts,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0042: Resource Development,n; o; n; e,5,Are we receiving emails from domains that are anomalously new compared to typical inbound mail?,"Instead of using a fixed 30-day window, this question uses a statistical approach to identify suspicious domains. By establishing a baseline of domain ages for all inbound mail, we can dynamically identify outliers. An email from a domain whose age falls in the bottom 5th percentile is statistically unusual for the organization and warrants investigation, as it suggests the sender is not a typical, established correspondent.
",Zeek smtp.log; Zeek dns.log; External WHOIS Data; Email Gateway; Internal/External DNS Resolvers; Domain Registrar Data Feeds,last 90 days,": CALCULATE domain_age_percentile_5th = percentile(domain_ages_last_90_days, 5)
FOR each new inbound email:
  FETCH domain_age
  IF domain_age < domain_age_percentile_5th THEN ALERT medium_severity
",playbooks/attack/enterprise/T1585.yml
T1585: Establish Accounts,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0042: Resource Development,n; o; n; e,6,Is there an anomalous spike in the number of newly registered domains sending us email?,"This question seeks to detect a sudden influx of emails from new domains, which could indicate the start of a large-scale phishing or spam campaign. By using a time series forecasting model, we can predict the expected number of new domains. An actual count that significantly exceeds the forecast's upper confidence bound is a strong indicator of an organized, anomalous event that requires immediate attention.
",Zeek smtp.log; Zeek dns.log; External WHOIS Data; Email Gateway; Internal/External DNS Resolvers; Domain Registrar Data Feeds,last 90 days,": MODEL daily_new_domain_count with time_series_forecast
GET daily_count_of_new_domains_age_less_than_30_days
IF daily_count > forecast_upper_confidence_interval THEN ALERT
",playbooks/attack/enterprise/T1585.yml
T1585: Establish Accounts,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0042: Resource Development,n; o; n; e,7,Has a single external source sent a low number of emails to a high number of internal recipients without receiving any replies?,"This question targets a common reconnaissance or phishing technique known as 'low and slow' or password spraying pre-checks. An adversary may send a small number of emails to many different employees to validate email addresses or conduct a broad but shallow phishing attempt. The lack of replies is key, as it distinguishes this activity from legitimate mass mailings (like newsletters) where some interaction is expected. This behavior is highly suspicious and warrants investigation.
",Zeek smtp.log; Zeek conn.log; Mail Exchange (MX) Servers; Email Gateway; Network Egress Points,last 24 hours,": AGGREGATE smtp.log over 24h window by source_ip/domain
  unique_recipients = COUNT_UNIQUE(recipient)
  total_emails = COUNT(email)
IF unique_recipients > 10 AND total_emails < 20:
  CHECK conn.log for reply_traffic_from_recipients_to_source
  IF no_reply_traffic THEN ALERT
",playbooks/attack/enterprise/T1585.yml
T1585: Establish Accounts,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0042: Resource Development,n; o; n; e,8,Can we detect anomalous sending patterns by analyzing the distribution of recipients for a given sender?,"This question provides a statistical method to identify suspicious sending behavior. Legitimate senders often have predictable recipient patterns, while an adversary conducting reconnaissance may have a highly random (high entropy) recipient list. By flagging senders with both high recipient entropy (top 5%) and low email volume (bottom 10%), we can pinpoint actors who are likely probing the organization rather than engaging in legitimate communication.
",Zeek smtp.log; Zeek conn.log; Mail Exchange (MX) Servers; Email Gateway; Network Egress Points,last 24 hours,": FOR each sender in 24h window:
  CALCULATE shannon_entropy(recipient_list)
  CALCULATE total_email_volume
IF entropy IN top_5_percentile AND volume IN bottom_10_percentile THEN ALERT
",playbooks/attack/enterprise/T1585.yml
T1585: Establish Accounts,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0042: Resource Development,n; o; n; e,9,Can we use graph analysis and clustering to identify anomalous senders who do not fit normal communication patterns?,"This question applies unsupervised machine learning to discover outlier senders. By representing sender-recipient relationships as a graph and then clustering senders based on features like recipient count and email volume, we can group legitimate senders into clusters. Senders that do not belong to any cluster (identified as 'noise' by algorithms like DBSCAN) are, by definition, anomalous and may represent suspicious probing or phishing activity that deviates from established communication norms.
",Zeek smtp.log; Zeek conn.log; Mail Exchange (MX) Servers; Email Gateway; Network Egress Points,last 90 days,": CREATE bipartite_graph of sender-recipient interactions
FOR each sender, CREATE feature_vector (recipient_count, email_count, etc.)
APPLY DBSCAN clustering to sender feature_vectors
FOR each sender identified as noise_point THEN FLAG_FOR_INVESTIGATION
",playbooks/attack/enterprise/T1585.yml
T1585: Establish Accounts,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0042: Resource Development,n; o; n; e,10,Has the number of unique source IPs from a single free webmail or dynamic DNS domain exceeded a set threshold in a short time frame?,"This question aims to detect abuse of legitimate services. An adversary might use a botnet or many compromised accounts from a single provider (e.g., Gmail) to launch an attack. A sudden spike in the number of unique IP addresses originating from a single, high-risk domain category within an hour suggests a distributed, coordinated effort and is a strong indicator of malicious activity, bypassing single-IP reputation blocks.
",Zeek conn.log; Zeek smtp.log; Zeek dns.log; Email Gateway; DNS Resolvers; Network Egress/Ingress Points (Firewalls/Proxies),last 1 hour,": MAINTAIN categorized_domain_list (webmail, dyndns, etc.)
IN 1-hour window, for each domain on list:
  COUNT unique source_ips
  IF unique_source_ip_count > 100 THEN ALERT
",playbooks/attack/enterprise/T1585.yml
T1585: Establish Accounts,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0042: Resource Development,n; o; n; e,11,Has the daily email volume or data transfer from a high-risk domain category (like free webmail) significantly deviated from its historical average?,"This question uses statistical process control (the '3-sigma rule') to detect anomalies in communication volume. While some level of traffic from free webmail providers is normal, a sudden, large increase in email count or data volume can signal a campaign. By comparing daily volume to a 30-day moving average, this method accounts for normal fluctuations and seasonality, alerting only on statistically significant deviations that could represent an attack.
",Zeek conn.log; Zeek smtp.log; Zeek dns.log; Email Gateway; DNS Resolvers; Network Egress/Ingress Points (Firewalls/Proxies),last 90 days,": FOR each domain_category (webmail, etc.):
  CALCULATE 30-day_moving_average and standard_deviation for email_count and data_volume
  GET current_daily_volume
  IF current_daily_volume > (moving_average + 3 * std_dev) THEN ALERT
",playbooks/attack/enterprise/T1585.yml
T1585: Establish Accounts,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0042: Resource Development,n; o; n; e,12,Can an unsupervised machine learning model detect anomalous communication patterns from high-risk domain categories?,"This question advances from simple statistical thresholds to a more sophisticated, unsupervised machine learning approach. A model like Isolation Forest can learn complex, multi-dimensional patterns in time-series data, including seasonality and normal business cycles. It can then identify hourly connection counts that are statistical outliers, representing a significant deviation from the learned norm. This is more robust than static thresholds and can detect more subtle anomalies.
",Zeek conn.log; Zeek smtp.log; Zeek dns.log; Email Gateway; DNS Resolvers; Network Egress/Ingress Points (Firewalls/Proxies),last 90 days,": FOR each high-risk_domain_category:
  TRAIN anomaly_detection_model on hourly_connection_counts
  FOR each new hour's connection_count:
    IF model.predict(count) == 'anomaly' THEN ALERT
",playbooks/attack/enterprise/T1585.yml
T1585: Establish Accounts,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0042: Resource Development,n; o; n; e,13,"Has a corporate email address been used to create an account on a non-sanctioned external service, or has a new profile impersonating a key employee been detected?","This question addresses two critical risks: data exfiltration/credential exposure and executive impersonation. A CASB policy can detect when corporate emails are used for sign-ups on unsanctioned services, indicating potential shadow IT or credential stuffing. Simultaneously, using an OSINT service to monitor for new profiles impersonating key personnel (like the CEO or CFO) can provide early warning of targeted phishing or social engineering campaigns.
","CASB Logs; Web Proxy Logs; OSINT Monitoring Service Data; Windows Event ID 4663; Cloud Access Security Broker (CASB); Secure Web Gateway; Public Internet (Social Media, Code Repositories); File Servers hosting HR data",last 90 days,": CASB_ALERT on account_creation IF platform NOT IN sanctioned_list AND email_domain IS corporate
OSINT_ALERT IF new_profile_name IN key_employee_watchlist
",playbooks/attack/enterprise/T1585.yml
T1585: Establish Accounts,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0042: Resource Development,n; o; n; e,14,"Have internal users visited a newly created, low-engagement social media profile that claims to be an employee?","This question aims to detect the 'lure' phase of a social engineering attack. After an adversary creates a fake persona (identified via OSINT), they may try to entice internal employees to connect with or visit that profile. By baselining normal web traffic and alerting when a user visits a newly created, low-follower profile, security teams can identify potential targets of social engineering and investigate the suspicious profile before a larger attack occurs.
","CASB Logs; Web Proxy Logs; OSINT Monitoring Service Data; Windows Event ID 4663; Cloud Access Security Broker (CASB); Secure Web Gateway; Public Internet (Social Media, Code Repositories); File Servers hosting HR data",last 90 days,": GET new_suspicious_profile from OSINT_feed
SEARCH web_proxy_logs for visits to new_suspicious_profile.url
IF visit_found THEN ALERT
",playbooks/attack/enterprise/T1585.yml
T1585: Establish Accounts,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0042: Resource Development,n; o; n; e,15,Can we use machine learning and NLP to automatically identify and classify suspicious social media profiles impersonating our employees?,"This question seeks to automate the detection of impersonation at scale. An NLP model can parse unstructured text from social media bios to find mentions of the organization's name. A subsequent classification model can then analyze features of the profile (account age, follower count, post frequency, etc.) to distinguish between legitimate new employees and suspicious, fake personas. This automates a manual, time-consuming investigation and allows for faster detection of impersonation campaigns.
","CASB Logs; Web Proxy Logs; OSINT Monitoring Service Data; Windows Event ID 4663; Cloud Access Security Broker (CASB); Secure Web Gateway; Public Internet (Social Media, Code Repositories); File Servers hosting HR data",last 90 days,": FOR each new profile from OSINT_feed:
  EXTRACT entities (person_name, company_name) using NLP
  IF company_name == our_organization:
    PREDICT is_suspicious = classification_model(profile_features)
    IF is_suspicious == TRUE THEN ALERT",playbooks/attack/enterprise/T1585.yml
T1586: Compromise Accounts,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0042: Resource Development,n; o; n; e,1,Are there any login attempts using usernames from known credential breaches or originating from IPs on credential abuse threat feeds?,"This question aims to proactively detect the use of compromised credentials. Adversaries often acquire lists of usernames and passwords from previous data breaches and use them to attempt to access systems. By correlating login events in real-time with threat intelligence feeds and lists of known breached accounts, we can identify these initial access attempts before a successful compromise occurs or quickly respond if one does.","Windows Event ID 4624; Windows Event ID 4625; Zeek conn.log; Threat Intelligence Feeds; Public-facing authentication services (e.g., VPN, OWA, M365); internal authentication servers (e.g., Domain Controllers); network egress points; threat intelligence platforms",last 90 days,: JOIN login_events ON username WITH breached_credential_list. OR JOIN login_events ON source_ip WITH credential_abuse_threat_feed. ALERT if match found.,playbooks/attack/enterprise/T1586.yml
T1586: Compromise Accounts,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0042: Resource Development,n; o; n; e,2,Is there an anomalous rate of login attempts originating from IPs known to be associated with malicious activity?,"Even if an IP is on a watchlist (e.g., a TOR exit node), not all traffic from it is malicious. This question focuses on identifying a change in behavior. By baselining the 'normal' login attempt rate from these suspicious IP categories, we can detect when an attacker starts actively using one for a targeted attack against our infrastructure, indicated by a statistically significant spike in activity.","Windows Event ID 4624; Windows Event ID 4625; Zeek conn.log; Threat Intelligence Feeds; Public-facing authentication services (e.g., VPN, OWA, M365); internal authentication servers (e.g., Domain Controllers); network egress points; threat intelligence platforms",last 90 days,: FOR each IP on threat_feed: CALCULATE hourly_login_rate (success + fail). BASELINE normal_rate over 30 days. ALERT if current_rate > 95th_percentile_of_baseline.,playbooks/attack/enterprise/T1586.yml
T1586: Compromise Accounts,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0042: Resource Development,n; o; n; e,3,Can we use machine learning to assign a risk score to login events based on multiple weak indicators of compromise?,"This question moves beyond simple rules to a more holistic, risk-based approach. A single indicator, like a login from a new location, might be benign. However, when combined with other features—such as the username being in a breach list, the IP being on a threat feed, and an unusual user agent—the probability of malicious activity increases significantly. A machine learning model can learn these complex patterns and flag high-risk logins that would be missed by individual rules.","Windows Event ID 4624; Windows Event ID 4625; Zeek conn.log; Threat Intelligence Feeds; Public-facing authentication services (e.g., VPN, OWA, M365); internal authentication servers (e.g., Domain Controllers); network egress points; threat intelligence platforms",last 90 days,": FOR each login_event: FEATURE_ENGINEER (is_breached, is_threat_ip, etc.). INPUT features to classification_model. ALERT if risk_score > threshold.",playbooks/attack/enterprise/T1586.yml
T1586: Compromise Accounts,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0042: Resource Development,n; o; n; e,4,"Is any single external IP address attempting to log in to many different user accounts in a short period, potentially using a known attack tool?","This question targets the classic password spraying or credential stuffing pattern: one source IP, many target accounts, and a high failure rate. This is distinct from a brute-force attack which targets one account. By setting thresholds (e.g., >20 failures, >10 accounts, 5 minutes) and correlating with web log data for known malicious user agents, we can create a high-fidelity alert for this specific attack technique.",Windows Event ID 4625; Zeek http.log; Zeek conn.log; Public web application servers; API gateways; VPN concentrators; network perimeter firewalls; cloud identity provider log streams,last 90 days,: GROUP failed_logins by source_ip in 5_min_window. ALERT if count(failed_logins) > 20 AND count(distinct_users) > 10. INCREASE_SCORE if user_agent in attack_tool_list.,playbooks/attack/enterprise/T1586.yml
T1586: Compromise Accounts,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0042: Resource Development,n; o; n; e,5,"Are we observing any source IPs exhibiting a high 'spray ratio', where failed login attempts are spread across many unique accounts?","This question provides a more statistical method to detect password spraying. A legitimate user who forgot their password will generate many failed logins for a single account (low spray ratio). An attacker trying one password against many accounts will have a spray ratio close to 1.0 (one failure per unique account). By calculating this ratio and comparing it to a baseline, we can identify spraying behavior even if it stays below simple volume-based thresholds.",Windows Event ID 4625; Zeek http.log; Zeek conn.log; Public web application servers; API gateways; VPN concentrators; network perimeter firewalls; cloud identity provider log streams,last 90 days,: FOR each source_ip in 5_min_window: CALCULATE ratio = count(distinct_failed_users) / count(total_failed_logins). ALERT if ratio > 99th_percentile_of_all_IPs AND count(distinct_failed_users) > 5.,playbooks/attack/enterprise/T1586.yml
T1586: Compromise Accounts,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0042: Resource Development,n; o; n; e,6,Can we use unsupervised machine learning to automatically discover clusters of activity that look like a coordinated password spraying attack?,"This question explores an advanced detection method that doesn't rely on pre-defined rules or thresholds. Density-based clustering can automatically group related login failures in a multi-dimensional space (source IP, username, time). A password spray will naturally form a dense cluster: many points (failures) close together in time, originating from one IP but spread across the username dimension. This can uncover attacks that are too slow or distributed to be caught by simple rules.",Windows Event ID 4625; Zeek http.log; Zeek conn.log; Public web application servers; API gateways; VPN concentrators; network perimeter firewalls; cloud identity provider log streams,last 90 days,": INPUT failed_logins (source_ip, username_hash, timestamp) to DBSCAN model. ALERT on clusters identified by the model as dense and containing a high ratio of unique users to a single source IP.",playbooks/attack/enterprise/T1586.yml
T1586: Compromise Accounts,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0042: Resource Development,n; o; n; e,7,Is any single user account being targeted by a high volume of failed login attempts from a geographically and network-diverse set of sources?,"This question aims to detect a distributed brute-force attack. To evade IP-based blocking, attackers use botnets or proxies spread across many different networks (ASNs). A simple rule looking for many failures from one IP would miss this. By counting failures against a single account and enriching the source IPs to find the number of unique ASNs, we can effectively identify these distributed attacks.","Windows Event ID 4625; Zeek conn.log; Authentication servers (Domain Controllers, RADIUS); public-facing application servers; cloud identity provider logs (e.g., Azure AD Sign-in logs); network perimeter flow logs",last 90 days,: GROUP failed_logins by target_user in 5_min_window. ALERT if count(failures) > 20 AND count(distinct_source_ASNs) > 5.,playbooks/attack/enterprise/T1586.yml
T1586: Compromise Accounts,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0042: Resource Development,n; o; n; e,8,Is there a statistically significant increase in the number or diversity of sources for failed logins against any single user account?,"This question uses statistical baselining to detect brute-force attacks. The first part identifies a simple volume-based anomaly (more failures than usual). The second part, using Shannon entropy, specifically detects a shift from a simple to a distributed attack. Entropy measures randomness; a low entropy of source IPs means failures come from one or two IPs, while a high entropy means they come from many different IPs. A sudden spike in entropy for a user's failed logins is a strong signal of a distributed attack.","Windows Event ID 4625; Zeek conn.log; Authentication servers (Domain Controllers, RADIUS); public-facing application servers; cloud identity provider logs (e.g., Azure AD Sign-in logs); network perimeter flow logs",last 90 days,": FOR each user: BASELINE hourly_failed_logins (mean, stddev). ALERT if current_hour_fails > mean + 3*stddev. ALSO, CALCULATE entropy of source_ips for fails in 5_min_window. ALERT on entropy spike.",playbooks/attack/enterprise/T1586.yml
T1586: Compromise Accounts,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0042: Resource Development,n; o; n; e,9,Can a time-series model predict the normal pattern of failed logins for high-value accounts and alert on deviations indicative of a brute-force attack?,"This question applies advanced time-series analysis for high-fidelity detection, especially for critical accounts (e.g., admins, executives). Models like ARIMA or LSTM can learn complex temporal patterns, including seasonality (e.g., fewer failures at night) and trends. They can then detect anomalies that simple statistical baselines might miss, such as a low-and-slow brute-force attack that doesn't trigger a simple volume threshold but represents a clear deviation from the learned pattern.","Windows Event ID 4625; Zeek conn.log; Authentication servers (Domain Controllers, RADIUS); public-facing application servers; cloud identity provider logs (e.g., Azure AD Sign-in logs); network perimeter flow logs",last 90 days,: FOR each high_value_user: TRAIN time-series_model on historical failed_login_counts_per_minute. FEED live stream of counts to model. ALERT if model flags current sequence as anomalous.,playbooks/attack/enterprise/T1586.yml
T1586: Compromise Accounts,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0042: Resource Development,n; o; n; e,10,Has a successful login occurred from an IP address that was just seen conducting a brute-force attempt against the same account?,"This is a classic and highly effective correlation. A string of failed logins followed by a success from the same source is a textbook indicator of a successful password guess. This question aims to directly identify the culmination of a brute-force or password guessing attack, providing a high-confidence alert that a compromise has likely just occurred.",Windows Event ID 4624; Windows Event ID 4625; Zeek conn.log; GeoIP Enrichment Database; Domain Controller and member server security logs; VPN access logs; internet gateway flow logs (Zeek conn.log); geolocation data enrichment services,last 90 days,": ON successful_login(user, ip): QUERY for failed_logins(user, ip) in last 15 minutes. ALERT if count(failed_logins) > 10.",playbooks/attack/enterprise/T1586.yml
T1586: Compromise Accounts,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0042: Resource Development,n; o; n; e,11,"Has a user successfully logged in from a location that is physically impossible to reach in the time since their last login, or from a network they have never used before?","This question seeks to identify account compromise through geographic and network anomalies. 'Impossible travel' is a strong indicator that two different entities are using the same credentials from different parts of the world. Similarly, a login from a country or Autonomous System (network) never before used by that user, while not impossible, is highly suspicious and warrants investigation. This helps catch compromises even without prior failed login attempts.",Windows Event ID 4624; Windows Event ID 4625; Zeek conn.log; GeoIP Enrichment Database; Domain Controller and member server security logs; VPN access logs; internet gateway flow logs (Zeek conn.log); geolocation data enrichment services,last 90 days,": ON successful_login(user, ip, time): GET last_login(user, last_ip, last_time). CALCULATE speed = distance(ip, last_ip) / (time - last_time). ALERT if speed > 1000 km/h. ALSO, CHECK if country(ip) or ASN(ip) is new for user in last 90 days. ALERT if new.",playbooks/attack/enterprise/T1586.yml
T1586: Compromise Accounts,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0042: Resource Development,n; o; n; e,12,Can a machine learning model provide a consolidated risk score for each successful login based on multiple behavioral and contextual features?,"This question proposes a sophisticated approach to detecting compromised account usage. Instead of relying on a single rule like 'impossible travel', a model can weigh multiple factors simultaneously (time since last login, distance, new country, new device, preceding failures, etc.). This allows it to flag logins that are subtly anomalous across several dimensions, providing a more nuanced and potentially more accurate detection capability than individual hard-coded rules.",Windows Event ID 4624; Windows Event ID 4625; Zeek conn.log; GeoIP Enrichment Database; Domain Controller and member server security logs; VPN access logs; internet gateway flow logs (Zeek conn.log); geolocation data enrichment services,last 90 days,": ON successful_login: FEATURE_ENGINEER (time_diff, distance, new_country, prior_fails, etc.). INPUT features to classification_model. ALERT if predicted_probability > 0.9.",playbooks/attack/enterprise/T1586.yml
T1586: Compromise Accounts,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0042: Resource Development,n; o; n; e,13,Are we receiving emails that appear to be from trusted partners but fail email authentication checks or contain known malicious links?,"This question targets the abuse of a compromised partner account for phishing or malware delivery. A failure in DMARC, SPF, or DKIM means the email likely did not originate from the partner's legitimate mail servers, a strong sign of spoofing or compromise. The presence of a known malicious URL is an even more direct indicator of malicious intent. This helps detect threats that leverage the trust established with partners.",Email Gateway Logs; Zeek dns.log; Zeek http.log; WHOIS lookup data; Mail Transfer Agents (MTAs); email security gateways; network DNS resolvers; web proxies; external domain intelligence services,last 90 days,": FOR inbound_email from partner_domain: ALERT if DMARC_result == 'fail'. ALSO, FOR url in email_body: ALERT if domain(url) in malicious_domain_feed.",playbooks/attack/enterprise/T1586.yml
T1586: Compromise Accounts,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0042: Resource Development,n; o; n; e,14,"Are emails from important senders (partners, executives) directing users to newly created websites?","This question leverages the fact that attackers often use newly registered domains (NRDs) for phishing and malware campaigns, as they have not yet been blacklisted. A legitimate email from a partner is highly unlikely to contain links to a website created just days ago. By checking the age of all domains in an email, especially from high-value senders, we can detect suspicious links that might otherwise appear benign.",Email Gateway Logs; Zeek dns.log; Zeek http.log; WHOIS lookup data; Mail Transfer Agents (MTAs); email security gateways; network DNS resolvers; web proxies; external domain intelligence services,last 90 days,: FOR inbound_email from partner_or_exec: EXTRACT urls. FOR each url: GET domain_registration_date. ALERT if age(domain) < 30 days.,playbooks/attack/enterprise/T1586.yml
T1586: Compromise Accounts,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0042: Resource Development,n; o; n; e,15,Does the writing style or topic of an inbound email from a known partner deviate significantly from their historical communication patterns?,"This question uses Natural Language Processing (NLP) to detect a 'human' anomaly. Every person has a unique writing style (stylometry)—their vocabulary, sentence length, use of punctuation, etc. An attacker who has compromised an account is unlikely to perfectly mimic the legitimate owner's style. By creating a baseline of a partner's normal style and topics, we can flag emails that 'don't sound like them', which can be a subtle but powerful indicator of account takeover.",Email Gateway Logs; Zeek dns.log; Zeek http.log; WHOIS lookup data; Mail Transfer Agents (MTAs); email security gateways; network DNS resolvers; web proxies; external domain intelligence services,last 90 days,: FOR inbound_email from key_partner: EXTRACT text. CALCULATE stylometric_and_topic_features. COMPARE features to sender's historical_baseline using cosine_similarity. ALERT if similarity_score < threshold.,playbooks/attack/enterprise/T1586.yml
T1586: Compromise Accounts,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0042: Resource Development,n; o; n; e,16,"Are new, potentially imposter social media accounts being created for our executives or brands and used to spread suspicious links?","This question focuses on detecting brand impersonation and typosquatting on social media. Adversaries create fake profiles to defraud customers, spread disinformation, or launch phishing attacks. By proactively monitoring for the creation of these accounts and checking the links they post for suspicious characteristics (newly registered, on a threat feed), we can quickly identify and report these impersonation attempts.","OSINT Monitoring Platform Data; Social Media Site APIs; Zeek dns.log; Zeek http.log; Public social media platforms (e.g., LinkedIn, X/Twitter); OSINT data aggregation services; brand protection services; internal web proxy logs",last 90 days,: MONITOR social_media for new_profiles matching executive_names. ON new_profile_creation: CHECK links in posts. ALERT if link_domain_age < 60 days OR link_domain_on_threat_feed.,playbooks/attack/enterprise/T1586.yml
T1586: Compromise Accounts,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0042: Resource Development,n; o; n; e,17,"Have any of our monitored, legitimate social media accounts started exhibiting anomalous behavior in terms of posting frequency, content, or engagement patterns?","This question aims to detect the takeover of a legitimate company or executive social media account. An attacker, once in control, is likely to behave differently than the original owner. This could manifest as posting at unusual times, a sudden change in topic (monitored via keywords or hashtags), or an abnormal spike in activity. By baselining normal behavior across multiple metrics, we can detect these deviations that signal a potential compromise.","OSINT Monitoring Platform Data; Social Media Site APIs; Zeek dns.log; Zeek http.log; Public social media platforms (e.g., LinkedIn, X/Twitter); OSINT data aggregation services; brand protection services; internal web proxy logs",last 90 days,": FOR monitored_account: BASELINE posting_frequency, content_keywords, etc. over 90 days. ALERT if current_activity > 3 * stddev from baseline. CALCULATE Jaccard_similarity of hashtags in new_post vs historical_posts. ALERT on sudden drop.",playbooks/attack/enterprise/T1586.yml
T1586: Compromise Accounts,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0042: Resource Development,n; o; n; e,18,Does the writing style of new posts on our official social media accounts match the established style of the legitimate author or brand voice?,"Similar to the email analysis, this question uses stylometry and author attribution to detect account takeover. A corporate brand or an executive has a distinct 'voice' or style. A machine learning model can be trained to recognize this style. If a new post is published that the model identifies as being written by someone else, it serves as a strong, albeit subtle, indicator that the account may be controlled by an unauthorized party.","OSINT Monitoring Platform Data; Social Media Site APIs; Zeek dns.log; Zeek http.log; Public social media platforms (e.g., LinkedIn, X/Twitter); OSINT data aggregation services; brand protection services; internal web proxy logs",last 90 days,: FOR monitored_account: TRAIN author_attribution_model on historical posts. FOR each new_post: CLASSIFY author using model. ALERT if classification is 'unknown' or not the expected author.,playbooks/attack/enterprise/T1586.yml
T1587.002: Code Signing Certificates,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0042: Resource Development,n; o; n; e,1,Are any executed binaries or TLS sessions using certificates with thumbprints that match a known-malicious list from threat intelligence?,"This question aims to identify the direct use of known-bad certificates. Cross-referencing certificate thumbprints from executed processes (captured via Sysmon or Zeek) and network TLS sessions against a list of malicious indicators from CTI feeds allows for high-confidence detection of malicious activity. A match indicates that a compromised or malicious component is active on the network, warranting an immediate high-severity alert.",Sysmon Event ID 1; Zeek ssl.log; Zeek pe.log; SIEM/Data Lake aggregating endpoint and network telemetry; Network sensors at internet egress points; All endpoints with process and signature monitoring.,last 90 days,: ,playbooks/attack/enterprise/T1587.002.yml
T1587.002: Code Signing Certificates,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0042: Resource Development,n; o; n; e,2,"For a certificate identified as malicious by CTI, is its issuer exceptionally rare in the environment?","This question adds context to a CTI match by assessing the novelty of the certificate's issuer. An adversary might use a newly created or stolen certificate authority to sign their tools. If a malicious certificate's issuer is rarely or never seen before (e.g., in the bottom 1st percentile of all issuers), it heightens the suspicion that the activity is part of a novel or highly targeted campaign, justifying an escalation in alert priority.",Sysmon Event ID 1; Zeek ssl.log; Zeek pe.log; SIEM/Data Lake aggregating endpoint and network telemetry; Network sensors at internet egress points; All endpoints with process and signature monitoring.,last 90 days,: ,playbooks/attack/enterprise/T1587.002.yml
T1587.002: Code Signing Certificates,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0042: Resource Development,n; o; n; e,3,Has there been an anomalous spike in the number of new CTI-matched certificate detections?,"This question seeks to identify a sudden, widespread campaign using known-bad certificates. By applying a time series anomaly detection model to the daily count of new CTI certificate matches, we can establish a baseline of 'normal' activity. A significant deviation from this baseline, such as a count exceeding the 99th percentile of the forecast, strongly suggests a coordinated attack is underway and requires an immediate, high-priority investigation.",Sysmon Event ID 1; Zeek ssl.log; Zeek pe.log; SIEM/Data Lake aggregating endpoint and network telemetry; Network sensors at internet egress points; All endpoints with process and signature monitoring.,last 90 days,: ,playbooks/attack/enterprise/T1587.002.yml
T1587.002: Code Signing Certificates,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0042: Resource Development,n; o; n; e,4,Is a user or process attempting to add a new certificate to a trusted root or publisher store using common command-line utilities?,This question targets a key persistence and defense evasion technique where an adversary installs a malicious root certificate to make their malware appear trusted. Monitoring for specific command-line patterns used by utilities like 'certutil.exe' or PowerShell's 'Import-Certificate' cmdlet to modify the 'Root' or 'TrustedPublisher' certificate stores provides a direct way to detect this activity. Any such attempt should be considered suspicious and trigger an alert.,"Sysmon Event ID 1; Windows Event ID 4688; Windows Event ID 4104; Windows endpoints and servers, especially Domain Controllers, Public Key Infrastructure (PKI) servers, and developer workstations.",last 90 days,: ,playbooks/attack/enterprise/T1587.002.yml
T1587.002: Code Signing Certificates,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0042: Resource Development,n; o; n; e,5,Is a certificate store modification being performed by a user or host that rarely or never performs this action?,"This question helps to differentiate between legitimate administrative activity and suspicious behavior. While IT administrators may regularly manage certificates, the same action from a standard user or a non-administrative server is highly anomalous. By baselining which users and hosts normally perform these tasks, we can flag modifications from entities outside the top 5% of frequent actors as potentially malicious, reducing false positives from routine maintenance.","Sysmon Event ID 1; Windows Event ID 4688; Windows Event ID 4104; Windows endpoints and servers, especially Domain Controllers, Public Key Infrastructure (PKI) servers, and developer workstations.",last 90 days,: ,playbooks/attack/enterprise/T1587.002.yml
T1587.002: Code Signing Certificates,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0042: Resource Development,n; o; n; e,6,Can we classify the command used for certificate management as 'benign' or 'suspicious' based on its characteristics?,"This question applies machine learning to add intelligence to the detection of certificate management commands. A classification model can learn the nuances that distinguish benign administrative scripts from malicious one-liners. By analyzing features like command length, specific keywords, and the user's role (e.g., IT admin), the model can automatically classify an event as 'suspicious,' allowing analysts to focus on the highest-risk activities.","Sysmon Event ID 1; Windows Event ID 4688; Windows Event ID 4104; Windows endpoints and servers, especially Domain Controllers, Public Key Infrastructure (PKI) servers, and developer workstations.",last 90 days,: ,playbooks/attack/enterprise/T1587.002.yml
T1587.002: Code Signing Certificates,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0042: Resource Development,n; o; n; e,7,Are any executed binaries signed with certificates containing suspicious metadata patterns?,"This question focuses on identifying malicious certificates not by a known thumbprint, but by their intrinsic properties. Adversaries often create certificates with metadata that deviates from legitimate norms, such as unusually long validity periods (e.g., >20 years), weak cryptographic algorithms (e.g., MD5), or known-bad issuer/subject strings. Applying a ruleset like YARA to certificate metadata can effectively flag these suspicious indicators.","Sysmon Event ID 1; Zeek pe.log; Endpoints and servers where binaries are executed; Network chokepoints where files are transferred (e.g., web proxies, email gateways); Centralized file repositories and shares.",last 90 days,: ,playbooks/attack/enterprise/T1587.002.yml
T1587.002: Code Signing Certificates,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0042: Resource Development,n; o; n; e,8,Do any signing certificates exhibit unusually high or low randomness in their Subject or Issuer fields?,"This question uses information theory to detect algorithmically generated or carelessly created certificate metadata. High entropy (randomness) in the Subject or Issuer fields may indicate the use of a Domain Generation Algorithm (DGA) for creating unique names, a common malware technique. Conversely, very low entropy can indicate generic, empty, or default values. Flagging certificates in the top or bottom 5th percentile for entropy, especially if self-signed, helps uncover these outliers.","Sysmon Event ID 1; Zeek pe.log; Endpoints and servers where binaries are executed; Network chokepoints where files are transferred (e.g., web proxies, email gateways); Centralized file repositories and shares.",last 90 days,: ,playbooks/attack/enterprise/T1587.002.yml
T1587.002: Code Signing Certificates,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0042: Resource Development,n; o; n; e,9,Are there any signing certificates that are statistical outliers compared to a baseline of known-good certificates?,"This question leverages anomaly detection to find suspicious certificates that don't match specific rules but differ from the norm. By training a model (like an Isolation Forest) on the metadata of legitimate, common software in the environment, we can create a profile of 'normal.' Any new certificate that significantly deviates from this profile, based on features like validity period, key length, and subject/issuer entropy, is flagged as an anomaly requiring investigation.","Sysmon Event ID 1; Zeek pe.log; Endpoints and servers where binaries are executed; Network chokepoints where files are transferred (e.g., web proxies, email gateways); Centralized file repositories and shares.",last 90 days,: ,playbooks/attack/enterprise/T1587.002.yml
T1587.002: Code Signing Certificates,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0042: Resource Development,n; o; n; e,10,Are any processes being executed from binaries that are self-signed and contain generic keywords?,"This question targets a common tactic used by developers of potentially unwanted programs (PUPs) or malware, where they use self-signed certificates with generic or placeholder information. An alert should be triggered when a binary is executed where the certificate's Issuer and Subject fields are identical, and the subject contains non-specific terms like 'Test', 'Developer', or is empty. This helps filter out more legitimate self-signed certificates from suspicious ones.","Sysmon Event ID 1; Zeek pe.log; All managed endpoints and servers; Network egress points monitoring file transfers; Software distribution points (e.g., SCCM, Intune).",last 90 days,: ,playbooks/attack/enterprise/T1587.002.yml
T1587.002: Code Signing Certificates,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0042: Resource Development,n; o; n; e,11,Is a binary being executed that is signed by a certificate from a completely new or extremely rare issuer?,"This question helps identify threats from novel sources. Adversaries may acquire or create certificates from new or obscure certificate authorities. By maintaining a baseline of all certificate issuers seen in the environment, we can immediately identify when a binary is signed by a brand-new issuer. This, or an issuer with a very low prevalence (e.g., bottom 5th percentile), significantly increases the risk score of the event, as it's unlikely to be from a mainstream, trusted software vendor.","Sysmon Event ID 1; Zeek pe.log; All managed endpoints and servers; Network egress points monitoring file transfers; Software distribution points (e.g., SCCM, Intune).",last 90 days,: ,playbooks/attack/enterprise/T1587.002.yml
T1587.002: Code Signing Certificates,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0042: Resource Development,n; o; n; e,12,"Does a newly observed certificate deviate from a model trained exclusively on known-good, common enterprise software certificates?","This question uses a highly tailored machine learning approach to detect suspicious certificates. A one-class SVM model is trained on the characteristics of certificates from trusted, frequently used applications within the organization. This creates a tight boundary defining 'normal.' Any new certificate that falls outside this boundary is, by definition, an outlier and likely not part of the standard software portfolio, making it a high-priority candidate for investigation.","Sysmon Event ID 1; Zeek pe.log; All managed endpoints and servers; Network egress points monitoring file transfers; Software distribution points (e.g., SCCM, Intune).",last 90 days,: ,playbooks/attack/enterprise/T1587.002.yml
T1587.002: Code Signing Certificates,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0042: Resource Development,n; o; n; e,13,"Has a single host exhibited a sudden burst of activity involving multiple unique, new, self-signed certificates?","This question aims to detect an adversary staging multiple tools or components on a compromised host. A legitimate system will rarely, if ever, introduce numerous new self-signed certificates in a short period. A rule that alerts when a host uses more than a small threshold (e.g., 5) of unique, previously unseen, self-signed certificates within a one-hour window is a strong indicator of malicious activity, such as the deployment of a malware toolkit.",Sysmon Event ID 1; Zeek pe.log; Zeek ssl.log; Enterprise-wide SIEM or data lake aggregating host and network logs.,last 90 days,: ,playbooks/attack/enterprise/T1587.002.yml
T1587.002: Code Signing Certificates,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0042: Resource Development,n; o; n; e,14,Has the enterprise-wide rate of new self-signed certificates appearing exceeded a statistical baseline?,"This question provides a broader, enterprise-wide view to detect widespread campaigns or environmental changes. By calculating a 30-day baseline (mean and standard deviation) for the number of new self-signed certificates observed in a 24-hour period, we can detect statistically significant spikes. A count that exceeds the mean by more than three standard deviations indicates an abnormal event that could be a coordinated attack or a misconfiguration affecting many systems.",Sysmon Event ID 1; Zeek pe.log; Zeek ssl.log; Enterprise-wide SIEM or data lake aggregating host and network logs.,last 90 days,: ,playbooks/attack/enterprise/T1587.002.yml
T1587.002: Code Signing Certificates,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0042: Resource Development,n; o; n; e,15,Is there a time-series anomaly in the hourly count of new self-signed certificates across the enterprise?,"This question applies advanced time-series analysis to detect anomalous spikes in self-signed certificate activity that might be missed by simpler statistical methods. A model like Seasonal-Hybrid ESD can account for normal daily or weekly patterns (e.g., more activity during business hours). An alert is generated only when a spike is detected that cannot be explained by these normal trends, providing a high-fidelity signal of a potential threat.",Sysmon Event ID 1; Zeek pe.log; Zeek ssl.log; Enterprise-wide SIEM or data lake aggregating host and network logs.,last 90 days,: ,playbooks/attack/enterprise/T1587.002.yml
T1587.002: Code Signing Certificates,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0042: Resource Development,n; o; n; e,16,Is the same certificate being used to both sign a local binary and secure an outbound TLS session from the same host?,This question seeks to identify a common malware pattern where a self-signed certificate is used to sign the malware executable and also to encrypt its command-and-control (C2) communications. Correlating process execution logs with network TLS logs to find a match between a binary's signing certificate and a server certificate for an outbound connection from the same host within a short time window is a powerful detection. This is especially suspicious if the destination IP is external and has a poor reputation.,Sysmon Event ID 1; Zeek ssl.log; Zeek conn.log; SIEM or data lake capable of correlating host-based process execution data with network session data.,last 90 days,: ,playbooks/attack/enterprise/T1587.002.yml
T1587.002: Code Signing Certificates,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0042: Resource Development,n; o; n; e,17,"Are we observing a rare combination of process name, certificate issuer, and destination network (ASN)?","This question uses statistical analysis to find anomalous correlations between process, certificate, and network activity. Most legitimate software has predictable patterns (e.g., chrome.exe, signed by Google, connecting to Google's ASN). By baselining common combinations of (process, issuer, destination ASN), we can flag any new, rare tuple that falls in the lowest 1st percentile of frequency. This points to unusual behavior that warrants investigation.",Sysmon Event ID 1; Zeek ssl.log; Zeek conn.log; SIEM or data lake capable of correlating host-based process execution data with network session data.,last 90 days,: ,playbooks/attack/enterprise/T1587.002.yml
T1587.002: Code Signing Certificates,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0042: Resource Development,n; o; n; e,18,Can we detect suspicious C2 activity by modeling host and network events as a graph?,"This question applies graph analysis to uncover complex relationships indicative of C2 activity. By representing processes, certificates, and IPs as nodes in a graph, we can use algorithms to find unusual structures. A small, tightly connected cluster of nodes that includes a process, a self-signed certificate, and a rare external IP address is a strong visual and analytical signal of a malicious C2 channel, distinct from the large, sprawling graphs of benign activity.",Sysmon Event ID 1; Zeek ssl.log; Zeek conn.log; SIEM or data lake capable of correlating host-based process execution data with network session data.,last 90 days,: ,playbooks/attack/enterprise/T1587.002.yml
T1588.002: Tool,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,1,Have any hosts downloaded files with known malicious hashes or connected to network destinations associated with adversary tool distribution?,"This question seeks to identify the most direct evidence of tool acquisition by matching observed activity against known-bad indicators. It involves two concurrent checks: 1) monitoring all network traffic (DNS, HTTP, general connections) for communications with IPs, domains, or URLs listed in threat intelligence feeds as tool hosting or distribution sites, and 2) scanning all new files and processes on endpoints to see if their file hashes match signatures of known malicious tools. A positive match on either check is a high-confidence indicator that an adversary is staging tools.",Windows Event ID 4688; Zeek conn.log; Zeek dns.log; Zeek files.log; Zeek http.log; Internet Gateway; DNS Servers; Endpoints,last 90 days,"QUERY: Cross-reference network logs (DNS, HTTP) against threat intel feeds for tool distribution sites. Separately, check file creation and process execution logs for file hashes matching known malicious tool hashes.",playbooks/attack/enterprise/T1588.002.yml
T1588.002: Tool,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,2,Are there any rare executables being downloaded from unusually random-looking domain names?,"This question attempts to find unknown or novel adversary tools by searching for statistical anomalies. Adversaries often use custom tools that will be rare within a target environment, or they may use Domain Generation Algorithms (DGAs) to host them, resulting in high-entropy, random-looking domain names. This query identifies suspicious activity by finding the intersection of these two anomalies: an executable file that has been seen on very few hosts (e.g., <0.1% of the fleet) being downloaded from a high-entropy domain that is not on an established allowlist.",Zeek conn.log; Zeek dns.log; Zeek files.log; Zeek http.log; Internet Gateway; DNS Servers; Endpoints,last 90 days,"QUERY: Identify executable file hashes with low prevalence (<0.1% of hosts). Separately, identify high-entropy FQDNs not on an allowlist. Correlate to see if rare executables are downloaded from these suspicious domains.",playbooks/attack/enterprise/T1588.002.yml
T1588.002: Tool,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,3,Can machine learning models identify network connections indicative of malicious tool downloads that evade signature-based detection?,"This question proposes a proactive, advanced detection method for finding novel threats. By training a supervised classification model on the characteristics of known benign and malicious network connections (e.g., duration, protocol, data volume, domain age, IP reputation), a predictive system can be built. This system can then score all new, unclassified outbound connections, assigning a probability of maliciousness. A high probability score (>0.8), especially for a connection that involves a file transfer, is a strong signal of a potential tool download that would be missed by traditional IOC-based methods.",Zeek conn.log; Zeek dns.log; Zeek files.log; Zeek http.log; Internet Gateway; DNS Servers; Endpoints,last 90 days,"QUERY: Apply a pre-trained classification model to score new outbound network connections. Flag connections with a high malicious probability score, especially those associated with file transfers.",playbooks/attack/enterprise/T1588.002.yml
T1588.002: Tool,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,4,Has any command-line activity been observed that matches signatures of known offensive security tools?,"Adversaries frequently use well-known offensive security tools (e.g., Mimikatz, AdFind, PsExec) and PowerShell frameworks (e.g., PowerSploit). These tools often have unique and recognizable command-line syntax, arguments, or patterns. This question involves actively searching process creation logs (Event ID 4688) and PowerShell script block logs (Event ID 4104) for these specific malicious signatures using keyword or regular expression-based detection rules, such as those provided by the Sigma project.",Windows Event ID 4688; Windows Event ID 4104; Endpoints; Application Servers; Domain Controllers,last 90 days,"QUERY: Scan process command-line arguments and PowerShell script block logs for keywords, regex, or specific argument combinations matching Sigma rules for common offensive tools.",playbooks/attack/enterprise/T1588.002.yml
T1588.002: Tool,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,5,Have any processes been executed with statistically rare or unusually complex/random command-line arguments?,"This question aims to uncover novel or obfuscated tool usage by identifying statistical outliers in command-line activity. An adversary might use a custom tool or encode their commands, both of which would deviate from normal administrative activity. This is detected in two ways: 1) identifying commands that use arguments that are extremely infrequent compared to a historical baseline for that specific parent process, and 2) identifying commands that have unusually high character entropy, which can indicate the use of obfuscation, encoding (like Base64), or encryption.",Windows Event ID 4688; Windows Event ID 4104; Endpoints; Application Servers; Domain Controllers,last 90 days,QUERY: Analyze command-line arguments for statistical rarity compared to a historical baseline. Flag commands with very infrequent arguments or high character entropy.,playbooks/attack/enterprise/T1588.002.yml
T1588.002: Tool,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,6,Can unsupervised machine learning identify clusters of suspicious command-line activity without prior knowledge of specific tools?,"This advanced technique uses unsupervised clustering algorithms (like DBSCAN) to automatically group similar command-line executions without relying on pre-existing signatures. Normal administrative and user activity will form large, dense clusters. The goal is to identify small, distinct clusters that are separate from these benign groups. Such outlier clusters may represent a novel or unknown adversary tool being used in a consistent manner, allowing for detection of new attack patterns.",Windows Event ID 4688; Windows Event ID 4104; Endpoints; Application Servers; Domain Controllers,last 90 days,"QUERY: Use a clustering algorithm (e.g., DBSCAN) on vectorized command-line data. Investigate small, distinct clusters that do not correspond to known benign activity.",playbooks/attack/enterprise/T1588.002.yml
T1588.002: Tool,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,7,"Has an executable file been downloaded and then quickly executed from a suspicious, non-standard directory?","This question targets the common ""download and execute"" TTP. Adversaries often drop malicious tools into directories that are user-writable by default and not intended for applications, such as C:\\Users\\Public\\, C:\\Windows\\Temp\\, or user download folders. This query correlates network logs showing an executable file download with endpoint logs showing process creation. An alert is triggered if the process is executed from one of these suspicious locations within a short time window (e.g., 10 minutes) of the download, indicating a likely tool staging event.",Zeek files.log; Zeek http.log; Windows Event ID 4688; Internet Gateway; Endpoints; Shared Network Drives,last 90 days,"QUERY: Correlate network file download events with process creation events on the same host. Alert if an executable is run from a non-standard directory (e.g., C:\\Users\\Public) within 10 minutes of being downloaded.",playbooks/attack/enterprise/T1588.002.yml
T1588.002: Tool,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,8,Have any common applications (like browsers or email clients) spawned unexpected child processes from unusual locations?,"Benign applications typically exhibit predictable process behaviors. For instance, an email client like Outlook should not be spawning a command shell or an unknown executable. This question involves establishing a baseline of normal parent-child process relationships and the directories from which child processes are typically executed. The query then flags statistically rare occurrences, such as chrome.exe spawning an executable from C:\\PerfLogs\\, which could indicate that a malicious download or exploit was used to drop and run an adversary tool.",Windows Event ID 4688; Endpoints; Shared Network Drives,last 90 days,"QUERY: Baseline normal parent-child process relationships and execution paths. Alert on statistically rare combinations, especially involving common applications spawning processes from unexpected directories.",playbooks/attack/enterprise/T1588.002.yml
T1588.002: Tool,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,9,"Can a machine learning model detect anomalous sequences of events (e.g., network connection -> file write -> process create) that indicate tool staging?","This advanced approach models the chronological sequence of events on a host to detect anomalies. A neural network (like an autoencoder) is trained on vast amounts of normal event sequences to learn what constitutes benign behavior. It can then be fed real-time event streams from hosts. If it encounters a sequence (e.g., an inbound network connection followed by a file write to a temp folder followed by a process creation) that it cannot accurately reconstruct based on its training, it flags the sequence with a high ""reconstruction error."" This indicates a deviation from normalcy that may represent a malicious tool staging and execution chain.",Zeek files.log; Zeek http.log; Windows Event ID 4688; Internet Gateway; Endpoints; Shared Network Drives,last 90 days,"QUERY: Feed host event sequences (network, file, process) into a trained autoencoder model. Investigate sequences that produce a high reconstruction error, indicating anomalous behavior.",playbooks/attack/enterprise/T1588.002.yml
T1588.002: Tool,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,10,"Has any user or host initiated a ""first time"" remote administrative connection to another host?","When adversaries gain access to a host, they often use remote administration protocols (RDP, WinRM, etc.) to move laterally to other systems. This question focuses on detecting this initial hop by maintaining a stateful record of all unique remote administrative connections. An alert is generated the first time a new connection is observed, such as a specific user on their workstation connecting to a high-value server they have never accessed before. This ""first-of-its-kind"" event is a strong indicator of potential lateral movement using a newly acquired tool or credential.",Zeek conn.log; Zeek dce_rpc.log; Zeek rdp.log; Windows Event ID 4624; Windows Event ID 4648; Internal Network Segments; Domain Controllers; High-Value Servers,last 90 days,"QUERY: Track all remote administrative logons. Alert on any unique combination of (Source User, Source Host, Destination Host, Protocol) that has not been observed in the last 30-90 days.",playbooks/attack/enterprise/T1588.002.yml
T1588.002: Tool,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,11,Is any user exhibiting an unusually high amount of remote logon activity compared to their own history or to their peers?,"A compromised user account may be used by an adversary to access far more systems than the legitimate user typically would. This question seeks to detect this behavior by identifying statistical outliers. It performs two checks: 1) it compares a user's current remote logon activity against their own historical baseline, flagging significant spikes (e.g., >3 standard deviations from the mean), and 2) it compares the user's activity against their peer group (e.g., other members of the HR department), flagging users whose activity is in the top percentile. A user who is an outlier in either their personal or peer group behavior warrants investigation.",Zeek conn.log; Windows Event ID 4624; Windows Event ID 4648; Internal Network Segments; Domain Controllers; High-Value Servers,last 90 days,"QUERY: Baseline each user's remote logon frequency. Alert if a user's activity exceeds their personal baseline (e.g., >3 standard deviations) or their peer group's baseline (e.g., >98th percentile).",playbooks/attack/enterprise/T1588.002.yml
T1588.002: Tool,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,12,Can graph analysis reveal improbable remote connections between distinct groups of assets that could signify lateral movement?,"This advanced method models the network as a graph, where hosts are nodes and remote logons are connections (edges). Using community detection algorithms, it first identifies normal clusters of activity (e.g., the ""developer workstations"" community talks to the ""source code servers"" community). It then uses link prediction models to identify new connections that are highly improbable given the established graph structure. An example would be a new connection forming between a host in the ""HR"" community and a host in the ""Domain Controllers"" community, which could signify tool-facilitated lateral movement across security boundaries.",Zeek conn.log; Windows Event ID 4624; Internal Network Segments; Domain Controllers; High-Value Servers,last 90 days,QUERY: Model hosts and remote logons as a graph. Use community detection and link prediction algorithms to flag new connections between otherwise disconnected clusters of hosts.,playbooks/attack/enterprise/T1588.002.yml
T1588.006: Vulnerabilities,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,1,Have any inbound connections originated from IP addresses on a high-confidence threat intelligence list of known scanners or C2 infrastructure?,"This question seeks to detect initial reconnaissance or probing by cross-referencing inbound connection source IPs with known malicious indicators. A match provides a strong signal of adversarial activity, and filtering out known benign scanners (e.g., from search engines or security partners) is crucial to minimize false positives.
",Zeek conn.log; Network sensors monitoring internet gateway traffic; SIEM platform hosting threat intelligence feeds.,Last 90 days,": JOIN zeek_conn.source_ip WITH threat_intel.ip 
WHERE zeek_conn.direction = 'inbound' 
AND zeek_conn.source_ip NOT IN benign_allow_list;
",playbooks/attack/enterprise/T1588.006.yml
T1588.006: Vulnerabilities,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,2,"For any IP identified as potentially malicious, has it exhibited broad, non-specific port scanning activity in the last 24 hours?","This question helps prioritize alerts by assessing the behavior of a suspicious IP. A high Shannon entropy score on destination ports indicates the IP is not targeting a specific service but is instead scanning a wide range of ports, which is a classic indicator of reconnaissance. This helps distinguish targeted attacks from broad, indiscriminate scanning.
",Zeek conn.log; Network sensors monitoring internet gateway traffic; SIEM platform hosting threat intelligence feeds.,Last 24 hours,": FROM zeek_conn 
WHERE source_ip = 'suspicious_ip' AND timestamp > (now - 24h) 
CALCULATE shannon_entropy(destination_port)
ALERT if entropy > 3.5;
",playbooks/attack/enterprise/T1588.006.yml
T1588.006: Vulnerabilities,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,3,"Can we use a machine learning model to predict if a new, previously unseen inbound connection is likely malicious based on its network traffic features?","This question leverages machine learning to proactively identify suspicious connections that may not appear on static threat intelligence lists. By training a model on features from historical data, it can learn the characteristics of malicious traffic (e.g., connection duration, bytes transferred, ASN information) and flag new connections that fit this profile with a high degree of probability, enabling detection of novel threats.
",Zeek conn.log; Network sensors monitoring internet gateway traffic; SIEM platform hosting threat intelligence feeds.,Last 90 days,": FOR each new inbound_connection
EXTRACT features (protocol, duration, bytes, ASN, country)
PREDICT probability = logistic_regression_model(features)
ALERT if probability > 0.9;
",playbooks/attack/enterprise/T1588.006.yml
T1588.006: Vulnerabilities,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,4,"Are inbound web requests showing signs of vulnerability scanning through matching known tool signatures, directory traversal attempts, or specific exploit probes?","This question uses signature-based detection on HTTP traffic to find clear indicators of scanning or exploitation attempts. By searching for common scanner user-agents (Nmap, Nikto), directory traversal patterns, or exploit strings (like for Log4Shell), analysts can quickly identify low-sophistication attacks and known malicious techniques.
",Zeek http.log; Web-facing application servers; Reverse proxies and load balancers where network traffic is inspected.,Last 90 days,": SELECT * FROM zeek_http 
WHERE user_agent MATCHES '(?i)nmap|nikto|acunetix' 
OR uri MATCHES '../' 
OR post_body MATCHES 'jndi:ldap';
",playbooks/attack/enterprise/T1588.006.yml
T1588.006: Vulnerabilities,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,5,"Is any single external IP address generating an anomalously high ratio of client-error (4xx) HTTP responses, suggesting forceful browsing or endpoint discovery?","This question aims to identify attackers who are systematically searching for hidden or unlinked content by monitoring for an unusually high rate of errors like '404 Not Found'. A high 4xx error rate from a single IP is a strong statistical indicator of forceful browsing or API endpoint enumeration.
",Zeek http.log; Web-facing application servers; Reverse proxies and load balancers where network traffic is inspected.,Last 90 days,": FOR each source_ip in zeek_http over 1-hour windows
CALCULATE ratio = (count where status_code LIKE '4%') / (total count)
ALERT if ratio > baseline_95th_percentile;
",playbooks/attack/enterprise/T1588.006.yml
T1588.006: Vulnerabilities,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,6,Can a machine learning model detect novel or obfuscated scanning and injection patterns in web request URIs that signature-based rules might miss?,"This question proposes using advanced NLP or CNN models to analyze the structure and characters of URIs. This approach can identify sophisticated attacks that use encoding or obfuscation to bypass simple regex rules, allowing for the detection of novel and zero-day attack patterns that would otherwise go unnoticed.
",Zeek http.log; Web-facing application servers; Reverse proxies and load balancers where network traffic is inspected.,Last 90 days,": FOR each request in zeek_http
CLASSIFY uri_string with cnn_model
ALERT if classification is 'malicious' with confidence > 0.95;
",playbooks/attack/enterprise/T1588.006.yml
T1588.006: Vulnerabilities,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,7,Has any single external IP address connected to an excessive number of unique hosts (horizontal scan) or unique ports on a single host (vertical scan) within a short time frame?,"This question uses simple thresholding to detect the two primary forms of network scanning. A horizontal scan (one source to many destinations) suggests an attacker is looking for a specific vulnerable service across the network, while a vertical scan (one source to many ports on one destination) suggests an attempt to fingerprint the services running on a single host.
",Zeek conn.log; Network sensors monitoring DMZ and internet gateway traffic; SIEM platform used for data aggregation and analysis.,Last 90 days,": FOR each source_ip over 5-minute windows
COUNT unique destination_hosts and destination_ports
ALERT if unique_hosts > 50 OR unique_ports > 25;
",playbooks/attack/enterprise/T1588.006.yml
T1588.006: Vulnerabilities,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,8,Is any external source IP exhibiting statistically anomalous scanning behavior by contacting a number of distinct hosts or ports that significantly deviates from the established baseline?,"This question moves beyond fixed thresholds to a more dynamic, statistical approach. By establishing a baseline of normal activity, it can flag source IPs whose connection patterns are a significant statistical outlier (e.g., more than 3 standard deviations from the mean). This method is more resilient to slow scans and can adapt to changing network traffic patterns.
",Zeek conn.log; Network sensors monitoring DMZ and internet gateway traffic; SIEM platform used for data aggregation and analysis.,Last 90 days,": FOR each source_ip over 15-minute windows
CALCULATE distinct_host_count and distinct_port_count
ALERT if count > (hourly_mean + 3 * hourly_std_dev);
",playbooks/attack/enterprise/T1588.006.yml
T1588.006: Vulnerabilities,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,9,"Using clustering algorithms, can we identify external source IPs that behave as outliers or form sparse clusters, indicating they are not part of legitimate, dense traffic patterns and are likely scanners?","This question applies unsupervised machine learning to identify scanners. Legitimate clients typically form dense clusters of activity (e.g., many users accessing a web server). Scanners, which connect broadly and shallowly, will not fit into these clusters and will be identified as noise or outliers by algorithms like DBSCAN, providing a powerful way to find anomalous actors.
",Zeek conn.log; Network sensors monitoring DMZ and internet gateway traffic; SIEM platform used for data aggregation and analysis.,Last 90 days,": INPUT connection_tuples (source_ip, dest_ip, dest_port) over 30 mins
RUN DBSCAN clustering algorithm
IDENTIFY source_ips classified as noise_points;
",playbooks/attack/enterprise/T1588.006.yml
T1588.006: Vulnerabilities,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,10,"Following the public disclosure of a new vulnerability, are we observing connection attempts to the affected service/port from new IP addresses not seen in the last 30 days?","This question focuses on detecting opportunistic, mass exploitation attempts that often follow the announcement of a critical vulnerability. By correlating vulnerability intelligence (like the CISA KEV catalog) with network traffic, security teams can create targeted, temporary alerts to watch for probes against a newly vulnerable service from unknown sources.
","Zeek conn.log; Network sensors monitoring internet-facing services (web, email, VPN); SIEM platform for time-series analysis and correlation with vulnerability intelligence.",Last 90 days,": WHEN new_vuln for 'service_port' is announced
ALERT on connection to 'service_port' 
WHERE source_ip was not seen in previous 30 days;
",playbooks/attack/enterprise/T1588.006.yml
T1588.006: Vulnerabilities,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,11,"Has any critical internet-facing service experienced a sudden, statistically significant spike in the number of unique source IPs attempting to connect, suggesting a distributed scanning event?","This question helps detect distributed scanning, where an adversary uses many different source IPs to evade simple IP-based blocking. By monitoring the time series of unique source IPs connecting to a specific port, a sudden spike that exceeds a statistical threshold (e.g., a 4-sigma event) can indicate a coordinated, large-scale reconnaissance effort.
","Zeek conn.log; Network sensors monitoring internet-facing services (web, email, VPN); SIEM platform for time-series analysis and correlation with vulnerability intelligence.",Last 90 days,": FOR each critical_port, create time_series of unique_source_ip_count per hour
CALCULATE 24h_moving_avg and 24h_std_dev
ALERT when current_hour_count > (moving_avg + 4 * std_dev);
",playbooks/attack/enterprise/T1588.006.yml
T1588.006: Vulnerabilities,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,12,"Does the observed traffic volume (in unique source IPs) for a critical service port significantly deviate from what a time-series forecasting model predicted, indicating an anomalous event possibly tied to mass exploitation?","This question uses more sophisticated time-series modeling (like ARIMA or Prophet) to predict expected traffic volumes, accounting for seasonality (e.g., time of day, day of week). An alert is generated when the actual traffic significantly exceeds the model's forecast, providing a high-fidelity signal of an anomalous event that simple statistical methods might miss.
","Zeek conn.log; Network sensors monitoring internet-facing services (web, email, VPN); SIEM platform for time-series analysis and correlation with vulnerability intelligence.",Last 90 days,": TRAIN time_series_model on historical unique_ip_counts for critical_port
FORECAST expected_count for current hour
ALERT if observed_count is significantly outside forecast_confidence_interval;
",playbooks/attack/enterprise/T1588.006.yml
T1588.006: Vulnerabilities,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,13,"Has a known network scanning tool been executed on a non-administrative host, or has PowerShell been used for network reconnaissance cmdlets?","This question shifts focus from the network perimeter to internal activity, aiming to detect post-compromise reconnaissance. It looks for the execution of common scanning tools (nmap, masscan) or the use of built-in tools like PowerShell for network discovery on endpoints where such activity is not authorized, such as standard user workstations.
",Windows Event ID 4688; Windows PowerShell Event ID 4104; Zeek conn.log; Endpoint Detection and Response (EDR) agents on workstations and servers; Network sensors monitoring internal (east-west) traffic segments; Domain Controllers.,Last 90 days,": ALERT on process_creation_event (EID 4688)
WHERE process_name IN ('nmap.exe', 'masscan.exe')
AND host NOT IN security_asset_group;
",playbooks/attack/enterprise/T1588.006.yml
T1588.006: Vulnerabilities,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,14,Has any internal host suddenly started contacting a number of unique internal destination IPs or ports that is statistically anomalous compared to its own established baseline behavior?,"This question establishes a behavioral baseline for each individual host on the internal network. It then looks for deviations from this norm, such as a workstation that normally contacts 5 other hosts per day suddenly contacting 50. This self-adaptive statistical method can effectively detect internal scanning activity without needing predefined tool signatures.
",Windows Event ID 4688; Windows PowerShell Event ID 4104; Zeek conn.log; Endpoint Detection and Response (EDR) agents on workstations and servers; Network sensors monitoring internal (east-west) traffic segments; Domain Controllers.,Last 90 days,": FOR each internal_host, establish baseline of unique_dest_ips_per_hour using IQR
CALCULATE upper_fence = Q3 + 1.5 * IQR
ALERT if current_hour_count > upper_fence;
",playbooks/attack/enterprise/T1588.006.yml
T1588.006: Vulnerabilities,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0042: Resource Development,n; o; n; e,15,"Are we observing the creation of rare or unusual communication pathways on the internal network graph, such as a workstation connecting to a sensitive server port it has never contacted before?","This question models the entire internal network as a graph of communications. By applying graph-based anomaly detection, it can identify when new, unusual connections (edges) appear that violate the established communication patterns. For example, a connection from a marketing laptop to a database administration port would be a high-rarity, suspicious event.
",Windows Event ID 4688; Windows PowerShell Event ID 4104; Zeek conn.log; Endpoint Detection and Response (EDR) agents on workstations and servers; Network sensors monitoring internal (east-west) traffic segments; Domain Controllers.,Last 90 days,": MODEL internal network as a host communication graph
FOR each new connection (edge)
CALCULATE rarity_score based on historical graph
ALERT if rarity_score is high;",playbooks/attack/enterprise/T1588.006.yml
T1589.002: Email Addresses,a7b1c2d3-e4f5-4a6b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,1,Are any external IP addresses connecting to our public services also listed on high-confidence threat intelligence feeds as malicious?,"This question aims to identify connections from known malicious actors, such as documented C2 servers, scanners, or anonymizing services like TOR exit nodes. A match provides a high-fidelity indicator that the activity is not benign and requires immediate investigation, as it could be the precursor to an attack.","Zeek conn.log; Zeek http.log; Threat Intelligence Feed; Internet gateway; network DMZ; public-facing web servers; external-facing authentication services (e.g., M365, VPN concentrators)",last 90 days,: SEARCH Zeek conn.log WHERE source_ip IN (high_confidence_threat_feed) AND is_external(source_ip) | ALERT,playbooks/attack/enterprise/T1589.002.yml
T1589.002: Email Addresses,a7b1c2d3-e4f5-4a6b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,2,Are any external IP addresses from lower-confidence threat feeds connecting to our services at a rate that is statistically anomalous compared to normal traffic?,"This question helps detect suspicious activity from sources that are not confirmed as malicious but are associated with higher-risk services like generic VPNs. By calculating a baseline of normal connection rates and flagging significant deviations (e.g., exceeding the 99th percentile), we can identify potential reconnaissance efforts that would otherwise be missed by simple signature-based detection.","Zeek conn.log; Zeek http.log; Threat Intelligence Feed; Internet gateway; network DMZ; public-facing web servers; external-facing authentication services (e.g., M365, VPN concentrators)",last 90 days,": SEARCH Zeek conn.log WHERE source_ip IN (low_confidence_feed) | STATS count BY source_ip, dest_port over 10m | WHERE count > percentile(all_external_traffic_to_port, 99, 24h) | ALERT",playbooks/attack/enterprise/T1589.002.yml
T1589.002: Email Addresses,a7b1c2d3-e4f5-4a6b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,3,Is the total volume of connections from known anonymizing services significantly exceeding forecasted seasonal trends?,"This question uses machine learning to establish a sophisticated baseline of expected traffic from anonymizing services, accounting for regular patterns like day-of-week or time-of-day variations. A significant spike above the model's prediction suggests a coordinated, large-scale reconnaissance campaign that might be distributed across many IPs and would be difficult to detect with per-IP statistical methods.","Zeek conn.log; Zeek http.log; Threat Intelligence Feed; Internet gateway; network DMZ; public-facing web servers; external-facing authentication services (e.g., M365, VPN concentrators)",last 90 days,: COMPARE current_connection_volume(anonymizing_services) with forecast_model(90d_history) | IF current_volume > prediction_interval(95%) THEN ALERT,playbooks/attack/enterprise/T1589.002.yml
T1589.002: Email Addresses,a7b1c2d3-e4f5-4a6b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,4,Are any HTTP requests to our web services using User-Agent strings associated with known email harvesting or reconnaissance tools?,"This question seeks to identify overt reconnaissance attempts where the adversary uses common OSINT or hacking tools. These tools often have unique User-Agent strings (e.g., 'theHarvester', 'sqlmap', 'Nmap Scripting Engine'). Detecting these signatures provides direct evidence of targeted information gathering.","Zeek http.log; Zeek weird.log; Public-facing web servers (e.g., company 'About Us' or 'Contact' pages); SharePoint sites; web application frontends",last 90 days,: SEARCH Zeek http.log WHERE user_agent MATCHES (recon_tool_regex_list) AND NOT source_ip IN (benign_scanners) | ALERT,playbooks/attack/enterprise/T1589.002.yml
T1589.002: Email Addresses,a7b1c2d3-e4f5-4a6b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,5,"Are any source IPs exhibiting signs of automated directory enumeration, characterized by a high request rate combined with low URI entropy?","This question is designed to detect automated scraping that doesn't use a known malicious User-Agent. A low Shannon entropy score in the requested URIs indicates that the client is accessing very similar, predictable paths, which is characteristic of enumeration. Combining this with a high request rate helps distinguish automated tools from normal user browsing.","Zeek http.log; Zeek weird.log; Public-facing web servers (e.g., company 'About Us' or 'Contact' pages); SharePoint sites; web application frontends",last 90 days,: CALCULATE uri_entropy and request_rate per source_ip over 5m | IF uri_entropy < 1.0 AND request_rate > 30/min THEN ALERT,playbooks/attack/enterprise/T1589.002.yml
T1589.002: Email Addresses,a7b1c2d3-e4f5-4a6b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,6,Can any HTTP requests be classified with high confidence as automated scraping based on a machine learning model of their header and URI structure?,"This question leverages a classification model to provide a more nuanced detection of automated activity. The model can learn the subtle combinations of features (headers, URI patterns, request method) that distinguish scrapers from legitimate users and benign bots (like search engine crawlers). This allows for more accurate identification of malicious scraping with fewer false positives.","Zeek http.log; Zeek weird.log; Public-facing web servers (e.g., company 'About Us' or 'Contact' pages); SharePoint sites; web application frontends",last 90 days,: SCORE each http_request with classification_model | IF score > 0.9 for 'automated' AND source_ip NOT IN (benign_crawlers) THEN ALERT,playbooks/attack/enterprise/T1589.002.yml
T1589.002: Email Addresses,a7b1c2d3-e4f5-4a6b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,7,Has any single external IP address generated a high number of failed logon attempts across multiple user accounts in a short time frame?,"This question aims to detect a classic password spraying or credential stuffing attack. An adversary, having harvested a list of potential email addresses/usernames, will try a common password against many accounts. A rule that triggers on a threshold of failures (e.g., >10) across multiple accounts (e.g., >5) from one IP is a strong indicator of this technique.",Windows Event ID 4625; Windows Event ID 4624; Zeek conn.log; Domain Controllers; Active Directory Federation Services (ADFS) servers; Remote Desktop Gateway servers; VPN concentrators; Microsoft 365 / Entra ID tenant,last 90 days,: SEARCH failed_logons (EventID 4625) | STATS distinct_count(user) by source_ip over 1m | WHERE distinct_count(user) > 5 AND event_count > 10 AND is_external(source_ip) | ALERT,playbooks/attack/enterprise/T1589.002.yml
T1589.002: Email Addresses,a7b1c2d3-e4f5-4a6b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,8,Is the ratio of failed-to-successful logon attempts from any single external IP statistically significantly higher than the established baseline?,"This question provides a more adaptive way to detect password spraying. Instead of fixed thresholds, it compares the behavior of a single IP to the normal behavior of all external traffic. An IP whose failure ratio is multiple standard deviations above the norm is highly suspect, even if the absolute number of failures is not high. This helps detect slower, more methodical attacks.",Windows Event ID 4625; Windows Event ID 4624; Zeek conn.log; Domain Controllers; Active Directory Federation Services (ADFS) servers; Remote Desktop Gateway servers; VPN concentrators; Microsoft 365 / Entra ID tenant,last 90 days,: CALCULATE failure_ratio per external_ip over 15m | COMPARE ratio to baseline_ratio(3_std_dev) | IF ratio > baseline AND involves > 3 users THEN ALERT,playbooks/attack/enterprise/T1589.002.yml
T1589.002: Email Addresses,a7b1c2d3-e4f5-4a6b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,9,Does an unsupervised machine learning model identify any anomalous clusters of authentication activity indicative of enumeration or password spraying?,"This question uses unsupervised learning to find novel or unusual attack patterns that don't fit predefined rules. By clustering authentication events based on features like source IP, number of target users, and timing between attempts, the model can automatically surface outliers that represent coordinated malicious activity without prior knowledge of the specific attack method.",Windows Event ID 4625; Windows Event ID 4624; Zeek conn.log; Domain Controllers; Active Directory Federation Services (ADFS) servers; Remote Desktop Gateway servers; VPN concentrators; Microsoft 365 / Entra ID tenant,last 90 days,": RUN IsolationForest/DBSCAN on auth_log_features (source_ip, user_count, success_rate, timing_variance) | INVESTIGATE anomalous_clusters",playbooks/attack/enterprise/T1589.002.yml
T1589.002: Email Addresses,a7b1c2d3-e4f5-4a6b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,10,Has any single external IP address requested an unusually high number of pages from employee directory or contact-related sections of our website?,"This question targets a common method of harvesting email addresses: scraping public-facing employee directories. By setting a high threshold for requests to URIs containing keywords like '/staff/', '/profile/', or '/contact/' within a short time, we can pinpoint automated scraping activity aimed at collecting personnel information.","Zeek http.log; Zeek conn.log; Zeek files.log; Public-facing websites, especially those with employee directories, contact lists, or profile pages.",last 90 days,": SEARCH http_logs WHERE uri contains ('/profile/', '/staff/', '/contact/') AND is_external(source_ip) AND NOT is_benign_crawler(user_agent) | STATS count by source_ip over 5m | WHERE count > 100 | ALERT",playbooks/attack/enterprise/T1589.002.yml
T1589.002: Email Addresses,a7b1c2d3-e4f5-4a6b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,11,"Are any external user sessions exceeding baseline thresholds for requests-per-minute and total pages viewed, while also showing signs of sequential URI traversal?","This question identifies sophisticated scrapers by looking at multiple behavioral indicators. It combines session-length anomalies (exceeding the 95th percentile for requests) with evidence of non-human navigation, such as systematically traversing URIs with minimal changes (low Levenshtein distance). This combination creates a strong signal for automated scraping.","Zeek http.log; Zeek conn.log; Zeek files.log; Public-facing websites, especially those with employee directories, contact lists, or profile pages.",last 90 days,: FOR each external_session: IF requests_per_min > baseline_95p AND total_pages > baseline_95p AND avg_uri_levenshtein_dist < 2 THEN ALERT,playbooks/attack/enterprise/T1589.002.yml
T1589.002: Email Addresses,a7b1c2d3-e4f5-4a6b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,12,Can a session-based machine learning classifier identify any traffic sessions as malicious bots or scrapers?,"This question applies machine learning at the session level to provide a holistic assessment of a visitor's behavior. By training a model on features like request frequency, URI entropy, and timing, it can learn to distinguish between human users, benign bots, and malicious scrapers with high accuracy, enabling real-time classification and alerting.","Zeek http.log; Zeek conn.log; Zeek files.log; Public-facing websites, especially those with employee directories, contact lists, or profile pages.",last 90 days,: FOR each session: CLASSIFY session with Random_Forest_model | IF classification is 'malicious_bot' or 'scraper' THEN ALERT,playbooks/attack/enterprise/T1589.002.yml
T1589.002: Email Addresses,a7b1c2d3-e4f5-4a6b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,13,Have we observed any failed authentication attempts from an IP address that was recently flagged for reconnaissance activity?,"This question directly links reconnaissance to a subsequent attack attempt. When an IP is flagged for scraping or using recon tools, it should be considered 'tainted'. Any authentication attempt, especially a failure, from that same IP within a follow-up window (e.g., 72 hours) is highly suspicious and indicates the adversary is now acting on the gathered intelligence.",Windows Event ID 4625; Windows Event ID 4624; Zeek conn.log; HR Information System Data; Domain Controllers; ADFS servers; VPN concentrators; SIEM correlation environment,last 90 days,: IF recon_alert(source_ip): MONITOR source_ip for 72h | IF failed_logon(source_ip) in 72h window THEN ESCALATE_ALERT,playbooks/attack/enterprise/T1589.002.yml
T1589.002: Email Addresses,a7b1c2d3-e4f5-4a6b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,14,Has any specific department or user group experienced a statistically significant increase in failed logon attempts compared to their 30-day moving average?,"This question aims to detect targeted password spraying against a specific group within the organization (e.g., the Finance department). By enriching authentication logs with HR data and establishing a baseline of normal failed logons for each group, a sudden spike that exceeds several standard deviations from the average points to a focused attack, likely resulting from successful reconnaissance.",Windows Event ID 4625; Windows Event ID 4624; Zeek conn.log; HR Information System Data; Domain Controllers; ADFS servers; VPN concentrators; SIEM correlation environment,last 90 days,: GROUP users by department | FOR each department: CALCULATE 30d_moving_avg(failed_logons) | IF current_failed_logons(1h) > moving_avg + 3_std_dev THEN ALERT,playbooks/attack/enterprise/T1589.002.yml
T1589.002: Email Addresses,a7b1c2d3-e4f5-4a6b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,15,Has a graph-based clustering algorithm detected a dense community of failed authentications linking one or more source IPs to a specific group of internal users?,"This question uses advanced analytics to visualize and detect targeted attacks. By modeling authentication attempts as a graph, we can apply community detection algorithms to find unusually dense clusters of activity. Discovering a cluster where a few external IPs are connected to many internal users—who are later confirmed to be from the same department via HR data—provides powerful evidence of a targeted campaign.",Windows Event ID 4625; Windows Event ID 4624; Zeek conn.log; HR Information System Data; Domain Controllers; ADFS servers; VPN concentrators; SIEM correlation environment,last 90 days,": CREATE graph from auth_logs (nodes=users,ips; edges=failed_logons) | RUN Louvain_community_detection | INVESTIGATE dense clusters connecting external IPs to internal user communities",playbooks/attack/enterprise/T1589.002.yml
T1590.001: Domain Properties,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0043: Reconnaissance,n; o; n; e,1,Is a known malicious IP address querying our DNS or connecting to our services?,Threat intelligence feeds provide lists of IP addresses known for malicious activities such as scanning or command and control. Matching a source IP from our network logs (DNS and connection logs) against these feeds is a high-confidence method for detecting targeted reconnaissance early in the attack lifecycle.,Zeek dns.log; Zeek conn.log; External-facing DNS Resolvers; Network Perimeter Firewalls; Web Application Firewalls,last 90 days,pseudocode: JOIN dns_logs and conn_logs ON source_ip; COMPARE source_ip against threat_intel_feed; ALERT on match;,playbooks/attack/enterprise/T1590.001.yml
T1590.001: Domain Properties,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0043: Reconnaissance,n; o; n; e,2,Is an IP from an unusual or rare Autonomous System Number (ASN) sending an anomalous number of DNS queries to our domain?,"Adversaries often leverage infrastructure from less common hosting providers or geographic regions. By establishing a baseline of normal query volume per source ASN, we can identify significant deviations. A sudden spike in queries from a new or infrequent ASN can indicate a reconnaissance attempt that might evade simple IP-based threat lists.",Zeek dns.log; Zeek conn.log; External-facing DNS Resolvers; Network Perimeter Firewalls; Web Application Firewalls,last 90 days,"pseudocode: FOR each source_ip, get ASN; CALCULATE historical query_count_per_ASN; ESTABLISH baseline (95th percentile); ALERT if new/rare ASN source_ip exceeds baseline in 1-hour window;",playbooks/attack/enterprise/T1590.001.yml
T1590.001: Domain Properties,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0043: Reconnaissance,n; o; n; e,3,Can we use a machine learning model to classify source IPs as malicious based on their DNS and connection behavior?,"This question explores a predictive approach beyond static rules. A supervised classification model, such as a Random Forest, can learn complex patterns from historical data. By engineering features like source ASN, country, time of day, and connection/query frequency, the model can classify new, unseen source IPs and alert on those predicted to be malicious, thus catching novel threats.",Zeek dns.log; Zeek conn.log; External-facing DNS Resolvers; Network Perimeter Firewalls; Web Application Firewalls,last 90 days,"pseudocode: TRAIN Random Forest model on labeled (benign/malicious) IP data with features (ASN, country, conn_count, dns_count); APPLY model to new IPs in real-time; ALERT on malicious classification;",playbooks/attack/enterprise/T1590.001.yml
T1590.001: Domain Properties,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0043: Reconnaissance,n; o; n; e,4,Are we seeing HTTP/S requests with User-Agents or URIs that match signatures of known domain reconnaissance tools?,"Automated reconnaissance tools like 'ffuf', 'gobuster', and 'sublist3r' often leave distinct fingerprints in the User-Agent string or the requested URI. This question aims to detect the active use of these tools by applying a list of regular expressions for known tool signatures against web traffic logs.",Zeek http.log; Public-facing Web Servers; Cloud API Gateways; Reverse Proxies,last 90 days,pseudocode: SEARCH http_logs for user_agent OR uri matching regex_list_of_recon_tools; ALERT on match;,playbooks/attack/enterprise/T1590.001.yml
T1590.001: Domain Properties,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0043: Reconnaissance,n; o; n; e,5,"Is any external source IP requesting web resources with an unusually high level of randomness, suggesting automated enumeration?","When an adversary uses a tool to brute-force directory names or subdomains, the sequence of requested URIs appears more random than normal user browsing. Calculating the Shannon entropy of URIs requested by a single source IP can quantify this randomness. A spike in entropy above the established baseline is a strong indicator of automated enumeration.",Zeek http.log; Public-facing Web Servers; Cloud API Gateways; Reverse Proxies,last 90 days,"pseudocode: FOR each source_ip, CALCULATE Shannon entropy of requested URIs in 5-min window; ESTABLISH baseline entropy; ALERT if entropy exceeds 99th percentile of baseline;",playbooks/attack/enterprise/T1590.001.yml
T1590.001: Domain Properties,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0043: Reconnaissance,n; o; n; e,6,Can a machine learning model distinguish malicious reconnaissance tool User-Agents from legitimate browsers and benign bots?,"This question proposes using a deep learning model, like a character-level Convolutional Neural Network (CNN), to analyze the structure of User-Agent strings. This approach can be more resilient than static signature matching, as it can identify new or modified tools that share structural similarities with known malicious User-Agents but do not match existing patterns.",Zeek http.log; Public-facing Web Servers; Cloud API Gateways; Reverse Proxies,last 90 days,"pseudocode: TRAIN character-level CNN on user_agent strings to classify (legitimate, benign_bot, malicious); APPLY model to new http_logs; ALERT on malicious classification;",playbooks/attack/enterprise/T1590.001.yml
T1590.001: Domain Properties,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0043: Reconnaissance,n; o; n; e,7,Is a network utility like nslookup or whois being executed by an unusual process or user account on an internal host?,"Legitimate use of network utilities like 'nslookup.exe' is typically interactive, launched from a command prompt by an administrator. When these tools are spawned by a non-standard parent process (e.g., a web service) or run under a service account, it is highly suspicious and could indicate an adversary performing internal reconnaissance after gaining an initial foothold.",Windows Event ID 4688; Domain Controllers; Endpoint Workstations; Member Servers; Privileged Access Workstations,last 90 days,"pseudocode: SEARCH process_creation_events (EID 4688) for process_name IN (nslookup.exe, whois.exe, Resolve-DnsName); ALERT if parent_process NOT IN (explorer.exe, cmd.exe, powershell.exe) OR if user is a service_account;",playbooks/attack/enterprise/T1590.001.yml
T1590.001: Domain Properties,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0043: Reconnaissance,n; o; n; e,8,Is any user or host executing an abnormally high number of network utility commands?,"While a single execution of 'nslookup' is normal, a sudden burst of these commands from one user or host is not. By baselining the normal frequency of these commands per user and per host, we can detect anomalous spikes that suggest an adversary is systematically enumerating internal or external resources.",Windows Event ID 4688; Domain Controllers; Endpoint Workstations; Member Servers; Privileged Access Workstations,last 90 days,"pseudocode: FOR each host/user, ESTABLISH baseline frequency of network utility executions; ALERT if daily count > (mean + 3 * std_dev) OR if command-line arguments show unusual domain variety;",playbooks/attack/enterprise/T1590.001.yml
T1590.001: Domain Properties,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0043: Reconnaissance,n; o; n; e,9,Can we use unsupervised clustering to find anomalous process executions related to network reconnaissance?,"This question uses an unsupervised machine learning approach (e.g., DBSCAN) to group all process execution events into clusters of 'normal' behavior. Processes that do not fit into these clusters are flagged as outliers. This is effective for finding novel or stealthy techniques that don't match predefined rules, by identifying activity that is simply 'different' from the norm.",Windows Event ID 4688; Domain Controllers; Endpoint Workstations; Member Servers; Privileged Access Workstations,last 90 days,"pseudocode: CLUSTER process_execution_events using DBSCAN on features (process_name, cmd_line_entropy, parent_process, session_type); INVESTIGATE outlier clusters;",playbooks/attack/enterprise/T1590.001.yml
T1590.001: Domain Properties,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0043: Reconnaissance,n; o; n; e,10,Is an external IP address generating a high volume of DNS queries for non-existent subdomains?,"A common technique for subdomain enumeration is to brute-force a list of potential names, which results in many DNS queries that receive an NXDOMAIN (non-existent domain) response. A simple rule that counts the number of NXDOMAIN responses from a single source IP in a short time frame can effectively detect this activity.",Zeek dns.log; External-facing DNS Resolvers; Internal Recursive DNS Servers that log queries,last 90 days,"pseudocode: FOR each external_source_ip, COUNT DNS queries with NXDOMAIN response in 1 minute; ALERT if count > 50;",playbooks/attack/enterprise/T1590.001.yml
T1590.001: Domain Properties,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0043: Reconnaissance,n; o; n; e,11,Is an external IP showing both a high ratio of NXDOMAIN responses and high randomness in the subdomains being queried?,"This question improves upon simple NXDOMAIN counting by adding a second condition: high entropy in the queried subdomain names. The combination of a high failure rate (NXDOMAIN ratio) and high randomness (entropy) is a stronger indicator of automated brute-force enumeration, helping to filter out benign misconfigurations.",Zeek dns.log; External-facing DNS Resolvers; Internal Recursive DNS Servers that log queries,last 90 days,"pseudocode: FOR each external_source_ip in 5-min window, CALCULATE (NXDOMAIN_ratio, subdomain_entropy); ALERT if NXDOMAIN_ratio > 98th_percentile_baseline AND subdomain_entropy is high;",playbooks/attack/enterprise/T1590.001.yml
T1590.001: Domain Properties,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0043: Reconnaissance,n; o; n; e,12,Can a time-series model detect anomalies in the volume and rate of NXDOMAIN responses from external sources?,"This question proposes using a sophisticated time-series model (e.g., ARIMA or LSTM) to forecast the 'normal' rate of DNS queries and NXDOMAIN responses, learning daily and weekly patterns. When a sudden, unexpected spike occurs that deviates significantly from the forecast (a high residual error), it signals an anomaly that could be a reconnaissance scan.",Zeek dns.log; External-facing DNS Resolvers; Internal Recursive DNS Servers that log queries,last 90 days,"pseudocode: TRAIN time-series model (e.g., LSTM) on DNS query volume and NXDOMAIN rate; MONITOR forecast error (residual) in real-time; ALERT on significant spikes in error for a specific source IP;",playbooks/attack/enterprise/T1590.001.yml
T1590.001: Domain Properties,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0043: Reconnaissance,n; o; n; e,13,Is Zeek's built-in portscan detector identifying scans from external IPs?,"This question leverages an existing capability within Zeek, which has a built-in script that detects port scanning behavior and logs it to 'portscan.log'. While potentially noisy, it provides a simple, immediate alert for basic scanning activity originating from the internet and requires minimal configuration.",Zeek conn.log; Network Perimeter Firewalls; Demilitarized Zone (DMZ) segments; Public-facing Application Servers,last 90 days,pseudocode: MONITOR Zeek portscan.log; ALERT on any entry where scanner is an external IP;,playbooks/attack/enterprise/T1590.001.yml
T1590.001: Domain Properties,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0043: Reconnaissance,n; o; n; e,14,Is any external IP connecting to an unusually high number of distinct internal hosts or ports?,"Adversaries perform network sweeps to identify live hosts (horizontal scanning) and service scans to find open ports on a host (vertical scanning). This question aims to detect this by counting the unique destination IPs and ports contacted by a single source IP in a short window and alerting when this count exceeds a dynamic, rolling baseline.",Zeek conn.log; Network Perimeter Firewalls; Demilitarized Zone (DMZ) segments; Public-facing Application Servers,last 90 days,"pseudocode: FROM conn_logs, GROUP BY source_ip in 5-min window; COUNT distinct dest_hosts and distinct dest_ports; ALERT if count > 99.5th percentile of 7-day baseline;",playbooks/attack/enterprise/T1590.001.yml
T1590.001: Domain Properties,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0043: Reconnaissance,n; o; n; e,15,Can we use unsupervised clustering to identify external IP addresses that are exhibiting scanning behavior?,"This question uses a clustering model like K-Means to group network traffic based on connection patterns. Features such as the count of distinct hosts/ports contacted, the ratio of SYN packets, and average connection duration can effectively separate normal traffic from scanning activity. The model can identify and alert on clusters whose characteristics match scanning behavior without predefined rules.",Zeek conn.log; Network Perimeter Firewalls; Demilitarized Zone (DMZ) segments; Public-facing Application Servers,last 90 days,"pseudocode: CLUSTER aggregated conn_data per source_ip using K-Means on features (distinct_dest_IPs, distinct_dest_ports, SYN_ratio, avg_duration); IDENTIFY and ALERT on clusters representing scanning behavior;",playbooks/attack/enterprise/T1590.001.yml
T1591.002: Business Relationships,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,1,"Have any internal hosts initiated outbound network connections or DNS queries to external destinations matching a threat intelligence feed of known reconnaissance infrastructure, malicious proxies, or domains associated with supply chain attacks?","This question aims to detect direct communication from within the network to adversary-controlled infrastructure. A match against a high-confidence threat intelligence feed is a strong indicator that an internal host may be compromised or an insider is using malicious tools for reconnaissance, specifically targeting information about business partners to facilitate a supply chain attack.",Zeek conn.log; Zeek dns.log; Internet gateway/egress points; DNS resolvers; Network Security Monitoring (NSM) sensor grid,last 90 days,: ,playbooks/attack/enterprise/T1591.002.yml
T1591.002: Business Relationships,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,2,Are there any DNS queries for domains that are visually similar (typosquatted) to the domains of our legitimate business partners?,"Adversaries often register domains that closely resemble legitimate ones to trick users or systems in phishing or man-in-the-middle attacks. This technique, known as typosquatting, can be an early indicator of reconnaissance for a targeted attack against a business partner. Identifying these queries helps uncover potential staging for such attacks before they are launched.",Zeek dns.log; Internet gateway/egress points; DNS resolvers; Network Security Monitoring (NSM) sensor grid,last 90 days,: ,playbooks/attack/enterprise/T1591.002.yml
T1591.002: Business Relationships,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,3,"Can we identify potentially malicious domains being queried by internal hosts, which are not on any known threat feed, using a machine learning model that analyzes domain characteristics?","Sophisticated adversaries may use newly registered domains (NRDs) or algorithmically generated domains (DGAs) that won't appear on standard threat feeds immediately. A machine learning model can proactively identify suspicious domains based on features like high entropy, unusual length, recent registration date, or association with a non-reputable ASN, providing an early warning of potential C2 or reconnaissance activity.",Zeek dns.log; Internet gateway/egress points; DNS resolvers; Network Security Monitoring (NSM) sensor grid,last 90 days,: ,playbooks/attack/enterprise/T1591.002.yml
T1591.002: Business Relationships,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,4,"Has any external source attempted a DNS zone transfer or used known scraping tools/libraries to access our public-facing websites, particularly pages listing business partners?","DNS zone transfer requests (`AXFR`) are a classic reconnaissance technique to map out an organization's DNS infrastructure. Similarly, user-agent strings associated with automated tools like 'Scrapy' or 'Wget' can indicate that an adversary is programmatically collecting information from public sites, such as lists of partners or clients, to build a target profile.",Zeek dns.log; Zeek http.log; Public-facing web servers; DMZ network segments; Reverse proxy servers,last 90 days,: ,playbooks/attack/enterprise/T1591.002.yml
T1591.002: Business Relationships,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,5,"Is any single external IP address sending an unusually high volume of requests to our public web pages, especially those containing partner or supply chain information?","Automated scraping by an adversary often manifests as a high rate of requests from a single source, far exceeding normal user browsing behavior. By establishing a baseline for normal traffic patterns and detecting statistical outliers (e.g., exceeding the 99th percentile), we can identify potential reconnaissance activity that uses custom scripts without common scraping tool user-agents.",Zeek http.log; Public-facing web servers; DMZ network segments; Reverse proxy servers,last 90 days,: ,playbooks/attack/enterprise/T1591.002.yml
T1591.002: Business Relationships,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,6,"Has the overall traffic volume to key partner-related web pages experienced a sudden spike that is inconsistent with historical seasonal patterns, as predicted by a time-series forecasting model?","While statistical methods can detect single-source anomalies, a distributed scraping attack might not trigger those alerts. A time-series model (like SARIMA or Prophet) learns the natural rhythm (e.g., daily, weekly cycles) of traffic to a specific page. A significant deviation from the model's forecast suggests an anomalous event, like a coordinated scraping campaign, even if the traffic comes from many different IPs.",Zeek http.log; Public-facing web servers; DMZ network segments; Reverse proxy servers,last 90 days,: ,playbooks/attack/enterprise/T1591.002.yml
T1591.002: Business Relationships,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,7,"Has there been any connection attempt to a partner-exclusive service (e.g., VPN, extranet portal) from an IP address that is not on the authorized partner allow-list?","Services designated for business partners should only be accessible from their known, pre-approved IP ranges. Any connection attempt from an unauthorized source is a direct violation of this policy and a strong indicator of targeted reconnaissance or an initial access attempt. This is a high-fidelity, rule-based check for unauthorized activity.",Zeek conn.log; Zeek weird.log; Partner extranet servers; VPN concentrators; B2B API gateways; DMZ firewalls,last 90 days,: ,playbooks/attack/enterprise/T1591.002.yml
T1591.002: Business Relationships,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,8,"Has any single, unauthorized external IP address generated a statistically significant number of failed connection attempts to our partner-facing services?","A large number of failed connections (e.g., TCP SYN packets with no response, or TCP resets) from a single IP to a specific service is a classic sign of a port scan or enumeration. An attacker may be probing the service to see if it is online and what version it is running. Calculating the Z-score helps to statistically validate that the observed activity is a significant anomaly compared to normal background noise.",Zeek conn.log; Partner extranet servers; VPN concentrators; B2B API gateways; DMZ firewalls,last 90 days,: ,playbooks/attack/enterprise/T1591.002.yml
T1591.002: Business Relationships,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,9,"Are there any connections from unknown IP addresses to partner services that exhibit characteristics different from the typical, legitimate connections made by our known partners?","Legitimate partner connections often have consistent patterns in terms of duration, data volume, and packet counts. A one-class SVM can be trained on these legitimate patterns to create a model of ""normal."" When a connection from an unknown source is observed, the model can determine if it fits this normal profile. If not, it's flagged as an anomaly, potentially indicating a scan or an attack attempt that uses different parameters than legitimate clients.",Zeek conn.log; Partner extranet servers; VPN concentrators; B2B API gateways; DMZ firewalls,last 90 days,: ,playbooks/attack/enterprise/T1591.002.yml
T1591.002: Business Relationships,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,10,Has a connection originating from a known business partner's IP range attempted to access an internal host or service that is outside of their explicitly allowed scope?,"A compromised partner network can be used as a pivot point to attack your organization. This question checks for lateral movement or unauthorized access attempts originating from a supposedly trusted source. By defining and enforcing strict access rules (e.g., Partner A can only access Server X on Port Y), any deviation immediately flags a potential compromise of the partner's environment.",Zeek conn.log; Zeek files.log; Internal network segments; Data center core; Application servers; Internal firewall logs,last 90 days,: ,playbooks/attack/enterprise/T1591.002.yml
T1591.002: Business Relationships,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,11,Is the total volume of data transferred to or from a business partner's network a statistical outlier compared to their historical daily baseline?,"A sudden, unusually large data transfer from a partner network could indicate data exfiltration from your environment through a compromised partner connection, or an attacker staging tools into your network. Using the IQR method to detect outliers provides a robust way to identify anomalous transfer volumes that deviate significantly from established norms for that specific partner.",Zeek conn.log; Zeek files.log; Internal network segments; Data center core; Application servers; Internal firewall logs,last 90 days,: ,playbooks/attack/enterprise/T1591.002.yml
T1591.002: Business Relationships,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,12,"Has a connection occurred between a known partner IP and an internal system that they do not normally communicate with, based on a graph-based community detection model?","Viewing your network as a graph of interconnected systems can reveal normal communication patterns or ""communities"" (e.g., Partner A's devices only talk to the Partner A extranet). A graph-based anomaly detection algorithm can learn these communities. An alert is triggered when a new connection (an edge) forms a ""bridge"" between two previously disconnected communities, such as a partner's IP connecting directly to a server in the HR department's network segment, indicating highly suspicious lateral movement.",Zeek conn.log; Zeek files.log; Internal network segments; Data center core; Application servers; Internal firewall logs,last 90 days,: ,playbooks/attack/enterprise/T1591.002.yml
T1591.002: Business Relationships,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,13,"Has any user account accessed an unusually large number of files from sensitive partner-related repositories within a short period, exceeding a predefined threshold?","This is a simple but effective method to detect ""smash and grab"" data theft. An adversary who has compromised a user account may attempt to quickly access and exfiltrate as much data as possible. A rule that alerts on a high volume of file access events (Windows Event ID 4663) in a short time frame from critical locations can catch this bulk reconnaissance or collection behavior.",Windows Event ID 4663; Windows Event ID 4624; Active Directory Logs; File servers hosting partner data; SharePoint sites for vendor management; Active Directory domain controllers,last 90 days,: ,playbooks/attack/enterprise/T1591.002.yml
T1591.002: Business Relationships,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,14,Has a user's file access activity on partner-related data repositories deviated significantly from their own historical behavior or the typical behavior of their peer group?,"This dual-pronged approach is more nuanced than a fixed threshold. First, it detects when a user behaves abnormally compared to their own past activity (intra-user anomaly). Second, it detects when a user's behavior is abnormal compared to their colleagues with similar roles (inter-user/peer group anomaly). This can catch both a compromised account acting out of character and an insider whose activity, while consistent for them, is suspicious for their role.",Windows Event ID 4663; Windows Event ID 4624; Active Directory Logs; File servers hosting partner data; SharePoint sites for vendor management; Active Directory domain controllers,last 90 days,: ,playbooks/attack/enterprise/T1591.002.yml
T1591.002: Business Relationships,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,15,"Does a user's overall behavior, including file access, login patterns, and process execution, show a multi-faceted deviation from their established normal profile, as determined by a UEBA model?","The most sophisticated attacks involve subtle changes across multiple vectors. A UEBA system creates a holistic, high-dimensional baseline of normal behavior for each user. It can correlate low-level, otherwise non-alerting events (e.g., logging in at an odd time, accessing a slightly unusual file, running a new PowerShell command) to identify a complex attack pattern that would be missed by single-metric statistical or rule-based methods.",Windows Event ID 4663; Windows Event ID 4624; Active Directory Logs; File servers hosting partner data; SharePoint sites for vendor management; Active Directory domain controllers,last 90 days,: ,playbooks/attack/enterprise/T1591.002.yml
T1591.003: Identify Business Tempo,f5d8a9e6-7b2c-4e8d-9f1a-0c3b5a6e7d8f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,1,Are there any network connections originating from or destined for infrastructure known to be associated with reconnaissance tools or services?,"This question aims to identify direct communication with known malicious infrastructure. By matching network logs (IPs, domains, JA3/JA3S hashes) against threat intelligence feeds, we can detect initial reconnaissance probes from adversaries using established tools. A match provides a high-confidence signal of targeted reconnaissance activity.
",Zeek conn.log; Zeek dns.log; Zeek ssl.log; Perimeter firewalls; forward/reverse proxies; public-facing DNS servers; external-facing web application firewalls (WAFs),last 90 days,pseudocode: SEARCH network_logs WHERE (source_ip IN threat_intel_feed OR dest_ip IN threat_intel_feed OR domain IN threat_intel_feed OR ja3_hash IN threat_intel_feed),playbooks/attack/enterprise/T1591.003.yml
T1591.003: Identify Business Tempo,f5d8a9e6-7b2c-4e8d-9f1a-0c3b5a6e7d8f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,2,"Are any external IP addresses, previously flagged by threat intelligence, exhibiting low-and-slow connection patterns indicative of stealthy reconnaissance?","Adversaries often use low-volume, persistent connections to avoid detection. This question focuses on identifying such 'low-and-slow' behavior from IPs already considered suspicious. By analyzing connection volume over several days, we can distinguish between normal traffic and methodical, automated probing that might otherwise be missed.
",Zeek conn.log; Zeek dns.log; Zeek ssl.log; Perimeter firewalls; forward/reverse proxies; public-facing DNS servers; external-facing web application firewalls (WAFs),last 90 days,pseudocode: FOR ip IN flagged_ips | CALCULATE connection_count over 7 days | IF connection_count < 10th_percentile AND connection_persists > 3 days | ALERT,playbooks/attack/enterprise/T1591.003.yml
T1591.003: Identify Business Tempo,f5d8a9e6-7b2c-4e8d-9f1a-0c3b5a6e7d8f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,3,Can we use machine learning to predict whether an inbound connection is part of a malicious reconnaissance campaign?,"This question leverages machine learning to proactively score and classify inbound connections. By training a model on features like connection duration, data volume, protocol, and threat intelligence hits, we can identify subtle patterns of malicious reconnaissance that are difficult to define with simple rules or statistics. This provides a probabilistic assessment of risk for new connections.
",Zeek conn.log; Zeek dns.log; Zeek ssl.log; Perimeter firewalls; forward/reverse proxies; public-facing DNS servers; external-facing web application firewalls (WAFs),last 90 days,"pseudocode: PREDICT connection_is_reconnaissance USING Random_Forest_Model(connection_duration, bytes_transferred, protocol, threat_intel_match)",playbooks/attack/enterprise/T1591.003.yml
T1591.003: Identify Business Tempo,f5d8a9e6-7b2c-4e8d-9f1a-0c3b5a6e7d8f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,4,Is any external IP repeatedly connecting to our authentication services without ever attempting to log in?,"This question aims to detect reconnaissance activity targeting authentication portals (like VPN or OWA). An adversary may probe these services to check for their existence and availability before launching an attack. A pattern of connections without corresponding login attempts (successful or failed) is a strong indicator of this pre-attack discovery phase.
",Zeek conn.log; Zeek http.log; Windows Event ID 4625; Windows Event ID 4624; VPN concentrators; Outlook Web Access (OWA) portals; single sign-on (SSO) platforms; other external-facing authentication gateways,last 90 days,pseudocode: SEARCH network_logs for connections to auth_services | GROUP BY source_ip | JOIN with auth_logs on source_ip | IF connection_count > 20 over 14 days AND login_attempts == 0 | ALERT,playbooks/attack/enterprise/T1591.003.yml
T1591.003: Identify Business Tempo,f5d8a9e6-7b2c-4e8d-9f1a-0c3b5a6e7d8f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,5,"Are there any source IPs connecting to authentication services with an unusually regular, automated rhythm?","Automated reconnaissance tools often make connections at fixed intervals. This question seeks to identify such automation by analyzing the time between connections (inter-arrival time). A very low standard deviation in these times suggests a machine-generated pattern, not human behavior, pointing to systematic probing of our authentication infrastructure.
",Zeek conn.log; Zeek http.log; Windows Event ID 4625; Windows Event ID 4624; VPN concentrators; Outlook Web Access (OWA) portals; single sign-on (SSO) platforms; other external-facing authentication gateways,last 90 days,pseudocode: FOR ip in auth_service_connections | CALCULATE inter_arrival_time_std_dev over 30 days | IF std_dev < 5th_percentile | ALERT,playbooks/attack/enterprise/T1591.003.yml
T1591.003: Identify Business Tempo,f5d8a9e6-7b2c-4e8d-9f1a-0c3b5a6e7d8f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,6,Can we detect anomalous connection patterns to our high-value authentication services that deviate from established normal behavior?,"This question uses time-series analysis to model the normal rhythm of connection activity for critical authentication services, accounting for time of day and day of week. The model can then detect anomalous deviations, such as a low, persistent stream of connections from an unknown source, which might represent a stealthy adversary trying to map out the attack surface.
",Zeek conn.log; Zeek http.log; Windows Event ID 4625; Windows Event ID 4624; VPN concentrators; Outlook Web Access (OWA) portals; single sign-on (SSO) platforms; other external-facing authentication gateways,last 90 days,pseudocode: PREDICT anomaly in connection_volume_time_series USING LSTM_Autoencoder_Model(connection_events),playbooks/attack/enterprise/T1591.003.yml
T1591.003: Identify Business Tempo,f5d8a9e6-7b2c-4e8d-9f1a-0c3b5a6e7d8f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,7,Is any external IP address scanning a wide variety of ports over a long period without sending significant traffic?,"This question is designed to detect slow, horizontal scanning. Adversaries use this technique to discover open ports and running services across an organization's IP range without triggering high-volume alerts. Identifying IPs that touch many ports but transfer minimal data helps uncover this stealthy form of network mapping.
",Zeek conn.log; Zeek dns.log; Zeek http.log; Network DMZ; public cloud subnets (VPCs/VNETs); public-facing application servers; external DNS servers,last 90 days,pseudocode: FOR ip in external_ips | IF unique_ports_contacted > 10 in 30 days AND total_traffic_per_port < 1KB AND ip NOT in allowlist | ALERT,playbooks/attack/enterprise/T1591.003.yml
T1591.003: Identify Business Tempo,f5d8a9e6-7b2c-4e8d-9f1a-0c3b5a6e7d8f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,8,Are any external IPs exhibiting a high degree of port scanning randomness combined with a low total connection count?,"This question uses information theory (Shannon entropy) to quantify the randomness of ports being scanned. A legitimate service typically communicates on a few predictable ports, resulting in low entropy. A scanner exploring a wide, random range of ports will have high entropy. By combining high port entropy with a low overall connection count, we can specifically target stealthy scanners and differentiate them from both normal traffic and noisy, high-volume scanners.
",Zeek conn.log; Zeek dns.log; Zeek http.log; Network DMZ; public cloud subnets (VPCs/VNETs); public-facing application servers; external DNS servers,last 90 days,pseudocode: FOR ip in external_ips over 30 days | CALCULATE port_entropy and total_connections | IF port_entropy > 98th_percentile AND total_connections < 25th_percentile | ALERT,playbooks/attack/enterprise/T1591.003.yml
T1591.003: Identify Business Tempo,f5d8a9e6-7b2c-4e8d-9f1a-0c3b5a6e7d8f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,9,Can we use clustering to identify outlier IPs whose connection behavior does not match any known profile of normal user or internet scanner activity?,"This question applies unsupervised machine learning to group external IPs based on their connection behaviors (e.g., connection count, port variety, data volume). IPs that do not fit into large clusters of 'normal' behavior are flagged as anomalies or noise. These outliers often represent unique, potentially malicious activity, such as targeted, low-and-slow reconnaissance that doesn't conform to typical patterns.
",Zeek conn.log; Zeek dns.log; Zeek http.log; Network DMZ; public cloud subnets (VPCs/VNETs); public-facing application servers; external DNS servers,last 90 days,"pseudocode: CLUSTER external_ips USING DBSCAN(connection_count, unique_port_count, avg_bytes) | INVESTIGATE noise_points and small_clusters",playbooks/attack/enterprise/T1591.003.yml
T1591.003: Identify Business Tempo,f5d8a9e6-7b2c-4e8d-9f1a-0c3b5a6e7d8f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,10,Has a privileged account logged in interactively during non-business hours and immediately run discovery commands?,"This question looks for a very specific, high-confidence pattern of malicious behavior: an attacker who has compromised a privileged account using it 'after hours' to perform reconnaissance. The combination of a privileged interactive logon (Type 2 or 10), non-business hours, and the immediate execution of discovery tools (`net.exe`, `whoami.exe`) strongly indicates an active adversary exploring the network.
",Windows Event ID 4624; Windows Event ID 4688; Windows Event ID 4663; Zeek conn.log; Domain Controllers; certificate authorities; critical file servers; privileged user workstations; database servers; hypervisor management consoles,last 90 days,pseudocode: SEARCH for privileged_logon (Type 2/10) during off_hours | IF followed by process_creation for discovery_tool | HIGH_SEVERITY_ALERT,playbooks/attack/enterprise/T1591.003.yml
T1591.003: Identify Business Tempo,f5d8a9e6-7b2c-4e8d-9f1a-0c3b5a6e7d8f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,11,Is a privileged user's recent activity statistically anomalous compared to their own historical baseline?,"This question aims to detect compromised accounts by establishing a 'normal' for each privileged user. By baselining typical login times, processes executed, and servers accessed, we can score new activities based on how much they deviate from this established pattern. An activity that is several standard deviations away from the user's norm (e.g., a login at 3 AM for a 9-to-5 user) generates a high risk score and warrants investigation.
",Windows Event ID 4624; Windows Event ID 4688; Windows Event ID 4663; Zeek conn.log; Domain Controllers; certificate authorities; critical file servers; privileged user workstations; database servers; hypervisor management consoles,last 90 days,"pseudocode: FOR each privileged_user_activity | CALCULATE z_score based on user's 90-day baseline for login_time, processes, etc. | IF total_risk_score > threshold | ALERT",playbooks/attack/enterprise/T1591.003.yml
T1591.003: Identify Business Tempo,f5d8a9e6-7b2c-4e8d-9f1a-0c3b5a6e7d8f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,12,Can we use machine learning to model the normal behavior of each privileged user and detect any outlier activity?,"This question applies a more sophisticated form of anomaly detection by building a dedicated behavioral model (a one-class SVM) for each privileged user. The model learns the multi-dimensional profile of the user's normal activity. Any new action that falls outside this learned 'normal' profile is flagged as an outlier for immediate review. This is particularly effective for catching novel or complex deviations that statistical methods might miss.
",Windows Event ID 4624; Windows Event ID 4688; Windows Event ID 4663; Zeek conn.log; Domain Controllers; certificate authorities; critical file servers; privileged user workstations; database servers; hypervisor management consoles,last 90 days,pseudocode: PREDICT activity_is_outlier USING One_Class_SVM_Model(activity_features) for each privileged_user,playbooks/attack/enterprise/T1591.003.yml
T1591.003: Identify Business Tempo,f5d8a9e6-7b2c-4e8d-9f1a-0c3b5a6e7d8f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,13,Has a new scheduled task or service been created that is set to run during non-business hours and executes a suspicious or obfuscated command?,"Adversaries often create scheduled tasks to establish persistence or execute payloads during off-hours to avoid detection. This question targets this technique by looking for the combination of a non-business hours trigger and a suspicious action, such as an obfuscated PowerShell command or a script interpreter. This combination is a strong indicator of malicious intent.
",Windows Event ID 4698; Windows Event ID 4702; Microsoft-Windows-TaskScheduler/Operational Event ID 106; Windows Event ID 4688; Windows Event ID 4697; All Windows endpoints and servers; particularly Domain Controllers; application servers; administrator workstations,last 90 days,"pseudocode: SEARCH for new_task or new_service | IF trigger is off_hours AND command contains (powershell -enc, cscript, non-standard path) | ALERT",playbooks/attack/enterprise/T1591.003.yml
T1591.003: Identify Business Tempo,f5d8a9e6-7b2c-4e8d-9f1a-0c3b5a6e7d8f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,14,"Is the rate of scheduled task creation on a host abnormally high, or is the command line of a new task unusually complex?","This question uses statistics to find anomalies in persistence mechanisms. First, it flags hosts where tasks are being created more frequently than normal, which could indicate an automated malware dropper. Second, it measures the complexity (entropy) of the command line. A command with unusually high entropy often contains obfuscated or randomized code, a common tactic for hiding malicious payloads.
",Windows Event ID 4698; Windows Event ID 4702; Microsoft-Windows-TaskScheduler/Operational Event ID 106; Windows Event ID 4688; Windows Event ID 4697; All Windows endpoints and servers; particularly Domain Controllers; application servers; administrator workstations,last 90 days,pseudocode: FOR each host | IF task_creation_frequency > 99th_percentile | ALERT | FOR each new_task | IF command_entropy > historical_average | ALERT,playbooks/attack/enterprise/T1591.003.yml
T1591.003: Identify Business Tempo,f5d8a9e6-7b2c-4e8d-9f1a-0c3b5a6e7d8f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,15,Can we train a machine learning model to predict whether a newly created scheduled task or service is malicious?,"This question proposes building a classifier to automatically assess the risk of new persistence mechanisms. By feeding a model features like the user context, trigger type, command line entropy, and the parent process, it can learn to distinguish between benign administrative tasks and malicious ones. This automates the analysis and helps focus analyst attention on the highest-risk events.
",Windows Event ID 4698; Windows Event ID 4702; Microsoft-Windows-TaskScheduler/Operational Event ID 106; Windows Event ID 4688; Windows Event ID 4697; All Windows endpoints and servers; particularly Domain Controllers; application servers; administrator workstations,last 90 days,"pseudocode: PREDICT task_is_malicious USING XGBoost_Model(run_as_user, trigger_type, command_entropy, parent_process)",playbooks/attack/enterprise/T1591.003.yml
T1592: Gather Victim Host Information,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,none,1,Is a known malicious IP address attempting to connect to our network?,"This question aims to identify reconnaissance activity by leveraging Cyber Threat Intelligence (CTI). By ingesting lists of known scanners or malicious actors into a watchlist, we can create a high-fidelity rule that alerts when any of these known-bad IPs attempt to establish a connection with our assets. A match provides a strong signal that an adversary is in the early stages of targeting.
",Zeek conn.log; Windows Event ID 5156; External-facing web servers; VPN concentrators; Firewall and network gateway logs; Domain controllers,last 90 days,": SEARCH network_connection_logs
WHERE source_ip IN cti_watchlist
AND direction = 'inbound'
RETURN count BY source_ip, destination_ip, destination_port
",playbooks/attack/enterprise/T1592.yml
T1592: Gather Victim Host Information,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,none,2,Is any single external IP address exhibiting scanning or sweeping behavior by connecting to an anomalous number of hosts or ports?,"This question seeks to detect scanning behavior without relying on pre-existing threat intelligence. Adversaries often perform horizontal sweeps (one port, many hosts) or vertical scans (one host, many ports) to map out our network. By establishing a statistical baseline for normal connection patterns and alerting on significant deviations (e.g., IPs exceeding the 99th percentile for unique hosts/ports contacted), we can uncover previously unknown scanning infrastructure.
",Zeek conn.log; Windows Event ID 5156; External-facing web servers; VPN concentrators; Firewall and network gateway logs; Domain controllers,last 90 days,": SEARCH network_connection_logs WHERE direction = 'inbound'
AGGREGATE unique_dest_hosts = unique_count(destination_ip), unique_dest_ports = unique_count(destination_port) OVER 5m_window BY source_ip
COMPARE unique_dest_hosts, unique_dest_ports AGAINST historical_baseline
ALERT IF value > 99th_percentile
",playbooks/attack/enterprise/T1592.yml
T1592: Gather Victim Host Information,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,none,3,Can machine learning models classify network activity from external IPs as reconnaissance based on connection patterns?,"This question leverages machine learning to create a sophisticated detection model for reconnaissance. By training a classifier (like a Random Forest) on features such as CTI list membership, connection counts to distinct hosts and ports, and connection states (e.g., failed, rejected), the model can learn the subtle, combined patterns of scanning activity. This approach can identify complex reconnaissance that might evade simpler rule-based or statistical methods.
",Zeek conn.log; Windows Event ID 5156; External-facing web servers; VPN concentrators; Firewall and network gateway logs; Domain controllers,last 90 days,": INPUT network_connection_logs
FOR each source_ip:
  FEATURE_SET = {is_on_cti_list, distinct_ports_5min, distinct_hosts_5min, connection_state_counts}
  PREDICTION = recon_model.predict(FEATURE_SET)
  CONFIDENCE = recon_model.predict_proba(FEATURE_SET)
  ALERT IF PREDICTION == 'reconnaissance' AND CONFIDENCE > 0.9
",playbooks/attack/enterprise/T1592.yml
T1592: Gather Victim Host Information,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,none,4,Has an internal host connected to a known reconnaissance framework domain or IP?,"This question focuses on detecting the use of specific, known adversary tools like the ScanBox framework. These frameworks are used to fingerprint victim browsers and hosts. By maintaining a watchlist of domains and IPs associated with these tools and monitoring DNS and HTTP logs, we can generate a high-severity alert upon a successful connection. This indicates a potential compromise or an insider threat actively profiling our internal systems.
",Zeek conn.log; Zeek http.log; Zeek dns.log; DNS resolvers; Network egress points and web proxies; User workstations,last 90 days,": SEARCH dns_logs, http_logs
WHERE (dns_query IN recon_framework_watchlist OR destination_ip IN recon_framework_watchlist)
AND source_ip is_internal
RETURN source_ip, destination_domain, destination_ip
",playbooks/attack/enterprise/T1592.yml
T1592: Gather Victim Host Information,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,none,5,Is an internal host exfiltrating data via an HTTP POST request with unusually high entropy?,"This question aims to detect the exfiltration of collected host information, which is a common follow-on to in-browser reconnaissance. Adversaries often encode or encrypt the collected data before sending it, which increases its randomness or entropy. By calculating the Shannon entropy of outbound HTTP POST bodies and comparing it to a baseline, we can flag requests with abnormally high entropy (e.g., > 98th percentile) as potential data exfiltration.
",Zeek conn.log; Zeek http.log; Zeek dns.log; DNS resolvers; Network egress points and web proxies; User workstations,last 90 days,": SEARCH http_logs WHERE http_method = 'POST' AND direction = 'outbound'
FOR each request:
  CALCULATE entropy(request_body)
  COMPARE entropy AGAINST historical_baseline
  ALERT IF entropy > 98th_percentile
",playbooks/attack/enterprise/T1592.yml
T1592: Gather Victim Host Information,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,none,6,Can a machine learning model identify outbound HTTP requests that are characteristic of browser profiling?,"This question uses machine learning to proactively identify browser profiling activity. By training a model on features like User-Agent, request body length, MIME types, URI entropy, and domain age, the model can learn to distinguish legitimate web browsing from automated profiling scripts. Deploying this model allows for the scoring of new outbound requests, enabling alerts when a request is classified as 'profiling' with high confidence, even to previously unknown domains.
",Zeek conn.log; Zeek http.log; Zeek dns.log; DNS resolvers; Network egress points and web proxies; User workstations,last 90 days,": INPUT http_logs WHERE direction = 'outbound'
FOR each request:
  FEATURE_SET = {user_agent, request_body_len, response_mime_type, uri_entropy, domain_age}
  PREDICTION = profiling_model.predict(FEATURE_SET)
  ALERT IF PREDICTION == 'profiling'
",playbooks/attack/enterprise/T1592.yml
T1592: Gather Victim Host Information,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,none,7,Is an external IP using a User-Agent or accessing URIs associated with known scanning tools?,"This question aims to identify overt scanning activity by looking for explicit tool signatures. Many automated scanning tools (like nmap, nikto, sqlmap) use default User-Agent strings or probe for specific, well-known sensitive files (e.g., /.git/config). By applying a set of regular expressions to our web logs to find these signatures, we can generate high-fidelity alerts for this common and often noisy reconnaissance technique.
",Zeek http.log; Public-facing web applications; API gateways; Load balancers,last 90 days,": SEARCH http_logs WHERE direction = 'inbound'
AND (user_agent MATCHES scanner_regex_list OR uri MATCHES sensitive_file_regex_list)
RETURN count BY source_ip, user_agent, uri
",playbooks/attack/enterprise/T1592.yml
T1592: Gather Victim Host Information,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,none,8,"Is an external IP generating an unusually high ratio of HTTP error responses, suggesting forceful browsing?","This question seeks to identify automated scanning by analyzing the server's responses. Attackers performing forceful browsing or directory enumeration will try to access many non-existent pages, resulting in a high number of HTTP 4xx (Client Error) and 5xx (Server Error) responses compared to successful 2xx/3xx codes. By tracking this error ratio for each source IP and alerting when it exceeds a statistical baseline (e.g., 95th percentile), we can detect this brute-force discovery behavior.
",Zeek http.log; Public-facing web applications; API gateways; Load balancers,last 90 days,": SEARCH http_logs WHERE direction = 'inbound'
AGGREGATE error_codes = count(status_code WHERE status_code >= 400), success_codes = count(status_code WHERE status_code < 400) OVER 10m_window BY source_ip
CALCULATE error_ratio = error_codes / (success_codes + error_codes)
COMPARE error_ratio AGAINST historical_baseline
ALERT IF error_ratio > 95th_percentile
",playbooks/attack/enterprise/T1592.yml
T1592: Gather Victim Host Information,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,none,9,Can a machine learning model detect anomalous URI navigation paths indicative of automated scanning?,"This question uses a sophisticated sequence model (LSTM) to understand normal user behavior. Legitimate users typically follow predictable navigation paths on a website, while automated scanners jump between unrelated URIs. By training an LSTM on sequences of benign URI requests, the model learns what a 'normal' session looks like. It can then assign a perplexity (or 'surprise') score to new sessions. Highly improbable sequences (e.g., top 1% perplexity) are flagged as anomalous and likely represent automated scanning.
",Zeek http.log; Public-facing web applications; API gateways; Load balancers,last 90 days,": INPUT http_logs WHERE direction = 'inbound'
FOR each session (by source_ip):
  URI_SEQUENCE = get_ordered_uris(session)
  PERPLEXITY = lstm_model.score(URI_SEQUENCE)
  COMPARE PERPLEXITY against historical_scores
  ALERT IF PERPLEXITY > 99th_percentile
",playbooks/attack/enterprise/T1592.yml
T1592: Gather Victim Host Information,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,none,10,Has a single external IP performed a high-volume port scan or network sweep within a one-minute window?,"This question aims to detect classic, high-volume scanning techniques using simple, fixed thresholds. A port scan involves probing many ports on a single host, while a network sweep involves probing a single port across many hosts. By creating a rule that alerts when an external IP exceeds a clear threshold (e.g., >100 ports on one host, or >50 hosts on one port) in a short time frame (60 seconds), we can reliably catch this overt form of network reconnaissance.
",Zeek conn.log; Windows Event ID 5156; Firewall and network gateway logs; DMZ subnets; Externally-facing servers,last 90 days,": SEARCH network_connection_logs WHERE direction = 'inbound'
AGGREGATE unique_dest_ports = unique_count(destination_port), unique_dest_hosts = unique_count(destination_ip) OVER 1m_window BY source_ip, destination_ip
ALERT IF (unique_dest_ports > 100) OR (unique_dest_hosts > 50)
",playbooks/attack/enterprise/T1592.yml
T1592: Gather Victim Host Information,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,none,11,"Is an external IP connecting to a set of destination ports with high statistical variance or entropy, suggesting a non-sequential scan?","This question seeks to identify more subtle or ""stealthy"" scanning techniques that might not be sequential. Instead of looking at the raw count of ports, this method analyzes the distribution of the ports being contacted. A legitimate service might connect to a few related ports, while a scanner might probe a wide, random-seeming selection. A high standard deviation or high entropy in the set of destination ports for a given source IP is a strong statistical indicator of a broad, non-sequential port scan.
",Zeek conn.log; Windows Event ID 5156; Firewall and network gateway logs; DMZ subnets; Externally-facing servers,last 90 days,": SEARCH network_connection_logs WHERE direction = 'inbound'
FOR each source_ip OVER 5m_window:
  PORT_LIST = get_destination_ports(source_ip)
  STDDEV_PORTS = calculate_stddev(PORT_LIST)
  ENTROPY_PORTS = calculate_entropy(PORT_LIST)
  COMPARE STDDEV_PORTS, ENTROPY_PORTS against baselines
  ALERT IF STDDEV_PORTS > 3_std_dev_from_mean OR ENTROPY_PORTS is high
",playbooks/attack/enterprise/T1592.yml
T1592: Gather Victim Host Information,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,none,12,Can an unsupervised machine learning model (DBSCAN) identify clusters of anomalous network activity corresponding to scanning?,"This question uses unsupervised learning to find scanning behavior without prior labels. Density-based clustering algorithms like DBSCAN group data points that are closely packed together. When applied to network connection data (using features like source/destination IPs and ports), legitimate traffic typically forms a large, dense cluster. Scanning activities, however, often appear as smaller, separate, but still dense clusters. By programmatically identifying these anomalous clusters, we can pinpoint the source IPs involved in the scanning.
",Zeek conn.log; Windows Event ID 5156; Firewall and network gateway logs; DMZ subnets; Externally-facing servers,last 90 days,": INPUT network_connection_logs for last hour
FEATURE_VECTORS = create_vectors(source_ip, dest_ip, dest_port)
CLUSTERS = dbscan.fit(FEATURE_VECTORS)
IDENTIFY anomalous_clusters (small, dense clusters)
ALERT on source_ips that are core points in anomalous_clusters
",playbooks/attack/enterprise/T1592.yml
T1592: Gather Victim Host Information,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,none,13,Is an inbound HTTP request using a User-Agent string known to be associated with malicious tools?,"This question provides a straightforward method for detecting malicious scanners by matching the User-Agent string against a blocklist. Many scanning and attack tools (e.g., 'masscan', 'zgrab') use unique, identifiable User-Agent strings. Maintaining a list of these and creating a SIEM rule to alert on any match in inbound web traffic provides a high-confidence signal of malicious reconnaissance.
",Zeek http.log; Public-facing web applications; Content Delivery Networks (CDNs); Reverse proxies,last 90 days,": SEARCH http_logs WHERE direction = 'inbound'
AND user_agent IN malicious_ua_blocklist
RETURN count BY source_ip, user_agent
",playbooks/attack/enterprise/T1592.yml
T1592: Gather Victim Host Information,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,none,14,"Is an inbound HTTP request using a User-Agent that is statistically anomalous (rare, new, or random-looking)?","This question aims to detect suspicious User-Agents without relying on a blocklist. Adversaries may use custom or randomized User-Agents to evade detection. This method identifies these by looking for statistical anomalies: User-Agents that have never been seen before, are extremely rare (e.g., in the bottom 0.1% of frequency), or have high character entropy (suggesting randomization). An alert on any of these conditions can reveal novel or customized scanning tools.
",Zeek http.log; Public-facing web applications; Content Delivery Networks (CDNs); Reverse proxies,last 90 days,": SEARCH http_logs WHERE direction = 'inbound'
FOR each request:
  UA = request.user_agent
  IS_NEW = UA not in historical_ua_list_30d
  IS_RARE = frequency(UA) < 0.1_percentile
  IS_HIGH_ENTROPY = entropy(UA) > 3.5
  ALERT IF IS_NEW OR IS_RARE OR IS_HIGH_ENTROPY
",playbooks/attack/enterprise/T1592.yml
T1592: Gather Victim Host Information,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,none,15,Can a machine learning autoencoder model detect fabricated or malicious User-Agent strings?,"This question employs a sophisticated anomaly detection technique using an autoencoder neural network. The model is trained on a large set of legitimate User-Agent strings, learning to compress and then reconstruct them accurately. When a new, anomalous User-Agent (one that doesn't fit the learned patterns) is fed into the model, it will have a high 'reconstruction error'. By alerting on User-Agents with an error above a very high threshold (e.g., 99.9th percentile), we can effectively identify fabricated, randomized, or otherwise malformed strings used by attackers.
",Zeek http.log; Public-facing web applications; Content Delivery Networks (CDNs); Reverse proxies,last 90 days,": INPUT http_logs WHERE direction = 'inbound'
FOR each request:
  UA_STRING = request.user_agent
  RECONSTRUCTION_ERROR = ua_autoencoder.evaluate(UA_STRING)
  COMPARE RECONSTRUCTION_ERROR against baseline_errors
  ALERT IF RECONSTRUCTION_ERROR > 99.9th_percentile
",playbooks/attack/enterprise/T1592.yml
T1592: Gather Victim Host Information,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,none,16,Is an external IP requesting URIs that are known to be sensitive files or information-leaking endpoints?,"This question targets a common reconnaissance technique where attackers probe for specific files or API endpoints that inadvertently expose sensitive information (e.g., '/.git/config', '/.env', '/actuator/heapdump'). By creating a SIEM rule with a list of regular expressions matching these known dangerous URI patterns, we can generate a high-severity alert on a single match. This provides a direct and immediate indication of targeted probing for vulnerabilities.
",Zeek http.log; Public web servers; API endpoints; Cloud service management consoles,last 90 days,": SEARCH http_logs WHERE direction = 'inbound'
AND uri MATCHES sensitive_uri_regex_list
ALERT on any match, returning source_ip and uri
",playbooks/attack/enterprise/T1592.yml
T1592: Gather Victim Host Information,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,none,17,"Is an external IP making multiple, distinct requests for known sensitive URIs in a short time frame?","This question builds upon the symbolic check by adding a frequency component to reduce noise and identify more determined adversaries. While a single request for a sensitive URI might be a false positive, an actor probing for multiple different known vulnerabilities from the same IP within a few minutes is a much stronger signal of malicious intent. An alert that triggers when this count exceeds a low threshold (like 3 unique probes in 5 minutes) indicates a targeted effort to find an exploitable information leak.
",Zeek http.log; Public web servers; API endpoints; Cloud service management consoles,last 90 days,": SEARCH http_logs WHERE direction = 'inbound' AND uri MATCHES sensitive_uri_regex_list
AGGREGATE unique_sensitive_uri_count = unique_count(uri) OVER 5m_window BY source_ip
ALERT IF unique_sensitive_uri_count > 3
",playbooks/attack/enterprise/T1592.yml
T1592: Gather Victim Host Information,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,none,18,Can an unsupervised machine learning model (One-Class SVM) identify entire user sessions that are anomalous and likely represent reconnaissance?,"This question takes a holistic, session-level view of user activity. Using a One-Class SVM, we can model what a 'normal' user session looks like based on features like its duration, number of requests, ratio of errors, and URI characteristics. The model learns the boundary of normal behavior. Any session that falls outside this boundary is classified as an anomaly or outlier. This is a powerful way to detect reconnaissance that might not trigger individual rules but looks suspicious when viewed as a whole session.
",Zeek http.log; Public web servers; API endpoints; Cloud service management consoles,last 90 days,": INPUT http_logs WHERE direction = 'inbound'
FOR each session (by source_ip):
  FEATURE_SET = {duration, request_count, ratio_404, avg_uri_entropy, count_suspicious_patterns}
  PREDICTION = session_svm_model.predict(FEATURE_SET)
  ALERT IF PREDICTION == 'anomaly'",playbooks/attack/enterprise/T1592.yml
T1596.001: DNS-Passive DNS,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,"{'tactic_id': 'TA0043', 'tactic_name': 'Reconnaissance'}",n; o; n; e,1,Are any DNS queries originating from external IP addresses known to be reconnaissance scanners according to threat intelligence feeds?,This question aims to identify straightforward reconnaissance attempts by cross-referencing the source IP of DNS queries with curated lists of known malicious scanners. A match is a high-confidence indicator that an external entity is actively probing the organization's DNS infrastructure.,Zeek dns.log; Threat Intelligence Platform Feeds; Authoritative DNS Servers; Public-facing DNS Resolvers; Network Egress/Ingress Points (Firewalls); Threat Intelligence Subscription Services,last 90 days,: SEARCH Zeek dns.log WHERE source_ip IN threat_intel_feed(type='scanner') | CREATE_ALERT,playbooks/attack/enterprise/T1596.001.yml
T1596.001: DNS-Passive DNS,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,"{'tactic_id': 'TA0043', 'tactic_name': 'Reconnaissance'}",n; o; n; e,2,"Among the IPs identified as reconnaissance scanners, which ones are exhibiting an unusually high query frequency compared to normal external clients?","This question helps prioritize threats by focusing on scanners that are not just present but are also highly active. By comparing their query rate to a baseline of normal traffic, analysts can distinguish between passive, low-level scanning and a potentially more targeted or aggressive reconnaissance campaign.",Zeek dns.log; Threat Intelligence Platform Feeds; Authoritative DNS Servers; Public-facing DNS Resolvers; Network Egress/Ingress Points (Firewalls); Threat Intelligence Subscription Services,last 90 days,: SEARCH Zeek dns.log WHERE source_ip IN threat_intel_feed(type='scanner') | STATS count BY source_ip | WHERE count > 95th_percentile_of_external_clients,playbooks/attack/enterprise/T1596.001.yml
T1596.001: DNS-Passive DNS,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,"{'tactic_id': 'TA0043', 'tactic_name': 'Reconnaissance'}",n; o; n; e,3,Can we use a machine learning model to classify incoming DNS queries as 'reconnaissance' with high confidence?,"This question leverages machine learning to move beyond simple blocklists and statistical thresholds. A supervised model trained on features like IP reputation, ASN, query type, and FQDN patterns can identify novel or complex reconnaissance behavior that might otherwise be missed, providing a more sophisticated layer of detection.",Zeek dns.log; Threat Intelligence Platform Feeds; Authoritative DNS Servers; Public-facing DNS Resolvers; Network Egress/Ingress Points (Firewalls); Threat Intelligence Subscription Services,last 90 days,: INPUT Zeek dns.log | APPLY ML_model(type='recon_classifier') | SEARCH model_prediction='reconnaissance' AND confidence_score > 0.90,playbooks/attack/enterprise/T1596.001.yml
T1596.001: DNS-Passive DNS,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,"{'tactic_id': 'TA0043', 'tactic_name': 'Reconnaissance'}",n; o; n; e,4,Is any single external IP address rapidly querying for multiple sensitive service discovery (SRV) records?,"This question targets a common Active Directory reconnaissance technique where an adversary attempts to locate critical services like Global Catalogs, LDAP, or Kerberos. A burst of such queries from an external source is highly suspicious and indicative of an attempt to map internal network services.",Zeek dns.log; Authoritative DNS Servers; Network Egress/Ingress Points (Firewalls),last 90 days,": SEARCH Zeek dns.log WHERE query_type='SRV' AND query_name IN ('_gc._tcp', '_ldap._tcp', '_kerberos._tcp') | STATS distinct_count(query_name) BY source_ip, time_window(5m) | WHERE distinct_count > 3",playbooks/attack/enterprise/T1596.001.yml
T1596.001: DNS-Passive DNS,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,"{'tactic_id': 'TA0043', 'tactic_name': 'Reconnaissance'}",n; o; n; e,5,Are any external IP addresses issuing a statistically anomalous proportion of SRV queries compared to their total DNS activity?,"This question identifies outliers whose behavior is heavily skewed towards service discovery. While a few SRV queries might be normal, an IP dedicating a high percentage of its activity to SRV lookups is abnormal and warrants investigation for targeted reconnaissance.",Zeek dns.log; Authoritative DNS Servers; Network Egress/Ingress Points (Firewalls),last 90 days,": SEARCH Zeek dns.log | STATS count, count(WHERE query_type='SRV') as srv_count BY source_ip | LET ratio = srv_count / count | WHERE ratio > 99.9th_percentile_of_all_clients",playbooks/attack/enterprise/T1596.001.yml
T1596.001: DNS-Passive DNS,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,"{'tactic_id': 'TA0043', 'tactic_name': 'Reconnaissance'}",n; o; n; e,6,Does the sequence of DNS queries from any external IP match the patterns used by known reconnaissance tools?,"This question uses a more advanced technique to detect reconnaissance by analyzing the order and type of DNS queries, not just their volume or content. Sequence analysis models can learn the specific 'fingerprints' of automated tools like DNSenum, allowing them to detect a malicious actor even if the individual queries appear benign in isolation.",Zeek dns.log; Authoritative DNS Servers; Network Egress/Ingress Points (Firewalls),last 90 days,: INPUT Zeek dns.log | GROUP_BY source_ip | APPLY sequence_analysis_model(type='dns_recon_tool') | SEARCH model_prediction='malicious_sequence',playbooks/attack/enterprise/T1596.001.yml
T1596.001: DNS-Passive DNS,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,"{'tactic_id': 'TA0043', 'tactic_name': 'Reconnaissance'}",n; o; n; e,7,Are we receiving any DNS zone transfer requests (AXFR/IXFR) from unauthorized external IP addresses?,"This question addresses a critical security misconfiguration. A zone transfer exposes all DNS records for a domain, providing an adversary with a complete map of the organization's network infrastructure. Any unauthorized attempt is a serious incident and requires immediate investigation, as it suggests a direct attempt to gather comprehensive intelligence.",Zeek dns.log; Authoritative DNS Servers,last 90 days,": SEARCH Zeek dns.log WHERE query_type IN ('AXFR', 'IXFR') AND source_ip NOT_IN zone_transfer_allowlist | CREATE_ALERT(severity='critical')",playbooks/attack/enterprise/T1596.001.yml
T1596.001: DNS-Passive DNS,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,"{'tactic_id': 'TA0043', 'tactic_name': 'Reconnaissance'}",n; o; n; e,8,Is any external IP address making a statistically unusual number of 'ANY' type DNS queries?,"This question looks for another reconnaissance method. An 'ANY' query requests all available records for a given name. While sometimes used for diagnostics, a high volume of 'ANY' queries from a single external source is abnormal and may indicate an adversary's attempt to gather as much information as possible about specific hosts.",Zeek dns.log; Authoritative DNS Servers,last 90 days,: SEARCH Zeek dns.log WHERE query_type='ANY' | STATS count BY source_ip over 1h | WHERE count > (mean + 3*stddev) of baseline,playbooks/attack/enterprise/T1596.001.yml
T1596.001: DNS-Passive DNS,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,"{'tactic_id': 'TA0043', 'tactic_name': 'Reconnaissance'}",n; o; n; e,9,Can an unsupervised machine learning model identify anomalous DNS queries based on rare query types or unusual frequencies?,"This question applies machine learning to find 'unknown unknowns' in DNS traffic. Unlike rules that look for specific indicators, an anomaly detection model learns what normal traffic looks like and flags any deviation. This can effectively catch rare but significant events like unauthorized AXFR attempts or bursts of 'ANY' queries without needing pre-defined signatures.",Zeek dns.log; Authoritative DNS Servers,last 90 days,": INPUT Zeek dns.log features(qtype_dist, query_volume) | APPLY anomaly_detection_model(type='isolation_forest') | SEARCH model_prediction='outlier'",playbooks/attack/enterprise/T1596.001.yml
T1596.001: DNS-Passive DNS,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,"{'tactic_id': 'TA0043', 'tactic_name': 'Reconnaissance'}",n; o; n; e,10,Is any external IP address generating a high volume of DNS queries that result in a non-existent domain (NXDOMAIN) error?,"This question targets a common reconnaissance technique known as a DNS sweep, where an adversary uses a wordlist to guess subdomains (e.g., 'vpn', 'remote', 'test'). A high ratio of NXDOMAIN responses from a single source strongly suggests this brute-force enumeration activity.",Zeek dns.log; Authoritative DNS Servers; DNS Resolvers,last 90 days,": SEARCH Zeek dns.log | STATS count, count(WHERE response_code='NXDOMAIN') as nx_count BY source_ip, time_window(5m) | WHERE (nx_count / count) > 0.8 AND count > 50",playbooks/attack/enterprise/T1596.001.yml
T1596.001: DNS-Passive DNS,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,"{'tactic_id': 'TA0043', 'tactic_name': 'Reconnaissance'}",n; o; n; e,11,"Are the subdomains being queried by any external IP address statistically random or complex, especially when also seeing many NXDOMAIN errors?","This question looks for evidence of Domain Generation Algorithms (DGAs) being used for reconnaissance. Instead of a dictionary, the adversary uses an algorithm to generate a large number of pseudo-random subdomain names. High character entropy in the queried names is a key indicator of this automated technique, especially when paired with a high NXDOMAIN rate.",Zeek dns.log; Authoritative DNS Servers; DNS Resolvers,last 90 days,: SEARCH Zeek dns.log | CALCULATE shannon_entropy(subdomain) per source_ip over 10m | WHERE entropy_score > 98th_percentile,playbooks/attack/enterprise/T1596.001.yml
T1596.001: DNS-Passive DNS,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,"{'tactic_id': 'TA0043', 'tactic_name': 'Reconnaissance'}",n; o; n; e,12,"Can a clustering algorithm group normal DNS client behavior and isolate anomalous clients based on query count, NXDOMAIN ratio, and subdomain entropy?","This question uses unsupervised machine learning to automatically group clients with similar behavior. 'Normal' clients will form dense clusters, while malicious actors (e.g., those performing DNS sweeps) will have a unique combination of features (high query count, high NXDOMAIN ratio, high entropy) and will be classified as outliers or noise by the algorithm, making them easy to spot.",Zeek dns.log; Authoritative DNS Servers; DNS Resolvers,last 90 days,": INPUT Zeek dns.log features(query_count, nxdomain_ratio, subdomain_entropy) | APPLY clustering_model(type='dbscan') | SEARCH model_prediction='outlier'",playbooks/attack/enterprise/T1596.001.yml
T1596.001: DNS-Passive DNS,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,"{'tactic_id': 'TA0043', 'tactic_name': 'Reconnaissance'}",n; o; n; e,13,Has there been a sudden and sustained spike in the overall rate of DNS queries to our servers?,"This question provides a broad, top-level view to detect large-scale events. A sudden, drastic increase in query volume that isn't tied to a known legitimate event (like a marketing campaign) could indicate a distributed reconnaissance effort or the beginning of a DNS-based denial-of-service attack.",Zeek dns.log; Authoritative DNS Servers; Network Egress/Ingress Points (Firewalls),last 90 days,": MONITOR rate(dns_queries) per 1m | LET moving_avg = moving_average(rate, 1h) | TRIGGER IF current_rate > (moving_avg * 4) for 5 minutes",playbooks/attack/enterprise/T1596.001.yml
T1596.001: DNS-Passive DNS,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,"{'tactic_id': 'TA0043', 'tactic_name': 'Reconnaissance'}",n; o; n; e,14,"Is the current DNS query volume exceeding our historical baseline by a statistically significant amount (e.g., more than 4 standard deviations)?","This question refines the simple rate-of-change detection by using historical time-series analysis. By comparing the current volume to a long-term baseline (e.g., 30 days), this method can more reliably identify true anomalies while accounting for normal fluctuations, reducing false positives.",Zeek dns.log; Authoritative DNS Servers; Network Egress/Ingress Points (Firewalls),last 90 days,": CALCULATE baseline(mean, stddev) for dns_query_volume over 30d | ALERT IF current_volume > (baseline.mean + 4*baseline.stddev)",playbooks/attack/enterprise/T1596.001.yml
T1596.001: DNS-Passive DNS,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,"{'tactic_id': 'TA0043', 'tactic_name': 'Reconnaissance'}",n; o; n; e,15,"Is the observed DNS traffic volume significantly deviating from what a time series forecasting model, which accounts for daily and weekly patterns, would predict?","This is the most sophisticated approach to volume anomaly detection. A SARIMA model learns complex seasonal patterns (e.g., lower traffic on weekends, peaks during business hours). It then predicts an expected range for future traffic. If the actual volume falls outside this predicted confidence interval, it signals a high-confidence anomaly that cannot be explained by normal business cycles.",Zeek dns.log; Authoritative DNS Servers; Network Egress/Ingress Points (Firewalls),last 90 days,: INPUT dns_volume_timeseries | APPLY forecasting_model(type='sarima') | LET prediction = model.predict() | ALERT IF actual_volume is_outside prediction.confidence_interval(99%),playbooks/attack/enterprise/T1596.001.yml
T1597: Search Closed Sources,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,1,Are there any successful or failed login attempts from external IP addresses using usernames known to be compromised in previous data breaches?,This question aims to directly detect credential stuffing attacks. Adversaries often acquire lists of usernames and passwords from public or private data breaches and test them against an organization's authentication services. A match indicates a high probability that an adversary is attempting to leverage a known-compromised credential to gain unauthorized access.,"Windows Event ID 4624; Windows Event ID 4625; Zeek conn.log; Externally-facing authentication services (e.g., VPN, OWA, M365); Domain Controllers; Cloud IAM services",Last 90 days,: SEARCH auth_logs (event_id=4624 OR 4625) WHERE source_ip.is_external=true AND username IN breached_credential_list,playbooks/attack/enterprise/T1597.yml
T1597: Search Closed Sources,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,2,Has there been a statistically significant increase in failed login attempts for accounts known to be on breached credential lists?,"This question seeks to identify brute-force or credential stuffing activity that may not result in an immediate successful login but shows a clear anomalous pattern. By comparing the current rate of failed logins from external sources to a historical baseline, analysts can detect a surge in attack attempts against vulnerable accounts, even if the attacker is rotating through different passwords.","Windows Event ID 4625; Zeek conn.log; Externally-facing authentication services (e.g., VPN, OWA, M365); Domain Controllers; Cloud IAM services",Last 90 days,": FOR user IN breached_credential_list | CALCULATE z_score(failed_logins_last_24h, baseline_30d) | ALERT if z_score > 3",playbooks/attack/enterprise/T1597.yml
T1597: Search Closed Sources,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,3,"Can a machine learning model identify malicious login attempts based on features like breach list status, source IP reputation, and time of day?","This question proposes a more sophisticated, proactive detection method using machine learning. By training a model on various contextual features (if the account is on a breach list, IP reputation, time, ASN rarity), it can learn the subtle characteristics of malicious login attempts and score new events in real-time. This provides a more nuanced detection capability than simple rule-based alerts.","Windows Event ID 4624; Windows Event ID 4625; Zeek conn.log; Externally-facing authentication services (e.g., VPN, OWA, M365); Domain Controllers; Cloud IAM services",Last 90 days,": SCORE auth_events using ML_model(features=[is_breached, is_external, time_of_day, source_ASN_rarity, ip_reputation]) | ALERT if score > threshold",playbooks/attack/enterprise/T1597.yml
T1597: Search Closed Sources,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,4,Is a single external IP address attempting to log in to a large number of different accounts in a short period?,"This question is designed to detect password spraying attacks. In this technique, an adversary uses a single password (or a small list of common passwords) against many different usernames. A rule that flags one source IP generating many failed logins for many unique users is a classic indicator of this reconnaissance method.",Windows Event ID 4625; Zeek conn.log; Externally-facing authentication services; Perimeter firewalls and network gateways,Last 90 days,: SEARCH auth_logs (event_id=4625) | GROUP BY source_ip over 10m | COUNT unique usernames | ALERT if unique_username_count > 20,playbooks/attack/enterprise/T1597.yml
T1597: Search Closed Sources,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,5,Is there an unusually high degree of randomness in the usernames being targeted for failed logins from a single external IP?,"This question uses information theory to detect password spraying. A high Shannon entropy value for the set of usernames targeted by a single IP suggests the attacker is cycling through a large and diverse list of users, which is not typical of legitimate, targeted login failures. This statistical approach can identify password spraying that might fly under the radar of simple threshold-based rules.",Windows Event ID 4625; Zeek conn.log; Externally-facing authentication services; Perimeter firewalls and network gateways,Last 90 days,: FOR ip IN external_ips | CALCULATE shannon_entropy(target_usernames) over 1h | ALERT if entropy > 99th_percentile_baseline,playbooks/attack/enterprise/T1597.yml
T1597: Search Closed Sources,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,6,Can we use clustering algorithms to automatically group and identify password spraying activity from raw authentication logs?,"This question leverages unsupervised machine learning to find anomalous clusters of activity. A DBSCAN algorithm can group events based on their properties (like source IP, outcome, and username). A cluster representing a single IP, high unique username count, and high failure rate is a strong signature for a password spray, allowing for detection without pre-defined rules.",Windows Event ID 4625; Zeek conn.log; Externally-facing authentication services; Perimeter firewalls and network gateways,Last 90 days,": RUN DBSCAN on auth_logs (features=[source_ip, outcome, username_hash]) over 5m | IDENTIFY clusters with single_ip, high_unique_users, high_failures | ALERT",playbooks/attack/enterprise/T1597.yml
T1597: Search Closed Sources,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,7,"Has a user account that has been inactive for over 90 days suddenly had a successful login, especially from an external IP?","This question targets the compromise of dormant accounts. Adversaries may use old, stolen credentials that are still valid for accounts that are no longer in active use. A successful login to such an account is highly suspicious, as there is no legitimate reason for it to be used. Correlating this with an external source IP further increases the likelihood of a compromise.","Windows Event ID 4624; Active Directory User Object Attributes (e.g., lastLogonTimestamp); Zeek conn.log; Domain Controllers; Active Directory servers; Externally-facing authentication services",Last 90 days,: CREATE watchlist of users where lastLogon < 90d ago | SEARCH auth_logs (event_id=4624) where user in watchlist AND source_ip.is_external=true | ALERT,playbooks/attack/enterprise/T1597.yml
T1597: Search Closed Sources,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,8,Did a recent successful login for a user occur after a period of inactivity that is statistically unusual for that specific user?,"This question moves beyond a static dormancy threshold (e.g., 90 days) to a user-specific behavioral baseline. Some users log in daily, while others log in weekly or monthly. By calculating a personal baseline for login frequency, we can flag a login that occurs after an unusually long gap for *that* user, which is a more tailored and potentially more accurate indicator of a compromise.","Windows Event ID 4624; Active Directory User Object Attributes (e.g., lastLogonTimestamp); Zeek conn.log; Domain Controllers; Active Directory servers; Externally-facing authentication services",Last 90 days,: FOR user | CALCULATE mean and stddev of login_time_deltas | FOR new_login | IF time_since_last_login > mean + 3*stddev | ALERT,playbooks/attack/enterprise/T1597.yml
T1597: Search Closed Sources,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,9,Can a time-series anomaly detection model identify a successful login that occurs during a period of predicted inactivity for a user?,"This question applies advanced time-series analysis to model each user's login rhythm (e.g., seasonality like weekdays vs. weekends). An algorithm like Seasonal-Hybrid ESD can learn this pattern and forecast when logins are expected. A successful login that occurs during a time the model predicts as 'off-hours' or 'inactive' is flagged as a significant anomaly, indicating a potential compromise.","Windows Event ID 4624; Active Directory User Object Attributes (e.g., lastLogonTimestamp); Zeek conn.log; Domain Controllers; Active Directory servers; Externally-facing authentication services",Last 90 days,: FOR user | TRAIN time_series_model on login_history | FOR new_login | IF model flags login as anomaly | ALERT,playbooks/attack/enterprise/T1597.yml
T1597: Search Closed Sources,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,10,Are external IP addresses attempting to connect to internal or non-public assets that should not be exposed to the internet?,"This question is focused on detecting network reconnaissance against internal infrastructure. By defining a clear list of assets (IPs, subnets, ports) that should never receive traffic from the public internet, any attempt to connect to them from an external source is an immediate and high-fidelity indicator of malicious scanning or targeted access attempts.",Zeek conn.log; Zeek notice.log; Network DMZ; Internal server subnets; Cloud environment subnets hosting non-public services; Perimeter firewalls,Last 90 days,: CREATE reference_set of non_public_assets | SEARCH network_logs where source_ip.is_external=true AND destination_ip IN non_public_assets | ALERT,playbooks/attack/enterprise/T1597.yml
T1597: Search Closed Sources,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,11,Has a single external IP address made an unusual number of connection attempts to our non-public assets?,"This question aims to catch scanning activity that might be missed by single-connection alerts. While the baseline for connections to non-public assets should be zero, an attacker might probe multiple ports or hosts. By setting a low threshold (e.g., more than 5 attempts in an hour), we can detect an adversary systematically scanning our internal attack surface from a single source.",Zeek conn.log; Zeek notice.log; Network DMZ; Internal server subnets; Cloud environment subnets hosting non-public services; Perimeter firewalls,Last 90 days,: SEARCH network_logs where source_ip.is_external=true AND destination_ip IN non_public_assets | GROUP BY source_ip over 1h | COUNT events | ALERT if event_count > 5,playbooks/attack/enterprise/T1597.yml
T1597: Search Closed Sources,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,12,Can a machine learning model trained only on legitimate perimeter traffic identify anomalous connection attempts from external sources targeting non-public assets?,This question proposes an anomaly detection approach for network traffic. A One-Class SVM is trained to understand what 'normal' traffic to the network perimeter looks like. Any new connection attempt from an external source that deviates significantly from this learned norm is flagged as an anomaly. This is particularly useful for identifying novel or slow scanning techniques against non-public infrastructure that might not trigger threshold-based rules.,Zeek conn.log; Zeek notice.log; Network DMZ; Internal server subnets; Cloud environment subnets hosting non-public services; Perimeter firewalls,Last 90 days,": TRAIN OneClassSVM_model on legitimate_perimeter_traffic_features | SCORE new_external_connections | ALERT if connection is anomaly, especially if targeting non-public_assets",playbooks/attack/enterprise/T1597.yml
T1597: Search Closed Sources,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,13,Has a user successfully logged in from a country or Autonomous System Number (ASN) from which they have never logged in before?,"This question aims to detect credential compromise by identifying logins from geographically or network-topologically novel locations. Each user has a typical pattern of access points. A login from a new country or a new internet service provider's network (ASN) is a strong indicator of an 'impossible travel' scenario or account takeover, especially for users who do not travel frequently.",Windows Event ID 4624; Zeek conn.log; Externally-facing authentication services; VPN concentrators; Domain Controllers,Last 90 days,: FOR user | MAINTAIN safelist of source_countries and source_ASNs | FOR new_login | IF login.source_country NOT IN safelist OR login.source_ASN NOT IN safelist | ALERT,playbooks/attack/enterprise/T1597.yml
T1597: Search Closed Sources,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,14,"Has a successful login event accumulated a high risk score based on multiple deviations from the user's established behavior, such as a new country, new ASN, and unusual time?","This question operationalizes a risk-scoring model to combine multiple weak signals into a stronger indicator of compromise. A single anomaly (like a login at an odd hour) might be benign, but when combined with a login from a new country and a new ASN, the event becomes much more suspicious. This scoring system allows for a more nuanced and context-rich alerting strategy than single-factor rules.",Windows Event ID 4624; Zeek conn.log; Externally-facing authentication services; VPN concentrators; Domain Controllers,Last 90 days,": FOR new_login | CALCULATE risk_score (new_country=1, new_ASN=1, unusual_time=1) | ALERT if total_score > 2",playbooks/attack/enterprise/T1597.yml
T1597: Search Closed Sources,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0043: Reconnaissance,n; o; n; e,15,"Can an unsupervised machine learning model, trained on a user's typical login characteristics, identify a successful login that is highly anomalous?","This question leverages sophisticated unsupervised learning to create a holistic behavioral profile for each user or user group. An Isolation Forest model is particularly effective at identifying outliers in multi-dimensional data. By feeding it features like time of day, day of week, and source ASN, the model can learn a complex definition of 'normal' and flag logins that deviate from this norm in ways that simple rules or scoring systems might miss.",Windows Event ID 4624; Zeek conn.log; Externally-facing authentication services; VPN concentrators; Domain Controllers,Last 90 days,": FOR user | TRAIN IsolationForest_model on login_features (hour, day, ASN_hash, etc.) | FOR new_login | IF model returns high anomaly_score | ALERT",playbooks/attack/enterprise/T1597.yml
T1608.001: Upload Malware,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0042: Resource Development,n; o; n; e,1,"Has any internal host established a network connection with a destination IP, domain, or URL known to be malicious?",This question aims to identify direct communication with known command-and-control (C2) or malware hosting infrastructure. Matching against a high-fidelity threat intelligence feed is a primary method for detecting active threats. An alert for such a connection provides a strong signal of a potential compromise.,Zeek conn.log; Zeek http.log; Internet gateways; network egress points; forward and reverse web proxies.,Last 90 days,"SEARCH network_logs (conn, http) WHERE destination_ip OR destination_domain OR url IN malicious_ioc_list RETURN source_host, destination, timestamp",playbooks/attack/enterprise/T1608.001.yml
T1608.001: Upload Malware,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0042: Resource Development,n; o; n; e,2,"If an internal host connected to a known malicious domain, is that domain rarely contacted by other hosts in the enterprise?","This question helps prioritize alerts by distinguishing between widespread, possibly less severe threats (or false positives) and highly targeted attacks. A malicious domain contacted by only one or a few hosts is more likely to be part of a specific, targeted campaign against the organization.",Zeek conn.log; Zeek http.log; Internet gateways; network egress points; forward and reverse web proxies.,Last 90 days,SEARCH network_logs WHERE destination_domain IN malicious_ioc_list | GROUP BY destination_domain | COUNT unique source_host | FILTER count < 3,playbooks/attack/enterprise/T1608.001.yml
T1608.001: Upload Malware,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0042: Resource Development,n; o; n; e,3,Have any outbound network connections been classified as highly likely to be malicious by a predictive model?,"This question leverages machine learning to detect previously unknown or zero-day threats that are not yet in threat intelligence feeds. By analyzing a rich set of features (ASN, geo-location, reputation, TLS data), the model can identify subtle patterns indicative of malicious activity, providing a proactive detection capability.",Zeek conn.log; Zeek ssl.log; Internet gateways; network egress points; forward and reverse web proxies.,Last 90 days,"INPUT network_connections | ENRICH with geo, asn, reputation, tls_features | PREDICT maliciousness_score with ML_model | FILTER maliciousness_score > 0.90",playbooks/attack/enterprise/T1608.001.yml
T1608.001: Upload Malware,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0042: Resource Development,n; o; n; e,4,"Was a high-risk file (e.g., .exe, .dll) downloaded from a non-sanctioned file-sharing site or a newly registered domain (NRD)?",Attackers often use file-sharing services or newly created domains to stage malware. This question focuses on identifying these high-risk download scenarios. Filtering by file type and source reputation (or age) helps to pinpoint potentially malicious payloads while reducing noise from legitimate downloads.,Zeek http.log; Zeek dns.log; Zeek files.log; WHOIS Data; Internal DNS servers; network egress points; web proxies.,Last 90 days,SEARCH file_downloads WHERE (mime_type IN high_risk_mimetypes) AND (source_domain IN non_sanctioned_fileshare_list OR source_domain_creation_date < 60_days_ago),playbooks/attack/enterprise/T1608.001.yml
T1608.001: Upload Malware,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0042: Resource Development,n; o; n; e,5,Has a high-risk file been downloaded from a URL with an unusually random or complex path?,"High entropy (randomness) in a URL path can indicate the use of algorithmically generated links, a technique often employed by content delivery networks (CDNs) and malware delivery systems to obscure file locations. This question helps detect suspicious delivery mechanisms that might evade simple domain-based blocking.",Zeek http.log; Zeek files.log; Internal DNS servers; network egress points; web proxies.,Last 90 days,SEARCH http_logs | CALCULATE shannon_entropy(uri_path) as entropy_score | JOIN with file_downloads on transaction_id | FILTER file_mime_type IN high_risk_mimetypes AND entropy_score > 98th_percentile,playbooks/attack/enterprise/T1608.001.yml
T1608.001: Upload Malware,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0042: Resource Development,n; o; n; e,6,Did an anomalous spike in DNS queries for a specific domain coincide with the download of a high-risk file from that same domain?,"A sudden, unusual increase in DNS requests for a domain can signal the activation of a malicious campaign or a rendezvous point for compromised hosts. This question seeks to correlate such DNS anomalies with actual file transfers, providing strong evidence that the spike was related to malware staging and delivery.",Zeek dns.log; Zeek files.log; Internal DNS servers; network egress points; web proxies.,Last 90 days,"DETECT anomalous_spike in dns_query_volume for each domain | IF spike_detected, SEARCH file_downloads in same_timeframe WHERE domain == spike_domain AND file_type IN high_risk_types",playbooks/attack/enterprise/T1608.001.yml
T1608.001: Upload Malware,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0042: Resource Development,n; o; n; e,7,Has a high-risk file been downloaded over a TLS session that used a self-signed or untrusted certificate?,Legitimate sites typically use TLS certificates issued by trusted Certificate Authorities (CAs). Attackers often use self-signed certificates or certificates from unknown CAs for their infrastructure to save cost and avoid scrutiny. This question helps identify malware downloads that are hiding within encrypted traffic but betray their malicious nature through weak certificate practices.,Zeek http.log; Zeek files.log; Zeek ssl.log; Zeek conn.log; Network egress points; certificate transparency logs; external threat intelligence platforms.,Last 90 days,"JOIN file_downloads with tls_sessions on transaction_id | FILTER file_type IN high_risk_types AND (tls_validation_status == ""self-signed"" OR tls_issuer NOT IN trusted_ca_list)",playbooks/attack/enterprise/T1608.001.yml
T1608.001: Upload Malware,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0042: Resource Development,n; o; n; e,8,"Have any file downloads accumulated a high composite risk score based on multiple suspicious factors (e.g., self-signed cert, low-rep IP, short-lived cert)?","A single suspicious indicator may not be enough to confirm a threat. This question uses a risk-scoring model to aggregate multiple weak signals into a stronger, higher-confidence alert. By combining factors like certificate validity, IP reputation, and User-Agent anomalies, analysts can more effectively identify downloads that are holistically suspicious.",Zeek http.log; Zeek files.log; Zeek ssl.log; Zeek conn.log; Network egress points; certificate transparency logs; external threat intelligence platforms.,Last 90 days,FOR each file_download: CALCULATE score = (points for self_signed_cert) + (points for low_rep_ip) + (points for unusual_user_agent) + (points for short_cert_validity) | FILTER score > threshold,playbooks/attack/enterprise/T1608.001.yml
T1608.001: Upload Malware,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0042: Resource Development,n; o; n; e,9,"Are there any small, distinct groups of file downloads that share similar suspicious characteristics (e.g., same cert issuer, destination ASN, file type)?","This question employs unsupervised machine learning to find novel or emerging attack patterns without relying on predefined rules or signatures. By clustering downloads based on their attributes, anomalous groups—small, dense clusters separate from the ""normal"" bulk of activity—can be identified for investigation as potential coordinated malicious campaigns.",Zeek http.log; Zeek files.log; Zeek ssl.log; Zeek conn.log; Network egress points; certificate transparency logs; external threat intelligence platforms.,Last 90 days,"INPUT file_download_features (mime_type, tls_issuer, dest_asn, etc.) | APPLY DBSCAN clustering | IDENTIFY and investigate small, dense outlier clusters",playbooks/attack/enterprise/T1608.001.yml
T1608.001: Upload Malware,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0042: Resource Development,n; o; n; e,10,Did a file recently downloaded from an external source get executed and immediately make a new outbound network connection?,"This question tracks the full lifecycle of a potential malware execution: download, execution, and command-and-control (C2) beaconing. Correlating network file download events with endpoint process creation and subsequent network activity provides a high-confidence indicator of compromise, showing that a downloaded payload is now active on the host.","Windows Event ID 4688; Sysmon Event ID 1; Sysmon Event ID 3; Zeek files.log; Zeek conn.log; Endpoint devices (workstations, servers); domain controllers; network egress points.",Last 90 days,"JOIN file_downloads with process_creation on (host, filename) within 10min | JOIN with network_connections on process_id | FILTER connection is_external | ALERT",playbooks/attack/enterprise/T1608.001.yml
T1608.001: Upload Malware,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0042: Resource Development,n; o; n; e,11,"Is a process created from a downloaded file masquerading as a common system process (e.g., ""svch0st.exe"" instead of ""svchost.exe"")?","Attackers often use typosquatting or minor variations of legitimate system process names to hide their malware from casual inspection. This question uses string similarity (Levenshtein distance) to detect such masquerading attempts, which is a strong indicator of malicious intent.","Windows Event ID 4688; Sysmon Event ID 1; Zeek files.log; Endpoint devices (workstations, servers); domain controllers.",Last 90 days,"FOR each process from downloaded_file: CALCULATE levenshtein_distance(process_name, known_system_processes) as distance | FILTER distance > 0 AND distance < 3",playbooks/attack/enterprise/T1608.001.yml
T1608.001: Upload Malware,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0042: Resource Development,n; o; n; e,12,"Does a process originating from a downloaded file exhibit periodic, ""heartbeat""-like network traffic indicative of C2 beaconing?","Malware often communicates with its command-and-control server on a regular, automated schedule (a ""beacon"" or ""heartbeat"") to receive commands or exfiltrate data. This question aims to identify this rhythmic traffic pattern using time-series analysis. Detecting such periodicity is a classic and reliable way to uncover active C2 channels.","Sysmon Event ID 3; Zeek conn.log; Endpoint devices (workstations, servers); network egress points.",Last 90 days,FOR each process from downloaded_file: ANALYZE timestamp_series of its outbound_connections | DETECT periodicity using fourier_analysis or autocorrelation | ALERT on strong_regular_signal,playbooks/attack/enterprise/T1608.001.yml
T1613: Container and Resource Discovery,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,1,Are container API calls originating from IP addresses known to be malicious?,This question aims to detect initial reconnaissance or exploitation attempts by correlating network traffic to container API endpoints (like Kubernetes API or Docker daemon) with known malicious hosts from threat intelligence feeds. A match indicates a high-confidence threat attempting to discover or interact with the container environment.,"Zeek conn.log; Zeek http.log; Threat Intelligence Feed; NAI: Kubernetes API server, Docker daemon hosts, internet gateway, reverse proxies, cloud provider control plane endpoints.",Last 90 days,"SEARCH Zeek logs (conn.log, http.log) WHERE destination_port IN (6443, 2375, 2376, 10250) | JOIN source_ip WITH threat_intelligence_feed ON ip_address | IF match_found, ALERT.",playbooks/attack/enterprise/T1613.yml
T1613: Container and Resource Discovery,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,2,"Is there an anomalous spike in new, unique IP addresses connecting to container API ports, suggesting a reconnaissance scan?","This question identifies potential large-scale scanning activity. Adversaries often use a distributed set of IP addresses to scan for exposed container APIs. A sudden increase in the rate of new source IPs connecting to these services, compared to a historical baseline, is a strong indicator of a coordinated reconnaissance effort.","Zeek conn.log; Zeek http.log; NAI: Kubernetes API server, Docker daemon hosts, internet gateway, reverse proxies, cloud provider control plane endpoints.",Last 90 days,"SEARCH Zeek logs WHERE destination_port IN (container_api_ports) | AGGREGATE unique count of new source_ips per hour | COMPARE current_rate to 30-day baseline | IF current_rate > 95th_percentile_of_baseline, ALERT.",playbooks/attack/enterprise/T1613.yml
T1613: Container and Resource Discovery,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,3,"Can we proactively identify high-risk connections to container APIs using machine learning, even from sources not yet on a threat feed?","This question leverages a machine learning model to score the risk of an API connection based on various features like IP reputation, ASN, time of day, and origin. This provides a more nuanced detection capability than simple blocklists, allowing for the identification of suspicious activity from previously unknown sources before they are formally listed on a threat feed.","Zeek conn.log; Zeek http.log; NAI: Kubernetes API server, Docker daemon hosts, internet gateway, reverse proxies, cloud provider control plane endpoints.",Last 90 days,"INPUT connection_features (ip_reputation, asn, time_of_day, country, is_new_ip) into ML_model | GET risk_score | IF risk_score > threshold, ALERT.",playbooks/attack/enterprise/T1613.yml
T1613: Container and Resource Discovery,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,4,"Are container discovery commands (`kubectl`, `docker`) being executed by non-interactive or unauthorized processes?","This question seeks to find instances where container command-line tools are used for discovery (e.g., `kubectl get`, `docker ps`) by an automated script or malware rather than a human administrator. Execution by a non-interactive parent process (i.e., not a standard command shell) is a strong indicator of malicious automation.","Windows Event ID 4688; NAI: Administrative workstations, jump servers, CI/CD runners, container nodes.",Last 90 days,"SEARCH Windows Event Logs (ID 4688) WHERE process_name IN ('kubectl.exe', 'docker.exe') AND command_line CONTAINS ('get', 'describe', 'ps', 'images', 'nodes', 'cluster-info') AND parent_process_name NOT IN ('explorer.exe', 'cmd.exe', 'powershell.exe') | ALERT.",playbooks/attack/enterprise/T1613.yml
T1613: Container and Resource Discovery,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,5,"Is there an unusually high variation or randomness in the command-line arguments for `kubectl` or `docker` commands, suggesting scripted enumeration?","Legitimate administrative commands often have a predictable structure. Automated reconnaissance tools, however, may generate a wide variety of commands in a short period. This question uses Shannon entropy to measure the complexity and randomness of command-line arguments, with a sudden spike indicating a deviation from normal, patterned user behavior toward automated discovery.","Windows Event ID 4688; NAI: Administrative workstations, jump servers, CI/CD runners, container nodes.",Last 90 days,"FOR each user/host, SEARCH Windows Event Logs (ID 4688) for 'kubectl.exe' or 'docker.exe' processes in 5-minute window | CALCULATE Shannon entropy of command_line_arguments | IF entropy > (baseline + 3 * std_dev), ALERT.",playbooks/attack/enterprise/T1613.yml
T1613: Container and Resource Discovery,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,6,Can we identify anomalous container-related command executions by clustering them based on their execution context?,"This question uses an unsupervised machine learning approach (DBSCAN) to group process executions into clusters of 'normal' activity based on features like parent process, user, and host. Outliers or small, isolated clusters that do not fit into the large, dense groups of routine administrative activity are flagged as anomalous and potentially malicious.","Windows Event ID 4688; NAI: Administrative workstations, jump servers, CI/CD runners, container nodes.",Last 90 days,"INPUT process_features (parent_process, user, host, command_tokens) into DBSCAN_model | IDENTIFY outlier clusters | ALERT on processes in outlier clusters.",playbooks/attack/enterprise/T1613.yml
T1613: Container and Resource Discovery,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,7,Are connections to container API endpoints originating from unauthorized network segments?,"Access to sensitive container management APIs should be tightly controlled and restricted to specific administrative network zones. This question aims to detect policy violations by alerting on any connection attempt from a non-approved network segment (e.g., a general user VLAN or guest network), which is a strong indicator of unauthorized access or lateral movement.","Zeek conn.log; Zeek http.log; NAI: Kubernetes API server, Docker daemon hosts, internal network firewalls and switches.",Last 90 days,SEARCH Zeek logs (conn.log) WHERE destination_port IN (container_api_ports) AND source_ip_zone IS 'non-administrative' | ALERT.,playbooks/attack/enterprise/T1613.yml
T1613: Container and Resource Discovery,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,8,"Is any single IP address generating an unusually high volume of connections to container APIs, indicative of a brute-force or enumeration attack?","An adversary attempting to enumerate resources or brute-force credentials may generate a rapid succession of connections from a single source. This question establishes a baseline for normal connection rates per IP and alerts when that baseline is significantly exceeded, pointing to a potential targeted attack.","Zeek conn.log; Zeek http.log; NAI: Kubernetes API server, Docker daemon hosts, internal network firewalls and switches.",Last 90 days,"FOR each source_ip, SEARCH Zeek logs (conn.log) | AGGREGATE connection count per 1-minute interval | IF count > 99th_percentile_of_baseline, ALERT.",playbooks/attack/enterprise/T1613.yml
T1613: Container and Resource Discovery,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,9,"Is there a platform-wide spike in container API requests that deviates from normal, forecasted traffic patterns?","This question provides a macro-level view of API activity. By using a time-series model (like ARIMA or Prophet) trained on historical data, it can predict the expected volume of API requests. A significant deviation from this forecast can indicate a large-scale, distributed reconnaissance event that might not be caught by single-IP or single-user thresholds.","Zeek conn.log; Zeek http.log; NAI: Kubernetes API server, Docker daemon hosts, internal network firewalls and switches.",Last 90 days,"INPUT total_api_request_rate per minute into time_series_model (ARIMA/Prophet) | GET forecasted_range | IF observed_rate is outside forecasted_range, ALERT.",playbooks/attack/enterprise/T1613.yml
T1613: Container and Resource Discovery,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,10,Are container management web UIs being accessed by clients using User-Agent strings associated with automated scanning tools or scripting libraries?,"Legitimate users access web UIs through standard web browsers. Adversaries often use automated tools or scripts for reconnaissance, which leave distinct User-Agent strings (e.g., `curl`, `python-requests`, `Kube-hunter`). This question identifies these non-standard User-Agents to detect automated and potentially malicious interaction with management consoles.","Zeek conn.log; Zeek http.log; NAI: Web servers hosting container management UIs (Kubernetes Dashboard, Rancher, OpenShift).",Last 90 days,"SEARCH Zeek http logs WHERE destination is container_management_UI | IF user_agent MATCHES ('Kube-hunter', 'python-requests', 'curl', 'Go-http-client'), ALERT.",playbooks/attack/enterprise/T1613.yml
T1613: Container and Resource Discovery,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,11,"Is a user session on a container management UI exhibiting behavior consistent with broad scanning, such as accessing many unique pages in a short time?","A normal user typically navigates a web UI in a focused manner, revisiting pages and following a logical path. An automated scanner, in contrast, will often try to access a large number of unique pages quickly to map out the application. This question detects such behavior by calculating the ratio of unique URIs to total requests; a ratio close to 1.0 indicates scanning.","Zeek conn.log; Zeek http.log; NAI: Web servers hosting container management UIs (Kubernetes Dashboard, Rancher, OpenShift).",Last 90 days,"FOR each session (source_ip + user_agent), CALCULATE (unique_uri_count / total_request_count) | IF ratio > 98th_percentile_of_historical_sessions, ALERT.",playbooks/attack/enterprise/T1613.yml
T1613: Container and Resource Discovery,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,12,Is the sequence of pages visited by a user on a container management UI anomalous when compared to learned patterns of legitimate navigation?,"This question employs a sophisticated machine learning model (like an LSTM autoencoder) to learn the typical 'clickstreams' or navigation sequences of normal users. When a new user session follows a path that the model cannot accurately reconstruct (i.e., has a high reconstruction error), it is flagged as anomalous, indicating a navigation pattern that is likely automated or malicious.","Zeek conn.log; Zeek http.log; NAI: Web servers hosting container management UIs (Kubernetes Dashboard, Rancher, OpenShift).",Last 90 days,"INPUT session_uri_sequence into LSTM_autoencoder_model | CALCULATE reconstruction_error | IF reconstruction_error > threshold, ALERT.",playbooks/attack/enterprise/T1613.yml
T1613: Container and Resource Discovery,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,13,"Is a single source IP attempting to discover multiple sensitive resource types (like secrets, service accounts, and cluster roles) in a short time frame?","An adversary performing reconnaissance will often query for a variety of high-value resource types to understand the environment and find sensitive information. This question uses a stateful rule to detect this specific pattern of behavior—requesting several distinct, sensitive resource types in a short window—which is a strong indicator of targeted discovery.","Zeek http.log; Windows Event ID 4688; NAI: Kubernetes API server, container nodes (for pod-to-API traffic).",Last 90 days,"FOR each source_ip, TRACK distinct sensitive resource types requested in 5-minute window (e.g., 'secrets', 'serviceaccounts', 'clusterroles') | IF count >= 3, ALERT.",playbooks/attack/enterprise/T1613.yml
T1613: Container and Resource Discovery,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,14,"Is a source IP requesting an unusually diverse set of API resource types, suggesting broad enumeration?","A high entropy score for the set of requested resource types (e.g., pods, nodes, deployments, secrets) indicates that a client is exploring a wide range of what the API offers, which is characteristic of reconnaissance, rather than the more focused requests typical of normal operations.","Zeek http.log; Windows Event ID 4688; NAI: Kubernetes API server, container nodes (for pod-to-API traffic).",Last 90 days,"FOR each source_ip, in 10-minute window, PARSE resource types from URI | CALCULATE Shannon entropy of the set of unique resource types | IF entropy > threshold OR entropy > (baseline + 3 * std_dev), ALERT.",playbooks/attack/enterprise/T1613.yml
T1613: Container and Resource Discovery,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,15,Can we use graph analysis to identify anomalous API requests that fall outside of normal user and service behavior clusters?,"This question uses graph theory to model the relationships between clients (IPs) and the resources they access (API paths). Normal activity forms dense clusters (communities). A client making unusual or exploratory requests will appear as a node that is weakly connected to these main communities, making it easy to spot as a potential anomaly or threat.","Zeek http.log; Windows Event ID 4688; NAI: Kubernetes API server, container nodes (for pod-to-API traffic).",Last 90 days,"CONSTRUCT bipartite graph of (source_ip, api_resource_path) | APPLY community detection algorithm (e.g., Louvain) | IDENTIFY nodes/edges with low community affiliation | ALERT.",playbooks/attack/enterprise/T1613.yml
T1613: Container and Resource Discovery,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,16,Is an unauthorized host attempting to list all secrets in the cluster?,"Listing all secrets across all namespaces is a highly privileged and dangerous operation, as it can expose credentials for the entire cluster. This question creates a high-fidelity alert for this specific, high-impact action when it originates from any source not explicitly authorized, indicating a likely compromise or severe misconfiguration.","Zeek http.log; Zeek conn.log; NAI: Kubernetes API server (specifically endpoints for secrets, configmaps, and pod logs).",Last 90 days,SEARCH Zeek http logs WHERE http_uri == '/api/v1/secrets' AND http_method == 'GET' AND source_ip NOT IN admin_host_allowlist | ALERT with high priority.,playbooks/attack/enterprise/T1613.yml
T1613: Container and Resource Discovery,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,17,"Is an API response for a sensitive resource, such as secrets or logs, anomalously large, suggesting bulk data exfiltration?","An adversary who has gained access may attempt to exfiltrate large amounts of data at once, such as all logs from a pod or all data from a configmap. This question establishes a baseline for the normal response size for sensitive endpoints and alerts when a response is unusually large, which could indicate a bulk data theft attempt.","Zeek http.log; Zeek conn.log; NAI: Kubernetes API server (specifically endpoints for secrets, configmaps, and pod logs).",Last 90 days,"FOR requests to sensitive endpoints (e.g., /logs, /secrets), SEARCH Zeek conn logs for response_bytes | IF response_bytes > 99th_percentile_of_baseline_for_endpoint, ALERT.",playbooks/attack/enterprise/T1613.yml
T1613: Container and Resource Discovery,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,18,Can we use anomaly detection to identify any access to sensitive data endpoints that deviates from established legitimate access patterns?,"This question uses an unsupervised machine learning model (One-Class SVM or Isolation Forest) to create a profile of 'normal' access to sensitive data based on features like source IP, User-Agent, and time of day. Any access attempt that the model flags as an outlier is considered anomalous and potentially malicious, providing a powerful way to detect novel threats.","Zeek http.log; Zeek conn.log; NAI: Kubernetes API server (specifically endpoints for secrets, configmaps, and pod logs).",Last 90 days,"INPUT access_features (source_ip, user_agent, time_of_day, resource_path) into one_class_ML_model | IF model flags as outlier, ALERT.",playbooks/attack/enterprise/T1613.yml
T1614: System Location Discovery,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,1,Are internal hosts making DNS queries or HTTP/S connections to known public IP geolocation services?,Adversaries use public geolocation services to determine the external IP address and physical location of a compromised host. This is a common reconnaissance step to understand the environment they are in. Monitoring for connections to a maintained watchlist of these services is a direct method for detecting this specific behavior.,Zeek conn.log; Zeek http.log; Zeek dns.log; Zeek ssl.log; Network Egress Points; Internal DNS Resolvers; Egress Proxy Servers,last 90 days,: ,playbooks/attack/enterprise/T1614.yml
T1614: System Location Discovery,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,2,Is any host exhibiting an unusual frequency of connections to geolocation services compared to its own baseline or its peer group?,"While benign applications might occasionally use geolocation services, malicious scripts often make repeated, automated queries. A statistical approach helps identify these outliers. By baselining normal behavior for each host and its peers, we can detect significant deviations that may indicate malicious activity, reducing false positives from legitimate, one-off uses.",Zeek conn.log; Zeek http.log; Zeek dns.log; Zeek ssl.log; Network Egress Points; Internal DNS Resolvers; Egress Proxy Servers,last 90 days,: ,playbooks/attack/enterprise/T1614.yml
T1614: System Location Discovery,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,3,Can we use machine learning to distinguish between benign and malicious connections to geolocation services based on connection characteristics?,"Malicious connections often have different characteristics than benign ones (e.g., initiated by a script versus a browser). A machine learning model can analyze features like user-agent, JA3/JA3S hashes, connection duration, and data volume to classify the connection's intent with higher accuracy than simple rules or statistical thresholds.",Zeek conn.log; Zeek http.log; Zeek dns.log; Zeek ssl.log; Network Egress Points; Internal DNS Resolvers; Egress Proxy Servers,last 90 days,: ,playbooks/attack/enterprise/T1614.yml
T1614: System Location Discovery,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,4,"Are users or processes executing specific command-line utilities to discover the system's time zone, locale, or language settings?","Adversaries use commands like `Get-TimeZone` or `systeminfo` to understand the system's configuration and location. This can inform their next steps, such as tailoring attacks to a specific region or avoiding detection. This question focuses on creating specific rules to catch these known discovery commands, especially when run by suspicious parent processes.",Windows Event ID 4688; User Workstations; Domain Controllers; Application Servers,last 90 days,: ,playbooks/attack/enterprise/T1614.yml
T1614: System Location Discovery,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,5,Is there a sudden spike in the variety of discovery-related commands being executed by a user or on a host?,"A normal user typically has a predictable command execution pattern. An adversary performing reconnaissance often runs a rapid series of different discovery commands. Measuring the Shannon entropy of commands in a short time window can statistically identify this burst of varied, unusual activity, which stands out from normal interactive use.",Windows Event ID 4688; User Workstations; Domain Controllers; Application Servers,last 90 days,: ,playbooks/attack/enterprise/T1614.yml
T1614: System Location Discovery,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,6,Can a sequence analysis model identify malicious reconnaissance command sequences executed within a user session?,"Beyond individual commands, the sequence of commands is highly indicative of intent. A machine learning model, like a Hidden Markov Model, can learn the patterns of both normal administrative activity and known malicious reconnaissance TTPs. By analyzing the command sequence in a session, it can flag entire sessions as suspicious.",Windows Event ID 4688; User Workstations; Domain Controllers; Application Servers,last 90 days,: ,playbooks/attack/enterprise/T1614.yml
T1614: System Location Discovery,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,7,Are non-interactive service accounts or server application processes executing location discovery commands?,"Server applications (like web servers, databases) and system service accounts have no legitimate reason to query the system's geographic location. Such activity is a very strong indicator of compromise, suggesting an adversary has gained control of that process or account to perform reconnaissance.",Windows Event ID 4688; User Workstations; Privileged Access Workstations; Critical Servers,last 90 days,: ,playbooks/attack/enterprise/T1614.yml
T1614: System Location Discovery,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,8,Is a user executing location discovery commands at an anomalous time or with anomalous frequency?,"Adversaries often operate outside of normal business hours to avoid detection. By creating separate baselines for on-hours and off-hours activity, we can more accurately detect unusual behavior. A user suddenly running many discovery commands, especially at night or on a weekend, is highly suspicious and would be flagged by this statistical Z-score check.",Windows Event ID 4688; User Workstations; Privileged Access Workstations; Critical Servers,last 90 days,: ,playbooks/attack/enterprise/T1614.yml
T1614: System Location Discovery,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,9,Can we identify outlier hosts that exhibit unusual location discovery command patterns compared to their peers?,"This approach uses unsupervised machine learning to find hosts that behave differently from the entire population. By clustering hosts based on features like command counts, parent processes, and time of day, we can identify small groups or individual hosts (outliers) whose activity patterns are unique and warrant investigation.",Windows Event ID 4688; User Workstations; Privileged Access Workstations; Critical Servers,last 90 days,: ,playbooks/attack/enterprise/T1614.yml
T1614: System Location Discovery,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,10,Is a host connecting to a known-bad or suspicious new domain shortly after executing a location discovery command?,"This is a classic ""recon followed by C2 beacon"" pattern. An adversary discovers information about the system and then immediately beacons out to a command-and-control server. Correlating the on-host command execution with an outbound network connection to a suspicious destination within a short time window provides a high-fidelity alert.",Windows Event ID 4688; Zeek conn.log; Zeek dns.log; Network Egress Points; User Workstations; Servers with Internet Access,last 90 days,: ,playbooks/attack/enterprise/T1614.yml
T1614: System Location Discovery,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,11,"Does a host show a statistically significant increase in connections to new, unseen IP addresses immediately following a location discovery command?","This statistical method looks for a change in behavior. A sudden burst of connections to new IPs right after reconnaissance is anomalous. By comparing the rate of new IP connections in the 5-minute window post-discovery to the host's overall baseline, we can quantify this suspicion and alert on significant deviations.",Windows Event ID 4688; Zeek conn.log; Zeek dns.log; Network Egress Points; User Workstations; Servers with Internet Access,last 90 days,: ,playbooks/attack/enterprise/T1614.yml
T1614: System Location Discovery,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,12,"Is there a strong, time-lagged correlation between location discovery events and outbound connections exhibiting C2-like characteristics?",This advanced technique treats discovery commands and suspicious outbound connections as two separate time series. Cross-correlation analysis can mathematically determine if a spike in one stream is consistently followed by a spike in the other after a short delay. A strong correlation is a powerful indicator of an automated tool performing recon and then phoning home.,Windows Event ID 4688; Zeek conn.log; Zeek dns.log; Network Egress Points; User Workstations; Servers with Internet Access,last 90 days,: ,playbooks/attack/enterprise/T1614.yml
T1614: System Location Discovery,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,13,Are unapproved processes on cloud instances querying the metadata service for location information?,"In cloud environments, the metadata service (169.254.169.254) is a primary target for reconnaissance. Adversaries query it to learn the instance's region and availability zone. Legitimate access is typically limited to specific startup scripts. Any other process accessing location-specific metadata endpoints is highly suspicious.","Zeek conn.log; Zeek http.log; Windows Event ID 4688; Windows Event ID 5156; Cloud Compute Instances (e.g., AWS EC2, Azure VM); Cloud Network Flow Logs",last 90 days,: ,playbooks/attack/enterprise/T1614.yml
T1614: System Location Discovery,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,14,Is a cloud instance accessing the metadata service with unusual frequency or requesting paths that are abnormal for its role?,"Different types of cloud instances have predictable patterns of interaction with the metadata service. By baselining this behavior per role (e.g., web server), we can detect an instance that starts making an excessive number of requests or queries a path it or its peers has never touched before, indicating a potential compromise.","Zeek conn.log; Zeek http.log; Windows Event ID 4688; Windows Event ID 5156; Cloud Compute Instances (e.g., AWS EC2, Azure VM); Cloud Network Flow Logs",last 90 days,: ,playbooks/attack/enterprise/T1614.yml
T1614: System Location Discovery,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0007: Discovery,n; o; n; e,15,Can a machine learning model classify metadata service access as malicious based on the context of the request?,This ML approach provides a nuanced detection by considering a rich set of features around a metadata query. A legitimate request from a known script at boot time looks very different from a request made by a reverse shell hours later. A trained classifier can learn these distinctions and flag anomalous requests with high confidence.,"Zeek conn.log; Zeek http.log; Windows Event ID 4688; Windows Event ID 5156; Cloud Compute Instances (e.g., AWS EC2, Azure VM); Cloud Network Flow Logs",last 90 days,: ,playbooks/attack/enterprise/T1614.yml
T1620: Reflective Code Loading,f8d2b3a1-7e8c-4a6f-8b9d-1c2e3f4a5b6c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,1,Is a process creating a named pipe with a name matching known malicious C2 patterns or originating from a suspicious parent process?,"Malicious tools, such as Cobalt Strike, often use predictable named pipe patterns for command and control (C2) communications. Detecting these patterns is a direct way to identify the presence of such tools. Furthermore, by correlating the pipe creation event with its parent process (e.g., an Office application spawning the process that creates the pipe), an analyst can trace the activity back to the initial infection vector and understand the attack chain.","Windows Event ID 17; Windows Event ID 18; Windows Event ID 1; Domain Controllers, File Servers, Application Servers, User Workstations",last 90 days,"SEARCH Sysmon EventID=17 WHERE pipe_name MATCHES regex_patterns for known C2. JOIN with Sysmon EventID=1 on process_guid to find parent process. FILTER for suspicious parent-child relationships (e.g., winword.exe -> cmd.exe).",playbooks/attack/enterprise/T1620.yml
T1620: Reflective Code Loading,f8d2b3a1-7e8c-4a6f-8b9d-1c2e3f4a5b6c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,2,"Is a process creating a named pipe with an unusually high-entropy name, or is a process creating a named pipe when it has rarely done so before?","To evade simple signature-based detections, adversaries often use algorithmically generated names for their named pipes, which result in high Shannon entropy scores. Baselining normal process behavior allows for the detection of anomalies. For instance, a process like notepad.exe creating a named pipe is highly unusual and warrants investigation, even if the pipe name itself does not match a known malicious pattern.","Windows Event ID 17; Windows Event ID 18; Windows Event ID 1; Domain Controllers, File Servers, Application Servers, User Workstations",last 90 days,CALCULATE entropy for pipe_names from Sysmon EventID=17. FLAG pipe_names with entropy > 95th percentile. COMPARE process_name creating pipes against historical baseline. ALERT if process is not in baseline of pipe-creating processes.,playbooks/attack/enterprise/T1620.yml
T1620: Reflective Code Loading,f8d2b3a1-7e8c-4a6f-8b9d-1c2e3f4a5b6c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,3,Can a machine learning model classify named pipe creation events as benign or suspicious based on features like process context and pipe name characteristics?,"A classification model can automate the detection of novel and sophisticated threats that use reflective code loading. By training on features like process lineage, pipe name entropy, user context, and time of day, the model can identify complex patterns that are difficult to capture with static rules, reducing analyst workload and improving detection accuracy for new C2 frameworks.","Windows Event ID 17; Windows Event ID 18; Windows Event ID 1; Domain Controllers, File Servers, Application Servers, User Workstations",last 90 days,"EXTRACT features (process_name, parent_process_name, pipe_name_entropy, user, time) from Sysmon EventID=17 and 18. INPUT features into trained classification model. ALERT on events classified as suspicious.",playbooks/attack/enterprise/T1620.yml
T1620: Reflective Code Loading,f8d2b3a1-7e8c-4a6f-8b9d-1c2e3f4a5b6c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,4,Does a process command line or PowerShell script block contain keywords or large encoded strings indicative of reflective loading?,"This is a direct hunt for common indicators of in-memory execution. Keywords like `[System.Reflection.Assembly]::Load` or `IEX` are frequently used by adversaries to load assemblies or execute code directly from memory. Large Base64 strings in a command line are a strong indicator of an embedded payload, bypassing on-disk antivirus scanning.","Windows Event ID 4688; Windows Event ID 1; Windows PowerShell Operational Log Event ID 4104; User Workstations, Servers with PowerShell Remoting enabled, Domain Controllers",last 90 days,"SEARCH command_lines (Sysmon EID=1, Win EID=4688) and script_blocks (PS EID=4104) FOR keywords (`IEX`, `Reflection.Assembly`, etc.) OR regex for large Base64 strings.",playbooks/attack/enterprise/T1620.yml
T1620: Reflective Code Loading,f8d2b3a1-7e8c-4a6f-8b9d-1c2e3f4a5b6c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,5,"Is a process being executed with an abnormally long or high-entropy command line argument, suggesting an obfuscated or encoded payload?","Similar to named pipes, high entropy in command lines can reveal obfuscated scripts or encoded payloads. Adversaries use this to hide their code from simple keyword searches. Baselining command line length and entropy per process helps to identify significant deviations that could represent a malicious command.","Windows Event ID 4688; Windows Event ID 1; Windows PowerShell Operational Log Event ID 4104; User Workstations, Servers with PowerShell Remoting enabled, Domain Controllers",last 90 days,CALCULATE entropy and length for command_lines and script_blocks. BASELINE per process_name. ALERT if entropy > 99th percentile OR length > 3 standard deviations from the mean for that process.,playbooks/attack/enterprise/T1620.yml
T1620: Reflective Code Loading,f8d2b3a1-7e8c-4a6f-8b9d-1c2e3f4a5b6c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,6,Can a machine learning model be used to score the likelihood that a command line is malicious based on its characteristics?,"A logistic regression model provides a probabilistic score of maliciousness, which is more nuanced than a binary alert from a simple rule. This allows for better prioritization of alerts for analysts. By combining features like command length, entropy, keyword presence, and parent process, the model can identify suspicious commands with higher confidence and reduce false positives.","Windows Event ID 4688; Windows Event ID 1; Windows PowerShell Operational Log Event ID 4104; User Workstations, Servers with PowerShell Remoting enabled, Domain Controllers",last 90 days,"EXTRACT features (length, entropy, keywords, parent_process) from command line events. INPUT to logistic regression model. PRIORITIZE alerts based on high maliciousness score.",playbooks/attack/enterprise/T1620.yml
T1620: Reflective Code Loading,f8d2b3a1-7e8c-4a6f-8b9d-1c2e3f4a5b6c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,7,"Is a native, non-.NET process, such as notepad.exe or an Office application, loading the .NET Common Language Runtime (CLR)?",Native Windows processes do not typically need the .NET runtime. An adversary may inject code into a trusted process (like svchost.exe) and then load the CLR to execute a managed (.NET) payload from memory. This is a high-fidelity indicator of process injection and defense evasion.,"Windows Event ID 7; Processes on user workstations and servers, especially non-.NET native Windows processes (e.g., notepad.exe, svchost.exe), user-facing applications (e.g., web browsers, Microsoft Office suite), and web server processes.",last 90 days,"SEARCH Sysmon EventID=7 WHERE process_name IN (`notepad.exe`, `svchost.exe`, Office apps, etc.) AND loaded_module IN (`clr.dll`, `mscoree.dll`, etc.).",playbooks/attack/enterprise/T1620.yml
T1620: Reflective Code Loading,f8d2b3a1-7e8c-4a6f-8b9d-1c2e3f4a5b6c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,8,Is a process loading a module that is rarely or never loaded by that process across the enterprise?,"This approach moves beyond a static watchlist to dynamic, environment-specific anomaly detection. By baselining all module loads for each process, you can detect when a process loads an unusual DLL. This could indicate process injection or a DLL hijacking variant used to set up reflective loading.","Windows Event ID 7; Processes on user workstations and servers, especially non-.NET native Windows processes (e.g., notepad.exe, svchost.exe), user-facing applications (e.g., web browsers, Microsoft Office suite), and web server processes.",last 90 days,BUILD baseline of process-module pairs from Sysmon EventID=7 over 30 days. CALCULATE frequency of each pair. ALERT when a new module load event occurs for a pair in the bottom 5th percentile of rarity.,playbooks/attack/enterprise/T1620.yml
T1620: Reflective Code Loading,f8d2b3a1-7e8c-4a6f-8b9d-1c2e3f4a5b6c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,9,Can an anomaly detection model identify abnormal patterns of module loading activity for a given process?,"An autoencoder or similar unsupervised model can learn the complex ""normal"" behavior of a process's module loading activity over time. When an adversary injects code that loads an unusual combination of DLLs, the model will fail to reconstruct this event accurately, resulting in a high anomaly score. This is effective for detecting novel or previously unseen injection techniques.","Windows Event ID 7; Processes on user workstations and servers, especially non-.NET native Windows processes (e.g., notepad.exe, svchost.exe), user-facing applications (e.g., web browsers, Microsoft Office suite), and web server processes.",last 90 days,TRAIN autoencoder model on vectors of module load events (Sysmon EID=7) per process. MONITOR for new events with high reconstruction error. ALERT on high anomaly scores.,playbooks/attack/enterprise/T1620.yml
T1620: Reflective Code Loading,f8d2b3a1-7e8c-4a6f-8b9d-1c2e3f4a5b6c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,10,"Is a process making an outbound network connection to an IP, domain, or TLS fingerprint known to be malicious?","This is a classic threat intelligence matching technique. Correlating internal host logs (Sysmon) with network data (Zeek) and external threat intelligence provides a high-confidence way to detect C2 communications. Matching on JA3/JA3S fingerprints is particularly effective against malware that uses specific TLS libraries, even if the destination IP changes.","Windows Event ID 3; Windows Event ID 1; Zeek conn.log; Zeek dns.log; Zeek ssl.log; Network Egress Points (Firewalls, Proxies), Workstations, Servers hosting sensitive data",last 90 days,"JOIN Sysmon EID=3 with Zeek logs on IP/port/time. QUERY destination_ip, domain, ja3_hash against threat intelligence feeds. ALERT on any match.",playbooks/attack/enterprise/T1620.yml
T1620: Reflective Code Loading,f8d2b3a1-7e8c-4a6f-8b9d-1c2e3f4a5b6c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,11,"Is a process, such as notepad.exe, initiating a network connection when it has no history of doing so, or are its connection characteristics (port, data volume) anomalous?","Reflectively loaded code often needs to establish C2. When this code is injected into a process that normally does not make network connections (e.g., notepad.exe), the connection itself is a major anomaly. Baselining network behavior per process helps identify these outliers, which are strong indicators of compromise.","Windows Event ID 3; Windows Event ID 1; Zeek conn.log; Zeek dns.log; Zeek ssl.log; Network Egress Points (Firewalls, Proxies), Workstations, Servers hosting sensitive data",last 90 days,"BASELINE network behavior (ports, data volume, frequency) per process_name. ALERT if a connection from a process (e.g., notepad.exe) is in the 99.9th percentile of rarity for that process.",playbooks/attack/enterprise/T1620.yml
T1620: Reflective Code Loading,f8d2b3a1-7e8c-4a6f-8b9d-1c2e3f4a5b6c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,12,"Can graph analysis reveal suspicious chains of activity, such as a script execution leading to a legitimate process making a rare external connection?","Attacks are often a sequence of events, not a single one. Graph analysis helps visualize and programmatically detect these chains. A subgraph showing an email attachment -> script execution -> Word -> rare network connection by Word is a powerful visualization and detection method for post-exploitation activity initiated by reflective loading.","Windows Event ID 3; Windows Event ID 1; Zeek conn.log; Zeek dns.log; Zeek ssl.log; Network Egress Points (Firewalls, Proxies), Workstations, Servers hosting sensitive data",last 90 days,"MODEL processes, users, and network connections as a graph. APPLY community detection algorithms. FLAG small, isolated subgraphs that link an initial execution event to a rare network connection.",playbooks/attack/enterprise/T1620.yml
T1620: Reflective Code Loading,f8d2b3a1-7e8c-4a6f-8b9d-1c2e3f4a5b6c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,13,"Is one process accessing the memory of another process and immediately creating a remote thread in it, especially involving high-risk processes?","The sequence of ProcessAccess (Sysmon Event ID 10) followed by CreateRemoteThread (Sysmon Event ID 8) between the same source and target processes is a classic pattern for code injection. The source process writes shellcode into the target's memory and then executes it. Monitoring for this specific sequence, especially when targeting critical processes like lsass.exe, is a high-fidelity detection for this technique.","Windows Event ID 8; Windows Event ID 10; High-value processes (lsass.exe, winlogon.exe, explorer.exe), User workstations, Domain Controllers",last 90 days,CORRELATE Sysmon EID=10 and EID=8 where SourceImage and TargetImage match. TRIGGER alert if EID=8 occurs within 1 second of EID=10. PRIORITIZE alerts where TargetImage is a high-value process.,playbooks/attack/enterprise/T1620.yml
T1620: Reflective Code Loading,f8d2b3a1-7e8c-4a6f-8b9d-1c2e3f4a5b6c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,14,"Is a remote thread being created between a statistically rare pair of processes, or is the thread's start address not mapped to a known module?","While some remote thread creation is legitimate, malicious use often involves unusual process pairs (e.g., WINWORD.EXE targeting svchost.exe). By baselining what is normal, rare pairs can be flagged. Furthermore, a key indicator of reflective loading is when the remote thread's start address is in a private memory region, not an on-disk DLL, which can be checked by analyzing the StartAddress field.","Windows Event ID 8; Windows Event ID 10; High-value processes (lsass.exe, winlogon.exe, explorer.exe), User workstations, Domain Controllers",last 90 days,"CALCULATE rarity of SourceImage-TargetImage pairs from Sysmon EID=8. ALERT on rare pairs. For alerts, CHECK if StartAddress maps to a known on-disk module in the target process. FLAG if it does not.",playbooks/attack/enterprise/T1620.yml
T1620: Reflective Code Loading,f8d2b3a1-7e8c-4a6f-8b9d-1c2e3f4a5b6c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,15,Can a sequence-based machine learning model detect anomalous sequences of process interactions that indicate malicious injection?,"System activity has a natural flow. An LSTM model can learn these normal sequences of events on a host. A malicious injection, like an Office application accessing and creating a thread in a system process, would be a deviation from the learned benign sequences, resulting in a high anomaly score. This helps detect sophisticated attacks that might not trigger rule-based alerts.","Windows Event ID 8; Windows Event ID 10; High-value processes (lsass.exe, winlogon.exe, explorer.exe), User workstations, Domain Controllers",last 90 days,TRAIN LSTM model on sequences of Sysmon events per host. MONITOR new event sequences for high anomaly scores. ALERT on sequences like (ProcessAccess -> CreateRemoteThread) from an unusual parent.,playbooks/attack/enterprise/T1620.yml
T1620: Reflective Code Loading,f8d2b3a1-7e8c-4a6f-8b9d-1c2e3f4a5b6c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,16,"Is a process creating a new thread in its own memory space where the thread's start address is unknown or doesn't map to a signed, on-disk module?","This is a core indicator of reflective code loading where a payload is executed within the host process itself. The key is that the code does not exist on disk. Sysmon indicates this when the StartAddress of the new thread is ""Unknown"" or points to a memory region not associated with a loaded DLL. This is a very strong sign of shellcode execution.","Windows Event ID 8; Windows Event ID 7; All running processes on critical servers and workstations, especially those handling untrusted data (e.g., browsers, email clients, Office applications).",last 90 days,"SEARCH Sysmon EID=8 where SourceImage == TargetImage. For each event, CHECK if StartAddress maps to a loaded module (from EID=7 baseline). ALERT if StartAddress is ""Unknown"" or does not map to a module.",playbooks/attack/enterprise/T1620.yml
T1620: Reflective Code Loading,f8d2b3a1-7e8c-4a6f-8b9d-1c2e3f4a5b6c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,17,Is a process creating a local thread with a start address in a statistically rare memory range?,"Legitimate processes that use techniques like Just-In-Time (JIT) compilation create threads from dynamically allocated memory, but these often fall into predictable memory ranges. By baselining these ranges per-process, it is possible to identify when a new thread starts in a highly unusual location, which could indicate a reflectively loaded payload has been placed there.","Windows Event ID 8; Windows Event ID 7; All running processes on critical servers and workstations, especially those handling untrusted data (e.g., browsers, email clients, Office applications).",last 90 days,"BASELINE common StartAddress ranges for local threads (Sysmon EID=8) per process_name. ALERT if a new thread's StartAddress is in a statistically rare range (e.g., bottom 1st percentile).",playbooks/attack/enterprise/T1620.yml
T1620: Reflective Code Loading,f8d2b3a1-7e8c-4a6f-8b9d-1c2e3f4a5b6c,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0005: Defense Evasion,n; o; n; e,18,Can a machine learning model be trained to differentiate between legitimate and malicious in-process thread creation?,"Differentiating legitimate JIT compilation from malicious shellcode can be complex. A classification model can learn these nuances by using features like the thread's start address, whether it is local, the parent process, and command-line arguments. This allows for more accurate detection of malicious in-memory execution while reducing false positives from benign activity.","Windows Event ID 8; Windows Event ID 7; All running processes on critical servers and workstations, especially those handling untrusted data (e.g., browsers, email clients, Office applications).",last 90 days,"EXTRACT features (is_local_thread, start_address_location, parent_process, cmd_args) from Sysmon EID=8. INPUT to trained XGBoost model. ALERT on events classified as malicious.",playbooks/attack/enterprise/T1620.yml
T1649: Steal or Forge Authentication Certificates,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,1,"Have any processes been executed that match known certificate theft tools, or have any network connections been made using known malicious TLS certificates?","This question aims to detect the direct use of known malicious tools or infrastructure. By matching process file hashes against a threat intelligence watchlist of certificate manipulation tools (like Certipy, Mimikatz, Rubeus) or matching TLS certificate thumbprints against a list of known malicious ones, we can quickly identify confirmed malicious activity.","Windows Event ID 4688; Zeek x509.log; Domain Controllers, Certificate Authority Servers, All Endpoints, Network Egress Points",last 90 days,SIEM Query: JOIN process_creation_events ON process_hash WITH certificate_tool_hash_watchlist. JOIN network_connection_events ON certificate_thumbprint WITH malicious_certificate_watchlist.,playbooks/attack/enterprise/T1649.yml
T1649: Steal or Forge Authentication Certificates,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,2,Is there an anomalous execution frequency of legitimate certificate management tools on any host?,"Adversaries may abuse legitimate system utilities (living-off-the-land) like 'certutil.exe' to perform malicious actions. This question seeks to identify such abuse by baselining the normal execution frequency of these tools per host and flagging significant deviations (e.g., exceeding the 99th percentile), which could indicate reconnaissance or theft activity.","Windows Event ID 4688; Domain Controllers, Certificate Authority Servers, All Endpoints, Network Egress Points",last 90 days,"SIEM Query: COUNT process_executions WHERE process_name IN (certutil.exe, certlm.msc) GROUP BY host, time_window. ALERT IF count > 99th_percentile_baseline.",playbooks/attack/enterprise/T1649.yml
T1649: Steal or Forge Authentication Certificates,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,3,Can we identify suspicious or malicious process executions related to certificate management using a machine learning model?,"This question leverages a supervised machine learning model to proactively identify potentially malicious process executions that may not be caught by simple signature-based rules. By training on features like process name, parent process, command-line entropy, and user context, the model can assign a risk score to new events and flag high-risk activities for analyst review, enabling detection of novel threats.","Windows Event ID 4688; Domain Controllers, Certificate Authority Servers, All Endpoints, Network Egress Points",last 90 days,"ML Model Query: PREDICT risk_score FROM process_execution_features (process_name, parent_process, cmd_entropy, user). ALERT IF risk_score > threshold.",playbooks/attack/enterprise/T1649.yml
T1649: Steal or Forge Authentication Certificates,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,4,"Are there any command-line arguments indicating the use of known certificate enumeration, request, or theft tools?","This question looks for specific, high-fidelity indicators of compromise within command-line logs. By using regular expressions to search for patterns associated with known offensive security tools (like Certipy, Mimikatz, Rubeus), we can detect their usage even if the executable name is changed. A match provides strong evidence of malicious activity.","Windows Event ID 4688; Windows PowerShell Event ID 4104; Domain Controllers, Certificate Authority Servers, All Endpoints with PowerShell/CMD access",last 90 days,"SIEM Query: SEARCH process_creation_events OR powershell_events WHERE command_line MATCHES REGEX ('find -vulnerable', 'auth -pfx', 'crypto::certificates', 'asktgs /pfx').",playbooks/attack/enterprise/T1649.yml
T1649: Steal or Forge Authentication Certificates,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,5,"Are there any command-line executions with unusually high entropy, suggesting obfuscation?",Adversaries often use obfuscation or encoding to hide their commands from simple keyword-based detections. This question aims to uncover such activity by calculating the entropy (randomness) of command-line arguments for common shells. A command with an entropy score significantly higher than the established baseline for a given user/host suggests obfuscation and warrants investigation.,"Windows Event ID 4688; Windows PowerShell Event ID 4104; Domain Controllers, Certificate Authority Servers, All Endpoints with PowerShell/CMD access",last 90 days,"SIEM Query: CALCULATE entropy(command_line) for powershell.exe, cmd.exe, certutil.exe. ALERT IF entropy > (baseline_entropy + 3 * std_dev) for user_host_pair.",playbooks/attack/enterprise/T1649.yml
T1649: Steal or Forge Authentication Certificates,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,6,Can a Natural Language Processing (NLP) model identify novel or obfuscated malicious command lines related to certificate abuse?,"This question proposes using an advanced NLP model to understand the semantic structure and intent of command lines, going beyond simple regex or entropy analysis. By training on a large dataset of benign and malicious commands, the model can classify new, previously unseen command-line variations as suspicious or malicious, providing a powerful defense against evolving attack techniques.","Windows Event ID 4688; Windows PowerShell Event ID 4104; Domain Controllers, Certificate Authority Servers, All Endpoints with PowerShell/CMD access",last 90 days,"ML Model Query: CLASSIFY command_line from events 4688, 4104 using transformer_model. ALERT IF classification is 'suspicious' or 'malicious'.",playbooks/attack/enterprise/T1649.yml
T1649: Steal or Forge Authentication Certificates,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,7,"Have there been any certificate requests that violate security policy, such as by specifying a Subject Alternative Name (SAN) or using a restricted template?","This question targets a specific Active Directory Certificate Services (AD CS) misconfiguration known as ESC1, where an attacker can impersonate privileged accounts by specifying a Subject Alternative Name (SAN) in a certificate request. The query checks for any such requests or requests for highly sensitive templates (like 'Sub-CA') from unauthorized sources, which are critical indicators of an attack.",Windows Event ID 4886; Windows Event ID 4898; Windows Event ID 4887; Active Directory Certificate Authority (CA) Servers,last 90 days,SIEM Query: SEARCH certificate_request_events (4886) WHERE (template_allows_san AND san_is_specified) OR (template IN ('Sub-CA') AND requestor NOT IN (ca_servers)).,playbooks/attack/enterprise/T1649.yml
T1649: Steal or Forge Authentication Certificates,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,8,Have there been any statistically rare certificate requests or an anomalous spike in failed requests from a specific user?,"This question aims to find unusual behavior by baselining normal certificate request patterns. It flags requests that are rare for a given user/machine and template combination, which could indicate an attacker exploring the environment. Additionally, a sudden spike in failed requests from a single user can be a sign of automated probing for misconfigurations or vulnerabilities on the Certificate Authority.",Windows Event ID 4886; Windows Event ID 4898; Windows Event ID 4887; Active Directory Certificate Authority (CA) Servers,last 90 days,"SIEM Query: CALCULATE rarity_score for (requestor, template) pair. ALERT if score is high. SEPARATELY, COUNT failed_requests (4887) by user. ALERT if count > (baseline + 3 * std_dev).",playbooks/attack/enterprise/T1649.yml
T1649: Steal or Forge Authentication Certificates,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,9,Is there an anomalous volume of successful or failed certificate requests for sensitive templates over time?,"This question uses a time-series model to detect automated abuse of the Certificate Authority. By monitoring the volume of successful and failed requests for specific, sensitive templates (e.g., Domain Controller Authentication), the model can identify sudden, anomalous spikes that deviate from normal patterns. Such a spike is a strong indicator of an adversary attempting to mint certificates for privilege escalation.",Windows Event ID 4886; Windows Event ID 4898; Windows Event ID 4887; Active Directory Certificate Authority (CA) Servers,last 90 days,ML Model Query: MONITOR time-series of successful (4898) and failed (4887) requests per template. ALERT if anomalous spike is detected for sensitive templates.,playbooks/attack/enterprise/T1649.yml
T1649: Steal or Forge Authentication Certificates,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,10,Has a cryptographic key been exported by an unauthorized process?,"This question focuses on detecting the direct theft of private keys. It monitors for key export events and correlates them with process creation information to identify the responsible application. An alert is generated if the process performing the export is not on an explicit allow-list of legitimate applications, indicating a high probability of credential theft.","Windows Event ID 5058; Windows Event ID 5059; Windows Event ID 4663; Windows Event ID 4688; All Endpoints and Servers, especially Domain Controllers and Certificate Authority Servers",last 90 days,SIEM Query: JOIN key_export_events (5058) WITH process_creation_events (4688) on ProcessID. ALERT IF process_name NOT IN (key_export_allow_list).,playbooks/attack/enterprise/T1649.yml
T1649: Steal or Forge Authentication Certificates,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,11,"Has a user performed a key export for the first time, or has there been an unusual amount of access to protected key storage directories?","This question seeks to identify anomalous behavior related to key access. It flags two suspicious scenarios: a user exporting a key for the very first time, which is a rare and potentially malicious event; and a process rapidly accessing numerous files in protected key storage directories. The latter can indicate an attempt to enumerate or steal multiple keys at once.","Windows Event ID 5058; Windows Event ID 5059; Windows Event ID 4663; Windows Event ID 4688; All Endpoints and Servers, especially Domain Controllers and Certificate Authority Servers",last 90 days,"SIEM Query: ALERT IF user performs first-time key_export (5058). SEPARATELY, COUNT file_access_events (4663) to crypto_dirs by process. ALERT if count > 98th_percentile.",playbooks/attack/enterprise/T1649.yml
T1649: Steal or Forge Authentication Certificates,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,12,Can an unsupervised machine learning model detect anomalous access to cryptographic keys or protected key storage?,"This question uses an unsupervised model (like Isolation Forest) to learn what constitutes normal key access behavior. By analyzing features like the user, process, target key/file, and time of day, the model can identify rare and unusual combinations of these features. This allows for the detection of novel attack patterns, such as a non-system process accessing machine keys outside of business hours.","Windows Event ID 5058; Windows Event ID 5059; Windows Event ID 4663; Windows Event ID 4688; All Endpoints and Servers, especially Domain Controllers and Certificate Authority Servers",last 90 days,"ML Model Query: DETECT_ANOMALY from key_access_features (user, process, path, time_of_day). ALERT on anomalous events.",playbooks/attack/enterprise/T1649.yml
T1649: Steal or Forge Authentication Certificates,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,13,"Has a privileged account, which is not expected to use certificate-based logon, successfully authenticated using this method?","This question targets a high-risk scenario where a compromised certificate for a privileged or service account is used for an interactive logon. Since these types of accounts rarely, if ever, log on interactively with a certificate, such an event is highly suspicious and could indicate that an attacker has stolen the account's certificate and is using it to move laterally or escalate privileges.","Windows Event ID 4624; Zeek conn.log; Zeek x509.log; Domain Controllers, Authentication Servers (RADIUS/NPS), VPN Concentrators, Network Gateways",last 90 days,"SIEM Query: SEARCH logon_events (4624) WHERE logon_type IN ('Network', 'RemoteInteractive') AND auth_package IN ('Kerberos', 'Schannel_Cert') AND user IN (privileged_user_watchlist).",playbooks/attack/enterprise/T1649.yml
T1649: Steal or Forge Authentication Certificates,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,14,Has a user authenticated with a certificate from a geographically impossible location or a previously unseen network?,"This question aims to detect credential theft by analyzing the geographic and network origin of certificate-based logons. By profiling a user's typical logon locations and source networks (ASNs), we can flag authentications that are physically impossible ('impossible travel') or originate from a network never before used by that user. This is a strong indicator that the user's certificate has been stolen and is being used from an attacker-controlled system.","Windows Event ID 4624; Zeek conn.log; Zeek x509.log; Domain Controllers, Authentication Servers (RADIUS/NPS), VPN Concentrators, Network Gateways",last 90 days,"SIEM Query: ON new_logon, CALCULATE travel_speed from previous_logon_location. ALERT IF speed > impossible_threshold. ALSO, ALERT IF source_ASN is new for user.",playbooks/attack/enterprise/T1649.yml
T1649: Steal or Forge Authentication Certificates,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,15,Has a user's certificate authentication behavior significantly deviated from that of their organizational peers?,"This question uses peer group analysis to identify anomalous behavior that might be normal for an individual but is strange compared to their colleagues. The model groups users by role (e.g., HR, Engineering) and learns the normal authentication patterns for each group. An alert is raised if a user's activity, such as an HR employee using a certificate to authenticate to a developer server, deviates significantly from their peer group's norm, suggesting a compromised account or certificate.","Windows Event ID 4624; Zeek conn.log; Zeek x509.log; Domain Controllers, Authentication Servers (RADIUS/NPS), VPN Concentrators, Network Gateways",last 90 days,"ML Model Query: CLUSTER users into peer_groups. ON new_authentication, CALCULATE distance from user_behavior to peer_group_centroid. ALERT IF distance > threshold.",playbooks/attack/enterprise/T1649.yml
T1649: Steal or Forge Authentication Certificates,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,16,"Has a certificate file (.pfx, .pem, etc.) been created in a sensitive or unusual directory by an unauthorized process?","This question focuses on detecting the staging of stolen certificates for exfiltration. By enabling file system auditing on common staging areas (like temp folders) and other sensitive locations, we can monitor for the creation of certificate files. An alert is triggered if the process writing the file is not an approved application (like a web browser or certificate client), suggesting an attacker is preparing to steal the certificate.","Windows Event ID 4663; Windows Event ID 4688; Zeek conn.log; Zeek files.log; User Workstations, File Servers, Web Servers, Network Egress Points",last 90 days,"SIEM Query: SEARCH file_write_events (4663) WHERE file_extension IN (.pfx, .p12, .pem) AND target_dir IN (staging_dirs). ALERT IF process_name NOT IN (allow_list).",playbooks/attack/enterprise/T1649.yml
T1649: Steal or Forge Authentication Certificates,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,17,Is there an anomalously high volume of certificate files being transferred outbound over the network?,"This question aims to detect the exfiltration of certificate files by monitoring network traffic. By analyzing file transfer logs (like Zeek's files.log) and baselining the normal volume of certificate-related MIME types being sent outbound, we can detect significant spikes. An alert on a volume exceeding a dynamic threshold (e.g., 95th percentile) indicates a potential mass exfiltration of stolen certificates.","Windows Event ID 4663; Windows Event ID 4688; Zeek conn.log; Zeek files.log; User Workstations, File Servers, Web Servers, Network Egress Points",last 90 days,"SIEM Query: COUNT outbound_transfers where mime_type IN (pkcs12, x509-cert) GROUP BY hour. ALERT IF count > 95th_percentile_baseline.",playbooks/attack/enterprise/T1649.yml
T1649: Steal or Forge Authentication Certificates,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0006: Credential Access,n; o; n; e,18,Has a process been observed writing a certificate file and immediately initiating an outbound network transfer of that file?,"This question seeks to identify the full 'steal and exfiltrate' attack chain with high confidence by linking discrete events into a single narrative. A sequence analysis model looks for a specific pattern within a short time window: the same process first writing a certificate file to disk, then making an outbound network connection, and then a certificate file being detected on that connection. This sequence is a very strong indicator of active certificate theft and exfiltration.","Windows Event ID 4663; Windows Event ID 4688; Zeek conn.log; Zeek files.log; User Workstations, File Servers, Web Servers, Network Egress Points",last 90 days,"SIEM Query: DETECT sequence for a single process: (1) file_write with .pfx extension (4663), THEN (2) outbound_network_connection (conn.log), THEN (3) file_transfer with cert_mime_type (files.log) within 2 minutes.",playbooks/attack/enterprise/T1649.yml
T1666: Modify Cloud Resource Hierarchy,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",T; A; 0; 0; 0; 5; :;  ; D; e; f; e; n; s; e;  ; E; v; a; s; i; o; n,n; o; n; e,1,How can I create a correlation rule to detect the execution of a known offensive cloud tool followed by a connection to a known C2 server?,"This question aims to identify a common attack pattern where an adversary uses a specialized tool to interact with cloud environments and then communicates with their command-and-control infrastructure. By correlating endpoint process events with network connection logs within a short time frame, we can detect this specific sequence of malicious activity with high confidence.","Windows Event ID 4688; Zeek conn.log; Zeek dns.log; Endpoint event logs from administrative workstations, developer workstations, and CI/CD servers; Network traffic logs from internet gateways and VPN concentrators",last 90 days,{'pseudocode': 'SEARCH Windows Event ID 4688\nWHERE (ProcessHash IN offensive_tool_hashes OR CommandLine CONTAINS offensive_tool_strings)\nJOIN (SEARCH Zeek conn.log WHERE DestinationIP IN c2_watchlist)\nON SourceHost\nWHERE time_difference <= 10 minutes\n'},playbooks/attack/enterprise/T1666.yml
T1666: Modify Cloud Resource Hierarchy,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",T; A; 0; 0; 0; 5; :;  ; D; e; f; e; n; s; e;  ; E; v; a; s; i; o; n,n; o; n; e,2,How can I use statistical analysis to detect potential C2 communication via domain generation algorithms (DGA) when a cloud CLI tool is executed?,"This question focuses on detecting C2 channels that use domain generation algorithms (DGAs) to evade static blocklists. By baselining the normal DNS query entropy for hosts running cloud tools, we can spot statistical anomalies. A high-entropy domain query co-occurring with cloud tool usage is a strong indicator of an adversary using DGA for C2 communications.","Windows Event ID 4688; Zeek conn.log; Zeek dns.log; Endpoint event logs from administrative workstations, developer workstations, and CI/CD servers; Network traffic logs from internet gateways and VPN concentrators",last 90 days,{'pseudocode': 'SEARCH Zeek dns.log AND Windows Event ID 4688\nGROUP BY SourceHost\nCALCULATE baseline_entropy(domain) for each host\nALERT WHEN event=cloud_cli_execution AND entropy(new_domain) > 98th_percentile(baseline_entropy)\n'},playbooks/attack/enterprise/T1666.yml
T1666: Modify Cloud Resource Hierarchy,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",T; A; 0; 0; 0; 5; :;  ; D; e; f; e; n; s; e;  ; E; v; a; s; i; o; n,n; o; n; e,3,How can a machine learning model be used to predict malicious cloud activity based on process execution and network data?,"This question explores an advanced detection method using a Random Forest classifier. By training a model on various features from both endpoint process events and network connection logs, the system can learn the complex patterns of malicious behavior. This approach can identify novel or subtle attacks that may not match specific rules or statistical thresholds, triggering an alert when the model's confidence in a malicious prediction is high.","Windows Event ID 4688; Zeek conn.log; Zeek dns.log; Endpoint event logs from administrative workstations, developer workstations, and CI/CD servers; Network traffic logs from internet gateways and VPN concentrators",last 90 days,{'pseudocode': 'EXTRACT features from Windows Event ID 4688 and correlated Zeek conn.log\nINPUT features into trained_random_forest_model\nALERT WHEN model_prediction_score > 0.9\n'},playbooks/attack/enterprise/T1666.yml
T1666: Modify Cloud Resource Hierarchy,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",T; A; 0; 0; 0; 5; :;  ; D; e; f; e; n; s; e;  ; E; v; a; s; i; o; n,n; o; n; e,4,How can I create a SIEM rule to detect when a sensitive cloud hierarchy modification command is run by a user not in the 'Cloud Administrators' group?,"This question addresses the insider threat or privilege escalation scenario where a non-administrative user executes a powerful command to alter the cloud organization structure. By creating a high-severity alert that checks the command line against a watchlist and verifies the user's group membership, security teams can immediately respond to unauthorized and high-risk activity.","Windows Event ID 4688; Active Directory Logs; Zeek conn.log; Administrative workstations, CI/CD pipeline servers, Bastion hosts, and servers with cloud management SDKs installed",last 90 days,"{'pseudocode': ""SEARCH Windows Event ID 4688\nWHERE CommandLine IN sensitive_cloud_command_list\nENRICH with UserGroup from Active Directory\nALERT WHEN UserGroup NOT IN ('Cloud Administrators')\n""}",playbooks/attack/enterprise/T1666.yml
T1666: Modify Cloud Resource Hierarchy,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",T; A; 0; 0; 0; 5; :;  ; D; e; f; e; n; s; e;  ; E; v; a; s; i; o; n,n; o; n; e,5,How can statistical analysis of command execution times identify anomalous behavior by authorized cloud administrators?,"This question aims to detect compromised administrator accounts. Even if a user is authorized, their behavior might be anomalous. By establishing a baseline of normal working hours and command frequency for each administrator, we can flag activity that deviates significantly, such as a command run late at night or an unusually high number of sensitive commands, which could indicate an account takeover.","Windows Event ID 4688; Active Directory Logs; Zeek conn.log; Administrative workstations, CI/CD pipeline servers, Bastion hosts, and servers with cloud management SDKs installed",last 90 days,"{'pseudocode': ""FOR each user in 'Cloud Administrators'\nCALCULATE baseline_activity_hours and baseline_command_frequency\nSEARCH Windows Event ID 4688 for sensitive commands\nALERT IF execution_time is > 3_std_dev from baseline_hours OR daily_frequency > 99th_percentile\n""}",playbooks/attack/enterprise/T1666.yml
T1666: Modify Cloud Resource Hierarchy,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",T; A; 0; 0; 0; 5; :;  ; D; e; f; e; n; s; e;  ; E; v; a; s; i; o; n,n; o; n; e,6,How can a sequence analysis model detect anomalous administrative command workflows?,"This question focuses on the context and order of operations. Benign administrative tasks often follow a predictable sequence. A machine learning model like an LSTM can be trained on these normal sequences. An alert for a sensitive command that appears in an unusual sequence (e.g., without preceding setup commands) can indicate that an adversary is executing it out of context as part of an attack.","Windows Event ID 4688; Active Directory Logs; Zeek conn.log; Administrative workstations, CI/CD pipeline servers, Bastion hosts, and servers with cloud management SDKs installed",last 90 days,{'pseudocode': 'CAPTURE command sequences from Windows Event ID 4688\nINPUT sequence into trained_LSTM_model\nALERT IF probability of observed_sequence is below benign_threshold\n'},playbooks/attack/enterprise/T1666.yml
T1666: Modify Cloud Resource Hierarchy,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",T; A; 0; 0; 0; 5; :;  ; D; e; f; e; n; s; e;  ; E; v; a; s; i; o; n,n; o; n; e,7,How can I implement a SIEM rule to detect cloud CLI tool execution following a login from an unapproved country?,"This question addresses the threat of account access from geographically suspicious locations. By correlating a cloud tool process execution with the user's most recent network logon event, we can check the source IP's geolocation. An execution following a login from a country not on the approved list for that user's role is a strong indicator of a compromised account or unauthorized remote access.","Windows Event ID 4688; Windows Event ID 4624; Zeek conn.log; All corporate endpoints and servers with cloud SDKs/CLIs installed, VPN access logs, Domain Controllers, and network egress points",last 90 days,"{'pseudocode': ""SEARCH Windows Event ID 4688 for cloud_cli_tool\nGET user from event\nFIND latest Windows Event ID 4624 (Logon Type 3 or 10) for that user\nENRICH with SourceIP and geo-location\nALERT IF geo-location NOT IN approved_country_list for user's role\n""}",playbooks/attack/enterprise/T1666.yml
T1666: Modify Cloud Resource Hierarchy,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",T; A; 0; 0; 0; 5; :;  ; D; e; f; e; n; s; e;  ; E; v; a; s; i; o; n,n; o; n; e,8,How can I use statistical user profiling to detect cloud CLI usage following a login from an anomalous source or at an unusual time?,"This question provides a more nuanced approach than static country lists. By building a historical profile for each user's typical login sources (IP subnets/ASNs) and times, we can detect deviations. A cloud CLI command executed after a login from a never-before-seen network or at a time that is statistically abnormal for that user (e.g., 3 AM) raises a strong suspicion of account misuse.","Windows Event ID 4688; Windows Event ID 4624; Zeek conn.log; All corporate endpoints and servers with cloud SDKs/CLIs installed, VPN access logs, Domain Controllers, and network egress points",last 90 days,"{'pseudocode': 'FOR each user\nPROFILE historical source ASNs and login times from Windows Event ID 4624\nON cloud_cli_execution (EID 4688), check preceding login (EID 4624)\nALERT IF login_ASN is new for user OR login_time is in bottom 5th percentile of activity\n'}",playbooks/attack/enterprise/T1666.yml
T1666: Modify Cloud Resource Hierarchy,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",T; A; 0; 0; 0; 5; :;  ; D; e; f; e; n; s; e;  ; E; v; a; s; i; o; n,n; o; n; e,9,How can a time-series model detect anomalous bulk operations against cloud management APIs?,"This question aims to detect large-scale, potentially malicious activity by monitoring network traffic volume. Adversaries modifying a cloud hierarchy might perform many actions in a short period. A time-series model can predict the expected volume of traffic to cloud management endpoints. A significant, unexplained spike in this traffic can trigger an alert for investigation, even if individual actions appear legitimate.","Windows Event ID 4688; Windows Event ID 4624; Zeek conn.log; All corporate endpoints and servers with cloud SDKs/CLIs installed, VPN access logs, Domain Controllers, and network egress points",last 90 days,{'pseudocode': 'AGGREGATE Zeek conn.log traffic to cloud_mgmt_endpoints by hour\nINPUT into trained_SARIMA_model\nALERT IF observed_traffic > predicted_upper_confidence_interval\n'},playbooks/attack/enterprise/T1666.yml
T1666: Modify Cloud Resource Hierarchy,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",T; A; 0; 0; 0; 5; :;  ; D; e; f; e; n; s; e;  ; E; v; a; s; i; o; n,n; o; n; e,10,How can I create a stateful correlation rule to detect credential access followed by scripted access to cloud APIs?,"This question identifies a common attacker workflow: steal credentials, then use them. This rule looks for a specific sequence: a process accessing local cloud credential files, followed by a scripting engine (like PowerShell or Python) starting up and making a network connection to a cloud API. Detecting this entire chain of events on one host within a short window provides strong evidence of a credential theft and use attack.","Windows Event ID 4688; Zeek conn.log; Developer workstations, Administrator workstations, servers hosting automation scripts, and CI/CD runners",last 90 days,"{'pseudocode': 'SEARCH for Event A: Windows EID 4688 with commandline accessing cloud_credential_paths\nIF found, SEARCH on same host for Event B: Windows EID 4688 for scripting_engine_process within 30 mins\nIF found, SEARCH on same host for Event C: Zeek conn.log to cloud_api_endpoint\nALERT if all three events occur in sequence\n'}",playbooks/attack/enterprise/T1666.yml
T1666: Modify Cloud Resource Hierarchy,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",T; A; 0; 0; 0; 5; :;  ; D; e; f; e; n; s; e;  ; E; v; a; s; i; o; n,n; o; n; e,11,How can command line entropy be used to detect obfuscated or malicious scripts connecting to cloud APIs?,"This question focuses on identifying malicious scripts that are obfuscated to avoid signature-based detection. Legitimate scripts often have predictable, low-entropy command lines. Adversaries may use heavily obfuscated, randomized, or one-line commands, which have high entropy. By calculating the entropy of the command line for scripting processes that connect to cloud APIs and alerting on statistical outliers, we can uncover these hidden threats.","Windows Event ID 4688; Zeek conn.log; Developer workstations, Administrator workstations, servers hosting automation scripts, and CI/CD runners",last 90 days,{'pseudocode': 'SEARCH Windows Event ID 4688 for scripting_engine processes\nCORRELATE with Zeek conn.log to cloud_api_endpoints\nCALCULATE shannon_entropy of CommandLine field\nALERT IF entropy_score > 95th percentile\n'},playbooks/attack/enterprise/T1666.yml
T1666: Modify Cloud Resource Hierarchy,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",T; A; 0; 0; 0; 5; :;  ; D; e; f; e; n; s; e;  ; E; v; a; s; i; o; n,n; o; n; e,12,How can a Hidden Markov Model (HMM) be used to detect a malicious sequence of administrative actions?,"This question proposes modeling administrative workflows as a sequence of states (e.g., 'Read Config', 'Run Script', 'Connect to API'). An HMM can be trained on countless benign sequences to learn the normal probability of transitioning from one state to another. When a new sequence of events is observed that has a very low probability of occurring under the benign model, it can be flagged as a potentially malicious and anomalous workflow.","Windows Event ID 4688; Zeek conn.log; Developer workstations, Administrator workstations, servers hosting automation scripts, and CI/CD runners",last 90 days,"{'pseudocode': 'MODEL event sequences (EID 4688, Zeek conn.log) as states\nINPUT observed sequence into trained_HMM\nALERT IF probability of sequence < low_threshold\n'}",playbooks/attack/enterprise/T1666.yml
T1666: Modify Cloud Resource Hierarchy,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",T; A; 0; 0; 0; 5; :;  ; D; e; f; e; n; s; e;  ; E; v; a; s; i; o; n,n; o; n; e,13,How can I create a correlation rule to detect when cloud hierarchy modification is paired with defense evasion techniques?,"This question aims to detect an adversary who is actively trying to cover their tracks. The execution of a sensitive cloud command is suspicious, but its co-occurrence with actions like clearing event logs (Event ID 1102) or stopping security services (Event ID 7040) on the same host within minutes is a critical finding. This combination strongly indicates malicious intent and should trigger a high-priority alert.","Windows Event ID 4688; Windows Event ID 1102; Windows Event ID 7040; Endpoint event logs on administrative workstations and servers, Domain Controller security logs, and centralized logging infrastructure",last 90 days,"{'pseudocode': 'SEARCH for Event A: EID 4688 with sensitive_cloud_command\nSEARCH on same host for Event B: EID 1102 OR EID 7040 (security service) OR EID 4688 (wevtutil.exe, sc.exe)\nALERT IF Event B occurs within 5 minutes of Event A\n'}",playbooks/attack/enterprise/T1666.yml
T1666: Modify Cloud Resource Hierarchy,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",T; A; 0; 0; 0; 5; :;  ; D; e; f; e; n; s; e;  ; E; v; a; s; i; o; n,n; o; n; e,14,How can we use the statistical rarity of defense evasion commands to escalate the risk of subsequent cloud commands?,"This question uses defense evasion as a risk primer. Commands to clear logs or stop services are statistically very rare on normally functioning systems. Their execution should immediately elevate the risk score of a host. If a cloud hierarchy modification command is then executed from that same high-risk host within the next hour, the event should be escalated to a critical alert, as the context strongly suggests a malicious actor is at work.","Windows Event ID 4688; Windows Event ID 1102; Windows Event ID 7040; Endpoint event logs on administrative workstations and servers, Domain Controller security logs, and centralized logging infrastructure",last 90 days,"{'pseudocode': 'SEARCH for defense_evasion_command (e.g., wevtutil cl)\nIF found, assign high_risk_score to host for 1 hour\nSEARCH for sensitive_cloud_command\nIF source host has high_risk_score, ESCALATE to critical alert\n'}",playbooks/attack/enterprise/T1666.yml
T1666: Modify Cloud Resource Hierarchy,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",T; A; 0; 0; 0; 5; :;  ; D; e; f; e; n; s; e;  ; E; v; a; s; i; o; n,n; o; n; e,15,How can a machine learning model classify a host as being in a 'Defense Evasion State' to prioritize subsequent alerts?,"This question proposes a proactive, state-based risk assessment. A classification model can be trained to recognize when a host is exhibiting a pattern of defense evasion activities. If the model classifies a host as being in this state, any subsequent administrative actions, particularly sensitive cloud commands, originating from it within a set time window can be automatically escalated. This allows analysts to focus on events that are already contextualized with a high degree of suspicion.","Windows Event ID 4688; Windows Event ID 1102; Windows Event ID 7040; Endpoint event logs on administrative workstations and servers, Domain Controller security logs, and centralized logging infrastructure",last 90 days,"{'pseudocode': ""EXTRACT features (e.g., count of wevtutil, EID 1102) from host logs\nINPUT features into trained_classifier_model\nIF prediction is 'Host Defense Evasion State'\nTHEN for next 60 mins, ESCALATE priority of all cloud admin commands from this host""}",playbooks/attack/enterprise/T1666.yml
T1672: Email Spoofing,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,1,Are any inbound emails originating from source IPs or containing header domains that are on a high-confidence list of malicious indicators?,"This question aims to detect emails from known malicious infrastructure. By comparing the source IP and key email header domains ('From', 'Reply-To', 'Return-Path') against a trusted threat intelligence list, analysts can quickly identify and triage emails associated with active phishing or malware campaigns. A match provides a strong signal that the email is part of a malicious attack.
",Zeek smtp.log; Zeek conn.log; DMZ network segment hosting email gateways; Network perimeter firewalls; Threat Intelligence Platform API endpoint,last 90 days,": FOR each inbound_email in last 90 days
GET source_ip, from_domain, reply_to_domain, return_path_domain
IF source_ip OR from_domain OR reply_to_domain OR return_path_domain IN malicious_indicator_list THEN
  ALERT
ENDIF
",playbooks/attack/enterprise/T1672.yml
T1672: Email Spoofing,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,2,Do any inbound emails have an aggregated threat intelligence risk score that exceeds the established threshold for known-bad indicators?,"This question moves beyond simple blocklists to use a more nuanced risk-based approach. By aggregating reputation scores for the sender's IP and domain from multiple threat intelligence feeds, we can identify suspicious emails that might not appear on a single high-confidence list. Calculating a weighted average and comparing it to a threshold based on historical data of known malicious indicators helps to flag emails that are statistically likely to be malicious.
",Zeek smtp.log; Zeek conn.log; DMZ network segment hosting email gateways; Network perimeter firewalls; Threat Intelligence Platform API endpoint,last 90 days,": FOR each inbound_email
GET source_ip, sender_domain
CALCULATE weighted_risk_score from threat_intel_feeds
IF weighted_risk_score > threshold (85th percentile of known-bad) THEN
  ALERT
ENDIF
",playbooks/attack/enterprise/T1672.yml
T1672: Email Spoofing,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,3,Has our machine learning model identified any inbound emails with a high probability of being malicious based on their features?,"This question leverages a supervised machine learning model to provide predictive analysis. The model is trained on a labeled dataset of good and bad emails, using features like ASN, sender domain age, and threat intelligence scores. It can identify complex, non-linear patterns that simple rules or scoring might miss, allowing for the detection of novel or sophisticated spoofing attempts in real-time.
",Zeek smtp.log; Zeek conn.log; DMZ network segment hosting email gateways; Network perimeter firewalls; Threat Intelligence Platform API endpoint,last 90 days,": FOR each new inbound_email
EXTRACT features (ASN, domain_age, etc.)
PREDICT malicious_probability with ML_model
IF probability > 0.90 THEN
  ALERT
ENDIF
",playbooks/attack/enterprise/T1672.yml
T1672: Email Spoofing,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,4,"Are there any inbound emails from high-value domains that are failing SPF or DKIM authentication, or originating from domains with a weak DMARC policy?","This question targets a common spoofing tactic where an attacker impersonates a trusted internal or partner domain. SPF and DKIM are authentication mechanisms designed to prevent this. An authentication failure from a high-value domain is a strong indicator of a spoofing attempt. Additionally, identifying emails from domains with a weak DMARC policy (`p=none`) is important, as it signals that the domain owner is not enforcing email authentication, making it an easier target for spoofing.
",Zeek smtp.log; Zeek dns.log; Email security gateway; Corporate DNS resolvers; Directory of trusted partner domains,last 90 days,": FOR each inbound_email
GET from_domain, spf_result, dkim_result, dmarc_policy
IF (from_domain IN high_value_list AND (spf_result == 'fail' OR dkim_result == 'fail')) THEN
  HIGH_SEVERITY_ALERT
ENDIF
IF (from_domain IN high_value_list AND dmarc_policy == 'p=none') THEN
  LOW_SEVERITY_ALERT
ENDIF
",playbooks/attack/enterprise/T1672.yml
T1672: Email Spoofing,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,5,Has the daily rate of SPF/DKIM authentication failures for any external sender domain significantly exceeded its historical baseline?,"This question aims to detect anomalies in authentication failure patterns. A sudden spike in SPF/DKIM failures from a specific domain, even if it's not a high-value one, could indicate the beginning of a larger spoofing campaign targeting that domain. By comparing the current day's failure rate to a statistical threshold (95th percentile) of its 30-day history, we can spot abnormal activity that might be missed by per-email rules.
",Zeek smtp.log; Zeek dns.log; Email security gateway; Corporate DNS resolvers; Directory of trusted partner domains,last 90 days,": FOR each sender_domain
CALCULATE daily_failure_rate
CALCULATE historical_95th_percentile_failure_rate
IF daily_failure_rate > historical_95th_percentile_failure_rate THEN
  ALERT
ENDIF
",playbooks/attack/enterprise/T1672.yml
T1672: Email Spoofing,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,6,"Is there a time-series anomaly in the hourly count of SPF/DKIM failures for any high-value sender domain, suggesting a targeted campaign?","This question uses a more advanced time-series model to detect sophisticated, targeted attacks. A spoofing campaign might manifest as a sudden, sharp increase in authentication failures that deviates from normal daily or weekly email patterns. By applying a model like Seasonal-Hybrid ESD, we can account for normal business seasonality and isolate true anomalies, providing a high-fidelity alert for potential targeted spoofing campaigns.
",Zeek smtp.log; Zeek dns.log; Email security gateway; Corporate DNS resolvers; Directory of trusted partner domains,last 90 days,": FOR each high_value_domain
APPLY time_series_model to hourly_auth_failure_count
IF current_count > forecasted_range THEN
  ALERT
ENDIF
",playbooks/attack/enterprise/T1672.yml
T1672: Email Spoofing,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,7,"Are we receiving emails where the friendly 'From' header domain is a trusted entity, but the envelope 'MAIL FROM' domain does not match?","This question looks for a classic spoofing indicator: a mismatch between the human-readable 'From' address (RFC5322) and the technical 'MAIL FROM' address used in the SMTP transaction (RFC5321). Attackers often spoof the friendly 'From' to appear as a trusted source (e.g., your own company) while the underlying envelope sender is a malicious domain. This check is crucial for catching impersonations of internal or high-value partner domains.
",Zeek smtp.log; Mail Transfer Agent (MTA) logs; Email security gateway inspection point,last 90 days,": FOR each inbound_email
GET from_domain, mailfrom_domain
IF (tld_plus_one(from_domain) != tld_plus_one(mailfrom_domain)) AND (from_domain IN high_value_list) THEN
  ALERT
ENDIF
",playbooks/attack/enterprise/T1672.yml
T1672: Email Spoofing,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,8,"For emails claiming to be from a trusted domain, is the combination of the 'From' domain and 'MAIL FROM' domain a new or very infrequent pairing?","This question uses historical data to establish a baseline of normal sender behavior. Legitimate services sending email on behalf of a trusted domain (e.g., a marketing platform) will create consistent ('From', 'MAIL FROM') pairs. A spoofed email is likely to introduce a new or rare pair. By flagging pairs that have never been seen or are in the bottom 5th percentile of frequency, we can identify suspicious sender relationships that might indicate a spoofing attempt.
",Zeek smtp.log; Mail Transfer Agent (MTA) logs; Email security gateway inspection point,last 90 days,": FOR each inbound_email from trusted_domain
GET from_domain, mailfrom_domain
CHECK frequency of (from_domain, mailfrom_domain) pair in last 90 days
IF pair is new OR frequency < 5th_percentile THEN
  ALERT
ENDIF
",playbooks/attack/enterprise/T1672.yml
T1672: Email Spoofing,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,9,Is our autoencoder model detecting an anomalous 'MAIL FROM' domain for an email purporting to be from a high-value 'From' domain?,"This question applies an unsupervised machine learning approach to detect abnormal sender relationships. An autoencoder is trained to learn the 'normal' set of envelope senders ('MAIL FROM' domains) for a specific high-value 'From' domain. When a new email arrives, the model attempts to reconstruct its 'MAIL FROM' domain. A high reconstruction error signifies that the domain is unlike any legitimate sender seen in the training data, strongly indicating it is an anomaly and likely spoofed.
",Zeek smtp.log; Mail Transfer Agent (MTA) logs; Email security gateway inspection point,last 90 days,": FOR each new_email from high_value_domain
GET mailfrom_domain
CALCULATE reconstruction_error using trained_autoencoder
IF reconstruction_error > threshold THEN
  ALERT
ENDIF
",playbooks/attack/enterprise/T1672.yml
T1672: Email Spoofing,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,10,"Has any single source IP sent an unusually large number of emails (e.g., >100) in a short time frame (e.g., 5 minutes) while purporting to be from a trusted domain?","This question aims to detect bulk email spoofing campaigns. A common attacker tactic is to send a high volume of spoofed emails from a single compromised machine or server in a short burst. By using a simple sliding window and a static threshold, we can quickly identify these high-volume sending events that are characteristic of a spam or phishing campaign impersonating a trusted entity.
",,last 90 days,": FOR each trusted_from_domain
COUNT emails per source_ip in 5_minute_window
IF count > 100 THEN
  ALERT
ENDIF
",playbooks/attack/enterprise/T1672.yml
T1672: Email Spoofing,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,11,"Has the email volume from any specific (Source IP, From Domain) pair exceeded its historical average by a statistically significant amount (e.g., Z-score > 3)?","This question refines the volume analysis by creating a dynamic, per-sender baseline. A static threshold might not be suitable for all senders. By calculating the mean and standard deviation of email volume for each (Source IP, From Domain) pair, we can detect statistically significant deviations. A Z-score greater than 3 indicates a rare event (less than 0.3% probability in a normal distribution), providing a more reliable alert for abnormal sending volume.
",Zeek smtp.log; Zeek conn.log; Network flow data collectors at the internet gateway; Email gateway transaction logs,last 90 days,": FOR each (source_ip, from_domain) pair
CALCULATE mean and std_dev of volume over 30 days
CALCULATE current_10_min_volume
IF Z-score(current_volume) > 3 THEN
  ALERT
ENDIF
",playbooks/attack/enterprise/T1672.yml
T1672: Email Spoofing,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,12,"After accounting for normal trends and seasonality, is there an unexplained residual spike in the hourly email volume for any high-volume (Source IP, From Domain) pair?","This question uses advanced time-series analysis to detect volume-based anomalies in complex environments. For high-volume senders, email traffic often has predictable daily and weekly patterns (seasonality). A time-series decomposition model can separate these normal patterns from the underlying trend and random residual noise. An alert on a large residual value means there's a volume spike that cannot be explained by normal business cycles, pointing to a potential spoofing campaign.
",Zeek smtp.log; Zeek conn.log; Network flow data collectors at the internet gateway; Email gateway transaction logs,last 90 days,": FOR each high_volume (source_ip, from_domain) pair
DECOMPOSE hourly_email_count_series
MONITOR residual_component
IF residual > dynamic_threshold THEN
  ALERT
ENDIF
",playbooks/attack/enterprise/T1672.yml
T1672: Email Spoofing,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,13,Did an email claiming to be from a critical internal or partner domain originate from a country or network (ASN) that is not on our explicit allow-list for that domain?,"This question implements a strict, high-confidence rule for the most critical domains. For your own domain or key financial partners, you likely know the legitimate geographic locations and network providers (ASNs) they send email from. By maintaining an explicit allow-list of these sources, any email that purports to be from that domain but originates from an unapproved source is highly suspicious and should be treated as a high-severity incident.
",Zeek smtp.log; Zeek conn.log; Internet gateway routers; Subscription-based GeoIP and ASN databases,last 90 days,": FOR each inbound_email from critical_domain
GET source_country, source_asn
IF source_country NOT IN allow_list OR source_asn NOT IN allow_list THEN
  HIGH_SEVERITY_ALERT
ENDIF
",playbooks/attack/enterprise/T1672.yml
T1672: Email Spoofing,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,14,"For a given trusted sender domain, did an inbound email originate from a source ASN or country that has never been seen before or is statistically rare?","This question identifies deviations from established communication patterns without needing a rigid allow-list. Over time, a trusted domain builds a profile of typical source countries and ASNs. A spoofed email will often originate from an anomalous source. By flagging emails from new or statistically rare (high Shannon entropy) source locations for a given domain, we can detect suspicious changes in origination patterns that may indicate a spoofing attempt.
",Zeek smtp.log; Zeek conn.log; Internet gateway routers; Subscription-based GeoIP and ASN databases,last 90 days,": FOR each inbound_email from trusted_domain
GET source_asn
CHECK historical_profile_of_asns_for_domain
IF source_asn is new OR statistically_rare THEN
  ALERT
ENDIF
",playbooks/attack/enterprise/T1672.yml
T1672: Email Spoofing,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0005: Defense Evasion,n; o; n; e,15,Does the source IP of an email from a high-value domain fall outside the normal 'clusters' of legitimate sending infrastructure identified by our density-based clustering model?,"This question uses an unsupervised machine learning model to define 'normal' sending infrastructure based on multiple features like ASN, country, and IP reputation. The HDBSCAN algorithm can identify dense clusters of legitimate source IPs. An email originating from an IP that the model classifies as 'noise' or that falls far from any established cluster is considered a spatial anomaly. This method is effective at identifying outlier sources that don't fit the profile of legitimate senders for that domain.
",Zeek smtp.log; Zeek conn.log; Internet gateway routers; Subscription-based GeoIP and ASN databases,last 90 days,": FOR each new_email from high_value_domain
GET source_ip_features
SCORE proximity to normal_clusters using HDBSCAN_model
IF score is 'noise' or far_from_clusters THEN
  ALERT
ENDIF",playbooks/attack/enterprise/T1672.yml
T1674: Input Injection,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,1,"Are process command lines, DNS queries, or HTTP requests matching known malicious indicators associated with input injection?","This question aims to identify direct evidence of malicious activity by matching observable data (command lines, DNS, HTTP traffic) against a threat intelligence feed curated for input injection IOCs. A match is a high-confidence signal that a known malicious command or connection has occurred on the network.",Windows Event ID 4688; Zeek dns.log; Zeek http.log; Endpoint Fleet; DNS Resolvers; Network Egress Points,last 90 days,": SEARCH process_events, dns_logs, http_logs | JOIN threat_intel_feed ON (command_line=ioc OR dns_query=ioc OR http_host=ioc OR http_uri=ioc) WHERE ioc_tag = 'Input Injection'",playbooks/attack/enterprise/T1674.yml
T1674: Input Injection,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,2,"Has there been an anomalous spike in the number of IOC matches related to input injection, suggesting a widespread attack?","This question moves beyond single IOC hits to detect broader campaigns. By establishing a baseline of normal IOC match frequency, a sudden, statistically significant increase (e.g., three standard deviations above the mean) can signal a large-scale, coordinated attack that might otherwise be lost in the noise of individual alerts.",Windows Event ID 4688; Zeek dns.log; Zeek http.log; Endpoint Fleet; DNS Resolvers; Network Egress Points,last 90 days,": SEARCH ioc_matches from past 30 days | CALCULATE hourly_count_baseline (95th_percentile, std_dev) | SEARCH current_hour_ioc_matches | COMPARE current_count to baseline | ALERT if current_count > (baseline_95th_percentile + 3 * std_dev)",playbooks/attack/enterprise/T1674.yml
T1674: Input Injection,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,3,"Are there command lines or domains that appear malicious based on their structural features, even if they don't match a known IOC?","This question addresses the detection of novel or unknown threats. By using a machine learning model to analyze features like entropy, length, and character patterns, it's possible to identify suspicious command lines and domains that deviate from benign norms, flagging them for investigation even without a prior IOC match.",Windows Event ID 4688; Zeek dns.log; Zeek http.log; Endpoint Fleet; DNS Resolvers; Network Egress Points,last 90 days,": FOR EACH command_line, domain | EXTRACT features (length, entropy, n-grams, etc.) | APPLY trained_classification_model | SCORE malicious_probability | ALERT if score > threshold",playbooks/attack/enterprise/T1674.yml
T1674: Input Injection,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,4,Are common user applications like browsers or email clients spawning command-line interpreters or scripting engines?,User-facing applications like Outlook or Chrome should not typically spawn shells like PowerShell or cmd.exe. Such an event is a high-fidelity indicator that an exploit or malicious macro has successfully executed and is attempting to run commands on the system.,Windows Event ID 4688; User Workstations; Terminal Servers; Virtual Desktop Infrastructure (VDI),last 90 days,": SEARCH process_creation_events | WHERE parent_process IN ('chrome.exe', 'outlook.exe', 'iexplore.exe') AND child_process IN ('powershell.exe', 'cmd.exe', 'wscript.exe') | ALERT",playbooks/attack/enterprise/T1674.yml
T1674: Input Injection,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,5,Has a process spawned a child process that is rare or has never been seen before in the environment?,"This question focuses on detecting anomalous process lineage. By baselining normal parent-child process relationships across the enterprise, any new or exceptionally rare pairing can be flagged as suspicious. This helps uncover novel execution techniques that don't match predefined high-fidelity rules.",Windows Event ID 4688; User Workstations; Terminal Servers; Virtual Desktop Infrastructure (VDI),last 90 days,: BUILD historical_baseline of parent_child_pairs over 90 days | FOR EACH new_process_creation_event | CHECK if parent_child_pair is new or rare (count < 5) | ALERT if true,playbooks/attack/enterprise/T1674.yml
T1674: Input Injection,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,6,Do the sequences of process creations within a user session deviate from established patterns of normal behavior?,"This question uses a more advanced analytical approach by modeling entire user sessions as process-lineage graphs. Anomaly detection models can then identify unusual structures or sequences of events within these graphs, which may indicate complex, multi-stage attacks that would be missed by looking at individual parent-child pairs.",Windows Event ID 4688; User Workstations; Terminal Servers; Virtual Desktop Infrastructure (VDI),last 90 days,: CONSTRUCT process_lineage_graphs per user_session | APPLY graph_anomaly_detection_model | IDENTIFY outlier subgraphs | ALERT on deviations,playbooks/attack/enterprise/T1674.yml
T1674: Input Injection,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,7,Are there command-line executions containing keywords or patterns strongly associated with obfuscation or fileless malware?,"This question seeks to identify common and high-fidelity indicators of malicious PowerShell or command-line usage. Strings like '-EncodedCommand' or 'IEX(New-Object Net.WebClient).DownloadString' are frequently used by attackers to hide their code and download additional payloads, making their presence a strong signal of compromise.",Windows Event ID 4688; User Workstations; Application Servers; Domain Controllers,last 90 days,": SEARCH process_creation_events | FILTER command_line CONTAINS ('-EncodedCommand', '-e', 'IEX(New-Object Net.WebClient).DownloadString', etc.) | ALERT",playbooks/attack/enterprise/T1674.yml
T1674: Input Injection,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,8,Are there any command-line executions with abnormally high length or character entropy?,"This question is designed to detect obfuscated or complex commands. Malicious scripts, especially those that are Base64-encoded or heavily obfuscated, tend to be much longer and have higher character randomness (entropy) than typical administrative commands. Comparing a command's length and entropy against a historical baseline for that specific process can reveal these outliers.",Windows Event ID 4688; User Workstations; Application Servers; Domain Controllers,last 90 days,: BUILD baseline of command_line_length and entropy per process_name over 90 days | FOR EACH new_command | COMPARE length and entropy to 99th_percentile of baseline | ALERT if exceeded,playbooks/attack/enterprise/T1674.yml
T1674: Input Injection,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,9,Do any command lines fall into unusual clusters or appear as statistical outliers when grouped by their structural characteristics?,"This question uses unsupervised machine learning to find 'needles in a haystack.' By vectorizing and clustering all command lines, common and benign commands will form large, dense clusters. Rare, custom, or malicious commands will either form very small clusters or be classified as noise/outliers, making them easy to isolate for investigation.",Windows Event ID 4688; User Workstations; Application Servers; Domain Controllers,last 90 days,": VECTORIZE all command_lines (TF-IDF, length, entropy) | APPLY clustering_algorithm (DBSCAN) | INVESTIGATE small clusters and noise points",playbooks/attack/enterprise/T1674.yml
T1674: Input Injection,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,10,Has a single parent process spawned a burst of multiple child processes in an extremely short time frame?,"This question helps detect automated execution, which is characteristic of malicious scripts or programs. A human operator cannot manually launch several processes from the same parent in under a second. A burst of activity like this is a strong indicator of a script loop or automated tool running commands in rapid succession.",Windows Event ID 4688; User Workstations; Point-of-Sale Terminals; Systems with frequent physical access,last 90 days,: WATCH process_creation_events | GROUP by ParentProcessID | COUNT child_processes within a 1-second sliding window | ALERT if count > 3,playbooks/attack/enterprise/T1674.yml
T1674: Input Injection,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,11,Is a user executing commands or spawning processes at a rate that is anomalously fast compared to their own historical behavior?,"This question personalizes anomaly detection by baselining the 'rhythm' of each individual user. By comparing a user's current activity to their own past behavior, this method can detect when a user's account might be compromised and used by an automated script, reducing false positives from naturally fast-typing users.",Windows Event ID 4688; User Workstations; Point-of-Sale Terminals; Systems with frequent physical access,last 90 days,: FOR EACH user | BUILD baseline of time_deltas between consecutive process_creations | FOR EACH new session | CALCULATE average_time_delta | ALERT if average_time_delta < 1st_percentile_of_baseline,playbooks/attack/enterprise/T1674.yml
T1674: Input Injection,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,12,"Has there been a sudden, anomalous spike in the overall rate of process creation on a host or by a user?","This question looks at the macro-level tempo of activity. Time-series models can learn the normal ebb and flow of process creation activity for a host or user. A sudden, sharp spike that deviates from this learned pattern can indicate a malicious event, such as a malware outbreak or a script running out of control.",Windows Event ID 4688; User Workstations; Point-of-Sale Terminals; Systems with frequent physical access,last 90 days,: MODEL rate of process_creations per user/host as a time-series | USE LSTM or similar model to predict expected rate | ALERT on significant deviation between actual and predicted rate,playbooks/attack/enterprise/T1674.yml
T1674: Input Injection,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,13,Is a high-value internal web application loading JavaScript from an unknown or unapproved external domain?,"This is a key question for detecting Cross-Site Scripting (XSS) or web-based supply chain attacks. High-value applications should only load scripts from a vetted list of trusted domains. A request to load a script from a new, external domain could mean an attacker has injected malicious code to steal data or capture credentials.",Zeek http.log; Zeek ssl.log; Zeek dns.log; Network Egress Points; Web Proxies; DMZ,last 90 days,: SEARCH http_logs WHERE uri ENDS WITH '.js' AND referer_domain IS internal_or_high_value AND host_domain IS NOT IN allowlist | ALERT,playbooks/attack/enterprise/T1674.yml
T1674: Input Injection,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,14,Has the set of external domains providing scripts to a high-value application changed significantly from its historical norm?,"This question provides a dynamic way to detect changes in a web application's dependencies. A low Jaccard similarity score indicates that the application is suddenly loading scripts from a very different set of domains than it usually does, which is a strong indicator of a potential compromise or a malicious injection.",Zeek http.log; Zeek ssl.log; Zeek dns.log; Network Egress Points; Web Proxies; DMZ,last 90 days,: FOR EACH high_value_app | BUILD baseline_set of script_source_domains over 90 days | FOR EACH new_session | CALCULATE Jaccard_similarity between session_script_domains and baseline_set | ALERT if similarity < 0.7,playbooks/attack/enterprise/T1674.yml
T1674: Input Injection,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,15,Are there suspicious outbound POST requests from high-value web applications that could indicate data exfiltration by injected scripts?,"This question focuses on the data exfiltration phase that often follows a successful input injection attack. Malicious JavaScript injected into a page might gather sensitive data and send it to an attacker-controlled server via an HTTP POST request. A machine learning model can flag anomalous ones based on features like request size, content type, or destination.",Zeek http.log; Zeek ssl.log; Zeek dns.log; Network Egress Points; Web Proxies; DMZ,last 90 days,": FROM http_logs | FILTER request_method = 'POST' and referer is high_value_app | EXTRACT features (body_length, content_type, etc.) | APPLY trained_classification_model | ALERT if score > threshold",playbooks/attack/enterprise/T1674.yml
T1675: ESXi Administration Command,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,1,Has a process spawned by vmtoolsd.exe shown activity matching known threat intelligence indicators?,"This question aims to identify direct matches to known malicious activity. When an adversary uses the ESXi `GuestProcessManager.StartProgramInGuest` API, it results in `vmtoolsd.exe` spawning a child process on the guest VM. By correlating the child process's hash, command-line arguments, and subsequent network activity (destination IPs, DNS queries) with threat intelligence feeds, we can detect known malicious tools or infrastructure being used. This is a high-confidence method for identifying compromised systems.
","Windows Event ID 4688; Zeek conn.log; Zeek dns.log; Guest Virtual Machines (especially Domain Controllers, Database Servers); Network Egress Points; Threat Intelligence Platforms",last 90 days,": FOR each event WHERE event_type is ""process_creation"" AND parent_process is ""vmtoolsd.exe"":
  LET child_process = event.process
  LET child_hash = event.hash
  LET cmd_line = event.command_line
  LET network_events = SEARCH network_logs WHERE source_ip is event.host AND process_id is event.process_id
  IF child_hash OR cmd_line OR network_events.destination_ip OR network_events.dns_query IN threat_intel_feed:
    ALERT(event)
",playbooks/attack/enterprise/T1675.yml
T1675: ESXi Administration Command,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,2,Has vmtoolsd.exe spawned a process with a statistically rare or unusual command line?,"Adversaries often use custom scripts or obscure commands that deviate from normal administrative activity. This question focuses on finding these anomalies without relying on pre-existing indicators. By calculating the historical frequency (TF-IDF) of words and paths in command lines for processes spawned by `vmtoolsd.exe`, we can flag commands containing rare tokens. This can uncover novel or obfuscated attack techniques that threat intelligence might not yet cover.
","Windows Event ID 4688; Guest Virtual Machines (especially Domain Controllers, Database Servers); Network Egress Points; Threat Intelligence Platforms",last 90 days,": LET baseline = CALCULATE_TF-IDF for all command_line_tokens from ""vmtoolsd.exe"" child processes over last 90 days
FOR each new event WHERE parent_process is ""vmtoolsd.exe"":
  LET tokens = PARSE(event.command_line)
  FOR each token in tokens:
    IF baseline.score(token) < 1st_percentile:
      ALERT(event, ""Rare command-line token found"")
",playbooks/attack/enterprise/T1675.yml
T1675: ESXi Administration Command,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,3,Does the command line of a process spawned by vmtoolsd.exe have features consistent with malicious commands?,"This question applies machine learning to proactively score the risk of a command line, even in the absence of exact matches or extreme statistical rarity. By training a model on features like string length, character entropy, and the presence of keywords (e.g., 'esxcli', 'rundll32.exe'), the system can learn the general characteristics of malicious commands. This allows for the detection of suspicious commands that might look subtly different from known-bad examples but share underlying malicious traits.
","Windows Event ID 4688; Guest Virtual Machines (especially Domain Controllers, Database Servers); Network Egress Points; Threat Intelligence Platforms",last 90 days,": LET ml_model = LOAD_TRAINED_CLASSIFIER(""command_line_model"")
FOR each new event WHERE parent_process is ""vmtoolsd.exe"":
  LET features = EXTRACT_FEATURES(event.command_line) // length, entropy, keywords
  LET score = ml_model.PREDICT(features)
  IF score > high_threshold:
    ALERT(event, ""High maliciousness score from ML model"")
",playbooks/attack/enterprise/T1675.yml
T1675: ESXi Administration Command,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,4,Did vmtoolsd.exe spawn a command-line interpreter or scripting engine?,"This is a very high-confidence indicator of malicious activity. Legitimate VMware Tools operations do not involve `vmtoolsd.exe` directly launching shells like `cmd.exe`, `powershell.exe`, or `bash`. An adversary using this technique to gain execution on a guest VM will almost certainly use a shell to run subsequent commands. Detecting this specific parent-child relationship is a critical and immediate sign of compromise.
","Windows Event ID 4688; Guest Virtual Machines (especially Domain Controllers, Database Servers)",last 90 days,": LET shell_list = [""cmd.exe"", ""powershell.exe"", ""pwsh.exe"", ""wscript.exe"", ""cscript.exe"", ""sh"", ""bash"", ""zsh"", ""rundll32.exe""]
FOR each event WHERE event_type is ""process_creation"" AND parent_process is ""vmtoolsd.exe"":
  IF event.process_name IN shell_list:
    ALERT(event, ""High-priority: Shell spawned from vmtoolsd.exe"")
",playbooks/attack/enterprise/T1675.yml
T1675: ESXi Administration Command,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,5,"Have any hosts exhibited vmtoolsd.exe spawning shell processes, and has the variety of child processes increased?","This question establishes a baseline expectation that `vmtoolsd.exe` should never spawn shell processes. Any deviation from this zero-count baseline is an immediate red flag. Additionally, by monitoring the entropy of parent-child process pairs, we can detect when `vmtoolsd.exe` starts spawning an uncharacteristically diverse set of child processes, which could indicate an adversary experimenting or deploying multiple tools.
","Windows Event ID 4688; Guest Virtual Machines (especially Domain Controllers, Database Servers)",last 30 days,": FOR each host:
  LET shell_spawn_count = COUNT events WHERE parent_process is ""vmtoolsd.exe"" AND child_process is a shell OVER 30 days
  IF shell_spawn_count > 0:
    ALERT(host, ""Shell process spawned by vmtoolsd.exe detected"")
",playbooks/attack/enterprise/T1675.yml
T1675: ESXi Administration Command,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,6,Has a sequence of process executions occurred that is anomalous because it includes vmtoolsd.exe spawning a shell?,"This question uses a more advanced, context-aware detection method. Instead of just looking at a single parent-child pair, a sequence analysis model (like an LSTM) learns the normal flow of process creations on a system. The sequence `... -> vmtoolsd.exe -> powershell.exe -> ...` would be a significant deviation from any learned legitimate sequence. This method is powerful because it can identify the malicious step within a broader chain of activity, providing richer context for an investigation.
","Windows Event ID 4688; Guest Virtual Machines (especially Domain Controllers, Database Servers)",last 90 days,": LET sequence_model = LOAD_TRAINED_LSTM_MODEL(""process_sequence_model"")
FOR each new process_creation_event:
  LET current_sequence = GET_PROCESS_CHAIN(event)
  LET anomaly_score = sequence_model.SCORE(current_sequence)
  IF anomaly_score is high AND ""vmtoolsd.exe -> shell"" in current_sequence:
    ALERT(event, ""Anomalous process sequence involving vmtoolsd.exe"")
",playbooks/attack/enterprise/T1675.yml
T1675: ESXi Administration Command,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,7,Did vmtoolsd.exe spawn a child process that is not on the pre-approved allowlist?,"This question implements a strict, allowlist-based security posture. The set of legitimate child processes for `vmtoolsd.exe` is typically very small or even empty. By defining this ""known-good"" set, any process creation that falls outside of it is immediately treated as suspicious. This is an effective method for environments where VMware Tools behavior is highly predictable and standardized.
","Windows Event ID 4688; Guest Virtual Machines (especially Domain Controllers, Database Servers)",last 90 days,": LET allowlist = [""VMwareUser.exe""]
FOR each event WHERE event_type is ""process_creation"" AND parent_process is ""vmtoolsd.exe"":
  IF event.process_name NOT IN allowlist:
    ALERT(event, ""Non-allowlisted process spawned by vmtoolsd.exe"")
",playbooks/attack/enterprise/T1675.yml
T1675: ESXi Administration Command,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,8,Has vmtoolsd.exe spawned a child process that is rarely seen across the environment?,"This question helps to automatically identify unusual child processes without maintaining a manual allowlist. By calculating the prevalence of each child process across all guest VMs, we can flag those that appear on only a small number of hosts. A process spawned by `vmtoolsd.exe` on only one or two machines is a strong candidate for investigation, as it could be a malicious tool deployed to a specific target.
","Windows Event ID 4688; Guest Virtual Machines (especially Domain Controllers, Database Servers)",last 30 days,": LET process_counts = COUNT(DISTINCT host) by child_process_name WHERE parent_process is ""vmtoolsd.exe"" OVER 30 days
LET total_hosts = COUNT(DISTINCT host)
FOR each process, count in process_counts:
  LET prevalence = count / total_hosts
  IF prevalence < 0.01:
    ALERT(process, ""Statistically rare child process for vmtoolsd.exe"")
",playbooks/attack/enterprise/T1675.yml
T1675: ESXi Administration Command,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,9,Has vmtoolsd.exe spawned a child process that an unsupervised machine learning model flags as an anomaly?,"This question leverages unsupervised learning to build a profile of ""normal"" `vmtoolsd.exe` child process activity and then identify deviations. Algorithms like Isolation Forest or one-class SVM can be trained on features of legitimate events (process name, command-line properties, user context). They can then flag new events that don't fit this profile, providing a way to detect novel or unknown malicious techniques without prior labeling or explicit rules.
","Windows Event ID 4688; Guest Virtual Machines (especially Domain Controllers, Database Servers)",last 90 days,": LET anomaly_model = LOAD_TRAINED_ISOLATION_FOREST(""vmtoolsd_children_model"")
FOR each new event WHERE parent_process is ""vmtoolsd.exe"":
  LET features = EXTRACT_FEATURES(event)
  IF anomaly_model.PREDICT(features) is ""outlier"":
    ALERT(event, ""Anomalous child process detected by unsupervised model"")
",playbooks/attack/enterprise/T1675.yml
T1675: ESXi Administration Command,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,10,Was a network connection from an ESXi host to a guest VM on port 902 quickly followed by suspicious process activity on that guest?,"This question links the network activity that initiates the guest operation with the resulting process execution on the VM. A connection from an ESXi host to a guest on TCP port 902 is expected for VMware Tools operations. However, if this connection is immediately followed (e.g., within 2 minutes) by `vmtoolsd.exe` spawning a shell or running reconnaissance commands (`whoami`, `net user`), it strongly indicates that the guest operation was malicious. This correlation provides a clear cause-and-effect chain of evidence.
",Zeek conn.log; Windows Event ID 4688; Zeek dns.log; ESXi Host Management Interfaces; vCenter Server; Virtual Machine Network Segments; Network Egress Points,last 90 days,": FOR each network_event WHERE dest_port is 902 AND source_ip is in ESXI_HOST_LIST:
  LET suspicious_processes = SEARCH process_logs WHERE host is network_event.dest_ip
    AND parent_process is ""vmtoolsd.exe""
    AND (process_name is shell OR command_line contains recon_commands)
    AND timestamp is within 2 minutes of network_event.timestamp
  IF suspicious_processes exist:
    ALERT(network_event, suspicious_processes)
",playbooks/attack/enterprise/T1675.yml
T1675: ESXi Administration Command,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,11,Has there been an anomalous spike in network traffic on TCP port 902 from an ESXi host to a guest VM?,"This question focuses on identifying anomalies in the volume of communication for guest operations. A sudden, significant increase in the amount of data or the number of connections on port 902 from an ESXi host to a guest VM can indicate unusual activity, such as an adversary transferring a large tool or issuing many rapid commands. Correlating this network spike with a subsequent increase in processes spawned by `vmtoolsd.exe` on the same guest VM strengthens the evidence of malicious use.
",Zeek conn.log; Windows Event ID 4688; Zeek dns.log; ESXi Host Management Interfaces; vCenter Server; Virtual Machine Network Segments; Network Egress Points,last 90 days,": FOR each guest_vm:
  LET baseline = CALCULATE_MOVING_AVG(traffic_volume on port 902 from ESXi hosts) over 90 days
  LET current_volume = GET_CURRENT_VOLUME()
  IF current_volume > baseline + 3 * STD_DEV(baseline):
    ALERT(guest_vm, ""Anomalous spike in port 902 traffic"")
",playbooks/attack/enterprise/T1675.yml
T1675: ESXi Administration Command,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,12,Can we identify a graph pattern representing an ESXi host connecting to a guest VM and causing an anomalous process to be spawned?,"This question models the attack as a chain of relationships in a graph, providing a powerful and intuitive way to visualize and detect the full attack path. By representing hosts, processes, and their connections as a graph, we can specifically search for the pattern of an ESXi host connecting to a guest on port 902, which then leads to `vmtoolsd.exe` spawning a suspicious child process. This approach is excellent for discovering complex, multi-stage activities that might be missed by simple event correlation.
",Zeek conn.log; Windows Event ID 4688; Zeek dns.log; ESXi Host Management Interfaces; vCenter Server; Virtual Machine Network Segments; Network Egress Points,last 90 days,": CONSTRUCT graph from network_logs and process_logs
SEARCH for pattern:
  (node_A:ESXi_Host) -[rel_1:CONNECTS_ON_902]-> (node_B:Guest_VM)
  (node_C:Process {name:""vmtoolsd.exe"", host:node_B}) -[rel_2:SPAWNS]-> (node_D:Anomalous_Process)
  WHERE rel_1.timestamp is close to rel_2.timestamp
  RETURN pattern
",playbooks/attack/enterprise/T1675.yml
T1675: ESXi Administration Command,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,13,Has a single source IP address initiated guest operations via vmtoolsd.exe on an abnormally large number of guest VMs in a short time?,"This question aims to detect large-scale, automated attacks like ransomware deployment or widespread lateral movement. A legitimate administrator might perform an operation on a few VMs at once, but an attacker's script could target tens or hundreds of machines in minutes. By setting a threshold (e.g., more than 10 distinct VMs targeted by one source IP in 5 minutes), we can effectively detect this ""fan-out"" behavior, which is a strong indicator of a coordinated attack.
",Windows Event ID 4688; Zeek conn.log; Guest Virtual Machines (fleet-wide); ESXi Host Management Interfaces; vCenter Server,last 90 days,": FOR each 5_minute_window:
  AGGREGATE events by source_ip where parent_process is ""vmtoolsd.exe""
  FOR each source_ip:
    LET distinct_targets = COUNT(DISTINCT target_vm)
    IF distinct_targets > 10:
      ALERT(source_ip, ""High fan-out detected"")
",playbooks/attack/enterprise/T1675.yml
T1675: ESXi Administration Command,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,14,Has the diversity (entropy) of guest VMs targeted by a single source IP for guest operations suddenly increased?,"This question provides a more dynamic way to detect fan-out activity than a static threshold. Shannon entropy measures the randomness or unpredictability of a set of targets. A low entropy means a source IP is repeatedly targeting the same few VMs, which might be normal. A sudden, high entropy means the source is now targeting a wide and diverse set of new VMs, which is highly anomalous and suggests scanning or mass deployment.
",Windows Event ID 4688; Zeek conn.log; Guest Virtual Machines (fleet-wide); ESXi Host Management Interfaces; vCenter Server,last 90 days,": FOR each source_ip in 10_minute_windows:
  LET target_set = GET_DISTINCT_TARGET_VMS(source_ip)
  LET current_entropy = CALCULATE_SHANNON_ENTROPY(target_set)
  LET baseline_entropy = GET_HISTORICAL_ENTROPY(source_ip)
  IF current_entropy is significantly higher than baseline_entropy:
    ALERT(source_ip, ""Sudden increase in target entropy"")
",playbooks/attack/enterprise/T1675.yml
T1675: ESXi Administration Command,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0002: Execution,n; o; n; e,15,Can we identify a dense cluster of guest operation events originating from a single source IP targeting many different VMs in a short time?,"This question uses clustering to find groups of related malicious activity. A density-based algorithm like DBSCAN can automatically group events that are close to each other in time and originate from the same source but target different destinations. A large, dense cluster found by the algorithm would represent a burst of activity, like a ransomware script rapidly encrypting files across many VMs, making it a powerful tool for discovering coordinated attacks.
",Windows Event ID 4688; Zeek conn.log; Guest Virtual Machines (fleet-wide); ESXi Host Management Interfaces; vCenter Server,last 90 days,": LET events = GET all vmtoolsd.exe spawn events with source_ip, target_vm, timestamp
LET clusters = DBSCAN(events, features=[source_ip, timestamp, target_vm])
FOR each cluster in clusters:
  IF cluster is dense AND has single source_ip AND multiple target_vms:
    ALERT(cluster, ""Anomalous dense cluster of guest operations found"")",playbooks/attack/enterprise/T1675.yml
T0800: Activate Firmware Update Mode,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",T; A; 0; 1; 0; 7; :;  ; I; n; h; i; b; i; t;  ; R; e; s; p; o; n; s; e;  ; F; u; n; c; t; i; o; n,n; o; n; e,1,Is a firmware update utility being executed on an engineering workstation followed by a large file transfer or communication loss to a critical ICS asset?,"This question seeks to identify a direct attempt to update or alter a device's firmware. An adversary may use legitimate vendor utilities or scripting engines on an EWS to initiate a firmware update. This action is highly suspicious if it is correlated with either a large file transfer (indicative of a firmware image being sent) or a sudden stop in the device's normal communications, and occurs outside a planned maintenance window.","Windows Event ID 4688; Zeek conn.log; Zeek files.log; Zeek ftp.log; Zeek http.log; Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), and Jump Servers within the Process Control and Supervisory network segments (Purdue Level 2/3), and network TAPs monitoring traffic to and from these assets.",last 90 days,"SIEM: SEARCH host_events (EventID=4688) on EWS hosts where process_name is a known utility (e.g., UnityPro.exe, powershell.exe) AND command_line contains keywords ('firmware', 'flash'). CORRELATE within 90s with network_logs where (src_ip=host_ip AND dest_ip=ics_asset AND bytes > 1MB) OR (src_ip=ics_asset AND communication_ceases).",playbooks/attack/ics/T0800.yml
T0800: Activate Firmware Update Mode,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",T; A; 0; 1; 0; 7; :;  ; I; n; h; i; b; i; t;  ; R; e; s; p; o; n; s; e;  ; F; u; n; c; t; i; o; n,n; o; n; e,2,"Has a novel command-line argument been used for an engineering tool, followed by a disruption in the target device's heartbeat messages?","This question aims to detect anomalous usage of legitimate tools. Adversaries may use standard engineering software in an unusual way to manipulate a device. By baselining normal command-line arguments, we can flag new or rare combinations. Correlating this host-based anomaly with a subsequent loss of periodic heartbeat messages from the target device strengthens the suspicion that the command was malicious and successfully altered the device's state.","Windows Event ID 4688; Zeek conn.log; Zeek files.log; Zeek ftp.log; Zeek http.log; Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), and Jump Servers within the Process Control and Supervisory network segments (Purdue Level 2/3), and network TAPs monitoring traffic to and from these assets.",last 90 days,"Baselining: FOR each EWS process, CALCULATE Jaccard similarity of new command-line arguments against 30-day baseline. IF similarity < 0.2, CHECK network logs for target device heartbeat inter-arrival time > 99.9th percentile within 5 minutes.",playbooks/attack/ics/T0800.yml
T0800: Activate Firmware Update Mode,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",T; A; 0; 1; 0; 7; :;  ; I; n; h; i; b; i; t;  ; R; e; s; p; o; n; s; e;  ; F; u; n; c; t; i; o; n,n; o; n; e,3,Can a machine learning model detect a suspicious process execution that correlates with anomalous network behavior from the target device?,"This question leverages a two-stage machine learning approach for high-fidelity detection. A supervised model first classifies process execution events on EWS as benign or suspicious based on features like command-line entropy and user context. Events classified as 'Suspicious-Update' are then used to trigger a second model (an LSTM autoencoder) that analyzes the target device's network traffic. An alert is raised only if the suspicious process is immediately followed by a statistically significant deviation in the device's network behavior, reducing false positives.","Windows Event ID 4688; Zeek conn.log; Zeek files.log; Zeek ftp.log; Zeek http.log; Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), and Jump Servers within the Process Control and Supervisory network segments (Purdue Level 2/3), and network TAPs monitoring traffic to and from these assets.",last 90 days,"ML: 1) CLASSIFY host events (EventID=4688) using Random Forest model. 2) IF classification is 'Suspicious-Update', FEED corresponding device network time-series data into LSTM autoencoder. 3) ALERT if LSTM reconstruction error spikes above threshold.",playbooks/attack/ics/T0800.yml
T0800: Activate Firmware Update Mode,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",T; A; 0; 1; 0; 7; :;  ; I; n; h; i; b; i; t;  ; R; e; s; p; o; n; s; e;  ; F; u; n; c; t; i; o; n,n; o; n; e,4,Has a state-change ICS protocol command been sent to a critical asset from an unauthorized source or outside a maintenance window?,"This question focuses on detecting the direct use of specific ICS protocol functions known to alter a device's operational state, such as putting it into a bootloader or restart mode. By monitoring for low-prevalence, high-impact commands (e.g., Modbus Function Code 16, DNP3 Cold Restart) and enriching these events with contextual information (Is the source a known EWS? Is this happening during a maintenance window?), analysts can quickly identify unauthorized and potentially malicious state changes.","Zeek conn.log; Zeek modbus.log; Zeek dnp3.log; Zeek enip.log; Zeek weird.log; Network sensor appliances (e.g., Zeek sensors) deployed on SPAN ports or network TAPs at the boundaries between Purdue Levels 1 (Basic Control), 2 (Area Supervisory Control), and 3 (Site Control), with a focus on traffic flows involving critical PLCs, RTUs, and protection relays.",last 90 days,"SIEM: SEARCH ICS protocol logs (zeek_modbus, zeek_dnp3) for state-change function codes targeting critical assets. IF (source_ip is NOT in EWS_allowlist) OR (event_time is NOT in maintenance_window), GENERATE high-priority alert.",playbooks/attack/ics/T0800.yml
T0800: Activate Firmware Update Mode,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",T; A; 0; 1; 0; 7; :;  ; I; n; h; i; b; i; t;  ; R; e; s; p; o; n; s; e;  ; F; u; n; c; t; i; o; n,n; o; n; e,5,"Following a potential state-change command, has the device's communication profile deviated significantly from its baseline?","This question provides a method to confirm the impact of a suspected state-change command. After observing a potentially malicious command, this analytic checks for secondary effects in the device's communication patterns. A significant deviation, such as a shift from read to write commands or a halt in expected polling traffic for over two minutes, provides strong evidence that the device's state was successfully and maliciously altered.","Zeek conn.log; Zeek modbus.log; Zeek dnp3.log; Zeek enip.log; Zeek weird.log; Network sensor appliances (e.g., Zeek sensors) deployed on SPAN ports or network TAPs at the boundaries between Purdue Levels 1 (Basic Control), 2 (Area Supervisory Control), and 3 (Site Control), with a focus on traffic flows involving critical PLCs, RTUs, and protection relays.",last 90 days,"Baselining: ON detection of state-change command, ANALYZE target device traffic for next 5 mins. IF (write-to-read_ratio > 99th_percentile_baseline) OR (polling_interval > 99.5th_percentile_baseline for > 120s), ALERT.",playbooks/attack/ics/T0800.yml
T0800: Activate Firmware Update Mode,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",T; A; 0; 1; 0; 7; :;  ; I; n; h; i; b; i; t;  ; R; e; s; p; o; n; s; e;  ; F; u; n; c; t; i; o; n,n; o; n; e,6,"Does a multivariate anomaly detection model show a significant deviation in a device's overall communication pattern, indicating a potential state change?","This question proposes a sophisticated anomaly detection approach that looks at the device's communication holistically. Rather than tracking a single metric, a Variational Autoencoder (VAE) model is trained on a feature set including byte counts, protocol mix, and function code distributions. An alert is triggered when the device's real-time behavior no longer matches the learned 'normal' profile, allowing for the detection of subtle or complex state changes that might be missed by simpler rules.","Zeek conn.log; Zeek modbus.log; Zeek dnp3.log; Zeek enip.log; Zeek weird.log; Network sensor appliances (e.g., Zeek sensors) deployed on SPAN ports or network TAPs at the boundaries between Purdue Levels 1 (Basic Control), 2 (Area Supervisory Control), and 3 (Site Control), with a focus on traffic flows involving critical PLCs, RTUs, and protection relays.",last 90 days,"ML: AGGREGATE Zeek logs into 1-min feature vectors (byte count, port entropy, function code distribution, etc.) per device. INPUT vector into pre-trained VAE model. IF reconstruction_error > dynamic_threshold (e.g., 99.8th percentile), ALERT.",playbooks/attack/ics/T0800.yml
T0800: Activate Firmware Update Mode,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",T; A; 0; 1; 0; 7; :;  ; I; n; h; i; b; i; t;  ; R; e; s; p; o; n; s; e;  ; F; u; n; c; t; i; o; n,n; o; n; e,7,Is a critical ICS asset responding to network pings (ICMP) but not to application-layer queries for an extended period?,"This question addresses a specific failure state where a device is 'alive' on the network but not performing its control function. This condition is highly indicative of a device stuck in a maintenance or bootloader mode. By creating a SIEM rule that maintains a state table of last seen application responses versus last seen ICMP responses, analysts can detect this 'zombie' state, which is a strong indicator of inhibited response functions.","Zeek conn.log; Zeek icmp.log; Zeek modbus.log; Network TAPs monitoring traffic to and from critical controllers (PLCs, RTUs, IEDs) in Purdue Level 1 and 2, and the central network core where ICMP traffic might be observed.",last 90 days,SIEM State Table: UPDATE state_table with 'last_app_response' from Modbus logs and 'last_icmp_response' from ICMP logs. TRIGGER alert IF (current_time - last_app_response > 10 minutes) AND (current_time - last_icmp_response < 2 minutes).,playbooks/attack/ics/T0800.yml
T0800: Activate Firmware Update Mode,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",T; A; 0; 1; 0; 7; :;  ; I; n; h; i; b; i; t;  ; R; e; s; p; o; n; s; e;  ; F; u; n; c; t; i; o; n,n; o; n; e,8,Is there an unusually long-lived TCP session to a control port on a critical device with no data being transferred?,"This question seeks to identify hung processes or devices stuck in a non-operational mode. A legitimate TCP session on a control port (like Modbus port 502) should involve data exchange. If a session remains established for an abnormally long time without any application data being sent, it could mean the device has entered a state (like firmware update mode) where it holds the connection open but is no longer processing control commands.","Zeek conn.log; Zeek icmp.log; Zeek modbus.log; Network TAPs monitoring traffic to and from critical controllers (PLCs, RTUs, IEDs) in Purdue Level 1 and 2, and the central network core where ICMP traffic might be observed.",last 90 days,"Baselining: FOR each critical device/port, baseline normal TCP session duration. SEARCH for active TCP sessions (state=ESTABLISHED) where application byte count is zero. ALERT if session duration exceeds the 98th percentile of the historical baseline.",playbooks/attack/ics/T0800.yml
T0800: Activate Firmware Update Mode,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",T; A; 0; 1; 0; 7; :;  ; I; n; h; i; b; i; t;  ; R; e; s; p; o; n; s; e;  ; F; u; n; c; t; i; o; n,n; o; n; e,9,Has a device's application-layer response count dropped to zero when a time-series forecast predicted significant activity?,"This question uses forecasting to detect unexpected silence. A model like Prophet can learn the daily and weekly patterns of a device's activity, including scheduled downtime. An alert is generated if the device stops responding during a period when it is normally active. Cross-validating this silence with a positive ICMP ping response confirms the device is online but non-functional, providing a high-confidence signal of a potential problem or malicious inhibition.","Zeek conn.log; Zeek icmp.log; Zeek modbus.log; Network TAPs monitoring traffic to and from critical controllers (PLCs, RTUs, IEDs) in Purdue Level 1 and 2, and the central network core where ICMP traffic might be observed.",last 90 days,"Forecasting: FOR each device, use Prophet model to forecast expected application response count in 1-min bins. IF actual response count is zero for several bins where forecast > 0 (outside uncertainty interval), and device still responds to ICMP, ALERT.",playbooks/attack/ics/T0800.yml
T0802: Automated Collection,f8a9b7c6-d5e4-4f32-1a0b-9c8d7e6f5a43,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0100: Collection,n; o; n; e,1,Is a known malicious IP or an unauthorized scanner attempting to connect to multiple ICS devices?,"This question aims to identify obvious scanning activity. By checking against a watchlist of known malicious IPs, we can quickly spot confirmed threats. Additionally, by comparing scanning behavior against an allowlist of authorized scanners (like vulnerability management tools), we can filter out legitimate activity and focus on unauthorized or anomalous scanning attempts that could indicate an adversary's initial reconnaissance. A fixed threshold provides a simple, immediate detection mechanism.","Zeek conn.log; Zeek notice.log; Network taps/SPAN ports on ICS network segments (Control Network, Process Network, DMZ), specifically monitoring traffic to/from PLCs, RTUs, and HMIs.",last 90 days,: SEARCH Zeek conn.log WHERE source_ip IN malicious_watchlist; SEARCH Zeek conn.log WHERE source_ip NOT IN authorized_scanners AND unique_destination_ip_count > 20 ON ICS_ports WITHIN 5_minutes GROUP BY source_ip;,playbooks/attack/ics/T0802.yml
T0802: Automated Collection,f8a9b7c6-d5e4-4f32-1a0b-9c8d7e6f5a43,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0100: Collection,n; o; n; e,2,Is any host exhibiting network scanning behavior that deviates from its own established baseline?,"This question moves beyond static thresholds to a more dynamic, behavioral approach. By creating a historical baseline of normal activity for each host, we can detect when a host suddenly starts behaving like a scanner, even if it's a previously trusted asset. This helps identify compromised internal hosts being used for lateral movement and reconnaissance. Calculating the entropy of destination ports can further confirm scanning activity, as random or widespread port connections are atypical for normal ICS operations.","Zeek conn.log; Zeek notice.log; Network taps/SPAN ports on ICS network segments (Control Network, Process Network, DMZ), specifically monitoring traffic to/from PLCs, RTUs, and HMIs.",last 90 days,": FOR each source_ip, CALCULATE 99th_percentile_baseline of unique_destination_ip_count per 5_minutes over 30_days; COMPARE current_5_minute_count to baseline; ALERT if current > baseline; ENRICH with destination_port_entropy_calculation;",playbooks/attack/ics/T0802.yml
T0802: Automated Collection,f8a9b7c6-d5e4-4f32-1a0b-9c8d7e6f5a43,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0100: Collection,n; o; n; e,3,Has an anomaly detection model identified a host exhibiting network behavior consistent with automated collection?,"This question leverages machine learning to identify complex patterns of anomalous behavior that may not be caught by simple threshold or baseline checks. By considering multiple features simultaneously (e.g., unique IPs/ports, connection counts, data volume), an unsupervised model like Isolation Forest can detect subtle deviations from normal network patterns. This is effective for finding novel or slow-and-low attack techniques that try to evade traditional detection methods.","Zeek conn.log; Zeek notice.log; Network taps/SPAN ports on ICS network segments (Control Network, Process Network, DMZ), specifically monitoring traffic to/from PLCs, RTUs, and HMIs.",last 90 days,": TRAIN IsolationForest model on 30_day baseline of Zeek conn.log features (unique_dest_ips, unique_dest_ports, conn_count, byte_sum); APPLY model to real-time 5_minute feature vectors; ALERT if model flags source_ip as anomalous;",playbooks/attack/ics/T0802.yml
T0802: Automated Collection,f8a9b7c6-d5e4-4f32-1a0b-9c8d7e6f5a43,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0100: Collection,n; o; n; e,4,Has an unauthorized or suspicious process been executed on a critical ICS asset?,"This question focuses on identifying the initial execution of a malicious tool or script on a key asset like an HMI or Engineering Workstation. ICS environments should have highly predictable and controlled software running. By using a process allowlist, any deviation is immediately suspect. Specifically looking for scripting interpreters (PowerShell, Python) or known scanning tools (Nmap) provides a high-fidelity indicator that an adversary is attempting to establish a foothold for collection activities.","Windows Event ID 4688; Zeek conn.log; Host logging agents on Engineering Workstations (EWS), Operator Stations / HMIs, and ICS Application Servers; Network taps/SPAN ports positioned to capture traffic originating from these assets.",last 90 days,": SEARCH WindowsEvent:4688 WHERE process_name NOT IN process_allowlist OR command_line CONTAINS ('powershell.exe', 'python.exe', 'nmap.exe');",playbooks/attack/ics/T0802.yml
T0802: Automated Collection,f8a9b7c6-d5e4-4f32-1a0b-9c8d7e6f5a43,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0100: Collection,n; o; n; e,5,"Following the execution of a suspicious process, did the host immediately initiate an unusual number of network connections?","This question aims to link a suspicious host-based event (process creation) with subsequent network behavior (scanning). An adversary often runs a tool that immediately begins collecting data from the network. By correlating the process event with network logs in a tight time window (e.g., 60 seconds), we can confirm the purpose of the suspicious process. Exceeding a host-specific baseline for network activity post-process creation provides strong evidence that the process is malicious and is performing automated collection.","Windows Event ID 4688; Zeek conn.log; Host logging agents on Engineering Workstations (EWS), Operator Stations / HMIs, and ICS Application Servers; Network taps/SPAN ports positioned to capture traffic originating from these assets.",last 90 days,": ON suspicious_process_alert (from WindowsEvent:4688), QUERY Zeek conn.log for source_ip from T to T+60_seconds; COUNT unique destination_ips; ALERT if count > host_baseline_for_post_process_activity;",playbooks/attack/ics/T0802.yml
T0802: Automated Collection,f8a9b7c6-d5e4-4f32-1a0b-9c8d7e6f5a43,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0100: Collection,n; o; n; e,6,Have machine learning models simultaneously detected a suspicious command line execution and an anomalous network connection burst from the same host?,"This question combines two separate machine learning models to create a very high-confidence alert. A command-line classification model can detect obfuscated or unusual commands that might evade simple keyword matching. A time-series model on network traffic can detect sudden bursts of activity. When both models fire for the same host in a short time window, it provides a powerful, composite signal that an automated collection script or tool has been launched and is now active on the network.","Windows Event ID 4688; Zeek conn.log; Host logging agents on Engineering Workstations (EWS), Operator Stations / HMIs, and ICS Application Servers; Network taps/SPAN ports positioned to capture traffic originating from these assets.",last 90 days,: MODEL_A: SCORE maliciousness of command_line from WindowsEvent:4688; MODEL_B: DETECT anomalous spike in connection_count from Zeek conn.log; ALERT if MODEL_A flags process as suspicious AND MODEL_B detects spike from same host within 60_seconds;,playbooks/attack/ics/T0802.yml
T0802: Automated Collection,f8a9b7c6-d5e4-4f32-1a0b-9c8d7e6f5a43,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0100: Collection,n; o; n; e,7,Has a suspicious or unauthorized network logon occurred on a critical ICS server?,"This question focuses on identifying improper access to critical servers like Data Historians or OPC servers. Automated collection often requires authenticating to multiple systems. By monitoring for logons (Logon Type 3) from watchlisted accounts, accounts not belonging to the correct access groups, or user accounts logging in at odd hours, we can detect potential abuse of credentials for data gathering purposes. This is a fundamental security hygiene check that can reveal lateral movement.","Windows Event ID 4624; Zeek conn.log; Host logging agents on OPC Servers, Data Historians, and Domain Controllers servicing the ICS environment; Network taps/SPAN ports near these servers to correlate logon events with protocol-level traffic.",last 90 days,: SEARCH WindowsEvent:4624 (LogonType=3) on critical_servers WHERE account IN watchlist OR account NOT IN approved_AD_group OR (account_type=user AND time NOT IN business_hours);,playbooks/attack/ics/T0802.yml
T0802: Automated Collection,f8a9b7c6-d5e4-4f32-1a0b-9c8d7e6f5a43,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0100: Collection,n; o; n; e,8,Is any user account or IP address generating an anomalously high number of successful logons to an ICS server?,"This question uses statistical analysis to find unusual logon patterns. An adversary using a script to authenticate to multiple systems in a short period will generate a burst of successful logon events. By establishing a baseline for each user/IP and server pair, we can detect when the number of logons deviates significantly (e.g., >3 standard deviations) from normal behavior. This is effective for detecting automated credential use for widespread data access.","Windows Event ID 4624; Zeek conn.log; Host logging agents on OPC Servers, Data Historians, and Domain Controllers servicing the ICS environment; Network taps/SPAN ports near these servers to correlate logon events with protocol-level traffic.",last 90 days,": FOR each source_ip-destination_server pair, CALCULATE 30_day_baseline (mean, stddev) of logon_count (EventID 4624, Type 3) per 10_minutes; COMPARE current_10_minute_count to baseline; ALERT if current_count > (mean + 3*stddev);",playbooks/attack/ics/T0802.yml
T0802: Automated Collection,f8a9b7c6-d5e4-4f32-1a0b-9c8d7e6f5a43,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0100: Collection,n; o; n; e,9,Has a time-series model detected an unexpected spike in successful logons that correlates with an increase in ICS protocol traffic?,This question uses a more advanced forecasting model (like ARIMA) to predict the expected number of logons and flags significant deviations. This can detect anomalous logon bursts more accurately than a simple standard deviation model. The key part of this question is the enrichment step: correlating the logon anomaly with a simultaneous increase in actual ICS protocol traffic (like OPC or Modbus) between the involved hosts. This correlation strongly indicates that the anomalous logons are not just an authentication issue but are being actively used for data collection.,"Windows Event ID 4624; Zeek conn.log; Host logging agents on OPC Servers, Data Historians, and Domain Controllers servicing the ICS environment; Network taps/SPAN ports near these servers to correlate logon events with protocol-level traffic.",last 90 days,": MODEL: FORECAST expected_logon_count per 10_minutes for critical_servers; ALERT if observed_logon_count > prediction_interval; ON alert, ENRICH by querying Zeek conn.log for increase in ICS_protocol_traffic between source_ip and destination_server;",playbooks/attack/ics/T0802.yml
T0805: Block Serial COM,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",T; A; 0; 1; 0; 7; :;  ; I; n; h; i; b; i; t;  ; R; e; s; p; o; n; s; e;  ; F; u; n; c; t; i; o; n,n; o; n; e,1,"Is there a successful connection to a known serial-to-Ethernet converter that has an unusually long duration but minimal data transfer, based on static thresholds?","This question seeks to identify connections that are being held open without legitimate communication, a common method to block a serial port and cause a denial of service. By setting static thresholds for duration (e.g., > 1200 seconds) and data transfer (e.g., < 50 bytes), we can quickly flag suspicious, inactive sessions that indicate an adversary is preventing legitimate systems from accessing a physical device.","Zeek conn.log; Network perimeter of the Process Control Network (PCN), Industrial Demilitarized Zone (IDMZ) gateways, and Level 2/3 SCADA/DCS network segments hosting serial-to-Ethernet converters.",last 90 days,": SEARCH Zeek conn.log WHERE conn_state = 'SF'
AND destination_port IN [known_converter_ports]
AND duration > 1200
AND (orig_bytes + resp_bytes) < 50
",playbooks/attack/ics/T0805.yml
T0805: Block Serial COM,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",T; A; 0; 1; 0; 7; :;  ; I; n; h; i; b; i; t;  ; R; e; s; p; o; n; s; e;  ; F; u; n; c; t; i; o; n,n; o; n; e,2,"Is there a connection to a serial-to-Ethernet converter that significantly deviates from its historical baseline, showing a duration in the top percentile and data transfer in the bottom percentile?","This question improves upon static thresholds by using dynamic, per-device baselines, which adapt to the unique communication patterns of each converter and reduce false positives. A connection that is statistically an outlier in both duration (very long, e.g., >99th percentile) and data volume (very low, e.g., <1st percentile) is a strong indicator of a port being intentionally blocked.","Zeek conn.log; Network perimeter of the Process Control Network (PCN), Industrial Demilitarized Zone (IDMZ) gateways, and Level 2/3 SCADA/DCS network segments hosting serial-to-Ethernet converters.",last 90 days,": FOREACH new_connection to converter_port:
  baseline_duration = 99th_percentile(duration) for past 90 days on converter_port
  baseline_bytes = 1st_percentile(total_bytes) for past 90 days on converter_port
  IF new_connection.duration > baseline_duration AND new_connection.total_bytes < baseline_bytes:
    ALERT
",playbooks/attack/ics/T0805.yml
T0805: Block Serial COM,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",T; A; 0; 1; 0; 7; :;  ; I; n; h; i; b; i; t;  ; R; e; s; p; o; n; s; e;  ; F; u; n; c; t; i; o; n,n; o; n; e,3,Has a machine learning model identified a connection to a serial-to-Ethernet converter as anomalous based on its duration and data transfer characteristics?,"This question represents an advanced detection method, using machine learning to identify complex deviations from normal behavior that might be missed by simpler statistical methods. An anomaly score above a certain threshold suggests the connection's features (duration, bytes transferred) are highly uncharacteristic of normal operations for that specific port, pointing to potential malicious activity.","Zeek conn.log; Network perimeter of the Process Control Network (PCN), Industrial Demilitarized Zone (IDMZ) gateways, and Level 2/3 SCADA/DCS network segments hosting serial-to-Ethernet converters.",last 90 days,": INPUT live Zeek conn.log data INTO anomaly_detection_model
FOREACH connection:
  anomaly_score = model.predict(connection_features)
  IF anomaly_score > tuned_threshold:
    ALERT
",playbooks/attack/ics/T0805.yml
T0805: Block Serial COM,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",T; A; 0; 1; 0; 7; :;  ; I; n; h; i; b; i; t;  ; R; e; s; p; o; n; s; e;  ; F; u; n; c; t; i; o; n,n; o; n; e,4,Has a connection been made to a serial-to-Ethernet converter from a source IP address not on the authorized allowlist?,"This is a high-fidelity check, as access to critical ICS devices like serial converters should be strictly controlled. A connection from an unauthorized source is a clear policy violation and a strong indicator of compromise or misconfiguration. Correlating this network event with host logs (e.g., process creation events) can help identify the specific process on the unauthorized machine responsible for the connection.","Zeek conn.log; Windows Event ID 4688; Windows Event ID 4624; IT/OT DMZ network boundary, Process Control Network (PCN) segments, supervisory control systems, engineering workstations, Human Machine Interfaces (HMIs), and network segments directly hosting serial-to-Ethernet converters.",last 90 days,": SEARCH Zeek conn.log WHERE conn_state = 'SF'
AND destination_ip IN [known_converters]
AND source_ip NOT IN [authorized_ip_allowlist]
THEN, SEARCH Host Logs where source_ip = alerted_ip and timestamp = alert_time
",playbooks/attack/ics/T0805.yml
T0805: Block Serial COM,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",T; A; 0; 1; 0; 7; :;  ; I; n; h; i; b; i; t;  ; R; e; s; p; o; n; s; e;  ; F; u; n; c; t; i; o; n,n; o; n; e,5,"Is there an anomalous pattern in the source IPs connecting to a serial-to-Ethernet converter, such as a sudden drop in variety or a spike in new, unknown IPs?","This question looks for changes in communication patterns. A sharp decrease in source IP entropy (variety) could mean one rogue host is monopolizing the connection, crowding out legitimate systems. Conversely, a sudden spike in new, never-before-seen IPs connecting could indicate a widespread scanning or reconnaissance effort by an adversary.","Zeek conn.log; Windows Event ID 4688; Windows Event ID 4624; IT/OT DMZ network boundary, Process Control Network (PCN) segments, supervisory control systems, engineering workstations, Human Machine Interfaces (HMIs), and network segments directly hosting serial-to-Ethernet converters.",last 90 days,": CALCULATE hourly Shannon entropy of source IPs for each converter
ALERT if entropy drops sharply
OR
COUNT new source IPs per hour for each converter
ALERT if new_ip_count > 99th_percentile_baseline
",playbooks/attack/ics/T0805.yml
T0805: Block Serial COM,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",T; A; 0; 1; 0; 7; :;  ; I; n; h; i; b; i; t;  ; R; e; s; p; o; n; s; e;  ; F; u; n; c; t; i; o; n,n; o; n; e,6,Has a machine learning classification model flagged a new connection to a serial-to-Ethernet converter as 'unauthorized' with high confidence?,"This leverages a supervised model trained on known-good and known-bad connection patterns. Unlike a simple allowlist, a model can learn more nuanced features (e.g., time of day, protocol details) to identify unauthorized activity. A high-confidence (>0.9) prediction of 'unauthorized' provides a strong signal for immediate investigation.","Zeek conn.log; Windows Event ID 4688; Windows Event ID 4624; IT/OT DMZ network boundary, Process Control Network (PCN) segments, supervisory control systems, engineering workstations, Human Machine Interfaces (HMIs), and network segments directly hosting serial-to-Ethernet converters.",last 90 days,": INPUT live Zeek conn.log data INTO classification_model
FOREACH connection:
  prediction, confidence = model.classify(connection_features)
  IF prediction == 'unauthorized' AND confidence > 0.9:
    ALERT
",playbooks/attack/ics/T0805.yml
T0805: Block Serial COM,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",T; A; 0; 1; 0; 7; :;  ; I; n; h; i; b; i; t;  ; R; e; s; p; o; n; s; e;  ; F; u; n; c; t; i; o; n,n; o; n; e,7,"Are there communication failure alarms from legitimate systems (like HMIs or SCADA servers) that coincide with an active, long-duration TCP session to the same device's serial converter?","This question directly links the effect (communication failure) to a potential cause (a suspicious network connection). If a system designed to talk to a device suddenly starts reporting errors at the exact time an anomalous connection to that device's converter is active, it strongly implies the connection is blocking legitimate access.","Windows Event Log (Application); Zeek conn.log; SCADA master servers, Historian databases, Human Machine Interface (HMI) terminals, and engineering workstations.",last 90 days,": SEARCH for 'Device Unresponsive' alarms in Application Logs
EXTRACT device_name and timestamp
SEARCH Zeek conn.log for active, long-duration sessions to converter for device_name
IF alarm_timestamp falls within session_time:
  ALERT
",playbooks/attack/ics/T0805.yml
T0805: Block Serial COM,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",T; A; 0; 1; 0; 7; :;  ; I; n; h; i; b; i; t;  ; R; e; s; p; o; n; s; e;  ; F; u; n; c; t; i; o; n,n; o; n; e,8,Has there been a statistically significant and sustained increase in the frequency of communication failure alarms for a critical device?,"This question focuses on identifying an abnormal rate of failure alarms, which serves as a symptom of a potential problem. While not directly pointing to a cause, a sudden, sustained spike in errors (e.g., > 3 standard deviations above the mean) for a specific device is a strong indicator that something is wrong, prompting further investigation into network connections to that device.","Windows Event Log (Application); Zeek conn.log; SCADA master servers, Historian databases, Human Machine Interface (HMI) terminals, and engineering workstations.",last 90 days,": CALCULATE time-series of alarm counts per minute for each device
CALCULATE mean and std_dev for each device's alarm count
IF current_alarm_count > (mean + 3*std_dev) for > 5 minutes:
  ALERT
",playbooks/attack/ics/T0805.yml
T0805: Block Serial COM,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",T; A; 0; 1; 0; 7; :;  ; I; n; h; i; b; i; t;  ; R; e; s; p; o; n; s; e;  ; F; u; n; c; t; i; o; n,n; o; n; e,9,Has a causal inference model determined a high probability that a specific network connection is the root cause of a recent spike in device communication alarms?,"This advanced analytic approach moves from correlation to causation. By modeling the relationships between network events (source IP, duration) and system alarms, a causal model can calculate the likelihood that a particular suspicious connection is directly causing the observed failures, allowing analysts to focus on the highest-probability threats.","Windows Event Log (Application); Zeek conn.log; SCADA master servers, Historian databases, Human Machine Interface (HMI) terminals, and engineering workstations.",last 90 days,": INPUT network connection data AND alarm log data INTO Bayesian network model
CALCULATE P(Alarm_Spike | Suspicious_Connection)
IF probability > high_threshold:
  ALERT with causal score",playbooks/attack/ics/T0805.yml
T0809: Data Destruction,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0107: Inhibit Response Function,n; o; n; e,1,Are known data destruction utilities being executed on critical ICS assets?,"This question aims to identify the explicit use of tools or commands designed for data destruction (e.g., sdelete, killdisk, cipher.exe /w). Detecting the execution of these utilities on sensitive ICS assets like Engineering Workstations or HMIs is a strong indicator of malicious intent to disrupt operations or destroy evidence.","Windows Event ID 4688; Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Data Historians, Process Control Servers (PCS), Operator Workstations",last 90 days,"Search: SIEM; Pseudocode: SEARCH Windows Event ID 4688 WHERE (host IN NAI_list) AND (command_line CONTAINS ('sdelete', 'killdisk', 'cipher.exe /w', 'format', 'wevtutil cl', 'fsutil file setzerodata')) AND (process_name NOT IN whitelist)",playbooks/attack/ics/T0809.yml
T0809: Data Destruction,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0107: Inhibit Response Function,n; o; n; e,2,Is there anomalous process command line activity on critical ICS assets that could indicate obfuscated data destruction?,Adversaries may try to hide their data destruction activities by using obfuscated or unusually long command lines. This question focuses on detecting statistical outliers in command line length or character entropy compared to a historical baseline for a given process on a specific host. A significant deviation could signal an attempt to conceal malicious commands.,"Windows Event ID 4688; Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Data Historians, Process Control Servers (PCS), Operator Workstations",last 90 days,"Search: SIEM/Data Analytics Platform; Pseudocode: FOR each host in NAI_list:
  CALCULATE baseline (mean, std_dev) of command_line_length and command_line_entropy for each process_name over last 30 days.
  ALERT IF current event's command_line_length > (mean + 3*std_dev) OR command_line_entropy > (mean + 3*std_dev) OR process_name not seen in 30 days.",playbooks/attack/ics/T0809.yml
T0809: Data Destruction,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0107: Inhibit Response Function,n; o; n; e,3,Can machine learning identify novel or complex patterns of malicious process execution related to data destruction?,"This question leverages unsupervised machine learning to find unusual process execution events that may not be caught by simple keyword or statistical checks. By analyzing multiple features like process name, parent process, user, command line properties, and time of day, the model can flag sophisticated attacks that deviate from normal operational patterns on critical ICS assets.","Windows Event ID 4688; Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Data Historians, Process Control Servers (PCS), Operator Workstations",last 90 days,"Search: Machine Learning Platform; Pseudocode: DEPLOY anomaly detection model (e.g., Isolation Forest) trained on historical WinEvent 4688 data from NAI_list.
  FEATURES: process_name, parent_process, user, cmd_length, cmd_entropy, time_of_day.
  SCORE new process events in real-time.
  ALERT IF event is classified as an outlier.",playbooks/attack/ics/T0809.yml
T0809: Data Destruction,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0107: Inhibit Response Function,n; o; n; e,4,Is there a mass deletion of files occurring in critical ICS directories?,"This question seeks to detect a brute-force data destruction attempt, characterized by a large number of file deletion events from a single user or process in a very short time. Focusing on critical directories (e.g., project files, historian data) helps prioritize alerts for activity that poses a direct threat to ICS operations.","Windows Event ID 4663; ICS File Servers, Data Historians, ICS Backup Servers, Engineering Workstations (EWS), Process Control Servers (PCS)",last 90 days,"Search: SIEM; Pseudocode: SEARCH Windows Event ID 4663 WHERE (accesses CONTAINS 'DELETE') AND (object_name IN critical_ICS_directories).
  GROUP BY user, process_name.
  ALERT IF count > 50 in 60 seconds.",playbooks/attack/ics/T0809.yml
T0809: Data Destruction,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0107: Inhibit Response Function,n; o; n; e,5,Is a user or process deleting files at a statistically unusual rate on critical ICS assets?,"Rather than a fixed threshold, this question uses a rolling baseline to detect abnormal deletion activity relative to the normal behavior of a specific user or process. This helps identify more subtle or slow-and-low destruction attempts that might not trigger a simple volume-based alert. It also checks for unusual deletion patterns by analyzing the entropy of file extensions being deleted.","Windows Event ID 4663; ICS File Servers, Data Historians, ICS Backup Servers, Engineering Workstations (EWS), Process Control Servers (PCS)",last 90 days,"Search: SIEM/Data Analytics Platform; Pseudocode: FOR each user, process on NAI_list:
  CALCULATE baseline (mean, std_dev) of 'DELETE' event counts per 5-minute window.
  ALERT IF current count > (mean + 3*std_dev).
  CALCULATE file extension entropy for window.
  ALERT IF entropy spikes.",playbooks/attack/ics/T0809.yml
T0809: Data Destruction,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0107: Inhibit Response Function,n; o; n; e,6,Can a time-series model predict and detect deviations from normal file deletion patterns on critical ICS assets?,"This question applies advanced time-series analysis to model the normal rhythm and seasonality of file deletion activities. By learning these complex patterns, a model like an LSTM autoencoder can detect significant deviations that indicate a potential attack, even if the activity falls within simple statistical bounds. This is useful for identifying sophisticated adversaries who understand and try to mimic normal operational behavior.","Windows Event ID 4663; ICS File Servers, Data Historians, ICS Backup Servers, Engineering Workstations (EWS), Process Control Servers (PCS)",last 90 days,"Search: Machine Learning Platform; Pseudocode: DEPLOY time-series anomaly detection model (e.g., LSTM) trained on 1-minute aggregated 'DELETE' counts from NAI_list.
  SEGMENT by user and process.
  ALERT IF actual count deviates significantly from model's predicted range.",playbooks/attack/ics/T0809.yml
T0809: Data Destruction,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0107: Inhibit Response Function,n; o; n; e,7,Are critical ICS project or configuration files being deleted?,"This question focuses on the highest-impact scenario: the deletion of specific, irreplaceable ICS files identified by their extensions (e.g., .ACD for Rockwell projects, .S7P for Siemens projects). The deletion of even a single one of these files by an unauthorized process or user is a critical event that requires immediate investigation, as it can halt production or render a system inoperable.","Windows Event ID 4663; Engineering Workstations (EWS), File servers hosting ICS project files, Data Historians, ICS Backup Servers",last 90 days,"Search: SIEM; Pseudocode: SEARCH Windows Event ID 4663 WHERE (accesses CONTAINS 'DELETE') AND (object_name ENDS WITH critical_ICS_extensions) AND (user/process NOT IN whitelist).
  ALERT immediately.",playbooks/attack/ics/T0809.yml
T0809: Data Destruction,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0107: Inhibit Response Function,n; o; n; e,8,Is a user or process deleting a critical ICS file type for the first time or at an unusual time?,"This question aims to detect suspicious deletions by identifying rare or novel behavior. An administrator might regularly delete backup '.ACD' files, but an operator deleting one for the first time is highly anomalous. By calculating a rarity score based on historical user/file-type interactions and timing, this method can flag suspicious activity that might otherwise appear legitimate.","Windows Event ID 4663; Engineering Workstations (EWS), File servers hosting ICS project files, Data Historians, ICS Backup Servers",last 90 days,"Search: Data Analytics Platform; Pseudocode: FOR each deletion of a critical ICS file:
  CALCULATE rarity_score based on historical frequency of (user, file_extension) pair.
  ALERT IF rarity_score is high OR deletion time is statistically anomalous.",playbooks/attack/ics/T0809.yml
T0809: Data Destruction,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0107: Inhibit Response Function,n; o; n; e,9,Can a machine learning model be trained to distinguish between legitimate and malicious deletions of critical ICS files?,"This question proposes using supervised machine learning to build a highly sophisticated detection capability. By training a model on labeled examples of 'good' and 'bad' deletions, it can learn the subtle, multi-faceted patterns that differentiate routine maintenance from a malicious attack. Features like user, process, file type, time, and rarity score are combined to make a high-confidence classification.","Windows Event ID 4663; Engineering Workstations (EWS), File servers hosting ICS project files, Data Historians, ICS Backup Servers",last 90 days,"Search: Machine Learning Platform; Pseudocode: DEPLOY classification model (e.g., Random Forest) trained on labeled 'DELETE' events of critical files.
  FEATURES: user, process, file_extension, source_workstation, time_of_day, rarity_score.
  ALERT IF classification is 'malicious' with confidence > 0.9.",playbooks/attack/ics/T0809.yml
T0809: Data Destruction,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0107: Inhibit Response Function,n; o; n; e,10,Is a known malicious executable being transferred into the OT/ICS network?,"This question seeks to identify the introduction of malware or unauthorized tools into the secure OT network. It works by monitoring network traffic for executable file transfers and cross-referencing the file's hash against threat intelligence feeds. An alert here indicates a potential precursor to an attack, such as an adversary staging a data destruction tool.","Zeek conn.log; Zeek files.log; Zeek pe.log; Network boundary between IT and OT networks (ICS DMZ), Core ICS network segments, SCADA network, Process Control Network (PCN)",last 90 days,"Search: SIEM; Pseudocode: SEARCH Zeek files.log WHERE (destination_ip IN OT_subnet) AND (mime_type is 'application/x-dosexec').
  CHECK file_hash against threat intelligence.
  CORRELATE with conn.log to check for non-standard ports.
  ALERT on match.",playbooks/attack/ics/T0809.yml
T0809: Data Destruction,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0107: Inhibit Response Function,n; o; n; e,11,"Is an executable file with suspicious characteristics (e.g., high entropy, anomalous PE header) being transferred into the OT network?","This question aims to detect potentially malicious executables that are not yet known to threat intelligence. Packed or encrypted malware often has high entropy. Similarly, malicious tools may have PE headers that deviate from the standard for legitimate ICS software. By baselining these characteristics, this method can flag novel or custom-made malicious executables.","Zeek conn.log; Zeek files.log; Zeek pe.log; Network boundary between IT and OT networks (ICS DMZ), Core ICS network segments, SCADA network, Process Control Network (PCN)",last 90 days,"Search: Data Analytics Platform; Pseudocode: FOR each executable transferred to OT_subnet:
  CALCULATE file entropy.
  ALERT IF entropy > 7.5 OR entropy > 3*std_dev from baseline.
  COMPARE PE header values to trusted baseline.
  ALERT on significant deviation.",playbooks/attack/ics/T0809.yml
T0809: Data Destruction,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0107: Inhibit Response Function,n; o; n; e,12,Can a machine learning model proactively classify file transfers into the OT network as malicious or benign?,"This question uses a supervised machine learning model to provide a comprehensive, real-time assessment of every file transfer into the OT network. By combining multiple features from network logs (file size, type, entropy, PE header info, connection details, IP reputation), the model can make a holistic judgment and flag suspicious transfers with high confidence, providing a powerful defense against the staging of malicious tools.","Zeek conn.log; Zeek files.log; Zeek pe.log; Network boundary between IT and OT networks (ICS DMZ), Core ICS network segments, SCADA network, Process Control Network (PCN)",last 90 days,"Search: Machine Learning Platform; Pseudocode: DEPLOY classification model (e.g., LightGBM) trained on labeled file transfer data.
  FEATURES: file_size, mime_type, entropy, PE_header_info, connection_duration, IP_reputation.
  ALERT IF classification is 'malicious' with confidence > 0.9.",playbooks/attack/ics/T0809.yml
T0812: Default Credentials,a3f8e1c2-7b6d-4a9f-8e1c-2d3b4a5c6d7e,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0109: Lateral Movement,n; o; n; e,1,Has a successful network connection to a critical ICS asset using a management or ICS protocol been authenticated with a known default credential from an unauthorized source?,"This question aims to detect direct lateral movement attempts against OT devices. Adversaries often scan for and attempt to log into Programmable Logic Controllers (PLCs), Remote Terminal Units (RTUs), and other field devices using common, factory-set credentials. This rule-based approach looks for the explicit combination of a connection to a sensitive device, the use of a default username, and a source IP that is not on an approved whitelist. For protocols like Modbus or DNP3 that lack native authentication, the query identifies unauthorized sources attempting to issue privileged 'write' or 'control' commands, which is a strong indicator of compromise.
","Z; e; e; k;  ; c; o; n; n; .; l; o; g; ,;  ; Z; e; e; k;  ; s; s; h; .; l; o; g; ,;  ; Z; e; e; k;  ; f; t; p; .; l; o; g; ,;  ; Z; e; e; k;  ; t; e; l; n; e; t; .; l; o; g; ,;  ; Z; e; e; k;  ; r; d; p; .; l; o; g; ,;  ; Z; e; e; k;  ; m; o; d; b; u; s; .; l; o; g; ,;  ; Z; e; e; k;  ; d; n; p; 3; .; l; o; g; ,;  ; Z; e; e; k;  ; e; n; i; p; .; l; o; g; ,;  ; Z; e; e; k;  ; s; 7; c; o; m; m; .; l; o; g; ,;  ; S; y; s; m; o; n;  ; E; v; e; n; t;  ; I; D;  ; 3; ,;  ; I; C; S;  ; A; s; s; e; t;  ; I; n; v; e; n; t; o; r; y; ,;  ; N; e; t; w; o; r; k;  ; A; c; c; e; s; s;  ; C; o; n; t; r; o; l;  ; L; i; s; t; s;  ; (; A; C; L; s; ); .;  ; N; e; t; w; o; r; k; s;  ; o; f;  ; I; n; t; e; r; e; s; t; :;  ; L; e; v; e; l;  ; 1;  ; (; P; r; o; c; e; s; s;  ; C; o; n; t; r; o; l; );  ; a; n; d;  ; L; e; v; e; l;  ; 2;  ; (; S; u; p; e; r; v; i; s; o; r; y;  ; C; o; n; t; r; o; l; );  ; n; e; t; w; o; r; k; s; ,;  ; s; p; e; c; i; f; i; c; a; l; l; y;  ; t; a; r; g; e; t; i; n; g;  ; P; L; C; s; ,;  ; R; T; U; s; ,;  ; H; M; I; s; ,;  ; I; E; D; s; ,;  ; a; n; d;  ; o; t; h; e; r;  ; f; i; e; l; d;  ; d; e; v; i; c; e; s; .;  ; A; l; s; o; ,;  ; t; h; e;  ; I; T; /; O; T;  ; D; M; Z;  ; (; P; u; r; d; u; e;  ; M; o; d; e; l;  ; L; e; v; e; l;  ; 3; .; 5; ); ,;  ; n; e; t; w; o; r; k;  ; t; r; a; f; f; i; c;  ; b; e; t; w; e; e; n;  ; E; n; g; i; n; e; e; r; i; n; g;  ; W; o; r; k; s; t; a; t; i; o; n; s;  ; a; n; d;  ; L; e; v; e; l;  ; 2; /; 1;  ; d; e; v; i; c; e; s; ,;  ; a; n; d;  ; c; o; n; n; e; c; t; i; o; n; s;  ; t; o;  ; S; C; A; D; A;  ; s; e; r; v; e; r; s;  ; a; n; d;  ; H; i; s; t; o; r; i; a; n;  ; d; a; t; a; b; a; s; e; s; .; 
",last 90 days,": JOIN network_flows ON connection_id WITH authentication_logs
WHERE destination_ip IN critical_ics_assets
AND destination_port IN management_ports
AND username IN default_credential_list
AND source_ip NOT IN approved_whitelist
",playbooks/attack/ics/T0812.yml
T0812: Default Credentials,a3f8e1c2-7b6d-4a9f-8e1c-2d3b4a5c6d7e,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0109: Lateral Movement,n; o; n; e,2,Has a critical ICS asset experienced a successful authentication event using a default credential that is statistically rare or anomalous for that asset?,"This question uses a statistical, risk-based approach to identify suspicious authentications. Instead of a simple block/allow rule, it baselines normal user authentication behavior for each critical asset over a 30-day period. By calculating the frequency of each username's appearance, it can identify when a common default credential is used for the first time or with unusual rarity. An alert is triggered when a login with a default credential has a risk score (inversely proportional to its historical frequency) that falls into the top percentile, suggesting a deviation from the established norm and a potential compromise.
","Z; e; e; k;  ; c; o; n; n; .; l; o; g; ,;  ; Z; e; e; k;  ; s; s; h; .; l; o; g; ,;  ; Z; e; e; k;  ; f; t; p; .; l; o; g; ,;  ; Z; e; e; k;  ; t; e; l; n; e; t; .; l; o; g; ,;  ; Z; e; e; k;  ; r; d; p; .; l; o; g; ,;  ; Z; e; e; k;  ; m; o; d; b; u; s; .; l; o; g; ,;  ; Z; e; e; k;  ; d; n; p; 3; .; l; o; g; ,;  ; Z; e; e; k;  ; e; n; i; p; .; l; o; g; ,;  ; Z; e; e; k;  ; s; 7; c; o; m; m; .; l; o; g; ,;  ; S; y; s; m; o; n;  ; E; v; e; n; t;  ; I; D;  ; 3; ,;  ; I; C; S;  ; A; s; s; e; t;  ; I; n; v; e; n; t; o; r; y; ,;  ; N; e; t; w; o; r; k;  ; A; c; c; e; s; s;  ; C; o; n; t; r; o; l;  ; L; i; s; t; s;  ; (; A; C; L; s; ); .;  ; N; e; t; w; o; r; k; s;  ; o; f;  ; I; n; t; e; r; e; s; t; :;  ; L; e; v; e; l;  ; 1;  ; (; P; r; o; c; e; s; s;  ; C; o; n; t; r; o; l; );  ; a; n; d;  ; L; e; v; e; l;  ; 2;  ; (; S; u; p; e; r; v; i; s; o; r; y;  ; C; o; n; t; r; o; l; );  ; n; e; t; w; o; r; k; s; ,;  ; s; p; e; c; i; f; i; c; a; l; l; y;  ; t; a; r; g; e; t; i; n; g;  ; P; L; C; s; ,;  ; R; T; U; s; ,;  ; H; M; I; s; ,;  ; I; E; D; s; ,;  ; a; n; d;  ; o; t; h; e; r;  ; f; i; e; l; d;  ; d; e; v; i; c; e; s; .;  ; A; l; s; o; ,;  ; t; h; e;  ; I; T; /; O; T;  ; D; M; Z;  ; (; P; u; r; d; u; e;  ; M; o; d; e; l;  ; L; e; v; e; l;  ; 3; .; 5; ); ,;  ; n; e; t; w; o; r; k;  ; t; r; a; f; f; i; c;  ; b; e; t; w; e; e; n;  ; E; n; g; i; n; e; e; r; i; n; g;  ; W; o; r; k; s; t; a; t; i; o; n; s;  ; a; n; d;  ; L; e; v; e; l;  ; 2; /; 1;  ; d; e; v; i; c; e; s; ,;  ; a; n; d;  ; c; o; n; n; e; c; t; i; o; n; s;  ; t; o;  ; S; C; A; D; A;  ; s; e; r; v; e; r; s;  ; a; n; d;  ; H; i; s; t; o; r; i; a; n;  ; d; a; t; a; b; a; s; e; s; .; 
",last 90 days,": FOR each critical_ics_asset:
  BASELINE authentication logs over 30 days to get username frequencies
FOR each new successful authentication:
  IF username IN default_credential_list:
    CALCULATE risk_score = 1 / (frequency + 1)
    IF risk_score > 99th_percentile_for_asset:
      ALERT
",playbooks/attack/ics/T0812.yml
T0812: Default Credentials,a3f8e1c2-7b6d-4a9f-8e1c-2d3b4a5c6d7e,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0109: Lateral Movement,n; o; n; e,3,Is there an anomalous network connection involving a default credential authentication that deviates from the learned model of normal communication patterns?,"This question leverages an unsupervised machine learning model to detect novel or sophisticated lateral movement attempts that might evade rule-based and statistical methods. By representing the entire network as a graph, a model like GraphSAGE can learn the complex relationships and typical communication patterns between all devices. When a new connection occurs, the model can score it for anomalousness. This approach is powerful because it doesn't rely on pre-defined rules. A high anomaly score, especially when correlated with a successful authentication using a default credential, provides a strong signal of a potential threat that does not conform to the learned network baseline.
","Z; e; e; k;  ; c; o; n; n; .; l; o; g; ,;  ; Z; e; e; k;  ; s; s; h; .; l; o; g; ,;  ; Z; e; e; k;  ; f; t; p; .; l; o; g; ,;  ; Z; e; e; k;  ; t; e; l; n; e; t; .; l; o; g; ,;  ; Z; e; e; k;  ; r; d; p; .; l; o; g; ,;  ; Z; e; e; k;  ; m; o; d; b; u; s; .; l; o; g; ,;  ; Z; e; e; k;  ; d; n; p; 3; .; l; o; g; ,;  ; Z; e; e; k;  ; e; n; i; p; .; l; o; g; ,;  ; Z; e; e; k;  ; s; 7; c; o; m; m; .; l; o; g; ,;  ; S; y; s; m; o; n;  ; E; v; e; n; t;  ; I; D;  ; 3; ,;  ; I; C; S;  ; A; s; s; e; t;  ; I; n; v; e; n; t; o; r; y; ,;  ; N; e; t; w; o; r; k;  ; A; c; c; e; s; s;  ; C; o; n; t; r; o; l;  ; L; i; s; t; s;  ; (; A; C; L; s; ); .;  ; N; e; t; w; o; r; k; s;  ; o; f;  ; I; n; t; e; r; e; s; t; :;  ; L; e; v; e; l;  ; 1;  ; (; P; r; o; c; e; s; s;  ; C; o; n; t; r; o; l; );  ; a; n; d;  ; L; e; v; e; l;  ; 2;  ; (; S; u; p; e; r; v; i; s; o; r; y;  ; C; o; n; t; r; o; l; );  ; n; e; t; w; o; r; k; s; ,;  ; s; p; e; c; i; f; i; c; a; l; l; y;  ; t; a; r; g; e; t; i; n; g;  ; P; L; C; s; ,;  ; R; T; U; s; ,;  ; H; M; I; s; ,;  ; I; E; D; s; ,;  ; a; n; d;  ; o; t; h; e; r;  ; f; i; e; l; d;  ; d; e; v; i; c; e; s; .;  ; A; l; s; o; ,;  ; t; h; e;  ; I; T; /; O; T;  ; D; M; Z;  ; (; P; u; r; d; u; e;  ; M; o; d; e; l;  ; L; e; v; e; l;  ; 3; .; 5; ); ,;  ; n; e; t; w; o; r; k;  ; t; r; a; f; f; i; c;  ; b; e; t; w; e; e; n;  ; E; n; g; i; n; e; e; r; i; n; g;  ; W; o; r; k; s; t; a; t; i; o; n; s;  ; a; n; d;  ; L; e; v; e; l;  ; 2; /; 1;  ; d; e; v; i; c; e; s; ,;  ; a; n; d;  ; c; o; n; n; e; c; t; i; o; n; s;  ; t; o;  ; S; C; A; D; A;  ; s; e; r; v; e; r; s;  ; a; n; d;  ; H; i; s; t; o; r; i; a; n;  ; d; a; t; a; b; a; s; e; s; .; 
",last 90 days,": TRAIN GraphSAGE model on baseline network connection graph (nodes=IPs, edges=connections)
FOR each new network connection:
  CALCULATE anomaly_score using trained model
  IF anomaly_score is high AND connection involves default_credential_auth:
    ALERT
",playbooks/attack/ics/T0812.yml
T0812: Default Credentials,a3f8e1c2-7b6d-4a9f-8e1c-2d3b4a5c6d7e,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0109: Lateral Movement,n; o; n; e,4,"Has a default or shared account been used to log into a critical Windows-based OT asset, followed shortly by the use of remote access tools to connect to another ICS device?","This question focuses on detecting a common adversary pivot technique within Windows-based OT environments like Engineering Workstations (EWS) or HMIs. The pattern involves an initial compromise of a host using a weak, default, or shared account. The adversary then immediately uses that access to launch a remote access tool (like RDP, SSH via PuTTY, or PowerShell Remoting) to move deeper into the OT network. This SIEM-based correlation rule specifically looks for this sequence: a successful logon (Event ID 4624) with a flagged account, followed within 5 minutes by the execution of a remote access process (Event ID 4688/4104) and a subsequent network connection to another sensitive ICS asset.
","W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 6; 2; 4; ,;  ; W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 6; 8; 8; ,;  ; P; o; w; e; r; S; h; e; l; l;  ; E; v; e; n; t;  ; I; D;  ; 4; 1; 0; 4; ,;  ; S; y; s; m; o; n;  ; E; v; e; n; t;  ; I; D;  ; 1; ,;  ; S; y; s; m; o; n;  ; E; v; e; n; t;  ; I; D;  ; 3; ,;  ; Z; e; e; k;  ; c; o; n; n; .; l; o; g; ,;  ; Z; e; e; k;  ; s; s; h; .; l; o; g; ,;  ; Z; e; e; k;  ; r; d; p; .; l; o; g; .;  ; N; e; t; w; o; r; k; s;  ; o; f;  ; I; n; t; e; r; e; s; t; :;  ; E; n; g; i; n; e; e; r; i; n; g;  ; W; o; r; k; s; t; a; t; i; o; n; s;  ; (; E; W; S; ); ,;  ; J; u; m; p;  ; S; e; r; v; e; r; s; ,;  ; R; e; m; o; t; e;  ; A; c; c; e; s; s;  ; S; e; r; v; e; r; s; ,;  ; S; C; A; D; A;  ; S; e; r; v; e; r; s; ,;  ; a; n; d;  ; H; u; m; a; n; -; M; a; c; h; i; n; e;  ; I; n; t; e; r; f; a; c; e; s;  ; (; H; M; I; s; );  ; r; u; n; n; i; n; g;  ; W; i; n; d; o; w; s;  ; o; p; e; r; a; t; i; n; g;  ; s; y; s; t; e; m; s;  ; w; i; t; h; i; n;  ; t; h; e;  ; P; r; o; c; e; s; s;  ; C; o; n; t; r; o; l;  ; N; e; t; w; o; r; k;  ; (; P; C; N; );  ; o; r;  ; I; T; /; O; T;  ; D; M; Z; .; 
",last 90 days,": TRIGGER on successful logon (WinEvent 4624) WHERE account IN default_account_list AND host IN critical_ot_assets
CORRELATE by LogonID with process_creation (WinEvent 4688) or powershell_log (4104) for remote_access_tools within 5 minutes
CORRELATE by source_ip and time with network_connection (Sysmon 3 or Zeek) to another ICS asset
IF all conditions met: ALERT
",playbooks/attack/ics/T0812.yml
T0812: Default Credentials,a3f8e1c2-7b6d-4a9f-8e1c-2d3b4a5c6d7e,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0109: Lateral Movement,n; o; n; e,5,"Has a user session on a critical OT server, initiated with a default or shared account, exhibited a statistically anomalous sequence of process executions or network connections?","This question provides a more nuanced, behavioral approach to detecting abuse of default accounts on critical Windows servers. Rather than looking for a specific sequence, it scores the entire user session for rarity. It establishes a 30-day baseline to understand what processes and network destinations are common for a given host. When a new session starts with a default account, it calculates a risk score based on the rarity of the actions taken during that session (from logon to logoff). A session with a risk score in the top percentile indicates that the user is performing actions that are highly unusual for that host, which is a strong indicator of malicious activity.
","W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 6; 2; 4; ,;  ; W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 6; 8; 8; ,;  ; P; o; w; e; r; S; h; e; l; l;  ; E; v; e; n; t;  ; I; D;  ; 4; 1; 0; 4; ,;  ; S; y; s; m; o; n;  ; E; v; e; n; t;  ; I; D;  ; 1; ,;  ; S; y; s; m; o; n;  ; E; v; e; n; t;  ; I; D;  ; 3; ,;  ; Z; e; e; k;  ; c; o; n; n; .; l; o; g; ,;  ; Z; e; e; k;  ; s; s; h; .; l; o; g; ,;  ; Z; e; e; k;  ; r; d; p; .; l; o; g; .;  ; N; e; t; w; o; r; k; s;  ; o; f;  ; I; n; t; e; r; e; s; t; :;  ; E; n; g; i; n; e; e; r; i; n; g;  ; W; o; r; k; s; t; a; t; i; o; n; s;  ; (; E; W; S; ); ,;  ; J; u; m; p;  ; S; e; r; v; e; r; s; ,;  ; R; e; m; o; t; e;  ; A; c; c; e; s; s;  ; S; e; r; v; e; r; s; ,;  ; S; C; A; D; A;  ; S; e; r; v; e; r; s; ,;  ; a; n; d;  ; H; u; m; a; n; -; M; a; c; h; i; n; e;  ; I; n; t; e; r; f; a; c; e; s;  ; (; H; M; I; s; );  ; r; u; n; n; i; n; g;  ; W; i; n; d; o; w; s;  ; o; p; e; r; a; t; i; n; g;  ; s; y; s; t; e; m; s;  ; w; i; t; h; i; n;  ; t; h; e;  ; P; r; o; c; e; s; s;  ; C; o; n; t; r; o; l;  ; N; e; t; w; o; r; k;  ; (; P; C; N; );  ; o; r;  ; I; T; /; O; T;  ; D; M; Z; .; 
",last 90 days,": FOR each critical host:
  BASELINE process executions and network connections over 30 days to get rarity probabilities
FOR each new user session (by LogonID) initiated with default_account:
  CALCULATE session_risk_score = SUM(-log(probability)) for each action
  IF session_risk_score > 98th_percentile_for_host:
    ALERT
",playbooks/attack/ics/T0812.yml
T0812: Default Credentials,a3f8e1c2-7b6d-4a9f-8e1c-2d3b4a5c6d7e,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0109: Lateral Movement,n; o; n; e,6,Does a user session initiated with a default account on an EWS or jump server show a high reconstruction error when analyzed by a sequence-based anomaly detection model?,"This question applies advanced machine learning to detect anomalous user sessions. It uses a sequence-based model, like an LSTM autoencoder, which is specifically designed to learn normal sequences of events (e.g., process A runs, then connects to server B, then process C runs). The model is trained on historical event logs from EWS and jump servers. In production, it attempts to reconstruct live user sessions. If a session initiated with a default account is highly anomalous (i.e., has a high 'reconstruction error'), it means the sequence of actions does not match any learned normal behavior. This is a powerful method for catching novel attack patterns that other methods might miss.
","W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 6; 2; 4; ,;  ; W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 6; 8; 8; ,;  ; P; o; w; e; r; S; h; e; l; l;  ; E; v; e; n; t;  ; I; D;  ; 4; 1; 0; 4; ,;  ; S; y; s; m; o; n;  ; E; v; e; n; t;  ; I; D;  ; 1; ,;  ; S; y; s; m; o; n;  ; E; v; e; n; t;  ; I; D;  ; 3; ,;  ; Z; e; e; k;  ; c; o; n; n; .; l; o; g; ,;  ; Z; e; e; k;  ; s; s; h; .; l; o; g; ,;  ; Z; e; e; k;  ; r; d; p; .; l; o; g; .;  ; N; e; t; w; o; r; k; s;  ; o; f;  ; I; n; t; e; r; e; s; t; :;  ; E; n; g; i; n; e; e; r; i; n; g;  ; W; o; r; k; s; t; a; t; i; o; n; s;  ; (; E; W; S; ); ,;  ; J; u; m; p;  ; S; e; r; v; e; r; s; ,;  ; R; e; m; o; t; e;  ; A; c; c; e; s; s;  ; S; e; r; v; e; r; s; ,;  ; S; C; A; D; A;  ; S; e; r; v; e; r; s; ,;  ; a; n; d;  ; H; u; m; a; n; -; M; a; c; h; i; n; e;  ; I; n; t; e; r; f; a; c; e; s;  ; (; H; M; I; s; );  ; r; u; n; n; i; n; g;  ; W; i; n; d; o; w; s;  ; o; p; e; r; a; t; i; n; g;  ; s; y; s; t; e; m; s;  ; w; i; t; h; i; n;  ; t; h; e;  ; P; r; o; c; e; s; s;  ; C; o; n; t; r; o; l;  ; N; e; t; w; o; r; k;  ; (; P; C; N; );  ; o; r;  ; I; T; /; O; T;  ; D; M; Z; .; 
",last 90 days,": TRAIN LSTM autoencoder on baseline user session event sequences
FOR each new user session:
  CALCULATE reconstruction_error using trained model
  IF reconstruction_error is high AND session initiated with default_account:
    ALERT",playbooks/attack/ics/T0812.yml
T0815: Denial of View,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0105: Impact,n; o; n; e,1,Has a critical PLC failed to send its expected periodic message to an HMI/Server within its established polling interval?,"This question aims to detect a complete communication loss from a field device. An adversary might block or interrupt this traffic to blind operators to the true state of the physical process. Detecting a missed ""heartbeat"" that exceeds the normal polling jitter (using a 2.5x multiplier as a threshold) is a direct indicator of a potential Denial of View attack. Correlating this with specific protocol error messages can confirm the HMI is aware of the failure but cannot receive data.","Zeek conn.log; Zeek modbus.log; Zeek enip.log; Zeek dnp3.log; Network Area of Interest: ICS Level 2 (Control System) network segment, specifically traffic between HMI/SCADA servers and Level 1 (Basic Control) PLCs/RTUs.",last 90 days,"SIEM Pseudocode: SEARCH Zeek ICS logs FOR critical PLC/HMI pairs WHERE message_not_seen IN (polling_interval * 2.5) AND CORRELATE WITH ICS error_codes LIKE ""Gateway Target Device Failed to Respond"".",playbooks/attack/ics/T0815.yml
T0815: Denial of View,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0105: Impact,n; o; n; e,2,Has there been a sustained and anomalous reduction in network traffic volume between a critical PLC and HMI?,"This question looks for a significant degradation of communication rather than a complete loss. Adversaries might throttle traffic to degrade, but not completely sever, operator visibility. By baselining normal traffic volumes (packet and byte counts) and inter-arrival times (jitter), we can detect subtle manipulations that fall below normal thresholds for an extended period, indicating a potential ongoing attack that precedes a full communication loss.","Zeek conn.log; Zeek modbus.log; Zeek enip.log; Zeek dnp3.log; Network Area of Interest: ICS Level 2 (Control System) network segment, specifically traffic between HMI/SCADA servers and Level 1 (Basic Control) PLCs/RTUs.",last 90 days,"SIEM Pseudocode: FOR each critical PLC/HMI pair, BASELINE packet/byte counts over 14 days. ALERT IF current packet/byte counts < 1st_percentile_baseline FOR 3 consecutive intervals OR IF message_jitter > 3 * stdev(historical_jitter).",playbooks/attack/ics/T0815.yml
T0815: Denial of View,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0105: Impact,n; o; n; e,3,"Does the network traffic pattern between critical PLCs and HMIs deviate significantly from the historically learned normal ""heartbeat""?","This question uses machine learning to identify sophisticated anomalies that simple threshold-based rules might miss. A time-series model like an LSTM autoencoder learns the complex, multi-variate relationships in network telemetry over time. A high reconstruction error (anomaly score) indicates that the current traffic pattern is highly improbable based on historical data, providing a high-confidence signal of an abnormal state, such as a Denial of View attack, even if traffic has not completely stopped.","Zeek conn.log; Zeek modbus.log; Zeek enip.log; Zeek dnp3.log; Network Area of Interest: ICS Level 2 (Control System) network segment, specifically traffic between HMI/SCADA servers and Level 1 (Basic Control) PLCs/RTUs.",last 90 days,"ML Model Pseudocode: INPUT real-time network telemetry (packets, bytes, protocol_mix) INTO trained LSTM model. ALERT IF anomaly_score > threshold AND packet_count is near-zero.",playbooks/attack/ics/T0815.yml
T0815: Denial of View,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0105: Impact,n; o; n; e,4,Was a critical HMI application terminated by an unapproved parent process or did it crash unexpectedly?,"This question focuses on identifying the illegitimate termination of HMI software. Adversaries may kill these processes to prevent operators from viewing or interacting with the control system. By monitoring process termination events (Sysmon ID 5) and checking the parent process that initiated the termination against a whitelist of legitimate launchers, we can distinguish between normal shutdowns and malicious actions. A non-zero exit code is also a strong indicator of a crash, which could be induced by an adversary.",Windows Event ID 4689; Windows Event ID 4688; Windows Event ID 1 (Sysmon Process Create); Windows Event ID 5 (Sysmon Process Terminate); Network Area of Interest: ICS Level 2 (Control System) HMI Workstations and Engineering Workstations.,last 90 days,SIEM Pseudocode: SEARCH for Process_Termination_Event (Sysmon ID 5) WHERE process_name IN critical_HMI_list. CORRELATE with Process_Creation_Event (Sysmon ID 1) to find parent_process. ALERT IF parent_process NOT IN whitelist OR exit_code != 0.,playbooks/attack/ics/T0815.yml
T0815: Denial of View,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0105: Impact,n; o; n; e,5,Has there been an unusual spike in HMI application terminations or has an HMI process terminated with a rare or never-before-seen exit code?,"This question seeks to find anomalies in the frequency and nature of HMI process terminations. A sudden increase in terminations within a short timeframe (e.g., hourly) compared to a historical baseline can indicate a repeated attack or instability. Furthermore, analyzing exit codes can reveal problems; a new or statistically rare exit code suggests the process terminated in a way that is not typical, warranting investigation for malicious interference or induced faults.",Windows Event ID 4689; Windows Event ID 4688; Windows Event ID 1 (Sysmon Process Create); Windows Event ID 5 (Sysmon Process Terminate); Network Area of Interest: ICS Level 2 (Control System) HMI Workstations and Engineering Workstations.,last 90 days,"SIEM Pseudocode: BASELINE hourly termination counts (Sysmon ID 5) for HMI processes over 30 days. ALERT IF current_hour_count > 99th_percentile_threshold. SEPARATELY, ALERT IF exit_code for HMI termination is new or statistically rare (<0.1% historical occurrence).",playbooks/attack/ics/T0815.yml
T0815: Denial of View,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0105: Impact,n; o; n; e,6,Does a machine learning model classify the termination of an HMI process as potentially malicious based on its context?,"This question leverages machine learning to provide a sophisticated, context-aware assessment of HMI process termination events. By training a model on features like the parent process, user context, time of day, and command-line arguments, it can learn the subtle differences between benign and malicious terminations. This allows for the detection of novel or evasive techniques that might not be caught by simple rules, flagging events with a high probability of being malicious for immediate analyst review.",Windows Event ID 4689; Windows Event ID 4688; Windows Event ID 1 (Sysmon Process Create); Windows Event ID 5 (Sysmon Process Terminate); Network Area of Interest: ICS Level 2 (Control System) HMI Workstations and Engineering Workstations.,last 90 days,"ML Model Pseudocode: INPUT new HMI process termination event features (parent_process, user, time, etc.) INTO trained classification model. ALERT IF model_output_probability(""malicious"") > high_confidence_threshold.",playbooks/attack/ics/T0815.yml
T0820: Exploitation for Evasion,e5b8e9b0-13d8-4a46-8a71-9f79b37a54a0,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0103: Evasion,n; o; n; e,1,"Is there network traffic violating the established whitelist of authorized IPs, assets, and protocols, or does it match known exploit signatures?","This question aims to detect blatant policy violations, such as connections from unauthorized sources or the use of forbidden protocols like RDP or SMB to critical ICS assets. Such activity is a strong indicator of an initial breach or lateral movement attempt. Correlating this with known exploit signatures provides a higher level of confidence that the activity is malicious.",Zeek conn.log; Zeek notice.log; Zeek dce_rpc.log; Zeek rdp.log; Process Control Network (PCN); Engineering Workstations (EWS); Human-Machine Interfaces (HMIs); Network boundary between IT and OT networks; Industrial Demilitarized Zone (IDMZ),last 90 days,"Pseudocode: SEARCH Zeek conn.log WHERE (source_ip NOT IN whitelist OR destination_ip NOT IN whitelist OR (protocol, port) NOT IN whitelist) OR (protocol IN [RDP, SMB, FTP]). CORRELATE with Zeek notice.log for matching signatures.",playbooks/attack/ics/T0820.yml
T0820: Exploitation for Evasion,e5b8e9b0-13d8-4a46-8a71-9f79b37a54a0,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0103: Evasion,n; o; n; e,2,"Are there network connections to or from ICS assets whose metrics (e.g., data volume, duration) significantly deviate from their established historical baseline?",This question helps identify subtle anomalies that might not violate a strict whitelist but are statistically unusual. An exploit or data exfiltration attempt might manifest as a connection that is unusually long or transfers an abnormally large amount of data compared to its normal behavior. Detecting deviations greater than 3 standard deviations helps filter out normal fluctuations and focuses on significant outliers.,Zeek conn.log; Zeek notice.log; Zeek dce_rpc.log; Zeek rdp.log; Process Control Network (PCN); Engineering Workstations (EWS); Human-Machine Interfaces (HMIs); Network boundary between IT and OT networks; Industrial Demilitarized Zone (IDMZ),last 90 days,"Pseudocode: FOR each connection in Zeek conn.log, CALCULATE 30-day baseline (mean, stddev) for its source-dest-port-proto tuple. ALERT if current_connection.bytes > mean + (3 * stddev) OR current_connection.duration > mean + (3 * stddev).",playbooks/attack/ics/T0820.yml
T0820: Exploitation for Evasion,e5b8e9b0-13d8-4a46-8a71-9f79b37a54a0,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0103: Evasion,n; o; n; e,3,Does the overall volume or frequency of network connections to critical ICS assets deviate from patterns predicted by a time-series anomaly detection model?,"This question seeks to identify coordinated or large-scale attacks that might not be apparent when looking at individual connections. A sudden spike in the number of connections or total data volume to a PLC, even if each connection is small, could indicate a distributed scanning or exploitation attempt. A time-series model can learn the 'rhythm' of the network and flag deviations from this learned normal pattern.",Zeek conn.log; Zeek notice.log; Zeek dce_rpc.log; Zeek rdp.log; Process Control Network (PCN); Engineering Workstations (EWS); Human-Machine Interfaces (HMIs); Network boundary between IT and OT networks; Industrial Demilitarized Zone (IDMZ),last 90 days,"Pseudocode: INPUT historical Zeek conn.log data (count, volume per hour) into time-series model. FORECAST expected activity. ALERT if current observed activity significantly deviates from forecast.",playbooks/attack/ics/T0820.yml
T0820: Exploitation for Evasion,e5b8e9b0-13d8-4a46-8a71-9f79b37a54a0,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0103: Evasion,n; o; n; e,4,"Has a suspicious process been created on a critical ICS host, characterized by being unsigned, running from a non-standard location, or being a LOLBin with suspicious parameters?","This question focuses on detecting common malware execution patterns on endpoints like HMIs and EWS. Legitimate software in an OT environment is typically signed and runs from expected directories. Processes that are unsigned, run from temporary folders, or leverage built-in system tools (LOLBins) for malicious purposes (like downloading files with certutil.exe) are high-fidelity indicators of compromise.",Windows Event ID 4688; Windows Event ID 5156; Engineering Workstations (EWS); Human-Machine Interfaces (HMIs); Jump Servers within the OT network,last 90 days,"Pseudocode: SEARCH Windows Event ID 4688 WHERE (process is unsigned AND process NOT IN whitelist) OR (process_path IN [%TEMP%, C:\Users\Public]) OR (process_name IN LOLBin_list AND command_line contains suspicious_args). CORRELATE with Event ID 5156 for network connections.",playbooks/attack/ics/T0820.yml
T0820: Exploitation for Evasion,e5b8e9b0-13d8-4a46-8a71-9f79b37a54a0,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0103: Evasion,n; o; n; e,5,"Are there new processes being created with unusually complex or obfuscated command-line arguments, or are they being spawned by unexpected parent processes?","This question aims to uncover attempts to hide malicious commands through obfuscation (detected by high entropy) or to execute code through an unusual process chain. For example, an HMI application should not normally spawn a command prompt (cmd.exe). Baselining normal command line entropy and parent-child relationships allows for the detection of these statistically rare and suspicious events.",Windows Event ID 4688; Windows Event ID 5156; Engineering Workstations (EWS); Human-Machine Interfaces (HMIs); Jump Servers within the OT network,last 90 days,"Pseudocode: FOR each new process (Event ID 4688), CALCULATE shannon_entropy of command_line. ALERT if entropy > 99th_percentile_baseline. SEARCH for parent-child relationships with frequency < 1st_percentile_baseline.",playbooks/attack/ics/T0820.yml
T0820: Exploitation for Evasion,e5b8e9b0-13d8-4a46-8a71-9f79b37a54a0,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0103: Evasion,n; o; n; e,6,Has a machine learning model classified any newly created process on an ICS host as 'suspicious' with a high confidence score?,"This question leverages a more advanced, holistic approach to process analysis. By training a model on various features like process name, parent, path, and entropy, it can learn the subtle characteristics of both benign and malicious behavior specific to the ICS environment. This allows for the detection of novel threats that may not be caught by static rules or simple statistical thresholds.",Windows Event ID 4688; Windows Event ID 5156; Engineering Workstations (EWS); Human-Machine Interfaces (HMIs); Jump Servers within the OT network,last 90 days,Pseudocode: INPUT features from Windows Event ID 4688 into trained classification model. ALERT if model_output == 'suspicious' AND confidence_score > 0.8.,playbooks/attack/ics/T0820.yml
T0820: Exploitation for Evasion,e5b8e9b0-13d8-4a46-8a71-9f79b37a54a0,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0103: Evasion,n; o; n; e,7,"Has a firmware, configuration, or project file been transferred in a manner that violates established policy (e.g., from an unauthorized source, with an unknown hash, or outside a maintenance window)?","This question is critical for protecting the integrity of ICS devices. Unauthorized changes to firmware or project files can cause catastrophic physical consequences. By strictly enforcing a policy based on known-good file hashes, authorized source systems, and pre-defined maintenance schedules, any deviation can be treated as a high-priority security incident.",Zeek files.log; Zeek conn.log; Windows Event ID 4663; Process Control Network (PCN); Engineering Workstations (EWS); Industrial Demilitarized Zone (IDMZ) for firmware update servers; OT File Servers,last 90 days,"Pseudocode: SEARCH Zeek files.log or Win Event 4663 for file types [.bin, .hex, .acd]. ALERT if (file_hash NOT IN known_good_hashes) OR (source_ip NOT IN authorized_ips) OR (timestamp NOT IN maintenance_window).",playbooks/attack/ics/T0820.yml
T0820: Exploitation for Evasion,e5b8e9b0-13d8-4a46-8a71-9f79b37a54a0,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0103: Evasion,n; o; n; e,8,"Are there file transfers exhibiting anomalous patterns, such as a single file being sent to an unusually large number of devices, or a file's size deviating significantly from the norm?","This question seeks to identify malicious deployment at scale or file manipulation. An adversary might push a malicious firmware file to many devices at once (fan-out). Alternatively, they might inject a payload into a legitimate file, causing its size to change. Monitoring for these statistical outliers can reveal malicious activity that might otherwise appear legitimate if viewed in isolation.",Zeek files.log; Zeek conn.log; Windows Event ID 4663; Process Control Network (PCN); Engineering Workstations (EWS); Industrial Demilitarized Zone (IDMZ) for firmware update servers; OT File Servers,last 90 days,Pseudocode: ANALYZE Zeek files.log. ALERT if (count of destinations for a single file_hash in 1 hour) > 99th_percentile_baseline. ALERT if file_size deviates > 3 standard deviations from baseline for that file type.,playbooks/attack/ics/T0820.yml
T0820: Exploitation for Evasion,e5b8e9b0-13d8-4a46-8a71-9f79b37a54a0,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0103: Evasion,n; o; n; e,9,Has a machine learning model assessed any file transfer event as high-risk or malicious based on a combination of its attributes?,"This question employs a machine learning model to provide a comprehensive risk score for each file transfer. The model can consider a wide range of features simultaneously (source, protocol, file name entropy, time of day) to make a more nuanced decision than simple rules. This is useful for detecting sophisticated attacks that try to blend in with normal activity.",Zeek files.log; Zeek conn.log; Windows Event ID 4663; Process Control Network (PCN); Engineering Workstations (EWS); Industrial Demilitarized Zone (IDMZ) for firmware update servers; OT File Servers,last 90 days,Pseudocode: INPUT features from Zeek files.log and conn.log into trained classification model. ALERT if model_output == 'malicious' AND probability_score > 0.85.,playbooks/attack/ics/T0820.yml
T0820: Exploitation for Evasion,e5b8e9b0-13d8-4a46-8a71-9f79b37a54a0,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0103: Evasion,n; o; n; e,10,"Is there direct evidence of security control tampering on a critical ICS host, such as audit logs being cleared, security services being stopped, or audit policies being modified?","This question looks for unambiguous signs of an adversary trying to cover their tracks or disable defenses. Events like the audit log being cleared (Event ID 1102) or an EDR service being stopped are high-confidence indicators of malicious intent. These should be treated as immediate, critical alerts as they often precede or accompany further malicious actions.",Windows Event ID 1102; Windows Event ID 7040; Windows Event ID 4719; Windows Event ID 4657; Engineering Workstations (EWS); Human-Machine Interfaces (HMIs); Windows Servers within the ICS network; OT Domain Controllers,last 90 days,"Pseudocode: CREATE non-suppressible ALERT for Windows Event IDs 1102, 4719, 4657. CREATE ALERT for Event ID 7040 where service_name is a critical security service.",playbooks/attack/ics/T0820.yml
T0820: Exploitation for Evasion,e5b8e9b0-13d8-4a46-8a71-9f79b37a54a0,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0103: Evasion,n; o; n; e,11,"Has there been an anomalous drop in log volume from a host, or have security services been modified in a statistically rare manner?","This question provides an indirect way to detect tampering. An adversary might stop a logging service without generating a specific 'log cleared' event, resulting in a sudden drop in log volume. Similarly, while services can stop and start for legitimate reasons, a security service changing state is often a rare event. Flagging these statistical rarities can provide an early warning of tampering.",Windows Event ID 1102; Windows Event ID 7040; Windows Event ID 4719; Windows Event ID 4657; Engineering Workstations (EWS); Human-Machine Interfaces (HMIs); Windows Servers within the ICS network; OT Domain Controllers,last 90 days,Pseudocode: BASELINE hourly log volume per host. ALERT if current_volume < 90% of baseline. TRACK frequency of service state changes (Event ID 7040) for security services. ALERT if change frequency is < 1st percentile.,playbooks/attack/ics/T0820.yml
T0820: Exploitation for Evasion,e5b8e9b0-13d8-4a46-8a71-9f79b37a54a0,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0103: Evasion,n; o; n; e,12,"Has a sequence analysis model detected an anomalous series of events on a host, such as a suspicious login followed by process creation and then a security service being disabled?","This question moves beyond individual events to analyze the 'story' they tell together. A single event might not be suspicious, but a specific sequence of events in a short time window can be a strong indicator of an attack. A sequence model learns normal workflows and can flag these malicious chains of activity, providing context-rich alerts for analysts.",Windows Event ID 1102; Windows Event ID 7040; Windows Event ID 4719; Windows Event ID 4657; Engineering Workstations (EWS); Human-Machine Interfaces (HMIs); Windows Servers within the ICS network; OT Domain Controllers,last 90 days,"Pseudocode: INPUT stream of Windows Event IDs into trained sequence analysis model (e.g., HMM, LSTM). ALERT when the model detects a low-probability (anomalous) sequence of events.",playbooks/attack/ics/T0820.yml
T0821: Modify Controller Tasking,1a2b3c4d-5e6f-4a7b-8c9d-9e8f7a6b5c4d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0104: Execution,n; o; n; e,1,Have any ICS modification commands been observed from an unapproved source or outside a scheduled maintenance window?,"This question aims to detect blatant policy violations. Authorized changes to controller logic should only come from designated Engineering Workstations (EWS) and during planned maintenance periods. An alert on this rule is a high-fidelity indicator of potentially unauthorized or malicious activity, as it bypasses established change control procedures.",Zeek conn.log; Zeek s7comm.log; Zeek modbus.log; Zeek enip.log; Zeek dnp3.log; Network segments within the Process Control Network (PCN) where Engineering Workstations (EWS) communicate with controllers; Network taps at the PCN/DMZ boundary; SPAN ports on core switches; Virtual LANs (VLANs) dedicated to Safety Instrumented Systems (SIS) and Basic Process Control Systems (BPCS),last 90 days,"SIEM: SEARCH Zeek logs (s7comm, modbus, etc.) FOR modification_function_codes WHERE (source_ip NOT IN EWS_Allowlist OR event_time NOT IN Maintenance_Windows) | ENRICH with conn.log details",playbooks/attack/ics/T0821.yml
T0821: Modify Controller Tasking,1a2b3c4d-5e6f-4a7b-8c9d-9e8f7a6b5c4d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0104: Execution,n; o; n; e,2,Has there been a statistically significant increase in modification commands between any specific source and controller?,"This question focuses on detecting anomalous volumes of activity that might otherwise be missed by simple rule-based logic. Even if commands originate from an approved EWS, a sudden, high-volume burst of modifications can indicate a compromised workstation or a malicious script. Using a 3-sigma threshold helps identify activity that is statistically rare and warrants investigation.",Zeek conn.log; Zeek s7comm.log; Zeek modbus.log; Zeek enip.log; Zeek dnp3.log; Network segments within the Process Control Network (PCN) where Engineering Workstations (EWS) communicate with controllers; Network taps at the PCN/DMZ boundary; SPAN ports on core switches; Virtual LANs (VLANs) dedicated to Safety Instrumented Systems (SIS) and Basic Process Control Systems (BPCS),last 90 days,"SIEM: FOR each (source_ip, dest_ip) pair | CALCULATE 90-day hourly baseline (mean, std_dev) for modification_commands | ALERT IF current_hour_count > (mean + 3 * std_dev) AND current_hour_count > 5",playbooks/attack/ics/T0821.yml
T0821: Modify Controller Tasking,1a2b3c4d-5e6f-4a7b-8c9d-9e8f7a6b5c4d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0104: Execution,n; o; n; e,3,Does the overall pattern of controller modification activity across the network deviate from the established operational rhythm?,"This question takes a holistic, network-wide view. It seeks to identify subtle deviations from normal operational patterns that might not be captured by per-host or per-pair analysis. A sophisticated time-series model can learn the complex rhythms of a plant (e.g., day vs. night, weekday vs. weekend, maintenance cycles) and flag activity that, while not violating a simple threshold, is inconsistent with these learned patterns.",Zeek conn.log; Zeek s7comm.log; Zeek modbus.log; Zeek enip.log; Zeek dnp3.log; Network segments within the Process Control Network (PCN) where Engineering Workstations (EWS) communicate with controllers; Network taps at the PCN/DMZ boundary; SPAN ports on core switches; Virtual LANs (VLANs) dedicated to Safety Instrumented Systems (SIS) and Basic Process Control Systems (BPCS),last 90 days,"ML Model: AGGREGATE modification_command_counts in 15-min intervals | INPUT to time-series model with features (count, day_of_week, hour, is_maintenance) | ALERT IF anomaly_score > 0.99",playbooks/attack/ics/T0821.yml
T0821: Modify Controller Tasking,1a2b3c4d-5e6f-4a7b-8c9d-9e8f7a6b5c4d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0104: Execution,n; o; n; e,4,Has ICS engineering software been executed by an unauthorized user or spawned from a suspicious parent process on an Engineering Workstation?,"This question investigates the origin of the modification activity on the host itself. Legitimate use of engineering software should be by authorized personnel and initiated directly by the user, not by scripts or other non-interactive processes. Detecting execution by an unauthorized account or from a parent like powershell.exe is a strong indicator of a compromised host being used to pivot to the control system.",Windows Event ID 4688; Windows Event ID 4624; Windows Event ID 4672; Windows Event ID 5156; Zeek conn.log; Dedicated Engineering Workstations (EWS); Active Directory Domain Controllers authenticating PCN users; Endpoint Detection and Response (EDR) platforms deployed on EWS hosts,last 90 days,SIEM: SEARCH EID 4688 on EWS hosts WHERE (process_name IN ICS_Software_List AND (user NOT IN Authorized_Group OR parent_process IN Suspicious_List)) | CORRELATE with EID 5156 to controller_IP within 60s,playbooks/attack/ics/T0821.yml
T0821: Modify Controller Tasking,1a2b3c4d-5e6f-4a7b-8c9d-9e8f7a6b5c4d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0104: Execution,n; o; n; e,5,Is an authorized user running ICS software from a workstation or at a time that is unusual for them?,"This question seeks to identify behavioral anomalies even for authorized users. An attacker who has stolen credentials may not know the typical routines of the compromised user. For example, an engineer who always works 9-5 from a specific EWS suddenly running software at 3 AM from a different machine is a significant anomaly that this question is designed to detect.",Windows Event ID 4688; Windows Event ID 4624; Windows Event ID 4672; Windows Event ID 5156; Zeek conn.log; Dedicated Engineering Workstations (EWS); Active Directory Domain Controllers authenticating PCN users; Endpoint Detection and Response (EDR) platforms deployed on EWS hosts,last 90 days,"SIEM/UBA: CALCULATE 90-day probability for each (user, hostname, hour) tuple for ICS software execution | ALERT IF new event tuple probability < 5th percentile",playbooks/attack/ics/T0821.yml
T0821: Modify Controller Tasking,1a2b3c4d-5e6f-4a7b-8c9d-9e8f7a6b5c4d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0104: Execution,n; o; n; e,6,Does a user's overall session activity on an Engineering Workstation appear anomalous when compared to their historical behavior?,"This question uses advanced User Behavior Analytics (UBA) to create a comprehensive profile of user sessions on critical assets like EWS. Instead of looking at a single event, it considers a collection of activities (logins, process execution, network connections, etc.) as a single entity. This allows it to detect sophisticated attackers who might try to blend in by keeping individual actions low-key, but whose overall session behavior deviates from the norm.",Windows Event ID 4688; Windows Event ID 4624; Windows Event ID 4672; Windows Event ID 5156; Zeek conn.log; Dedicated Engineering Workstations (EWS); Active Directory Domain Controllers authenticating PCN users; Endpoint Detection and Response (EDR) platforms deployed on EWS hosts,last 90 days,"UBA Model: FOR each user session on EWS | CREATE feature vector (login_type, cmd_entropy, parent-child_rels, network_conns) | INPUT to UBA model (e.g., Isolation Forest) | ALERT IF session anomaly_score > 99.5th percentile",playbooks/attack/ics/T0821.yml
T0821: Modify Controller Tasking,1a2b3c4d-5e6f-4a7b-8c9d-9e8f7a6b5c4d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0104: Execution,n; o; n; e,7,Does the running configuration on a critical controller match its last known-good baseline hash?,"This is a question of integrity verification. It provides a definitive ground truth by directly checking the controller's configuration against an authoritative 'golden image'. A hash mismatch is a very high-fidelity indicator that an unauthorized or undocumented change has occurred, regardless of how the change was made. This acts as a safety net to catch modifications that might evade network or host-based detection.",Zeek s7comm.log; Zeek modbus.log; Zeek enip.log; Controller configuration backups / 'golden image' repository; Controller internal logs; Directly on Programmable Logic Controllers (PLCs) and Distributed Control Systems (DCS); Secure baseline repository or Configuration Management Database (CMDB) storing controller golden images; Network segments carrying configuration traffic between EWS and controllers,last 90 days,Script: SCHEDULE script to run every 4 hours: POLL controller for config | COMPUTE SHA-256 hash of config | RETRIEVE golden_image_hash from repository | ALERT IF current_hash != golden_image_hash,playbooks/attack/ics/T0821.yml
T0821: Modify Controller Tasking,1a2b3c4d-5e6f-4a7b-8c9d-9e8f7a6b5c4d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0104: Execution,n; o; n; e,8,Is a controller experiencing an unusually high volume or variety of configuration write commands?,"This question focuses on the characteristics of the modification traffic itself. An attacker attempting to brute-force a configuration or trying multiple different payloads might generate a higher volume (count) or a greater variety (entropy) of write commands than a typical, targeted engineering change. This method can detect suspicious modification patterns even if the source is authorized.",Zeek s7comm.log; Zeek modbus.log; Zeek enip.log; Controller configuration backups / 'golden image' repository; Controller internal logs; Directly on Programmable Logic Controllers (PLCs) and Distributed Control Systems (DCS); Secure baseline repository or Configuration Management Database (CMDB) storing controller golden images; Network segments carrying configuration traffic between EWS and controllers,last 90 days,SIEM: FOR each controller | CALCULATE 90-day baseline (98th percentile) for hourly command_count and command_entropy | ALERT IF current_hour_count > 98th_percentile_count OR current_hour_entropy > 98th_percentile_entropy,playbooks/attack/ics/T0821.yml
T0821: Modify Controller Tasking,1a2b3c4d-5e6f-4a7b-8c9d-9e8f7a6b5c4d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0104: Execution,n; o; n; e,9,"Can a machine learning model, trained on historical data, classify a new configuration change as potentially malicious?","This question represents a proactive, predictive approach. By training a supervised model on labeled examples of both benign (e.g., routine maintenance) and malicious (e.g., from past incidents) activity, the system can learn the subtle, multi-faceted indicators of a malicious change. This allows it to make a real-time judgment on new, unseen events and flag them for immediate review.",Zeek s7comm.log; Zeek modbus.log; Zeek enip.log; Controller configuration backups / 'golden image' repository; Controller internal logs; Directly on Programmable Logic Controllers (PLCs) and Distributed Control Systems (DCS); Secure baseline repository or Configuration Management Database (CMDB) storing controller golden images; Network segments carrying configuration traffic between EWS and controllers,last 90 days,"ML Model: ON new configuration change event | CREATE feature vector (source_ip, user, command_type, data_size, time_of_day, has_change_ticket) | INPUT to Random Forest classifier | ALERT IF classification == 'Malicious'",playbooks/attack/ics/T0821.yml
T0827: Loss of Control,3a1b9d4e-7f6c-4e8a-9a1b-2c3d4e5f6a7b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0105: Impact,n; o; n; e,1,Are HMI communication failure events correlated with a lack of successful 'Write' commands to the PLC?,"This question is crucial for identifying a potential denial of control attack. If an HMI reports it cannot communicate with a PLC, but network logs show a simultaneous absence of legitimate control commands ('Write' operations), it could indicate that an adversary is blocking or manipulating control traffic, preventing operators from controlling the process. This is a direct indicator of a loss of control.
","Windows Event ID 1000; Zeek modbus.log; HMI hosts in the control room, PCN network taps monitoring traffic to critical PLCs (e.g., Boiler Control PLC, Turbine Governor PLC), Engineering Workstation subnets.",last 90 days,": // 1. TRIGGER on Windows Event ID 1000 from HMI with 'communication error' message.
// 2. EXTRACT HMI IP address.
// 3. SEARCH Zeek modbus.log for HMI IP in the last 1 minute.
// 4. COUNT successful Modbus 'Write' commands (func_codes: 05, 06, 0F, 10).
// 5. ALERT if count is 0.
",playbooks/attack/ics/T0827.yml
T0827: Loss of Control,3a1b9d4e-7f6c-4e8a-9a1b-2c3d4e5f6a7b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0105: Impact,n; o; n; e,2,Has there been a statistically significant increase in Modbus exception responses from a PLC to an HMI?,"A sudden spike in exception responses (like 'Illegal Function' or 'Illegal Data Address') from a PLC suggests that it is receiving invalid or malformed commands. This could be an adversary attempting to probe the PLC's memory, find vulnerabilities, or disrupt its operation by sending commands it cannot process. Baselining normal error rates and alerting on deviations helps detect this anomalous and potentially malicious activity.
","Windows Event ID 1000; Zeek modbus.log; HMI hosts in the control room, PCN network taps monitoring traffic to critical PLCs (e.g., Boiler Control PLC, Turbine Governor PLC), Engineering Workstation subnets.",last 90 days,": // 1. For each HMI-PLC pair, CALCULATE 30-day baseline of Modbus exception counts per 5-min interval.
// 2. DETERMINE 99th percentile threshold from baseline.
// 3. MONITOR real-time exception counts in a 5-min sliding window.
// 4. ALERT if current count > threshold.
",playbooks/attack/ics/T0827.yml
T0827: Loss of Control,3a1b9d4e-7f6c-4e8a-9a1b-2c3d4e5f6a7b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0105: Impact,n; o; n; e,3,"Is an HMI exhibiting a combination of anomalous behaviors, such as communication errors, exception responses, and a lack of 'Write' commands, that deviates from its normal operational profile?","This question uses machine learning to move beyond simple thresholding. By combining multiple indicators (communication errors, exception responses, lack of writes) into a single model, it can detect subtle, coordinated attacks that might not trigger individual rules. An anomaly score exceeding the threshold indicates that the HMI's overall communication pattern is highly unusual and warrants investigation for a potential loss-of-control scenario.
","Windows Event ID 1000; Zeek modbus.log; HMI hosts in the control room, PCN network taps monitoring traffic to critical PLCs (e.g., Boiler Control PLC, Turbine Governor PLC), Engineering Workstation subnets.",last 90 days,": // 1. TRAIN unsupervised anomaly detection model on historical data (30+ days) with features: comm errors, exception counts, absence of 'Write' commands.
// 2. APPLY trained model to real-time data streams.
// 3. ALERT when anomaly score exceeds a pre-tuned threshold.
",playbooks/attack/ics/T0827.yml
T0827: Loss of Control,3a1b9d4e-7f6c-4e8a-9a1b-2c3d4e5f6a7b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0105: Impact,n; o; n; e,4,Is an unauthorized device attempting to issue 'Write' commands to a critical PLC?,"This question addresses the fundamental security principle of least privilege. In a properly configured control system, only specific, authorized workstations should be able to modify PLC logic or setpoints. Detecting a 'Write' command from an unknown IP address or an attempt by an authorized IP to write to a forbidden register is a strong indicator of a compromised device or an insider threat attempting to manipulate the process.
","Zeek modbus.log; Zeek dnp3.log; Zeek conn.log; Process Historian Data; Windows Event ID 4624; Process Historian database servers, Network taps capturing traffic between Level 1 (PLCs/RTUs) and Level 2 (Supervisory Control), specific PLCs controlling critical physical processes.",last 90 days,": // 1. DEFINE a whitelist of {Source IP: [Allowed_Register/Object]}.
// 2. MONITOR network logs (modbus, dnp3) for all 'Write' commands.
// 3. For each 'Write', CHECK if Source IP and Target Register/Object are in the whitelist.
// 4. ALERT if not in whitelist.
",playbooks/attack/ics/T0827.yml
T0827: Loss of Control,3a1b9d4e-7f6c-4e8a-9a1b-2c3d4e5f6a7b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0105: Impact,n; o; n; e,5,"Has a critical process variable moved outside its normal operating range without a legitimate, corresponding control command?","This question aims to differentiate between normal process fluctuations and adversary-induced changes. A process variable exceeding its historical boundaries is anomalous, but it could be due to a legitimate operator action. By correlating the deviation with the absence of an authorized 'Write' command, we can infer that the change is unauthorized and potentially malicious. The secondary check on command entropy helps detect repetitive, targeted commands designed to force a variable to a specific state.
","Zeek modbus.log; Zeek dnp3.log; Zeek conn.log; Process Historian Data; Windows Event ID 4624; Process Historian database servers, Network taps capturing traffic between Level 1 (PLCs/RTUs) and Level 2 (Supervisory Control), specific PLCs controlling critical physical processes.",last 90 days,": // 1. For a critical Process Variable, MONITOR if its value is outside the 1st-99th percentile for 5 mins.
// 2. If true, CHECK for a corresponding authorized 'Write' command in network logs within the same window.
// 3. ALERT if no authorized 'Write' command is found.
",playbooks/attack/ics/T0827.yml
T0827: Loss of Control,3a1b9d4e-7f6c-4e8a-9a1b-2c3d4e5f6a7b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0105: Impact,n; o; n; e,6,Is the physical process behaving in a way that cannot be explained by the legitimate control inputs it is receiving?,"This advanced question seeks to detect manipulation by modeling the expected physical behavior of the system. Industrial processes have inherent physical relationships (e.g., increasing fuel flow should increase temperature). A multi-variate model learns these relationships. If a process variable deviates from what the model predicts based on legitimate control inputs, it strongly suggests an external, unlogged, and malicious influence is acting on the system.
","Zeek modbus.log; Zeek dnp3.log; Zeek conn.log; Process Historian Data; Windows Event ID 4624; Process Historian database servers, Network taps capturing traffic between Level 1 (PLCs/RTUs) and Level 2 (Supervisory Control), specific PLCs controlling critical physical processes.",last 90 days,": // 1. TRAIN a multi-variate model (e.g., VAR) on historical process variables and control commands.
// 2. USE the model to forecast future process variable values with a prediction interval.
// 3. MONITOR if the actual process variable value falls outside its predicted interval for > 3 minutes.
// 4. ALERT if a sustained deviation occurs.
",playbooks/attack/ics/T0827.yml
T0827: Loss of Control,3a1b9d4e-7f6c-4e8a-9a1b-2c3d4e5f6a7b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0105: Impact,n; o; n; e,7,Did a Safety Instrumented System (SIS) trip occur without a valid physical cause or an authorized manual command?,"This question is of the highest criticality. The SIS is the last line of defense against a catastrophic failure. An 'uncommanded' or 'spurious' trip is a major red flag. By automatically verifying that a trip was not caused by a real process upset (PV exceeding a safety limit) or a deliberate operator action, we can quickly identify a potential direct attack on the safety system itself, which could be a precursor to causing physical damage.
","Windows Event ID 4624; Zeek conn.log; Zeek s7comm.log; Zeek enip.log; SIS System Logs; Process Historian Data; SIS Logic Solver hardware, SIS Engineering Workstations, Network segments dedicated to the Safety Instrumented Network (SIN), Firewalls or Data Diodes separating the SIN from the PCN.",last 90 days,": // 1. TRIGGER on an SIS trip alarm from SIS logs.
// 2. LOOKBACK 5 minutes in Process Historian data for any PV exceeding its safety limit.
// 3. LOOKBACK 5 minutes in SIS command logs / Win Event 4624 for an authorized manual trip command.
// 4. ALERT if neither condition is met.
",playbooks/attack/ics/T0827.yml
T0827: Loss of Control,3a1b9d4e-7f6c-4e8a-9a1b-2c3d4e5f6a7b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0105: Impact,n; o; n; e,8,Was an SIS trip correlated with statistically rare or anomalous network activity on the SIS network?,"SIS networks are typically static and highly predictable. Any deviation from the established communication baseline is suspicious. This question attempts to link a safety system trip to unusual network behavior. The presence of a new device, a non-standard protocol, or unusual data flows communicating with the SIS controller right before a trip provides strong circumstantial evidence that the trip was induced by malicious network activity.
","Windows Event ID 4624; Zeek conn.log; Zeek s7comm.log; Zeek enip.log; SIS System Logs; Process Historian Data; SIS Logic Solver hardware, SIS Engineering Workstations, Network segments dedicated to the Safety Instrumented Network (SIN), Firewalls or Data Diodes separating the SIN from the PCN.",last 90 days,": // 1. ESTABLISH a baseline of normal network traffic on the SIS network (IPs, ports, protocols).
// 2. On an SIS trip, ANALYZE network traffic from the preceding 30 minutes.
// 3. CALCULATE statistical rarity (e.g., z-score) of observed connections against the baseline.
// 4. ALERT if trip correlates with statistically rare network activity.
",playbooks/attack/ics/T0827.yml
T0827: Loss of Control,3a1b9d4e-7f6c-4e8a-9a1b-2c3d4e5f6a7b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0105: Impact,n; o; n; e,9,Can a machine learning model classify a recent SIS trip as anomalous based on historical data and associated features?,"This question operationalizes the investigation of SIS trips using machine learning. By training a model on labeled historical data, we can automate the classification of new trips. The model considers multiple factors simultaneously (process state, manual commands, network activity, user logins) to make a holistic judgment. An 'Anomalous' classification with high confidence provides a rapid, data-driven assessment that the trip was likely malicious in nature.
","Windows Event ID 4624; Zeek conn.log; Zeek s7comm.log; Zeek enip.log; SIS System Logs; Process Historian Data; SIS Logic Solver hardware, SIS Engineering Workstations, Network segments dedicated to the Safety Instrumented Network (SIN), Firewalls or Data Diodes separating the SIN from the PCN.",last 90 days,": // 1. TRAIN a supervised classification model on labeled historical SIS trips ('Legitimate' vs 'Anomalous').
// 2. ENGINEER features: PV excursion flag, manual command flag, network rarity score, etc.
// 3. DEPLOY model to classify new SIS trips in real-time.
// 4. ALERT if a trip is classified as 'Anomalous' with high confidence (>0.90).",playbooks/attack/ics/T0827.yml
T0829: Loss of View,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0105: Impact,n; o; n; e,1,Are critical HMI processes crashing or terminating unexpectedly based on predefined rules?,"This question looks for explicit signs of HMI application failure. By monitoring for specific error events (crashes, hangs) or process terminations without a corresponding restart, analysts can quickly identify targeted attacks against operator visibility tools. A high frequency of these events in a short window is a strong indicator of malicious interference.","Windows Event ID 1000; Windows Event ID 1002; Windows Event ID 4688; Windows Event ID 4689; NAI: Critical Operator Workstations and HMI Servers within the Level 2 (Supervisory) and Level 3 (Site Control) zones of the Process Control Network (PCN), including any associated DMZ for remote HMI access.",last 90 days,"Symbolic Logic: SEARCH EventLogs WHERE (EventID=1000 OR EventID=1002) AND ProcessName IN (critical_hmi_list) | COUNT by host, time_window=60s | ALERT if count > 2; Symbolic Logic: SEARCH EventLogs WHERE EventID=4689 AND ProcessName IN (critical_hmi_list) | CHECK if EventID=4688 for same process/host follows within 30s | ALERT if not",playbooks/attack/ics/T0829.yml
T0829: Loss of View,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0105: Impact,n; o; n; e,2,Is there a statistically significant increase in HMI application errors or an abnormal delay in process restarts compared to historical baselines?,"This question uses statistical baselining to detect more subtle forms of HMI instability. Instead of fixed thresholds, it compares current error rates and restart times against learned norms (e.g., 99th percentile). This approach helps identify 'low and slow' attacks or instability issues that might not trigger simple rule-based alerts but still represent a deviation from normal operation.","Windows Event ID 1000; Windows Event ID 1002; Windows Event ID 4688; Windows Event ID 4689; NAI: Critical Operator Workstations and HMI Servers within the Level 2 (Supervisory) and Level 3 (Site Control) zones of the Process Control Network (PCN), including any associated DMZ for remote HMI access.",last 90 days,"Statistical Method: SEARCH EventLogs WHERE EventID IN (1000, 1002) for critical HMI processes | BASELINE count per 10min over 14 days to find 99th_percentile_threshold | ALERT if current_10min_count > 99th_percentile_threshold; Statistical Method: SEARCH EventLogs for critical HMI processes | BASELINE time_delta between EventID=4689 and EventID=4688 | ALERT if current_delta > (mean + 3 * stdev)",playbooks/attack/ics/T0829.yml
T0829: Loss of View,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0105: Impact,n; o; n; e,3,Is the current stability pattern of HMI applications anomalous when compared to a machine learning model trained on historical data?,"This question employs an unsupervised machine learning model to detect complex anomalies in HMI stability. The model learns the normal, multi-dimensional relationships between different event types (errors, terminations) over time. It can identify novel or sophisticated attack patterns that may not be captured by simpler rule-based or statistical methods, providing a more robust defense against unseen threats.","Windows Event ID 1000; Windows Event ID 1002; Windows Event ID 4689; NAI: Critical Operator Workstations and HMI Servers within the Level 2 (Supervisory) and Level 3 (Site Control) zones of the Process Control Network (PCN), including any associated DMZ for remote HMI access.",last 90 days,"Machine Learning: FEATURE_ENGINEERING from EventLogs (EventID 1000, 1002, 4689 counts per 1min) | TRAIN IsolationForest model on 30+ days of data | APPLY model to live data stream | ALERT if anomaly_score > threshold",playbooks/attack/ics/T0829.yml
T0829: Loss of View,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0105: Impact,n; o; n; e,4,Has communication between a critical PLC/RTU and a Historian/HMI stopped for a period longer than the expected maximum polling interval?,"This question provides a direct, rule-based check for a complete communication loss. By defining critical device pairs and their expected communication frequency, analysts can immediately detect if a data link goes silent. This is a high-fidelity indicator of a potential network disruption, device failure, or deliberate blocking of process data.",Zeek conn.log; Zeek modbus.log; Zeek dnp3.log; Zeek enip.log; Zeek opcua.log; NAI: Network sensors monitoring critical network segments at the Level 1.5 (Industrial Demilitarized Zone/IDMZ) and Level 2 (Supervisory) boundaries within the Process Control Network (PCN).,last 90 days,"Symbolic Logic: DEFINE critical_pairs (e.g., PLC_IP:Historian_IP, port, max_interval) | SEARCH Zeek logs for traffic from critical_pairs | ALERT if no traffic seen for a duration > (3 * max_interval)",playbooks/attack/ics/T0829.yml
T0829: Loss of View,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0105: Impact,n; o; n; e,5,Has the volume or diversity of network traffic from control devices dropped below a statistically established baseline?,"This question aims to detect a degradation, rather than a complete loss, of communication. By baselining normal traffic volume (bytes) and message diversity (Shannon entropy of function codes), it can identify situations where data is still flowing but is significantly reduced or less varied. This could indicate a partial DoS, a compromised device sending minimal keep-alives, or a filtering rule being applied.",Zeek conn.log; Zeek modbus.log; Zeek dnp3.log; Zeek enip.log; Zeek opcua.log; NAI: Network sensors monitoring critical network segments at the Level 1.5 (Industrial Demilitarized Zone/IDMZ) and Level 2 (Supervisory) boundaries within the Process Control Network (PCN).,last 90 days,Statistical Method: BASELINE byte/message counts per 1min for critical flows over 7 days to find 5th_percentile | ALERT if current_1min_value < 5th_percentile for 3 consecutive minutes; Statistical Method: BASELINE Shannon entropy of modbus.function_code over 5min | ALERT if current_entropy < 10th_percentile_of_baseline,playbooks/attack/ics/T0829.yml
T0829: Loss of View,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0105: Impact,n; o; n; e,6,Does the current network traffic volume from control devices deviate significantly from a machine learning forecast of expected behavior?,"This question uses a time-series forecasting model to predict what the network traffic should look like at any given moment. By comparing the actual observed traffic against the model's prediction and its confidence interval, it can detect subtle, anomalous drops in volume that might be missed by simple statistical thresholds. This method is particularly effective at accounting for normal cyclical variations in traffic.",Zeek conn.log; Zeek modbus.log; Zeek dnp3.log; Zeek enip.log; Zeek opcua.log; NAI: Network sensors monitoring critical network segments at the Level 1.5 (Industrial Demilitarized Zone/IDMZ) and Level 2 (Supervisory) boundaries within the Process Control Network (PCN).,last 90 days,"Machine Learning: FEATURE_ENGINEERING from Zeek logs (bytes, packets, etc. per 5min) | TRAIN SARIMA model on 30+ days of data | FORECAST expected traffic and 99% prediction interval | ALERT if observed_volume < lower_bound_of_interval for > 10 minutes",playbooks/attack/ics/T0829.yml
T0829: Loss of View,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0105: Impact,n; o; n; e,7,Is an HMI server receiving an abnormally high number of failed connection attempts or blocked packets from a single source or in aggregate?,"This question uses hard-coded thresholds to detect a flood of failed connections, a classic sign of a Denial-of-Service (DoS) attack. By counting specific failure states ('S0', 'REJ') in network logs or blocked packets in firewall logs, analysts can quickly identify an attempt to overwhelm an HMI server and make it unavailable to legitimate operators.",Zeek conn.log; Windows Event ID 5156; NAI: Network sensors and host logs on critical HMI Servers within the Level 2 (Supervisory) zone of the Process Control Network (PCN) and any associated IDMZ or enterprise DMZ enabling remote access to HMI systems.,last 90 days,"Symbolic Logic: SEARCH Zeek conn.log for connections to HMI_IPs with state IN ('S0', 'REJ', 'RSTO') | ALERT if count_from_single_source > 30 in 30s OR total_count > 100 in 60s; Symbolic Logic: SEARCH Windows EventID 5156 on HMI servers | ALERT if inbound_blocked_count_from_single_source > 50 in 60s",playbooks/attack/ics/T0829.yml
T0829: Loss of View,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0105: Impact,n; o; n; e,8,Is an HMI server experiencing both a statistically unusual increase in total connections and a simultaneous spike in the ratio of failed-to-successful connections?,"This question refines the DoS detection by combining two statistical metrics. It looks for a condition where not only is the overall connection volume abnormally high (exceeding the 99th percentile), but the proportion of those connections that are failing is also unusually high (exceeding the 95th percentile). This combination is a stronger indicator of a malicious DoS attack versus a benign high-traffic event.",Zeek conn.log; Windows Event ID 5156; NAI: Network sensors and host logs on critical HMI Servers within the Level 2 (Supervisory) zone of the Process Control Network (PCN) and any associated IDMZ or enterprise DMZ enabling remote access to HMI systems.,last 90 days,Statistical Method: BASELINE total_connections_per_5min and failed_connection_ratio_per_5min for HMI servers | CALCULATE 99th_percentile_total and 95th_percentile_ratio | ALERT if current_total > 99th_percentile_total AND current_ratio > 95th_percentile_ratio,playbooks/attack/ics/T0829.yml
T0829: Loss of View,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0105: Impact,n; o; n; e,9,Does the network traffic pattern targeting an HMI server exhibit characteristics of a DoS attack as identified by an unsupervised machine learning model?,"This question uses a machine learning model to identify complex patterns indicative of a DoS attack that go beyond simple volume metrics. By analyzing features like connection rate, source IP/port entropy, and connection state ratios, the model can learn the signature of normal traffic and flag deviations that match known DoS or network scanning profiles, even if the attacker attempts to be stealthy.",Zeek conn.log; Windows Event ID 5156; NAI: Network sensors and host logs on critical HMI Servers within the Level 2 (Supervisory) zone of the Process Control Network (PCN) and any associated IDMZ or enterprise DMZ enabling remote access to HMI systems.,last 90 days,"Machine Learning: FEATURE_ENGINEERING from Zeek logs (conn_rate, src_ip_entropy, state_ratios, etc.) | TRAIN One-Class SVM model on 30+ days of normal traffic | APPLY model to live traffic | ALERT if data_point is classified as outlier",playbooks/attack/ics/T0829.yml
T0830: Adversary-in-the-Middle,8c3d7b2a-9f1e-4a6c-8e4d-5b1a9c8d7e6f,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0100: Collection,n; o; n; e,1,Is an adversary attempting to poison the ARP cache by associating a critical ICS asset's IP with an unauthorized MAC address or by manually modifying the ARP cache on a workstation?,"This question aims to detect classic ARP poisoning. Attackers can send spoofed ARP messages to link their MAC address with the IP address of a legitimate device, redirecting traffic to the attacker. This analytic checks for two methods: 1) Network-level detection of ARP replies that violate a known IP-to-MAC allowlist, and 2) Host-level detection of commands (e.g., `arp.exe -s`) used to statically manipulate the ARP table on an engineering workstation.
","Zeek arp.log; Windows Event ID 4688; Windows Security Event ID 4703; Process Control Network (PCN) switches, managed industrial switches, network taps/sensors within the PCN, Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), SCADA servers, Domain Controllers.",last 90 days,": SEARCH Zeek arp.log WHERE op == 'reply' AND sender_ip IN critical_ips AND sender_mac NOT IN allowlist
; : SEARCH EventID 4688 WHERE process_name == 'arp.exe' AND command_line CONTAINS '-s' OR process_name == 'netsh.exe' AND command_line CONTAINS 'add neighbors'
",playbooks/attack/ics/T0830.yml
T0830: Adversary-in-the-Middle,8c3d7b2a-9f1e-4a6c-8e4d-5b1a9c8d7e6f,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0100: Collection,n; o; n; e,2,"Is there evidence of MAC address flapping, where a critical ICS asset's IP address is rapidly being claimed by multiple different MAC addresses?","This question looks for MAC flapping, a strong indicator of an ARP storm or a conflict caused by an attacker trying to claim an IP address. By monitoring the number of unique MAC addresses associated with a single critical IP over a short time (e.g., 5 minutes), we can detect this instability, which is highly abnormal in a stable ICS environment and may point to an active ARP poisoning campaign.
","Zeek arp.log; Process Control Network (PCN) switches, managed industrial switches, network taps/sensors within the PCN, Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), SCADA servers, Domain Controllers.",last 90 days,": SEARCH Zeek arp.log | TIMESERIES count(distinct sender_mac) by sender_ip over 5m | WHERE sender_ip IN critical_ips AND count > 3
",playbooks/attack/ics/T0830.yml
T0830: Adversary-in-the-Middle,8c3d7b2a-9f1e-4a6c-8e4d-5b1a9c8d7e6f,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0100: Collection,n; o; n; e,3,"Has there been an anomalous, network-wide spike in gratuitous ARP packets, suggesting a large-scale ARP poisoning attempt?","This question uses a time-series anomaly detection model to establish a baseline of normal gratuitous ARP traffic. A sudden, significant deviation from this baseline can indicate an attacker is broadcasting a large number of unsolicited ARP packets to poison the caches of many devices simultaneously, a common precursor to a widespread AiTM attack.
","Zeek arp.log; Process Control Network (PCN) switches, managed industrial switches, network taps/sensors within the PCN, Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), SCADA servers, Domain Controllers.",last 90 days,": INPUT Zeek arp.log WHERE is_gratuitous == true | AGGREGATE count by time_bucket(1m) | APPLY anomaly_detection_model | ALERT where anomaly_score > threshold
",playbooks/attack/ics/T0830.yml
T0830: Adversary-in-the-Middle,8c3d7b2a-9f1e-4a6c-8e4d-5b1a9c8d7e6f,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0100: Collection,n; o; n; e,4,Is network traffic from a critical ICS asset being rerouted through an unauthorized intermediary device instead of its legitimate destination?,"This question seeks to identify the classic AiTM pattern where an attacker's machine inserts itself into an existing communication flow. By defining legitimate communication paths and approved gateways, we can detect when a connection from a critical asset (A) is unexpectedly intercepted by an unknown device (B), which then forwards the traffic to the intended destination (C). This is a direct observation of an AiTM attack in progress.
","Zeek conn.log; Zeek http.log; Zeek ssl.log; Network backbone switches within the PCN, firewalls/routers at PCN-DMZ/Enterprise boundaries, SCADA servers, Historian servers, network taps/sensors deployed at critical communication choke points.",last 90 days,": JOIN conn.log as A_to_B with conn.log as B_to_C on A_to_B.dest_ip == B_to_C.orig_ip WHERE A_to_B.orig_ip IN critical_assets AND B_to_C.dest_ip IS_KNOWN_PARTNER_OF(A_to_B.orig_ip) AND A_to_B.dest_ip NOT IN approved_gateways AND time_diff(B_to_C.ts, A_to_B.ts) < 1s
",playbooks/attack/ics/T0830.yml
T0830: Adversary-in-the-Middle,8c3d7b2a-9f1e-4a6c-8e4d-5b1a9c8d7e6f,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0100: Collection,n; o; n; e,5,"Are there anomalous changes in network performance metrics, such as round-trip time or data volume, for critical communication paths?","An AiTM device that inspects, modifies, or even just forwards traffic will introduce latency (affecting Round-Trip Time) and may alter the size of data packets. This question aims to detect these subtle side effects. By baselining normal performance characteristics for critical connections, we can identify statistically significant deviations that could indicate the presence of an unseen intermediary.
","Zeek conn.log; Network backbone switches within the PCN, firewalls/routers at PCN-DMZ/Enterprise boundaries, SCADA servers, Historian servers, network taps/sensors deployed at critical communication choke points.",last 90 days,": INPUT Zeek conn.log | FOR_EACH critical_path | CALCULATE RTT, orig_bytes, resp_bytes | COMPARE to historical_baseline | ALERT if RTT_zscore > 3 OR byte_distribution_p_value < 0.05
",playbooks/attack/ics/T0830.yml
T0830: Adversary-in-the-Middle,8c3d7b2a-9f1e-4a6c-8e4d-5b1a9c8d7e6f,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0100: Collection,n; o; n; e,6,"Has the fundamental structure of the network graph changed in a way that suggests a new, unauthorized device has been inserted into a critical communication path?","This question applies graph theory to network security. The normal communication patterns in an ICS network form a stable graph. An AiTM attack fundamentally alters this graph by inserting a new node (the attacker) and two new edges into a previously direct path. Graph-based anomaly detection models can learn the normal topology and flag these structural changes as malicious.
","Zeek conn.log; Network backbone switches within the PCN, firewalls/routers at PCN-DMZ/Enterprise boundaries, SCADA servers, Historian servers, network taps/sensors deployed at critical communication choke points.",last 90 days,": BUILD graph from Zeek conn.log | APPLY GraphSAGE model | ALERT on new_node_insertion_anomaly between known_critical_nodes
",playbooks/attack/ics/T0830.yml
T0830: Adversary-in-the-Middle,8c3d7b2a-9f1e-4a6c-8e4d-5b1a9c8d7e6f,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0100: Collection,n; o; n; e,7,"Is a critical ICS service presenting an invalid, self-signed, or unknown TLS/SSL certificate where a known, valid certificate is expected?","In an AiTM attack on encrypted traffic, the adversary must present their own certificate to the client. This question checks for common red flags associated with malicious certificates. By maintaining a strict baseline of expected certificate fingerprints and properties for critical services, any deviation—such as a mismatched fingerprint, a validation error, or an unexpected self-signed certificate—is a strong indicator of interception.
","Zeek ssl.log; Zeek x509.log; Network taps/sensors at the perimeter of the PCN, network gateways, SCADA servers, Historian servers, remote access VPN concentrators, Engineering Workstations (EWS) that establish encrypted sessions.",last 90 days,": SEARCH Zeek ssl.log JOIN x509.log on cert_chain_fuids | WHERE server_ip IN critical_services AND (sha1 NOT IN baseline_fingerprints OR validation_status != 'ok' OR (self_signed == true AND service NOT IN self_signed_allowlist))
",playbooks/attack/ics/T0830.yml
T0830: Adversary-in-the-Middle,8c3d7b2a-9f1e-4a6c-8e4d-5b1a9c8d7e6f,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0100: Collection,n; o; n; e,8,"Are we observing newly seen certificates with suspicious characteristics, such as high-entropy subject names, or is there an unusual increase in TLS connection errors for a critical asset?","Attackers often use tools that algorithmically generate fake certificates, resulting in subject or issuer names that are random-looking strings with high entropy. This question aims to detect these algorithmically generated certificates. Additionally, a spike in TLS errors can occur if clients start rejecting an attacker's invalid certificate, providing another signal of a potential AiTM attempt.
","Zeek ssl.log; Zeek x509.log; Network taps/sensors at the perimeter of the PCN, network gateways, SCADA servers, Historian servers, remote access VPN concentrators, Engineering Workstations (EWS) that establish encrypted sessions.",last 90 days,": SEARCH Zeek x509.log WHERE is_new_cert | CALCULATE entropy(subject), entropy(issuer) | ALERT if entropy > threshold
; : SEARCH Zeek ssl.log | TIMESERIES count by server_ip where validation_status != 'ok' | ALERT if rate > 3_std_dev_from_baseline
",playbooks/attack/ics/T0830.yml
T0830: Adversary-in-the-Middle,8c3d7b2a-9f1e-4a6c-8e4d-5b1a9c8d7e6f,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0100: Collection,n; o; n; e,9,"Does a newly observed certificate for a critical service deviate significantly from the profile of known-good certificates, as determined by a machine learning model?","This question uses a machine learning approach to generalize the concept of a 'good' certificate. Instead of just checking specific fields, a model (like a One-Class SVM or an autoencoder) learns the multi-dimensional profile of normal certificates based on features like key length, validity period, and signature algorithm. Any new certificate that doesn't fit this learned profile is flagged as an outlier.
","Zeek x509.log; Network taps/sensors at the perimeter of the PCN, network gateways, SCADA servers, Historian servers, remote access VPN concentrators, Engineering Workstations (EWS) that establish encrypted sessions.",last 90 days,: EXTRACT features from new certs in x509.log | APPLY one-class_SVM_cert_model | ALERT on outlier_classification,playbooks/attack/ics/T0830.yml
T0832: Manipulation of View,17c2f0f4-508b-4b68-809c-2795958b883d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0105: Impact,n; o; n; e,1,Is there a discrepancy between the process values reported directly by PLCs and the values recorded by the historian or displayed on the HMI?,"This question aims to detect view manipulation by comparing data from different points in the control system. An attacker might intercept and alter data sent to the HMI or historian, making operators and engineers believe the process is normal while it is actually in an unsafe state. By correlating PLC network responses with data sent to visualization platforms, we can identify such discrepancies. An alert is triggered if the difference exceeds a defined engineering threshold, indicating a potential compromise of the operator's view.
","Zeek modbus.log; Zeek dnp3.log; Zeek s7comm.log; Zeek conn.log; HMI servers, Historian servers, and network segments connecting PLCs to HMIs and Historians, focusing on data gateways and visualization platforms.",last 90 days,"SEARCH PLC read responses AND HMI/gateway traffic to historian. FOR each critical process tag, JOIN PLC value and historian value by timestamp (within 5s window). WHERE (value_plc - value_historian) > threshold, ALERT.",playbooks/attack/ics/T0832.yml
T0832: Manipulation of View,17c2f0f4-508b-4b68-809c-2795958b883d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0105: Impact,n; o; n; e,2,Has the statistical correlation between PLC-reported values and historian-recorded values for critical process tags degraded over time?,"This question seeks to identify a subtle or slow divergence between the actual process state and the operator's view. A strong, consistent correlation is expected between what a PLC reports and what a historian records. A drop in this correlation suggests that the data streams are becoming decoupled, which could be a sign of a sophisticated manipulation attack. Calculating a rolling cross-correlation coefficient can detect this degradation even if the absolute values do not immediately trigger a simple threshold alert.
","Zeek modbus.log; Zeek dnp3.log; Zeek s7comm.log; Zeek conn.log; HMI servers, Historian servers, and network segments connecting PLCs to HMIs and Historians, focusing on data gateways and visualization platforms.",last 90 days,"FOR each critical tag, CREATE time_series_plc AND time_series_historian. CALCULATE rolling 10-min Pearson correlation. WHERE correlation_coefficient < 0.9 for > 5 mins, ALERT.",playbooks/attack/ics/T0832.yml
T0832: Manipulation of View,17c2f0f4-508b-4b68-809c-2795958b883d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0105: Impact,n; o; n; e,3,"Is there a statistical anomaly in the relationship between PLC-reported values, HMI-displayed values, historian-recorded values, and associated control outputs?","This question uses machine learning to detect complex forms of view manipulation. An autoencoder is trained on the normal, highly correlated state between multiple data sources related to a single process point. When an attacker manipulates one of these data streams, the relationship is broken, causing the model to produce a high reconstruction error. This approach can detect novel or complex attacks that might evade simpler correlation or threshold-based checks by learning the holistic 'normal' behavior of the system's data flow.
","Zeek modbus.log; Zeek dnp3.log; Zeek s7comm.log; Zeek conn.log; HMI servers, Historian servers, and network segments connecting PLCs to HMIs and Historians, focusing on data gateways and visualization platforms.",last 90 days,"TRAIN autoencoder on [PLC_value, HMI_value, Historian_value, Control_output]. FOR new data, CALCULATE reconstruction_error. WHERE reconstruction_error > threshold, ALERT.",playbooks/attack/ics/T0832.yml
T0832: Manipulation of View,17c2f0f4-508b-4b68-809c-2795958b883d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0105: Impact,n; o; n; e,4,Has an unauthorized process modified HMI configuration or project files?,"This question aims to detect direct tampering with HMI files, which is a common way to manipulate an operator's view. Attackers may modify graphical files to hide alarm conditions or display false data. By maintaining a whitelist of approved software (e.g., HMI editors) and monitoring for file writes to sensitive HMI project directories, we can alert on any modification made by an unapproved process, indicating a potential attack.
","Windows Event ID 4663; Windows Event ID 4688; File systems on HMI servers and engineering workstations, specifically directories containing HMI screen and logic configuration files.",last 90 days,"SEARCH for EventID 4663 (file write) on HMI files. JOIN with EventID 4688 on ProcessId. WHERE ProcessName OR ProcessHash is NOT in whitelist, ALERT.",playbooks/attack/ics/T0832.yml
T0832: Manipulation of View,17c2f0f4-508b-4b68-809c-2795958b883d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0105: Impact,n; o; n; e,5,Is there an unusually high frequency of modifications to HMI configuration files by a specific user or process?,"This question seeks to detect anomalous behavior related to HMI file editing. While legitimate changes occur, an attacker attempting to manipulate the view might make numerous, rapid changes. By baselining the normal frequency of modifications for each user and process, we can identify outliers. A sudden spike in editing activity, especially outside of planned maintenance, is a strong indicator of malicious activity.
","Windows Event ID 4663; Windows Event ID 4688; File systems on HMI servers and engineering workstations, specifically directories containing HMI screen and logic configuration files.",last 90 days,"BASELINE EventID 4663 count per user/host/process over 30 days. SEARCH for current 24-hour modification count. WHERE count > 99th percentile of baseline, ALERT.",playbooks/attack/ics/T0832.yml
T0832: Manipulation of View,17c2f0f4-508b-4b68-809c-2795958b883d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0105: Impact,n; o; n; e,6,Has a user or system process exhibited anomalous behavior while modifying HMI configuration files?,"This question leverages UEBA to detect sophisticated attacks that may use legitimate credentials. A UEBA model learns the normal context of file modifications, including the user, process, time of day, and source system. An alert would be triggered by a deviation from this learned behavior, such as an administrator account using PowerShell to edit HMI files late at night, instead of an engineer using the official HMI editor during business hours. This helps catch credential misuse and living-off-the-land techniques.
","Windows Event ID 4663; Windows Event ID 4688; File systems on HMI servers and engineering workstations, specifically directories containing HMI screen and logic configuration files.",last 90 days,"TRAIN UEBA model on user/process file modification behavior (file paths, frequency, time, process name). WHERE new activity significantly deviates from baseline, ALERT.",playbooks/attack/ics/T0832.yml
T0832: Manipulation of View,17c2f0f4-508b-4b68-809c-2795958b883d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0105: Impact,n; o; n; e,7,Has an unauthorized source sent a command to a critical PLC register with a value outside its safe operating range or to a read-only register?,"This question aims to detect overtly malicious commands sent to a PLC. Such commands could directly cause a hazardous state. By defining critical registers, their safe value ranges, and their read/write status, we can create high-fidelity alerts. Any write command from an unapproved IP that violates these pre-defined safety or configuration rules is a strong indicator of an attack attempting to cause a physical impact.
","Zeek conn.log; Zeek modbus.log; Zeek dnp3.log; Zeek enip.log; Zeek s7comm.log; Windows Event ID 4688; Windows Event ID 4624; Process Control Network (PCN) segments, Safety Instrumented System (SIS) network segments, PLC/RTU network interfaces, Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), SCADA Servers, Data Historian servers.",last 90 days,"SEARCH for ICS write commands. WHERE (source_ip NOT in allowlist AND value is outside safe range) OR (target_register is read-only), ALERT.",playbooks/attack/ics/T0832.yml
T0832: Manipulation of View,17c2f0f4-508b-4b68-809c-2795958b883d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0105: Impact,n; o; n; e,8,"Are critical process parameters deviating significantly from their normal, baselined operating ranges or interdependencies?","This question seeks to identify when the physical process itself enters an anomalous state, which could be the result of a successful manipulation. By baselining the normal statistical distribution of individual parameters and the relationships between multiple parameters (using Mahalanobis distance), we can detect when the system's state becomes abnormal. This can catch the *result* of an attack, even if the attack command itself was missed.
","Zeek conn.log; Zeek modbus.log; Zeek dnp3.log; Zeek enip.log; Zeek s7comm.log; Windows Event ID 4688; Windows Event ID 4624; Process Control Network (PCN) segments, Safety Instrumented System (SIS) network segments, PLC/RTU network interfaces, Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), SCADA Servers, Data Historian servers.",last 90 days,"BASELINE 30-day distribution for critical parameters. SEARCH live readings. WHERE reading is outside 1st-99th percentile range for 3+ cycles, ALERT. OR CALCULATE Mahalanobis distance for interdependent parameters. WHERE distance > 99.9th percentile, ALERT.",playbooks/attack/ics/T0832.yml
T0832: Manipulation of View,17c2f0f4-508b-4b68-809c-2795958b883d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0105: Impact,n; o; n; e,9,Are the observed ICS 'write' commands statistically anomalous compared to a learned baseline of normal command behavior?,"This question uses machine learning to identify unusual or novel ICS 'write' commands that might not violate a simple rule but are inconsistent with normal operations. An OCSVM model can learn the multi-dimensional profile of normal commands (source IP, target register, value). Any command that falls outside this learned 'normal' cluster is flagged as an outlier. A secondary model monitors the temporal patterns of commands (frequency, entropy) to detect behavioral shifts, like a sudden flood of write commands, indicative of a scripting attack.
","Zeek conn.log; Zeek modbus.log; Zeek dnp3.log; Zeek enip.log; Zeek s7comm.log; Windows Event ID 4688; Windows Event ID 4624; Process Control Network (PCN) segments, Safety Instrumented System (SIS) network segments, PLC/RTU network interfaces, Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), SCADA Servers, Data Historian servers.",last 90 days,"TRAIN OCSVM on normal [source_ip, register, value] tuples. FOR live write commands, WHERE model predicts outlier (-1), ALERT. AND/OR TRAIN anomaly model on 1-min aggregated features (write frequency, entropy). WHERE changepoint or spike detected, ALERT.",playbooks/attack/ics/T0832.yml
T0834: Native API,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0104: Execution,n; o; n; e,1,Is a critical ICS process spawning an unauthorized child process or attempting to inject into another process?,"This question aims to detect direct code execution attempts where a legitimate, whitelisted ICS process is compromised and used to launch malicious tools (like command shells) or inject code. Such behavior is a strong indicator of an adversary leveraging a trusted process to bypass security controls. The action involves creating detection rules based on parent-child relationships, unauthorized interpreters, unsigned binaries, execution from temporary locations, and monitoring for memory write access requests which can precede process injection.","W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 6; 8; 8; ,;  ; S; y; s; m; o; n;  ; E; v; e; n; t;  ; I; D;  ; 1; ,;  ; W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 6; 5; 6;  ; f; r; o; m;  ; E; n; g; i; n; e; e; r; i; n; g;  ; W; o; r; k; s; t; a; t; i; o; n; s;  ; (; E; W; S; ); ,;  ; H; u; m; a; n; -; M; a; c; h; i; n; e;  ; I; n; t; e; r; f; a; c; e; s;  ; (; H; M; I; ); ,;  ; I; C; S;  ; A; p; p; l; i; c; a; t; i; o; n;  ; S; e; r; v; e; r; s;  ; (; S; C; A; D; A; /; D; C; S; ); ,;  ; D; a; t; a;  ; H; i; s; t; o; r; i; a; n;  ; S; e; r; v; e; r; s; ,;  ; D; o; m; a; i; n;  ; C; o; n; t; r; o; l; l; e; r; s;  ; w; i; t; h; i; n;  ; t; h; e;  ; P; r; o; c; e; s; s;  ; C; o; n; t; r; o; l;  ; N; e; t; w; o; r; k; .",Last 90 days,"Search (Process_Creation_Events) WHERE parent_process IN (critical_ics_watchlist) AND (child_process IN (interpreter_denylist) OR child_process_signature = ""invalid"" OR child_process_path CONTAINS (""%TEMP%"", ""C:\\Users\\Public"")); Search (Memory_Access_Events) WHERE source_process IN (critical_ics_watchlist) AND access_mask CONTAINS (""process_memory_write"")",playbooks/attack/ics/T0834.yml
T0834: Native API,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0104: Execution,n; o; n; e,2,Are there statistically rare parent-child process relationships or command-line arguments originating from critical ICS processes?,"This question seeks to identify anomalies using statistical baselining. Adversaries might use legitimate but uncommon child processes or obfuscated command-line arguments to evade simple signature-based detections. By establishing a baseline of normal behavior and alerting on rare occurrences (99th percentile rarity) or high-entropy command lines (3 standard deviations from the norm), we can detect subtle deviations that may indicate malicious activity.","W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 6; 8; 8; ,;  ; S; y; s; m; o; n;  ; E; v; e; n; t;  ; I; D;  ; 1;  ; f; r; o; m;  ; E; n; g; i; n; e; e; r; i; n; g;  ; W; o; r; k; s; t; a; t; i; o; n; s;  ; (; E; W; S; ); ,;  ; H; u; m; a; n; -; M; a; c; h; i; n; e;  ; I; n; t; e; r; f; a; c; e; s;  ; (; H; M; I; ); ,;  ; I; C; S;  ; A; p; p; l; i; c; a; t; i; o; n;  ; S; e; r; v; e; r; s;  ; (; S; C; A; D; A; /; D; C; S; ); ,;  ; D; a; t; a;  ; H; i; s; t; o; r; i; a; n;  ; S; e; r; v; e; r; s; ,;  ; D; o; m; a; i; n;  ; C; o; n; t; r; o; l; l; e; r; s;  ; w; i; t; h; i; n;  ; t; h; e;  ; P; r; o; c; e; s; s;  ; C; o; n; t; r; o; l;  ; N; e; t; w; o; r; k; .",Last 90 days,Compare (new_process_event) against (30_day_historical_baseline) IF (parent_child_frequency < 1st_percentile) OR (command_line_entropy_deviation > 3_std_dev) THEN ALERT,playbooks/attack/ics/T0834.yml
T0834: Native API,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0104: Execution,n; o; n; e,3,Has a machine learning model detected an anomalous process creation event associated with a critical ICS asset?,"This question leverages unsupervised machine learning to find novel or complex attacks that do not fit pre-defined rules or statistical thresholds. An Isolation Forest model can identify outliers across multiple features simultaneously (e.g., process names, command-line attributes, signature status). Flagging events in the top 2% of anomaly scores provides a robust, adaptive detection mechanism for previously unseen malicious process behaviors.","S; y; s; m; o; n;  ; E; v; e; n; t;  ; I; D;  ; 1;  ; f; r; o; m;  ; E; n; g; i; n; e; e; r; i; n; g;  ; W; o; r; k; s; t; a; t; i; o; n; s;  ; (; E; W; S; ); ,;  ; H; u; m; a; n; -; M; a; c; h; i; n; e;  ; I; n; t; e; r; f; a; c; e; s;  ; (; H; M; I; ); ,;  ; I; C; S;  ; A; p; p; l; i; c; a; t; i; o; n;  ; S; e; r; v; e; r; s;  ; (; S; C; A; D; A; /; D; C; S; ); ,;  ; D; a; t; a;  ; H; i; s; t; o; r; i; a; n;  ; S; e; r; v; e; r; s; ,;  ; D; o; m; a; i; n;  ; C; o; n; t; r; o; l; l; e; r; s;  ; w; i; t; h; i; n;  ; t; h; e;  ; P; r; o; c; e; s; s;  ; C; o; n; t; r; o; l;  ; N; e; t; w; o; r; k; .",Last 90 days,Score (new_process_event) with (Isolation_Forest_Model) IF (anomaly_score > 98th_percentile) THEN ALERT,playbooks/attack/ics/T0834.yml
T0834: Native API,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0104: Execution,n; o; n; e,4,Is a critical ICS application initiating network connections using non-standard protocols or communicating with unauthorized external destinations?,"This question addresses the risk of compromised ICS applications being used for command and control (C2) or data exfiltration. Critical industrial applications should have highly predictable network behavior, typically restricted to specific industrial protocols and internal destinations. An alert on connections using IT protocols (HTTP, RDP) to external IPs or queries for non-whitelisted domains is a strong indicator that the process's functionality has been hijacked.","Z; e; e; k;  ; c; o; n; n; .; l; o; g; ,;  ; Z; e; e; k;  ; d; n; s; .; l; o; g; ,;  ; W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 5; 1; 5; 6; ,;  ; S; y; s; m; o; n;  ; E; v; e; n; t;  ; I; D;  ; 3;  ; f; r; o; m;  ; N; e; t; w; o; r; k;  ; s; e; n; s; o; r; s;  ; a; t;  ; t; h; e;  ; p; e; r; i; m; e; t; e; r;  ; o; f;  ; I; C; S;  ; N; e; t; w; o; r; k;  ; S; e; g; m; e; n; t; s;  ; (; P; u; r; d; u; e;  ; L; e; v; e; l; s;  ; 2; /; 3; ); ,;  ; I; n; d; u; s; t; r; i; a; l;  ; D; e; m; i; l; i; t; a; r; i; z; e; d;  ; Z; o; n; e;  ; (; I; D; M; Z; );  ; e; g; r; e; s; s;  ; p; o; i; n; t; s; ,;  ; D; N; S;  ; r; e; s; o; l; v; e; r; s;  ; s; e; r; v; i; n; g;  ; t; h; e;  ; O; T;  ; e; n; v; i; r; o; n; m; e; n; t; ,;  ; I; n; t; e; r; n; e; t;  ; g; a; t; e; w; a; y;  ; p; r; o; x; i; e; s; .",Last 90 days,Search (Network_Connection_Events) JOIN (Process_Info) WHERE process_name IN (critical_ics_watchlist) AND ((destination_port IN (common_it_ports) AND destination_ip NOT IN (ot_ip_space)) OR (dns_query NOT IN (domain_whitelist))),playbooks/attack/ics/T0834.yml
T0834: Native API,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0104: Execution,n; o; n; e,5,"Is a critical ICS application exhibiting statistically anomalous network behavior, such as connecting to new ports or transferring unusual amounts of data?","This question uses baselining to detect subtle changes in network patterns. An adversary might use an allowed protocol but connect to a new, unauthorized port, or exfiltrate data by sending larger-than-normal data volumes. Alerting when an application connects to a port for the first time or when its daily data volume exceeds the 95th percentile helps catch these less obvious indicators of compromise.","Z; e; e; k;  ; c; o; n; n; .; l; o; g;  ; f; r; o; m;  ; N; e; t; w; o; r; k;  ; s; e; n; s; o; r; s;  ; a; t;  ; t; h; e;  ; p; e; r; i; m; e; t; e; r;  ; o; f;  ; I; C; S;  ; N; e; t; w; o; r; k;  ; S; e; g; m; e; n; t; s;  ; (; P; u; r; d; u; e;  ; L; e; v; e; l; s;  ; 2; /; 3; ); ,;  ; I; n; d; u; s; t; r; i; a; l;  ; D; e; m; i; l; i; t; a; r; i; z; e; d;  ; Z; o; n; e;  ; (; I; D; M; Z; );  ; e; g; r; e; s; s;  ; p; o; i; n; t; s; ,;  ; D; N; S;  ; r; e; s; o; l; v; e; r; s;  ; s; e; r; v; i; n; g;  ; t; h; e;  ; O; T;  ; e; n; v; i; r; o; n; m; e; n; t; ,;  ; I; n; t; e; r; n; e; t;  ; g; a; t; e; w; a; y;  ; p; r; o; x; i; e; s; .",Last 90 days,Compare (new_network_connection) against (30_day_historical_baseline) IF (destination_port_frequency = 0) OR (daily_data_volume > 95th_percentile) THEN ALERT,playbooks/attack/ics/T0834.yml
T0834: Native API,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0104: Execution,n; o; n; e,6,Has a machine learning model classified a network connection from a critical ICS application as an outlier?,"This question employs a One-Class Support Vector Machine (OC-SVM) model, a machine learning technique ideal for anomaly detection when only 'normal' data is available for training. The model learns the boundary of normal network behavior based on features like connection duration, bytes transferred, and protocol state. Any new connection that falls outside this learned boundary is flagged as an outlier, enabling the detection of sophisticated attacks with unusual network characteristics.","Z; e; e; k;  ; c; o; n; n; .; l; o; g;  ; f; r; o; m;  ; N; e; t; w; o; r; k;  ; s; e; n; s; o; r; s;  ; a; t;  ; t; h; e;  ; p; e; r; i; m; e; t; e; r;  ; o; f;  ; I; C; S;  ; N; e; t; w; o; r; k;  ; S; e; g; m; e; n; t; s;  ; (; P; u; r; d; u; e;  ; L; e; v; e; l; s;  ; 2; /; 3; ); ,;  ; I; n; d; u; s; t; r; i; a; l;  ; D; e; m; i; l; i; t; a; r; i; z; e; d;  ; Z; o; n; e;  ; (; I; D; M; Z; );  ; e; g; r; e; s; s;  ; p; o; i; n; t; s; ,;  ; D; N; S;  ; r; e; s; o; l; v; e; r; s;  ; s; e; r; v; i; n; g;  ; t; h; e;  ; O; T;  ; e; n; v; i; r; o; n; m; e; n; t; ,;  ; I; n; t; e; r; n; e; t;  ; g; a; t; e; w; a; y;  ; p; r; o; x; i; e; s; .",Last 90 days,"Score (new_network_connection) with (OC_SVM_Model) IF (classification = ""outlier"") THEN ALERT",playbooks/attack/ics/T0834.yml
T0834: Native API,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0104: Execution,n; o; n; e,7,Is a critical ICS process attempting to write to or delete protected system files or registry keys?,"This question aims to detect attempts by a compromised ICS process to achieve persistence, escalate privileges, or tamper with the system. Critical applications should not be modifying system executables (e.g., in System32), autorun registry keys, or their own on-disk binaries. By enabling auditing (SACLs) on these sensitive resources and alerting on write/delete attempts from whitelisted ICS processes, defenders can catch blatant attempts to manipulate the operating environment.","W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 6; 6; 3; ,;  ; W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 6; 5; 7; ,;  ; S; y; s; m; o; n;  ; E; v; e; n; t;  ; I; D;  ; 1; 1; ,;  ; S; y; s; m; o; n;  ; E; v; e; n; t;  ; I; D;  ; 1; 2; ,;  ; S; y; s; m; o; n;  ; E; v; e; n; t;  ; I; D;  ; 1; 3;  ; f; r; o; m;  ; F; i; l; e;  ; s; y; s; t; e; m; s;  ; a; n; d;  ; r; e; g; i; s; t; r; i; e; s;  ; o; f;  ; c; r; i; t; i; c; a; l;  ; I; C; S;  ; a; s; s; e; t; s; ,;  ; i; n; c; l; u; d; i; n; g;  ; E; n; g; i; n; e; e; r; i; n; g;  ; W; o; r; k; s; t; a; t; i; o; n; s;  ; (; E; W; S; ); ,;  ; H; u; m; a; n; -; M; a; c; h; i; n; e;  ; I; n; t; e; r; f; a; c; e; s;  ; (; H; M; I; ); ,;  ; a; n; d;  ; A; p; p; l; i; c; a; t; i; o; n;  ; S; e; r; v; e; r; s; .",Last 90 days,"Search (File_or_Registry_Events) WHERE process_name IN (critical_ics_watchlist) AND event_type IN (""write"", ""delete"") AND target_path IN (protected_resource_list)",playbooks/attack/ics/T0834.yml
T0834: Native API,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0104: Execution,n; o; n; e,8,Is a critical ICS application writing to a statistically rare file or registry path?,"This question uses statistical analysis to find malicious activity that does not target explicitly protected paths. An adversary might drop a payload or configuration file in an unusual but not explicitly forbidden location. By baselining all write locations for a critical process and alerting on writes to very infrequent paths (99th percentile rarity), we can detect suspicious file and registry interactions that deviate from established normal behavior.","W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 6; 6; 3; ,;  ; W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 6; 5; 7; ,;  ; S; y; s; m; o; n;  ; E; v; e; n; t;  ; I; D;  ; 1; 1; ,;  ; S; y; s; m; o; n;  ; E; v; e; n; t;  ; I; D;  ; 1; 2; ,;  ; S; y; s; m; o; n;  ; E; v; e; n; t;  ; I; D;  ; 1; 3;  ; f; r; o; m;  ; F; i; l; e;  ; s; y; s; t; e; m; s;  ; a; n; d;  ; r; e; g; i; s; t; r; i; e; s;  ; o; f;  ; c; r; i; t; i; c; a; l;  ; I; C; S;  ; a; s; s; e; t; s; ,;  ; i; n; c; l; u; d; i; n; g;  ; E; n; g; i; n; e; e; r; i; n; g;  ; W; o; r; k; s; t; a; t; i; o; n; s;  ; (; E; W; S; ); ,;  ; H; u; m; a; n; -; M; a; c; h; i; n; e;  ; I; n; t; e; r; f; a; c; e; s;  ; (; H; M; I; ); ,;  ; a; n; d;  ; A; p; p; l; i; c; a; t; i; o; n;  ; S; e; r; v; e; r; s; .",Last 90 days,Compare (new_write_event) against (30_day_historical_baseline) IF (path_rarity_score > 99th_percentile) THEN ALERT,playbooks/attack/ics/T0834.yml
T0834: Native API,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0104: Execution,n; o; n; e,9,Has a machine learning model detected a syntactically anomalous file or registry path being written by a critical ICS application?,"This question uses a deep learning model to detect algorithmically generated or heavily obfuscated paths that would appear structurally different from normal, human-readable paths. A character-level autoencoder learns the typical patterns of file and registry paths. When a new path with an unusual structure is processed, it results in a high reconstruction error. This technique is effective at identifying malware that uses path generation algorithms for its components.","W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 6; 6; 3; ,;  ; W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 6; 5; 7; ,;  ; S; y; s; m; o; n;  ; E; v; e; n; t;  ; I; D;  ; 1; 1; ,;  ; S; y; s; m; o; n;  ; E; v; e; n; t;  ; I; D;  ; 1; 2; ,;  ; S; y; s; m; o; n;  ; E; v; e; n; t;  ; I; D;  ; 1; 3;  ; f; r; o; m;  ; F; i; l; e;  ; s; y; s; t; e; m; s;  ; a; n; d;  ; r; e; g; i; s; t; r; i; e; s;  ; o; f;  ; c; r; i; t; i; c; a; l;  ; I; C; S;  ; a; s; s; e; t; s; ,;  ; i; n; c; l; u; d; i; n; g;  ; E; n; g; i; n; e; e; r; i; n; g;  ; W; o; r; k; s; t; a; t; i; o; n; s;  ; (; E; W; S; ); ,;  ; H; u; m; a; n; -; M; a; c; h; i; n; e;  ; I; n; t; e; r; f; a; c; e; s;  ; (; H; M; I; ); ,;  ; a; n; d;  ; A; p; p; l; i; c; a; t; i; o; n;  ; S; e; r; v; e; r; s; .",Last 90 days,Score (new_write_path) with (Path_Autoencoder_Model) IF (reconstruction_error > threshold) THEN ALERT,playbooks/attack/ics/T0834.yml
T0835: Manipulate I-O Image,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0107: Inhibit Response Function,n; o; n; e,1,"Have any Modbus 'Force Coil' commands (Function Code 5 or 15) been issued from an unauthorized source, by an unapproved process, or outside of a maintenance window?","This question seeks to identify overtly unauthorized or suspicious Modbus 'Force Coil' commands. These commands can directly manipulate the binary state of outputs on a PLC. Detecting them from non-allowlisted IPs, unauthorized software, or outside planned operational windows is a strong indicator of malicious intent, as it suggests an adversary is attempting to alter the physical process without authorization.
",Zeek modbus.log; Zeek conn.log; Windows Event ID 4688; Windows Event ID 4624; Industrial Demilitarized Zone (IDMZ) network segments; Control Network segments (Level 3.5 and 3 of Purdue Model); Process Control Network (PCN) segments (Level 2 of Purdue Model); Engineering Workstation (EWS) endpoints; PLC network interfaces,last 90 days,": SEARCH Zeek modbus.log WHERE function_code IN [5, 15]
IF source_ip NOT IN ews_allowlist THEN ALERT
ELSE
  SEARCH Windows Event ID 4688 WHERE source_ip AND timestamp
  IF process_name NOT IN process_allowlist THEN ALERT
END
IF command_timestamp NOT IN maintenance_window THEN ALERT
",playbooks/attack/ics/T0835.yml
T0835: Manipulate I-O Image,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0107: Inhibit Response Function,n; o; n; e,2,Has there been an anomalous frequency or volume of Modbus 'Force Coil' commands (Function Code 5 or 15) between any source IP and target PLC?,"This question aims to detect volumetric anomalies in 'Force Coil' commands. Even if the source is authorized, a sudden spike in the frequency of these commands can indicate a malfunction, a misconfiguration, or a malicious script attempting to disrupt a process through rapid state changes. Comparing current activity against a historical baseline helps identify statistically significant deviations from normal behavior.
",Zeek modbus.log; Zeek conn.log; Windows Event ID 4688; Windows Event ID 4624; Industrial Demilitarized Zone (IDMZ) network segments; Control Network segments (Level 3.5 and 3 of Purdue Model); Process Control Network (PCN) segments (Level 2 of Purdue Model); Engineering Workstation (EWS) endpoints; PLC network interfaces,last 90 days,": FOR EACH source_ip, destination_ip:
  BASELINE = Calculate 99th percentile of hourly count(FC 5, 15) over last 30 days
  CURRENT_COUNT = Hourly count(FC 5, 15) for current hour
  IF CURRENT_COUNT > BASELINE THEN ALERT
",playbooks/attack/ics/T0835.yml
T0835: Manipulate I-O Image,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0107: Inhibit Response Function,n; o; n; e,3,Do any Modbus 'Force Coil' commands (Function Code 5 or 15) exhibit characteristics that a machine learning model classifies as malicious with high confidence?,"This question leverages a machine learning model to identify complex patterns indicative of malicious activity that might be missed by simple rule-based or statistical methods. By analyzing a combination of features like source, destination, timing, and originating process, the model can learn the subtle nuances of normal vs. malicious 'Force Coil' commands and flag suspicious events with a high degree of confidence.
",Zeek modbus.log; Zeek conn.log; Windows Event ID 4688; Windows Event ID 4624; Industrial Demilitarized Zone (IDMZ) network segments; Control Network segments (Level 3.5 and 3 of Purdue Model); Process Control Network (PCN) segments (Level 2 of Purdue Model); Engineering Workstation (EWS) endpoints; PLC network interfaces,last 90 days,": FOR EACH Modbus command (FC 5, 15):
  EXTRACT features (source_ip, dest_ip, coil_addr, time, process_name)
  PREDICTION = ML_Model.predict(features)
  PROBABILITY = ML_Model.predict_proba(features)
  IF PREDICTION == 'malicious' AND PROBABILITY > 0.9 THEN ALERT
",playbooks/attack/ics/T0835.yml
T0835: Manipulate I-O Image,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0107: Inhibit Response Function,n; o; n; e,4,"Have any Modbus 'Preset Register' commands (Function Code 6 or 16) been issued from an unauthorized source, by an unapproved process, or with a value outside of its safe operational range?","This question focuses on detecting unauthorized or unsafe attempts to write values to PLC registers. 'Preset Register' commands can alter critical process parameters like setpoints, timers, or counters. An unauthorized source, unapproved software, or an unsafe value being written to a critical register are strong indicators of an attempt to sabotage or disrupt the controlled process.
",Zeek modbus.log; Zeek conn.log; Windows Event ID 4688; Windows Event ID 4624; Process Control Network (PCN) segments (Level 2 of Purdue Model); critical PLC backplanes; Engineering Workstation (EWS) endpoints; PLC network interfaces,last 90 days,": SEARCH Zeek modbus.log WHERE function_code IN [6, 16]
IF source_ip NOT IN ews_allowlist THEN ALERT
ELSE
  SEARCH Windows Event ID 4688 WHERE source_ip AND timestamp
  IF process_name NOT IN process_allowlist THEN ALERT
END
IF register_address IN critical_registers AND register_value NOT IN safe_range THEN ALERT
",playbooks/attack/ics/T0835.yml
T0835: Manipulate I-O Image,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0107: Inhibit Response Function,n; o; n; e,5,Has any critical PLC register been written with a value that is a statistically significant deviation from its historical norm?,"This question aims to detect anomalous register values that may still be within a theoretical safe range but are highly unusual for normal operations. By calculating the historical mean and standard deviation for a register's value, we can identify writes that are statistically improbable (e.g., more than 3 standard deviations away). Such an event could signal an adversary's attempt to subtly manipulate a process or a precursor to a more significant attack.
",Zeek modbus.log; Zeek conn.log; Windows Event ID 4688; Windows Event ID 4624; Process Control Network (PCN) segments (Level 2 of Purdue Model); critical PLC backplanes; Engineering Workstation (EWS) endpoints; PLC network interfaces,last 90 days,": FOR EACH critical_register:
  MEAN, STD_DEV = Calculate mean and std deviation of value over last 30 days
FOR EACH new write command (FC 6, 16) to critical_register:
  IF new_value > (MEAN + 3 * STD_DEV) OR new_value < (MEAN - 3 * STD_DEV) THEN ALERT
",playbooks/attack/ics/T0835.yml
T0835: Manipulate I-O Image,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0107: Inhibit Response Function,n; o; n; e,6,Do any Modbus 'Preset Register' commands (Function Code 6 or 16) exhibit characteristics that an unsupervised anomaly detection model flags as highly unusual?,"This question employs unsupervised machine learning to find novel or complex anomalies in 'Preset Register' commands. Unlike supervised models, an Isolation Forest or similar model does not require pre-labeled malicious data. It identifies outliers based on how different they are from the established baseline of normal activity across multiple features. This is effective for catching previously unseen attack patterns or sophisticated manipulations that evade simpler detection logic.
",Zeek modbus.log; Zeek conn.log; Windows Event ID 4688; Windows Event ID 4624; Process Control Network (PCN) segments (Level 2 of Purdue Model); critical PLC backplanes; Engineering Workstation (EWS) endpoints; PLC network interfaces,last 90 days,": FOR EACH Modbus write command (FC 6, 16):
  EXTRACT features (source_ip, dest_ip, register_addr, register_val, time)
  ANOMALY_SCORE = Unsupervised_Model.score(features)
  IF ANOMALY_SCORE > 95th_percentile_threshold THEN ALERT",playbooks/attack/ics/T0835.yml
T0838: Modify Alarm Settings,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0107: Inhibit Response Function,n; o; n; e,1,Has an unauthorized user or process attempted to modify a critical alarm configuration file outside of a designated maintenance window?,"This question helps detect direct, unauthorized tampering with alarm configuration files on critical systems. By monitoring for specific file access events and correlating them with process creation data, analysts can identify modifications made by non-whitelisted entities or at unusual times, which are strong indicators of malicious activity aimed at suppressing alarms.","Windows Event ID 4663; Windows Event ID 4688; Windows Event ID 5145; Windows Event ID 4656; Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Historian servers, Data Gateways/OPC Servers",last 90 days,": SEARCH for EventID 4663 or 5145 on critical file paths
WHERE file path in watchlist
EXTRACT ProcessID
JOIN with EventID 4688 on ProcessID
EXTRACT user, parent process
ALERT if user or parent process NOT in whitelist OR event time outside maintenance window
",playbooks/attack/ics/T0838.yml
T0838: Modify Alarm Settings,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0107: Inhibit Response Function,n; o; n; e,2,Has there been a statistically anomalous spike in modification activity or a change in the variety of parent processes modifying critical alarm configuration files?,"This question focuses on detecting deviations from normal modification patterns. A sudden increase in the frequency of file writes/deletes can indicate bulk changes or repeated tampering. Similarly, a significant change in the entropy of parent processes (e.g., a single, unusual process now responsible for all modifications) can expose a new or anomalous tool being used by an adversary.","Windows Event ID 4663; Windows Event ID 5145; Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Historian servers, Data Gateways/OPC Servers",last 60 days,": // Query 1: Frequency Anomaly
CALCULATE hourly count of EventID 4663/5145 on critical files over 60 days
DETERMINE 99th percentile for each hour
SEARCH for current hourly count
ALERT if current count > 99th percentile threshold

// Query 2: Entropy Anomaly
CALCULATE rolling 24-hour Shannon entropy of parent process names modifying critical files
DETERMINE 2-standard-deviation band from baseline
ALERT if current entropy is outside the band
",playbooks/attack/ics/T0838.yml
T0838: Modify Alarm Settings,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0107: Inhibit Response Function,n; o; n; e,3,Can we use a machine learning model to predict whether a specific modification to an alarm configuration file is malicious?,"This question aims to automate the detection of malicious modifications by using a supervised machine learning model. By training on historical data with known outcomes, the model can learn complex patterns that distinguish malicious from benign activity, allowing for real-time scoring and alerting on high-confidence predictions, reducing analyst workload and improving accuracy.","Windows Event ID 4663; Windows Event ID 4688; Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Historian servers, Data Gateways/OPC Servers",last 90 days,": FOR each new EventID 4663 on critical file:
GATHER features: process name, parent process, user, time of day, etc.
INPUT features into trained classification model
GET prediction score
ALERT if prediction is 'malicious' AND score > 0.90
",playbooks/attack/ics/T0838.yml
T0838: Modify Alarm Settings,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0107: Inhibit Response Function,n; o; n; e,4,"Has a known alarm configuration file been transferred to a critical ICS asset from an unapproved source, using an unapproved port, or with a hash that does not match a known-good version?","This question addresses the threat of an adversary introducing a modified alarm configuration file over the network. By monitoring file transfers and verifying the source, destination port, and file integrity against whitelists and known-good hashes, analysts can detect unauthorized file staging or replacement activities.","Zeek files.log; Zeek conn.log; Zeek smb_files.log; Zeek ftp.log; IT/OT boundary firewalls, Industrial Demilitarized Zones (IDMZ), Control Network segments (Process Control, Safety Instrumented Systems), Wireless Industrial Networks",last 90 days,": SEARCH Zeek files.log WHERE filename in watchlist AND destination is critical asset
JOIN with conn.log on UID
ALERT if source IP NOT in whitelist
OR destination port NOT in whitelist
OR file SHA1 hash NOT in known-good hash list
",playbooks/attack/ics/T0838.yml
T0838: Modify Alarm Settings,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0107: Inhibit Response Function,n; o; n; e,5,"Has there been a statistically anomalous increase in the number or volume of alarm configuration files transferred to a critical asset, or a change in the diversity of sources for these transfers?","This question seeks to identify unusual network transfer patterns. A spike in the volume or count of configuration files being transferred could indicate a large-scale modification attempt. A sudden drop in the entropy of source IPs (e.g., many files coming from a single, new IP) might point to a centralized staging host used by an attacker.","Zeek files.log; Zeek conn.log; IT/OT boundary firewalls, Industrial Demilitarized Zones (IDMZ), Control Network segments (Process Control, Safety Instrumented Systems), Wireless Industrial Networks",last 60 days,": // Query 1: Volume/Count Anomaly
CALCULATE daily count and volume of config file transfers to critical assets over 60 days
DETERMINE 99th percentile for count and volume
SEARCH for current daily metrics
ALERT if current count > threshold OR current volume > threshold

// Query 2: Source Entropy Anomaly
CALCULATE rolling 24-hour Shannon entropy of source IPs transferring config files
ALERT if entropy drops suddenly
",playbooks/attack/ics/T0838.yml
T0838: Modify Alarm Settings,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0107: Inhibit Response Function,n; o; n; e,6,"Does overall network traffic to critical ICS assets show anomalous patterns that could indicate malicious activity, such as the transfer of modified alarm files?","This question uses an unsupervised machine learning model to find subtle deviations in network behavior that might otherwise be missed. By learning what ""normal"" traffic looks like across multiple dimensions (byte count, protocols, file transfers, etc.), the model can flag periods of unusual activity that warrant investigation, even if no single rule is explicitly violated.","Zeek files.log; Zeek conn.log; IT/OT boundary firewalls, Industrial Demilitarized Zones (IDMZ), Control Network segments (Process Control, Safety Instrumented Systems), Wireless Industrial Networks",last 90 days,": AGGREGATE hourly network features (byte count, packet count, file transfers, etc.) for traffic to critical assets
INPUT feature vector into trained LSTM Autoencoder model
CALCULATE reconstruction error (anomaly score)
ALERT if anomaly score is high
",playbooks/attack/ics/T0838.yml
T0838: Modify Alarm Settings,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0107: Inhibit Response Function,n; o; n; e,7,"Has a critical alarm service been stopped outside of a legitimate system shutdown, or has its startup type been changed to 'Disabled'?","This question targets direct attempts to disable alarm services. An adversary might stop a service to prevent new alarms from being generated or processed. Monitoring for service stop events (and filtering out legitimate shutdowns) is a direct way to detect this. Additionally, changing a service's startup type to 'Disabled' is a persistence technique to ensure the service does not run on the next reboot.","Windows Event ID 7036; Windows Event ID 1074; Windows Event ID 4688; Windows Event ID 7040; Operator Stations, Human-Machine Interfaces (HMIs), Alarm management servers, SCADA Servers, Data Historian Servers",last 90 days,": // Query 1: Service Stop
SEARCH for EventID 7036 where service in watchlist AND state is 'stopped'
CHECK for EventID 1074 on same host in preceding 5 minutes
IF no shutdown event, ALERT and investigate initiator with EventID 4688

// Query 2: Service Start Type Change
SEARCH for EventID 7040 where service in watchlist
ALERT if new start type is 'Disabled'
",playbooks/attack/ics/T0838.yml
T0838: Modify Alarm Settings,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0107: Inhibit Response Function,n; o; n; e,8,Has a critical alarm service stopped prematurely or more frequently than normal?,"This question uses historical data to establish a baseline for normal service behavior. A service stopping much sooner than it typically does (low percentile uptime) could indicate a crash or a forced termination. Likewise, an increase in the frequency of stop events (high percentile count) could signal repeated, unsuccessful attempts by an adversary to disable the service.","Windows Event ID 7036; Operator Stations, Human-Machine Interfaces (HMIs), Alarm management servers, SCADA Servers, Data Historian Servers",last 90 days,": // Query 1: Uptime Anomaly
CALCULATE uptime durations for critical services over 90 days
DETERMINE 5th percentile of uptime
FOR each new 'stopped' event, calculate uptime
ALERT if uptime < 5th percentile

// Query 2: Frequency Anomaly
CALCULATE daily count of unsuppressed 'stopped' events over 90 days
DETERMINE 99th percentile of daily counts
ALERT if current daily count > 99th percentile
",playbooks/attack/ics/T0838.yml
T0838: Modify Alarm Settings,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0107: Inhibit Response Function,n; o; n; e,9,Can a machine learning model be used to determine if a service stop event is suspicious?,"This question proposes using a supervised model to automate the classification of service stop events. By learning from labeled historical data, the model can identify complex relationships between features (like the time of day, initiating process, and proximity to a system shutdown) to accurately predict whether a stop event is legitimate or suspicious, thereby focusing analyst attention on high-probability threats.","Windows Event ID 7036; Windows Event ID 1074; Windows Event ID 4688; Operator Stations, Human-Machine Interfaces (HMIs), Alarm management servers, SCADA Servers, Data Historian Servers",last 90 days,": FOR each new EventID 7036 'stopped' event:
GATHER features: service name, time of day, has preceding shutdown, initiator, etc.
INPUT features into trained classification model
GET prediction score
ALERT if prediction is 'suspicious' AND score > 0.85",playbooks/attack/ics/T0838.yml
T0861: Point & Tag Identification,f8a9b7c6-d5e4-4f3c-b2a1-9e8d7c6b5a4b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0100: Collection,n; o; n; e,1,Is an unknown or unauthorized host communicating using ICS protocols on the Process Control Network?,"This question aims to identify hosts that have not been seen communicating with ICS protocols before. Answering this can uncover unauthorized devices, compromised IT systems pivoting into the OT environment, or an adversary's initial reconnaissance attempts within the control network. Identifying such activity early is critical to preventing further intrusion.","Zeek modbus.log; Zeek ethernetip.log; Zeek dnp3.log; Zeek opcua.log; Zeek conn.log; Network segments corresponding to Purdue Model Levels 0, 1, and 2, specifically traffic between PLCs, RTUs, and HMIs; Network taps or SPAN ports on switches within the Process Control Network (PCN); Firewall and NIDS logs at the boundary between the IT network (Level 4/5) and the OT DMZ (Level 3.5) and between the DMZ and the PCN (Level 3)",last 90 days,": FOR each ICS protocol log (Modbus, DNP3, etc.) FROM last 30 days, GET source_ip. COMPARE source_ip against static_allowlist AND dynamic_baseline_of_known_ips. ALERT if source_ip is not in either list.",playbooks/attack/ics/T0861.yml
T0861: Point & Tag Identification,f8a9b7c6-d5e4-4f3c-b2a1-9e8d7c6b5a4b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0100: Collection,n; o; n; e,2,Is an authorized ICS host exhibiting scanning behavior by making an unusually high volume of read requests or contacting an abnormal number of unique devices?,This question focuses on detecting anomalous behavior from otherwise legitimate devices. An adversary who has compromised an authorized host (like an HMI) may use it to scan the network to identify other devices and map out the process. This query helps detect such internal reconnaissance by baselining normal activity and flagging statistically significant deviations.,"Zeek modbus.log; Zeek ethernetip.log; Zeek dnp3.log; Zeek opcua.log; Zeek conn.log; Network segments corresponding to Purdue Model Levels 0, 1, and 2, specifically traffic between PLCs, RTUs, and HMIs; Network taps or SPAN ports on switches within the Process Control Network (PCN); Firewall and NIDS logs at the boundary between the IT network (Level 4/5) and the OT DMZ (Level 3.5) and between the DMZ and the PCN (Level 3)",last 90 days,": FOR each authorized_host, CALCULATE 7-day rolling baseline of hourly_read_requests and unique_destinations. CALCULATE 99th percentile for both metrics. COMPARE current hourly counts against baseline. ALERT if current_count > 99th_percentile.",playbooks/attack/ics/T0861.yml
T0861: Point & Tag Identification,f8a9b7c6-d5e4-4f3c-b2a1-9e8d7c6b5a4b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0100: Collection,n; o; n; e,3,"Does the overall communication pattern of an ICS host deviate significantly from its established normal behavior, considering multiple protocol features simultaneously?","This question uses a more advanced, model-based approach to detect subtle anomalies that might be missed by simple thresholding. By creating a 'fingerprint' of normal communication for each host (e.g., packet counts, unique IPs, function codes used), a machine learning model can identify complex deviations that indicate sophisticated reconnaissance or manipulation, even if individual metrics remain within simple thresholds.","Zeek modbus.log; Zeek ethernetip.log; Zeek dnp3.log; Zeek opcua.log; Zeek conn.log; Network segments corresponding to Purdue Model Levels 0, 1, and 2, specifically traffic between PLCs, RTUs, and HMIs; Network taps or SPAN ports on switches within the Process Control Network (PCN); Firewall and NIDS logs at the boundary between the IT network (Level 4/5) and the OT DMZ (Level 3.5) and between the DMZ and the PCN (Level 3)",last 90 days,": FOR each host, TRAIN anomaly detection model on historical data (30+ days) using features (packet counts, unique IPs, function codes). APPLY model to real-time traffic. ALERT if anomaly_score > 95th_percentile_of_historical_scores.",playbooks/attack/ics/T0861.yml
T0861: Point & Tag Identification,f8a9b7c6-d5e4-4f3c-b2a1-9e8d7c6b5a4b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0100: Collection,n; o; n; e,4,Is an unauthorized user or an unapproved process attempting to read sensitive ICS project or tag export files?,"This question helps detect direct attempts to steal intellectual property or gather intelligence for an attack. By monitoring read access to critical files (like PLC logic or tag databases) and alerting on access by unauthorized users or suspicious processes (e.g., cmd.exe, powershell.exe), security teams can catch adversaries trying to exfiltrate project data.","Windows Event ID 4663; Windows Event ID 4688; File system and object access audit logs on Engineering Workstations (EWS), project file repositories, and version control servers, typically located in Purdue Model Level 3 or 2; Central file servers in the business network (Level 4) that store backups of ICS project files; Document management systems where tag databases might be stored",last 90 days,": MONITOR Windows Event ID 4663 for project_file_types. FOR each event, CHECK if SubjectUserName AND ProcessName are in allowlist. ALERT if either is not on allowlist.",playbooks/attack/ics/T0861.yml
T0861: Point & Tag Identification,f8a9b7c6-d5e4-4f3c-b2a1-9e8d7c6b5a4b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0100: Collection,n; o; n; e,5,"Is an authorized user accessing an unusually large number or volume of ICS project files, suggesting bulk data collection?","This question addresses the insider threat or compromised account scenario. A legitimate user's account could be used to gather project files en masse. By baselining normal file access patterns for each user, this query can flag abnormal behavior, such as an engineer suddenly accessing hundreds of project files when they typically only access a few per day.","Windows Event ID 4663; Windows Event ID 4688; File system and object access audit logs on Engineering Workstations (EWS), project file repositories, and version control servers, typically located in Purdue Model Level 3 or 2; Central file servers in the business network (Level 4) that store backups of ICS project files; Document management systems where tag databases might be stored",last 90 days,": FOR each authorized_user, CALCULATE 7-day rolling baseline of hourly_unique_files_accessed and total_read_events. CALCULATE 99th percentile for both. ALERT if user's current hourly activity > 99th_percentile for either metric.",playbooks/attack/ics/T0861.yml
T0861: Point & Tag Identification,f8a9b7c6-d5e4-4f3c-b2a1-9e8d7c6b5a4b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0100: Collection,n; o; n; e,6,"Is a user's file access behavior anomalous when considering the process used, time of day, and access velocity?","This question uses User and Entity Behavior Analytics (UEBA) to build a sophisticated profile of normal file access. It goes beyond simple counts to detect contextual anomalies. For example, an engineer accessing 10 project files using 'Studio5000.exe' during work hours is normal. The same user accessing the same files via 'powershell.exe' at 2 AM is highly suspicious. This model-based approach helps identify such nuanced threats.","Windows Event ID 4663; Windows Event ID 4688; File system and object access audit logs on Engineering Workstations (EWS), project file repositories, and version control servers, typically located in Purdue Model Level 3 or 2; Central file servers in the business network (Level 4) that store backups of ICS project files; Document management systems where tag databases might be stored",last 90 days,": TRAIN UEBA model on user file access (Event 4663), profiling user-process-filetype triplets, access times, and velocity. APPLY model to real-time events. ALERT on significant deviation from learned profile.",playbooks/attack/ics/T0861.yml
T0861: Point & Tag Identification,f8a9b7c6-d5e4-4f3c-b2a1-9e8d7c6b5a4b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0100: Collection,n; o; n; e,7,"Is an unauthorized client connecting to the Process Data Historian, or is there evidence of a successful brute-force login attack against it?","This question has two parts to detect unauthorized access to the historian. First, it identifies any network connections from clients that are not explicitly authorized, indicating a potential intrusion. Second, it looks for the classic pattern of a brute-force attack: a burst of failed logins followed by a success from the same source, which strongly suggests a compromised credential.","Zeek conn.log; Windows Event ID 4624; Windows Event ID 4625; Network traffic to and from Process Data Historian servers, typically at Purdue Model Level 3.5 or 4; Security event logs (logon/logoff events) on the historian servers themselves; Network flow data (e.g., Zeek conn.log) captured at the network switch port for the historian or at the firewall segmenting the historian from other network zones",last 90 days,: QUERY 1: MONITOR connections on historian_ports. ALERT if source_ip is not in static_allowlist AND not in 30-day dynamic_baseline. QUERY 2: MONITOR failed logins (Event 4625) and successful logins (Event 4624). ALERT if count(failed_logins from source_ip) >= 10 within 5 mins AND is followed by successful_login from same source_ip.,playbooks/attack/ics/T0861.yml
T0861: Point & Tag Identification,f8a9b7c6-d5e4-4f3c-b2a1-9e8d7c6b5a4b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0100: Collection,n; o; n; e,8,Is an authorized client exfiltrating an abnormally large amount of data from the Process Data Historian?,"This question aims to detect bulk data exfiltration, which is a key part of tag identification. An adversary who has gained access to a legitimate client may attempt to download the entire tag database. By baselining the normal amount of data transferred from the historian to each client, this query can detect significant outliers that represent a potential mass data export.","Zeek conn.log; Windows Event ID 4624; Windows Event ID 4625; Network traffic to and from Process Data Historian servers, typically at Purdue Model Level 3.5 or 4; Security event logs (logon/logoff events) on the historian servers themselves; Network flow data (e.g., Zeek conn.log) captured at the network switch port for the historian or at the firewall segmenting the historian from other network zones",last 90 days,": FOR each client-historian_pair, CALCULATE 7-day rolling hourly baseline of bytes_transferred_from_historian. CALCULATE 99.9th percentile. ALERT if current hourly bytes > 99.9th_percentile.",playbooks/attack/ics/T0861.yml
T0861: Point & Tag Identification,f8a9b7c6-d5e4-4f3c-b2a1-9e8d7c6b5a4b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0100: Collection,n; o; n; e,9,"Does a client's connection profile to the historian deviate significantly from its normal 'data query profile', considering duration, data volume, and time-of-day?","This question uses a machine learning model to create a detailed profile for each client's interaction with the historian. It's more robust than a simple data volume check because it considers multiple features of the connection. This can detect more subtle exfiltration attempts, such as queries run at unusual times or connections with abnormal durations, which might indicate an adversary manually exploring the database rather than a standard automated query.","Zeek conn.log; Windows Event ID 4624; Windows Event ID 4625; Network traffic to and from Process Data Historian servers, typically at Purdue Model Level 3.5 or 4; Security event logs (logon/logoff events) on the historian servers themselves; Network flow data (e.g., Zeek conn.log) captured at the network switch port for the historian or at the firewall segmenting the historian from other network zones",last 90 days,": FOR each client, TRAIN anomaly detection model on historical connection data (duration, bytes_sent, bytes_received, time-of-day). APPLY model to new connections. ALERT if a connection is flagged as a significant outlier.",playbooks/attack/ics/T0861.yml
T0864: Transient Cyber Asset,a7d8e9f0-1b2c-4d5e-8f6a-7b8c9d0e1f23,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0108: Initial Access,n; o; n; e,1,"How can I detect and alert on network connections from new, undocumented devices targeting critical ICS hosts?","This question aims to identify potentially unauthorized transient assets connecting to the ICS network for the first time. By comparing observed source MAC/IP addresses against historical data and authoritative asset inventories, we can flag devices that are not whitelisted or part of the known configuration, which could represent an initial access attempt.","Zeek conn.log; Zeek dhcp.log; ICS Asset Inventory (CMDB); Device Whitelists; NAI: Network ingress/egress points for ICS zones (e.g., Level 2 Process Control Network, Level 3.5 Manufacturing Zone), especially within maintenance and engineering VLANs, IT/OT DMZ gateways, core ICS network switches, and physical ports where transient devices (e.g., engineering laptops, diagnostic tools) connect. Also, Jump Servers and Bastion Hosts within the IT/OT DMZ.",last 30 days,": FOREACH conn in zeek_conn_logs:
  source_ip = conn.id.orig_h
  source_mac = conn.source_mac
  is_new_ip = NOT seen_in_logs(source_ip, last 30 days)
  is_new_mac = NOT seen_in_logs(source_mac, last 30 days)
  IF is_new_ip OR is_new_mac:
    is_in_cmdb = lookup_in_cmdb(source_ip, source_mac)
    is_whitelisted = lookup_in_whitelist(source_ip, source_mac)
    IF NOT is_in_cmdb AND NOT is_whitelisted:
      ALERT ""New, un-inventoried device detected"" with conn details
",playbooks/attack/ics/T0864.yml
T0864: Transient Cyber Asset,a7d8e9f0-1b2c-4d5e-8f6a-7b8c9d0e1f23,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0108: Initial Access,n; o; n; e,2,Is there an unusual surge in the number of new devices connecting to an ICS network segment?,"This question focuses on detecting anomalous trends in new device connections. A sudden increase in the volume of new devices, even if individual connections don't seem malicious, can indicate a coordinated or large-scale unauthorized access event. Baselining this activity helps distinguish normal fluctuations from statistically significant spikes.","Zeek conn.log; NAI: Network ingress/egress points for ICS zones (e.g., Level 2 Process Control Network, Level 3.5 Manufacturing Zone), especially within maintenance and engineering VLANs, IT/OT DMZ gateways, core ICS network switches, and physical ports where transient devices (e.g., engineering laptops, diagnostic tools) connect. Also, Jump Servers and Bastion Hosts within the IT/OT DMZ.",last 60 days,": FOREACH segment in ics_segments:
  new_devices_today = count_unique_ips_macs(today) NOT seen_in_logs(last 7 days)
  baseline = calculate_percentile(daily_new_device_counts, last 60 days, 99)
  IF new_devices_today > baseline:
    ALERT ""Unusual surge in new devices detected"" with segment, count, threshold
",playbooks/attack/ics/T0864.yml
T0864: Transient Cyber Asset,a7d8e9f0-1b2c-4d5e-8f6a-7b8c9d0e1f23,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0108: Initial Access,n; o; n; e,3,Can machine learning be used to identify network connections that are anomalous compared to historical patterns within an ICS segment?,"This question proposes using an unsupervised machine learning model (like Isolation Forest) to find connections that don't fit the established normal behavior. This is useful for catching novel or subtle attack techniques that might not be caught by simple rule-based checks, by analyzing multiple features of a connection simultaneously.","Zeek conn.log; NAI: Network ingress/egress points for ICS zones (e.g., Level 2 Process Control Network, Level 3.5 Manufacturing Zone), especially within maintenance and engineering VLANs, IT/OT DMZ gateways, core ICS network switches, and physical ports where transient devices (e.g., engineering laptops, diagnostic tools) connect. Also, Jump Servers and Bastion Hosts within the IT/OT DMZ.",last 90 days,": model = load_pretrained_isolation_forest_model()
FOREACH conn in new_zeek_conn_logs:
  features = extract_features(conn)
  anomaly_score = model.predict(features)
  IF anomaly_score > 0.6:
    ALERT ""Anomalous network connection detected by ML model"" with conn details and score
",playbooks/attack/ics/T0864.yml
T0864: Transient Cyber Asset,a7d8e9f0-1b2c-4d5e-8f6a-7b8c9d0e1f23,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0108: Initial Access,n; o; n; e,4,Is a known transient asset communicating with unauthorized destinations or known malicious endpoints?,Even authorized transient assets can be compromised. This question focuses on enforcing strict communication policies by checking if a transient asset is connecting to an IP/port/protocol combination that is not on its explicit whitelist. It also checks for communication with known malicious IPs/domains from threat intelligence feeds.,"Zeek conn.log; Zeek dns.log; Asset Whitelist; Threat Intelligence Feed; NAI: Network ingress/egress points for ICS zones, especially at the boundaries of Level 2/3.5 networks, Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Historians, Programmable Logic Controllers (PLCs), Remote Terminal Units (RTUs), and network gateways connecting the Process Control Network (PCN) to corporate IT or external networks. Also, the transient asset's point of connection to the ICS network and any associated management/maintenance VLANs.",last 90 days,": malicious_ips = load_threat_intel_ips()
FOREACH conn in zeek_conn_logs from known_transient_assets:
  is_whitelisted = check_whitelist(conn.id.orig_h, conn.id.resp_h, conn.id.resp_p, conn.proto)
  is_malicious = conn.id.resp_h in malicious_ips
  IF NOT is_whitelisted OR is_malicious:
    ALERT ""Transient asset communication violation"" with details
",playbooks/attack/ics/T0864.yml
T0864: Transient Cyber Asset,a7d8e9f0-1b2c-4d5e-8f6a-7b8c9d0e1f23,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0108: Initial Access,n; o; n; e,5,Is a known transient asset exhibiting statistically anomalous communication behavior in terms of destinations or data volume?,"This question aims to detect behavioral deviations in authorized transient assets. By creating a baseline of normal activity (common destinations, typical data volume), we can identify when an asset starts communicating with rare destinations or transfers an unusually large amount of data, which could indicate misuse or compromise.","Zeek conn.log; NAI: Network ingress/egress points for ICS zones, especially at the boundaries of Level 2/3.5 networks, Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Historians, Programmable Logic Controllers (PLCs), Remote Terminal Units (RTUs), and network gateways connecting the Process Control Network (PCN) to corporate IT or external networks. Also, the transient asset's point of connection to the ICS network and any associated management/maintenance VLANs.",last 60 days,": FOREACH asset in known_transient_assets:
  baseline_dest = get_99_percentile_destinations(asset, last 60 days)
  baseline_volume_stats = get_hourly_volume_mean_stddev(asset, last 60 days)
  FOREACH conn in new_logs_for(asset):
    IF conn.destination NOT in baseline_dest:
      ALERT ""Connection to rare destination""
    current_hourly_volume = get_current_hourly_volume(asset)
    z_score = (current_hourly_volume - baseline_volume_stats.mean) / baseline_volume_stats.stddev
    IF z_score > 3:
      ALERT ""Anomalous hourly data volume""
",playbooks/attack/ics/T0864.yml
T0864: Transient Cyber Asset,a7d8e9f0-1b2c-4d5e-8f6a-7b8c9d0e1f23,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0108: Initial Access,n; o; n; e,6,Can advanced machine learning models detect subtle anomalies in a transient asset's communication patterns over time or classify individual connections as anomalous?,"This question leverages two types of ML: time-series forecasting (Prophet) to find deviations from expected traffic patterns over time, and supervised classification (Random Forest) to make a real-time judgment on individual connections. This provides a more sophisticated, multi-faceted approach to detecting compromised transient assets.","Zeek conn.log; NAI: Network ingress/egress points for ICS zones, especially at the boundaries of Level 2/3.5 networks, Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Historians, Programmable Logic Controllers (PLCs), Remote Terminal Units (RTUs), and network gateways connecting the Process Control Network (PCN) to corporate IT or external networks. Also, the transient asset's point of connection to the ICS network and any associated management/maintenance VLANs.",last 90 days,": prophet_model = load_prophet_model_for_asset()
rf_model = load_random_forest_model_for_asset()
observed_volume = get_observed_hourly_volume()
forecast = prophet_model.predict()
IF observed_volume > forecast.yhat_upper for 3 consecutive hours:
  ALERT ""Sustained anomalous data volume detected by Prophet""
FOREACH conn in new_logs_for_asset:
  features = extract_features(conn)
  prediction = rf_model.predict(features)
  IF prediction.class == 'anomalous' AND prediction.confidence > 0.75:
    ALERT ""Anomalous connection classified by Random Forest""
",playbooks/attack/ics/T0864.yml
T0864: Transient Cyber Asset,a7d8e9f0-1b2c-4d5e-8f6a-7b8c9d0e1f23,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0108: Initial Access,n; o; n; e,7,Was an executable file transferred from a transient asset to an ICS host and then immediately executed?,"This is a classic 'download and execute' pattern. Correlating a file transfer with a subsequent process creation within a short time window is a strong indicator of malicious activity, such as malware delivery or the staging of unauthorized tools.","Zeek files.log; Zeek smb_files.log; Zeek http.log; Windows Event ID 4688; NAI: Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Historians, file servers, and other Windows-based servers within the Process Control Network (PCN), especially endpoints configured to accept file transfers from transient devices. Also, network segments where transient assets connect and hosts within those segments, and IT/OT DMZ file transfer zones.",last 90 days,": FOREACH file_transfer in file_logs where source_ip is transient_asset:
  IF file_extension is executable:
    SEARCH process_logs for EventID 4688 where:
      host == file_transfer.destination_ip AND
      process_name == file_transfer.filename AND
      timestamp is within 5 minutes of file_transfer.timestamp
    IF match_found:
      ALERT ""File transfer followed by immediate execution"" with details
",playbooks/attack/ics/T0864.yml
T0864: Transient Cyber Asset,a7d8e9f0-1b2c-4d5e-8f6a-7b8c9d0e1f23,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0108: Initial Access,n; o; n; e,8,Are files being transferred from transient assets with unusually random filenames or unexpected file sizes?,"Attackers often use randomized filenames to evade simple signature-based detection. High filename entropy can be an indicator of such obfuscation. Similarly, if a file pretending to be a legitimate tool has a size that is significantly different from the real tool, it might be a malicious implant.","Zeek files.log; NAI: Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Historians, file servers, and other Windows-based servers within the Process Control Network (PCN), especially endpoints configured to accept file transfers from transient devices. Also, network segments where transient assets connect and hosts within those segments, and IT/OT DMZ file transfer zones.",last 90 days,": entropy_baseline = calculate_percentile(filename_entropy, last 90 days, 99)
filesize_baselines = get_legitimate_filesize_baselines()
FOREACH file_transfer in file_logs:
  entropy = calculate_shannon_entropy(file_transfer.filename)
  IF entropy > entropy_baseline:
    ALERT ""High entropy filename detected""
  IF file_transfer.filename in filesize_baselines:
    size_deviation = abs(file_transfer.size - filesize_baselines[file_transfer.filename]) / filesize_baselines[file_transfer.filename]
    IF size_deviation > 0.10:
      ALERT ""Anomalous file size detected for known executable""
",playbooks/attack/ics/T0864.yml
T0864: Transient Cyber Asset,a7d8e9f0-1b2c-4d5e-8f6a-7b8c9d0e1f23,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0108: Initial Access,n; o; n; e,9,Can a machine learning model be used to predict whether a file transfer followed by execution is a malicious event?,"This question proposes building a classifier that learns the characteristics of both benign and malicious 'transfer-and-execute' events. By using features like file type, protocol, entropy, and process context, the model can provide a high-confidence assessment of whether a new event is malicious, automating a complex analysis task.","Zeek files.log; Windows Event ID 4688; Threat Intelligence Feed; NAI: Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Historians, file servers, and other Windows-based servers within the Process Control Network (PCN), especially endpoints configured to accept file transfers from transient devices. Also, network segments where transient assets connect and hosts within those segments, and IT/OT DMZ file transfer zones.",last 90 days,": model = load_pretrained_gbm_model()
correlated_events = correlate_file_transfers_with_process_creations()
FOREACH event in correlated_events:
  features = extract_features_from_event(event)
  prediction = model.predict(features)
  IF prediction.class == 'malicious' AND prediction.confidence > 0.85:
    ALERT ""Malicious file transfer/execution pair detected by ML model""
",playbooks/attack/ics/T0864.yml
T0864: Transient Cyber Asset,a7d8e9f0-1b2c-4d5e-8f6a-7b8c9d0e1f23,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0108: Initial Access,n; o; n; e,10,Is a user session from a transient asset executing commands with suspicious keywords or issuing potentially harmful ICS protocol commands?,"This question seeks to detect direct malicious interaction. It involves looking for known suspicious command-line strings (e.g., from hacking tools) within sessions originating from transient assets. It also expands the search to the OT layer, checking for dangerous industrial protocol commands (like write operations) that could alter a physical process.","Windows Event ID 4688; Windows Event ID 4624; Zeek rdp.log; Zeek dnp3.log; Zeek modbus.log; NAI: Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Domain Controllers, Bastion Hosts, and other Windows-based servers within the ICS environment, particularly endpoints where transient assets establish direct or indirect interactive sessions. Also, network segments where DNP3/Modbus communications are monitored to detect effects of malicious commands.",last 90 days,": suspicious_keywords = ['mimikatz', 'Invoke-WebRequest', 'whoami /all']
transient_sessions = get_sessions_from_transient_assets()
FOREACH process in process_logs where process.session in transient_sessions:
  IF process.command_line contains any suspicious_keywords:
    ALERT ""Suspicious keyword in command line from transient session""
FOREACH ot_command in dnp3_modbus_logs from transient_ips:
  IF ot_command is write_operation AND NOT in maintenance_window:
    ALERT ""Unauthorized OT write command from transient asset""
",playbooks/attack/ics/T0864.yml
T0864: Transient Cyber Asset,a7d8e9f0-1b2c-4d5e-8f6a-7b8c9d0e1f23,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0108: Initial Access,n; o; n; e,11,Is a transient asset executing administrative commands with novel or unusually complex (high entropy) arguments?,Attackers often use legitimate tools for malicious purposes ('living off the land'). This question aims to detect this by baselining normal command-line usage for common tools. A command that is structurally very different (low Jaccard similarity) or overly complex/obfuscated (high entropy) is highly suspicious.,"Windows Event ID 4688; NAI: Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Domain Controllers, Bastion Hosts, and other Windows-based servers within the ICS environment, particularly endpoints where transient assets establish direct or indirect interactive sessions. Also, network segments where DNP3/Modbus communications are monitored to detect effects of malicious commands.",last 90 days,": FOREACH tool in admin_tools:
  baseline_commands = get_historical_commands(tool, last 90 days)
  entropy_baseline = calculate_percentile(command_entropy, last 90 days, 98)
  FOREACH new_command in process_logs for tool from transient_session:
    similarity = max_jaccard_similarity(new_command, baseline_commands)
    entropy = calculate_shannon_entropy(new_command)
    IF similarity < 0.5:
      ALERT ""Novel command-line argument detected""
    IF entropy > entropy_baseline:
      ALERT ""High entropy command-line argument detected""
",playbooks/attack/ics/T0864.yml
T0864: Transient Cyber Asset,a7d8e9f0-1b2c-4d5e-8f6a-7b8c9d0e1f23,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0108: Initial Access,n; o; n; e,12,Can machine learning models classify command lines as malicious or detect anomalous sequences of process executions originating from a transient asset?,"This question proposes two advanced ML approaches. The first uses NLP to understand and classify the intent of a single command line. The second uses an RNN to model entire workflows (sequences of commands) to detect when a user deviates from normal operational procedures, which could indicate malicious exploration or action.","Windows Event ID 4688; NAI: Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Domain Controllers, Bastion Hosts, and other Windows-based servers within the ICS environment, particularly endpoints where transient assets establish direct or indirect interactive sessions. Also, network segments where DNP3/Modbus communications are monitored to detect effects of malicious commands.",last 90 days,": nlp_model = load_nlp_classifier()
rnn_model = load_rnn_sequence_model()
FOREACH new_command in process_logs from transient_session:
  prediction = nlp_model.predict(new_command.command_line)
  IF prediction.class == 'malicious' AND prediction.confidence > 0.8:
    ALERT ""Malicious command line classified by NLP model""
process_sequence = get_process_sequence_for_session()
sequence_probability = rnn_model.predict_probability(process_sequence)
IF sequence_probability is low:
  ALERT ""Anomalous sequence of process executions detected""",playbooks/attack/ics/T0864.yml
T0865: Spearphishing Attachment,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0108: Initial Access,none,1,Are high-risk ICS personnel receiving emails with potentially malicious attachments based on predefined watchlists?,"This question aims to proactively detect targeted spearphishing attempts by creating and monitoring watchlists for high-risk individuals, suspicious file extensions (including common archive and ICS-specific project files), and keywords relevant to the OT environment. By correlating email and file logs, security analysts can generate high-fidelity alerts when an email from an external source matches multiple risk criteria, such as a blacklisted attachment hash or a combination of a risky file type and an ICS-related keyword in the subject or filename.",Zeek smtp.log; Zeek files.log; Zeek dns.log; Zeek x509.log; Active Directory Logs; Corporate Email Gateway; OT Network Mail Relay (if present); Corporate-to-OT DMZ; Engineering Workstations (local email client logs); Control System Network (for internal email traffic if applicable),last 90 days,: JOIN smtp.log and files.log on fuid. FILTER for emails to 'high-risk_personnel_watchlist'. ALERT if attachment_hash in 'threat_intel_hashes' OR (attachment_filename OR attachment_mime_type in 'high-risk_file_list' AND (email_subject OR attachment_filename contains 'ics_keyword_watchlist')).,playbooks/attack/ics/T0865.yml
T0865: Spearphishing Attachment,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0108: Initial Access,none,2,Are high-risk ICS personnel receiving emails with high-risk attachments from anomalous senders or with obfuscated content?,"This question focuses on detecting sophisticated spearphishing by establishing behavioral baselines. It identifies anomalies by tracking the frequency of communication between senders and high-value recipients. An alert is triggered if a risky attachment comes from a new or highly infrequent sender. Additionally, it analyzes the Shannon entropy of email subjects and attachment filenames to spot randomization or obfuscation techniques, which are often used by adversaries to bypass simple signature-based filters. An unusually high entropy value would trigger an alert for further investigation.",Zeek smtp.log; Zeek files.log; Zeek dns.log; Zeek x509.log; Active Directory Logs; Corporate Email Gateway; OT Network Mail Relay (if present); Corporate-to-OT DMZ; Engineering Workstations (local email client logs); Control System Network (for internal email traffic if applicable),last 90 days,: FOR each email to 'high-risk_personnel' with 'high-risk_attachment': CALCULATE 90-day baseline of sender_domain frequency. CALCULATE Shannon entropy for attachment_filename and email_subject. ALERT if sender_domain_frequency < 1st_percentile OR filename_entropy > 99th_percentile OR subject_entropy > 99th_percentile.,playbooks/attack/ics/T0865.yml
T0865: Spearphishing Attachment,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0108: Initial Access,none,3,Can machine learning models identify and score spearphishing emails targeted at high-risk ICS personnel with high confidence?,"This question explores the use of advanced analytics to improve detection accuracy. By implementing a supervised machine learning model (e.g., Gradient Boosting), the system can assign a 'phishing probability score' to each incoming email. The model is trained on a rich set of features, including sender reputation, email authentication results (DMARC/SPF/DKIM), keyword density, attachment characteristics, and historical communication patterns. This provides a more nuanced and adaptive detection capability, generating critical alerts when the model identifies a high-probability phishing attempt targeting a key user with a confidence score exceeding a defined threshold (e.g., > 0.90).",Zeek smtp.log; Zeek files.log; Zeek dns.log; Zeek x509.log; Active Directory Logs; Corporate Email Gateway; OT Network Mail Relay (if present); Corporate-to-OT DMZ; Engineering Workstations (local email client logs); Control System Network (for internal email traffic if applicable),last 90 days,": INPUT email_metadata (sender_domain_age, dmarc_spf_dkim_results, ics_keyword_density, attachment_mime_type, filename_entropy, etc.). APPLY trained classification_model. ALERT if recipient in 'high-risk_personnel' AND model_output_score > 0.90.",playbooks/attack/ics/T0865.yml
T0867: Lateral Tool Transfer,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0105: Impact; TA0109: Lateral Movement,none,1,Are ICS write commands originating from unauthorized source IPs or attempting to set unsafe process values?,"This question helps detect direct manipulation attempts against PLCs and field controllers. Adversaries may try to send malicious commands from a compromised, non-standard device on the network. This query validates that the command originates from an approved HMI or engineering workstation and that the value being written to a process register is within its pre-defined safe operational limits, providing a fundamental defense against process disruption.
","Zeek modbus.log; Zeek dnp3.log; Zeek s7comm.log; Network interfaces of PLCs and other field controllers, particularly on segments accessible by engineering workstations and HMIs.",Last 90 days,"SEARCH Zeek ICS logs (modbus, dnp3, s7comm) FOR write_commands WHERE source_ip NOT IN approved_workstation_list OR written_value NOT IN safe_value_range_for_register",playbooks/attack/ics/T0867.yml
T0867: Lateral Tool Transfer,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0105: Impact; TA0109: Lateral Movement,none,2,"Is there a statistically unusual frequency or value in ICS write commands, even from authorized sources?","This question addresses the scenario where an adversary has compromised an authorized host, such as an HMI, and is using it to launch an attack. By establishing a baseline of normal command frequency and value distributions for each HMI-PLC pair, this query can detect anomalous behavior that signature-based rules would miss. A sudden spike in write commands or a command with an outlier value could indicate a replay attack or a novel manipulation attempt from a trusted source.
","Zeek modbus.log; Zeek dnp3.log; Zeek s7comm.log; Network interfaces of PLCs and other field controllers, particularly on segments accessible by engineering workstations and HMIs.",Last 90 days,COMPARE current_hourly_write_count_per_host_pair WITH 99th_percentile_baseline. ALERT on exceed. COMPARE written_value with 4_std_dev_from_historical_mean. ALERT on exceed.,playbooks/attack/ics/T0867.yml
T0867: Lateral Tool Transfer,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0105: Impact; TA0109: Lateral Movement,none,3,Can machine learning models identify ICS write commands that are characteristic of malicious activity?,"This question explores a proactive, advanced detection method using machine learning. By training a classification model on various contextual features of historical command data (source, destination, function, value, time), it is possible to identify subtle and complex patterns indicative of an attack that evade simple statistical thresholds or whitelists. This helps to flag novel or sophisticated manipulation attempts for analyst review.
","Zeek modbus.log; Zeek dnp3.log; Zeek s7comm.log; Network interfaces of PLCs and other field controllers, particularly on segments accessible by engineering workstations and HMIs.",Last 90 days,APPLY trained_ML_classifier (Random Forest/Gradient Boosting) to new_write_command_features. ALERT if classified as suspicious.,playbooks/attack/ics/T0867.yml
T0867: Lateral Tool Transfer,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0105: Impact; TA0109: Lateral Movement,none,4,Are high-risk files or files being transferred to administrative shares on critical ICS assets from unauthorized sources?,"This question focuses on detecting the initial stage of tool transfer. Adversaries often move executables, scripts, or compressed archives to target systems before execution. This query looks for explicit indicators of this activity, such as files with high-risk extensions (.exe, .ps1) or ICS-specific project files (.ACD, .L5K), and monitors for access to administrative shares (e.g., C$) from systems not authorized for such actions. An alert provides a clear signal of potential lateral movement.
","Zeek smb_files.log; Zeek ftp.log; Zeek files.log; Zeek conn.log; Network traffic sensors deployed at key chokepoints, such as the IT/OT boundary (Purdue Level 3.5), between control and supervisory zones (Purdue Level 2/3), and monitoring traffic to and from critical assets like Engineering Workstations (EWS), Human Machine Interfaces (HMIs), and Historian databases.",Last 90 days,"SEARCH Zeek file logs (smb, ftp) FOR transfers_to_critical_assets WHERE (file_extension IN high_risk_list OR share_path IN admin_share_list) AND source_ip NOT IN approved_admin_list",playbooks/attack/ics/T0867.yml
T0867: Lateral Tool Transfer,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0105: Impact; TA0109: Lateral Movement,none,5,"Are there statistically unusual file transfers to critical ICS assets, such as abnormally large files, files with randomized names, or transfers from new sources?","This question uses a behavioral approach to detect tool transfers that may evade signature-based methods. Adversaries may rename tools or use custom packing to avoid detection. By baselining normal file transfer characteristics (size, name complexity/entropy) and communication patterns (source/destination pairs), this query identifies outliers that could represent obfuscated or novel tool transfers.
","Zeek smb_files.log; Zeek ftp.log; Zeek files.log; Zeek conn.log; Network traffic sensors deployed at key chokepoints, such as the IT/OT boundary (Purdue Level 3.5), between control and supervisory zones (Purdue Level 2/3), and monitoring traffic to and from critical assets like Engineering Workstations (EWS), Human Machine Interfaces (HMIs), and Historian databases.",Last 90 days,"COMPARE new_file_transfer_metrics (size, entropy, src_dst_pair) WITH 30-day_baseline. ALERT if file_size > 98th_percentile OR entropy > 98th_percentile OR src_dst_pair is new",playbooks/attack/ics/T0867.yml
T0867: Lateral Tool Transfer,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0105: Impact; TA0109: Lateral Movement,none,6,Can a machine learning model detect anomalous patterns in overall file transfer activity within the ICS network?,"This question leverages advanced analytics to find systemic changes in network behavior related to file movement. Instead of looking at individual files, it analyzes aggregate trends over time. A sudden shift in the types of files being moved, the volume of data transferred, or the source/destination subnets involved can indicate a large-scale lateral movement or data staging operation that might be missed when looking at events in isolation.
","Zeek smb_files.log; Zeek ftp.log; Zeek files.log; Zeek conn.log; Network traffic sensors deployed at key chokepoints, such as the IT/OT boundary (Purdue Level 3.5), between control and supervisory zones (Purdue Level 2/3), and monitoring traffic to and from critical assets like Engineering Workstations (EWS), Human Machine Interfaces (HMIs), and Historian databases.",Last 90 days,APPLY trained_ML_anomaly_model (Isolation Forest/VAE) to time-series_file_transfer_features. ALERT on high_anomaly_score,playbooks/attack/ics/T0867.yml
T0867: Lateral Tool Transfer,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0105: Impact; TA0109: Lateral Movement,none,7,Is an unauthorized user or system writing files to sensitive network shares on critical ICS hosts?,"This question provides host-based evidence of file transfer, complementing network-based detection. Windows Event ID 5145 gives granular detail about who is accessing what share from where. By filtering for write actions ('WriteData' or 'AppendData') to sensitive locations (like administrative shares or PLC project directories) and checking the source account or IP against a whitelist, analysts can precisely identify unauthorized file placement on critical systems.
","Windows Event ID 5145; Critical ICS hosts (e.g., HMIs, Engineering Workstations, Historians, SCADA servers) where Windows security auditing for detailed file share access is enabled.",Last 90 days,"SEARCH Windows Event Logs FOR EventID=5145 ON critical_hosts WHERE (accesses CONTAINS ""WriteData"") AND (sharename IS admin_share OR target_path IS sensitive) AND (source_ip OR account_name NOT IN approved_list)",playbooks/attack/ics/T0867.yml
T0867: Lateral Tool Transfer,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0105: Impact; TA0109: Lateral Movement,none,8,Is there a statistical anomaly in file write activity on the network shares of critical ICS hosts?,"This question seeks to find deviations from normal user and system behavior on the host itself. Even authorized users can be compromised. By baselining what is normal for each user/system combination (e.g., frequency of writes, types of files written), this method can detect when an account or system starts behaving unusually, such as writing an executable file for the first time or writing files at an abnormally high rate.
","Windows Event ID 5145; Critical ICS hosts (e.g., HMIs, Engineering Workstations, Historians, SCADA servers) where Windows security auditing for detailed file share access is enabled.",Last 90 days,COMPARE new_write_event (EventID 5145) metrics WITH 30-day_baseline. ALERT if hourly_count > 3_std_dev OR source_entity is new OR file_extension is new for that context,playbooks/attack/ics/T0867.yml
T0867: Lateral Tool Transfer,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0105: Impact; TA0109: Lateral Movement,none,9,Can a UEBA model identify anomalous file write access patterns that indicate malicious behavior by a user or entity?,"This question applies sophisticated User and Entity Behavior Analytics (UEBA) to detect compromised accounts or insider threats. A UEBA model can synthesize many features (source IP, account, target path, time of day) to create a rich profile of normal behavior. It can then identify complex deviations that simple rules or statistical thresholds would miss, such as an administrator writing a file to a share they rarely touch, or activity occurring at a strange time of day.
","Windows Event ID 5145; Critical ICS hosts (e.g., HMIs, Engineering Workstations, Historians, SCADA servers) where Windows security auditing for detailed file share access is enabled.",Last 90 days,APPLY trained_UEBA_model (One-Class SVM/Graph) to new_write_event (EventID 5145) features. ALERT on high_anomaly_score,playbooks/attack/ics/T0867.yml
T0867: Lateral Tool Transfer,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0105: Impact; TA0109: Lateral Movement,none,10,Has a file recently written to an ICS host from a network share been immediately executed?,"This is a high-fidelity question that directly links tool transfer to execution, a classic adversary technique. Correlating a file write event (Windows Event ID 5145) with a subsequent process creation event (Event ID 4688) for the same filename provides strong evidence of an adversary running a payload they just transferred. Filtering out legitimate software deployment activity makes this a very powerful alert for remote execution.
","Windows Event ID 5145; Windows Event ID 4688; Critical ICS hosts (e.g., HMIs, Engineering Workstations, Historians) with security event logging enabled for both detailed file share auditing and process creation.",Last 90 days,CORRELATE EventID=5145 (write) with EventID=4688 (execute) on same_host within 300s WHERE file_path = process_name. ALERT if parent_process or account NOT IN whitelist,playbooks/attack/ics/T0867.yml
T0867: Lateral Tool Transfer,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0105: Impact; TA0109: Lateral Movement,none,11,"Is the observed ""write-then-execute"" behavior statistically unusual compared to historical norms?","This question refines the previous correlation by adding a layer of behavioral analysis. Not all ""write-then-execute"" events are malicious. By baselining which processes are legitimately executed from shares, how often, and the typical time lag between the write and the execution, analysts can filter out noise and focus on truly anomalous events, such as a rarely seen process being executed almost instantly after being written.
","Windows Event ID 5145; Windows Event ID 4688; Critical ICS hosts (e.g., HMIs, Engineering Workstations, Historians) with security event logging enabled for both detailed file share auditing and process creation.",Last 90 days,"COMPARE new ""write-then-execute"" event WITH historical_baseline. ALERT if process is rare OR time_delta < 5th_percentile OR file_path_entropy is high",playbooks/attack/ics/T0867.yml
T0867: Lateral Tool Transfer,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0105: Impact; TA0109: Lateral Movement,none,12,"Can a sequence-based machine learning model detect anomalous ""write-then-execute"" event chains?","This question proposes an advanced detection for this technique by modeling the entire sequence of events as a single pattern. A sequence model (like a Hidden Markov Model or Recurrent Neural Network) can learn the normal ""grammar"" of operations. It can then flag sequences that do not fit this grammar, such as a specific user causing a file write from an unusual host, which is then executed by an unexpected parent process, thereby detecting novel attack paths.
","Windows Event ID 5145; Windows Event ID 4688; Critical ICS hosts (e.g., HMIs, Engineering Workstations, Historians) with security event logging enabled for both detailed file share auditing and process creation.",Last 90 days,"APPLY trained_sequence_model (HMM/RNN) to new ""write-then-execute"" event_sequence. ALERT if sequence_probability is low",playbooks/attack/ics/T0867.yml
T0868: Detect Operating Mode,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0100: Collection,none,1,Is an unauthorized asset querying the operating mode of PLCs and executing suspicious processes?,"An adversary might use a non-standard or compromised machine, not on the authorized asset list, to probe the state of PLCs. This question aims to detect such queries from IPs not on the authorized Engineering Workstation (EWS) list and then check the source machine for related suspicious process executions (like scanning tools) within a short time frame to confirm malicious intent.
","Zeek modbus.log; Zeek s7comm.log; Zeek enip.log; Zeek dnp3.log; Zeek conn.log; Windows Event ID 4688; Network sensors (TAPs/SPANs) at the IT/OT boundary, within the Process Control Network (PCN), and in Cell/Area zones. Log aggregators for Engineering Workstations (EWS), SCADA servers, and data historians.",last 90 days,": SEARCH Zeek ICS logs (modbus, s7comm, enip) for operating mode queries
WHERE source_ip NOT IN authorized_ews_watchlist
JOIN with Windows Event ID 4688 logs ON source_ip
WHERE event_time is within 15 minutes of query_time
AND process_name IN (plcscan.py, nmap.exe)
",playbooks/attack/ics/T0868.yml
T0868: Detect Operating Mode,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0100: Collection,none,2,"Is a known, authorized Engineering Workstation exhibiting anomalous PLC operating mode scanning behavior?","Even authorized workstations can be compromised. This question focuses on detecting when a legitimate EWS starts scanning an unusually high number of distinct PLCs for their operating status within a short window. This behavior deviates from normal operational patterns and could indicate that an attacker has gained control of the EWS and is performing network-wide reconnaissance.
","Zeek modbus.log; Zeek s7comm.log; Zeek enip.log; Zeek dnp3.log; Zeek conn.log; Windows Event ID 4688; Network sensors (TAPs/SPANs) at the IT/OT boundary, within the Process Control Network (PCN), and in Cell/Area zones. Log aggregators for Engineering Workstations (EWS), SCADA servers, and data historians.",last 90 days,": FOR each authorized_source_ip in Zeek ICS logs:
CALCULATE 30-day rolling baseline of distinct_destination_plc_count per 5-minute window.
ALERT if current_5_min_count > 99th_percentile_of_baseline.
",playbooks/attack/ics/T0868.yml
T0868: Detect Operating Mode,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0100: Collection,none,3,Are there statistically significant deviations from normal operating mode query patterns between specific source-destination pairs?,"This question uses advanced machine learning to establish a highly detailed baseline of normal communication between specific assets. It aims to detect subtle anomalies in the frequency, timing, and sequence of operating mode queries that might be missed by simple thresholding rules, indicating a more sophisticated or stealthy adversary attempting to blend in.
","Zeek modbus.log; Zeek s7comm.log; Zeek enip.log; Zeek dnp3.log; Zeek conn.log; Windows Event ID 4688; Network sensors (TAPs/SPANs) at the IT/OT boundary, within the Process Control Network (PCN), and in Cell/Area zones. Log aggregators for Engineering Workstations (EWS), SCADA servers, and data historians.",last 90 days,": INPUT: Historical Zeek ICS log data (90+ days) for operating mode queries.
MODEL: Train time-series anomaly detection model (e.g., ARIMA, LSTM) on frequency/timing for each source-destination pair.
APPLY model to real-time data.
ALERT on statistically significant deviations.
",playbooks/attack/ics/T0868.yml
T0868: Detect Operating Mode,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0100: Collection,none,4,Did a remote logon from an untrusted location to an EWS precede PLC operating mode queries from that same EWS?,"This question tries to link a potentially risky remote access event to subsequent reconnaissance activity in the OT network. A logon from an unapproved IP or geographic location is suspicious on its own; if it is followed within 30 minutes by PLC scanning from that same EWS, it strongly suggests a compromised EWS is being used for malicious purposes.
","Windows Event ID 4624; Zeek conn.log; Zeek rdp.log; Zeek modbus.log; Zeek s7comm.log; Zeek enip.log; Windows Event ID 4688; Log sources on Engineering Workstation (EWS) endpoints, Active Directory Domain Controllers, and remote access infrastructure (VPN concentrators, jump boxes). Network traffic sensors at the IT/OT boundary and monitoring EWS subnets.",last 90 days,": SEARCH Windows Event ID 4624 (Logon Type 10)
WHERE source_ip NOT IN trusted_geo_or_ip_list
JOIN with Zeek ICS logs ON ews_ip
WHERE ics_query_time is within 30 minutes of logon_time.
",playbooks/attack/ics/T0868.yml
T0868: Detect Operating Mode,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0100: Collection,none,5,"Did an anomalous remote logon to an EWS, based on user behavior, precede PLC operating mode queries?","This question moves beyond simple IP blocklists to behavioral analysis. It aims to identify remote logons that are unusual for a specific user (e.g., wrong time of day, new ISP, rare geolocation). Correlating this behavioral anomaly with subsequent PLC scanning provides a high-fidelity indicator of a compromised user account being used to access and reconnoiter the OT network.
","Windows Event ID 4624; Zeek conn.log; Zeek rdp.log; Zeek modbus.log; Zeek s7comm.log; Zeek enip.log; Windows Event ID 4688; Log sources on Engineering Workstation (EWS) endpoints, Active Directory Domain Controllers, and remote access infrastructure (VPN concentrators, jump boxes). Network traffic sensors at the IT/OT boundary and monitoring EWS subnets.",last 90 days,": FOR each remote logon (Event 4624, Type 10):
CALCULATE anomaly score based on user's historical attributes (time, ISP, country).
IF score > 95th_percentile:
JOIN with Zeek ICS logs ON ews_ip WHERE ics_query_time is within 30 minutes of logon_time.
ESCALATE alert.
",playbooks/attack/ics/T0868.yml
T0868: Detect Operating Mode,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0100: Collection,none,6,Did a remote logon event classified as an outlier by a clustering model precede PLC operating mode queries?,"This question applies unsupervised machine learning to find remote logons that do not fit any established pattern of behavior across the entire user base. These ""outlier"" or ""noise"" logons are highly suspicious. Linking them to subsequent PLC scanning activity within a short timeframe provides a powerful method for detecting novel or sophisticated intrusion attempts that might evade other detection methods.
","Windows Event ID 4624; Zeek conn.log; Zeek rdp.log; Zeek modbus.log; Zeek s7comm.log; Zeek enip.log; Windows Event ID 4688; Log sources on Engineering Workstation (EWS) endpoints, Active Directory Domain Controllers, and remote access infrastructure (VPN concentrators, jump boxes). Network traffic sensors at the IT/OT boundary and monitoring EWS subnets.",last 90 days,": INPUT: EWS remote logon data (Event 4624, Zeek rdp.log).
MODEL: Train clustering model (e.g., DBSCAN) on logon features (source IP, user, duration).
IDENTIFY outlier/noise logons.
IF logon is an outlier:
JOIN with Zeek ICS logs ON ews_ip WHERE ics_query_time is within 30 minutes of logon_time.
CREATE high-severity alert.",playbooks/attack/ics/T0868.yml
T0871: Execution through API,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0104: Execution,n; o; n; e,1,"Has a network connection to a control device originated from an IP address not on the authorized allowlist, and if so, what process on the source host initiated it?","This question aims to detect unauthorized communication attempts to critical control system devices. By maintaining a strict allowlist of authorized hosts (like Engineering Workstations) for each device and port, any deviation can indicate a misconfiguration, an unauthorized device, or a compromised host attempting to interact with the control system. Correlating network alerts with host-level process creation and network connection events helps pinpoint the exact software or script responsible for the unauthorized connection, providing crucial context for incident response.","Zeek conn.log; Windows Event ID 5156; Windows Event ID 4688; Network ingress/egress points between the Enterprise Network (Level 4/5) and Process Control Network (Level 3), and network segments within the PCN containing Engineering Workstations (EWs), Human-Machine Interfaces (HMIs), and critical control devices (PLCs, RTUs).",last 90 days,": SEARCH Zeek conn.log WHERE destination IP and port are for a critical device AND source IP is NOT in the allowlist for that device/port. CORRELATE the source IP and timestamp with host logs (Windows Event IDs 5156, 4688) to find the originating process.",playbooks/attack/ics/T0871.yml
T0871: Execution through API,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0104: Execution,n; o; n; e,2,"Is there an anomalous spike in the number of unique source IPs attempting to connect to a control device, potentially indicating a network scan?","This question focuses on detecting reconnaissance or widespread access attempts against control devices. A sudden increase in the number of unique systems trying to communicate with a single PLC or RTU is highly abnormal in a stable ICS environment. It often signifies a network scanning activity where an adversary is probing for accessible devices. By baselining normal activity and alerting on statistical deviations, we can catch these early-stage reconnaissance activities before an exploit is attempted.","Zeek conn.log; Network ingress/egress points between the Enterprise Network (Level 4/5) and Process Control Network (Level 3), and network segments within the PCN containing Engineering Workstations (EWs), Human-Machine Interfaces (HMIs), and critical control devices (PLCs, RTUs).",last 90 days,": FROM Zeek conn.log, COUNT unique source IPs per hour for each destination control device. COMPARE the hourly count against a 30-day rolling baseline for that device. ALERT if the count exceeds the 99th percentile of the baseline.",playbooks/attack/ics/T0871.yml
T0871: Execution through API,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0104: Execution,n; o; n; e,3,"Are there any network connections to control devices that are statistically anomalous based on their combined characteristics (e.g., duration, bytes transferred, protocol)?","This question uses a machine learning approach to find unusual connections that might not be caught by simple rules. An Isolation Forest model can identify outliers across multiple dimensions simultaneously. For example, a connection that uses a valid protocol but has an unusually long duration and transfers an uncharacteristically small amount of data might be flagged. This helps detect novel or subtle attack techniques that don't fit pre-defined patterns but deviate from established communication norms.","Zeek conn.log; Network ingress/egress points between the Enterprise Network (Level 4/5) and Process Control Network (Level 3), and network segments within the PCN containing Engineering Workstations (EWs), Human-Machine Interfaces (HMIs), and critical control devices (PLCs, RTUs).",last 90 days,": APPLY a trained Isolation Forest model to live Zeek conn.log data. The model should use features like source/destination IP, destination port, protocol, duration, and bytes transferred. FLAG any connection the model identifies as an anomaly for analyst review.",playbooks/attack/ics/T0871.yml
T0871: Execution through API,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0104: Execution,n; o; n; e,4,"Has a high-risk or write-capable ICS command, such as 'PLC Stop' or 'Program Download', been sent over the network?","This question directly targets the most impactful and potentially destructive commands within ICS protocols. Unauthorized or unexpected use of function codes that can alter a device's state, logic, or operation (e.g., stopping a PLC, overwriting its program) is a critical indicator of an attack. Alerting on these specific commands, especially when cross-referenced with maintenance schedules to filter out legitimate activity, provides a high-fidelity signal of malicious execution.","Zeek modbus.log; Zeek dnp3.log; Zeek s7comm.log; Network taps or SPAN ports deployed at critical choke points within the Process Control Network (Level 2), such as in front of safety PLCs, between HMI/EWS and control devices, and on links to Historian servers.",last 90 days,": SEARCH ICS protocol logs (Modbus, DNP3, S7comm) for the usage of pre-defined critical function codes (e.g., Modbus FC 5, 16; S7comm 'Stop'). GENERATE a high-severity alert, enriching it with asset data and checking against a maintenance calendar.",playbooks/attack/ics/T0871.yml
T0871: Execution through API,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0104: Execution,n; o; n; e,5,"Is the pattern or frequency of ICS function codes used between two devices statistically unusual, suggesting an automated attack or deviation from normal operations?","This question looks for subtle changes in command usage that might indicate compromise. A drop in entropy (less variety in commands) can signal a repetitive, scripted attack, while a Z-score spike (a specific command used far more than usual) can indicate an adversary repeatedly attempting a specific malicious action. This method can detect attacks even when the commands themselves are technically valid, but their pattern of use is abnormal.","Zeek modbus.log; Zeek dnp3.log; Zeek s7comm.log; Network taps or SPAN ports deployed at critical choke points within the Process Control Network (Level 2), such as in front of safety PLCs, between HMI/EWS and control devices, and on links to Historian servers.",last 90 days,": FOR each source-destination asset pair, calculate the Shannon entropy of function codes in a 10-minute window. Also, calculate the Z-score for the frequency of high-risk function codes. ALERT if entropy drops below the 5th percentile of a 60-day baseline OR if the Z-score exceeds 3.0.",playbooks/attack/ics/T0871.yml
T0871: Execution through API,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0104: Execution,n; o; n; e,6,"Does the sequence of ICS commands observed between devices follow a logical and expected operational workflow, or does it represent an improbable sequence indicative of malicious activity?","This question uses a more advanced stateful model to understand the *logic* of an industrial process. A Hidden Markov Model (HMM) learns the normal sequence of operations (e.g., a 'startup' sequence involves command A, then B, then C). If it observes a sequence that has a very low probability of occurring under this learned model (e.g., a 'write' command in the middle of an 'idle' state), it signals a significant deviation from normal process control that could be malicious.","Zeek modbus.log; Zeek dnp3.log; Zeek s7comm.log; Network taps or SPAN ports deployed at critical choke points within the Process Control Network (Level 2), such as in front of safety PLCs, between HMI/EWS and control devices, and on links to Historian servers.",last 90 days,": FEED observed sequences of ICS function codes into a trained Hidden Markov Model (HMM) specific to that industrial process. ALERT if the model calculates a very low probability for an observed sequence, indicating a deviation from the learned normal states.",playbooks/attack/ics/T0871.yml
T0871: Execution through API,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0104: Execution,n; o; n; e,7,"Has a sequence of commands that violates established safe operational procedures, such as a 'PLC Stop' followed by a 'Program Download' from an unauthorized source, been observed?",This question leverages expert human knowledge to define explicitly forbidden or dangerous command sequences. These 'anti-patterns' represent combinations of actions that should never occur during normal operations and are almost certainly malicious or indicative of a severe malfunction. This is a rule-based approach that provides very high-fidelity alerts for known-bad scenarios.,"Zeek conn.log; Zeek modbus.log; Zeek dnp3.log; Zeek s7comm.log; Network segments within the Process Control Network (Level 2) that connect authorized Engineering Workstations (EWs) and Human-Machine Interfaces (HMIs) to their respective control devices (PLCs, RTUs).",last 90 days,": DEFINE and search for specific 'anti-pattern' command sequences within a short time window (e.g., a 'PLC Stop' command immediately followed by a 'Program Download' from a non-EWS source). ALERT if a forbidden sequence is detected.",playbooks/attack/ics/T0871.yml
T0871: Execution through API,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0104: Execution,n; o; n; e,8,"Is an authorized host sending commands to a control device at a rate significantly faster than a human operator, suggesting the use of an automated script?","This question aims to detect when a legitimate, authorized host (like an HMI) might be compromised and used to issue commands. Human operators have physical and cognitive limits on how fast they can interact with a system. By baselining the normal time between commands (inter-arrival time) and alerting on a significant speed-up, we can detect the presence of malicious automation on a compromised but otherwise authorized host.","Zeek conn.log; Zeek modbus.log; Zeek dnp3.log; Zeek s7comm.log; Network segments within the Process Control Network (Level 2) that connect authorized Engineering Workstations (EWs) and Human-Machine Interfaces (HMIs) to their respective control devices (PLCs, RTUs).",last 90 days,": FOR each authorized source-destination pair, calculate the mean inter-arrival time of requests in a 5-minute window. COMPARE this value to a historical baseline. ALERT if the mean inter-arrival time drops below the 1st percentile of the baseline.",playbooks/attack/ics/T0871.yml
T0871: Execution through API,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0104: Execution,n; o; n; e,9,"Does the time-series 'rhythm' of communication volume and command frequency between an authorized host and a control device deviate from its normal, learned pattern?","This question employs a sophisticated deep learning model (LSTM autoencoder) to learn the complex, time-dependent patterns of normal communication. When live traffic no longer matches this learned normal rhythm, the model fails to 'reconstruct' it accurately, resulting in a high reconstruction error. This signals a subtle but significant deviation from normalcy, potentially indicating a compromised host is being used for malicious purposes.","Zeek conn.log; Zeek modbus.log; Zeek dnp3.log; Zeek s7comm.log; Network segments within the Process Control Network (Level 2) that connect authorized Engineering Workstations (EWs) and Human-Machine Interfaces (HMIs) to their respective control devices (PLCs, RTUs).",last 90 days,": PROCESS time-series data (e.g., bytes/sec, commands/sec) from logs through a trained LSTM autoencoder model for each authorized communication pair. ALERT if the model's reconstruction error for the live traffic exceeds a learned threshold.",playbooks/attack/ics/T0871.yml
T0874: Hooking,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0104: Execution; TA0111: Privilege Escalation,n; o; n; e,1,"Is a critical ICS process loading a suspicious DLL based on signature status, path allow/blocklists, or known-bad hashes?","This question aims to identify basic hooking attempts where a legitimate Industrial Control System (ICS) process is forced to load a malicious DLL. Adversaries use this to execute their code within the context of a trusted process. By checking for unsigned DLLs, modules loaded from unexpected or suspicious directories (like temp folders), or modules matching known threat intelligence, analysts can detect common and straightforward hooking implementations.
","Windows Event ID 7 (Sysmon - Image Loaded); NAI: Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Operator Stations, Process Control Servers (e.g., Historians, Domain Controllers in the PCN)",last 90 days,": Search Sysmon Event ID 7 for critical ICS processes. Filter for loaded modules where signature is false/invalid, path is not on allowlist, path is on blocklist, or hash matches threat intelligence.",playbooks/attack/ics/T0874.yml
T0874: Hooking,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0104: Execution; TA0111: Privilege Escalation,n; o; n; e,2,"Is a critical ICS process loading a DLL that is statistically anomalous based on hash prevalence, path entropy, or file size deviation?","This question seeks to uncover more sophisticated hooking attempts that might evade simple signature or path-based checks. By analyzing statistical properties, analysts can find outliers that suggest malicious activity. A rarely seen DLL hash across the environment, a file path with unusually high randomness (entropy), or a known DLL with a modified file size can all be indicators of a compromised file or a novel malware implant.
","Windows Event ID 7 (Sysmon - Image Loaded); NAI: Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Operator Stations, Process Control Servers (e.g., Historians, Domain Controllers in the PCN)",last 90 days,": For Sysmon Event ID 7 from critical ICS processes, calculate 30-day prevalence of ImageLoadedHash. Alert on hashes below 1st percentile. Calculate Shannon entropy of ImageLoaded path and alert if > 3 std dev from mean. For known DLLs, alert if file size deviates > 10% from average.",playbooks/attack/ics/T0874.yml
T0874: Hooking,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0104: Execution; TA0111: Privilege Escalation,n; o; n; e,3,Can a machine learning model detect anomalous DLL loading behavior for a critical ICS process that deviates from its established baseline?,"This question leverages machine learning to automate the detection of complex and subtle hooking activities. By training a model on a comprehensive set of features (signature status, path characteristics, file rarity), it can learn the normal profile of DLL loading for a specific process. The model can then flag new events that deviate significantly from this baseline, identifying novel or advanced attacks that might be missed by manual statistical analysis or static rules.
","Windows Event ID 7 (Sysmon - Image Loaded); NAI: Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Operator Stations, Process Control Servers (e.g., Historians, Domain Controllers in the PCN)",last 90 days,": Using historical Sysmon Event ID 7 data, train an anomaly detection model (e.g., Isolation Forest) with features like signature status, path entropy, and hash rarity. Apply the model to new module load events and alert on high-scoring anomalies.",playbooks/attack/ics/T0874.yml
T0874: Hooking,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0104: Execution; TA0111: Privilege Escalation,n; o; n; e,4,"Is a hooked critical ICS process making network connections to unauthorized destinations, using unapproved protocols, or contacting known malicious domains?","This question investigates the post-exploitation phase of a hooking attack. Once an adversary has injected code into a process, they often establish a network connection for command and control (C2) or data exfiltration. This query looks for clear violations of expected network behavior, such as connections to IPs or ports not on an allowlist, communication over unexpected protocols, or DNS lookups for domains associated with threat actors.
","Windows Event ID 3 (Sysmon - Network Connection); Zeek conn.log; Zeek dns.log; NAI: Process Control Network (PCN) Segments, EWS, HMIs, Historian Servers, Network Gateways",last 90 days,: Correlate Sysmon Event ID 3 and Zeek logs for critical ICS processes. Alert if DestinationIP/Port is not on process allowlist. Alert if DNS query matches threat intelligence. Alert if protocol is not on process-destination allowlist.,playbooks/attack/ics/T0874.yml
T0874: Hooking,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0104: Execution; TA0111: Privilege Escalation,n; o; n; e,5,"Is a critical ICS process exhibiting statistically anomalous network behavior, such as connecting to rare destinations or transferring unusual amounts of data?","This question uses statistical baselining to find subtle indicators of compromise in network traffic from a potentially hooked process. An adversary might use a C2 server that isn't on any public blocklist. However, a connection to a destination rarely or never seen before for that specific ICS process is highly suspicious. Similarly, a sudden spike in data transfer volume could indicate data exfiltration. These statistical anomalies can reveal malicious activity that bypasses static rules.
","Windows Event ID 3 (Sysmon - Network Connection); Zeek conn.log; NAI: Process Control Network (PCN) Segments, EWS, HMIs, Historian Servers, Network Gateways",last 90 days,: Build 90-day baseline of DestinationIP/Port pairs for critical ICS processes. Alert on connections to destinations in the bottom 1st percentile of frequency. Baseline data transfer volume and alert if a connection exceeds the 99th percentile.,playbooks/attack/ics/T0874.yml
T0874: Hooking,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0104: Execution; TA0111: Privilege Escalation,n; o; n; e,6,Can a machine learning model detect anomalous network transactions from a critical ICS process that deviate from its learned multi-variate baseline?,"This question applies advanced machine learning to detect anomalous network behavior by considering multiple features simultaneously. An autoencoder can learn the complex, normal relationships between destination, port, protocol, data volume, and connection duration for a specific process. It can then identify malicious activity that presents as an unusual *combination* of these features, even if each individual feature is not anomalous on its own. This provides a powerful method for detecting novel C2 channels or exfiltration techniques.
","Windows Event ID 3 (Sysmon - Network Connection); Zeek conn.log; NAI: Process Control Network (PCN) Segments, EWS, HMIs, Historian Servers, Network Gateways",last 90 days,": Train an autoencoder on historical network transaction data for critical ICS processes. Use features like IP, port, protocol, byte counts, and duration. Alert on new transactions with a high reconstruction error, indicating a deviation from the normal profile.",playbooks/attack/ics/T0874.yml
T0874: Hooking,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0104: Execution; TA0111: Privilege Escalation,n; o; n; e,7,"Is a privileged ICS process (High or System integrity) loading a DLL that is not on its strict, pre-approved allowlist?","This question focuses on a high-confidence detection method for hooking as a privilege escalation vector. Privileged processes are high-value targets. By maintaining a strict allowlist of known-good DLLs for these processes, any deviation becomes a critical security event. This approach, known as application allowlisting, is highly effective at preventing unauthorized code execution in sensitive processes, as anything not explicitly permitted is denied and flagged.
","Windows Event ID 7 (Sysmon - Image Loaded); NAI: Engineering Workstations (EWS), Domain Controllers, Application Servers within the PCN",last 90 days,": For Sysmon Event ID 7 where parent process IntegrityLevel is High/System, check if ImageLoadedHash and ImageLoaded path are on a pre-defined allowlist. Alert on any mismatch.",playbooks/attack/ics/T0874.yml
T0874: Hooking,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0104: Execution; TA0111: Privilege Escalation,n; o; n; e,8,"Is a privileged ICS process loading a DLL that is statistically anomalous based on hash rarity, file compile time, or path entropy?","This question applies statistical analysis to hunt for hooking in privileged processes, providing detection capabilities when a strict allowlist is not feasible. A DLL loaded into a system-level process should almost never be unique to a single machine (low prevalence). A DLL compiled more recently than the process loading it or the last system patch is also highly suspicious. These statistical indicators help identify novel malware or file-less attacks attempting to escalate privileges.
","Windows Event ID 7 (Sysmon - Image Loaded); NAI: Engineering Workstations (EWS), Domain Controllers, Application Servers within the PCN",last 90 days,": For privileged ICS process module loads, calculate 30-day hash prevalence and alert if < 0.5th percentile. Alert if module compile time is newer than parent process or last patch date. Alert if path entropy is > 3 std dev from mean.",playbooks/attack/ics/T0874.yml
T0874: Hooking,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0104: Execution; TA0111: Privilege Escalation,n; o; n; e,9,Can a One-Class SVM model identify anomalous DLL loading events for privileged ICS processes that indicate a potential privilege escalation attempt?,"This question proposes using a specialized machine learning model (One-Class SVM) to create a high-fidelity baseline of normal DLL loading behavior for privileged processes. This model is particularly well-suited for learning a 'tight' boundary around normal activity. Any new event that falls outside this boundary is considered a significant anomaly. This is a powerful technique for detecting sophisticated hooking attempts aimed at privilege escalation, as it can catch deviations across multiple features simultaneously.
","Windows Event ID 7 (Sysmon - Image Loaded); NAI: Engineering Workstations (EWS), Domain Controllers, Application Servers within the PCN",last 90 days,": Train a One-Class SVM model on Sysmon Event ID 7 data for privileged ICS processes, using features like signature status, path entropy, and hash prevalence. Alert on any new module load flagged as an outlier by the model.",playbooks/attack/ics/T0874.yml
T0874: Hooking,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0104: Execution; TA0111: Privilege Escalation,n; o; n; e,10,"Following a suspicious DLL load, did a critical ICS process spawn a known malicious process or execute a command with suspicious arguments?","This question links the initial hooking event with its immediate consequence: process creation. A common goal of hooking is to spawn a new process, like a command shell, to execute further commands. This query correlates a suspicious module load with a subsequent process creation by the same parent process within a short time window. It looks for high-confidence indicators of malice, such as the creation of `cmd.exe` or `powershell.exe`, or the use of command-line arguments associated with obfuscation (`-enc`) or downloading payloads (`IEX`, `download`).
","Windows Event ID 7 (Sysmon - Image Loaded); Windows Event ID 4688 (Security - A process has been created); Windows Event ID 1 (Sysmon - Process Create); NAI: Engineering Workstations (EWS), HMIs, Historian Servers",last 90 days,": Correlate suspicious Sysmon Event ID 7 with subsequent Sysmon Event ID 1 from the same ProcessGuid within 60 seconds. Alert if child process is on a blocklist (cmd.exe, powershell.exe) or command line contains suspicious strings (-enc, download, IEX).",playbooks/attack/ics/T0874.yml
T0874: Hooking,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0104: Execution; TA0111: Privilege Escalation,n; o; n; e,11,Did a critical ICS process spawn a child process or use command-line arguments that are statistically unusual compared to its 90-day baseline?,"This question uses baselining to detect anomalous process creation events that may indicate a successful hooking attack. Critical ICS processes typically have very predictable behavior, including the child processes they spawn and the arguments they use. This query establishes a historical baseline and alerts on deviations. Alerting on a never-before-seen child process or a command line with a significantly different structure (measured by Jaccard distance) can uncover attacker activity, even if the child process itself is legitimate.
","Windows Event ID 7 (Sysmon - Image Loaded); Windows Event ID 4688 (Security - A process has been created); Windows Event ID 1 (Sysmon - Process Create); NAI: Engineering Workstations (EWS), HMIs, Historian Servers",last 90 days,": Build a 90-day baseline of child processes and command-line arguments for each critical ICS parent process. Alert if a new child process is not in the baseline. For known child processes, tokenize command line and alert if Jaccard distance from historical token sets is > 0.8.",playbooks/attack/ics/T0874.yml
T0874: Hooking,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk,TA0104: Execution; TA0111: Privilege Escalation,n; o; n; e,12,Can a graph-based anomaly detection model identify structurally rare process creation events originating from critical ICS processes?,"This question applies advanced graph analytics to model and detect anomalous process relationships. Normal system activity forms a predictable process creation graph. A hooking attack often creates a structurally rare or impossible path in this graph, for example, a SCADA service suddenly spawning PowerShell. By using a graph-based machine learning model, analysts can automatically detect these structural anomalies, which are strong indicators of compromise, without relying on pre-defined rules.
","Windows Event ID 7 (Sysmon - Image Loaded); Windows Event ID 4688 (Security - A process has been created); Windows Event ID 1 (Sysmon - Process Create); NAI: Engineering Workstations (EWS), HMIs, Historian Servers",last 90 days,": Build a process creation graph from Sysmon Event ID 1 data. Use a graph-based anomaly detection model to find structurally rare parent-child relationships involving critical ICS processes (e.g., historian spawning powershell.exe).",playbooks/attack/ics/T0874.yml
T0880: Loss of Safety,9a8b7c6d-5e4f-4a3b-2c1d-0e9f8a7b6c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0105: Impact,n; o; n; e,1,Has a PLC logic file been transferred to a Safety Instrumented System (SIS) from an unauthorized source or outside a scheduled maintenance window?,"This question seeks to identify potentially malicious logic file transfers. A transfer from an unknown engineering workstation (EWS) or occurring outside of a planned maintenance period is a strong indicator of an attempt to tamper with safety logic, possibly to disable safety features or cause a hazardous state.",Windows Event ID 4688; Windows Event ID 4624; Windows Event ID 4672; Zeek conn.log; Zeek files.log; Zeek smb.log; Zeek ftp.log; Zeek s7comm.log; Zeek enip.log; Network traffic at SIS network segment ingress/egress points; Authentication logs on Domain Controllers; File access and process execution logs on Engineering Workstations (EWS) and file servers; Network protocol logs from network sensors.,last 90 days,"SEARCH network file monitoring logs (e.g., Zeek files.log) FOR file transfers with PLC logic extensions (.L5X, .ACD, .PRO) WHERE destination IP is in SIS asset group AND (source IP is NOT in 'Authorized EWS' list OR timestamp is OUTSIDE 'Scheduled Maintenance' calendar).",playbooks/attack/ics/T0880.yml
T0880: Loss of Safety,9a8b7c6d-5e4f-4a3b-2c1d-0e9f8a7b6c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0105: Impact,n; o; n; e,2,Has an unusually large or long-duration logic file transfer occurred between an authorized Engineering Workstation (EWS) and an SIS PLC?,"Even if a file transfer originates from an authorized source, a significant deviation from normal behavior could indicate a compromised EWS or an unusual, potentially malicious, update. This question looks for statistical anomalies in file size and transfer duration to flag suspicious updates that might otherwise appear legitimate.",Windows Event ID 4688; Windows Event ID 4624; Windows Event ID 4672; Zeek conn.log; Zeek files.log; Zeek smb.log; Zeek ftp.log; Zeek s7comm.log; Zeek enip.log; Network traffic at SIS network segment ingress/egress points; Authentication logs on Domain Controllers; File access and process execution logs on Engineering Workstations (EWS) and file servers; Network protocol logs from network sensors.,last 90 days,"FOR each authorized EWS-SIS pair, CALCULATE 30-day rolling 99th percentile for file size and connection duration from network logs (Zeek files.log, conn.log). ALERT if a new logic file transfer exceeds BOTH the size and duration thresholds.",playbooks/attack/ics/T0880.yml
T0880: Loss of Safety,9a8b7c6d-5e4f-4a3b-2c1d-0e9f8a7b6c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0105: Impact,n; o; n; e,3,Can a machine learning model classify a recent logic file download to an SIS PLC as malicious?,"This question uses a supervised machine learning model to provide a more sophisticated classification of file transfers. By considering multiple features like time, source, size, and protocol, the model can identify complex patterns indicative of malicious activity that simpler rules might miss, providing a high-confidence alert.",Windows Event ID 4688; Windows Event ID 4624; Windows Event ID 4672; Zeek conn.log; Zeek files.log; Zeek smb.log; Zeek ftp.log; Zeek s7comm.log; Zeek enip.log; Network traffic at SIS network segment ingress/egress points; Authentication logs on Domain Controllers; File access and process execution logs on Engineering Workstations (EWS) and file servers; Network protocol logs from network sensors.,last 90 days,"INPUT features (time, source/dest IP, user, file size, duration, protocol, maintenance window flag) of a logic file transfer into a trained classifier (e.g., Random Forest). ALERT if classification is 'malicious' with a confidence score > 0.95.",playbooks/attack/ics/T0880.yml
T0880: Loss of Safety,9a8b7c6d-5e4f-4a3b-2c1d-0e9f8a7b6c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0105: Impact,n; o; n; e,4,Has a critical safety function command been sent to an SIS PLC from an unauthorized source?,"This question aims to detect the direct manipulation of an SIS PLC's core safety functions (e.g., 'Stop CPU', 'Write to safety memory'). Executing such commands from an unauthorized workstation is a direct and high-confidence indicator of an attack intended to cause a loss of safety.",Zeek conn.log; Zeek modbus.log; Zeek s7comm.log; Zeek dnp3.log; Zeek enip.log; Windows Event ID 4624; Windows Event ID 4688; Network traffic at the SIS network segment; ICS protocol logs from network sensors monitoring communication to SIS PLCs; Process execution logs on HMIs and Engineering Workstations; Asset inventory database defining SIS device roles and IP addresses.,last 90 days,"SEARCH deep packet inspection logs (e.g., Zeek s7comm.log) for commands matching a watchlist of critical function codes or memory addresses targeting SIS devices. ALERT if source IP is NOT in the authorized EWS watchlist.",playbooks/attack/ics/T0880.yml
T0880: Loss of Safety,9a8b7c6d-5e4f-4a3b-2c1d-0e9f8a7b6c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0105: Impact,n; o; n; e,5,Is an SIS PLC receiving an anomalous variety or frequency of commands?,"Normal SIS operations typically involve a predictable and repetitive set of commands. A sudden increase in the variety of commands (entropy) or a spike in the frequency of critical 'write' or 'program' commands can indicate an adversary exploring device capabilities or attempting to brute-force a change, deviating from the established operational baseline.",Zeek conn.log; Zeek modbus.log; Zeek s7comm.log; Zeek dnp3.log; Zeek enip.log; Windows Event ID 4624; Windows Event ID 4688; Network traffic at the SIS network segment; ICS protocol logs from network sensors monitoring communication to SIS PLCs; Process execution logs on HMIs and Engineering Workstations; Asset inventory database defining SIS device roles and IP addresses.,last 90 days,"IN 5-minute windows, CALCULATE Shannon entropy of function codes and frequency of 'write'/'program' commands from protocol logs. ALERT if entropy increases > 3 standard deviations OR command frequency exceeds 99th percentile.",playbooks/attack/ics/T0880.yml
T0880: Loss of Safety,9a8b7c6d-5e4f-4a3b-2c1d-0e9f8a7b6c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0105: Impact,n; o; n; e,6,Does the sequence of recent commands sent to an SIS PLC violate its normal operational 'grammar' as determined by a machine learning model?,"This question uses an advanced ML model (like an RNN or LSTM) to learn the legitimate sequence and structure of commands for an SIS PLC. An alert is triggered if a new sequence of commands has a high reconstruction error, meaning it does not conform to the learned 'grammar' of safe operations, indicating a novel or malicious command pattern.",Zeek conn.log; Zeek modbus.log; Zeek s7comm.log; Zeek dnp3.log; Zeek enip.log; Windows Event ID 4624; Windows Event ID 4688; Network traffic at the SIS network segment; ICS protocol logs from network sensors monitoring communication to SIS PLCs; Process execution logs on HMIs and Engineering Workstations; Asset inventory database defining SIS device roles and IP addresses.,last 90 days,INPUT live stream of ICS commands into a trained RNN/LSTM autoencoder. ALERT if the reconstruction error for a command sequence exceeds the dynamically tuned threshold.,playbooks/attack/ics/T0880.yml
T0880: Loss of Safety,9a8b7c6d-5e4f-4a3b-2c1d-0e9f8a7b6c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0105: Impact,n; o; n; e,7,Is an SIS PLC the target of a connection flood or network scan?,"This question looks for brute-force network activity, such as denial-of-service (DoS) attempts or network scanning. A high rate of failed or rejected connection attempts ('S0', 'S1', 'REJ') from a single source to an SIS device is a strong indicator of reconnaissance or an attempt to overwhelm the device.","Zeek conn.log; Zeek notice.log; Zeek weird.log; Zeek packet_filter.log; Network traffic at the SIS network segment and IDMZ boundaries; Logs from network infrastructure (firewalls, switches) protecting the SIS; Network sensor logs (Zeek conn.log, notice.log) capturing connection state information; Performance and availability monitoring data for SIS PLCs.",last 90 days,"SEARCH network connection logs (e.g., Zeek conn.log). ALERT if count of connections with state 'S0', 'S1', or 'REJ' from a single source to a single SIS IP exceeds 100 in 1 minute. CORRELATE with Zeek notices for 'Scan' or 'DoS' against SIS assets.",playbooks/attack/ics/T0880.yml
T0880: Loss of Safety,9a8b7c6d-5e4f-4a3b-2c1d-0e9f8a7b6c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0105: Impact,n; o; n; e,8,"Has there been a statistically significant anomaly in the traffic volume, source diversity, or connection quality to an SIS PLC?","This question seeks to identify more subtle indicators of an attack by baselining key network traffic metrics. A sudden spike in inbound data volume, the number of unique sources communicating with the PLC, or the ratio of incomplete to complete connections can signal abnormal activity like data exfiltration, distributed scanning, or a DoS attack that falls below the thresholds of simpler rules.","Zeek conn.log; Zeek notice.log; Zeek weird.log; Zeek packet_filter.log; Network traffic at the SIS network segment and IDMZ boundaries; Logs from network infrastructure (firewalls, switches) protecting the SIS; Network sensor logs (Zeek conn.log, notice.log) capturing connection state information; Performance and availability monitoring data for SIS PLCs.",last 90 days,"TRACK per-minute metrics (inbound bytes, unique source IPs, incomplete connection ratio) for each SIS PLC. ALERT if byte count or source IP count exceeds 99.9th percentile, OR if incomplete connection ratio exceeds 30-day rolling average.",playbooks/attack/ics/T0880.yml
T0880: Loss of Safety,9a8b7c6d-5e4f-4a3b-2c1d-0e9f8a7b6c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0105: Impact,n; o; n; e,9,Do the current network traffic patterns for an SIS PLC deviate from its forecasted behavior based on a multivariate time-series model?,"This question leverages a sophisticated forecasting model to create a highly accurate, dynamic baseline of expected network behavior that accounts for seasonality. By comparing observed traffic against this forecast, it can detect subtle, coordinated anomalies across multiple metrics (volume, packet counts, protocol mix) that indicate a complex attack pattern.","Zeek conn.log; Zeek notice.log; Zeek weird.log; Zeek packet_filter.log; Network traffic at the SIS network segment and IDMZ boundaries; Logs from network infrastructure (firewalls, switches) protecting the SIS; Network sensor logs (Zeek conn.log, notice.log) capturing connection state information; Performance and availability monitoring data for SIS PLCs.",last 90 days,"INPUT historical traffic data (volume, packets, protocol distribution) into a multivariate time-series model (e.g., VAR). ALERT if observed metrics consistently deviate from the model's forecasted values beyond a 99% confidence interval for more than 3 minutes.",playbooks/attack/ics/T0880.yml
T0882: Theft of Operational Information,c8a2b3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0105: Impact,n; o; n; e,1,"Have critical ICS assets initiated connections to known malicious domains or domains with suspicious characteristics, or used tunneling protocols for potential data exfiltration?","This question focuses on identifying direct exfiltration attempts by checking for connections from high-value ICS assets to known bad destinations from threat intelligence feeds. It also looks for indicators of covert channels, such as DNS tunneling or connections to newly registered or algorithmically generated domains (high Shannon entropy), which are common tactics for bypassing network security controls.","Zeek conn.log; Zeek dns.log; Zeek files.log; Zeek tunnel.log; OT-to-IT network gateways, ICS firewalls, Engineering Workstations, Data Historians, DMZ segments, internal network segments hosting critical ICS servers, Internet egress points, SCADA network segments.",last 90 days,pseudocode: FOR each IP in critical_asset_watchlist; SEARCH Zeek_conn_log WHERE source_ip=IP AND destination_ip IN threat_intel_feed; SEARCH Zeek_dns_log WHERE source_ip=IP AND (domain_shannon_entropy > 3.5 OR domain_age < 30_days); SEARCH Zeek_tunnel_log WHERE source_ip=IP; ALERT on any match.,playbooks/attack/ics/T0882.yml
T0882: Theft of Operational Information,c8a2b3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0105: Impact,n; o; n; e,2,Has any critical ICS asset exhibited an anomalous spike in outbound data volume or connected to an unusually high number of unique destination ports?,"This question aims to detect bulk data transfer by establishing a baseline of normal network behavior for each critical asset. A significant deviation from this baseline, such as transferring an unusually large amount of data (e.g., exceeding the 99th percentile) or connecting to many different ports in a short period, can be a strong indicator of data staging or exfiltration, even if the destination is not known to be malicious.","Zeek conn.log; Zeek dns.log; Zeek files.log; Zeek tunnel.log; OT-to-IT network gateways, ICS firewalls, Engineering Workstations, Data Historians, DMZ segments, internal network segments hosting critical ICS servers, Internet egress points, SCADA network segments.",last 90 days,pseudocode: FOR each IP in critical_asset_watchlist; CALCULATE 30-day baseline of hourly outbound_bytes AND unique destination_ports from Zeek_conn_log; ALERT IF current_hour_outbound_bytes > 99th_percentile_baseline OR current_hour_unique_ports > (mean_baseline + 3 * std_dev_baseline).,playbooks/attack/ics/T0882.yml
T0882: Theft of Operational Information,c8a2b3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0105: Impact,n; o; n; e,3,"Does the overall network traffic pattern for any critical ICS asset show a significant deviation from historically normal behavior, as identified by a machine learning model?","This question leverages machine learning to identify complex and subtle anomalies that might be missed by simple threshold-based rules. A time-series model (e.g., Isolation Forest, STL) can learn the normal 'rhythm' of an asset's network activity—including data volume, connection duration, and protocol usage—and flag periods that do not conform to this learned pattern, which could indicate sophisticated exfiltration techniques.","Zeek conn.log; Zeek dns.log; Zeek files.log; Zeek tunnel.log; OT-to-IT network gateways, ICS firewalls, Engineering Workstations, Data Historians, DMZ segments, internal network segments hosting critical ICS servers, Internet egress points, SCADA network segments.",last 90 days,"pseudocode: INPUT historical Zeek_conn_log data (bytes, duration, protocols, etc.) for critical assets into time-series anomaly detection model (e.g., Isolation Forest); FEED live Zeek_conn_log data into the trained model; ALERT IF model returns a high anomaly score for any time window.",playbooks/attack/ics/T0882.yml
T0882: Theft of Operational Information,c8a2b3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0105: Impact,n; o; n; e,4,Has an archiving or compression utility been executed on a critical ICS asset with command line arguments targeting sensitive operational files?,"Adversaries often compress and archive data before exfiltration to reduce its size and evade detection. This question directly searches for the use of common archiving tools (like 7z.exe, rar.exe, tar, or PowerShell's Compress-Archive) that are specifically targeting files known to be critical to ICS operations (e.g., .L5K, .ACD, project files, recipes, or design documents).","Windows Event ID 4688; Windows PowerShell Event ID 4104; Windows Event ID 4663; Engineering Workstations, ICS Application Servers, File servers hosting project data, SCADA/HMI servers, Historian servers, PLC programming stations.",last 90 days,"pseudocode: SEARCH WinEvent:4688 OR WinEvent:4104 ON critical_assets; ALERT IF process_name IN (7z.exe, rar.exe, tar, etc.) OR script_block CONTAINS 'Compress-Archive' AND (command_line CONTAINS '.L5K' OR command_line CONTAINS '.ACD' OR command_line CONTAINS 'project').",playbooks/attack/ics/T0882.yml
T0882: Theft of Operational Information,c8a2b3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0105: Impact,n; o; n; e,5,"Has an archiving utility been executed on a critical ICS asset by a user who has never used it on that machine before, or has its usage frequency spiked anomalously?","This question focuses on behavioral anomalies related to user activity. Legitimate engineers may have a regular, predictable pattern of using archiving tools. A user running an archiver for the first time on a specific machine ('first-seen' analysis), or a sudden, dramatic increase in usage beyond a statistical baseline (e.g., 3 standard deviations), are strong indicators that the activity may be part of an adversary's data collection and staging process.","Windows Event ID 4688; Windows PowerShell Event ID 4104; Windows Event ID 4663; Engineering Workstations, ICS Application Servers, File servers hosting project data, SCADA/HMI servers, Historian servers, PLC programming stations.",last 90 days,"pseudocode: BUILD baseline of user-host-process combinations from WinEvent:4688; ALERT IF new execution of an archiving utility is a 'first-seen' user-host-process event; FOR known combinations, CALCULATE daily execution baseline; ALERT IF daily_count > (mean_baseline + 3 * std_dev_baseline).",playbooks/attack/ics/T0882.yml
T0882: Theft of Operational Information,c8a2b3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0105: Impact,n; o; n; e,6,"Does the execution of an archiving utility on a critical ICS asset deviate from normal, learned behavior based on its context (e.g., parent process, user, time of day)?","This question employs a more sophisticated machine learning approach (e.g., One-Class SVM) to detect malicious process execution. The model learns what 'normal' looks like for every process, considering factors like who ran it, what process spawned it, and when it was run. An archiving process spawned by an unusual parent (e.g., a web server process) or run at an odd time would be flagged as anomalous, indicating potential compromise.","Windows Event ID 4688; Windows PowerShell Event ID 4104; Windows Event ID 4663; Engineering Workstations, ICS Application Servers, File servers hosting project data, SCADA/HMI servers, Historian servers, PLC programming stations.",last 90 days,"pseudocode: INPUT historical WinEvent:4688 data (parent process, user, time, command line tokens) into behavioral anomaly detection model (e.g., One-Class SVM); FEED live WinEvent:4688 data into the trained model; ALERT IF model returns a high anomaly score for an archiving process execution.",playbooks/attack/ics/T0882.yml
T0882: Theft of Operational Information,c8a2b3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0105: Impact,n; o; n; e,7,Has a non-authorized user account attempted to read sensitive ICS operational files on a critical file server or workstation?,"This question provides a direct, rule-based check for unauthorized access. By maintaining a list of sensitive file paths/extensions (e.g., *.L5K, *\configs\*.ACD) and a corresponding list of authorized engineering accounts, an alert can be triggered whenever an account outside the approved group attempts to access these protected files. This is a high-fidelity indicator of reconnaissance or data theft.","Windows Event ID 4663; Windows Event ID 4656; File servers containing operational design documents, PLC/HMI project repositories, Engineering Workstations, Historian file shares, SCADA client machines, central configuration management servers.",last 90 days,pseudocode: SEARCH WinEvent:4663 WHERE access_type='ReadData'; ALERT IF file_path IN sensitive_file_watchlist AND user NOT IN authorized_user_list.,playbooks/attack/ics/T0882.yml
T0882: Theft of Operational Information,c8a2b3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0105: Impact,n; o; n; e,8,Has any user accessed an abnormally large number or an unusually diverse variety of sensitive files within a short time frame?,"Adversaries performing 'smash and grab' data theft will often access a large quantity of files in a short period (e.g., 10 minutes). This question establishes a baseline of normal file access behavior for each user. An alert is triggered if a user suddenly accesses far more files than usual (>3 standard deviations from their mean) or if the types of files they access become unusually varied (Shannon entropy of file extensions > 3.0), which can indicate a broad collection effort.","Windows Event ID 4663; Windows Event ID 4656; File servers containing operational design documents, PLC/HMI project repositories, Engineering Workstations, Historian file shares, SCADA client machines, central configuration management servers.",last 90 days,pseudocode: FOR each user; AGGREGATE WinEvent:4663 events in 10-minute windows; CALCULATE baseline of unique_file_count and file_extension_entropy; ALERT IF current_window_count > (mean_count + 3 * std_dev) OR current_window_entropy > (mean_entropy + 3 * std_dev).,playbooks/attack/ics/T0882.yml
T0882: Theft of Operational Information,c8a2b3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0105: Impact,n; o; n; e,9,"Does a user's sequence of file access events deviate from their historically learned patterns of behavior, as determined by a UEBA model?","This is an advanced question, focusing on the *sequence* of actions rather than just the volume. A User and Entity Behavior Analytics (UEBA) model (e.g., HMM or LSTM) can learn a user's typical workflow, such as 'opens project file -> reads configuration files -> accesses library files.' A sequence that violates this learned pattern, such as rapidly accessing files from many different, unrelated projects, would be flagged as highly anomalous and indicative of malicious activity.","Windows Event ID 4663; Windows Event ID 4656; File servers containing operational design documents, PLC/HMI project repositories, Engineering Workstations, Historian file shares, SCADA client machines, central configuration management servers.",last 90 days,"pseudocode: INPUT historical WinEvent:4656/4663 data into a sequence model (e.g., HMM, LSTM) to profile user file access patterns; FEED live file access events into the trained model; ALERT IF the model assigns a low probability to a user's observed sequence of file accesses.",playbooks/attack/ics/T0882.yml
T0883: Internet Accessible Device,9e3b1c7d-8f6a-4b5c-9d1e-2f3a4b5c6d7e,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0108: Initial Access,n; o; n; e,1,"Are there inbound connections from unapproved external IPs to sensitive OT ports that exhibit scanning behavior (e.g., connection rejections, incomplete handshakes, or very short-lived sessions)?","This question aims to detect initial reconnaissance or scanning activity targeting internet-exposed ICS assets. By filtering for connections from non-allowlisted external sources to specific ICS or remote access ports and looking for signs of scanning (rejected states, incomplete handshakes, or brief connections with minimal data transfer), analysts can identify potential precursors to an intrusion attempt. Enriching the source IP with threat intelligence provides additional context on whether the activity originates from a known malicious actor.",Zeek conn.log; Zeek notice.log; Network security monitoring sensors at the IT/OT boundary (Purdue Level 3.5/DMZ); Internet gateway firewalls; Network taps within the supervisory control network (Purdue Level 2); Threat Intelligence Feeds; IP Allowlists,last 90 days,": SEARCH Zeek:conn.log WHERE
source_ip is NOT private AND source_ip is NOT in approved_remote_access_list AND
destination_ip is in OT_network_range AND
destination_port is in [102, 502, 9600, 20000, 44818, 3389, 5900] AND
((connection_state = 'S0' OR connection_state = 'REJ') OR
(connection_state = 'SF' AND duration < 5s AND total_bytes < 100))
ENRICH source_ip with threat_intelligence
ALERT
",playbooks/attack/ics/T0883.yml
T0883: Internet Accessible Device,9e3b1c7d-8f6a-4b5c-9d1e-2f3a4b5c6d7e,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0108: Initial Access,n; o; n; e,2,"Is there a statistical anomaly in the number of unique external IP addresses attempting to connect to specific OT ports, or is a single external IP scanning multiple ports on an OT asset?","This question uses statistical methods to detect more subtle or distributed scanning. By baselining the normal hourly count of unique source IPs per port, a sudden spike exceeding a threshold (like the 99th percentile) can indicate a widespread scan. Additionally, calculating the Shannon entropy of destination ports targeted by a single source IP helps differentiate between a targeted probe and a broad port scan; high entropy suggests an attacker is looking for any open port, a common reconnaissance technique.",Zeek conn.log; Zeek notice.log; Network security monitoring sensors at the IT/OT boundary (Purdue Level 3.5/DMZ); Internet gateway firewalls; Network taps within the supervisory control network (Purdue Level 2),last 90 days,": // Query 1: Volume Anomaly
BASELINE hourly unique source_ip count per destination_port for last 14 days
CALCULATE 99th_percentile threshold
SEARCH Zeek:conn.log WHERE current_hourly_count > threshold
ALERT
// Query 2: Port Scan Entropy
FOR each external source_ip over 1 hour:
CALCULATE Shannon entropy of destination_ports
IF entropy > high_entropy_threshold
ALERT
",playbooks/attack/ics/T0883.yml
T0883: Internet Accessible Device,9e3b1c7d-8f6a-4b5c-9d1e-2f3a4b5c6d7e,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0108: Initial Access,n; o; n; e,3,"Is the overall pattern of inbound connection attempts to the OT network deviating from the established norm, as identified by a machine learning model?","This question leverages advanced machine learning to identify complex, coordinated, or low-and-slow scanning campaigns that might evade simpler rule-based or statistical methods. A time-series anomaly detection model (like an LSTM autoencoder) learns the normal rhythm and volume of inbound traffic, including different connection states. An alert is triggered when the current traffic pattern's reconstruction error is high, signifying a significant deviation that could represent a novel or sophisticated attack.",Zeek conn.log; Zeek notice.log; Network security monitoring sensors at the IT/OT boundary (Purdue Level 3.5/DMZ); Internet gateway firewalls; Network taps within the supervisory control network (Purdue Level 2),last 90 days,": // Model Training (offline)
TRAIN LSTM autoencoder model on 90+ days of hourly aggregated inbound connection data (from Zeek:conn.log), faceted by connection_state
// Real-time Inference
FOR each hour:
FEED current connection data into model
CALCULATE reconstruction_error
IF reconstruction_error > learned_threshold
ALERT
",playbooks/attack/ics/T0883.yml
T0883: Internet Accessible Device,9e3b1c7d-8f6a-4b5c-9d1e-2f3a4b5c6d7e,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0108: Initial Access,n; o; n; e,4,"Is an external IP address generating a high volume of failed remote access logins against an OT asset in a short period, indicating a potential brute-force attack?","This question focuses on detecting classic brute-force attacks by setting a simple, effective threshold. By counting failed logins (Event ID 4625) from a single external IP within a minute, analysts can quickly identify aggressive attempts to guess credentials. Enriching this alert with network protocol details from Zeek (RDP, SSH) and threat intelligence provides crucial context for triage and response.",Windows Event ID 4625; Zeek conn.log; Zeek rdp.log; Zeek ssh.log; Endpoint security logs on internet-facing Windows-based assets in the process control or supervisory networks (Purdue Levels 2-3); Authentication logs from Domain Controllers in the IT/OT DMZ (Purdue Level 3.5); Network security monitoring sensors at the network perimeter; Threat Intelligence Feeds,last 90 days,": SEARCH WindowsEvent:4625 WHERE source_ip is NOT private
AGGREGATE count by source_ip over 60s window
IF count > 5
ENRICH source_ip with threat_intel, Zeek:conn, Zeek:rdp, Zeek:ssh logs
ALERT
",playbooks/attack/ics/T0883.yml
T0883: Internet Accessible Device,9e3b1c7d-8f6a-4b5c-9d1e-2f3a4b5c6d7e,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0108: Initial Access,n; o; n; e,5,"Are we observing a statistically unusual rate of failed logins from an external source, and can we differentiate between a brute-force and a password-spraying attack?","This question uses baselining and entropy calculation to add nuance to failed login detection. A statistical alert based on a deviation from the normal failed login rate can catch slower attacks. Furthermore, analyzing the entropy of targeted usernames from a single source IP is a powerful technique low entropy (many attempts on one or few accounts) points to a brute-force attack, while high entropy (one or few password attempts across many accounts) strongly suggests a password spraying attack.",Windows Event ID 4625; Zeek conn.log; Zeek rdp.log; Zeek ssh.log; Endpoint security logs on internet-facing Windows-based assets in the process control or supervisory networks (Purdue Levels 2-3); Authentication logs from Domain Controllers in the IT/OT DMZ (Purdue Level 3.5); Network security monitoring sensors at the network perimeter,last 90 days,": // Query 1: Rate Anomaly
BASELINE hourly failed login rate (Event 4625) per asset from external IPs for last 14 days
CALCULATE 99th_percentile threshold
SEARCH WindowsEvent:4625 WHERE current_rate > threshold
ALERT
// Query 2: Attack Type Entropy
FOR each source_ip over 5 mins:
CALCULATE Shannon entropy of target_account_name
IF entropy is low, TAG as 'brute-force'
IF entropy is high, TAG as 'password-spray'
ALERT
",playbooks/attack/ics/T0883.yml
T0883: Internet Accessible Device,9e3b1c7d-8f6a-4b5c-9d1e-2f3a4b5c6d7e,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0108: Initial Access,n; o; n; e,6,"Can a machine learning model, trained on various contextual features, proactively classify external failed login attempts as malicious with a high degree of confidence?","This question proposes a sophisticated, proactive approach using a supervised machine learning model. By training a model (like Random Forest) on a rich feature set—including event log details, source IP reputation, geolocation, time of day, and protocol specifics—the system can learn the subtle characteristics of malicious login attempts. This allows for more accurate and automated detection, generating high-confidence alerts that reduce analyst fatigue.",Windows Event ID 4625; Zeek conn.log; Zeek rdp.log; Zeek ssh.log; Endpoint security logs on internet-facing Windows-based assets in the process control or supervisory networks (Purdue Levels 2-3); Authentication logs from Domain Controllers in the IT/OT DMZ (Purdue Level 3.5); Network security monitoring sensors at the network perimeter,last 90 days,": // Model Training (offline)
TRAIN supervised classification model on labeled historical data (Event 4625, Zeek logs, etc.)
// Real-time Inference
FOR each new failed login event (Event 4625) from external IP:
EXTRACT features (Logon Type, Status, IP geo, ASN, time, etc.)
SCORE event with model
IF classification is 'malicious' AND confidence_score > 0.9
ALERT
",playbooks/attack/ics/T0883.yml
T0883: Internet Accessible Device,9e3b1c7d-8f6a-4b5c-9d1e-2f3a4b5c6d7e,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0108: Initial Access,n; o; n; e,7,Has a successful remote login to an OT asset occurred from an external IP address that is not on an approved allowlist?,"This question represents a critical, high-fidelity detection. A successful login from an unapproved source is a major security event and a potential sign of compromise. Using an allowlist, whether per-user or a general corporate list, provides a straightforward and effective way to flag unauthorized access. This is often one of the most important alerts to investigate for initial access.","Windows Event ID 4624; Zeek conn.log; Zeek rdp.log; Zeek ssh.log; Approved Remote Access IP Whitelist; Active Directory Logs; Endpoint security logs on internet-facing Windows-based OT assets; Authentication logs from central servers (Domain Controllers, RADIUS) in the IT/OT DMZ; Identity and Access Management (IAM) system or asset database",last 90 days,": SEARCH WindowsEvent:4624 WHERE
logon_type IN [3, 10] AND
source_ip is NOT private AND
source_ip is NOT in approved_ip_allowlist(target_account_name)
ALERT as HIGH_PRIORITY
",playbooks/attack/ics/T0883.yml
T0883: Internet Accessible Device,9e3b1c7d-8f6a-4b5c-9d1e-2f3a4b5c6d7e,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0108: Initial Access,n; o; n; e,8,"Has a user logged in successfully from a location, network, or at a time that deviates significantly from their established historical behavior?","This question addresses the scenario where an attacker uses legitimate, stolen credentials. Simple allowlists would not catch this. By building a behavioral profile for each user (typical locations, ASNs, login times), the system can calculate a risk score for each new login. A high score, indicating multiple deviations from the norm (e.g., new country AND unusual time), can flag a likely account takeover.","Windows Event ID 4624; Zeek conn.log; Zeek rdp.log; Zeek ssh.log; Approved Remote Access IP Whitelist; Active Directory Logs; Endpoint security logs on internet-facing Windows-based OT assets; Authentication logs from central servers (Domain Controllers, RADIUS) in the IT/OT DMZ; Identity and Access Management (IAM) system or asset database",last 90 days,": // Profile Building (ongoing)
FOR each user, build profile from 90 days of Event 4624: {countries}, {ASNs}, {hours}, {subnets}
// Real-time Scoring
FOR each new login (Event 4624):
risk_score = 0
IF new_login.country NOT in user.profile.countries, risk_score += 3
IF new_login.hour NOT in user.profile.hours, risk_score += 1
IF new_login.subnet NOT in user.profile.subnets, risk_score += 1
IF risk_score > threshold
ALERT
",playbooks/attack/ics/T0883.yml
T0883: Internet Accessible Device,9e3b1c7d-8f6a-4b5c-9d1e-2f3a4b5c6d7e,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0108: Initial Access,n; o; n; e,9,Does a successful login event appear as a statistical anomaly when evaluated by an unsupervised UEBA model that has learned the user's normal behavior?,"This question employs an advanced UEBA approach to detect credential compromise. Unlike simple profiling, an unsupervised model (like Isolation Forest) can learn complex, multi-dimensional patterns of normalcy across many features (login timing, geo-distance, IP reputation, etc.). It can then flag any login that falls outside this learned boundary as an anomaly, capable of detecting sophisticated attacks that might not trigger individual rule-based checks.","Windows Event ID 4624; Zeek conn.log; Zeek rdp.log; Zeek ssh.log; Approved Remote Access IP Whitelist; Active Directory Logs; Endpoint security logs on internet-facing Windows-based OT assets; Authentication logs from central servers (Domain Controllers, RADIUS) in the IT/OT DMZ; Identity and Access Management (IAM) system or asset database",last 90 days,": // Model Training (offline/ongoing)
FOR each user/group, TRAIN unsupervised model (e.g., Isolation Forest) on historical login features (time since last login, geo distance, ASN, etc.)
// Real-time Inference
FOR each new login:
EXTRACT features
SCORE login with model
IF score indicates anomaly
ALERT as HIGH_RISK
",playbooks/attack/ics/T0883.yml
T0883: Internet Accessible Device,9e3b1c7d-8f6a-4b5c-9d1e-2f3a4b5c6d7e,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0108: Initial Access,n; o; n; e,10,"Following a suspicious login, did the user session lead to a process making a network connection to a known command-and-control (C2) server?","This question is designed to rapidly confirm a compromise by linking a suspicious login to clear post-exploitation activity. It uses the anomalous login as a trigger to scrutinize subsequent actions. Correlating a process creation event (Event ID 4688) with an outbound network connection (Zeek conn.log) to a destination on a C2 threat intelligence list provides strong, actionable evidence that the host is compromised and communicating with an attacker.",Zeek conn.log; Zeek dns.log; Windows Event ID 4688; Windows Event ID 5156; Network security monitoring sensors (Zeek) at the ICS perimeter and IT/OT DMZ; Endpoint detection and response (EDR) logs on the source OT asset; DNS server logs; Threat Intelligence Feeds,last 90 days,": ON an 'Anomalous Login' alert for a host:
TRIGGER search for 60 mins post-login:
SEARCH (WindowsEvent:4688 AND Zeek:conn.log) WHERE
host_ip is compromised_host_ip AND
Zeek:conn.log.destination_ip is on C2_threat_intel_list
CORRELATE process_name and connection details
ALERT
",playbooks/attack/ics/T0883.yml
T0883: Internet Accessible Device,9e3b1c7d-8f6a-4b5c-9d1e-2f3a4b5c6d7e,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0108: Initial Access,n; o; n; e,11,"After a suspicious login, is the OT asset exhibiting unusual network behavior, such as connecting to new destinations, using non-standard ports, or transferring abnormal amounts of data?","This question aims to detect post-exploitation activity by baselining the asset's typical network behavior. Even if a destination isn't on a threat list, a deviation from the norm can be a strong indicator of compromise. For example, an HMI that never connects to servers in a new country, suddenly starts sending data there, or an engineer workstation that begins using a port associated with a specific RAT, would be flagged as statistical outliers, warranting investigation.",Zeek conn.log; Zeek dns.log; Windows Event ID 4688; Windows Event ID 5156; Network security monitoring sensors (Zeek) at the ICS perimeter and IT/OT DMZ; Endpoint detection and response (EDR) logs on the source OT asset; DNS server logs,last 90 days,": // Profile Building (ongoing)
FOR each asset, build 30-day baseline of outbound connections: {dest_countries}, {dest_ASNs}, {dest_ports}, {data_transfer_percentiles}
// Real-time Monitoring Post-Alert
ON an 'Anomalous Login' alert for an asset:
FOR each new outbound connection:
IF connection.dest_country is outlier OR
connection.dest_port is outlier OR
connection.bytes_transferred is outlier (e.g., > 99th percentile)
ALERT
",playbooks/attack/ics/T0883.yml
T0883: Internet Accessible Device,9e3b1c7d-8f6a-4b5c-9d1e-2f3a4b5c6d7e,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0108: Initial Access,n; o; n; e,12,"Does the sequence of actions (process creations, DNS lookups, network connections) following a suspicious login deviate from the learned sequence of normal user activity?","This is a highly sophisticated question that looks not just at individual events, but at the story they tell. A sequence analysis model (like an HMM or RNN) learns the typical grammar of user behavior, e.g., ""User opens RDP client, which spawns a specific engineering tool, which connects to an internal data historian."" An attacker's sequence might look very different ""User opens RDP client, which spawns PowerShell, which makes a DNS request to a dynamic DNS domain, which initiates an outbound connection."" The model would flag this sequence as having a low probability of being normal, indicating a likely compromise.",Zeek conn.log; Zeek dns.log; Windows Event ID 4688; Windows Event ID 5156; Network security monitoring sensors (Zeek) at the ICS perimeter and IT/OT DMZ; Endpoint detection and response (EDR) logs on the source OT asset; DNS server logs,last 90 days,": // Model Training (offline)
TRAIN sequence model (HMM/RNN) on typical post-login event sequences (Event 4688 -> Zeek:dns -> Zeek:conn)
// Real-time Inference
ON an 'Anomalous Login' alert:
CAPTURE subsequent event sequence
FEED sequence into model
IF model assigns low probability to sequence
ALERT",playbooks/attack/ics/T0883.yml
T0886: Remote Services,f8a7b6c5-d4e3-4f2a-1b9c-8d7e6f5a4b3c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0108: Initial Access,none,1,Is there a successful remote service connection to a critical OT asset from a source not on the established access allow list?,"An allow list defines authorized remote access patterns (user, source, destination, port). A successful connection that violates this pre-defined policy is a high-fidelity indicator of either a misconfiguration or a potential compromise, as unauthorized entities should not be able to establish sessions with critical assets. This is often a first step in an intrusion.","Data Sources: Zeek conn.log, Zeek rdp.log, Zeek ssh.log, Windows Event ID 4624, Microsoft-Windows-TerminalServices-LocalSessionManager/Operational Event ID 21; Named Areas of Interest: IT/OT Network Perimeter (ICS DMZ), Jump Servers, VPN Concentrators, Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Data Historians, Process Control Networks (PCN).",Last 90 days,"SIEM Pseudocode: | SEARCH successful_logins (e.g., Zeek conn_state='SF', ssh.log auth_success=T, EventID 4624 Logon Type 10) ON ports (22, 3389, 5900) TO critical_ot_assets WHERE (source_ip, user, destination_asset, port) NOT IN remote_access_allow_list",playbooks/attack/ics/T0886.yml
T0886: Remote Services,f8a7b6c5-d4e3-4f2a-1b9c-8d7e6f5a4b3c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0108: Initial Access,none,2,"Has a remote service connection to a critical OT asset exhibited a combination of anomalous characteristics, such as a rare source ASN, unusual login time, or extended session duration?","Adversaries often operate from infrastructure and at times that deviate from normal administrative or maintenance behavior. By baselining normal connection patterns (source locations, time-of-day, duration) and scoring new connections against this baseline, we can flag activity that is statistically unlikely. A connection with multiple anomalous factors has a higher probability of being malicious.","Data Sources: Zeek conn.log, Zeek rdp.log, Zeek ssh.log, Windows Event ID 4624, Microsoft-Windows-TerminalServices-LocalSessionManager/Operational Event ID 21; Named Areas of Interest: IT/OT Network Perimeter (ICS DMZ), Jump Servers, VPN Concentrators, Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Data Historians, Process Control Networks (PCN).",Last 90 days,SIEM Pseudocode: | FOR each new_connection to critical_ot_asset CALCULATE risk_score = 0 IF source_asn is new_or_rare THEN risk_score += 1 IF login_hour is >2_std_dev_from_mean THEN risk_score += 1 IF session_duration is >95th_percentile THEN risk_score += 1 IF risk_score >= 2 THEN ALERT,playbooks/attack/ics/T0886.yml
T0886: Remote Services,f8a7b6c5-d4e3-4f2a-1b9c-8d7e6f5a4b3c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0108: Initial Access,none,3,Has an unsupervised machine learning model identified a remote service session as anomalous based on a rare combination of features?,"While rule-based and statistical methods are effective, they may miss complex, novel attacks. An unsupervised ML model, like an Isolation Forest, can learn the normal multi-dimensional relationships between various session features (e.g., location, time, protocol, asset type, data volume). It can then identify sessions that are anomalous because their combination of feature values is rare and deviates significantly from all known normal patterns.","Data Sources: Zeek conn.log, Zeek rdp.log, Zeek ssh.log, Windows Event ID 4624, Microsoft-Windows-TerminalServices-LocalSessionManager/Operational Event ID 21; Named Areas of Interest: IT/OT Network Perimeter (ICS DMZ), Jump Servers, VPN Concentrators, Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Data Historians, Process Control Networks (PCN).",Last 90 days,"ML Platform Pseudocode: | STREAM remote_session_data FEATURE_ENGINEER (geolocation, on_allow_list, asset_criticality, time_of_day, protocol, bytes_transferred) APPLY trained_isolation_forest_model WHERE anomaly_score > high_threshold THEN ALERT",playbooks/attack/ics/T0886.yml
T0886: Remote Services,f8a7b6c5-d4e3-4f2a-1b9c-8d7e6f5a4b3c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0108: Initial Access,none,4,"Has a brute-force attempt, characterized by a high volume of failed logins from one source, been immediately followed by a successful login from that same source?","This specific sequence of events is a classic and highly reliable indicator of a successful brute-force or password spraying attack. The initial storm of failed logins reveals the attempt, and the subsequent successful login from the same IP address confirms that the attacker has found valid credentials and gained access. Correlating these events is critical for timely detection.","Data Sources: Windows Event ID 4625, Windows Event ID 4624, Zeek conn.log, Zeek ssh.log; Named Areas of Interest: Externally-facing remote access servers, Jump Servers, ICS DMZ, Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Active Directory Domain Controllers within the OT environment.",Last 90 days,"SIEM Correlation Pseudocode: | TRIGGER on ( COUNT(failed_logins, EventID 4625 OR ssh.log auth_success=F) > 20 FROM same source_ip WITHIN 5 minutes ) IF FOLLOWED BY ( COUNT(successful_logins, EventID 4624 OR ssh.log auth_success=T) >= 1 FROM same source_ip TO same destination_group WITHIN 15 minutes ) THEN ALERT",playbooks/attack/ics/T0886.yml
T0886: Remote Services,f8a7b6c5-d4e3-4f2a-1b9c-8d7e6f5a4b3c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0108: Initial Access,none,5,"Is there a source IP exhibiting a failed login rate that exceeds its historical 99th percentile, which is then followed by a successful login?","This is a statistical approach to detecting brute-force attacks that is more adaptive than a fixed threshold. By establishing a baseline of normal failed login rates for each source IP, the system can detect anomalous spikes in failures that are characteristic of an attack. Escalating the alert when a success follows the anomaly adds confirmation that the attack may have been successful, increasing the urgency of the response.","Data Sources: Windows Event ID 4625, Windows Event ID 4624, Zeek conn.log, Zeek ssh.log; Named Areas of Interest: Externally-facing remote access servers, Jump Servers, ICS DMZ, Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Active Directory Domain Controllers within the OT environment.",Last 90 days,SIEM Pseudocode: | MONITOR failed_login_rate per source_ip IF current_rate > 99th_percentile_baseline(source_ip) THEN GENERATE low_priority_alert IF successful_login FROM same_ip occurs WITHIN 30 minutes THEN ESCALATE to high_priority_alert,playbooks/attack/ics/T0886.yml
T0886: Remote Services,f8a7b6c5-d4e3-4f2a-1b9c-8d7e6f5a4b3c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0108: Initial Access,none,6,Has a Hidden Markov Model detected a sequence of login events that transitions from a 'Brute-Force Attack' state to a 'Successful Compromise' state?,"A Hidden Markov Model (HMM) is a sophisticated, state-based approach for detecting attack patterns. It models sequences of events (logins, failures) rather than just counts. By training the model to recognize the probable sequence of an attacker's actions—transitioning from normal behavior to a high-rate 'Brute-Force' state and then to a 'Successful Compromise' state upon a successful login—it can detect the entire attack narrative, providing high-confidence alerts.","Data Sources: Windows Event ID 4625, Windows Event ID 4624, Zeek conn.log, Zeek ssh.log; Named Areas of Interest: Externally-facing remote access servers, Jump Servers, ICS DMZ, Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Active Directory Domain Controllers within the OT environment.",Last 90 days,"ML Platform Pseudocode: | STREAM login_events (success, fail) for each source-destination_pair APPLY trained_hmm_model IF model_state transitions to 'Successful_Compromise' THEN ALERT",playbooks/attack/ics/T0886.yml
T0888: Remote System Information Discovery,a9b8c7d6-e5f4-4a3b-9c2d-1e0f9a8b7c6d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0102: Discovery,n; o; n; e,1,Is an unauthorized source IP address attempting to perform a discovery sweep of our ICS environment?,"This question aims to detect a classic reconnaissance technique where an attacker, from an unknown or unauthorized system, sends discovery protocol requests (e.g., Modbus function code 43, DNP3 Object Group 10) to multiple ICS devices in a short period. This is a strong indicator of an initial foothold or an external threat attempting to map the OT network. The check against a pre-defined whitelist of authorized management systems is crucial for filtering out legitimate administrative activity and identifying truly unauthorized behavior.","Zeek conn.log; Zeek modbus.log; Zeek dnp3.log; Zeek enip.log; Data should be collected from Network Areas of Interest (NAI) such as OT network segments (e.g., Process Control Network VLANs, Safety Instrumented System networks), network traffic aggregation points (e.g., span ports on core switches), Industrial Demilitarized Zone (IDMZ) gateways, and subnets containing SCADA servers, Engineering Workstations, or Data Historians.",last 90 days,: ,playbooks/attack/ics/T0888.yml
T0888: Remote System Information Discovery,a9b8c7d6-e5f4-4a3b-9c2d-1e0f9a8b7c6d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0102: Discovery,n; o; n; e,2,Is an authorized OT management host exhibiting anomalous discovery behavior by contacting an unusually high number of devices?,"This question addresses the scenario where an adversary has compromised a legitimate, authorized system (like an Engineering Workstation) and is using it for internal discovery. By establishing a historical baseline of normal activity for each authorized host (e.g., 95th percentile of discovery requests and unique destinations), we can detect deviations that suggest misuse. Correlating this network anomaly with user login information (Windows Event ID 4624) on the host helps identify the specific user session during which the suspicious activity occurred.","Zeek conn.log; Zeek modbus.log; Zeek dnp3.log; Zeek enip.log; Windows Event ID 4624; Data should be collected from Network Areas of Interest (NAI) such as OT network segments, network traffic aggregation points, IDMZ gateways, and subnets containing SCADA servers, Engineering Workstations, or Data Historians.",last 90 days,: ,playbooks/attack/ics/T0888.yml
T0888: Remote System Information Discovery,a9b8c7d6-e5f4-4a3b-9c2d-1e0f9a8b7c6d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0102: Discovery,n; o; n; e,3,Does the pattern of ICS discovery requests from an authorized host deviate significantly from its learned normal behavior over time?,"This question uses a more advanced, machine learning-based approach to detect subtle or sophisticated misuse of authorized hosts. A time-series anomaly detection model (e.g., Isolation Forest, LSTM) can learn the normal rhythm and volume of discovery activity for each host. This allows it to flag sustained deviations that might not be caught by simple threshold-based statistical methods, potentially indicating a stealthier adversary who is attempting to blend in.","Zeek conn.log; Zeek modbus.log; Zeek dnp3.log; Zeek enip.log; Data should be collected from Network Areas of Interest (NAI) such as OT network segments, network traffic aggregation points, IDMZ gateways, and subnets containing SCADA servers, Engineering Workstations, or Data Historians.",last 90 days,: ,playbooks/attack/ics/T0888.yml
T0888: Remote System Information Discovery,a9b8c7d6-e5f4-4a3b-9c2d-1e0f9a8b7c6d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0102: Discovery,n; o; n; e,4,Has an unapproved process on a critical OT host initiated network connections to multiple ICS devices shortly after its execution?,"This question focuses on detecting malicious tools or scripts running on key OT assets like HMIs or Engineering Workstations. The execution of a process not on the approved software whitelist is inherently suspicious. When this unapproved process immediately begins communicating with multiple ICS devices on standard OT protocol ports (e.g., 502, 20000, 44818), it is a strong indicator of a malicious payload specifically designed for OT reconnaissance or attack. Enriching alerts with user and process context is critical for rapid response.","Windows Event ID 4688 (Process Creation); Windows Event ID 4624 (User Logon); Zeek conn.log; Zeek modbus.log; Zeek dnp3.log; Zeek enip.log; Data should be collected from NAIs such as Engineering Workstations (EWS), Human-Machine Interface (HMI) Workstations, SCADA Servers, Data Historians, and Jump Servers/Bastion Hosts within the IDMZ or OT network segments.",last 90 days,: ,playbooks/attack/ics/T0888.yml
T0888: Remote System Information Discovery,a9b8c7d6-e5f4-4a3b-9c2d-1e0f9a8b7c6d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0102: Discovery,n; o; n; e,5,"Is a process on an OT host, whether whitelisted or not, exhibiting anomalous network scanning behavior shortly after launch?","This question broadens detection to include the misuse of legitimate tools. An adversary may use a whitelisted administrative tool in an abnormal way to perform discovery. This method establishes a baseline of normal network behavior (e.g., 99th percentile of unique IPs contacted) for each whitelisted process. It then flags any whitelisted process that exceeds its specific baseline or any un-whitelisted process that contacts more than a generic threshold of devices, catching both novel malware and 'living off the land' techniques.","Windows Event ID 4688 (Process Creation); Zeek conn.log; Zeek modbus.log; Zeek dnp3.log; Zeek enip.log; Data should be collected from NAIs such as Engineering Workstations (EWS), Human-Machine Interface (HMI) Workstations, SCADA Servers, Data Historians, and Jump Servers/Bastion Hosts.",last 90 days,: ,playbooks/attack/ics/T0888.yml
T0888: Remote System Information Discovery,a9b8c7d6-e5f4-4a3b-9c2d-1e0f9a8b7c6d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0102: Discovery,n; o; n; e,6,Can we classify a newly executed process as malicious discovery based on its initial characteristics and network activity?,"This question proposes a proactive, predictive approach using supervised machine learning. By training a classification model (e.g., Random Forest) on features from historical known-benign and known-malicious discovery events, the system can automatically classify new, unseen process activity. This can provide faster and more accurate alerts than rule-based methods by considering a wider range of features (e.g., parent process, command-line entropy, network connection patterns) in concert to determine malicious intent with a calculated confidence score.","Windows Event ID 4688 (Process Creation); Zeek conn.log; Data should be collected from NAIs such as Engineering Workstations (EWS), Human-Machine Interface (HMI) Workstations, SCADA Servers, Data Historians, and Jump Servers/Bastion Hosts.",last 90 days,: ,playbooks/attack/ics/T0888.yml
T0889: Modify Program,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0110: Persistence,n; o; n; e,1,Has a program modification command been issued from an unauthorized source or outside an approved maintenance window?,"This question seeks to identify potentially malicious program modifications by verifying the legitimacy of the command's origin and timing. An adversary might inject new logic into a controller to disrupt a process or establish persistence. By correlating network logs (Zeek) with allowlists of authorized engineering workstations (EWS) and scheduled maintenance windows, we can filter out legitimate engineering activity and flag suspicious commands that are either from an unknown IP address or occur at an unexpected time.","Zeek s7comm.log; Zeek modbus.log; Zeek enip.log; Zeek conn.log; Windows Event ID 4624; Network traffic sensors at choke points between the enterprise network (Level 4/5) and the process control network (Level 3), taps on EWS subnets (Level 3), and span ports monitoring traffic to and from critical PLCs/controllers (Level 1/2).",last 90 days,": SEARCH Zeek logs (s7comm, modbus, enip) FOR program_modification_commands | JOIN conn.log ON uid | IF source_ip NOT IN authorized_ews_allowlist OR event_timestamp NOT IN maintenance_windows THEN ALERT",playbooks/attack/ics/T0889.yml
T0889: Modify Program,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0110: Persistence,n; o; n; e,2,Is there a statistically unusual increase in the frequency of program modification commands for any controller?,"This question aims to detect anomalous behavior by establishing a baseline of normal activity. Adversaries, or malfunctioning equipment, might cause a sudden burst of program modification commands. By tracking the hourly count of these commands for each controller and comparing it against a historical baseline (e.g., a 30-day rolling average), we can use statistical methods (e.g., standard deviation) to identify significant spikes that warrant investigation, even if the source appears legitimate.","Zeek s7comm.log; Zeek modbus.log; Zeek enip.log; Zeek conn.log; Windows Event ID 4624; Network traffic sensors at choke points between the enterprise network (Level 4/5) and the process control network (Level 3), taps on EWS subnets (Level 3), and span ports monitoring traffic to and from critical PLCs/controllers (Level 1/2).",last 90 days,": FOR each controller_ip: CALCULATE hourly count of modification_commands over last 30 days to create baseline (mean, std_dev) | GET current hourly count | IF current_count > (baseline_mean + 3 * baseline_std_dev) THEN ALERT",playbooks/attack/ics/T0889.yml
T0889: Modify Program,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0110: Persistence,n; o; n; e,3,Does the overall pattern of program modification activity across the network deviate from learned normal behavior?,"This question leverages machine learning to identify complex, subtle anomalies that simple rule-based detections might miss. A sophisticated adversary might try to mimic legitimate activity. A multivariate model (like an LSTM Autoencoder) can learn the intricate relationships between various features, such as the source IP, destination PLC, protocol, and payload size, over time. An alert is triggered when current activity does not conform to these learned legitimate patterns, indicated by a high reconstruction error, suggesting a novel or evasive attack.","Zeek s7comm.log; Zeek modbus.log; Zeek enip.log; Zeek conn.log; Windows Event ID 4624; Network traffic sensors at choke points between the enterprise network (Level 4/5) and the process control network (Level 3), taps on EWS subnets (Level 3), and span ports monitoring traffic to and from critical PLCs/controllers (Level 1/2).",last 90 days,": MODEL = train_lstm_autoencoder(historical_zeek_logs) | FOR each 5-minute_window of live_traffic: a. engineer_features(command_count, unique_sources, unique_dests, protocol, avg_payload) b. calculate_reconstruction_error(MODEL, features) | IF reconstruction_error > threshold THEN ALERT",playbooks/attack/ics/T0889.yml
T0889: Modify Program,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0110: Persistence,n; o; n; e,4,"Has a controller's operational mode been changed (e.g., to 'STOP' or 'PROGRAM') without proper authorization?","This question focuses on detecting unauthorized changes to a controller's operational state. Before a program can be modified, a controller must typically be put into a 'STOP' or 'PROGRAM' mode. This action is a critical precursor to program modification. By cross-referencing mode change commands observed in network traffic with an allowlist of authorized sources and an official change management system, we can identify changes that lack proper approval, which could indicate malicious activity.","Zeek s7comm.log; Zeek enip.log; Zeek dnp3.log; Zeek conn.log; Network interfaces of critical PLCs/Controllers (Level 1/2), Process Control Network (Purdue Level 2/3) monitoring points, network choke points between Level 3 and Level 2, and logs from change management systems.",last 90 days,": SEARCH Zeek logs (s7comm, enip) FOR mode_change_to_STOP/PROGRAM | JOIN conn.log on uid | IF source_ip NOT IN authorized_ews_allowlist OR NOT EXISTS (approved_change_ticket FOR controller_ip, timestamp) THEN ALERT",playbooks/attack/ics/T0889.yml
T0889: Modify Program,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0110: Persistence,n; o; n; e,5,"Has any critical controller spent an unusually long time in a modifiable state (e.g., 'STOP', 'PROGRAM')?","This question aims to detect suspicious activity by monitoring the duration a controller spends in a non-operational, modifiable state. While legitimate maintenance requires placing a controller in 'STOP' or 'PROGRAM' mode, this is usually for a brief, predictable period. An adversary might keep a controller in this state for an extended time while they explore, exfiltrate logic, or perform complex modifications. By baselining the normal daily duration for these states and alerting on significant deviations (e.g., exceeding the 99th percentile), we can flag potentially malicious loitering.","Zeek s7comm.log; Zeek enip.log; Zeek dnp3.log; Zeek conn.log; Network interfaces of critical PLCs/Controllers (Level 1/2), Process Control Network (Purdue Level 2/3) monitoring points, network choke points between Level 3 and Level 2, and logs from change management systems.",last 90 days,: FOR each critical_controller: CALCULATE daily_duration_in_non_RUN_state over last 90 days to create baseline (99th_percentile) | GET duration for last 24 hours | IF current_duration > baseline_99th_percentile THEN ALERT,playbooks/attack/ics/T0889.yml
T0889: Modify Program,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0110: Persistence,n; o; n; e,6,Did a controller state change sequence deviate from the learned legitimate operational workflow?,"This question seeks to identify attacks by analyzing the entire sequence of operations, rather than just individual events. Legitimate engineering tasks follow a predictable pattern (e.g., RUN -> STOP -> DOWNLOAD -> RUN, all from an authorized source). An adversary's actions might break this pattern (e.g., a STOP command from an unknown source, or a STOP command not followed by a RUN). A sequence analysis model, like a Hidden Markov Model (HMM), can learn the valid state transitions and alert when an improbable or invalid sequence occurs, indicating a potential compromise.","Zeek s7comm.log; Zeek enip.log; Zeek dnp3.log; Zeek conn.log; Network interfaces of critical PLCs/Controllers (Level 1/2), Process Control Network (Purdue Level 2/3) monitoring points, network choke points between Level 3 and Level 2, and logs from change management systems.",last 90 days,": MODEL = train_HMM(historical_sequences_of_(controller_ip, state, source_category)) | FOR each new observed_sequence: a. calculate_probability(MODEL, observed_sequence) | IF probability < threshold THEN ALERT",playbooks/attack/ics/T0889.yml
T0889: Modify Program,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0110: Persistence,n; o; n; e,7,"Has an ICS project file been modified, transferred, or created in a way that violates integrity policies?","This question addresses the integrity of the ICS project files themselves, which contain the controller logic. Adversaries may modify these files on an Engineering Workstation (EWS) before deploying them to a controller. This query checks for unauthorized changes by monitoring file systems (using Sysmon for write/delete events) and network transfers (using Zeek). It validates file integrity by comparing file hashes against a 'golden' baseline of approved versions and checking against known-malicious hashes from threat intelligence feeds, alerting on any mismatch or unauthorized activity.","Zeek files.log; Windows Event ID 11 (Sysmon); Windows Event ID 23 (Sysmon); Windows Event ID 4663; Windows Event ID 1 (Sysmon); File systems of Engineering Workstations (EWS) (Level 3), version control systems for ICS projects, centralized log servers, network file transfer inspection points (Level 3), and dedicated ICS integrity monitoring platforms.",last 90 days,": ON file_event (Sysmon write/delete OR Zeek transfer) for ICS_project_file: a. calculate file_hash b. GET source_host, user | IF source_host is unauthorized OR file_hash != golden_baseline_hash OR file_hash IN malicious_hash_list THEN ALERT",playbooks/attack/ics/T0889.yml
T0889: Modify Program,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0110: Persistence,n; o; n; e,8,"Does a transferred ICS project file exhibit unusual characteristics, such as high or low entropy?","This question attempts to identify modified or malicious project files by analyzing their structure, as measured by Shannon entropy. Legitimate project files of a certain type have a predictable range of entropy. An unusually high entropy score might indicate that the file is encrypted or packed, a common obfuscation technique used by attackers. Conversely, an unusually low score could suggest null-padding or other structural anomalies. By baselining normal entropy values for each file type and alerting on outliers, we can flag potentially compromised files for deeper inspection.","Zeek files.log; Windows Event ID 11 (Sysmon); Windows Event ID 23 (Sysmon); Windows Event ID 4663; Windows Event ID 1 (Sysmon); File systems of Engineering Workstations (EWS) (Level 3), version control systems for ICS projects, centralized log servers, network file transfer inspection points (Level 3), and dedicated ICS integrity monitoring platforms.",last 90 days,: FOR each ICS_project_file in Zeek files.log: a. calculate shannon_entropy b. get file_type | GET baseline_entropy_range for file_type | IF shannon_entropy NOT IN baseline_entropy_range THEN ALERT,playbooks/attack/ics/T0889.yml
T0889: Modify Program,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0110: Persistence,n; o; n; e,9,"Based on a combination of host, network, and contextual factors, is a project file modification likely to be unauthorized?","This question uses a machine learning classifier to make a holistic judgment about whether a file modification is legitimate or malicious. Simple rules can be bypassed, but a model like a Random Forest can analyze a wide range of features simultaneously—such as the process that wrote the file, the user account involved, the time of day, network origin, and file entropy. By training on labeled historical data, the model learns the complex characteristics of both authorized and unauthorized changes, allowing it to classify new events with a high degree of confidence and detect sophisticated attacks that might otherwise look normal in isolation.","Zeek files.log; Windows Event ID 11 (Sysmon); Windows Event ID 23 (Sysmon); Windows Event ID 4663; Windows Event ID 1 (Sysmon); File systems of Engineering Workstations (EWS) (Level 3), version control systems for ICS projects, centralized log servers, network file transfer inspection points (Level 3), and dedicated ICS integrity monitoring platforms.",last 90 days,": MODEL = train_random_forest(historical_labeled_events) | FOR each new file_modification_event: a. engineer_features(process, user, time, entropy, source_ip, in_maintenance_window) b. get classification_score(MODEL, features) | IF classification == 'unauthorized' AND score > 0.95 THEN ALERT",playbooks/attack/ics/T0889.yml
T0890: Exploitation for Privilege Escalation,4e8b5d3a-1b7c-4a9e-8c6d-2f0b9a3e1d7f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0111: Privilege Escalation,n; o; n; e,1,"Is a known, high-privilege ICS application spawning a suspicious utility like a command shell or hacking tool?","This question aims to detect a common attack pattern where an adversary, having compromised a legitimate ICS application, uses its elevated privileges to launch system tools for further reconnaissance or lateral movement. Legitimate ICS applications rarely spawn command shells, so such an event is highly suspicious and indicative of post-exploitation activity.","Windows Event ID 4688; Sysmon Event ID 1; Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Historian Servers, and OPC Servers within the Process Control Network (PCN) and Manufacturing Zone (MZ).",last 90 days,": SEARCH process_creation_events (event_id=4688 OR event_id=1)
WHERE parent_process IN (ics_app_allowlist)
AND child_process IN (suspicious_utility_watchlist)
AND (privilege_level='High' OR integrity_level='System')
",playbooks/attack/ics/T0890.yml
T0890: Exploitation for Privilege Escalation,4e8b5d3a-1b7c-4a9e-8c6d-2f0b9a3e1d7f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0111: Privilege Escalation,n; o; n; e,2,Has a new or rare parent-child process relationship appeared on a critical ICS asset?,"This question focuses on detecting novel process behaviors that deviate from an established baseline. Adversaries often introduce new process execution chains that have never been seen before on a specific host. By identifying these first-time occurrences and assessing their rarity across the entire environment, analysts can uncover stealthy exploitation attempts that might not involve known suspicious tools.","Windows Event ID 4688; Sysmon Event ID 1; Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Historian Servers, and OPC Servers within the Process Control Network (PCN) and Manufacturing Zone (MZ).",last 90 days,": FOR each new process_creation_event:
  tuple = (event.parent_process, event.child_process, event.command_line)
  IF tuple IS NOT IN host_baseline(90d):
    rarity = calculate_global_rarity(tuple)
    IF rarity < threshold:
      ALERT (High Priority)
    ELSE:
      ALERT (Medium Priority)
",playbooks/attack/ics/T0890.yml
T0890: Exploitation for Privilege Escalation,4e8b5d3a-1b7c-4a9e-8c6d-2f0b9a3e1d7f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0111: Privilege Escalation,n; o; n; e,3,Does a recent process creation event on an ICS asset register as a statistical anomaly according to a machine learning model?,"This question leverages unsupervised machine learning to find outliers in process creation data. Unlike rule-based methods, ML models can identify complex and subtle deviations across multiple features (e.g., process names, command line length/entropy, user context) that collectively indicate anomalous behavior. This is effective for catching novel or sophisticated attack techniques.","Windows Event ID 4688; Sysmon Event ID 1; Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Historian Servers, and OPC Servers within the Process Control Network (PCN) and Manufacturing Zone (MZ).",last 90 days,": FOR each new process_creation_event:
  features = extract_features(event)
  anomaly_score = model.predict(features)
  IF anomaly_score > anomaly_threshold (e.g., 99th percentile):
    ALERT (High Priority)
",playbooks/attack/ics/T0890.yml
T0890: Exploitation for Privilege Escalation,4e8b5d3a-1b7c-4a9e-8c6d-2f0b9a3e1d7f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0111: Privilege Escalation,n; o; n; e,4,"Has a new service been installed to run with high privileges from an unusual, user-writable directory or using an unapproved executable?","This question looks for adversaries establishing persistence by installing a malicious service. Attackers often place service executables in non-standard directories like Temp or ProgramData to bypass stricter permissions on system folders. By checking for services running as LocalSystem from these locations or using executables not on an allowlist, analysts can detect this common privilege escalation and persistence technique.","Windows Event ID 4697; Windows Event ID 7045; Sysmon Event ID 13; Engineering Workstations (EWS), HMIs, Historian Servers, OPC Servers, and other critical Windows-based ICS infrastructure components within the PCN/MZ.",last 90 days,": SEARCH service_creation_events (event_id=4697 OR event_id=7045)
WHERE service_account IN ('LocalSystem', 'NT AUTHORITY\\SYSTEM')
AND (service_path IN (user_writable_dirs) OR service_executable NOT IN (approved_service_exe_allowlist))
",playbooks/attack/ics/T0890.yml
T0890: Exploitation for Privilege Escalation,4e8b5d3a-1b7c-4a9e-8c6d-2f0b9a3e1d7f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0111: Privilege Escalation,n; o; n; e,5,Does a newly installed service have a randomly generated name or executable filename?,"This question aims to identify services created with randomized names, a technique adversaries use to evade signature-based detections and make their tools harder to track. Legitimate service names are typically descriptive, while malicious ones are often a random string of characters. By measuring the character randomness (entropy) and comparing it to a baseline of normal services, analysts can flag suspicious installations.","Windows Event ID 4697; Windows Event ID 7045; Sysmon Event ID 13; Engineering Workstations (EWS), HMIs, Historian Servers, OPC Servers, and other critical Windows-based ICS infrastructure components within the PCN/MZ.",last 90 days,": FOR each new service_creation_event:
  name_entropy = calculate_shannon_entropy(event.service_name)
  filename_entropy = calculate_shannon_entropy(event.service_filename)
  IF name_entropy > baseline_95th_percentile OR filename_entropy > baseline_95th_percentile:
    ALERT (Medium Priority)
",playbooks/attack/ics/T0890.yml
T0890: Exploitation for Privilege Escalation,4e8b5d3a-1b7c-4a9e-8c6d-2f0b9a3e1d7f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0111: Privilege Escalation,n; o; n; e,6,Does a new service installation exhibit a combination of characteristics deemed malicious by a machine learning classifier?,"This question applies a supervised machine learning model to classify new service installations as benign or malicious. The model is trained to recognize complex patterns across various features, such as file path depth, name entropy, account type, and start type. This provides a more robust and context-aware detection method than simple rules, allowing it to catch sophisticated threats.","Windows Event ID 4697; Windows Event ID 7045; Sysmon Event ID 13; Engineering Workstations (EWS), HMIs, Historian Servers, OPC Servers, and other critical Windows-based ICS infrastructure components within the PCN/MZ.",last 90 days,": FOR each new service_creation_event:
  features = extract_features(event)
  malicious_probability = model.predict_proba(features)
  IF malicious_probability > 0.90:
    ALERT (High Priority)
",playbooks/attack/ics/T0890.yml
T0890: Exploitation for Privilege Escalation,4e8b5d3a-1b7c-4a9e-8c6d-2f0b9a3e1d7f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0111: Privilege Escalation,n; o; n; e,7,"Did a suspicious network event, such as a connection to an unknown external IP or the download of an executable, immediately precede an anomalous process or service creation on an ICS asset?","This question seeks to connect the dots between potential exploit delivery and host-based execution. An adversary often needs to transfer a payload to the target before they can execute it to escalate privileges. By correlating suspicious network activity with subsequent host-based anomalies within a short time window, analysts can build a stronger, higher-fidelity alert that captures multiple stages of the attack chain.","Zeek conn.log; Zeek dns.log; Zeek http.log; Zeek smb_files.log; Zeek files.log; Windows Event ID 4688; Windows Event ID 4697; Windows Event ID 7045; Sysmon Event ID 1; Network segments connecting EWS, HMIs, and servers within the PCN/MZ; industrial demilitarized zones (IDMZ) and network gateways connecting the PCN to enterprise IT networks.",last 90 days,": JOIN by IP address, time window 120s
STREAM A: network_events WHERE (is_suspicious_download OR is_external_untrusted_conn)
STREAM B: host_events WHERE (is_anomalous_process OR is_suspicious_service)
TRIGGER when Stream A is followed by Stream B for same IP
",playbooks/attack/ics/T0890.yml
T0890: Exploitation for Privilege Escalation,4e8b5d3a-1b7c-4a9e-8c6d-2f0b9a3e1d7f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0111: Privilege Escalation,n; o; n; e,8,"Following a rare network event from an ICS asset (e.g., a connection to a first-seen IP or domain), did any other host-based anomaly occur on that same asset shortly after?","This question uses the detection of a rare network behavior as a trigger to scrutinize subsequent host activity more closely. The premise is that communication with a novel external entity is a potential indicator of C2 communication or payload download. By creating a short, heightened monitoring window after such an event, security systems can link the otherwise disparate network and host alerts, providing valuable context that a privilege escalation attempt may be underway.","Zeek conn.log; Zeek dns.log; Zeek http.log; Zeek smb_files.log; Zeek files.log; Windows Event ID 4688; Windows Event ID 4697; Windows Event ID 7045; Sysmon Event ID 1; Network segments connecting EWS, HMIs, and servers within the PCN/MZ; industrial demilitarized zones (IDMZ) and network gateways connecting the PCN to enterprise IT networks.",last 90 days,": FOR each new network_event:
  IF event.destination IS NOT IN host_baseline(90d):
    MONITOR event.source_ip for 120s
    IF high_priority_host_alert occurs on event.source_ip in window:
      CORRELATE and ALERT (High Priority)
",playbooks/attack/ics/T0890.yml
T0890: Exploitation for Privilege Escalation,4e8b5d3a-1b7c-4a9e-8c6d-2f0b9a3e1d7f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0111: Privilege Escalation,n; o; n; e,9,"Has an ICS asset accumulated a high risk score from a combination of lower-confidence alerts related to anomalous processes, services, and network activity?","This question addresses the problem of alert fatigue by aggregating multiple, potentially low-priority signals into a single, high-confidence risk score. Instead of firing separate alerts for a rare process, a suspicious service, and an odd network connection, the RBA framework combines them. When the cumulative risk for a single asset (like an HMI) crosses a threshold, it generates one composite alert, presenting the analyst with a unified view of a potential multi-stage attack.","Zeek conn.log; Zeek dns.log; Zeek http.log; Zeek smb_files.log; Zeek files.log; Windows Event ID 4688; Windows Event ID 4697; Windows Event ID 7045; Sysmon Event ID 1; Network segments connecting EWS, HMIs, and servers within the PCN/MZ; industrial demilitarized zones (IDMZ) and network gateways connecting the PCN to enterprise IT networks.",last 90 days,": FOR each new security_event for an entity:
  entity.risk_score += event.score * event.weight
IF entity.risk_score > critical_threshold within a 5-min window:
  GENERATE composite alert for entity
  RESET entity.risk_score",playbooks/attack/ics/T0890.yml
T0892: Change Credential,9e1a8f9c-7b6d-4c5a-b3d2-e1f0a9b8c7d6,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0107: Inhibit Response Function,n; o; n; e,1,Has monitored ICS engineering software been executed on an Engineering Workstation (EWS) by an unauthorized user account?,"This question aims to detect a clear policy violation. The execution of sensitive ICS software by an account that is not explicitly authorized for that host is a strong indicator of a compromised account or insider threat, representing a significant risk for unauthorized changes like credential modification.","W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 6; 8; 8; ,;  ; W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 6; 2; 4; ,;  ; Z; e; e; k;  ; c; o; n; n; .; l; o; g; ,;  ; E; n; g; i; n; e; e; r; i; n; g;  ; W; o; r; k; s; t; a; t; i; o; n; s;  ; (; E; W; S; ); ,;  ; H; u; m; a; n; -; M; a; c; h; i; n; e;  ; I; n; t; e; r; f; a; c; e; s;  ; (; H; M; I; s; ); ,;  ; A; c; t; i; v; e;  ; D; i; r; e; c; t; o; r; y;  ; S; e; r; v; e; r; s; ,;  ; a; n; d;  ; n; e; t; w; o; r; k;  ; g; a; t; e; w; a; y; s;  ; w; i; t; h; i; n;  ; t; h; e;  ; P; r; o; c; e; s; s;  ; C; o; n; t; r; o; l;  ; N; e; t; w; o; r; k;  ; (; P; C; N; );  ; a; n; d;  ; D; M; Z; .",last 90 days,": SEARCH EventID=4688 AND Host IN (EWS_List) AND ProcessName IN (ICS_Software_List)
WHERE UserName NOT IN (Authorized_User_List_for_Host)
",playbooks/attack/ics/T0892.yml
T0892: Change Credential,9e1a8f9c-7b6d-4c5a-b3d2-e1f0a9b8c7d6,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0107: Inhibit Response Function,n; o; n; e,2,Has an authorized user executed ICS software or logged in remotely to an EWS at an unusual time or from an unapproved network location?,"This question focuses on detecting anomalous behavior from otherwise legitimate accounts. By baselining normal working hours and remote access locations, it can identify when an authorized account might be compromised and used outside of its normal operational pattern, which could be a precursor to malicious activity.","W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 6; 8; 8; ,;  ; W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 6; 2; 4; ,;  ; Z; e; e; k;  ; c; o; n; n; .; l; o; g; ,;  ; E; n; g; i; n; e; e; r; i; n; g;  ; W; o; r; k; s; t; a; t; i; o; n; s;  ; (; E; W; S; ); ,;  ; H; u; m; a; n; -; M; a; c; h; i; n; e;  ; I; n; t; e; r; f; a; c; e; s;  ; (; H; M; I; s; ); ,;  ; A; c; t; i; v; e;  ; D; i; r; e; c; t; o; r; y;  ; S; e; r; v; e; r; s; ,;  ; a; n; d;  ; n; e; t; w; o; r; k;  ; g; a; t; e; w; a; y; s;  ; w; i; t; h; i; n;  ; t; h; e;  ; P; r; o; c; e; s; s;  ; C; o; n; t; r; o; l;  ; N; e; t; w; o; r; k;  ; (; P; C; N; );  ; a; n; d;  ; D; M; Z; .",last 90 days,": // Time Anomaly Query
SEARCH EventID=4688 AND Host IN (EWS_List) AND UserName IN (Authorized_Users)
COMPARE execution_time with user_baseline_profile
ALERT if deviation > 2 * standard_deviation

// Location Anomaly Query
SEARCH EventID=4624 AND LogonType=10 AND Host IN (EWS_List) AND UserName IN (Authorized_Users)
WHERE Source_IP NOT IN (user_baseline_IP_subnets)
",playbooks/attack/ics/T0892.yml
T0892: Change Credential,9e1a8f9c-7b6d-4c5a-b3d2-e1f0a9b8c7d6,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0107: Inhibit Response Function,n; o; n; e,3,"Does machine learning analysis of user, process, time, and network data on EWS hosts reveal activity that significantly deviates from established normal behavior?","This question leverages an unsupervised machine learning model (Isolation Forest) to find complex anomalies that simple rules might miss. By combining multiple features like user, process, time of day, and source IP information, the model can identify subtle, multi-faceted deviations from normal activity patterns, providing a more sophisticated layer of detection for potential threats.","W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 6; 8; 8; ,;  ; W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 6; 2; 4; ,;  ; Z; e; e; k;  ; c; o; n; n; .; l; o; g; ,;  ; E; n; g; i; n; e; e; r; i; n; g;  ; W; o; r; k; s; t; a; t; i; o; n; s;  ; (; E; W; S; ); ,;  ; H; u; m; a; n; -; M; a; c; h; i; n; e;  ; I; n; t; e; r; f; a; c; e; s;  ; (; H; M; I; s; ); ,;  ; A; c; t; i; v; e;  ; D; i; r; e; c; t; o; r; y;  ; S; e; r; v; e; r; s; ,;  ; a; n; d;  ; n; e; t; w; o; r; k;  ; g; a; t; e; w; a; y; s;  ; w; i; t; h; i; n;  ; t; h; e;  ; P; r; o; c; e; s; s;  ; C; o; n; t; r; o; l;  ; N; e; t; w; o; r; k;  ; (; P; C; N; );  ; a; n; d;  ; D; M; Z; .",last 90 days,": // ML Model Inference
INPUT: Real-time stream of (UserID, ProcessName, DayOfWeek, HourOfDay, SourceIP_ASN, SourceIP_Country)
MODEL: Trained Isolation Forest
OUTPUT: Anomaly_Score
ALERT if Anomaly_Score indicates anomaly
",playbooks/attack/ics/T0892.yml
T0892: Change Credential,9e1a8f9c-7b6d-4c5a-b3d2-e1f0a9b8c7d6,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0107: Inhibit Response Function,n; o; n; e,4,"Has network traffic analysis detected specific ICS protocol commands known to modify device credentials, excluding authorized changes during maintenance windows?","This question provides a direct method for detecting credential modification attempts by monitoring for the exact protocol commands used to perform this action (e.g., S7COMM 'Setup Communication', Modbus function 16). By cross-referencing with a change management system, it effectively filters out legitimate administrative activity, reducing false positives and focusing on potentially malicious events.","Z; e; e; k;  ; c; o; n; n; .; l; o; g; ,;  ; Z; e; e; k;  ; s; 7; c; o; m; m; .; l; o; g; ,;  ; Z; e; e; k;  ; m; o; d; b; u; s; .; l; o; g; ,;  ; Z; e; e; k;  ; e; n; i; p; .; l; o; g; ,;  ; N; e; t; w; o; r; k;  ; s; e; g; m; e; n; t; s;  ; w; i; t; h; i; n;  ; t; h; e;  ; P; r; o; c; e; s; s;  ; C; o; n; t; r; o; l;  ; N; e; t; w; o; r; k;  ; (; P; C; N; );  ; w; h; e; r; e;  ; E; n; g; i; n; e; e; r; i; n; g;  ; W; o; r; k; s; t; a; t; i; o; n; s;  ; (; E; W; S; );  ; c; o; m; m; u; n; i; c; a; t; e;  ; w; i; t; h;  ; P; r; o; g; r; a; m; m; a; b; l; e;  ; L; o; g; i; c;  ; C; o; n; t; r; o; l; l; e; r; s;  ; (; P; L; C; s; ); ,;  ; R; e; m; o; t; e;  ; T; e; r; m; i; n; a; l;  ; U; n; i; t; s;  ; (; R; T; U; s; ); ,;  ; o; r;  ; I; n; t; e; l; l; i; g; e; n; t;  ; E; l; e; c; t; r; o; n; i; c;  ; D; e; v; i; c; e; s;  ; (; I; E; D; s; ); ,;  ; i; n; c; l; u; d; i; n; g;  ; n; e; t; w; o; r; k;  ; t; a; p; s;  ; a; t;  ; a; g; g; r; e; g; a; t; i; o; n;  ; s; w; i; t; c; h; e; s;  ; a; n; d;  ; f; i; r; e; w; a; l; l; s;  ; s; e; p; a; r; a; t; i; n; g;  ; t; h; e; s; e;  ; z; o; n; e; s; .",last 90 days,": SEARCH (s7comm.log AND function='Setup Communication' AND has_password_params)
OR (modbus.log AND function_code=16 AND register IN (credential_registers))
OR (enip.log AND command='Set_Attribute_Single' AND class IN (security_classes))
WHERE source_ip NOT IN (authorized_change_ips_for_current_time)
",playbooks/attack/ics/T0892.yml
T0892: Change Credential,9e1a8f9c-7b6d-4c5a-b3d2-e1f0a9b8c7d6,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0107: Inhibit Response Function,n; o; n; e,5,Has a statistically rare credential-modifying ICS command been observed between an EWS and a controller?,"This question focuses on identifying suspicious commands based on their rarity. Credential modification commands are typically infrequent compared to normal operational commands. By baselining the frequency of all commands, the detection of a historically rare but high-impact command strongly suggests an unusual and potentially unauthorized action.","Z; e; e; k;  ; c; o; n; n; .; l; o; g; ,;  ; Z; e; e; k;  ; s; 7; c; o; m; m; .; l; o; g; ,;  ; Z; e; e; k;  ; m; o; d; b; u; s; .; l; o; g; ,;  ; Z; e; e; k;  ; e; n; i; p; .; l; o; g; ,;  ; N; e; t; w; o; r; k;  ; s; e; g; m; e; n; t; s;  ; w; i; t; h; i; n;  ; t; h; e;  ; P; r; o; c; e; s; s;  ; C; o; n; t; r; o; l;  ; N; e; t; w; o; r; k;  ; (; P; C; N; );  ; w; h; e; r; e;  ; E; n; g; i; n; e; e; r; i; n; g;  ; W; o; r; k; s; t; a; t; i; o; n; s;  ; (; E; W; S; );  ; c; o; m; m; u; n; i; c; a; t; e;  ; w; i; t; h;  ; P; r; o; g; r; a; m; m; a; b; l; e;  ; L; o; g; i; c;  ; C; o; n; t; r; o; l; l; e; r; s;  ; (; P; L; C; s; ); ,;  ; R; e; m; o; t; e;  ; T; e; r; m; i; n; a; l;  ; U; n; i; t; s;  ; (; R; T; U; s; ); ,;  ; o; r;  ; I; n; t; e; l; l; i; g; e; n; t;  ; E; l; e; c; t; r; o; n; i; c;  ; D; e; v; i; c; e; s;  ; (; I; E; D; s; ); ,;  ; i; n; c; l; u; d; i; n; g;  ; n; e; t; w; o; r; k;  ; t; a; p; s;  ; a; t;  ; a; g; g; r; e; g; a; t; i; o; n;  ; s; w; i; t; c; h; e; s;  ; a; n; d;  ; f; i; r; e; w; a; l; l; s;  ; s; e; p; a; r; a; t; i; n; g;  ; t; h; e; s; e;  ; z; o; n; e; s; .",last 90 days,": // Baseline (over 30 days)
CALCULATE frequency distribution of all ICS function codes per (source_EWS, dest_controller) pair.
// Real-time check
SEARCH for credential_modifying_function_code
IF frequency_of_code in baseline < 1st_percentile
THEN ALERT
",playbooks/attack/ics/T0892.yml
T0892: Change Credential,9e1a8f9c-7b6d-4c5a-b3d2-e1f0a9b8c7d6,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0107: Inhibit Response Function,n; o; n; e,6,"Has machine learning analysis detected an anomalous change in the complexity or 'rhythm' of ICS command sequences, potentially indicating a credential modification attempt?","This question uses advanced time-series analysis to detect subtle changes in communication patterns. Normal operations have a certain 'rhythm' or complexity, which can be learned by an LSTM autoencoder. A malicious action, like a simple, repetitive credential change attempt, would disrupt this rhythm, leading to a high reconstruction error from the model, thus flagging the activity as anomalous without needing to know the specifics of the command itself.","Z; e; e; k;  ; c; o; n; n; .; l; o; g; ,;  ; Z; e; e; k;  ; s; 7; c; o; m; m; .; l; o; g; ,;  ; Z; e; e; k;  ; m; o; d; b; u; s; .; l; o; g; ,;  ; Z; e; e; k;  ; e; n; i; p; .; l; o; g; ,;  ; N; e; t; w; o; r; k;  ; s; e; g; m; e; n; t; s;  ; w; i; t; h; i; n;  ; t; h; e;  ; P; r; o; c; e; s; s;  ; C; o; n; t; r; o; l;  ; N; e; t; w; o; r; k;  ; (; P; C; N; );  ; w; h; e; r; e;  ; E; n; g; i; n; e; e; r; i; n; g;  ; W; o; r; k; s; t; a; t; i; o; n; s;  ; (; E; W; S; );  ; c; o; m; m; u; n; i; c; a; t; e;  ; w; i; t; h;  ; P; r; o; g; r; a; m; m; a; b; l; e;  ; L; o; g; i; c;  ; C; o; n; t; r; o; l; l; e; r; s;  ; (; P; L; C; s; ); ,;  ; R; e; m; o; t; e;  ; T; e; r; m; i; n; a; l;  ; U; n; i; t; s;  ; (; R; T; U; s; ); ,;  ; o; r;  ; I; n; t; e; l; l; i; g; e; n; t;  ; E; l; e; c; t; r; o; n; i; c;  ; D; e; v; i; c; e; s;  ; (; I; E; D; s; ); ,;  ; i; n; c; l; u; d; i; n; g;  ; n; e; t; w; o; r; k;  ; t; a; p; s;  ; a; t;  ; a; g; g; r; e; g; a; t; i; o; n;  ; s; w; i; t; c; h; e; s;  ; a; n; d;  ; f; i; r; e; w; a; l; l; s;  ; s; e; p; a; r; a; t; i; n; g;  ; t; h; e; s; e;  ; z; o; n; e; s; .",last 90 days,": // Model Inference
INPUT: Time series of Shannon entropy values for ICS function codes in 5-min windows.
MODEL: Trained LSTM Autoencoder
OUTPUT: Reconstruction_Error
ALERT if Reconstruction_Error > 98th_percentile_of_historical_errors
",playbooks/attack/ics/T0892.yml
T0892: Change Credential,9e1a8f9c-7b6d-4c5a-b3d2-e1f0a9b8c7d6,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0107: Inhibit Response Function,n; o; n; e,7,"Has a correlated sequence of events occurred within a 15-minute window: an anomalous remote logon to an EWS, followed by ICS software execution, and then a credential modification command sent to a controller?","This question aims to piece together a full attack chain from disparate log sources. By correlating a suspicious remote login, the subsequent launch of engineering tools, and the final transmission of a credential-changing command, it provides high-fidelity evidence of a complete malicious action, significantly increasing confidence that an attack is underway.","W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 6; 2; 4; ,;  ; W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 6; 8; 8; ,;  ; Z; e; e; k;  ; c; o; n; n; .; l; o; g; ,;  ; Z; e; e; k;  ; s; 7; c; o; m; m; .; l; o; g; ,;  ; Z; e; e; k;  ; m; o; d; b; u; s; .; l; o; g; ,;  ; Z; e; e; k;  ; e; n; i; p; .; l; o; g; ,;  ; E; n; g; i; n; e; e; r; i; n; g;  ; W; o; r; k; s; t; a; t; i; o; n; s;  ; (; E; W; S; ); ,;  ; A; c; t; i; v; e;  ; D; i; r; e; c; t; o; r; y; /; A; u; t; h; e; n; t; i; c; a; t; i; o; n;  ; S; e; r; v; e; r; s; ,;  ; V; P; N;  ; c; o; n; c; e; n; t; r; a; t; o; r; s; ,;  ; a; n; d;  ; n; e; t; w; o; r; k;  ; p; e; r; i; m; e; t; e; r;  ; d; e; v; i; c; e; s;  ; b; e; t; w; e; e; n;  ; t; h; e;  ; I; T;  ; a; n; d;  ; O; T;  ; n; e; t; w; o; r; k; s; .",last 90 days,": SEQUENCE within 15m by UserName, Host
[SEARCH EventID=4624 AND LogonType=10 AND Source_IP NOT IN (Allowlist)] as stage1
[SEARCH EventID=4688 AND ProcessName IN (ICS_Software_List)] as stage2
[SEARCH (s7comm, modbus, or enip logs) for credential_change_command from Host] as stage3
ALERT on completion of sequence
",playbooks/attack/ics/T0892.yml
T0892: Change Credential,9e1a8f9c-7b6d-4c5a-b3d2-e1f0a9b8c7d6,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0107: Inhibit Response Function,n; o; n; e,8,"Has a user's activity sequence (logon, process execution, command) on an EWS generated a composite risk score that is anomalously high compared to historical activity?","This question moves beyond simple correlation to a risk-based scoring approach. By assigning risk values to different aspects of an activity sequence (e.g., rarity of source IP, time of day, process, command) and summing them, it can quantify the overall suspiciousness of a user's actions. This allows for the detection of 'medium-risk' events that in combination represent a high-risk threat.","W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 6; 2; 4; ,;  ; W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 6; 8; 8; ,;  ; Z; e; e; k;  ; c; o; n; n; .; l; o; g; ,;  ; Z; e; e; k;  ; s; 7; c; o; m; m; .; l; o; g; ,;  ; Z; e; e; k;  ; m; o; d; b; u; s; .; l; o; g; ,;  ; Z; e; e; k;  ; e; n; i; p; .; l; o; g; ,;  ; E; n; g; i; n; e; e; r; i; n; g;  ; W; o; r; k; s; t; a; t; i; o; n; s;  ; (; E; W; S; ); ,;  ; A; c; t; i; v; e;  ; D; i; r; e; c; t; o; r; y; /; A; u; t; h; e; n; t; i; c; a; t; i; o; n;  ; S; e; r; v; e; r; s; ,;  ; V; P; N;  ; c; o; n; c; e; n; t; r; a; t; o; r; s; ,;  ; a; n; d;  ; n; e; t; w; o; r; k;  ; p; e; r; i; m; e; t; e; r;  ; d; e; v; i; c; e; s;  ; b; e; t; w; e; e; n;  ; t; h; e;  ; I; T;  ; a; n; d;  ; O; T;  ; n; e; t; w; o; r; k; s; .",last 90 days,": FOR EACH sequence (logon -> process -> command):
  score = (weight1 * risk(source_IP_ASN)) +
          (weight2 * risk(login_time_zscore)) +
          (weight3 * risk(process_rarity)) +
          (weight4 * risk(command_rarity))
ALERT if score > 99th_percentile_of_historical_scores
",playbooks/attack/ics/T0892.yml
T0892: Change Credential,9e1a8f9c-7b6d-4c5a-b3d2-e1f0a9b8c7d6,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0107: Inhibit Response Function,n; o; n; e,9,"Does graph-based analysis of interactions between users, EWS hosts, and controllers reveal anomalous relationships or subgraphs that deviate from learned normal patterns?","This question applies graph analytics and machine learning to model complex relationships within the ICS environment. By representing users, hosts, and controllers as a graph, a GNN can learn the normal 'shape' of interactions. An alert is triggered when a new interaction (e.g., a user who never touches a certain controller suddenly sends it a command) creates a subgraph that deviates significantly from these learned patterns, indicating a potential threat.","W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 6; 2; 4; ,;  ; W; i; n; d; o; w; s;  ; E; v; e; n; t;  ; I; D;  ; 4; 6; 8; 8; ,;  ; Z; e; e; k;  ; c; o; n; n; .; l; o; g; ,;  ; Z; e; e; k;  ; s; 7; c; o; m; m; .; l; o; g; ,;  ; Z; e; e; k;  ; m; o; d; b; u; s; .; l; o; g; ,;  ; Z; e; e; k;  ; e; n; i; p; .; l; o; g; ,;  ; E; n; g; i; n; e; e; r; i; n; g;  ; W; o; r; k; s; t; a; t; i; o; n; s;  ; (; E; W; S; ); ,;  ; A; c; t; i; v; e;  ; D; i; r; e; c; t; o; r; y; /; A; u; t; h; e; n; t; i; c; a; t; i; o; n;  ; S; e; r; v; e; r; s; ,;  ; V; P; N;  ; c; o; n; c; e; n; t; r; a; t; o; r; s; ,;  ; a; n; d;  ; n; e; t; w; o; r; k;  ; p; e; r; i; m; e; t; e; r;  ; d; e; v; i; c; e; s;  ; b; e; t; w; e; e; n;  ; t; h; e;  ; I; T;  ; a; n; d;  ; O; T;  ; n; e; t; w; o; r; k; s; .",last 90 days,": // Model Inference
INPUT: Graph of (User, Host, Controller) nodes and (logs_into, executes, sends_command_to) edges with attributes.
MODEL: Trained Graph Neural Network (GNN)
OUTPUT: Anomaly score for new edges or subgraphs
ALERT if anomaly score is high",playbooks/attack/ics/T0892.yml
T0895: Autorun Image,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; AI Assistant,TA0104: Execution,n; o; n; e,1,"Has a process been executed from a removable device shortly after it was mounted, where the executable is a known threat or is unsigned and associated with an 'autorun.inf' file?","This question addresses a classic adversary technique of using removable media's Autorun/AutoPlay functionality to gain initial execution. By correlating a device insertion event with a subsequent process creation from that same device, analysts can detect this behavior with high confidence. Further checks for known malicious file hashes or the combination of an unsigned executable and an 'autorun.inf' file help to filter out legitimate software installations and focus on high-risk events.","Windows Event ID 4688; Sysmon Event ID 1; Sysmon Event ID 11; Windows System Log Event ID 12; Windows System Log Event ID 1006; Zeek conn.log; Zeek files.log; Physical USB ports on Windows-based Human-Machine Interfaces (HMIs), Engineering Workstations (EWS), data historians, and any servers within the Process Control Network (PCN) or ICS DMZ. Includes endpoints used for device programming or maintenance updates.",last 90 days,"SIEM: JOIN (device_mount_events WHERE event_id IN [12, 1006]) AND (process_creation_events WHERE event_id IN [4688, 1]) ON (hostname) WHERE process_creation_time - device_mount_time <= 30s AND process_path IS ON removable_drive. ALERT IF (process_hash IN threat_intel_feed) OR (process_is_unsigned AND autorun.inf_creation_event_exists_on_same_drive).",playbooks/attack/ics/T0895.yml
T0895: Autorun Image,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; AI Assistant,TA0104: Execution,n; o; n; e,2,Did a process launched from removable media exhibit signs of obfuscation (high filename entropy) and subsequently generate anomalous network traffic?,"Adversaries often use randomized or nonsensical filenames for their malware to evade simple signature-based detections. Calculating the Shannon entropy of a filename provides a mathematical way to measure this randomness. A process with a highly entropic filename originating from removable media is suspicious. If this event is followed by a burst of unusual network activity, such as connections to many new destinations, it strongly indicates malicious activity like command-and-control communication or data staging.","Windows Event ID 4688; Sysmon Event ID 1; Sysmon Event ID 11; Windows System Log Event ID 12; Windows System Log Event ID 1006; Zeek conn.log; Zeek files.log; Physical USB ports on Windows-based Human-Machine Interfaces (HMIs), Engineering Workstations (EWS), data historians, and any servers within the Process Control Network (PCN) or ICS DMZ. Includes endpoints used for device programming or maintenance updates.",last 90 days,"Pseudocode: FOR each process created from removable_media, CALCULATE Shannon entropy of filename. IF entropy > 98th_percentile_baseline_for_host, THEN MONITOR network connections FROM host for 5 minutes. IF count(unique destination_ip:port) > 99th_percentile_baseline, THEN ALERT.",playbooks/attack/ics/T0895.yml
T0895: Autorun Image,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; AI Assistant,TA0104: Execution,n; o; n; e,3,Can machine learning identify malicious processes originating from removable media based on a combination of execution and file characteristics?,"While rule-based detections are effective, they can be brittle. A machine learning model can learn complex, non-linear relationships between various data points to identify suspicious activity that rules might miss. By training a model on features like the parent process, command-line length, file path entropy, and whether the file is signed, it can assign a probabilistic 'malicious' score to new process creations, providing a more nuanced and potentially more robust detection capability for activity originating from removable media.","Windows Event ID 4688; Sysmon Event ID 1; Sysmon Event ID 11; Windows System Log Event ID 12; Windows System Log Event ID 1006; Zeek conn.log; Zeek files.log; Physical USB ports on Windows-based Human-Machine Interfaces (HMIs), Engineering Workstations (EWS), data historians, and any servers within the Process Control Network (PCN) or ICS DMZ. Includes endpoints used for device programming or maintenance updates.",last 90 days,"Pseudocode: FOR each new process_creation_event, EXTRACT features (parent_process, cmd_line_length, path_entropy, is_unsigned, from_removable_media). INPUT features into pre-trained classification model. IF model_prediction_probability > 0.85, THEN ALERT.",playbooks/attack/ics/T0895.yml
T0895: Autorun Image,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; AI Assistant,TA0104: Execution,n; o; n; e,4,"Was a process executed from a newly mounted virtual disk on a VM, which then connected to a known malicious IP address?","This question targets the abuse of virtual disk images (e.g., ISO, VHD) to deliver malware into a virtualized environment, bypassing some network perimeter controls. Correlating the disk attachment event at the hypervisor level with a process creation event inside the guest VM from that new disk provides a clear line of evidence. If that new process then immediately initiates a network connection to an IP address on a threat intelligence blocklist, it is a very high-confidence indicator of compromise.","Hypervisor API logs (e.g., vSphere, Hyper-V); Windows System Log Event ID 15; Windows Event ID 4688; Sysmon Event ID 1; Sysmon Event ID 3; Sysmon Event ID 22; Zeek conn.log; Zeek dns.log; Zeek http.log; Virtualization hosts (hypervisors) managing guest VMs in the ICS DMZ or Process Control Network. Specific targets include virtualized HMIs, EWS, data historians, and domain controllers. Also includes VM templates, golden images, and network egress points monitoring traffic from the virtualization cluster.",last 90 days,"SIEM: JOIN (hypervisor_vdisk_attach_event) AND (guest_os_disk_init_event WHERE event_id=15) AND (guest_process_creation_event WHERE event_id=1) ON (vm_id, time) WHERE time_delta <= 60s. IF created_process initiates network_connection TO destination_ip IN threat_intel_blocklist, THEN ALERT.",playbooks/attack/ics/T0895.yml
T0895: Autorun Image,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; AI Assistant,TA0104: Execution,n; o; n; e,5,"Following execution from a new virtual disk, did a process exhibit anomalous network behavior, such as querying unusual domains or exfiltrating an abnormal amount of data?","When a direct IOC like a blocklisted IP is not present, analysts must look for behavioral anomalies. This question focuses on two key post-exploitation network indicators. First, calculating the Jaccard similarity between newly queried DNS domains and the VM's historical baseline can reveal communication with novel C2 infrastructure. A low similarity score is highly suspicious. Second, a high ratio of outbound to inbound bytes is a classic pattern of data exfiltration. Finding either of these behaviors after a process is run from a new virtual disk warrants immediate investigation.","Hypervisor API logs (e.g., vSphere, Hyper-V); Windows System Log Event ID 15; Windows Event ID 4688; Sysmon Event ID 1; Sysmon Event ID 3; Sysmon Event ID 22; Zeek conn.log; Zeek dns.log; Zeek http.log; Virtualization hosts (hypervisors) managing guest VMs in the ICS DMZ or Process Control Network. Specific targets include virtualized HMIs, EWS, data historians, and domain controllers. Also includes VM templates, golden images, and network egress points monitoring traffic from the virtualization cluster.",last 90 days,"Pseudocode: FOR each process launched from new_vdisk, ANALYZE subsequent DNS queries for 10 min. CALCULATE Jaccard_similarity(new_domains, historical_domains_for_vm). IF score < 0.10, ALERT. ADDITIONALLY, ANALYZE network_flows. IF (outbound_bytes / inbound_bytes) > 95th_percentile_for_vm, THEN ALERT.",playbooks/attack/ics/T0895.yml
T0895: Autorun Image,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; AI Assistant,TA0104: Execution,n; o; n; e,6,Can a multivariate anomaly detection model identify time windows of unusual system activity on critical VMs that coincide with a virtual disk mount event?,"This advanced analytic approach moves beyond single-event correlation to assess the overall state of a system. By feeding multiple metrics—such as process creation counts, network connection rates, and DNS query volumes—into a time-series model like an Isolation Forest, the system can learn a baseline of normal behavior. It can then flag entire time windows (e.g., one minute) that deviate significantly from this norm. Prioritizing anomalous windows that also contain a virtual disk mount event provides analysts with powerful, context-rich alerts that point to a confluence of suspicious activities.","Hypervisor API logs (e.g., vSphere, Hyper-V); Windows System Log Event ID 15; Windows Event ID 4688; Sysmon Event ID 1; Sysmon Event ID 3; Sysmon Event ID 22; Zeek conn.log; Zeek dns.log; Zeek http.log; Virtualization hosts (hypervisors) managing guest VMs in the ICS DMZ or Process Control Network. Specific targets include virtualized HMIs, EWS, data historians, and domain controllers. Also includes VM templates, golden images, and network egress points monitoring traffic from the virtualization cluster.",last 90 days,"Pseudocode: FOR critical_vms, AGGREGATE metrics (process_count, net_conn_count, bytes_sent, unique_dns_count, vdisk_mounted_flag) into 1-min windows. APPLY pre-trained anomaly detection model (e.g., Isolation Forest). IF anomaly_score IS in top 1% AND vdisk_mounted_flag IS true, THEN ALERT.",playbooks/attack/ics/T0895.yml
T1406.002: Software Packing,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0030: Defense Evasion,n; o; n; e,1,Are newly downloaded APKs originating from known malicious sources?,"Monitors network logs for APK file transfers, extracts the source IP and domain, and compares them against threat intelligence feeds. A match indicates a high probability that a device has downloaded a malicious application from a known malware distribution command and control (C2) server, requiring immediate investigation.
",Zeek files.log; Zeek http.log; Zeek conn.log; Zeek dns.log; Windows Sysmon Event ID 11; Network Security Monitoring (NSM) sensor locations monitoring traffic to/from corporate Wi-Fi and VPNs; Mobile Device Management (MDM) / Enterprise Mobility Management (EMM) platform application inventories; Developer workstations and CI/CD build servers,last 90 days,": FOR each file transfer with MIME type 'application/vnd.android.package-archive' in Zeek logs:
  GET source IP and domain.
  CHECK source IP/domain against threat intelligence feed.
  IF match: ALERT with file hash, source, destination.
",playbooks/attack/mobile/T1406.002.yml
T1406.002: Software Packing,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0030: Defense Evasion,n; o; n; e,2,Are any newly observed APKs exhibiting unusually high entropy compared to a baseline of approved applications?,"Establishes a baseline of normal Shannon entropy scores from corporate-approved applications. It then monitors for new APKs and calculates their entropy. An APK with an entropy score significantly higher than the baseline (e.g., above the 95th percentile or a static threshold of 7.5) is flagged. This is a strong indicator of packing or encryption used to hide malicious code.
",Zeek files.log; Zeek http.log; Zeek conn.log; Zeek dns.log; Windows Sysmon Event ID 11; Network Security Monitoring (NSM) sensor locations monitoring traffic to/from corporate Wi-Fi and VPNs; Mobile Device Management (MDM) / Enterprise Mobility Management (EMM) platform application inventories; Developer workstations and CI/CD build servers,last 90 days,": CREATE baseline of Shannon entropy from approved APKs in MDM.
FOR each new APK from network/host logs:
  CALCULATE entropy.
  IF entropy > 95th percentile of baseline OR > 7.5: ALERT for manual review.
",playbooks/attack/mobile/T1406.002.yml
T1406.002: Software Packing,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0030: Defense Evasion,n; o; n; e,3,Can a machine learning model identify high-risk APKs based on a combination of file features and network context?,"This involves developing and deploying a binary classification model trained on features from both benign and malicious APKs. Features include entropy, file size, permissions, and network context (e.g., source ASN, domain age). The model provides a risk score for each new APK, allowing for automated identification and sandboxing of highly suspicious files, improving detection speed and accuracy.
",Zeek files.log; Zeek http.log; Zeek conn.log; Zeek dns.log; Windows Sysmon Event ID 11; Network Security Monitoring (NSM) sensor locations monitoring traffic to/from corporate Wi-Fi and VPNs; Mobile Device Management (MDM) / Enterprise Mobility Management (EMM) platform application inventories; Developer workstations and CI/CD build servers,last 90 days,": FOR each new APK:
  EXTRACT features (entropy, size, permissions, network context).
  APPLY pre-trained ML model to generate risk score.
  IF score > confidence threshold: ALERT and SUBMIT to sandbox.
",playbooks/attack/mobile/T1406.002.yml
T1406.002: Software Packing,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0030: Defense Evasion,n; o; n; e,4,Are any newly observed APKs matching YARA rules for known mobile application packers or obfuscators?,"Integrates a YARA scanner into the analysis pipeline to scan all new APK files against a curated ruleset targeting mobile packers (like UPX, DexProtector) and obfuscation libraries. A positive match is a high-fidelity indicator that the application is packed, which is a common defense evasion technique for malware. This provides a direct and reliable signal for immediate investigation.
","Zeek files.log; Windows Sysmon Event ID 11; File systems on developer and user endpoints; Corporate application repositories and stores; Network file transfer inspection points (e.g., inline sandboxing); Automated malware analysis sandboxes",last 90 days,": FOR each new APK from network/host logs:
  SCAN with YARA ruleset for mobile packers.
  IF match: ALERT with file hash, path, and matched rule name.
",playbooks/attack/mobile/T1406.002.yml
T1406.002: Software Packing,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0030: Defense Evasion,n; o; n; e,5,Do any new APKs contain an anomalous number of unusual executable section names compared to a baseline of approved applications?,"This question aims to detect packers that modify executable section names. It establishes a baseline of common section names from approved applications. New APKs are then analyzed for section names that are rare, randomized, or deviate significantly from the baseline. A high count of such anomalous names suggests the use of a packer and warrants deeper analysis.
","Zeek files.log; Windows Sysmon Event ID 11; File systems on developer and user endpoints; Corporate application repositories and stores; Network file transfer inspection points (e.g., inline sandboxing); Automated malware analysis sandboxes",last 90 days,": CREATE baseline of section names from approved APKs.
FOR each new APK:
  PARSE section names.
  COUNT anomalous names not in baseline.
  IF count > 3 standard deviations from baseline mean: ALERT for analysis.
",playbooks/attack/mobile/T1406.002.yml
T1406.002: Software Packing,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0030: Defense Evasion,n; o; n; e,6,"Has there been a statistically significant spike in the detection of packed software, indicating a potential campaign?","This question involves applying time-series anomaly detection to the frequency of YARA rule matches for software packing. By modeling the normal rhythm of detections, the system can automatically identify unusual spikes that might represent a coordinated attack or a new malware campaign. This shifts the focus from individual alerts to a broader, more proactive threat hunting perspective.
","Zeek files.log; Windows Sysmon Event ID 11; File systems on developer and user endpoints; Corporate application repositories and stores; Network file transfer inspection points (e.g., inline sandboxing); Automated malware analysis sandboxes",last 90 days,": COLLECT time-stamped YARA match counts for packing signatures.
APPLY time-series anomaly detection model.
IF observed count > forecasted confidence interval: ALERT to trigger threat hunt.",playbooks/attack/mobile/T1406.002.yml
T1407: Download New Code at Runtime,e9a3b1c8-4f2d-4e9a-8b1c-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,1,Has a mobile device downloaded a file indicative of executable code from a suspicious destination?,"This question aims to detect the direct download of potentially malicious code. Adversaries often host payloads on newly registered domains or servers with poor reputation to evade blocklists. By correlating network connections with file transfers and enriching this with threat intelligence and domain age data, we can identify high-risk downloads that bypass traditional security controls.","Zeek conn.log; Zeek http.log; Zeek files.log; Zeek ssl.log; Zeek x509.log; Zeek dns.log; Corporate Wi-Fi network segments, VPN concentrators, and cloud-based secure web gateways used by mobile devices.",last 90 days,"JOIN Zeek conn.log with files.log ON session_id. FILTER for source IP in mobile range. ALERT IF (destination in threat_intel_feed OR domain_age < 30_days) AND mime_type IN ('application/java-archive', 'application/x-dex', 'application/x-sharedlib', 'application/octet-stream').",playbooks/attack/mobile/T1407.yml
T1407: Download New Code at Runtime,e9a3b1c8-4f2d-4e9a-8b1c-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,2,"Is a mobile device communicating over a statistically rare or obfuscated channel, potentially to download code?","This question seeks to identify command-and-control (C2) or payload delivery channels that use non-standard TLS clients or obfuscated URIs to hide their activity. A rare JA3/JA3S hash suggests a unique or uncommon client application, while high URI entropy can indicate the use of Domain Generation Algorithms (DGA) or other randomization techniques. The combination is a strong signal of malicious behavior.","Zeek conn.log; Zeek http.log; Zeek ssl.log; Zeek x509.log; Zeek dns.log; Corporate Wi-Fi network segments, VPN concentrators, and cloud-based secure web gateways used by mobile devices.",last 90 days,CALCULATE frequency of JA3/JA3S hashes over 30 days. CALCULATE Shannon entropy for URI path/query. ALERT IF (JA3/JA3S_frequency_percentile < 5) AND (URI_entropy > 4.5).,playbooks/attack/mobile/T1407.yml
T1407: Download New Code at Runtime,e9a3b1c8-4f2d-4e9a-8b1c-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,3,Can a machine learning model identify network sessions highly likely to be malicious dynamic code downloads?,"This question leverages machine learning to build a more sophisticated detection model that can identify complex, non-linear patterns indicative of malicious downloads. By combining multiple features like domain age, threat intelligence, JA3/JA3S rarity, URI entropy, and file characteristics, the model can achieve higher accuracy and reduce false positives compared to simple rule-based alerts.","Zeek conn.log; Zeek http.log; Zeek files.log; Zeek ssl.log; Zeek x509.log; Zeek dns.log; Corporate Wi-Fi network segments, VPN concentrators, and cloud-based secure web gateways used by mobile devices.",last 90 days,"APPLY Random Forest model to new network sessions. FEATURES: domain_age, threat_intel_match, reputation, JA3/JA3S_freq_percentile, URI_entropy, file_mime_type, file_size, cert_validity, cert_issuer. ALERT IF prediction_probability > 0.85.",playbooks/attack/mobile/T1407.yml
T1407: Download New Code at Runtime,e9a3b1c8-4f2d-4e9a-8b1c-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,4,Has an unapproved or known-bad application on an Android device made an API call associated with dynamic code loading?,"This question focuses on detecting the direct execution of dynamically loaded code on Android. Certain API calls are primary indicators of this behavior. By correlating these calls with the application's status (i.e., is it on the corporate allowlist?), we can quickly identify unauthorized and potentially malicious activity and trigger an automated response, like quarantining the device.",Mobile Threat Defense (MTD) API monitoring logs; Mobile Device Management (MDM) Application Inventory Logs; Managed Android mobile devices enrolled in MDM/MTD solutions.,last 90 days,"ON MTD_log_event. FILTER for API_call IN ('dalvik.system.DexClassLoader', 'java.lang.System.load', 'addJavascriptInterface'). JOIN app_package_name with MDM_app_allowlist. ALERT IF app_is_not_allowlisted.",playbooks/attack/mobile/T1407.yml
T1407: Download New Code at Runtime,e9a3b1c8-4f2d-4e9a-8b1c-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,5,Is an application on an Android device exhibiting anomalous behavior by suddenly using or increasing its use of dynamic code loading APIs?,"This question seeks to identify behavioral changes in applications that might indicate compromise or a newly activated malicious feature. A legitimate application might start using these APIs after a malicious update, or an adversary might trigger a dormant feature. Baselining normal behavior and alerting on deviations (first-time use or frequency spikes) helps detect these subtle shifts.",Mobile Threat Defense (MTD) API monitoring logs; Mobile Device Management (MDM) Application Inventory Logs; Managed Android mobile devices enrolled in MDM/MTD solutions.,last 90 days,BASELINE API call counts for dynamic_code_loading_functions per user-app pair over 30 days. ALERT IF (first_time_use_fleet_wide) OR (daily_count > 99th_percentile_of_baseline).,playbooks/attack/mobile/T1407.yml
T1407: Download New Code at Runtime,e9a3b1c8-4f2d-4e9a-8b1c-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,6,"Can an unsupervised machine learning model detect anomalous application behavior on Android, specifically related to dynamic code loading?","This question uses unsupervised anomaly detection to find unknown threats without relying on predefined rules or signatures. By modeling the normal behavior of 'known-good' applications based on features like API call sequences and timing, the model can flag applications that deviate significantly. This is particularly effective for identifying novel malware or sophisticated attacks that blend in with normal activity.",Mobile Threat Defense (MTD) API monitoring logs; Mobile Device Management (MDM) Application Inventory Logs; Managed Android mobile devices enrolled in MDM/MTD solutions.,last 90 days,"APPLY Isolation Forest/LOF model to MTD telemetry streams. FEATURES: API_call_ngrams, time_between_calls, requested_permissions, network_volume. ALERT IF behavior is flagged as anomaly, especially involving dynamic_code_loading_APIs.",playbooks/attack/mobile/T1407.yml
T1407: Download New Code at Runtime,e9a3b1c8-4f2d-4e9a-8b1c-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,7,Has an iOS device connected to a known malicious JSPatch-related domain or has an MTD agent detected the use of a JSPatch function?,JSPatch and similar frameworks are a known vector for bypassing Apple's App Store security controls on iOS. This question aims to detect this activity by either matching network traffic against known malicious infrastructure from threat intelligence feeds or by directly observing the use of JSPatch functions via a Mobile Threat Defense (MTD) agent.,Mobile Threat Defense (MTD) logs; Zeek dns.log; Zeek conn.log; MDM Application Inventory Logs; Managed iOS mobile devices enrolled in MDM/MTD solutions and their associated network traffic.,last 90 days,"JOIN iOS network logs (DNS, conn) with mobile_threat_intel_feed. ALERT ON match. SEPARATELY, ALERT ON MTD_log reporting JSPatch function use in non-allowlisted app.",playbooks/attack/mobile/T1407.yml
T1407: Download New Code at Runtime,e9a3b1c8-4f2d-4e9a-8b1c-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,8,"Is a non-browser application on an iOS device making suspicious DNS queries (high entropy, rare TLD) followed by a significant data download?","This question seeks to identify potential payload delivery to iOS apps through suspicious domains. High entropy in a domain name often indicates algorithmic generation (DGA), a common C2 technique. Similarly, rare TLDs are often abused by attackers. Correlating these suspicious DNS queries from a non-browser app with a subsequent large download is a strong indicator of malicious code being fetched.",Mobile Threat Defense (MTD) logs; Zeek dns.log; Zeek conn.log; MDM Application Inventory Logs; Managed iOS mobile devices enrolled in MDM/MTD solutions and their associated network traffic.,last 90 days,CALCULATE Shannon entropy for new domains from iOS DNS logs. IDENTIFY queries to rare TLDs. ALERT IF (app is not browser) AND (domain_entropy > 4.0 OR TLD is rare) AND (followed by download > 1MB from domain).,playbooks/attack/mobile/T1407.yml
T1407: Download New Code at Runtime,e9a3b1c8-4f2d-4e9a-8b1c-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,9,Is a critical iOS application generating an anomalously high volume of network connections?,"This question uses time-series analysis to baseline the normal network behavior of critical applications and detect significant deviations. A sudden, sustained spike in outbound connections could indicate that an application has been compromised and is being used for C2 communication, data exfiltration, or is downloading additional malicious components. This method can detect suspicious activity even when the destination is not on a known blocklist.",Mobile Threat Defense (MTD) logs; Zeek dns.log; Zeek conn.log; MDM Application Inventory Logs; Managed iOS mobile devices enrolled in MDM/MTD solutions and their associated network traffic.,last 90 days,FORECAST expected hourly network connections for critical apps using SARIMA/Prophet model. ALERT IF actual_connection_volume > 95%_confidence_interval for > 10 minutes.,playbooks/attack/mobile/T1407.yml
T1409: Stored Application Data,1e9a71a3-83fe-4a8b-9c98-71320349c2e0,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0035: Collection,n; o; n; e,1,"Are processes accessing files outside of their own application sandbox in a manner not explicitly allowlisted, or are processes attempting to change directory permissions to be world-readable/writable?","This question seeks to identify classic sandbox escape or data theft techniques on mobile devices. A malicious application might try to read sensitive data (like credentials or tokens) from a legitimate application's private storage. By maintaining an allowlist of known-good inter-app communications and alerting on deviations, we can detect this unauthorized access. Similarly, monitoring for 'chmod 777' or 'chmod 666' on application directories is a strong indicator of an attempt to break down security barriers for easier data access.","Mobile EDR file access audit logs; Mobile EDR process execution logs; MDM compliance violation alerts; Internal application storage directories (e.g., /data/data/ on Android, Application Sandboxes on iOS) on all managed mobile endpoints.",last 90 days,": SEARCH file_events WHERE source_app != target_app AND (source_app, target_path) NOT IN allowlist; SEARCH process_events WHERE command CONTAINS 'chmod 777' OR command CONTAINS 'chmod 666' AND target_path CONTAINS '/data/data/'",playbooks/attack/mobile/T1409.yml
T1409: Stored Application Data,1e9a71a3-83fe-4a8b-9c98-71320349c2e0,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0035: Collection,n; o; n; e,2,"Are managed applications exhibiting anomalous file access patterns, such as accessing a significantly different set of directories than normal or appearing to scan directories?","This question aims to detect more subtle indicators of compromise. Instead of a single, explicitly malicious action, an adversary might use a compromised legitimate application to slowly explore the file system. By baselining normal behavior (which directories an app usually touches) and using a Jaccard index to detect deviations, we can spot this exploration. High Shannon entropy in accessed directory names can also indicate scanning activity, as the process is accessing many different, unrelated paths rather than a few predictable ones.","Mobile EDR file access audit logs; Mobile EDR process execution logs; MDM compliance violation alerts; Internal application storage directories (e.g., /data/data/ on Android, Application Sandboxes on iOS) on all managed mobile endpoints.",last 90 days,": FOR each app, BASELINE normal_directory_access; HOURLY, CALCULATE jaccard_similarity(current_access, baseline); ALERT if similarity < threshold; FOR each process, CALCULATE shannon_entropy(accessed_directories) in 5_min_window; ALERT if entropy > threshold",playbooks/attack/mobile/T1409.yml
T1409: Stored Application Data,1e9a71a3-83fe-4a8b-9c98-71320349c2e0,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0035: Collection,n; o; n; e,3,Can we detect anomalous inter-application file access events using a graph-based model of normal device activity?,"This question proposes a sophisticated, machine-learning-based approach to detecting unauthorized data access. By modeling the entire ecosystem of application interactions as a graph, we can identify rare or entirely new connections (e.g., a game suddenly accessing the corporate email client's data). This method is powerful because it considers the context of the entire system and can flag events that might look benign in isolation but are highly anomalous when viewed as part of the larger interaction graph.","Mobile EDR file access audit logs; Mobile EDR process execution logs; MDM compliance violation alerts; Internal application storage directories (e.g., /data/data/ on Android, Application Sandboxes on iOS) on all managed mobile endpoints.",last 90 days,": BUILD graph with apps as nodes, file_access as edges; TRAIN GCN model on baseline graph; FOR new_file_access_event, SCORE with model; ALERT if anomaly_score > threshold",playbooks/attack/mobile/T1409.yml
T1409: Stored Application Data,1e9a71a3-83fe-4a8b-9c98-71320349c2e0,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0035: Collection,n; o; n; e,4,Are managed mobile devices connecting to known malicious IPs/domains or to newly registered domains?,"This question addresses data exfiltration by looking for connections to suspicious destinations. Adversaries often use command-and-control (C2) servers with known malicious reputations or stand up new infrastructure for specific campaigns. By correlating network connection logs with threat intelligence feeds (known bad IPs/domains) and passive DNS data (newly registered domains), we can quickly identify high-confidence indicators of a compromise.",Zeek conn.log; Zeek dns.log; Zeek intel.log; Passive DNS logs; Corporate Wi-Fi network gateways; VPN concentrators; Cloud Access Security Broker (CASB) egress points,last 90 days,: SEARCH conn_logs FROM mobile_ips; JOIN with threat_intel on destination_ip; JOIN with dns_logs and whois_data; ALERT if destination in threat_intel OR domain_age < 30_days,playbooks/attack/mobile/T1409.yml
T1409: Stored Application Data,1e9a71a3-83fe-4a8b-9c98-71320349c2e0,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0035: Collection,n; o; n; e,5,"Are mobile devices exhibiting anomalous network egress behavior, such as unusually large data uploads, especially when combined with other suspicious characteristics?","This question focuses on detecting data exfiltration through behavioral anomalies, even when the destination isn't known to be malicious. A device suddenly sending a large amount of data is highly suspicious. This suspicion is amplified if the upload is very fast (suggesting a bulk transfer) or if it uses a network service that the device doesn't typically use. This multi-faceted profiling helps reduce false positives from legitimate large transfers.",Zeek conn.log; Zeek dns.log; Zeek intel.log; Passive DNS logs; Corporate Wi-Fi network gateways; VPN concentrators; Cloud Access Security Broker (CASB) egress points,last 90 days,": FOR each device, PROFILE outbound_bytes, duration, services; FOR new_connection, ALERT if outbound_bytes > 99.5th_percentile; INCREASE_PRIORITY if duration < 5th_percentile OR service is new_for_device",playbooks/attack/mobile/T1409.yml
T1409: Stored Application Data,1e9a71a3-83fe-4a8b-9c98-71320349c2e0,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0035: Collection,n; o; n; e,6,Can we use an unsupervised machine learning model to identify any network connection that significantly deviates from a device's established normal behavior?,"This question leverages machine learning to create a comprehensive, multi-dimensional profile of 'normal' for each device's network activity. Models like Isolation Forest can learn complex patterns across many features (data volume, duration, protocol, port, etc.). Any connection that the model flags as an 'outlier' is, by definition, a significant deviation from that device's unique norm, making it a strong candidate for investigation. This is effective at catching novel exfiltration techniques.",Zeek conn.log; Zeek dns.log; Zeek intel.log; Passive DNS logs; Corporate Wi-Fi network gateways; VPN concentrators; Cloud Access Security Broker (CASB) egress points,last 90 days,": FOR each device, TRAIN isolation_forest_model on features (bytes, duration, proto, port, time); FOR new_connection, PREDICT with model; ALERT if prediction is 'outlier'",playbooks/attack/mobile/T1409.yml
T1409: Stored Application Data,1e9a71a3-83fe-4a8b-9c98-71320349c2e0,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0035: Collection,n; o; n; e,7,"Are managed corporate applications writing files with names indicative of sensitive data (e.g., 'backup', 'creds.db') to world-readable external storage locations?","This question targets a common data staging technique where an adversary causes an application to save sensitive information to a location that is easily accessible by other applications, such as the 'Downloads' folder. This is a high-fidelity indicator because legitimate corporate apps should rarely export sensitive data to insecure, public locations. Using a regular expression to match filenames associated with credentials, backups, or exports provides an effective way to detect this activity.","Mobile EDR file write event logs (including process name, file path, and file hash); Mobile DLP file content scan results; Publicly accessible external storage directories on managed mobile devices (e.g., /storage/emulated/0/, /sdcard/, and their subdirectories like Download and Documents).",last 90 days,: SEARCH file_write_events WHERE source_app IN managed_apps AND target_path IN external_storage; ALERT if filename MATCHES regex('backup|creds|password|etc'),playbooks/attack/mobile/T1409.yml
T1409: Stored Application Data,1e9a71a3-83fe-4a8b-9c98-71320349c2e0,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0035: Collection,n; o; n; e,8,"Are managed applications writing an unusually high number of files to external storage, or are the files being written highly entropic, suggesting they are encrypted or compressed?","This question looks for behavioral clues related to data staging. High entropy in a file (like a .txt file that looks like random characters) is a strong sign that the data within is not plain text, but rather encrypted or compressed, which is a common step before exfiltration. A sudden burst of file writes to external storage from an application that normally doesn't do so is also suspicious. Combining these two analytics can help detect an adversary preparing data for exfiltration.","Mobile EDR file write event logs (including process name, file path, and file hash); Mobile DLP file content scan results; Publicly accessible external storage directories on managed mobile devices (e.g., /storage/emulated/0/, /sdcard/, and their subdirectories like Download and Documents).",last 90 days,": ON file_write to external_storage, CALCULATE file_entropy; ALERT if entropy > 99th_percentile_for_filetype; HOURLY, COUNT file_writes_per_app; ALERT if count > 3_std_dev_from_average",playbooks/attack/mobile/T1409.yml
T1409: Stored Application Data,1e9a71a3-83fe-4a8b-9c98-71320349c2e0,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",TA0035: Collection,n; o; n; e,9,"Are managed applications writing files to external storage that contain actual sensitive content, such as PII, credentials, or API keys, as identified by an NLP model?","This is the most direct approach to detecting sensitive data exposure. Instead of relying on file names or entropy as proxies, this question involves inspecting the file content itself using advanced text classification models. A fine-tuned NLP model can identify specific patterns like Social Security Numbers or API keys. A high-confidence detection from such a model is a critical finding, justifying an immediate, automated response like quarantining the device to prevent data loss.","Mobile EDR file write event logs (including process name, file path, and file hash); Mobile DLP file content scan results; Publicly accessible external storage directories on managed mobile devices (e.g., /storage/emulated/0/, /sdcard/, and their subdirectories like Download and Documents).",last 90 days,": ON file_write to external_storage, SEND file_content_sample to NLP_model; IF model_prediction is 'Sensitive' AND confidence > 0.95, CREATE critical_incident AND quarantine_device",playbooks/attack/mobile/T1409.yml
T1418.001: Security Software Discovery,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0032: Discovery,n; o; n; e,1,Is a newly launched application communicating with known malicious domains or using malicious TLS fingerprints?,"This question aims to identify if an application, immediately after its first launch, is establishing network connections to destinations flagged by threat intelligence. Matching DNS queries against known malicious domains and comparing TLS JA3/JA3S hashes against malicious fingerprints can reveal command-and-control (C2) communication or other malicious activity disguised as legitimate traffic.
",Zeek dns.log; Zeek conn.log; MDM/EMM Application Activity Logs; Corporate DNS Resolvers; Network Egress Firewalls; VPN Concentrators; MDM/EMM Platform Servers,last 90 days,": SEARCH MDM/EMM for new app launches.
FOR each launch, SEARCH network logs (Zeek dns.log, ssl.log) within 5 minutes.
JOIN on device IP.
CHECK DNS query against threat intel feeds.
CHECK JA3/JA3S hashes against malicious fingerprint feeds.
ALERT on match.
",playbooks/attack/mobile/T1418.001.yml
T1418.001: Security Software Discovery,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0032: Discovery,n; o; n; e,2,Is a mobile device querying statistically rare or algorithmically generated domains?,"This question focuses on detecting Domain Generation Algorithms (DGAs) and other evasion techniques. Adversaries often use DGAs to create a large number of domains, making blocklisting difficult. A domain that is rarely visited across the enterprise (low prevalence) or has a high degree of randomness (high entropy) is a strong indicator of potential DGA activity and warrants investigation.
",Zeek dns.log; Zeek conn.log; MDM/EMM Application Activity Logs; Corporate DNS Resolvers; Network Egress Firewalls; VPN Concentrators; MDM/EMM Platform Servers,last 90 days,": SEARCH all DNS logs (Zeek dns.log) from mobile subnet for the last 30 days.
CALCULATE prevalence for each queried domain.
FOR new queries, ALERT if prevalence < 1st percentile.
CALCULATE Shannon entropy for the registered domain.
ALERT if entropy > 4.0.
",playbooks/attack/mobile/T1418.001.yml
T1418.001: Security Software Discovery,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0032: Discovery,n; o; n; e,3,Is a newly launched application exhibiting anomalous outbound data transfer volumes that correlate with low-prevalence DNS queries?,"This question seeks to identify data exfiltration by modeling normal network behavior. A sudden, unexpectedly large data transfer shortly after a new application is launched, especially when directed to a rare domain, is highly suspicious. A time-series model can establish a baseline for expected data volume, making significant deviations that exceed a confidence threshold stand out as anomalies requiring investigation.
",Zeek dns.log; Zeek conn.log; MDM/EMM Application Activity Logs; Corporate DNS Resolvers; Network Egress Firewalls; VPN Concentrators; MDM/EMM Platform Servers,last 90 days,": CREATE a time-series model for each device's outbound data volume (Zeek conn.log).
FOR each new app launch, MONITOR outbound data in the next 5 minutes.
IF data transfer > 99% confidence interval AND correlates with a low-prevalence DNS query, ALERT as high-confidence anomaly.
",playbooks/attack/mobile/T1418.001.yml
T1418.001: Security Software Discovery,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0032: Discovery,n; o; n; e,4,Is a mobile application communicating with known C2 servers or using suspicious User-Agents?,"This question aims to detect command-and-control (C2) communication by checking against known indicators. Adversaries often use known malicious infrastructure for C2. Additionally, malware or malicious tools may use generic User-Agents (like curl, Wget, or python-requests) instead of typical mobile browser or app User-Agents, which can be a strong signal of non-standard, potentially malicious activity.
",Zeek http.log; Zeek ssl.log; Zeek conn.log; MDM/EMM Application Inventory Logs; Network Egress Points; Forward Proxies; Cloud Access Security Brokers (CASB); VPN Concentrators,last 90 days,": SEARCH HTTP/S logs (Zeek http.log, ssl.log) from mobile devices.
MATCH `host` and `server_name` against C2 threat intel feeds. ALERT on match.
ALSO, SEARCH for requests with non-browser User-Agents (e.g., 'curl/*', 'Wget/*') not tied to known tools. ALERT on match.
",playbooks/attack/mobile/T1418.001.yml
T1418.001: Security Software Discovery,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0032: Discovery,n; o; n; e,5,"Is a mobile application sending unusually large amounts of data or communicating with new, previously unseen destinations?","This question seeks to identify anomalous behavior by baselining application activity. A sudden, abnormally large HTTP POST request can indicate data exfiltration. Similarly, an application suddenly communicating with a new Server Name Indication (SNI) that it has never contacted before could signify that it has been compromised or is communicating with a new C2 server. Both are deviations from normal behavior.
",Zeek http.log; Zeek ssl.log; Zeek conn.log; MDM/EMM Application Inventory Logs; Network Egress Points; Forward Proxies; Cloud Access Security Brokers (CASB); VPN Concentrators,last 90 days,": FOR each app, CREATE a 30-day baseline of HTTP POST sizes (Zeek http.log) and a list of historical SNIs (Zeek ssl.log).
ALERT if a new POST request size > 99th percentile of its baseline.
ALERT if the request's SNI is not in the app's historical list.
",playbooks/attack/mobile/T1418.001.yml
T1418.001: Security Software Discovery,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0032: Discovery,n; o; n; e,6,Can we detect anomalous HTTP/S sessions from mobile devices using an unsupervised machine learning model?,"This question leverages machine learning to find 'unknown unknowns' in network traffic. An Isolation Forest model can identify outliers in high-dimensional data without relying on predefined rules or signatures. By training it on features like URI length, request size, and the prevalence of the User-Agent and SNI, it can flag the most unusual sessions that deviate from the norm, which may represent novel or evasive adversary techniques.
",Zeek http.log; Zeek ssl.log; Zeek conn.log; MDM/EMM Application Inventory Logs; Network Egress Points; Forward Proxies; Cloud Access Security Brokers (CASB); VPN Concentrators,last 90 days,": TRAIN an Isolation Forest model on features from Zeek logs (http, ssl, conn) for mobile traffic.
FEATURES include: URI length, request body length, User-Agent prevalence, SNI prevalence, TLS version, JA3 hash prevalence.
SCORE all new HTTP/S sessions.
ALERT on the top 0.5% of outlier scores.
",playbooks/attack/mobile/T1418.001.yml
T1418.001: Security Software Discovery,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0032: Discovery,n; o; n; e,7,Is a newly installed application using high-risk permissions or private APIs to enumerate other installed applications?,"This question aims to proactively identify applications that have the capability to discover other software on a device, a key step in security software discovery. The `QUERY_ALL_PACKAGES` permission on Android and the use of private APIs like `LSApplicationWorkspace` on iOS grant this capability. Automatically blocking or alerting on apps with these characteristics, unless explicitly allow-listed, provides a strong preventative control.
",MDM/EMM Application Scan Reports; Mobile Application Vetting Platform Data; Mobile Device Management (MDM) / Enterprise Mobility Management (EMM) Platform; Integrated Mobile Threat Defense (MTD) Solution; Third-party Application Vetting Service,last 90 days,": CONFIGURE MDM/MTD policy to scan new apps.
IF app manifest contains `android.permission.QUERY_ALL_PACKAGES` OR scan detects `LSApplicationWorkspace` API calls, AND app is not on allow-list, THEN ALERT or BLOCK installation.
",playbooks/attack/mobile/T1418.001.yml
T1418.001: Security Software Discovery,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0032: Discovery,n; o; n; e,8,Are there existing applications in our environment with statistically improbable or suspicious combinations of permissions for their category?,"This question focuses on finding dormant or previously unnoticed threats within the existing application inventory. An app in a category like 'Games' has little legitimate reason to need to query all other packages. Identifying such outliers, or finding apps with rare and dangerous combinations of permissions (e.g., querying all packages and recording audio), can uncover potentially malicious applications that evaded initial screening.
",MDM/EMM Application Scan Reports; Mobile Application Vetting Platform Data; Mobile Device Management (MDM) / Enterprise Mobility Management (EMM) Platform; Integrated Mobile Threat Defense (MTD) Solution; Third-party Application Vetting Service,last 90 days,": SCAN entire app inventory.
FOR each app category, CALCULATE prevalence of `QUERY_ALL_PACKAGES` permission.
ALERT on non-security apps with this permission in the bottom 5th percentile.
CALCULATE Jaccard index for permission co-occurrence.
ALERT on improbable combinations (e.g., `QUERY_ALL_PACKAGES` and `RECORD_AUDIO`) below a 1st percentile threshold.
",playbooks/attack/mobile/T1418.001.yml
T1418.001: Security Software Discovery,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0032: Discovery,n; o; n; e,9,Can we use a supervised machine learning model to assign a risk score to mobile applications and automate further analysis?,"This question proposes a more sophisticated, automated vetting process. By training a model (like XGBoost) on various features—such as dangerous permissions, developer reputation, and app store ratings—we can create a holistic risk score. This moves beyond simple rule-based checks. Applications that the model flags as high-risk can be automatically sent to a sandbox for dynamic analysis, focusing analyst attention on the most likely threats.
",MDM/EMM Application Scan Reports; Mobile Application Vetting Platform Data; Mobile Device Management (MDM) / Enterprise Mobility Management (EMM) Platform; Integrated Mobile Threat Defense (MTD) Solution; Third-party Application Vetting Service,last 90 days,": TRAIN a classification model (e.g., XGBoost) on app features (permissions, developer reputation, ratings).
ASSIGN high weight to `QUERY_ALL_PACKAGES` or private API usage.
SCORE all new and existing applications.
IF risk score exceeds threshold, AUTOMATICALLY submit to sandbox for dynamic analysis.",playbooks/attack/mobile/T1418.001.yml
T1422.002: Wi-Fi Discovery,a7b3c9d1-e8f6-4a2b-9c8d-5e3f1a0b7c6d,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0032: Discovery,n; o; n; e,1,Is a non-allow-listed application attempting to query Wi-Fi configurations?,"This question aims to identify unauthorized applications accessing sensitive Wi-Fi configuration APIs like `WifiManager.getConfiguredNetworks()` or `NEHotspotConfigurationManager.fetchConfigurations`. By maintaining an allow-list of known good applications (e.g., system processes, MDM clients), any deviation can be immediately flagged as a high-severity event, indicating a potential attempt by malware or a suspicious application to gather network intelligence.","Mobile Device Management (MDM) API call logs; Mobile Endpoint Detection and Response (EDR) process activity logs; Corporate-managed mobile devices (iOS, Android); Mobile Device Management (MDM) Platform; Mobile EDR Platform",last 90 days,"SIEM Query: SEARCH MDM/EDR logs for Wi-Fi API calls (e.g., getConfiguredNetworks, fetchConfigurations) WHERE the application package name OR code-signing certificate is NOT in the authorized allow-list. TRIGGER high-severity alert.",playbooks/attack/mobile/T1422.002.yml
T1422.002: Wi-Fi Discovery,a7b3c9d1-e8f6-4a2b-9c8d-5e3f1a0b7c6d,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0032: Discovery,n; o; n; e,2,Is any application exhibiting an anomalous frequency of Wi-Fi API calls?,"This question seeks to detect malicious behavior masquerading as normal application activity. Adversaries may repeatedly call Wi-Fi APIs to gather information over time. By establishing a statistical baseline (mean and standard deviation) of API call frequency for each application, we can identify significant outliers ($$ \mu + 3\sigma $$) that suggest an application is behaving unusually, potentially indicating a discovery attempt.","Mobile Device Management (MDM) API call logs; Mobile Endpoint Detection and Response (EDR) process activity logs; Corporate-managed mobile devices (iOS, Android); Mobile Device Management (MDM) Platform; Mobile EDR Platform",last 90 days,"SIEM Query: FOR each application, CALCULATE baseline mean and standard deviation of Wi-Fi API calls per 5-minute window from the last 30 days of logs. SEARCH for current API call counts in a 5-minute window that EXCEED (mean + 3 * standard deviation). TRIGGER medium-severity alert.",playbooks/attack/mobile/T1422.002.yml
T1422.002: Wi-Fi Discovery,a7b3c9d1-e8f6-4a2b-9c8d-5e3f1a0b7c6d,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0032: Discovery,n; o; n; e,3,Can we use machine learning to proactively identify malicious Wi-Fi discovery behavior based on API call patterns?,"This question explores a more advanced, predictive approach. Instead of relying on simple thresholds, it involves training a machine learning model to recognize complex patterns indicative of malicious Wi-Fi discovery. By analyzing features like call frequency, call sequences, application permissions, and install source, the model can classify behavior as 'benign' or 'malicious' in near real-time, providing a higher-fidelity detection mechanism.","Mobile Device Management (MDM) API call logs; Mobile Endpoint Detection and Response (EDR) process activity logs; Corporate-managed mobile devices (iOS, Android); Mobile Device Management (MDM) Platform; Mobile EDR Platform",last 90 days,"ML Model Pseudocode: EXTRACT features (call frequency, API sequence, permissions, install source) from MDM/EDR logs. TRAIN a classifier (e.g., Random Forest) on labeled data. DEPLOY model to score new API call sequences. TRIGGER alert on high-probability malicious classifications.",playbooks/attack/mobile/T1422.002.yml
T1422.002: Wi-Fi Discovery,a7b3c9d1-e8f6-4a2b-9c8d-5e3f1a0b7c6d,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0032: Discovery,n; o; n; e,4,Is a mobile device performing a network address or port scan immediately after joining a new Wi-Fi network?,"This question focuses on identifying reconnaissance activity on the local network. When an adversary's device joins a new network, a common next step is to scan for other live hosts and open ports. Using a tool like Zeek's built-in scan detector, we can flag this behavior and enrich the alert with device-specific information from DHCP logs, providing immediate context about which device is performing the suspicious scan.","Zeek conn.log; Zeek notice.log; Zeek icmp.log; DHCP Server Logs; Zeek weird.log; Corporate and guest Wi-Fi network segments; Network sensors (e.g., Zeek); DHCP servers",last 90 days,SIEM Query: SEARCH Zeek notice.log for 'Scan::Address_Scan' or 'Scan::Port_Scan' events WHERE source IP is in mobile DHCP range. CORRELATE source IP and timestamp with DHCP logs to find hostname/MAC. TRIGGER high-severity alert.,playbooks/attack/mobile/T1422.002.yml
T1422.002: Wi-Fi Discovery,a7b3c9d1-e8f6-4a2b-9c8d-5e3f1a0b7c6d,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0032: Discovery,n; o; n; e,5,Is a mobile device exhibiting statistically anomalous network connection patterns indicative of scanning?,"This question provides a statistical method for detecting network scanning that may evade simple signature-based detectors. By tracking metrics like the count of unique destination IPs, ICMP requests, and the entropy of destination ports within short time windows, we can build a baseline of normal behavior. A device that suddenly exceeds multiple statistical thresholds is highly likely to be engaged in scanning, even if the activity is slow or stealthy.","Zeek conn.log; Zeek notice.log; Zeek icmp.log; DHCP Server Logs; Zeek weird.log; Corporate and guest Wi-Fi network segments; Network sensors (e.g., Zeek); DHCP servers",last 90 days,"SIEM Query: IN 60s windows, CALCULATE for each source IP: distinct destination IPs, distinct ICMP requests, and destination port entropy. COMPARE against 95th percentile baseline. IF two or more metrics exceed baseline, TRIGGER medium-severity alert.",playbooks/attack/mobile/T1422.002.yml
T1422.002: Wi-Fi Discovery,a7b3c9d1-e8f6-4a2b-9c8d-5e3f1a0b7c6d,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0032: Discovery,n; o; n; e,6,Can we use unsupervised machine learning to identify anomalous network scanning activity from mobile devices?,"This question leverages unsupervised learning to find 'needles in a haystack'. Most network traffic is uniform and predictable. By using a clustering algorithm like DBSCAN, normal activity will form a dense cluster, while anomalous activities, like network scanning, will appear as outliers or sparse clusters. This approach can detect novel or previously unseen scanning techniques that don't fit pre-defined rules.","Zeek conn.log; Zeek notice.log; Zeek icmp.log; DHCP Server Logs; Zeek weird.log; Corporate and guest Wi-Fi network segments; Network sensors (e.g., Zeek); DHCP servers",last 90 days,"ML Model Pseudocode: FOR each source IP in 1-min intervals, CREATE feature vectors (byte counts, packet ratios, unique IPs/ports, port entropy). APPLY clustering algorithm (e.g., DBSCAN). TRIGGER alert for devices classified into anomalous, sparse clusters.",playbooks/attack/mobile/T1422.002.yml
T1422.002: Wi-Fi Discovery,a7b3c9d1-e8f6-4a2b-9c8d-5e3f1a0b7c6d,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0032: Discovery,n; o; n; e,7,Did a non-system process access a Wi-Fi credential store and immediately connect to a known malicious domain?,"This question targets a clear-cut case of credential theft and exfiltration. Access to Wi-Fi credential stores (like `/data/misc/wifi/wpa_supplicant.conf` or specific iOS Keychain items) by an unauthorized application is highly suspicious. Correlating this access with an immediate outbound connection to a domain on a threat intelligence feed provides strong evidence of a compromise, warranting a critical alert and immediate investigation.",Mobile EDR file integrity monitoring logs; Mobile EDR process or keychain access logs; Zeek conn.log; Zeek dns.log; Threat Intelligence Platform data; Corporate-managed mobile devices; Network Egress Points (Firewall/Proxy); Internal DNS Resolvers; Mobile EDR Platform; Threat Intelligence Platform,last 90 days,"SIEM Query: ON EDR alert for Wi-Fi credential store access by non-system process, SEARCH network logs for connections from the same device within 5 minutes. IF destination IP/domain is on threat intel feed, TRIGGER critical alert.",playbooks/attack/mobile/T1422.002.yml
T1422.002: Wi-Fi Discovery,a7b3c9d1-e8f6-4a2b-9c8d-5e3f1a0b7c6d,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0032: Discovery,n; o; n; e,8,"Following a credential store access event, did the device connect to a suspicious, low-prevalence, or newly registered domain?","This question helps detect exfiltration to domains that are not yet on threat intelligence feeds. Adversaries often use new or obscure domains for command and control or data exfiltration. By analyzing domain characteristics—such as age, organizational prevalence (how many other devices connect to it), and name entropy—we can identify suspicious destinations and flag potential exfiltration attempts even without a prior malicious indicator.",Mobile EDR file integrity monitoring logs; Mobile EDR process or keychain access logs; Zeek conn.log; Zeek dns.log; Threat Intelligence Platform data; Corporate-managed mobile devices; Network Egress Points (Firewall/Proxy); Internal DNS Resolvers; Mobile EDR Platform; Threat Intelligence Platform,last 90 days,"SIEM Query: ON EDR alert for credential store access, ANALYZE outbound connections in the next 5 minutes. CALCULATE domain prevalence $$ S_p $$, age, and entropy. IF domain is low prevalence ($$ S_p < 0.01 $$), new (< 30 days), or high entropy, TRIGGER high-severity alert.",playbooks/attack/mobile/T1422.002.yml
T1422.002: Wi-Fi Discovery,a7b3c9d1-e8f6-4a2b-9c8d-5e3f1a0b7c6d,technique,2025-10-01,2025-10-01,"Zachary Szewczyk, Ask Sage",TA0032: Discovery,n; o; n; e,9,Can a sequence-aware machine learning model detect the entire chain of Wi-Fi credential theft and exfiltration?,"This question proposes a sophisticated, holistic detection strategy. Instead of looking at isolated events, it involves training a model (like an LSTM) to recognize the entire attack sequence: process start -> credential access -> DNS query -> outbound connection. By analyzing features from the entire event chain, the model can make a high-confidence determination of malicious intent, reducing false positives and detecting complex adversary tradecraft.",Mobile EDR file integrity monitoring logs; Mobile EDR process or keychain access logs; Zeek conn.log; Zeek dns.log; Threat Intelligence Platform data; Corporate-managed mobile devices; Network Egress Points (Firewall/Proxy); Internal DNS Resolvers; Mobile EDR Platform; Threat Intelligence Platform,last 90 days,"ML Model Pseudocode: CREATE event sequences [Process Start -> Credential Access -> DNS Query -> Connection]. ENGINEER features for each step. TRAIN a sequence-aware model (e.g., LSTM) to classify sequences. DEPLOY to score real-time sequences and alert on high-confidence malicious predictions.",playbooks/attack/mobile/T1422.002.yml
T1422: System Network Configuration Discovery,8e7c6f5a-4b3c-4d2e-9a1b-0f8e7d6c5b4a,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",T; A; 0; 0; 3; 2; :;  ; D; i; s; c; o; v; e; r; y,n; o; n; e,1,Has a non-authorized application been granted the 'READ_PRIVILEGED_PHONE_STATE' permission?,"The 'READ_PRIVILEGED_PHONE_STATE' permission provides access to sensitive device identifiers and network state information. An unauthorized application requesting and receiving this permission is a strong indicator of malicious intent, likely to gather device and network information for reconnaissance before further action. This question aims to detect this initial breach of policy by comparing any application granted this permission against a pre-defined allow list.",Mobile Threat Defense (MTD) Application Scan Logs; Mobile Device Management (MDM) Policy Compliance Logs; Zeek conn.log; Corporate-managed Android mobile device fleet; MDM/MTD management servers; Network egress points and VPN concentrators,last 90 days,: SEARCH MDM/MTD logs for event='READ_PRIVILEGED_PHONE_STATE' grant | FILTER package_name NOT IN allow_list | ALERT,playbooks/attack/mobile/T1422.yml
T1422: System Network Configuration Discovery,8e7c6f5a-4b3c-4d2e-9a1b-0f8e7d6c5b4a,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",T; A; 0; 0; 3; 2; :;  ; D; i; s; c; o; v; e; r; y,n; o; n; e,2,"Following a suspicious permission grant, did the device make network connections to rare or previously unseen destinations?","After gaining the capability to discover network information, an adversary's next logical step is to exfiltrate that data or establish a command-and-control (C2) channel. This question investigates the network traffic from a device immediately after a suspicious permission grant. Connections to destinations that are statistically rare or new across the entire mobile fleet are highly suspect and may represent exfiltration or C2 activity.",Mobile Threat Defense (MTD) Application Scan Logs; Mobile Device Management (MDM) Policy Compliance Logs; Zeek conn.log; Corporate-managed Android mobile device fleet; MDM/MTD management servers; Network egress points and VPN concentrators,last 90 days,: SEARCH alerts for non-allowed permission grants | FOREACH alert | SEARCH Zeek conn.log where src_ip=alert.device_ip and time within +/- 15 mins of alert.time | CALCULATE prevalence of dest_ip across all mobile devices in last 30 days | FILTER prevalence < 1% | ALERT,playbooks/attack/mobile/T1422.yml
T1422: System Network Configuration Discovery,8e7c6f5a-4b3c-4d2e-9a1b-0f8e7d6c5b4a,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",T; A; 0; 0; 3; 2; :;  ; D; i; s; c; o; v; e; r; y,n; o; n; e,3,Does an application requesting 'READ_PRIVILEGED_PHONE_STATE' have a high-risk profile based on its metadata and characteristics?,"This question moves beyond simple allow/deny lists to a proactive, risk-based assessment of applications. By training a machine learning model on application metadata (e.g., developer reputation, install source, requested permissions), we can score the risk of any new application requesting sensitive permissions. This helps identify potentially unwanted or novel malicious applications that are not yet on any threat intelligence feed, enabling earlier detection.",Mobile Threat Defense (MTD) Application Scan Logs; Mobile Device Management (MDM) Policy Compliance Logs; Zeek conn.log; Corporate-managed Android mobile device fleet; MDM/MTD management servers; Network egress points and VPN concentrators,last 90 days,": ON new 'READ_PRIVILEGED_PHONE_STATE' request | EXTRACT app features (category, developer, ratings, etc.) | INPUT features into classification model | IF model_risk_score > 0.85 | ESCALATE for analysis",playbooks/attack/mobile/T1422.yml
T1422: System Network Configuration Discovery,8e7c6f5a-4b3c-4d2e-9a1b-0f8e7d6c5b4a,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",T; A; 0; 0; 3; 2; :;  ; D; i; s; c; o; v; e; r; y,n; o; n; e,4,Is a known malicious application making calls to the 'java.net.NetworkInterface' API?,"The 'java.net.NetworkInterface' API is a primary method for applications on Android to enumerate network interfaces and discover their configurations (IP addresses, MAC addresses, etc.). When an application known to be malicious (based on threat intelligence feeds) is observed making these calls, it is a high-confidence indicator of active network reconnaissance on the compromised device.","Mobile EDR/MTD API Call Monitoring Logs; Zeek conn.log; Mobile devices with EDR/MTD agents installed, especially those used by high-value targets; EDR/MTD management servers; Network traffic monitoring points",last 90 days,: SEARCH MTD API logs for api_call='java.net.NetworkInterface' | JOIN app_package_name with threat_intel_feed | IF match_found | ALERT,playbooks/attack/mobile/T1422.yml
T1422: System Network Configuration Discovery,8e7c6f5a-4b3c-4d2e-9a1b-0f8e7d6c5b4a,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",T; A; 0; 0; 3; 2; :;  ; D; i; s; c; o; v; e; r; y,n; o; n; e,5,Has any application exhibited an anomalous spike in 'java.net.NetworkInterface' API calls compared to its own historical behavior?,"This question seeks to identify behavioral anomalies that could indicate a compromised or malicious application, even if it is not on a known-bad list. While some legitimate applications may use the 'java.net.NetworkInterface' API, a sudden, high-frequency burst of calls is abnormal. By baselining the typical call frequency for each application, we can detect significant deviations that suggest a hidden malicious function has been activated for network discovery.","Mobile EDR/MTD API Call Monitoring Logs; Zeek conn.log; Mobile devices with EDR/MTD agents installed, especially those used by high-value targets; EDR/MTD management servers; Network traffic monitoring points",last 90 days,": SEARCH MTD API logs for api_call='java.net.NetworkInterface' | AGGREGATE count by app, device, 1_minute_interval | COMPARE count to 30-day rolling baseline (mean, stddev) for that app | IF count > (mean + 3*stddev) | ALERT",playbooks/attack/mobile/T1422.yml
T1422: System Network Configuration Discovery,8e7c6f5a-4b3c-4d2e-9a1b-0f8e7d6c5b4a,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",T; A; 0; 0; 3; 2; :;  ; D; i; s; c; o; v; e; r; y,n; o; n; e,6,"For critical applications or users, has the pattern of 'java.net.NetworkInterface' API calls deviated significantly from its normal, learned temporal behavior?","This question applies advanced anomaly detection for high-value assets. A time-series model, such as an LSTM autoencoder, can learn the complex, time-dependent patterns of normal API call behavior, including regular fluctuations. A high reconstruction error from the model indicates that the current activity does not fit the learned normal pattern. This method can detect sophisticated or subtle anomalies that simpler statistical thresholds might miss, providing a higher-fidelity signal for critical assets.","Mobile EDR/MTD API Call Monitoring Logs; Zeek conn.log; Mobile devices with EDR/MTD agents installed, especially those used by high-value targets; EDR/MTD management servers; Network traffic monitoring points",last 90 days,: STREAM 'java.net.NetworkInterface' API call frequency data into LSTM autoencoder model | CALCULATE reconstruction_error | IF reconstruction_error > dynamic_threshold | ALERT,playbooks/attack/mobile/T1422.yml
T1422: System Network Configuration Discovery,8e7c6f5a-4b3c-4d2e-9a1b-0f8e7d6c5b4a,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",T; A; 0; 0; 3; 2; :;  ; D; i; s; c; o; v; e; r; y,n; o; n; e,7,"Shortly after a new application was installed, did the device connect to a destination listed on a threat intelligence feed?","Malicious applications frequently 'phone home' to a command-and-control (C2) server immediately after installation to receive instructions or exfiltrate initial data. This question establishes a direct, time-based correlation between a new application installation and a network connection to a known-malicious destination. A match provides a high-confidence indicator of a device compromise.","Zeek dns.log; Zeek conn.log; MDM/MTD Application Install Logs; Organization's network egress points (e.g., internet gateway, VPN concentrators); DNS resolvers; MDM management servers",last 90 days,: SEARCH MDM/MTD install logs for new app installs | FOREACH install | SEARCH network logs where src_ip=install.device_ip and time within 5 mins of install.time | JOIN dest_ip/domain with threat_intel_feed | IF match_found | ALERT,playbooks/attack/mobile/T1422.yml
T1422: System Network Configuration Discovery,8e7c6f5a-4b3c-4d2e-9a1b-0f8e7d6c5b4a,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",T; A; 0; 0; 3; 2; :;  ; D; i; s; c; o; v; e; r; y,n; o; n; e,8,"Following a new app install, did the device connect to a destination with a high-entropy domain name and a low-prevalence IP address?","This question hunts for signs of algorithmically generated C2 infrastructure. High-entropy (random-looking) domain names are a hallmark of Domain Generation Algorithms (DGAs), used by malware to evade blacklists. Low-prevalence IP addresses are destinations rarely, if ever, visited by other devices in the organization. The combination of both indicators in a connection made shortly after a new app installation is highly suspicious and points to novel C2 communication.","Zeek dns.log; Zeek conn.log; MDM/MTD Application Install Logs; Organization's network egress points (e.g., internet gateway, VPN concentrators); DNS resolvers; MDM management servers",last 90 days,: SEARCH MDM/MTD install logs | FOREACH install | SEARCH DNS/network logs within 5 mins | CALCULATE entropy of domain_name and prevalence of dest_ip | IF domain_entropy > 3.5 AND ip_prevalence < 1% | ALERT,playbooks/attack/mobile/T1422.yml
T1422: System Network Configuration Discovery,8e7c6f5a-4b3c-4d2e-9a1b-0f8e7d6c5b4a,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",T; A; 0; 0; 3; 2; :;  ; D; i; s; c; o; v; e; r; y,n; o; n; e,9,Are there any network connections from mobile devices that are statistical outliers compared to the fleet's normal network behavior patterns?,"This question uses unsupervised machine learning to find anomalous network activity without relying on pre-defined signatures or rules. By clustering the vast majority of 'normal' network connections based on features like port, protocol, and data volume, any connection that does not fit into a cluster is flagged as an outlier. These outliers represent anomalous network patterns that could indicate novel C2 channels or data exfiltration techniques that other methods would miss.","Zeek dns.log; Zeek conn.log; MDM/MTD Application Install Logs; Organization's network egress points (e.g., internet gateway, VPN concentrators); DNS resolvers; MDM management servers",last 90 days,": PROCESS network logs for mobile fleet | CREATE feature vectors (port, proto, duration, bytes) | APPLY DBSCAN clustering algorithm | IDENTIFY outlier connections (classified as noise) | ALERT on outliers",playbooks/attack/mobile/T1422.yml
T1429: Audio Capture,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0035: Collection,n; o; n; e,1,Is a mobile application activating the microphone while in the background and immediately communicating with a known malicious destination?,"This question aims to detect a classic spyware pattern: surreptitious audio recording followed by exfiltration to an adversary-controlled server. By correlating microphone activation events from MDM/MTD with network logs and threat intelligence within a tight 60-second window, analysts can identify high-confidence malicious activity that warrants immediate investigation.","MDM/MTD API Event Logs (Microphone Access, App State); Zeek conn.log; Zeek dns.log; Threat Intelligence Feeds (C2 domains/IPs); Managed mobile device fleet (both corporate-owned and BYOD); Mobile Device Management (MDM) and Mobile Threat Defense (MTD) servers; Network egress points capturing traffic from mobile device subnets",last 90 days,": SEARCH (MDM logs for 'mic_activation' AND 'app_background')
JOIN by device_id with (Network logs)
WHERE time_diff(network_event, mdm_event) < 60s
AND network_log.destination IN (Threat_Intel_Feed)
GROUP by device_id, app_name
",playbooks/attack/mobile/T1429.yml
T1429: Audio Capture,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0035: Collection,n; o; n; e,2,"Is an application exhibiting anomalous background behavior by using the microphone for an unusual duration, sending an unusually large amount of data, or connecting to a new geographic location?","This question focuses on detecting deviations from normal behavior. Even if an application's network destination isn't on a known threat list, a sudden change in its behavior can indicate a compromise or a newly activated malicious feature. By establishing a 30-day baseline for each app, analysts can use statistical methods to flag outliers that represent potential threats.","MDM/MTD API Event Logs (Microphone Access, App State); Zeek conn.log; Managed mobile device fleet (both corporate-owned and BYOD); Mobile Device Management (MDM) and Mobile Threat Defense (MTD) servers; Network egress points capturing traffic from mobile device subnets",last 90 days,": // Baseline Generation (run periodically)
CALCULATE 95th_percentile(mic_duration) per app_name over 30 days
CALCULATE 95th_percentile(bytes_sent) per app_name over 30 days
LIST unique(destination_country) per app_name over 30 days

// Alerting Query
SEARCH (MDM logs for 'mic_activation' AND 'app_background')
JOIN by device_id with (Network logs)
WHERE mic_duration > baseline_mic_duration_95p
AND (bytes_sent > baseline_bytes_sent_95p OR destination_country NOT IN baseline_countries)
",playbooks/attack/mobile/T1429.yml
T1429: Audio Capture,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0035: Collection,n; o; n; e,3,"Are there sequences of device events (like microphone use, app state changes, and network connections) that are statistically rare and deviate from learned normal behavior patterns?","This question leverages machine learning (e.g., an LSTM autoencoder) to identify complex, multi-event patterns that simple correlation rules might miss. The model learns 'normal' sequences of activity, and a high 'reconstruction error' for a new sequence indicates it is anomalous and potentially malicious, allowing for the detection of novel attack techniques.","MDM/MTD API Event Logs (Microphone Access, App State); Zeek conn.log; Zeek dns.log; Managed mobile device fleet (both corporate-owned and BYOD); Mobile Device Management (MDM) and Mobile Threat Defense (MTD) servers; Network egress points capturing traffic from mobile device subnets",last 90 days,": // Model Training
INPUT: Time-series of events (mic_on, app_background, net_connect, etc.)
MODEL: Train LSTM Autoencoder on historical data
OUTPUT: Trained model

// Real-time Inference
INPUT: Live event stream
PROCESS: Feed stream into trained model, calculate reconstruction_error
ALERT if reconstruction_error > (mean_error + 3 * stddev_error)
",playbooks/attack/mobile/T1429.yml
T1429: Audio Capture,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0035: Collection,n; o; n; e,4,Is there an Android application in the environment with the rare and dangerous 'CAPTURE_AUDIO_OUTPUT' permission that is not signed by a trusted system vendor?,This question targets a very specific and high-risk Android permission that allows capturing audio from other apps. This permission is typically reserved for the device manufacturer (OEM). Finding a non-OEM app with this permission is a major red flag for powerful surveillance capabilities and requires immediate investigation.,"Mobile Application Vetting Static Analysis Reports (Parsed Manifests, Permissions, Signer Certificates); MDM Application Inventory Logs (Package Name, Version, Device ID); Mobile Application Management (MAM) repositories; Mobile application vetting and sandboxing platforms",last 90 days,": SEARCH App Manifests
WHERE app.platform == 'Android'
AND 'android.permission.CAPTURE_AUDIO_OUTPUT' IN app.permissions
AND app.signer.CN NOT IN (Allowlist_of_OEMs)
ALERT on each finding
",playbooks/attack/mobile/T1429.yml
T1429: Audio Capture,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0035: Collection,n; o; n; e,5,Which applications requesting microphone access pose the highest risk to the organization based on a multi-factor risk score?,"This question provides a way to prioritize analysis efforts by scoring applications based on risk factors. Factors include the app's category (a game needing mic access is suspicious), developer reputation, number of permissions, and market presence. This proactive measure helps analysts focus on the small subset of applications that warrant a closer look before they can cause an incident.","Mobile Application Vetting Static Analysis Reports (Parsed Manifests, Permissions, Signer Certificates, API calls); MDM Application Inventory Logs (Package Name, Version, Device ID); Mobile Application Management (MAM) repositories; Mobile application vetting and sandboxing platforms",last 90 days,": FOR each app with mic_permission:
  score = (weight1 * app_category_risk) +
          (weight2 * developer_reputation_risk) +
          (weight3 * permission_entropy) +
          (weight4 * market_presence_risk)
  STORE app.risk_score = score
ALERT on apps where app.risk_score > 95th_percentile(all_app_scores)
",playbooks/attack/mobile/T1429.yml
T1429: Audio Capture,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0035: Collection,n; o; n; e,6,Can we automatically classify newly submitted applications as malicious or benign based on features extracted from static analysis?,"This question aims to automate threat detection by using a supervised classification model. By training a model on labeled good and bad apps, the system learns the statistical patterns of malicious code (e.g., specific combinations of permissions, suspicious API calls, obfuscation). This allows for automatic blocking and alerting on new threats that match these learned patterns, reducing analyst workload.","Mobile Application Vetting Static Analysis Reports (Parsed Manifests, Permissions, Signer Certificates, API calls); Mobile Application Management (MAM) repositories; Mobile application vetting and sandboxing platforms",last 90 days,": // Model Training
FEATURES = extract_features(permissions, api_calls, obfuscation, etc.) from labeled_dataset
MODEL = train_classifier(features, labels)

// Inference Pipeline
FOR each new_app:
  features = extract_features(new_app)
  prediction, confidence = MODEL.predict(features)
  IF prediction == 'malicious' AND confidence > 0.9:
    BLOCK and ALERT",playbooks/attack/mobile/T1429.yml
T1430.002: Impersonate SS7 Nodes,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0032: Discovery; TA0035: Collection,n; o; n; e,1,Are we receiving SS7 location queries from Global Titles not on our approved roaming partner whitelist?,This question aims to identify the most direct evidence of SS7 node impersonation. Legitimate roaming partners communicate from known Global Titles (GTs) that should be on a whitelist. A location query (like SRI-SM or PSI) from a source GT not on this list is a high-fidelity indicator of a potential adversary trying to discover subscriber locations.,"SGW_map_transactions.log; HLR_query_logs; roaming_partner_gt_whitelist.csv; Core network infrastructure, specifically the SS7 signaling plane interfaces (Signaling Gateways), subscriber databases (HLR/HSS), and network security monitoring platforms.",last 90 days,": SEARCH SGW_map_transactions.log WHERE (OpCode IN [45, 70]) AND source_gt NOT IN (roaming_partner_gt_whitelist.csv) | JOIN with HLR_query_logs",playbooks/attack/mobile/T1430.002.yml
T1430.002: Impersonate SS7 Nodes,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0032: Discovery; TA0035: Collection,n; o; n; e,2,Are any source Global Titles sending an anomalously high ratio of location queries compared to other message types?,"Adversaries focused on location discovery will likely send a higher proportion of location-related queries compared to legitimate partners who engage in a wider variety of signaling. By baselining normal traffic patterns and looking for statistical outliers, we can uncover suspicious GTs, including potentially compromised but otherwise legitimate partner nodes.","SGW_map_transactions.log; HLR_query_logs; roaming_partner_gt_whitelist.csv; Core network infrastructure, specifically the SS7 signaling plane interfaces (Signaling Gateways), subscriber databases (HLR/HSS), and network security monitoring platforms.",last 90 days,: CALCULATE ratio = (count of location queries) / (count of all queries) per source_gt over 24h | COMPARE ratio to 99th percentile of 30-day baseline for legitimate partners | ALERT if ratio > baseline_threshold,playbooks/attack/mobile/T1430.002.yml
T1430.002: Impersonate SS7 Nodes,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0032: Discovery; TA0035: Collection,n; o; n; e,3,Can we use machine learning to proactively identify and score suspicious SS7 transactions indicative of node impersonation?,"This question moves beyond simple rule-based detection to a more sophisticated, behavioral approach. A machine learning model can learn the subtle, multi-dimensional patterns of both legitimate and malicious SS7 traffic (e.g., time of day, country of origin, query frequency). This allows for the detection of novel or complex attack patterns that might evade static rules.","SGW_map_transactions.log; HLR_query_logs; roaming_partner_gt_whitelist.csv; Core network infrastructure, specifically the SS7 signaling plane interfaces (Signaling Gateways), subscriber databases (HLR/HSS), and network security monitoring platforms.",last 90 days,": SCORE SS7 transactions using trained classification model | ALERT on transactions with confidence_score > 0.90, especially from non-whitelisted GTs",playbooks/attack/mobile/T1430.002.yml
T1430.002: Impersonate SS7 Nodes,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0032: Discovery; TA0035: Collection,n; o; n; e,4,Is any single external Global Title conducting large-scale scanning for our subscribers?,"This question seeks to detect brute-force discovery attempts. A legitimate roaming partner typically queries for subscribers with whom they have a roaming relationship. An adversary, however, might perform a large-scale scan, querying hundreds or thousands of subscriber identifiers (MSISDNs) in a short time to map out a network's user base. A hard threshold (e.g., 500 unique MSISDNs in an hour) provides a clear signal of this activity.","SGW_map_transactions.log; HLR_query_logs; Core network infrastructure, specifically the SS7 signaling plane interfaces (Signaling Gateways) and subscriber databases (HLR/HSS).",last 90 days,: COUNT unique MSISDNs per source_gt over 1-hour window | ALERT if unique_msisdn_count > 500,playbooks/attack/mobile/T1430.002.yml
T1430.002: Impersonate SS7 Nodes,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0032: Discovery; TA0035: Collection,n; o; n; e,5,Are any source Global Titles showing a statistically significant spike in the number of unique subscribers they are querying?,"This question provides a more dynamic and tailored approach than a fixed threshold. By calculating a Z-score, we compare a GT's current activity against its own historical baseline. A high Z-score (e.g., >3.0) indicates that the GT is behaving abnormally for itself, which can detect scanning activity from even normally low-volume sources or compromised partners.","SGW_map_transactions.log; HLR_query_logs; Core network infrastructure, specifically the SS7 signaling plane interfaces (Signaling Gateways) and subscriber databases (HLR/HSS).",last 90 days,: FOR each source_gt: CALCULATE hourly unique MSISDN count (x) | CALCULATE 30-day rolling average (mu) and standard deviation (sigma) | CALCULATE Z-score = (x - mu) / sigma | ALERT if Z-score > 3.0,playbooks/attack/mobile/T1430.002.yml
T1430.002: Impersonate SS7 Nodes,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0032: Discovery; TA0035: Collection,n; o; n; e,6,Can we use clustering algorithms to identify outlier Global Titles whose query behavior does not match any known profile of legitimate activity?,"This question uses an unsupervised machine learning approach to find anomalies. Clustering algorithms like DBSCAN group similar data points together. By defining 'similarity' based on features like query volume and type, legitimate roaming partners will form dense clusters. GTs that fall outside these clusters (i.e., 'noise' or 'outliers') represent anomalous behavior that warrants investigation, as they are not behaving like typical partners.","SGW_map_transactions.log; HLR_query_logs; Core network infrastructure, specifically the SS7 signaling plane interfaces (Signaling Gateways) and subscriber databases (HLR/HSS).",last 90 days,": APPLY DBSCAN clustering on feature set (source_gt, unique_msisdn_count, query_ratio) | INVESTIGATE GTs classified as noise/outliers",playbooks/attack/mobile/T1430.002.yml
T1430.002: Impersonate SS7 Nodes,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0032: Discovery; TA0035: Collection,n; o; n; e,7,Is any single subscriber being repeatedly queried for their location by an unapproved external entity in a short time frame?,"This question focuses on detecting targeted tracking of an individual. While a single location query might be incidental, multiple queries for the same subscriber (MSISDN) from the same unapproved source (GT) in a short period (e.g., 15 minutes) strongly suggests a deliberate attempt to monitor that person's movements. This is a significant indicator of active collection.","HLR_query_logs; SGW_map_transactions.log; VLR_event_logs; roaming_partner_gt_whitelist.csv; Subscriber location databases (HLR/HSS, VLR) and the signaling gateways (SGW) that route queries to them.",last 90 days,: GROUP HLR logs by MSISDN and source_gt | COUNT location queries within 15-minute window | ALERT if count >= 3 AND source_gt is not whitelisted,playbooks/attack/mobile/T1430.002.yml
T1430.002: Impersonate SS7 Nodes,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0032: Discovery; TA0035: Collection,n; o; n; e,8,"Are there subscribers whose location queries are dominated by a single, potentially malicious, source Global Title?","This question uses information theory to identify potential targeting. Normally, a subscriber's location might be queried by several different legitimate partner networks over time, resulting in higher entropy. If one source GT is responsible for almost all queries for a specific subscriber, the entropy will be very low (approaching zero). This indicates a lack of diversity in query sources and can be a subtle sign that a single entity is fixated on that subscriber.","HLR_query_logs; SGW_map_transactions.log; VLR_event_logs; roaming_partner_gt_whitelist.csv; Subscriber location databases (HLR/HSS, VLR) and the signaling gateways (SGW) that route queries to them.",last 90 days,: FOR each MSISDN: CALCULATE Shannon entropy of source GTs over 24h | FLAG MSISDNs with entropy in the bottom 5th percentile,playbooks/attack/mobile/T1430.002.yml
T1430.002: Impersonate SS7 Nodes,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0032: Discovery; TA0035: Collection,n; o; n; e,9,Can a sequence-aware machine learning model detect anomalous patterns of SS7 events that indicate subscriber tracking?,"This question addresses the temporal aspect of tracking. An adversary's actions might form a specific sequence (e.g., repeated location queries without any follow-up call or SMS activity). RNNs and LSTMs are designed to recognize patterns in sequential data. By training a model on normal subscriber event sequences, it can learn to flag abnormal sequences that suggest tracking, providing a more context-aware detection method.","HLR_query_logs; SGW_map_transactions.log; VLR_event_logs; roaming_partner_gt_whitelist.csv; Subscriber location databases (HLR/HSS, VLR) and the signaling gateways (SGW) that route queries to them.",last 90 days,: FEED sequences of SS7 events per MSISDN into RNN/LSTM model | INVESTIGATE MSISDNs with sequences flagged as 'anomalous tracking pattern',playbooks/attack/mobile/T1430.002.yml
T1430.002: Impersonate SS7 Nodes,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0032: Discovery; TA0035: Collection,n; o; n; e,10,Are we successfully sending subscriber location data to unapproved external Global Titles?,"This is a critical question to confirm successful data exfiltration. It's not enough for an adversary to ask for data; they must receive it. This query correlates the inbound request with the outbound, successful response. If a successful acknowledgment containing location data is sent to a non-whitelisted GT, it confirms that a breach of location privacy has occurred.","HLR_query_logs; SGW_map_transactions.log; roaming_partner_gt_whitelist.csv; Egress points of the core network's signaling plane, specifically the Signaling Gateways (SGWs) responsible for forwarding responses to external networks.",last 90 days,: CORRELATE inbound query with outbound response via transaction ID | ALERT if response is successful AND destination_gt is not whitelisted,playbooks/attack/mobile/T1430.002.yml
T1430.002: Impersonate SS7 Nodes,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0032: Discovery; TA0035: Collection,n; o; n; e,11,Do any non-whitelisted Global Titles have an unusually high success rate for their location queries?,"This question seeks to identify adversaries who have found a weakness and are exploiting it effectively. A very high success rate (e.g., >90%) for location queries from an unapproved source is highly suspicious. Comparing this rate to the baseline for legitimate partners helps to confirm the anomaly. It suggests the adversary is not just blindly probing but has found a reliable method to exfiltrate location data.","HLR_query_logs; SGW_map_transactions.log; roaming_partner_gt_whitelist.csv; Egress points of the core network's signaling plane, specifically the Signaling Gateways (SGWs) responsible for forwarding responses to external networks.",last 90 days,: FOR each non-whitelisted GT: CALCULATE success_rate = (successful responses / total queries) per hour | ALERT if success_rate > 90% AND success_rate > 95th percentile of legitimate partner baseline,playbooks/attack/mobile/T1430.002.yml
T1430.002: Impersonate SS7 Nodes,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0032: Discovery; TA0035: Collection,n; o; n; e,12,Can we use graph analysis to identify external nodes that are acting as central hubs for collecting our subscriber location data?,"This question applies graph theory to visualize and analyze network-wide collection activity. By representing GTs and subscribers as nodes and successful queries as links, an adversary's GT will appear as a 'high-centrality collector'—a node with an unusually high number of connections to subscriber nodes. This provides a powerful, visual way to identify the scope and focus of a large-scale data collection campaign.","HLR_query_logs; SGW_map_transactions.log; roaming_partner_gt_whitelist.csv; Egress points of the core network's signaling plane, specifically the Signaling Gateways (SGWs) responsible for forwarding responses to external networks.",last 90 days,": MODEL SS7 network as a graph (nodes=GTs/MSISDNs, edges=successful queries) | USE graph anomaly detection to find non-whitelisted GTs with high centrality | FLAG high-centrality collector nodes",playbooks/attack/mobile/T1430.002.yml
T1437.001: Web Protocols,b4c2d1e0-f3a9-4b8d-9c6a-7e5f1d0b9c8a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0037: Command And Control,n; o; n; e,1,Are mobile devices communicating with known command and control servers over web protocols?,"This question aims to detect the most direct evidence of C2 activity by cross-referencing network traffic destinations (both domain names and IP addresses) from mobile devices against a curated list of known malicious infrastructure. A positive match provides a high-confidence indicator of compromise, allowing for immediate incident response.
","Zeek conn.log, Zeek http.log, Zeek dns.log, Zeek ssl.log from Corporate Wi-Fi network egress points, VPN concentrators, Mobile Device Management (MDM) gateways, forward/reverse proxies, and central DNS resolvers that process traffic from managed mobile device subnets or enrolled devices.",last 90 days,"Pseudocode: SEARCH dns.log, http.log WHERE source_ip IN mobile_device_subnets | JOIN destination_ip, destination_fqdn WITH threat_intelligence_feed ON ip, fqdn | IF match FOUND, ALERT",playbooks/attack/mobile/T1437.001.yml
T1437.001: Web Protocols,b4c2d1e0-f3a9-4b8d-9c6a-7e5f1d0b9c8a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0037: Command And Control,n; o; n; e,2,"Is any mobile device exhibiting statistical anomalies in its web traffic, such as beaconing, asymmetric data transfer, or high-entropy requests?","This question seeks to identify covert C2 channels that don't rely on known malicious domains. Adversaries often use techniques that create subtle statistical deviations from normal traffic. This includes periodic 'heartbeat' connections (beaconing), sending small commands and receiving large payloads (or vice versa), and obfuscating data in URI paths. Detecting multiple such anomalies in a single session strengthens the likelihood of malicious activity.
","Zeek conn.log, Zeek http.log, Zeek dns.log, Zeek ssl.log from Corporate Wi-Fi network egress points, VPN concentrators, Mobile Device Management (MDM) gateways, forward/reverse proxies, and central DNS resolvers that process traffic from managed mobile device subnets or enrolled devices.",last 90 days,"Pseudocode: SEARCH conn.log, http.log OVER 24h_window FOR_EACH source_ip | CALCULATE stddev(inter_arrival_time) per destination, data_ratio(sent/received), shannon_entropy(uri) | IF stddev < 1.5 OR data_ratio > 10.0 OR data_ratio < 0.1 OR entropy > 98th_percentile, FLAG | IF multiple flags for a session, ALERT",playbooks/attack/mobile/T1437.001.yml
T1437.001: Web Protocols,b4c2d1e0-f3a9-4b8d-9c6a-7e5f1d0b9c8a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0037: Command And Control,n; o; n; e,3,Can an unsupervised machine learning model identify previously unseen or novel C2 patterns in mobile device network traffic?,"This question leverages machine learning to move beyond predefined rules and thresholds. An unsupervised model like an Isolation Forest can learn the characteristics of 'normal' traffic and flag any session that deviates significantly, without prior knowledge of the attack. This is powerful for detecting zero-day exploits or custom C2 frameworks. Supplementing this with time-series forecasting on data volume adds another dimension for detecting anomalous data exfiltration or C2 communication.
","Zeek conn.log, Zeek http.log, Zeek dns.log, Zeek ssl.log from Corporate Wi-Fi network egress points, VPN concentrators, Mobile Device Management (MDM) gateways, forward/reverse proxies, and central DNS resolvers that process traffic from managed mobile device subnets or enrolled devices.",last 90 days,"Pseudocode: TRAIN IsolationForest model ON baseline_traffic_features(duration, bytes, ratio, uri_length, etc.) | APPLY model to new_sessions to get anomaly_score | TRAIN ARIMA model on outbound_data_volume per device | IF anomaly_score > threshold OR observed_volume > predicted_confidence_interval, ALERT",playbooks/attack/mobile/T1437.001.yml
T1437.001: Web Protocols,b4c2d1e0-f3a9-4b8d-9c6a-7e5f1d0b9c8a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0037: Command And Control,n; o; n; e,4,Are any mobile devices establishing TLS sessions that use fingerprints (JA3/JA3S) associated with known malware or malicious tools?,"This question uses TLS/SSL client and server fingerprints (JA3 and JA3S) as high-fidelity indicators of compromise. Specific malware families or hacking tools often have unique, hardcoded TLS implementations, resulting in a consistent fingerprint. Matching these fingerprints against a threat intelligence feed provides a very reliable way to detect the presence of specific malicious tools on the network, even if the destination IP or domain is unknown.
","Zeek ssl.log, Zeek conn.log, Zeek x509.log from Network sensors at key chokepoints with visibility into traffic from managed mobile devices, including corporate Wi-Fi egress points, VPN concentrators, Mobile Device Management (MDM) gateways, and forward proxies capable of inspecting TLS handshakes to generate Zeek log data.",last 90 days,"Pseudocode: SEARCH ssl.log | JOIN ja3, ja3s WITH threat_intel_feed ON fingerprint | IF match FOUND, ALERT",playbooks/attack/mobile/T1437.001.yml
T1437.001: Web Protocols,b4c2d1e0-f3a9-4b8d-9c6a-7e5f1d0b9c8a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0037: Command And Control,n; o; n; e,5,Are mobile devices using rare or uncommon TLS client fingerprints (JA3) to connect to servers with suspicious certificates?,"This question aims to find unknown or custom malicious clients by focusing on statistical rarity. While legitimate applications have common JA3 hashes, custom malware will appear as a rare hash. This method flags these rare connections for further scrutiny. The suspicion is increased if the server at the other end is using a self-signed or very new certificate, as these are common tactics for adversary-controlled C2 infrastructure.
","Zeek ssl.log, Zeek conn.log, Zeek x509.log from Network sensors at key chokepoints with visibility into traffic from managed mobile devices, including corporate Wi-Fi egress points, VPN concentrators, Mobile Device Management (MDM) gateways, and forward proxies capable of inspecting TLS handshakes to generate Zeek log data.",last 90 days,"Pseudocode: CALCULATE frequency of all ja3 hashes over 30d | FOR new_session FROM mobile_device | IF session.ja3_frequency < 1st_percentile AND session.ja3 NOT IN allowlist | GET certificate_info for session.uid from x509.log | IF certificate is self_signed OR cert_age < 30d, ALERT",playbooks/attack/mobile/T1437.001.yml
T1437.001: Web Protocols,b4c2d1e0-f3a9-4b8d-9c6a-7e5f1d0b9c8a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0037: Command And Control,n; o; n; e,6,Can a supervised machine learning model be trained to proactively classify TLS sessions from mobile devices as malicious or benign?,"This question proposes a proactive, predictive approach to threat detection. By training a classifier on the granular details of the TLS handshake (like cipher suites and extensions), the model can learn the subtle differences between legitimate application traffic and malicious C2 communications. Once deployed, it can score new, unclassified sessions in real-time, enabling the detection of novel threats that share characteristics with known malware, even without an exact fingerprint match.
","Zeek ssl.log, Zeek conn.log, Zeek x509.log from Network sensors at key chokepoints with visibility into traffic from managed mobile devices, including corporate Wi-Fi egress points, VPN concentrators, Mobile Device Management (MDM) gateways, and forward proxies capable of inspecting TLS handshakes to generate Zeek log data.",last 90 days,"Pseudocode: TRAIN RandomForest model ON labeled_dataset(features from TLS Client Hello) | DEPLOY model | FOR new_unclassified_session FROM mobile_device | CALCULATE malicious_probability_score | IF score > 0.90, ALERT",playbooks/attack/mobile/T1437.001.yml
T1474.003: Compromise Software Supply Chain,f9e0b51a-5f8c-4f8a-9a9c-2b2b1a9c1e1e,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0027: Initial Access,n; o; n; e,1,"Following a mobile application update, does the new package's signature hash match a known-malicious hash or fail verification against the official vendor hash?",This question aims to identify tampered or trojanized application updates at the earliest stage. A mismatch in the digital signature is a strong indicator that the application package has been modified since it was signed by the legitimate developer. Comparing the hash against both a deny-list of known malicious signatures and an allow-list of official vendor signatures provides a robust method for detecting a potential supply chain compromise.,"Mobile Device Management (MDM) Application Inventory Logs; Mobile Threat Defense (MTD) Signature Analysis Reports; Vendor-Published Application Hashes; Internal Application Hash Baseline; Application Manifest Files (from MDM/MTD); MDM/UEM servers, corporate-owned mobile endpoints, and internal/external application repositories used by the organization.",last 90 days,: FOR each app_update IN mdm_logs | EXTRACT signature_hash | IF signature_hash IN malicious_hash_list THEN ALERT (High) | ELSE IF signature_hash NOT IN vendor_hash_list THEN ALERT (High),playbooks/attack/mobile/T1474.003.yml
T1474.003: Compromise Software Supply Chain,f9e0b51a-5f8c-4f8a-9a9c-2b2b1a9c1e1e,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0027: Initial Access,n; o; n; e,2,"Did a recent mobile application update introduce a significant number of new, high-risk permissions compared to its previous version?","Adversaries often modify legitimate applications to include additional permissions that facilitate malicious activities like data theft, surveillance, or persistence. This question uses two statistical methods to detect such changes. The Jaccard similarity measures the churn in the overall permission set, while the risk score highlights the introduction of specifically dangerous permissions. A significant change in either metric, especially for a minor update, warrants investigation.","Mobile Device Management (MDM) Application Inventory Logs; Mobile Threat Defense (MTD) Signature Analysis Reports; Vendor-Published Application Hashes; Internal Application Hash Baseline; Application Manifest Files (from MDM/MTD); MDM/UEM servers, corporate-owned mobile endpoints, and internal/external application repositories used by the organization.",last 90 days,": FOR each app_update IN mdm_logs | CALCULATE jaccard_similarity(old_permissions, new_permissions) | CALCULATE risk_score_increase(old_permissions, new_permissions) | IF jaccard_similarity < threshold OR risk_score_increase > percentile_99 THEN ALERT",playbooks/attack/mobile/T1474.003.yml
T1474.003: Compromise Software Supply Chain,f9e0b51a-5f8c-4f8a-9a9c-2b2b1a9c1e1e,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0027: Initial Access,n; o; n; e,3,"Based on a combination of signature status, permission changes, and risk scores, does a machine learning model classify a recent application update as likely compromised?","This question leverages a machine learning model to provide a holistic assessment of an application update's risk. By combining multiple weak signals (signature status, permission changes) into a single predictive model, it can identify complex patterns of compromise that might be missed by individual checks. A high probability score from the model serves as a strong, aggregated alert that synthesizes multiple pieces of evidence, justifying an immediate investigation.","Mobile Device Management (MDM) Application Inventory Logs; Mobile Threat Defense (MTD) Signature Analysis Reports; Vendor-Published Application Hashes; Internal Application Hash Baseline; Application Manifest Files (from MDM/MTD); MDM/UEM servers, corporate-owned mobile endpoints, and internal/external application repositories used by the organization.",last 90 days,": FOR each app_update IN mdm_logs | GATHER features (signature_status, jaccard_score, risk_delta, etc.) | PREDICT compromise_probability = ml_model(features) | IF compromise_probability > threshold THEN ALERT",playbooks/attack/mobile/T1474.003.yml
T1474.003: Compromise Software Supply Chain,f9e0b51a-5f8c-4f8a-9a9c-2b2b1a9c1e1e,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0027: Initial Access,n; o; n; e,4,"Following a mobile app update, is the device communicating with known malicious infrastructure or using non-standard ports for common protocols?","A compromised application will often 'call home' to an adversary's command and control (C2) server. This question seeks to detect that initial communication. By correlating app updates with subsequent network traffic and checking destinations (IPs, domains) and transport characteristics (TLS fingerprints, non-standard ports) against threat intelligence and protocol standards, analysts can identify tell-tale signs of malicious C2 activity.","Zeek conn.log; Zeek dns.log; Zeek http.log; Zeek ssl.log; Mobile Device Management (MDM) Application Update Logs; Threat Intelligence Feeds; Network egress points (firewalls, proxies), corporate DNS resolvers, VPN concentrators, and WiFi access points servicing managed mobile devices.",last 90 days,: JOIN mdm_update_logs ON device_ip WITH network_logs ON source_ip | FOR each connection POST_UPDATE | IF dest_ip OR dest_domain OR ja3_hash IN threat_intel_feeds THEN ALERT | IF protocol_is_standard AND dest_port_is_non_standard THEN ALERT,playbooks/attack/mobile/T1474.003.yml
T1474.003: Compromise Software Supply Chain,f9e0b51a-5f8c-4f8a-9a9c-2b2b1a9c1e1e,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0027: Initial Access,n; o; n; e,5,"After a mobile app update, does the device exhibit anomalous network behavior such as unusual data exfiltration volumes, DNS requests for algorithmically generated domains (DGA), or communication to new, rare ports?","This question looks for statistical anomalies in network behavior that indicate a compromise. A sudden spike in data egress can signal data theft. High-entropy DNS queries are a hallmark of Domain Generation Algorithms (DGAs) used by malware to locate C2 servers. Communication to a new, low-prevalence port can indicate a custom C2 channel. Detecting these deviations from a device's established baseline can uncover malicious activity even when the destination is not yet on a threat intelligence list.","Zeek conn.log; Zeek dns.log; Zeek http.log; Zeek ssl.log; Mobile Device Management (MDM) Application Update Logs; Threat Intelligence Feeds; Network egress points (firewalls, proxies), corporate DNS resolvers, VPN concentrators, and WiFi access points servicing managed mobile devices.",last 90 days,: FOR each device POST_UPDATE | IF daily_data_out > baseline_99th_percentile THEN ALERT | FOR each new_dns_query | IF shannon_entropy(domain) > 3.5 THEN ALERT | FOR each new_dest_port | IF is_new_and_rare(port) THEN ALERT,playbooks/attack/mobile/T1474.003.yml
T1474.003: Compromise Software Supply Chain,f9e0b51a-5f8c-4f8a-9a9c-2b2b1a9c1e1e,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0027: Initial Access,n; o; n; e,6,Does a time-series analysis of post-update network traffic patterns reveal anomalies consistent with C2 beaconing or data exfiltration?,"This question applies advanced machine learning to detect subtle, time-based patterns in network traffic that are characteristic of malware behavior. C2 beaconing often occurs at regular intervals, and data exfiltration can cause sustained, unusual traffic volumes. A time-series model can learn a device's normal 'rhythm' of communication and flag significant deviations that would be invisible to simple threshold-based checks, providing a powerful method for detecting sophisticated threats.","Zeek conn.log; Zeek dns.log; Zeek http.log; Zeek ssl.log; Mobile Device Management (MDM) Application Update Logs; Threat Intelligence Feeds; Network egress points (firewalls, proxies), corporate DNS resolvers, VPN concentrators, and WiFi access points servicing managed mobile devices.",last 90 days,": FOR each device POST_UPDATE | GATHER hourly_traffic_features (volume, unique_ips, egress_ratio) | PREDICT expected_traffic = time_series_model(features) | IF actual_traffic DEVIATES_SIGNIFICANTLY from expected_traffic THEN ALERT",playbooks/attack/mobile/T1474.003.yml
T1481.002: Bidirectional Communication,8a1b6f0a-7c3d-4e9f-8a1b-9c0d1e2f3a4b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0037: Command And Control,n; o; n; e,1,"Are mobile devices communicating with domains, subdomains, or IP addresses known to be abused for C2 via legitimate web services?","This question aims to identify high-confidence C2 activity by cross-referencing outbound network connections from mobile devices with a threat intelligence feed. A match indicates a device is connecting to infrastructure that, while hosted on a legitimate service, is known to be used by malicious actors for command and control.","Zeek conn.log; Zeek ssl.log; Network security monitoring sensors at internet gateways, corporate Wi-Fi gateways, VPN concentrators, and Cloud Access Security Broker (CASB) or Unified Endpoint Management (UEM) log sources where mobile device traffic is observable.",last 90 days,": SEARCH Zeek logs (conn.log, ssl.log) WHERE source_ip is in mobile_device_range AND (destination_ip OR server_name) is in known_abused_c2_service_feed",playbooks/attack/mobile/T1481.002.yml
T1481.002: Bidirectional Communication,8a1b6f0a-7c3d-4e9f-8a1b-9c0d1e2f3a4b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0037: Command And Control,n; o; n; e,2,"Are any mobile devices exhibiting periodic, 'heartbeat'-like beaconing or making unusually large data transfers to legitimate web services?","This question seeks to uncover C2 channels that use automated, repetitive connections (beaconing) or exfiltrate/receive large payloads. Regular, low-jitter connections suggest automated malware behavior, while significant data transfer anomalies can indicate data exfiltration or payload delivery, deviating from normal user activity.","Zeek conn.log; Zeek ssl.log; Network security monitoring sensors at internet gateways, corporate Wi-Fi gateways, VPN concentrators, and Cloud Access Security Broker (CASB) or Unified Endpoint Management (UEM) log sources where mobile device traffic is observable.",last 90 days,": FOR each source_ip, destination_service pair: CALCULATE baseline stats (frequency, bytes). ALERT IF current_connection_bytes > 99th_percentile_baseline OR stddev(inter_arrival_time) < 1_second over 10_minutes",playbooks/attack/mobile/T1481.002.yml
T1481.002: Bidirectional Communication,8a1b6f0a-7c3d-4e9f-8a1b-9c0d1e2f3a4b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0037: Command And Control,n; o; n; e,3,Is there a statistically significant anomaly in the time-series data volume for connections between a mobile device and a specific web service?,"This question uses advanced time-series analysis to detect subtle deviations in traffic volume that might be missed by simple thresholding. By modeling normal traffic patterns, including daily and weekly cycles, it can identify anomalous spikes or changes in data transfer volume that could represent C2 activity.","Zeek conn.log; Zeek ssl.log; Network security monitoring sensors at internet gateways, corporate Wi-Fi gateways, VPN concentrators, and Cloud Access Security Broker (CASB) or Unified Endpoint Management (UEM) log sources where mobile device traffic is observable.",last 90 days,: FOR each device_service pair: TRAIN time_series_model on historical_data_volume. ALERT IF live_data_volume > model_prediction_interval(99%),playbooks/attack/mobile/T1481.002.yml
T1481.002: Bidirectional Communication,8a1b6f0a-7c3d-4e9f-8a1b-9c0d1e2f3a4b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0037: Command And Control,n; o; n; e,4,Are mobile devices making HTTP/S requests that contain known malicious C2 URI patterns or suspicious User-Agent strings?,"This question looks for explicit indicators of compromise within HTTP/S traffic. Malicious actors often use specific, recognizable patterns in URIs for C2 communication, and malware may use custom, non-standard, or known-bad User-Agent strings that differ from legitimate mobile browsers or applications.","Zeek http.log; Zeek ssl.log; Zeek dns.log; SSL/TLS-inspecting forward proxies, corporate DNS servers, and other network traffic inspection points capable of decrypting and logging HTTP/S metadata.",last 90 days,: SEARCH decrypted http.log WHERE uri MATCHES malicious_c2_regex_ruleset OR user_agent MATCHES known_bad_user_agent_list,playbooks/attack/mobile/T1481.002.yml
T1481.002: Bidirectional Communication,8a1b6f0a-7c3d-4e9f-8a1b-9c0d1e2f3a4b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0037: Command And Control,n; o; n; e,5,Are there any HTTP/S requests from mobile devices with unusually high-entropy URIs or statistically rare User-Agent strings for a given destination service?,"This question aims to find C2 communications that hide data within the URI. High entropy (randomness) in a URI can indicate encoded or encrypted data being passed as a parameter. Similarly, a User-Agent that is rarely seen for a popular service can be an indicator of a custom client, such as malware, rather than a standard browser or app.","Zeek http.log; Zeek ssl.log; Zeek dns.log; SSL/TLS-inspecting forward proxies, corporate DNS servers, and other network traffic inspection points capable of decrypting and logging HTTP/S metadata.",last 90 days,: FOR each destination_service: CALCULATE baseline URI entropy and User-Agent frequency. ALERT IF current_request_uri_entropy > 3_stddev_from_mean OR current_request_user_agent_frequency < 0.1%,playbooks/attack/mobile/T1481.002.yml
T1481.002: Bidirectional Communication,8a1b6f0a-7c3d-4e9f-8a1b-9c0d1e2f3a4b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0037: Command And Control,n; o; n; e,6,"Can a machine learning model, trained on URI characteristics, classify any new mobile HTTP requests as malicious C2 traffic?","This question applies a machine learning approach to detect malicious C2 URIs by analyzing multiple features simultaneously (e.g., length, character types, entropy). This method can identify complex patterns that are difficult to define with simple rules and can adapt to new and evolving C2 techniques.","Zeek http.log; Zeek ssl.log; Zeek dns.log; SSL/TLS-inspecting forward proxies, corporate DNS servers, and other network traffic inspection points capable of decrypting and logging HTTP/S metadata.",last 90 days,": FOR each new http_request: EXTRACT features (URI length, entropy, etc.). SCORE request with trained_classification_model. ALERT IF classification_score > 0.9",playbooks/attack/mobile/T1481.002.yml
T1481.002: Bidirectional Communication,8a1b6f0a-7c3d-4e9f-8a1b-9c0d1e2f3a4b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0037: Command And Control,n; o; n; e,7,Are any sensitive or high-risk mobile applications communicating with network destinations not on their approved whitelist?,"This question enforces a strict, policy-based control for critical applications. By defining an explicit 'allow list' of network destinations, any deviation from this policy is a clear indicator of a potential compromise or misconfiguration, warranting immediate investigation.","Mobile Device Management (MDM/UEM) logs; Zeek conn.log; Zeek ssl.log; HR Information System Data; Managed mobile device endpoints via MDM/UEM agents, MDM/UEM management consoles, and network chokepoints like corporate Wi-Fi gateways or Cloud Access Security Brokers (CASBs).",last 90 days,: JOIN MDM/UEM logs (for app_name) with Zeek logs (for destination_service). ALERT IF app_name is in sensitive_app_list AND destination_service is NOT in app_whitelist,playbooks/attack/mobile/T1481.002.yml
T1481.002: Bidirectional Communication,8a1b6f0a-7c3d-4e9f-8a1b-9c0d1e2f3a4b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0037: Command And Control,n; o; n; e,8,Is a mobile application connecting to a network service that is statistically rare for its application category?,"This question identifies anomalous behavior by comparing an application's network activity to that of its peers. For example, if a 'Calculator' app starts communicating with a 'Development Tools' service like GitHub, it is a statistical anomaly that could indicate the app has been compromised or is a trojanized version.","Mobile Device Management (MDM/UEM) logs; Zeek conn.log; Zeek ssl.log; HR Information System Data; Managed mobile device endpoints via MDM/UEM agents, MDM/UEM management consoles, and network chokepoints like corporate Wi-Fi gateways or Cloud Access Security Brokers (CASBs).",last 90 days,: FOR each app_category: PROFILE destination_service prevalence. ALERT IF an app connects to a service with prevalence < 1% within its category,playbooks/attack/mobile/T1481.002.yml
T1481.002: Bidirectional Communication,8a1b6f0a-7c3d-4e9f-8a1b-9c0d1e2f3a4b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0037: Command And Control,n; o; n; e,9,Does a mobile app's network connection represent a bridge between two otherwise disconnected 'communities' of applications and services?,"This question uses graph analysis to find unusual relationships between applications and the network services they access. By identifying clusters of apps that normally talk to specific clusters of services (e.g., social media apps and social media sites), a connection that crosses these community boundaries is a strong indicator of an anomaly that could be C2 activity.","Mobile Device Management (MDM/UEM) logs; Zeek conn.log; Zeek ssl.log; HR Information System Data; Managed mobile device endpoints via MDM/UEM agents, MDM/UEM management consoles, and network chokepoints like corporate Wi-Fi gateways or Cloud Access Security Brokers (CASBs).",last 90 days,: BUILD bipartite graph of apps and services. RUN community detection algorithm. ALERT on connections that link two distinct communities,playbooks/attack/mobile/T1481.002.yml
T1517: Access Notifications,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0031: Credential Access; TA0035: Collection,n; o; n; e,1,Is an unapproved or tampered application gaining access to notifications?,"This question aims to identify potentially malicious applications that have been granted the highly sensitive `BIND_NOTIFICATION_LISTENER_SERVICE` permission. By comparing the application's package name and signing certificate against a corporate allowlist, we can detect unauthorized software or legitimate apps that have been modified (tampered), which could be a sign of a supply chain attack or a Trojanized app designed to steal notification data like MFA codes.","MDM Permission Grant Event Log; MDM Application Inventory Report; Corporate Application Allowlist File; Centralized Mobile Device Management (MDM) platform; Mobile Threat Defense (MTD) cloud console; Internal repository (e.g., Git, database) hosting the application package name and certificate hash allowlist",last 90 days,: ,playbooks/attack/mobile/T1517.yml
T1517: Access Notifications,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0031: Credential Access; TA0035: Collection,n; o; n; e,2,Is a rare or unusual application with notification access installed on managed devices?,"This question uses statistical analysis to surface high-risk applications that might otherwise go unnoticed. An application with sensitive permissions that is installed on very few devices (a statistical outlier, e.g., $$ P_{install} < 0.05 $$) is inherently more suspicious than a widely deployed, well-known app. Further analyzing its permission set against typical apps in its category (using Jaccard distance) helps quantify how unusual its behavior is, providing a data-driven approach to risk assessment.","MDM Permission Grant Event Log; MDM Application Inventory Report; Corporate Application Allowlist File; Centralized Mobile Device Management (MDM) platform; Mobile Threat Defense (MTD) cloud console; Internal repository (e.g., Git, database) hosting the application package name and certificate hash allowlist",last 90 days,: ,playbooks/attack/mobile/T1517.yml
T1517: Access Notifications,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0031: Credential Access; TA0035: Collection,n; o; n; e,3,Does a machine learning model classify an application with notification access as potentially malicious?,"This question leverages machine learning to automate the risk assessment of applications. By training a model on features like permissions, developer reputation, and code obfuscation, we can predict the likelihood that an app is malicious. This provides a scalable, automated way to flag high-risk applications (e.g., predicted probability > 0.85) for review or quarantine, reducing analyst workload and response time.","MDM Permission Grant Event Log; MDM Application Inventory Report; Corporate Application Allowlist File; Centralized Mobile Device Management (MDM) platform; Mobile Threat Defense (MTD) cloud console; Internal repository (e.g., Git, database) hosting the application package name and certificate hash allowlist",last 90 days,: ,playbooks/attack/mobile/T1517.yml
T1517: Access Notifications,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0031: Credential Access; TA0035: Collection,n; o; n; e,4,Is an application with notification access communicating with known malicious infrastructure?,"This question seeks to find direct evidence of malicious activity by correlating application permissions with network traffic. An app that can read notifications and is also communicating with an IP address or domain on a threat intelligence feed, or using a TLS fingerprint (JA3/JA3S) associated with malware, is a very strong indicator of compromise and data exfiltration.","MDM Permission Grant Event Log; Zeek conn.log; Zeek dns.log; Zeek ssl.log; Threat Intelligence Feed; Network egress points including corporate VPN concentrators, WiFi access points, and Cloud Access Security Broker (CASB) proxies where Zeek sensors are deployed; SIEM platform containing correlated MDM and network logs",last 90 days,: ,playbooks/attack/mobile/T1517.yml
T1517: Access Notifications,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0031: Credential Access; TA0035: Collection,n; o; n; e,5,"Is an application with notification access exhibiting network behavior indicative of C2 communication, such as DGA or beaconing?","This question looks for subtle, algorithm-driven command-and-control (C2) patterns that may not be caught by simple signature-based detection. High Shannon entropy in DNS queries ($$ H(X) = - \sum p(x) \log_2 p(x) $$) can indicate Domain Generation Algorithms (DGA) used by malware to find C2 servers, while highly periodic, small network connections (beaconing) identified via Fast Fourier Transform (FFT) can reveal a 'heartbeat' to an attacker's infrastructure.","MDM Permission Grant Event Log; Zeek conn.log; Zeek dns.log; Zeek ssl.log; Threat Intelligence Feed; Network egress points including corporate VPN concentrators, WiFi access points, and Cloud Access Security Broker (CASB) proxies where Zeek sensors are deployed; SIEM platform containing correlated MDM and network logs",last 90 days,: ,playbooks/attack/mobile/T1517.yml
T1517: Access Notifications,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0031: Credential Access; TA0035: Collection,n; o; n; e,6,Is an application with notification access generating network traffic that is anomalous compared to its normal behavior?,"This question uses a sophisticated machine learning model (an LSTM autoencoder) to learn the 'normal' network behavior of an application and then flag deviations. A high reconstruction error means the model was unable to predict the observed traffic based on its training, indicating a significant anomaly. This is particularly useful for detecting novel or evasive C2 techniques, especially when the app is supposed to be in the background.","MDM Permission Grant Event Log; Zeek conn.log; Zeek dns.log; Zeek ssl.log; Threat Intelligence Feed; Network egress points including corporate VPN concentrators, WiFi access points, and Cloud Access Security Broker (CASB) proxies where Zeek sensors are deployed; SIEM platform containing correlated MDM and network logs",last 90 days,: ,playbooks/attack/mobile/T1517.yml
T1517: Access Notifications,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0031: Credential Access; TA0035: Collection,n; o; n; e,7,"Is a sensitive notification (e.g., from an authenticator app) being dismissed almost instantly by another application?",This question aims to detect the core malicious action of an adversary stealing a one-time password. A legitimate user interaction involves seeing a notification and then acting on it. A programmatic dismissal by a different application within seconds of the notification's arrival is highly indicative of an automated process designed to intercept the code before the user can see it.,MTD Notification Posted Log; MTD Notification Dismissed Log; MDM Application Launch Log; Mobile Threat Defense (MTD) cloud console; SIEM platform for log correlation,last 90 days,: ,playbooks/attack/mobile/T1517.yml
T1517: Access Notifications,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0031: Credential Access; TA0035: Collection,n; o; n; e,8,Is an application dismissing notifications significantly faster than its own typical behavior?,"This question uses statistical baselining to detect anomalous behavior on a per-application basis. Even if an app legitimately dismisses notifications, an unusually fast dismissal (a statistical outlier, e.g., $$ T_{dismiss} < P_{5} $$) could signify that a specific, targeted notification (like an MFA code) was programmatically intercepted, rather than being part of a normal user interaction.",MTD Notification Posted Log; MTD Notification Dismissed Log; MDM Application Launch Log; Mobile Threat Defense (MTD) cloud console; SIEM platform for log correlation,last 90 days,: ,playbooks/attack/mobile/T1517.yml
T1517: Access Notifications,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0031: Credential Access; TA0035: Collection,n; o; n; e,9,"Does the sequence of user and application events surrounding a notification dismissal deviate from normal, learned patterns?","This question models the entire user interaction workflow as a sequence of events. A normal sequence might be [Notification Arrives -> User Dismisses -> User Opens App]. By training a model on these normal sequences, we can detect anomalous patterns like [Notification Arrives -> App B Dismisses -> No User Action], which strongly implies automated, non-interactive data harvesting.",MTD Notification Posted Log; MTD Notification Dismissed Log; MDM Application Launch Log; Mobile Threat Defense (MTD) cloud console; SIEM platform for log correlation,last 90 days,: ,playbooks/attack/mobile/T1517.yml
T1517: Access Notifications,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0031: Credential Access; TA0035: Collection,n; o; n; e,10,"Is there a temporal correlation between a user reporting a missing MFA/OTP notification and a recent, suspicious application event on their device?",This question leverages human-generated signals (a user filing a help desk ticket) as a trigger for a targeted technical investigation. A user reporting a missing MFA code is a strong indicator of a potential problem. Correlating this report with a recent app installation or a sensitive permission grant on that user's device within a tight time window can quickly pinpoint the likely cause of the credential theft attempt.,"ServiceNow Incident Table; MDM Application Install Log; MDM Permission Grant Event Log; Service desk ticketing system (e.g., Jira, ServiceNow); Centralized SIEM platform; MDM/UEM management console; User's managed mobile device",last 90 days,: ,playbooks/attack/mobile/T1517.yml
T1517: Access Notifications,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0031: Credential Access; TA0035: Collection,n; o; n; e,11,Did an application on the user's device exhibit a significant spike in background data usage around the time they reported a missing notification?,"Following a user report of a missing MFA code, this question looks for evidence of data exfiltration. A sudden, statistically significant increase (e.g., Z-score > 3) in an app's background data transfer, especially for an app with notification access, strongly suggests that it intercepted the sensitive data and immediately sent it to an external server.","ServiceNow Incident Table; MDM Application Install Log; MDM Permission Grant Event Log; Service desk ticketing system (e.g., Jira, ServiceNow); Centralized SIEM platform; MDM/UEM management console; User's managed mobile device",last 90 days,: ,playbooks/attack/mobile/T1517.yml
T1517: Access Notifications,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0031: Credential Access; TA0035: Collection,n; o; n; e,12,Can an NLP model automatically identify and prioritize help desk tickets that are likely related to notification-based credential theft?,"This question focuses on improving the efficiency and speed of response by automating the initial triage of help desk tickets. An NLP model can parse the unstructured text in a ticket to accurately classify its intent, automatically flagging tickets related to this specific threat (e.g., classification probability > 0.90), assigning a critical priority, and triggering subsequent automated investigation steps.","ServiceNow Incident Table; MDM Application Install Log; MDM Permission Grant Event Log; Service desk ticketing system (e.g., Jira, ServiceNow); Centralized SIEM platform; MDM/UEM management console; User's managed mobile device",last 90 days,: ,playbooks/attack/mobile/T1517.yml
T1517: Access Notifications,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0031: Credential Access; TA0035: Collection,n; o; n; e,13,Is an application with notification access communicating over an unexpected network port or showing signs of an unstable connection?,"This question uses rule-based logic to detect suspicious network behavior. Applications typically communicate over expected, standard ports. An app with sensitive permissions sending data over a non-standard port is a red flag. Additionally, connection-level issues like retransmissions (seen in Zeek's `history` field) combined with large data transfers can indicate an attacker struggling to exfiltrate data over an unreliable C2 channel.","Zeek conn.log; MDM Permission Grant Event Log; MDM Application State Log; Network data collection points such as VPN concentrators, corporate WiFi controllers, and CASB proxies; SIEM platform for log correlation and analysis",last 90 days,: ,playbooks/attack/mobile/T1517.yml
T1517: Access Notifications,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0031: Credential Access; TA0035: Collection,n; o; n; e,14,"Is an application with notification access exfiltrating an anomalously large amount of data, especially while in the background?","This question focuses on detecting data exfiltration by baselining an application's network traffic volume. A sudden, massive spike in outbound data (e.g., exceeding the 99th percentile of its own history, or the ratio of $$ orig\_bytes / resp\_bytes $$ exceeding a baseline) is a primary indicator of exfiltration. The suspicion is amplified if this occurs while the app is in a background state, as there is no user interaction to explain the large transfer.","Zeek conn.log; MDM Permission Grant Event Log; MDM Application State Log; Network data collection points such as VPN concentrators, corporate WiFi controllers, and CASB proxies; SIEM platform for log correlation and analysis",last 90 days,: ,playbooks/attack/mobile/T1517.yml
T1517: Access Notifications,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0031: Credential Access; TA0035: Collection,n; o; n; e,15,Does a machine learning model identify a network connection from an app with notification access as a multivariate anomaly?,"This question uses an unsupervised ML model (Isolation Forest) to find 'unusual' network flows that might not be caught by single-metric thresholds. The model considers multiple features at once (data volume, duration, port, protocol, etc.) to identify connections that are anomalous in their combination of attributes. This can detect sophisticated exfiltration attempts that try to blend in by keeping individual metrics below simple alert thresholds.","Zeek conn.log; MDM Permission Grant Event Log; MDM Application State Log; Network data collection points such as VPN concentrators, corporate WiFi controllers, and CASB proxies; SIEM platform for log correlation and analysis",last 90 days,: ,playbooks/attack/mobile/T1517.yml
T1521: Encrypted Channel,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0037: Command And Control,n; o; n; e,1,"Are managed mobile devices establishing TLS sessions with servers using self-signed certificates, non-approved Certificate Authorities, or domains known to be malicious or newly registered?","Adversaries often use self-signed certificates or certificates from untrusted Certificate Authorities (CAs) to encrypt command and control (C2) traffic. This avoids the cost and potential scrutiny associated with obtaining legitimate certificates. This question helps identify such suspicious TLS sessions, and correlating them with threat intelligence on domain reputation can confirm if the destination is a known malicious entity.","Zeek ssl.log; Zeek x509.log; Zeek conn.log; Zeek dns.log; Internet Egress Points (e.g., corporate Wi-Fi gateways, VPN concentrators) instrumented with Zeek sensors.; Cloud Access Security Broker (CASB) providing visibility into cloud app traffic.; Mobile Device Management (MDM) platform for device and user context.",last 90 days,pseudocode: | JOIN ssl.log with x509.log on uid FILTER where x509.validation_status is 'self-signed certificate' OR x509.issuer is not in <allowlist_of_CAs> ENRICH results with dns.log to get server_name CHECK server_name against threat intelligence feeds for malicious or newly registered domains ALERT on matches,playbooks/attack/mobile/T1521.yml
T1521: Encrypted Channel,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0037: Command And Control,n; o; n; e,2,"Are managed mobile devices connecting to new, previously unseen domains that exhibit characteristics of Domain Generation Algorithms (DGA) or have a poor reputation?","Domain Generation Algorithms (DGAs) are used by malware to create a large number of domain names for C2 servers, making them difficult to block via static lists. High Shannon entropy in a domain name is a strong indicator of a DGA. This question aims to detect these algorithmically generated domains, as well as other new domains with poor reputation, to uncover resilient C2 infrastructure.","Zeek ssl.log; Zeek x509.log; Zeek conn.log; Zeek dns.log; Internet Egress Points (e.g., corporate Wi-Fi gateways, VPN concentrators) instrumented with Zeek sensors.; Cloud Access Security Broker (CASB) providing visibility into cloud app traffic.; Mobile Device Management (MDM) platform for device and user context.",last 90 days,pseudocode: | IDENTIFY server_names from ssl.log not seen in last 30 days FOR each new server_name: CALCULATE Shannon entropy of the domain string QUERY threat intelligence for reputation score ALERT if entropy > <high_threshold> OR reputation < <low_threshold>,playbooks/attack/mobile/T1521.yml
T1521: Encrypted Channel,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0037: Command And Control,n; o; n; e,3,"Can a machine learning model identify malicious TLS sessions in real-time based on features like certificate attributes, key length, and domain age?","This question explores a proactive, machine-learning-based approach to threat detection. By training a model on various features of a TLS session (e.g., certificate validity, entropy of subject/issuer fields, public key algorithm, self-signed status), it is possible to score new sessions for their likelihood of being malicious. This provides a more adaptive and scalable detection method that can catch novel threats missed by rule-based systems.","Zeek ssl.log; Zeek x509.log; Zeek conn.log; Zeek dns.log; Internet Egress Points (e.g., corporate Wi-Fi gateways, VPN concentrators) instrumented with Zeek sensors.; Cloud Access Security Broker (CASB) providing visibility into cloud app traffic.; Mobile Device Management (MDM) platform for device and user context.",last 90 days,"pseudocode: | FOR each new TLS session: EXTRACT features (cert duration, subject entropy, key length, self-signed flag, etc.) INPUT feature vector into trained Random Forest model SCORE the session ALERT if malicious_probability > <dynamic_threshold>",playbooks/attack/mobile/T1521.yml
T1521: Encrypted Channel,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0037: Command And Control,n; o; n; e,4,Are managed mobile devices making TLS connections using client applications whose JA3/JA3S fingerprints are not on the approved application allowlist?,"A JA3 or JA3S hash is a fingerprint of the client-side of a TLS connection, which can effectively identify the specific application or library that initiated it. An unknown or unapproved hash suggests the presence of unauthorized software on the device. This question helps detect such software, which could be a malicious implant, by comparing observed fingerprints against a baseline of known, sanctioned applications.","Zeek ssl.log; Network sensors (e.g., Zeek) at internet egress points and virtual network taps monitoring traffic to/from the mobile device subnet.; The Mobile Device Management (MDM) platform is used as a contextual source for application and device inventories.",last 90 days,pseudocode: | MAINTAIN allowlist of known good JA3/JA3S hashes QUERY ssl.log in real-time for connections from mobile IP range ALERT if JA3 or JA3S hash is NOT IN allowlist ENRICH alert with device/user info from MDM,playbooks/attack/mobile/T1521.yml
T1521: Encrypted Channel,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0037: Command And Control,n; o; n; e,5,Are there any managed mobile devices using statistically rare client applications (identified by JA3 hash) across the entire device fleet?,"Even if an application is not explicitly disallowed, its rarity can be a significant indicator of a threat. A specialized tool used by an adversary or a targeted malware implant will likely have a TLS fingerprint (JA3 hash) that is uncommon across the organization's devices. Investigating these statistical outliers helps uncover threats that might otherwise go unnoticed.","Zeek ssl.log; Network sensors (e.g., Zeek) at internet egress points and virtual network taps monitoring traffic to/from the mobile device subnet.; The Mobile Device Management (MDM) platform is used as a contextual source for application and device inventories.",last 90 days,pseudocode: | QUERY last 30 days of ssl.log from mobile fleet CALCULATE frequency of each unique JA3 hash IDENTIFY JA3 hashes with prevalence in the bottom 1st percentile ALERT on connections using these rare hashes,playbooks/attack/mobile/T1521.yml
T1521: Encrypted Channel,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0037: Command And Control,n; o; n; e,6,Can clustering algorithms identify devices with anomalous TLS fingerprinting behavior compared to their peers?,"This question shifts the analysis from individual connections to the overall behavior of a device. By profiling devices based on the set of applications (represented by JA3 hashes) they use over time, we can use clustering algorithms like DBSCAN to group devices with similar behavior. Devices that are flagged as noise or form very small, distinct clusters are outliers and warrant investigation, as they have a unique software profile that could indicate compromise.","Zeek ssl.log; Network sensors (e.g., Zeek) at internet egress points and virtual network taps monitoring traffic to/from the mobile device subnet.; The Mobile Device Management (MDM) platform is used as a contextual source for application and device inventories.",last 90 days,pseudocode: | FOR each mobile device: CREATE feature vector of unique JA3 hashes used in last 7 days APPLY DBSCAN clustering to the population of device vectors INVESTIGATE devices classified as noise or in very small clusters,playbooks/attack/mobile/T1521.yml
T1521: Encrypted Channel,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0037: Command And Control,n; o; n; e,7,"Are there any long-lived, low-throughput encrypted TCP connections originating from managed mobile devices that could indicate an idle C2 channel?","Adversaries frequently establish persistent, long-duration connections that transfer very little data as they lie in wait for commands from a C2 server. These 'idle' or 'sleeper' channels are a key tactic for maintaining persistence. Detecting encrypted connections that stay open for many hours but transmit minimal data is a direct way to uncover these potentially compromised devices.","Zeek conn.log; Network flow data collected from core network switches, VPN concentrators, and network taps monitoring traffic from mobile device subnets, including traffic subject to split-tunneling policies.",last 90 days,pseudocode: | QUERY conn.log for TCP connections from mobile IP range FILTER where connection_state is 'SF' AND duration > 8 hours AND (orig_bytes + resp_bytes) < 10 KB ALERT on matching connections,playbooks/attack/mobile/T1521.yml
T1521: Encrypted Channel,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0037: Command And Control,n; o; n; e,8,"Are there encrypted connections from mobile devices exhibiting highly regular 'heartbeat' patterns, such as consistent timing and data sizes?","Automated C2 communications from malware often exhibit machine-like regularity, unlike typical user-driven traffic. This 'beaconing' or 'heartbeat' behavior is characterized by very low variance in the time between connections (jitter) and the amount of data sent. Identifying source-destination pairs with this highly predictable pattern is a strong indicator of a C2 channel.","Zeek conn.log; Network flow data collected from core network switches, VPN concentrators, and network taps monitoring traffic from mobile device subnets, including traffic subject to split-tunneling policies.",last 90 days,"pseudocode: | FOR each source-destination pair (mobile device to server) over 1-hour window: CALCULATE standard deviation of inter-arrival times CALCULATE standard deviation of payload sizes ALERT if both standard deviations are below a low threshold (e.g., bottom 5th percentile)",playbooks/attack/mobile/T1521.yml
T1521: Encrypted Channel,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0037: Command And Control,n; o; n; e,9,"Can frequency analysis (FFT) be used to detect strong periodicity in encrypted connection patterns, indicative of C2 beaconing?","This question proposes a more advanced signal processing technique to detect C2 beaconing. A Fast Fourier Transform (FFT) can convert a time series of connection events into its constituent frequencies. A highly periodic signal, like a C2 beacon, will appear as a strong, distinct spike in the frequency domain. This method can robustly detect regular beaconing even when there is some minor noise or jitter in the timing.","Zeek conn.log; Network flow data collected from core network switches, VPN concentrators, and network taps monitoring traffic from mobile device subnets, including traffic subject to split-tunneling policies.",last 90 days,pseudocode: | FOR each high-volume source-destination pair: EXTRACT time series of connection timestamps from conn.log APPLY Fast Fourier Transform (FFT) to the time series ANALYZE the resulting power spectrum ALERT if a single frequency spike indicates strong periodicity,playbooks/attack/mobile/T1521.yml
T1532: Archive Collected Data,a7d8c6b5-e4f3-4a21-8b9c-0d1e2f3a4b5c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,T; A; 0; 0; 3; 5; :;  ; C; o; l; l; e; c; t; i; o; n,n; o; n; e,1,Is a non-allowlisted application with sensitive permissions creating an archive file?,"This question aims to identify the initial act of data staging. Adversaries often use custom or uncommon tools to package data. By checking if the application creating an archive file (like .zip, .rar) is on a denylist or, more importantly, not on an allowlist of legitimate backup/file management tools, and simultaneously has permissions to access sensitive data (contacts, photos, etc.), we can flag potentially malicious activity at its source. A positive match is a strong indicator of unauthorized data collection.","MTD file_creation.log; MDM application_inventory.log; File systems on managed mobile endpoints, focusing on user-accessible storage (e.g., Android /sdcard/, iOS 'On My iPhone/iPad') and application-private storage directories.",last 90 days,"pseudocode: FROM mtd_file_creation WHERE file_extension IN ('.zip', '.rar', '.7z', '.tar.gz') | JOIN mdm_app_inventory ON process_name | WHERE (app_is_on_denylist OR (app_not_on_allowlist AND app_has_sensitive_permissions))",playbooks/attack/mobile/T1532.yml
T1532: Archive Collected Data,a7d8c6b5-e4f3-4a21-8b9c-0d1e2f3a4b5c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,T; A; 0; 0; 3; 5; :;  ; C; o; l; l; e; c; t; i; o; n,n; o; n; e,2,"Does a newly created archive file exhibit suspicious characteristics like abnormal size, location, or is it followed by large network transfers?",This question builds on the initial detection of an archive file by seeking contextual evidence of malicious intent. An unusually large file (compared to the device's baseline) suggests a significant amount of data has been collected. A high-entropy directory path can indicate an attempt to obfuscate the staging location. A large outbound network connection shortly after creation is a classic sign of data exfiltration. Any of these factors significantly increases the likelihood that the archiving activity is malicious.,MTD file_creation.log; Zeek files.log; Zeek conn.log; File systems on managed mobile endpoints and network egress points instrumented with Zeek for traffic correlation.,last 90 days,"pseudocode: FOR each new_archive_file: | CALCULATE file_size_percentile(device, 30d) | CALCULATE path_entropy(file_path) | SEARCH zeek_conn_logs WHERE source_ip=device_ip AND timestamp within 5min of file_creation AND bytes_out > 1MB | ALERT if file_size_percentile > 95 OR path_entropy > 3.0 OR zeek_conn_found",playbooks/attack/mobile/T1532.yml
T1532: Archive Collected Data,a7d8c6b5-e4f3-4a21-8b9c-0d1e2f3a4b5c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,T; A; 0; 0; 3; 5; :;  ; C; o; l; l; e; c; t; i; o; n,n; o; n; e,3,Can a machine learning model identify file creation events indicative of malicious data staging?,"This question explores an advanced, automated approach to detection. By training a classification model with features like file size percentile, directory path entropy, application permissions, and subsequent network activity, we can create a system that scores each file creation event for its likelihood of being malicious. This moves beyond simple rule-based alerts to a probabilistic model that can identify more nuanced patterns of adversarial behavior.",MTD file_creation.log; MDM application_inventory.log; Zeek conn.log; File systems on managed mobile endpoints and network egress points instrumented with Zeek for traffic correlation.,last 90 days,"pseudocode: PREDICT malicious_staging_probability with classification_model | INPUTS: file_size_percentile, path_entropy, app_permissions, is_on_allowlist, time_of_day, network_bytes_out_5min | TRIGGER incident if probability > 0.90",playbooks/attack/mobile/T1532.yml
T1532: Archive Collected Data,a7d8c6b5-e4f3-4a21-8b9c-0d1e2f3a4b5c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,T; A; 0; 0; 3; 5; :;  ; C; o; l; l; e; c; t; i; o; n,n; o; n; e,4,"Is a process running with high resource usage while the screen is off, and is this process on a denylist or not on an allowlist of known background services?","This question aims to detect data collection and compression activities that occur when the user is not actively using the device. Adversaries perform these intensive tasks in the background to avoid detection. By monitoring for processes that consume high CPU or other resources while the screen is off and cross-referencing them against threat intelligence denylists and allowlists of legitimate background services, we can identify suspicious processes that might be preparing data for exfiltration.","MTD process_performance.log; MDM device_health.log; MDM application_inventory.log; Mobile device OS kernel, specifically process, CPU, memory, and disk I/O schedulers, with metrics collected by MDM/MTD agents.",last 90 days,pseudocode: FROM mtd_performance_logs WHERE screen_state='off' | CHECK process_name against denylist and allowlist | ALERT if on_denylist OR (not_on_allowlist AND cpu_usage > 70% for 60s),playbooks/attack/mobile/T1532.yml
T1532: Archive Collected Data,a7d8c6b5-e4f3-4a21-8b9c-0d1e2f3a4b5c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,T; A; 0; 0; 3; 5; :;  ; C; o; l; l; e; c; t; i; o; n,n; o; n; e,5,"Is an application exhibiting anomalous CPU, memory, and disk I/O usage during 'screen off' periods compared to its own historical baseline?","This question moves from static thresholds to dynamic, behavioral baselining. If an app's CPU, memory, and disk I/O simultaneously and significantly deviate from their established 'screen off' norms, it suggests a change in function, such as a dormant malicious component activating to collect and write data to a file. This is a powerful method for detecting previously unknown malware.","MTD process_performance.log; Mobile device OS kernel, specifically process, CPU, memory, and disk I/O schedulers, with metrics collected by MDM/MTD agents.",last 90 days,"pseudocode: FOR each app with screen_state='off': | CALCULATE 60s_moving_avg(cpu, memory, disk_io) | COMPARE to 30d_baseline(cpu, memory, disk_io) | ALERT if all three metrics > (mean + 3*stdev) of baseline",playbooks/attack/mobile/T1532.yml
T1532: Archive Collected Data,a7d8c6b5-e4f3-4a21-8b9c-0d1e2f3a4b5c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,T; A; 0; 0; 3; 5; :;  ; C; o; l; l; e; c; t; i; o; n,n; o; n; e,6,"Can a multivariate time-series model detect anomalous system resource patterns on a device, irrespective of individual application baselines?","This question proposes a holistic, device-level anomaly detection approach. By training a model (like an LSTM Autoencoder) on the combined performance metrics of a device, it learns the device's normal 'rhythm' of operation. An alert is triggered when the current state indicates a significant deviation from learned normalcy. This can catch sophisticated adversaries who may distribute their activity across multiple processes to stay below individual process-based thresholds.","MTD process_performance.log; Mobile device OS kernel, specifically process, CPU, memory, and disk I/O schedulers, with metrics collected by MDM/MTD agents.",last 90 days,"pseudocode: PREDICT reconstruction_error with multivariate_anomaly_model | INPUTS: cpu_usage, memory_usage, disk_write_bytes, network_sent_bytes, screen_state | ALERT if reconstruction_error > dynamic_threshold",playbooks/attack/mobile/T1532.yml
T1532: Archive Collected Data,a7d8c6b5-e4f3-4a21-8b9c-0d1e2f3a4b5c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,T; A; 0; 0; 3; 5; :;  ; C; o; l; l; e; c; t; i; o; n,n; o; n; e,7,"Did a non-backup or non-cloud-storage application execute a sequence of API calls for reading sensitive data, followed by compression, and then network activity?","This question targets the specific, logical chain of actions an adversary would take to stage and exfiltrate data. By monitoring for a predefined, ordered sequence of API calls—accessing contacts, zipping a file, opening a network socket—within a short time frame, we can create a highly specific and high-fidelity detection rule. Checking the application's category against an allowlist helps eliminate false positives from legitimate applications.",MTD api_call.log; Application Sandboxing Logs; MDM application_inventory.log; Instrumentation points within the mobile OS or a sandboxed environment that hook into API calls made by user-installed applications.,last 90 days,"pseudocode: FROM mtd_api_logs | DETECT sequence [read_contacts, zip_file, socket_connect] within 60s by same_process | JOIN mdm_app_inventory ON process | ALERT if app_category NOT IN ('File Manager', 'Cloud Storage', 'Backup')",playbooks/attack/mobile/T1532.yml
T1532: Archive Collected Data,a7d8c6b5-e4f3-4a21-8b9c-0d1e2f3a4b5c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,T; A; 0; 0; 3; 5; :;  ; C; o; l; l; e; c; t; i; o; n,n; o; n; e,8,Is an application executing rare or unusually random sequences of API calls compared to its own baseline?,"This question uses behavioral analysis of API call patterns to find anomalies. By baselining the frequency of API call sequences (n-grams) for each app, we can detect when an app executes a sequence that is statistically rare for it. Additionally, a sudden spike in API call entropy (randomness) can suggest obfuscated or exploratory activity, which deviates from normal, programmatic function calls.",MTD api_call.log; Instrumentation points within the mobile OS or a sandboxed environment that hook into API calls made by user-installed applications.,last 90 days,pseudocode: FOR each app: | CALCULATE frequency of new_api_sequence in 30d_baseline | CALCULATE entropy of api_calls in 5min_window | ALERT if sequence_frequency < 1st_percentile OR api_entropy > (mean + 3*stdev) of baseline,playbooks/attack/mobile/T1532.yml
T1532: Archive Collected Data,a7d8c6b5-e4f3-4a21-8b9c-0d1e2f3a4b5c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,T; A; 0; 0; 3; 5; :;  ; C; o; l; l; e; c; t; i; o; n,n; o; n; e,9,Can a sequence-based machine learning model classify real-time API call sequences as malicious?,"This question proposes using a deep learning model (like an LSTM or GRU) trained on the temporal nature of API call sequences. Such a model can learn the complex patterns that differentiate benign behavior from malicious activity. By feeding real-time API sequences into the model, it can provide a high-confidence score of maliciousness, enabling automated incident creation for the most critical threats.",MTD api_call.log; Application Sandboxing Logs; Instrumentation points within the mobile OS or a sandboxed environment that hook into API calls made by user-installed applications.,last 90 days,"pseudocode: PREDICT malicious_api_sequence_probability with sequence_classification_model | INPUTS: sequence_of_api_calls, app_state, time_deltas | TRIGGER incident if probability > 0.95",playbooks/attack/mobile/T1532.yml
T1616: Call Control,f8b8d2a0-6c1f-4e3a-8b9d-5a6c7d8e9f0a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0034: Impact; TA0035: Collection; TA0037: Command And Control,n; o; n; e,1,"Are any installed applications, not on our approved allowlist, possessing high-risk call control permissions like `PROCESS_OUTGOING_CALLS` or `ANSWER_PHONE_CALLS`?","This question aims to proactively identify potentially malicious applications that have been granted permissions to intercept or manage phone calls. By comparing installed applications against a curated allowlist of known-good communication apps, we can quickly surface unauthorized software capable of disrupting telephony services, such as blocking or redirecting calls.",UEM application inventory logs; Android application manifest file; Unified Endpoint Management (UEM) platform; Mobile Application Management (MAM) server; Application vetting and sandboxing environment.,last 90 days,: GET all_apps from UEM; DEFINE allowlist; FOR app in all_apps: IF app.package_name NOT IN allowlist AND ('PROCESS_OUTGOING_CALLS' IN app.permissions OR 'ANSWER_PHONE_CALLS' IN app.permissions): ALERT on app;,playbooks/attack/mobile/T1616.yml
T1616: Call Control,f8b8d2a0-6c1f-4e3a-8b9d-5a6c7d8e9f0a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0034: Impact; TA0035: Collection; TA0037: Command And Control,n; o; n; e,2,"Are any applications exhibiting an anomalously high permission risk score for their category, specifically related to call control permissions?","This question helps to identify outlier applications whose permission sets are unusual compared to their peers. By assigning weights to high-risk permissions and establishing a baseline risk profile for different app categories (e.g., 'Games', 'Productivity'), we can detect applications that request a dangerous combination or number of permissions, which may indicate malicious intent beyond their stated purpose.",UEM application inventory logs; Android application manifest file; Unified Endpoint Management (UEM) platform; Mobile Application Management (MAM) server; Application vetting and sandboxing environment.,last 90 days,: DEFINE weights for permissions; FOR each app_category: CALCULATE 98th percentile score_threshold; FOR each app: CALCULATE app_score; IF app_score > score_threshold for app.category: FLAG for review;,playbooks/attack/mobile/T1616.yml
T1616: Call Control,f8b8d2a0-6c1f-4e3a-8b9d-5a6c7d8e9f0a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0034: Impact; TA0035: Collection; TA0037: Command And Control,n; o; n; e,3,"Has our machine learning model classified any newly installed applications as potentially malicious based on their manifest features, including call-related permissions?","This question leverages a predictive model to automate the detection of malicious applications. The model is trained to recognize patterns in application manifests (permissions, services, receivers) that are characteristic of malware. This provides a scalable way to flag suspicious new installations that might use call control for malicious purposes, even if they are not caught by signature-based methods.",UEM application inventory logs; Android application manifest file; Unified Endpoint Management (UEM) platform; Mobile Application Management (MAM) server; Application vetting and sandboxing environment.,last 90 days,": FOR each new_app: EXTRACT features (permissions, services, etc.); PREDICT class with ML_model; IF prediction is 'malicious' AND confidence > 0.85: FLAG for review;",playbooks/attack/mobile/T1616.yml
T1616: Call Control,f8b8d2a0-6c1f-4e3a-8b9d-5a6c7d8e9f0a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0034: Impact; TA0035: Collection; TA0037: Command And Control,n; o; n; e,4,"Are we observing correlation events where a non-system, third-party application is programmatically blocking an outgoing call immediately after it is initiated?","This question targets the direct observation of call blocking in real-time. An `abortBroadcast()` call immediately following a `NEW_OUTGOING_CALL` intent is a strong indicator that an application is intercepting and preventing a user's outgoing call. Correlating these events in a SIEM helps detect active, in-progress call disruption.",Android Logcat; Centralized log aggregator (SIEM) collecting real-time Logcat streams from managed devices; Endpoint Detection and Response (EDR) for Mobile platform.,last 90 days,: WHEN event 'ACTION_NEW_OUTGOING_CALL' from device_id FOLLOWED WITHIN 1s by event 'abortBroadcast' from same device_id: IF source_package of abort NOT IN allowlist: ALERT;,playbooks/attack/mobile/T1616.yml
T1616: Call Control,f8b8d2a0-6c1f-4e3a-8b9d-5a6c7d8e9f0a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0034: Impact; TA0035: Collection; TA0037: Command And Control,n; o; n; e,5,Do any devices show a statistically significant increase in the ratio of blocked outgoing calls compared to their own historical baseline or the fleet-wide average?,"This question moves from single-event detection to behavioral anomaly detection. By tracking the ratio of blocked calls to initiated calls over time, we can identify devices that begin to exhibit an abnormal pattern of call interference. This is useful for detecting low-and-slow attacks or compromised devices that might not trigger a single high-severity alert.",Android Logcat; Centralized log aggregator (SIEM) collecting real-time Logcat streams from managed devices; Endpoint Detection and Response (EDR) for Mobile platform.,last 90 days,: FOR each device: CALCULATE daily_ratio = aborts / new_calls; CALCULATE 30-day avg and std_dev of ratio; IF daily_ratio > (avg + 3*std_dev): ALERT;,playbooks/attack/mobile/T1616.yml
T1616: Call Control,f8b8d2a0-6c1f-4e3a-8b9d-5a6c7d8e9f0a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0034: Impact; TA0035: Collection; TA0037: Command And Control,n; o; n; e,6,"Has a time-series model detected a fleet-wide, statistically significant spike in call-blocking events that deviates from normal daily and weekly patterns?","This question provides a macro-level view to detect coordinated or widespread campaigns. A sudden, anomalous increase in `abortBroadcast()` events across the entire organization, as identified by a seasonality-aware model, could signal a large-scale attack or the deployment of a malicious application to many devices simultaneously.",Android Logcat; Centralized log aggregator (SIEM) collecting real-time Logcat streams from managed devices; Endpoint Detection and Response (EDR) for Mobile platform.,last 90 days,: APPLY S-H-ESD model to fleet-wide 'abortBroadcast' event count per minute; IF anomaly detected: ALERT and identify top contributing devices/packages;,playbooks/attack/mobile/T1616.yml
T1616: Call Control,f8b8d2a0-6c1f-4e3a-8b9d-5a6c7d8e9f0a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0034: Impact; TA0035: Collection; TA0037: Command And Control,n; o; n; e,7,"Have any newly installed applications, not on our exception list, been detected with a high-risk combination of permissions indicative of spyware (e.g., call, record audio, and access call logs)?","This question focuses on identifying potential spyware at the point of installation. The specific combination of permissions to make/answer calls, record audio, and read/write call logs is highly indicative of an application designed for audio surveillance. Alerting on this combination allows for immediate response before the application can be used.",UEM application inventory logs; Android application manifest file; Unified Endpoint Management (UEM) platform; Mobile Application Management (MAM) server; Data warehouse containing application metadata and allowlists.,last 90 days,: ON app_install: IF app NOT IN exception_list AND app.permissions contain (('CALL_PHONE' or 'ANSWER_PHONE_CALLS') and 'RECORD_AUDIO' and ('WRITE_CALL_LOG' or 'READ_CALL_LOG')): TRIGGER high-priority alert;,playbooks/attack/mobile/T1616.yml
T1616: Call Control,f8b8d2a0-6c1f-4e3a-8b9d-5a6c7d8e9f0a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0034: Impact; TA0035: Collection; TA0037: Command And Control,n; o; n; e,8,Are any applications flagged for having an unusually high 'Spyware Potential Score' based on a weighted sum of risky permissions?,"This question provides a quantitative method for risk-ranking applications based on their potential for surveillance. By scoring and thresholding, we can surface applications that accumulate a dangerous set of permissions, even if they don't match one specific rule. This helps prioritize review efforts on the most suspicious applications.",UEM application inventory logs; Android application manifest file; Unified Endpoint Management (UEM) platform; Mobile Application Management (MAM) server; Data warehouse containing application metadata and allowlists.,last 90 days,: DEFINE weights for spyware permissions; FOR each app: CALCULATE spyware_score; IF spyware_score > 20 OR spyware_score > 99th_percentile for app.category: ALERT;,playbooks/attack/mobile/T1616.yml
T1616: Call Control,f8b8d2a0-6c1f-4e3a-8b9d-5a6c7d8e9f0a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0034: Impact; TA0035: Collection; TA0037: Command And Control,n; o; n; e,9,"Has a clustering algorithm identified any small, unusual groups of applications that share a rare and potentially malicious combination of surveillance-related permissions?","This question uses unsupervised machine learning to find novel threats. By clustering applications based on their permission sets, we can discover new or unknown spyware that shares a unique 'permission fingerprint' with a few other malicious apps, separating them from the large clusters of common, benign applications.",UEM application inventory logs; Android application manifest file; Unified Endpoint Management (UEM) platform; Mobile Application Management (MAM) server; Data warehouse containing application metadata and allowlists.,last 90 days,": VECTORIZE app permissions; APPLY DBSCAN algorithm; INVESTIGATE small, dense clusters not associated with known app types;",playbooks/attack/mobile/T1616.yml
T1616: Call Control,f8b8d2a0-6c1f-4e3a-8b9d-5a6c7d8e9f0a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0034: Impact; TA0035: Collection; TA0037: Command And Control,n; o; n; e,10,Are there any discrepancies where a call record exists in the carrier's logs but is missing from the corresponding on-device call log?,"This question aims to detect if an adversary is hiding their tracks by deleting specific entries from the device's call log. A mismatch between the official carrier record (ground truth) and the local device log is a strong indicator of evidence tampering, likely to conceal malicious call activity like surveillance or C2.",Carrier Call Detail Records (CDRs); UEM-retrieved device call logs; Data warehouse or SIEM containing both ingested telecom provider CDR feeds and UEM-polled device call logs; Telecom Expense Management (TEM) platform.,last 90 days,": JOIN CDR_logs with Device_logs on device, timestamp, number; ALERT on any CDR_log entry with no matching Device_log entry;",playbooks/attack/mobile/T1616.yml
T1616: Call Control,f8b8d2a0-6c1f-4e3a-8b9d-5a6c7d8e9f0a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0034: Impact; TA0035: Collection; TA0037: Command And Control,n; o; n; e,11,"Does any device exhibit a low Jaccard similarity score between its carrier call records and its on-device logs, indicating a significant mismatch in call history?","This question quantifies the degree of mismatch between the two call log sources. The Jaccard similarity provides a single metric to gauge how similar the two sets of records are. A sudden drop in this score for a device indicates that a significant number of calls are being hidden or deleted, warranting an investigation.",Carrier Call Detail Records (CDRs); UEM-retrieved device call logs; Data warehouse or SIEM containing both ingested telecom provider CDR feeds and UEM-polled device call logs; Telecom Expense Management (TEM) platform.,last 90 days,": FOR each device: CREATE setA from CDRs, setB from device_logs; CALCULATE jaccard_score = |A intersect B| / |A union B|; IF jaccard_score < 0.95 OR jaccard_score < fleet_baseline: ALERT;",playbooks/attack/mobile/T1616.yml
T1616: Call Control,f8b8d2a0-6c1f-4e3a-8b9d-5a6c7d8e9f0a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0034: Impact; TA0035: Collection; TA0037: Command And Control,n; o; n; e,12,Has a regression model predicted a statistically significant and anomalous deficit in the number of on-device call log entries for any user compared to their expected count based on carrier records?,"This question uses predictive analytics to find subtle log deletion. A regression model can learn a user's normal calling behavior and predict how many device log entries *should* exist based on their carrier activity. When the actual number is significantly lower, it provides a statistically-backed alert that log manipulation is likely occurring.",Carrier Call Detail Records (CDRs); UEM-retrieved device call logs; Data warehouse or SIEM containing both ingested telecom provider CDR feeds and UEM-polled device call logs; Telecom Expense Management (TEM) platform.,last 90 days,": TRAIN regression model to predict device_log_count from CDR_count, user_dept, etc.; FOR each user: PREDICT expected_log_count; IF actual_log_count is anomalously low compared to prediction: ALERT;",playbooks/attack/mobile/T1616.yml
T1616: Call Control,f8b8d2a0-6c1f-4e3a-8b9d-5a6c7d8e9f0a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0034: Impact; TA0035: Collection; TA0037: Command And Control,n; o; n; e,13,"Is any device making an excessive number of very short-duration calls to the same number within a short time frame, indicative of C2 beaconing?","This question looks for a classic C2 beaconing pattern adapted for telephony. Repeated, brief, automated calls to a single destination are not typical user behavior and can be used by malware to signal its presence, check for tasks, or exfiltrate small amounts of data.",Carrier Call Detail Records (CDRs); Telecom provider data feeds ingested into a central SIEM or data lake; Telecom Expense Management (TEM) platform.,last 90 days,: WHEN device makes > 5 calls to same_number within 1 hour AND call_duration < 5s AND same_number NOT IN allowlist: ALERT;,playbooks/attack/mobile/T1616.yml
T1616: Call Control,f8b8d2a0-6c1f-4e3a-8b9d-5a6c7d8e9f0a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0034: Impact; TA0035: Collection; TA0037: Command And Control,n; o; n; e,14,"Are any devices exhibiting both a high volume of short-duration calls and a low entropy of destination numbers, suggesting repetitive, non-random calling patterns?","This question combines two metrics to find beaconing behavior with higher confidence. A high number of short calls alone could be noise, but when combined with low Shannon entropy (meaning the calls are directed at very few unique numbers), it strongly suggests an automated, programmatic process like a C2 beacon.",Carrier Call Detail Records (CDRs); Telecom provider data feeds ingested into a central SIEM or data lake; Telecom Expense Management (TEM) platform.,last 90 days,: FOR each device: CALCULATE count of short_calls; CALCULATE shannon_entropy of destination_numbers for short_calls; IF count in top 5% AND entropy in bottom 5%: ALERT;,playbooks/attack/mobile/T1616.yml
T1616: Call Control,f8b8d2a0-6c1f-4e3a-8b9d-5a6c7d8e9f0a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0034: Impact; TA0035: Collection; TA0037: Command And Control,n; o; n; e,15,"Has clustering analysis of inter-arrival times for short calls revealed any devices with highly periodic, machine-like calling behavior?","This question focuses on the timing *between* calls to detect automation. Human calling patterns are typically random, whereas C2 beacons are often periodic (e.g., a call every 5 minutes). By analyzing the time intervals between calls, a clustering algorithm can identify devices with a very low variance in their call timing, which is a strong signal of C2 activity.",Carrier Call Detail Records (CDRs); Telecom provider data feeds ingested into a central SIEM or data lake; Telecom Expense Management (TEM) platform.,last 90 days,: FOR each device: EXTRACT time_between_short_calls to same number; CLUSTER on mean and variance of these times; INVESTIGATE clusters with low variance;,playbooks/attack/mobile/T1616.yml
T1616: Call Control,f8b8d2a0-6c1f-4e3a-8b9d-5a6c7d8e9f0a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0034: Impact; TA0035: Collection; TA0037: Command And Control,n; o; n; e,16,Are we observing events where a short-duration phone call is immediately followed by a network connection to a known malicious domain or IP address?,"This question seeks to identify a specific C2 pattern where a call acts as a trigger for a network-based callback. The malware might make a brief call to 'wake up' the C2 server, which then expects a network connection. Correlating a short call with a subsequent connection to a destination on a threat intelligence feed provides a very high-confidence indicator of compromise.","Carrier Call Detail Records (CDRs); Zeek conn.log; Zeek dns.log; SIEM or data lake with correlation capabilities, ingesting logs from telecom providers (CDRs) and network infrastructure (Zeek sensors on Wi-Fi controllers, VPN concentrators, and internet gateways).",last 90 days,: WHEN CDR_event with duration < 5s OCCURS: SEARCH for Zeek_log from same device_ip within 10s; IF Zeek_log.destination IN threat_intel_feed: HIGH SEVERITY ALERT;,playbooks/attack/mobile/T1616.yml
T1616: Call Control,f8b8d2a0-6c1f-4e3a-8b9d-5a6c7d8e9f0a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0034: Impact; TA0035: Collection; TA0037: Command And Control,n; o; n; e,17,Has cross-correlation analysis revealed any devices with a statistically significant pattern of network connections consistently occurring shortly after short-duration calls?,"This question provides a statistical method to prove the relationship between calls and network traffic, even without threat intelligence. By calculating the cross-correlation between the time series of short calls and the time series of network connections, we can mathematically identify devices where one event type reliably predicts the other, pointing to a cause-and-effect relationship indicative of C2.","Carrier Call Detail Records (CDRs); Zeek conn.log; Zeek dns.log; SIEM or data lake with correlation capabilities, ingesting logs from telecom providers (CDRs) and network infrastructure (Zeek sensors on Wi-Fi controllers, VPN concentrators, and internet gateways).",last 90 days,": FOR each device: CREATE time_series_A for short_calls, time_series_B for network_connections; CALCULATE cross-correlation of A and B; IF significant peak at lag 1-10s: ALERT;",playbooks/attack/mobile/T1616.yml
T1616: Call Control,f8b8d2a0-6c1f-4e3a-8b9d-5a6c7d8e9f0a,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0034: Impact; TA0035: Collection; TA0037: Command And Control,n; o; n; e,18,Has sequential pattern mining discovered a recurring event sequence of a short call followed by a DNS query for a rare domain and then a TCP connection?,"This question uses advanced pattern analysis to discover the specific, multi-step playbook of a C2 channel. By looking for the entire sequence (`short call -> DNS query -> connection`) as a frequent pattern, we can identify this C2 methodology with high precision and understand the attacker's TTPs more deeply. This is especially effective at finding C2 domains that are not yet on threat intelligence feeds.","Carrier Call Detail Records (CDRs); Zeek conn.log; Zeek dns.log; SIEM or data lake with correlation capabilities, ingesting logs from telecom providers (CDRs) and network infrastructure (Zeek sensors on Wi-Fi controllers, VPN concentrators, and internet gateways).",last 90 days,: FOR each device event stream: USE PrefixSpan to find frequent patterns; SEARCH for pattern '(short_call_end) -> (dns_query_rare_domain) -> (tcp_connection)'; RANK and ALERT on high-support patterns;,playbooks/attack/mobile/T1616.yml
T1625: Hijack Execution Flow,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0028: Persistence,n; o; n; e,1,Is there a real-time alert for mobile devices failing integrity or attestation checks?,"This question aims to establish a proactive, real-time alerting mechanism for explicit signs of device compromise. An immediate alert upon detection of a failed integrity check (e.g., `attestation_result: 'FAIL'`, `root_status: 'detected'`) in MDM or MTD logs is critical for rapid response. It allows security analysts to quickly isolate a potentially compromised device before an adversary can move laterally or exfiltrate data. The alert must contain key details like device ID, user, and the specific failure reason to expedite investigation.
","Mobile Device Management (MDM) attestation logs; Mobile Threat Defense (MTD) integrity scan logs; MDM/MTD management console, managed mobile endpoints (iOS, Android), and centralized log aggregator (SIEM) ingesting events from the MDM/MTD cloud infrastructure.",last 90 days,: ,playbooks/attack/mobile/T1625.yml
T1625: Hijack Execution Flow,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0028: Persistence,n; o; n; e,2,Has any device profile shown a statistically significant increase in attestation failures compared to its historical baseline?,"This question moves beyond single, explicit failures to detect subtle, targeted attacks. By baselining the normal attestation failure rate for specific device models and OS versions, analysts can identify anomalies. A sudden spike in the failure rate for a particular device profile, exceeding a statistical threshold (e.g., 99th percentile), could indicate a new exploit targeting that specific configuration or a bad OS update that creates a vulnerability. This provides an early warning of a developing threat that might otherwise be lost in the noise of random, isolated failures.
","Mobile Device Management (MDM) attestation logs; Mobile Threat Defense (MTD) integrity scan logs; MDM/MTD management console, managed mobile endpoints (iOS, Android), and centralized log aggregator (SIEM) ingesting events from the MDM/MTD cloud infrastructure.",last 90 days,: ,playbooks/attack/mobile/T1625.yml
T1625: Hijack Execution Flow,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0028: Persistence,n; o; n; e,3,"Is there a fleet-wide, anomalous spike in the total number of attestation failures?","This question addresses the detection of large-scale campaigns or systemic issues affecting the entire mobile fleet. By applying time-series anomaly detection to the aggregate count of all integrity failures, analysts can identify patterns that deviate significantly from normal operational noise. An alert triggered when failure counts exceed the model's forecast for a sustained period suggests a widespread event, such as a zero-day exploit being deployed or a critical failure in the MDM/MTD infrastructure.
","Mobile Device Management (MDM) attestation logs; Mobile Threat Defense (MTD) integrity scan logs; MDM/MTD management console, managed mobile endpoints (iOS, Android), and centralized log aggregator (SIEM) ingesting events from the MDM/MTD cloud infrastructure.",last 90 days,: ,playbooks/attack/mobile/T1625.yml
T1625: Hijack Execution Flow,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0028: Persistence,n; o; n; e,4,Has any mobile device connected to a known malicious IP address or domain?,"This is a fundamental and high-fidelity investigative question. By cross-referencing network connection logs (specifically Zeek's intel.log) from mobile devices against curated threat intelligence feeds, analysts can immediately identify communications with known command-and-control (C2) servers, malware distribution points, or other malicious infrastructure. An alert from this check is a strong indicator of compromise and requires immediate investigation.
","Zeek conn.log; Zeek dns.log; Zeek ssl.log; Zeek intel.log; Zeek ja3.log; Network sensors (e.g., Zeek) deployed at key egress points, including corporate Wi-Fi network gateways, VPN concentrators serving mobile devices, and DNS resolvers used by mobile clients.",last 90 days,: ,playbooks/attack/mobile/T1625.yml
T1625: Hijack Execution Flow,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0028: Persistence,n; o; n; e,5,Is any mobile device exhibiting anomalous network behavior compared to its own baseline?,"This question seeks to uncover covert malicious activity by identifying subtle deviations from a device's normal network patterns. Adversaries may use novel domains or custom TLS implementations that evade signature-based detection. By baselining each device's behavior, analysts can flag suspicious outliers, such as the use of a never-before-seen JA3 hash (indicating a new client application), DNS queries for algorithmically generated domains (high entropy), or unusual spikes in outbound data transfer. This behavioral approach is effective at detecting unknown or customized malware.
","Zeek conn.log; Zeek dns.log; Zeek ssl.log; Zeek intel.log; Zeek ja3.log; Network sensors (e.g., Zeek) deployed at key egress points, including corporate Wi-Fi network gateways, VPN concentrators serving mobile devices, and DNS resolvers used by mobile clients.",last 90 days,: ,playbooks/attack/mobile/T1625.yml
T1625: Hijack Execution Flow,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0028: Persistence,n; o; n; e,6,Can machine learning classify any mobile device network connections as potentially malicious?,"This question leverages the power of machine learning to synthesize numerous weak signals from network logs into a strong, actionable indicator of compromise. A supervised model, trained on labeled malicious and benign traffic, can learn complex patterns that are difficult for humans to define with rules. By scoring every connection based on features like duration, data volume, and DNS/TLS metadata, this approach can uncover sophisticated threats that mimic legitimate traffic but exhibit subtle malicious characteristics, providing a probabilistic risk score for analysts to prioritize investigations.
","Zeek conn.log; Zeek dns.log; Zeek ssl.log; Zeek intel.log; Zeek ja3.log; Network sensors (e.g., Zeek) deployed at key egress points, including corporate Wi-Fi network gateways, VPN concentrators serving mobile devices, and DNS resolvers used by mobile clients.",last 90 days,: ,playbooks/attack/mobile/T1625.yml
T1627: Execution Guardrails,a1b9e8f0-c7d6-4e5a-9f8b-3d2c1b0a9e8f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,1,Is a new or updated mobile application requesting a high-risk combination of permissions or does its code contain references to target-specific identifiers?,"Adversaries often bundle permissions that, when combined, allow for potent malicious activity (e.g., reading SMS messages and location data). This question aims to identify applications using these known high-risk permission sets. Furthermore, malware designed for specific targets may have hardcoded identifiers like corporate Wi-Fi SSIDs or internal domain names. Finding these strings in the application's code is a strong indicator of targeted intent. An alert on a match helps analysts prioritize potentially malicious applications for deeper inspection.","Mobile Application Manifest Files (e.g., AndroidManifest.xml); Static analysis reports from decompiled application source code (e.g., APK, IPA); Corporate-managed mobile devices, Mobile Device Management (MDM) platform, internal application vetting/sandbox environments, and public/private mobile application marketplaces.",Last 90 days,": FOR each new/updated application:
  permissions = EXTRACT_PERMISSIONS(application.manifest)
  IF permissions IN high_risk_watchlist:
    ALERT(""High-risk permission combo found"")
  strings = EXTRACT_STRINGS(application.code)
  IF strings CONTAINS target_specific_identifiers:
    ALERT(""Target-specific identifier found"")
",playbooks/attack/mobile/T1627.yml
T1627: Execution Guardrails,a1b9e8f0-c7d6-4e5a-9f8b-3d2c1b0a9e8f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,2,Does a mobile application have a statistically unusual set of permissions compared to other apps in its category?,This question focuses on identifying outliers. Malicious applications often request a set of permissions that deviates significantly from legitimate apps in the same category. A low Jaccard similarity score indicates the app's permissions are very different from the norm. A high Shannon entropy score suggests the app uses a rare and diverse set of permissions. Both are statistical indicators that the application may be using an unusual permission set to enable its malicious functionality while evading simple signature-based detection.,"Mobile Application Manifest Files (e.g., AndroidManifest.xml); Mobile Threat Defense (MTD) permission analysis logs; Corporate-managed mobile devices, Mobile Device Management (MDM) platform, internal application vetting/sandbox environments, and public/private mobile application marketplaces.",Last 90 days,": FOR each application:
  category_median_permissions = GET_MEDIAN_PERMS(application.category)
  jaccard_score = CALC_JACCARD(application.permissions, category_median_permissions)
  IF jaccard_score < 10th_percentile:
    FLAG_FOR_REVIEW(application, ""Low Jaccard Score"")
  entropy_score = CALC_ENTROPY(application.permissions)
  IF entropy_score > 95th_percentile:
    FLAG_FOR_REVIEW(application, ""High Entropy Score"")
",playbooks/attack/mobile/T1627.yml
T1627: Execution Guardrails,a1b9e8f0-c7d6-4e5a-9f8b-3d2c1b0a9e8f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,3,Does a machine learning model classify a new mobile application as highly likely to be malicious based on its static features?,"This question leverages machine learning to automate the detection of potentially malicious applications. By creating a feature vector from static properties like permissions, exported components, and specific API calls associated with guardrailing, a trained classifier can predict the likelihood of an app being malicious. A high probability score ($$ p(malicious) > 0.90 $$) serves as a strong signal to quarantine the application and escalate it for more intensive dynamic analysis, preventing it from running in a production environment.","Static analysis reports from decompiled application source code (e.g., APK, IPA); Corporate-managed mobile devices, Mobile Device Management (MDM) platform, internal application vetting/sandbox environments, and public/private mobile application marketplaces.",Last 90 days,": FOR each new application:
  feature_vector = GENERATE_FEATURES(application)
  prediction = ML_MODEL.predict(feature_vector)
  IF prediction.probability > 0.90:
    QUARANTINE_AND_ALERT(application)
",playbooks/attack/mobile/T1627.yml
T1627: Execution Guardrails,a1b9e8f0-c7d6-4e5a-9f8b-3d2c1b0a9e8f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,4,Does an application initiate suspicious network connections to known-bad domains or low-reputation IPs immediately after a specific environmental trigger is applied in a sandbox?,"This question aims to unmask dormant malicious behavior. Adversaries use execution guardrails to ensure their malware remains inactive until it confirms it's on a target device. By simulating a target environment (e.g., setting a specific GPS location or Wi-Fi name) in a sandbox, we can trigger this behavior. A sudden DNS query to a domain on a threat intelligence list or a connection to a low-reputation IP right after a trigger is a strong indicator that the application was waiting for these specific conditions to begin its C2 communications or other malicious network activity.","Zeek conn.log; Zeek dns.log; Dynamic analysis sandbox logs (API call traces, system call logs, file system access); Network egress points for corporate mobile devices (via VPN or proxy), guest Wi-Fi network segments, and dedicated mobile security analysis sandboxes.",Last 90 days,": IN sandbox:
  FOR each trigger in environmental_triggers:
    APPLY_TRIGGER(trigger)
    SLEEP(60)
    network_events = GET_NETWORK_LOGS(last_60_seconds)
    FOR event in network_events:
      IF event.domain in threat_intel_feed OR event.ip_rep < low_score:
        ALERT(""Suspicious network activity post-trigger"")
",playbooks/attack/mobile/T1627.yml
T1627: Execution Guardrails,a1b9e8f0-c7d6-4e5a-9f8b-3d2c1b0a9e8f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,5,"Following an environmental trigger in a sandbox, does an application's network traffic exhibit a statistically significant anomaly in volume or entropy?","This question uses statistical methods to detect a change in an application's behavior. A dormant malicious app will have very low and predictable network traffic. After a guardrail condition is met, it may initiate data exfiltration or C2 communication, causing a dramatic and anomalous spike in outbound traffic (e.g., exceeding three standard deviations from the baseline mean, $$ \mu + 3\sigma $$). An increase in the entropy of destination ports or DNS queries also suggests a shift from quiet, predictable behavior to more chaotic and suspicious activity, such as scanning or contacting multiple C2 servers.","Zeek conn.log; Zeek dns.log; Network egress points for corporate mobile devices (via VPN or proxy), guest Wi-Fi network segments, and dedicated mobile security analysis sandboxes.",Last 90 days,": IN sandbox:
  baseline_traffic = MONITOR_NETWORK(5_minutes)
  mean, std_dev = CALC_STATS(baseline_traffic)
  threshold = mean + 3 * std_dev
  APPLY_TRIGGER(trigger)
  post_trigger_traffic = MONITOR_NETWORK()
  IF post_trigger_traffic.bytes_out > threshold:
    ALERT(""Anomalous traffic volume detected"")
  IF CALC_ENTROPY(post_trigger_traffic) >> CALC_ENTROPY(baseline_traffic):
    ALERT(""Anomalous traffic entropy detected"")
",playbooks/attack/mobile/T1627.yml
T1627: Execution Guardrails,a1b9e8f0-c7d6-4e5a-9f8b-3d2c1b0a9e8f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,6,"After an environmental trigger, does an LSTM autoencoder model detect a significant anomaly in the application's network behavior compared to its learned baseline?","This question applies an advanced machine learning technique to detect behavioral changes. An LSTM autoencoder is trained on the application's normal network traffic patterns (e.g., bytes/sec, packets/sec). The model learns to reconstruct this normal behavior with low error. When the application's behavior changes dramatically after a trigger (e.g., it starts exfiltrating data), its network traffic will no longer match the learned pattern. The model will fail to reconstruct this new, anomalous traffic accurately, resulting in a high reconstruction error. A spike in this error above a high percentile threshold is a strong indicator of a malicious state change.","Zeek conn.log; Network egress points for corporate mobile devices (via VPN or proxy), guest Wi-Fi network segments, and dedicated mobile security analysis sandboxes.",Last 90 days,": IN sandbox:
  baseline_traffic = MONITOR_NETWORK()
  lstm_autoencoder = TRAIN_MODEL(baseline_traffic)
  APPLY_TRIGGER(trigger)
  post_trigger_traffic = MONITOR_NETWORK()
  reconstruction_error = lstm_autoencoder.evaluate(post_trigger_traffic)
  IF reconstruction_error > 99th_percentile_error:
    ALERT(""LSTM model detected network anomaly"")",playbooks/attack/mobile/T1627.yml
T1628.001: Suppress Application Icon,9a8b1c4d-2e3f-4a5b-8c7d-6e5f4a3b2c1d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,1,"Is there an application installed on a device that has never been launched, potentially indicating it is a hidden helper or malicious payload?","This question aims to identify 'headless' applications. Malicious apps may be installed without a user-launchable icon to act as a background service or payload dropper. By joining MDM inventory logs with mobile EDR launch logs, we can find packages that exist on the device but have no record of being opened by the user via the standard launcher interface. This check helps surface potentially unwanted or malicious software that is trying to remain hidden.
","M; D; M;  ; a; p; p; l; i; c; a; t; i; o; n;  ; i; n; v; e; n; t; o; r; y;  ; l; o; g; s; ,;  ; M; o; b; i; l; e;  ; E; D; R;  ; l; a; u; n; c; h; e; r;  ; i; n; t; e; n; t;  ; l; o; g; s; ,;  ; T; h; r; e; a; t;  ; i; n; t; e; l; l; i; g; e; n; c; e;  ; p; a; c; k; a; g; e;  ; n; a; m; e;  ; b; l; o; c; k; l; i; s; t; s; ,;  ; Z; e; e; k;  ; c; o; n; n; .; l; o; g; ,;  ; Z; e; e; k;  ; d; n; s; .; l; o; g; .;  ; T; h; e;  ; a; n; a; l; y; s; i; s;  ; r; e; q; u; i; r; e; s;  ; a; c; c; e; s; s;  ; t; o;  ; C; o; r; p; o; r; a; t; e; -; o; w; n; e; d;  ; a; n; d;  ; b; r; i; n; g; -; y; o; u; r; -; o; w; n; -; d; e; v; i; c; e;  ; (; B; Y; O; D; );  ; m; o; b; i; l; e;  ; e; n; d; p; o; i; n; t; s; ,;  ; M; D; M;  ; a; n; d;  ; M; o; b; i; l; e;  ; T; h; r; e; a; t;  ; D; e; f; e; n; s; e;  ; (; M; T; D; );  ; m; a; n; a; g; e; m; e; n; t;  ; s; e; r; v; e; r; s; ,;  ; S; e; c; u; r; i; t; y;  ; I; n; f; o; r; m; a; t; i; o; n;  ; a; n; d;  ; E; v; e; n; t;  ; M; a; n; a; g; e; m; e; n; t;  ; (; S; I; E; M; );  ; p; l; a; t; f; o; r; m; ,;  ; N; e; t; w; o; r; k;  ; e; g; r; e; s; s;  ; g; a; t; e; w; a; y; s; ,;  ; a; n; d;  ; I; n; t; e; r; n; a; l;  ; D; N; S;  ; r; e; s; o; l; v; e; r; s; .; 
",last 30 days,": LEFT JOIN mdm_inventory_logs ON (device_id, package_name)
WITH edr_launch_logs ON (device_id, package_name)
WHERE edr_launch_logs.package_name IS NULL
AND mdm_inventory_logs.time > NOW() - 30d
AND mdm_inventory_logs.package_name NOT IN (allowlist)
THEN
  QUERY threat_intel_feed WITH package_name, package_hash
  ALERT
",playbooks/attack/mobile/T1628.001.yml
T1628.001: Suppress Application Icon,9a8b1c4d-2e3f-4a5b-8c7d-6e5f4a3b2c1d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,2,Has a newly identified non-launcher application been installed on an anomalously large number of devices across the organization?,"This question focuses on the installation prevalence of headless applications. While some legitimate helper apps are non-launchable, a malicious one might propagate rapidly. By establishing a baseline for normal installation counts of benign helper apps, we can detect outliers. A new non-launcher app spreading to a number of devices far exceeding the 99th percentile of this baseline is highly suspicious and could indicate a coordinated campaign.
","M; D; M;  ; a; p; p; l; i; c; a; t; i; o; n;  ; i; n; v; e; n; t; o; r; y;  ; l; o; g; s; ,;  ; M; o; b; i; l; e;  ; E; D; R;  ; l; a; u; n; c; h; e; r;  ; i; n; t; e; n; t;  ; l; o; g; s; ,;  ; T; h; r; e; a; t;  ; i; n; t; e; l; l; i; g; e; n; c; e;  ; p; a; c; k; a; g; e;  ; n; a; m; e;  ; b; l; o; c; k; l; i; s; t; s; ,;  ; Z; e; e; k;  ; c; o; n; n; .; l; o; g; ,;  ; Z; e; e; k;  ; d; n; s; .; l; o; g; .;  ; T; h; e;  ; a; n; a; l; y; s; i; s;  ; r; e; q; u; i; r; e; s;  ; a; c; c; e; s; s;  ; t; o;  ; C; o; r; p; o; r; a; t; e; -; o; w; n; e; d;  ; a; n; d;  ; b; r; i; n; g; -; y; o; u; r; -; o; w; n; -; d; e; v; i; c; e;  ; (; B; Y; O; D; );  ; m; o; b; i; l; e;  ; e; n; d; p; o; i; n; t; s; ,;  ; M; D; M;  ; a; n; d;  ; M; o; b; i; l; e;  ; T; h; r; e; a; t;  ; D; e; f; e; n; s; e;  ; (; M; T; D; );  ; m; a; n; a; g; e; m; e; n; t;  ; s; e; r; v; e; r; s; ,;  ; S; e; c; u; r; i; t; y;  ; I; n; f; o; r; m; a; t; i; o; n;  ; a; n; d;  ; E; v; e; n; t;  ; M; a; n; a; g; e; m; e; n; t;  ; (; S; I; E; M; );  ; p; l; a; t; f; o; r; m; ,;  ; N; e; t; w; o; r; k;  ; e; g; r; e; s; s;  ; g; a; t; e; w; a; y; s; ,;  ; a; n; d;  ; I; n; t; e; r; n; a; l;  ; D; N; S;  ; r; e; s; o; l; v; e; r; s; .; 
",last 90 days,": // Step 1: Establish baseline
CALCULATE installation_prevalence_percentiles for known_benign_helper_apps over last 90 days.
STORE 99th_percentile_threshold.

// Step 2: Detect anomalies
FOR each new_non_launcher_app:
  CALCULATE fleet_wide_installation_count.
  IF installation_count > 99th_percentile_threshold:
    ALERT high_severity
",playbooks/attack/mobile/T1628.001.yml
T1628.001: Suppress Application Icon,9a8b1c4d-2e3f-4a5b-8c7d-6e5f4a3b2c1d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,3,"Can we assign a risk score to a non-launcher application based on its installation method, requested permissions, and associated network behavior?","This question seeks to automatically classify the risk of a headless application using a machine learning model. A logistic regression model can be trained on various features to predict the probability of an app being malicious ($$ P(malicious) > 0.8 $$). Features include whether the app was sideloaded, the number of dangerous permissions it requests, and network indicators like the entropy of destination IPs ($$ H(X) = -\sum p(x) \log_2 p(x) $$) or queried domains, which can reveal command-and-control (C2) activity. This provides a scalable way to prioritize investigations.
","M; D; M;  ; a; p; p; l; i; c; a; t; i; o; n;  ; i; n; v; e; n; t; o; r; y;  ; l; o; g; s; ,;  ; M; o; b; i; l; e;  ; E; D; R;  ; l; a; u; n; c; h; e; r;  ; i; n; t; e; n; t;  ; l; o; g; s; ,;  ; T; h; r; e; a; t;  ; i; n; t; e; l; l; i; g; e; n; c; e;  ; p; a; c; k; a; g; e;  ; n; a; m; e;  ; b; l; o; c; k; l; i; s; t; s; ,;  ; Z; e; e; k;  ; c; o; n; n; .; l; o; g; ,;  ; Z; e; e; k;  ; d; n; s; .; l; o; g; .;  ; T; h; e;  ; a; n; a; l; y; s; i; s;  ; r; e; q; u; i; r; e; s;  ; a; c; c; e; s; s;  ; t; o;  ; C; o; r; p; o; r; a; t; e; -; o; w; n; e; d;  ; a; n; d;  ; b; r; i; n; g; -; y; o; u; r; -; o; w; n; -; d; e; v; i; c; e;  ; (; B; Y; O; D; );  ; m; o; b; i; l; e;  ; e; n; d; p; o; i; n; t; s; ,;  ; M; D; M;  ; a; n; d;  ; M; o; b; i; l; e;  ; T; h; r; e; a; t;  ; D; e; f; e; n; s; e;  ; (; M; T; D; );  ; m; a; n; a; g; e; m; e; n; t;  ; s; e; r; v; e; r; s; ,;  ; S; e; c; u; r; i; t; y;  ; I; n; f; o; r; m; a; t; i; o; n;  ; a; n; d;  ; E; v; e; n; t;  ; M; a; n; a; g; e; m; e; n; t;  ; (; S; I; E; M; );  ; p; l; a; t; f; o; r; m; ,;  ; N; e; t; w; o; r; k;  ; e; g; r; e; s; s;  ; g; a; t; e; w; a; y; s; ,;  ; a; n; d;  ; I; n; t; e; r; n; a; l;  ; D; N; S;  ; r; e; s; o; l; v; e; r; s; .; 
",last 90 days,": // Feature Engineering
EXTRACT features from MDM logs (sideloaded_flag, permission_count, app_age).
EXTRACT features from Zeek logs (destination_ip_entropy, dns_query_entropy, low_reputation_domain_ratio).

// Prediction
PREDICT P(malicious) using trained logistic regression model.
IF P(malicious) > 0.8:
  FLAG for analyst review.
",playbooks/attack/mobile/T1628.001.yml
T1628.001: Suppress Application Icon,9a8b1c4d-2e3f-4a5b-8c7d-6e5f4a3b2c1d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,4,Is a user being redirected from the device's home screen directly to an application's details page in the system settings?,"This question looks for evidence of a synthesized icon. An adversary can create a shortcut that looks like a normal app icon but actually launches the system settings and navigates directly to a specific app's details page. A correlation rule can detect this by seeing a known launcher process spawn the system settings process (`com.android.settings`) with command-line arguments that contain 'ApplicationDetailsPages' and a target 'package:'. This behavior is a strong indicator that the user is interacting with a deceptive shortcut designed to make them launch a hidden app.
","M; o; b; i; l; e;  ; E; D; R;  ; p; r; o; c; e; s; s;  ; c; r; e; a; t; i; o; n;  ; e; v; e; n; t;  ; l; o; g; s; ,;  ; A; n; d; r; o; i; d;  ; L; o; g; c; a; t;  ; l; o; g; s; ,;  ; I; T; S; M;  ; t; i; c; k; e; t;  ; d; a; t; a; .;  ; T; h; i; s;  ; r; e; q; u; i; r; e; s;  ; a; c; c; e; s; s;  ; t; o;  ; M; a; n; a; g; e; d;  ; m; o; b; i; l; e;  ; e; n; d; p; o; i; n; t; s;  ; r; u; n; n; i; n; g;  ; A; n; d; r; o; i; d;  ; 1; 0;  ; o; r;  ; n; e; w; e; r; ,;  ; E; D; R;  ; a; n; d;  ; S; I; E; M;  ; l; o; g;  ; a; g; g; r; e; g; a; t; i; o; n;  ; p; l; a; t; f; o; r; m; s; ,;  ; a; n; d;  ; t; h; e;  ; I; T;  ; S; e; r; v; i; c; e;  ; M; a; n; a; g; e; m; e; n; t;  ; s; y; s; t; e; m; .; 
",last 90 days,": ON process_creation_event:
IF parent_process_name IN (launcher_allowlist)
AND process_name == 'com.android.settings'
AND process_cmdline CONTAINS 'com.android.settings.ApplicationDetailsPages'
AND process_cmdline CONTAINS 'package:':
  EXTRACT package_name from process_cmdline
  ALERT for investigation
",playbooks/attack/mobile/T1628.001.yml
T1628.001: Suppress Application Icon,9a8b1c4d-2e3f-4a5b-8c7d-6e5f4a3b2c1d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,5,Has there been a statistically significant increase in the number of launcher-to-settings redirections for a specific application?,"This question aims to detect anomalous spikes in the use of synthesized icons for a particular app. By tracking the daily count of these redirection events per application, we can establish a normal baseline using a 30-day moving average ($$ MA_{30} $$) and standard deviation ($$ \sigma_{30} $$). An alert is triggered if the daily count for an app exceeds three standard deviations above its moving average ($$ DailyCount > MA_{30} + 3\sigma_{30} $$), which suggests a potential campaign or widespread use of a deceptive technique that warrants investigation.
","M; o; b; i; l; e;  ; E; D; R;  ; p; r; o; c; e; s; s;  ; c; r; e; a; t; i; o; n;  ; e; v; e; n; t;  ; l; o; g; s; ,;  ; A; n; d; r; o; i; d;  ; L; o; g; c; a; t;  ; l; o; g; s; ,;  ; I; T; S; M;  ; t; i; c; k; e; t;  ; d; a; t; a; .;  ; T; h; i; s;  ; r; e; q; u; i; r; e; s;  ; a; c; c; e; s; s;  ; t; o;  ; M; a; n; a; g; e; d;  ; m; o; b; i; l; e;  ; e; n; d; p; o; i; n; t; s;  ; r; u; n; n; i; n; g;  ; A; n; d; r; o; i; d;  ; 1; 0;  ; o; r;  ; n; e; w; e; r; ,;  ; E; D; R;  ; a; n; d;  ; S; I; E; M;  ; l; o; g;  ; a; g; g; r; e; g; a; t; i; o; n;  ; p; l; a; t; f; o; r; m; s; ,;  ; a; n; d;  ; t; h; e;  ; I; T;  ; S; e; r; v; i; c; e;  ; M; a; n; a; g; e; m; e; n; t;  ; s; y; s; t; e; m; .; 
",last 30 days,": FOR each identified_package:
  CALCULATE daily_count of 'launcher-to-settings' events.
  CALCULATE 30_day_moving_average (MA_30) and standard_deviation (sigma_30).
  IF daily_count > (MA_30 + 3 * sigma_30):
    ALERT on statistical anomaly
",playbooks/attack/mobile/T1628.001.yml
T1628.001: Suppress Application Icon,9a8b1c4d-2e3f-4a5b-8c7d-6e5f4a3b2c1d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,6,Can we detect the use of a synthesized icon by identifying anomalous user navigation sequences?,"This question uses sequence analysis to model user behavior and find deviations that indicate a synthesized icon was used. A Hidden Markov Model (HMM) can be trained on normal UI event sequences (e.g., HomeScreen -> AppDrawer -> App). The model would learn that a direct transition from the 'HomeScreen' state to an 'AppDetailsPage' state is a very low-probability event. When the model detects this anomalous sequence in a user's session logs, it can generate a high-fidelity alert, as this navigation path is not typical and strongly implies a deceptive shortcut was used.
","M; o; b; i; l; e;  ; E; D; R;  ; p; r; o; c; e; s; s;  ; c; r; e; a; t; i; o; n;  ; e; v; e; n; t;  ; l; o; g; s; ,;  ; A; n; d; r; o; i; d;  ; L; o; g; c; a; t;  ; l; o; g; s; ,;  ; I; T; S; M;  ; t; i; c; k; e; t;  ; d; a; t; a; .;  ; T; h; i; s;  ; r; e; q; u; i; r; e; s;  ; a; c; c; e; s; s;  ; t; o;  ; M; a; n; a; g; e; d;  ; m; o; b; i; l; e;  ; e; n; d; p; o; i; n; t; s;  ; r; u; n; n; i; n; g;  ; A; n; d; r; o; i; d;  ; 1; 0;  ; o; r;  ; n; e; w; e; r; ,;  ; E; D; R;  ; a; n; d;  ; S; I; E; M;  ; l; o; g;  ; a; g; g; r; e; g; a; t; i; o; n;  ; p; l; a; t; f; o; r; m; s; ,;  ; a; n; d;  ; t; h; e;  ; I; T;  ; S; e; r; v; i; c; e;  ; M; a; n; a; g; e; m; e; n; t;  ; s; y; s; t; e; m; .; 
",last 90 days,": // Model Training
TRAIN Hidden Markov Model (HMM) on baseline UI event sequences.
IDENTIFY 'HomeScreen' -> 'AppDetailsPage' as anomalous transition.

// Detection
FOR each user_session_event_sequence:
  SCORE sequence using trained HMM.
  IF anomalous_transition_is_detected:
    ALERT on anomalous navigation path
",playbooks/attack/mobile/T1628.001.yml
T1628.001: Suppress Application Icon,9a8b1c4d-2e3f-4a5b-8c7d-6e5f4a3b2c1d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,7,Does a submitted APK file contain code to programmatically disable its own launcher icon?,"This question seeks to proactively identify malicious applications during the vetting process before they are deployed. A YARA rule can scan the APK's bytecode for the specific `setComponentEnabledSetting` API call and the `COMPONENT_ENABLED_STATE_DISABLED` flag. A post-processing script then verifies if the targeted component is indeed the main launcher defined in the `AndroidManifest.xml`. A positive match provides definitive evidence of icon-hiding behavior, allowing the application to be automatically blocked from the organizational app store.
","S; t; a; t; i; c;  ; a; n; a; l; y; s; i; s;  ; r; e; p; o; r; t; s;  ; f; r; o; m;  ; a; p; p; l; i; c; a; t; i; o; n;  ; v; e; t; t; i; n; g;  ; s; a; n; d; b; o; x; ,;  ; M; o; b; i; l; e;  ; a; p; p; l; i; c; a; t; i; o; n;  ; r; e; p; u; t; a; t; i; o; n;  ; s; e; r; v; i; c; e;  ; l; o; g; s; ,;  ; A; P; K;  ; f; i; l; e; s; .;  ; T; h; i; s;  ; r; e; q; u; i; r; e; s;  ; a; c; c; e; s; s;  ; t; o;  ; O; r; g; a; n; i; z; a; t; i; o; n; a; l;  ; a; p; p; l; i; c; a; t; i; o; n;  ; s; t; o; r; e; s;  ; (; e; .; g; .; ,;  ; m; a; n; a; g; e; d;  ; G; o; o; g; l; e;  ; P; l; a; y; ); ,;  ; A; p; p; l; i; c; a; t; i; o; n;  ; v; e; t; t; i; n; g;  ; s; a; n; d; b; o; x; e; s; ,;  ; D; e; v; e; l; o; p; e; r;  ; C; I; /; C; D;  ; p; i; p; e; l; i; n; e; s; ,;  ; a; n; d;  ; T; h; r; e; a; t;  ; i; n; t; e; l; l; i; g; e; n; c; e;  ; p; l; a; t; f; o; r; m; s; .; 
",last 90 days,": // YARA Scan
SCAN APK with YARA rule for `setComponentEnabledSetting` and `COMPONENT_ENABLED_STATE_DISABLED`.

// Post-processing
IF YARA match:
  PARSE AndroidManifest.xml.
  CONFIRM disabled component has LAUNCHER intent.
  IF confirmed:
    BLOCK application distribution
    ALERT
",playbooks/attack/mobile/T1628.001.yml
T1628.001: Suppress Application Icon,9a8b1c4d-2e3f-4a5b-8c7d-6e5f4a3b2c1d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,8,"Among applications that use icon-hiding APIs, which ones are most anomalous based on their overall API usage and code complexity?","This question helps prioritize manual review for apps flagged by the YARA rule. Even if an app uses the icon-hiding API, it might be for a legitimate purpose. To find the most suspicious cases, we can compare the app's full set of API calls to a baseline of benign apps using Jaccard distance ($$ d_J(A, B) = 1 - \frac{|A \cap B|}{|A \cup B|} $$). A high distance indicates unusual API usage. Additionally, high Shannon entropy of the `classes.dex` file can indicate code obfuscation. Flagging apps that have the icon-hiding API *and* are in the top 5th percentile for both Jaccard distance and entropy helps focus analyst attention on the most likely threats.
","S; t; a; t; i; c;  ; a; n; a; l; y; s; i; s;  ; r; e; p; o; r; t; s;  ; f; r; o; m;  ; a; p; p; l; i; c; a; t; i; o; n;  ; v; e; t; t; i; n; g;  ; s; a; n; d; b; o; x; ,;  ; M; o; b; i; l; e;  ; a; p; p; l; i; c; a; t; i; o; n;  ; r; e; p; u; t; a; t; i; o; n;  ; s; e; r; v; i; c; e;  ; l; o; g; s; ,;  ; A; P; K;  ; f; i; l; e; s; .;  ; T; h; i; s;  ; r; e; q; u; i; r; e; s;  ; a; c; c; e; s; s;  ; t; o;  ; O; r; g; a; n; i; z; a; t; i; o; n; a; l;  ; a; p; p; l; i; c; a; t; i; o; n;  ; s; t; o; r; e; s;  ; (; e; .; g; .; ,;  ; m; a; n; a; g; e; d;  ; G; o; o; g; l; e;  ; P; l; a; y; ); ,;  ; A; p; p; l; i; c; a; t; i; o; n;  ; v; e; t; t; i; n; g;  ; s; a; n; d; b; o; x; e; s; ,;  ; D; e; v; e; l; o; p; e; r;  ; C; I; /; C; D;  ; p; i; p; e; l; i; n; e; s; ,;  ; a; n; d;  ; T; h; r; e; a; t;  ; i; n; t; e; l; l; i; g; e; n; c; e;  ; p; l; a; t; f; o; r; m; s; .; 
",last 90 days,": FOR each new_apk:
  IF apk contains icon-hiding_api:
    CALCULATE Jaccard distance of API set vs. benign baseline.
    CALCULATE Shannon entropy of classes.dex.
    IF Jaccard_distance > 95th_percentile AND entropy > 95th_percentile:
      FLAG for manual review
",playbooks/attack/mobile/T1628.001.yml
T1628.001: Suppress Application Icon,9a8b1c4d-2e3f-4a5b-8c7d-6e5f4a3b2c1d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,9,Can we automate the rejection or quarantining of new APKs based on a predicted malice score from a machine learning model?,"This question focuses on creating a fully automated, scalable vetting system using a gradient boosting classifier (like XGBoost). The model is trained on a rich feature set from static analysis reports, including suspicious API calls, dangerous permissions, obfuscation signatures, and the reputation of embedded network indicators. It then assigns a malice score to each new APK. Applications with a very high score (e.g., $$ > 0.9 $$) can be automatically rejected, while those in a medium-risk band (e.g., $$ 0.7 - 0.9 $$) can be sent to analysts for review, optimizing the security workflow.
","S; t; a; t; i; c;  ; a; n; a; l; y; s; i; s;  ; r; e; p; o; r; t; s;  ; f; r; o; m;  ; a; p; p; l; i; c; a; t; i; o; n;  ; v; e; t; t; i; n; g;  ; s; a; n; d; b; o; x; ,;  ; M; o; b; i; l; e;  ; a; p; p; l; i; c; a; t; i; o; n;  ; r; e; p; u; t; a; t; i; o; n;  ; s; e; r; v; i; c; e;  ; l; o; g; s; ,;  ; A; P; K;  ; f; i; l; e; s; .;  ; T; h; i; s;  ; r; e; q; u; i; r; e; s;  ; a; c; c; e; s; s;  ; t; o;  ; O; r; g; a; n; i; z; a; t; i; o; n; a; l;  ; a; p; p; l; i; c; a; t; i; o; n;  ; s; t; o; r; e; s;  ; (; e; .; g; .; ,;  ; m; a; n; a; g; e; d;  ; G; o; o; g; l; e;  ; P; l; a; y; ); ,;  ; A; p; p; l; i; c; a; t; i; o; n;  ; v; e; t; t; i; n; g;  ; s; a; n; d; b; o; x; e; s; ,;  ; D; e; v; e; l; o; p; e; r;  ; C; I; /; C; D;  ; p; i; p; e; l; i; n; e; s; ,;  ; a; n; d;  ; T; h; r; e; a; t;  ; i; n; t; e; l; l; i; g; e; n; c; e;  ; p; l; a; t; f; o; r; m; s; .; 
",last 90 days,": // Feature Engineering
EXTRACT features from static analysis (APIs, permissions, packers, URL/IP reputation).

// Prediction
PREDICT malice_score using trained gradient boosting model.
IF malice_score > 0.9:
  REJECT application
ELSE IF malice_score > 0.7:
  QUARANTINE for manual review",playbooks/attack/mobile/T1628.001.yml
T1628.002: User Evasion,1e9d1a3b-4c6e-4b8a-9f0e-2d3c1a5b7d9c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,1,Is a mobile application ceasing C2-like beaconing immediately after device motion is detected?,"This question aims to detect malware that hides its command-and-control (C2) communication when it senses the user might be actively using the device. The logic is that an application's network activity should not suddenly stop just because the device is moved. A stateful correlation rule identifies this pattern: 1) periodic, low-volume network traffic (beaconing) while the device is at rest, followed by 2) motion sensor access, and then 3) a significant drop in that network traffic. This is a strong indicator of user evasion.
","M; o; b; i; l; e;  ; T; h; r; e; a; t;  ; D; e; f; e; n; s; e;  ; (; M; T; D; );  ; s; e; n; s; o; r;  ; a; c; c; e; s; s;  ; l; o; g; s; ,;  ; M; o; b; i; l; e;  ; D; e; v; i; c; e;  ; M; a; n; a; g; e; m; e; n; t;  ; (; M; D; M; );  ; a; p; p; l; i; c; a; t; i; o; n;  ; i; n; v; e; n; t; o; r; y;  ; l; o; g; s; ,;  ; Z; e; e; k;  ; c; o; n; n; .; l; o; g; ,;  ; Z; e; e; k;  ; d; n; s; .; l; o; g; .;  ; D; a; t; a;  ; i; s;  ; s; o; u; r; c; e; d;  ; f; r; o; m;  ; c; o; r; p; o; r; a; t; e; -; m; a; n; a; g; e; d;  ; m; o; b; i; l; e;  ; d; e; v; i; c; e; s;  ; w; i; t; h;  ; M; T; D; /; M; D; M;  ; a; g; e; n; t; s; ,;  ; n; e; t; w; o; r; k;  ; t; a; p; s;  ; a; t;  ; c; o; r; p; o; r; a; t; e;  ; W; i; -; F; i; /; V; P; N;  ; p; o; i; n; t; s;  ; w; i; t; h;  ; Z; e; e; k;  ; s; e; n; s; o; r; s; ,;  ; M; D; M;  ; s; e; r; v; e; r; s; ,;  ; a; n; d;  ; D; N; S;  ; s; e; r; v; e; r; s; ,;  ; a; l; l;  ; a; g; g; r; e; g; a; t; e; d;  ; i; n;  ; a;  ; c; e; n; t; r; a; l;  ; S; I; E; M;  ; o; r;  ; d; a; t; a;  ; l; a; k; e; .; 
",last 90 days,": CREATE stateful rule.
TRIGGER on MTD event for accelerometer/gyroscope access from non-allowlisted app.
IF triggered, QUERY Zeek conn.log for device IP in previous 10 minutes.
IF periodic, low-volume connections are found, QUERY Zeek conn.log for next 5+ minutes.
IF traffic has ceased, GENERATE high-severity alert.
",playbooks/attack/mobile/T1628.002.yml
T1628.002: User Evasion,1e9d1a3b-4c6e-4b8a-9f0e-2d3c1a5b7d9c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,2,Is there a strong negative correlation between a mobile application's network activity and the device's motion state?,"This question seeks to identify evasive behavior over a longer period. By continuously calculating the Pearson correlation coefficient between device motion (from MTD logs) and an application's network connection count (from Zeek logs), we can statistically prove that the application intentionally reduces its network footprint when the user is active. A strong negative correlation (e.g., $$ r < -0.8 $$) is a significant anomaly, suggesting the app is designed to operate stealthily. The suspicion is increased if the network traffic during 'at rest' periods has characteristics of C2 traffic, like low destination entropy.
","M; o; b; i; l; e;  ; T; h; r; e; a; t;  ; D; e; f; e; n; s; e;  ; (; M; T; D; );  ; s; e; n; s; o; r;  ; a; c; c; e; s; s;  ; l; o; g; s; ,;  ; M; o; b; i; l; e;  ; D; e; v; i; c; e;  ; M; a; n; a; g; e; m; e; n; t;  ; (; M; D; M; );  ; a; p; p; l; i; c; a; t; i; o; n;  ; i; n; v; e; n; t; o; r; y;  ; l; o; g; s; ,;  ; Z; e; e; k;  ; c; o; n; n; .; l; o; g; ,;  ; Z; e; e; k;  ; d; n; s; .; l; o; g; .;  ; D; a; t; a;  ; i; s;  ; s; o; u; r; c; e; d;  ; f; r; o; m;  ; c; o; r; p; o; r; a; t; e; -; m; a; n; a; g; e; d;  ; m; o; b; i; l; e;  ; d; e; v; i; c; e; s;  ; w; i; t; h;  ; M; T; D; /; M; D; M;  ; a; g; e; n; t; s; ,;  ; n; e; t; w; o; r; k;  ; t; a; p; s;  ; a; t;  ; c; o; r; p; o; r; a; t; e;  ; W; i; -; F; i; /; V; P; N;  ; p; o; i; n; t; s;  ; w; i; t; h;  ; Z; e; e; k;  ; s; e; n; s; o; r; s; ,;  ; M; D; M;  ; s; e; r; v; e; r; s; ,;  ; a; n; d;  ; D; N; S;  ; s; e; r; v; e; r; s; ,;  ; a; l; l;  ; a; g; g; r; e; g; a; t; e; d;  ; i; n;  ; a;  ; c; e; n; t; r; a; l;  ; S; I; E; M;  ; o; r;  ; d; a; t; a;  ; l; a; k; e; .; 
",last 90 days,": FOR each non-allowlisted app:
CALCULATE rolling 24-hour Pearson correlation ('r') between MTD motion series (1=motion, 0=rest) and Zeek connection count series.
IF $$ r < -0.8 $$, GENERATE medium-severity alert.
ELEVATE risk if destination IP entropy is low during rest periods.
",playbooks/attack/mobile/T1628.002.yml
T1628.002: User Evasion,1e9d1a3b-4c6e-4b8a-9f0e-2d3c1a5b7d9c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,3,Can a machine learning model predict a device's motion state solely based on an application's network traffic patterns?,"This question uses a machine learning approach to find a subtle but powerful anomaly. An application's network traffic (like connection rate or data volume) should not be a reliable predictor of whether the device is moving or at rest. If a model (like a Random Forest classifier) can achieve high accuracy in predicting motion using only network features, it implies the application is deliberately altering its network behavior based on the device's physical state. This provides strong evidence of sophisticated user evasion logic embedded within the application.
","M; o; b; i; l; e;  ; T; h; r; e; a; t;  ; D; e; f; e; n; s; e;  ; (; M; T; D; );  ; s; e; n; s; o; r;  ; a; c; c; e; s; s;  ; l; o; g; s; ,;  ; M; o; b; i; l; e;  ; D; e; v; i; c; e;  ; M; a; n; a; g; e; m; e; n; t;  ; (; M; D; M; );  ; a; p; p; l; i; c; a; t; i; o; n;  ; i; n; v; e; n; t; o; r; y;  ; l; o; g; s; ,;  ; Z; e; e; k;  ; c; o; n; n; .; l; o; g; ,;  ; Z; e; e; k;  ; d; n; s; .; l; o; g; .;  ; D; a; t; a;  ; i; s;  ; s; o; u; r; c; e; d;  ; f; r; o; m;  ; c; o; r; p; o; r; a; t; e; -; m; a; n; a; g; e; d;  ; m; o; b; i; l; e;  ; d; e; v; i; c; e; s;  ; w; i; t; h;  ; M; T; D; /; M; D; M;  ; a; g; e; n; t; s; ,;  ; n; e; t; w; o; r; k;  ; t; a; p; s;  ; a; t;  ; c; o; r; p; o; r; a; t; e;  ; W; i; -; F; i; /; V; P; N;  ; p; o; i; n; t; s;  ; w; i; t; h;  ; Z; e; e; k;  ; s; e; n; s; o; r; s; ,;  ; M; D; M;  ; s; e; r; v; e; r; s; ,;  ; a; n; d;  ; D; N; S;  ; s; e; r; v; e; r; s; ,;  ; a; l; l;  ; a; g; g; r; e; g; a; t; e; d;  ; i; n;  ; a;  ; c; e; n; t; r; a; l;  ; S; I; E; M;  ; o; r;  ; d; a; t; a;  ; l; a; k; e; .; 
",last 90 days,": FOR each non-allowlisted app:
TRAIN a classifier (e.g., Random Forest) to predict motion state ('at rest' vs 'in motion') using network features from Zeek logs.
IF model accuracy > 85%, FLAG application as highly suspicious.
",playbooks/attack/mobile/T1628.002.yml
T1628.002: User Evasion,1e9d1a3b-4c6e-4b8a-9f0e-2d3c1a5b7d9c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,4,Is a non-standard mobile application initiating high-volume data transfers only when the proximity sensor is covered?,"This question investigates malware that waits for the device to be inactive (e.g., in a pocket, face down) to exfiltrate data. The trigger is an application, not on an allowlist for proximity sensor access (like the Phone app), accessing the sensor. If the sensor state becomes 'covered' and the application's data output suddenly spikes far beyond its normal background usage, it's a red flag. The case is strengthened if this anomalous traffic stops abruptly as soon as the sensor becomes 'uncovered', indicating a direct link between the evasive condition and the malicious activity.
","M; o; b; i; l; e;  ; T; h; r; e; a; t;  ; D; e; f; e; n; s; e;  ; (; M; T; D; );  ; s; e; n; s; o; r;  ; a; c; c; e; s; s;  ; l; o; g; s; ,;  ; M; o; b; i; l; e;  ; D; e; v; i; c; e;  ; M; a; n; a; g; e; m; e; n; t;  ; (; M; D; M; );  ; a; p; p; l; i; c; a; t; i; o; n;  ; i; n; v; e; n; t; o; r; y;  ; l; o; g; s; ,;  ; Z; e; e; k;  ; c; o; n; n; .; l; o; g; ,;  ; Z; e; e; k;  ; d; n; s; .; l; o; g; .;  ; D; a; t; a;  ; i; s;  ; s; o; u; r; c; e; d;  ; f; r; o; m;  ; c; o; r; p; o; r; a; t; e; -; m; a; n; a; g; e; d;  ; m; o; b; i; l; e;  ; d; e; v; i; c; e; s;  ; w; i; t; h;  ; M; T; D; /; M; D; M;  ; a; g; e; n; t; s; ,;  ; n; e; t; w; o; r; k;  ; t; a; p; s;  ; a; t;  ; c; o; r; p; o; r; a; t; e;  ; W; i; -; F; i; /; V; P; N;  ; p; o; i; n; t; s;  ; w; i; t; h;  ; Z; e; e; k;  ; s; e; n; s; o; r; s; ,;  ; M; D; M;  ; s; e; r; v; e; r; s; ,;  ; a; n; d;  ; D; N; S;  ; s; e; r; v; e; r; s; ,;  ; a; l; l;  ; a; g; g; r; e; g; a; t; e; d;  ; i; n;  ; a;  ; c; e; n; t; r; a; l;  ; S; I; E; M;  ; o; r;  ; d; a; t; a;  ; l; a; k; e; .; 
",last 90 days,": CREATE rule.
TRIGGER when non-allowlisted app accesses proximity sensor with state 'covered'.
IF triggered AND outbound data volume > (5 * 30-day baseline), GENERATE medium-severity alert.
ESCALATE to high if traffic stops within 10 seconds of state changing to 'uncovered'.
",playbooks/attack/mobile/T1628.002.yml
T1628.002: User Evasion,1e9d1a3b-4c6e-4b8a-9f0e-2d3c1a5b7d9c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,5,Does an application's network data transfer rate show a statistically significant increase specifically when the proximity sensor is covered?,"This question uses statistical analysis (Z-score) to detect abnormal network behavior linked to the proximity sensor. By establishing a baseline of normal network activity when the device is in use (sensor 'uncovered'), we can identify significant deviations from this norm. If an application's data transfer rate consistently shows a high Z-score (e.g., $$ Z > 3 $$) only during periods when the sensor is 'covered', it provides a quantifiable measure of suspicion that the app is using this state as a trigger for covert data transmission.
","M; o; b; i; l; e;  ; T; h; r; e; a; t;  ; D; e; f; e; n; s; e;  ; (; M; T; D; );  ; s; e; n; s; o; r;  ; a; c; c; e; s; s;  ; l; o; g; s; ,;  ; M; o; b; i; l; e;  ; D; e; v; i; c; e;  ; M; a; n; a; g; e; m; e; n; t;  ; (; M; D; M; );  ; a; p; p; l; i; c; a; t; i; o; n;  ; i; n; v; e; n; t; o; r; y;  ; l; o; g; s; ,;  ; Z; e; e; k;  ; c; o; n; n; .; l; o; g; ,;  ; Z; e; e; k;  ; d; n; s; .; l; o; g; .;  ; D; a; t; a;  ; i; s;  ; s; o; u; r; c; e; d;  ; f; r; o; m;  ; c; o; r; p; o; r; a; t; e; -; m; a; n; a; g; e; d;  ; m; o; b; i; l; e;  ; d; e; v; i; c; e; s;  ; w; i; t; h;  ; M; T; D; /; M; D; M;  ; a; g; e; n; t; s; ,;  ; n; e; t; w; o; r; k;  ; t; a; p; s;  ; a; t;  ; c; o; r; p; o; r; a; t; e;  ; W; i; -; F; i; /; V; P; N;  ; p; o; i; n; t; s;  ; w; i; t; h;  ; Z; e; e; k;  ; s; e; n; s; o; r; s; ,;  ; M; D; M;  ; s; e; r; v; e; r; s; ,;  ; a; n; d;  ; D; N; S;  ; s; e; r; v; e; r; s; ,;  ; a; l; l;  ; a; g; g; r; e; g; a; t; e; d;  ; i; n;  ; a;  ; c; e; n; t; r; a; l;  ; S; I; E; M;  ; o; r;  ; d; a; t; a;  ; l; a; k; e; .; 
",last 90 days,": FOR each app:
ESTABLISH baseline network rate during 'uncovered' states.
CONTINUOUSLY monitor 'covered' states.
FOR each 5-min interval in 'covered' state, CALCULATE Z-score of data rate.
IF $$ Z > 3 $$ for >2 consecutive intervals, GENERATE alert.
",playbooks/attack/mobile/T1628.002.yml
T1628.002: User Evasion,1e9d1a3b-4c6e-4b8a-9f0e-2d3c1a5b7d9c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,6,"Is there a logical contradiction where a machine learning model predicts the proximity sensor is 'covered' based on network traffic, while sensor logs report it is 'uncovered'?","This advanced question seeks to find a logical inconsistency created by evasive malware. A logistic regression model is trained to associate specific network patterns (like high data throughput) with the 'covered' proximity sensor state. During monitoring, if the model predicts a 'covered' state with high confidence because it sees a surge in network traffic, but the actual sensor data from MTD logs says the state is 'uncovered', it signals a major anomaly. The application is behaving as if the screen is obscured, but it isn't, which is highly indicative of malicious or evasive behavior that is malfunctioning or being tested.
","M; o; b; i; l; e;  ; T; h; r; e; a; t;  ; D; e; f; e; n; s; e;  ; (; M; T; D; );  ; s; e; n; s; o; r;  ; a; c; c; e; s; s;  ; l; o; g; s; ,;  ; M; o; b; i; l; e;  ; D; e; v; i; c; e;  ; M; a; n; a; g; e; m; e; n; t;  ; (; M; D; M; );  ; a; p; p; l; i; c; a; t; i; o; n;  ; i; n; v; e; n; t; o; r; y;  ; l; o; g; s; ,;  ; Z; e; e; k;  ; c; o; n; n; .; l; o; g; ,;  ; Z; e; e; k;  ; d; n; s; .; l; o; g; .;  ; D; a; t; a;  ; i; s;  ; s; o; u; r; c; e; d;  ; f; r; o; m;  ; c; o; r; p; o; r; a; t; e; -; m; a; n; a; g; e; d;  ; m; o; b; i; l; e;  ; d; e; v; i; c; e; s;  ; w; i; t; h;  ; M; T; D; /; M; D; M;  ; a; g; e; n; t; s; ,;  ; n; e; t; w; o; r; k;  ; t; a; p; s;  ; a; t;  ; c; o; r; p; o; r; a; t; e;  ; W; i; -; F; i; /; V; P; N;  ; p; o; i; n; t; s;  ; w; i; t; h;  ; Z; e; e; k;  ; s; e; n; s; o; r; s; ,;  ; M; D; M;  ; s; e; r; v; e; r; s; ,;  ; a; n; d;  ; D; N; S;  ; s; e; r; v; e; r; s; ,;  ; a; l; l;  ; a; g; g; r; e; g; a; t; e; d;  ; i; n;  ; a;  ; c; e; n; t; r; a; l;  ; S; I; E; M;  ; o; r;  ; d; a; t; a;  ; l; a; k; e; .; 
",last 90 days,": TRAIN logistic regression model to predict proximity state ('covered'/'uncovered') from network features.
DEPLOY model.
IF model predicts 'covered' with probability > 0.9 AND MTD log shows actual state is 'uncovered', GENERATE high-confidence alert.",playbooks/attack/mobile/T1628.002.yml
T1628.003: Conceal Multimedia Files,5e9d3b1a-8f7c-4d6e-a2b1-9c0f8e7d4a3b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,1,Has a '.nomedia' file been created by an application that is not a standard system or media application?,"This question is crucial for identifying attempts to hide media files from standard gallery or media player applications. Adversaries may use this technique to conceal captured images or videos before exfiltration. Detecting the creation of this file by an unexpected application (i.e., not a photo gallery or system process) is a strong indicator of malicious intent.","Mobile EDR File System Auditing Logs; Mobile MDM Application Inventory Logs; File systems of corporate-managed Android devices, specifically user-writable directories such as /storage/emulated/0/DCIM/, /storage/emulated/0/Pictures/, /storage/emulated/0/Download/, and application-specific data folders.",last 90 days,: ,playbooks/attack/mobile/T1628.003.yml
T1628.003: Conceal Multimedia Files,5e9d3b1a-8f7c-4d6e-a2b1-9c0f8e7d4a3b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,2,Was the '.nomedia' file created in a directory with an unusually complex or randomized name?,"Adversaries often use randomly generated directory names to further obfuscate the location of hidden files, making manual discovery more difficult. A high Shannon entropy score for the directory path suggests randomness and is a common characteristic of malware or attacker tools. This question helps prioritize alerts by focusing on '.nomedia' files placed in suspicious locations.","Mobile EDR File System Auditing Logs; Mobile MDM Application Inventory Logs; File systems of corporate-managed Android devices, specifically user-writable directories such as /storage/emulated/0/DCIM/, /storage/emulated/0/Pictures/, /storage/emulated/0/Download/, and application-specific data folders.",last 90 days,: ,playbooks/attack/mobile/T1628.003.yml
T1628.003: Conceal Multimedia Files,5e9d3b1a-8f7c-4d6e-a2b1-9c0f8e7d4a3b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,3,"Based on a machine learning model, what is the risk score associated with the '.nomedia' file creation event?","This question leverages machine learning to synthesize multiple data points into a single, actionable risk score. By considering features like directory entropy, application age, permissions, and whether it was sideloaded, the model can provide a more nuanced and accurate assessment than individual rules. A high-risk score indicates a strong likelihood of malicious activity, justifying an immediate and potentially automated response like device isolation.","Mobile EDR File System Auditing Logs; Mobile MDM Application Inventory Logs; File systems of corporate-managed Android devices, specifically user-writable directories such as /storage/emulated/0/DCIM/, /storage/emulated/0/Pictures/, /storage/emulated/0/Download/, and application-specific data folders.",last 90 days,: ,playbooks/attack/mobile/T1628.003.yml
T1628.003: Conceal Multimedia Files,5e9d3b1a-8f7c-4d6e-a2b1-9c0f8e7d4a3b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,4,Is a mobile device transferring multimedia files to a known malicious domain?,"This question directly targets the exfiltration phase of the attack. After hiding multimedia files, the adversary needs to transfer them off the device. Correlating network traffic to known malicious infrastructure (domains or IPs) from a threat intelligence feed provides high-fidelity evidence of data theft. Identifying multimedia file types (e.g., image/jpeg, video/mp4) in this traffic confirms the nature of the exfiltrated data.","Zeek files.log; Zeek http.log; Zeek conn.log; Zeek dns.log; Network egress points monitoring traffic from mobile device subnets, including corporate Wi-Fi gateways, VPN concentrators, and Cloud Access Security Brokers (CASB).",last 90 days,: ,playbooks/attack/mobile/T1628.003.yml
T1628.003: Conceal Multimedia Files,5e9d3b1a-8f7c-4d6e-a2b1-9c0f8e7d4a3b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,5,"Is a mobile device exfiltrating a large volume of multimedia files to a new, previously unseen destination?","Attackers often use newly registered or temporary domains for data exfiltration to avoid existing blocklists. This question focuses on behavioral anomalies rather than known bad indicators. A device suddenly sending a large amount of multimedia data (e.g., > 10MB) to a domain it has never contacted before is highly suspicious and warrants investigation, even if the destination is not on a threat intelligence list.","Zeek files.log; Zeek http.log; Zeek conn.log; Zeek dns.log; Network egress points monitoring traffic from mobile device subnets, including corporate Wi-Fi gateways, VPN concentrators, and Cloud Access Security Brokers (CASB).",last 90 days,: ,playbooks/attack/mobile/T1628.003.yml
T1628.003: Conceal Multimedia Files,5e9d3b1a-8f7c-4d6e-a2b1-9c0f8e7d4a3b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,6,Does the pattern of outbound multimedia traffic from a device deviate significantly from its normal behavior?,"This question employs advanced analytics to detect subtle or complex exfiltration patterns that might be missed by simple threshold-based rules. A time-series model can identify unusual spikes in data volume over time, while clustering can detect anomalous connection characteristics (e.g., long durations, unusual packet sizes). Combining these methods helps to identify sophisticated adversaries attempting to blend in with normal traffic.","Zeek files.log; Zeek http.log; Zeek conn.log; Zeek dns.log; Network egress points monitoring traffic from mobile device subnets, including corporate Wi--Fi gateways, VPN concentrators, and Cloud Access Security Brokers (CASB).",last 90 days,: ,playbooks/attack/mobile/T1628.003.yml
T1628: Hide Artifacts,9a8b7c6d-5e4f-4a3b-2c1d-0e9f8a7b6c5d,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",T; A; 0; 0; 3; 0; :;  ; D; e; f; e; n; s; e;  ; E; v; a; s; i; o; n,n; o; n; e,1,Are there any installed applications without a launcher icon that are not on the corporate whitelist and match known threats?,"This question aims to identify potentially malicious applications that are hiding from the user by not having a visible icon in the application launcher. The query first finds all such 'iconless' apps and filters out legitimate, known applications using a corporate whitelist. The remaining suspicious apps are then checked against a threat intelligence platform to see if they are known malware or part of a threat campaign. A match indicates a high-probability threat on the device.","M; D; M; /; U; E; M;  ; A; p; p; l; i; c; a; t; i; o; n;  ; I; n; v; e; n; t; o; r; y;  ; L; o; g; ,;  ; C; o; r; p; o; r; a; t; e;  ; A; p; p; l; i; c; a; t; i; o; n;  ; W; h; i; t; e; l; i; s; t;  ; D; a; t; a; b; a; s; e; ,;  ; T; h; r; e; a; t;  ; I; n; t; e; l; l; i; g; e; n; c; e;  ; P; l; a; t; f; o; r; m;  ; (; T; I; P; );  ; D; a; t; a; ,;  ; M; D; M; /; U; E; M;  ; m; a; n; a; g; e; m; e; n; t;  ; c; o; n; s; o; l; e;  ; a; n; d;  ; u; n; d; e; r; l; y; i; n; g;  ; d; a; t; a; b; a; s; e; ,;  ; T; h; e;  ; p; o; p; u; l; a; t; i; o; n;  ; o; f;  ; m; a; n; a; g; e; d;  ; c; o; r; p; o; r; a; t; e; -; o; w; n; e; d;  ; a; n; d;  ; B; Y; O; D;  ; m; o; b; i; l; e;  ; d; e; v; i; c; e; s; .",last 90 days,": SELECT package_name, hash FROM mdm_logs WHERE has_launcher_icon IS false AND package_name NOT IN (SELECT package_name FROM whitelist); FOREACH result, QUERY tip_data WHERE hash = result.hash;",playbooks/attack/mobile/T1628.yml
T1628: Hide Artifacts,9a8b7c6d-5e4f-4a3b-2c1d-0e9f8a7b6c5d,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",T; A; 0; 0; 3; 0; :;  ; D; e; f; e; n; s; e;  ; E; v; a; s; i; o; n,n; o; n; e,2,"Can we identify suspicious iconless applications or devices by analyzing their rarity, density, or permission complexity?","This question uses statistical methods to surface anomalies that might indicate malicious activity, even without a direct threat intelligence match. It operates on three principles: 1) Malicious apps are often not widely distributed, so rare apps are suspicious. 2) A device with an unusually high number of hidden apps may be compromised. 3) Malicious apps may request an abnormally large or diverse set of permissions, which can be measured by Shannon entropy. By flagging outliers in these three areas, analysts can prioritize devices and applications for deeper investigation.","M; D; M; /; U; E; M;  ; A; p; p; l; i; c; a; t; i; o; n;  ; I; n; v; e; n; t; o; r; y;  ; L; o; g; ,;  ; C; o; r; p; o; r; a; t; e;  ; A; p; p; l; i; c; a; t; i; o; n;  ; W; h; i; t; e; l; i; s; t;  ; D; a; t; a; b; a; s; e; ,;  ; T; h; r; e; a; t;  ; I; n; t; e; l; l; i; g; e; n; c; e;  ; P; l; a; t; f; o; r; m;  ; (; T; I; P; );  ; D; a; t; a; ,;  ; M; D; M; /; U; E; M;  ; m; a; n; a; g; e; m; e; n; t;  ; c; o; n; s; o; l; e;  ; a; n; d;  ; u; n; d; e; r; l; y; i; n; g;  ; d; a; t; a; b; a; s; e; ,;  ; T; h; e;  ; p; o; p; u; l; a; t; i; o; n;  ; o; f;  ; m; a; n; a; g; e; d;  ; c; o; r; p; o; r; a; t; e; -; o; w; n; e; d;  ; a; n; d;  ; B; Y; O; D;  ; m; o; b; i; l; e;  ; d; e; v; i; c; e; s; .",last 90 days,": 1. CALCULATE prevalence of all iconless, non-whitelisted apps; FLAG apps with prevalence < 5th percentile. 2. COUNT iconless, non-whitelisted apps per device; FLAG devices with count > 98th percentile. 3. CALCULATE permission entropy for iconless apps; FLAG apps with entropy > (mean_entropy_whitelisted + 2 * std_dev).",playbooks/attack/mobile/T1628.yml
T1628: Hide Artifacts,9a8b7c6d-5e4f-4a3b-2c1d-0e9f8a7b6c5d,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",T; A; 0; 0; 3; 0; :;  ; D; e; f; e; n; s; e;  ; E; v; a; s; i; o; n,n; o; n; e,3,"Can a machine learning model predict whether a non-whitelisted, iconless application is malicious?","This question involves building a predictive model to automate the detection of malicious hidden applications. By training a classifier (like Random Forest) on features such as installation rarity, app store source, and permission patterns, the model learns to distinguish between benign and malicious characteristics. Once deployed, it can score new applications in near-real-time, automatically flagging those with a high probability of being malicious ($$ > 0.85 $$) for quarantine and analyst review, thereby scaling the detection process.","M; D; M; /; U; E; M;  ; A; p; p; l; i; c; a; t; i; o; n;  ; I; n; v; e; n; t; o; r; y;  ; L; o; g; ,;  ; C; o; r; p; o; r; a; t; e;  ; A; p; p; l; i; c; a; t; i; o; n;  ; W; h; i; t; e; l; i; s; t;  ; D; a; t; a; b; a; s; e; ,;  ; T; h; r; e; a; t;  ; I; n; t; e; l; l; i; g; e; n; c; e;  ; P; l; a; t; f; o; r; m;  ; (; T; I; P; );  ; D; a; t; a; ,;  ; M; D; M; /; U; E; M;  ; m; a; n; a; g; e; m; e; n; t;  ; c; o; n; s; o; l; e;  ; a; n; d;  ; u; n; d; e; r; l; y; i; n; g;  ; d; a; t; a; b; a; s; e; ,;  ; T; h; e;  ; p; o; p; u; l; a; t; i; o; n;  ; o; f;  ; m; a; n; a; g; e; d;  ; c; o; r; p; o; r; a; t; e; -; o; w; n; e; d;  ; a; n; d;  ; B; Y; O; D;  ; m; o; b; i; l; e;  ; d; e; v; i; c; e; s; .",last 90 days,": TRAIN classifier_model ON labeled_data(features: prevalence, source, permissions_count, permissions_entropy, high_risk_permissions); FOR new_app, PREDICT score = classifier_model(new_app.features); IF score > 0.85, TRIGGER alert;",playbooks/attack/mobile/T1628.yml
T1628: Hide Artifacts,9a8b7c6d-5e4f-4a3b-2c1d-0e9f8a7b6c5d,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",T; A; 0; 0; 3; 0; :;  ; D; e; f; e; n; s; e;  ; E; v; a; s; i; o; n,n; o; n; e,4,"Are there any running processes on devices that do not belong to a known, installed application and match a known threat?","This question seeks to identify 'rogue' processes that may be running from sources other than a properly installed application, a technique used by adversaries to evade detection (e.g., fileless malware). The query compares the list of running processes from a Mobile Threat Protection (MTP) agent against the official application inventory from MDM. Any process that cannot be mapped to an installed app is considered suspicious and is checked against threat intelligence feeds for known indicators of compromise.","M; o; b; i; l; e;  ; T; h; r; e; a; t;  ; P; r; o; t; e; c; t; i; o; n;  ; (; M; T; P; );  ; P; r; o; c; e; s; s;  ; E; x; e; c; u; t; i; o; n;  ; L; o; g; ,;  ; M; D; M; /; U; E; M;  ; A; p; p; l; i; c; a; t; i; o; n;  ; I; n; v; e; n; t; o; r; y;  ; L; o; g; ,;  ; T; h; r; e; a; t;  ; I; n; t; e; l; l; i; g; e; n; c; e;  ; P; l; a; t; f; o; r; m;  ; (; T; I; P; );  ; D; a; t; a; ,;  ; M; o; b; i; l; e;  ; T; h; r; e; a; t;  ; P; r; o; t; e; c; t; i; o; n;  ; (; M; T; P; );  ; p; l; a; t; f; o; r; m;  ; c; o; n; s; o; l; e; ,;  ; M; D; M; /; U; E; M;  ; m; a; n; a; g; e; m; e; n; t;  ; c; o; n; s; o; l; e; ,;  ; E; n; d; p; o; i; n; t;  ; f; i; l; e;  ; s; y; s; t; e; m; s;  ; a; n; d;  ; p; r; o; c; e; s; s;  ; t; a; b; l; e; s;  ; o; n;  ; m; a; n; a; g; e; d;  ; m; o; b; i; l; e;  ; d; e; v; i; c; e; s; .",last 90 days,": FOR each device: GET running_processes from MTP; GET installed_apps from MDM; FIND unmapped_processes = running_processes - installed_apps; FOREACH process in unmapped_processes, QUERY tip_data WHERE hash = process.hash;",playbooks/attack/mobile/T1628.yml
T1628: Hide Artifacts,9a8b7c6d-5e4f-4a3b-2c1d-0e9f8a7b6c5d,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",T; A; 0; 0; 3; 0; :;  ; D; e; f; e; n; s; e;  ; E; v; a; s; i; o; n,n; o; n; e,5,Do any devices have a set of unmapped (rogue) processes that significantly deviates from a known-good baseline?,"This question uses a baselining approach to detect anomalies. It acknowledges that some unmapped processes might be legitimate (e.g., system processes not tracked by MDM). A 'golden' baseline of these normal, unmapped processes is created from trusted devices. The set of unmapped processes on every other device is then compared to this baseline using Jaccard similarity. A low score ($$ < 0.5 $$) means the device has a very different set of unmapped processes, indicating a significant deviation that could be caused by malware or an unauthorized tool.","M; o; b; i; l; e;  ; T; h; r; e; a; t;  ; P; r; o; t; e; c; t; i; o; n;  ; (; M; T; P; );  ; P; r; o; c; e; s; s;  ; E; x; e; c; u; t; i; o; n;  ; L; o; g; ,;  ; M; D; M; /; U; E; M;  ; A; p; p; l; i; c; a; t; i; o; n;  ; I; n; v; e; n; t; o; r; y;  ; L; o; g; ,;  ; T; h; r; e; a; t;  ; I; n; t; e; l; l; i; g; e; n; c; e;  ; P; l; a; t; f; o; r; m;  ; (; T; I; P; );  ; D; a; t; a; ,;  ; M; o; b; i; l; e;  ; T; h; r; e; a; t;  ; P; r; o; t; e; c; t; i; o; n;  ; (; M; T; P; );  ; p; l; a; t; f; o; r; m;  ; c; o; n; s; o; l; e; ,;  ; M; D; M; /; U; E; M;  ; m; a; n; a; g; e; m; e; n; t;  ; c; o; n; s; o; l; e; ,;  ; E; n; d; p; o; i; n; t;  ; f; i; l; e;  ; s; y; s; t; e; m; s;  ; a; n; d;  ; p; r; o; c; e; s; s;  ; t; a; b; l; e; s;  ; o; n;  ; m; a; n; a; g; e; d;  ; m; o; b; i; l; e;  ; d; e; v; i; c; e; s; .",last 90 days,": CREATE baseline_set of unmapped processes from golden_devices; FOR each device: GET device_set of unmapped processes; CALCULATE jaccard_similarity(baseline_set, device_set); IF similarity < 0.5, FLAG device;",playbooks/attack/mobile/T1628.yml
T1628: Hide Artifacts,9a8b7c6d-5e4f-4a3b-2c1d-0e9f8a7b6c5d,technique,2025-10-01,2025-10-01,"Z; a; c; h; a; r; y;  ; S; z; e; w; c; z; y; k; ,;  ; A; s; k;  ; S; a; g; e",T; A; 0; 0; 3; 0; :;  ; D; e; f; e; n; s; e;  ; E; v; a; s; i; o; n,n; o; n; e,6,Can a time-series model detect an abnormal increase in the number of unmapped processes on a device over time?,"This question applies machine learning to monitor the behavior of unmapped processes over time. Instead of just looking at a snapshot, it analyzes the trend of how many unmapped processes are running. A model like an LSTM Autoencoder is trained to recognize the normal rhythm of these processes appearing and disappearing. If a device suddenly shows a sustained, high count of unmapped processes that doesn't fit the learned pattern, the model flags it as an anomaly. This is effective for detecting threats that establish persistence by running continuously in the background.","M; o; b; i; l; e;  ; T; h; r; e; a; t;  ; P; r; o; t; e; c; t; i; o; n;  ; (; M; T; P; );  ; P; r; o; c; e; s; s;  ; E; x; e; c; u; t; i; o; n;  ; L; o; g; ,;  ; M; D; M; /; U; E; M;  ; A; p; p; l; i; c; a; t; i; o; n;  ; I; n; v; e; n; t; o; r; y;  ; L; o; g; ,;  ; T; h; r; e; a; t;  ; I; n; t; e; l; l; i; g; e; n; c; e;  ; P; l; a; t; f; o; r; m;  ; (; T; I; P; );  ; D; a; t; a; ,;  ; M; o; b; i; l; e;  ; T; h; r; e; a; t;  ; P; r; o; t; e; c; t; i; o; n;  ; (; M; T; P; );  ; p; l; a; t; f; o; r; m;  ; c; o; n; s; o; l; e; ,;  ; M; D; M; /; U; E; M;  ; m; a; n; a; g; e; m; e; n; t;  ; c; o; n; s; o; l; e; ,;  ; E; n; d; p; o; i; n; t;  ; f; i; l; e;  ; s; y; s; t; e; m; s;  ; a; n; d;  ; p; r; o; c; e; s; s;  ; t; a; b; l; e; s;  ; o; n;  ; m; a; n; a; g; e; d;  ; m; o; b; i; l; e;  ; d; e; v; i; c; e; s; .",last 90 days,": FOR each device, CREATE time_series of hourly_unmapped_process_count; TRAIN lstm_autoencoder_model ON historical_fleet_data; FOR each device, CALCULATE reconstruction_error = model(device_time_series); IF error > dynamic_threshold, TRIGGER alert;",playbooks/attack/mobile/T1628.yml
T1629.002: Device Lockout,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,1,Has an application with 'Device Administrator' privileges been identified as malicious by threat intelligence feeds?,This question aims to detect the most straightforward case of a malicious application gaining powerful permissions. An application that has the ability to lock a device and is also a known malicious indicator presents a high-confidence threat and requires immediate attention.,MDM application inventory and event logs; Mobile EDR process and permission grant logs; Android Logcat; Threat Intelligence Feeds; NAI: Corporate-managed mobile devices; Mobile Device Management (MDM) servers; Application Vetting and Sandboxing Environments; Enterprise Application Stores,last 90 days,"pseudocode: QUERY MDM/EDR logs for 'Device Admin Enabled' events. FOREACH event, JOIN app package/cert with threat intel feed. ALERT on match.",playbooks/attack/mobile/T1629.002.yml
T1629.002: Device Lockout,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,2,"Has an application gained 'Device Administrator' privileges and exhibited risky characteristics, such as being from an unknown source or being unusually rare?","This question looks for suspicious indicators that, when combined, suggest a malicious application, even if it is not yet on a threat intelligence blocklist. Sideloaded, non-standard, and rare applications gaining high privileges are inherently risky and warrant investigation.",MDM application inventory and event logs; Mobile EDR process and permission grant logs; Android Logcat; NAI: Corporate-managed mobile devices; Mobile Device Management (MDM) servers; Application Vetting and Sandboxing Environments; Enterprise Application Stores,last 90 days,"pseudocode: QUERY 'Device Admin Enabled' events. FOREACH event, CALCULATE risk score based on (is not allowlisted, is sideloaded, is rare). ALERT if score > threshold.",playbooks/attack/mobile/T1629.002.yml
T1629.002: Device Lockout,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,3,Can a machine learning model identify applications that are likely malicious based on characteristics observed when they request 'Device Administrator' rights?,"This question uses a predictive model to proactively identify potentially malicious applications. By analyzing features like installation source, permission request timing, and certificate details, the model can flag suspicious apps that might evade simpler rule-based detections.",MDM application inventory and event logs; Mobile EDR process and permission grant logs; Android Logcat; NAI: Corporate-managed mobile devices; Mobile Device Management (MDM) servers; Application Vetting and Sandboxing Environments; Enterprise Application Stores,last 90 days,"pseudocode: APPLY logistic regression model to apps requesting 'Device Admin' rights. FEATURES include install source, permission grant timing, cert details. FLAG apps with prediction > 0.85.",playbooks/attack/mobile/T1629.002.yml
T1629.002: Device Lockout,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,4,Is a privileged mobile application (with 'Device Administrator' or overlay permissions) communicating with known malicious network infrastructure?,This question checks for command-and-control (C2) or data exfiltration activity from a high-privilege application. Communication with a known malicious endpoint from an application with the ability to lock a device is a strong indicator of compromise.,Zeek conn.log; Zeek dns.log; Mobile EDR Network Flow Logs; MDM Application Inventory Logs; NAI: Our organization's internet gateway; Corporate DNS resolvers; Network proxies; VPN Concentrators,last 90 days,pseudocode: JOIN MDM logs (for privileged apps) with network logs (Zeek conn.log) on device IP. ALERT if privileged app communicates with destination on threat intel blocklist.,playbooks/attack/mobile/T1629.002.yml
T1629.002: Device Lockout,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,5,"Is a privileged mobile application attempting to resolve unusually random-looking domain names, suggesting the use of a Domain Generation Algorithm (DGA)?",DGAs are often used by malware to dynamically find C2 servers. A privileged application making high-entropy DNS queries is highly suspicious and may be trying to establish a resilient C2 channel before locking the device.,Zeek dns.log; Mobile EDR Network Flow Logs; MDM Application Inventory Logs; NAI: Our organization's internet gateway; Corporate DNS resolvers; Network proxies; VPN Concentrators,last 90 days,"pseudocode: FROM Zeek dns.log, CALCULATE entropy for queried domains. FOR privileged apps, ALERT if a new query's entropy > 98th percentile of baseline.",playbooks/attack/mobile/T1629.002.yml
T1629.002: Device Lockout,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,6,"Is a privileged mobile application exhibiting anomalous network traffic patterns, such as an unusual spike in outbound data transfer?","This question aims to detect data staging or exfiltration by identifying significant deviations from an application's normal network behavior. A sudden, large data transfer from a privileged app could precede a ransomware-style lockout and must be investigated.",Zeek conn.log; Mobile EDR Network Flow Logs; NAI: Our organization's internet gateway; Corporate DNS resolvers; Network proxies; VPN Concentrators,last 90 days,pseudocode: MODEL hourly outbound data volume per app/user using time-series anomaly detection. ALERT on significant anomalies identified by the model.,playbooks/attack/mobile/T1629.002.yml
T1629.002: Device Lockout,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,7,Has a sideloaded application been installed that requests the 'SYSTEM_ALERT_WINDOW' (overlay) permission?,"This question identifies a high-risk combination of behaviors. Sideloading bypasses app store security checks, and the overlay permission can be used to create fake login screens or lock the user out of their device. The combination warrants immediate investigation.",Mobile Application Vetting Scans; MDM Application Installation Logs; NAI: Application sandboxing environments; Corporate-managed mobile devices; Enterprise app stores and repositories; Mobile Endpoint Detection and Response (EDR) platform,last 90 days,pseudocode: JOIN app vetting data with MDM logs. ALERT if app is installed from 'unknown source' AND requests 'SYSTEM_ALERT_WINDOW' permission.,playbooks/attack/mobile/T1629.002.yml
T1629.002: Device Lockout,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,8,Is an application with overlay permissions running in the foreground for an anomalously long time without any user interaction?,This is a key indicator of a screen-locking attack. A legitimate application typically requires user input. An overlay that runs for an extended period without any taps or swipes is likely trying to prevent the user from accessing their device.,Mobile EDR Process and Activity Logs; Android Logcat; NAI: Corporate-managed mobile devices; Mobile Endpoint Detection and Response (EDR) platform,last 90 days,"pseudocode: FOR apps with overlay permission, CALCULATE baseline session durations. ALERT if current session duration > 98th percentile AND has zero user input events.",playbooks/attack/mobile/T1629.002.yml
T1629.002: Device Lockout,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,9,"Can a machine learning model detect anomalous application sessions that may indicate an overlay attack, based on features like session duration, resource usage, and lack of user input?","This question uses a sophisticated, multi-variate approach to detect overlay attacks. By considering multiple features simultaneously (CPU, memory, network, user input, duration), a model can identify complex anomalies that might be missed by single-metric rules.",Mobile EDR Process and Activity Logs; NAI: Corporate-managed mobile devices; Mobile Endpoint Detection and Response (EDR) platform,last 90 days,"pseudocode: APPLY Isolation Forest model to app sessions. FEATURES include duration, CPU, memory, network, user input count. FLAG sessions with anomaly score in top 1%.",playbooks/attack/mobile/T1629.002.yml
T1629.003: Disable or Modify Tools,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,1,"Are there any immediate indications of unauthorized changes to device administrator privileges, such as revoking security tool access or granting it to unapproved apps?","This question addresses the most direct evidence of tampering with security controls at the privilege level. An adversary may attempt to remove a security application's device administrator rights to render it ineffective or grant those same rights to a malicious application to gain deeper system control. This is a high-fidelity indicator of a targeted attack, and a real-time alert is critical for a rapid response.
",MDM/UEM audit logs; Application Inventory List; Centralized log aggregator (SIEM); MDM/UEM administrative servers; Fleet of managed mobile endpoints,last 90 days,: SEARCH MDM/UEM logs WHERE (event_code = 'device_admin_revoked' AND target_app IN [list_of_required_security_tools]) OR (event_code = 'device_admin_granted' AND target_app NOT IN [list_of_approved_admin_apps]),playbooks/attack/mobile/T1629.003.yml
T1629.003: Disable or Modify Tools,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,2,Is there a statistically unusual pattern of an application gaining device administrator privileges on a specific device over time?,"This question aims to detect more subtle or low-and-slow attacks that a simple, static rule might miss. By establishing a baseline of normal behavior for each device, we can identify when a device starts exhibiting an abnormal frequency of privilege escalation events. A sudden spike above the 99th percentile of its own history suggests a departure from normal use and could indicate that the device is compromised or being prepared for an attack.
",MDM/UEM audit logs; Application Inventory List; Centralized log aggregator (SIEM); MDM/UEM administrative servers; Fleet of managed mobile endpoints,last 90 days,": FOR each_device, CALCULATE 30-day baseline of 'device_admin_granted' counts for unapproved apps. ALERT if daily_count > 99th_percentile(baseline).",playbooks/attack/mobile/T1629.003.yml
T1629.003: Disable or Modify Tools,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,3,Can we predictively identify and automatically respond to malicious device administrator changes using machine learning?,"This question moves from reactive detection to proactive, automated defense. By training a machine learning model on various contextual features (e.g., app permissions, installation source, time of day), it's possible to score the likelihood that a privilege change is malicious. This allows for an automated, high-confidence response, such as quarantining the device via an MDM API call, thereby neutralizing a threat before a human analyst can even begin an investigation.
",MDM/UEM audit logs; Application Inventory List; Centralized log aggregator (SIEM); MDM/UEM administrative servers; Fleet of managed mobile endpoints,last 90 days,": TRAIN classification model on features (app_name, permissions, source, time). PREDICT if admin_change_event is malicious. IF score > 0.9, TRIGGER automated device quarantine.",playbooks/attack/mobile/T1629.003.yml
T1629.003: Disable or Modify Tools,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,4,"Has the Mobile Threat Defense (MTD) agent on any device been explicitly reported as disabled, tampered with, or stopped?","This question focuses on a critical alert directly from the MTD platform itself. An adversary's primary goal when evading defenses is to disable the tools that would detect them. An event explicitly stating the MTD agent has been stopped or tampered with is a clear, unambiguous signal that the device's security posture has been compromised and requires immediate investigation.
",MTD agent status logs; MTD alert logs; MTD management console; Centralized log aggregator (SIEM); Managed mobile endpoints,last 90 days,": SEARCH MTD logs WHERE agent_status IN ('disabled', 'tampered', 'stopped'). ALERT with device ID and user details.",playbooks/attack/mobile/T1629.003.yml
T1629.003: Disable or Modify Tools,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,5,Is there a statistical anomaly in the number of MTD agent tampering or disabling events for a specific device model or OS version?,"This question helps to identify widespread issues beyond a single device. A spike in tampering events concentrated on a particular device model or OS version could indicate a newly discovered vulnerability or a targeted campaign exploiting a weakness in that specific platform. Detecting this trend allows security teams to take broader action, such as issuing patches or warnings for all similar devices.
",MTD agent status logs; MTD alert logs; MTD management console; Centralized log aggregator (SIEM); Managed mobile endpoints,last 90 days,": FOR each_device_group (by model/OS), CALCULATE 14-day moving average of tamper_events. ALERT if daily_count > (moving_average + 3 * std_dev).",playbooks/attack/mobile/T1629.003.yml
T1629.003: Disable or Modify Tools,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,6,"Can we use machine learning to distinguish between benign MTD agent stops and malicious tampering, and automate a response?","This question addresses the challenge of alert fatigue. MTD agents can stop for benign reasons, such as OS updates or user-initiated reboots. A supervised machine learning model can be trained to differentiate these normal events from malicious tampering by analyzing surrounding context, like the time since the last successful check-in or the presence of a concurrent root detection alert. This focuses analyst attention on high-fidelity threats and enables confident, automated isolation of compromised devices.
",MTD agent status logs; MTD alert logs; MTD management console; Centralized log aggregator (SIEM); Managed mobile endpoints,last 90 days,": TRAIN classifier on features (agent_status, time_since_checkin, root_alert, new_app_install). PREDICT if event is 'malicious tampering'. IF true, ISOLATE device.",playbooks/attack/mobile/T1629.003.yml
T1629.003: Disable or Modify Tools,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,7,Has any device stopped sending its required MTD agent heartbeat signal within an expected static time window?,"This question provides a fundamental check for agent health. If an MTD agent is disabled or removed, it will stop sending its periodic heartbeat signal. By monitoring for the absence of this signal beyond a static threshold (e.g., 60 minutes), security teams can get a medium-severity notification that a device has gone offline unexpectedly, prompting a manual check of its status. It's a simple but effective safety net.
",MTD agent heartbeat logs; Zeek conn.log; MTD management console; Network sensors at internet gateways; Centralized log aggregator (SIEM),last 90 days,: CREATE stateful rule to track last_heartbeat_timestamp for each device. ALERT if (current_time - last_heartbeat_timestamp) > 60 minutes.,playbooks/attack/mobile/T1629.003.yml
T1629.003: Disable or Modify Tools,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,8,"Has any device failed to check-in within its own statistically normal heartbeat interval, and can this be correlated with a lack of network traffic?","This question refines the basic heartbeat check by creating a dynamic, per-device baseline. Not all devices check in at the same rate. By calculating the mean and standard deviation of check-in intervals for each device, we can create a much more accurate threshold for alerting. An alert is triggered only when a device deviates significantly from its own established pattern. Corroborating this with network logs to confirm the device isn't communicating with MTD servers adds a powerful layer of confirmation that the agent is truly offline and not just experiencing network latency.
",MTD agent heartbeat logs; Zeek conn.log; MTD management console; Network sensors at internet gateways; Centralized log aggregator (SIEM),last 90 days,": FOR each_device, CALCULATE baseline heartbeat interval (mean, std_dev). ALERT if time_since_last_heartbeat > (mean + 4 * std_dev). THEN, QUERY network logs to confirm no traffic from device_ip to MTD_server_ip.",playbooks/attack/mobile/T1629.003.yml
T1629.003: Disable or Modify Tools,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,9,Can we use time-series forecasting to predict when a device's MTD agent should check in and alert on significant deviations?,"This question represents the most advanced method of heartbeat analysis. Instead of relying on static or simple statistical baselines, a time-series model (like Prophet or LSTM) can learn complex patterns in a device's check-in behavior, including time-of-day or day-of-week variations. The model then predicts a window for the next expected check-in. An alert is generated only if the device fails to check in within this predicted window, representing a statistically significant anomaly that is highly indicative of a problem.
",MTD agent heartbeat logs; Zeek conn.log; MTD management console; Network sensors at internet gateways; Centralized log aggregator (SIEM),last 90 days,": FOR each_device, TRAIN time-series model on heartbeat history. PREDICT next_checkin_interval. ALERT if actual_checkin falls outside prediction_interval.",playbooks/attack/mobile/T1629.003.yml
T1629.003: Disable or Modify Tools,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,10,"Are any Android devices reporting a non-compliant SELinux state, and can we automate an immediate response?","This question targets a critical security control specific to Android. SELinux (Security-Enhanced Linux) enforces mandatory access controls, and it should always be in an 'enforcing' state on a managed device. An adversary may disable it or set it to 'permissive' to bypass system protections. This is a severe security degradation, and the detection of this state should trigger an immediate, automated response, such as moving the device to a restricted network to contain the potential threat.
",MDM/UEM compliance reports; MTD security posture scan logs; MDM/UEM and MTD administrative consoles; Centralized log aggregator (SIEM); Fleet of managed Android devices,last 90 days,": SEARCH compliance logs WHERE device_os = 'Android' AND selinux_status IN ('permissive', 'disabled'). TRIGGER alert and MOVE device to restricted_network_group.",playbooks/attack/mobile/T1629.003.yml
T1629.003: Disable or Modify Tools,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,11,Is there an abnormal level of change across multiple key security settings on any single Android device?,"This question seeks to identify an adversary who is making multiple configuration changes simultaneously to disable defenses. While a single change might not be suspicious, a flurry of changes to key settings (like SELinux status, root status, developer mode) is highly abnormal. By calculating the Shannon entropy of a string representing these settings, we can measure the 'randomness' or 'chaos' of the device's configuration. A sudden spike in entropy compared to the device's baseline indicates a suspicious level of activity that warrants investigation.
",MDM/UEM compliance reports; MTD security posture scan logs; MDM/UEM and MTD administrative consoles; Centralized log aggregator (SIEM); Fleet of managed Android devices,last 90 days,": FOR each_device, CALCULATE daily entropy of security_settings_string. ALERT if daily_entropy > 98th_percentile(baseline_entropy).",playbooks/attack/mobile/T1629.003.yml
T1629.003: Disable or Modify Tools,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,12,Can we use an unsupervised machine learning model to identify Android devices that are outliers from the fleet's secure baseline based on their security posture?,"This question aims to find the 'unknown unknowns' by using anomaly detection. Instead of looking for a specific bad configuration, an unsupervised model like an Isolation Forest can learn what a 'normal' secure device looks like based on the entire fleet. It then assigns an anomaly score to each device. Devices with high scores are statistical outliers; they are different from their peers in ways that may not be captured by predefined rules. These outliers should be flagged for manual review, as they may represent novel attacks or previously unknown misconfigurations.
",MDM/UEM compliance reports; MTD security posture scan logs; MDM/UEM and MTD administrative consoles; Centralized log aggregator (SIEM); Fleet of managed Android devices,last 90 days,: TRAIN Isolation Forest model on feature set from all Android devices. CALCULATE anomaly score for each device. FLAG devices with scores in top 2% for review.,playbooks/attack/mobile/T1629.003.yml
T1631: Process Injection,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0029: Privilege Escalation; TA0030: Defense Evasion,n; o; n; e,1,How can we detect sensitive API calls on mobile devices that might indicate process injection and correlate them with known malicious network infrastructure?,"This question aims to identify the initial, overt signs of process injection, such as the use of debugging or memory manipulation APIs (`ptrace`, `dlopen`, `mach_vm_write`) by non-standard processes. Correlating this on-device activity with network logs provides crucial context, helping to validate the threat by linking it to known command-and-control (C2) servers or malicious domains. Answering this helps catch attackers in the early stages of privilege escalation.","MDM/EDR Process Activity Logs; Android logcat; iOS Unified Logs; Zeek dns.log; Zeek conn.log; Threat Intelligence Feeds; Managed mobile devices with EDR/MDM agents, network gateways monitoring corporate Wi-Fi and VPN traffic, and centralized log aggregation platforms such as a SIEM or Data Lake.",last 90 days,"Pseudocode: SEARCH EDR logs for process events WHERE (api_call IN ['ptrace', 'mach_vm_write'] OR (api_call = 'dlopen' AND library_path NOT IN '/system/lib/')) AND process_signature NOT IN [allowlisted_developer_certs] AND process_name NOT IN [allowlisted_debug_tools]. FOR each result, SEARCH network logs (dns.log, conn.log) WHERE source_ip = event.device_ip AND timestamp WITHIN 1 minute of event.timestamp. IF destination_ip OR destination_domain IN [threat_intel_feed], THEN ALERT.",playbooks/attack/mobile/T1631.yml
T1631: Process Injection,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0029: Privilege Escalation; TA0030: Defense Evasion,n; o; n; e,2,"Are any mobile applications loading rare or unusual dynamic libraries, and does this activity coincide with DNS requests for high-entropy domains, suggesting DGA activity?","This question focuses on a more subtle detection method. Attackers may inject a custom, malicious library into a legitimate process, which would be rare across the device fleet. High-entropy domain requests, calculated using the Shannon entropy formula $$ H(X) = -\sum_{i=1}^{n} P(x_i) \log_2 P(x_i) $$, are a common indicator of Domain Generation Algorithms (DGAs) used for C2 communication. Combining these two weak signals—a rare library load and a suspicious DNS query—creates a high-fidelity alert for advanced process injection attacks.","MDM/EDR Process Activity Logs; Zeek dns.log; Managed mobile devices with EDR/MDM agents, network gateways monitoring corporate Wi-Fi and VPN traffic, and centralized log aggregation platforms such as a SIEM or Data Lake.",last 90 days,"Pseudocode: DEFINE rare_library_events AS (SEARCH EDR library_load logs GROUP BY library, application | WHERE prevalence < 0.01). DEFINE high_entropy_dns AS (SEARCH dns.log | CALCULATE shannon_entropy(domain_name) | WHERE entropy_score > 99th_percentile_baseline). JOIN rare_library_events and high_entropy_dns ON device_id WHERE event_timestamps are within 2 minutes. IF match, THEN ALERT.",playbooks/attack/mobile/T1631.yml
T1631: Process Injection,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0029: Privilege Escalation; TA0030: Defense Evasion,n; o; n; e,3,"Are high-risk mobile applications exhibiting anomalous system call sequences, and does this behavior correlate with network connections to new, unseen IP addresses?","This question addresses the need to detect in-memory threats that don't drop new files. By modeling the normal sequence of system calls for an application with an LSTM autoencoder, we can identify when a process deviates from its expected behavior, which could be caused by injected code. Correlating this behavioral anomaly with a connection to a 'newly observed' IP address (one not seen in the last 30 days) strengthens the signal, as this is a common pattern for malware establishing a C2 channel.","MDM/EDR Process Activity Logs; Zeek conn.log; Managed mobile devices with EDR/MDM agents, network gateways monitoring corporate Wi-Fi and VPN traffic, and centralized log aggregation platforms such as a SIEM or Data Lake.",last 90 days,"Pseudocode: SEARCH LSTM model_output for events WHERE reconstruction_error > 99.9th_percentile_threshold. FOR each anomaly, GET device_id and timestamp. SEARCH conn.log for connections WHERE source_ip = anomaly.device_ip AND timestamp is within 5 minutes of anomaly.timestamp. IF destination_ip was not seen for that device_id in the last 30 days, THEN ALERT.",playbooks/attack/mobile/T1631.yml
T1631: Process Injection,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0029: Privilege Escalation; TA0030: Defense Evasion,n; o; n; e,4,Are trusted mobile applications making network connections that are inconsistent with their known behavior or are associated with known malicious indicators?,"This question targets defense evasion, where an attacker hides within a legitimate process (e.g., a web browser). While the process itself is trusted, its network traffic may betray malicious activity. This involves checking for connections to blocklisted IPs/domains, matching TLS fingerprints (JA3/JA3S) against known malicious ones, and verifying that the User-Agent string is correct for the application. A mismatch can indicate that malicious code within the process is making its own outbound C2 requests.","MDM/EDR Process Activity Logs; Zeek conn.log; Zeek dns.log; Zeek http.log; Zeek ssl.log; Threat Intelligence Feeds; Managed mobile devices with EDR/MDM agents, network gateways monitoring corporate Wi-Fi and VPN traffic, and centralized log aggregation platforms such as a SIEM or Data Lake.",last 90 days,"Pseudocode: JOIN process logs and network logs (conn, dns, http, ssl) on device_ip. FOR each event WHERE process_name IN [trusted_apps_list], CHECK IF (destination_ip OR domain IN [threat_intel_feed]) OR (ja3_hash IN [malicious_ja3_list]) OR (user_agent NOT MATCHES established_user_agent_pattern for process_name). IF any condition is true, THEN ALERT.",playbooks/attack/mobile/T1631.yml
T1631: Process Injection,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0029: Privilege Escalation; TA0030: Defense Evasion,n; o; n; e,5,"Are any mobile applications exhibiting both anomalous resource consumption (CPU/memory) and an unusually high ratio of outgoing to incoming network traffic, suggesting data exfiltration?","This question seeks to identify signs of malicious code execution by its side effects. Injected code can cause an application to use more CPU and memory than normal. If this high resource usage coincides with a network traffic pattern where the device is sending significantly more data than it is receiving ($$ orig_bytes / resp_bytes $$), it is a strong indicator of data exfiltration. This is a powerful heuristic for detecting the impact of a compromise.","MDM Performance Logs (CPU/Memory); Zeek conn.log; Managed mobile devices with EDR/MDM agents, network gateways monitoring corporate Wi-Fi and VPN traffic, and centralized log aggregation platforms such as a SIEM or Data Lake.",last 90 days,"Pseudocode: SEARCH MDM performance logs WHERE (cpu_usage > 95th_percentile_baseline AND memory_usage > 95th_percentile_baseline) for 5 continuous minutes. FOR each event, SEARCH conn.log WHERE source_ip = event.device_ip AND timestamp is concurrent. CALCULATE byte_ratio = $$ orig_bytes / resp_bytes $$. IF byte_ratio > 99th_percentile_baseline for that device, THEN ALERT.",playbooks/attack/mobile/T1631.yml
T1631: Process Injection,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0029: Privilege Escalation; TA0030: Defense Evasion,n; o; n; e,6,"Can we detect anomalous network connections from mobile devices that, when combined with high resource usage, point to a potential compromise?","This question uses unsupervised machine learning (DBSCAN) to define 'normal' network behavior for a device based on features like port, protocol, duration, and ASN. Any connection that doesn't fit into a known cluster is flagged as an outlier. This is a powerful way to detect novel C2 channels. When such a network outlier occurs at the same time as a resource consumption anomaly (high CPU/memory), it provides a strong, correlated signal that the device is compromised.","Zeek conn.log; MDM Performance Logs (CPU/Memory); Managed mobile devices with EDR/MDM agents, network gateways monitoring corporate Wi-Fi and VPN traffic, and centralized log aggregation platforms such as a SIEM or Data Lake.",last 90 days,"Pseudocode: DEFINE network_outliers AS (SEARCH DBSCAN model_output for events WHERE cluster_label = 'noise'). DEFINE resource_anomalies AS (SEARCH MDM performance logs WHERE cpu_usage > 95th_percentile OR memory_usage > 95th_percentile). JOIN network_outliers and resource_anomalies ON device_id WHERE timestamps are concurrent. IF match, THEN ALERT.",playbooks/attack/mobile/T1631.yml
T1633: Virtualization-Sandbox Evasion,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,1,"Is a newly installed, non-allowlisted application querying for multiple known emulator artifacts within 60 seconds of its first execution?","This question seeks to identify applications that immediately check for signs of a virtualized or emulated environment upon launch. Malware often performs these checks to alter its behavior or terminate execution if it detects a sandbox, thereby evading analysis. The query joins MDM process logs with Android Logcat data to specifically target applications from untrusted publishers that exhibit this suspicious reconnaissance behavior.
","A; n; d; r; o; i; d;  ; L; o; g; c; a; t; ,;  ; M; D; M;  ; A; p; p; l; i; c; a; t; i; o; n;  ; I; n; v; e; n; t; o; r; y;  ; L; o; g; s; ,;  ; M; D; M;  ; P; r; o; c; e; s; s;  ; A; c; t; i; v; i; t; y;  ; L; o; g; s; ,;  ; Z; e; e; k;  ; c; o; n; n; .; l; o; g; .;  ; T; h; i; s;  ; d; a; t; a;  ; c; a; n;  ; b; e;  ; f; o; u; n; d;  ; o; n;  ; M; a; n; a; g; e; d;  ; M; o; b; i; l; e;  ; D; e; v; i; c; e;  ; E; n; d; p; o; i; n; t; s; ,;  ; t; h; e;  ; M; o; b; i; l; e;  ; D; e; v; i; c; e;  ; M; a; n; a; g; e; m; e; n; t;  ; (; M; D; M; );  ; P; l; a; t; f; o; r; m; ,;  ; a;  ; C; e; n; t; r; a; l; i; z; e; d;  ; L; o; g;  ; A; g; g; r; e; g; a; t; o; r; /; S; I; E; M; ,;  ; a; n; d;  ; N; e; t; w; o; r; k;  ; S; e; c; u; r; i; t; y;  ; M; o; n; i; t; o; r; i; n; g;  ; (; N; S; M; );  ; s; e; n; s; o; r; s;  ; a; t;  ; i; n; t; e; r; n; e; t;  ; g; a; t; e; w; a; y; s; .; 
",Last 90 days,": JOIN MDM_process_logs ON process_start_time
WITH Android_logcat_data
WHERE application_publisher NOT IN allowlist
AND logcat_message CONTAINS emulator_artifact_watchlist
AND COUNT(DISTINCT artifact) >= 2
WITHIN 60 seconds of process_start_time
",playbooks/attack/mobile/T1633.yml
T1633: Virtualization-Sandbox Evasion,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,2,Is any third-party application querying for an anomalously high number of unique emulator-related system properties or exhibiting low-entropy queries shortly after execution?,"This question aims to detect sandbox evasion attempts by establishing a behavioral baseline across the mobile fleet. An application querying significantly more emulator properties than its peers might be performing a more thorough evasion check. Similarly, very low entropy in the queried property names (e.g., repeatedly checking the same one or two properties) can also indicate a simplistic, automated evasion script. This approach uses statistical methods (99th percentile, Shannon entropy) to find outliers without relying solely on a fixed list of known bad applications.
","A; n; d; r; o; i; d;  ; L; o; g; c; a; t; ,;  ; M; D; M;  ; A; p; p; l; i; c; a; t; i; o; n;  ; I; n; v; e; n; t; o; r; y;  ; L; o; g; s; ,;  ; M; D; M;  ; P; r; o; c; e; s; s;  ; A; c; t; i; v; i; t; y;  ; L; o; g; s; ,;  ; Z; e; e; k;  ; c; o; n; n; .; l; o; g; .;  ; T; h; i; s;  ; d; a; t; a;  ; c; a; n;  ; b; e;  ; f; o; u; n; d;  ; o; n;  ; M; a; n; a; g; e; d;  ; M; o; b; i; l; e;  ; D; e; v; i; c; e;  ; E; n; d; p; o; i; n; t; s; ,;  ; t; h; e;  ; M; o; b; i; l; e;  ; D; e; v; i; c; e;  ; M; a; n; a; g; e; m; e; n; t;  ; (; M; D; M; );  ; P; l; a; t; f; o; r; m; ,;  ; a;  ; C; e; n; t; r; a; l; i; z; e; d;  ; L; o; g;  ; A; g; g; r; e; g; a; t; o; r; /; S; I; E; M; ,;  ; a; n; d;  ; N; e; t; w; o; r; k;  ; S; e; c; u; r; i; t; y;  ; M; o; n; i; t; o; r; i; n; g;  ; (; N; S; M; );  ; s; e; n; s; o; r; s;  ; a; t;  ; i; n; t; e; r; n; e; t;  ; g; a; t; e; w; a; y; s; .; 
",Last 90 days,": // Rule 1: High Count
FOR each third-party_application:
  CALCULATE fleet_wide_99th_percentile_of_unique_emulator_property_queries
  WITHIN 5 minutes of execution
  ALERT if application_query_count > fleet_wide_99th_percentile

// Rule 2: Low Entropy
FOR each process:
  CALCULATE shannon_entropy_of_queried_property_names
  ALERT if entropy < 1.5
",playbooks/attack/mobile/T1633.yml
T1633: Virtualization-Sandbox Evasion,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,3,"Can a machine learning model identify applications exhibiting evasive behavior based on system property queries and other features, and can this be correlated with suspicious network activity?","This question leverages a Random Forest classification model to make a predictive judgment about an application's intent. By training the model on a variety of features—such as the count and entropy of property queries, time-to-first-query, publisher reputation, and requested permissions—it can learn complex patterns indicative of evasion that are difficult to capture with simple rules. Correlating a high-confidence 'evasive' prediction with subsequent suspicious network connections (e.g., to known C2 servers) provides a powerful, automated method for escalating high-priority threats.
","A; n; d; r; o; i; d;  ; L; o; g; c; a; t; ,;  ; M; D; M;  ; A; p; p; l; i; c; a; t; i; o; n;  ; I; n; v; e; n; t; o; r; y;  ; L; o; g; s; ,;  ; M; D; M;  ; P; r; o; c; e; s; s;  ; A; c; t; i; v; i; t; y;  ; L; o; g; s; ,;  ; Z; e; e; k;  ; c; o; n; n; .; l; o; g; .;  ; T; h; i; s;  ; d; a; t; a;  ; c; a; n;  ; b; e;  ; f; o; u; n; d;  ; o; n;  ; M; a; n; a; g; e; d;  ; M; o; b; i; l; e;  ; D; e; v; i; c; e;  ; E; n; d; p; o; i; n; t; s; ,;  ; t; h; e;  ; M; o; b; i; l; e;  ; D; e; v; i; c; e;  ; M; a; n; a; g; e; m; e; n; t;  ; (; M; D; M; );  ; P; l; a; t; f; o; r; m; ,;  ; a;  ; C; e; n; t; r; a; l; i; z; e; d;  ; L; o; g;  ; A; g; g; r; e; g; a; t; o; r; /; S; I; E; M; ,;  ; a; n; d;  ; N; e; t; w; o; r; k;  ; S; e; c; u; r; i; t; y;  ; M; o; n; i; t; o; r; i; n; g;  ; (; N; S; M; );  ; s; e; n; s; o; r; s;  ; a; t;  ; i; n; t; e; r; n; e; t;  ; g; a; t; e; w; a; y; s; .; 
",Last 90 days,": // Model Prediction
INPUT features (query_count, entropy, time_delta, publisher_rep, permissions)
INTO Random_Forest_Model
GET prediction_score

// Correlation
IF prediction_score > high_confidence_threshold:
  SEARCH Zeek_conn_logs for subsequent connections from device_ip
  to malicious_ip_list or on unusual_ports
  IF match found:
    ESCALATE incident_priority
",playbooks/attack/mobile/T1633.yml
T1633: Virtualization-Sandbox Evasion,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,4,"Has a newly installed application requested multiple 'human interaction' permissions and then exhibited network dormancy, suggesting it is checking for a live user before proceeding?","This question looks for a common sandbox evasion tactic where malware checks for signs of a real user (e.g., access to contacts, body sensors) and, upon finding none, remains dormant to avoid detection in an automated analysis environment. The combination of rapid permission requests for human-centric data followed by a lack of significant network activity is a strong indicator of this behavior. The query correlates MDM permission logs with Zeek network logs to detect this specific sequence of events.
","M; D; M;  ; P; e; r; m; i; s; s; i; o; n;  ; G; r; a; n; t;  ; L; o; g; s; ,;  ; A; n; d; r; o; i; d;  ; L; o; g; c; a; t; ,;  ; Z; e; e; k;  ; c; o; n; n; .; l; o; g; .;  ; T; h; i; s;  ; d; a; t; a;  ; c; a; n;  ; b; e;  ; f; o; u; n; d;  ; o; n;  ; M; a; n; a; g; e; d;  ; M; o; b; i; l; e;  ; D; e; v; i; c; e;  ; E; n; d; p; o; i; n; t; s; ,;  ; t; h; e;  ; M; o; b; i; l; e;  ; D; e; v; i; c; e;  ; M; a; n; a; g; e; m; e; n; t;  ; (; M; D; M; );  ; P; l; a; t; f; o; r; m; ,;  ; a;  ; C; e; n; t; r; a; l; i; z; e; d;  ; L; o; g;  ; A; g; g; r; e; g; a; t; o; r; /; S; I; E; M; ,;  ; a; n; d;  ; N; e; t; w; o; r; k;  ; S; e; c; u; r; i; t; y;  ; M; o; n; i; t; o; r; i; n; g;  ; (; N; S; M; );  ; s; e; n; s; o; r; s;  ; a; t;  ; i; n; t; e; r; n; e; t;  ; g; a; t; e; w; a; y; s; .; 
",Last 90 days,": // Event 1: Permission Grants
SEARCH MDM_permission_logs
FOR application granted >= 3 permissions from 'human_interaction_watchlist'
WITHIN 60 seconds of first_launch

// Event 2: Network Dormancy
IF Event 1 is true:
  SEARCH Zeek_conn_logs for device_ip in subsequent 5 minutes
  WHERE outbound_connections == 0
  OR (outbound_connections == 1 AND total_bytes_sent < 1024)

// Correlation
IF both events are true for the same application:
  ALERT
",playbooks/attack/mobile/T1633.yml
T1633: Virtualization-Sandbox Evasion,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,5,"Is a new application making an anomalous sequence of API calls or observing static sensor data, suggesting it is running in an emulator?","This question aims to detect emulated environments by analyzing an application's early-stage behavior. Emulators often provide static or predictable sensor data (e.g., an accelerometer that doesn't move), and applications running within them may have different API call patterns than on a real device. By comparing a new app's initial API call sequence to a baseline of trusted apps (using Levenshtein distance) and monitoring sensor data entropy, we can identify statistical anomalies indicative of a non-human environment.
","M; D; M;  ; P; e; r; m; i; s; s; i; o; n;  ; G; r; a; n; t;  ; L; o; g; s; ,;  ; A; n; d; r; o; i; d;  ; L; o; g; c; a; t; ,;  ; Z; e; e; k;  ; c; o; n; n; .; l; o; g; .;  ; T; h; i; s;  ; d; a; t; a;  ; c; a; n;  ; b; e;  ; f; o; u; n; d;  ; o; n;  ; M; a; n; a; g; e; d;  ; M; o; b; i; l; e;  ; D; e; v; i; c; e;  ; E; n; d; p; o; i; n; t; s; ,;  ; t; h; e;  ; M; o; b; i; l; e;  ; D; e; v; i; c; e;  ; M; a; n; a; g; e; m; e; n; t;  ; (; M; D; M; );  ; P; l; a; t; f; o; r; m; ,;  ; a;  ; C; e; n; t; r; a; l; i; z; e; d;  ; L; o; g;  ; A; g; g; r; e; g; a; t; o; r; /; S; I; E; M; ,;  ; a; n; d;  ; N; e; t; w; o; r; k;  ; S; e; c; u; r; i; t; y;  ; M; o; n; i; t; o; r; i; n; g;  ; (; N; S; M; );  ; s; e; n; s; o; r; s;  ; a; t;  ; i; n; t; e; r; n; e; t;  ; g; a; t; e; w; a; y; s; .; 
",Last 90 days,": // Rule 1: API Sequence Anomaly
FOR each new_application:
  GET initial_API_call_sequence from Logcat
  GET baseline_sequence for application_category
  CALCULATE Levenshtein_distance(new_sequence, baseline_sequence)
  ALERT if distance_score > 98th_percentile_for_category

// Rule 2: Static Sensor Data
MONITOR sensor_data_streams from Logcat
CALCULATE entropy over 30-second window
ALERT if entropy is near 0
",playbooks/attack/mobile/T1633.yml
T1633: Virtualization-Sandbox Evasion,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,6,"Can an LSTM Autoencoder model detect anomalous, non-human sensor activity from a newly installed application?","This question applies a deep learning model (LSTM Autoencoder) to detect time-series anomalies in sensor data. The model is trained on normal patterns of human interaction (e.g., movement from accelerometer/gyroscope). When a new application is running, its associated sensor data is fed into the model. If the model cannot accurately reconstruct the input data (resulting in a high reconstruction error), it signifies that the data pattern is anomalous and likely not from a human user, strongly suggesting the application is running in an emulator providing static or unrealistic sensor inputs.
","M; D; M;  ; P; e; r; m; i; s; s; i; o; n;  ; G; r; a; n; t;  ; L; o; g; s; ,;  ; A; n; d; r; o; i; d;  ; L; o; g; c; a; t; ,;  ; Z; e; e; k;  ; c; o; n; n; .; l; o; g; .;  ; T; h; i; s;  ; d; a; t; a;  ; c; a; n;  ; b; e;  ; f; o; u; n; d;  ; o; n;  ; M; a; n; a; g; e; d;  ; M; o; b; i; l; e;  ; D; e; v; i; c; e;  ; E; n; d; p; o; i; n; t; s; ,;  ; t; h; e;  ; M; o; b; i; l; e;  ; D; e; v; i; c; e;  ; M; a; n; a; g; e; m; e; n; t;  ; (; M; D; M; );  ; P; l; a; t; f; o; r; m; ,;  ; a;  ; C; e; n; t; r; a; l; i; z; e; d;  ; L; o; g;  ; A; g; g; r; e; g; a; t; o; r; /; S; I; E; M; ,;  ; a; n; d;  ; N; e; t; w; o; r; k;  ; S; e; c; u; r; i; t; y;  ; M; o; n; i; t; o; r; i; n; g;  ; (; N; S; M; );  ; s; e; n; s; o; r; s;  ; a; t;  ; i; n; t; e; r; n; e; t;  ; g; a; t; e; w; a; y; s; .; 
",Last 90 days,": // Model Inference
FOR each new_application:
  FEED real-time_sensor_data_stream into pre-trained_LSTM_Autoencoder
  CALCULATE reconstruction_error_score

// Anomaly Detection
IF reconstruction_error_score > statistical_threshold:
  ALERT for anomalous sensor activity, indicating probable emulator
",playbooks/attack/mobile/T1633.yml
T1633: Virtualization-Sandbox Evasion,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,7,Is a newly installed application making DNS queries for multiple public NTP or IP geolocation services within its first five minutes of execution?,"This question targets malware's attempt to verify its external environment. Sandboxes may manipulate system time or report a generic location. To counter this, malware may query external, trusted time (NTP) and location (geolocation) services. Detecting a new application that quickly queries several of these services is a strong indicator of an evasion attempt, as this behavior is abnormal for most legitimate applications.
","Z; e; e; k;  ; d; n; s; .; l; o; g; ,;  ; Z; e; e; k;  ; c; o; n; n; .; l; o; g; ,;  ; M; D; M;  ; A; p; p; l; i; c; a; t; i; o; n;  ; I; n; s; t; a; l; l; a; t; i; o; n;  ; L; o; g; s; .;  ; T; h; i; s;  ; d; a; t; a;  ; c; a; n;  ; b; e;  ; f; o; u; n; d;  ; o; n;  ; C; o; r; p; o; r; a; t; e;  ; D; N; S;  ; R; e; s; o; l; v; e; r; s; ,;  ; N; e; t; w; o; r; k;  ; S; e; c; u; r; i; t; y;  ; M; o; n; i; t; o; r; i; n; g;  ; (; N; S; M; );  ; s; e; n; s; o; r; s;  ; a; t;  ; i; n; t; e; r; n; e; t;  ; g; a; t; e; w; a; y; s; ,;  ; a;  ; C; e; n; t; r; a; l; i; z; e; d;  ; L; o; g;  ; A; g; g; r; e; g; a; t; o; r; /; S; I; E; M; ,;  ; a; n; d;  ; t; h; e;  ; M; o; b; i; l; e;  ; D; e; v; i; c; e;  ; M; a; n; a; g; e; m; e; n; t;  ; (; M; D; M; );  ; P; l; a; t; f; o; r; m; .; 
",Last 90 days,": JOIN MDM_installation_logs ON device_ip, timestamp
WITH Zeek_dns_logs
WHERE query IN public_time_geo_watchlist
AND COUNT(DISTINCT query) >= 3
WITHIN 5 minutes of installation_time
ALERT
",playbooks/attack/mobile/T1633.yml
T1633: Virtualization-Sandbox Evasion,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,8,Is a mobile device suddenly making an anomalously high number or frequency of DNS queries to time and geolocation services compared to its own historical baseline?,"This question focuses on detecting changes in individual device behavior over time. Instead of using a static threshold, it establishes a 30-day rolling baseline for each device's queries to time/geo services. An alert is triggered if a device suddenly deviates significantly from its own normal pattern (e.g., exceeding three standard deviations or a 99th percentile frequency). This personalized, adaptive approach helps reduce false positives that might occur from fleet-wide rules and can pinpoint a compromised device even if its traffic volume isn't high in absolute terms.
","Z; e; e; k;  ; d; n; s; .; l; o; g; ,;  ; Z; e; e; k;  ; c; o; n; n; .; l; o; g; ,;  ; M; D; M;  ; A; p; p; l; i; c; a; t; i; o; n;  ; I; n; s; t; a; l; l; a; t; i; o; n;  ; L; o; g; s; .;  ; T; h; i; s;  ; d; a; t; a;  ; c; a; n;  ; b; e;  ; f; o; u; n; d;  ; o; n;  ; C; o; r; p; o; r; a; t; e;  ; D; N; S;  ; R; e; s; o; l; v; e; r; s; ,;  ; N; e; t; w; o; r; k;  ; S; e; c; u; r; i; t; y;  ; M; o; n; i; t; o; r; i; n; g;  ; (; N; S; M; );  ; s; e; n; s; o; r; s;  ; a; t;  ; i; n; t; e; r; n; e; t;  ; g; a; t; e; w; a; y; s; ,;  ; a;  ; C; e; n; t; r; a; l; i; z; e; d;  ; L; o; g;  ; A; g; g; r; e; g; a; t; o; r; /; S; I; E; M; ,;  ; a; n; d;  ; t; h; e;  ; M; o; b; i; l; e;  ; D; e; v; i; c; e;  ; M; a; n; a; g; e; m; e; n; t;  ; (; M; D; M; );  ; P; l; a; t; f; o; r; m; .; 
",Last 90 days,": // Baseline Calculation (30-day rolling)
FOR each device:
  CALCULATE baseline_mean_and_std_dev of distinct time_geo_queries
  CALCULATE baseline_99th_percentile_frequency for each time_geo_domain

// Anomaly Detection (10-minute sliding window)
FOR each device:
  IF current_distinct_query_count > (baseline_mean + 3 * baseline_std_dev):
    ALERT
  IF current_query_frequency_to_domain > baseline_99th_percentile:
    ALERT
",playbooks/attack/mobile/T1633.yml
T1633: Virtualization-Sandbox Evasion,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,9,"Can network traffic outliers, identified by a DBSCAN clustering algorithm, reveal sandbox evasion reconnaissance?","This question uses an unsupervised machine learning approach (DBSCAN) to find anomalous patterns in network traffic without pre-defined rules. By clustering traffic based on features like FQDN entropy, DNS-to-connection ratios, and JA3 hashes, normal traffic will form dense clusters. Evasion attempts, characterized by a high number of DNS queries to time/geo services followed by minimal data transfer, will not fit these clusters and will be labeled as 'noise' or outliers by the algorithm. Investigating these outliers provides a novel way to discover previously unknown or subtle evasion techniques.
","Z; e; e; k;  ; d; n; s; .; l; o; g; ,;  ; Z; e; e; k;  ; c; o; n; n; .; l; o; g; ,;  ; M; D; M;  ; A; p; p; l; i; c; a; t; i; o; n;  ; I; n; s; t; a; l; l; a; t; i; o; n;  ; L; o; g; s; .;  ; T; h; i; s;  ; d; a; t; a;  ; c; a; n;  ; b; e;  ; f; o; u; n; d;  ; o; n;  ; C; o; r; p; o; r; a; t; e;  ; D; N; S;  ; R; e; s; o; l; v; e; r; s; ,;  ; N; e; t; w; o; r; k;  ; S; e; c; u; r; i; t; y;  ; M; o; n; i; t; o; r; i; n; g;  ; (; N; S; M; );  ; s; e; n; s; o; r; s;  ; a; t;  ; i; n; t; e; r; n; e; t;  ; g; a; t; e; w; a; y; s; ,;  ; a;  ; C; e; n; t; r; a; l; i; z; e; d;  ; L; o; g;  ; A; g; g; r; e; g; a; t; o; r; /; S; I; E; M; ,;  ; a; n; d;  ; t; h; e;  ; M; o; b; i; l; e;  ; D; e; v; i; c; e;  ; M; a; n; a; g; e; m; e; n; t;  ; (; M; D; M; );  ; P; l; a; t; f; o; r; m; .; 
",Last 90 days,": // Feature Engineering (5-minute windows)
FOR each device:
  EXTRACT features (FQDN_count, FQDN_entropy, DNS_to_conn_ratio, ports, JA3_hash)
  from Zeek_dns and Zeek_conn logs

// Clustering
APPLY DBSCAN algorithm to feature set
IDENTIFY points classified as 'noise' (outliers)

// Investigation
INVESTIGATE outlier points that show high DNS queries to time/geo services
and low subsequent data transfer.",playbooks/attack/mobile/T1633.yml
T1635: Steal Application Access Token,5a9e3b7c-4f8d-4a1e-8b6c-9e2d0f3a1b4c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0031: Credential Access,n; o; n; e,1,Are we observing OAuth authorization flows with redirect URIs pointing to unapproved or non-allowlisted domains?,"This question aims to detect the 'Authorization Code Interception via Malicious Redirect URI' attack pattern. An adversary might trick a user into an OAuth flow where the authorization code is sent to a malicious server they control instead of the legitimate application. By creating a SIEM rule to check the `redirect_uri` against a corporate allowlist, we can identify potential token theft attempts in real-time.","Zeek http.log; Zeek dns.log; Zeek ssl.log; Corporate network egress points, including firewalls, VPN concentrators, and Cloud Access Security Brokers (CASBs) inspecting traffic from corporate Wi-Fi and VPN-connected mobile devices; Cloud-native network sensors (e.g., VPC Flow Logs, cloud firewalls)",last 90 days,: QUERY Zeek http.log WHERE (uri CONTAINS 'redirect_uri' AND uri CONTAINS 'client_id') | EXTRACT redirect_uri | URL_DECODE redirect_uri | IF domain(redirect_uri) NOT IN allowlist THEN ALERT medium_severity,playbooks/attack/mobile/T1635.yml
T1635: Steal Application Access Token,5a9e3b7c-4f8d-4a1e-8b6c-9e2d0f3a1b4c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0031: Credential Access,n; o; n; e,2,Can we identify potentially malicious redirect URIs by analyzing the randomness of their domain names?,"This question builds on the previous one by adding a layer of heuristic analysis. Attackers often use Domain Generation Algorithms (DGA) to create disposable callback domains. These domains frequently have high entropy (i.e., they appear random). By calculating the Shannon entropy of a suspicious `redirect_uri` domain and comparing it to a baseline of legitimate domains, we can flag those that are statistically likely to be algorithmically generated and thus malicious, prioritizing them for investigation.","Zeek http.log; Zeek dns.log; Zeek ssl.log; Corporate network egress points, including firewalls, VPN concentrators, and Cloud Access Security Brokers (CASBs) inspecting traffic from corporate Wi-Fi and VPN-connected mobile devices; Cloud-native network sensors (e.g., VPC Flow Logs, cloud firewalls)",last 90 days,: FOR each alerted_domain | CALCULATE shannon_entropy(fqdn) | IF entropy > P95(baseline_entropy_scores) THEN ALERT high_priority,playbooks/attack/mobile/T1635.yml
T1635: Steal Application Access Token,5a9e3b7c-4f8d-4a1e-8b6c-9e2d0f3a1b4c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0031: Credential Access,n; o; n; e,3,Can we use a machine learning model to predict if an OAuth flow is malicious based on its HTTP request characteristics?,"This question seeks to automate the detection of sophisticated attacks by using a logistic regression classifier. This moves beyond simple allowlists or entropy scores. By feeding a model various features—such as domain entropy, domain age, TLD reputation, URI path depth, and the client's TLS fingerprint (JA3/JA3S)—we can achieve a more nuanced and accurate prediction of malicious activity. A high probability score from the model would trigger an immediate, critical-level alert, enabling rapid response like device isolation via MDM.","Zeek http.log; Zeek dns.log; Zeek ssl.log; Passive DNS; TLD reputation data; Corporate network egress points, including firewalls, VPN concentrators, and Cloud Access Security Brokers (CASBs) inspecting traffic from corporate Wi-Fi and VPN-connected mobile devices; Cloud-native network sensors (e.g., VPC Flow Logs, cloud firewalls)",last 90 days,": EXTRACT features (entropy, domain_age, tld_rep, state_param, uri_depth, ja3) from http_request | INPUT features into logistic_regression_model | IF probability(malicious) > 0.90 THEN ESCALATE alert to critical",playbooks/attack/mobile/T1635.yml
T1635: Steal Application Access Token,5a9e3b7c-4f8d-4a1e-8b6c-9e2d0f3a1b4c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0031: Credential Access,n; o; n; e,4,Are mobile devices initiating OAuth flows shortly after communicating with known malicious domains?,"This question aims to identify a common attack chain where a user is first compromised by visiting a malicious site (e.g., via phishing) which then immediately triggers an illegitimate OAuth flow to steal a token. By creating a correlation rule in the SIEM that looks for communication with a threat-intel-flagged domain followed closely by an OAuth request from the same device, we can detect this specific sequence of events and generate a high-severity alert.","Zeek http.log; Zeek conn.log; Zeek dns.log; Threat Intelligence Platform Feed; Web proxy logs and network sensor data (e.g., Zeek) at the internet gateway; SIEM platform with integrated threat intelligence feeds",last 90 days,: CORRELATE events FROM same source_ip WITHIN 60s WHERE (event_A: destination IN threat_intel_feed) AND (event_B: uri CONTAINS 'response_type' AND 'client_id') | IF correlation_successful THEN ALERT high_severity,playbooks/attack/mobile/T1635.yml
T1635: Steal Application Access Token,5a9e3b7c-4f8d-4a1e-8b6c-9e2d0f3a1b4c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0031: Credential Access,n; o; n; e,5,"Following a potential compromise, is a user accessing an OAuth provider that is unusual for them or for the organization?","This question adds context to the previous alert by analyzing the rarity of the OAuth provider being accessed. An attacker might use a less common or entirely new service to exfiltrate a token, which would be an anomaly compared to a user's normal behavior. By baselining OAuth provider usage for each user and the organization as a whole, we can significantly increase the risk score of an alert if the provider is statistically rare, indicating a higher likelihood of malicious activity.","Zeek http.log; Zeek conn.log; Zeek dns.log; Threat Intelligence Platform Feed; Web proxy logs and network sensor data (e.g., Zeek) at the internet gateway; SIEM platform with integrated threat intelligence feeds",last 90 days,: FOR each alerted_oauth_domain | CHECK if domain in user_90day_baseline | CHECK if domain_prevalence < 1% org_wide_baseline | IF both_conditions_true THEN INCREASE risk_score,playbooks/attack/mobile/T1635.yml
T1635: Steal Application Access Token,5a9e3b7c-4f8d-4a1e-8b6c-9e2d0f3a1b4c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0031: Credential Access,n; o; n; e,6,"Can we detect anomalous user browsing sequences, such as a visit to a malicious site followed by an OAuth request, using a time-series model?","This question leverages advanced anomaly detection to identify suspicious behavioral patterns. Normal user browsing can be modeled as a sequence of transitions between website categories. A pre-trained LSTM autoencoder can learn these normal patterns. When an unusual sequence, like a direct transition from a 'malicious' category domain to an 'oauth_provider', is observed, the model will have a high reconstruction error. This statistical anomaly provides strong evidence of a deviation from benign behavior and can be used to escalate an alert for critical review.","Zeek http.log; Zeek conn.log; Zeek dns.log; Threat Intelligence Platform Feed; Web proxy logs and network sensor data (e.g., Zeek) at the internet gateway; SIEM platform with integrated threat intelligence feeds",last 90 days,: MODEL user_browsing as sequence_of_domain_categories | FOR new_sequence ['malicious' -> 'oauth_provider'] | CALCULATE reconstruction_error with LSTM_autoencoder | IF error > dynamic_threshold THEN ESCALATE to critical,playbooks/attack/mobile/T1635.yml
T1635: Steal Application Access Token,5a9e3b7c-4f8d-4a1e-8b6c-9e2d0f3a1b4c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0031: Credential Access,n; o; n; e,7,Are there any unauthorized mobile applications on managed devices that have registered a URI scheme conflicting with a legitimate one?,"This question addresses the 'Custom URI Scheme Hijacking' technique. A malicious app can register a URI scheme (e.g., `fbauth2://`) that is normally used by a legitimate app. When the user tries to authenticate, the OS may launch the malicious app instead, which can then steal the credentials or token. By periodically parsing app manifests from our UEM/MDM and comparing registered schemes, bundle IDs, and signing certificates against an allowlist of legitimate apps, we can detect and alert on these high-confidence indicators of compromise.",UEM Application Manifest Data; MDM Application Inventory Log; Mobile Threat Protection (MTP) Event Log; Application security testing (AST) reports for in-house developed apps; Mobile Device Management (MDM) / Unified Endpoint Management (UEM) platforms,last 90 days,: INGEST app_inventory from UEM/MDM | PARSE manifest for uri_schemes | FOR each app | IF registered_scheme IN protected_schemes AND (bundle_id NOT_MATCH or certificate_hash NOT_MATCH) THEN ALERT high_severity,playbooks/attack/mobile/T1635.yml
T1635: Steal Application Access Token,5a9e3b7c-4f8d-4a1e-8b6c-9e2d0f3a1b4c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0031: Credential Access,n; o; n; e,8,Can we identify potentially malicious applications by looking for typosquatted display names?,"This question focuses on detecting deceptive applications that trick users by using a name very similar to a well-known, legitimate application (e.g., 'Faceboook' instead of 'Facebook'). By calculating the Levenshtein distance (a measure of string similarity) between the names of newly installed apps and a corporate allowlist, we can flag potential typosquats for manual review. This is particularly important if the suspicious app also registers custom URI schemes, as it combines social engineering with a technical exploit method.",UEM Application Manifest Data; MDM Application Inventory Log; Mobile Threat Protection (MTP) Event Log; Mobile Device Management (MDM) / Unified Endpoint Management (UEM) platforms,last 90 days,": FOR each new_app | CALCULATE levenshtein_distance(new_app_name, allowlist_app_names) | IF distance < 3 AND app_registers_uri_schemes THEN FLAG for manual_review",playbooks/attack/mobile/T1635.yml
T1635: Steal Application Access Token,5a9e3b7c-4f8d-4a1e-8b6c-9e2d0f3a1b4c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0031: Credential Access,n; o; n; e,9,Can we use a machine learning classifier to predict if a mobile application is malicious based on its metadata from MDM/UEM?,"This question proposes a comprehensive, automated approach to vetting mobile applications. A Random Forest classifier can be trained on a rich set of features available from MDM/UEM platforms, such as whether the app was sideloaded, the permissions it requests, its developer's reputation, its similarity to known apps (Levenshtein score), and the security state of the device (e.g., jailbroken). An application classified as having a high probability of being malicious can automatically trigger a response, such as quarantining the device, to prevent or contain a compromise.",UEM Application Manifest Data; MDM Application Inventory Log; Mobile Threat Protection (MTP) Event Log; Mobile Device Management (MDM) / Unified Endpoint Management (UEM) platforms,last 90 days,": EXTRACT features (source, permissions, dev_rep, levenshtein_score, is_rooted) from MDM | INPUT features to random_forest_model | IF probability(malicious) > 0.85 THEN QUARANTINE device AND create_ticket",playbooks/attack/mobile/T1635.yml
T1636.001: Calendar Entries,a6c5d4b3-e2f1-4a09-8b7c-6d5e4f3a2b1c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0035: Collection,n; o; n; e,1,Is a mobile device with a calendar-accessing application communicating with a known malicious domain or IP address?,"This question aims to detect direct data exfiltration or command-and-control (C2) communication. By correlating application permissions from an MDM with network logs and threat intelligence, analysts can identify high-confidence indicators of compromise where a seemingly legitimate application is being used for malicious purposes.
","Zeek conn.log; Zeek dns.log; Mobile Device Management (MDM) Application Inventory; Threat Intelligence Feeds; Corporate network gateways, VPN concentrators, DNS resolvers, and MDM/UEM platforms monitoring mobile device traffic and application installations.",last 90 days,pseudocode: FOR each mobile_device_ip | GET installed_apps with calendar_permission from MDM | FILTER network_logs for connections from mobile_device_ip | JOIN destination_ip/fqdn with threat_intel_feed | IF match THEN ALERT.,playbooks/attack/mobile/T1636.001.yml
T1636.001: Calendar Entries,a6c5d4b3-e2f1-4a09-8b7c-6d5e4f3a2b1c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0035: Collection,n; o; n; e,2,Is an application with calendar permissions exfiltrating an unusually large amount of data or communicating with a domain showing signs of algorithmic generation (DGA)?,"This question helps detect covert data exfiltration that avoids known malicious indicators. Adversaries may use legitimate-looking domains or their own infrastructure. By baselining normal data transfer volumes and analyzing domain name randomness (Shannon entropy), analysts can spot statistical outliers that suggest data theft or C2 communication via Domain Generation Algorithms (DGA).
","Zeek conn.log; Zeek dns.log; Mobile Device Management (MDM) Application Inventory; Corporate network gateways, VPN concentrators, DNS resolvers, and MDM/UEM platforms monitoring mobile device traffic and application installations.",last 90 days,pseudocode: FOR each app_with_calendar_permission | BUILD 30-day baseline of outbound_data_volume | IF new_session_volume > 99.5th_percentile THEN ALERT | CONCURRENTLY: CALCULATE shannon_entropy of fqdn | IF entropy > 3.5 AND volume_anomaly THEN ELEVATE_ALERT.,playbooks/attack/mobile/T1636.001.yml
T1636.001: Calendar Entries,a6c5d4b3-e2f1-4a09-8b7c-6d5e4f3a2b1c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0035: Collection,n; o; n; e,3,"Does a mobile device's outbound network traffic volume show a significant deviation from its established historical pattern, as identified by a time-series anomaly detection model?","This question leverages machine learning to identify subtle or complex anomalies in network traffic that simple thresholding might miss. A time-series model (like an LSTM autoencoder) learns the 'normal' rhythm of a device's network activity. A high reconstruction error indicates the current traffic pattern is highly unexpected, which could signal an exfiltration event by an application with calendar access.
","Zeek conn.log; Mobile Device Management (MDM) Application Inventory; Corporate network gateways, VPN concentrators, DNS resolvers, and MDM/UEM platforms monitoring mobile device traffic and application installations.",last 90 days,pseudocode: AGGREGATE outbound_data_volume per device in 1-hour windows | INPUT data into pre-trained LSTM_autoencoder_model | IF model_reconstruction_error > (mean_error + 3 * std_dev_error) THEN ALERT.,playbooks/attack/mobile/T1636.001.yml
T1636.001: Calendar Entries,a6c5d4b3-e2f1-4a09-8b7c-6d5e4f3a2b1c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0035: Collection,n; o; n; e,4,Has a newly installed mobile application with calendar permissions been identified that is not on the corporate allowlist or is on a known malicious denylist?,"This question focuses on early detection of potentially malicious applications at the time of installation. By checking every new app with sensitive permissions (like calendar access) against curated allowlists and denylists, security teams can quickly flag unauthorized or known-bad software before it can cause harm.
","Mobile Device Management (MDM) Application Inventory; Mobile Threat Defense (MTD) Scan Results; Public App Store Metadata; Mobile Device Management (MDM) platform, Mobile Threat Defense (MTD) platform, and public application stores (e.g., Google Play, Apple App Store).",last 90 days,pseudocode: FOR each new_app_install_event | IF app has 'READ_CALENDAR' or 'WRITE_CALENDAR' permissions | CHECK app_bundle_id against corporate_allowlist and malicious_denylist | IF not on allowlist THEN MEDIUM_ALERT | IF on denylist THEN HIGH_ALERT.,playbooks/attack/mobile/T1636.001.yml
T1636.001: Calendar Entries,a6c5d4b3-e2f1-4a09-8b7c-6d5e4f3a2b1c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0035: Collection,n; o; n; e,5,"Is there a non-allowlisted application with calendar access that exhibits high-risk characteristics, such as low installation prevalence or belonging to an app category that shouldn't require calendar access?","This question helps prioritize investigation for unknown applications that aren't on a denylist. Malicious apps often have low prevalence within a specific enterprise. By combining this with other risk factors, like an app's category (e.g., a 'Game' needing calendar access), analysts can use a heuristic risk score to surface the most suspicious applications for manual review.
","Mobile Device Management (MDM) Application Inventory; Mobile Threat Defense (MTD) Scan Results; Public App Store Metadata; Mobile Device Management (MDM) platform, Mobile Threat Defense (MTD) platform, and public application stores (e.g., Google Play, Apple App Store).",last 90 days,"pseudocode: FOR each app_with_calendar_permission not on allowlist | CALCULATE installation_prevalence | CALCULATE risk_score (e.g., low_prevalence_pts + high_risk_category_pts) | IF risk_score > threshold THEN FLAG for manual_review.",playbooks/attack/mobile/T1636.001.yml
T1636.001: Calendar Entries,a6c5d4b3-e2f1-4a09-8b7c-6d5e4f3a2b1c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0035: Collection,n; o; n; e,6,Which applications with calendar access are ranked as most likely to be malicious by a machine learning classification model?,"This question uses a predictive model to automate the risk assessment of applications. By training a classifier on various features (permission count, developer reputation, user ratings, etc.), a 'malice probability score' can be generated. This allows security analysts to work from a prioritized queue, focusing their limited time on the applications that pose the greatest threat.
","Mobile Device Management (MDM) Application Inventory; Mobile Threat Defense (MTD) Scan Results; Public App Store Metadata; Mobile Device Management (MDM) platform, Mobile Threat Defense (MTD) platform, and public application stores (e.g., Google Play, Apple App Store).",last 90 days,"pseudocode: EXTRACT features for each app_with_calendar_access (permissions, dev_rep, category, etc.) | INPUT features into pre-trained classification_model (e.g., Random Forest) | GET malice_probability_score | RANK apps by score to create investigation_queue.",playbooks/attack/mobile/T1636.001.yml
T1636.001: Calendar Entries,a6c5d4b3-e2f1-4a09-8b7c-6d5e4f3a2b1c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0035: Collection,n; o; n; e,7,Has a process on a jailbroken or rooted device accessed the local calendar database file?,"This question identifies a highly suspicious event on a compromised device. Jailbreaking or rooting removes OS-level security controls, allowing direct file system access. Correlating a 'rooted' device status from an MDM with a file integrity monitoring (FIM) alert for the calendar database provides a strong indicator that an attacker is attempting to directly steal calendar data.
","Mobile Device Management (MDM) Device Status; Mobile Threat Defense (MTD) File Integrity Monitoring Logs; Zeek conn.log; MDM/MTD platforms, Endpoint file systems on high-risk mobile devices, Corporate network egress points",last 90 days,pseudocode: JOIN mdm_device_status with mtd_file_access_alerts | IF device_status is 'rooted'/'jailbroken' AND file_path is '*/Calendar.sqlitedb' THEN CRITICAL_ALERT.,playbooks/attack/mobile/T1636.001.yml
T1636.001: Calendar Entries,a6c5d4b3-e2f1-4a09-8b7c-6d5e4f3a2b1c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0035: Collection,n; o; n; e,8,"On a rooted or jailbroken device, is a process repeatedly making a network connection almost immediately after accessing the calendar database?","This question looks for a specific pattern of 'smash and grab' data theft on a compromised device. An adversary might script a process to read the calendar database and instantly exfiltrate it. By correlating file access events with subsequent network connections and measuring the time delta, analysts can detect this automated behavior, which is a strong signal of malicious activity.
","Mobile Device Management (MDM) Device Status; Mobile Threat Defense (MTD) File Integrity Monitoring Logs; Zeek conn.log; MDM/MTD platforms, Endpoint file systems on high-risk mobile devices, Corporate network egress points",last 90 days,pseudocode: FOR each rooted/jailbroken_device | CORRELATE calendar_db_access_events with network_connection_events | CALCULATE time_delta between access and connection | IF median_delta < 5_seconds over 24h THEN ALERT.,playbooks/attack/mobile/T1636.001.yml
T1636.001: Calendar Entries,a6c5d4b3-e2f1-4a09-8b7c-6d5e4f3a2b1c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0035: Collection,n; o; n; e,9,"Has a sequence analysis model detected a high-probability chain of events on a rooted device, such as a non-system process accessing the calendar database and then connecting to a new external IP?","This question applies advanced sequence analysis to detect a logical attack chain. A model (like a Hidden Markov Model) can be trained to distinguish between normal and malicious sequences of system events. Detecting the specific sequence of a non-standard process accessing the calendar file and then making a new external connection provides a very high-confidence alert that an attack is in progress.
","Mobile Device Management (MDM) Device Status; Mobile Threat Defense (MTD) File Integrity Monitoring Logs; Zeek conn.log; MDM/MTD platforms, Endpoint file systems on high-risk mobile devices, Corporate network egress points",last 90 days,"pseudocode: ON rooted/jailbroken_devices | INPUT event_sequences [process, file_path, dest_ip] into sequence_analysis_model | IF model identifies sequence ['non-system_process', '*/Calendar.sqlitedb', 'new_external_ip'] with high_probability THEN HIGH_CONFIDENCE_ALERT.",playbooks/attack/mobile/T1636.001.yml
T1636.002: Call Log,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0035: Collection,n; o; n; e,1,Are there any applications on managed mobile devices that request 'READ_CALL_LOG' permission but are not on the corporate application allowlist?,"This question aims to identify potentially malicious or unauthorized applications that have the capability to access sensitive call log data. By comparing apps with this permission against a known-good allowlist, we can quickly flag suspicious installations that bypass corporate policy and may be used for data collection.",MDM/UEM Application Inventory Log; AndroidManifest.xml; Application Allowlist; Unified Endpoint Management (UEM) console; Cloud-based application sandbox; Corporate application store,Last 90 days,": apps_with_permission = SEARCH UEM logs WHERE permission == 'android.permission.READ_CALL_LOG'
allowlist = GET corporate_allowlist
FOR app in apps_with_permission:
  IF app.package_name NOT IN allowlist.package_names OR app.certificate NOT IN allowlist.certificates:
    ALERT high_severity ""Unauthorized app with call log permission""
",playbooks/attack/mobile/T1636.002.yml
T1636.002: Call Log,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0035: Collection,n; o; n; e,2,"Is the 'android.permission.READ_CALL_LOG' permission statistically rare in our environment, and if so, which applications are requesting it?","This question uses statistical analysis to find outliers. Permissions that are rarely requested across the device fleet are more likely to be associated with specialized, and potentially malicious, functionality. Identifying an app with a rare, high-risk permission like `READ_CALL_LOG` provides a strong signal for further investigation, even if the app is not explicitly blocklisted.",MDM/UEM Application Inventory Log; AndroidManifest.xml; Application Allowlist; Unified Endpoint Management (UEM) console; Cloud-based application sandbox; Corporate application store,Last 90 days,": permission_counts = COUNT permissions in UEM logs
rare_permissions = CALCULATE 99th_percentile_rarity(permission_counts)
IF 'android.permission.READ_CALL_LOG' IN rare_permissions:
  apps_with_rare_permission = SEARCH UEM logs WHERE permission == 'android.permission.READ_CALL_LOG'
  FOR app in apps_with_rare_permission:
    ALERT medium_severity ""App with statistically rare call log permission""
",playbooks/attack/mobile/T1636.002.yml
T1636.002: Call Log,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0035: Collection,n; o; n; e,3,Has a machine learning model identified any applications with 'READ_CALL_LOG' permission as malicious or potentially unwanted with high confidence?,"This question leverages a machine learning model to perform a deeper, more nuanced analysis of an application's characteristics beyond just its requested permissions. If an app requests call log access and an ML model, trained to recognize malicious behavior, flags it with high confidence (>0.85), it signifies a critical threat that warrants immediate automated blocking and incident response.",MDM/UEM Application Inventory Log; AndroidManifest.xml; Application Allowlist; Unified Endpoint Management (UEM) console; Cloud-based application sandbox; Corporate application store,Last 90 days,": apps_with_permission = SEARCH UEM logs WHERE permission == 'android.permission.READ_CALL_LOG'
FOR app in apps_with_permission:
  ml_result = ANALYZE app with ML_model
  IF (ml_result.classification == 'malicious' OR ml_result.classification == 'PUA') AND ml_result.confidence > 0.85:
    BLOCK app
    ALERT critical_incident ""ML detected malicious app with call log permission""
",playbooks/attack/mobile/T1636.002.yml
T1636.002: Call Log,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0035: Collection,n; o; n; e,4,Has an unapproved process been observed accessing the Android call log content provider at runtime?,"This question focuses on detecting the actual act of accessing call log data at runtime, rather than just the static permission. By monitoring for API calls to the 'content://call_log/calls' URI and checking the responsible process's hash against an allowlist, we can identify unauthorized applications that are actively attempting to collect call data. This provides high-fidelity evidence of malicious activity.",Mobile EDR Process and API monitoring logs; Android Logcat; Managed Android endpoints; Unified Endpoint Management (UEM) console; SIEM platform,Last 90 days,": access_events = SEARCH EDR logs WHERE api_call_uri == 'content://call_log/calls'
allowlist_hashes = GET process_hash_allowlist
FOR event in access_events:
  IF event.process_sha256 NOT IN allowlist_hashes:
    ALERT high_severity ""Unapproved process accessed call log""
",playbooks/attack/mobile/T1636.002.yml
T1636.002: Call Log,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0035: Collection,n; o; n; e,5,Is any application accessing the call log with a frequency that is anomalously high compared to its own historical baseline?,"This question seeks to detect unusual behavior from otherwise legitimate or unknown applications. An application might have a valid reason to access the call log, but a sudden, dramatic spike in access frequency can indicate that the app has been compromised or is performing an illicit data collection task. Detecting a deviation of more than three standard deviations from the norm is a common statistical method for identifying such anomalies.",Mobile EDR Process and API monitoring logs; Android Logcat; Managed Android endpoints; Unified Endpoint Management (UEM) console; SIEM platform,Last 90 days,": FOR each (app, device):
  baseline = CALCULATE 14-day_rolling_baseline(app, device, 'content://call_log/calls')
  current_hour_count = COUNT accesses in last hour
  IF current_hour_count > (baseline.mean + 3 * baseline.std_dev):
    ALERT medium_severity ""Anomalous call log access frequency""
",playbooks/attack/mobile/T1636.002.yml
T1636.002: Call Log,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0035: Collection,n; o; n; e,6,"Has an anomalous sequence of API calls, involving call log access followed by suspicious actions like network activity or encryption, been detected?","This question looks for a chain of suspicious behaviors, which is a stronger indicator of malicious intent than a single action. A sequence analysis model (like an LSTM) learns the normal ""grammar"" of an application's API calls. When it detects an unusual sequence, such as reading the call log and then immediately trying to send data over the network, it provides a high-confidence signal of an active attack, warranting a critical alert.",Mobile EDR Process and API monitoring logs; Android Logcat; Managed Android endpoints; Unified Endpoint Management (UEM) console; SIEM platform,Last 90 days,": api_sequences = STREAM real-time API calls
FOR sequence in api_sequences:
  is_anomalous = ANALYZE sequence with LSTM_model
  IF is_anomalous AND 'content://call_log/calls' in sequence AND (network_call in sequence OR crypto_call in sequence) within 60s:
    ALERT critical_alert ""Anomalous API sequence involving call log""
",playbooks/attack/mobile/T1636.002.yml
T1636.002: Call Log,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0035: Collection,n; o; n; e,7,Has a device connected to a known command-and-control (C2) server shortly after installing an application with call log access permissions?,"This question correlates multiple, distinct data sources to uncover a clear attack pattern. The installation of an app with risky permissions, followed by network communication to a known malicious destination, is a classic indicator of compromise. This multi-conditional correlation provides extremely high-fidelity alerts, pointing directly to a compromised device.",Zeek conn.log; Zeek dns.log; MDM/UEM Application Installation Event Logs; Threat Intelligence Platform Data; Network egress points; Corporate Wi-Fi network gateways; VPN concentrators; DNS resolvers,Last 90 days,": c2_list = GET threat_intel_feed
app_installs = SEARCH UEM logs WHERE permission == 'READ_CALL_LOG'
FOR install in app_installs:
  connections = SEARCH network logs WHERE source_ip == install.device_ip AND time < install.time + 24h
  FOR conn in connections:
    IF conn.dest_ip IN c2_list OR conn.dest_domain IN c2_list:
      ALERT critical_alert ""Device connected to C2 after installing app with call log permission""
",playbooks/attack/mobile/T1636.002.yml
T1636.002: Call Log,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0035: Collection,n; o; n; e,8,Is a device exhibiting an unusual spike in outbound network traffic shortly after an application with call log permissions was installed?,"This question aims to detect data exfiltration. A significant, anomalous increase in outbound traffic (exceeding the 98th percentile baseline) is suspicious on its own. When this occurs within 24 hours of installing an app that can read sensitive data like call logs, it strongly suggests the app is exfiltrating that data. Enriching the alert with DNS query entropy helps to further qualify the threat, as high entropy can indicate the use of Domain Generation Algorithms (DGA).",Zeek conn.log; Zeek dns.log; MDM/UEM Application Installation Event Logs; Threat Intelligence Platform Data; Network egress points; Corporate Wi-Fi network gateways; VPN concentrators; DNS resolvers,Last 90 days,": app_installs = SEARCH UEM logs WHERE permission == 'READ_CALL_LOG' and time > now() - 24h
FOR device in managed_devices:
  baseline = CALCULATE 30-day_98th_percentile_traffic(device)
  current_traffic = CALCULATE traffic in last hour
  IF current_traffic > baseline AND device in app_installs.devices:
    dns_entropy = CALCULATE shannon_entropy(device.dns_queries in last hour)
    ALERT high_severity ""Anomalous traffic after app install. DNS Entropy: "" + dns_entropy
",playbooks/attack/mobile/T1636.002.yml
T1636.002: Call Log,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0035: Collection,n; o; n; e,9,Have advanced machine learning models detected both anomalous outbound traffic volume and outlier network flow characteristics on a device shortly after an app with call log permissions was installed?,"This question uses a sophisticated, two-pronged ML approach for high-confidence threat detection. A time-series model detects when traffic volume is abnormal, while a clustering algorithm detects what about the network connection itself is abnormal (e.g., unusual port, JA3/JA3S hash). When both models flag an anomaly correlated with the recent installation of an app that can read call logs, it provides a very strong signal of data exfiltration.",Zeek conn.log; Zeek dns.log; MDM/UEM Application Installation Event Logs; Threat Intelligence Platform Data; Network egress points; Corporate Wi-Fi network gateways; VPN concentrators; DNS resolvers,Last 90 days,": app_installs = SEARCH UEM logs WHERE permission == 'READ_CALL_LOG' and time > now() - 24h
FOR device in managed_devices:
  traffic_anomaly = PREDICT traffic_anomaly with ARIMA_model
  flow_anomaly = DETECT outlier_flow with DBSCAN_model
  IF traffic_anomaly AND flow_anomaly AND device in app_installs.devices:
    ALERT critical_alert ""ML detected traffic and flow anomaly after app install""",playbooks/attack/mobile/T1636.002.yml
T1636.003: Contact List,f8a9b1c2-d3e4-4f5a-6b7c-8d9e0f1a2b3c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0035: Collection,n; o; n; e,1,Is there an installed mobile application with 'read contacts' permission that is a known malicious application?,"This question seeks to identify overtly malicious applications that have been installed on managed devices. By cross-referencing the application inventory with a threat intelligence feed of known malicious mobile apps, we can quickly detect high-confidence threats that have gained access to sensitive contact information. A match indicates a direct and immediate risk of data exfiltration.
",MDM Application Inventory Log; Threat Intelligence Feed (Mobile Malware Identifiers),last 90 days,SEARCH MDM application inventory WHERE has_permission('read contacts') AND application_identifier IN (threat_intelligence_feed) | JOIN with MTD logs,playbooks/attack/mobile/T1636.003.yml
T1636.003: Contact List,f8a9b1c2-d3e4-4f5a-6b7c-8d9e0f1a2b3c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0035: Collection,n; o; n; e,2,Are there any mobile applications with 'read contacts' permission that belong to an App Store category where this permission is statistically uncommon?,"This question aims to uncover potentially malicious or privacy-invasive applications masquerading as legitimate software. Most apps in a given category (e.g., 'Games') do not require contact access. An app that requests this permission when its peers do not is a statistical anomaly and warrants investigation. This could indicate a 'grayware' app or a compromised legitimate app designed to siphon data.
",MDM Application Inventory Log; Application Vetting Service Results,last 90 days,QUERY MDM logs daily | GROUP BY app_category | CALCULATE percentage with 'read contacts' permission | FILTER where permission_prevalence < 2% | LIST anomalous applications for review,playbooks/attack/mobile/T1636.003.yml
T1636.003: Contact List,f8a9b1c2-d3e4-4f5a-6b7c-8d9e0f1a2b3c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0035: Collection,n; o; n; e,3,Can we use machine learning to predict if an application with 'read contacts' permission is malicious based on its metadata?,"This question leverages a supervised machine learning model to proactively identify high-risk applications. By training a model on various features like developer reputation, permissions, and app store ratings, we can score the likelihood of an application being malicious. This automated analysis helps prioritize investigative efforts on the applications that pose the greatest threat, even if they are not yet on a known threat intelligence list.
",MDM/MTD Logs (Application Metadata),last 90 days,RUN classification model ON (all applications with 'read contacts' permission) | CREATE case IF prediction == 'malicious' AND confidence_score > 0.90,playbooks/attack/mobile/T1636.003.yml
T1636.003: Contact List,f8a9b1c2-d3e4-4f5a-6b7c-8d9e0f1a2b3c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0035: Collection,n; o; n; e,4,Has a mobile device accessed its contact list and then immediately connected to a known malicious command-and-control (C2) server?,"This question looks for a classic data exfiltration pattern: access data, then phone home. Correlating an OS-level contact access event with a subsequent network connection to an IP address on a malware C2 threat intelligence feed provides a strong signal of active compromise and data theft. The tight time window (5 minutes) increases the confidence that the two events are related.
",MTD OS API Call Log; Zeek conn.log; Threat Intelligence Feed (Mobile Malware C2),last 90 days,CORRELATE MTD log (event: 'contact list access') with Zeek conn.log (destination_ip IN mobile_malware_c2_feed) WHERE device_id matches AND time_difference < 5 minutes,playbooks/attack/mobile/T1636.003.yml
T1636.003: Contact List,f8a9b1c2-d3e4-4f5a-6b7c-8d9e0f1a2b3c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0035: Collection,n; o; n; e,5,"Has any application made an anomalous number of contact list API calls, followed by connections to suspicious or previously unseen domains?","This question aims to detect abnormal behavior by establishing a baseline of normal activity for each application on each device. A sudden spike in contact list access (e.g., exceeding the 99th percentile) is a significant anomaly. Tying this spike to network connections to domains that are either algorithmically generated (high entropy) or new to the environment strengthens the hypothesis that the application is exfiltrating the contact data it just accessed.
",MTD OS API Call Log; Zeek dns.log,last 90 days,CALCULATE 30-day baseline of hourly contact API calls per app/device | ALERT if current_hour_count > 99th_percentile | ENRICH alert with Zeek DNS logs for high_entropy_domains (>3.5) or new_domains in the same hour,playbooks/attack/mobile/T1636.003.yml
T1636.003: Contact List,f8a9b1c2-d3e4-4f5a-6b7c-8d9e0f1a2b3c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0035: Collection,n; o; n; e,6,"Can a time-series anomaly detection model identify sequences of events, including contact list access, that deviate from a device's normal behavior?","This question uses an advanced machine learning approach to understand the holistic behavior of a device over time. Instead of looking at single events in isolation, a model (like an LSTM Autoencoder) learns the normal patterns of API calls, network traffic, and data volume. When a sequence of events, including contact access, cannot be 'reconstructed' accurately by the model, it signals a significant deviation from normalcy, suggesting a potential compromise that might be missed by rule-based detections.
",MTD OS API Call Log; Zeek conn.log; Zeek dns.log,last 90 days,"RUN time-series model on real-time device event vectors (API calls, network stats) | ALERT if reconstruction_error > threshold for a sequence containing a 'contact list access' event",playbooks/attack/mobile/T1636.003.yml
T1636.003: Contact List,f8a9b1c2-d3e4-4f5a-6b7c-8d9e0f1a2b3c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0035: Collection,n; o; n; e,7,Is there a device that has failed an integrity check and has a sideloaded application with 'read contacts' permission?,"This question correlates multiple high-risk indicators to pinpoint a likely compromised device. A failed integrity check (e.g., device is rooted or jailbroken), the presence of an app from an untrusted source ('sideloaded'), and that same app having access to sensitive contacts creates a compelling narrative of compromise. This combination is a critical alert because the device's security controls are bypassed, and a potentially malicious app has access to data.
",MDM Device Compliance Log; MDM Application Inventory Log,last 90 days,CORRELATE MDM logs where (compliance_status == 'compromised' OR integrity_check == 'failed') AND (install_source == 'unofficial') AND (app_permission == 'read contacts') for the same device_id within a 1-hour window,playbooks/attack/mobile/T1636.003.yml
T1636.003: Contact List,f8a9b1c2-d3e4-4f5a-6b7c-8d9e0f1a2b3c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0035: Collection,n; o; n; e,8,Which devices with sideloaded applications pose the highest risk based on the permissions their sideloaded apps have?,"This question provides a method for risk-based prioritization. Not all sideloaded apps are malicious, but they carry inherent risk. By assigning weights to sensitive permissions (like contacts, microphone, SMS), we can calculate a cumulative risk score for each device. This allows analysts to focus their limited time on the devices that represent the biggest potential threat, rather than investigating every single device with a sideloaded app.
",MDM Application Inventory Log,last 90 days,"QUERY MDM inventory for sideloaded apps | CALCULATE risk_score per device based on permission weights (e.g., Contacts=10, SMS=8) | RANK devices by score and investigate top 5% or score > 20",playbooks/attack/mobile/T1636.003.yml
T1636.003: Contact List,f8a9b1c2-d3e4-4f5a-6b7c-8d9e0f1a2b3c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0035: Collection,n; o; n; e,9,Can we use clustering algorithms to identify outlier mobile devices that deviate significantly from the secure baseline of the device fleet?,"This question uses unsupervised machine learning to find the 'black sheep' in the device fleet. By clustering devices based on security-relevant features (like patch level, integrity check failures, sideloaded app count), we can identify devices that don't fit into the main, presumably secure, clusters. These outliers, identified as 'noise' by algorithms like DBSCAN, are anomalous by definition and should be investigated as they may represent misconfigured or compromised devices.
",MDM Device Compliance Log; MDM Application Inventory Log,last 90 days,"APPLY DBSCAN clustering on all mobile devices using features (os_patch_level, failed_integrity_checks, sideloaded_app_count) | ISOLATE and investigate outlier devices (noise points)",playbooks/attack/mobile/T1636.003.yml
T1636.004: SMS Messages,f5c8a9e1-b2d3-4a6f-8b9c-0d1e2f3a4b5c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0035: Collection,n; o; n; e,1,Has a corporate mobile device communicated with a known-malicious command and control (C2) domain?,"This question aims to identify high-confidence indicators of compromise. If a mobile device, which potentially has access to SMS messages, is communicating with a domain on a C2 threat intelligence list, it strongly suggests the device is compromised and is being used for data exfiltration or further malicious activity.",Zeek conn.log; Zeek dns.log; Mobile Device Management (MDM) logs; Corporate Wi-Fi network egress points; VPN concentrators,last 90 days,: ,playbooks/attack/mobile/T1636.004.yml
T1636.004: SMS Messages,f5c8a9e1-b2d3-4a6f-8b9c-0d1e2f3a4b5c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0035: Collection,n; o; n; e,2,Is a mobile device exfiltrating an anomalous amount of data to a rare network destination?,"This question focuses on detecting exfiltration through behavioral anomaly detection. Adversaries often exfiltrate data to destinations not typically contacted by the user or organization. By baselining normal traffic patterns (data volume, destination country/ASN) for each device, we can spot significant deviations that could indicate data theft, even if the destination is not on a known threat list.",Zeek conn.log; Mobile Device Management (MDM) logs; Corporate Wi-Fi network egress points; VPN concentrators,last 90 days,: ,playbooks/attack/mobile/T1636.004.yml
T1636.004: SMS Messages,f5c8a9e1-b2d3-4a6f-8b9c-0d1e2f3a4b5c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0035: Collection,n; o; n; e,3,Does a mobile device's network traffic profile exhibit complex anomalies indicative of malicious activity?,"This question leverages advanced machine learning to detect subtle deviations from a device's normal network behavior. Unlike simple volumetric baselines, a time-series model can learn complex patterns across multiple features (e.g., data volume, connection timing, protocol usage, encryption details). A high reconstruction error suggests the current traffic does not match the learned 'normal' profile, which could signal sophisticated C2 communication or data exfiltration.",Zeek conn.log; Zeek dns.log; Zeek ssl.log; Mobile Device Management (MDM) logs; Corporate Wi-Fi network egress points; VPN concentrators,last 90 days,: ,playbooks/attack/mobile/T1636.004.yml
T1636.004: SMS Messages,f5c8a9e1-b2d3-4a6f-8b9c-0d1e2f3a4b5c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0035: Collection,n; o; n; e,4,Has a mobile device synchronization tool on a workstation spawned a suspicious child process for networking or encoding?,"This question addresses the threat of an adversary using a connected workstation as a staging point. Mobile sync tools are trusted processes, but they should not be spawning command-line utilities like PowerShell or curl to perform network transfers or data encoding. Detecting such process chains is a strong indicator that the sync tool's access to mobile data is being abused for data staging and exfiltration.",Windows Event ID 4688; Employee workstations with mobile device syncing software installed; Centralized log aggregator/SIEM,last 90 days,: ,playbooks/attack/mobile/T1636.004.yml
T1636.004: SMS Messages,f5c8a9e1-b2d3-4a6f-8b9c-0d1e2f3a4b5c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0035: Collection,n; o; n; e,5,Has a mobile sync tool executed a statistically rare process chain on a workstation?,"This question uses statistical analysis to find unusual behavior without relying on predefined suspicious indicators. By baselining the normal child processes and arguments for sync tools across the enterprise, we can identify executions that are statistical outliers. A rare process chain, even if the child process isn't inherently malicious, warrants investigation as it deviates from established normal operations and could represent an adversary's novel technique.",Windows Event ID 4688; Employee workstations with mobile device syncing software installed; Centralized log aggregator/SIEM,last 90 days,: ,playbooks/attack/mobile/T1636.004.yml
T1636.004: SMS Messages,f5c8a9e1-b2d3-4a6f-8b9c-0d1e2f3a4b5c,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0035: Collection,n; o; n; e,6,Does a process chain originating from a mobile sync tool match a machine learning model's profile of malicious data staging?,"This question applies supervised machine learning to classify the intent of process activity. By training a model on known benign and malicious examples, it can learn to identify complex patterns indicative of data staging. Features like command-line entropy and the presence of encoded strings can help the model distinguish malicious commands from normal sync operations, providing a risk score to help analysts prioritize the most suspicious events.",Windows Event ID 4688; Windows PowerShell Event ID 4104; Employee workstations with mobile device syncing software installed; Centralized log aggregator/SIEM,last 90 days,: ,playbooks/attack/mobile/T1636.004.yml
T1641: Data Manipulation,a0f7e8c1-4b9d-4e2a-8f6c-1d0b3a5c7e9f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0034: Impact,n; o; n; e,1,Has a non-corporate or known malicious mobile application been observed reading clipboard data immediately after a corporate application wrote to it?,"This question seeks to identify 'clipboard hijacking,' a technique where a malicious application steals sensitive information (e.g., passwords, PII, financial details) that a user has copied from a legitimate corporate application. Correlating the reading application with a threat intelligence feed provides high-confidence confirmation of malicious intent, indicating a likely device compromise and data theft.","Mobile EDR/MDM logs (capturing API calls, process activity, and clipboard access events); Zeek conn.log; Zeek dns.log; Corporate-managed mobile devices; Corporate Wi-Fi and VPN network gateways; Cloud-hosted MDM/EDR platforms",last 90 days,: ,playbooks/attack/mobile/T1641.yml
T1641: Data Manipulation,a0f7e8c1-4b9d-4e2a-8f6c-1d0b3a5c7e9f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0034: Impact,n; o; n; e,2,Is any mobile application accessing the clipboard at an anomalously high frequency or interacting with other applications in a previously unseen manner?,"This question aims to detect more subtle data scraping activities that might not involve known malicious applications. By establishing a baseline of normal clipboard access frequency and legitimate application-to-application interactions, analysts can identify deviations that suggest an application is either scraping data excessively or interacting with other apps in a suspicious, previously unobserved way.","Mobile EDR/MDM logs (capturing API calls, process activity, and clipboard access events); Zeek conn.log; Zeek dns.log; Corporate-managed mobile devices; Corporate Wi-Fi and VPN network gateways; Cloud-hosted MDM/EDR platforms",last 90 days,: ,playbooks/attack/mobile/T1641.yml
T1641: Data Manipulation,a0f7e8c1-4b9d-4e2a-8f6c-1d0b3a5c7e9f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0034: Impact,n; o; n; e,3,Has a device exhibited an anomalous spike in outbound network traffic shortly after a non-standard application was seen reading from the clipboard?,This question correlates two distinct suspicious events: clipboard access and network traffic anomalies. The goal is to connect the potential local theft of data (from the clipboard) with the subsequent exfiltration of that data to an external server. A confirmed link between these two activities provides strong evidence that sensitive data has been successfully stolen and removed from the device.,"Mobile EDR/MDM logs (capturing API calls, process activity, and clipboard access events); Zeek conn.log; Zeek dns.log; Corporate-managed mobile devices; Corporate Wi-Fi and VPN network gateways; Cloud-hosted MDM/EDR platforms",last 90 days,: ,playbooks/attack/mobile/T1641.yml
T1641: Data Manipulation,a0f7e8c1-4b9d-4e2a-8f6c-1d0b3a5c7e9f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0034: Impact,n; o; n; e,4,Has any mobile application attempted to write or modify data outside of its designated sandbox environment?,"This question checks for direct violations of the mobile OS security model, specifically application sandboxing. An application writing outside its own container is a major security red flag. It suggests an attempt to tamper with other applications' data, alter system configurations, or plant malicious files. After excluding known legitimate inter-app frameworks, any such event is highly indicative of malicious activity.",Mobile EDR/MDM logs (capturing file system and database modifications); Zeek http.log; Zeek files.log; Corporate-managed mobile devices; Application servers receiving mobile data; Application data containers on mobile devices,last 90 days,: ,playbooks/attack/mobile/T1641.yml
T1641: Data Manipulation,a0f7e8c1-4b9d-4e2a-8f6c-1d0b3a5c7e9f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0034: Impact,n; o; n; e,5,Is any application modifying critical data files (like the contacts database) with an unusually high frequency or causing an abnormally large change in file size?,"This question focuses on detecting anomalous modification of shared, sensitive data stores. While legitimate applications may modify these files, an attacker might do so with unusual velocity (e.g., rapid encryption) or by adding/removing large amounts of data. Baselining normal write frequency and data change magnitude helps distinguish legitimate use from suspicious manipulation.",Mobile EDR/MDM logs (capturing file system and database modifications); Zeek http.log; Zeek files.log; Corporate-managed mobile devices; Application servers receiving mobile data; Application data containers on mobile devices,last 90 days,: ,playbooks/attack/mobile/T1641.yml
T1641: Data Manipulation,a0f7e8c1-4b9d-4e2a-8f6c-1d0b3a5c7e9f,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0034: Impact,n; o; n; e,6,Do file-write events on mobile devices exhibit characteristics that a machine learning model identifies as likely malicious?,"This question uses a machine learning model to find complex patterns of malicious file modifications that simple rule-based alerts might miss. By training on features like process name, file type, write frequency, and time of day, the model can learn a nuanced profile of malicious behavior and score new events for risk, allowing analysts to prioritize the most suspicious activities.",Mobile EDR/MDM logs (capturing file system and database modifications); Zeek http.log; Zeek files.log; Corporate-managed mobile devices; Application servers receiving mobile data; Application data containers on mobile devices,last 90 days,: ,playbooks/attack/mobile/T1641.yml
T1642: Endpoint Denial of Service,f4a5b6c7-d8e9-4f0a-b1c2-d3e4f5a6b7c8,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0034: Impact,n; o; n; e,1,Has a managed mobile device connected to an IP or domain known for mobile malware with Endpoint DoS capabilities?,"This question aims to detect direct communication with known malicious infrastructure. By correlating threat intelligence matches with actual network connection logs, analysts can identify compromised devices that are part of a botnet or under the control of an attacker capable of launching a DoS attack.","Zeek intel.log; Zeek conn.log; MDM Logs; Corporate and Guest Wi-Fi network gateways, VPN concentrators, DNS resolvers, Mobile Device Management (MDM) platform.",last 90 days,"pseudocode: SEARCH Zeek intel.log AND conn.log WHERE intel.uid = conn.uid AND conn.source_ip IN mobile_ip_range AND intel.source_tag IN ('mobile_malware', 'KeyRaider', 'T1642')",playbooks/attack/mobile/T1642.yml
T1642: Endpoint Denial of Service,f4a5b6c7-d8e9-4f0a-b1c2-d3e4f5a6b7c8,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0034: Impact,n; o; n; e,2,"Has a mobile device initiated a connection to a new or historically anomalous Autonomous System (AS), especially one with a poor reputation?","This question detects deviations from normal network behavior. Mobile devices typically connect to a predictable set of ASNs. A connection to a new, previously unseen ASN, particularly one with a bad reputation or involving an unusually high connection frequency, can indicate communication with a new C2 server or malicious infrastructure.","Zeek intel.log; Zeek conn.log; MDM Logs; Corporate and Guest Wi-Fi network gateways, VPN concentrators, DNS resolvers, Mobile Device Management (MDM) platform.",last 30 days,"pseudocode: COMPARE conn.log destination_asn FOR device_ip OVER past_30_days. IF new_asn FOUND, ENRICH asn_reputation. IF reputation is malicious OR connection_count > 99th_percentile_for_peer_group, ALERT.",playbooks/attack/mobile/T1642.yml
T1642: Endpoint Denial of Service,f4a5b6c7-d8e9-4f0a-b1c2-d3e4f5a6b7c8,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0034: Impact,n; o; n; e,3,"Does a mobile device's network connection exhibit a high-risk score based on a machine learning model, suggesting malicious activity?","This question leverages machine learning to identify subtle patterns of maliciousness that rule-based detections might miss. By analyzing multiple features of a connection in real-time (duration, protocol, bytes transferred, reputation, etc.), a model can score the likelihood of a connection being part of a DoS attack, triggering an automated response for sustained high-risk activity.","Zeek intel.log; Zeek conn.log; MDM Logs; Corporate and Guest Wi-Fi network gateways, VPN concentrators, DNS resolvers, Mobile Device Management (MDM) platform.",last 90 days,"pseudocode: FOR EACH connection FROM mobile_ip, CALCULATE risk_score using ML_model(features). IF risk_score > 0.9 FOR 3+ consecutive_connections, TRIGGER SOAR_playbook(device_ip).",playbooks/attack/mobile/T1642.yml
T1642: Endpoint Denial of Service,f4a5b6c7-d8e9-4f0a-b1c2-d3e4f5a6b7c8,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0034: Impact,n; o; n; e,4,Has a mobile device attempted to resolve a very recently registered domain and then subsequently ceased all network activity?,"This question looks for a two-stage indicator of compromise. Attackers often use newly registered domains for C2. A device connecting to one and then going silent could mean a malicious command was received that disabled the device's networking or bricked it entirely, which is a form of DoS.","Zeek dns.log; Zeek conn.log; Internal DNS resolvers, network traffic monitoring points at internet gateways.",last 90 days,"pseudocode: SEARCH dns.log FOR query_to_domain_registered_within_3_days. IF found, CHECK conn.log FOR no_activity FROM source_ip for next_15_minutes. IF true, ALERT.",playbooks/attack/mobile/T1642.yml
T1642: Endpoint Denial of Service,f4a5b6c7-d8e9-4f0a-b1c2-d3e4f5a6b7c8,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0034: Impact,n; o; n; e,5,Is a mobile device generating a high volume of random-looking DNS queries (indicative of DGA) followed by an abnormally long period of network inactivity?,"This question identifies Domain Generation Algorithm (DGA) behavior, a common technique for malware to find its C2 server. A burst of high-entropy DNS queries followed by an unusual period of silence for that specific device suggests the device may have found its C2, received a payload or command, and then been taken offline as part of a DoS attack.","Zeek dns.log; Zeek conn.log; Internal DNS resolvers, network traffic monitoring points at internet gateways.",last 90 days,"pseudocode: STREAM dns.log. IF count(high_entropy_queries) > 5 in 5_mins for mobile_ip, FLAG 'Potential DGA'. THEN, CHECK conn.log for time_since_last_connection > 95th_percentile_for_device. IF true, ALERT.",playbooks/attack/mobile/T1642.yml
T1642: Endpoint Denial of Service,f4a5b6c7-d8e9-4f0a-b1c2-d3e4f5a6b7c8,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0034: Impact,n; o; n; e,6,"Has a mobile device's network traffic pattern deviated significantly from its normal baseline, specifically by dropping to zero after potential DGA activity?","This question uses advanced anomaly detection to spot significant changes in a device's network behavior. A sudden drop to zero activity is a major anomaly. When this occurs shortly after the device was flagged for potential DGA activity, it provides a very strong signal that the device has been disabled as part of an attack.","Zeek dns.log; Zeek conn.log; Internal DNS resolvers, network traffic monitoring points at internet gateways.",last 90 days,"pseudocode: FOR EACH mobile_ip, MONITOR timeseries_network_metrics. IF reconstruction_error > threshold (anomaly), CHECK for 'Potential DGA' flag in last 30_mins AND current_activity is zero. IF true, ELEVATE_ALERT.",playbooks/attack/mobile/T1642.yml
T1642: Endpoint Denial of Service,f4a5b6c7-d8e9-4f0a-b1c2-d3e4f5a6b7c8,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0034: Impact,n; o; n; e,7,Has a managed mobile device connected to a domain or IP known to be associated with rooting or jailbreaking tools?,"This question aims to detect attempts to compromise the device's security at the OS level. Rooting or jailbreaking a device bypasses built-in security controls, making it much easier for an attacker to install malware, gain persistence, and execute a DoS attack. Detecting connections to sites that facilitate this is an early warning sign.","Zeek dns.log; Zeek http.log; Zeek intel.log; MDM Logs; Corporate Wi-Fi access points, VPN concentrators, web proxies, Mobile Device Management (MDM) platform.",last 90 days,"pseudocode: SEARCH intel.log where source_ip IN mobile_ip_range AND intel.source_tag = 'rooting_jailbreaking_site'. IF match, TRIGGER MDM_API_query for device_compliance_status.",playbooks/attack/mobile/T1642.yml
T1642: Endpoint Denial of Service,f4a5b6c7-d8e9-4f0a-b1c2-d3e4f5a6b7c8,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0034: Impact,n; o; n; e,8,Is a mobile device reporting a User-Agent string that is statistically rare among its peers?,"This question identifies outliers based on the software they are running. A rare User-Agent can indicate the use of a non-standard browser, a custom application, or malware trying to impersonate a legitimate client. These are often associated with compromised or jailbroken devices, which are at higher risk for DoS.","Zeek dns.log; Zeek http.log; Zeek intel.log; MDM Logs; Corporate Wi-Fi access points, VPN concentrators, web proxies, Mobile Device Management (MDM) platform.",last 90 days,"pseudocode: CALCULATE frequency of each user_agent per OS_group. IF device_user_agent_frequency < 1%, ALERT 'Rare User-Agent'.",playbooks/attack/mobile/T1642.yml
T1642: Endpoint Denial of Service,f4a5b6c7-d8e9-4f0a-b1c2-d3e4f5a6b7c8,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0034: Impact,n; o; n; e,9,Does a mobile device exhibit anomalous network behavior that causes it to be classified as an outlier when compared to its peers?,"This question uses unsupervised machine learning to find devices that 'don't fit in.' By clustering devices based on a wide range of network behaviors (ports, protocols, data volume, etc.), devices that are outliers (noise) can be identified. These anomalous devices can then be cross-referenced with MDM data to see if they are non-compliant (e.g., jailbroken), indicating a high-risk state.","Zeek dns.log; Zeek http.log; Zeek intel.log; MDM Logs; Corporate Wi-Fi access points, VPN concentrators, web proxies, Mobile Device Management (MDM) platform.",last 24 hours,"pseudocode: CLUSTER devices based on 24hr_network_profile_features. IF device is outlier, QUERY MDM for compliance_status. IF non-compliant, ALERT.",playbooks/attack/mobile/T1642.yml
T1642: Endpoint Denial of Service,f4a5b6c7-d8e9-4f0a-b1c2-d3e4f5a6b7c8,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0034: Impact,n; o; n; e,10,Has an unapproved application been granted Device Administrator privileges or has an unapproved configuration profile been installed on a managed mobile device?,"This is a direct question to detect high-risk configuration changes on the endpoint itself. Gaining Device Administrator rights (Android) or installing a malicious profile (iOS) gives an application extensive control over the device, including the ability to wipe data or lock the screen, all of which are forms of Endpoint DoS.","MDM Logs; SIEM Logs; Mobile Device Management (MDM) platform, Enterprise Mobility Management (EMM) server logs, SIEM.",last 90 days,"pseudocode: SEARCH MDM_logs FOR event_type IN ('Device Admin Granted', 'Profile Installed') WHERE app_or_cert NOT IN allowlist. IF match, ALERT with device_details.",playbooks/attack/mobile/T1642.yml
T1642: Endpoint Denial of Service,f4a5b6c7-d8e9-4f0a-b1c2-d3e4f5a6b7c8,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0034: Impact,n; o; n; e,11,Is a mobile device experiencing an abnormally high rate of application installations or profile modifications compared to its own history and its peer group?,"This question looks for an unusual velocity of change on a device. While a single app install is normal, a sudden burst of installations or configuration changes can indicate an automated, malicious process, such as a dropper installing multiple malicious packages or an attacker rapidly modifying device settings to prepare for an attack.","MDM Logs; SIEM Logs; Mobile Device Management (MDM) platform, Enterprise Mobility Management (EMM) server logs, SIEM.",last 90 days,"pseudocode: MONITOR rate of app_installs/profile_mods per device. IF rate > 99th_percentile_for_device AND rate > 99th_percentile_for_peer_group, ALERT.",playbooks/attack/mobile/T1642.yml
T1642: Endpoint Denial of Service,f4a5b6c7-d8e9-4f0a-b1c2-d3e4f5a6b7c8,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0034: Impact,n; o; n; e,12,Has a newly installed application on a mobile device been classified as 'high risk' by a machine learning model based on its permissions and characteristics?,"This question proactively assesses the risk of new software. Instead of waiting for malicious behavior, it uses an ML model to score an application at the time of installation based on its requested permissions, source, developer reputation, and other factors. A high-risk classification can trigger an immediate automated response, like quarantining the device, to prevent a potential DoS attack before it happens.","MDM Logs; SIEM Logs; Mobile Device Management (MDM) platform, Enterprise Mobility Management (EMM) server logs, SIEM.",last 90 days,"pseudocode: FOR EACH new_app_install, CALCULATE risk_score using ML_model(features). IF risk_score is 'high', TRIGGER SOAR_playbook_to_quarantine_device.",playbooks/attack/mobile/T1642.yml
T1643: Generate Traffic from Victim,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0034: Impact,n; o; n; e,1,Is a managed mobile device sending SMS messages to a known fraudulent or premium-rate number?,"This question aims to detect Toll Fraud, where malware sends SMS messages to premium-rate numbers, incurring costs for the organization. The action is to create a rule that cross-references the destination number of every outbound SMS message from carrier logs with a threat intelligence feed of known fraudulent and premium-rate numbers. A match would trigger a high-severity alert, providing crucial details like the source device, user, destination, and the specific application that sent the message, allowing for immediate response.","Carrier billing records; Mobile Device Management (MDM) application inventory logs; Mobile Device Management (MDM) application permission logs; Managed mobile device fleet, MDM servers, and Telecommunications provider billing systems",last 90 days,": FOR each outbound_sms IN carrier_logs
  IF outbound_sms.destination_number IN fraudulent_number_feed
    FETCH device_info, user_info, app_name FROM mdm_logs WHERE device_id = outbound_sms.device_id
    TRIGGER high_severity_alert WITH (device_info, user_info, app_name, outbound_sms.destination_number)
",playbooks/attack/mobile/T1643.yml
T1643: Generate Traffic from Victim,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0034: Impact,n; o; n; e,2,Is a non-messaging application on an Android device sending an anomalously high volume of SMS messages?,"This question helps identify malware that has gained SMS permissions to send messages for fraudulent purposes, bypassing standard user-facing messaging apps. The approach involves identifying Android applications with `SEND_SMS` permission that are not classified as 'Messaging' apps. For these apps, a historical baseline (99th percentile) of daily SMS volume is established. An alert is triggered if the daily count exceeds this baseline, indicating a potential compromise or misuse of permissions.","Carrier billing records; Mobile Device Management (MDM) application inventory logs; Mobile Device Management (MDM) application permission logs; Managed mobile device fleet, MDM servers, and Telecommunications provider billing systems",last 90 days,": FOR each android_device IN mdm_fleet
  FIND apps_with_sms_permission WHERE app.category != 'Messaging'
  FOR each app in apps_with_sms_permission
    CALCULATE daily_sms_baseline (99th percentile over 30 days) FROM carrier_logs
    GET current_daily_sms_count
    IF current_daily_sms_count > daily_sms_baseline
      TRIGGER medium_severity_alert WITH (device, app, current_count, baseline)
",playbooks/attack/mobile/T1643.yml
T1643: Generate Traffic from Victim,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0034: Impact,n; o; n; e,3,Can machine learning be used to classify outbound SMS events as fraudulent?,"This question explores a more advanced, proactive approach to detecting SMS fraud by using a supervised machine learning model. The goal is to automatically score every outbound SMS event based on a variety of features (e.g., sending app category, time of day, destination country, historical frequency). By training a model like a Random Forest on labeled historical data, the system can identify fraudulent activity with high confidence. Events classified as 'fraudulent' with a confidence score above 0.95 would automatically trigger a high-severity alert and a device quarantine action via MDM, providing a rapid and automated response to a high-confidence threat.","Carrier billing records; Mobile Device Management (MDM) application inventory logs; Mobile Device Management (MDM) application permission logs; Managed mobile device fleet, MDM servers, and Telecommunications provider billing systems",last 90 days,": FOR each new_sms_event
  EXTRACT features (app_category, time_of_day, dest_country, etc.)
  SCORE event using trained_ml_model
  IF score.class == 'fraudulent' AND score.confidence > 0.95
    TRIGGER high_severity_alert
    INITIATE mdm_quarantine_policy FOR device
",playbooks/attack/mobile/T1643.yml
T1643: Generate Traffic from Victim,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0034: Impact,n; o; n; e,4,"Is a managed mobile device communicating with network destinations associated with ad fraud, click fraud, or app-ranking manipulation?","This question aims to detect if a mobile device is being used for fraudulent online activities by checking its network communications against known malicious infrastructure. The action is to create a real-time rule that inspects DNS queries and HTTP/S requests from mobile devices. If a destination FQDN or URL matches an entry in a threat intelligence feed for ad/click fraud, a medium-severity alert is triggered. This provides early warning that a device may be compromised or running a malicious app, even if the traffic volume itself is not yet anomalous.","Zeek conn.log; Zeek dns.log; Zeek http.log; Corporate Wi-Fi network gateways, DNS resolvers, and Internet web proxies",last 90 days,": FOR each network_event (dns_log, http_log) FROM mobile_ip_range
  IF network_event.destination IN fraud_threat_feed
    TRIGGER medium_severity_alert WITH (source_ip, destination, user_agent, matched_feed)
",playbooks/attack/mobile/T1643.yml
T1643: Generate Traffic from Victim,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0034: Impact,n; o; n; e,5,"Is a mobile device exhibiting a pattern of automated network activity indicative of fraud, based on volume, randomness, and connection-to-data ratio?","This question seeks to identify automated, non-human traffic patterns by analyzing multiple network metrics simultaneously. It looks for a combination of three indicators: 1) an unusually high volume of connections, 2) unusually low randomness (entropy) in DNS queries, suggesting repetitive lookups, and 3) a high ratio of connections to data transferred, typical of check-in or simple click traffic. An alert is triggered only when a device exceeds its own historical baseline for connection volume/ratio AND falls below its baseline for DNS entropy, creating a high-fidelity signal for automated fraudulent behavior.","Zeek conn.log; Zeek dns.log; Zeek http.log; Corporate Wi-Fi network gateways, DNS resolvers, and Internet web proxies",last 90 days,": FOR each mobile_ip, HOURLY
  CALCULATE current_conn_count, current_dns_entropy, current_conn_byte_ratio FROM last_hour_zeek_logs
  FETCH historical_baselines (95th percentile for count/ratio, 5th for entropy) for this hour-of-day
  IF (current_conn_count > baseline_count OR current_conn_byte_ratio > baseline_ratio) AND (current_dns_entropy < baseline_entropy)
    TRIGGER medium_severity_alert
",playbooks/attack/mobile/T1643.yml
T1643: Generate Traffic from Victim,f47ac10b-58cc-4372-a567-0e02b2c3d479,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0034: Impact,n; o; n; e,6,Can an unsupervised machine learning model detect anomalous network behavior from mobile devices in near real-time?,"This question proposes using an unsupervised anomaly detection model, like an Isolation Forest, to identify novel or evolving fraudulent traffic patterns that may not be caught by signature-based rules or simple baselines. By training a model on a wide range of features from Zeek logs (connection counts, DNS entropy, port distribution, etc.), it learns the 'normal' network behavior for each device. The model can then score new activity in near real-time, flagging significant deviations from this learned norm as potential threats without prior knowledge of the specific attack, enabling detection of zero-day or sophisticated fraud techniques.","Zeek conn.log; Zeek dns.log; Zeek http.log; Corporate Wi-Fi network gateways, DNS resolvers, and Internet web proxies",last 90 days,": FOR each 5_minute_window for each device_ip
  EXTRACT features (conn_count, dns_entropy, port_dist, etc.) from Zeek logs
  SCORE window using trained_isolation_forest_model
  IF anomaly_score > threshold
    TRIGGER alert WITH (device_ip, score, anomalous_features)",playbooks/attack/mobile/T1643.yml
T1646: Exfiltration Over C2 Channel,a8e6e24b-3d6f-4c8a-9a9b-7e6d5c4b3a21,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0036: Exfiltration,n; o; n; e,1,"Has a mobile device connected to a known C2 server, used a malicious TLS client, or sent an unusually large amount of data in a single session?","This question seeks to identify high-confidence indicators of C2 communication and data exfiltration. Matching destination IPs against threat intelligence feeds or JA3 hashes against known malware signatures provides strong evidence of malicious activity. A large, single-session data transfer is a classic sign of bulk data exfiltration, which this query can detect using a simple static threshold.","Zeek conn.log; Zeek dns.log; Zeek ssl.log; Network gateways for corporate Wi-Fi, VPN concentrators, Cloud Access Security Broker (CASB) egress points, and other network egress points monitoring mobile device traffic.",last 90 days,": SEARCH conn.log from mobile_ip_range
JOIN with c2_threat_feed ON destination_ip
OR JOIN with ssl.log WHERE ja3_hash IN malicious_ja3_watchlist
OR WHERE outbound_bytes > 25MB
RETURN source_ip, destination_ip, outbound_bytes, ja3_hash
",playbooks/attack/mobile/T1646.yml
T1646: Exfiltration Over C2 Channel,a8e6e24b-3d6f-4c8a-9a9b-7e6d5c4b3a21,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0036: Exfiltration,n; o; n; e,2,Has a mobile device exhibited a statistically significant anomaly in its data transfer volume or connection duration to a specific destination compared to its own historical baseline?,"This question moves beyond static thresholds to detect subtle, anomalous behavior specific to a device's normal communication patterns. An attacker might try to exfiltrate data in volumes that are not large in absolute terms but are highly unusual for that specific device and destination. Comparing activity to a 99th percentile baseline makes this a powerful detection method for such deviations.","Zeek conn.log; Zeek dns.log; Zeek ssl.log; Network gateways for corporate Wi-Fi, VPN concentrators, Cloud Access Security Broker (CASB) egress points, and other network egress points monitoring mobile device traffic.",last 90 days,": FOR EACH source_ip, destination_ip pair:
  CALCULATE 30_day_baseline_bytes = 99th_percentile(outbound_bytes)
  CALCULATE 30_day_baseline_duration = 99th_percentile(duration)
SEARCH conn.log WHERE outbound_bytes > 30_day_baseline_bytes OR duration > 30_day_baseline_duration
RETURN source_ip, destination_ip, outbound_bytes, duration
",playbooks/attack/mobile/T1646.yml
T1646: Exfiltration Over C2 Channel,a8e6e24b-3d6f-4c8a-9a9b-7e6d5c4b3a21,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0036: Exfiltration,n; o; n; e,3,Is the total daily outbound data volume from a mobile device to a specific destination deviating from what a time series model would predict?,"This is an advanced statistical approach that models the expected data flow over time. It can detect more sophisticated, 'low-and-slow' exfiltration techniques that might not trigger single-session or simple baseline alerts. A deviation from a model's predicted 95% confidence interval is a strong statistical indicator of an abnormal change in the communication pattern that warrants investigation.","Zeek conn.log; Zeek dns.log; Zeek ssl.log; Network gateways for corporate Wi-Fi, VPN concentrators, Cloud Access Security Broker (CASB) egress points, and other network egress points monitoring mobile device traffic.",last 90 days,": FOR EACH source_ip, destination_ip pair:
  TRAIN time_series_model on 90_days_of(daily_sum(outbound_bytes))
  PREDICT today_expected_volume_range
SEARCH daily_aggregated_conn.log
IF today_actual_volume > today_expected_volume_range.upper_bound
  ALERT source_ip, destination_ip, today_actual_volume
",playbooks/attack/mobile/T1646.yml
T1646: Exfiltration Over C2 Channel,a8e6e24b-3d6f-4c8a-9a9b-7e6d5c4b3a21,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0036: Exfiltration,n; o; n; e,4,"Is a mobile device making large HTTP POST/PUT requests to suspicious domains, using malicious User-Agent strings, or sending generic binary data to unapproved services?","This question hunts for a combination of suspicious indicators within HTTP traffic. DNS lookups for known C2 or high-entropy domains are a primary red flag. When combined with large POST/PUT requests (indicative of data upload), malicious user agents, or generic content types like 'application/octet-stream', the evidence for data exfiltration becomes very strong.","Zeek http.log; Zeek dns.log; Internet-facing web proxies, DNS resolvers used by mobile devices, and Unified Endpoint Management (UEM) proxy logs.",last 90 days,": SEARCH dns.log WHERE query IN c2_domain_blocklist OR entropy(query) > high
CORRELATE source_ip with http.log
WHERE (method IN ['POST', 'PUT'] AND request_body_len > 1MB)
OR user_agent IN malicious_user_agent_list
OR (content_type = 'application/octet-stream' AND destination NOT IN approved_file_services)
RETURN source_ip, destination_host, user_agent, content_type
",playbooks/attack/mobile/T1646.yml
T1646: Exfiltration Over C2 Channel,a8e6e24b-3d6f-4c8a-9a9b-7e6d5c4b3a21,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0036: Exfiltration,n; o; n; e,5,"Is the ratio of data uploads (POSTs) to data downloads (GETs) for a mobile device to a specific web server abnormally high, or is the average size of the uploads statistically unusual compared to its baseline?","Normal web browsing involves far more GET requests (downloading content) than POST requests (uploading data). A high POST:GET ratio is a strong indicator that the primary purpose of the communication is data upload. Similarly, a sudden increase in the average size of POST requests suggests that the nature of the uploaded data has changed, potentially to include exfiltrated files.","Zeek http.log; Zeek dns.log; Internet-facing web proxies, DNS resolvers used by mobile devices, and Unified Endpoint Management (UEM) proxy logs.",last 90 days,": FOR EACH source_ip, destination_host pair:
  CALCULATE daily_post_get_ratio = count(POST)/count(GET)
  CALCULATE baseline_post_size_avg, baseline_post_size_stdev from 30_day_history
SEARCH aggregated http.log
WHERE daily_post_get_ratio > 10
OR avg(request_body_len) > (baseline_post_size_avg + 3 * baseline_post_size_stdev)
RETURN source_ip, destination_host, daily_post_get_ratio
",playbooks/attack/mobile/T1646.yml
T1646: Exfiltration Over C2 Channel,a8e6e24b-3d6f-4c8a-9a9b-7e6d5c4b3a21,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0036: Exfiltration,n; o; n; e,6,Does a mobile device's HTTP traffic pattern fall into a cluster of behavior that is anomalous when compared to the majority of network activity?,"This question uses unsupervised machine learning to find 'unknown unknowns.' By grouping all HTTP sessions based on various features (e.g., size ratios, entropy), most traffic will form large clusters of normal behavior. Outliers—small, isolated clusters—represent highly unusual activity that deviates significantly from the norm and warrants investigation for C2 and exfiltration.","Zeek http.log; Zeek dns.log; Internet-facing web proxies, DNS resolvers used by mobile devices, and Unified Endpoint Management (UEM) proxy logs.",last 90 days,": FOR EACH http_session in last hour:
  EXTRACT features (post_get_ratio, size_ratio, ua_entropy, uri_entropy, content_type_dist)
APPLY DBSCAN clustering algorithm to feature_set
INVESTIGATE sessions identified as outliers/noise
RETURN outlier_session_details
",playbooks/attack/mobile/T1646.yml
T1646: Exfiltration Over C2 Channel,a8e6e24b-3d6f-4c8a-9a9b-7e6d5c4b3a21,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0036: Exfiltration,n; o; n; e,7,Is a mobile device transferring archived files (like ZIP or RAR) over unencrypted channels to destinations that are not approved corporate cloud services?,Adversaries often compress and archive data before exfiltration to reduce its size and bundle many files together. Detecting the transfer of these archive file types over cleartext protocols (like HTTP or FTP) to non-standard or unapproved destinations is a strong indicator of data staging and exfiltration.,"Zeek files.log; Zeek conn.log; PCAP; Network TAPs capturing traffic from mobile subnets, Virtual Private Cloud (VPC) traffic mirroring, and Wi-Fi access points configured for full packet capture.",last 90 days,": SEARCH files.log WHERE mime_type IN ['application/zip', 'application/x-rar-compressed']
CORRELATE conn_uids with conn.log to get destination_ip
WHERE destination_ip NOT IN approved_cloud_service_ips
RETURN source_ip, destination_ip, file_mime_type
",playbooks/attack/mobile/T1646.yml
T1646: Exfiltration Over C2 Channel,a8e6e24b-3d6f-4c8a-9a9b-7e6d5c4b3a21,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0036: Exfiltration,n; o; n; e,8,"Is unencrypted traffic from a mobile device to an unapproved destination exhibiting high entropy, suggesting it is compressed or custom-encrypted?","Shannon entropy measures the randomness of data. Plain text has low entropy, while compressed or encrypted data has very high entropy. If an adversary uses a custom encryption scheme or simply compresses data before sending it over a non-TLS channel, the high entropy of the payload will be a key indicator of exfiltration, especially when the destination is not an approved service.","Zeek files.log; Zeek conn.log; PCAP; Network TAPs capturing traffic from mobile subnets, Virtual Private Cloud (VPC) traffic mirroring, and Wi-Fi access points configured for full packet capture.",last 90 days,": FOR EACH unencrypted_flow from mobile_device:
  IF destination_ip NOT IN enterprise_allow_list:
    CALCULATE payload_entropy
    IF payload_entropy > 7.5:
      ALERT source_ip, destination_ip, payload_entropy
",playbooks/attack/mobile/T1646.yml
T1646: Exfiltration Over C2 Channel,a8e6e24b-3d6f-4c8a-9a9b-7e6d5c4b3a21,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0036: Exfiltration,n; o; n; e,9,"Can a machine learning model, trained on a wide range of network features, classify a given network flow from a mobile device as potential exfiltration?","This represents a holistic, machine learning-driven approach. By combining numerous features—from connection metadata (duration, bytes) to payload analysis (entropy) and threat intelligence—a classification model can learn the complex patterns of exfiltration traffic. This allows it to identify malicious flows with higher confidence and detect novel techniques that might evade simpler, single-indicator rules.","Zeek files.log; Zeek conn.log; PCAP; Network TAPs capturing traffic from mobile subnets, Virtual Private Cloud (VPC) traffic mirroring, and Wi-Fi access points configured for full packet capture.",last 90 days,": features = [payload_entropy, protocol, port, duration, bytes_out, bytes_in, packet_size_stats, is_on_threat_list]
TRAIN classification_model on labeled_flows(features) -> 'benign' or 'exfil'
FOR EACH live_network_flow:
  prediction = model.predict(flow_features)
  IF prediction == 'exfil':
    ALERT flow_details",playbooks/attack/mobile/T1646.yml
T1655: Masquerading,3a1f8b4c-9e2a-4f6d-8c1b-7e5a0d4f3c2b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,1,Are mobile devices communicating with known command-and-control (C2) servers?,"This question aims to detect direct communication between a mobile device and known malicious infrastructure. Adversaries often use C2 servers to send commands to and exfiltrate data from compromised devices. Identifying these connections is a high-fidelity indicator of a potential compromise, even if the malicious application is masquerading as a legitimate one.",Zeek conn.log; Zeek dns.log; Zeek http.log; Corporate Wi-Fi Network Egress Points; VPN Concentrators; DNS Resolvers; Cloud Access Security Brokers (CASBs); Mobile Device Management (MDM) Platforms,last 90 days,"SEARCH Zeek logs (dns.log, conn.log) WHERE source_ip IN mobile_ip_range AND (destination_ip IN c2_threat_feed OR destination_domain IN c2_threat_feed). JOIN with http.log ON connection_uid. EXTRACT user_agent.",playbooks/attack/mobile/T1655.yml
T1655: Masquerading,3a1f8b4c-9e2a-4f6d-8c1b-7e5a0d4f3c2b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,2,"Is any mobile device exhibiting anomalous network behavior, such as unusual data volumes, uncommon port usage, or algorithmically generated domains?","This question seeks to identify deviations from normal, established network patterns for individual mobile devices. Masquerading applications may generate traffic that is statistically different from legitimate apps. High data volumes could indicate data exfiltration, unusual ports might be used to bypass firewalls, and high-entropy domains are a common sign of Domain Generation Algorithms (DGAs) used by malware to locate C2 servers.",Zeek conn.log; Zeek dns.log; Zeek http.log; Corporate Wi-Fi Network Egress Points; VPN Concentrators; DNS Resolvers; Cloud Access Security Brokers (CASBs); Mobile Device Management (MDM) Platforms,last 90 days,FOR each mobile_device_ip: BASELINE outbound_bytes and destination_ports over 30 days. CALCULATE Shannon entropy for all DNS queries. ALERT IF current_outbound_bytes > baseline_95th_percentile OR current_destination_port NOT IN baseline_ports OR dns_query_entropy > 3.5.,playbooks/attack/mobile/T1655.yml
T1655: Masquerading,3a1f8b4c-9e2a-4f6d-8c1b-7e5a0d4f3c2b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,3,Can machine learning models identify anomalous network connections or data spikes from mobile devices that are indicative of masquerading?,"This question leverages advanced analytics to find subtle or complex patterns of malicious activity that simple thresholding might miss. Time-series forecasting can detect sudden, unexpected spikes in data transfer, while clustering algorithms can group connections by their characteristics and isolate outliers that don't fit any normal profile, pointing to potentially hidden malicious communication channels.",Zeek conn.log; Zeek dns.log; Zeek http.log; Corporate Wi-Fi Network Egress Points; VPN Concentrators; DNS Resolvers; Cloud Access Security Brokers (CASBs); Mobile Device Management (MDM) Platforms,last 90 days,"MODEL 1 (Time-Series): TRAIN ARIMA on historical total_outbound_bytes per device. ALERT on significant forecast error. MODEL 2 (Clustering): TRAIN DBSCAN on connection features (duration, protocol, bytes). ALERT on connections classified as noise/outliers.",playbooks/attack/mobile/T1655.yml
T1655: Masquerading,3a1f8b4c-9e2a-4f6d-8c1b-7e5a0d4f3c2b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,4,"Are mobile applications (.apk or .ipa files) being downloaded to devices disguised with incorrect file extensions (e.g., '.pdf', '.jpg')?","This question looks for a classic masquerading technique where an attacker tricks a user into downloading a malicious application by naming it as a benign document or image file. By inspecting the file's actual MIME type, we can uncover this mismatch and identify attempts to bypass security controls and user suspicion.",Zeek files.log; Zeek http.log; Zeek conn.log; Organizational Internet Gateway; Web Proxies; Email Gateways; Cloud File Storage Services; Mobile Device Management (MDM) Platforms,last 90 days,SEARCH Zeek logs (files.log) WHERE (mime_type IS 'application/vnd.android.package-archive' AND filename NOT ENDS WITH '.apk') OR (mime_type IS 'application/x-itunes-ipa' AND filename NOT ENDS WITH '.ipa'). JOIN with conn.log to confirm source is from mobile_ip_range.,playbooks/attack/mobile/T1655.yml
T1655: Masquerading,3a1f8b4c-9e2a-4f6d-8c1b-7e5a0d4f3c2b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,5,Is any user downloading an unusually high number of files where the filename extension does not match the true file type?,"This question aims to detect anomalous user behavior by baselining file download activity. While occasional mismatches can occur, a sudden spike in the number of mismatched files for a single user could indicate a targeted attack or a compromised account being used to download malicious tools disguised as documents.",Zeek files.log; Zeek http.log; Zeek conn.log; Organizational Internet Gateway; Web Proxies; Email Gateways; Cloud File Storage Services; Mobile Device Management (MDM) Platforms,last 90 days,FOR each user: BASELINE daily count of file downloads with extension/MIME-type mismatch over 30 days. CALCULATE 99th percentile of this count across all users. ALERT if a user's daily count exceeds this organizational threshold.,playbooks/attack/mobile/T1655.yml
T1655: Masquerading,3a1f8b4c-9e2a-4f6d-8c1b-7e5a0d4f3c2b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,6,Can a machine learning model predict the risk of a file download being a masqueraded threat based on its metadata?,"This question uses a predictive model to proactively score the risk of file downloads. By training a model on features like MIME type, file size, source reputation, and referring URL, it can learn the characteristics of malicious downloads and assign a risk score, allowing analysts to focus on the highest-probability threats rather than chasing down every single mismatched file.",Zeek files.log; Zeek http.log; Zeek conn.log; Organizational Internet Gateway; Web Proxies; Email Gateways; Cloud File Storage Services; Mobile Device Management (MDM) Platforms,last 90 days,"MODEL (Random Forest): TRAIN on labeled file metadata (mime_type, extension, size, source_ip_rep, etc.). PREDICT 'masquerade_risk_score' for new file downloads. ALERT if score > 0.8.",playbooks/attack/mobile/T1655.yml
T1655: Masquerading,3a1f8b4c-9e2a-4f6d-8c1b-7e5a0d4f3c2b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,7,"Is a single IP address from the mobile VPN range generating a high volume of failed logins, suggesting a brute-force or password spray attack?",This question seeks to identify credential-based attacks originating from a potentially compromised mobile device. A high rate of failed logins from a single source IP is a strong indicator of an automated attack. Differentiating between attacks targeting a single account (brute-force) versus multiple accounts (password spray) helps in understanding the attacker's method and scope.,Zeek conn.log; Windows Event ID 4625; Windows Event ID 4624; VPN Concentrators; Authentication Servers; Domain Controllers; Active Directory; Identity and Access Management (IAM) Platforms; Internal File Servers,last 90 days,"SEARCH authentication logs WHERE event_id IS 4625 AND source_ip IN mobile_vpn_range. COUNT failures by source_ip and target_user over a 5-minute window. ALERT if count > 10. LABEL 'Brute-Force' if target_user is same, 'Password Spray' if different.",playbooks/attack/mobile/T1655.yml
T1655: Masquerading,3a1f8b4c-9e2a-4f6d-8c1b-7e5a0d4f3c2b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,8,Is the overall rate of failed authentication attempts from the mobile VPN IP range anomalously high compared to its historical baseline?,"This question provides a broader, environmental view of authentication health. Instead of focusing on a single IP, it monitors the aggregate behavior of the entire mobile VPN pool. A significant spike in the overall failure rate could indicate a large-scale, distributed attack or widespread issues, even if no single IP crosses a simple threshold.",Zeek conn.log; Windows Event ID 4625; Windows Event ID 4624; VPN Concentrators; Authentication Servers; Domain Controllers; Active Directory; Identity and Access Management (IAM) Platforms; Internal File Servers,last 90 days,FOR each hour: BASELINE count of failed logins (Event ID 4625) from mobile_vpn_range. CALCULATE moving average and standard deviation. ALERT if current hourly count > (average + 3 * std_dev).,playbooks/attack/mobile/T1655.yml
T1655: Masquerading,3a1f8b4c-9e2a-4f6d-8c1b-7e5a0d4f3c2b,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0030: Defense Evasion,n; o; n; e,9,"Is a user's authentication behavior from the mobile VPN, especially following a series of failures, a significant deviation from their established normal activity?","This question employs User and Entity Behavior Analytics (UEBA) to detect sophisticated attacks that might be missed by simple rules. A UEBA system learns what is 'normal' for each user (e.g., login times, systems accessed). It can then flag a sequence of events—like numerous login failures from a mobile VPN at an odd hour, followed by a successful login and access to a sensitive, rarely-used server—as a high-risk anomaly, even if each individual event is not inherently malicious.",Zeek conn.log; Windows Event ID 4625; Windows Event ID 4624; VPN Concentrators; Authentication Servers; Domain Controllers; Active Directory; Identity and Access Management (IAM) Platforms; Internal File Servers,last 90 days,"MODEL (UEBA): PROFILE normal user authentication patterns (times, locations, systems). ALERT on high-risk deviation score for a user on mobile VPN, especially after a sequence of failed logins (Event ID 4625) followed by a success (Event ID 4624) and access to unusual systems.",playbooks/attack/mobile/T1655.yml
T1664: Exploitation for Initial Access,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0027: Initial Access,n; o; n; e,1,"Has a mobile device connected to a known malicious IP address, domain, or SSL/TLS fingerprint?","This question aims to detect the most direct evidence of compromise by checking if a mobile device's network traffic matches indicators from threat intelligence feeds. A match against known malicious IPs, domains, or certificate hashes (JA3/JA3S) is a high-confidence signal that the device is communicating with an adversary's infrastructure, potentially as a result of an exploit.
",Zeek conn.log; Zeek dns.log; Zeek ssl.log; Corporate Wi-Fi network segments; Guest Wi-Fi network; VPN concentrators; Internet gateway proxy/firewall logs; MDM/UEM servers,last 90 days,"Search Zeek logs (conn, dns, ssl) for connections from mobile device IPs where the destination IP, requested domain, or JA3/JA3S hash matches a list of known malicious indicators.",playbooks/attack/mobile/T1664.yml
T1664: Exploitation for Initial Access,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0027: Initial Access,n; o; n; e,2,Is a mobile device exhibiting anomalous network behavior compared to its own historical baseline?,"This question seeks to identify subtle signs of compromise by detecting deviations from a device's normal network activity. Adversaries may use previously unknown infrastructure, which won't be caught by indicator matching. By monitoring for unusual spikes in data volume, connections to a wider-than-usual range of destination ports, or new client-side SSL/TLS fingerprints (JA3/JA3S), we can spot behavior that is abnormal for that specific device, even if not globally recognized as malicious.
",Zeek conn.log; Zeek dns.log; Zeek ssl.log; Corporate Wi-Fi network segments; Guest Wi-Fi network; VPN concentrators; Internet gateway proxy/firewall logs; MDM/UEM servers,last 90 days,"For each mobile device, calculate a 30-day rolling baseline of total bytes transferred, destination port entropy, and unique JA3/JA3S hashes. Alert if current hourly metrics exceed the 98th percentile of the historical baseline.",playbooks/attack/mobile/T1664.yml
T1664: Exploitation for Initial Access,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0027: Initial Access,n; o; n; e,3,Does a mobile device's sequence of network connections deviate from patterns learned by an advanced anomaly detection model?,"This question uses a sophisticated machine learning approach (LSTM Autoencoder) to detect complex anomalies in network traffic patterns. Unlike simple thresholding, this model learns the normal *sequence* and *relationship* between connections for a device. A high reconstruction error indicates that the current network activity is so different from the device's learned normal behavior that the model cannot accurately 'rebuild' it, suggesting a significant and potentially malicious deviation, such as C2 beaconing or data exfiltration.
",Zeek conn.log; Zeek dns.log; Zeek ssl.log; Corporate Wi-Fi network segments; Guest Wi-Fi network; VPN concentrators; Internet gateway proxy/firewall logs; MDM/UEM servers,last 90 days,"For each device, feed real-time network connection sequences (features: duration, bytes, proto, service) into a pre-trained LSTM Autoencoder. Alert if the reconstruction error for a sequence exceeds the 99th percentile of errors from the training data.",playbooks/attack/mobile/T1664.yml
T1664: Exploitation for Initial Access,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0027: Initial Access,n; o; n; e,4,Has a mobile device downloaded a known malicious file or an application from an unofficial app store?,"This question addresses two common initial access vectors: delivering malware and tricking users into sideloading malicious apps. By checking file hashes against malware signature databases, we can detect known threats. By monitoring for downloads of application packages (.apk, .ipa) from domains other than official, trusted app stores, we can identify potential sideloading attempts, which bypass security controls and are a frequent method for installing malware.
",Zeek http.log; Zeek files.log; Zeek dns.log; Internet gateway; Web Proxy; Guest Wi-Fi network; Corporate Wi-Fi network segments; Content Delivery Network (CDN) logs,last 90 days,Query 1: Search Zeek files.log for file transfers to mobile devices and alert if the MD5 or SHA1 hash matches a known mobile malware signature. Query 2: Search Zeek http.log for downloads of .apk or .ipa files where the host domain is not on the approved app store allowlist.,playbooks/attack/mobile/T1664.yml
T1664: Exploitation for Initial Access,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0027: Initial Access,n; o; n; e,5,Is a mobile device downloading an unusual number of files with mismatched MIME types?,"This question is designed to uncover attempts to obfuscate malicious payloads. Adversaries may serve a file with a benign MIME type (e.g., 'image/jpeg') while the actual file content is an executable or script. Zeek's ability to infer the true file type based on its content, regardless of the server's declaration, allows us to detect these mismatches. A sudden spike in such mismatches for a specific device, compared to its own history and the rest of the device fleet, is a strong indicator of suspicious activity.
",Zeek http.log; Zeek files.log; Zeek dns.log; Internet gateway; Web Proxy; Guest Wi-Fi network; Corporate Wi-Fi network segments; Content Delivery Network (CDN) logs,last 90 days,"For each mobile device, calculate the daily rate of MIME type mismatches from Zeek files.log. Alert if the daily rate exceeds 3 standard deviations above the device's own 30-day baseline or the fleet-wide baseline.",playbooks/attack/mobile/T1664.yml
T1664: Exploitation for Initial Access,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0027: Initial Access,n; o; n; e,6,Has a mobile device downloaded a file from a URL that is algorithmically scored as likely malicious?,"This question leverages machine learning to proactively identify dangerous URLs that may not yet be on any threat intelligence blacklist. By analyzing features of the URL itself—such as its length, complexity (entropy), number of subdomains, and the reputation of its domain—a model can predict the probability of it being malicious. This helps catch threats from newly created adversary infrastructure used in exploit delivery.
",Zeek http.log; Zeek files.log; Zeek dns.log; Internet gateway; Web Proxy; Guest Wi-Fi network; Corporate Wi-Fi network segments; Content Delivery Network (CDN) logs,last 90 days,"For each file download in Zeek http.log, extract URL features (length, entropy, subdomains, domain age). Use a classification model to generate a maliciousness score. Alert if the score exceeds a predefined threshold (e.g., > 0.9).",playbooks/attack/mobile/T1664.yml
T1664: Exploitation for Initial Access,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0027: Initial Access,n; o; n; e,7,Did a mobile device make an outbound connection to a known malicious host immediately after receiving a push notification?,"This question targets a key indicator of a zero-click or one-click exploit. The exploit is delivered via a push notification, which, upon receipt, triggers the device to connect to an adversary-controlled server without user interaction. By correlating a legitimate inbound push notification with a nearly simultaneous outbound connection to a known-bad destination, we can detect this specific and high-confidence attack pattern.
",Zeek conn.log; Zeek dns.log; Zeek ssl.log; Corporate Wi-Fi network; Guest Wi-Fi network; Internet Gateway; VPN termination points,last 90 days,Correlate Zeek conn.log events. Alert if an inbound connection from a push notification service IP is followed within 60 seconds by an outbound connection from the same device to an IP/domain on a malicious blocklist.,playbooks/attack/mobile/T1664.yml
T1664: Exploitation for Initial Access,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0027: Initial Access,n; o; n; e,8,Did a mobile device make an unusually fast outbound connection to a new domain immediately after receiving a push notification?,"This question aims to detect zero-click exploits without relying on a blocklist of known malicious domains. It establishes a baseline for each user's typical 'reaction time'—the delay between receiving a push notification and initiating a related outbound connection. An automated exploit will have a time delta that is a statistical outlier (extremely fast) compared to normal human interaction. Combining this with the condition that the destination is a new, previously unvisited domain for that device creates a powerful heuristic for detecting novel zero-click attacks.
",Zeek conn.log; Zeek dns.log; Zeek ssl.log; Corporate Wi-Fi network; Guest Wi-Fi network; Internet Gateway; VPN termination points,last 90 days,"For each device, create a historical distribution of time deltas between inbound push notifications and subsequent outbound connections. Alert if a new event has a time delta in the bottom 5th percentile AND the destination domain is new for that device in the last 30 days.",playbooks/attack/mobile/T1664.yml
T1664: Exploitation for Initial Access,a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d,technique,2025-10-01,2025-10-01,Zachary Szewczyk; Ask Sage,TA0027: Initial Access,n; o; n; e,9,"Did a mobile device's sequence of network states (e.g., from 'receiving push notification' to 'beaconing') violate its normal, learned transition patterns?","This question uses a Hidden Markov Model (HMM) to understand the *normal flow* of a device's network activity. The model learns the probability of transitioning from one state to another (e.g., from 'Idle' to 'Web Browsing'). A zero-click exploit would likely cause an improbable state transition, such as going directly from receiving a push notification to beaconing to a new C2 domain, bypassing any intermediate states associated with normal user activity. Detecting such a low-probability transition is a strong signal of an automated, non-user-driven event.
",Zeek conn.log; Zeek dns.log; Zeek ssl.log; Corporate Wi-Fi network; Guest Wi-Fi network; Internet Gateway; VPN termination points,last 90 days,"Using a per-device Hidden Markov Model trained on historical network event sequences, evaluate new event sequences in real-time. Alert if a state transition occurs that has a very low probability according to the trained model (e.g., 'Inbound_Push_Notification' -> 'Outbound_Beaconing_To_New_Domain').",playbooks/attack/mobile/T1664.yml
