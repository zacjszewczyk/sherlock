[
  {
    "Is the adversary executing malicious code using container orchestration jobs? (TA0002 - Execution)": {
      "Indicators": {
        "T1053.007 - Container Orchestration Job": {
          "Network traffic or host process creation consistent with the execution of code from a potentially malicious container job.": {
            "Data": "Zeek conn.log; Windows Event ID 4688",
            "Data Platform": "Network devices, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Identify new processes (Win Event ID 4688) or network connections (Zeek conn.log) on worker nodes that deviate significantly from the historical baseline for that node or container type. Use anomaly detection techniques (e.g., clustering or time series analysis on event frequency/type) to flag unusual activity coinciding with potential job execution times."
          },
          "Zeek conn.log showing connections from IP addresses associated with scheduled jobs to external or unusual destinations.": {
            "Data": "Zeek conn.log",
            "Data Platform": "Network devices",
            "NAI": "Insert site-specific NAI here",
            "Action": "Filter Zeek conn.log for connections originating from pod IP ranges on worker nodes. Identify connections to external IP addresses not in an approved list or to internal segments that pods associated with scheduled jobs should not reach. Use frequency analysis to identify rare or unusual destinations."
          },
          "Windows Event ID 4688 showing execution of common post-exploitation tools or scripts initiated by container processes on a worker node.": {
            "Data": "Windows Event ID 4688",
            "Data Platform": "Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 4688 on Kubernetes worker nodes. Identify process creation events where the parent process is a container runtime or associated process (e.g., containerd, dockerd, kubelet child process). Filter for commands or process names matching known post-exploitation tools, scripting interpreters (powershell, python, bash with suspicious arguments), or unexpected binaries within containers. Use frequency analysis or statistical profiling to detect commands rare for that container/node."
          },
          "Outbound network connections from container IP addresses on worker nodes to suspicious destinations (e.g., known C2, unusual ports, scan targets) immediately after a scheduled job's execution time.": {
            "Data": "Zeek conn.log",
            "Data Platform": "Network devices",
            "NAI": "Insert site-specific NAI here",
            "Action": "Identify IP ranges used by pods/containers on Kubernetes worker nodes. Correlate Zeek conn.log entries originating from these IPs with the scheduled execution times of known jobs. Filter for connections to external IPs not on allowed lists, connections using unusual ports, or connection patterns indicative of scanning (e.g., connections to many different ports/IPs). Use time series analysis to spot bursts of activity after scheduled job triggers. Compare connection patterns to established baselines using descriptive statistics."
          }
        }
      },
      "version": "1.1",
      "last_updated": "2025-05-07"
    }
  },
  {
    "Is the adversary maintaining persistence using container orchestration jobs? (TA0003 - Persistence)": {
      "Indicators": {
        "T1053.007 - Container Orchestration Job": {
          "Temporal patterns in Zeek conn.log or Windows Event IDs on nodes indicating recurring outbound connections or process creation at scheduled intervals.": {
            "Data": "Zeek conn.log; Windows Event ID 4688",
            "Data Platform": "Network devices, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Analyze Zeek conn.log and Windows Event ID 4688 timestamps on worker nodes. Look for recurring activity patterns (e.g., process creation, specific outbound connections) at fixed time intervals using time series analysis or periodicity detection methods."
          },
          "Detection of recurring network communication patterns (Zeek) or host process activity (Win Events) originating from nodes running scheduled jobs, consistent with attempts to maintain a specific malicious state.": {
            "Data": "Zeek conn.log; Windows Event ID 4688",
            "Data Platform": "Network devices, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Zeek conn.log and Windows Event ID 4688 for the repeated appearance of specific network connection patterns or process hashes originating from scheduled jobs over time. Use frequency analysis and correlation to identify attempts to maintain a persistent state or presence."
          },
          "Repeated identical outbound network connections from container IPs or identical process executions on worker nodes at regular intervals, not corresponding to known legitimate scheduled tasks.": {
            "Data": "Zeek conn.log; Windows Event ID 4688",
            "Data Platform": "Network devices, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Analyze Zeek conn.log (source IP, destination IP/port) and Windows Event ID 4688 (process hash, command line) originating from potential container processes/IPs on worker nodes over an extended period (e.g., days/weeks). Use time series analysis to detect activity occurring with a fixed periodicity. Correlate recurring patterns with known legitimate scheduled jobs or tasks. Flag activity lacking corresponding legitimate job configuration or exhibiting unusual target/command patterns."
          },
          "Windows Event IDs showing repeated attempts by container processes on worker nodes to modify host system files or create persistent artifacts (e.g., services, scheduled tasks - non-container orchestration ones).": {
            "Data": "Windows Event ID 4688",
            "Data Platform": "Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 4688 on Kubernetes worker nodes, focusing on processes initiated by container runtimes. Filter command lines for keywords or patterns associated with modifying host system persistence (e.g., `sc create`, `schtasks`, modifying `/etc/crontab`, modifying sensitive Windows registry keys or startup folders via scripts). Use frequency analysis to detect repeated attempts from the same source container/pod."
          }
        }
      },
      "version": "1.1",
      "last_updated": "2025-05-07"
    }
  },
  {
    "Is the adversary escalating privileges using container orchestration jobs? (TA0004 - Privilege Escalation)": {
      "Indicators": {
        "T1053.007 - Container Orchestration Job": {
          "Zeek conn.log showing connections from IP addresses associated with scheduled job pods to internal network segments or services they should not normally access.": {
            "Data": "Zeek conn.log",
            "Data Platform": "Network devices",
            "NAI": "Insert site-specific NAI here",
            "Action": "Analyze Zeek conn.log for connections originating from pod IP ranges to internal network resources. Calculate the entropy of destination ports and hosts accessed by pods from scheduled jobs; high entropy may indicate exploratory or malicious scanning/access attempts against internal infrastructure."
          },
          "Windows Event IDs on worker nodes indicating process creation or file access originating from container processes that interact with sensitive host resources.": {
            "Data": "Windows Event ID 4688",
            "Data Platform": "Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Analyze Windows Event ID 4688 on worker nodes. Look for process creation events initiated by container processes that attempt to execute commands or access paths outside the container's intended scope (e.g., host filesystem paths). Correlate with other host events indicating filesystem modification or sensitive resource access."
          },
          "Zeek conn.log showing connections from container IPs on worker nodes attempting to access credential stores or privileged services (e.g., LDAP, Kerberos, SSH/RDP to admin hosts) on internal network segments they shouldn't access.": {
            "Data": "Zeek conn.log",
            "Data Platform": "Network devices",
            "NAI": "Insert site-specific NAI here",
            "Action": "Analyze Zeek conn.log for connections originating from container IP ranges on worker nodes to sensitive internal services (e.g., domain controllers on LDAP/Kerberos ports, admin workstations on RDP/SSH ports, internal credential management systems). Use correlation to identify activity originating from scheduled jobs. Calculate the frequency of connections to these services from container IPs and flag connections outside of expected administrative pod activity using frequency analysis or thresholding."
          },
          "Windows Event ID 4688 on worker nodes showing container processes attempting to execute host system commands with elevated privileges or interacting with sensitive host-level resources.": {
            "Data": "Windows Event ID 4688",
            "Data Platform": "Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 4688 on Kubernetes worker nodes for processes initiated by container runtimes. Filter for commands that attempt to escalate privileges (e.g., `runas`, modifying security configurations) or access sensitive host-only resources (e.g., host files/registry via scripts). Use correlation to link these events to specific containers or scheduled jobs if possible. Use frequency analysis to detect rare or unique command executions originating from containers."
          }
        }
      },
      "version": "1.1",
      "last_updated": "2025-05-07"
    }
  }
]