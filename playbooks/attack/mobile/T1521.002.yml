name: T1521.002: Asymmetric Cryptography
id: 5a9b8e1c-7f5d-4f6a-8b3c-9d1e0a2b4c6d
description: Is an adversary using non-standard or suspicious asymmetric cryptography for command and control on mobile devices? This involves looking for anomalous TLS certificate properties like self-signed status, malicious issuers/subjects, or unusual validity periods. It also includes identifying highly regular, periodic 'heartbeat' connections characteristic of automated C2 communication, especially to known malicious IPs. Finally, it covers detecting data covertly tunneled within protocol fields not intended for bulk transfer, such as DNS queries or HTTP User-Agent strings, identified by matching malicious patterns or high Shannon entropy.
type: technique
related: TA0037: Command And Control
contributors: Zachary Szewczyk, Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Are mobile devices establishing TLS sessions using certificates with issuers or subjects known to be malicious?
    context: This question aims to identify direct connections to known malicious infrastructure. By cross-referencing certificate details against a threat intelligence feed, an analyst can quickly spot high-confidence indicators of compromise. Correlating this with connection logs confirms the traffic originates from a mobile device, which is crucial for attributing the activity and initiating the correct incident response procedure for mobile endpoints.
    answer_sources:
      - Zeek ssl.log
      - Zeek conn.log
      - Zeek ja3.log
      - Zeek ja3s.log
      - Network egress points
      - Corporate Wi-Fi access points
      - VPN concentrators
      - MDM (Mobile Device Management) proxy servers
      - Cloud Access Security Brokers (CASB)
      - Cellular network gateways (for corporate-liable devices backhauling traffic)
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          // SEARCH ssl.log for issuer or subject in threat_intel_list
          // JOIN results with conn.log on uid
          // WHERE source_ip is in mobile_ip_range
          // RETURN connection details
  - question: Are mobile devices using self-signed certificates or certificates with an unusually short validity period, suggesting non-standard or temporary C2 infrastructure?
    context: This question helps detect malware that uses self-signed certificates or short-lived certificates to evade detection based on traditional certificate authority reputation. Self-signed certificates are a common indicator of ad-hoc C2 setups. Similarly, an unusually short validity period can be a sign of dynamically generated certificates used by malware. By baselining normal certificate durations, analysts can spot statistical outliers that warrant investigation.
    answer_sources:
      - Zeek ssl.log
      - Zeek conn.log
      - Zeek ja3.log
      - Zeek ja3s.log
      - Network egress points
      - Corporate Wi-Fi access points
      - VPN concentrators
      - MDM (Mobile Device Management) proxy servers
      - Cloud Access Security Brokers (CASB)
      - Cellular network gateways (for corporate-liable devices backhauling traffic)
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          // SEARCH ssl.log where source_ip is in mobile_ip_range
          // CALCULATE validity_duration = not_valid_after - not_valid_before
          // CALCULATE baseline_5th_percentile for validity_duration over last 30 days
          // WHERE validation_status is 'self-signed' OR validity_duration < baseline_5th_percentile
          // RETURN connection details
  - question: Can a machine learning model identify high-risk TLS sessions from mobile devices based on a combination of certificate, TLS, and connection properties?
    context: This question leverages machine learning to detect subtle, complex patterns that may not be obvious through simple rule-based alerts. By combining multiple features—such as certificate details, TLS client fingerprint (JA3), server fingerprint (JA3S), and connection volume/duration—a model can learn to distinguish between benign and malicious traffic with greater nuance. This approach helps to surface suspicious activity that might otherwise be missed and provides a risk score to help analysts prioritize their investigative efforts on the most likely threats.
    answer_sources:
      - Zeek ssl.log
      - Zeek conn.log
      - Zeek ja3.log
      - Zeek ja3s.log
      - Network egress points
      - Corporate Wi-Fi access points
      - VPN concentrators
      - MDM (Mobile Device Management) proxy servers
      - Cloud Access Security Brokers (CASB)
      - Cellular network gateways (for corporate-liable devices backhauling traffic)
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          // FOR each TLS session from a mobile device:
          // EXTRACT features (cert duration, key length, TLS version, cipher, JA3, JA3S, conn duration, conn bytes)
          // INPUT features into pre-trained Random Forest model
          // IF model_risk_score > threshold:
          //   ALERT for analyst review
  - question: Are mobile devices communicating with IP addresses known to be Command and Control servers?
    context: This is a high-fidelity check to detect connections to known-bad infrastructure. By matching outbound connections from mobile devices against a curated list of C2 server IPs from a threat intelligence feed, analysts can immediately identify compromised devices. This type of alert is typically high priority because it provides strong evidence of an active C2 channel.
    answer_sources:
      - Zeek conn.log
      - Network egress points
      - VPN concentrators
      - MDM (Mobile Device Management) proxy servers
      - Corporate Wi-Fi gateways
      - Cellular network gateways (for corporate-liable devices backhauling traffic)
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          // SEARCH conn.log where source_ip is in mobile_ip_range
          // AND destination_ip is in c2_threat_intel_list
          // RETURN connection details as a high-priority alert
  - question: Are there any network flows from mobile devices exhibiting unusually regular 'heartbeat' behavior in terms of timing and data volume?
    context: This question seeks to identify automated C2 communications, often called 'beacons' or 'heartbeats', which are characterized by their regularity. Unlike human-generated traffic, which is typically bursty and random, malware C2 check-ins often occur at fixed intervals and involve similar amounts of data. By calculating the coefficient of variation for connection timing and data volume, analysts can statistically identify flows that are abnormally uniform and likely machine-generated, even if the destination is not on a known threat list.
    answer_sources:
      - Zeek conn.log
      - Network egress points
      - VPN concentrators
      - MDM (Mobile Device Management) proxy servers
      - Corporate Wi-Fi gateways
      - Cellular network gateways (for corporate-liable devices backhauling traffic)
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          // AGGREGATE conn.log over 1-hour windows by src_ip, dst_ip, dst_port, protocol
          // FOR each group with > 10 connections:
          //   CALCULATE CoV for inter-arrival_time
          //   CALCULATE CoV for total_bytes
          //   IF both CoV values are in the bottom 1st percentile of historical data:
          //     ALERT on the flow as potential beaconing
  - question: Can a time-series anomaly detection model identify network flows from mobile devices that deviate significantly from established normal behavior?
    context: This question applies advanced machine learning to detect C2 beaconing. An LSTM autoencoder can learn the complex, temporal patterns of normal network traffic for a specific flow. When a flow's behavior changes—for instance, if malware begins using it for C2—the model will be unable to accurately 'reconstruct' the new, anomalous pattern, resulting in a high reconstruction error. This flags the flow for investigation, providing a powerful way to detect novel or evolving C2 channels that don't conform to simple statistical rules.
    answer_sources:
      - Zeek conn.log
      - Network egress points
      - VPN concentrators
      - MDM (Mobile Device Management) proxy servers
      - Corporate Wi-Fi gateways
      - Cellular network gateways (for corporate-liable devices backhauling traffic)
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          // FOR each unique client-server flow:
          // EXTRACT time-series features (inter-arrival time, duration, bytes)
          // INPUT into pre-trained LSTM autoencoder model
          // IF reconstruction_error > threshold:
          //   ALERT on the flow as anomalous
  - question: Are mobile devices making DNS queries for known malicious domains or using HTTP User-Agents associated with malware?
    context: This question focuses on detecting C2 communication that hides within legitimate protocols like DNS and HTTP. Malware often uses Domain Generation Algorithms (DGAs) to find its C2 server, and these patterns can sometimes be identified with regular expressions. Similarly, malware may use a unique or known-bad User-Agent string in its HTTP-based C2. Matching DNS queries or User-Agents against threat intelligence lists and known patterns is a direct way to find these covert channels.
    answer_sources:
      - Zeek dns.log
      - Zeek http.log
      - Internal DNS resolvers
      - Forward web proxies
      - Reverse proxies
      - Cloud Access Security Brokers (CASB)
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          // SEARCH dns.log where query matches malicious_domain_list or dga_regex
          // OR
          // SEARCH http.log where user_agent matches malicious_ua_list
          // ALERT on any match
  - question: Are there DNS queries or HTTP User-Agents from mobile devices that appear unusually random, suggesting encoded data tunneling?
    context: This question aims to detect C2 data that is encoded and tunneled within fields like DNS query names or User-Agent strings. Such encoded data often has a high degree of randomness, which can be measured using Shannon entropy. By baselining the normal entropy for these fields, analysts can spot statistical outliers that are likely carrying an encoded payload. A follow-up Chi-squared test can further validate if the character distribution is anomalous compared to normal traffic, strengthening the evidence of covert tunneling.
    answer_sources:
      - Zeek dns.log
      - Zeek http.log
      - Internal DNS resolvers
      - Forward web proxies
      - Reverse proxies
      - Cloud Access Security Brokers (CASB)
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          // FOR each DNS query:
          //   CALCULATE entropy of query_name
          //   IF entropy > 99th_percentile_baseline:
          //     FLAG for review
          // FOR each HTTP request:
          //   CALCULATE entropy of user_agent
          //   IF entropy > 99th_percentile_baseline:
          //     FLAG for review
  - question: Can a clustering algorithm identify outlier DNS and HTTP requests from mobile devices based on their structural and entropy features?
    context: This question uses an unsupervised machine learning approach to find anomalies without pre-existing labels. A clustering algorithm like DBSCAN groups similar requests together based on features like length, complexity (subdomain count), and randomness (entropy). Requests that do not fit into any cluster are labeled as 'noise' or outliers. These outliers represent unusual activity that deviates from common patterns and are strong candidates for investigation as potential C2 tunneling.
    answer_sources:
      - Zeek dns.log
      - Zeek http.log
      - Internal DNS resolvers
      - Forward web proxies
      - Reverse proxies
      - Cloud Access Security Brokers (CASB)
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          // EXTRACT features (query_length, subdomain_count, query_entropy, ua_length, ua_entropy) from dns.log and http.log
          // INPUT features into DBSCAN model
          // FOR each data point classified as 'noise':
          //   ALERT as a potential outlier for investigation