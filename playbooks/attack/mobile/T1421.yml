name: T1421: System Network Connections Discovery
id: 5c8a6b9e-3f1d-4e8a-9b7c-0a1b2c3d4e5f
description: This playbook helps determine if an adversary is enumerating local or adjacent networks from a managed mobile device. The investigation focuses on identifying anomalous network discovery API calls and correlating them with subsequent high-risk outbound network connections. Indicators of compromise include unusual call frequency, calls from unexpected application types or background processes, and connections to known malicious servers, newly registered domains, or destinations exhibiting characteristics of command-and-control (C2) beaconing.
type: technique
related:
  - TA0032: Discovery
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Does an application making network discovery API calls match known indicators of compromise from a mobile threat intelligence feed?
    context: This question helps to quickly identify if an application performing network discovery is already known to be malicious. By comparing its package name, signing certificate hash, or developer ID against a threat intelligence feed, analysts can rapidly confirm a threat without needing complex behavioral analysis.
    answer_sources:
      - Mobile EDR API Logs
      - Android Logcat
      - UEM Application State Logs
      - MDM Application Inventory
      - MDM Permission Logs
      - MDM/UEM Platform
      - Mobile EDR/MTD Platform
      - SIEM/Data Lake
      - Managed Mobile Endpoints
    range: Last 90 days
    queries:
      - search_technology: pseudocode
        query: SEARCH Mobile EDR API Logs FOR network discovery calls JOIN with Threat Intelligence Feeds ON (package_name, certificate_hash, developer_id) RETURN matches.
  - question: Is an application exhibiting anomalous network discovery behavior based on its historical baseline, application category, or process state?
    context: This question aims to detect unusual scanning activity that deviates from an application's normal behavior. Legitimate apps may perform discovery, but a sudden spike (exceeding the 98th percentile of its baseline), discovery from an app that has no business scanning the network (like a game), or discovery from a long-running background process is highly suspicious and could indicate compromise.
    answer_sources:
      - Mobile EDR API Logs
      - Android Logcat
      - UEM Application State Logs
      - MDM Application Inventory
      - MDM Permission Logs
      - MDM/UEM Platform
      - Mobile EDR/MTD Platform
      - SIEM/Data Lake
      - Managed Mobile Endpoints
    range: Last 90 days
    queries:
      - search_technology: pseudocode
        query: SEARCH Mobile EDR API Logs FOR network discovery calls | GROUP by application, hour | COMPARE count to 30-day baseline | ALERT if count > 98th percentile OR app_category NOT IN ('Networking', 'Navigation', 'System Tools') OR background_process_time > 5 minutes.
  - question: Does a network discovery API call register as a statistical outlier when analyzed by a machine learning model?
    context: This question uses a machine learning approach (Local Outlier Factor) to identify subtle and evasive discovery activities that might be missed by simple threshold-based rules. By considering multiple features simultaneously (like time of day, app category, permissions), the model can detect complex patterns of anomalous behavior and flag events with high anomaly scores for deeper investigation.
    answer_sources:
      - Mobile EDR API Logs
      - Android Logcat
      - UEM Application State Logs
      - MDM Application Inventory
      - MDM Permission Logs
      - MDM/UEM Platform
      - Mobile EDR/MTD Platform
      - SIEM/Data Lake
      - Managed Mobile Endpoints
    range: Last 90 days
    queries:
      - search_technology: pseudocode
        query: INPUT API call event features (hour, category, permissions, etc.) INTO LOF model | CALCULATE anomaly score | ALERT if score is in top 1%.
  - question: Following a network discovery event, did the device connect to a known malicious C2 server or a high-risk destination like a newly registered domain?
    context: This question seeks to link the act of network discovery directly to a potential C2 communication channel. An adversary often scans the network to understand its surroundings before "phoning home." Correlating a discovery API call with an immediate connection to a known C2 indicator, a newly registered domain (NRD), or a direct-to-IP connection provides strong evidence of malicious activity.
    answer_sources:
      - Mobile EDR API Logs
      - Zeek conn.log
      - Zeek dns.log
      - Zeek ssl.log
      - Zeek notice.log
      - Threat Intelligence Feeds
      - Passive DNS Data
      - WHOIS Data
      - Network Gateway (Wireless Access Points, Firewalls)
      - DNS Servers
      - SIEM/Data Lake
      - Threat Intelligence Platform
    range: Last 90 days
    queries:
      - search_technology: pseudocode
        query: SEARCH Mobile EDR API Logs FOR network discovery calls | WITHIN 5 minutes, SEARCH Zeek logs for connections from device_ip | JOIN with C2 Threat Intel feed and WHOIS data | ALERT if destination is on C2 list OR domain is < 30 days old OR connection is direct-to-IP.
  - question: Following a network discovery event, does the device's subsequent network traffic exhibit characteristics of C2 communication, such as DGA, long-tail domains, or failed beaconing?
    context: This question looks for subtle indicators of C2 activity after a discovery event. It checks for three common patterns a) high entropy in DNS requests, which can indicate Domain Generation Algorithms (DGA); b) connections to rare domains (long-tail analysis); and c) a high rate of failed connections to a single destination, which can be a sign of a C2 beacon checking in.
    answer_sources:
      - Mobile EDR API Logs
      - Zeek conn.log
      - Zeek dns.log
      - Zeek ssl.log
      - Zeek notice.log
      - Threat Intelligence Feeds
      - Passive DNS Data
      - WHOIS Data
      - Network Gateway (Wireless Access Points, Firewalls)
      - DNS Servers
      - SIEM/Data Lake
      - Threat Intelligence Platform
    range: Last 90 days
    queries:
      - search_technology: pseudocode
        query: SEARCH Mobile EDR API Logs FOR network discovery calls | FOR next 10 minutes, MONITOR Zeek logs from device_ip | ALERT if Shannon_entropy(dns.query) > 4.2 OR destination_domain is rare (long-tail) OR failed_connection_ratio > 90%.
  - question: Following a network discovery event, does any subsequent outbound connection get classified as an anomaly by a machine learning model?
    context: This question employs a one-class SVM machine learning model to identify anomalous network connections that may represent C2 traffic. By training the model on "normal" traffic based on features like port, protocol, bytes transferred, and SSL/TLS fingerprints (JA3/JA3S), it can effectively flag any connection that deviates from this norm as a potential threat.
    answer_sources:
      - Mobile EDR API Logs
      - Zeek conn.log
      - Zeek dns.log
      - Zeek ssl.log
      - Zeek notice.log
      - Threat Intelligence Feeds
      - Passive DNS Data
      - WHOIS Data
      - Network Gateway (Wireless Access Points, Firewalls)
      - DNS Servers
      - SIEM/Data Lake
      - Threat Intelligence Platform
    range: Last 90 days
    queries:
      - search_technology: pseudocode
        query: SEARCH Mobile EDR API Logs FOR network discovery calls | FOR next 10 minutes, INPUT outbound connection features (port, protocol, bytes, JA3, etc.) INTO one-class SVM model | ALERT if connection is classified as outlier.