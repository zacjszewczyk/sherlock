name: "T1655: Masquerading"
id: 3a1f8b4c-9e2a-4f6d-8c1b-7e5a0d4f3c2b
description: "Is an adversary using masqueraded applications or files on mobile devices to evade defenses? This involves detecting suspicious network traffic from mobile devices, such as connections to known C2 servers, use of DGA-like domains, or anomalous data volumes. It also includes identifying files transferred to mobile devices where the filename extension mismatches the actual file type (e.g., an .apk file disguised as a .pdf). Additionally, it looks for signs of brute-force or password spray attacks originating from the mobile VPN range, indicated by a high rate of failed authentications followed by a success."
type: technique
related:
  - "TA0030: Defense Evasion"
contributors:
  - "Zachary Szewczyk"
  - "Ask Sage"
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: "Are mobile devices communicating with known command-and-control (C2) servers?"
    context: "This question aims to detect direct communication between a mobile device and known malicious infrastructure. Adversaries often use C2 servers to send commands to and exfiltrate data from compromised devices. Identifying these connections is a high-fidelity indicator of a potential compromise, even if the malicious application is masquerading as a legitimate one."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Zeek http.log"
      - "Corporate Wi-Fi Network Egress Points"
      - "VPN Concentrators"
      - "DNS Resolvers"
      - "Cloud Access Security Brokers (CASBs)"
      - "Mobile Device Management (MDM) Platforms"
    range: "last 90 days"
    queries:
      - "SEARCH Zeek logs (dns.log, conn.log) WHERE source_ip IN mobile_ip_range AND (destination_ip IN c2_threat_feed OR destination_domain IN c2_threat_feed). JOIN with http.log ON connection_uid. EXTRACT user_agent."
  - question: "Is any mobile device exhibiting anomalous network behavior, such as unusual data volumes, uncommon port usage, or algorithmically generated domains?"
    context: "This question seeks to identify deviations from normal, established network patterns for individual mobile devices. Masquerading applications may generate traffic that is statistically different from legitimate apps. High data volumes could indicate data exfiltration, unusual ports might be used to bypass firewalls, and high-entropy domains are a common sign of Domain Generation Algorithms (DGAs) used by malware to locate C2 servers."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Zeek http.log"
      - "Corporate Wi-Fi Network Egress Points"
      - "VPN Concentrators"
      - "DNS Resolvers"
      - "Cloud Access Security Brokers (CASBs)"
      - "Mobile Device Management (MDM) Platforms"
    range: "last 90 days"
    queries:
      - "FOR each mobile_device_ip: BASELINE outbound_bytes and destination_ports over 30 days. CALCULATE Shannon entropy for all DNS queries. ALERT IF current_outbound_bytes > baseline_95th_percentile OR current_destination_port NOT IN baseline_ports OR dns_query_entropy > 3.5."
  - question: "Can machine learning models identify anomalous network connections or data spikes from mobile devices that are indicative of masquerading?"
    context: "This question leverages advanced analytics to find subtle or complex patterns of malicious activity that simple thresholding might miss. Time-series forecasting can detect sudden, unexpected spikes in data transfer, while clustering algorithms can group connections by their characteristics and isolate outliers that don't fit any normal profile, pointing to potentially hidden malicious communication channels."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Zeek http.log"
      - "Corporate Wi-Fi Network Egress Points"
      - "VPN Concentrators"
      - "DNS Resolvers"
      - "Cloud Access Security Brokers (CASBs)"
      - "Mobile Device Management (MDM) Platforms"
    range: "last 90 days"
    queries:
      - "MODEL 1 (Time-Series): TRAIN ARIMA on historical total_outbound_bytes per device. ALERT on significant forecast error. MODEL 2 (Clustering): TRAIN DBSCAN on connection features (duration, protocol, bytes). ALERT on connections classified as noise/outliers."
  - question: "Are mobile applications (.apk or .ipa files) being downloaded to devices disguised with incorrect file extensions (e.g., '.pdf', '.jpg')?"
    context: "This question looks for a classic masquerading technique where an attacker tricks a user into downloading a malicious application by naming it as a benign document or image file. By inspecting the file's actual MIME type, we can uncover this mismatch and identify attempts to bypass security controls and user suspicion."
    answer_sources:
      - "Zeek files.log"
      - "Zeek http.log"
      - "Zeek conn.log"
      - "Organizational Internet Gateway"
      - "Web Proxies"
      - "Email Gateways"
      - "Cloud File Storage Services"
      - "Mobile Device Management (MDM) Platforms"
    range: "last 90 days"
    queries:
      - "SEARCH Zeek logs (files.log) WHERE (mime_type IS 'application/vnd.android.package-archive' AND filename NOT ENDS WITH '.apk') OR (mime_type IS 'application/x-itunes-ipa' AND filename NOT ENDS WITH '.ipa'). JOIN with conn.log to confirm source is from mobile_ip_range."
  - question: "Is any user downloading an unusually high number of files where the filename extension does not match the true file type?"
    context: "This question aims to detect anomalous user behavior by baselining file download activity. While occasional mismatches can occur, a sudden spike in the number of mismatched files for a single user could indicate a targeted attack or a compromised account being used to download malicious tools disguised as documents."
    answer_sources:
      - "Zeek files.log"
      - "Zeek http.log"
      - "Zeek conn.log"
      - "Organizational Internet Gateway"
      - "Web Proxies"
      - "Email Gateways"
      - "Cloud File Storage Services"
      - "Mobile Device Management (MDM) Platforms"
    range: "last 90 days"
    queries:
      - "FOR each user: BASELINE daily count of file downloads with extension/MIME-type mismatch over 30 days. CALCULATE 99th percentile of this count across all users. ALERT if a user's daily count exceeds this organizational threshold."
  - question: "Can a machine learning model predict the risk of a file download being a masqueraded threat based on its metadata?"
    context: "This question uses a predictive model to proactively score the risk of file downloads. By training a model on features like MIME type, file size, source reputation, and referring URL, it can learn the characteristics of malicious downloads and assign a risk score, allowing analysts to focus on the highest-probability threats rather than chasing down every single mismatched file."
    answer_sources:
      - "Zeek files.log"
      - "Zeek http.log"
      - "Zeek conn.log"
      - "Organizational Internet Gateway"
      - "Web Proxies"
      - "Email Gateways"
      - "Cloud File Storage Services"
      - "Mobile Device Management (MDM) Platforms"
    range: "last 90 days"
    queries:
      - "MODEL (Random Forest): TRAIN on labeled file metadata (mime_type, extension, size, source_ip_rep, etc.). PREDICT 'masquerade_risk_score' for new file downloads. ALERT if score > 0.8."
  - question: "Is a single IP address from the mobile VPN range generating a high volume of failed logins, suggesting a brute-force or password spray attack?"
    context: "This question seeks to identify credential-based attacks originating from a potentially compromised mobile device. A high rate of failed logins from a single source IP is a strong indicator of an automated attack. Differentiating between attacks targeting a single account (brute-force) versus multiple accounts (password spray) helps in understanding the attacker's method and scope."
    answer_sources:
      - "Zeek conn.log"
      - "Windows Event ID 4625"
      - "Windows Event ID 4624"
      - "VPN Concentrators"
      - "Authentication Servers"
      - "Domain Controllers"
      - "Active Directory"
      - "Identity and Access Management (IAM) Platforms"
      - "Internal File Servers"
    range: "last 90 days"
    queries:
      - "SEARCH authentication logs WHERE event_id IS 4625 AND source_ip IN mobile_vpn_range. COUNT failures by source_ip and target_user over a 5-minute window. ALERT if count > 10. LABEL 'Brute-Force' if target_user is same, 'Password Spray' if different."
  - question: "Is the overall rate of failed authentication attempts from the mobile VPN IP range anomalously high compared to its historical baseline?"
    context: "This question provides a broader, environmental view of authentication health. Instead of focusing on a single IP, it monitors the aggregate behavior of the entire mobile VPN pool. A significant spike in the overall failure rate could indicate a large-scale, distributed attack or widespread issues, even if no single IP crosses a simple threshold."
    answer_sources:
      - "Zeek conn.log"
      - "Windows Event ID 4625"
      - "Windows Event ID 4624"
      - "VPN Concentrators"
      - "Authentication Servers"
      - "Domain Controllers"
      - "Active Directory"
      - "Identity and Access Management (IAM) Platforms"
      - "Internal File Servers"
    range: "last 90 days"
    queries:
      - "FOR each hour: BASELINE count of failed logins (Event ID 4625) from mobile_vpn_range. CALCULATE moving average and standard deviation. ALERT if current hourly count > (average + 3 * std_dev)."
  - question: "Is a user's authentication behavior from the mobile VPN, especially following a series of failures, a significant deviation from their established normal activity?"
    context: "This question employs User and Entity Behavior Analytics (UEBA) to detect sophisticated attacks that might be missed by simple rules. A UEBA system learns what is 'normal' for each user (e.g., login times, systems accessed). It can then flag a sequence of events—like numerous login failures from a mobile VPN at an odd hour, followed by a successful login and access to a sensitive, rarely-used server—as a high-risk anomaly, even if each individual event is not inherently malicious."
    answer_sources:
      - "Zeek conn.log"
      - "Windows Event ID 4625"
      - "Windows Event ID 4624"
      - "VPN Concentrators"
      - "Authentication Servers"
      - "Domain Controllers"
      - "Active Directory"
      - "Identity and Access Management (IAM) Platforms"
      - "Internal File Servers"
    range: "last 90 days"
    queries:
      - "MODEL (UEBA): PROFILE normal user authentication patterns (times, locations, systems). ALERT on high-risk deviation score for a user on mobile VPN, especially after a sequence of failed logins (Event ID 4625) followed by a success (Event ID 4624) and access to unusual systems."