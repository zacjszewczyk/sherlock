name: T1604: Proxy Through Victim
id: 1a8b3c7d-4e2f-4a9b-8c6d-5e4f3a2b1c0d
description: Investigates whether an adversary is using a managed mobile device as a proxy to conceal C2 communications or evade IP-based restrictions. This is identified by looking for indicators such as anomalously large outbound data volumes, connections to an unusually high number of unique domains or IPs (often with high entropy), connections to ports commonly used for proxying (e.g., 1080), and network behavior characteristic of a relay, like an excessive number of concurrent or long-duration connections.
type: technique
related:
- TA0030: Defense Evasion
contributors:
- Zachary Szewczyk
- Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
- question: Has any mobile device transmitted an amount of outbound data exceeding a static threshold (e.g., 5 GB in 1 hour) to destinations not on an allowlist?
  context: This question aims to detect sudden, massive data exfiltration or proxy activity. A static threshold provides a simple, high-water mark for identifying egregious outliers. By excluding known-good traffic like backups, we reduce false positives and focus on potentially malicious, high-volume data transfers that could indicate the device is being used as a proxy.
  answer_sources:
  - Zeek conn.log
  - Corporate Wi-Fi network segments, VPN gateways, and network egress points monitoring traffic from mobile device subnets.
  range: last 90 days
  queries:
  - technology: Pseudocode
    query: SEARCH Zeek conn.log | GROUP BY id.orig_h over 1h | SUM orig_bytes > 5GB | WHERE id.resp_h NOT IN (allowlist) | ALERT
- question: Has any mobile device exhibited an outbound data volume that is statistically anomalous compared to its own historical baseline or its peer group's behavior?
  context: This question moves beyond static thresholds to detect more subtle anomalies. Comparing a device's activity to its own history helps spot sudden changes, while comparing it to a peer group helps identify devices behaving differently from similar users. An alert based on standard deviations or percentiles is a robust way to flag suspicious activity that might otherwise be missed.
  answer_sources:
  - Zeek conn.log
  - Corporate Wi-Fi network segments, VPN gateways, and network egress points monitoring traffic from mobile device subnets.
  range: last 90 days
  queries:
  - technology: Pseudocode
    query: SEARCH Zeek conn.log | GROUP BY id.orig_h over 1h | CALCULATE sum(orig_bytes) | COMPARE to 30-day baseline (self and peer group) | ALERT if sum(orig_bytes) > 3_std_dev_self OR > 99th_percentile_peer
- question: Does a mobile device's outbound data volume significantly deviate from the forecast of a trained time-series anomaly detection model?
  context: This question represents the most sophisticated approach, using machine learning to model a device's normal traffic patterns over time, including seasonality (e.g., daily/weekly cycles). An alert is generated when current behavior diverges from the model's prediction, indicating an anomaly that simple statistical methods might miss. This is effective for detecting low-and-slow proxy activity that doesn't trigger volumetric thresholds.
  answer_sources:
  - Zeek conn.log
  - Corporate Wi-Fi network segments, VPN gateways, and network egress points monitoring traffic from mobile device subnets.
  range: last 90 days
  queries:
  - technology: Pseudocode
    query: MODEL time-series on historical orig_bytes per device | SCORE live data from Zeek conn.log | ALERT if observed_volume deviates from predicted_volume beyond confidence_interval
- question: Has a mobile device queried an unusually high number of unique, non-allowlisted domains within a short time frame?
  context: This question aims to detect automated activity, such as that from a proxy or malware, which often involves contacting many different domains in rapid succession. A normal user is unlikely to generate such a high volume of unique queries manually. Focusing on non-allowlisted and newly observed domains helps prioritize the most suspicious activity.
  answer_sources:
  - Zeek dns.log
  - Zeek conn.log
  - Internal DNS servers, network firewalls, and web proxies that log DNS queries and outbound connections from mobile devices.
  range: last 90 days
  queries:
  - technology: Pseudocode
    query: SEARCH Zeek dns.log | GROUP BY id.orig_h over 5m | COUNT distinct query | ALERT if distinct_query_count > 100 AND query NOT IN (allowlist)
- question: Is a mobile device querying a statistically significant number of unique domains, and does the set of domains exhibit high entropy (randomness)?
  context: This question adds a layer of sophistication by analyzing not just the quantity but also the quality of the domains. High Shannon entropy in domain names is a hallmark of Domain Generation Algorithms (DGAs) used by malware for C2 communication. Combining a high unique domain count with high entropy creates a high-confidence indicator of automated, malicious activity like proxying C2 traffic.
  answer_sources:
  - Zeek dns.log
  - Zeek conn.log
  - Internal DNS servers, network firewalls, and web proxies that log DNS queries and outbound connections from mobile devices.
  range: last 90 days
  queries:
  - technology: Pseudocode
    query: SEARCH Zeek dns.log | GROUP BY id.orig_h over 1h | CALCULATE unique_sld_count and shannon_entropy(sld_set) | COMPARE to baselines | ALERT if unique_sld_count > 98th_percentile_peer AND shannon_entropy > 2_std_dev_self
- question: Does a machine learning model (Isolation Forest) identify a mobile device as a strong outlier based on its DNS and connection patterns?
  context: This question uses an unsupervised machine learning model, Isolation Forest, which is effective at identifying anomalies. By feeding it a rich set of features (like unique IP/DNS counts, entropy, and error ratios), the model can learn what "normal" multi-faceted behavior looks like and flag devices that deviate significantly across these dimensions, even if no single metric is extreme. This is powerful for detecting complex evasion techniques.
  answer_sources:
  - Zeek dns.log
  - Zeek conn.log
  - Internal DNS servers, network firewalls, and web proxies that log DNS queries and outbound connections from mobile devices.
  range: last 90 days
  queries:
  - technology: Pseudocode
    query: MODEL IsolationForest on historical features (unique_ips, unique_dns, entropy, error_ratios) | SCORE live data from Zeek logs | ALERT if device is flagged as outlier
- question: Has a mobile device connected to an external destination on a port commonly associated with proxy services?
  context: This question targets a straightforward indicator of proxy activity. Services like SOCKS and other web proxies often run on well-known, non-standard ports. Alerting on connections to these ports from mobile devices, which typically should not be making such connections, is a simple yet effective way to detect unauthorized proxy software. Correlating with MDM inventory can help validate if an approved app is responsible.
  answer_sources:
  - Zeek conn.log
  - MDM/EMM Application Inventory
  - Firewall Logs
  - Network flow collectors at egress points, firewall logs, and MDM/EMM management platforms.
  range: last 90 days
  queries:
  - technology: Pseudocode
    query: SEARCH Zeek/Firewall logs | WHERE id.orig_h IN (mobile_subnet) AND id.resp_p IN (1080, 3128, 8080, 8888) AND id.resp_h NOT IN (internal_services) | ALERT
- question: Is a mobile device connecting to an anomalously high ratio of 'rare' ports compared to its established baseline and peer group?
  context: This question seeks to identify deviations from normal application behavior. Every device establishes a profile of commonly used ports (e.g., 80, 443). A sudden increase in connections to ports outside this normal profile suggests a new, potentially unauthorized application is running. This is a powerful way to detect malware or proxy tools that use non-standard or dynamically chosen ports to evade simple port-based rules.
  answer_sources:
  - Zeek conn.log
  - MDM/EMM Application Inventory
  - Firewall Logs
  - Network flow collectors at egress points, firewall logs, and MDM/EMM management platforms.
  range: last 90 days
  queries:
  - technology: Pseudocode
    query: BASELINE common ports per device over 30 days | For each 1h window, CALCULATE ratio(rare_ports / common_ports) | COMPARE to peer group baseline | ALERT if ratio > 95th_percentile_peer
- question: Does a one-class SVM model, trained on normal connection behavior, classify any new connections from a mobile device as anomalous?
  context: This question uses a machine learning model (one-class SVM) to create a tight boundary around what constitutes "normal" connection behavior for a device, using features like port, protocol, and duration. Any new connection that falls outside this boundary is flagged as an anomaly. This is particularly effective for detecting novel or stealthy proxy channels that do not conform to any previously seen patterns.
  answer_sources:
  - Zeek conn.log
  - MDM/EMM Application Inventory
  - Firewall Logs
  - Network flow collectors at egress points, firewall logs, and MDM/EMM management platforms.
  range: last 90 days
  queries:
  - technology: Pseudocode
    query: MODEL One-Class SVM on historical connection features (port, protocol, duration) per device | SCORE live connections from Zeek conn.log | ALERT if connection is classified as anomaly
- question: Has a mobile device maintained an unusually long-lived connection (e.g., >24 hours) to a destination not on a corporate allowlist?
  context: This question targets persistent C2 channels or tunnels. While some legitimate applications maintain long connections, an extremely long-lived, established connection to an unknown external IP is highly suspicious. It may indicate the device is acting as a stable relay or is maintaining a heartbeat to a C2 server, a common behavior for proxy malware.
  answer_sources:
  - Zeek conn.log
  - Network flow collectors (e.g., Zeek sensors) at key chokepoints like the Wi-Fi access controller or VPN concentrator.
  range: last 90 days
  queries:
  - technology: Pseudocode
    query: SEARCH Zeek conn.log | WHERE id.orig_h IN (mobile_subnet) AND duration > 24h AND conn_state == 'SF' AND id.resp_h NOT IN (allowlist) | ALERT
- question: Does a mobile device show a statistically anomalous combination of high concurrent connections and unusual connection durations?
  context: This question seeks to identify devices acting as traffic relays by looking at multiple behavioral indicators at once. A device proxying traffic for multiple clients would likely have a high number of concurrent connections. Using a multivariate algorithm like Mahalanobis distance can detect when a device is an outlier in the two-dimensional space of "connection count" and "average duration," even if neither metric is extreme on its own.
  answer_sources:
  - Zeek conn.log
  - Network flow collectors (e.g., Zeek sensors) at key chokepoints like the Wi-Fi access controller or VPN concentrator.
  range: last 90 days
  queries:
  - technology: Pseudocode
    query: SEARCH Zeek conn.log | GROUP BY id.orig_h over 5m | CALCULATE active_conn_count and avg_duration | APPLY Mahalanobis distance against 30-day profile | ALERT if device is multivariate outlier
- question: Does a density-based clustering algorithm (DBSCAN) identify any mobile devices as behavioral outliers (noise) when compared to the rest of the device population?
  context: This question takes a population-level view. DBSCAN groups devices with similar network behaviors (e.g., similar connection counts, durations, and data volumes) into clusters. Devices that do not fit into any cluster are labeled as "noise." These noise points are, by definition, behaving uniquely compared to all other peer groups in the organization, making them prime candidates for investigation as potential unauthorized proxies.
  answer_sources:
  - Zeek conn.log
  - Network flow collectors (e.g., Zeek sensors) at key chokepoints like the Wi-Fi access controller or VPN concentrator.
  range: last 90 days
  queries:
  - technology: Pseudocode
    query: AGGREGATE features (avg_concurrent_conn, 95th_percentile_duration, total_bytes) over 24h for all devices | APPLY DBSCAN algorithm | ALERT on devices classified as 'noise'