name: T1637: Dynamic Resolution
id: a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d
description: This playbook helps determine if an adversary is maintaining command and control over a compromised mobile device by using dynamic resolution techniques. These techniques include using Domain Generation Algorithms (DGA) to create pseudo-random domain names, employing fast-flux DNS where a single domain rapidly resolves to a large and diverse set of IP addresses, and utilizing recently registered or unpopular domains for C2 beaconing. The goal is to identify these patterns in DNS and network traffic logs to uncover hidden C2 channels.
type: technique
related:
  - TA0037: Command and Control
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Are DNS queries from mobile devices matching known DGA domains from threat intelligence feeds?
    context: This question seeks to identify command and control activity by directly matching outbound DNS queries from mobile devices against a curated list of domains known to be generated by malware using Domain Generation Algorithms (DGA). A successful match is a high-fidelity indicator of a compromise and warrants immediate investigation, as it suggests a device is attempting to contact a malicious server.
    answer_sources:
      - Zeek dns.log
      - Mobile Device Management (MDM) DNS logs
      - Threat intelligence feeds of known DGA domains
      - Corporate Wi-Fi gateways, VPN concentrators, guest network segments, and Mobile Device Management (MDM) platform logs.
    range: last 90 days
    queries:
      - "search(technology=pseudocode): | FROM dns_logs WHERE source_ip IN mobile_ip_ranges | JOIN threat_intel_dga_feed ON dns_logs.query == threat_intel_dga_feed.domain | IF match_found, CREATE high_priority_alert"
  - question: Are mobile devices querying for domains that statistically resemble algorithmically generated domains based on entropy and character ratios?
    context: This question aims to detect previously unknown DGA activity by analyzing the linguistic and structural properties of domain names. DGAs often produce domains that appear random, which can be measured statistically through high Shannon entropy and an unusual ratio of numbers to letters. By comparing these metrics against a baseline of normal traffic, this method can proactively identify suspicious domains that are not yet present in threat intelligence feeds.
    answer_sources:
      - Zeek dns.log
      - DHCP or VPN logs (to identify mobile IP ranges)
      - Corporate Wi-Fi gateways, VPN concentrators, guest network segments, and Mobile Device Management (MDM) platform logs.
    range: last 90 days
    queries:
      - "search(technology=pseudocode): | FROM dns_logs WHERE source_ip IN mobile_ip_ranges | FOR_EACH domain | CALCULATE shannon_entropy, numeric_char_ratio | COMPARE with 30_day_baseline_percentiles | IF entropy > 98th_percentile AND numeric_ratio > 98th_percentile, FLAG domain as suspicious"
  - question: Can a machine learning model identify DNS queries from mobile devices as likely DGA-generated based on domain features?
    context: This question leverages machine learning to automate the detection of DGA domains. A model, such as a random forest classifier, can be trained on a large dataset of known benign and DGA domains. The model learns to identify malicious domains based on a combination of features like domain length, entropy, n-gram frequency, and character ratios. Applying this model to live DNS traffic allows for scalable, high-confidence detection of potential C2 communications.
    answer_sources:
      - Zeek dns.log
      - Mobile Device Management (MDM) DNS logs
      - Labeled dataset of DGA and legitimate domains (e.g., public DGA lists, Tranco Top 1M)
      - Corporate Wi-Fi gateways, VPN concentrators, guest network segments, and Mobile Device Management (MDM) platform logs.
    range: last 90 days
    queries:
      - "search(technology=pseudocode): | FROM dns_logs WHERE source_ip IN mobile_ip_ranges | APPLY pre-trained_dga_classifier_model to domain_query | IF model_confidence > 0.90, ESCALATE for analyst_review"
  - question: Are mobile devices connecting to domains or IPs known to be malicious C2 infrastructure according to threat intelligence?
    context: This question focuses on identifying direct connections to known-bad infrastructure. By taking domains queried by mobile devices, resolving them to IP addresses, and checking both the domain and the IP against threat intelligence blocklists, an organization can detect active C2 communication with a high degree of certainty. A match provides a clear, actionable signal of a compromise.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - Threat intelligence platform APIs (for C2 domains/IPs)
      - Corporate Wi-Fi gateways, VPN concentrators, guest network segments, and external WHOIS services.
    range: last 90 days
    queries:
      - "search(technology=pseudocode): | FROM dns_logs WHERE source_ip IN mobile_ip_ranges | ENRICH domain with resolved_ip | QUERY threat_intel_api with domain, resolved_ip | IF match_found, CREATE critical_priority_alert"
  - question: Are mobile devices exhibiting low-volume, periodic connections to recently registered and unpopular domains, indicative of C2 beaconing?
    context: Adversaries often use newly created, obscure domains for C2 to evade reputation-based defenses. This question combines domain analysis with network traffic analysis to find these threats. It first calculates a risk score for a domain based on its age and popularity. For connections to high-risk domains, it then analyzes the traffic patterns, looking for the "low and slow" behavior characteristic of C2 beaconing (low data volume and highly regular timing).
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - External WHOIS Data
      - External Domain Prevalence Lists (e.g., Tranco)
      - Corporate Wi-Fi gateways, VPN concentrators, guest network segments, and external WHOIS services.
    range: last 90 days
    queries:
      - "search(technology=pseudocode): | FROM dns_logs | ENRICH domain with whois_date, tranco_rank | CALCULATE risk_score | FROM conn_logs WHERE domain_risk > 10 | ANALYZE connection_patterns over 24h for source_ip | IF total_bytes < 20th_percentile AND timing_std_dev < 10th_percentile, FLAG source_ip for beaconing"
  - question: Can an autocorrelation function detect periodic C2 beaconing patterns in traffic to high-risk domains?
    context: This question applies a more rigorous statistical method to confirm C2 beaconing. After identifying traffic to a potentially malicious domain, an Autocorrelation Function (ACF) is applied to the time series of connection events. The ACF is designed to find repeating patterns in data. A strong, repeating peak in the ACF plot provides mathematical evidence of periodic, automated communication, a hallmark of malware beaconing.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - External WHOIS Data
      - External Domain Prevalence Lists
      - Corporate Wi-Fi gateways, VPN concentrators, guest network segments, and external WHOIS services.
    range: last 90 days
    queries:
      - "search(technology=pseudocode): | FOR high-risk_domains | CREATE time_series of connection_events for each source_ip | APPLY Autocorrelation_Function (ACF) to time_series | IF distinct_repeating_peak in ACF_plot, CREATE alert with detected_interval"
  - question: Are mobile devices querying domains associated with known dynamic DNS (DDNS) providers?
    context: Adversaries abuse legitimate Dynamic DNS (DDNS) services to frequently change the IP address associated with their C2 domain, making IP-based blocking ineffective. This question involves actively monitoring DNS traffic for queries to domains belonging to known DDNS providers. While not always malicious, such activity from a mobile device can be an indicator of an attempt to maintain a resilient C2 channel and warrants further review.
    answer_sources:
      - Zeek dns.log
      - Watchlist of DDNS provider domain patterns
      - Corporate Wi-Fi gateways, VPN concentrators, guest network segments, and DNS resolution infrastructure.
    range: last 90 days
    queries:
      - "search(technology=pseudocode): | FROM dns_logs WHERE source_ip IN mobile_ip_ranges | MATCH query against ddns_provider_watchlist (e.g., '*.ddns.net', '*.no-ip.com') | IF match_found, CREATE medium_priority_alert"
  - question: Are any domains being resolved to an unusually high number of unique IPs and ASNs with a low TTL, which is characteristic of fast-flux DNS?
    context: This question aims to detect fast-flux DNS, a technique where a domain's DNS records are changed rapidly to point to a large, rotating pool of compromised hosts acting as proxies. This makes the C2 server's true location difficult to find and block. By identifying domains that resolve to an anomalously high number of IPs and Autonomous Systems (ASNs) within a short time, especially with a low Time-To-Live (TTL) value, we can detect this evasive C2 technique.
    answer_sources:
      - Zeek dns.log
      - External IP to ASN Database
      - Corporate Wi-Fi gateways, VPN concentrators, guest network segments, and DNS resolution infrastructure.
    range: last 90 days
    queries:
      - "search(technology=pseudocode): | FROM dns_logs over 1h_window | GROUP_BY domain_name | COUNT unique resolved_ips, unique_asns | CALCULATE average_ttl | IF unique_ips > 99th_percentile AND unique_asns > 99th_percentile AND average_ttl < 300, CREATE high_priority_alert"
  - question: Can clustering algorithms identify a single mobile device connecting to a large and diverse set of destination endpoints, suggesting fast-flux activity?
    context: This question provides an alternative method for detecting fast-flux by focusing on the client's connection behavior. A mobile device communicating with a fast-flux network will make outbound connections to a wide and varied set of destination IPs and ASNs. A density-based clustering algorithm like DBSCAN can analyze this connection metadata and identify such a pattern as a single, large cluster of disparate endpoints, which is highly abnormal and indicative of fast-flux C2.
    answer_sources:
      - Zeek conn.log
      - External IP to ASN Database
      - Corporate Wi-Fi gateways, VPN concentrators, guest network segments, and DNS resolution infrastructure.
    range: last 90 days
    queries:
      - "search(technology=pseudocode): | FROM conn_logs for a single_mobile_ip over 15m_window | APPLY DBSCAN clustering on features (dest_ip, dest_port, dest_asn) | IF large_cluster_with_high_diversity is found, CREATE alert for source_ip"