name: T1639: Exfiltration Over Alternative Protocol
id: f47ac10b-58cc-4372-a567-0e02b2c3d479
description: >-
  This playbook addresses the information requirement: "Has an adversary exfiltrated data from a corporate mobile device by using a non-standard or alternative network protocol?". It focuses on detecting data exfiltration from mobile devices through three primary evidence categories. First, it looks for outbound connections using protocols not typical for a device's baseline or connections with unusually large data volumes, which could indicate misuse of protocols like FTP or IRC. Second, it identifies signs of DNS data tunneling, such as abnormally high query rates, high-entropy query names, or an unusual ratio of TXT/NULL requests. Third, it scrutinizes HTTP/S traffic for anomalously large POST requests or periodic 'heartbeat' connections to non-corporate or newly registered domains, which are indicative of command-and-control beaconing.
type: technique
related:
  - TA0036: Exfiltration
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Is a mobile device connecting to a known malicious command-and-control (C2) server or data exfiltration service?
    context: >-
      This question aims to identify high-confidence indicators of compromise by correlating outbound connections from mobile devices with external threat intelligence. A match suggests that the device may be communicating with an adversary's infrastructure, a common step in data exfiltration.
    answer_sources:
      - Zeek conn.log
      - Threat intelligence feeds
      - Corporate Wi-Fi network segments
      - guest networks
      - VPN concentrators
      - cloud proxies
      - Mobile Device Management (MDM) platform logs
    range: last 90 days
    queries:
      - pseudocode: >-
          SEARCH Zeek conn.log WHERE source_ip IN mobile_ip_space
          | JOIN destination_ip, destination_port WITH threat_intelligence_feed
          | IF match, ALERT
  - question: Is a mobile device exhibiting anomalous network behavior by using a new protocol or sending an unusually large amount of data for a given protocol?
    context: >-
      Adversaries may use uncommon or non-standard protocols to exfiltrate data to bypass security controls focused on common protocols like HTTP/S. This question helps detect such activity by establishing a baseline of normal protocol usage and data volume for each device and the entire fleet. Deviations from this baseline are strong indicators of potential exfiltration.
    answer_sources:
      - Zeek conn.log
      - Corporate Wi-Fi network segments
      - guest networks
      - VPN concentrators
      - cloud proxies
      - Mobile Device Management (MDM) platform logs
    range: last 90 days
    queries:
      - pseudocode: >-
          FOR each device:
            CREATE 30_day_protocol_baseline
            SEARCH Zeek conn.log
            IF protocol NOT IN baseline, ALERT
          COMPUTE 99th_percentile_bytes_per_protocol FOR all_devices
          SEARCH Zeek conn.log
            IF outbound_bytes > 99th_percentile for protocol, ALERT
  - question: Can machine learning detect anomalous outbound connections from mobile devices that may indicate data exfiltration?
    context: >-
      This question leverages unsupervised machine learning (Isolation Forest) to identify outliers in network connection data. This approach can detect novel or sophisticated exfiltration techniques that might not be caught by signature-based or simple thresholding rules. By analyzing multiple features of a connection (protocol, port, duration, bytes), it provides a more holistic view of what constitutes an anomaly.
    answer_sources:
      - Zeek conn.log
      - Corporate Wi-Fi network segments
      - guest networks
      - VPN concentrators
      - cloud proxies
      - Mobile Device Management (MDM) platform logs
    range: last 90 days
    queries:
      - pseudocode: >-
          EXTRACT features (protocol, port, duration, bytes) from Zeek conn.log
          | INPUT features into trained_Isolation_Forest_model
          | IF model_flags_connection_as_outlier, ALERT for investigation
  - question: Is a mobile device making DNS queries to domains known to be associated with malicious activity or DNS tunneling?
    context: >-
      This question focuses on detecting DNS-based threats by comparing DNS queries against a blocklist of known malicious domains. This is a high-fidelity method for identifying connections to command-and-control servers or domains used for DNS tunneling, a technique where data is encoded within DNS queries and responses.
    answer_sources:
      - Zeek dns.log
      - Threat intelligence feeds
      - Internal DNS resolvers
      - network egress points
      - Cloud Access Security Broker (CASB) logs
      - Mobile Device Management (MDM) platform logs
    range: last 90 days
    queries:
      - pseudocode: >-
          SEARCH Zeek dns.log WHERE source_ip IN mobile_ip_space
          | JOIN query_domain WITH malicious_domain_blocklist
          | IF match, ALERT
  - question: Is a mobile device exhibiting anomalous DNS behavior, such as a spike in query volume, unusually long or complex query names, or a high ratio of TXT/NULL requests?
    context: >-
      DNS tunneling often manifests as statistical anomalies in DNS traffic. This question aims to detect these anomalies by baselining normal DNS behavior for each device. A sudden increase in query volume, high entropy (randomness) in query names, or an unusual number of TXT/NULL requests (which can carry larger data payloads) are all strong indicators of potential DNS tunneling for data exfiltration.
    answer_sources:
      - Zeek dns.log
      - Internal DNS resolvers
      - network egress points
      - Cloud Access Security Broker (CASB) logs
      - Mobile Device Management (MDM) platform logs
    range: last 90 days
    queries:
      - pseudocode: >-
          FOR each device:
            CREATE 30_day_baseline (query_volume, query_length, entropy)
            SEARCH Zeek dns.log
            IF daily_metric > 3_std_dev from baseline, ALERT
            CALCULATE TXT/NULL_ratio
            IF ratio > 95th_percentile_for_fleet, ALERT
  - question: Can a machine learning classifier identify individual DNS queries that are likely part of a DNS tunneling attack?
    context: >-
      This question applies supervised machine learning to classify DNS queries as benign or malicious in real-time. By training a Random Forest model on features characteristic of DNS tunneling (e.g., query length, entropy, character types), this approach can detect malicious queries with high precision, complementing statistical and signature-based methods.
    answer_sources:
      - Zeek dns.log
      - Internal DNS resolvers
      - network egress points
      - Cloud Access Security Broker (CASB) logs
      - Mobile Device Management (MDM) platform logs
    range: last 90 days
    queries:
      - pseudocode: >-
          EXTRACT features (length, entropy, char_types) from Zeek dns.log queries
          | INPUT features into trained_Random_Forest_model
          | IF model_score > 0.85, ALERT for investigation
  - question: Is a mobile device sending a large amount of data via an HTTP/S POST request to a known malicious or newly registered domain?
    context: >-
      This question combines three strong indicators of data exfiltration: a large data upload (POST request), a destination known to be malicious (threat intelligence), and a potentially suspicious domain (NRD). An alert triggered by this logic is a high-confidence signal that an adversary is actively exfiltrating a significant volume of data.
    answer_sources:
      - Zeek http.log
      - Zeek ssl.log
      - Zeek conn.log
      - Threat intelligence feeds
      - Newly Registered Domain (NRD) feeds
      - Web proxies
      - internet gateways
      - VPN concentrators with SSL/TLS inspection capabilities
      - mobile application security gateways
      - Cloud Access Security Broker (CASB) platforms
    range: last 90 days
    queries:
      - pseudocode: >-
          SEARCH Zeek http.log, ssl.log, conn.log WHERE source_ip IN mobile_ip_space AND method == "POST"
          | JOIN destination_host with (malicious_domains_feed, NRD_feed)
          | IF match AND outbound_bytes > 500KB, ALERT
  - question: Is a mobile device exhibiting HTTP/S traffic patterns indicative of data exfiltration, such as unusually large uploads or periodic, 'heartbeat' beaconing to a single destination?
    context: >-
      This question looks for two distinct patterns. First, it identifies anomalously large data uploads over standard web ports (80/443), which could be a simple exfiltration method. Second, it searches for C2 beaconing, where malware maintains a connection to its controller through regular, periodic callbacks. A low standard deviation in the time between connections is a classic sign of automated, non-human traffic.
    answer_sources:
      - Zeek conn.log
      - Web proxies
      - internet gateways
      - VPN concentrators with SSL/TLS inspection capabilities
      - mobile application security gateways
      - Cloud Access Security Broker (CASB) platforms
    range: last 90 days
    queries:
      - pseudocode: >-
          COMPUTE 99th_percentile_bytes for ports 80, 443
          SEARCH Zeek conn.log
          IF outbound_bytes > 99th_percentile, ALERT
          FOR each device-destination_pair:
            CALCULATE std_dev of connection_time_deltas
            IF std_dev < 2.0s AND frequency > 10/hour, ALERT
  - question: Is a mobile device using an unusual or unique TLS/HTTP client fingerprint, especially when associated with suspicious network activity?
    context: >-
      This question uses client fingerprinting (JA3/JA3S for TLS, User-Agent for HTTP) to identify malicious or non-standard applications. Legitimate applications often have common fingerprints. Malware or custom exfiltration tools may have unique or rare fingerprints. By clustering these fingerprints, we can identify outliers that warrant further investigation, particularly when they are correlated with other suspicious activities like large uploads or connections to rare domains.
    answer_sources:
      - Zeek http.log
      - Zeek ssl.log
      - Web proxies
      - internet gateways
      - VPN concentrators with SSL/TLS inspection capabilities
      - mobile application security gateways
      - Cloud Access Security Broker (CASB) platforms
    range: last 90 days
    queries:
      - pseudocode: >-
          EXTRACT JA3/JA3S and User-Agent from Zeek logs
          | CREATE client_fingerprints
          | INPUT fingerprints into K-Means clustering model
          | IF fingerprint in small or new cluster, ALERT for investigation