name: T1637.001: Domain Generation Algorithms
id: 123e4567-e89b-12d3-a456-426614174000
description: This playbook focuses on detecting the use of Domain Generation Algorithms (DGAs) by adversaries to establish command and control channels, particularly from mobile devices. The primary goal is to identify anomalous DNS query patterns that are characteristic of DGA activity. This includes observing a high volume of DNS requests for unique, non-existent domains (NXDOMAINs) with high Shannon entropy from a single device; identifying connections to very recently registered domains that have low internal prevalence; and detecting patterns indicative of DNS tunneling, such as an unusually high frequency of queries for subdomains of a single parent domain or queries that are abnormally long or appear to contain encoded data.
type: technique
related:
  - TA0037: Command and Control
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Is a mobile device querying for domains that match known DGA patterns from threat intelligence feeds?
    context: This question aims to identify the most straightforward DGA activity by matching DNS queries against a curated list of known malicious DGA domain patterns. A match is a high-confidence indicator of compromise, suggesting the device is infected with a known malware family that uses DGA for C2 communications.
    answer_sources:
      - Zeek dns.log
      - Windows DNS Server Analytic Event ID 260
      - Network traffic from mobile device subnets
      - MDM/CASB logs
      - Threat intelligence feeds of DGA patterns
    range: last 90 days
    queries:
      - pseudocode: SEARCH dns_logs WHERE source_ip IN mobile_ip_ranges AND query MATCHES dga_threat_feed_regex
  - question: Is any mobile device exhibiting a high rate of failed DNS lookups for random-looking domains, deviating from its normal behavior?
    context: This question seeks to detect DGA activity by identifying its characteristic 'beaconing' behavior. DGAs often generate a large number of domains, many of which are not yet registered, leading to a high volume of NXDOMAIN (non-existent domain) responses. The high entropy (randomness) of the queried domains is another strong indicator. By baselining normal activity and looking for statistical outliers, we can uncover previously unknown DGA-based malware.
    answer_sources:
      - Zeek dns.log
      - Windows DNS Server Analytic Event ID 260
      - Network traffic from mobile device subnets
      - MDM/CASB logs
    range: last 90 days
    queries:
      - pseudocode: SEARCH dns_logs | BIN time by 5m | GROUP BY source_ip | CALCULATE unique_nxdomain_count, avg_entropy(query) | WHERE source_ip IN mobile_ip_ranges AND unique_nxdomain_count > baseline_99th_percentile AND avg_entropy > 3.5
  - question: Are any domains being queried by mobile devices that a machine learning model classifies as highly likely to be algorithmically generated?
    context: This question applies machine learning to detect DGAs that may not be caught by simple statistical thresholds or known patterns. By analyzing linguistic and structural features of a domain name (length, randomness, character ratios), a classification model can score its likelihood of being machine-generated versus human-created. This advanced method helps identify novel or sophisticated DGA families.
    answer_sources:
      - Zeek dns.log
      - Windows DNS Server Analytic Event ID 260
      - Network traffic from mobile device subnets
      - MDM/CASB logs
      - Organizational domain allowlist
    range: last 90 days
    queries:
      - pseudocode: SEARCH dns_logs WHERE source_ip IN mobile_ip_ranges AND query NOT IN allowlist | EXTRACT_FEATURES(query) | SCORE with dga_classification_model | WHERE score > 0.90
  - question: Are mobile devices communicating with domains that have been registered very recently (within the last 3 days)?
    context: This question helps identify 'just-in-time' C2 infrastructure. Adversaries using DGAs often register the generated domains only shortly before they are needed for a campaign. A connection to a brand new domain is highly suspicious and a common tactic for evading reputation-based blacklists, which take time to update.
    answer_sources:
      - Zeek dns.log
      - External WHOIS Data
      - Egress network traffic at gateways/proxies
      - MDM/CASB logs
    range: last 90 days
    queries:
      - pseudocode: SEARCH dns_logs WHERE source_ip IN mobile_ip_ranges AND rcode = 'NOERROR' | ENRICH with whois_data(query) | WHERE creation_date < (now - 3_days)
  - question: Are mobile devices connecting to newly registered domains that are rarely visited by other devices within the organization?
    context: This question combines two powerful indicators: domain age and internal rarity (prevalence). Legitimate new services tend to gain popularity quickly, while C2 domains are typically used by only a few compromised hosts. A connection to a new domain that very few other internal devices have ever contacted is a strong signal of targeted or isolated malicious activity.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - External WHOIS Data
      - Egress network traffic at gateways/proxies
      - MDM/CASB logs
    range: last 90 days
    queries:
      - pseudocode: JOIN dns_logs, conn_logs ON resolved_ip | ENRICH with whois_data(query) | WHERE creation_date < (now - 30_days) | GROUP BY query | CALCULATE unique_source_ip_count | WHERE unique_source_ip_count < 5
  - question: Is any mobile device showing an anomalous spike in connections to newly registered domains over time?
    context: This question uses time series analysis to detect changes in behavior. A device that suddenly starts contacting an unusually high number of new domains may have been recently compromised or activated. By modeling the historical pattern of this behavior for each device, we can spot statistically significant deviations that indicate a potential C2 beaconing pattern to fresh infrastructure.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - External WHOIS Data
      - Egress network traffic at gateways/proxies
      - MDM/CASB logs
    range: last 90 days
    queries:
      - pseudocode: SEARCH connections_to_new_domains per day per device | APPLY time_series_anomaly_detection | ALERT on statistically_significant_spikes
  - question: Are mobile devices sending abnormally long or encoded DNS queries, potentially indicating DNS tunneling?
    context: This question targets DNS tunneling, a technique for C2 communication where data is hidden within DNS queries. DNS protocol standards have limits (e.g., 63 characters per label, 255 bytes total). Queries exceeding these limits or containing encoded data (like Base64) are highly anomalous and strongly suggest data exfiltration or C2 commands are being tunneled through DNS. Correlating this with recent DGA-like activity (NXDOMAINs) strengthens the finding.
    answer_sources:
      - Zeek dns.log
      - DNS traffic logs from resolvers/forwarders
      - NSM sensors
    range: last 90 days
    queries:
      - pseudocode: SEARCH dns_logs WHERE source_ip IN mobile_ip_ranges AND (label_length > 63 OR total_length > 255 OR query MATCHES encoding_patterns) | CORRELATE with recent_nxdomain_activity(source_ip)
  - question: Is a mobile device sending an unusually high volume of queries for unique subdomains of a single parent domain?
    context: This question aims to detect a specific DNS tunneling pattern where a compromised client communicates with a C2 server by rapidly querying many different subdomains of a single attacker-controlled domain. This behavior is abnormal for legitimate traffic. By baselining normal DNS traffic and looking for statistical outliers in query frequency and unique subdomain counts, we can pinpoint this C2 channel.
    answer_sources:
      - Zeek dns.log
      - DNS traffic logs from resolvers/forwarders
      - NSM sensors
    range: last 90 days
    queries:
      - pseudocode: SEARCH dns_logs | BIN time by 10m | GROUP BY source_ip, parent_domain | CALCULATE query_count, unique_subdomain_count | WHERE query_count > baseline_99.5_percentile OR unique_subdomain_count > baseline_99.5_percentile
  - question: Can unsupervised machine learning models identify mobile devices exhibiting anomalous DNS behavior consistent with tunneling?
    context: This question uses unsupervised ML (clustering) to find 'unknown unknowns.' Instead of defining specific thresholds, the model groups all devices by their DNS behavior based on features like query rate, size, and randomness. Devices that don't fit into the large cluster of 'normal' behavior are flagged as outliers. This approach is powerful for detecting novel or evasive DNS tunneling techniques that don't match pre-defined rules.
    answer_sources:
      - Zeek dns.log
      - DNS traffic logs from resolvers/forwarders
      - NSM sensors
    range: last 90 days
    queries:
      - pseudocode: SEARCH dns_logs over 1h | EXTRACT_FEATURES per source_ip | APPLY clustering_model | INVESTIGATE outlier_clusters