name: "T1418.001: Security Software Discovery"
id: "a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d"
description: |
  This playbook helps investigate if an adversary is attempting to discover security software on managed mobile devices. This involves detecting applications that exhibit suspicious network behavior shortly after being launched, such as connecting to rare or algorithmically generated domains and exfiltrating data. It also includes identifying applications that make anomalous HTTP/S POST requests, characterized by unusually large data volumes or communication with new or disreputable destinations. Furthermore, the playbook focuses on statically or dynamically identifying applications that request invasive permissions (e.g., Android's QUERY_ALL_PACKAGES) or use private APIs (e.g., iOS's LSApplicationWorkspace) to enumerate other applications installed on the device.
type: "technique"
related:
  - "TA0032: Discovery"
contributors:
  - "Zachary Szewczyk"
  - "Ask Sage"
created: "2025-10-01"
modified: "2025-10-01"
version: 1.0
tags: "none"
questions:
  - question: "Is a newly launched application communicating with known malicious domains or using malicious TLS fingerprints?"
    context: |
      This question aims to identify if an application, immediately after its first launch, is establishing network connections to destinations flagged by threat intelligence. Matching DNS queries against known malicious domains and comparing TLS JA3/JA3S hashes against malicious fingerprints can reveal command-and-control (C2) communication or other malicious activity disguised as legitimate traffic.
    answer_sources:
      - "Zeek dns.log"
      - "Zeek conn.log"
      - "MDM/EMM Application Activity Logs"
      - "Corporate DNS Resolvers"
      - "Network Egress Firewalls"
      - "VPN Concentrators"
      - "MDM/EMM Platform Servers"
    range: "last 90 days"
    queries:
      - technology: pseudocode
        query: |
          SEARCH MDM/EMM for new app launches.
          FOR each launch, SEARCH network logs (Zeek dns.log, ssl.log) within 5 minutes.
          JOIN on device IP.
          CHECK DNS query against threat intel feeds.
          CHECK JA3/JA3S hashes against malicious fingerprint feeds.
          ALERT on match.
  - question: "Is a mobile device querying statistically rare or algorithmically generated domains?"
    context: |
      This question focuses on detecting Domain Generation Algorithms (DGAs) and other evasion techniques. Adversaries often use DGAs to create a large number of domains, making blocklisting difficult. A domain that is rarely visited across the enterprise (low prevalence) or has a high degree of randomness (high entropy) is a strong indicator of potential DGA activity and warrants investigation.
    answer_sources:
      - "Zeek dns.log"
      - "Zeek conn.log"
      - "MDM/EMM Application Activity Logs"
      - "Corporate DNS Resolvers"
      - "Network Egress Firewalls"
      - "VPN Concentrators"
      - "MDM/EMM Platform Servers"
    range: "last 90 days"
    queries:
      - technology: pseudocode
        query: |
          SEARCH all DNS logs (Zeek dns.log) from mobile subnet for the last 30 days.
          CALCULATE prevalence for each queried domain.
          FOR new queries, ALERT if prevalence < 1st percentile.
          CALCULATE Shannon entropy for the registered domain.
          ALERT if entropy > 4.0.
  - question: "Is a newly launched application exhibiting anomalous outbound data transfer volumes that correlate with low-prevalence DNS queries?"
    context: |
      This question seeks to identify data exfiltration by modeling normal network behavior. A sudden, unexpectedly large data transfer shortly after a new application is launched, especially when directed to a rare domain, is highly suspicious. A time-series model can establish a baseline for expected data volume, making significant deviations that exceed a confidence threshold stand out as anomalies requiring investigation.
    answer_sources:
      - "Zeek dns.log"
      - "Zeek conn.log"
      - "MDM/EMM Application Activity Logs"
      - "Corporate DNS Resolvers"
      - "Network Egress Firewalls"
      - "VPN Concentrators"
      - "MDM/EMM Platform Servers"
    range: "last 90 days"
    queries:
      - technology: pseudocode
        query: |
          CREATE a time-series model for each device's outbound data volume (Zeek conn.log).
          FOR each new app launch, MONITOR outbound data in the next 5 minutes.
          IF data transfer > 99% confidence interval AND correlates with a low-prevalence DNS query, ALERT as high-confidence anomaly.
  - question: "Is a mobile application communicating with known C2 servers or using suspicious User-Agents?"
    context: |
      This question aims to detect command-and-control (C2) communication by checking against known indicators. Adversaries often use known malicious infrastructure for C2. Additionally, malware or malicious tools may use generic User-Agents (like curl, Wget, or python-requests) instead of typical mobile browser or app User-Agents, which can be a strong signal of non-standard, potentially malicious activity.
    answer_sources:
      - "Zeek http.log"
      - "Zeek ssl.log"
      - "Zeek conn.log"
      - "MDM/EMM Application Inventory Logs"
      - "Network Egress Points"
      - "Forward Proxies"
      - "Cloud Access Security Brokers (CASB)"
      - "VPN Concentrators"
    range: "last 90 days"
    queries:
      - technology: pseudocode
        query: |
          SEARCH HTTP/S logs (Zeek http.log, ssl.log) from mobile devices.
          MATCH `host` and `server_name` against C2 threat intel feeds. ALERT on match.
          ALSO, SEARCH for requests with non-browser User-Agents (e.g., 'curl/*', 'Wget/*') not tied to known tools. ALERT on match.
  - question: "Is a mobile application sending unusually large amounts of data or communicating with new, previously unseen destinations?"
    context: |
      This question seeks to identify anomalous behavior by baselining application activity. A sudden, abnormally large HTTP POST request can indicate data exfiltration. Similarly, an application suddenly communicating with a new Server Name Indication (SNI) that it has never contacted before could signify that it has been compromised or is communicating with a new C2 server. Both are deviations from normal behavior.
    answer_sources:
      - "Zeek http.log"
      - "Zeek ssl.log"
      - "Zeek conn.log"
      - "MDM/EMM Application Inventory Logs"
      - "Network Egress Points"
      - "Forward Proxies"
      - "Cloud Access Security Brokers (CASB)"
      - "VPN Concentrators"
    range: "last 90 days"
    queries:
      - technology: pseudocode
        query: |
          FOR each app, CREATE a 30-day baseline of HTTP POST sizes (Zeek http.log) and a list of historical SNIs (Zeek ssl.log).
          ALERT if a new POST request size > 99th percentile of its baseline.
          ALERT if the request's SNI is not in the app's historical list.
  - question: "Can we detect anomalous HTTP/S sessions from mobile devices using an unsupervised machine learning model?"
    context: |
      This question leverages machine learning to find 'unknown unknowns' in network traffic. An Isolation Forest model can identify outliers in high-dimensional data without relying on predefined rules or signatures. By training it on features like URI length, request size, and the prevalence of the User-Agent and SNI, it can flag the most unusual sessions that deviate from the norm, which may represent novel or evasive adversary techniques.
    answer_sources:
      - "Zeek http.log"
      - "Zeek ssl.log"
      - "Zeek conn.log"
      - "MDM/EMM Application Inventory Logs"
      - "Network Egress Points"
      - "Forward Proxies"
      - "Cloud Access Security Brokers (CASB)"
      - "VPN Concentrators"
    range: "last 90 days"
    queries:
      - technology: pseudocode
        query: |
          TRAIN an Isolation Forest model on features from Zeek logs (http, ssl, conn) for mobile traffic.
          FEATURES include: URI length, request body length, User-Agent prevalence, SNI prevalence, TLS version, JA3 hash prevalence.
          SCORE all new HTTP/S sessions.
          ALERT on the top 0.5% of outlier scores.
  - question: "Is a newly installed application using high-risk permissions or private APIs to enumerate other installed applications?"
    context: |
      This question aims to proactively identify applications that have the capability to discover other software on a device, a key step in security software discovery. The `QUERY_ALL_PACKAGES` permission on Android and the use of private APIs like `LSApplicationWorkspace` on iOS grant this capability. Automatically blocking or alerting on apps with these characteristics, unless explicitly allow-listed, provides a strong preventative control.
    answer_sources:
      - "MDM/EMM Application Scan Reports"
      - "Mobile Application Vetting Platform Data"
      - "Mobile Device Management (MDM) / Enterprise Mobility Management (EMM) Platform"
      - "Integrated Mobile Threat Defense (MTD) Solution"
      - "Third-party Application Vetting Service"
    range: "last 90 days"
    queries:
      - technology: pseudocode
        query: |
          CONFIGURE MDM/MTD policy to scan new apps.
          IF app manifest contains `android.permission.QUERY_ALL_PACKAGES` OR scan detects `LSApplicationWorkspace` API calls, AND app is not on allow-list, THEN ALERT or BLOCK installation.
  - question: "Are there existing applications in our environment with statistically improbable or suspicious combinations of permissions for their category?"
    context: |
      This question focuses on finding dormant or previously unnoticed threats within the existing application inventory. An app in a category like 'Games' has little legitimate reason to need to query all other packages. Identifying such outliers, or finding apps with rare and dangerous combinations of permissions (e.g., querying all packages and recording audio), can uncover potentially malicious applications that evaded initial screening.
    answer_sources:
      - "MDM/EMM Application Scan Reports"
      - "Mobile Application Vetting Platform Data"
      - "Mobile Device Management (MDM) / Enterprise Mobility Management (EMM) Platform"
      - "Integrated Mobile Threat Defense (MTD) Solution"
      - "Third-party Application Vetting Service"
    range: "last 90 days"
    queries:
      - technology: pseudocode
        query: |
          SCAN entire app inventory.
          FOR each app category, CALCULATE prevalence of `QUERY_ALL_PACKAGES` permission.
          ALERT on non-security apps with this permission in the bottom 5th percentile.
          CALCULATE Jaccard index for permission co-occurrence.
          ALERT on improbable combinations (e.g., `QUERY_ALL_PACKAGES` and `RECORD_AUDIO`) below a 1st percentile threshold.
  - question: "Can we use a supervised machine learning model to assign a risk score to mobile applications and automate further analysis?"
    context: |
      This question proposes a more sophisticated, automated vetting process. By training a model (like XGBoost) on various features—such as dangerous permissions, developer reputation, and app store ratings—we can create a holistic risk score. This moves beyond simple rule-based checks. Applications that the model flags as high-risk can be automatically sent to a sandbox for dynamic analysis, focusing analyst attention on the most likely threats.
    answer_sources:
      - "MDM/EMM Application Scan Reports"
      - "Mobile Application Vetting Platform Data"
      - "Mobile Device Management (MDM) / Enterprise Mobility Management (EMM) Platform"
      - "Integrated Mobile Threat Defense (MTD) Solution"
      - "Third-party Application Vetting Service"
    range: "last 90 days"
    queries:
      - technology: pseudocode
        query: |
          TRAIN a classification model (e.g., XGBoost) on app features (permissions, developer reputation, ratings).
          ASSIGN high weight to `QUERY_ALL_PACKAGES` or private API usage.
          SCORE all new and existing applications.
          IF risk score exceeds threshold, AUTOMATICALLY submit to sandbox for dynamic analysis.