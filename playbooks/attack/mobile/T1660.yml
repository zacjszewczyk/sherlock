name: T1660: Phishing
id: f47ac10b-58cc-4372-a567-0e02b2c3d479
description: |
  This playbook is designed to help identify if an adversary is attempting to gain initial access to mobile devices via phishing. It focuses on analyzing network traffic (DNS, HTTP, TLS) and authentication logs to detect suspicious activities indicative of phishing campaigns. Detection strategies include matching against threat intelligence, risk-scoring based on domain and certificate attributes (e.g., domain entropy, age, TLD rarity, certificate issuer), and leveraging machine learning models to identify anomalous user or network behavior. The playbook aims to correlate suspicious network events from mobile devices with subsequent authentication events to detect potential credential compromise.
type: technique
related:
  - TA0027: Initial Access
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Are mobile devices querying domains that are on known phishing threat intelligence lists?
    context: |
      This question aims to identify direct connections from mobile devices to known malicious infrastructure. A match provides a high-confidence indicator of a phishing attempt. By enriching the alert with the User-Agent, we can confirm the device type and potentially the application used, which helps in scoping the incident and understanding the attack vector.
    answer_sources:
      - Zeek dns.log
      - Zeek http.log
      - External Phishing Threat Intelligence Lists
      - NAI: Corporate and guest Wi-Fi network segments, VPN concentrators, Mobile Device Management (MDM) logs, and network egress points.
    range: Last 90 days
    queries:
      - pseudocode: SEARCH Zeek dns.log WHERE source_ip IN mobile_ip_ranges AND query_domain IN phishing_intel_list | JOIN Zeek http.log ON connection_id TO GET user_agent | ALERT
  - question: Are mobile devices connecting to domains exhibiting multiple high-risk characteristics, such as high entropy, recent registration, and rare TLDs?
    context: |
      This question uses a risk-scoring model to uncover suspicious domains that may not be on a threat intelligence list yet. Phishing domains often use algorithmically generated names (high entropy), are newly created for a campaign (recent registration), and use uncommon TLDs to evade detection. A high cumulative score suggests a likely phishing attempt that warrants investigation.
    answer_sources:
      - Zeek dns.log
      - Zeek http.log
      - External WHOIS data
      - NAI: Corporate and guest Wi-Fi network segments, VPN concentrators, Mobile Device Management (MDM) logs, and network egress points.
    range: Last 90 days
    queries:
      - pseudocode: FOR each DNS query from mobile_ip_range | CALCULATE risk_score (entropy > threshold, age < 30d, TLD is rare) | IF risk_score >= 2 | GET user_agent from http.log | ALERT for review
  - question: Can a machine learning model identify DNS requests from mobile devices that are likely to be malicious based on a combination of lexical and registration features?
    context: |
      This question leverages a machine learning model to automate the detection of malicious domains with greater nuance than simple rule-based scoring. By analyzing multiple features simultaneously (e.g., domain length, entropy, n-grams, age), the model can identify complex patterns indicative of phishing, reducing false positives and detecting novel threats that might otherwise be missed. An alert with a high probability score requires analyst review.
    answer_sources:
      - Zeek dns.log
      - External WHOIS data
      - Pre-trained ML Model
      - NAI: Corporate and guest Wi-Fi network segments, VPN concentrators, Mobile Device Management (MDM) logs, and network egress points.
    range: Last 90 days
    queries:
      - pseudocode: FOR each DNS query from mobile_ip_range | EXTRACT features (length, entropy, ngrams, TLD, age, etc.) | INPUT features into logistic_regression_model | IF model_output > 0.9 | ALERT for review
  - question: Are mobile devices establishing TLS connections using certificates known to be malicious or exhibiting suspicious properties like self-signing or suspect issuer strings?
    context: |
      This question focuses on identifying phishing attempts by inspecting the TLS certificate, which is a critical component of a secure connection. A match against a known malicious certificate hash is a high-fidelity indicator of compromise. Additionally, self-signed certificates for external sites or certificates with unusual issuer names are strong red flags for fraudulent sites masquerading as legitimate ones.
    answer_sources:
      - Zeek ssl.log
      - Malicious Certificate Threat Intelligence Feed
      - NAI: Network sensors monitoring corporate and guest Wi-Fi networks, and VPN concentrators logging traffic from remote mobile devices.
    range: Last 90 days
    queries:
      - pseudocode: SEARCH Zeek ssl.log from mobile_ip_range | IF certificate_hash IN malicious_cert_intel OR is_self_signed_external=true OR issuer CONTAINS suspicious_strings | ALERT
  - question: Is a user on a mobile device visiting a domain that is rare for both the entire organization and the specific user, and does this visit represent a significant deviation from their normal browsing behavior?
    context: |
      This question seeks to identify anomalous browsing activity that could indicate a user has been redirected to a phishing site. Phishing links are often unique and short-lived, making them rare globally ('globally rare') and for a small number of users ('locally rare'). When a user visits such a domain and their overall session activity (Jaccard similarity) diverges significantly from their historical pattern, it strongly suggests a compromise or an unusual, high-risk event.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - Zeek ssl.log
      - Zeek http.log
      - NAI: Network sensors monitoring corporate and guest Wi-Fi networks, and VPN concentrators logging traffic from remote mobile devices.
    range: Last 90 days
    queries:
      - pseudocode: FOR each mobile DNS query | CHECK if domain is globally_rare (not in 30d baseline) AND locally_rare (<3 users in 24h) | IF true, CALCULATE Jaccard similarity of user's current session vs 30d history | IF similarity < 0.2 | ALERT
  - question: Is a mobile device making a network connection that is a statistical outlier compared to the user's established baseline of normal network activity?
    context: |
      This question uses an unsupervised machine learning model (One-Class SVM) to create a personalized profile of normal network behavior for each user. Any new connection from their mobile device that deviates significantly from this profile is flagged as an anomaly. This is particularly effective for detecting 'quishing' (QR code phishing) or other redirect-based attacks where the destination's characteristics (port, protocol, TLS fingerprint via JA3/JA3S, etc.) are unusual for that specific user, even if the domain itself is not inherently suspicious.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - Zeek ssl.log
      - Zeek http.log
      - NAI: Network sensors monitoring corporate and guest Wi-Fi networks, and VPN concentrators logging traffic from remote mobile devices.
    range: Last 90 days
    queries:
      - pseudocode: FOR each new mobile connection | EXTRACT features (TLDs, ports, protocols, JA3/JA3S, duration, volume) | INPUT features into user's one_class_svm_model | IF model classifies as outlier | ALERT for investigation
  - question: Did a mobile device access a known URL shortener that resolved to an IP address associated with known phishing infrastructure?
    context: |
      This question addresses the common phishing tactic of using URL shorteners to obscure the final malicious destination. By monitoring for requests to shortener services, resolving the final IP address, and checking that IP against threat intelligence, we can unmask the attack. Correlating this with a subsequent login attempt from the same source IP adds critical context, suggesting the user may have been tricked into entering credentials.
    answer_sources:
      - Zeek dns.log
      - Zeek http.log
      - Zeek conn.log
      - Windows Event ID 4624
      - Azure AD Sign-in logs
      - Phishing Infrastructure Threat Intelligence
      - NAI: Network egress points, VPN concentrators, Active Directory Domain Controllers, and cloud identity provider infrastructure (e.g., Azure AD, Okta).
    range: Last 90 days
    queries:
      - pseudocode: SEARCH Zeek dns.log for mobile request to URL_shortener_list | GET final_resolved_ip | IF final_resolved_ip IN phishing_ip_intel | ALERT and search for auth events from source_ip
  - question: Did a mobile device connect to a suspicious site (indicated by a short-lived, free TLS certificate for a typosquatted domain) and then immediately perform a successful authentication?
    context: |
      This question links suspicious web traffic directly to a potential credential compromise. Attackers often use free, short-validity certificates for their phishing sites to appear legitimate. By identifying connections with these risky certificate attributes, especially when the domain name is a look-alike of a trusted site (typosquatting/homoglyph), and then observing a successful login from that same IP shortly after, we can create a very high-confidence alert for a successful phishing attack.
    answer_sources:
      - Zeek ssl.log
      - Zeek conn.log
      - Windows Event ID 4624
      - Azure AD Sign-in logs
      - NAI: Network egress points, VPN concentrators, Active Directory Domain Controllers, and cloud identity provider infrastructure (e.g., Azure AD, Okta).
    range: Last 90 days
    queries:
      - pseudocode: SEARCH Zeek ssl.log from mobile_ip | IF cert_validity < 90d AND issuer IS free_ca AND SNI is typosquatted | THEN search auth_logs for successful login from same source_ip within 5 mins | IF found, ESCALATE
  - question: Can a two-stage model, combining a machine learning-based network risk assessment with a subsequent authentication event check, detect credential compromise from mobile phishing?
    context: |
      This question describes an advanced, automated detection pipeline. The first stage uses a robust machine learning model (Random Forest) to identify high-risk network connections with high probability, filtering out most benign traffic. The second stage uses this high-risk flag as a trigger to perform a targeted, real-time search for a successful login. This two-stage approach minimizes false positives and creates a critical, actionable alert only when there is strong evidence of both a visit to a suspicious site and a subsequent credential use, indicating a likely compromise.
    answer_sources:
      - Zeek dns.log
      - Zeek http.log
      - Zeek ssl.log
      - Zeek conn.log
      - Windows Event ID 4624
      - Azure AD Sign-in logs
      - Pre-trained ML Model
      - NAI: Network egress points, VPN concentrators, Active Directory Domain Controllers, and cloud identity provider infrastructure (e.g., Azure AD, Okta).
    range: Last 90 days
    queries:
      - pseudocode: STAGE 1: For mobile connection, INPUT features (cert, domain, connection stats) into random_forest_model | IF probability > 0.9, trigger STAGE 2 | STAGE 2: SEARCH auth_logs for successful login from same source_ip within 5 mins | IF match found, generate CRITICAL alert