name: T1544: Ingress Tool Transfer
id: f47ac10b-58cc-4372-a567-0e02b2c3d479
description: This playbook helps investigate whether an adversary is transferring malicious tools or files onto managed mobile devices. It focuses on two main indicators: 1) File transfers with suspicious attributes like high-entropy filenames, risky MIME types, sources with low reputation or self-signed certificates. 2) Network sessions with anomalously large data transfer volumes to destinations not on an approved list, indicating potential unauthorized downloads.
type: technique
related:
- TA0037: Command And Control
contributors:
- Zachary Szewczyk
- Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
- question: Are files being transferred to mobile devices from sources known to be malicious?
  context: This question aims to identify high-confidence threats by checking if the source of a file transfer (IP address or hostname) is listed in threat intelligence feeds as a known malicious dropper or command and control (C2) server. A match provides a strong signal that an unauthorized and potentially harmful tool is being introduced to a managed mobile device.
  answer_sources:
  - Zeek conn.log
  - Zeek files.log
  - Zeek http.log
  - Zeek dns.log
  - Zeek ssl.log
  - Zeek x509.log
  - Threat Intelligence Feeds
  - Network egress points capturing traffic from corporate-managed mobile devices, including VPN concentrators, corporate Wi-Fi access point controllers, and Mobile Device Management (MDM) or Unified Endpoint Management (UEM) platform traffic logs.
  range: last 90 days
  queries:
  - technology: Pseudocode
    query: |
      FOR each file_transfer in (files.log, http.log) to mobile_device_IPs:
        GET source_ip, destination_hostname
        IF source_ip OR destination_hostname IN threat_intel_feed:
          ALERT 'Malicious Source File Transfer'
- question: Are file transfers to mobile devices exhibiting a combination of risky characteristics?
  context: This question uses a multi-faceted approach to risk-score file transfers. It combines several weak signals—such as high-entropy filenames (suggesting obfuscation), new source domains (common for malicious infrastructure), specific file types associated with mobile malware ($$ I_{mime} = 1 $$ if MIME type is 'application/vnd.android.package-archive', 'application/x-mach-binary', or 'application/octet-stream'), and weak or invalid security certificates—into a single, actionable score using the formula $$ Score = (w_1 \cdot I_{entropy}) + (w_2 \cdot I_{age}) + (w_3 \cdot I_{mime}) + (w_4 \cdot I_{cert}) $$. This helps detect suspicious transfers that might not trigger individual alerts but are collectively indicative of a potential threat.
  answer_sources:
  - Zeek conn.log
  - Zeek files.log
  - Zeek http.log
  - Zeek dns.log
  - Zeek ssl.log
  - Zeek x509.log
  - WHOIS Data
  - Network egress points capturing traffic from corporate-managed mobile devices, including VPN concentrators, corporate Wi-Fi access point controllers, and Mobile Device Management (MDM) or Unified Endpoint Management (UEM) platform traffic logs.
  range: last 90 days
  queries:
  - technology: Pseudocode
    query: |
      FOR each file in files.log to mobile_device_IP:
        CALCULATE risk_score = w1*entropy_flag + w2*domain_age_flag + w3*mime_type_flag + w4*cert_flag
        IF risk_score > threshold:
          ALERT 'High Risk Score File Transfer'
- question: Are network connections associated with file transfers to mobile devices anomalous compared to a learned baseline of normal behavior?
  context: This question seeks to identify novel or unusual network activity related to file transfers that may indicate a new or unknown threat. By using an unsupervised machine learning model (like Isolation Forest), it can flag connections that deviate from established patterns based on features like TLS fingerprints (JA3/JA3S), connection size, and duration. This method is effective at catching threats that don't match known signatures.
  answer_sources:
  - Zeek conn.log
  - Zeek files.log
  - Zeek http.log
  - Zeek dns.log
  - Zeek ssl.log
  - Zeek x509.log
  - Network egress points capturing traffic from corporate-managed mobile devices, including VPN concentrators, corporate Wi-Fi access point controllers, and Mobile Device Management (MDM) or Unified Endpoint Management (UEM) platform traffic logs.
  range: last 90 days
  queries:
  - technology: Pseudocode
    query: |
      MODEL = train_anomaly_model(historical_conn_logs)
      FOR each new_connection in file_transfer_sessions:
        CALCULATE anomaly_score = MODEL.predict(new_connection)
        IF anomaly_score > threshold:
          ALERT 'Anomalous Connection for File Transfer'
- question: Are mobile devices downloading large files from destinations not on the approved services list?
  context: This question aims to find straightforward policy violations. By defining a static threshold for a "large" download (e.g., 100MB) and an allow-list of approved services (like app stores or corporate cloud storage), this check quickly identifies significant data transfers from unauthorized or unknown sources. It's a simple but effective way to flag potentially malicious tool transfers that bypass standard distribution channels.
  answer_sources:
  - Zeek conn.log
  - Zeek dns.log
  - Network egress points capturing traffic from corporate-managed mobile devices, including VPN concentrators, corporate Wi-Fi access point controllers, and Mobile Device Management (MDM) or Unified Endpoint Management (UEM) platform traffic logs.
  range: last 90 days
  queries:
  - technology: Pseudocode
    query: |
      ALLOW_LIST = [approved_domains/ips]
      FOR each connection in conn.log to mobile_device_IPs:
        IF resp_bytes > 100MB AND destination NOT IN ALLOW_LIST:
          ALERT 'Large Download from Unapproved Source'
- question: Has a mobile device's total daily download volume deviated significantly from its own historical baseline?
  context: This question focuses on identifying unusual behavior at the device level. By calculating a Z-score, $$ Z = (x - \mu) / \sigma $$, it statistically measures how far a single day's download volume ($$ x $$) is from that device's "normal" activity (mean $$ \mu $$, standard deviation $$ \sigma $$) over the past 30 days. An alert for $$ |Z| > 3 $$ indicates a statistically significant event, suggesting an abnormal amount of data was downloaded, which could be an adversary transferring a large tool or payload.
  answer_sources:
  - Zeek conn.log
  - Zeek dns.log
  - Network egress points capturing traffic from corporate-managed mobile devices, including VPN concentrators, corporate Wi-Fi access point controllers, and Mobile Device Management (MDM) or Unified Endpoint Management (UEM) platform traffic logs.
  range: last 90 days
  queries:
  - technology: Pseudocode
    query: |
      FOR each mobile_device:
        BASELINE = calculate_mean_std(last_30d_daily_downloads)
        TODAY_DOWNLOAD = sum_today_resp_bytes
        Z_SCORE = (TODAY_DOWNLOAD - BASELINE.mean) / BASELINE.std
        IF abs(Z_SCORE) > 3:
          ALERT 'Anomalous Daily Download Volume'
- question: Is a mobile device's hourly download volume unexpectedly high compared to what a predictive model forecasted?
  context: This question employs a sophisticated time series model (like SARIMA or Prophet) to create a highly accurate forecast of a device's expected download volume, accounting for patterns like time of day and day of week. When the actual volume significantly exceeds this forecast (i.e., breaches the 99% prediction interval), it signals a strong anomaly that is unlikely to be normal user behavior. This is highly effective for detecting unexpected, large data transfers that could correspond to an ingress tool transfer.
  answer_sources:
  - Zeek conn.log
  - Zeek dns.log
  - Network egress points capturing traffic from corporate-managed mobile devices, including VPN concentrators, corporate Wi-Fi access point controllers, and Mobile Device Management (MDM) or Unified Endpoint Management (UEM) platform traffic logs.
  range: last 90 days
  queries:
  - technology: Pseudocode
    query: |
      MODEL = train_timeseries_model(last_90d_hourly_downloads)
      FOR each hour, for each device:
        FORECAST = MODEL.predict()
        OBSERVED = actual_download_volume
        IF OBSERVED > FORECAST.upper_99_percent_interval:
          ALERT 'Hourly Download Volume Exceeds Forecast'