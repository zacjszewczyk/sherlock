name: "T1664: Exploitation for Initial Access"
id: "a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d"
description: |
  This playbook helps investigate whether an adversary has exploited a software vulnerability to gain initial access to a mobile device. It focuses on detecting anomalous network traffic, such as connections to known malicious indicators or significant deviations from established baselines in data volume or connection types. It also looks for suspicious file downloads, including files with malicious hashes, applications from unofficial stores, or files with mismatched MIME types. Finally, it helps identify patterns indicative of zero-click exploits, where an inbound push notification is immediately followed by a suspicious outbound connection, suggesting automated activity without user interaction.
type: "technique"
related:
  - "TA0027: Initial Access"
contributors:
  - "Zachary Szewczyk"
  - "Ask Sage"
created: "2025-10-01"
modified: "2025-10-01"
version: 1.0
tags: "none"
questions:
  - question: "Has a mobile device connected to a known malicious IP address, domain, or SSL/TLS fingerprint?"
    context: |
      This question aims to detect the most direct evidence of compromise by checking if a mobile device's network traffic matches indicators from threat intelligence feeds. A match against known malicious IPs, domains, or certificate hashes (JA3/JA3S) is a high-confidence signal that the device is communicating with an adversary's infrastructure, potentially as a result of an exploit.
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Zeek ssl.log"
      - "Corporate Wi-Fi network segments"
      - "Guest Wi-Fi network"
      - "VPN concentrators"
      - "Internet gateway proxy/firewall logs"
      - "MDM/UEM servers"
    range: "last 90 days"
    queries:
      - "Search Zeek logs (conn, dns, ssl) for connections from mobile device IPs where the destination IP, requested domain, or JA3/JA3S hash matches a list of known malicious indicators."
  - question: "Is a mobile device exhibiting anomalous network behavior compared to its own historical baseline?"
    context: |
      This question seeks to identify subtle signs of compromise by detecting deviations from a device's normal network activity. Adversaries may use previously unknown infrastructure, which won't be caught by indicator matching. By monitoring for unusual spikes in data volume, connections to a wider-than-usual range of destination ports, or new client-side SSL/TLS fingerprints (JA3/JA3S), we can spot behavior that is abnormal for that specific device, even if not globally recognized as malicious.
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Zeek ssl.log"
      - "Corporate Wi-Fi network segments"
      - "Guest Wi-Fi network"
      - "VPN concentrators"
      - "Internet gateway proxy/firewall logs"
      - "MDM/UEM servers"
    range: "last 90 days"
    queries:
      - "For each mobile device, calculate a 30-day rolling baseline of total bytes transferred, destination port entropy, and unique JA3/JA3S hashes. Alert if current hourly metrics exceed the 98th percentile of the historical baseline."
  - question: "Does a mobile device's sequence of network connections deviate from patterns learned by an advanced anomaly detection model?"
    context: |
      This question uses a sophisticated machine learning approach (LSTM Autoencoder) to detect complex anomalies in network traffic patterns. Unlike simple thresholding, this model learns the normal *sequence* and *relationship* between connections for a device. A high reconstruction error indicates that the current network activity is so different from the device's learned normal behavior that the model cannot accurately 'rebuild' it, suggesting a significant and potentially malicious deviation, such as C2 beaconing or data exfiltration.
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Zeek ssl.log"
      - "Corporate Wi-Fi network segments"
      - "Guest Wi-Fi network"
      - "VPN concentrators"
      - "Internet gateway proxy/firewall logs"
      - "MDM/UEM servers"
    range: "last 90 days"
    queries:
      - "For each device, feed real-time network connection sequences (features: duration, bytes, proto, service) into a pre-trained LSTM Autoencoder. Alert if the reconstruction error for a sequence exceeds the 99th percentile of errors from the training data."
  - question: "Has a mobile device downloaded a known malicious file or an application from an unofficial app store?"
    context: |
      This question addresses two common initial access vectors: delivering malware and tricking users into sideloading malicious apps. By checking file hashes against malware signature databases, we can detect known threats. By monitoring for downloads of application packages (.apk, .ipa) from domains other than official, trusted app stores, we can identify potential sideloading attempts, which bypass security controls and are a frequent method for installing malware.
    answer_sources:
      - "Zeek http.log"
      - "Zeek files.log"
      - "Zeek dns.log"
      - "Internet gateway"
      - "Web Proxy"
      - "Guest Wi-Fi network"
      - "Corporate Wi-Fi network segments"
      - "Content Delivery Network (CDN) logs"
    range: "last 90 days"
    queries:
      - "Query 1: Search Zeek files.log for file transfers to mobile devices and alert if the MD5 or SHA1 hash matches a known mobile malware signature. Query 2: Search Zeek http.log for downloads of .apk or .ipa files where the host domain is not on the approved app store allowlist."
  - question: "Is a mobile device downloading an unusual number of files with mismatched MIME types?"
    context: |
      This question is designed to uncover attempts to obfuscate malicious payloads. Adversaries may serve a file with a benign MIME type (e.g., 'image/jpeg') while the actual file content is an executable or script. Zeek's ability to infer the true file type based on its content, regardless of the server's declaration, allows us to detect these mismatches. A sudden spike in such mismatches for a specific device, compared to its own history and the rest of the device fleet, is a strong indicator of suspicious activity.
    answer_sources:
      - "Zeek http.log"
      - "Zeek files.log"
      - "Zeek dns.log"
      - "Internet gateway"
      - "Web Proxy"
      - "Guest Wi-Fi network"
      - "Corporate Wi-Fi network segments"
      - "Content Delivery Network (CDN) logs"
    range: "last 90 days"
    queries:
      - "For each mobile device, calculate the daily rate of MIME type mismatches from Zeek files.log. Alert if the daily rate exceeds 3 standard deviations above the device's own 30-day baseline or the fleet-wide baseline."
  - question: "Has a mobile device downloaded a file from a URL that is algorithmically scored as likely malicious?"
    context: |
      This question leverages machine learning to proactively identify dangerous URLs that may not yet be on any threat intelligence blacklist. By analyzing features of the URL itself—such as its length, complexity (entropy), number of subdomains, and the reputation of its domain—a model can predict the probability of it being malicious. This helps catch threats from newly created adversary infrastructure used in exploit delivery.
    answer_sources:
      - "Zeek http.log"
      - "Zeek files.log"
      - "Zeek dns.log"
      - "Internet gateway"
      - "Web Proxy"
      - "Guest Wi-Fi network"
      - "Corporate Wi-Fi network segments"
      - "Content Delivery Network (CDN) logs"
    range: "last 90 days"
    queries:
      - "For each file download in Zeek http.log, extract URL features (length, entropy, subdomains, domain age). Use a classification model to generate a maliciousness score. Alert if the score exceeds a predefined threshold (e.g., > 0.9)."
  - question: "Did a mobile device make an outbound connection to a known malicious host immediately after receiving a push notification?"
    context: |
      This question targets a key indicator of a zero-click or one-click exploit. The exploit is delivered via a push notification, which, upon receipt, triggers the device to connect to an adversary-controlled server without user interaction. By correlating a legitimate inbound push notification with a nearly simultaneous outbound connection to a known-bad destination, we can detect this specific and high-confidence attack pattern.
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Zeek ssl.log"
      - "Corporate Wi-Fi network"
      - "Guest Wi-Fi network"
      - "Internet Gateway"
      - "VPN termination points"
    range: "last 90 days"
    queries:
      - "Correlate Zeek conn.log events. Alert if an inbound connection from a push notification service IP is followed within 60 seconds by an outbound connection from the same device to an IP/domain on a malicious blocklist."
  - question: "Did a mobile device make an unusually fast outbound connection to a new domain immediately after receiving a push notification?"
    context: |
      This question aims to detect zero-click exploits without relying on a blocklist of known malicious domains. It establishes a baseline for each user's typical 'reaction time'—the delay between receiving a push notification and initiating a related outbound connection. An automated exploit will have a time delta that is a statistical outlier (extremely fast) compared to normal human interaction. Combining this with the condition that the destination is a new, previously unvisited domain for that device creates a powerful heuristic for detecting novel zero-click attacks.
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Zeek ssl.log"
      - "Corporate Wi-Fi network"
      - "Guest Wi-Fi network"
      - "Internet Gateway"
      - "VPN termination points"
    range: "last 90 days"
    queries:
      - "For each device, create a historical distribution of time deltas between inbound push notifications and subsequent outbound connections. Alert if a new event has a time delta in the bottom 5th percentile AND the destination domain is new for that device in the last 30 days."
  - question: "Did a mobile device's sequence of network states (e.g., from 'receiving push notification' to 'beaconing') violate its normal, learned transition patterns?"
    context: |
      This question uses a Hidden Markov Model (HMM) to understand the *normal flow* of a device's network activity. The model learns the probability of transitioning from one state to another (e.g., from 'Idle' to 'Web Browsing'). A zero-click exploit would likely cause an improbable state transition, such as going directly from receiving a push notification to beaconing to a new C2 domain, bypassing any intermediate states associated with normal user activity. Detecting such a low-probability transition is a strong signal of an automated, non-user-driven event.
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Zeek ssl.log"
      - "Corporate Wi-Fi network"
      - "Guest Wi-Fi network"
      - "Internet Gateway"
      - "VPN termination points"
    range: "last 90 days"
    queries:
      - "Using a per-device Hidden Markov Model trained on historical network event sequences, evaluate new event sequences in real-time. Alert if a state transition occurs that has a very low probability according to the trained model (e.g., 'Inbound_Push_Notification' -> 'Outbound_Beaconing_To_New_Domain')."