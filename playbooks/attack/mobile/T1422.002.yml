name: "T1422.002: Wi-Fi Discovery"
id: "a7b3c9d1-e8f6-4a2b-9c8d-5e3f1a0b7c6d"
description: "This playbook helps identify if an adversary is attempting to discover Wi-Fi network information on managed mobile devices. This involves detecting anomalous usage of Wi-Fi configuration APIs, identifying network scanning behavior after a device connects to a new Wi-Fi network, and observing processes that read Wi-Fi credential stores before making suspicious outbound network connections."
type: "technique"
related:
  - "TA0032: Discovery"
contributors:
  - "Zachary Szewczyk, Ask Sage"
created: "2025-10-01"
modified: "2025-10-01"
version: 1.0
tags: "none"
questions:
  - question: "Is a non-allow-listed application attempting to query Wi-Fi configurations?"
    context: "This question aims to identify unauthorized applications accessing sensitive Wi-Fi configuration APIs like `WifiManager.getConfiguredNetworks()` or `NEHotspotConfigurationManager.fetchConfigurations`. By maintaining an allow-list of known good applications (e.g., system processes, MDM clients), any deviation can be immediately flagged as a high-severity event, indicating a potential attempt by malware or a suspicious application to gather network intelligence."
    answer_sources:
      - "Mobile Device Management (MDM) API call logs"
      - "Mobile Endpoint Detection and Response (EDR) process activity logs"
      - "Corporate-managed mobile devices (iOS, Android)"
      - "Mobile Device Management (MDM) Platform"
      - "Mobile EDR Platform"
    range: "last 90 days"
    queries:
      - "SIEM Query: SEARCH MDM/EDR logs for Wi-Fi API calls (e.g., getConfiguredNetworks, fetchConfigurations) WHERE the application package name OR code-signing certificate is NOT in the authorized allow-list. TRIGGER high-severity alert."
  - question: "Is any application exhibiting an anomalous frequency of Wi-Fi API calls?"
    context: "This question seeks to detect malicious behavior masquerading as normal application activity. Adversaries may repeatedly call Wi-Fi APIs to gather information over time. By establishing a statistical baseline (mean and standard deviation) of API call frequency for each application, we can identify significant outliers ($$ \\mu + 3\\sigma $$) that suggest an application is behaving unusually, potentially indicating a discovery attempt."
    answer_sources:
      - "Mobile Device Management (MDM) API call logs"
      - "Mobile Endpoint Detection and Response (EDR) process activity logs"
      - "Corporate-managed mobile devices (iOS, Android)"
      - "Mobile Device Management (MDM) Platform"
      - "Mobile EDR Platform"
    range: "last 90 days"
    queries:
      - "SIEM Query: FOR each application, CALCULATE baseline mean and standard deviation of Wi-Fi API calls per 5-minute window from the last 30 days of logs. SEARCH for current API call counts in a 5-minute window that EXCEED (mean + 3 * standard deviation). TRIGGER medium-severity alert."
  - question: "Can we use machine learning to proactively identify malicious Wi-Fi discovery behavior based on API call patterns?"
    context: "This question explores a more advanced, predictive approach. Instead of relying on simple thresholds, it involves training a machine learning model to recognize complex patterns indicative of malicious Wi-Fi discovery. By analyzing features like call frequency, call sequences, application permissions, and install source, the model can classify behavior as 'benign' or 'malicious' in near real-time, providing a higher-fidelity detection mechanism."
    answer_sources:
      - "Mobile Device Management (MDM) API call logs"
      - "Mobile Endpoint Detection and Response (EDR) process activity logs"
      - "Corporate-managed mobile devices (iOS, Android)"
      - "Mobile Device Management (MDM) Platform"
      - "Mobile EDR Platform"
    range: "last 90 days"
    queries:
      - "ML Model Pseudocode: EXTRACT features (call frequency, API sequence, permissions, install source) from MDM/EDR logs. TRAIN a classifier (e.g., Random Forest) on labeled data. DEPLOY model to score new API call sequences. TRIGGER alert on high-probability malicious classifications."
  - question: "Is a mobile device performing a network address or port scan immediately after joining a new Wi-Fi network?"
    context: "This question focuses on identifying reconnaissance activity on the local network. When an adversary's device joins a new network, a common next step is to scan for other live hosts and open ports. Using a tool like Zeek's built-in scan detector, we can flag this behavior and enrich the alert with device-specific information from DHCP logs, providing immediate context about which device is performing the suspicious scan."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek notice.log"
      - "Zeek icmp.log"
      - "DHCP Server Logs"
      - "Zeek weird.log"
      - "Corporate and guest Wi-Fi network segments"
      - "Network sensors (e.g., Zeek)"
      - "DHCP servers"
    range: "last 90 days"
    queries:
      - "SIEM Query: SEARCH Zeek notice.log for 'Scan::Address_Scan' or 'Scan::Port_Scan' events WHERE source IP is in mobile DHCP range. CORRELATE source IP and timestamp with DHCP logs to find hostname/MAC. TRIGGER high-severity alert."
  - question: "Is a mobile device exhibiting statistically anomalous network connection patterns indicative of scanning?"
    context: "This question provides a statistical method for detecting network scanning that may evade simple signature-based detectors. By tracking metrics like the count of unique destination IPs, ICMP requests, and the entropy of destination ports within short time windows, we can build a baseline of normal behavior. A device that suddenly exceeds multiple statistical thresholds is highly likely to be engaged in scanning, even if the activity is slow or stealthy."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek notice.log"
      - "Zeek icmp.log"
      - "DHCP Server Logs"
      - "Zeek weird.log"
      - "Corporate and guest Wi-Fi network segments"
      - "Network sensors (e.g., Zeek)"
      - "DHCP servers"
    range: "last 90 days"
    queries:
      - "SIEM Query: IN 60s windows, CALCULATE for each source IP: distinct destination IPs, distinct ICMP requests, and destination port entropy. COMPARE against 95th percentile baseline. IF two or more metrics exceed baseline, TRIGGER medium-severity alert."
  - question: "Can we use unsupervised machine learning to identify anomalous network scanning activity from mobile devices?"
    context: "This question leverages unsupervised learning to find 'needles in a haystack'. Most network traffic is uniform and predictable. By using a clustering algorithm like DBSCAN, normal activity will form a dense cluster, while anomalous activities, like network scanning, will appear as outliers or sparse clusters. This approach can detect novel or previously unseen scanning techniques that don't fit pre-defined rules."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek notice.log"
      - "Zeek icmp.log"
      - "DHCP Server Logs"
      - "Zeek weird.log"
      - "Corporate and guest Wi-Fi network segments"
      - "Network sensors (e.g., Zeek)"
      - "DHCP servers"
    range: "last 90 days"
    queries:
      - "ML Model Pseudocode: FOR each source IP in 1-min intervals, CREATE feature vectors (byte counts, packet ratios, unique IPs/ports, port entropy). APPLY clustering algorithm (e.g., DBSCAN). TRIGGER alert for devices classified into anomalous, sparse clusters."
  - question: "Did a non-system process access a Wi-Fi credential store and immediately connect to a known malicious domain?"
    context: "This question targets a clear-cut case of credential theft and exfiltration. Access to Wi-Fi credential stores (like `/data/misc/wifi/wpa_supplicant.conf` or specific iOS Keychain items) by an unauthorized application is highly suspicious. Correlating this access with an immediate outbound connection to a domain on a threat intelligence feed provides strong evidence of a compromise, warranting a critical alert and immediate investigation."
    answer_sources:
      - "Mobile EDR file integrity monitoring logs"
      - "Mobile EDR process or keychain access logs"
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Threat Intelligence Platform data"
      - "Corporate-managed mobile devices"
      - "Network Egress Points (Firewall/Proxy)"
      - "Internal DNS Resolvers"
      - "Mobile EDR Platform"
      - "Threat Intelligence Platform"
    range: "last 90 days"
    queries:
      - "SIEM Query: ON EDR alert for Wi-Fi credential store access by non-system process, SEARCH network logs for connections from the same device within 5 minutes. IF destination IP/domain is on threat intel feed, TRIGGER critical alert."
  - question: "Following a credential store access event, did the device connect to a suspicious, low-prevalence, or newly registered domain?"
    context: "This question helps detect exfiltration to domains that are not yet on threat intelligence feeds. Adversaries often use new or obscure domains for command and control or data exfiltration. By analyzing domain characteristics—such as age, organizational prevalence (how many other devices connect to it), and name entropy—we can identify suspicious destinations and flag potential exfiltration attempts even without a prior malicious indicator."
    answer_sources:
      - "Mobile EDR file integrity monitoring logs"
      - "Mobile EDR process or keychain access logs"
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Threat Intelligence Platform data"
      - "Corporate-managed mobile devices"
      - "Network Egress Points (Firewall/Proxy)"
      - "Internal DNS Resolvers"
      - "Mobile EDR Platform"
      - "Threat Intelligence Platform"
    range: "last 90 days"
    queries:
      - "SIEM Query: ON EDR alert for credential store access, ANALYZE outbound connections in the next 5 minutes. CALCULATE domain prevalence $$ S_p $$, age, and entropy. IF domain is low prevalence ($$ S_p < 0.01 $$), new (< 30 days), or high entropy, TRIGGER high-severity alert."
  - question: "Can a sequence-aware machine learning model detect the entire chain of Wi-Fi credential theft and exfiltration?"
    context: "This question proposes a sophisticated, holistic detection strategy. Instead of looking at isolated events, it involves training a model (like an LSTM) to recognize the entire attack sequence: process start -> credential access -> DNS query -> outbound connection. By analyzing features from the entire event chain, the model can make a high-confidence determination of malicious intent, reducing false positives and detecting complex adversary tradecraft."
    answer_sources:
      - "Mobile EDR file integrity monitoring logs"
      - "Mobile EDR process or keychain access logs"
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Threat Intelligence Platform data"
      - "Corporate-managed mobile devices"
      - "Network Egress Points (Firewall/Proxy)"
      - "Internal DNS Resolvers"
      - "Mobile EDR Platform"
      - "Threat Intelligence Platform"
    range: "last 90 days"
    queries:
      - "ML Model Pseudocode: CREATE event sequences [Process Start -> Credential Access -> DNS Query -> Connection]. ENGINEER features for each step. TRAIN a sequence-aware model (e.g., LSTM) to classify sequences. DEPLOY to score real-time sequences and alert on high-confidence malicious predictions."