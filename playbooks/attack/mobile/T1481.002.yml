name: "T1481.002: Bidirectional Communication"
id: "8a1b6f0a-7c3d-4e9f-8a1b-9c0d1e2f3a4b"
description: "This playbook helps to identify if an adversary is using a legitimate external web service for command and control of a compromised mobile device. It focuses on detecting C2 communication that masquerades as legitimate traffic by looking for several key indicators: anomalous network traffic patterns like periodic 'heartbeat' connections or unusually large data transfers that deviate from a historical baseline; suspicious HTTP/S request characteristics such as high-entropy URIs (indicating encoded data) or non-standard/malicious User-Agent strings; and unusual application behavior, where a mobile app connects to a network service that is statistically rare for its category (e.g., a calculator app connecting to GitHub) or violates a predefined security policy."
type: "technique"
related:
  - "TA0037: Command And Control"
contributors:
  - "Zachary Szewczyk"
  - "Ask Sage"
created: "2025-10-01"
modified: "2025-10-01"
version: "1.0"
tags: "none"
questions:
  - question: "Are mobile devices communicating with domains, subdomains, or IP addresses known to be abused for C2 via legitimate web services?"
    context: "This question aims to identify high-confidence C2 activity by cross-referencing outbound network connections from mobile devices with a threat intelligence feed. A match indicates a device is connecting to infrastructure that, while hosted on a legitimate service, is known to be used by malicious actors for command and control."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek ssl.log"
      - "Network security monitoring sensors at internet gateways, corporate Wi-Fi gateways, VPN concentrators, and Cloud Access Security Broker (CASB) or Unified Endpoint Management (UEM) log sources where mobile device traffic is observable."
    range: "last 90 days"
    queries:
      - search_technology: "Pseudocode"
        query: "SEARCH Zeek logs (conn.log, ssl.log) WHERE source_ip is in mobile_device_range AND (destination_ip OR server_name) is in known_abused_c2_service_feed"
  - question: "Are any mobile devices exhibiting periodic, 'heartbeat'-like beaconing or making unusually large data transfers to legitimate web services?"
    context: "This question seeks to uncover C2 channels that use automated, repetitive connections (beaconing) or exfiltrate/receive large payloads. Regular, low-jitter connections suggest automated malware behavior, while significant data transfer anomalies can indicate data exfiltration or payload delivery, deviating from normal user activity."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek ssl.log"
      - "Network security monitoring sensors at internet gateways, corporate Wi-Fi gateways, VPN concentrators, and Cloud Access Security Broker (CASB) or Unified Endpoint Management (UEM) log sources where mobile device traffic is observable."
    range: "last 90 days"
    queries:
      - search_technology: "Pseudocode"
        query: "FOR each source_ip, destination_service pair: CALCULATE baseline stats (frequency, bytes). ALERT IF current_connection_bytes > 99th_percentile_baseline OR stddev(inter_arrival_time) < 1_second over 10_minutes"
  - question: "Is there a statistically significant anomaly in the time-series data volume for connections between a mobile device and a specific web service?"
    context: "This question uses advanced time-series analysis to detect subtle deviations in traffic volume that might be missed by simple thresholding. By modeling normal traffic patterns, including daily and weekly cycles, it can identify anomalous spikes or changes in data transfer volume that could represent C2 activity."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek ssl.log"
      - "Network security monitoring sensors at internet gateways, corporate Wi-Fi gateways, VPN concentrators, and Cloud Access Security Broker (CASB) or Unified Endpoint Management (UEM) log sources where mobile device traffic is observable."
    range: "last 90 days"
    queries:
      - search_technology: "Pseudocode"
        query: "FOR each device_service pair: TRAIN time_series_model on historical_data_volume. ALERT IF live_data_volume > model_prediction_interval(99%)"
  - question: "Are mobile devices making HTTP/S requests that contain known malicious C2 URI patterns or suspicious User-Agent strings?"
    context: "This question looks for explicit indicators of compromise within HTTP/S traffic. Malicious actors often use specific, recognizable patterns in URIs for C2 communication, and malware may use custom, non-standard, or known-bad User-Agent strings that differ from legitimate mobile browsers or applications."
    answer_sources:
      - "Zeek http.log"
      - "Zeek ssl.log"
      - "Zeek dns.log"
      - "SSL/TLS-inspecting forward proxies, corporate DNS servers, and other network traffic inspection points capable of decrypting and logging HTTP/S metadata."
    range: "last 90 days"
    queries:
      - search_technology: "Pseudocode"
        query: "SEARCH decrypted http.log WHERE uri MATCHES malicious_c2_regex_ruleset OR user_agent MATCHES known_bad_user_agent_list"
  - question: "Are there any HTTP/S requests from mobile devices with unusually high-entropy URIs or statistically rare User-Agent strings for a given destination service?"
    context: "This question aims to find C2 communications that hide data within the URI. High entropy (randomness) in a URI can indicate encoded or encrypted data being passed as a parameter. Similarly, a User-Agent that is rarely seen for a popular service can be an indicator of a custom client, such as malware, rather than a standard browser or app."
    answer_sources:
      - "Zeek http.log"
      - "Zeek ssl.log"
      - "Zeek dns.log"
      - "SSL/TLS-inspecting forward proxies, corporate DNS servers, and other network traffic inspection points capable of decrypting and logging HTTP/S metadata."
    range: "last 90 days"
    queries:
      - search_technology: "Pseudocode"
        query: "FOR each destination_service: CALCULATE baseline URI entropy and User-Agent frequency. ALERT IF current_request_uri_entropy > 3_stddev_from_mean OR current_request_user_agent_frequency < 0.1%"
  - question: "Can a machine learning model, trained on URI characteristics, classify any new mobile HTTP requests as malicious C2 traffic?"
    context: "This question applies a machine learning approach to detect malicious C2 URIs by analyzing multiple features simultaneously (e.g., length, character types, entropy). This method can identify complex patterns that are difficult to define with simple rules and can adapt to new and evolving C2 techniques."
    answer_sources:
      - "Zeek http.log"
      - "Zeek ssl.log"
      - "Zeek dns.log"
      - "SSL/TLS-inspecting forward proxies, corporate DNS servers, and other network traffic inspection points capable of decrypting and logging HTTP/S metadata."
    range: "last 90 days"
    queries:
      - search_technology: "Pseudocode"
        query: "FOR each new http_request: EXTRACT features (URI length, entropy, etc.). SCORE request with trained_classification_model. ALERT IF classification_score > 0.9"
  - question: "Are any sensitive or high-risk mobile applications communicating with network destinations not on their approved whitelist?"
    context: "This question enforces a strict, policy-based control for critical applications. By defining an explicit 'allow list' of network destinations, any deviation from this policy is a clear indicator of a potential compromise or misconfiguration, warranting immediate investigation."
    answer_sources:
      - "Mobile Device Management (MDM/UEM) logs"
      - "Zeek conn.log"
      - "Zeek ssl.log"
      - "HR Information System Data"
      - "Managed mobile device endpoints via MDM/UEM agents, MDM/UEM management consoles, and network chokepoints like corporate Wi-Fi gateways or Cloud Access Security Brokers (CASBs)."
    range: "last 90 days"
    queries:
      - search_technology: "Pseudocode"
        query: "JOIN MDM/UEM logs (for app_name) with Zeek logs (for destination_service). ALERT IF app_name is in sensitive_app_list AND destination_service is NOT in app_whitelist"
  - question: "Is a mobile application connecting to a network service that is statistically rare for its application category?"
    context: "This question identifies anomalous behavior by comparing an application's network activity to that of its peers. For example, if a 'Calculator' app starts communicating with a 'Development Tools' service like GitHub, it is a statistical anomaly that could indicate the app has been compromised or is a trojanized version."
    answer_sources:
      - "Mobile Device Management (MDM/UEM) logs"
      - "Zeek conn.log"
      - "Zeek ssl.log"
      - "HR Information System Data"
      - "Managed mobile device endpoints via MDM/UEM agents, MDM/UEM management consoles, and network chokepoints like corporate Wi-Fi gateways or Cloud Access Security Brokers (CASBs)."
    range: "last 90 days"
    queries:
      - search_technology: "Pseudocode"
        query: "FOR each app_category: PROFILE destination_service prevalence. ALERT IF an app connects to a service with prevalence < 1% within its category"
  - question: "Does a mobile app's network connection represent a bridge between two otherwise disconnected 'communities' of applications and services?"
    context: "This question uses graph analysis to find unusual relationships between applications and the network services they access. By identifying clusters of apps that normally talk to specific clusters of services (e.g., social media apps and social media sites), a connection that crosses these community boundaries is a strong indicator of an anomaly that could be C2 activity."
    answer_sources:
      - "Mobile Device Management (MDM/UEM) logs"
      - "Zeek conn.log"
      - "Zeek ssl.log"
      - "HR Information System Data"
      - "Managed mobile device endpoints via MDM/UEM agents, MDM/UEM management consoles, and network chokepoints like corporate Wi-Fi gateways or Cloud Access Security Brokers (CASBs)."
    range: "last 90 days"
    queries:
      - search_technology: "Pseudocode"
        query: "BUILD bipartite graph of apps and services. RUN community detection algorithm. ALERT on connections that link two distinct communities"