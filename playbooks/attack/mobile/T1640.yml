name: T1640: Account Access Removal
id: a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d
description: This playbook helps investigate whether an adversary is leveraging compromised mobile devices to remove or deny access to corporate user accounts. It focuses on detecting anomalous authentication events like lockouts and password resets, unusual API requests to account management endpoints, and suspicious activity on managed mobile devices, particularly when these events originate from mobile network providers or involve devices with mismatched or risky profiles.
type: technique
related:
  - TA0034: Impact
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
investigative_questions:
  - question: Has a user account experienced a rapid password reset attempt followed by a lockout from the same source IP, where that IP belongs to a mobile network and the device is not registered in our MDM?
    context: This question aims to detect a specific attack pattern where an adversary attempts to reset a user's password and then immediately locks the account, effectively denying access. By correlating these two events within a short timeframe from the same source and checking if the source is a mobile provider and the device is unknown, we can identify a highly suspicious and targeted attempt to remove account access, likely originating from a compromised mobile device.
    answer_sources:
      data_sources:
        - Windows Event ID 4740
        - Windows Event ID 4724
        - Zeek conn.log
        - Zeek http.log
        - MDM Device Logs
        - Cloud Identity Provider Logs
      nai: Active Directory Domain Controllers, VPN Concentrators, Internet Gateway, Mobile Device Management (MDM) Platform, Cloud Identity Provider (e.g., Azure AD, Okta)
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          SEARCH for EventID 4724 (password reset)
          JOIN with EventID 4740 (lockout) within 60s ON username AND source_ip
          IF match:
            ENRICH source_ip with ASN from Zeek conn.log
            IF ASN is in mobile_provider_watchlist:
              ENRICH username with device_status from MDM logs
              IF device is not registered or not compliant:
                ALERT as CRITICAL
              ELSE:
                ALERT as HIGH
  - question: Is a user account showing an anomalous number of authentication events (lockouts or password resets) compared to their own baseline, originating from a mobile network with an unrecognized device?
    context: This question focuses on detecting deviations from normal user behavior. By establishing a baseline of authentication activity for each user, we can spot unusual spikes that might indicate an attack. A spike exceeding the 99th percentile is already suspicious, but correlating it with an origin from a mobile network and a device that doesn't match the user's known profile significantly increases the likelihood of a malicious actor using a compromised mobile device.
    answer_sources:
      data_sources:
        - Windows Event ID 4740
        - Windows Event ID 4724
        - Zeek conn.log
        - Zeek http.log
        - MDM Device Logs
        - Cloud Identity Provider Logs
      nai: Active Directory Domain Controllers, VPN Concentrators, Internet Gateway, Mobile Device Management (MDM) Platform, Cloud Identity Provider (e.g., Azure AD, Okta)
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each user:
            CALCULATE 30-day baseline and 99th percentile of hourly auth events (4724, 4740).
          SEARCH for current hourly auth events > 99th percentile for a user.
          IF match:
            ENRICH source_ip with ASN and user-agent from Zeek logs.
            ENRICH user with device profile from MDM.
            IF ASN is mobile_provider AND user-agent is new or mismatched:
              ALERT as HIGH
            ELSE:
              ALERT as MEDIUM
  - question: Can a machine learning model detect anomalous authentication patterns for a user that, when combined with risk factors like mobile origin and unregistered devices, indicate a potential account access removal attempt?
    context: This question leverages machine learning to move beyond simple thresholding. A time-series model can identify subtle, complex anomalies in authentication patterns that static rules might miss. By creating a composite risk score that includes the model's output along with contextual factors like mobile network origin, unusual geolocation, and device registration status, we can create a highly effective and prioritized alerting system for sophisticated attacks.
    answer_sources:
      data_sources:
        - Windows Event ID 4740
        - Windows Event ID 4724
        - Zeek conn.log
        - Zeek http.log
        - MDM Device Logs
        - Cloud Identity Provider Logs
      nai: Active Directory Domain Controllers, VPN Concentrators, Internet Gateway, Mobile Device Management (MDM) Platform, Cloud Identity Provider (e.g., Azure AD, Okta)
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each user:
            TRAIN time-series model on auth event counts (5-min intervals).
          DETECT anomalies using the model.
          IF anomaly detected:
            ENRICH with ASN, geolocation, user-agent from Zeek.
            ENRICH with device registration status from MDM.
            CALCULATE risk_score = f(anomaly_score, is_mobile_asn, is_rare_geo, is_unregistered_device).
            IF risk_score > threshold:
              ALERT for investigation.
  - question: Has a critical account management API endpoint been accessed via a POST or DELETE request from a mobile network, especially if the session token lacks a recent MFA claim?
    context: This question targets direct, programmatic attacks against sensitive API endpoints responsible for account control (e.g., deletion, password reset). Monitoring for high-risk methods like POST and DELETE from mobile networks provides a strong initial signal. Further inspecting the session token for the absence of a recent MFA claim helps distinguish potentially legitimate but risky user actions from highly suspicious automated attacks that may have bypassed or stolen a session token without performing MFA.
    answer_sources:
      data_sources:
        - Zeek http.log
        - Zeek conn.log
        - WAF Logs
        - API Gateway Logs
        - Cloud Identity Provider Logs
      nai: API Gateway Servers, Web Application Firewalls (WAFs), Internet-facing application servers, Cloud Identity Provider Logs, Microservice infrastructure hosting account management functions
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          DEFINE critical_api_endpoints_watchlist.
          SEARCH for POST/DELETE requests to watched endpoints.
          IF match:
            ENRICH source_ip with ASN from Zeek conn.log.
            IF ASN is in mobile_provider_watchlist:
              PARSE Authorization header for MFA claim.
              IF recent_mfa_claim is absent:
                ALERT as CRITICAL
              ELSE:
                ALERT as HIGH
  - question: Is a source IP from a mobile network sending an anomalously high number of requests to a critical API endpoint, and do these requests show signs of being scripted or repetitive?
    context: This question aims to identify brute-force or scripted attacks against APIs from mobile devices. A simple high request rate from a mobile IP is suspicious, but it could be a legitimate user retrying an action. By also measuring the Shannon entropy of the URIs requested by that IP, we can add a crucial piece of context. A sudden drop in entropy (e.g., the same exact API call is made over and over) strongly suggests automated, non-human behavior, warranting a high-severity alert.
    answer_sources:
      data_sources:
        - Zeek http.log
        - Zeek conn.log
        - WAF Logs
        - API Gateway Logs
        - Cloud Identity Provider Logs
      nai: API Gateway Servers, Web Application Firewalls (WAFs), Internet-facing application servers, Cloud Identity Provider Logs, Microservice infrastructure hosting account management functions
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each critical_api_endpoint:
            CALCULATE 30-day baseline and 99th percentile of request rate per source_ip.
          SEARCH for source_ip with request rate > 99th percentile.
          IF match:
            ENRICH source_ip with ASN from Zeek conn.log.
            IF ASN is mobile_provider:
              CALCULATE Shannon entropy of URIs from source_ip in the same time window.
              IF entropy < low_threshold (e.g., 1.0):
                ALERT as HIGH
              ELSE:
                ALERT as MEDIUM
  - question: Can a machine learning model identify outlier API requests to sensitive endpoints, particularly those that are POST/DELETE requests originating from mobile networks?
    context: This question uses an unsupervised machine learning model to detect unusual API access that doesn't fit established patterns. By building a feature vector that describes multiple dimensions of a request (what, how, when, from where), the model can spot novel or evasive attack techniques that rule-based systems might miss. Prioritizing outliers that involve high-impact methods (POST/DELETE) from mobile network ASNs allows analysts to focus on the most probable threats.
    answer_sources:
      data_sources:
        - Zeek http.log
        - Zeek conn.log
        - WAF Logs
        - API Gateway Logs
        - Cloud Identity Provider Logs
      nai: API Gateway Servers, Web Application Firewalls (WAFs), Internet-facing application servers, Cloud Identity Provider Logs, Microservice infrastructure hosting account management functions
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          TRAIN unsupervised model (e.g., Isolation Forest) on baseline API traffic features.
          FOR each new API request to sensitive endpoints:
            CONSTRUCT feature vector (URI, method, body_len, user-agent, etc.).
            SCORE request with model.
            IF score is outlier:
              ENRICH source_ip with ASN.
              IF (HTTP method is POST or DELETE) AND (ASN is mobile_provider):
                ALERT for immediate investigation, prioritized by score.
  - question: Has a user's account been locked out or had a failed password reset shortly after a non-standard application was granted administrator rights on their managed mobile device?
    context: This question links a high-risk event on a mobile device (granting admin rights to an unapproved app) directly to a negative impact on the user's corporate account. The initial event indicates a potential device compromise or malicious insider action. The subsequent account lockout or failed reset within a short time window provides strong evidence that the compromised device is being used to attack the user's account, warranting an immediate, high-severity response.
    answer_sources:
      data_sources:
        - MDM Device Logs
        - MDM Application Logs
        - Windows Event ID 4724
        - Windows Event ID 4740
        - Zeek conn.log
        - Cloud Identity Provider Logs
      nai: Mobile Device Management (MDM) Platform, Managed Mobile Devices, Active Directory Domain Controllers, Cloud Identity Provider (e.g., Azure AD, Okta), VPN Concentrators
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          SEARCH MDM logs for 'Device Admin' permission granted to non-standard app.
          IF match:
            MONITOR auth logs for that user for 60 minutes.
            IF EventID 4740 or failed_cloud_password_reset occurs for the user:
              ALERT as HIGH.
  - question: Is a managed mobile device experiencing an unusually high frequency of 'Device Administrator' permission grants, and is it also exhibiting anomalous network traffic to authentication services?
    context: This question seeks to identify devices that are behaving suspiciously, even if the apps involved are technically on an approved list. An abnormal rate of admin permission grants is a red flag. By correlating this with a second anomaly—a statistically significant increase in network connections to authentication ports (like Kerberos or LDAP)—we can build a stronger case that the device is compromised and being prepared for, or is actively engaged in, an attack on user credentials.
    answer_sources:
      data_sources:
        - MDM Device Logs
        - MDM Application Logs
        - Windows Event ID 4724
        - Windows Event ID 4740
        - Zeek conn.log
        - Cloud Identity Provider Logs
      nai: Mobile Device Management (MDM) Platform, Managed Mobile Devices, Active Directory Domain Controllers, Cloud Identity Provider (e.g., Azure AD, Okta), VPN Concentrators
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each device:
            CALCULATE 90-day baseline and 99th percentile of 'Device Admin' grants.
          SEARCH for device with grants > 99th percentile in a 24-hour period.
          IF match:
            CALCULATE user's daily norm for auth connection volume (ports 88, 389, etc.).
            QUERY current auth connection volume from device.
            IF current volume > (norm + 3 * std_dev):
              ALERT as HIGH
            ELSE:
              ALERT as MEDIUM
  - question: Can we use machine learning to cluster mobile devices into risk groups, and if a device enters a high-risk group, should we treat subsequent security events like account lockouts with a higher level of scrutiny?
    context: This question proposes a proactive, risk-based approach to device monitoring. Instead of treating all devices equally, we can use clustering to identify devices that exhibit a combination of risky characteristics (e.g., many high-risk permissions, non-compliant status). Once a device is flagged as high-risk by the model, its security posture is considered degraded. This justifies lowering the alerting threshold for that device, meaning even a single suspicious event (which might be ignored for a 'healthy' device) will trigger an immediate alert, enabling faster response to potential compromises.
    answer_sources:
      data_sources:
        - MDM Device Logs
        - MDM Application Logs
        - Windows Event ID 4724
        - Windows Event ID 4740
        - Zeek conn.log
        - Cloud Identity Provider Logs
      nai: Mobile Device Management (MDM) Platform, Managed Mobile Devices, Active Directory Domain Controllers, Cloud Identity Provider (e.g., Azure AD, Okta), VPN Concentrators
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          TRAIN clustering model (e.g., K-Means) on MDM device features.
          IDENTIFY high-risk clusters.
          FOR each device:
            IF device enters a high-risk cluster:
              SET device_risk_status = 'high'.
          IF device_risk_status is 'high' AND any EventID 4740 or failed MFA occurs:
            ALERT immediately.