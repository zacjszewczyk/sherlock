name: T1627.001: Geofencing
id: f47ac10b-58cc-4372-a567-0e02b2c3d479
description: >-
  Investigates whether an adversary is using geofencing to evade detection or analysis on mobile devices. This involves checking for applications with high-risk, persistent location permissions that are not justified by the app's functional category. It also involves dynamically testing applications in a sandbox environment by simulating a change in GPS coordinates to observe if the application's network behavior abruptly changes, such as by ceasing network callbacks, reducing data volume, or shifting DNS requests. This behavior indicates an attempt to alter functionality based on geographical location to evade analysis.
type: technique
related:
  - TA0030: Defense Evasion
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Are any mobile applications requesting persistent background location permissions without being in a category where such access is justified by corporate policy?
    context: >-
      This question helps identify potential misuse of high-risk permissions. Applications that request background location access but don't have a clear, policy-approved need (like navigation or weather apps) may be using this permission for malicious tracking or geofencing-based evasion. This check serves as a first-line defense against privacy violations and covert malware behavior.
    answer_sources:
      - MDM App Inventory Report
      - Static Analysis Tool Output (e.g., MobSF JSON report)
      - Corporate Application Policy
      - Application Store Metadata
      - Mobile Device Management (MDM) Platform
      - Application Vetting Sandbox
      - Corporate App Store Repository
      - Managed Mobile Endpoints
    range: last 90 days
    queries:
      - search: pseudocode
        query: >-
          GET all apps from MDM. FILTER for apps with 'ACCESS_BACKGROUND_LOCATION' or 'NSLocationAlwaysAndWhenInUseUsageDescription'. FOR each filtered app, CHECK if its category is in the approved list. IF NOT, ALERT.
  - question: Is an application requesting background location permissions in a way that is statistically anomalous compared to other applications in the same App Store category?
    context: >-
      This question aims to find outliers. Even if an application's category isn't explicitly disallowed by policy, it might still be behaving unusually. By calculating the prevalence of background location permissions across all apps in a category, we can flag apps that request this permission when it is rare for their peers. This points to behavior that deviates from the norm and warrants further investigation for geofencing or other malicious activity.
    answer_sources:
      - MDM App Inventory Report
      - Static Analysis Tool Output (e.g., MobSF JSON report)
      - Corporate Application Policy
      - Application Store Metadata
      - Mobile Device Management (MDM) Platform
      - Application Vetting Sandbox
      - Corporate App Store Repository
      - Managed Mobile Endpoints
    range: last 90 days
    queries:
      - search: pseudocode
        query: >-
          GET all apps with their categories and permissions. FOR each category, CALCULATE percentage of apps with background location permission. FOR each app with the permission, COMPARE its category's percentage to a global threshold (e.g., 5th percentile). IF below threshold, ALERT.
  - question: Does a machine learning model, based on static features like permissions and API calls, classify a new or updated application as having a high probability of malicious geofencing?
    context: >-
      This question leverages machine learning to automate the detection of suspicious applications. By training a model on known-good and known-bad examples, it can learn complex patterns that are difficult to define with simple rules. This proactive approach analyzes an app's static characteristics (permissions, API calls, category) to predict its likelihood of being malicious, flagging high-risk apps for manual review before they are widely deployed.
    answer_sources:
      - MDM App Inventory Report
      - Static Analysis Tool Output (e.g., MobSF JSON report)
      - Corporate Application Policy
      - Application Store Metadata
      - Mobile Device Management (MDM) Platform
      - Application Vetting Sandbox
      - Corporate App Store Repository
      - Managed Mobile Endpoints
    range: last 90 days
    queries:
      - search: pseudocode
        query: >-
          EXTRACT features (permissions, API calls, category) from application binary. INPUT features into pre-trained classification model. IF model_output_probability > 0.85, ALERT.
  - question: Does an application's periodic network beaconing stop after its simulated GPS location is moved to a restricted geographical area?
    context: >-
      This question seeks to identify geofencing by observing an application's live network behavior. Many malicious apps use 'beaconing' to communicate with a command and control (C2) server. If this beaconing activity abruptly stops when the device's location is changed to a 'restricted' or unexpected region, it's a strong indicator that the malware is using geofencing to hide its C2 communication and evade analysis.
    answer_sources:
      - Mobile Application Vetting Sandbox Logs
      - Zeek conn.log
      - Zeek dns.log
      - Zeek http.log
      - Zeek ssl.log
      - Application Vetting Sandbox
      - Network Egress Points (VPN, Corporate Wi-Fi)
      - DNS Resolvers
      - Web Proxy Servers
    range: last 90 days
    queries:
      - search: pseudocode
        query: >-
          In sandbox, BASELINE network traffic for 10 mins, identify beacons. SIMULATE GPS location change. MONITOR network traffic for 5+ mins. IF beacons cease and do not resume, ALERT.
  - question: Following a simulated GPS location change, does the application's network traffic exhibit a significant drop in both DNS request randomness and data volume?
    context: >-
      This question uses statistical measures of network traffic to detect geofencing. Malicious activity often involves communicating with randomly generated or high-entropy domains and exfiltrating data. A sudden, simultaneous drop in DNS entropy (less randomness) and egress data volume after a location change suggests the application has switched from a covert, malicious mode to a benign, low-activity state to avoid detection in an 'unfriendly' geographical region.
    answer_sources:
      - Mobile Application Vetting Sandbox Logs
      - Zeek conn.log
      - Zeek dns.log
      - Zeek http.log
      - Zeek ssl.log
      - Application Vetting Sandbox
      - Network Egress Points (VPN, Corporate Wi-Fi)
      - DNS Resolvers
      - Web Proxy Servers
    range: last 90 days
    queries:
      - search: pseudocode
        query: >-
          In sandbox, CAPTURE baseline network metrics (DNS entropy, egress volume). SIMULATE GPS location change. CAPTURE post-change metrics. IF post-change DNS entropy drops > 1.5 std dev AND egress volume drops > 75%, ALERT.
  - question: Does a time-series anomaly detection model detect a significant change in network behavior, followed by a new stable state, immediately after a simulated GPS location change is introduced?
    context: >-
      This question applies advanced machine learning to dynamic analysis. An LSTM autoencoder is trained to understand 'normal' network behavior over time. When analyzing a new app, a simulated location change is introduced as an event. If the model flags a large anomaly (high reconstruction error) at that exact moment, followed by a shift to a new, different-but-stable pattern (e.g., very low traffic), it strongly implies the app's behavior is directly and intentionally tied to its geographical location, a hallmark of geofencing.
    answer_sources:
      - Mobile Application Vetting Sandbox Logs
      - Zeek conn.log
      - Zeek dns.log
      - Zeek http.log
      - Zeek ssl.log
      - Application Vetting Sandbox
      - Network Egress Points (VPN, Corporate Wi-Fi)
      - DNS Resolvers
      - Web Proxy Servers
    range: last 90 days
    queries:
      - search: pseudocode
        query: >-
          In sandbox, FEED live network telemetry into a trained LSTM model. INTRODUce simulated GPS location change. IF model reports high reconstruction error at time of change, followed by a new stable low-activity state, ALERT.