name: 'T1628.003: Conceal Multimedia Files'
id: 5e9d3b1a-8f7c-4d6e-a2b1-9c0f8e7d4a3b
description: This playbook focuses on detecting adversaries concealing captured multimedia files on mobile devices. It identifies the creation of '.nomedia' files by unauthorized applications, particularly in obfuscated directory paths, which is a key technique for hiding files from standard media viewers. It also looks for the subsequent exfiltration of these files by monitoring for anomalous outbound network connections transferring large volumes of multimedia data to new or known malicious destinations.
type: technique
related:
  - 'TA0030: Defense Evasion'
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: '2025-10-01'
modified: '2025-10-01'
version: 1.0
tags: none
questions:
  - question: Has a '.nomedia' file been created by an application that is not a standard system or media application?
    context: This question is crucial for identifying attempts to hide media files from standard gallery or media player applications. Adversaries may use this technique to conceal captured images or videos before exfiltration. Detecting the creation of this file by an unexpected application (i.e., not a photo gallery or system process) is a strong indicator of malicious intent.
    answer_sources:
      - Mobile EDR File System Auditing Logs
      - Mobile MDM Application Inventory Logs
      - File systems of corporate-managed Android devices, specifically user-writable directories such as /storage/emulated/0/DCIM/, /storage/emulated/0/Pictures/, /storage/emulated/0/Download/, and application-specific data folders.
    range: last 90 days
    queries:
      - pseudocode: |
          SEARCH Mobile EDR logs for file creation events where file.name = '.nomedia'.
          FOR EACH event, get the creating process name.
          CHECK IF the process name is in the allowlist of known media/system applications.
          ALERT if the process is not in the allowlist.
  - question: Was the '.nomedia' file created in a directory with an unusually complex or randomized name?
    context: Adversaries often use randomly generated directory names to further obfuscate the location of hidden files, making manual discovery more difficult. A high Shannon entropy score for the directory path suggests randomness and is a common characteristic of malware or attacker tools. This question helps prioritize alerts by focusing on '.nomedia' files placed in suspicious locations.
    answer_sources:
      - Mobile EDR File System Auditing Logs
      - Mobile MDM Application Inventory Logs
      - File systems of corporate-managed Android devices, specifically user-writable directories such as /storage/emulated/0/DCIM/, /storage/emulated/0/Pictures/, /storage/emulated/0/Download/, and application-specific data folders.
    range: last 90 days
    queries:
      - pseudocode: |
          ON alert for unauthorized '.nomedia' creation:
          CALCULATE Shannon entropy of the file.directory path.
          COMPARE entropy score to a baseline (e.g., 98th percentile) or a hard threshold (e.g., > 3.5).
          ESCALATE ALERT if entropy is high.
  - question: Based on a machine learning model, what is the risk score associated with the '.nomedia' file creation event?
    context: This question leverages machine learning to synthesize multiple data points into a single, actionable risk score. By considering features like directory entropy, application age, permissions, and whether it was sideloaded, the model can provide a more nuanced and accurate assessment than individual rules. A high-risk score indicates a strong likelihood of malicious activity, justifying an immediate and potentially automated response like device isolation.
    answer_sources:
      - Mobile EDR File System Auditing Logs
      - Mobile MDM Application Inventory Logs
      - File systems of corporate-managed Android devices, specifically user-writable directories such as /storage/emulated/0/DCIM/, /storage/emulated/0/Pictures/, /storage/emulated/0/Download/, and application-specific data folders.
    range: last 90 days
    queries:
      - pseudocode: |
          FOR EACH '.nomedia' creation event:
          EXTRACT features (e.g., directory_path_entropy, application_age_on_device, is_sideloaded).
          INPUT features into a pre-trained risk model (e.g., Random Forest).
          IF model's predicted probability > 0.90, TRIGGER critical alert and initiate automated response.
  - question: Is a mobile device transferring multimedia files to a known malicious domain?
    context: This question directly targets the exfiltration phase of the attack. After hiding multimedia files, the adversary needs to transfer them off the device. Correlating network traffic to known malicious infrastructure (domains or IPs) from a threat intelligence feed provides high-fidelity evidence of data theft. Identifying multimedia file types (e.g., image/jpeg, video/mp4) in this traffic confirms the nature of the exfiltrated data.
    answer_sources:
      - Zeek files.log
      - Zeek http.log
      - Zeek conn.log
      - Zeek dns.log
      - Network egress points monitoring traffic from mobile device subnets, including corporate Wi-Fi gateways, VPN concentrators, and Cloud Access Security Brokers (CASB).
    range: last 90 days
    queries:
      - pseudocode: |
          SEARCH Zeek dns.log and http.log for connections from mobile subnets to domains on threat intelligence lists.
          FOR each matching connection, get the connection UID.
          PIVOT to Zeek files.log using the connection UID.
          ALERT if files.log shows a file transfer with a multimedia MIME type.
  - question: Is a mobile device exfiltrating a large volume of multimedia files to a new, previously unseen destination?
    context: Attackers often use newly registered or temporary domains for data exfiltration to avoid existing blocklists. This question focuses on behavioral anomalies rather than known bad indicators. A device suddenly sending a large amount of multimedia data (e.g., > 10MB) to a domain it has never contacted before is highly suspicious and warrants investigation, even if the destination is not on a threat intelligence list.
    answer_sources:
      - Zeek files.log
      - Zeek http.log
      - Zeek conn.log
      - Zeek dns.log
      - Network egress points monitoring traffic from mobile device subnets, including corporate Wi-Fi gateways, VPN concentrators, and Cloud Access Security Brokers (CASB).
    range: last 90 days
    queries:
      - pseudocode: |
          FOR EACH mobile device, maintain a 30-day rolling baseline of unique destination domains contacted.
          SEARCH Zeek logs for sessions with large (>10MB) outbound transfers of multimedia MIME types.
          CHECK if the destination domain is in the device's 30-day baseline.
          ALERT if the destination domain is new for that device.
  - question: Does the pattern of outbound multimedia traffic from a device deviate significantly from its normal behavior?
    context: This question employs advanced analytics to detect subtle or complex exfiltration patterns that might be missed by simple threshold-based rules. A time-series model can identify unusual spikes in data volume over time, while clustering can detect anomalous connection characteristics (e.g., long durations, unusual packet sizes). Combining these methods helps to identify sophisticated adversaries attempting to blend in with normal traffic.
    answer_sources:
      - Zeek files.log
      - Zeek http.log
      - Zeek conn.log
      - Zeek dns.log
      - Network egress points monitoring traffic from mobile device subnets, including corporate Wi--Fi gateways, VPN concentrators, and Cloud Access Security Brokers (CASB).
    range: last 90 days
    queries:
      - pseudocode: |
          FOR EACH device, apply a time-series model (e.g., ARIMA) to the hourly volume of outbound multimedia bytes.
          ALERT if the observed volume is a significant outlier (e.g., > 3 standard deviations from forecast).
          ENRICH alert by clustering connection features (duration, packets) of the outlier traffic to identify behavioral anomalies.