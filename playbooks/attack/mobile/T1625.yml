name: "T1625: Hijack Execution Flow"
id: "a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d"
description: |
  This playbook helps determine if an adversary has established persistence on a mobile device by hijacking its execution flow. It focuses on detecting two primary categories of evidence. The first is the presence of failed device integrity checks within Mobile Device Management (MDM) or Mobile Threat Defense (MTD) logs, which can be identified by explicit failure messages (e.g., attestation_result: 'FAIL') or by cryptographic hashes of system components not matching known-good baselines. The second is the observation of anomalous network traffic originating from a mobile device, such as connections to known malicious IPs, the use of rare SSL/TLS client fingerprints (JA3), or statistical outliers in connection metadata like DNS query patterns or data volume.
type: "technique"
related: 
  - "TA0028: Persistence"
contributors:
  - "Zachary Szewczyk"
  - "Ask Sage"
created: "2025-10-01"
modified: "2025-10-01"
version: 1.0
tags: "none"
questions:
  - question: "Is there a real-time alert for mobile devices failing integrity or attestation checks?"
    context: |
      This question aims to establish a proactive, real-time alerting mechanism for explicit signs of device compromise. An immediate alert upon detection of a failed integrity check (e.g., `attestation_result: 'FAIL'`, `root_status: 'detected'`) in MDM or MTD logs is critical for rapid response. It allows security analysts to quickly isolate a potentially compromised device before an adversary can move laterally or exfiltrate data. The alert must contain key details like device ID, user, and the specific failure reason to expedite investigation.
    answer_sources:
      - "Mobile Device Management (MDM) attestation logs"
      - "Mobile Threat Defense (MTD) integrity scan logs"
      - "MDM/MTD management console, managed mobile endpoints (iOS, Android), and centralized log aggregator (SIEM) ingesting events from the MDM/MTD cloud infrastructure."
    range: "last 90 days"
    queries:
      - "pseudocode": "SEARCH MDM/MTD logs WHERE (attestation_result = 'FAIL' OR root_status = 'detected' OR integrity_status = 'failed') | ALERT with device_id, user, reason"
  - question: "Has any device profile shown a statistically significant increase in attestation failures compared to its historical baseline?"
    context: |
      This question moves beyond single, explicit failures to detect subtle, targeted attacks. By baselining the normal attestation failure rate for specific device models and OS versions, analysts can identify anomalies. A sudden spike in the failure rate for a particular device profile, exceeding a statistical threshold (e.g., 99th percentile), could indicate a new exploit targeting that specific configuration or a bad OS update that creates a vulnerability. This provides an early warning of a developing threat that might otherwise be lost in the noise of random, isolated failures.
    answer_sources:
      - "Mobile Device Management (MDM) attestation logs"
      - "Mobile Threat Defense (MTD) integrity scan logs"
      - "MDM/MTD management console, managed mobile endpoints (iOS, Android), and centralized log aggregator (SIEM) ingesting events from the MDM/MTD cloud infrastructure."
    range: "last 90 days"
    queries:
      - "pseudocode": "FOR each device_profile | CALCULATE 30-day baseline failure_rate | SEARCH hourly for current_failure_rate | ALERT if current_failure_rate > 99th_percentile(baseline_failure_rate)"
  - question: "Is there a fleet-wide, anomalous spike in the total number of attestation failures?"
    context: |
      This question addresses the detection of large-scale campaigns or systemic issues affecting the entire mobile fleet. By applying time-series anomaly detection to the aggregate count of all integrity failures, analysts can identify patterns that deviate significantly from normal operational noise. An alert triggered when failure counts exceed the model's forecast for a sustained period suggests a widespread event, such as a zero-day exploit being deployed or a critical failure in the MDM/MTD infrastructure.
    answer_sources:
      - "Mobile Device Management (MDM) attestation logs"
      - "Mobile Threat Defense (MTD) integrity scan logs"
      - "MDM/MTD management console, managed mobile endpoints (iOS, Android), and centralized log aggregator (SIEM) ingesting events from the MDM/MTD cloud infrastructure."
    range: "last 90 days"
    queries:
      - "pseudocode": "TRAIN time-series model on 90-day history of hourly attestation failure counts | FORECAST expected failure count with confidence bounds | ALERT if observed_count > upper_bound for 3 consecutive hours"
  - question: "Has any mobile device connected to a known malicious IP address or domain?"
    context: |
      This is a fundamental and high-fidelity investigative question. By cross-referencing network connection logs (specifically Zeek's intel.log) from mobile devices against curated threat intelligence feeds, analysts can immediately identify communications with known command-and-control (C2) servers, malware distribution points, or other malicious infrastructure. An alert from this check is a strong indicator of compromise and requires immediate investigation.
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Zeek ssl.log"
      - "Zeek intel.log"
      - "Zeek ja3.log"
      - "Network sensors (e.g., Zeek) deployed at key egress points, including corporate Wi-Fi network gateways, VPN concentrators serving mobile devices, and DNS resolvers used by mobile clients."
    range: "last 90 days"
    queries:
      - "pseudocode": "SEARCH Zeek intel.log WHERE source_ip IN mobile_ip_range AND intel_source indicates malicious | ALERT with source_ip, destination_ip, intel_details"
  - question: "Is any mobile device exhibiting anomalous network behavior compared to its own baseline?"
    context: |
      This question seeks to uncover covert malicious activity by identifying subtle deviations from a device's normal network patterns. Adversaries may use novel domains or custom TLS implementations that evade signature-based detection. By baselining each device's behavior, analysts can flag suspicious outliers, such as the use of a never-before-seen JA3 hash (indicating a new client application), DNS queries for algorithmically generated domains (high entropy), or unusual spikes in outbound data transfer. This behavioral approach is effective at detecting unknown or customized malware.
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Zeek ssl.log"
      - "Zeek intel.log"
      - "Zeek ja3.log"
      - "Network sensors (e.g., Zeek) deployed at key egress points, including corporate Wi-Fi network gateways, VPN concentrators serving mobile devices, and DNS resolvers used by mobile clients."
    range: "last 90 days"
    queries:
      - "pseudocode": "FOR each device_ip | BASELINE 30-day activity (JA3, DNS entropy, outbound_bytes) | SEARCH hourly for outliers | ALERT if current_JA3 is new OR current_entropy > 98th_percentile OR current_bytes > 98th_percentile"
  - question: "Can machine learning classify any mobile device network connections as potentially malicious?"
    context: |
      This question leverages the power of machine learning to synthesize numerous weak signals from network logs into a strong, actionable indicator of compromise. A supervised model, trained on labeled malicious and benign traffic, can learn complex patterns that are difficult for humans to define with rules. By scoring every connection based on features like duration, data volume, and DNS/TLS metadata, this approach can uncover sophisticated threats that mimic legitimate traffic but exhibit subtle malicious characteristics, providing a probabilistic risk score for analysts to prioritize investigations.
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Zeek ssl.log"
      - "Zeek intel.log"
      - "Zeek ja3.log"
      - "Network sensors (e.g., Zeek) deployed at key egress points, including corporate Wi-Fi network gateways, VPN concentrators serving mobile devices, and DNS resolvers used by mobile clients."
    range: "last 90 days"
    queries:
      - "pseudocode": "FOR each connection from mobile_ip_range | EXTRACT features (duration, bytes, proto, conn_state, dns_entropy, etc.) | APPLY trained ML model | ALERT if malicious_probability > 0.90"