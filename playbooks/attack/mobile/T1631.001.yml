name: T1631.001: Ptrace System Calls
id: f8a7b6c5-4d3e-4b2a-8c9d-1e0f2a3b4c5d
description: This playbook helps identify adversaries using ptrace system calls on mobile devices for privilege escalation and defense evasion. An adversary may use ptrace to attach to a higher-privileged process (e.g., root or system) to inject and execute malicious code. This technique is often indicated by an unapproved application making a ptrace call to a privileged process. Additionally, adversaries may use ptrace to inject code into a legitimate application to masquerade their malicious network activity, such as C2 communication or data exfiltration. This subsequent network activity may be identifiable by its connection to known malicious infrastructure or by anomalous characteristics like high-entropy domain lookups or connections to unusual ports.
type: technique
related:
  - TA0029: Privilege Escalation
  - TA0030: Defense Evasion
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
investigative_questions:
  - question: Has a known malicious application used a ptrace system call to attach to a privileged process (root or system)?
    context: This question seeks to identify the highest-fidelity indicator of malicious ptrace usage. By cross-referencing the hash of the source application making the ptrace call with a threat intelligence feed of known malicious application hashes, analysts can quickly confirm if a known threat is attempting to escalate privileges by injecting code into a process running as root (euid=0) or system (euid=1000). A positive match is a strong signal of a compromise in progress.
    answer_sources:
      - Android auditd log
      - MDM application inventory log
      - NAI: Central SIEM aggregating Android auditd log streams from managed mobile endpoints; Mobile Device Management (MDM) platform containing application inventories.
    range: the last 90 days
    queries:
      - technology: Pseudocode
        query: SEARCH Android auditd logs WHERE syscall=101 AND source_process_hash IN threat_intel_feed AND target_process_euid IN (0, 1000)
  - question: Is an application that is not an approved developer/debugging tool using ptrace to attach to a privileged process, or is any application using ptrace at an anomalously high rate?
    context: This question helps detect potentially malicious or suspicious ptrace activity from unknown or unauthorized applications. By maintaining an allow-list of legitimate developer and debugging tools expected to use ptrace, any other application using it to target privileged processes becomes inherently suspicious. Furthermore, by baselining the normal frequency of ptrace calls for all applications, a sudden spike from any single application can indicate that it has been compromised or is being used for malicious purposes, even if it's normally benign.
    answer_sources:
      - Android auditd log
      - MDM application inventory log
      - NAI: Central SIEM aggregating Android auditd log streams from managed mobile endpoints; Mobile Device Management (MDM) platform containing application inventories.
    range: the last 90 days
    queries:
      - technology: Pseudocode
        query: SEARCH Android auditd logs WHERE syscall=101 AND source_process_name NOT IN ptrace_allow_list AND target_process_euid IN (0, 1000)
      - technology: Pseudocode
        query: SEARCH Android auditd logs WHERE syscall=101 | STATS count BY hour, application, device | COMPARE count to 99th_percentile_baseline
  - question: Has a machine learning model classified a ptrace system call targeting a privileged process as malicious with high confidence?
    context: This question leverages a machine learning model to detect subtle or complex patterns of malicious ptrace usage that rule-based detections might miss. By training a model on features like process name entropy, parent process details, and time-based patterns, it can learn the nuanced differences between benign and malicious calls. An alert from a model with a high confidence score (>0.90), especially when a privileged process is the target, provides a sophisticated, data-driven signal that warrants immediate investigation.
    answer_sources:
      - Android auditd log
      - MDM application inventory log
      - NAI: Central SIEM aggregating Android auditd log streams from managed mobile endpoints; Mobile Device Management (MDM) platform containing application inventories.
    range: the last 90 days
    queries:
      - technology: Pseudocode
        query: STREAM Android auditd logs WHERE syscall=101 TO ML_model | SEARCH model_output WHERE classification='malicious' AND probability > 0.90 AND target_process_euid IN (0, 1000)
  - question: Did a device that recently executed a ptrace call subsequently communicate with a known malicious C2 server or domain?
    context: This question aims to link an endpoint behavior (ptrace) with suspicious network activity (C2 communication) to uncover defense evasion. An adversary might inject code into a legitimate process to hide their activity; this injected code then initiates network connections. Correlating a ptrace event with a nearly simultaneous connection to a destination on a high-confidence threat intelligence feed provides strong evidence that the ptrace call was used to initiate malicious C2 activity.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Android auditd log
      - NAI: Network sensors at corporate Wi-Fi egress points, VPN concentrators, and DNS resolvers; Central SIEM aggregating network and mobile endpoint logs.
    range: the last 90 days
    queries:
      - technology: Pseudocode
        query: JOIN (SEARCH Android auditd logs WHERE syscall=101) AND (SEARCH Zeek logs WHERE destination_ip OR destination_domain IN threat_intel_feed) ON source_ip WITHIN 5 minutes
  - question: Following a ptrace call, did the device exhibit anomalous network behavior, such as connecting to an unusual port or querying a high-entropy domain name?
    context: This question helps identify malicious follow-on activity even when the destination is not on a threat intelligence list. After using ptrace to inject code, an adversary's malware may connect to a non-standard port for C2 or use a Domain Generation Algorithm (DGA), which produces high-entropy domain names. By baselining normal network behavior for each device, any deviation (like using a new port or a DGA-like domain) shortly after a ptrace event serves as a powerful indicator of compromise.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Android auditd log
      - NAI: Network sensors at corporate Wi-Fi egress points, VPN concentrators, and DNS resolvers; Central SIEM aggregating network and mobile endpoint logs.
    range: the last 90 days
    queries:
      - technology: Pseudocode
        query: SEQUENCE (SEARCH Android auditd logs WHERE syscall=101) THEN (SEARCH Zeek logs WHERE destination_port NOT IN baseline_ports OR domain_entropy > 95th_percentile_baseline) ON source_ip WITHIN 10 minutes
  - question: Did a device's overall network traffic profile (bytes, connections, DNS queries) become anomalous according to a time-series model immediately after a ptrace call was executed?
    context: This question uses advanced time-series analysis to detect subtle changes in the overall volume and pattern of a device's network traffic post-ptrace. An adversary's injected code might cause changes in traffic volume, connection frequency, or DNS activity that are not individually anomalous but form a suspicious pattern when viewed together over time. A time-series model (like an LSTM Autoencoder) can detect these composite anomalies, flagging when a device's network behavior significantly deviates from its established norm immediately following a ptrace event.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Android auditd log
      - NAI: Network sensors at corporate Wi-Fi egress points, VPN concentrators, and DNS resolvers; Central SIEM aggregating network and mobile endpoint logs.
    range: the last 90 days
    queries:
      - technology: Pseudocode
        query: SEARCH Android auditd logs WHERE syscall=101 | TRIGGER time_series_model on subsequent Zeek logs for source_ip | ALERT on reconstruction_error > 99th_percentile for 3 consecutive intervals