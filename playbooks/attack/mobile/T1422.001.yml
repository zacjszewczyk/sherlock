name: T1422.001: Internet Connection Discovery
id: a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d
description: This playbook helps identify if an adversary is performing network discovery on a compromised mobile device. This is often characterized by the execution of network diagnostic commands (like 'netstat', 'ping', 'ifconfig') from unusual processes or remote shells, or by observing bursts of automated network probing activity. This activity can manifest as a high volume of DNS queries to common domains, an unusual number of short-lived TCP connections, and low data transfer per connection, all of which are indicative of an attacker attempting to understand the device's network connectivity and environment rather than normal user activity.
type: technique
related:
- TA0032: Discovery
contributors:
- Zachary Szewczyk
- Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
- question: Is a mobile endpoint executing network diagnostic commands from an unauthorized parent process or remote shell?
  context: Adversaries frequently use built-in network diagnostic tools like 'netstat', 'ping', and 'ifconfig' to map the internal network and discover the device's internet connectivity. This question helps distinguish malicious use from legitimate administrative activity by checking if these commands are executed by an unexpected parent process (i.e., not a known system or MDM tool) or within the context of a remote shell, which is a common vector for hands-on-keyboard attacks.
  answer_sources:
  - Mobile EDR process execution logs
  - Android Debug Bridge (ADB) logs
  - Corporate-managed mobile devices (Android, iOS)
  - Mobile Device Management (MDM) servers
  - Endpoint Detection and Response (EDR) platform consoles
  range: last 90 days
  queries:
  - search_technology: pseudocode
    query: SEARCH process_logs WHERE command_line CONTAINS ('netstat', 'ping', 'ifconfig', 'getprop net.dns1') AND parent_process NOT IN (allowlist). CORRELATE with adb_logs to check for remote shell execution context.
- question: Has a mobile endpoint executed a statistically rare network discovery command compared to its own baseline and the fleet-wide activity?
  context: This question aims to detect subtle or low-and-slow discovery techniques that might be missed by simple signature-based rules. By establishing a behavioral baseline for command-line executions on each device and across the entire fleet, we can identify when a network discovery command is anomalous. An alert based on high rarity or a significant spike in execution volume for a specific device can indicate that an adversary is using legitimate tools for malicious purposes in a way that deviates from normal operational patterns.
  answer_sources:
  - Mobile EDR process execution logs
  - Android Debug Bridge (ADB) logs
  - Corporate-managed mobile devices (Android, iOS)
  - Mobile Device Management (MDM) servers
  - Endpoint Detection and Response (EDR) platform consoles
  range: last 90 days
  queries:
  - search_technology: pseudocode
    query: FOR each process_event with a discovery command, CALCULATE its rarity against a 30-day baseline. ALERT IF rarity_score is in top 5% of fleet OR daily_command_count > 99th percentile of device's history.
- question: Does a machine learning model classify a process execution event on a mobile endpoint as malicious network discovery activity?
  context: This question leverages a supervised machine learning model to provide a more sophisticated and context-aware detection capability. The model can analyze multiple features simultaneously (e.g., the command itself, its parent process, user privileges, time of day, remote execution context) to identify complex patterns indicative of malice. This approach can achieve higher accuracy and reduce false positives compared to static rules, as it learns to differentiate between benign and malicious execution patterns from historical data.
  answer_sources:
  - Mobile EDR process execution logs
  - Android Debug Bridge (ADB) logs
  - Corporate-managed mobile devices (Android, iOS)
  - Mobile Device Management (MDM) servers
  - Endpoint Detection and Response (EDR) platform consoles
  range: last 90 days
  queries:
  - search_technology: pseudocode
    query: SCORE new process_events using trained Random Forest model. ALERT IF predicted_probability_of_malice > 0.90.
- question: Is a mobile device connecting to a known command and control (C2) server while performing network discovery?
  context: This question seeks to find high-fidelity evidence of a compromise by correlating network activity with threat intelligence. If a mobile device initiates a connection to a destination IP address known to be a C2 server, it is a strong indicator of an active intrusion. Enriching this alert with DNS query data and device ownership information provides immediate context for an incident responder to confirm the threat and take action.
  answer_sources:
  - Zeek conn.log
  - Zeek dns.log
  - Network egress points
  - corporate Wi-Fi controllers
  - VPN concentrators
  - Internal DNS resolvers
  range: last 90 days
  queries:
  - search_technology: pseudocode
    query: SEARCH network_logs WHERE src_ip IN mobile_range AND dest_ip IN c2_threat_feed. ENRICH alert with DNS and MDM data for context.
- question: Does a mobile device's network traffic exhibit statistical anomalies indicative of automated probing?
  context: Adversary-driven network discovery is often automated, resulting in traffic patterns that differ significantly from normal user behavior. This question focuses on identifying these statistical outliers. By analyzing network metadata in short time windows—such as the entropy of destination IPs, the number of unique domains queried, and the ratio of very short connections—we can detect machine-generated traffic. An alert is triggered when multiple metrics deviate significantly from the device's established baseline, suggesting an automated tool is at work.
  answer_sources:
  - Zeek conn.log
  - Zeek dns.log
  - Network egress points
  - corporate Wi-Fi controllers
  - VPN concentrators
  - Internal DNS resolvers
  range: last 90 days
  queries:
  - search_technology: pseudocode
    query: AGGREGATE network_logs in 1-minute windows by src_ip. CALCULATE metrics (Shannon entropy, unique domains, short_connection_ratio). ALERT IF 2+ metrics exceed 3 standard deviations from the 28-day baseline.
- question: Has an unsupervised machine learning model identified a mobile device's network traffic pattern as a significant outlier?
  context: This question uses an unsupervised model, like an Isolation Forest, to find "unknown unknowns" or novel attack patterns that may not be caught by signature or rule-based detections. The model learns what normal traffic looks like for each device based on features like connection volume, data transfer size, protocol mix, and destination diversity. It then flags any device whose traffic patterns are highly anomalous or isolated from the norm, which could represent a new or cleverly disguised form of network discovery.
  answer_sources:
  - Zeek conn.log
  - Zeek dns.log
  - Network egress points
  - corporate Wi-Fi controllers
  - VPN concentrators
  - Internal DNS resolvers
  range: last 90 days
  queries:
  - search_technology: pseudocode
    query: PROCESS network_data in 1-minute windows. SCORE each window using a trained Isolation Forest model. INVESTIGATE devices flagged as significant outliers.