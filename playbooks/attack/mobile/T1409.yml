name: "T1409: Stored Application Data"
id: "1e9a71a3-83fe-4a8b-9c98-71320349c2e0"
description: "Is an adversary accessing and exfiltrating sensitive application data from our managed mobile devices? This involves detecting unauthorized inter-process communication where a process accesses another app's sandboxed storage or escalates permissions. It also covers identifying anomalous outbound network connections with unusually large data volumes to malicious or newly registered domains. Additionally, it aims to find instances of corporate applications writing files with sensitive data patterns to world-readable external storage locations."
type: "technique"
related:
  - "TA0035: Collection"
contributors: "Zachary Szewczyk, Ask Sage"
created: "2025-10-01"
modified: "2025-10-01"
version: 1.0
tags: "none"
questions:
  - question: "Are processes accessing files outside of their own application sandbox in a manner not explicitly allowlisted, or are processes attempting to change directory permissions to be world-readable/writable?"
    context: "This question seeks to identify classic sandbox escape or data theft techniques on mobile devices. A malicious application might try to read sensitive data (like credentials or tokens) from a legitimate application's private storage. By maintaining an allowlist of known-good inter-app communications and alerting on deviations, we can detect this unauthorized access. Similarly, monitoring for 'chmod 777' or 'chmod 666' on application directories is a strong indicator of an attempt to break down security barriers for easier data access."
    answer_sources:
      - "Mobile EDR file access audit logs"
      - "Mobile EDR process execution logs"
      - "MDM compliance violation alerts"
      - "Internal application storage directories (e.g., /data/data/ on Android, Application Sandboxes on iOS) on all managed mobile endpoints."
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "SEARCH file_events WHERE source_app != target_app AND (source_app, target_path) NOT IN allowlist; SEARCH process_events WHERE command CONTAINS 'chmod 777' OR command CONTAINS 'chmod 666' AND target_path CONTAINS '/data/data/'"
  - question: "Are managed applications exhibiting anomalous file access patterns, such as accessing a significantly different set of directories than normal or appearing to scan directories?"
    context: "This question aims to detect more subtle indicators of compromise. Instead of a single, explicitly malicious action, an adversary might use a compromised legitimate application to slowly explore the file system. By baselining normal behavior (which directories an app usually touches) and using a Jaccard index to detect deviations, we can spot this exploration. High Shannon entropy in accessed directory names can also indicate scanning activity, as the process is accessing many different, unrelated paths rather than a few predictable ones."
    answer_sources:
      - "Mobile EDR file access audit logs"
      - "Mobile EDR process execution logs"
      - "MDM compliance violation alerts"
      - "Internal application storage directories (e.g., /data/data/ on Android, Application Sandboxes on iOS) on all managed mobile endpoints."
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "FOR each app, BASELINE normal_directory_access; HOURLY, CALCULATE jaccard_similarity(current_access, baseline); ALERT if similarity < threshold; FOR each process, CALCULATE shannon_entropy(accessed_directories) in 5_min_window; ALERT if entropy > threshold"
  - question: "Can we detect anomalous inter-application file access events using a graph-based model of normal device activity?"
    context: "This question proposes a sophisticated, machine-learning-based approach to detecting unauthorized data access. By modeling the entire ecosystem of application interactions as a graph, we can identify rare or entirely new connections (e.g., a game suddenly accessing the corporate email client's data). This method is powerful because it considers the context of the entire system and can flag events that might look benign in isolation but are highly anomalous when viewed as part of the larger interaction graph."
    answer_sources:
      - "Mobile EDR file access audit logs"
      - "Mobile EDR process execution logs"
      - "MDM compliance violation alerts"
      - "Internal application storage directories (e.g., /data/data/ on Android, Application Sandboxes on iOS) on all managed mobile endpoints."
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "BUILD graph with apps as nodes, file_access as edges; TRAIN GCN model on baseline graph; FOR new_file_access_event, SCORE with model; ALERT if anomaly_score > threshold"
  - question: "Are managed mobile devices connecting to known malicious IPs/domains or to newly registered domains?"
    context: "This question addresses data exfiltration by looking for connections to suspicious destinations. Adversaries often use command-and-control (C2) servers with known malicious reputations or stand up new infrastructure for specific campaigns. By correlating network connection logs with threat intelligence feeds (known bad IPs/domains) and passive DNS data (newly registered domains), we can quickly identify high-confidence indicators of a compromise."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Zeek intel.log"
      - "Passive DNS logs"
      - "Corporate Wi-Fi network gateways; VPN concentrators; Cloud Access Security Broker (CASB) egress points"
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "SEARCH conn_logs FROM mobile_ips; JOIN with threat_intel on destination_ip; JOIN with dns_logs and whois_data; ALERT if destination in threat_intel OR domain_age < 30_days"
  - question: "Are mobile devices exhibiting anomalous network egress behavior, such as unusually large data uploads, especially when combined with other suspicious characteristics?"
    context: "This question focuses on detecting data exfiltration through behavioral anomalies, even when the destination isn't known to be malicious. A device suddenly sending a large amount of data is highly suspicious. This suspicion is amplified if the upload is very fast (suggesting a bulk transfer) or if it uses a network service that the device doesn't typically use. This multi-faceted profiling helps reduce false positives from legitimate large transfers."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Zeek intel.log"
      - "Passive DNS logs"
      - "Corporate Wi-Fi network gateways; VPN concentrators; Cloud Access Security Broker (CASB) egress points"
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "FOR each device, PROFILE outbound_bytes, duration, services; FOR new_connection, ALERT if outbound_bytes > 99.5th_percentile; INCREASE_PRIORITY if duration < 5th_percentile OR service is new_for_device"
  - question: "Can we use an unsupervised machine learning model to identify any network connection that significantly deviates from a device's established normal behavior?"
    context: "This question leverages machine learning to create a comprehensive, multi-dimensional profile of 'normal' for each device's network activity. Models like Isolation Forest can learn complex patterns across many features (data volume, duration, protocol, port, etc.). Any connection that the model flags as an 'outlier' is, by definition, a significant deviation from that device's unique norm, making it a strong candidate for investigation. This is effective at catching novel exfiltration techniques."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Zeek intel.log"
      - "Passive DNS logs"
      - "Corporate Wi-Fi network gateways; VPN concentrators; Cloud Access Security Broker (CASB) egress points"
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "FOR each device, TRAIN isolation_forest_model on features (bytes, duration, proto, port, time); FOR new_connection, PREDICT with model; ALERT if prediction is 'outlier'"
  - question: "Are managed corporate applications writing files with names indicative of sensitive data (e.g., 'backup', 'creds.db') to world-readable external storage locations?"
    context: "This question targets a common data staging technique where an adversary causes an application to save sensitive information to a location that is easily accessible by other applications, such as the 'Downloads' folder. This is a high-fidelity indicator because legitimate corporate apps should rarely export sensitive data to insecure, public locations. Using a regular expression to match filenames associated with credentials, backups, or exports provides an effective way to detect this activity."
    answer_sources:
      - "Mobile EDR file write event logs (including process name, file path, and file hash)"
      - "Mobile DLP file content scan results"
      - "Publicly accessible external storage directories on managed mobile devices (e.g., /storage/emulated/0/, /sdcard/, and their subdirectories like Download and Documents)."
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "SEARCH file_write_events WHERE source_app IN managed_apps AND target_path IN external_storage; ALERT if filename MATCHES regex('backup|creds|password|etc')"
  - question: "Are managed applications writing an unusually high number of files to external storage, or are the files being written highly entropic, suggesting they are encrypted or compressed?"
    context: "This question looks for behavioral clues related to data staging. High entropy in a file (like a .txt file that looks like random characters) is a strong sign that the data within is not plain text, but rather encrypted or compressed, which is a common step before exfiltration. A sudden burst of file writes to external storage from an application that normally doesn't do so is also suspicious. Combining these two analytics can help detect an adversary preparing data for exfiltration."
    answer_sources:
      - "Mobile EDR file write event logs (including process name, file path, and file hash)"
      - "Mobile DLP file content scan results"
      - "Publicly accessible external storage directories on managed mobile devices (e.g., /storage/emulated/0/, /sdcard/, and their subdirectories like Download and Documents)."
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "ON file_write to external_storage, CALCULATE file_entropy; ALERT if entropy > 99th_percentile_for_filetype; HOURLY, COUNT file_writes_per_app; ALERT if count > 3_std_dev_from_average"
  - question: "Are managed applications writing files to external storage that contain actual sensitive content, such as PII, credentials, or API keys, as identified by an NLP model?"
    context: "This is the most direct approach to detecting sensitive data exposure. Instead of relying on file names or entropy as proxies, this question involves inspecting the file content itself using advanced text classification models. A fine-tuned NLP model can identify specific patterns like Social Security Numbers or API keys. A high-confidence detection from such a model is a critical finding, justifying an immediate, automated response like quarantining the device to prevent data loss."
    answer_sources:
      - "Mobile EDR file write event logs (including process name, file path, and file hash)"
      - "Mobile DLP file content scan results"
      - "Publicly accessible external storage directories on managed mobile devices (e.g., /storage/emulated/0/, /sdcard/, and their subdirectories like Download and Documents)."
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "ON file_write to external_storage, SEND file_content_sample to NLP_model; IF model_prediction is 'Sensitive' AND confidence > 0.95, CREATE critical_incident AND quarantine_device"