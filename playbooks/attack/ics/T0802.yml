name: 'T0802: Automated Collection'
id: 'f8a9b7c6-d5e4-4f32-1a0b-9c8d7e6f5a43'
description: 'This playbook helps to determine if an adversary is performing automated collection of data from an Industrial Control System (ICS) or Operational Technology (OT) environment. Evidence of this technique includes a single source establishing an anomalous number of connections to unique devices on ICS-specific ports, a suspicious process creation on an ICS asset followed by a burst of network connections, or an unusually high number of successful network logon events to ICS servers. The goal is to identify unauthorized scanning, data gathering, and lateral movement for collection purposes.'
type: 'technique'
related:
  - 'TA0100: Collection'
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: '2025-10-01'
modified: '2025-10-01'
version: '1.0'
tags: 'none'
questions:
  - question: 'Is a known malicious IP or an unauthorized scanner attempting to connect to multiple ICS devices?'
    context: 'This question aims to identify obvious scanning activity. By checking against a watchlist of known malicious IPs, we can quickly spot confirmed threats. Additionally, by comparing scanning behavior against an allowlist of authorized scanners (like vulnerability management tools), we can filter out legitimate activity and focus on unauthorized or anomalous scanning attempts that could indicate an adversary''s initial reconnaissance. A fixed threshold provides a simple, immediate detection mechanism.'
    answer_sources:
      - 'Zeek conn.log'
      - 'Zeek notice.log'
      - 'Network taps/SPAN ports on ICS network segments (Control Network, Process Network, DMZ), specifically monitoring traffic to/from PLCs, RTUs, and HMIs.'
    range: 'last 90 days'
    queries:
      - technology: 'pseudocode'
        query: 'SEARCH Zeek conn.log WHERE source_ip IN malicious_watchlist; SEARCH Zeek conn.log WHERE source_ip NOT IN authorized_scanners AND unique_destination_ip_count > 20 ON ICS_ports WITHIN 5_minutes GROUP BY source_ip;'
  - question: 'Is any host exhibiting network scanning behavior that deviates from its own established baseline?'
    context: 'This question moves beyond static thresholds to a more dynamic, behavioral approach. By creating a historical baseline of normal activity for each host, we can detect when a host suddenly starts behaving like a scanner, even if it''s a previously trusted asset. This helps identify compromised internal hosts being used for lateral movement and reconnaissance. Calculating the entropy of destination ports can further confirm scanning activity, as random or widespread port connections are atypical for normal ICS operations.'
    answer_sources:
      - 'Zeek conn.log'
      - 'Zeek notice.log'
      - 'Network taps/SPAN ports on ICS network segments (Control Network, Process Network, DMZ), specifically monitoring traffic to/from PLCs, RTUs, and HMIs.'
    range: 'last 90 days'
    queries:
      - technology: 'pseudocode'
        query: 'FOR each source_ip, CALCULATE 99th_percentile_baseline of unique_destination_ip_count per 5_minutes over 30_days; COMPARE current_5_minute_count to baseline; ALERT if current > baseline; ENRICH with destination_port_entropy_calculation;'
  - question: 'Has an anomaly detection model identified a host exhibiting network behavior consistent with automated collection?'
    context: 'This question leverages machine learning to identify complex patterns of anomalous behavior that may not be caught by simple threshold or baseline checks. By considering multiple features simultaneously (e.g., unique IPs/ports, connection counts, data volume), an unsupervised model like Isolation Forest can detect subtle deviations from normal network patterns. This is effective for finding novel or slow-and-low attack techniques that try to evade traditional detection methods.'
    answer_sources:
      - 'Zeek conn.log'
      - 'Zeek notice.log'
      - 'Network taps/SPAN ports on ICS network segments (Control Network, Process Network, DMZ), specifically monitoring traffic to/from PLCs, RTUs, and HMIs.'
    range: 'last 90 days'
    queries:
      - technology: 'pseudocode'
        query: 'TRAIN IsolationForest model on 30_day baseline of Zeek conn.log features (unique_dest_ips, unique_dest_ports, conn_count, byte_sum); APPLY model to real-time 5_minute feature vectors; ALERT if model flags source_ip as anomalous;'
  - question: 'Has an unauthorized or suspicious process been executed on a critical ICS asset?'
    context: 'This question focuses on identifying the initial execution of a malicious tool or script on a key asset like an HMI or Engineering Workstation. ICS environments should have highly predictable and controlled software running. By using a process allowlist, any deviation is immediately suspect. Specifically looking for scripting interpreters (PowerShell, Python) or known scanning tools (Nmap) provides a high-fidelity indicator that an adversary is attempting to establish a foothold for collection activities.'
    answer_sources:
      - 'Windows Event ID 4688'
      - 'Zeek conn.log'
      - 'Host logging agents on Engineering Workstations (EWS), Operator Stations / HMIs, and ICS Application Servers; Network taps/SPAN ports positioned to capture traffic originating from these assets.'
    range: 'last 90 days'
    queries:
      - technology: 'pseudocode'
        query: 'SEARCH WindowsEvent:4688 WHERE process_name NOT IN process_allowlist OR command_line CONTAINS (''powershell.exe'', ''python.exe'', ''nmap.exe'');'
  - question: 'Following the execution of a suspicious process, did the host immediately initiate an unusual number of network connections?'
    context: 'This question aims to link a suspicious host-based event (process creation) with subsequent network behavior (scanning). An adversary often runs a tool that immediately begins collecting data from the network. By correlating the process event with network logs in a tight time window (e.g., 60 seconds), we can confirm the purpose of the suspicious process. Exceeding a host-specific baseline for network activity post-process creation provides strong evidence that the process is malicious and is performing automated collection.'
    answer_sources:
      - 'Windows Event ID 4688'
      - 'Zeek conn.log'
      - 'Host logging agents on Engineering Workstations (EWS), Operator Stations / HMIs, and ICS Application Servers; Network taps/SPAN ports positioned to capture traffic originating from these assets.'
    range: 'last 90 days'
    queries:
      - technology: 'pseudocode'
        query: 'ON suspicious_process_alert (from WindowsEvent:4688), QUERY Zeek conn.log for source_ip from T to T+60_seconds; COUNT unique destination_ips; ALERT if count > host_baseline_for_post_process_activity;'
  - question: 'Have machine learning models simultaneously detected a suspicious command line execution and an anomalous network connection burst from the same host?'
    context: 'This question combines two separate machine learning models to create a very high-confidence alert. A command-line classification model can detect obfuscated or unusual commands that might evade simple keyword matching. A time-series model on network traffic can detect sudden bursts of activity. When both models fire for the same host in a short time window, it provides a powerful, composite signal that an automated collection script or tool has been launched and is now active on the network.'
    answer_sources:
      - 'Windows Event ID 4688'
      - 'Zeek conn.log'
      - 'Host logging agents on Engineering Workstations (EWS), Operator Stations / HMIs, and ICS Application Servers; Network taps/SPAN ports positioned to capture traffic originating from these assets.'
    range: 'last 90 days'
    queries:
      - technology: 'pseudocode'
        query: 'MODEL_A: SCORE maliciousness of command_line from WindowsEvent:4688; MODEL_B: DETECT anomalous spike in connection_count from Zeek conn.log; ALERT if MODEL_A flags process as suspicious AND MODEL_B detects spike from same host within 60_seconds;'
  - question: 'Has a suspicious or unauthorized network logon occurred on a critical ICS server?'
    context: 'This question focuses on identifying improper access to critical servers like Data Historians or OPC servers. Automated collection often requires authenticating to multiple systems. By monitoring for logons (Logon Type 3) from watchlisted accounts, accounts not belonging to the correct access groups, or user accounts logging in at odd hours, we can detect potential abuse of credentials for data gathering purposes. This is a fundamental security hygiene check that can reveal lateral movement.'
    answer_sources:
      - 'Windows Event ID 4624'
      - 'Zeek conn.log'
      - 'Host logging agents on OPC Servers, Data Historians, and Domain Controllers servicing the ICS environment; Network taps/SPAN ports near these servers to correlate logon events with protocol-level traffic.'
    range: 'last 90 days'
    queries:
      - technology: 'pseudocode'
        query: 'SEARCH WindowsEvent:4624 (LogonType=3) on critical_servers WHERE account IN watchlist OR account NOT IN approved_AD_group OR (account_type=user AND time NOT IN business_hours);'
  - question: 'Is any user account or IP address generating an anomalously high number of successful logons to an ICS server?'
    context: 'This question uses statistical analysis to find unusual logon patterns. An adversary using a script to authenticate to multiple systems in a short period will generate a burst of successful logon events. By establishing a baseline for each user/IP and server pair, we can detect when the number of logons deviates significantly (e.g., >3 standard deviations) from normal behavior. This is effective for detecting automated credential use for widespread data access.'
    answer_sources:
      - 'Windows Event ID 4624'
      - 'Zeek conn.log'
      - 'Host logging agents on OPC Servers, Data Historians, and Domain Controllers servicing the ICS environment; Network taps/SPAN ports near these servers to correlate logon events with protocol-level traffic.'
    range: 'last 90 days'
    queries:
      - technology: 'pseudocode'
        query: 'FOR each source_ip-destination_server pair, CALCULATE 30_day_baseline (mean, stddev) of logon_count (EventID 4624, Type 3) per 10_minutes; COMPARE current_10_minute_count to baseline; ALERT if current_count > (mean + 3*stddev);'
  - question: 'Has a time-series model detected an unexpected spike in successful logons that correlates with an increase in ICS protocol traffic?'
    context: 'This question uses a more advanced forecasting model (like ARIMA) to predict the expected number of logons and flags significant deviations. This can detect anomalous logon bursts more accurately than a simple standard deviation model. The key part of this question is the enrichment step: correlating the logon anomaly with a simultaneous increase in actual ICS protocol traffic (like OPC or Modbus) between the involved hosts. This correlation strongly indicates that the anomalous logons are not just an authentication issue but are being actively used for data collection.'
    answer_sources:
      - 'Windows Event ID 4624'
      - 'Zeek conn.log'
      - 'Host logging agents on OPC Servers, Data Historians, and Domain Controllers servicing the ICS environment; Network taps/SPAN ports near these servers to correlate logon events with protocol-level traffic.'
    range: 'last 90 days'
    queries:
      - technology: 'pseudocode'
        query: 'MODEL: FORECAST expected_logon_count per 10_minutes for critical_servers; ALERT if observed_logon_count > prediction_interval; ON alert, ENRICH by querying Zeek conn.log for increase in ICS_protocol_traffic between source_ip and destination_server;'