name: T0887: Wireless Sniffing
id: 3c1a9f8e-7d6b-4c1a-8b9f-0e1d2c3b4a5f
description: |
  This playbook helps investigate if an adversary is capturing or discovering wireless Industrial Control Systems (ICS) communications. It addresses potential replay attacks by identifying suspicious command patterns, such as commands executed outside of operational hours, redundant commands, or commands followed by system anomalies. It also focuses on detecting unauthorized wireless devices by monitoring for unknown MAC addresses, anomalous signal strengths (RSSI) suggesting spoofing, and unusual device behavior profiles. Furthermore, the playbook aids in identifying reconnaissance activities like unauthorized RF signal detection, frequency hopping, and network scanning from unknown sources targeting ICS wireless gateways.
type: technique
related:
- TA0100: Collection
- TA0102: Discovery
contributors:
- Zachary Szewczyk
- Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
- question: Have any ICS write commands been executed from wireless gateways under suspicious circumstances, such as outside of normal hours, redundantly, or without a corresponding authorized user action?
  context: This question aims to detect potential replay attacks. An attacker might capture a legitimate command and replay it later. Such replayed commands often lack the normal operational context, such as being executed during off-hours, attempting to change a state that is already set, or not being preceded by a legitimate operator logging in or interacting with an HMI.
  answer_sources:
  - Data Sources: Zeek conn.log, Zeek dnp3.log, Zeek modbus.log, Windows Event ID 4624, Windows Event ID 4688, Sysmon Event ID 1, Sysmon Event ID 3, Syslog from field devices (PLCs, RTUs), ICS Historian Database Logs (e.g., OSIsoft PI), HMI Application Event Logs
  - NAI: Network segments connecting wireless gateways to the ICS network, Wireless Access Points/Gateways, Human-Machine Interfaces (HMIs), Engineering Workstations (EWS), Data Historian servers, and PLC/RTU network interfaces.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      SEARCH for Modbus/DNP3 write commands from wireless_gateway_IPs
      WHERE (timestamp is outside operational_hours)
      OR (command_value == last_historian_value)
      OR (NOT (user_login OR hmi_process_creation from authorized_user within 2 mins before command))
- question: Have any illogical or out-of-order command sequences been observed for critical PLCs/RTUs, deviating from their normal operational patterns?
  context: Legitimate ICS operations often follow predictable sequences (e.g., 'open valve' is followed by 'confirm flow'). Replay attacks can disrupt this logical flow by inserting commands out of sequence. By modeling normal command transitions (e.g., using a Markov chain), we can detect sequences with a very low probability of occurring, which may indicate malicious activity.
  answer_sources:
  - Data Sources: Zeek conn.log, Zeek dnp3.log, Zeek modbus.log, Windows Event ID 4624, Windows Event ID 4688, Sysmon Event ID 1, Sysmon Event ID 3, Syslog from field devices (PLCs, RTUs), ICS Historian Database Logs (e.g., OSIsoft PI), HMI Application Event Logs
  - NAI: Network segments connecting wireless gateways to the ICS network, Wireless Access Points/Gateways, Human-Machine Interfaces (HMIs), Engineering Workstations (EWS), Data Historian servers, and PLC/RTU network interfaces.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR each critical PLC/RTU:
        CALCULATE transition probabilities between command pairs from historical logs to build a baseline model.
        MONITOR real-time command sequences.
        ALERT if observed sequence probability is below a statistical threshold (e.g., <1%).
- question: Can we detect anomalous sequences of ICS commands that deviate from learned normal behavior using a machine learning model?
  context: This question uses an advanced anomaly detection technique to identify subtle deviations in command sequences that simpler rule-based methods might miss. An LSTM autoencoder learns the complex temporal patterns of legitimate command traffic. When a malicious or replayed sequence is introduced, the model will struggle to reconstruct it accurately, resulting in a high "reconstruction error" that flags the activity as anomalous.
  answer_sources:
  - Data Sources: Zeek conn.log, Zeek dnp3.log, Zeek modbus.log, Windows Event ID 4624, Windows Event ID 4688, Sysmon Event ID 1, Sysmon Event ID 3, Syslog from field devices (PLCs, RTUs), ICS Historian Database Logs (e.g., OSIsoft PI), HMI Application Event Logs
  - NAI: Network segments connecting wireless gateways to the ICS network, Wireless Access Points/Gateways, Human-Machine Interfaces (HMIs), Engineering Workstations (EWS), Data Historian servers, and PLC/RTU network interfaces.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      TRAIN LSTM autoencoder on historical command sequences (function code, parameters, time delta).
      FEED real-time command sequences (e.g., 5-minute windows) into the trained model.
      CALCULATE reconstruction error for each sequence.
      ALERT if reconstruction error exceeds a dynamic threshold (e.g., 99th percentile of normal error).
- question: Are there any unauthorized wireless devices (based on MAC address) transmitting on our ICS network frequencies?
  context: A fundamental security control is to ensure that only known, authorized devices can communicate on the wireless ICS network. This question seeks to identify any device whose MAC address is not in the asset inventory, which could be an attacker's device attempting to sniff traffic or inject commands.
  answer_sources:
  - Data Sources: Zeek wifi.log, Wireless IDS/IPS Logs, Spectrum Analyzer Logs, RF Sensor Logs, ICS Asset Inventory Database, Network Access Control (NAC) Logs, Kismet logs (.pcaplog, .netxml)
  - NAI: Physical airspace and critical infrastructure corridors surrounding ICS facilities, specifically near wireless field devices, sensors, actuators, and wireless access points/gateways. Includes uncontrolled public areas with line-of-sight to field assets (e.g., parking lots, adjacent properties).
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      MONITOR wireless logs (Zeek wifi.log, WIDS) for source MAC addresses.
      CROSS-REFERENCE each MAC address with the authorized_asset_inventory.
      ALERT if a transmitting MAC address is NOT in the inventory.
- question: Are any of our authorized, static wireless devices transmitting with a signal strength that is statistically inconsistent with their known physical location?
  context: An attacker may try to spoof the MAC address of a legitimate device. However, it is difficult to also spoof the physical location. By monitoring the Received Signal Strength Indicator (RSSI) of static devices, we can detect anomalies. A sudden, significant change in RSSI for a device that shouldn't be moving can indicate that a different device, at a different location, is impersonating it.
  answer_sources:
  - Data Sources: Zeek wifi.log, Wireless IDS/IPS Logs, Spectrum Analyzer Logs, RF Sensor Logs, ICS Asset Inventory Database, Network Access Control (NAC) Logs, Kismet logs (.pcaplog, .netxml)
  - NAI: Physical airspace and critical infrastructure corridors surrounding ICS facilities, specifically near wireless field devices, sensors, actuators, and wireless access points/gateways. Includes uncontrolled public areas with line-of-sight to field assets (e.g., parking lots, adjacent properties).
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR each static_wireless_device:
        CALCULATE baseline RSSI mean and standard deviation over 14 days.
        IN real-time, calculate the Z-score of the current RSSI.
        ALERT if absolute Z-score > 3.5 for a sustained period (e.g., >60 seconds).
- question: Is any authorized wireless device exhibiting a behavioral profile (based on signal strength, associated SSIDs, channel use) that is uncharacteristic of its normal operation?
  context: This question moves beyond single metrics like MAC address or RSSI to analyze a device's overall behavior. By clustering devices based on multiple features, we can create profiles for different types of normal activity (e.g., 'fixed sensor,' 'mobile tablet'). If a device suddenly matches a different profile, it could indicate it has been compromised, spoofed, or is being used for a malicious purpose.
  answer_sources:
  - Data Sources: Zeek wifi.log, Wireless IDS/IPS Logs, Spectrum Analyzer Logs, RF Sensor Logs, ICS Asset Inventory Database, Network Access Control (NAC) Logs, Kismet logs (.pcaplog, .netxml)
  - NAI: Physical airspace and critical infrastructure corridors surrounding ICS facilities, specifically near wireless field devices, sensors, actuators, and wireless access points/gateways. Includes uncontrolled public areas with line-of-sight to field assets (e.g., parking lots, adjacent properties).
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      PROFILE normal device behavior using K-Means clustering on historical data (RSSI, SSIDs, channels, frame types).
      ASSIGN each device to a cluster representing its normal profile.
      IN real-time, check the cluster assignment of each device.
      ALERT if a device's behavior causes it to shift to an unexpected cluster.
- question: Have we detected any persistent, unauthorized radio signals in protected ICS frequency bands that exhibit characteristics of a reconnaissance tool (e.g., rapid channel hopping, power fluctuations)?
  context: Before an attacker can sniff or interfere with wireless communications, they must first discover the frequencies and protocols in use. This reconnaissance phase often involves using specialized tools that scan across frequencies. This question aims to detect the tell-tale signs of such scanning activity, like rapid frequency changes or power level shifts that are not typical of legitimate ICS devices.
  answer_sources:
  - Data Sources: Spectrum Analyzer Logs, Wireless IDS Logs, RF Sensor Grid Logs, Drone Detection System Logs
  - NAI: Physical perimeter, airspace, rooftops, and high-ground locations with line-of-sight to ICS facilities, focusing on control rooms, substations, remote terminal units (RTUs), and field device arrays.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      MONITOR RF signals in protected ICS bands.
      ALERT if a signal persists (> 30s) AND:
        (signal_signature is NOT in authorized_list)
        AND (signal exhibits rapid_channel_hopping OR large_power_fluctuation).
- question: Has there been a statistically significant increase in the randomness or unpredictability of frequencies being used within our protected ICS bands?
  context: A wireless scanning tool rapidly jumping between many different frequencies will create a more random, or high-entropy, frequency distribution compared to normal operations where devices communicate on fixed channels. By monitoring the entropy of frequency usage, we can detect a shift from predictable communication to unpredictable scanning activity.
  answer_sources:
  - Data Sources: Spectrum Analyzer Logs, Wireless IDS Logs, RF Sensor Grid Logs, Drone Detection System Logs
  - NAI: Physical perimeter, airspace, rooftops, and high-ground locations with line-of-sight to ICS facilities, focusing on control rooms, substations, remote terminal units (RTUs), and field device arrays.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      CALCULATE a baseline for Shannon entropy of frequency distribution in protected bands over 30 days.
      IN real-time, calculate entropy over rolling 1-minute windows.
      ALERT if current entropy exceeds the baseline threshold (e.g., 99th percentile) for several consecutive intervals.
- question: Can we use a machine learning classifier to identify and distinguish malicious scanning signals from legitimate wireless traffic and background noise?
  context: This question applies supervised machine learning to the problem of RF signal identification. By training a classifier on examples of known legitimate signals, noise, and known scanner patterns, we can build a model that can automatically classify new, unknown signals. An alert for an 'Unknown_Scanner' provides a high-confidence indicator of reconnaissance activity.
  answer_sources:
  - Data Sources: Spectrum Analyzer Logs, Wireless IDS Logs, RF Sensor Grid Logs, Drone Detection System Logs
  - NAI: Physical perimeter, airspace, rooftops, and high-ground locations with line-of-sight to ICS facilities, focusing on control rooms, substations, remote terminal units (RTUs), and field device arrays.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      TRAIN a Random Forest classifier on labeled RF signal data (frequency, power, bandwidth, etc.).
      DEPLOY model to classify real-time RF signals.
      ALERT if a signal in an ICS band is classified as 'Unknown_Scanner' with high confidence (>0.90).
- question: Is a single, unknown source IP generating a high rate of failed connection attempts against an ICS wireless gateway, possibly indicating a brute-force or scanning attack?
  context: Network-level reconnaissance often involves scanning for open ports and services. An attacker attempting to find vulnerabilities in a wireless gateway may generate a large volume of connection attempts, many of which will fail. This question looks for this high-volume, low-success pattern from a single, un-inventoried source, which is a strong indicator of a targeted scan.
  answer_sources:
  - Data Sources: Zeek conn.log, Zeek notice.log, Zeek dnp3.log, Zeek modbus.log, Windows Event ID 4625, Windows Event ID 4624, Windows Event ID 5156, Wireless Gateway Authentication Logs
  - NAI: Network interfaces of ICS wireless gateways, associated authentication servers (RADIUS/TACACS+), and Domain Controllers handling ICS-related authentication.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      MONITOR connection logs to ICS gateways.
      ALERT if a single, unknown source_IP generates > 20 failed_connections (REJ, S0, RSTOS0) in < 1 minute.
      ESCALATE if a successful login from the same source_IP occurs within 10 minutes after the initial alert.
- question: Can we identify high-risk source IPs on the wireless segment by combining multiple indicators of anomalous behavior, such as connection rejections, authentication failures, and protocol errors?
  context: A sophisticated attacker may try to be stealthy, keeping any single malicious indicator below a simple threshold. This question addresses that by creating a composite risk score. By combining weighted Z-scores for several different types of bad behavior (connection failures, auth failures, protocol errors), we can detect an adversary who is anomalous across multiple dimensions, even if they aren't excessively noisy in any single one.
  answer_sources:
  - Data Sources: Zeek conn.log, Zeek notice.log, Zeek dnp3.log, Zeek modbus.log, Windows Event ID 4625, Windows Event ID 4624, Windows Event ID 5156, Wireless Gateway Authentication Logs
  - NAI: Network interfaces of ICS wireless gateways, associated authentication servers (RADIUS/TACACS+), and Domain Controllers handling ICS-related authentication.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR each source_IP:
        CALCULATE baselines for rejected connections, failed authentications, and protocol notices.
        CALCULATE a real-time composite risk score based on Z-scores of current activity against baselines.
        ALERT if the composite risk score exceeds a dynamic threshold.
- question: Are there any source IPs on the wireless network whose overall traffic patterns are highly distinct from the vast majority of normal devices?
  context: This question uses an unsupervised machine learning model (Isolation Forest) that is particularly good at identifying outliers in data. Instead of looking for specific bad patterns, it looks for any behavior that is "different." By feeding it features like port usage, connection ratios, and packet sizes, the model can flag a source IP that doesn't behave like a typical device, which could be an indicator of a compromised machine or an attacker's toolkit.
  answer_sources:
  - Data Sources: Zeek conn.log, Zeek notice.log, Zeek dnp3.log, Zeek modbus.log, Windows Event ID 4625, Windows Event ID 4624, Windows Event ID 5156, Wireless Gateway Authentication Logs
  - NAI: Network interfaces of ICS wireless gateways, associated authentication servers (RADIUS/TACACS+), and Domain Controllers handling ICS-related authentication.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      TRAIN an Isolation Forest model on historical multi-feature data per source IP.
      APPLY the model to real-time traffic data.
      ALERT if any source IP receives an anomaly score in the top percentile (e.g., top 1%).