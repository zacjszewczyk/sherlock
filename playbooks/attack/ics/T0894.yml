name: T0894: System Binary Proxy Execution
id: c1b2a3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d
description: This playbook helps investigate if an adversary is using trusted host or application binaries to execute malicious commands or payloads on ICS systems. This technique involves leveraging legitimate system binaries (e.g., rundll32.exe, mshta.exe) or trusted ICS applications to evade defenses. Indicators include process creation events for these binaries with suspicious command-line arguments (e.g., encoded strings, remote scripts), anomalous outbound network connections to untrusted destinations, or the creation of unusual parent-child process relationships, such as a trusted application spawning a command shell.
type: technique
related:
  - TA0103: Evasion
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
investigative_questions:
  - question: Are trusted ICS applications or LOLBAS binaries executing with suspicious command-line arguments indicative of malicious activity?
    context: Adversaries often use legitimate applications (Living Off the Land Binaries, or LOLBAS) to execute malicious code. This question helps detect this by searching for known indicators of compromise (IOCs) within the command-line arguments of these processes, such as calls to download remote files, encoded commands, or specific malicious strings. A positive finding is a strong indicator of proxy execution.
    answer_sources:
      - Windows Event ID 4688
      - Engineering Workstations (EWS)
      - Human-Machine Interfaces (HMIs)
      - SCADA Servers
      - Historian Servers
      - Data Gateways within the OT network
      - Jump Hosts used for remote OT access
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: SEARCH process_creation_events WHERE (parent_process IN [trusted_ics_apps, lolbas_binaries]) AND command_line CONTAINS [malicious_strings, b64_regex, script_engine_calls]
  - question: Are trusted processes exhibiting statistically anomalous command-line argument lengths or entropy values compared to their established baseline?
    context: Malicious commands executed via proxy are often longer or more complex (higher entropy due to encoding/obfuscation) than benign commands. By establishing a baseline of normal command-line length and entropy for each trusted process, this question helps identify outliers that may represent malicious activity, even if no specific IOCs are present.
    answer_sources:
      - Windows Event ID 4688
      - Engineering Workstations (EWS)
      - Human-Machine Interfaces (HMIs)
      - SCADA Servers
      - Historian Servers
      - Data Gateways within the OT network
      - Jump Hosts used for remote OT access
    range: last 90 days (for new events), with a baseline established over the last 30 days
    queries:
      - search_technology: pseudocode
        query: SEARCH process_creation_events | BASELINE command_line_length, command_line_entropy by parent_process over 30d | DETECT events where length > 99_percentile OR entropy > 99_percentile
  - question: Can machine learning models classify command-line arguments from trusted processes as malicious based on learned patterns?
    context: This question moves beyond static rules and simple statistics to a more advanced, adaptive detection method. A supervised machine learning model trained on known-good and known-bad command-line arguments from the specific ICS environment can identify novel or polymorphic malicious commands that evade other detection techniques. A high-confidence malicious classification warrants immediate investigation.
    answer_sources:
      - Windows Event ID 4688
      - Engineering Workstations (EWS)
      - Human-Machine Interfaces (HMIs)
      - SCADA Servers
      - Historian Servers
      - Data Gateways within the OT network
      - Jump Hosts used for remote OT access
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: SEARCH process_creation_events | EXTRACT command_line | CLASSIFY command_line with ML_model | WHERE classification == 'malicious' AND confidence > 0.90
  - question: Are trusted ICS processes initiating network connections to unapproved destinations or using non-whitelisted protocols?
    context: In a properly segmented OT network, communication patterns for critical applications should be predictable. This question aims to detect when a trusted process, potentially hijacked by an adversary, communicates with an unauthorized IP address or uses a protocol it shouldn't. This is a high-fidelity indicator of command-and-control (C2) activity or data exfiltration.
    answer_sources:
      - Windows Event ID 4688
      - Zeek conn.log
      - Zeek dns.log
      - ICS Network Segments (e.g., Control Network, Process Network)
      - Industrial Demilitarized Zone (IDMZ)
      - SCADA Firewalls
      - Network taps at key egress/ingress points
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: JOIN process_creation_events, network_events ON process_id | WHERE process_name IN [whitelisted_apps] AND (destination_ip NOT IN [approved_ips] OR protocol NOT IN [approved_protocols]) | DEDUP process_name, destination_ip
  - question: Are trusted processes exhibiting rare or anomalous network behaviors, such as using unusual ports, protocols, TLS fingerprints, or generating high-entropy DNS queries?
    context: Adversaries may try to hide C2 traffic by using common ports but with unusual protocols or by using techniques like Domain Generation Algorithms (DGA). This question helps detect such evasions by baselining normal network behavior (ports, protocols, TLS fingerprints) and DNS query patterns for each process. Deviations, such as using a rare port or a high-entropy DNS name, are flagged as suspicious.
    answer_sources:
      - Windows Event ID 4688
      - Zeek conn.log
      - Zeek dns.log
      - Zeek ssl.log
      - ICS Network Segments (e.g., Control Network, Process Network)
      - Industrial Demilitarized Zone (IDMZ)
      - SCADA Firewalls
      - Network taps at key egress/ingress points
    range: last 90 days (for new events), with a baseline established over the last 30 days
    queries:
      - search_technology: pseudocode
        query: SEARCH network_events | BASELINE frequency(port), frequency(protocol), ja3 by process_name over 30d | DETECT events where frequency < 5_percentile
  - question: Can unsupervised machine learning models detect anomalous network flows originating from trusted processes based on deviations from normal behavior?
    context: This question uses machine learning to find "unknown unknowns" in network traffic. An unsupervised model learns the multi-dimensional profile of normal network connections for trusted processes. It can then flag any new connection that deviates significantly from this learned profile across features like protocol, bytes transferred, and duration, even if the connection doesn't violate a specific rule.
    answer_sources:
      - Windows Event ID 4688
      - Zeek conn.log
      - ICS Network Segments (e.g., Control Network, Process Network)
      - Industrial Demilitarized Zone (IDMZ)
      - SCADA Firewalls
      - Network taps at key egress/ingress points
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: SEARCH network_events | EXTRACT features (protocol, port, bytes, duration) | SCORE with IsolationForest_model | WHERE anomaly_score > threshold
  - question: Are trusted ICS applications or critical system processes spawning child processes that are not on the established whitelist of legitimate parent-child relationships?
    context: Process execution flow in stable ICS environments is highly predictable. A trusted HMI application, for example, should not be spawning a PowerShell terminal. This question leverages a strict whitelist of known-good parent-child process pairs to detect any deviation, which is a very strong signal of compromise.
    answer_sources:
      - Windows Event ID 4688
      - Engineering Workstations (EWS)
      - Human-Machine Interfaces (HMIs)
      - SCADA Servers
      - Historian Servers
      - Jump Hosts
      - Domain Controllers within the OT network
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: SEARCH process_creation_events | WHERE (parent_process, child_process) NOT IN [whitelisted_pairs]
  - question: Are there instances of new or statistically rare parent-child process relationships involving trusted processes?
    context: While a strict whitelist is ideal, it can be difficult to maintain. This question provides an alternative by using statistical analysis. It identifies parent-child process pairings that have either never been seen before or are extremely rare in the environment. This can effectively detect an adversary's attempt to use a legitimate but uncommon execution chain to remain undetected.
    answer_sources:
      - Windows Event ID 4688
      - Engineering Workstations (EWS)
      - Human-Machine Interfaces (HMIs)
      - SCADA Servers
      - Historian Servers
      - Jump Hosts
      - Domain Controllers within the OT network
    range: last 90 days (for new events), with a baseline established over the last 60 days
    queries:
      - search_technology: pseudocode
        query: SEARCH process_creation_events | BASELINE frequency(parent_process, child_process) over 60d | DETECT events where frequency < 1_percentile OR pair is new
  - question: Can graph-based analysis identify anomalous process execution chains originating from trusted binaries, indicating deviations from normal process creation structures?
    context: This question takes a holistic view of process activity, modeling all parent-child relationships as a large graph. This allows detection of more complex attack patterns, such as an unusually long chain of process creations or a trusted process spawning a type of process it has never parented before, even if each individual link in the chain seems plausible. It helps uncover the broader structure of an intrusion.
    answer_sources:
      - Windows Event ID 4688
      - Engineering Workstations (EWS)
      - Human-Machine Interfaces (HMIs)
      - SCADA Servers
      - Historian Servers
      - Jump Hosts
      - Domain Controllers within the OT network
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: SEARCH process_creation_events | BUILD process_graph | SCORE new_edges with GraphSAGE_model | WHERE anomaly_score > threshold