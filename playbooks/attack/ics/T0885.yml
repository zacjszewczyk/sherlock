name: "T0885: Commonly Used Port"
id: "a7d8c6b5-e4f3-4a2b-9c8d-7f6e5d4c3b2a"
description: |
  Investigates whether an adversary is using a commonly used ICS or IT port for Command and Control. This is identified by observing several indicators: 1) Protocol masquerading, where the identified application protocol does not match the expected protocol for a given port. 2) Outbound connections from critical ICS assets to unauthorized external IP addresses over common ports. 3) Behavioral anomalies in network connections, such as unusual duration, data volume, or high payload entropy compared to baselines. 4) Periodic, low-volume outbound connections from non-browser processes, which is characteristic of C2 beaconing.
type: "technique"
related:
  - "TA0101: Command And Control"
contributors:
  - "Zachary Szewczyk"
  - "Ask Sage"
created: "2025-10-01"
modified: "2025-10-01"
version: 1.0
tags: "none"
questions:
  - question: "Are there network connections on common ICS/IT ports where the identified application protocol does not match the expected protocol?"
    context: |
      This question seeks to identify potential protocol masquerading, a common C2 technique. Adversaries may tunnel malicious traffic over well-known ports like TCP/502 (Modbus), TCP/443 (HTTPS), or UDP/53 (DNS) to blend in with normal network activity and bypass firewall rules. Detecting a mismatch between the port and the actual protocol (e.g., non-DNS traffic on port 53) is a strong indicator of anomalous or malicious behavior that requires immediate triage.
    answer_sources:
      - "Zeek conn.log"
      - "Network sensors monitoring the IT/OT boundary, ICS DMZ, and internal ICS network segments (Purdue Model Levels 1-3)."
    range: "last 90 days"
    queries: "SEARCH Zeek conn.log WHERE (destination_port = 502 AND service != 'modbus') OR (destination_port = 443 AND service != 'ssl') OR (destination_port = 53 AND service != 'dns')"
  - question: "Has any specific source IP shown a statistically significant increase in protocol mismatch events recently?"
    context: |
      While a single protocol mismatch can be an indicator, a sudden increase in these events from a single host is a much stronger signal of a potential compromise or active C2 channel. This question aims to move beyond simple detection to identify hosts that are persistently or increasingly engaging in this suspicious behavior by comparing their current activity against their own historical baseline.
    answer_sources:
      - "Zeek conn.log"
      - "Network sensors monitoring the IT/OT boundary, ICS DMZ, and internal ICS network segments (Purdue Model Levels 1-3)."
    range: "last 90 days"
    queries: "FOR each source_ip with protocol mismatches: CALCULATE daily_count over 30 days. CALCULATE 95th_percentile of daily_counts. ALERT if today's count > 95th_percentile."
  - question: "Can a machine learning model identify network connections that are highly likely to be malicious protocol mismatches?"
    context: |
      This question leverages a supervised machine learning model to automate the classification of protocol mismatches. By training on historical data with known benign and malicious examples, the model can learn complex patterns beyond simple port-service rules. It can identify high-confidence malicious connections for priority investigation and help analysts understand the key features (e.g., duration, byte counts) that contribute to a malicious classification.
    answer_sources:
      - "Zeek conn.log"
      - "Network sensors monitoring the IT/OT boundary, ICS DMZ, and internal ICS network segments (Purdue Model Levels 1-3)."
    range: "last 90 days"
    queries: "TRAIN Random Forest model on labeled conn.log data with features [proto, port, service, duration, bytes, etc.]. PREDICT new connections as 'benign' or 'malicious'. REVIEW high-confidence predictions."
  - question: "Are any critical ICS assets making outbound connections to unauthorized external IP addresses, and which processes are initiating them?"
    context: |
      This question is critical for detecting potential C2 from high-value assets. Critical ICS assets (like PLCs, EWS, HMIs) typically have very predictable network behavior and should not be initiating connections to arbitrary external IPs. By correlating network logs with host-level process creation and network event logs, an analyst can pinpoint the exact unauthorized application responsible for the suspicious communication, providing a direct lead for incident response.
    answer_sources:
      - "Zeek conn.log"
      - "Windows Event ID 5156"
      - "Windows Event ID 4688"
      - "Critical ICS assets including Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), and controllers on ICS network Levels 1 (Basic Control) and 2 (Supervisory Control)."
    range: "last 90 days"
    queries: "SEARCH Zeek conn.log WHERE source_ip IN critical_asset_watchlist AND destination_ip is external AND NOT IN whitelist. PIVOT to Windows Event 5156 on source_ip at same time to find process_name. ALERT if process_name NOT IN application_whitelist."
  - question: "Is any critical ICS asset exhibiting an abnormal increase in the volume or frequency of its outbound connections to external IPs?"
    context: |
      This question aims to detect deviations from normal behavior for critical assets. Even if some external communication is expected, a sudden, statistically significant spike in connection counts or data volume can indicate a new C2 channel, data exfiltration, or a change in adversary activity. Using a rolling baseline with standard deviations helps to dynamically define 'normal' for each asset and flag meaningful anomalies.
    answer_sources:
      - "Zeek conn.log"
      - "Windows Event ID 5156"
      - "Windows Event ID 4688"
      - "Critical ICS assets including Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), and controllers on ICS network Levels 1 (Basic Control) and 2 (Supervisory Control)."
    range: "last 90 days"
    queries: "FOR each critical_asset: CALCULATE 14-day moving_average and std_dev of daily_connection_count and daily_data_volume. ALERT if today's metrics > (moving_average + 3 * std_dev)."
  - question: "Can we use unsupervised machine learning to automatically identify outlier connections from critical ICS assets that do not fit normal patterns?"
    context: |
      This question uses an unsupervised approach to find the 'unknown unknowns'. Instead of defining what is bad, a density-based clustering algorithm like HDBSCAN learns what is 'normal' by grouping the repetitive, day-to-day operational connections into dense clusters. Any connection that does not fit into these clusters is flagged as an outlier or noise. These outliers are, by definition, anomalous and represent prime candidates for investigation as they deviate from established communication patterns.
    answer_sources:
      - "Zeek conn.log"
      - "Windows Event ID 5156"
      - "Windows Event ID 4688"
      - "Critical ICS assets including Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), and controllers on ICS network Levels 1 (Basic Control) and 2 (Supervisory Control)."
    range: "last 90 days"
    queries: "APPLY HDBSCAN clustering to critical asset connection data using features [dest_ip, dest_port, duration, bytes]. INVESTIGATE all connections classified as noise/outliers."
  - question: "Are there signs of protocol abuse, such as DNS tunneling or non-standard SSL/TLS certificates, on common IT/OT ports?"
    context: |
      This question focuses on detecting specific, known techniques of C2 tunneling within common protocols. For DNS, adversaries may hide data in long query names or TXT records. For SSL/TLS, they often use self-signed certificates or custom clients that produce unique JA3/JA3S fingerprints. Searching for these specific artifacts provides a high-fidelity way to uncover covert communication channels that might otherwise appear as legitimate DNS or HTTPS traffic.
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Zeek files.log"
      - "Zeek ssl.log"
      - "Network sensors at the ICS DMZ, core network switches, and DNS servers within the Purdue Model Levels 2 and 3."
    range: "last 90 days"
    queries: "SEARCH Zeek dns.log WHERE query_length > 255 OR (query_type = 'TXT' AND query contains encoded data). SEARCH Zeek ssl.log WHERE certificate is self-signed OR ja3_hash NOT IN baseline."
  - question: "Are any established communication flows exhibiting behavioral anomalies in terms of duration, data volume, or payload entropy?"
    context: |
      This question aims to detect changes within seemingly normal communication channels. An adversary might hijack a legitimate, established connection for C2. By baselining key metrics for every unique 5-tuple (source/dest IP, source/dest port, protocol), we can detect when a specific flow starts behaving differently. A sudden increase in duration, a change in the data transfer ratio, or higher payload entropy can signal that the nature of the communication has changed, warranting investigation.
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Zeek files.log"
      - "Zeek ssl.log"
      - "Network sensors at the ICS DMZ, core network switches, and DNS servers within the Purdue Model Levels 2 and 3."
    range: "last 90 days"
    queries: "FOR each unique 5-tuple flow: CALCULATE 30-day baseline for duration, byte counts, and payload entropy. ALERT if a new connection's metrics > (baseline_mean + 3 * std_dev)."
  - question: "Is the overall traffic pattern for critical OT ports deviating from the learned 'normal' operational rhythm?"
    context: |
      This question takes a macro view by analyzing the collective behavior of traffic on critical OT ports. Industrial processes often have a predictable, cyclical rhythm. A time-series model like an LSTM Autoencoder can learn this complex temporal pattern. When the model fails to accurately reconstruct the observed traffic (resulting in a high reconstruction error), it signifies a major deviation from the norm. This could indicate a widespread issue, a coordinated C2 event, or another significant disruption to the operational environment.
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Zeek files.log"
      - "Zeek ssl.log"
      - "Network sensors at the ICS DMZ, core network switches, and DNS servers within the Purdue Model Levels 2 and 3."
    range: "last 90 days"
    queries: "TRAIN LSTM Autoencoder on time-series data (bytes/min, conns/min) for critical OT ports. MONITOR real-time traffic. ALERT on time windows with high reconstruction error."
  - question: "Is an unauthorized, non-browser process on an ICS endpoint making outbound web connections to external IPs?"
    context: |
      This question seeks to identify C2 beaconing that attempts to masquerade as legitimate web traffic. A key indicator is when a process that is not a web browser (or on an approved application whitelist) starts making connections over ports 80 or 443. By correlating host-level process logs (4688) with network event logs (5156) and then validating with network sensor data (Zeek), an analyst can build a complete picture from process creation to external communication and check the destination against threat intelligence.
    answer_sources:
      - "Windows Event ID 4688"
      - "Windows Event ID 5156"
      - "Zeek conn.log"
      - "Windows-based endpoints in the ICS environment, including Engineering Workstations (EWS), HMIs, and data historians located at Purdue Model Levels 2 and 3."
    range: "last 90 days"
    queries: "SEARCH Windows Event 4688 for process_name NOT IN whitelist. For that process_id, SEARCH Windows Event 5156 for external connections on port 80/443. VALIDATE connection in Zeek conn.log and check destination_ip against threat intel."
  - question: "Are there any hosts exhibiting periodic, 'heartbeat'-like network connections characteristic of C2 beaconing?"
    context: |
      This question attempts to identify C2 beaconing purely from network traffic patterns. Malware often communicates with its C2 server on a regular schedule (a 'heartbeat'). This results in connections to the same destination that are spaced at very regular time intervals. By grouping connections and calculating the standard deviation of the time between them, we can find this regularity. Combining this with other indicators like low data volume and a minimum number of connections helps to filter out noise and identify strong candidates for C2 beaconing.
    answer_sources:
      - "Windows Event ID 4688"
      - "Windows Event ID 5156"
      - "Zeek conn.log"
      - "Windows-based endpoints in the ICS environment, including Engineering Workstations (EWS), HMIs, and data historians located at Purdue Model Levels 2 and 3."
    range: "last 90 days"
    queries: "GROUP Zeek conn.log by 4-tuple. CALCULATE time deltas between connections in each group. ALERT if std_dev of time deltas is low AND connection count > 5 AND data size is small."
  - question: "Can a machine learning model be used to automatically score and identify network sessions that are highly probable C2 beaconing?"
    context: |
      This question applies supervised machine learning to the complex problem of distinguishing malicious C2 beaconing from benign, periodic application traffic. By engineering features that capture the statistical properties of a communication session (e.g., timing regularity, data size consistency, destination entropy), a model like Gradient Boosting can be trained to recognize the subtle signatures of beaconing. This automates the detection process and allows analysts to focus on high-probability alerts generated by the model.
    answer_sources:
      - "Windows Event ID 4688"
      - "Windows Event ID 5156"
      - "Zeek conn.log"
      - "Windows-based endpoints in the ICS environment, including Engineering Workstations (EWS), HMIs, and data historians located at Purdue Model Levels 2 and 3."
    range: "last 90 days"
    queries: "TRAIN Gradient Boosting model on sessionized data with features [time_delta_stddev, packet_size_variance, etc.]. PREDICT new sessions as 'benign' or 'beaconing'. ALERT on high-probability beaconing."