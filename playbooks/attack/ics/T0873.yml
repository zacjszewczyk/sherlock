name: T0873: Project File Infection
id: a8c2b1e9-d4f3-4e6a-b7c1-9f0d2a5b8e4f
description: This playbook helps investigate whether an adversary is attempting to achieve persistence by modifying Industrial Control System (ICS) project files. This can manifest as anomalous file modification events (writes, creates, deletes) on engineering workstations or file servers targeting specific project file types (.ACD, .S7P, etc.). It can also be observed through unusual network connections to PLC engineering ports from unauthorized sources or with abnormal data volumes. A key indicator is the sequence of a PLC mode change (e.g., RUN to PROGRAM) followed immediately by a high-volume data transfer, which is a strong sign of a project file being downloaded to the controller.
type: technique
related:
  - TA0110: Persistence
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Are unauthorized users modifying ICS project files or are modifications occurring outside of scheduled maintenance windows?
    context: This question aims to detect blatant policy violations. Modifications to critical ICS project files should only be performed by authorized engineering personnel during planned maintenance periods. This query identifies activity that breaks these rules by checking if the user is in the authorized group and if the event time falls within a known maintenance window. It also correlates with network logs to ensure the activity originates from an approved Engineering Workstation (EWS), providing a multi-faceted check for unauthorized access.
    answer_sources:
      - Windows Event ID 4663
      - Windows Event ID 4656
      - Windows Event ID 5145
      - Sysmon Event ID 11
      - Zeek smb_files.log
      - ICS Project File Shares (e.g., dedicated SMB shares for engineering files) and Engineering Workstations (EWS) within the Corporate IT, DMZ, or Process Control Network (PCN).
    range: last 90 days
    queries:
      - SIEM Pseudocode: FILTER file audit logs (WinEvent 4663, Sysmon 11) for ICS file extensions. ALERT if (user NOT in 'Authorized_ICS_Engineers' group) OR (timestamp NOT in maintenance window). CORRELATE with network share logs (WinEvent 5145) to verify source is an approved EWS.
  - question: Is an authorized user exhibiting anomalous file access behavior, such as accessing an unusually high number of project files or accessing files from disparate project directories?
    context: Even authorized users can be compromised or act maliciously. This question seeks to identify behavioral outliers. It establishes a personal baseline for each user's normal activity, flagging deviations like a sudden spike in the number of unique files accessed. It also analyzes the diversity of project folders a user accesses over time (using Shannon entropy), as a sudden increase could indicate reconnaissance or unauthorized data staging across different projects.
    answer_sources:
      - Windows Event ID 4663
      - Windows Event ID 4656
      - Windows Event ID 5145
      - Sysmon Event ID 11
      - Zeek smb_files.log
      - ICS Project File Shares (e.g., dedicated SMB shares for engineering files) and Engineering Workstations (EWS) within the Corporate IT, DMZ, or Process Control Network (PCN).
    range: last 90 days
    queries:
      - Baseline Pseudocode: FOR each user, calculate 30-day baseline (mean, std dev) of unique project files accessed per hour. ALERT if hourly access > 3 std dev from mean. CALCULATE weekly Shannon entropy of parent folder paths. ALERT on sharp increase from 4-week average.
  - question: Can machine learning identify statistically rare and potentially malicious file modification events that evade simpler rule-based detection?
    context: This question leverages an unsupervised machine learning model (Isolation Forest) to find 'unknown unknowns'. The model learns what constitutes normal engineering activity by analyzing features like the user, source host, process, parent process, time of day, and file type. It can then flag events that are statistically rare combinations of these features, such as a project file being modified by 'powershell.exe' instead of 'Studio5000.exe', or access from an unusual host at 3 AM. This helps detect novel or sophisticated attack patterns.
    answer_sources:
      - Windows Event ID 4663
      - Windows Event ID 4656
      - Windows Event ID 5145
      - Sysmon Event ID 11
      - Zeek smb_files.log
      - ICS Project File Shares (e.g., dedicated SMB shares for engineering files) and Engineering Workstations (EWS) within the Corporate IT, DMZ, or Process Control Network (PCN).
    range: last 90 days
    queries:
      - ML Pseudocode: TRAIN Isolation Forest model on 90 days of normal file modification logs (features: user, host, process, parent process, time, file extension). SCORE new events in real-time. ALERT on events with anomaly scores in the top 1% percentile.
  - question: Are unauthorized hosts connecting to PLC engineering ports, or are authorized hosts using unexpected processes for these connections?
    context: This question focuses on validating the source of engineering connections to PLCs. It first checks for a fundamental security violation: any connection to a sensitive PLC engineering port from a host that is not an explicitly authorized Engineering Workstation (EWS). For connections that do originate from an authorized EWS, it performs a deeper check by correlating network data with host logs to ensure the process initiating the connection is approved engineering software (e.g., 'TIA_Portal.exe') and not a generic or potentially malicious tool like 'powershell.exe'.
    answer_sources:
      - Zeek conn.log
      - Windows Event ID 4688
      - Windows Event ID 5156
      - Network segments within the ICS DMZ (Level 3.5) and Process Control Network (Levels 2/1), and the Engineering Workstations that access them.
    range: last 90 days
    queries:
      - SIEM Pseudocode: ON Zeek conn.log to PLC engineering port, ALERT if source IP not in 'Authorized_EWS' group. IF source is authorized, CORRELATE with host logs (WinEvent 5156, 4688) to ensure connecting process is approved engineering software.
  - question: Are there new, never-before-seen connections to PLCs, or are existing connections exhibiting unusually high data volumes or durations indicative of a project download?
    context: This question aims to detect anomalies in network traffic patterns to PLCs. It first identifies 'first-time talker' behavior, which is any new communication pair (source, destination, port) that has not been seen in the last 30 days. For established, legitimate communication pairs, it baselines the normal data volume and connection duration. An alert is generated if a new connection dramatically exceeds these historical norms (e.g., surpasses the 99th percentile), which could signal a large file transfer like a project download rather than routine operational communication.
    answer_sources:
      - Zeek conn.log
      - Windows Event ID 4688
      - Windows Event ID 5156
      - Network segments within the ICS DMZ (Level 3.5) and Process Control Network (Levels 2/1), and the Engineering Workstations that access them.
    range: last 90 days
    queries:
      - Baseline Pseudocode: BASELINE 30 days of (source, destination, port) tuples to PLCs. ALERT on any new tuple ('first-time talker'). FOR existing tuples, baseline 'orig_bytes' and 'duration'. ALERT if a new connection exceeds the 99th percentile for its specific baseline.
  - question: Can machine learning identify anomalous PLC network connections that don't fit into normal patterns of activity?
    context: This question applies an unsupervised clustering algorithm (DBSCAN) to group routine network connections into clusters of 'normal' behavior. The model groups connections based on features like duration, data volume, service type, and time. Connections that are frequent, short, and involve low data transfer (like status polling) will form dense clusters. Any connection that does not fit into a cluster is labeled as 'noise' or an outlier. These outliers, by definition, represent anomalous activity—such as a high-volume, long-duration session typical of a project download—and should be prioritized for investigation.
    answer_sources:
      - Zeek conn.log
      - Windows Event ID 4688
      - Windows Event ID 5156
      - Network segments within the ICS DMZ (Level 3.5) and Process Control Network (Levels 2/1), and the Engineering Workstations that access them.
    range: last 90 days
    queries:
      - ML Pseudocode: APPLY DBSCAN clustering on PLC connection logs (features: duration, bytes, service, time). INVESTIGATE connections identified as noise/outliers by the model, as they represent anomalous sessions.
  - question: Has a PLC mode change (e.g., from RUN to PROGRAM) been immediately followed by a large data transfer to that same PLC?
    context: This question looks for a very specific and high-confidence attack sequence: 'change mode, then write'. An adversary must typically switch a PLC from RUN mode to PROGRAM or REMOTE mode before they can download a new or modified project file. This stateful rule detects this mode change and then watches for a subsequent high-volume data transfer to the same PLC within a short time window (e.g., 5 minutes). The combination of these two events is a strong indicator that a project file infection is actively occurring.
    answer_sources:
      - Zeek conn.log
      - Zeek s7comm.log
      - Zeek enip.log
      - Zeek dnp3.log
      - Zeek modbus.log
      - Process Control Network (Level 2/1) segments where PLCs and other field controllers reside and network traffic can be monitored via a TAP or SPAN port.
    range: last 90 days
    queries:
      - Stateful SIEM Pseudocode: TRIGGER on PLC mode change event (e.g., s7comm 'stop'). WATCH for 5 minutes for a large connection ('orig_bytes' > threshold) to the same PLC. ALERT if both conditions are met.
  - question: Is a PLC experiencing an anomalously high frequency of 'write' commands that also correlates with a large data transfer?
    context: This question provides another way to detect a project download by correlating two distinct anomalies. It establishes two baselines for each PLC: the normal frequency of write-type commands (e.g., 'write_tag') and the normal size of data transfers to it. An alert is generated only when both anomalies occur together—an hourly count of write functions that exceeds its statistical baseline AND a corresponding network connection with a data volume that exceeds its historical 95th percentile. This correlation reduces false positives from either event happening in isolation.
    answer_sources:
      - Zeek conn.log
      - Zeek s7comm.log
      - Zeek enip.log
      - Zeek dnp3.log
      - Zeek modbus.log
      - Process Control Network (Level 2/1) segments where PLCs and other field controllers reside and network traffic can be monitored via a TAP or SPAN port.
    range: last 90 days
    queries:
      - Baseline Pseudocode: FOR each PLC, baseline hourly 'write' command frequency and 95th percentile of connection 'orig_bytes'. ALERT if hourly write count > 3 std dev from baseline AND a corresponding connection's byte count > 95th percentile.
  - question: Can a sequence-aware machine learning model detect an improbable series of events related to a PLC that indicates a project file download?
    context: This is the most advanced question, using a sequence-based model (like an HMM or LSTM) to understand the *order* of events. The model is trained on streams of abstracted events for each PLC (e.g., 'mode change', 'function call', 'large connection'). It learns the normal probability of transitioning from one event type to another. An attack sequence, such as 'mode change' -> 'large connection', which is rare in normal operations, would be assigned a very low probability by the model. This allows for the detection of sophisticated, multi-step attack chains that might otherwise appear as disconnected, low-priority events.
    answer_sources:
      - Zeek conn.log
      - Zeek s7comm.log
      - Zeek enip.log
      - Zeek dnp3.log
      - Zeek modbus.log
      - Process Control Network (Level 2/1) segments where PLCs and other field controllers reside and network traffic can be monitored via a TAP or SPAN port.
    range: last 90 days
    queries:
      - ML Pseudocode: TRAIN a sequence model (HMM/LSTM) on streams of abstracted PLC events (mode change, function call, connection size). SCORE new event sequences in real-time. ALERT on sequences with a very low probability score.