name: "T0895: Autorun Image"
id: "f47ac10b-58cc-4372-a567-0e02b2c3d479"
description: "This playbook helps identify if an adversary has leveraged Autorun functionality on removable media or mounted virtual disk images to execute malicious code on an Industrial Control System (ICS) environment. The investigation focuses on detecting processes created from removable media (like USB drives) or newly mounted virtual disks within a short time frame of the mount event. It looks for corroborating evidence such as the process executable matching a known threat, being unsigned, or having an unusually high filename entropy. Further indicators include subsequent anomalous network activity from the host or Virtual Machine (VM), like connections to blocklisted IPs, queries to new or low-reputation domains, or unusual data egress volumes."
type: "technique"
related:
  - "TA0104: Execution"
contributors:
  - "Zachary Szewczyk"
  - "AI Assistant"
created: "2025-10-01"
modified: "2025-10-01"
version: 1.0
tags: "none"
questions:
  - question: "Has a process been executed from a removable device shortly after it was mounted, where the executable is a known threat or is unsigned and associated with an 'autorun.inf' file?"
    context: "This question addresses a classic adversary technique of using removable media's Autorun/AutoPlay functionality to gain initial execution. By correlating a device insertion event with a subsequent process creation from that same device, analysts can detect this behavior with high confidence. Further checks for known malicious file hashes or the combination of an unsigned executable and an 'autorun.inf' file help to filter out legitimate software installations and focus on high-risk events."
    answer_sources:
      - "Windows Event ID 4688"
      - "Sysmon Event ID 1"
      - "Sysmon Event ID 11"
      - "Windows System Log Event ID 12"
      - "Windows System Log Event ID 1006"
      - "Zeek conn.log"
      - "Zeek files.log"
      - "Physical USB ports on Windows-based Human-Machine Interfaces (HMIs), Engineering Workstations (EWS), data historians, and any servers within the Process Control Network (PCN) or ICS DMZ. Includes endpoints used for device programming or maintenance updates."
    range: "last 90 days"
    queries:
      - "SIEM: JOIN (device_mount_events WHERE event_id IN [12, 1006]) AND (process_creation_events WHERE event_id IN [4688, 1]) ON (hostname) WHERE process_creation_time - device_mount_time <= 30s AND process_path IS ON removable_drive. ALERT IF (process_hash IN threat_intel_feed) OR (process_is_unsigned AND autorun.inf_creation_event_exists_on_same_drive)."
  - question: "Did a process launched from removable media exhibit signs of obfuscation (high filename entropy) and subsequently generate anomalous network traffic?"
    context: "Adversaries often use randomized or nonsensical filenames for their malware to evade simple signature-based detections. Calculating the Shannon entropy of a filename provides a mathematical way to measure this randomness. A process with a highly entropic filename originating from removable media is suspicious. If this event is followed by a burst of unusual network activity, such as connections to many new destinations, it strongly indicates malicious activity like command-and-control communication or data staging."
    answer_sources:
      - "Windows Event ID 4688"
      - "Sysmon Event ID 1"
      - "Sysmon Event ID 11"
      - "Windows System Log Event ID 12"
      - "Windows System Log Event ID 1006"
      - "Zeek conn.log"
      - "Zeek files.log"
      - "Physical USB ports on Windows-based Human-Machine Interfaces (HMIs), Engineering Workstations (EWS), data historians, and any servers within the Process Control Network (PCN) or ICS DMZ. Includes endpoints used for device programming or maintenance updates."
    range: "last 90 days"
    queries:
      - "Pseudocode: FOR each process created from removable_media, CALCULATE Shannon entropy of filename. IF entropy > 98th_percentile_baseline_for_host, THEN MONITOR network connections FROM host for 5 minutes. IF count(unique destination_ip:port) > 99th_percentile_baseline, THEN ALERT."
  - question: "Can machine learning identify malicious processes originating from removable media based on a combination of execution and file characteristics?"
    context: "While rule-based detections are effective, they can be brittle. A machine learning model can learn complex, non-linear relationships between various data points to identify suspicious activity that rules might miss. By training a model on features like the parent process, command-line length, file path entropy, and whether the file is signed, it can assign a probabilistic 'malicious' score to new process creations, providing a more nuanced and potentially more robust detection capability for activity originating from removable media."
    answer_sources:
      - "Windows Event ID 4688"
      - "Sysmon Event ID 1"
      - "Sysmon Event ID 11"
      - "Windows System Log Event ID 12"
      - "Windows System Log Event ID 1006"
      - "Zeek conn.log"
      - "Zeek files.log"
      - "Physical USB ports on Windows-based Human-Machine Interfaces (HMIs), Engineering Workstations (EWS), data historians, and any servers within the Process Control Network (PCN) or ICS DMZ. Includes endpoints used for device programming or maintenance updates."
    range: "last 90 days"
    queries:
      - "Pseudocode: FOR each new process_creation_event, EXTRACT features (parent_process, cmd_line_length, path_entropy, is_unsigned, from_removable_media). INPUT features into pre-trained classification model. IF model_prediction_probability > 0.85, THEN ALERT."
  - question: "Was a process executed from a newly mounted virtual disk on a VM, which then connected to a known malicious IP address?"
    context: "This question targets the abuse of virtual disk images (e.g., ISO, VHD) to deliver malware into a virtualized environment, bypassing some network perimeter controls. Correlating the disk attachment event at the hypervisor level with a process creation event inside the guest VM from that new disk provides a clear line of evidence. If that new process then immediately initiates a network connection to an IP address on a threat intelligence blocklist, it is a very high-confidence indicator of compromise."
    answer_sources:
      - "Hypervisor API logs (e.g., vSphere, Hyper-V)"
      - "Windows System Log Event ID 15"
      - "Windows Event ID 4688"
      - "Sysmon Event ID 1"
      - "Sysmon Event ID 3"
      - "Sysmon Event ID 22"
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Zeek http.log"
      - "Virtualization hosts (hypervisors) managing guest VMs in the ICS DMZ or Process Control Network. Specific targets include virtualized HMIs, EWS, data historians, and domain controllers. Also includes VM templates, golden images, and network egress points monitoring traffic from the virtualization cluster."
    range: "last 90 days"
    queries:
      - "SIEM: JOIN (hypervisor_vdisk_attach_event) AND (guest_os_disk_init_event WHERE event_id=15) AND (guest_process_creation_event WHERE event_id=1) ON (vm_id, time) WHERE time_delta <= 60s. IF created_process initiates network_connection TO destination_ip IN threat_intel_blocklist, THEN ALERT."
  - question: "Following execution from a new virtual disk, did a process exhibit anomalous network behavior, such as querying unusual domains or exfiltrating an abnormal amount of data?"
    context: "When a direct IOC like a blocklisted IP is not present, analysts must look for behavioral anomalies. This question focuses on two key post-exploitation network indicators. First, calculating the Jaccard similarity between newly queried DNS domains and the VM's historical baseline can reveal communication with novel C2 infrastructure. A low similarity score is highly suspicious. Second, a high ratio of outbound to inbound bytes is a classic pattern of data exfiltration. Finding either of these behaviors after a process is run from a new virtual disk warrants immediate investigation."
    answer_sources:
      - "Hypervisor API logs (e.g., vSphere, Hyper-V)"
      - "Windows System Log Event ID 15"
      - "Windows Event ID 4688"
      - "Sysmon Event ID 1"
      - "Sysmon Event ID 3"
      - "Sysmon Event ID 22"
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Zeek http.log"
      - "Virtualization hosts (hypervisors) managing guest VMs in the ICS DMZ or Process Control Network. Specific targets include virtualized HMIs, EWS, data historians, and domain controllers. Also includes VM templates, golden images, and network egress points monitoring traffic from the virtualization cluster."
    range: "last 90 days"
    queries:
      - "Pseudocode: FOR each process launched from new_vdisk, ANALYZE subsequent DNS queries for 10 min. CALCULATE Jaccard_similarity(new_domains, historical_domains_for_vm). IF score < 0.10, ALERT. ADDITIONALLY, ANALYZE network_flows. IF (outbound_bytes / inbound_bytes) > 95th_percentile_for_vm, THEN ALERT."
  - question: "Can a multivariate anomaly detection model identify time windows of unusual system activity on critical VMs that coincide with a virtual disk mount event?"
    context: "This advanced analytic approach moves beyond single-event correlation to assess the overall state of a system. By feeding multiple metrics—such as process creation counts, network connection rates, and DNS query volumes—into a time-series model like an Isolation Forest, the system can learn a baseline of normal behavior. It can then flag entire time windows (e.g., one minute) that deviate significantly from this norm. Prioritizing anomalous windows that also contain a virtual disk mount event provides analysts with powerful, context-rich alerts that point to a confluence of suspicious activities."
    answer_sources:
      - "Hypervisor API logs (e.g., vSphere, Hyper-V)"
      - "Windows System Log Event ID 15"
      - "Windows Event ID 4688"
      - "Sysmon Event ID 1"
      - "Sysmon Event ID 3"
      - "Sysmon Event ID 22"
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Zeek http.log"
      - "Virtualization hosts (hypervisors) managing guest VMs in the ICS DMZ or Process Control Network. Specific targets include virtualized HMIs, EWS, data historians, and domain controllers. Also includes VM templates, golden images, and network egress points monitoring traffic from the virtualization cluster."
    range: "last 90 days"
    queries:
      - "Pseudocode: FOR critical_vms, AGGREGATE metrics (process_count, net_conn_count, bytes_sent, unique_dns_count, vdisk_mounted_flag) into 1-min windows. APPLY pre-trained anomaly detection model (e.g., Isolation Forest). IF anomaly_score IS in top 1% AND vdisk_mounted_flag IS true, THEN ALERT."