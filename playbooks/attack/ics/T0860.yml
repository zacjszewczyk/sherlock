name: 'T0860: Wireless Compromise'
id: 'f47ac10b-58cc-4372-a567-0e02b2c3d479'
description: This playbook helps determine if an adversary is attempting to gain initial access to an Industrial Control System (ICS) network through wireless compromise. It focuses on detecting unauthorized devices connecting to the wireless network, authorized devices exhibiting anomalous communication patterns (such as connecting to new destinations, using unapproved protocols, or transferring unusual data volumes), and the subsequent execution of high-risk processes on critical ICS hosts following suspicious wireless activity.
type: technique
related: 
  - 'TA0108: Initial Access'
contributors: 'Zachary Szewczyk, Ask Sage'
created: '2025-10-01'
modified: '2025-10-01'
version: 1.0
tags: none
questions:
  - question: Has a new, unauthorized device connected to the ICS wireless network?
    context: This question aims to identify potentially malicious devices gaining access to the network. An unknown MAC address connecting to a sensitive ICS wireless segment, especially if it communicates with critical devices like PLCs or HMIs, is a strong indicator of a potential breach. This check is a fundamental first step in detecting wireless compromise.
    answer_sources:
      - Zeek conn.log
      - Zeek wifi.log
      - ICS Wireless Asset Inventory
      - Wireless Access Points (WAPs) within the Process Control Network (PCN) and Manufacturing Zone, network taps or SPAN ports on wireless network infrastructure connecting to Level 1/2 devices, dedicated wireless sensor network gateways.
    range: last 90 days
    queries:
      - tech: pseudocode
        query: |
          FOR each connection in (Zeek conn.log, Zeek wifi.log)
            IF connection.mac_address NOT IN (ICS Wireless Asset Inventory)
              AND connection.target IN (Level 1/2 Devices)
            THEN ALERT 'Unauthorized MAC Address Detected'
  - question: Is a new device performing unusual service discovery or using rare communication protocols?
    context: Adversaries often perform network reconnaissance and service discovery immediately after gaining access. This question looks for two signs of this behavior: the use of statistically uncommon protocols/ports, which might indicate a custom C2 channel, and a sudden increase in the variety of services contacted (measured by Shannon entropy), which suggests scanning.
    answer_sources:
      - Zeek conn.log
      - Wireless Access Points (WAPs) within the Process Control Network (PCN) and Manufacturing Zone, network taps or SPAN ports on wireless network infrastructure connecting to Level 1/2 devices, dedicated wireless sensor network gateways.
    range: last 90 days
    queries:
      - tech: pseudocode
        query: |
          FOR each connection with unknown_mac
            CALCULATE frequency of (protocol, port) against 30-day baseline
            IF frequency < 5th percentile THEN ALERT 'Rare Protocol/Port Usage'
          CALCULATE entropy of 'service' field over 10-min windows
            IF entropy > 99th percentile of baseline THEN ALERT 'Service Discovery Spike'
  - question: Does network traffic from a new device exhibit anomalous characteristics according to an unsupervised machine learning model?
    context: This question uses an Isolation Forest model to detect subtle anomalies in network traffic that might be missed by rule-based methods. The model learns the characteristics of normal traffic (e.g., data volume, duration, protocol) and flags any connections that deviate significantly, which could represent malicious activity from a newly connected device.
    answer_sources:
      - Zeek conn.log
      - Wireless Access Points (WAPs) within the Process Control Network (PCN) and Manufacturing Zone, network taps or SPAN ports on wireless network infrastructure connecting to Level 1/2 devices, dedicated wireless sensor network gateways.
    range: last 90 days
    queries:
      - tech: pseudocode
        query: |
          TRAIN Isolation Forest model on 90-day baseline of (orig_bytes, resp_bytes, duration, proto, service)
          FOR each new network flow
            IF model.predict(flow) == 'outlier'
              AND flow involves unknown_mac
            THEN ALERT 'ML Detected Network Flow Anomaly'
  - question: Is an authorized wireless ICS device communicating with unapproved destinations or using forbidden ICS commands?
    context: Once an adversary compromises an authorized device, they may use it to pivot further into the network. This question seeks to detect such activity by enforcing a strict baseline. Any communication to a new IP address, port, or protocol, or the use of dangerous ICS function codes (like writing to a controller from a device that should only read), is a strong indicator of compromise.
    answer_sources:
      - Zeek conn.log
      - Zeek modbus.log
      - Zeek dnp3.log
      - Communication Baseline Policy
      - Process Control Network (PCN) segments where HMIs, EWS, Historian Servers, and other wireless-connected ICS field devices reside; network taps on switch uplinks for these segments; ICS protocol deep packet inspection (DPI) sensors.
    range: last 90 days
    queries:
      - tech: pseudocode
        query: |
          FOR each connection from authorized_device
            IF connection.destination NOT IN baseline
              OR connection.protocol NOT IN baseline
              OR connection.port NOT IN baseline
            THEN ALERT 'Baseline Communication Violation'
          FOR each ICS command from authorized_device
            IF command.function_code NOT IN baseline
            THEN ALERT 'Anomalous ICS Function Code'
  - question: Has an authorized wireless device shown a statistically significant change in its data volume, connection count, or destination port variety?
    context: This question uses statistical methods to find behavioral changes in authorized devices. A sudden spike in data volume or connection count (exceeding 3 standard deviations) could indicate data exfiltration or C2 activity. A rise in destination port entropy suggests the device may be scanning the network for open ports, a common reconnaissance technique.
    answer_sources:
      - Zeek conn.log
      - Process Control Network (PCN) segments where HMIs, EWS, Historian Servers, and other wireless-connected ICS field devices reside; network taps on switch uplinks for these segments; ICS protocol deep packet inspection (DPI) sensors.
    range: last 90 days
    queries:
      - tech: pseudocode
        query: |
          CALCULATE daily_data_volume and connection_count for each device
          IF daily_total > (30-day_avg + 3 * 30-day_stddev) THEN ALERT 'Statistical Anomaly in Data Volume/Connections'
          CALCULATE entropy of destination_ports over 15-min windows
          IF entropy > 99th percentile of baseline THEN ALERT 'Port Scanning Behavior Detected'
  - question: Does the daily data volume of a critical wireless ICS device deviate from its predicted normal behavior according to a time-series model?
    context: This question applies a more sophisticated time-series model (like Prophet or ARIMA) to forecast the expected data volume for a critical device. An alert is generated if the actual traffic falls significantly outside the model's prediction (99% confidence interval). This can detect both spikes (C2, exfiltration) and drops (denial of service, device failure) that simpler statistical methods might miss.
    answer_sources:
      - Zeek conn.log
      - Process Control Network (PCN) segments where HMIs, EWS, Historian Servers, and other wireless-connected ICS field devices reside; network taps on switch uplinks for these segments; ICS protocol deep packet inspection (DPI) sensors.
    range: last 90 days
    queries:
      - tech: pseudocode
        query: |
          TRAIN time-series model on 90-day baseline of daily_data_volume
          FOR each day's observed_volume
            PREDICT expected_volume_range with 99% confidence
            IF observed_volume NOT IN expected_volume_range
            THEN ALERT 'Time-Series Anomaly in Data Volume'
  - question: Has a high-risk process been executed on a critical ICS host shortly after it received an anomalous wireless connection?
    context: This question correlates network and endpoint data to link a potential wireless intrusion to subsequent malicious activity on a host. The execution of command shells (cmd.exe, powershell.exe) or scripting engines on a critical host like an HMI or EWS, immediately following a suspicious network connection, is a very strong indicator that an attacker has gained execution.
    answer_sources:
      - Windows Event ID 4688
      - Zeek conn.log
      - Windows-based HMIs, EWS, and Control Servers within the Process Control Network (PCN) and DMZ; endpoint detection and response (EDR) agents or Windows Event Forwarding (WEF) infrastructure on these hosts.
    range: last 90 days
    queries:
      - tech: pseudocode
        query: |
          ON 'Anomalous Wireless Connection' alert to host_ip
            MONITOR for 3 minutes for 'Process Creation' event on host_ip
              IF process_name IN (powershell.exe, cmd.exe, wscript.exe, cscript.exe, mshta.exe, certutil.exe)
                OR process executes from a non-standard directory (%TEMP%, %APPDATA%)
              THEN ALERT 'Correlated High-Risk Process Execution'
  - question: Is there evidence of obfuscation in the command line of a process executed on a critical ICS host?
    context: Attackers frequently obfuscate commands (e.g., using Base64 encoding in PowerShell) to evade simple signature-based detection. This question aims to detect such obfuscation by measuring the character randomness (Shannon entropy) of the command line. A command line with abnormally high entropy for a given process suggests it is likely obfuscated and malicious.
    answer_sources:
      - Windows Event ID 4688
      - Windows-based HMIs, EWS, and Control Servers within the Process Control Network (PCN) and DMZ; endpoint detection and response (EDR) agents or Windows Event Forwarding (WEF) infrastructure on these hosts.
    range: last 90 days
    queries:
      - tech: pseudocode
        query: |
          FOR each 'Process Creation' event on critical_host
            CALCULATE entropy of event.CommandLine
            GET 30-day entropy baseline for event.NewProcessName
            IF entropy > 99th percentile of baseline
            THEN ALERT 'High Entropy Command Line Detected (Probable Obfuscation)'
  - question: Has a machine learning model classified a new process creation event on an ICS host as malicious?
    context: This question uses a supervised ML model (like Random Forest) to provide a robust, multi-featured assessment of whether a process execution is malicious. The model is trained on labeled historical data and considers features like the process name, command line characteristics, and parent process information to make its classification, allowing it to detect novel or complex threats.
    answer_sources:
      - Windows Event ID 4688
      - Windows-based HMIs, EWS, and Control Servers within the Process Control Network (PCN) and DMZ; endpoint detection and response (EDR) agents or Windows Event Forwarding (WEF) infrastructure on these hosts.
    range: last 90 days
    queries:
      - tech: pseudocode
        query: |
          TRAIN Random Forest model on labeled historical 'Process Creation' events
          FOR each new 'Process Creation' event
            EXTRACT features (ProcessName, CommandLine, ParentProcess, etc.)
            IF model.predict(features) == 'malicious'
            THEN ALERT 'ML Detected Malicious Process Creation'