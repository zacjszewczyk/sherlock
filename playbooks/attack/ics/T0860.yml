name: T0860: Wireless Compromise
id: f47ac10b-58cc-4372-a567-0e02b2c3d479
description: This playbook helps determine if an adversary is attempting to gain initial access to an Industrial Control System (ICS) network via wireless compromise. It focuses on identifying previously unobserved MAC addresses on ICS wireless segments, detecting when authorized wireless devices exhibit communication patterns outside their established baseline, and correlating anomalous wireless network connections with suspicious process creation events on critical ICS hosts.
type: technique
related:
  - TA0108: Initial Access
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Are previously unobserved devices connecting to the ICS wireless network and targeting critical Level 1 or Level 2 assets?
    context: This question aims to detect the primary indicator of a wireless intrusion: an unauthorized device connecting to the network. The playbook checks for any MAC address on an ICS wireless segment that is not listed in an authorized asset inventory. An alert is triggered, especially if this new device attempts to communicate with highly sensitive assets like PLCs, RTUs, or HMIs, which could signify a direct attempt to manipulate the control process.
    answer_sources:
      - Zeek conn.log
      - Zeek wifi.log
      - ICS Wireless Asset Inventory
      - Wireless Access Points (WAPs) within the Process Control Network (PCN) and Manufacturing Zone, network taps or SPAN ports on wireless network infrastructure connecting to Level 1/2 devices, dedicated wireless sensor network gateways.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each record in (Zeek conn.log, Zeek wifi.log) on ICS wireless segments:
            EXTRACT source_mac and destination_mac
            IF source_mac NOT IN authorized_inventory OR destination_mac NOT IN authorized_inventory:
              GENERATE high_severity_alert
  - question: Is a new, unknown device on the wireless network exhibiting unusual communication patterns, such as using rare protocols or performing service discovery?
    context: After an unknown device is detected, this question helps confirm malicious intent by analyzing its behavior. Adversary tools often use uncommon protocols or perform network/service discovery scans to find targets. This query checks for statistically rare protocol and port combinations used by the new device and monitors for spikes in the Shannon entropy of network service fields, which indicates scanning or discovery activity.
    answer_sources:
      - Zeek conn.log
      - Zeek wifi.log
      - ICS Wireless Asset Inventory
      - Wireless Access Points (WAPs) within the Process Control Network (PCN) and Manufacturing Zone, network taps or SPAN ports on wireless network infrastructure connecting to Level 1/2 devices, dedicated wireless sensor network gateways.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each connection from an unknown_mac:
            CALCULATE frequency of (protocol, dest_port) against 30-day baseline
            IF frequency < 5th_percentile:
              ALERT
            CALCULATE Shannon entropy of 'service' field over 10-min window
            IF entropy > 99th_percentile of historical values:
              ALERT
  - question: Can unsupervised machine learning models detect anomalous network flows from wireless devices that might indicate a compromise?
    context: This question proposes an advanced detection method using an unsupervised learning model like an Isolation Forest. Such models can identify outliers in network traffic without being explicitly trained on what "bad" looks like. By analyzing features like data volume, connection duration, and protocol, the model can flag any network flow that deviates significantly from the established norm, providing a powerful way to catch novel or stealthy attacks.
    answer_sources:
      - Zeek conn.log
      - Zeek wifi.log
      - ICS Wireless Asset Inventory
      - Wireless Access Points (WAPs) within the Process Control Network (PCN) and Manufacturing Zone, network taps or SPAN ports on wireless network infrastructure connecting to Level 1/2 devices, dedicated wireless sensor network gateways.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          TRAIN Isolation Forest model on 90 days of normal wireless Zeek conn.log data
          (features: orig_bytes, resp_bytes, duration, proto, service)
          FOR each new network flow:
            IF model.predict(flow) == 'outlier':
              GENERATE high_priority_alert
  - question: Are authorized ICS wireless devices communicating with unapproved destinations, using non-standard protocols, or executing unauthorized ICS functions?
    context: This question addresses the scenario where an attacker compromises a legitimate, authorized device. The query enforces a strict baseline for each device, defining allowed destination IPs, ports, and protocols. It alerts on any deviation, including the use of unexpected ICS function codes (e.g., a device that should only be reading data attempting to write data), which is a strong indicator that the device is being controlled by an attacker.
    answer_sources:
      - Zeek conn.log
      - Zeek modbus.log
      - Zeek dnp3.log
      - Windows Event ID 4624
      - Communication Baseline Policy
      - Process Control Network (PCN) segments where HMIs, EWS, Historian Servers, and other wireless-connected ICS field devices reside; network taps on switch uplinks for these segments; ICS protocol deep packet inspection (DPI) sensors.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each connection from an authorized_device:
            IF connection.dest_ip NOT IN baseline.allowed_ips
            OR connection.dest_port NOT IN baseline.allowed_ports
            OR connection.protocol NOT IN baseline.allowed_protocols
            OR modbus.function_code NOT IN baseline.allowed_functions:
              ALERT
  - question: Are authorized wireless devices exhibiting statistical anomalies in their traffic volume, connection frequency, or port scanning behavior?
    context: This question uses statistical analysis to find subtle indicators of compromise on authorized devices. An attacker might use a compromised device for C2 communications, data exfiltration, or internal scanning. This query looks for significant deviations (e.g., more than 3 standard deviations from the norm) in daily data volume or connection counts and also monitors the entropy of destination ports to detect scanning behavior.
    answer_sources:
      - Zeek conn.log
      - Zeek modbus.log
      - Zeek dnp3.log
      - Windows Event ID 4624
      - Communication Baseline Policy
      - Process Control Network (PCN) segments where HMIs, EWS, Historian Servers, and other wireless-connected ICS field devices reside; network taps on switch uplinks for these segments; ICS protocol deep packet inspection (DPI) sensors.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each authorized_device:
            CALCULATE daily_data_volume and daily_connection_count
            IF daily_data_volume > (30-day_avg + 3 * 30-day_std_dev):
              ALERT
            CALCULATE Shannon entropy of destination ports over 15-min window
            IF entropy > 99th_percentile of historical scores:
              ALERT
  - question: Can time-series forecasting models detect anomalous changes in the daily data volume of critical ICS wireless devices?
    context: This question leverages a sophisticated time-series model (like ARIMA or Prophet) to detect anomalies in traffic volume. These models learn the normal patterns of a device's communication, including trends and seasonality. They can then forecast an expected range of data volume and trigger an alert if the actual observed volume falls outside this confidence interval, effectively detecting both unusual spikes (exfiltration) and drops (denial of service).
    answer_sources:
      - Zeek conn.log
      - Zeek modbus.log
      - Zeek dnp3.log
      - Windows Event ID 4624
      - Communication Baseline Policy
      - Process Control Network (PCN) segments where HMIs, EWS, Historian Servers, and other wireless-connected ICS field devices reside; network taps on switch uplinks for these segments; ICS protocol deep packet inspection (DPI) sensors.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          TRAIN time-series model (ARIMA/Prophet) on 90 days of daily_data_volume for each critical_device
          FOR each new day's data_volume:
            PREDICT confidence_interval
            IF actual_volume NOT IN confidence_interval:
              ALERT
  - question: Is there evidence of malicious process execution on a critical ICS host shortly after an anomalous wireless connection to that same host?
    context: This question is critical for connecting a network intrusion to host-level impact. It creates a correlation rule that looks for a suspicious process creation event (Windows Event ID 4688) on a host within a few minutes of an anomalous wireless network event targeting that same host. The presence of command shells, scripting engines, or tools running from unusual locations strongly indicates successful exploitation.
    answer_sources:
      - Windows Event ID 4688
      - Zeek conn.log
      - Windows-based HMIs, EWS, and Control Servers within the Process Control Network (PCN) and DMZ; endpoint detection and response (EDR) agents or Windows Event Forwarding (WEF) infrastructure on these hosts.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          ON wireless_anomaly_alert(target_host):
            MONITOR for Event ID 4688 on target_host for 3 minutes
            IF event.NewProcessName IN (powershell.exe, cmd.exe, etc.)
            AND event.ParentProcessName IS unexpected:
              GENERATE correlated_high_severity_alert
  - question: Are command-line arguments for processes on critical ICS hosts being obfuscated, suggesting malicious intent?
    context: Attackers frequently obfuscate commands to evade detection. This query analyzes the command line of executed processes (from Event ID 4688) for high Shannon entropy, which indicates a high degree of randomness typical of encoded or obfuscated commands. An unusually high entropy score for the command line of a process like 'powershell.exe' is a strong signal of malicious activity.
    answer_sources:
      - Windows Event ID 4688
      - Zeek conn.log
      - Windows-based HMIs, EWS, and Control Servers within the Process Control Network (PCN) and DMZ; endpoint detection and response (EDR) agents or Windows Event Forwarding (WEF) infrastructure on these hosts.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each Event ID 4688 on critical_host:
            CALCULATE Shannon entropy of event.CommandLine
            IF event.NewProcessName IN (powershell.exe, etc.)
            AND entropy > 99th_percentile of historical entropy for that process:
              ALERT
  - question: Can a machine learning model automatically classify process creation events on ICS hosts as malicious, especially when correlated with wireless anomalies?
    context: This proposes using a supervised machine learning model, like a Random Forest, to automatically classify process creation events as benign or malicious. By training the model on labeled historical data and using features from the process event (e.g., process name, command line length, parent process), it can provide a highly accurate, automated verdict, which becomes even more powerful when correlated with network-level alerts.
    answer_sources:
      - Windows Event ID 4688
      - Zeek conn.log
      - Windows-based HMIs, EWS, and Control Servers within the Process Control Network (PCN) and DMZ; endpoint detection and response (EDR) agents or Windows Event Forwarding (WEF) infrastructure on these hosts.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          TRAIN Random Forest classifier on labeled Event ID 4688 data
          (features: NewProcessName, CommandLine attributes, ParentProcessName)
          FOR each new Event ID 4688:
            IF model.predict(event) == 'malicious':
              GENERATE alert