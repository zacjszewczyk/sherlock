name: T0847: Replication Through Removable Media
id: 5e9b7f8c-1d3a-4b6e-9f0c-2a1b8d7e4f6a
description: |
  This playbook helps determine if an adversary is attempting to gain initial access to an Industrial Control System (ICS) network by introducing malware via removable media. It focuses on detecting suspicious process executions originating from removable drives, subsequent anomalous network activity, and the creation of persistence mechanisms. Key indicators include processes not on software allowlists, executions with high command-line entropy, connections to malicious or non-standard external destinations, and the creation of new services, scheduled tasks, or autorun keys that deviate from established baselines.
type: technique
related:
- TA0108: Initial Access
contributors:
- Zachary Szewczyk, Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
investigative_questions:
- question: Is a process being executed from a removable media volume that is not on an approved software allowlist or initiated by an unexpected parent process?
  context: |
    Adversaries frequently use removable media to introduce malware into air-gapped or segmented networks like ICS environments. This question aims to detect the initial execution of an unauthorized program. A process hash not found on a pre-approved allowlist for that specific asset type is a strong indicator of unauthorized software. Additionally, legitimate processes are typically launched by expected parent processes (like 'explorer.exe' for user-initiated actions). An anomalous parent could indicate a more sophisticated attack, such as process injection from an already compromised process.
  answer_sources:
  - Windows Event ID 4688
  - Sysmon Event ID 1
  - Engineering Workstations (EWS)
  - Human-Machine Interfaces (HMIs)
  - Historian Servers
  - Operator Consoles
  - Data Gateways
  - SCADA Servers
  - Portable technician laptops
  - any Windows-based ICS endpoint with USB/removable media access.
  range: last 90 days
  queries:
  - technology: SIEM
    query: |
      SEARCH process_creation_events (Sysmon_ID=1 OR WinEvent_ID=4688) 
      WHERE process_path matches regex '^[D-Z]:\\.*' 
      | LOOKUP process_hash against asset_specific_allowlist 
      | IF hash not in allowlist OR parent_process NOT IN ('explorer.exe', 'known_good_initiator') THEN ALERT high_severity
- question: Is a process launched from removable media using command line arguments with unusually high entropy, suggesting obfuscation?
  context: |
    To evade detection, attackers often encode or obfuscate their commands, particularly those executed via PowerShell or command prompt. These obfuscated commands result in a command-line string with high Shannon entropy (a measure of randomness) compared to normal, human-readable commands. By establishing a baseline of normal entropy scores for processes on an asset and alerting on significant deviations, this question helps detect suspicious command-line activity that might otherwise be missed by signature-based tools.
  answer_sources:
  - Windows Event ID 4688
  - Sysmon Event ID 1
  - Engineering Workstations (EWS)
  - Human-Machine Interfaces (HMIs)
  - Historian Servers
  - Operator Consoles
  - Data Gateways
  - SCADA Servers
  - Portable technician laptops
  - any Windows-based ICS endpoint with USB/removable media access.
  range: last 90 days
  queries:
  - technology: SIEM / Scripting
    query: |
      ON process_creation_from_removable_media 
      | CALCULATE shannon_entropy(command_line) 
      | LOOKUP historical_entropy_baseline for asset 
      | IF current_entropy > 95th_percentile_baseline THEN ALERT
- question: Does a machine learning model classify a process execution from removable media as malicious based on its characteristics?
  context: |
    This question leverages a machine learning classifier (like Random Forest or Gradient Boosting) to provide a more sophisticated, multi-faceted analysis of a process execution. The model can learn complex, non-linear relationships between various features (e.g., process name randomness, command line length, parent process, binary signature status) to determine the likelihood of malice. A high probability score from the model serves as a high-confidence alert that a process is likely malicious, even if it doesn't trigger any single, simple rule.
  answer_sources:
  - Sysmon Event ID 1
  - Engineering Workstations (EWS)
  - Human-Machine Interfaces (HMIs)
  - Historian Servers
  - Operator Consoles
  - Data Gateways
  - SCADA Servers
  - Portable technician laptops
  - any Windows-based ICS endpoint with USB/removable media access.
  range: last 90 days
  queries:
  - technology: Machine Learning / EDR
    query: |
      ON Sysmon_ID=1 from removable_media 
      | EXTRACT features (ProcessName_entropy, CommandLine_length, ParentProcessName, SignatureStatus, etc.) 
      | SCORE with pre-trained_classifier_model 
      | IF malicious_probability > 0.90 THEN ALERT
- question: Following a removable media execution, did the host initiate a network connection to a known malicious destination or exhibit suspicious TLS characteristics?
  context: |
    Once malware executes, it often attempts to establish a command and control (C2) channel. This question correlates the initial execution with subsequent network activity. A connection to an IP or domain on a threat intelligence list is a critical indicator of compromise. Similarly, observing suspicious TLS/SSL attributes, such as a self-signed certificate on an external connection or a JA3/JA3S hash associated with known malware, strongly suggests a malicious C2 communication attempt.
  answer_sources:
  - Windows Event ID 4688
  - Sysmon Event ID 1
  - Zeek conn.log
  - Zeek dns.log
  - Zeek ssl.log
  - Zeek files.log
  - The IT/OT network boundary
  - Engineering Workstations (EWS)
  - Human-Machine Interfaces (HMIs)
  - Historian Servers
  - Perimeter firewalls
  - Network Intrusion Detection Systems (NIDS) at the IT/OT boundary
  - ICS network switches and routers where Zeek sensors are deployed.
  range: last 90 days
  queries:
  - technology: SIEM
    query: |
      CORRELATE process_creation_from_removable_media with network_connection_events (Zeek) on same host within 5 minutes 
      | IF destination_ip/domain in threat_intel_feed OR (ssl_log exists AND (ja3/ja3s in watchlist OR validation_status='self-signed')) THEN ALERT critical
- question: After a process was run from removable media, did the host exhibit anomalous network behavior, such as connecting to a new port or transferring an unusually large amount of data?
  context: |
    This question aims to detect C2 or data exfiltration activity by identifying deviations from an asset's normal network behavior. ICS assets typically have very predictable communication patterns. A connection to a destination port never used by that asset before, or a data transfer significantly larger than its historical average, are strong anomalies. This behavioral approach can detect novel C2 channels or data exfiltration that don't use known malicious indicators.
  answer_sources:
  - Zeek conn.log
  - Zeek dns.log
  - Zeek ssl.log
  - Zeek files.log
  - The IT/OT network boundary
  - Engineering Workstations (EWS)
  - Human-Machine Interfaces (HMIs)
  - Historian Servers
  - Perimeter firewalls
  - Network Intrusion Detection Systems (NIDS) at the IT/OT boundary
  - ICS network switches and routers where Zeek sensors are deployed.
  range: last 90 days
  queries:
  - technology: SIEM / Network Monitoring
    query: |
      ON process_creation_from_removable_media 
      | MONITOR host network traffic for 1 hour 
      | LOOKUP 30-day_baseline for host (unique_ports, avg_data_volume) 
      | IF connection_port not in baseline OR connection_bytes > 99th_percentile_baseline THEN ALERT
- question: Does a machine learning anomaly detection model identify the host's network traffic as abnormal in the minutes following a removable media execution?
  context: |
    This question applies unsupervised machine learning (e.g., an Isolation Forest model) to detect anomalous network behavior in a more holistic way. The model analyzes multiple dimensions of network traffic simultaneously (e.g., connection counts, port diversity, data volume ratios) to identify patterns that deviate from the norm. This is particularly effective for detecting "unknown unknowns" or sophisticated attackers who subtly alter their network traffic to evade simpler, single-metric-based anomaly detection rules.
  answer_sources:
  - Zeek conn.log
  - Zeek dns.log
  - Zeek ssl.log
  - Zeek files.log
  - The IT/OT network boundary
  - Engineering Workstations (EWS)
  - Human-Machine Interfaces (HMIs)
  - Historian Servers
  - Perimeter firewalls
  - Network Intrusion Detection Systems (NIDS) at the IT/OT boundary
  - ICS network switches and routers where Zeek sensors are deployed.
  range: last 90 days
  queries:
  - technology: Machine Learning / Network Monitoring
    query: |
      ON process_creation_from_removable_media 
      | AGGREGATE host's network traffic features over 60s intervals for 10 mins 
      | SCORE aggregated data with Isolation_Forest_model 
      | IF anomaly_score > threshold THEN ALERT
- question: Was a new persistence mechanism, such as a service or scheduled task pointing to a temporary directory, created shortly after a process was executed from removable media?
  context: |
    To ensure their malware survives a system reboot, adversaries establish persistence. This question correlates a removable media execution with the subsequent creation of a persistence mechanism. A common tactic is to create a new service, scheduled task, or autorun registry key that executes a payload. When the payload is placed in a non-standard, user-writable location like 'C:\ProgramData\' or 'AppData\Local\Temp', it is highly indicative of malicious intent.
  answer_sources:
  - Windows Event ID 4688
  - Sysmon Event ID 1
  - Windows Event ID 7045
  - Windows Event ID 4698
  - Sysmon Event ID 12
  - Sysmon Event ID 13
  - Sysmon Event ID 14
  - Engineering Workstations (EWS)
  - Human-Machine Interfaces (HMIs)
  - Historian Servers
  - SCADA Servers
  - any Windows-based ICS endpoint with USB/removable media access.
  range: last 90 days
  queries:
  - technology: SIEM
    query: |
      CORRELATE process_creation_from_removable_media with persistence_creation_event (WinEvent_7045/4698, Sysmon_12/13/14) on same host within 10 minutes 
      | IF new_persistence_path points to temp/user_writable_dir THEN ALERT
- question: Following a removable media event, was a new persistence mechanism created that has never been seen before for this asset class?
  context: |
    ICS assets are typically configured in a standardized and static manner. Any change, especially the addition of a new persistence mechanism, is inherently suspicious. This question involves comparing any newly created service, task, or autorun entry against a baseline of known-good entries for that specific class of asset (e.g., all HMIs from a certain vendor). If the new entry is not in the baseline, it's a "zero-day" occurrence for that environment and requires immediate review as a potential Indicator of Compromise.
  answer_sources:
  - Windows Event ID 4688
  - Sysmon Event ID 1
  - Windows Event ID 7045
  - Windows Event ID 4698
  - Sysmon Event ID 12
  - Sysmon Event ID 13
  - Sysmon Event ID 14
  - Engineering Workstations (EWS)
  - Human-Machine Interfaces (HMIs)
  - Historian Servers
  - SCADA Servers
  - any Windows-based ICS endpoint with USB/removable media access.
  range: last 90 days
  queries:
  - technology: SIEM / CMDB
    query: |
      ON new_persistence_created after removable_media_event 
      | LOOKUP persistence_identifier (name/path/value) in known_good_baseline for asset_class 
      | IF identifier not in baseline THEN ALERT
- question: Does a machine learning model classify a newly created persistence mechanism as an outlier compared to the baseline of benign persistence on similar assets?
  context: |
    This question uses a one-class machine learning model (like a One-Class SVM) to learn the characteristics of "normal" persistence entries in the environment. The model is trained on features from known-benign entries, such as the entropy of the service name, the depth of the executable path, and the signature status of the binary. When a new persistence mechanism is created, the model scores it. If it's classified as an outlier, it means its characteristics are significantly different from the established norm, making it highly suspect.
  answer_sources:
  - Windows Event ID 4688
  - Sysmon Event ID 1
  - Windows Event ID 7045
  - Windows Event ID 4698
  - Sysmon Event ID 12
  - Sysmon Event ID 13
  - Sysmon Event ID 14
  - Engineering Workstations (EWS)
  - Human-Machine Interfaces (HMIs)
  - Historian Servers
  - SCADA Servers
  - any Windows-based ICS endpoint with USB/removable media access.
  range: last 90 days
  queries:
  - technology: Machine Learning / EDR
    query: |
      ON new_persistence_created after removable_media_event 
      | EXTRACT features (path_entropy, signature_status, etc.) 
      | SCORE with one-class_SVM_model 
      | IF classified as 'outlier' THEN ALERT