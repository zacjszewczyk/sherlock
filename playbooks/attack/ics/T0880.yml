name: "T0880: Loss of Safety"
id: "9a8b7c6d-5e4f-4a3b-2c1d-0e9f8a7b6c5d"
description: "This playbook helps investigate whether an adversary is attempting to disable or manipulate a Safety Instrumented System (SIS). It focuses on detecting unauthorized or anomalous logic file transfers to SIS PLCs, the execution of critical or unsafe commands via ICS protocols, and unusual network traffic patterns such as high rates of connection attempts or protocol errors directed at SIS devices."
type: "technique"
related:
  - "TA0105: Impact"
contributors:
  - "Zachary Szewczyk"
  - "Ask Sage"
created: "2025-10-01"
modified: "2025-10-01"
version: "1.0"
tags: "none"
questions:
  - question: "Has a PLC logic file been transferred to a Safety Instrumented System (SIS) from an unauthorized source or outside a scheduled maintenance window?"
    context: "This question seeks to identify potentially malicious logic file transfers. A transfer from an unknown engineering workstation (EWS) or occurring outside of a planned maintenance period is a strong indicator of an attempt to tamper with safety logic, possibly to disable safety features or cause a hazardous state."
    answer_sources:
      - "Windows Event ID 4688"
      - "Windows Event ID 4624"
      - "Windows Event ID 4672"
      - "Zeek conn.log"
      - "Zeek files.log"
      - "Zeek smb.log"
      - "Zeek ftp.log"
      - "Zeek s7comm.log"
      - "Zeek enip.log"
      - "Network traffic at SIS network segment ingress/egress points; Authentication logs on Domain Controllers; File access and process execution logs on Engineering Workstations (EWS) and file servers; Network protocol logs from network sensors."
    range: "last 90 days"
    queries:
      - "SEARCH network file monitoring logs (e.g., Zeek files.log) FOR file transfers with PLC logic extensions (.L5X, .ACD, .PRO) WHERE destination IP is in SIS asset group AND (source IP is NOT in 'Authorized EWS' list OR timestamp is OUTSIDE 'Scheduled Maintenance' calendar)."
  - question: "Has an unusually large or long-duration logic file transfer occurred between an authorized Engineering Workstation (EWS) and an SIS PLC?"
    context: "Even if a file transfer originates from an authorized source, a significant deviation from normal behavior could indicate a compromised EWS or an unusual, potentially malicious, update. This question looks for statistical anomalies in file size and transfer duration to flag suspicious updates that might otherwise appear legitimate."
    answer_sources:
      - "Windows Event ID 4688"
      - "Windows Event ID 4624"
      - "Windows Event ID 4672"
      - "Zeek conn.log"
      - "Zeek files.log"
      - "Zeek smb.log"
      - "Zeek ftp.log"
      - "Zeek s7comm.log"
      - "Zeek enip.log"
      - "Network traffic at SIS network segment ingress/egress points; Authentication logs on Domain Controllers; File access and process execution logs on Engineering Workstations (EWS) and file servers; Network protocol logs from network sensors."
    range: "last 90 days"
    queries:
      - "FOR each authorized EWS-SIS pair, CALCULATE 30-day rolling 99th percentile for file size and connection duration from network logs (Zeek files.log, conn.log). ALERT if a new logic file transfer exceeds BOTH the size and duration thresholds."
  - question: "Can a machine learning model classify a recent logic file download to an SIS PLC as malicious?"
    context: "This question uses a supervised machine learning model to provide a more sophisticated classification of file transfers. By considering multiple features like time, source, size, and protocol, the model can identify complex patterns indicative of malicious activity that simpler rules might miss, providing a high-confidence alert."
    answer_sources:
      - "Windows Event ID 4688"
      - "Windows Event ID 4624"
      - "Windows Event ID 4672"
      - "Zeek conn.log"
      - "Zeek files.log"
      - "Zeek smb.log"
      - "Zeek ftp.log"
      - "Zeek s7comm.log"
      - "Zeek enip.log"
      - "Network traffic at SIS network segment ingress/egress points; Authentication logs on Domain Controllers; File access and process execution logs on Engineering Workstations (EWS) and file servers; Network protocol logs from network sensors."
    range: "last 90 days"
    queries:
      - "INPUT features (time, source/dest IP, user, file size, duration, protocol, maintenance window flag) of a logic file transfer into a trained classifier (e.g., Random Forest). ALERT if classification is 'malicious' with a confidence score > 0.95."
  - question: "Has a critical safety function command been sent to an SIS PLC from an unauthorized source?"
    context: "This question aims to detect the direct manipulation of an SIS PLC's core safety functions (e.g., 'Stop CPU', 'Write to safety memory'). Executing such commands from an unauthorized workstation is a direct and high-confidence indicator of an attack intended to cause a loss of safety."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek modbus.log"
      - "Zeek s7comm.log"
      - "Zeek dnp3.log"
      - "Zeek enip.log"
      - "Windows Event ID 4624"
      - "Windows Event ID 4688"
      - "Network traffic at the SIS network segment; ICS protocol logs from network sensors monitoring communication to SIS PLCs; Process execution logs on HMIs and Engineering Workstations; Asset inventory database defining SIS device roles and IP addresses."
    range: "last 90 days"
    queries:
      - "SEARCH deep packet inspection logs (e.g., Zeek s7comm.log) for commands matching a watchlist of critical function codes or memory addresses targeting SIS devices. ALERT if source IP is NOT in the authorized EWS watchlist."
  - question: "Is an SIS PLC receiving an anomalous variety or frequency of commands?"
    context: "Normal SIS operations typically involve a predictable and repetitive set of commands. A sudden increase in the variety of commands (entropy) or a spike in the frequency of critical 'write' or 'program' commands can indicate an adversary exploring device capabilities or attempting to brute-force a change, deviating from the established operational baseline."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek modbus.log"
      - "Zeek s7comm.log"
      - "Zeek dnp3.log"
      - "Zeek enip.log"
      - "Windows Event ID 4624"
      - "Windows Event ID 4688"
      - "Network traffic at the SIS network segment; ICS protocol logs from network sensors monitoring communication to SIS PLCs; Process execution logs on HMIs and Engineering Workstations; Asset inventory database defining SIS device roles and IP addresses."
    range: "last 90 days"
    queries:
      - "IN 5-minute windows, CALCULATE Shannon entropy of function codes and frequency of 'write'/'program' commands from protocol logs. ALERT if entropy increases > 3 standard deviations OR command frequency exceeds 99th percentile."
  - question: "Does the sequence of recent commands sent to an SIS PLC violate its normal operational 'grammar' as determined by a machine learning model?"
    context: "This question uses an advanced ML model (like an RNN or LSTM) to learn the legitimate sequence and structure of commands for an SIS PLC. An alert is triggered if a new sequence of commands has a high reconstruction error, meaning it does not conform to the learned 'grammar' of safe operations, indicating a novel or malicious command pattern."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek modbus.log"
      - "Zeek s7comm.log"
      - "Zeek dnp3.log"
      - "Zeek enip.log"
      - "Windows Event ID 4624"
      - "Windows Event ID 4688"
      - "Network traffic at the SIS network segment; ICS protocol logs from network sensors monitoring communication to SIS PLCs; Process execution logs on HMIs and Engineering Workstations; Asset inventory database defining SIS device roles and IP addresses."
    range: "last 90 days"
    queries:
      - "INPUT live stream of ICS commands into a trained RNN/LSTM autoencoder. ALERT if the reconstruction error for a command sequence exceeds the dynamically tuned threshold."
  - question: "Is an SIS PLC the target of a connection flood or network scan?"
    context: "This question looks for brute-force network activity, such as denial-of-service (DoS) attempts or network scanning. A high rate of failed or rejected connection attempts ('S0', 'S1', 'REJ') from a single source to an SIS device is a strong indicator of reconnaissance or an attempt to overwhelm the device."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek notice.log"
      - "Zeek weird.log"
      - "Zeek packet_filter.log"
      - "Network traffic at the SIS network segment and IDMZ boundaries; Logs from network infrastructure (firewalls, switches) protecting the SIS; Network sensor logs (Zeek conn.log, notice.log) capturing connection state information; Performance and availability monitoring data for SIS PLCs."
    range: "last 90 days"
    queries:
      - "SEARCH network connection logs (e.g., Zeek conn.log). ALERT if count of connections with state 'S0', 'S1', or 'REJ' from a single source to a single SIS IP exceeds 100 in 1 minute. CORRELATE with Zeek notices for 'Scan' or 'DoS' against SIS assets."
  - question: "Has there been a statistically significant anomaly in the traffic volume, source diversity, or connection quality to an SIS PLC?"
    context: "This question seeks to identify more subtle indicators of an attack by baselining key network traffic metrics. A sudden spike in inbound data volume, the number of unique sources communicating with the PLC, or the ratio of incomplete to complete connections can signal abnormal activity like data exfiltration, distributed scanning, or a DoS attack that falls below the thresholds of simpler rules."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek notice.log"
      - "Zeek weird.log"
      - "Zeek packet_filter.log"
      - "Network traffic at the SIS network segment and IDMZ boundaries; Logs from network infrastructure (firewalls, switches) protecting the SIS; Network sensor logs (Zeek conn.log, notice.log) capturing connection state information; Performance and availability monitoring data for SIS PLCs."
    range: "last 90 days"
    queries:
      - "TRACK per-minute metrics (inbound bytes, unique source IPs, incomplete connection ratio) for each SIS PLC. ALERT if byte count or source IP count exceeds 99.9th percentile, OR if incomplete connection ratio exceeds 30-day rolling average."
  - question: "Do the current network traffic patterns for an SIS PLC deviate from its forecasted behavior based on a multivariate time-series model?"
    context: "This question leverages a sophisticated forecasting model to create a highly accurate, dynamic baseline of expected network behavior that accounts for seasonality. By comparing observed traffic against this forecast, it can detect subtle, coordinated anomalies across multiple metrics (volume, packet counts, protocol mix) that indicate a complex attack pattern."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek notice.log"
      - "Zeek weird.log"
      - "Zeek packet_filter.log"
      - "Network traffic at the SIS network segment and IDMZ boundaries; Logs from network infrastructure (firewalls, switches) protecting the SIS; Network sensor logs (Zeek conn.log, notice.log) capturing connection state information; Performance and availability monitoring data for SIS PLCs."
    range: "last 90 days"
    queries:
      - "INPUT historical traffic data (volume, packets, protocol distribution) into a multivariate time-series model (e.g., VAR). ALERT if observed metrics consistently deviate from the model's forecasted values beyond a 99% confidence interval for more than 3 minutes."