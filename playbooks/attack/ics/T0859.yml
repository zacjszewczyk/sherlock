name: T0859: Valid Accounts
id: f47ac10b-58cc-4372-a567-0e02b2c3d479
description: This playbook focuses on detecting adversaries using valid accounts for lateral movement and persistence within an Industrial Control Systems (ICS) environment. It addresses the unauthorized use of existing accounts to move between assets, such as a successful authentication to a critical HMI or EWS from an unapproved workstation. It also covers the anomalous use of high-privilege protocols like RDP or SSH that violate access policies or show unusual data transfer volumes. Furthermore, the playbook helps identify persistence techniques, such as the creation of a new user account followed by immediate privilege escalation, or a privileged OT account logging in from an unapproved geographic location or at an anomalous time. The goal is to distinguish legitimate administrative activity from malicious use of valid credentials.
type: technique
related:
- TA0109: Lateral Movement
- TA0110: Persistence
contributors:
- Zachary Szewczyk
- Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
- question: Has a successful network or remote interactive login occurred on a critical ICS asset from an unauthorized source workstation for a specific user account?
  context: This question aims to detect unauthorized lateral movement by comparing every successful remote login (Windows Event ID 4624, Logon Type 3 or 10) on critical ICS assets against a pre-approved allow-list. An alert for a login not on this list indicates a potential breach, as the combination of source system, destination asset, and user account is not explicitly authorized. This is a high-fidelity method for catching policy violations.
  answer_sources:
  - Windows Event ID 4624
  - Zeek conn.log
  - Zeek rdp.log
  - Zeek dce_rpc.log
  - Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Programmable Logic Controllers (PLCs), Remote Terminal Units (RTUs), Historian Servers, Active Directory/Authentication servers, Network switches/routers in critical OT segments, IT/OT DMZ gateways, Jump Servers, Safety Instrumented Systems (SIS), Distributed Control Systems (DCS) controllers.
  range: last 90 days
  queries:
  - siem: |
      SEARCH for (Windows Event ID 4624 with Logon Type 3 or 10) on critical_asset_list
      ENRICH event with source_ip from (Zeek conn.log where dest_ip=event.dest_ip and timestamp~event.timestamp)
      LOOKUP (event.source_ip, event.ComputerName, event.TargetUserName) against authorized_lateral_movement_allow_list
      ALERT if lookup fails
- question: Has a user account logged into a critical ICS asset from a source IP address that is statistically rare or has never been seen before for that specific user and asset combination?
  context: This question seeks to identify anomalous logins by baselining normal activity. By profiling the historical source IP addresses for every user-asset pair, we can detect when a login occurs from an unusual or unprecedented location. This can indicate a compromised account being used from an attacker-controlled machine, even if the account itself is valid. Alerts are triggered for source IPs that are new or fall below a certain frequency threshold.
  answer_sources:
  - Windows Event ID 4624
  - Zeek conn.log
  - Zeek rdp.log
  - Zeek dce_rpc.log
  - Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Programmable Logic Controllers (PLCs), Remote Terminal Units (RTUs), Historian Servers, Active Directory/Authentication servers, Network switches/routers in critical OT segments, IT/OT DMZ gateways, Jump Servers, Safety Instrumented Systems (SIS), Distributed Control Systems (DCS) controllers.
  range: last 90 days
  queries:
  - siem: |
      FOR EACH new login event (user, destination_asset, source_ip):
        PROFILE historical source_ips for (user, destination_asset) over last 90 days
        CALCULATE frequency percentile of new source_ip within historical profile
        ALERT if source_ip is new OR frequency < 1st percentile
- question: Does a new lateral movement login attempt exhibit characteristics that a machine learning model identifies as malicious?
  context: This question leverages a supervised machine learning model to score the risk of each lateral movement attempt. The model is trained on historical data, using features like IP subnet, asset role, user privileges, and time of day to learn the difference between benign and malicious logins. This approach can detect complex, subtle patterns of abuse that rule-based methods might miss, providing a probabilistic risk score for each event.
  answer_sources:
  - Windows Event ID 4624
  - Zeek conn.log
  - Zeek rdp.log
  - Zeek dce_rpc.log
  - Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Programmable Logic Controllers (PLCs), Remote Terminal Units (RTUs), Historian Servers, Active Directory/Authentication servers, Network switches/routers in critical OT segments, IT/OT DMZ gateways, Jump Servers, Safety Instrumented Systems (SIS), Distributed Control Systems (DCS) controllers.
  range: last 90 days
  queries:
  - ml_pseudocode: |
      ON new login event:
        EXTRACT features (source_subnet, dest_asset_role, user_privilege, time_of_day, day_of_week, is_new_triplet)
        SCORE features with pre-trained classification model (e.g., Random Forest)
        ALERT if predicted_malicious_probability > 0.85
- question: Has an administrative protocol (RDP, SSH, WinRM) been used between assets in a way that violates the established access control matrix?
  context: This question enforces a strict, policy-based control on the use of high-privilege administrative protocols within the ICS network. By creating a matrix of allowed connections (based on source/destination roles, user groups, and protocol), any deviation can be immediately flagged as a critical security event. This helps prevent unauthorized administrative access and lateral movement between sensitive systems.
  answer_sources:
  - Zeek conn.log
  - Zeek rdp.log
  - Zeek ssh.log
  - Windows Event ID 4624
  - Network switches and routers in critical OT segments, Firewalls at network boundaries (e.g., IT/OT DMZ), Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Jump Servers, Remote Access Gateways, Historian Servers, Process Control Networks (PCN) assets, Data Diodes.
  range: last 90 days
  queries:
  - siem: |
      SEARCH Zeek logs where service in ('rdp', 'ssh', 'winrm') and destination_ip in critical_ics_assets
      ENRICH with user_group from (Windows Event 4624 on destination_ip)
      ENRICH with asset_roles for source_ip and destination_ip
      LOOKUP (source_role, destination_role, user_group, service) against ics_admin_access_matrix
      ALERT if lookup fails
- question: For an otherwise-permitted administrative connection, is the frequency of connections or the volume of data transferred anomalously high compared to its historical baseline?
  context: This question looks for abuse of legitimate administrative pathways. Even if a connection is allowed by policy, an adversary might use it more frequently or to transfer more data than usual (e.g., for data exfiltration or deploying large tools). By baselining the normal connection count and data volume for each path and alerting on significant deviations (e.g., exceeding the 99th percentile), we can detect this anomalous activity.
  answer_sources:
  - Zeek conn.log
  - Zeek rdp.log
  - Zeek ssh.log
  - Windows Event ID 4624
  - Network switches and routers in critical OT segments, Firewalls at network boundaries (e.g., IT/OT DMZ), Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Jump Servers, Remote Access Gateways, Historian Servers, Process Control Networks (PCN) assets, Data Diodes.
  range: last 90 days
  queries:
  - siem_timeseries: |
      FOR EACH permitted admin path (source_ip, dest_ip, protocol):
        BASELINE hourly connection_count and total_bytes over last 90 days
        CALCULATE 99th percentile for connection_count and total_bytes
        MONITOR new hourly stats
        ALERT if current_hour_count > 99th_percentile_count OR current_hour_bytes > 99th_percentile_bytes
- question: Does a new administrative connection within the OT network show a combination of features (source, destination, port, duration, data volume) that an unsupervised machine learning model flags as a significant outlier?
  context: This question uses an unsupervised anomaly detection model (like an Isolation Forest) to find novel or unusual administrative connections without pre-existing rules. The model learns what 'normal' activity looks like based on a multi-dimensional feature set. It can then flag connections that are outliers, indicating potentially malicious activity that doesn't fit any known pattern, such as using a non-standard port or an unusual combination of source and destination.
  answer_sources:
  - Zeek conn.log
  - Zeek rdp.log
  - Zeek ssh.log
  - Windows Event ID 4624
  - Network switches and routers in critical OT segments, Firewalls at network boundaries (e.g., IT/OT DMZ), Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Jump Servers, Remote Access Gateways, Historian Servers, Process Control Networks (PCN) assets, Data Diodes.
  range: last 90 days
  queries:
  - ml_pseudocode: |
      ON new admin connection:
        EXTRACT feature vector (source_ip, dest_ip, port, protocol, duration, total_bytes)
        SCORE with pre-trained unsupervised model (e.g., Isolation Forest)
        ALERT if anomaly_score is in top 0.5%
- question: Was a new user account created on a critical ICS asset and then immediately added to a high-privilege group?
  context: This question is designed to detect a common persistence technique where an attacker creates a new account and quickly elevates its privileges. By correlating account creation events (Event ID 4720) with group membership additions (e.g., Event ID 4732) that happen within a very short timeframe (e.g., 10 minutes), we can identify highly suspicious activity. Cross-referencing this with a change management system helps filter out legitimate administrative actions.
  answer_sources:
  - Windows Event ID 4720
  - Windows Event ID 4732
  - Windows Event ID 4728
  - Windows Event ID 4756
  - Active Directory/LDAP servers, Local security logs on EWS/HMIs/Historian Servers, Configuration management systems for PLCs/RTUs (if applicable), Patch Management/Change Management systems, Jump Servers.
  range: last 90 days
  queries:
  - siem: |
      TRIGGER on Windows Event ID 4720 on critical_asset_list
      WITHIN 10 minutes, LOOK for (Event 4732, 4728, or 4756) on same host for same TargetUserName
      IF found, ALERT as CRITICAL
      ENRICH alert by querying change_management_system_api for approved change
- question: Does a newly created user account exhibit suspicious characteristics such as a random-looking name, a name that is a typo of a real privileged account, or was it created during a burst of unusual account creation activity?
  context: This question uses heuristic analysis to flag suspicious account creations. It looks for several red flags: high-entropy names (suggesting machine-generation), names that are slight misspellings of legitimate admin accounts (typosquatting), or accounts created during a time when an abnormally high number of accounts are being created on an asset. Each of these can be an indicator of malicious automation or an attempt to create a stealthy backdoor account.
  answer_sources:
  - Windows Event ID 4720
  - Windows Event ID 4732
  - Windows Event ID 4728
  - Windows Event ID 4756
  - Active Directory/LDAP servers, Local security logs on EWS/HMIs/Historian Servers, Configuration management systems for PLCs/RTUs (if applicable), Patch Management/Change Management systems, Jump Servers.
  range: last 90 days
  queries:
  - siem: |
      ON new account creation (Event 4720):
        CALCULATE entropy of TargetUserName. ALERT if > 4.0.
        CALCULATE Levenshtein distance between TargetUserName and known_admin_names. ALERT if <= 2.
        CHECK rate of account creations on host. ALERT if rate > 99.9th percentile of historical hourly rate.
- question: Based on a machine learning model, what is the probability that a new account creation event is malicious?
  context: This question applies a supervised machine learning model to assess the risk of each new account creation. By training on features like username characteristics, the process that created the account, and the time of creation, the model can provide a probability score of malicious intent. This is particularly powerful when combined with post-creation events, such as immediate privilege escalation, to generate high-confidence alerts.
  answer_sources:
  - Windows Event ID 4720
  - Windows Event ID 4732
  - Windows Event ID 4728
  - Windows Event ID 4756
  - Active Directory/LDAP servers, Local security logs on EWS/HMIs/Historian Servers, Configuration management systems for PLCs/RTUs (if applicable), Patch Management/Change Management systems, Jump Servers.
  range: last 90 days
  queries:
  - ml_pseudocode: |
      ON new account creation (Event 4720):
        EXTRACT features (username_entropy, username_length, creator_process, time_of_day, privilege_escalation_within_10_mins)
        SCORE features with pre-trained classification model (e.g., Logistic Regression)
        ALERT if predicted_malicious_probability > 0.95
- question: Has a privileged OT account logged in from an unapproved source IP, to an unapproved asset, or using a logon type that is explicitly forbidden by the defined access policy?
  context: This question focuses on enforcing strict access controls for the most powerful OT accounts. By maintaining an explicit allow-list of valid source subnets, destination asset roles, and logon types for each privileged account, any login that violates this policy can be treated as a critical incident. This provides a clear, rule-based method for detecting potential misuse or compromise of high-value accounts, including flagging logins from unexpected geographic locations.
  answer_sources:
  - Windows Event ID 4624
  - Zeek conn.log
  - Zeek rdp.log
  - VPN concentrators, Jump servers, Firewalls (IT/OT boundary), Active Directory/Authentication servers, Network switches/routers in critical OT segments, Endpoint devices (EWS, HMIs, Historian Servers), Remote Access Gateways.
  range: last 90 days
  queries:
  - siem: |
      SEARCH for (Windows Event ID 4624) for user in privileged_ot_accounts_list
      ENRICH event with source_ip from Zeek conn.log
      LOOKUP (event.source_ip_subnet, event.destination_asset_role, event.Logon_Type) against privileged_account_allow_list
      ALERT if lookup fails
      ENRICH source_ip with GeoIP data and ALERT if country is unexpected.
- question: Does a recent login by a privileged OT user have a high risk score based on deviations from their established behavioral baseline?
  context: This question uses a risk-scoring system to evaluate logins from privileged users against their personal historical profile. Instead of a binary allow/deny, it scores a login based on multiple factors, such as whether the source IP is new, if the logon type is rare for that user, or if the login occurs outside their normal working hours. A cumulative score exceeding a set threshold indicates a significant anomaly that warrants investigation.
  answer_sources:
  - Windows Event ID 4624
  - Zeek conn.log
  - Zeek rdp.log
  - VPN concentrators, Jump servers, Firewalls (IT/OT boundary), Active Directory/Authentication servers, Network switches/routers in critical OT segments, Endpoint devices (EWS, HMIs, Historian Servers), Remote Access Gateways.
  range: last 90 days
  queries:
  - siem_profiling: |
      FOR EACH privileged OT user, PROFILE historical (source_subnets, logon_types, login_hours) over 90 days
      ON new login for privileged user:
        INITIALIZE risk_score = 0
        IF source_subnet is new for user, risk_score += 3
        IF logon_type_frequency < 5% for user, risk_score += 2
        IF login_time is outside typical hours for user, risk_score += 2
        ALERT if risk_score >= 4
- question: Does a privileged account login event exhibit a combination of features that an unsupervised machine learning model identifies as a significant anomaly compared to past legitimate activity?
  context: This question applies unsupervised machine learning to detect anomalous logins without needing pre-defined rules or labels. The model (e.g., One-Class SVM or Isolation Forest) learns the multi-dimensional boundary of 'normal' login behavior for privileged accounts. Any new login that falls outside this learned boundary is flagged as an anomaly, allowing for the detection of novel attack patterns that may not violate any single, specific rule.
  answer_sources:
  - Windows Event ID 4624
  - Zeek conn.log
  - Zeek rdp.log
  - VPN concentrators, Jump servers, Firewalls (IT/OT boundary), Active Directory/Authentication servers, Network switches/routers in critical OT segments, Endpoint devices (EWS, HMIs, Historian Servers), Remote Access Gateways.
  range: last 90 days
  queries:
  - ml_pseudocode: |
      ON new privileged account login:
        EXTRACT feature vector (source_subnet_onehot, dest_asset_role_onehot, logon_type_categorical, time_of_day_cyclical, day_of_week_cyclical)
        SCORE with pre-trained unsupervised model (e.g., Isolation Forest)
        ALERT if anomaly_score indicates a significant outlier