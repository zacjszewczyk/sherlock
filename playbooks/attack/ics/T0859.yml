name: "T0859: Valid Accounts"
id: "e0d1c7c8-7c8c-4f1b-8c8c-2c1c9c0c1c9c"
description: "This playbook focuses on detecting adversaries leveraging valid accounts for lateral movement and persistence within an Industrial Control Systems (ICS) environment. It addresses the use of compromised credentials for unauthorized access between assets, anomalous connections using high-privilege protocols, the creation of new user accounts followed by immediate privilege escalation, and privileged account activity from unapproved locations or with unusual characteristics. The goal is to identify unauthorized or anomalous use of legitimate credentials, a common tactic for evading detection while moving through and establishing persistence in a network."
type: "technique"
related:
  - "TA0109: Lateral Movement"
  - "TA0110: Persistence"
contributors:
  - "Zachary Szewczyk"
  - "Ask Sage"
created: "2025-10-01"
modified: "2025-10-01"
version: "1.0"
tags: "none"
questions:
  - question: "Is a successful network or remote interactive login on a critical ICS asset originating from an unauthorized source workstation for that specific user and destination?"
    context: "This question aims to detect unauthorized lateral movement by comparing successful logins (Windows Event ID 4624, Logon Types 3 or 10) against a pre-defined allow-list of approved access paths (source, destination, user). A successful login from a tuple that is not on this list is a strong indicator of a compromised account or an insider threat attempting to move through the network."
    answer_sources:
      - "Windows Event ID 4624"
      - "Zeek conn.log"
      - "Zeek rdp.log"
      - "Zeek dce_rpc.log"
      - "NAI: Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Programmable Logic Controllers (PLCs), Remote Terminal Units (RTUs), Historian Servers, Active Directory/Authentication servers, Network switches/routers in critical OT segments, IT/OT DMZ gateways, Jump Servers, Safety Instrumented Systems (SIS), Distributed Control Systems (DCS) controllers."
    range: "last 90 days"
    queries:
      - "pseudocode: SEARCH Windows Event ID 4624 AND (LogonType=3 OR LogonType=10) ON critical_asset_list. JOIN with Zeek conn.log ON timestamp, destination_ip. WHERE (source_ip, destination_asset, user) NOT IN authorized_access_allowlist. ALERT high_severity."
  - question: "Has a successful login to a critical ICS asset occurred from a source IP address that is historically rare or entirely new for that specific user and asset combination?"
    context: "This question seeks to identify anomalous lateral movement by baselining normal login behavior. Even if a user is generally authorized to access an asset, a login from a completely new or very infrequent source machine could indicate that the user's credentials have been stolen and are being used from an attacker-controlled system. This method helps detect deviations from established patterns."
    answer_sources:
      - "Windows Event ID 4624"
      - "Zeek conn.log"
      - "Zeek rdp.log"
      - "Zeek dce_rpc.log"
      - "NAI: Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Programmable Logic Controllers (PLCs), Remote Terminal Units (RTUs), Historian Servers, Active Directory/Authentication servers, Network switches/routers in critical OT segments, IT/OT DMZ gateways, Jump Servers, Safety Instrumented Systems (SIS), Distributed Control Systems (DCS) controllers."
    range: "last 90 days"
    queries:
      - "pseudocode: FOR each (asset, user) pair: BUILD baseline of source_ips from last 90 days. FOR each new login: CHECK if source_ip is new OR if frequency < 1st_percentile. IF true, ALERT medium_severity."
  - question: "Does a lateral movement login attempt exhibit a combination of features that a machine learning model identifies as similar to previously observed malicious activity?"
    context: "This question applies machine learning to detect complex patterns indicative of malicious logins that simple rules might miss. By training a model on features like source subnet, asset role, user privileges, and time of day, the system can score new logins for their likelihood of being malicious, providing a more nuanced and potentially more accurate detection capability than static thresholds or allow-lists alone."
    answer_sources:
      - "Windows Event ID 4624"
      - "Zeek conn.log"
      - "Zeek rdp.log"
      - "Zeek dce_rpc.log"
      - "NAI: Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Programmable Logic Controllers (PLCs), Remote Terminal Units (RTUs), Historian Servers, Active Directory/Authentication servers, Network switches/routers in critical OT segments, IT/OT DMZ gateways, Jump Servers, Safety Instrumented Systems (SIS), Distributed Control Systems (DCS) controllers."
    range: "last 90 days"
    queries:
      - "pseudocode: FOR each new login event: EXTRACT features (source_subnet, dest_role, user_privilege, time_of_day, etc.). SCORE with trained_ML_model. IF score > 0.85, ALERT."
  - question: "Is there a connection to a critical ICS asset using an administrative protocol (RDP, SSH, WinRM) that violates the defined access control matrix for source, destination, user, and protocol?"
    context: "This question focuses on enforcing strict access control policies for high-privilege protocols. It aims to detect unauthorized administrative access by checking every RDP, SSH, or WinRM connection against a matrix that explicitly defines what is allowed. Any connection not explicitly permitted by this matrix is considered a policy violation and a potential security incident."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek rdp.log"
      - "Zeek ssh.log"
      - "Windows Event ID 4624"
      - "NAI: Network switches and routers in critical OT segments, Firewalls at network boundaries (e.g., IT/OT DMZ), Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Jump Servers, Remote Access Gateways, Historian Servers, Process Control Networks (PCN) assets, Data Diodes."
    range: "last 90 days"
    queries:
      - "pseudocode: SEARCH Zeek logs WHERE service IN ('rdp', 'ssh', 'winrm') AND destination IN critical_asset_list. GET user from correlated Windows Event 4624. CHECK if (source_role, destination_role, user_group, protocol) is NOT IN admin_access_matrix. IF true, ALERT critical."
  - question: "Is an authorized administrative connection path exhibiting an unusually high frequency of connections or volume of data transferred compared to its historical baseline?"
    context: "This question aims to detect abuse of legitimate administrative access. An attacker who has compromised a valid account might use it for activities like data exfiltration or deploying large tools, which would manifest as a spike in data volume or connection frequency. By baselining normal activity for each allowed path, we can detect these significant deviations."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek rdp.log"
      - "Zeek ssh.log"
      - "Windows Event ID 4624"
      - "NAI: Network switches and routers in critical OT segments, Firewalls at network boundaries (e.g., IT/OT DMZ), Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Jump Servers, Remote Access Gateways, Historian Servers, Process Control Networks (PCN) assets, Data Diodes."
    range: "last 90 days"
    queries:
      - "pseudocode: FOR each allowed (source, destination, protocol) path: CALCULATE 90-day baseline for hourly_connection_count and hourly_bytes_transferred. FOR each new hour: CHECK if connection_count > 99th_percentile OR bytes_transferred > 99th_percentile. IF true, ALERT high_priority."
  - question: "Does an administrative connection within the OT network show a combination of characteristics (source, destination, port, duration, data volume) that an unsupervised machine learning model flags as a significant anomaly?"
    context: "This question uses unsupervised machine learning to find novel or previously unseen attack patterns that don't match any predefined rules. By modeling the normal characteristics of all administrative connections, an Isolation Forest or similar model can identify outliers that represent unusual combinations of features, even if each individual feature is not anomalous on its own. This is effective for detecting sophisticated or evolving threats."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek rdp.log"
      - "Zeek ssh.log"
      - "Windows Event ID 4624"
      - "NAI: Network switches and routers in critical OT segments, Firewalls at network boundaries (e.g., IT/OT DMZ), Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Jump Servers, Remote Access Gateways, Historian Servers, Process Control Networks (PCN) assets, Data Diodes."
    range: "last 90 days"
    queries:
      - "pseudocode: FOR each new admin connection: CREATE feature_vector (source_ip, dest_ip, port, protocol, duration, bytes). SCORE with trained_unsupervised_model. IF anomaly_score is in top 0.5%, ALERT."
  - question: "Has a newly created user account on a critical ICS asset been immediately added to a high-privilege group without a corresponding authorized change request?"
    context: "This question targets a common persistence technique where an attacker creates a new account and quickly elevates its privileges. The correlation of an account creation event (4720) with a group addition event (4732, 4728, or 4756) in a short time frame is a high-fidelity indicator of malicious activity. Cross-referencing with a change management system helps filter out legitimate administrative actions."
    answer_sources:
      - "Windows Event ID 4720"
      - "Windows Event ID 4732"
      - "Windows Event ID 4728"
      - "Windows Event ID 4756"
      - "NAI: Active Directory/LDAP servers, Local security logs on EWS/HMIs/Historian Servers, Configuration management systems for PLCs/RTUs (if applicable), Patch Management/Change Management systems, Jump Servers."
    range: "last 90 days"
    queries:
      - "pseudocode: ON Event ID 4720 (user creation) on critical_asset: START 10-minute timer. IF Event ID (4732 OR 4728 OR 4756) for same user on same host occurs: QUERY change_management_system for approval. IF no approval, ALERT critical."
  - question: "Does a newly created user account exhibit suspicious characteristics, such as a randomly generated name (high entropy), a name that mimics an existing privileged account (typosquatting), or was it created during a period of anomalously high account creation activity?"
    context: "This question uses heuristic analysis to flag suspicious account creations that might be part of an automated attack or an attempt to blend in. Randomly generated usernames are common for malware, typosquatting is a classic deception technique, and a sudden burst of account creations is abnormal. These checks provide early warnings of potential persistence attempts."
    answer_sources:
      - "Windows Event ID 4720"
      - "Windows Event ID 4732"
      - "Windows Event ID 4728"
      - "Windows Event ID 4756"
      - "NAI: Active Directory/LDAP servers, Local security logs on EWS/HMIs/Historian Servers, Configuration management systems for PLCs/RTUs (if applicable), Patch Management/Change Management systems, Jump Servers."
    range: "last 90 days"
    queries:
      - "pseudocode: ON Event ID 4720: CALCULATE username_entropy, Levenshtein_distance_to_privileged_accounts, hourly_creation_rate. IF entropy > 4.0 OR distance < 3 OR rate > 99.9th_percentile, ALERT."
  - question: "Based on a combination of its features, does a machine learning model classify a new account creation event as likely malicious?"
    context: "This question leverages supervised machine learning to make a holistic judgment about whether a new account creation is malicious. By considering features like the username's characteristics, the process that created it, the time of day, and whether it was immediately followed by privilege escalation, the model can identify subtle malicious patterns that would be difficult to define with individual rules."
    answer_sources:
      - "Windows Event ID 4720"
      - "Windows Event ID 4732"
      - "Windows Event ID 4728"
      - "Windows Event ID 4756"
      - "NAI: Active Directory/LDAP servers, Local security logs on EWS/HMIs/Historian Servers, Configuration management systems for PLCs/RTUs (if applicable), Patch Management/Change Management systems, Jump Servers."
    range: "last 90 days"
    queries:
      - "pseudocode: ON Event ID 4720: EXTRACT features (username_entropy, creator_process, time_of_day, followed_by_privesc). SCORE with trained_ML_model. IF score > 0.95, ALERT high_priority."
  - question: "Has a privileged OT account logged into a critical asset from an unapproved source location, or used a logon type that is not permitted for that specific context?"
    context: "This question enforces a strict, context-aware access policy for the most sensitive accounts. It goes beyond simple authentication by ensuring that privileged users are only logging in from expected network locations (e.g., a jump server) and using appropriate methods (e.g., interactive remote access vs. a network share login). A violation strongly suggests credential compromise."
    answer_sources:
      - "Windows Event ID 4624"
      - "Zeek conn.log"
      - "Zeek rdp.log"
      - "NAI: VPN concentrators, Jump servers, Firewalls (IT/OT boundary), Active Directory/Authentication servers, Network switches/routers in critical OT segments, Endpoint devices (EWS, HMIs, Historian Servers), Remote Access Gateways."
    range: "last 90 days"
    queries:
      - "pseudocode: ON Event ID 4624 for privileged_user: GET source_ip from Zeek conn.log. CHECK if (source_subnet, destination_role, logon_type) NOT IN privileged_access_allowlist. IF true, ALERT critical."
  - question: "Does a privileged account login exhibit a combination of moderately anomalous factors, such as a new source subnet, an infrequent logon type, or an unusual time, that cumulatively suggest a heightened risk?"
    context: "This question uses a risk-scoring model to detect suspicious activity that may not be severe enough to trigger a single critical alert but is risky when combined. It profiles a user's normal behavior and flags logins that deviate in multiple ways (e.g., from a new location AND at an odd time). This approach helps identify moderately suspicious events that warrant investigation."
    answer_sources:
      - "Windows Event ID 4624"
      - "Zeek conn.log"
      - "Zeek rdp.log"
      - "NAI: VPN concentrators, Jump servers, Firewalls (IT/OT boundary), Active Directory/Authentication servers, Network switches/routers in critical OT segments, Endpoint devices (EWS, HMIs, Historian Servers), Remote Access Gateways."
    range: "last 90 days"
    queries:
      - "pseudocode: ON Event ID 4624 for privileged_user: CALCULATE risk_score = 0. IF source_subnet is new, risk_score+=3. IF logon_type_frequency < 5%, risk_score+=2. IF time is outside normal hours, risk_score+=2. IF risk_score >= 4, ALERT."
  - question: "Does a privileged account login event appear as a significant outlier when compared to a baseline of normal login activity by an unsupervised machine learning model?"
    context: "This question applies unsupervised anomaly detection to find novel attack patterns involving privileged accounts. The model learns the multi-dimensional profile of 'normal' for privileged loginsâ€”considering source, destination, logon type, and time simultaneously. It can then flag any new login that deviates significantly from this learned norm, even if the pattern of deviation is completely new."
    answer_sources:
      - "Windows Event ID 4624"
      - "Zeek conn.log"
      - "Zeek rdp.log"
      - "NAI: VPN concentrators, Jump servers, Firewalls (IT/OT boundary), Active Directory/Authentication servers, Network switches/routers in critical OT segments, Endpoint devices (EWS, HMIs, Historian Servers), Remote Access Gateways."
    range: "last 90 days"
    queries:
      - "pseudocode: ON Event ID 4624 for privileged_user: CREATE feature_vector (source_subnet, dest_role, logon_type, time_features). SCORE with trained_unsupervised_model. IF anomaly_score is high, ALERT."