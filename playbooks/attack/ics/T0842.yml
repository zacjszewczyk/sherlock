name: T0842: Network Sniffing
id: f47ac10b-58cc-4372-a567-0e02b2c3d479
description: >-
  This playbook helps to determine if an adversary is attempting to discover information about the ICS network topology, protocols, or credentials by sniffing network traffic. It focuses on detecting the use of known sniffing tools or libraries on critical assets, identifying anomalous network scanning behaviors (like high fan-out or policy violations), analyzing unencrypted protocol sessions for unusual volume or content, and detecting signs of Man-in-the-Middle attacks through ARP or DNS spoofing.
type: technique
related:
  - TA0102: Discovery
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Are known network sniffing tools or libraries being executed or installed on critical ICS assets?
    context: >-
      Adversaries often use well-known, off-the-shelf tools like Wireshark, tcpdump, or their associated libraries (e.g., wpcap.dll) to capture network traffic. Detecting the creation of these processes, installation of their services, or the loading of their libraries on critical systems like Engineering Workstations or HMIs is a high-fidelity indicator of network sniffing activity.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 7045
      - Sysmon Event ID 1
      - Sysmon Event ID 7
      - Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Data Historians, and other Windows-based systems within the Process Control Network (PCN) and Manufacturing Zone.
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: >-
          SEARCH process_creation, service_installation, image_loads WHERE (process_name IN [sniffer_watchlist] OR service_name IN [sniffer_watchlist] OR image_name IN [sniffer_library_watchlist]) ON critical_ics_assets
  - question: Is there an anomalous spike in the creation of new processes or the loading of unusual DLLs on critical ICS assets?
    context: >-
      To evade simple signature-based detections, adversaries may use custom-compiled, renamed, or packed sniffing tools. This question helps detect such evasive activity by establishing a baseline of normal process and DLL loading behavior on a per-host basis. A sudden, statistically significant increase in new, non-allowlisted processes or the loading of unexpected DLLs by critical applications can indicate the introduction of an unknown sniffing tool.
    answer_sources:
      - Sysmon Event ID 1
      - Sysmon Event ID 7
      - Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Data Historians, and other Windows-based systems within the Process Control Network (PCN) and Manufacturing Zone.
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: >-
          COMPARE daily_new_process_count AGAINST 14_day_rolling_98th_percentile_baseline ON critical_ics_assets. SEARCH for new_dlls_loaded_by_critical_applications NOT IN [dll_allowlist]
  - question: Are there any newly created processes on ICS assets that exhibit characteristics of a network sniffer, even if their names are unknown?
    context: >-
      This question employs a machine learning approach to proactively identify suspicious processes that might be custom-built or obfuscated sniffers. By training a model to recognize inherent characteristics of such tools—like high-entropy process names, unusual parent-child process relationships, or specific command-line argument patterns—it is possible to flag potential threats that signature-based and simple statistical methods would miss.
    answer_sources:
      - Sysmon Event ID 1
      - Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Data Historians, and other Windows-based systems within the Process Control Network (PCN) and Manufacturing Zone.
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: >-
          RUN classification_model ON all_process_creation_events FROM critical_ics_assets. ALERT IF classification_score IS 'suspicious_sniffer_like'
  - question: Are ICS assets communicating with unauthorized devices or network segments, violating established communication policies?
    context: >-
      Network sniffing is often a precursor to lateral movement or data exfiltration. This question aims to detect this initial reconnaissance phase by identifying any network connections that deviate from a strictly defined allowlist of approved source-destination-port communication tuples. In a highly segmented ICS environment, any violation of this policy is a strong indicator of unauthorized or malicious activity.
    answer_sources:
      - Zeek conn.log
      - Network segments connecting PLCs, RTUs, and SCADA servers; network choke points between the IT and OT networks; switch port mirror/SPAN sessions on critical ICS segments.
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: >-
          SEARCH network_connections WHERE connection_tuple NOT IN [approved_communication_policy_allowlist]
  - question: Is any ICS host exhibiting scanning behavior by connecting to an unusually high number of unique destination IPs or ports?
    context: >-
      A compromised host used for network discovery will often exhibit a 'fan-out' behavior, where it attempts to connect to many different devices to map the network or find open services. This question establishes a baseline of normal connectivity for each host and alerts when the number of unique destinations ('fan-out') or the randomness of destination ports (entropy) exceeds a statistical threshold, which can indicate active network scanning.
    answer_sources:
      - Zeek conn.log
      - Network segments connecting PLCs, RTUs, and SCADA servers; network choke points between the IT and OT networks; switch port mirror/SPAN sessions on critical ICS segments.
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: >-
          FOR each_host, COMPARE hourly_unique_destination_ip_count AGAINST 30_day_rolling_99th_percentile_baseline. ALERT if threshold_exceeded
  - question: Does the overall network communication profile of any ICS host deviate significantly from its learned normal behavior?
    context: >-
      This question uses a time-series model to create a holistic, multi-dimensional view of a host's network activity over time. Instead of tracking a single metric, it analyzes patterns across multiple features (e.g., connection counts, protocol mix, data volume). An alert on high reconstruction error signifies a complex deviation from the norm, potentially caused by sophisticated sniffing or reconnaissance activities that simpler statistical methods might miss.
    answer_sources:
      - Zeek conn.log
      - Network segments connecting PLCs, RTUs, and SCADA servers; network choke points between the IT and OT networks; switch port mirror/SPAN sessions on critical ICS segments.
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: >-
          RUN time_series_anomaly_model ON hourly_host_feature_vectors. ALERT IF reconstruction_error > dynamic_threshold
  - question: Are unauthorized or insecure commands being transmitted over industrial or administrative protocols?
    context: >-
      Adversaries sniffing traffic may attempt to capture credentials or inject malicious commands. This question focuses on detecting the use of forbidden ICS function codes (e.g., a 'stop PLC' command from an unauthorized HMI) or the use of inherently insecure administrative protocols like Telnet or FTP that are not on an explicit allowlist. This provides a direct method for detecting active tampering or credential theft.
    answer_sources:
      - Zeek conn.log
      - Zeek notice.log
      - Zeek modbus.log
      - Zeek dnp3.log
      - Zeek ftp.log
      - Zeek http.log
      - Data historians, SCADA servers, and network segments carrying administrative or industrial protocol traffic; DMZ segments for external ICS access.
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: >-
          SEARCH ics_protocol_logs FOR unauthorized_function_codes. SEARCH admin_protocol_logs FOR connections NOT IN [source_destination_allowlist]
  - question: Are there unencrypted communication sessions that are abnormally long or transferring an unusual amount of data?
    context: >-
      Network sniffing can be used to exfiltrate large volumes of captured data. An adversary might keep a connection open for an extended period or transfer an unusually large payload. This question aims to detect such behavior by baselining the normal duration and data volume for established unencrypted protocol sessions and alerting on significant statistical deviations (e.g., more than 3 standard deviations from the mean).
    answer_sources:
      - Zeek conn.log
      - Data historians, SCADA servers, and network segments carrying administrative or industrial protocol traffic; DMZ segments for external ICS access.
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: >-
          FOR each_session_type, COMPARE session_duration_and_byte_count AGAINST (mean + 3*stdev) of 30_day_baseline. ALERT if threshold_exceeded
  - question: Are there any unencrypted sessions that are fundamentally different from the vast majority of normal sessions?
    context: >-
      This question uses unsupervised machine learning (clustering) to find 'needles in a haystack.' By grouping all unencrypted sessions based on features like duration, data volume, and commands used, any session that does not fit into a well-defined cluster is flagged as an outlier. This can uncover novel or unusual sniffing and exfiltration techniques that don't trigger specific rule-based or simple statistical alerts.
    answer_sources:
      - Zeek conn.log
      - Zeek notice.log
      - Zeek modbus.log
      - Zeek dnp3.log
      - Zeek ftp.log
      - Zeek http.log
      - Data historians, SCADA servers, and network segments carrying administrative or industrial protocol traffic; DMZ segments for external ICS access.
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: >-
          RUN clustering_algorithm ON all_unencrypted_sessions. ALERT on sessions classified as 'outlier'
  - question: Is there evidence of ARP or DNS spoofing, suggesting a Man-in-the-Middle (MitM) attack to intercept traffic?
    context: >-
      A common method to enable network sniffing is to perform an ARP or DNS spoofing attack, which redirects traffic through an adversary-controlled machine. This question looks for direct evidence of this MitM technique, such as a critical IP address (like a gateway or historian) suddenly being associated with a new, unauthorized MAC address, or an internal ICS domain name resolving to an external or unapproved IP address.
    answer_sources:
      - Zeek arp.log
      - Zeek dns.log
      - Zeek notice.log
      - Local network segments within the Process Control Network (PCN), especially those containing EWS, HMIs, and PLCs; DNS servers and resolvers serving the OT environment.
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: >-
          SEARCH arp_logs for critical_ip associated with new_mac NOT IN [hardware_allowlist]. SEARCH dns_logs for internal_hostname resolving to external_ip
  - question: Are there any new, unapproved IP-to-MAC address pairings on the network, or are hosts generating an unusual number of failed DNS lookups?
    context: >-
      This question aims to detect spoofing attempts through baselining. In a stable ICS environment, IP-to-MAC address pairings should be relatively static. Alerting on any new, un-vetted pairing can indicate an ARP spoof. Similarly, a spike in failed DNS lookups (NXDOMAIN responses) from a host could indicate DNS-based reconnaissance or an attempt to communicate with a non-existent C2 server after a DNS hijack.
    answer_sources:
      - Zeek arp.log
      - Zeek dns.log
      - Local network segments within the Process Control Network (PCN), especially those containing EWS, HMIs, and PLCs; DNS servers and resolvers serving the OT environment.
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: >-
          SEARCH arp_logs for ip_mac_pairs NOT IN [static_map]. FOR each_host, COMPARE daily_nxdomain_count AGAINST 99th_percentile_baseline
  - question: Are there anomalous structural changes in the network communication graph that could indicate a spoofing attack?
    context: >-
      This question models the entire network as a graph of interconnected entities (IPs, MACs, domains). A graph-based machine learning model learns the normal structure of these connections. It can then detect subtle but significant structural anomalies, such as a new connection (edge) forming between a critical IP node and a previously unknown MAC node. This provides a powerful, context-aware method for detecting a potential Man-in-the-Middle attack.
    answer_sources:
      - Zeek arp.log
      - Zeek dns.log
      - Zeek notice.log
      - Local network segments within the Process Control Network (PCN), especially those containing EWS, HMIs, and PLCs; DNS servers and resolvers serving the OT environment.
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: >-
          RUN graph_anomaly_model ON network_communication_graph. ALERT on high_anomaly_score_changes like new_edge(critical_ip, unknown_mac)