name: T0811: Data from Information Repositories
id: a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d
description: This playbook investigates potential adversary collection of data from Industrial Control System (ICS) information repositories. The investigation focuses on identifying anomalous file access, such as a user accessing an unusually high number of files or files containing sensitive keywords; unusual network egress, like large data transfers to external networks or connections to malicious services; and suspicious logon activity, including logons from unauthorized accounts or those exhibiting characteristics that deviate from the user's established behavioral baseline.
type: technique
related:
  - TA0100: Collection
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Are users accessing files with sensitive ICS-related keywords?
    context: Adversaries often search for specific keywords related to industrial control systems to identify high-value documents. This question helps detect such targeted data collection by monitoring for read access to files whose names contain keywords like 'SCADA', 'P&ID', 'PLC', etc., while filtering out access by authorized personnel to reduce false positives.
    answer_sources:
      - Windows Event ID 5145
      - Windows Sysmon Event ID 11
      - Zeek smb_files.log
      - Named Assets of Interest: ICS File Servers, Engineering Workstations (EWS), Document Management Systems (DMS), Project File Shares, Configuration Management Databases (CMDBs), and SharePoint/Confluence sites hosting ICS documentation.
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: SEARCH (EventID=5145 AND Accesses='ReadData') OR (sourcetype=zeek_smb AND action='file_read') WHERE filename CONTAINS ('SCADA', 'P&ID', 'RTU', ...) AND user NOT IN (allowlist_group)
  - question: Is any user accessing an unusually high number or variety of files from sensitive repositories compared to their normal behavior?
    context: This question aims to detect bulk file collection. An adversary attempting to exfiltrate large amounts of data will likely access many more unique files than a typical user in a short period. Monitoring for deviations from a user's established baseline of file access count and file type variety (entropy) can reveal this anomalous activity.
    answer_sources:
      - Windows Event ID 5145
      - Windows Sysmon Event ID 11
      - Zeek smb_files.log
      - Named Assets of Interest: ICS File Servers, Engineering Workstations (EWS), Document Management Systems (DMS), Project File Shares, Configuration Management Databases (CMDBs), and SharePoint/Confluence sites hosting ICS documentation.
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: SEARCH file_access_events | BUCKET time by 15min | COUNT unique files by user, host | COMPARE count to 30-day baseline for user, host | ALERT if count > 99th_percentile
      - technology: Pseudocode
        query: SEARCH file_access_events | BUCKET time by 1hr | CALCULATE entropy of file_extensions by user | COMPARE to historical norm | ALERT on spikes
  - question: Can we use machine learning to detect complex patterns of anomalous file access?
    context: Simple thresholding can miss sophisticated adversaries. This question uses a machine learning model (Isolation Forest) to analyze multiple features of a file access event simultaneously (e.g., user, time, file type, path). This allows for the detection of subtle anomalies that might not trigger individual rules but are suspicious when combined.
    answer_sources:
      - Windows Event ID 5145
      - Windows Sysmon Event ID 11
      - Zeek smb_files.log
      - Named Assets of Interest: ICS File Servers, Engineering Workstations (EWS), Document Management Systems (DMS), Project File Shares, Configuration Management Databases (CMDBs), and SharePoint/Confluence sites hosting ICS documentation.
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: INPUT file_access_events | CREATE_FEATURES (user, host, server, path_depth, extension, time, day_of_week, keyword_match, off_hours) | APPLY IsolationForestModel | GROUP by user over 1hr | ALERT if anomaly_score > 99.5th_percentile
  - question: Are sensitive ICS repository hosts communicating with known malicious IPs or unauthorized external services?
    context: Data exfiltration often involves sending collected information to an external server. This question seeks to identify this activity by checking if any hosts containing sensitive ICS data are connecting to destinations on threat intelligence lists or to unauthorized services like public cloud storage or webmail, which are common exfiltration channels.
    answer_sources:
      - Zeek conn.log
      - Zeek files.log
      - Zeek dns.log
      - Zeek ssl.log
      - Zeek http.log
      - Zeek ftp.log
      - Named Assets of Interest: Process Historian Servers, Control System Databases (SQL, Oracle), OPC DA/HDA servers, ICS File Servers, and Engineering Workstations acting as data aggregation points.
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: SEARCH sourcetype=zeek_conn where src_ip IN (NAI_hosts) AND dest_ip NOT IN (internal_networks) | LOOKUP threat_intel on dest_ip | ALERT if match | ELSE LOOKUP dns/ssl logs on dest_ip | ALERT if domain IN (unauthorized_services) and bytes_out > 1024
  - question: Are sensitive ICS hosts sending an unusually large amount of data to external networks?
    context: A key indicator of data exfiltration is an anomalous volume of outbound traffic. This question focuses on detecting such anomalies by comparing the current outbound data volume from sensitive hosts against their historical baselines. It checks for both sustained high traffic over an hour and large single-session transfers, which could indicate bulk data exfiltration.
    answer_sources:
      - Zeek conn.log
      - Zeek files.log
      - Zeek dns.log
      - Zeek ssl.log
      - Zeek http.log
      - Zeek ftp.log
      - Named Assets of Interest: Process Historian Servers, Control System Databases (SQL, Oracle), OPC DA/HDA servers, ICS File Servers, and Engineering Workstations acting as data aggregation points.
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: SEARCH sourcetype=zeek_conn where src_ip IN (NAI_hosts) | BUCKET by 1hr | SUM bytes_out by src_ip | COMPARE to 30-day baseline | ALERT if current > 99th_percentile OR current > 500MB
      - technology: Pseudocode
        query: SEARCH sourcetype=zeek_conn where src_ip IN (NAI_hosts) | COMPARE bytes_out to session_baseline | ALERT if bytes_out > 99th_percentile OR bytes_out > 100MB
  - question: Can we use a time-series model to predict and detect abnormal network egress patterns?
    context: Network traffic often has predictable daily and weekly patterns. This question involves using a time-series model to learn these normal cycles for each sensitive host. The model can then predict expected traffic volume and alert on significant deviations, allowing for the detection of anomalous egress that might be missed by simple baseline thresholds.
    answer_sources:
      - Zeek conn.log
      - Zeek files.log
      - Zeek dns.log
      - Zeek ssl.log
      - Zeek http.log
      - Zeek ftp.log
      - Named Assets of Interest: Process Historian Servers, Control System Databases (SQL, Oracle), OPC DA/HDA servers, ICS File Servers, and Engineering Workstations acting as data aggregation points.
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: INPUT zeek_conn_logs | AGGREGATE bytes_out per 15min by host | APPLY ProphetModel | ALERT if observed_volume > predicted_upper_bound for 2 consecutive intervals
  - question: Are unauthorized accounts successfully logging into critical ICS repository hosts?
    context: An adversary may use compromised credentials to access sensitive systems. This question aims to detect this by verifying that any successful logon to a critical host is performed by an account that belongs to the appropriate Active Directory group for that asset. It also specifically scrutinizes remote interactive logons, which are a high-risk vector, against a strict allowlist.
    answer_sources:
      - Windows Event ID 4624
      - Zeek conn.log
      - Named Assets of Interest: Engineering Workstations (EWS), Historian Servers, Human-Machine Interface (HMI) consoles, Domain Controllers, and Jump Servers within the ICS network.
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: SEARCH EventID=4624 on NAI_hosts | LOOKUP AD_groups for user | ALERT if user NOT IN authorized_group for host
      - technology: Pseudocode
        query: SEARCH EventID=4624 on NAI_hosts where LogonType=10 | ALERT if user NOT IN remote_access_allowlist
  - question: Are there any successful logons that are highly anomalous based on a user's historical behavior?
    context: Even if a legitimate account is used, the context of the logon can be suspicious. This question seeks to identify compromised accounts by baselining normal user behavior (e.g., typical work hours, locations, source machines) and assigning a risk score to new logons based on deviations. A high cumulative score from multiple anomalous factors can indicate that the legitimate user is not the one logging in.
    answer_sources:
      - Windows Event ID 4624
      - Zeek conn.log
      - Named Assets of Interest: Engineering Workstations (EWS), Historian Servers, Human-Machine Interface (HMI) consoles, Domain Controllers, and Jump Servers within the ICS network.
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: FOR each logon event (EventID=4624): CALCULATE risk_score (is_off_hours, is_new_geo, is_new_workstation) | ALERT if risk_score >= 5
  - question: Can a machine learning classifier identify suspicious logon events based on a combination of factors?
    context: This question leverages a supervised machine learning model (Random Forest) to provide a more robust detection capability than simple scoring. By training on historical data, the model learns the complex, non-linear relationships between various logon features that characterize suspicious activity. This can detect sophisticated impersonation attempts that might evade rule-based systems.
    answer_sources:
      - Windows Event ID 4624
      - Zeek conn.log
      - Named Assets of Interest: Engineering Workstations (EWS), Historian Servers, Human-Machine Interface (HMI) consoles, Domain Controllers, and Jump Servers within the ICS network.
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: INPUT logon_events (EventID=4624) | CREATE_FEATURES (LogonType, IsAdmin, TimeOfDay, IsNewGeo, IsNewWorkstation, IsRemote) | APPLY RandomForestModel | ALERT if classification='suspicious' AND confidence > 0.90