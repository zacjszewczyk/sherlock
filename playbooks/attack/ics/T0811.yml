name: T0811: Data from Information Repositories
id: 3d1f8f0b-4b2a-4c9e-8d7f-6a5b4c3d2e1f
description: |-
  This playbook helps investigate whether an adversary is collecting data from Industrial Control System (ICS) information repositories. It focuses on identifying anomalous file access, unusual network egress, and suspicious logon activities associated with sensitive data stores. Key indicators include users accessing an abnormally high number of files, files with sensitive keywords being read, large data transfers to external networks, and logons from unauthorized accounts or exhibiting multiple anomalous characteristics (e.g., unusual time, location, or source workstation). The goal is to detect data staging and exfiltration from critical assets like Engineering Workstations, Historians, and document management systems.
type: technique
related:
  - TA0100: Collection
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Are users accessing files containing sensitive ICS keywords from information repositories?
    context: |-
      This question aims to detect direct access to files whose names suggest they contain sensitive ICS information, such as SCADA diagrams, P&ID documents, or network layouts. By monitoring for specific read actions on files with keywords like 'PLC', 'RTU', or 'HMI', analysts can quickly identify potential data staging or reconnaissance, even if the volume of access is low. The query is designed to filter out legitimate access by known administrative or engineering groups to reduce false positives.
    answer_sources:
      - Windows Event ID 5145
      - Windows Sysmon Event ID 11
      - Zeek smb_files.log
      - ICS File Servers
      - Engineering Workstations (EWS)
      - Document Management Systems (DMS)
      - Project File Shares
      - Configuration Management Databases (CMDBs)
      - SharePoint/Confluence sites hosting ICS documentation
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: |-
          SEARCH (Windows Event ID 5145 AND Accesses includes 'ReadData') OR (Zeek smb_files.log AND action is 'file_read')
          WHERE (filename CONTAINS 'SCADA' OR 'P&ID' OR 'RTU' OR 'PLC' OR 'HMI' OR 'Historian' OR 'Network_Diagram')
          AND user NOT IN (ICS_Allowlist_Group)
          RETURN user, source_host, filename, timestamp
  - question: Is any user-host pair accessing an anomalously high number of unique files or file types from ICS repositories?
    context: |-
      This question seeks to identify bulk file collection behavior. Adversaries often copy large numbers of files rather than specific ones. By establishing a baseline of normal file access for each user-host combination, we can detect significant deviations that indicate mass data gathering. The check for Shannon entropy of file extensions helps detect when a user suddenly starts accessing a wider variety of file types than usual, which can also be indicative of broader reconnaissance.
    answer_sources:
      - Windows Event ID 5145
      - Windows Sysmon Event ID 11
      - Zeek smb_files.log
      - ICS File Servers
      - Engineering Workstations (EWS)
      - Document Management Systems (DMS)
      - Project File Shares
      - Configuration Management Databases (CMDBs)
      - SharePoint/Confluence sites hosting ICS documentation
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: |-
          FOR each user-host pair:
            BASELINE = 99th_percentile(unique_file_count) over last 30 days in 15-min windows
            CURRENT = count(unique_files) in last 15 mins
            IF CURRENT > BASELINE THEN ALERT

          FOR each user:
            BASELINE_ENTROPY = historical_shannon_entropy(file_extensions) over 1-hour windows
            CURRENT_ENTROPY = shannon_entropy(file_extensions) in last 1 hour
            IF CURRENT_ENTROPY spikes > BASELINE_ENTROPY THEN ALERT
  - question: Can we detect anomalous file access patterns using a machine learning model?
    context: |-
      This question leverages machine learning to identify subtle anomalies that rule-based methods might miss. An Isolation Forest model can consider multiple features simultaneously—such as the user, time of day, file path, and file extension—to build a comprehensive profile of normal activity. It can then flag access patterns that are unusual across these dimensions, such as a user accessing files from an unusual location during non-business hours, even if the volume isn't high.
    answer_sources:
      - Windows Event ID 5145
      - Windows Sysmon Event ID 11
      - Zeek smb_files.log
      - ICS File Servers
      - Engineering Workstations (EWS)
      - Document Management Systems (DMS)
      - Project File Shares
      - Configuration Management Databases (CMDBs)
      - SharePoint/Confluence sites hosting ICS documentation
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: |-
          MODEL = train_isolation_forest(features: user, host, path_depth, extension, time_of_day, keyword_match, etc.)
          FOR each user in 1-hour window:
            SCORE = model.predict(user_activity_features)
            IF SCORE > 99.5th_percentile(all_scores) THEN ALERT
  - question: Are ICS information repositories communicating with known malicious IPs or unauthorized external services?
    context: |-
      This question focuses on detecting data exfiltration to known-bad destinations. It checks for any network traffic from sensitive ICS repositories to IP addresses listed in threat intelligence feeds. It also looks for connections to unauthorized cloud storage, webmail, or paste sites, which are common channels for exfiltration. A small amount of data transfer (e.g., >1KB) to such a service is a strong indicator of compromise.
    answer_sources:
      - Zeek conn.log
      - Zeek files.log
      - Zeek dns.log
      - Zeek ssl.log
      - Zeek http.log
      - Zeek ftp.log
      - Process Historian Servers
      - Control System Databases (SQL, Oracle)
      - OPC DA/HDA servers
      - ICS File Servers
      - Engineering Workstations acting as data aggregation points
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: |-
          SEARCH Zeek conn.log
          WHERE source_ip IN (NAI_IP_list) AND destination_ip NOT IN (Internal_CIDR_ranges)
          IF destination_ip IN (Threat_Intel_Feed) THEN ALERT
          ELSE
            LOOKUP destination_domain from Zeek dns.log/ssl.log
            IF destination_domain IN (Unauthorized_Service_List) AND bytes_out > 1024 THEN ALERT
  - question: Is any ICS information repository sending an anomalously large volume of data to external networks?
    context: |-
      This question aims to detect bulk data exfiltration by monitoring the volume of outbound traffic. Adversaries often exfiltrate large amounts of collected data in a short period. By establishing a baseline for normal outbound traffic volume for each sensitive host, we can detect significant spikes that exceed historical norms or pre-defined hard thresholds (e.g., 500MB/hour), which strongly suggests data theft.
    answer_sources:
      - Zeek conn.log
      - Zeek files.log
      - Zeek dns.log
      - Zeek ssl.log
      - Zeek http.log
      - Zeek ftp.log
      - Process Historian Servers
      - Control System Databases (SQL, Oracle)
      - OPC DA/HDA servers
      - ICS File Servers
      - Engineering Workstations acting as data aggregation points
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: |-
          FOR each NAI_host:
            HOURLY_BASELINE = 99th_percentile(hourly_bytes_out) over last 30 days
            SESSION_BASELINE = 99th_percentile(session_bytes_out) over last 30 days
            CURRENT_HOURLY = sum(bytes_out) in last 1 hour
            IF CURRENT_HOURLY > HOURLY_BASELINE OR CURRENT_HOURLY > 500MB THEN ALERT

            FOR each session:
              IF session_bytes_out > SESSION_BASELINE OR session_bytes_out > 100MB THEN ALERT
  - question: Can a time-series model detect anomalous patterns in network egress volume from ICS repositories?
    context: |-
      This question uses a more sophisticated time-series model to understand and predict normal network traffic patterns, including daily and weekly seasonality. Models like Prophet can create a forecast with confidence intervals. An alert is triggered when the actual traffic volume exceeds the predicted upper bound for a sustained period, indicating a deviation that is not explained by normal cyclical fluctuations. This is effective at catching 'low-and-slow' exfiltration that might not trigger simple threshold alerts.
    answer_sources:
      - Zeek conn.log
      - Zeek files.log
      - Zeek dns.log
      - Zeek ssl.log
      - Zeek http.log
      - Zeek ftp.log
      - Process Historian Servers
      - Control System Databases (SQL, Oracle)
      - OPC DA/HDA servers
      - ICS File Servers
      - Engineering Workstations acting as data aggregation points
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: |-
          MODEL = train_prophet_model(historical_egress_per_15min)
          FORECAST = model.predict(next_intervals)
          CURRENT_VOLUME = actual_egress_per_15min
          IF CURRENT_VOLUME > FORECAST.upper_bound for 2 consecutive intervals THEN ALERT
  - question: Are unauthorized accounts successfully logging into critical ICS repository hosts?
    context: |-
      This question checks for clear policy violations that could indicate a compromised account or misconfiguration. Access to critical ICS assets like Historians and EWS should be tightly controlled via Active Directory groups. Any successful logon by an account not in the designated authorized group for that specific host is a high-fidelity indicator of a potential security breach. Similarly, remote interactive logons (RDP) should be restricted to a small, explicit allowlist.
    answer_sources:
      - Windows Event ID 4624
      - Zeek conn.log
      - Engineering Workstations (EWS)
      - Historian Servers
      - Human-Machine Interface (HMI) consoles
      - Domain Controllers
      - Jump Servers within the ICS network
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: |-
          SEARCH Windows Event ID 4624 (Successful Logon) on NAI hosts
          IF user NOT IN (Host_Authorized_AD_Group) THEN ALERT (High)
          IF LogonType is 10 AND user NOT IN (Remote_Access_Allowlist) THEN ALERT (Medium)
  - question: Are there any successful logons to ICS repositories that exhibit multiple anomalous characteristics?
    context: |-
      This question uses a risk-scoring model to identify suspicious logons that may not violate a hard rule but are collectively unusual. A single anomaly, like logging in from a new workstation, might be benign. However, a combination of anomalies—such as a user logging in from a new country, at an unusual time, and from a new device—is highly suspicious. This approach aggregates weak signals into a stronger, more actionable alert.
    answer_sources:
      - Windows Event ID 4624
      - Zeek conn.log
      - Engineering Workstations (EWS)
      - Historian Servers
      - Human-Machine Interface (HMI) consoles
      - Domain Controllers
      - Jump Servers within the ICS network
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: |-
          FOR each successful logon:
            risk_score = 0
            IF logon_hour is unusual for user THEN risk_score += 3
            IF source_country is new for user THEN risk_score += 5
            IF source_workstation is new for user THEN risk_score += 2
            IF risk_score >= 5 THEN ALERT
  - question: Can a machine learning classifier identify suspicious logons to ICS repositories with high confidence?
    context: |-
      This question applies a supervised machine learning model (Random Forest) to classify logons as legitimate or suspicious. By training on historical data (ideally labeled by analysts), the model can learn complex, non-linear relationships between features like logon type, time of day, user privileges, and source location. This allows it to detect sophisticated attacks, like credential abuse, with a higher degree of accuracy and provide a confidence score for the analyst.
    answer_sources:
      - Windows Event ID 4624
      - Zeek conn.log
      - Engineering Workstations (EWS)
      - Historian Servers
      - Human-Machine Interface (HMI) consoles
      - Domain Controllers
      - Jump Servers within the ICS network
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: |-
          MODEL = train_random_forest(labeled_logon_data, features: LogonType, IsAdmin, TimeOfDay, IsNewGeo, etc.)
          FOR each new logon:
            PREDICTION, CONFIDENCE = model.predict(logon_features)
            IF PREDICTION is 'suspicious' AND CONFIDENCE > 0.90 THEN ALERT