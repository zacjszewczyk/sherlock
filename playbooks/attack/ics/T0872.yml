name: T0872: Indicator Removal on Host
id: 3a9c7b2f-8d1e-4f3a-9c6b-8d1e2f3a4b5c
description: This playbook addresses adversary attempts to hide their presence on critical Industrial Control System (ICS) hosts by removing indicators of compromise. This includes actions such as clearing Windows event logs, executing mass file deletions in log directories, deleting command-line history files, and stopping or disabling the Windows EventLog service. The goal is to detect these evasion techniques on key assets like Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Historian Servers, and OT Domain Controllers.
type: technique
related:
- TA0103: Evasion
contributors:
- Zachary Szewczyk
- Ask Sage
created: '2025-10-01'
modified: '2025-10-01'
version: 1.0
tags: none
questions:
- question: Has an unauthorized user cleared the Windows audit log on a critical ICS host?
  context: The clearing of the Windows Security audit log (Event ID 1102) is a significant indicator of an adversary attempting to erase their tracks. This action is highly unusual during normal operations. Investigating whether the initiating user was authorized and if the action occurred within a scheduled maintenance window is critical to distinguishing between malicious activity and legitimate administrative tasks.
  answer_sources:
  - Windows Event ID 1102
  - Windows Event ID 4624
  - Windows Event ID 4688
  - Zeek conn.log
  - Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Historian Servers, and OT Domain Controllers.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |-
      SEARCH for (Windows Event ID 1102) on hosts tagged 'ICS'.
      FOR each event:
        GET the user from the event.
        GET the most recent logon event (Windows Event ID 4624) for that user on that host.
        CHECK if user is in 'authorized administrators' list.
        CHECK if event timestamp is within a 'scheduled maintenance window'.
        GET source IP from logon event and cross-reference with Zeek conn.log for unexpected network segments.
      ALERT if user is not authorized OR timestamp is outside maintenance window.
- question: Has there been an anomalous occurrence of audit log clearing on an ICS host?
  context: Because clearing the audit log is an extremely rare event in a production ICS environment, any occurrence can be treated as a statistical anomaly. This question focuses on establishing a baseline (which is likely zero) and alerting on any deviation. Correlating the event with a recent interactive logon (Logon Type 2 or 10) significantly increases the confidence that an active intruder is responsible, as they are likely cleaning up immediately after performing other actions.
  answer_sources:
  - Windows Event ID 1102
  - Windows Event ID 4624
  - Windows Event ID 4688
  - Zeek conn.log
  - Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Historian Servers, and OT Domain Controllers.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |-
      FOR each ICS host:
        CALCULATE 90-day baseline count of Windows Event ID 1102 (expected to be 0).
        ALERT on any new occurrence of Event ID 1102.
        ENRICH alert by finding the last interactive logon (Event ID 4624, Type 2 or 10) on the host.
        CALCULATE time delta between logon and log clear event.
        INCREASE risk score if delta < 300 seconds.
- question: Does the clearing of an audit log on an ICS host deviate from the established normal behavior for the user or entity involved?
  context: User and Entity Behavior Analytics (UEBA) can identify sophisticated threats by modeling normal activity and flagging deviations. Even if a legitimate administrator account is compromised, a UEBA system can detect that the action of clearing the audit log is uncharacteristic for that user, or that it occurred at an anomalous time or from an unusual source location. This provides a powerful way to detect credential abuse.
  answer_sources:
  - Windows Event ID 1102
  - Windows Event ID 4624
  - Windows Event ID 4688
  - Zeek conn.log
  - Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Historian Servers, and OT Domain Controllers.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |-
      QUERY UEBA system for high-risk anomalies associated with user accounts on ICS hosts.
      FILTER for anomalies related to Windows Event ID 1102.
      INVESTIGATE alerts where the model flags the log clearing as anomalous based on user history, time of day, source IP, or other features.
- question: Have known file wiping utilities or commands been used to delete files from sensitive log directories on ICS hosts?
  context: Adversaries often use specific command-line utilities (e.g., 'wevtutil.exe cl', 'sdelete.exe', 'cipher.exe /w') to surgically remove evidence of their activities. This question focuses on creating a high-fidelity detection rule that looks for the execution of these commands (via Event ID 4688) specifically targeting critical system or application log directories. Correlating this with file deletion events (Event ID 4663) provides confirmation of the action's success.
  answer_sources:
  - Windows Event ID 4663
  - Windows Event ID 4688
  - Zeek fileinfo.log
  - Zeek pe.log
  - File systems on Engineering Workstations, HMIs, Process Control Servers, and Historian Servers, specifically directories containing system logs, ICS vendor-specific application logs, and user profiles.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |-
      SEARCH for process execution (Event ID 4688) on ICS hosts where command line contains ('wevtutil.exe cl', 'del /s /q', 'sdelete.exe', 'cipher.exe /w') AND targets a known log directory.
      CORRELATE with file deletion events (Event ID 4663, AccessMask 0x10000) for the same directories.
      ENRICH with process hash reputation from threat intelligence or Zeek pe.log.
      ALERT on confirmed matches.
- question: Has there been a statistically significant spike in file deletions within log directories on an ICS host?
  context: Instead of looking for a specific command, this question seeks to identify the effect of indicator removalâ€”a large number of deleted files in a short time. By establishing a rolling baseline of normal file deletion activity, we can alert on spikes that exceed a statistical threshold (e.g., the 99th percentile). A sudden drop in the entropy of file extensions being deleted can also indicate a programmatic script cleaning up specific file types (e.g., all '.log' files), strengthening the detection.
  answer_sources:
  - Windows Event ID 4663
  - Windows Event ID 4688
  - Zeek fileinfo.log
  - Zeek pe.log
  - File systems on Engineering Workstations, HMIs, Process Control Servers, and Historian Servers, specifically directories containing system logs, ICS vendor-specific application logs, and user profiles.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |-
      FOR each ICS host, user, and process:
        MAINTAIN a 7-day rolling baseline of file deletion counts (Event ID 4663) in log directories.
        ALERT if deletion count in a 15-minute window exceeds the 99th percentile.
        SIMULTANEOUSLY, calculate Shannon entropy of file extensions deleted by a process in a 60-second window.
        ALERT if entropy drops below the 5th percentile.
- question: Are there anomalous patterns or coordinated campaigns of file deletions across multiple ICS hosts?
  context: Advanced adversaries may attempt to remove indicators across multiple compromised systems simultaneously. This question leverages machine learning models to detect such coordinated behavior. A time-series model can flag an abnormal rate of deletions on a single host, while a clustering algorithm can group hosts or users exhibiting similar anomalous deletion patterns (e.g., deleting the same files at the same time), revealing a wider campaign.
  answer_sources:
  - Windows Event ID 4663
  - Windows Event ID 4688
  - Zeek fileinfo.log
  - Zeek pe.log
  - File systems on Engineering Workstations, HMIs, Process Control Servers, and Historian Servers, specifically directories containing system logs, ICS vendor-specific application logs, and user profiles.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |-
      INPUT file deletion event rate (Event ID 4663) per host into a time-series anomaly detection model (e.g., LSTM).
      ALERT on hosts with high anomaly scores.
      INPUT features of anomalous deletions (rate, directory, process, time) into a clustering algorithm (e.g., DBSCAN).
      INVESTIGATE clusters of hosts/users as potential coordinated campaigns.
- question: Has a command-line history file been deleted on an ICS host?
  context: Deleting shell history files (e.g., PowerShell's 'ConsoleHost_history.txt' or Linux's '.bash_history') is a direct attempt by an adversary to hide the commands they have executed. This is not a normal administrative action. This question focuses on detecting the deletion or modification of these specific files, which serves as a high-confidence indicator of malicious activity.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 4663
  - Zeek conn.log
  - User profile directories on Engineering Workstations (EWS) and other ICS hosts where operators use command-line interfaces (e.g., C:\Users\<user>\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\).
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |-
      SEARCH for file deletions (Event ID 4663, AccessMask 0x10000) OR command executions (Event ID 4688) on ICS hosts.
      FILTER for events where the target file name is ('ConsoleHost_history.txt', '.bash_history', etc.).
      ESCALATE priority if the parent process is not a standard shell OR the user is not a whitelisted administrator.
      ALERT on any match.
- question: Has the deletion of a command history file occurred shortly after a user logged in?
  context: Because deleting command history is an extremely rare and suspicious event, any occurrence warrants an alert. This question adds a layer of statistical validation by measuring the time between an interactive logon and the deletion event. A very short delta (e.g., under two minutes) strongly suggests an attacker is covering their tracks immediately after completing their objectives and before logging off.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 4663
  - Zeek conn.log
  - User profile directories on Engineering Workstations (EWS) and other ICS hosts where operators use command-line interfaces (e.g., C:\Users\<user>\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\).
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |-
      ALERT on any deletion of a known command history file (as it exceeds the 99.9th percentile of a 30-day baseline).
      FOR each alert:
        FIND the most recent interactive logon (Event ID 4624, Type 2 or 10) for the user on the host.
        CALCULATE the time delta between logon and deletion.
        MARK as high-confidence malicious activity if delta < 120 seconds.
- question: Was the command used to delete a history file identified as malicious by a command-line classifier?
  context: This question applies machine learning to add analytical rigor to the investigation. A command-line classifier can analyze the full command string used to delete the history file, looking at its structure, arguments, and entropy. If the model flags the command itself as anomalous or malicious, it provides strong, independent confirmation that the action was not benign, even if other contextual clues are missing.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 4663
  - Zeek conn.log
  - User profile directories on Engineering Workstations (EWS) and other ICS hosts where operators use command-line interfaces (e.g., C:\Users\<user>\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\).
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |-
      FOR any command that deletes a history file:
        INPUT the command string, parent process, and other features into a command-line classifier (e.g., Random Forest).
        TRIGGER a high-fidelity alert if the model returns a high anomaly/malicious score.
        CORRELATE with other low-confidence indicators like unusual network activity in Zeek conn.log to boost confidence.
- question: Has the Windows EventLog service been stopped or disabled on an ICS host by an unauthorized user or outside a maintenance window?
  context: The Windows EventLog service is the core component responsible for logging. An adversary may stop or disable this service to 'blind' the system before performing further malicious actions. This is a brazen and highly suspicious act. This question focuses on detecting the service state change and immediately cross-referencing it with user authorization and maintenance schedules to rule out legitimate administrative activity.
  answer_sources:
  - Windows Event ID 7036
  - Windows Event ID 7040
  - Windows Event ID 4624
  - Windows Event ID 4688
  - Zeek conn.log
  - Service Control Manager and system services on critical ICS hosts, including EWS, HMIs, Historians, and OT Domain Controllers.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |-
      SEARCH for (Event ID 7036 AND service='EventLog' AND state='stopped') OR (Event ID 7040 AND service='EventLog' AND new_type='Disabled').
      FOR each event:
        FIND the responsible user via preceding logon events (Event ID 4624).
        CHECK if user is whitelisted and if the event is within a maintenance window.
      ESCALATE for immediate response if checks fail.
- question: Has the EventLog service been stopped or disabled anomalously, especially shortly after an interactive logon?
  context: Stopping or disabling the EventLog service is so rare and critical that any occurrence outside of a strictly controlled change process is a major red flag. This question treats any such event as a severe statistical anomaly. Calculating the time between the service change and the last interactive logon adds crucial context; a short delay is a strong indicator of an active attacker attempting to disable logging before proceeding.
  answer_sources:
  - Windows Event ID 7036
  - Windows Event ID 7040
  - Windows Event ID 4624
  - Windows Event ID 4688
  - Zeek conn.log
  - Service Control Manager and system services on critical ICS hosts, including EWS, HMIs, Historians, and OT Domain Controllers.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |-
      ESTABLISH a 1-year baseline for EventLog stop/disable events (expected to be near zero).
      ALERT on any occurrence of Event ID 7036 (stopped) or 7040 (disabled) for the EventLog service outside a maintenance window.
      CALCULATE time delta from the last interactive logon (Event ID 4624, Type 2 or 10).
      FLAG as highly suspicious if delta < 60 seconds.
- question: Did the stopping or disabling of the EventLog service occur as part of an anomalous sequence of service control events?
  context: Legitimate service management often follows a predictable pattern (e.g., stop, reconfigure, start). Malicious actions often break these patterns. This question uses a sequence-based model to learn the normal flow of service control events. An anomalous sequence, such as a 'stop' event that is never followed by a 'start', or a 'disable' event with no associated maintenance activity, would be flagged by the model as a high-risk anomaly requiring investigation.
  answer_sources:
  - Windows Event ID 7036
  - Windows Event ID 7040
  - Windows Event ID 4624
  - Windows Event ID 4688
  - Zeek conn.log
  - Service Control Manager and system services on critical ICS hosts, including EWS, HMIs, Historians, and OT Domain Controllers.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |-
      INPUT sequences of service control events (Event IDs 7036, 7040, etc.) into a sequence-based anomaly detection model (e.g., LSTM autoencoder).
      ALERT with a high anomaly score if the model detects an unusual sequence involving the EventLog service, such as:
        - A 'stop' event not followed by a 'start' in a typical timeframe.
        - A 'disable' event with no related authorized activity.