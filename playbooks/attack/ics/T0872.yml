name: 'T0872: Indicator Removal on Host'
id: 'f47ac10b-58cc-4372-a567-0e02b2c3d479'
description: 'This playbook helps investigate whether an adversary is attempting to hide their presence on critical Industrial Control Systems (ICS) hosts. It focuses on detecting unauthorized attempts to erase forensic evidence, such as clearing Windows audit logs (Event ID 1102), executing file wiping utilities or mass file deletions in sensitive log directories (Event IDs 4663, 4688), removing command-line history files, and stopping or disabling the Windows EventLog service (Event IDs 7036, 7040). These activities are strong indicators of an adversary trying to cover their tracks after compromising a system.'
type: 'technique'
related:
  - 'TA0103: Evasion'
contributors: 'Zachary Szewczyk, Ask Sage'
created: '2025-10-01'
modified: '2025-10-01'
version: 1.0
tags: 'none'
questions:
  - question: 'Has the Windows audit log been cleared on a critical ICS host by an unauthorized user or outside of a maintenance window?'
    context: 'This question aims to detect a common anti-forensic technique where an adversary clears security logs to hide their activity. An occurrence of Windows Event ID 1102 is a high-fidelity indicator of this behavior. Correlating this event with user logon data, maintenance schedules, and network source information helps to quickly distinguish between legitimate administrative tasks and malicious actions, enabling rapid incident response.'
    answer_sources: 'Windows Event ID 1102, Windows Event ID 4624, Zeek conn.log, list of authorized administrators, schedule of maintenance windows. Named Asset/Information (NAI): Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Historian Servers, and OT Domain Controllers.'
    range: 'Last 90 days'
    queries: 'SEARCH for Event ID 1102 on ICS hosts. FOR each event, GET preceding logon (Event ID 4624) to find user. CHECK if user is authorized AND if time is within maintenance window. GET source IP from Zeek conn.log at event time. ALERT if unauthorized user, outside maintenance, or unexpected source IP.'
  - question: 'Has a statistically anomalous audit log clearing event occurred on an ICS host shortly after an interactive logon?'
    context: 'This question uses a statistical approach to identify suspicious log clearing. Since clearing audit logs on critical ICS hosts is exceptionally rare, any occurrence is anomalous. By specifically looking for these events happening shortly after a user has logged on interactively (e.g., via RDP), we can infer that the user who logged on is likely responsible, significantly increasing the confidence that this is a deliberate, malicious action rather than an automated or benign system process.'
    answer_sources: 'Windows Event ID 1102, Windows Event ID 4624 (Logon Type 2 or 10). Named Asset/Information (NAI): Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Historian Servers, and OT Domain Controllers.'
    range: 'Last 90 days'
    queries: 'SEARCH for Event ID 1102 on ICS hosts. COMPARE to 90-day baseline; ALERT if count > 99.9th percentile. FOR each alert, FIND last interactive logon (Event ID 4624, Type 2/10). CALCULATE time delta. IF delta < 300 seconds, INCREASE risk score.'
  - question: 'Has a user account cleared the audit log on an ICS host in a manner that deviates from its established behavioral profile?'
    context: 'This question leverages User and Entity Behavior Analytics (UEBA) to detect sophisticated threats. Even authorized administrators have predictable patterns of behavior. A UEBA model can learn these patterns (e.g., typical logon times, source workstations, common commands). If an account, even a privileged one, clears the audit log at an unusual time or from an unusual location, it constitutes a high-risk anomaly that could indicate account compromise or insider threat.'
    answer_sources: 'Windows Event ID 1102, UEBA model data (user logon times, source IPs, command history). Named Asset/Information (NAI): Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Historian Servers, and OT Domain Controllers.'
    range: 'Last 90 days'
    queries: 'INPUT Event ID 1102 into UEBA model. MODEL checks if user has history of this action. MODEL checks if time of action is anomalous for this user. ALERT if action or time is anomalous, include model confidence score.'
  - question: 'Has a known file wiping utility or command been used to delete files in sensitive system or ICS application log directories?'
    context: 'This question focuses on detecting the explicit use of tools or commands (wevtutil.exe cl, sdelete.exe, etc.) to destroy evidence. Monitoring for the execution of these specific commands (Event ID 4688) within critical log directories provides a high-confidence signal of malicious intent. Correlating this with file deletion events (Event ID 4663) and checking the reputation of the executing process adds further evidence to confirm an attack.'
    answer_sources: 'Windows Event ID 4688, Windows Event ID 4663 (AccessMask 0x10000), Zeek fileinfo.log, Zeek pe.log, Threat Intelligence feeds. Named Asset/Information (NAI): File systems on Engineering Workstations, HMIs, Process Control Servers, and Historian Servers.'
    range: 'Last 90 days'
    queries: 'SEARCH for process creation (Event ID 4688) with command line containing ''wevtutil.exe cl'', ''del /s /q'', ''sdelete.exe'', etc. targeting log directories. CORRELATE with file delete events (Event ID 4663, AccessMask 0x10000) in same directories. CHECK process hash reputation. ALERT on match.'
  - question: 'Is there a statistically significant spike in file deletions or a sudden drop in the variety of file types being deleted within log directories on an ICS host?'
    context: 'This question uses statistical methods to find evidence destruction that might not involve known wiping tools. A sudden, anomalous increase in file deletions within a short time frame can indicate a script or adversary manually cleaning up logs. Additionally, a sharp decrease in the entropy of file extensions being deleted (e.g., suddenly only .log files are deleted) suggests a targeted, programmatic cleanup, which is highly abnormal.'
    answer_sources: 'Windows Event ID 4663 (AccessMask 0x10000). Named Asset/Information (NAI): File systems on Engineering Workstations, HMIs, Process Control Servers, and Historian Servers.'
    range: 'Last 90 days'
    queries: 'MONITOR file deletions (Event ID 4663) in log directories. MAINTAIN 7-day baseline. ALERT if 15-min deletion count > 99th percentile. SEPARATELY, calculate Shannon entropy of deleted file extensions in 60-sec window. ALERT if entropy drops below 5th percentile.'
  - question: 'Are there anomalous patterns in the rate of file deletions across one or more ICS hosts that suggest a coordinated campaign?'
    context: 'This question seeks to identify large-scale or coordinated cleanup operations across multiple systems. A time-series model (like LSTM) can detect subtle anomalies in the rate of file deletions on a single host that might be missed by simple thresholding. A clustering algorithm (like DBSCAN) can then group hosts or users exhibiting similar anomalous deletion behaviors (e.g., same time of day, same target directories), revealing a wider, coordinated attack campaign.'
    answer_sources: 'Windows Event ID 4663. Named Asset/Information (NAI): File systems on Engineering Workstations, HMIs, Process Control Servers, and Historian Servers.'
    range: 'Last 90 days'
    queries: 'INPUT file deletion rate (Event ID 4663) into LSTM model; ALERT on anomalous spikes. CLUSTER anomalous events using DBSCAN based on features (host, user, directory, time). IDENTIFY clusters as potential coordinated campaigns.'
  - question: 'Has a user or process attempted to delete a command-line history file on an ICS host?'
    context: 'This question targets a very specific and highly suspicious adversary action: deleting the history of commands they have run. Legitimate users rarely, if ever, delete these files (ConsoleHost_history.txt, .bash_history). Monitoring for deletion (Event ID 4663) or command execution (Event ID 4688) that targets these specific filenames is a high-fidelity way to detect an adversary trying to cover their tracks.'
    answer_sources: 'Windows Event ID 4688, Windows Event ID 4663 (AccessMask 0x10000). Named Asset/Information (NAI): User profile directories on Engineering Workstations (EWS) and other ICS hosts.'
    range: 'Last 90 days'
    queries: 'SEARCH for file deletions (Event ID 4663) or commands (Event ID 4688) where target is ''ConsoleHost_history.txt'', ''.bash_history'', etc. ESCALATE if parent process is not a standard shell or user is not whitelisted admin. ALERT on any match.'
  - question: 'Has a command history file been deleted shortly after a user logged on interactively?'
    context: 'This question uses the timing of events to increase detection confidence. Since deleting a command history file is almost always a malicious act, any occurrence is a statistical anomaly. By correlating the deletion with a recent interactive logon, we can strongly attribute the action to the logged-on user, indicating they are likely trying to hide commands they just executed. A short time delta (e.g., under two minutes) makes this a very high-confidence indicator.'
    answer_sources: 'Windows Event ID 4663, Windows Event ID 4624 (Logon Type 2 or 10). Named Asset/Information (NAI): User profile directories on Engineering Workstations (EWS) and other ICS hosts.'
    range: 'Last 90 days'
    queries: 'ALERT on any deletion of command history files. FOR each alert, FIND last interactive logon (Event ID 4624, Type 2/10) for the same user. CALCULATE time delta. IF delta < 120 seconds, flag as high-confidence malicious activity.'
  - question: 'Was the command used to delete a history file classified as malicious or anomalous by a machine learning model?'
    context: 'This question adds an advanced layer of analysis by examining the command itself. A machine learning classifier can analyze features of the command line used to delete the history file (e.g., arguments, length, obscurity). If the command receives a high anomaly score from the model, it provides strong corroborating evidence that the action was malicious, even if the command itself is not on a predefined blocklist. This helps detect novel or obfuscated techniques.'
    answer_sources: 'Windows Event ID 4688, Command-line classifier model, Zeek conn.log. Named Asset/Information (NAI): User profile directories on Engineering Workstations (EWS) and other ICS hosts.'
    range: 'Last 90 days'
    queries: 'INPUT command that deletes history file (from Event ID 4688) into classifier model. IF model returns high anomaly score, TRIGGER high-fidelity alert. CORRELATE with other indicators like unusual network activity.'
  - question: 'Has the Windows EventLog service been stopped or disabled on an ICS host by an unauthorized user or outside a maintenance window?'
    context: 'This question addresses a direct and severe method of evidence suppression: disabling the logging service itself. The ''EventLog'' service is critical for all Windows event logging. An attacker stopping or disabling it effectively blinds monitoring systems. This action is extremely rare in normal operations, so any unauthorized instance (detected via Event IDs 7036 or 7040) is a critical security event that requires immediate investigation.'
    answer_sources: 'Windows Event ID 7036, Windows Event ID 7040, Windows Event ID 4688, Windows Event ID 4624, list of authorized administrators, schedule of maintenance windows. Named Asset/Information (NAI): Service Control Manager and system services on critical ICS hosts.'
    range: 'Last 90 days'
    queries: 'SEARCH for Event ID 7036 (service=''EventLog'', state=''stopped'') OR Event ID 7040 (service=''EventLog'', new_start_type=''Disabled''). FIND associated user (Event ID 4624) and command (Event ID 4688). CHECK if user/time is authorized. ALERT if unauthorized.'
  - question: 'Has the EventLog service been stopped or disabled in a statistically anomalous manner, particularly soon after an interactive logon?'
    context: 'This question applies statistical analysis to an already high-confidence indicator. Given that stopping or disabling the EventLog service is almost unheard of outside of very specific, planned maintenance, any occurrence is a severe anomaly. By confirming that the event occurred shortly after a user logged on interactively, we can be highly confident that it was a deliberate, malicious act by that user to evade detection.'
    answer_sources: 'Windows Event ID 7036, Windows Event ID 7040, Windows Event ID 4624 (Logon Type 2 or 10). Named Asset/Information (NAI): Service Control Manager and system services on critical ICS hosts.'
    range: 'Last 90 days'
    queries: 'MONITOR for Event ID 7036/7040 for ''EventLog'' service. ALERT on any occurrence outside maintenance window (exceeds 99.9th percentile of 1-year baseline). FIND last interactive logon (Event ID 4624). IF time delta < 60 seconds, flag as highly suspicious.'
  - question: 'Did the stopping or disabling of the EventLog service occur as part of an anomalous sequence of service control events?'
    context: 'This question uses sequence analysis to understand the context of the service change. Legitimate maintenance often involves a predictable sequence of events (e.g., stop service, reconfigure, start service). An attacker, however, might just stop the service and leave it stopped. A sequence-based model can learn the normal patterns and flag a ''stop'' or ''disable'' event that occurs in isolation or in an unusual order as a high-risk anomaly, indicating malicious activity rather than a failed but legitimate administrative task.'
    answer_sources: 'Windows Event ID 7036, Windows Event ID 7040, Sequence-based anomaly detection model. Named Asset/Information (NAI): Service Control Manager and system services on critical ICS hosts.'
    range: 'Last 90 days'
    queries: 'INPUT sequence of service control events (Event ID 7036/7040) into LSTM model. MODEL is trained on normal sequences (e.g., stop->reconfigure->start). ALERT if an anomalous sequence is detected, such as a ''stop'' without a ''start'', or a ''disable'' event.'