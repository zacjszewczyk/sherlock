name: 'T0883: Internet Accessible Device'
id: 9e3b1c7d-8f6a-4b5c-9d1e-2f3a4b5c6d7e
description: This playbook helps to determine if an adversary is attempting to gain initial access to an ICS network via an internet-exposed device. It focuses on identifying several key indicators of compromise, including inbound network scanning from external sources targeting ICS-specific or remote access ports; high-frequency brute-force or password spraying attacks indicated by failed remote logins; successful but anomalous remote logins that deviate from established user behavior profiles (e.g., from a new location or at an unusual time); and suspicious post-login activity, such as connections to known C2 servers or unusual data exfiltration patterns.
type: technique
related:
  - 'TA0108: Initial Access'
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Are there inbound connections from unapproved external IPs to sensitive OT ports that exhibit scanning behavior (e.g., connection rejections, incomplete handshakes, or very short-lived sessions)?
    context: This question aims to detect initial reconnaissance or scanning activity targeting internet-exposed ICS assets. By filtering for connections from non-allowlisted external sources to specific ICS or remote access ports and looking for signs of scanning (rejected states, incomplete handshakes, or brief connections with minimal data transfer), analysts can identify potential precursors to an intrusion attempt. Enriching the source IP with threat intelligence provides additional context on whether the activity originates from a known malicious actor.
    answer_sources:
      - Zeek conn.log
      - Zeek notice.log
      - Network security monitoring sensors at the IT/OT boundary (Purdue Level 3.5/DMZ)
      - Internet gateway firewalls
      - Network taps within the supervisory control network (Purdue Level 2)
      - Threat Intelligence Feeds
      - IP Allowlists
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          SEARCH Zeek:conn.log WHERE
          source_ip is NOT private AND source_ip is NOT in approved_remote_access_list AND
          destination_ip is in OT_network_range AND
          destination_port is in [102, 502, 9600, 20000, 44818, 3389, 5900] AND
          ((connection_state = 'S0' OR connection_state = 'REJ') OR
          (connection_state = 'SF' AND duration < 5s AND total_bytes < 100))
          ENRICH source_ip with threat_intelligence
          ALERT
  - question: Is there a statistical anomaly in the number of unique external IP addresses attempting to connect to specific OT ports, or is a single external IP scanning multiple ports on an OT asset?
    context: This question uses statistical methods to detect more subtle or distributed scanning. By baselining the normal hourly count of unique source IPs per port, a sudden spike exceeding a threshold (like the 99th percentile) can indicate a widespread scan. Additionally, calculating the Shannon entropy of destination ports targeted by a single source IP helps differentiate between a targeted probe and a broad port scan; high entropy suggests an attacker is looking for any open port, a common reconnaissance technique.
    answer_sources:
      - Zeek conn.log
      - Zeek notice.log
      - Network security monitoring sensors at the IT/OT boundary (Purdue Level 3.5/DMZ)
      - Internet gateway firewalls
      - Network taps within the supervisory control network (Purdue Level 2)
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          // Query 1: Volume Anomaly
          BASELINE hourly unique source_ip count per destination_port for last 14 days
          CALCULATE 99th_percentile threshold
          SEARCH Zeek:conn.log WHERE current_hourly_count > threshold
          ALERT
          // Query 2: Port Scan Entropy
          FOR each external source_ip over 1 hour:
          CALCULATE Shannon entropy of destination_ports
          IF entropy > high_entropy_threshold
          ALERT
  - question: Is the overall pattern of inbound connection attempts to the OT network deviating from the established norm, as identified by a machine learning model?
    context: This question leverages advanced machine learning to identify complex, coordinated, or low-and-slow scanning campaigns that might evade simpler rule-based or statistical methods. A time-series anomaly detection model (like an LSTM autoencoder) learns the normal rhythm and volume of inbound traffic, including different connection states. An alert is triggered when the current traffic pattern's reconstruction error is high, signifying a significant deviation that could represent a novel or sophisticated attack.
    answer_sources:
      - Zeek conn.log
      - Zeek notice.log
      - Network security monitoring sensors at the IT/OT boundary (Purdue Level 3.5/DMZ)
      - Internet gateway firewalls
      - Network taps within the supervisory control network (Purdue Level 2)
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          // Model Training (offline)
          TRAIN LSTM autoencoder model on 90+ days of hourly aggregated inbound connection data (from Zeek:conn.log), faceted by connection_state
          // Real-time Inference
          FOR each hour:
          FEED current connection data into model
          CALCULATE reconstruction_error
          IF reconstruction_error > learned_threshold
          ALERT
  - question: Is an external IP address generating a high volume of failed remote access logins against an OT asset in a short period, indicating a potential brute-force attack?
    context: This question focuses on detecting classic brute-force attacks by setting a simple, effective threshold. By counting failed logins (Event ID 4625) from a single external IP within a minute, analysts can quickly identify aggressive attempts to guess credentials. Enriching this alert with network protocol details from Zeek (RDP, SSH) and threat intelligence provides crucial context for triage and response.
    answer_sources:
      - Windows Event ID 4625
      - Zeek conn.log
      - Zeek rdp.log
      - Zeek ssh.log
      - Endpoint security logs on internet-facing Windows-based assets in the process control or supervisory networks (Purdue Levels 2-3)
      - Authentication logs from Domain Controllers in the IT/OT DMZ (Purdue Level 3.5)
      - Network security monitoring sensors at the network perimeter
      - Threat Intelligence Feeds
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          SEARCH WindowsEvent:4625 WHERE source_ip is NOT private
          AGGREGATE count by source_ip over 60s window
          IF count > 5
          ENRICH source_ip with threat_intel, Zeek:conn, Zeek:rdp, Zeek:ssh logs
          ALERT
  - question: Are we observing a statistically unusual rate of failed logins from an external source, and can we differentiate between a brute-force and a password-spraying attack?
    context: This question uses baselining and entropy calculation to add nuance to failed login detection. A statistical alert based on a deviation from the normal failed login rate can catch slower attacks. Furthermore, analyzing the entropy of targeted usernames from a single source IP is a powerful technique low entropy (many attempts on one or few accounts) points to a brute-force attack, while high entropy (one or few password attempts across many accounts) strongly suggests a password spraying attack.
    answer_sources:
      - Windows Event ID 4625
      - Zeek conn.log
      - Zeek rdp.log
      - Zeek ssh.log
      - Endpoint security logs on internet-facing Windows-based assets in the process control or supervisory networks (Purdue Levels 2-3)
      - Authentication logs from Domain Controllers in the IT/OT DMZ (Purdue Level 3.5)
      - Network security monitoring sensors at the network perimeter
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          // Query 1: Rate Anomaly
          BASELINE hourly failed login rate (Event 4625) per asset from external IPs for last 14 days
          CALCULATE 99th_percentile threshold
          SEARCH WindowsEvent:4625 WHERE current_rate > threshold
          ALERT
          // Query 2: Attack Type Entropy
          FOR each source_ip over 5 mins:
          CALCULATE Shannon entropy of target_account_name
          IF entropy is low, TAG as 'brute-force'
          IF entropy is high, TAG as 'password-spray'
          ALERT
  - question: Can a machine learning model, trained on various contextual features, proactively classify external failed login attempts as malicious with a high degree of confidence?
    context: This question proposes a sophisticated, proactive approach using a supervised machine learning model. By training a model (like Random Forest) on a rich feature set—including event log details, source IP reputation, geolocation, time of day, and protocol specifics—the system can learn the subtle characteristics of malicious login attempts. This allows for more accurate and automated detection, generating high-confidence alerts that reduce analyst fatigue.
    answer_sources:
      - Windows Event ID 4625
      - Zeek conn.log
      - Zeek rdp.log
      - Zeek ssh.log
      - Endpoint security logs on internet-facing Windows-based assets in the process control or supervisory networks (Purdue Levels 2-3)
      - Authentication logs from Domain Controllers in the IT/OT DMZ (Purdue Level 3.5)
      - Network security monitoring sensors at the network perimeter
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          // Model Training (offline)
          TRAIN supervised classification model on labeled historical data (Event 4625, Zeek logs, etc.)
          // Real-time Inference
          FOR each new failed login event (Event 4625) from external IP:
          EXTRACT features (Logon Type, Status, IP geo, ASN, time, etc.)
          SCORE event with model
          IF classification is 'malicious' AND confidence_score > 0.9
          ALERT
  - question: Has a successful remote login to an OT asset occurred from an external IP address that is not on an approved allowlist?
    context: This question represents a critical, high-fidelity detection. A successful login from an unapproved source is a major security event and a potential sign of compromise. Using an allowlist, whether per-user or a general corporate list, provides a straightforward and effective way to flag unauthorized access. This is often one of the most important alerts to investigate for initial access.
    answer_sources:
      - Windows Event ID 4624
      - Zeek conn.log
      - Zeek rdp.log
      - Zeek ssh.log
      - Approved Remote Access IP Whitelist
      - Active Directory Logs
      - Endpoint security logs on internet-facing Windows-based OT assets
      - Authentication logs from central servers (Domain Controllers, RADIUS) in the IT/OT DMZ
      - Identity and Access Management (IAM) system or asset database
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          SEARCH WindowsEvent:4624 WHERE
          logon_type IN [3, 10] AND
          source_ip is NOT private AND
          source_ip is NOT in approved_ip_allowlist(target_account_name)
          ALERT as HIGH_PRIORITY
  - question: Has a user logged in successfully from a location, network, or at a time that deviates significantly from their established historical behavior?
    context: This question addresses the scenario where an attacker uses legitimate, stolen credentials. Simple allowlists would not catch this. By building a behavioral profile for each user (typical locations, ASNs, login times), the system can calculate a risk score for each new login. A high score, indicating multiple deviations from the norm (e.g., new country AND unusual time), can flag a likely account takeover.
    answer_sources:
      - Windows Event ID 4624
      - Zeek conn.log
      - Zeek rdp.log
      - Zeek ssh.log
      - Approved Remote Access IP Whitelist
      - Active Directory Logs
      - Endpoint security logs on internet-facing Windows-based OT assets
      - Authentication logs from central servers (Domain Controllers, RADIUS) in the IT/OT DMZ
      - Identity and Access Management (IAM) system or asset database
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          // Profile Building (ongoing)
          FOR each user, build profile from 90 days of Event 4624: {countries}, {ASNs}, {hours}, {subnets}
          // Real-time Scoring
          FOR each new login (Event 4624):
          risk_score = 0
          IF new_login.country NOT in user.profile.countries, risk_score += 3
          IF new_login.hour NOT in user.profile.hours, risk_score += 1
          IF new_login.subnet NOT in user.profile.subnets, risk_score += 1
          IF risk_score > threshold
          ALERT
  - question: Does a successful login event appear as a statistical anomaly when evaluated by an unsupervised UEBA model that has learned the user's normal behavior?
    context: This question employs an advanced UEBA approach to detect credential compromise. Unlike simple profiling, an unsupervised model (like Isolation Forest) can learn complex, multi-dimensional patterns of normalcy across many features (login timing, geo-distance, IP reputation, etc.). It can then flag any login that falls outside this learned boundary as an anomaly, capable of detecting sophisticated attacks that might not trigger individual rule-based checks.
    answer_sources:
      - Windows Event ID 4624
      - Zeek conn.log
      - Zeek rdp.log
      - Zeek ssh.log
      - Approved Remote Access IP Whitelist
      - Active Directory Logs
      - Endpoint security logs on internet-facing Windows-based OT assets
      - Authentication logs from central servers (Domain Controllers, RADIUS) in the IT/OT DMZ
      - Identity and Access Management (IAM) system or asset database
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          // Model Training (offline/ongoing)
          FOR each user/group, TRAIN unsupervised model (e.g., Isolation Forest) on historical login features (time since last login, geo distance, ASN, etc.)
          // Real-time Inference
          FOR each new login:
          EXTRACT features
          SCORE login with model
          IF score indicates anomaly
          ALERT as HIGH_RISK
  - question: Following a suspicious login, did the user session lead to a process making a network connection to a known command-and-control (C2) server?
    context: This question is designed to rapidly confirm a compromise by linking a suspicious login to clear post-exploitation activity. It uses the anomalous login as a trigger to scrutinize subsequent actions. Correlating a process creation event (Event ID 4688) with an outbound network connection (Zeek conn.log) to a destination on a C2 threat intelligence list provides strong, actionable evidence that the host is compromised and communicating with an attacker.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Windows Event ID 4688
      - Windows Event ID 5156
      - Network security monitoring sensors (Zeek) at the ICS perimeter and IT/OT DMZ
      - Endpoint detection and response (EDR) logs on the source OT asset
      - DNS server logs
      - Threat Intelligence Feeds
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          ON an 'Anomalous Login' alert for a host:
          TRIGGER search for 60 mins post-login:
          SEARCH (WindowsEvent:4688 AND Zeek:conn.log) WHERE
          host_ip is compromised_host_ip AND
          Zeek:conn.log.destination_ip is on C2_threat_intel_list
          CORRELATE process_name and connection details
          ALERT
  - question: After a suspicious login, is the OT asset exhibiting unusual network behavior, such as connecting to new destinations, using non-standard ports, or transferring abnormal amounts of data?
    context: This question aims to detect post-exploitation activity by baselining the asset's typical network behavior. Even if a destination isn't on a threat list, a deviation from the norm can be a strong indicator of compromise. For example, an HMI that never connects to servers in a new country, suddenly starts sending data there, or an engineer workstation that begins using a port associated with a specific RAT, would be flagged as statistical outliers, warranting investigation.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Windows Event ID 4688
      - Windows Event ID 5156
      - Network security monitoring sensors (Zeek) at the ICS perimeter and IT/OT DMZ
      - Endpoint detection and response (EDR) logs on the source OT asset
      - DNS server logs
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          // Profile Building (ongoing)
          FOR each asset, build 30-day baseline of outbound connections: {dest_countries}, {dest_ASNs}, {dest_ports}, {data_transfer_percentiles}
          // Real-time Monitoring Post-Alert
          ON an 'Anomalous Login' alert for an asset:
          FOR each new outbound connection:
          IF connection.dest_country is outlier OR
          connection.dest_port is outlier OR
          connection.bytes_transferred is outlier (e.g., > 99th percentile)
          ALERT
  - question: Does the sequence of actions (process creations, DNS lookups, network connections) following a suspicious login deviate from the learned sequence of normal user activity?
    context: This is a highly sophisticated question that looks not just at individual events, but at the story they tell. A sequence analysis model (like an HMM or RNN) learns the typical grammar of user behavior, e.g., "User opens RDP client, which spawns a specific engineering tool, which connects to an internal data historian." An attacker's sequence might look very different "User opens RDP client, which spawns PowerShell, which makes a DNS request to a dynamic DNS domain, which initiates an outbound connection." The model would flag this sequence as having a low probability of being normal, indicating a likely compromise.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Windows Event ID 4688
      - Windows Event ID 5156
      - Network security monitoring sensors (Zeek) at the ICS perimeter and IT/OT DMZ
      - Endpoint detection and response (EDR) logs on the source OT asset
      - DNS server logs
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          // Model Training (offline)
          TRAIN sequence model (HMM/RNN) on typical post-login event sequences (Event 4688 -> Zeek:dns -> Zeek:conn)
          // Real-time Inference
          ON an 'Anomalous Login' alert:
          CAPTURE subsequent event sequence
          FEED sequence into model
          IF model assigns low probability to sequence
          ALERT