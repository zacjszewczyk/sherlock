name: T0855: Unauthorized Command Message
id: c4d9a5b6-7e8f-4a01-8c4d-1e5f6a9b3c2d
description: This playbook helps identify when an adversary attempts to impair process
  control or cause a disruptive impact by sending unauthorized command messages to
  industrial control system (ICS) devices. It focuses on detecting commands that
  violate established rules, originate from unauthorized sources, occur at anomalous
  times, or are part of an unusual sequence. Evidence for this can be found in ICS
  protocol logs (e.g., Modbus, DNP3, EtherNet/IP, S7comm) and correlated with host-level
  events (e.g., Windows process creation logs) and contextual data like change management
  records. Detections may involve commands with values outside safe operational ranges,
  commands from unapproved IP addresses, commands spawned by non-standard parent
  processes like 'powershell.exe', or commands executed outside of normal business
  hours without authorization.
type: technique
related:
- TA0105: Impact
- TA0106: Impair Process Control
contributors:
- Zachary Szewczyk
- Ask Sage
created: '2025-10-01'
modified: '2025-10-01'
version: 1.0
tags: none
questions:
- question: Is a command that does not match an established allowlist being sent,
    and is it confirmed to be unauthorized by checking against the change management
    system?
  context: This question aims to detect unauthorized ICS commands by first checking
    them against a granular allowlist of approved {source IP, user account, destination
    IP, command_type, target_address_range} tuples. To reduce false positives from
    legitimate but unscheduled maintenance, any command that fails the allowlist check
    should then be automatically cross-referenced with the change management system.
    An alert is only finalized if no corresponding approved change record exists.
  answer_sources:
  - Zeek modbus.log
  - Zeek dnp3.log
  - Zeek enip.log
  - Windows Event ID 4624
  - Windows Event ID 4663
  - Change Management System Logs
  - Engineering Workstations (EWS) and Operator Stations (HMI) for command origination
    context
  - ICS Control Network (Purdue Model Levels 1 & 2) for monitoring command transmission
    to PLCs/RTUs
  - Authentication Servers for user identity correlation
  - Change Management database for operational context.
  range: last 90 days
  queries:
  - 'SEARCH Zeek ICS protocol logs for commands. IF a command does not match the allowlist,
    THEN query the change management system API for a matching record. IF no record
    is found, THEN generate a high-priority alert.'
- question: Has a critical command been issued at an unusual time or as part of an
    abnormal sequence, based on statistical baselines and Markov chain models?
  context: This question seeks to identify malicious commands by analyzing their timing
    and sequence, which often deviate from normal operational patterns. It involves
    two methods: 1) Profiling the timing of authorized commands to establish a statistical
    baseline and alerting when a command is issued at a time that falls outside the
    99th percentile of its normal distribution. 2) Modeling the normal operational
    workflow as a sequence of commands using a first-order Markov chain and alerting
    when a transition between command states occurs that has a historically very
    low probability (e.g., < 0.01).
  answer_sources:
  - Zeek modbus.log
  - Zeek dnp3.log
  - Zeek enip.log
  - Windows Event ID 4624
  - Windows Event ID 4663
  - Change Management System Logs
  - Engineering Workstations (EWS) and Operator Stations (HMI) for command origination
    context
  - ICS Control Network (Purdue Model Levels 1 & 2) for monitoring command transmission
    to PLCs/RTUs
  - Authentication Servers for user identity correlation
  - Change Management database for operational context.
  range: last 90 days
  queries:
  - 'PROFILE command timing and sequence over a 30-day baseline. FOR new commands,
    IF the command time is outside the 99th percentile OR the command sequence transition
    probability is less than 0.01, THEN generate an alert.'
- question: Has a machine learning model identified a command as an outlier, potentially
    correlated with recent anomalous host activity?
  context: This question leverages machine learning to detect subtle anomalies that
    rule-based systems might miss. A One-Class SVM model is trained on feature vectors
    (source IP, user ID, command type, parameters, time delta) representing normal
    commands. This model then scores new commands in real-time. An alert is generated
    for any command identified as an outlier. The alert's priority is escalated if
    the anomalous command is correlated with preceding suspicious activity on the
    source host, such as unauthorized access to HMI project files (Windows Event
    ID 4663), within the last hour.
  answer_sources:
  - Zeek modbus.log
  - Zeek dnp3.log
  - Zeek enip.log
  - Windows Event ID 4624
  - Windows Event ID 4663
  - Change Management System Logs
  - Engineering Workstations (EWS) and Operator Stations (HMI) for command origination
    context
  - ICS Control Network (Purdue Model Levels 1 & 2) for monitoring command transmission
    to PLCs/RTUs
  - Authentication Servers for user identity correlation
  - Change Management database for operational context.
  range: last 90 days
  queries:
  - 'SCORE new ICS commands using a trained One-Class SVM model. IF a command is
    identified as an outlier, THEN search for anomalous host events (e.g., Event
    ID 4663) on the source host in the last hour. IF a correlation is found, ESCALATE
    the alert.'
- question: Is an ICS write/operate command originating from an IP address that is
    not on the approved list of command initiators?
  context: This question addresses a fundamental security control: ensuring that
    only authorized devices can send critical commands. It requires creating and maintaining
    an explicit allow-list of IP addresses for all approved Engineering Workstations,
    HMIs, and control servers. A SIEM rule then monitors the source IP (`id.orig_h`)
    in Zeek ICS protocol logs and generates a high-priority alert for any command
    that originates from an IP address not on this list.
  answer_sources:
  - Zeek conn.log
  - Zeek modbus.log
  - Zeek dnp3.log
  - Zeek enip.log
  - Zeek s7comm.log
  - Process Control Network (PCN) segments, including network taps/sensors monitoring
    traffic to/from PLCs, RTUs, and field controllers at the Level 3.5 Industrial
    Demilitarized Zone (IDMZ), Level 3 Manufacturing Operations Management (MOM) Layer,
    and Level 2 Control System Layer.
  range: last 90 days
  queries:
  - 'CREATE and maintain an allow-list of authorized command initiator IPs. SEARCH
    Zeek ICS logs and COMPARE the source IP of each command against the allow-list.
    IF the source IP is not on the list, THEN generate a high-priority alert.'
- question: Has a new source IP address appeared and sent an anomalously high number
    of commands compared to established baselines?
  context: This question helps detect the introduction of a new, potentially malicious
    device on the network that begins communicating aggressively. The method involves
    baselining daily command counts per source IP over a 30-day window to establish
    normal behavior. An alert is generated if a source IP not seen in the last 30
    days appears and its daily command count exceeds the 99th percentile of all established
    IPs.
  answer_sources:
  - Zeek conn.log
  - Zeek modbus.log
  - Zeek dnp3.log
  - Zeek enip.log
  - Zeek s7comm.log
  - Process Control Network (PCN) segments, including network taps/sensors monitoring
    traffic to/from PLCs, RTUs, and field controllers at the Level 3.5 Industrial
    Demilitarized Zone (IDMZ), Level 3 Manufacturing Operations Management (MOM) Layer,
    and Level 2 Control System Layer.
  range: last 90 days
  queries:
  - 'AGGREGATE daily command counts per source IP over a 30-day rolling window to
    identify established IPs and calculate a 99th percentile command count threshold.
    IF a newly observed IP''s daily command count exceeds this threshold, THEN generate
    a medium-priority alert.'
- question: Has a supervised machine learning model classified a real-time ICS network
    event as 'unauthorized' with high confidence?
  context: This question uses a supervised machine learning approach for more nuanced
    detection. A pre-trained model (e.g., Gradient Boosting, Random Forest) analyzes
    various features from Zeek logs in real-time, such as source/destination IP, protocol,
    service, command type, duration, and bytes transferred. An alert is triggered
    if the model classifies an event as 'unauthorized' with a confidence score exceeding
    a high threshold (e.g., > 0.90), indicating a strong likelihood of malicious activity.
  answer_sources:
  - Zeek conn.log
  - Zeek modbus.log
  - Zeek dnp3.log
  - Zeek enip.log
  - Zeek s7comm.log
  - Process Control Network (PCN) segments, including network taps/sensors monitoring
    traffic to/from PLCs, RTUs, and field controllers at the Level 3.5 Industrial
    Demilitarized Zone (IDMZ), Level 3 Manufacturing Operations Management (MOM) Layer,
    and Level 2 Control System Layer.
  range: last 90 days
  queries:
  - 'DEPLOY a trained classification model to analyze real-time Zeek log data. IF
    the model classifies an event as ''unauthorized'' with a confidence score > 0.90,
    THEN generate an alert.'
- question: Was an ICS command message executed outside of its pre-defined, approved
    operational schedule or maintenance window?
  context: Adversaries may perform actions during off-hours to avoid detection. This
    question seeks to identify such activity by defining and maintaining a lookup
    table of approved operational schedules (e.g., business hours) and maintenance
    windows. A SIEM rule then compares the timestamp (`ts` field) of each command
    from Zeek logs against this schedule, generating a high-priority alert for any
    command executed outside of an approved time window.
  answer_sources:
  - Zeek modbus.log
  - Zeek enip.log
  - Zeek s7comm.log
  - Zeek dnp3.log
  - SCADA/HMI server segments, data historians, network taps, and industrial firewalls
    monitoring HMI, SCADA server, and PLC/RTU communications within the ICS network,
    including Level 1 Basic Control Layer and Level 0 Process Layer.
  range: last 90 days
  queries:
  - 'MAINTAIN a lookup of approved operational schedules. CREATE a rule to compare
    the timestamp of ICS commands from Zeek logs against this schedule. IF a command
    is executed outside its approved window, THEN generate a high-priority alert.'
- question: Has the command count for a specific device and command type deviated
    significantly from its historical hourly and daily baseline?
  context: This question aims to detect anomalous frequencies of commands, such as
    a command being sent repeatedly when it is normally infrequent. It involves establishing
    a granular baseline of activity over a 90-day period for each critical command
    type and source device pair. By calculating the historical mean and standard
    deviation for each time slice (e.g., Monday at 2 PM), an alert can be generated
    if the current command count exceeds its historical mean by a significant margin
    (e.g., more than 3 standard deviations).
  answer_sources:
  - Zeek modbus.log
  - Zeek enip.log
  - Zeek s7comm.log
  - Zeek dnp3.log
  - SCADA/HMI server segments, data historians, network taps, and industrial firewalls
    monitoring HMI, SCADA server, and PLC/RTU communications within the ICS network,
    including Level 1 Basic Control Layer and Level 0 Process Layer.
  range: last 90 days
  queries:
  - 'BASELINE command counts for each device/command pair on an hourly/daily basis
    over 90 days. CALCULATE the mean and standard deviation for each time slice. IF
    the current count in a time slice exceeds its mean by more than 3 standard deviations,
    THEN generate a medium-priority alert.'
- question: Has a time-series anomaly detection model flagged a command's timing
    as a deviation from learned temporal patterns?
  context: This question uses advanced analytics to detect temporal anomalies that
    simple scheduling rules might miss. A time-series model like Prophet or an LSTM
    Autoencoder is trained on at least 90 days of historical command data (timestamps
    and types). The deployed model analyzes the command stream in real-time, generating
    an alert when it flags a command's timing with an anomaly score that exceeds a
    pre-determined threshold, indicating a significant break from learned historical
    patterns.
  answer_sources:
  - Zeek modbus.log
  - Zeek enip.log
  - Zeek s7comm.log
  - Zeek dnp3.log
  - SCADA/HMI server segments, data historians, network taps, and industrial firewalls
    monitoring HMI, SCADA server, and PLC/RTU communications within the ICS network,
    including Level 1 Basic Control Layer and Level 0 Process Layer.
  range: last 90 days
  queries:
  - 'TRAIN a time-series anomaly detection model on 90+ days of ICS command data.
    DEPLOY the model to score the timing of new commands. IF a command''s anomaly
    score exceeds the threshold, THEN generate an alert.'
- question: Was a critical ICS application spawned by a non-standard parent process,
    followed by related outbound ICS network traffic?
  context: Adversaries often use legitimate tools like PowerShell or command prompt
    to launch malicious actions. This question seeks to detect when a critical ICS
    application (e.g., an HMI client) is launched by an unusual parent process. By
    maintaining a whitelist of approved parent processes and monitoring Windows Event
    ID 4688, an alert can be generated if a violation occurs. The alert is confirmed
    and elevated to critical if the host event is correlated with outbound ICS protocol
    traffic from the same host within a 60-second window.
  answer_sources:
  - Windows Event ID 4688
  - Zeek conn.log
  - Zeek modbus.log
  - Zeek enip.log
  - Zeek s7comm.log
  - Zeek dnp3.log
  - Human-Machine Interfaces (HMIs), Engineering Workstations (EWS), and SCADA/Historian
    Servers within the control network.
  range: last 90 days
  queries:
  - 'MONITOR Windows Event ID 4688 for ICS application creation. IF the parent process
    is not on the approved whitelist, THEN search Zeek logs for outbound ICS traffic
    from the same host within 60 seconds. IF traffic is found, THEN generate a critical
    alert.'
- question: Has an extremely rare parent-child process pair involving a critical
    ICS application been observed?
  context: This question provides a statistical method for detecting anomalous process
    lineage without a strict whitelist. It involves calculating the frequency of all
    unique parent-child process pairs involving critical ICS applications over a 60-day
    baseline period. An alert is triggered for any observed pair that has a historical
    frequency in the bottom 1st percentile, indicating it is extremely rare. The priority
    is escalated if the parent process is a scripting engine or command shell, as
    this is a common attacker technique.
  answer_sources:
  - Windows Event ID 4688
  - Zeek conn.log
  - Zeek modbus.log
  - Zeek enip.log
  - Zeek s7comm.log
  - Zeek dnp3.log
  - Human-Machine Interfaces (HMIs), Engineering Workstations (EWS), and SCADA/Historian
    Servers within the control network.
  range: last 90 days
  queries:
  - 'BASELINE the frequency of parent-child process pairs for ICS apps over 60 days.
    ALERT on any newly observed pair with a frequency in the bottom 1st percentile.
    ESCALATE the alert if the parent is a shell/scripting engine and correlates with
    outbound ICS traffic.'
- question: Did a graph-based anomaly detection model identify an anomalous process
    lineage that involves a critical ICS application and is correlated with ICS network
    traffic?
  context: This is an advanced analytic technique that models process creation activity
    (Windows Event ID 4688) as a directed graph of parent-child relationships. A graph-based
    anomaly detection algorithm (e.g., GraphSAGE) is trained to learn the normal structures
    of these process chains. The model then scores new process creation events in
    real-time, generating a high-priority alert for anomalous chains that involve
    critical ICS applications and are also temporally correlated with outbound ICS
    protocol traffic.
  answer_sources:
  - Windows Event ID 4688
  - Zeek conn.log
  - Zeek modbus.log
  - Zeek enip.log
  - Zeek s7comm.log
  - Zeek dnp3.log
  - Human-Machine Interfaces (HMIs), Engineering Workstations (EWS), and SCADA/Historian
    Servers within the control network.
  range: last 90 days
  queries:
  - 'MODEL process creation events as a graph and train a graph anomaly detection
    algorithm. SCORE new process events in real-time. IF an anomalous chain involves
    an ICS application and is correlated with outbound ICS traffic, THEN generate
    a high-priority alert.'
- question: Did an ICS command contain a value or parameter that violates the pre-defined
    physical or logical constraints for the target system?
  context: This question aims to detect commands that could put a physical process
    into an unsafe or undesirable state. It requires close collaboration with process
    engineers to develop a 'process specification' lookup table. This table defines,
    per control point, the valid function codes, register addresses, and safe min/max
    values. A SIEM rule then parses Zeek ICS logs in real-time and cross-references
    command parameters against this specification, generating a critical alert for
    any violation.
  answer_sources:
  - Zeek modbus.log
  - Zeek dnp3.log
  - Zeek enip.log
  - Zeek s7comm.log
  - Process Control Network (PCN) segments, with a focus on traffic destined for
    critical final control elements (e.g., actuators, valves), safety instrumented
    systems (SIS), Programmable Logic Controllers (PLCs), Remote Terminal Units (RTUs),
    and Intelligent Electronic Devices (IEDs).
  range: last 90 days
  queries:
  - 'DEVELOP a process specification lookup defining safe/valid parameters per control
    point. CREATE a SIEM rule to parse Zeek ICS logs and check command parameters
    against this specification. IF any parameter violates the defined rules, THEN
    generate a critical alert.'
- question: Was a statistically outlier value written to a critical register, or is
    there a significant change in the entropy of values suggesting fuzzing?
  context: This question uses statistical methods to detect anomalous command values.
    First, it profiles the distribution of values written to critical registers over
    a 90-day baseline, alerting if a new value is a statistical outlier (e.g., exceeds
    3 standard deviations from the mean). Second, it looks for signs of fuzzing by
    calculating the Shannon entropy of the value field in 1-hour windows. A significant,
    sudden change in entropy can indicate an attempt to find vulnerabilities by sending
    randomized data, triggering an alert.
  answer_sources:
  - Zeek modbus.log
  - Zeek dnp3.log
  - Zeek enip.log
  - Zeek s7comm.log
  - Process Control Network (PCN) segments, with a focus on traffic destined for
    critical final control elements (e.g., actuators, valves), safety instrumented
    systems (SIS), Programmable Logic Controllers (PLCs), Remote Terminal Units (RTUs),
    and Intelligent Electronic Devices (IEDs).
  range: last 90 days
  queries:
  - 'BASELINE the distribution of written values for critical registers. ALERT if
    a new value is a statistical outlier. SEPARATELY, calculate Shannon entropy of
    the value field in 1-hour windows and ALERT on significant entropy changes.'
- question: Has an unsupervised machine learning model detected that a command's parameters
    are inconsistent with the learned normal behavior for that device?
  context: This question applies unsupervised machine learning for device-specific
    anomaly detection. For each critical control device, an Autoencoder model is trained
    on the historical multivariate distribution of its command parameters (function,
    address, value) from Zeek logs. In real-time, the model attempts to reconstruct
    new commands it sees. A high reconstruction error indicates the command's parameters
    are inconsistent with learned normal behavior, triggering an alert.
  answer_sources:
  - Zeek modbus.log
  - Zeek dnp3.log
  - Zeek enip.log
  - Zeek s7comm.log
  - Process Control Network (PCN) segments, with a focus on traffic destined for
    critical final control elements (e.g., actuators, valves), safety instrumented
    systems (SIS), Programmable Logic Controllers (PLCs), Remote Terminal Units (RTUs),
    and Intelligent Electronic Devices (IEDs).
  range: last 90 days
  queries:
  - 'TRAIN an Autoencoder model for each critical device on its historical command
    parameters. IN real-time, calculate the reconstruction error for new commands.
    IF the error exceeds a tuned threshold, THEN generate an alert.'