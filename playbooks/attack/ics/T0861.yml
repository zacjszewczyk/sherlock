name: "T0861: Point & Tag Identification"
id: f8a9b7c6-d5e4-4f3c-b2a1-9e8d7c6b5a4b
description: "This playbook helps investigate if an adversary is attempting to map an industrial control process. It focuses on detecting anomalous activity related to the discovery of control system points and tags. The investigation covers three main areas: 1) Anomalous Industrial Control System (ICS) protocol communication that could indicate network scanning or host discovery. 2) Unusual read access to sensitive ICS project files or tag export files on engineering workstations and file servers, which could signify data theft. 3) Suspicious activity targeting Process Data Historians, such as unauthorized connections, brute-force login attempts, or abnormally large data transfers, which are indicative of tag database exfiltration."
type: technique
related:
  - "TA0100: Collection"
contributors:
  - "Zachary Szewczyk"
  - "Ask Sage"
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: "Is an unknown or unauthorized host communicating using ICS protocols on the Process Control Network?"
    context: "This question aims to identify hosts that have not been seen communicating with ICS protocols before. Answering this can uncover unauthorized devices, compromised IT systems pivoting into the OT environment, or an adversary's initial reconnaissance attempts within the control network. Identifying such activity early is critical to preventing further intrusion."
    answer_sources:
      - "Zeek modbus.log"
      - "Zeek ethernetip.log"
      - "Zeek dnp3.log"
      - "Zeek opcua.log"
      - "Zeek conn.log"
      - "Network segments corresponding to Purdue Model Levels 0, 1, and 2, specifically traffic between PLCs, RTUs, and HMIs"
      - "Network taps or SPAN ports on switches within the Process Control Network (PCN)"
      - "Firewall and NIDS logs at the boundary between the IT network (Level 4/5) and the OT DMZ (Level 3.5) and between the DMZ and the PCN (Level 3)"
    range: last 90 days
    queries:
      - technology: pseudocode
        query: "FOR each ICS protocol log (Modbus, DNP3, etc.) FROM last 30 days, GET source_ip. COMPARE source_ip against static_allowlist AND dynamic_baseline_of_known_ips. ALERT if source_ip is not in either list."
  - question: "Is an authorized ICS host exhibiting scanning behavior by making an unusually high volume of read requests or contacting an abnormal number of unique devices?"
    context: "This question focuses on detecting anomalous behavior from otherwise legitimate devices. An adversary who has compromised an authorized host (like an HMI) may use it to scan the network to identify other devices and map out the process. This query helps detect such internal reconnaissance by baselining normal activity and flagging statistically significant deviations."
    answer_sources:
      - "Zeek modbus.log"
      - "Zeek ethernetip.log"
      - "Zeek dnp3.log"
      - "Zeek opcua.log"
      - "Zeek conn.log"
      - "Network segments corresponding to Purdue Model Levels 0, 1, and 2, specifically traffic between PLCs, RTUs, and HMIs"
      - "Network taps or SPAN ports on switches within the Process Control Network (PCN)"
      - "Firewall and NIDS logs at the boundary between the IT network (Level 4/5) and the OT DMZ (Level 3.5) and between the DMZ and the PCN (Level 3)"
    range: last 90 days
    queries:
      - technology: pseudocode
        query: "FOR each authorized_host, CALCULATE 7-day rolling baseline of hourly_read_requests and unique_destinations. CALCULATE 99th percentile for both metrics. COMPARE current hourly counts against baseline. ALERT if current_count > 99th_percentile."
  - question: "Does the overall communication pattern of an ICS host deviate significantly from its established normal behavior, considering multiple protocol features simultaneously?"
    context: "This question uses a more advanced, model-based approach to detect subtle anomalies that might be missed by simple thresholding. By creating a 'fingerprint' of normal communication for each host (e.g., packet counts, unique IPs, function codes used), a machine learning model can identify complex deviations that indicate sophisticated reconnaissance or manipulation, even if individual metrics remain within simple thresholds."
    answer_sources:
      - "Zeek modbus.log"
      - "Zeek ethernetip.log"
      - "Zeek dnp3.log"
      - "Zeek opcua.log"
      - "Zeek conn.log"
      - "Network segments corresponding to Purdue Model Levels 0, 1, and 2, specifically traffic between PLCs, RTUs, and HMIs"
      - "Network taps or SPAN ports on switches within the Process Control Network (PCN)"
      - "Firewall and NIDS logs at the boundary between the IT network (Level 4/5) and the OT DMZ (Level 3.5) and between the DMZ and the PCN (Level 3)"
    range: last 90 days
    queries:
      - technology: pseudocode
        query: "FOR each host, TRAIN anomaly detection model on historical data (30+ days) using features (packet counts, unique IPs, function codes). APPLY model to real-time traffic. ALERT if anomaly_score > 95th_percentile_of_historical_scores."
  - question: "Is an unauthorized user or an unapproved process attempting to read sensitive ICS project or tag export files?"
    context: "This question helps detect direct attempts to steal intellectual property or gather intelligence for an attack. By monitoring read access to critical files (like PLC logic or tag databases) and alerting on access by unauthorized users or suspicious processes (e.g., cmd.exe, powershell.exe), security teams can catch adversaries trying to exfiltrate project data."
    answer_sources:
      - "Windows Event ID 4663"
      - "Windows Event ID 4688"
      - "File system and object access audit logs on Engineering Workstations (EWS), project file repositories, and version control servers, typically located in Purdue Model Level 3 or 2"
      - "Central file servers in the business network (Level 4) that store backups of ICS project files"
      - "Document management systems where tag databases might be stored"
    range: last 90 days
    queries:
      - technology: pseudocode
        query: "MONITOR Windows Event ID 4663 for project_file_types. FOR each event, CHECK if SubjectUserName AND ProcessName are in allowlist. ALERT if either is not on allowlist."
  - question: "Is an authorized user accessing an unusually large number or volume of ICS project files, suggesting bulk data collection?"
    context: "This question addresses the insider threat or compromised account scenario. A legitimate user's account could be used to gather project files en masse. By baselining normal file access patterns for each user, this query can flag abnormal behavior, such as an engineer suddenly accessing hundreds of project files when they typically only access a few per day."
    answer_sources:
      - "Windows Event ID 4663"
      - "Windows Event ID 4688"
      - "File system and object access audit logs on Engineering Workstations (EWS), project file repositories, and version control servers, typically located in Purdue Model Level 3 or 2"
      - "Central file servers in the business network (Level 4) that store backups of ICS project files"
      - "Document management systems where tag databases might be stored"
    range: last 90 days
    queries:
      - technology: pseudocode
        query: "FOR each authorized_user, CALCULATE 7-day rolling baseline of hourly_unique_files_accessed and total_read_events. CALCULATE 99th percentile for both. ALERT if user's current hourly activity > 99th_percentile for either metric."
  - question: "Is a user's file access behavior anomalous when considering the process used, time of day, and access velocity?"
    context: "This question uses User and Entity Behavior Analytics (UEBA) to build a sophisticated profile of normal file access. It goes beyond simple counts to detect contextual anomalies. For example, an engineer accessing 10 project files using 'Studio5000.exe' during work hours is normal. The same user accessing the same files via 'powershell.exe' at 2 AM is highly suspicious. This model-based approach helps identify such nuanced threats."
    answer_sources:
      - "Windows Event ID 4663"
      - "Windows Event ID 4688"
      - "File system and object access audit logs on Engineering Workstations (EWS), project file repositories, and version control servers, typically located in Purdue Model Level 3 or 2"
      - "Central file servers in the business network (Level 4) that store backups of ICS project files"
      - "Document management systems where tag databases might be stored"
    range: last 90 days
    queries:
      - technology: pseudocode
        query: "TRAIN UEBA model on user file access (Event 4663), profiling user-process-filetype triplets, access times, and velocity. APPLY model to real-time events. ALERT on significant deviation from learned profile."
  - question: "Is an unauthorized client connecting to the Process Data Historian, or is there evidence of a successful brute-force login attack against it?"
    context: "This question has two parts to detect unauthorized access to the historian. First, it identifies any network connections from clients that are not explicitly authorized, indicating a potential intrusion. Second, it looks for the classic pattern of a brute-force attack: a burst of failed logins followed by a success from the same source, which strongly suggests a compromised credential."
    answer_sources:
      - "Zeek conn.log"
      - "Windows Event ID 4624"
      - "Windows Event ID 4625"
      - "Network traffic to and from Process Data Historian servers, typically at Purdue Model Level 3.5 or 4"
      - "Security event logs (logon/logoff events) on the historian servers themselves"
      - "Network flow data (e.g., Zeek conn.log) captured at the network switch port for the historian or at the firewall segmenting the historian from other network zones"
    range: last 90 days
    queries:
      - technology: pseudocode
        query: "QUERY 1: MONITOR connections on historian_ports. ALERT if source_ip is not in static_allowlist AND not in 30-day dynamic_baseline. QUERY 2: MONITOR failed logins (Event 4625) and successful logins (Event 4624). ALERT if count(failed_logins from source_ip) >= 10 within 5 mins AND is followed by successful_login from same source_ip."
  - question: "Is an authorized client exfiltrating an abnormally large amount of data from the Process Data Historian?"
    context: "This question aims to detect bulk data exfiltration, which is a key part of tag identification. An adversary who has gained access to a legitimate client may attempt to download the entire tag database. By baselining the normal amount of data transferred from the historian to each client, this query can detect significant outliers that represent a potential mass data export."
    answer_sources:
      - "Zeek conn.log"
      - "Windows Event ID 4624"
      - "Windows Event ID 4625"
      - "Network traffic to and from Process Data Historian servers, typically at Purdue Model Level 3.5 or 4"
      - "Security event logs (logon/logoff events) on the historian servers themselves"
      - "Network flow data (e.g., Zeek conn.log) captured at the network switch port for the historian or at the firewall segmenting the historian from other network zones"
    range: last 90 days
    queries:
      - technology: pseudocode
        query: "FOR each client-historian_pair, CALCULATE 7-day rolling hourly baseline of bytes_transferred_from_historian. CALCULATE 99.9th percentile. ALERT if current hourly bytes > 99.9th_percentile."
  - question: "Does a client's connection profile to the historian deviate significantly from its normal 'data query profile', considering duration, data volume, and time-of-day?"
    context: "This question uses a machine learning model to create a detailed profile for each client's interaction with the historian. It's more robust than a simple data volume check because it considers multiple features of the connection. This can detect more subtle exfiltration attempts, such as queries run at unusual times or connections with abnormal durations, which might indicate an adversary manually exploring the database rather than a standard automated query."
    answer_sources:
      - "Zeek conn.log"
      - "Windows Event ID 4624"
      - "Windows Event ID 4625"
      - "Network traffic to and from Process Data Historian servers, typically at Purdue Model Level 3.5 or 4"
      - "Security event logs (logon/logoff events) on the historian servers themselves"
      - "Network flow data (e.g., Zeek conn.log) captured at the network switch port for the historian or at the firewall segmenting the historian from other network zones"
    range: last 90 days
    queries:
      - technology: pseudocode
        query: "FOR each client, TRAIN anomaly detection model on historical connection data (duration, bytes_sent, bytes_received, time-of-day). APPLY model to new connections. ALERT if a connection is flagged as a significant outlier."