name: T0861: Point & Tag Identification
id: 3e6a9f1a-8b0c-4d5e-9f3a-6b7c8d9e0f1a
description: |
  This playbook helps to determine if an adversary is attempting to map an industrial control process. This involves detecting anomalous Industrial Control System (ICS) protocol communication, such as a host using an ICS protocol for the first time or an authorized host exhibiting a significant increase in read requests or endpoints contacted. It also focuses on identifying anomalous read access to sensitive ICS project files (e.g., .ACD, .L5K) or tag export files on Engineering Workstations or file servers, especially from unauthorized users or processes. Finally, it monitors for suspicious activity targeting a Process Data Historian, characterized by connections from new IPs, successful logins following multiple failures (brute-force), or anomalously large data transfers indicative of exfiltration.
type: technique
related: TA0100: Collection
contributors: Zachary Szewczyk, Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Is an unauthorized host communicating using ICS protocols on the Process Control Network?
    context: |
      This question aims to detect new or unapproved devices speaking industrial protocols (e.g., Modbus, DNP3). Such activity is a primary indicator of an adversary's initial reconnaissance or lateral movement into the OT environment. The detection strategy uses a combination of a static allowlist for known-good devices and a dynamic baseline to catch new, potentially malicious hosts that are not on the static list, providing layered defense against unknown threats.
    answer_sources: |
      Zeek modbus.log, Zeek ethernetip.log, Zeek dnp3.log, Zeek opcua.log, Zeek conn.log. Network segments corresponding to Purdue Model Levels 0, 1, and 2, specifically traffic between PLCs, RTUs, and HMIs; Network taps or SPAN ports on switches within the Process Control Network (PCN); Firewall and NIDS logs at the boundary between the IT network (Level 4/5) and the OT DMZ (Level 3.5) and between the DMZ and the PCN (Level 3).
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each ICS protocol packet:
            GET source_ip
            IF source_ip IS NOT IN static_allowlist AND source_ip IS NOT IN 30_day_dynamic_baseline:
              ALERT (High Priority) - "New ICS Communicating Host Detected"
  - question: Is an authorized ICS host scanning the network or reading an unusual amount of data?
    context: |
      This question addresses the scenario where a legitimate host (like an HMI or EWS) has been compromised. An adversary might use this trusted host to perform reconnaissance. The detection looks for behavioral anomalies, specifically a statistical increase in read requests or the number of unique devices contacted. These are strong indicators of network scanning or device data enumeration by a compromised asset.
    answer_sources: |
      Zeek modbus.log, Zeek ethernetip.log, Zeek dnp3.log, Zeek opcua.log, Zeek conn.log. Network segments corresponding to Purdue Model Levels 0, 1, and 2, specifically traffic between PLCs, RTUs, and HMIs; Network taps or SPAN ports on switches within the Process Control Network (PCN); Firewall and NIDS logs at the boundary between the IT network (Level 4/5) and the OT DMZ (Level 3.5) and between the DMZ and the PCN (Level 3).
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each authorized_host:
            CALCULATE 7-day rolling baseline (99th percentile) for hourly_read_requests and hourly_unique_destinations
            GET current_hourly_read_requests and current_hourly_unique_destinations
            IF current_hourly_read_requests > baseline OR current_hourly_unique_destinations > baseline:
              ALERT (Medium Priority) - "Anomalous Scanning/Reading from Authorized Host"
  - question: Does the network communication profile of an ICS host deviate significantly from its established normal behavior?
    context: |
      This is a more advanced, machine learning-based approach. Instead of tracking just one or two metrics, it builds a comprehensive "fingerprint" of a host's communication patterns using multiple features (e.g., packet counts, unique IPs, function codes). This can detect more subtle anomalies that might not trigger simple threshold-based alerts, providing a more robust detection capability against sophisticated adversaries trying to blend in with normal traffic.
    answer_sources: |
      Zeek modbus.log, Zeek ethernetip.log, Zeek dnp3.log, Zeek opcua.log, Zeek conn.log. Network segments corresponding to Purdue Model Levels 0, 1, and 2, specifically traffic between PLCs, RTUs, and HMIs; Network taps or SPAN ports on switches within the Process Control Network (PCN); Firewall and NIDS logs at the boundary between the IT network (Level 4/5) and the OT DMZ (Level 3.5) and between the DMZ and the PCN (Level 3).
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each host:
            TRAIN anomaly detection model (e.g., Isolation Forest) on 30+ days of historical communication data
            CALCULATE real-time anomaly_score for current activity
            IF anomaly_score > 95th_percentile_of_historical_scores:
              ALERT (Medium Priority) - "Host Communication Profile Deviation Detected"
  - question: Is an unauthorized user or process accessing sensitive ICS project or tag files?
    context: |
      This question focuses on protecting the intellectual property and configuration data of the control system, which are stored in project files. Unauthorized access, especially by common scripting tools (PowerShell, cmd.exe) instead of legitimate engineering software (Studio5000.exe), is a strong indicator of data theft or an adversary preparing for a disruptive attack by gathering system logic.
    answer_sources: |
      Windows Event ID 4663, Windows Event ID 4688. File system and object access audit logs on Engineering Workstations (EWS), project file repositories, and version control servers, typically located in Purdue Model Level 3 or 2; Central file servers in the business network (Level 4) that store backups of ICS project files; Document management systems where tag databases might be stored.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          ON Windows Event 4663 (File Read Access) for monitored file extensions (.ACD, .L5K, .CSV, .XML):
            GET SubjectUserName and ProcessName
            IF SubjectUserName IS NOT IN authorized_user_list OR ProcessName IS NOT IN authorized_process_list:
              ALERT (High Priority) - "Unauthorized Access to Sensitive ICS File"
  - question: Is an authorized user exfiltrating an unusually large number of ICS project or tag files?
    context: |
      This addresses an insider threat or a compromised legitimate account. Even if the user has rights to the files, accessing a massive number of them in a short period is abnormal behavior and suggests bulk data collection for exfiltration. This action establishes a personal baseline of activity for each user to detect such deviations from their normal work patterns.
    answer_sources: |
      Windows Event ID 4663, Windows Event ID 4688. File system and object access audit logs on Engineering Workstations (EWS), project file repositories, and version control servers, typically located in Purdue Model Level 3 or 2; Central file servers in the business network (Level 4) that store backups of ICS project files; Document management systems where tag databases might be stored.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each authorized_user:
            CALCULATE 7-day rolling baseline (99th percentile) for hourly_unique_files_accessed and hourly_total_read_events
            GET current_hour_counts
            IF current_hour_unique_files > baseline OR current_hour_total_reads > baseline:
              ALERT (Medium Priority) - "Anomalous Bulk File Access by Authorized User"
  - question: Is a user's file access behavior on critical systems showing anomalous patterns, even if the user is authorized?
    context: |
      This is a UEBA (User and Entity Behavior Analytics) approach to file access. It goes beyond simple counts and analyzes the context, such as the process used, time of day, and access velocity. For example, a user who normally accesses a few files an hour using engineering software but suddenly accesses hundreds using PowerShell at 2 AM would be flagged as a high-risk anomaly, even if the user is authorized to access those files.
    answer_sources: |
      Windows Event ID 4663, Windows Event ID 4688. File system and object access audit logs on Engineering Workstations (EWS), project file repositories, and version control servers, typically located in Purdue Model Level 3 or 2; Central file servers in the business network (Level 4) that store backups of ICS project files; Document management systems where tag databases might be stored.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          PROFILE normal user behavior triplets ('user-process-filetype', access_time, access_velocity)
          DETECT significant deviation from the learned profile
          IF deviation_detected:
            ALERT (Medium Priority) - "Anomalous User File Access Behavior Detected"
  - question: Is an unauthorized system attempting to connect to or brute-force credentials for the Process Data Historian?
    context: |
      The Process Data Historian is a high-value target containing historical operational data. This question aims to detect two attack vectors: connections from completely unknown/unauthorized systems, and brute-force password guessing attacks. A successful login immediately following a high volume of failures from the same source is a classic indicator of a successful brute-force or password spray attempt.
    answer_sources: |
      Zeek conn.log, Windows Event ID 4624, Windows Event ID 4625. Network traffic to and from Process Data Historian servers, typically at Purdue Model Level 3.5 or 4; Security event logs (logon/logoff events) on the historian servers themselves; Network flow data (e.g., Zeek conn.log) captured at the network switch port for the historian or at the firewall segmenting the historian from other network zones.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          QUERY 1:
            ON connection to historian ports (1433, 5432, etc.):
              IF source_ip IS NOT IN allowlist AND source_ip IS NOT IN 30-day_baseline:
                ALERT (High Priority) - "Unauthorized Connection to Historian"
          QUERY 2:
            ON successful login (Event 4624):
              CHECK for >= 10 failed logins (Event 4625) from same IP in last 5 minutes
              IF true:
                ALERT (High Priority) - "Potential Brute-Force Success on Historian"
  - question: Is an authorized client exfiltrating an abnormally large amount of data from the Process Data Historian?
    context: |
      This action targets data exfiltration by a compromised but authorized client. By monitoring the volume of data transferred from the historian to the client (e.g., 'resp_bytes' in Zeek), we can detect unusual bulk data exports that deviate from normal querying behavior. This is crucial for detecting the theft of large historical process datasets, which could be used to plan a future attack.
    answer_sources: |
      Zeek conn.log, Windows Event ID 4624, Windows Event ID 4625. Network traffic to and from Process Data Historian servers, typically at Purdue Model Level 3.5 or 4; Security event logs (logon/logoff events) on the historian servers themselves; Network flow data (e.g., Zeek conn.log) captured at the network switch port for the historian or at the firewall segmenting the historian from other network zones.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each authorized client-historian pair:
            CALCULATE 7-day rolling hourly baseline (99.9th percentile) for total_bytes_transferred_from_historian
            GET current_hour_bytes_transferred
            IF current_hour_bytes_transferred > baseline:
              ALERT (Medium Priority) - "Potential Bulk Data Exfiltration from Historian"
  - question: Does a client's data query profile against the historian deviate significantly from its normal, learned behavior?
    context: |
      This is the most advanced detection for this evidence type, using machine learning to model the "normal" connection profile for each client. It considers multiple features like connection duration and data volume in both directions. This can catch sophisticated exfiltration attempts that might be spread over time or use unusual connection parameters to evade simpler threshold-based detections, providing a higher-fidelity alert.
    answer_sources: |
      Zeek conn.log, Windows Event ID 4624, Windows Event ID 4625. Network traffic to and from Process Data Historian servers, typically at Purdue Model Level 3.5 or 4; Security event logs (logon/logoff events) on the historian servers themselves; Network flow data (e.g., Zeek conn.log) captured at the network switch port for the historian or at the firewall segmenting the historian from other network zones.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each authorized client:
            TRAIN anomaly detection model (e.g., One-Class SVM) on historical connection data (duration, bytes_sent, bytes_received, time_of_day)
            IF model flags a new connection as a significant outlier:
              ALERT (Medium Priority) - "Anomalous Historian Query Profile Detected"