name: T0800: Activate Firmware Update Mode
id: a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d
description: This playbook focuses on detecting an adversary's attempt to inhibit or disable safety and protection functions by forcing an Industrial Control System (ICS) device into a firmware update, maintenance, or other non-operational mode. This can be observed through several indicators: 1) The execution of firmware update utilities on engineering workstations, correlated with large file transfers or a subsequent loss of communication from the target device. 2) The use of specific, low-prevalence ICS protocol commands designed to alter a device's operational state, followed by a significant deviation in the device's communication baseline. 3) A scenario where a critical device becomes unresponsive to application-layer queries but still responds to low-level network probes like ICMP, indicating it is online but its primary functions are inhibited.
type: technique
related:
  - TA0107: Inhibit Response Function
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Is a known firmware update utility or scripting engine being executed on an EWS with suspicious command-line arguments, followed by a large file transfer to a critical ICS asset?
    context: This question aims to detect the initial stage of a malicious firmware update. An adversary might use legitimate engineering tools on an Engineering Workstation (EWS) to push a malicious firmware file. Correlating the process execution with a subsequent large file transfer to a sensitive device provides strong evidence of this activity, distinguishing it from benign tool usage.
    answer_sources:
      - Windows Event ID 4688
      - Zeek conn.log
      - Zeek files.log
      - Zeek ftp.log
      - Zeek http.log
      - Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), and Jump Servers within the Process Control and Supervisory network segments (Purdue Level 2/3), and network TAPs monitoring traffic to and from these assets.
    range: last 90 days
    queries:
      - pseudocode: SEARCH for Process Creation Event (ID 4688) on EWS/HMI hosts WHERE (process_name is vendor_utility OR scripting_engine) AND (command_line contains 'firmware' OR 'update' OR 'flash'). CORRELATE within 90s with Network Connection Log WHERE (source_host is EWS_host) AND (destination_host is critical_asset) AND (bytes_transferred > 1MB OR file_mime_type is 'application/octet-stream').
  - question: Has a common engineering tool been executed on an EWS with an unusually rare command-line structure, and did a targeted ICS device subsequently stop sending its normal heartbeat signals?
    context: Adversaries may use legitimate tools in non-standard ways. This question focuses on detecting novel command-line usage by comparing it to a historical baseline. A low similarity score suggests an unusual action. Correlating this host anomaly with a loss of network heartbeats from the target device helps confirm that the unusual command had a direct impact on the device's operational state.
    answer_sources:
      - Windows Event ID 4688
      - Zeek conn.log
      - Zeek files.log
      - Zeek ftp.log
      - Zeek http.log
      - Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), and Jump Servers within the Process Control and Supervisory network segments (Purdue Level 2/3), and network TAPs monitoring traffic to and from these assets.
    range: last 90 days
    queries:
      - pseudocode: FOR each Process Creation Event on EWS hosts, CALCULATE Jaccard similarity of command args against historical baseline. IF similarity < 0.2, CHECK if target device's heartbeat inter-arrival time > 99.9th percentile within 5 minutes.
  - question: Can we use a machine learning model to identify suspicious firmware update processes on host systems, and does this correspond with anomalous network behavior from the target device?
    context: This advanced question uses a two-stage machine learning approach for high-fidelity detection. A classification model first flags suspicious process executions based on rich feature sets. An LSTM autoencoder then analyzes the target device's network traffic time-series. A spike in the LSTM's reconstruction error following a suspicious process classification indicates a significant, unexpected change in network behavior, strongly suggesting a successful device state manipulation.
    answer_sources:
      - Windows Event ID 4688
      - Zeek conn.log
      - Zeek files.log
      - Zeek ftp.log
      - Zeek http.log
      - Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), and Jump Servers within the Process Control and Supervisory network segments (Purdue Level 2/3), and network TAPs monitoring traffic to and from these assets.
    range: last 90 days
    queries:
      - pseudocode: INPUT Process Creation Events into Random Forest classifier. IF classification is 'Suspicious-Update', INPUT corresponding device network traffic (byte volume, packet count) into LSTM autoencoder. ALERT if LSTM reconstruction error spikes.
  - question: Has a specific ICS protocol command known to cause a device state change (e.g., Modbus FC16, DNP3 FC13) been sent to a critical asset from an unauthorized source or outside of a scheduled maintenance window?
    context: This question targets the direct manipulation of ICS devices using their native protocols. Certain function codes are explicitly designed to alter device state or trigger resets. By monitoring for these specific, high-risk commands and enriching the events with contextual data (is the source authorized? is it a maintenance period?), analysts can quickly identify unauthorized and potentially malicious control actions.
    answer_sources:
      - Zeek conn.log
      - Zeek modbus.log
      - Zeek dnp3.log
      - Zeek enip.log
      - Zeek weird.log
      - Network sensor appliances (e.g., Zeek sensors) deployed on SPAN ports or network TAPs at the boundaries between Purdue Levels 1 (Basic Control), 2 (Area Supervisory Control), and 3 (Site Control), with a focus on traffic flows involving critical PLCs, RTUs, and protection relays.
    range: last 90 days
    queries:
      - pseudocode: SEARCH ICS protocol logs (Modbus, DNP3) for state-change function codes (e.g., Modbus FC 16, DNP3 FC 13) targeting critical assets. IF (source_ip NOT in allowlist) OR (event_time NOT in maintenance_window), ALERT.
  - question: Following a potential state-change command, did the communication profile of the target device change significantly, such as an abnormal increase in write commands or a cessation of expected polling responses?
    context: This question seeks to confirm the impact of a potential state-change command. A device entering a firmware update or maintenance mode will behave differently. This can manifest as a shift from normal read-heavy operations to write-heavy operations (e.g., writing new firmware) or a complete halt in communications. Comparing the post-command behavior to a learned baseline provides evidence that the command was effective.
    answer_sources:
      - Zeek conn.log
      - Zeek modbus.log
      - Zeek dnp3.log
      - Zeek enip.log
      - Zeek weird.log
      - Network sensor appliances (e.g., Zeek sensors) deployed on SPAN ports or network TAPs at the boundaries between Purdue Levels 1 (Basic Control), 2 (Area Supervisory Control), and 3 (Site Control), with a focus on traffic flows involving critical PLCs, RTUs, and protection relays.
    range: last 90 days
    queries:
      - pseudocode: ON potential state-change command to device, MONITOR device traffic for 5 mins. ALERT if (write/read ratio > 99th percentile) OR (time_since_last_poll > 99.5th percentile for > 120s).
  - question: Does the overall communication pattern of a critical device, considering multiple network metrics simultaneously, show a significant deviation from its normal, learned behavior?
    context: This question employs a holistic, model-driven approach to detect subtle or complex changes in a device's network footprint. A multivariate model (like a VAE) learns the intricate relationships between various metrics (byte counts, protocol functions, port entropy). An alert is triggered when the device's current behavior doesn't match the learned "normal" pattern, indicating a potential state change that might be missed by simpler, single-metric rules.
    answer_sources:
      - Zeek conn.log
      - Zeek modbus.log
      - Zeek dnp3.log
      - Zeek enip.log
      - Zeek weird.log
      - Network sensor appliances (e.g., Zeek sensors) deployed on SPAN ports or network TAPs at the boundaries between Purdue Levels 1 (Basic Control), 2 (Area Supervisory Control), and 3 (Site Control), with a focus on traffic flows involving critical PLCs, RTUs, and protection relays.
    range: last 90 days
    queries:
      - pseudocode: INPUT 1-min aggregated network metrics (connection count, bytes, port entropy, function code distribution) for critical devices into VAE model. ALERT if reconstruction error > 99.8th percentile of baseline.
  - question: Is a critical ICS asset responding to network-level pings (ICMP) but has stopped responding to application-level status queries for an extended period?
    context: This question aims to identify devices that are "alive but not well." A device in a firmware update mode or a fault state may still be online at the network layer (responding to pings) but will have its primary control logic and application-layer communication disabled. This specific combination of responsiveness and unresponsiveness is a strong indicator of an inhibited device.
    answer_sources:
      - Zeek conn.log
      - Zeek icmp.log
      - Zeek modbus.log
      - Network TAPs monitoring traffic to and from critical controllers (PLCs, RTUs, IEDs) in Purdue Level 1 and 2, and the central network core where ICMP traffic might be observed.
    range: last 90 days
    queries:
      - pseudocode: MAINTAIN state table of critical assets with 'last_app_response' and 'last_icmp_response' timestamps. ALERT if (current_time - last_app_response > 10 mins) AND (current_time - last_icmp_response < 2 mins).
  - question: Is there an unusually long-lived TCP connection to a critical device's control port that is not transferring any application data?
    context: This question identifies a potential "hung" state. A device that has entered an alternate mode or experienced a fault might accept a TCP connection but be unable to process any application-layer data. This results in an established session that remains open but idle. Detecting such sessions that last significantly longer than a historical baseline can uncover devices that are stuck in a non-operational state.
    answer_sources:
      - Zeek conn.log
      - Zeek icmp.log
      - Zeek modbus.log
      - Network TAPs monitoring traffic to and from critical controllers (PLCs, RTUs, IEDs) in Purdue Level 1 and 2, and the central network core where ICMP traffic might be observed.
    range: last 90 days
    queries:
      - pseudocode: BASELINE TCP session durations on control ports for each critical device. ALERT if new session is ESTABLISHED and has 0 data bytes for a duration > 98th percentile of historical durations.
  - question: Has a critical device stopped sending its expected application-layer responses, according to a predictive model, while still being confirmed as online via ICMP?
    context: This is a sophisticated method for detecting a silent failure or state change. A time-series forecasting model learns the normal rhythm of a device's activity, including daily and weekly patterns. The model can then predict when responses should be seen. If the actual responses drop to zero when the model predicted activity, and the device is still pingable, it provides a high-confidence signal that the device's function is inhibited.
    answer_sources:
      - Zeek conn.log
      - Zeek icmp.log
      - Zeek modbus.log
      - Network TAPs monitoring traffic to and from critical controllers (PLCs, RTUs, IEDs) in Purdue Level 1 and 2, and the central network core where ICMP traffic might be observed.
    range: last 90 days
    queries:
      - pseudocode: FORECAST expected application response count for device in 1-min bins. IF actual_count is 0 for several bins where forecast > 0, CHECK for recent ICMP responses. IF ICMP is responsive, ALERT.