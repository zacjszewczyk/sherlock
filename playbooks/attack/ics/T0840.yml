name: T0840: Network Connection Enumeration
id: f47ac10b-58cc-4372-a567-0e02b2c3d479
description: This playbook helps investigate whether an adversary is attempting to discover the communication patterns and device roles within an ICS network. This is often done by executing network enumeration utilities (like netstat.exe or arp.exe) on critical assets, initiating an anomalously high number of network connections from a single host to scan for other devices, or using ICS-specific protocols (like Modbus or DNP3) from unauthorized source IP addresses to identify control systems.
type: technique
related:
  - TA0102: Discovery
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Has a network enumeration utility (like netstat.exe or ipconfig.exe) been executed on a critical ICS asset by an unauthorized user or process?
    context: This question aims to detect initial reconnaissance activity on critical systems. Adversaries often use built-in Windows utilities to map network connections and configurations. Execution by non-standard accounts (not service or admin) or from interactive shells like cmd.exe or powershell.exe outside of maintenance windows is a strong indicator of hands-on-keyboard intrusion.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 4104
      - Sysmon Event ID 1
      - Endpoint devices of critical ICS assets (Engineering Workstations, HMIs, Historian Servers, Data Gateways, Operator Workstations)
    range: last 90 days
    queries:
      - pseudocode: SEARCH process creation logs (Sysmon 1, Win 4688) OR PowerShell script logs (Win 4104) ON critical ICS assets WHERE (process_name IN ['netstat.exe', 'arp.exe', 'nbtstat.exe', 'ipconfig.exe', 'route.exe'] AND parent_process IN ['cmd.exe', 'powershell.exe', 'explorer.exe'] AND user is NOT system/admin) OR (script_block CONTAINS 'Get-NetTCPConnection' OR 'Get-NetNeighbor' AND script is NOT allow-listed).
  - question: Is there a statistically significant increase in the execution frequency of network enumeration utilities on critical ICS assets, suggesting automated or scripted reconnaissance?
    context: This question seeks to identify subtler, volume-based anomalies. Instead of looking for a single suspicious execution, it monitors the rate of execution. A sudden spike in the usage of tools like 'netstat.exe', even by an authorized account, could indicate that a script is repeatedly running the command to gather network information over time. A z-score helps quantify this deviation from the established normal behavior.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 4104
      - Sysmon Event ID 1
      - Endpoint devices of critical ICS assets (Engineering Workstations, HMIs, Historian Servers, Data Gateways, Operator Workstations)
    range: last 90 days
    queries:
      - pseudocode: FOR EACH critical ICS asset, CALCULATE hourly execution count of enumeration utilities over 30 days. COMPUTE historical mean and standard deviation. TRIGGER alert IF current hourly count's z-score > 3.
  - question: Has a machine learning model detected an anomalous process execution event on a critical ICS asset that matches the profile of network enumeration activity?
    context: This question leverages machine learning to find novel or evasive enumeration techniques that may not be caught by simple signature-based rules. The model learns the normal patterns of process execution (who, what, when, how) and flags any execution that deviates significantly. This is useful for detecting enumeration attempts that use different tool names, unusual parent processes, or occur at odd times.
    answer_sources:
      - Sysmon Event ID 1
      - Endpoint devices of critical ICS assets (Engineering Workstations, HMIs, Historian Servers, Data Gateways, Operator Workstations)
    range: last 90 days
    queries:
      - pseudocode: INPUT process creation data (Sysmon 1) from critical ICS assets into a pre-trained anomaly detection model (e.g., Isolation Forest). ANALYZE features like process name, parent process, user, command-line arguments, and time. TRIGGER alert for any event flagged as a significant outlier by the model.
  - question: Is a host within the ICS network attempting to connect to an unusually large number of internal devices, especially with a high rate of failed or rejected connections?
    context: This question focuses on identifying network-level scanning behavior. An adversary performing a network sweep will often try to connect to many different IP addresses in a short period. A high number of connection attempts that are unanswered ('S0') or actively rejected ('REJ') is a classic sign of a host discovery scan (like a SYN scan or ping sweep).
    answer_sources:
      - Zeek conn.log
      - Firewall Logs
      - ICS network segments (Process Control Network - PCN), Network choke points between IT and OT networks (DMZ, Purdue Model Zone 3.5), SCADA/DCS networks
    range: last 90 days
    queries:
      - pseudocode: SEARCH network connection logs (Zeek, Firewall) FOR source IP in NAI. WITHIN a 5-minute window, COUNT unique destination IPs. TRIGGER alert IF unique destination count > 20 AND ratio of connection states (S0, REJ, RSTOS0) > 80%.
  - question: Has any ICS host's network communication pattern deviated statistically from its normal baseline, specifically regarding the number and variety of unique devices or services it connects to?
    context: This question aims to detect more subtle or 'low-and-slow' scanning activity by baselining normal communication patterns. Instead of a fixed threshold, it compares current activity to the host's own history. An increase in the count of unique destination IPs or ports, or a rise in the Shannon entropy (which measures randomness), can indicate that a compromised host is now being used to explore the network beyond its typical operational connections.
    answer_sources:
      - Zeek conn.log
      - Firewall Logs
      - ICS network segments (Process Control Network - PCN), Network choke points between IT and OT networks (DMZ, Purdue Model Zone 3.5), SCADA/DCS networks
    range: last 90 days
    queries:
      - pseudocode: FOR EACH source host in NAI, CALCULATE baseline metrics (unique dest IPs, unique dest ports, Shannon entropy of dest IPs) in 5-min windows over 30 days. TRIGGER alert IF current window's metric exceeds the 99th percentile of its historical baseline.
  - question: Is there a spike in network enumeration from a high-value asset that cannot be explained by its normal daily or weekly operational cycles?
    context: This question applies time-series forecasting to detect anomalies, which is particularly effective for systems with predictable, cyclical communication patterns. A SARIMA model can learn these seasonal patterns. If the actual number of connections suddenly exceeds the model's forecast, it suggests an anomalous event, like an adversary using the asset to scan the network, which is not part of its regular, scheduled behavior.
    answer_sources:
      - Zeek conn.log
      - Firewall Logs
      - ICS network segments (Process Control Network - PCN), Network choke points between IT and OT networks (DMZ, Purdue Model Zone 3.5), SCADA/DCS networks
    range: last 90 days
    queries:
      - pseudocode: FOR EACH high-value asset, MODEL hourly count of unique destination IPs using a SARIMA time-series algorithm based on historical data. TRIGGER alert IF the observed count significantly exceeds the forecasted upper 99% confidence interval.
  - question: Has a network connection been observed using a common ICS protocol (like Modbus or DNP3) from a device that is not on the authorized allow-list for that communication?
    context: This question provides a high-fidelity method for detecting unauthorized devices attempting to communicate with control systems. In a well-managed OT environment, communication paths are static and well-defined. An allow-list defines exactly which devices are permitted to talk to each other using specific protocols. Any deviation from this list is a strong indicator of a misconfiguration or an adversary.
    answer_sources:
      - Zeek conn.log
      - Zeek dnp3.log
      - Zeek modbus.log
      - Zeek s7comm.log
      - Firewall Logs
      - Process Control Network (PCN) subnets containing PLCs, RTUs, and other field controllers, ICS DMZ, Control Server segment
    range: last 90 days
    queries:
      - pseudocode: COMPARE network logs against a version-controlled allow-list of [Source_IP, Dest_IP, Dest_Port, Protocol]. TRIGGER alert IF a connection is observed where (the source IP is NOT on the allow-list AND the destination port is a known ICS port) OR the protocol is identified as an ICS protocol and the communication tuple is not explicitly allowed.
  - question: Is an unauthorized device attempting to scan for multiple ICS devices by connecting to more than one host on ICS-specific ports?
    context: This question helps differentiate between a simple one-off misconfiguration and a deliberate scan by an unauthorized device. If a non-allow-listed device tries to connect to a single ICS host, it might be an error. However, if that same unauthorized device attempts to connect to multiple different ICS hosts, it strongly suggests it is actively searching for and enumerating control systems.
    answer_sources:
      - Zeek conn.log
      - Zeek dnp3.log
      - Zeek modbus.log
      - Zeek s7comm.log
      - Firewall Logs
      - Process Control Network (PCN) subnets containing PLCs, RTUs, and other field controllers, ICS DMZ, Control Server segment
    range: last 90 days
    queries:
      - pseudocode: FILTER for traffic from source IPs NOT on the PCN allow-list. WITHIN a 1-hour window, COUNT unique destination hosts contacted on ICS-specific ports. TRIGGER alert IF count > 1 for any single non-allow-listed source IP.
  - question: Has a machine learning clustering model identified a host within the control network exhibiting behavioral patterns consistent with an unauthorized device performing enumeration?
    context: This question uses an unsupervised machine learning approach to find outlier devices based on their overall communication behavior. By creating a profile for each host (e.g., protocols used, connection counts, error rates), a clustering algorithm like DBSCAN can group similar hosts together. Any host that doesn't fit into a normal cluster (an outlier) is flagged for investigation.
    answer_sources:
      - Zeek conn.log
      - Zeek dnp3.log
      - Zeek modbus.log
      - Zeek s7comm.log
      - Firewall Logs
      - Process Control Network (PCN) subnets containing PLCs, RTUs, and other field controllers, ICS DMZ, Control Server segment
    range: last 90 days
    queries:
      - pseudocode: FOR EACH host in NAI, CREATE feature vectors from 1-hour windows of network logs (e.g., connection counts, protocol ratios, unique destinations, error rates). APPLY a clustering algorithm (e.g., DBSCAN) to the feature vectors. TRIGGER alert for any host classified as an outlier (cluster label -1).