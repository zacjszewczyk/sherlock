name: "T0892: Change Credential"
id: "9e1a8f9c-7b6d-4c5a-b3d2-e1f0a9b8c7d6"
description: "This playbook helps investigate whether an adversary is attempting to inhibit response functions by changing credentials on critical Industrial Control Systems (ICS) devices. It focuses on detecting precursors and direct evidence of unauthorized credential modification. The investigation covers three primary areas: 1) Anomalous or unauthorized use of engineering software on Engineering Workstations (EWS), which could be a precursor to illicit changes. 2) Direct observation of specific ICS network protocol commands (e.g., S7COMM, Modbus, EtherNet/IP) known to alter credentials. 3) Correlated sequences of events that link a suspicious remote logon to an EWS with the subsequent execution of engineering software and the transmission of credential-modifying commands."
type: "technique"
related:
  - "TA0107: Inhibit Response Function"
contributors:
  - "Zachary Szewczyk"
  - "Ask Sage"
created: "2025-10-01"
modified: "2025-10-01"
version: 1.0
tags: "none"
questions:
  - question: "Has monitored ICS engineering software been executed on an Engineering Workstation (EWS) by an unauthorized user account?"
    context: "This question aims to detect a clear policy violation. The execution of sensitive ICS software by an account that is not explicitly authorized for that host is a strong indicator of a compromised account or insider threat, representing a significant risk for unauthorized changes like credential modification."
    answer_sources: "Windows Event ID 4688, Windows Event ID 4624, Zeek conn.log, Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Active Directory Servers, and network gateways within the Process Control Network (PCN) and DMZ."
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: |
          SEARCH EventID=4688 AND Host IN (EWS_List) AND ProcessName IN (ICS_Software_List)
          WHERE UserName NOT IN (Authorized_User_List_for_Host)
  - question: "Has an authorized user executed ICS software or logged in remotely to an EWS at an unusual time or from an unapproved network location?"
    context: "This question focuses on detecting anomalous behavior from otherwise legitimate accounts. By baselining normal working hours and remote access locations, it can identify when an authorized account might be compromised and used outside of its normal operational pattern, which could be a precursor to malicious activity."
    answer_sources: "Windows Event ID 4688, Windows Event ID 4624, Zeek conn.log, Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Active Directory Servers, and network gateways within the Process Control Network (PCN) and DMZ."
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: |
          // Time Anomaly Query
          SEARCH EventID=4688 AND Host IN (EWS_List) AND UserName IN (Authorized_Users)
          COMPARE execution_time with user_baseline_profile
          ALERT if deviation > 2 * standard_deviation

          // Location Anomaly Query
          SEARCH EventID=4624 AND LogonType=10 AND Host IN (EWS_List) AND UserName IN (Authorized_Users)
          WHERE Source_IP NOT IN (user_baseline_IP_subnets)
  - question: "Does machine learning analysis of user, process, time, and network data on EWS hosts reveal activity that significantly deviates from established normal behavior?"
    context: "This question leverages an unsupervised machine learning model (Isolation Forest) to find complex anomalies that simple rules might miss. By combining multiple features like user, process, time of day, and source IP information, the model can identify subtle, multi-faceted deviations from normal activity patterns, providing a more sophisticated layer of detection for potential threats."
    answer_sources: "Windows Event ID 4688, Windows Event ID 4624, Zeek conn.log, Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Active Directory Servers, and network gateways within the Process Control Network (PCN) and DMZ."
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: |
          // ML Model Inference
          INPUT: Real-time stream of (UserID, ProcessName, DayOfWeek, HourOfDay, SourceIP_ASN, SourceIP_Country)
          MODEL: Trained Isolation Forest
          OUTPUT: Anomaly_Score
          ALERT if Anomaly_Score indicates anomaly
  - question: "Has network traffic analysis detected specific ICS protocol commands known to modify device credentials, excluding authorized changes during maintenance windows?"
    context: "This question provides a direct method for detecting credential modification attempts by monitoring for the exact protocol commands used to perform this action (e.g., S7COMM 'Setup Communication', Modbus function 16). By cross-referencing with a change management system, it effectively filters out legitimate administrative activity, reducing false positives and focusing on potentially malicious events."
    answer_sources: "Zeek conn.log, Zeek s7comm.log, Zeek modbus.log, Zeek enip.log, Network segments within the Process Control Network (PCN) where Engineering Workstations (EWS) communicate with Programmable Logic Controllers (PLCs), Remote Terminal Units (RTUs), or Intelligent Electronic Devices (IEDs), including network taps at aggregation switches and firewalls separating these zones."
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: |
          SEARCH (s7comm.log AND function='Setup Communication' AND has_password_params)
          OR (modbus.log AND function_code=16 AND register IN (credential_registers))
          OR (enip.log AND command='Set_Attribute_Single' AND class IN (security_classes))
          WHERE source_ip NOT IN (authorized_change_ips_for_current_time)
  - question: "Has a statistically rare credential-modifying ICS command been observed between an EWS and a controller?"
    context: "This question focuses on identifying suspicious commands based on their rarity. Credential modification commands are typically infrequent compared to normal operational commands. By baselining the frequency of all commands, the detection of a historically rare but high-impact command strongly suggests an unusual and potentially unauthorized action."
    answer_sources: "Zeek conn.log, Zeek s7comm.log, Zeek modbus.log, Zeek enip.log, Network segments within the Process Control Network (PCN) where Engineering Workstations (EWS) communicate with Programmable Logic Controllers (PLCs), Remote Terminal Units (RTUs), or Intelligent Electronic Devices (IEDs), including network taps at aggregation switches and firewalls separating these zones."
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: |
          // Baseline (over 30 days)
          CALCULATE frequency distribution of all ICS function codes per (source_EWS, dest_controller) pair.
          // Real-time check
          SEARCH for credential_modifying_function_code
          IF frequency_of_code in baseline < 1st_percentile
          THEN ALERT
  - question: "Has machine learning analysis detected an anomalous change in the complexity or 'rhythm' of ICS command sequences, potentially indicating a credential modification attempt?"
    context: "This question uses advanced time-series analysis to detect subtle changes in communication patterns. Normal operations have a certain 'rhythm' or complexity, which can be learned by an LSTM autoencoder. A malicious action, like a simple, repetitive credential change attempt, would disrupt this rhythm, leading to a high reconstruction error from the model, thus flagging the activity as anomalous without needing to know the specifics of the command itself."
    answer_sources: "Zeek conn.log, Zeek s7comm.log, Zeek modbus.log, Zeek enip.log, Network segments within the Process Control Network (PCN) where Engineering Workstations (EWS) communicate with Programmable Logic Controllers (PLCs), Remote Terminal Units (RTUs), or Intelligent Electronic Devices (IEDs), including network taps at aggregation switches and firewalls separating these zones."
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: |
          // Model Inference
          INPUT: Time series of Shannon entropy values for ICS function codes in 5-min windows.
          MODEL: Trained LSTM Autoencoder
          OUTPUT: Reconstruction_Error
          ALERT if Reconstruction_Error > 98th_percentile_of_historical_errors
  - question: "Has a correlated sequence of events occurred within a 15-minute window: an anomalous remote logon to an EWS, followed by ICS software execution, and then a credential modification command sent to a controller?"
    context: "This question aims to piece together a full attack chain from disparate log sources. By correlating a suspicious remote login, the subsequent launch of engineering tools, and the final transmission of a credential-changing command, it provides high-fidelity evidence of a complete malicious action, significantly increasing confidence that an attack is underway."
    answer_sources: "Windows Event ID 4624, Windows Event ID 4688, Zeek conn.log, Zeek s7comm.log, Zeek modbus.log, Zeek enip.log, Engineering Workstations (EWS), Active Directory/Authentication Servers, VPN concentrators, and network perimeter devices between the IT and OT networks."
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: |
          SEQUENCE within 15m by UserName, Host
          [SEARCH EventID=4624 AND LogonType=10 AND Source_IP NOT IN (Allowlist)] as stage1
          [SEARCH EventID=4688 AND ProcessName IN (ICS_Software_List)] as stage2
          [SEARCH (s7comm, modbus, or enip logs) for credential_change_command from Host] as stage3
          ALERT on completion of sequence
  - question: "Has a user's activity sequence (logon, process execution, command) on an EWS generated a composite risk score that is anomalously high compared to historical activity?"
    context: "This question moves beyond simple correlation to a risk-based scoring approach. By assigning risk values to different aspects of an activity sequence (e.g., rarity of source IP, time of day, process, command) and summing them, it can quantify the overall suspiciousness of a user's actions. This allows for the detection of 'medium-risk' events that in combination represent a high-risk threat."
    answer_sources: "Windows Event ID 4624, Windows Event ID 4688, Zeek conn.log, Zeek s7comm.log, Zeek modbus.log, Zeek enip.log, Engineering Workstations (EWS), Active Directory/Authentication Servers, VPN concentrators, and network perimeter devices between the IT and OT networks."
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: |
          FOR EACH sequence (logon -> process -> command):
            score = (weight1 * risk(source_IP_ASN)) +
                    (weight2 * risk(login_time_zscore)) +
                    (weight3 * risk(process_rarity)) +
                    (weight4 * risk(command_rarity))
          ALERT if score > 99th_percentile_of_historical_scores
  - question: "Does graph-based analysis of interactions between users, EWS hosts, and controllers reveal anomalous relationships or subgraphs that deviate from learned normal patterns?"
    context: "This question applies graph analytics and machine learning to model complex relationships within the ICS environment. By representing users, hosts, and controllers as a graph, a GNN can learn the normal 'shape' of interactions. An alert is triggered when a new interaction (e.g., a user who never touches a certain controller suddenly sends it a command) creates a subgraph that deviates significantly from these learned patterns, indicating a potential threat."
    answer_sources: "Windows Event ID 4624, Windows Event ID 4688, Zeek conn.log, Zeek s7comm.log, Zeek modbus.log, Zeek enip.log, Engineering Workstations (EWS), Active Directory/Authentication Servers, VPN concentrators, and network perimeter devices between the IT and OT networks."
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: |
          // Model Inference
          INPUT: Graph of (User, Host, Controller) nodes and (logs_into, executes, sends_command_to) edges with attributes.
          MODEL: Trained Graph Neural Network (GNN)
          OUTPUT: Anomaly score for new edges or subgraphs
          ALERT if anomaly score is high