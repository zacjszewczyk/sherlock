name: "T0801: Monitor Process State"
id: "9f8e7d6c-5b4a-4f3e-8d2c-1b0a9f8e7d6c"
description: |
  This playbook helps determine if an unauthorized entity has accessed or queried process state data from key Industrial Control System (ICS) components. It focuses on detecting anomalous read requests, network scanning behavior, and suspicious activity following remote logons. Indicators include unauthorized connections making ICS protocol read requests, approved sources exceeding baseline data transfer volumes, hosts connecting to an anomalous number of unique devices, and high-risk remote logons followed by a burst of read requests to field devices.
type: "technique"
related:
  - "TA0100: Collection"
contributors:
  - "Zachary Szewczyk"
  - "Ask Sage"
created: "2025-10-01"
modified: "2025-10-01"
version: 1.0
tags: "none"
questions:
  - question: "Is an unauthorized source (IP or user) attempting to read ICS process data?"
    context: "This question aims to identify unauthorized read attempts against critical ICS assets. By maintaining an allow-list of approved source IP, user account, and destination asset combinations, any deviation from this known-good state can be immediately flagged as a potential threat. The playbook correlates network protocol logs (e.g., Modbus, DNP3) with Windows logon events to provide a comprehensive view of the activity, linking a network request to a specific user account on the target system."
    answer_sources:
      - "Data Sources: Zeek conn.log, Zeek modbus.log, Zeek dnp3.log, Zeek opc.log, Windows Event ID 4624, Windows Event ID 4663"
      - "NAI: Data Historian servers (Level 3), Process Control Network (PCN) gateways (Level 3/2), PLC subnets (Level 1/2), HMI/EWS subnets (Level 2.5/2), DMZ between IT and OT networks."
    range: "last 90 days"
    queries:
      - "SEARCH Zeek logs (modbus, dnp3, opc) for read requests WHERE (Source IP, User, Destination IP) NOT IN allow_list. CORRELATE source IP with Windows Event ID 4624 on destination within 5 minutes."
  - question: "Has an authorized source exceeded its normal baseline for ICS data read volume or request count?"
    context: "This question addresses the insider threat or compromised account scenario where an authorized entity behaves anomalously. By establishing a 30-day rolling baseline of normal activity (read counts and data volume) for each authorized source, we can detect significant deviations. An alert is triggered if a source's activity exceeds its 99th percentile, suggesting unusual data collection or exfiltration."
    answer_sources:
      - "Data Sources: Zeek conn.log, Zeek modbus.log, Zeek dnp3.log, Zeek opc.log, Windows Event ID 4624, Windows Event ID 4663"
      - "NAI: Data Historian servers (Level 3), Process Control Network (PCN) gateways (Level 3/2), PLC subnets (Level 1/2), HMI/EWS subnets (Level 2.5/2), DMZ between IT and OT networks."
    range: "last 90 days"
    queries:
      - "FOR each authorized source, CALCULATE 30-day baseline (99th percentile) of daily read counts and bytes transferred from Zeek logs. ALERT if current daily count OR volume > baseline."
  - question: "Are there statistically anomalous ICS read requests that deviate from normal patterns?"
    context: "This question uses unsupervised machine learning (Isolation Forest) to detect novel or sophisticated attacks that might not be caught by signature-based rules or simple thresholds. By analyzing multiple features of a request (IPs, port, function code, size, timing), the model can identify rare combinations of attributes that signify an anomaly. This helps in discovering previously unseen attack patterns."
    answer_sources:
      - "Data Sources: Zeek conn.log, Zeek modbus.log, Zeek dnp3.log, Zeek opc.log, Windows Event ID 4624, Windows Event ID 4663"
      - "NAI: Data Historian servers (Level 3), Process Control Network (PCN) gateways (Level 3/2), PLC subnets (Level 1/2), HMI/EWS subnets (Level 2.5/2), DMZ between IT and OT networks."
    range: "last 90 days"
    queries:
      - "FROM Zeek logs, CREATE feature vector for each read request (source/dest IP, port, function code, size, time). APPLY pre-trained Isolation Forest model. ALERT on requests with high anomaly scores."
  - question: "Is an ICS host communicating with unauthorized devices or on unapproved ports?"
    context: "This question aims to detect network reconnaissance or lateral movement by identifying violations of the established network communication policy. A defined network map of allowed connections (source, destination, port) is used as a baseline. Any connection attempt outside this map, logged by Zeek, is flagged as suspicious. Correlating this with process creation events on the source host helps pinpoint the malicious or misconfigured software responsible."
    answer_sources:
      - "Data Sources: Zeek conn.log, Zeek modbus.log, Zeek dnp3.log, Zeek opc.log, Windows Event ID 5156, Windows Event ID 4688"
      - "NAI: Engineering Workstations (EWS) (Level 2), Human-Machine Interface (HMI) systems (Level 2), Level 2/3 network boundary devices, PLC/RTU subnets (Level 1/2), ICS application servers (Level 2.5)."
    range: "last 90 days"
    queries:
      - "SEARCH Zeek conn.log for connections on ICS ports WHERE (Source, Destination, Port) NOT IN network_map. CORRELATE alerts with Windows Event ID 4688 on source host to find process."
  - question: "Is an ICS host attempting to connect to an unusually high number of unique devices, suggesting scanning behavior?"
    context: "This question focuses on detecting sweeping or scanning activity, a common reconnaissance technique. By baselining the normal number of unique devices an ICS host connects to within a 15-minute window, we can identify when a host exceeds its typical behavior. An alert is triggered if the count surpasses the 99th percentile, indicating a potential attempt to map out the network or find vulnerable devices."
    answer_sources:
      - "Data Sources: Zeek conn.log, Zeek modbus.log, Zeek dnp3.log, Zeek opc.log, Windows Event ID 5156, Windows Event ID 4688"
      - "NAI: Engineering Workstations (EWS) (Level 2), Human-Machine Interface (HMI) systems (Level 2), Level 2/3 network boundary devices, PLC/RTU subnets (Level 1/2), ICS application servers (Level 2.5)."
    range: "last 90 days"
    queries:
      - "FOR each ICS host, CALCULATE 30-day baseline (99th percentile) for count of unique destination IPs over 15-min window from Zeek conn.log. ALERT if current count > baseline."
  - question: "Does any host exhibit anomalous network communication patterns when compared to its peers?"
    context: "This question uses unsupervised clustering (DBSCAN) to identify outlier hosts based on their communication patterns. Instead of looking at individual connections, it analyzes a host's behavior over a 1-hour window, considering factors like the set of ports and subnets contacted. Hosts that do not fit into any cluster of 'normal' behavior are flagged as anomalies, which could indicate a compromise or misconfiguration."
    answer_sources:
      - "Data Sources: Zeek conn.log, Zeek modbus.log, Zeek dnp3.log, Zeek opc.log, Windows Event ID 5156, Windows Event ID 4688"
      - "NAI: Engineering Workstations (EWS) (Level 2), Human-Machine Interface (HMI) systems (Level 2), Level 2/3 network boundary devices, PLC/RTU subnets (Level 1/2), ICS application servers (Level 2.5)."
    range: "last 90 days"
    queries:
      - "FROM 1-hour windows, CREATE feature vector for each host (dest ports, dest subnets, dest IP entropy). APPLY DBSCAN clustering. ALERT on hosts classified as 'noise' points."
  - question: "Following a high-risk remote logon to a critical ICS host, is there a subsequent burst of read requests to multiple devices?"
    context: "This question correlates a potentially compromised remote access session with immediate post-access activity. A 'high-risk' logon is first identified based on anomalous characteristics (e.g., unusual time, location). The playbook then specifically looks for a burst of ICS read requests to multiple distinct devices within 10 minutes of that logon. This combination of events is a strong indicator of an attacker using the newly acquired access to perform reconnaissance."
    answer_sources:
      - "Data Sources: Windows Event ID 4624, Windows Event ID 4648, Zeek conn.log, Zeek rdp.log, Zeek modbus.log, Zeek dnp3.log, Zeek opc.log"
      - "NAI: Human-Machine Interfaces (HMIs) (Level 2), Engineering Workstations (EWS) (Level 2), ICS Application Servers (Level 2.5), Jump Servers (Level 3/2.5), Active Directory Domain Controllers (Level 3)."
    range: "last 90 days"
    queries:
      - "DETECT high-risk logon (Windows Event ID 4624, Type 10) based on location, time, etc. IF detected, MONITOR Zeek logs for read requests from that host. ALERT if > 3 unique PLCs are queried in next 10 mins."
  - question: "Does the number of devices queried after a remote logon exceed the established baseline for that host?"
    context: "This question provides a more statistically rigorous version of the previous one. It establishes a historical baseline for each critical host, defining the normal number of unique devices queried within 10 minutes of a remote logon. An alert is triggered if the post-logon activity exceeds the 95th percentile of this baseline, providing a data-driven approach to detecting anomalous reconnaissance activity following remote access."
    answer_sources:
      - "Data Sources: Windows Event ID 4624, Windows Event ID 4648, Zeek conn.log, Zeek rdp.log, Zeek modbus.log, Zeek dnp3.log, Zeek opc.log"
      - "NAI: Human-Machine Interfaces (HMIs) (Level 2), Engineering Workstations (EWS) (Level 2), ICS Application Servers (Level 2.5), Jump Servers (Level 3/2.5), Active Directory Domain Controllers (Level 3)."
    range: "last 90 days"
    queries:
      - "FOR each critical host, CALCULATE 30-day baseline (95th percentile) for count of unique devices queried in 10 mins post-logon (Event ID 4624, Type 10). ALERT if current count > baseline."
  - question: "Can a logon session be classified as a likely precursor to malicious activity based on its combined features?"
    context: "This question uses a supervised machine learning model (Random Forest) to proactively classify the risk of a logon session. By training the model on historical data labeled as benign or malicious, it learns to weigh various features (logon time, location, post-logon queries) to predict the likelihood of a session being a precursor to an attack. This provides a holistic risk score for the session, with explainable feature importance to guide the analyst's investigation."
    answer_sources:
      - "Data Sources: Windows Event ID 4624, Windows Event ID 4648, Zeek conn.log, Zeek rdp.log, Zeek modbus.log, Zeek dnp3.log, Zeek opc.log"
      - "NAI: Human-Machine Interfaces (HMIs) (Level 2), Engineering Workstations (EWS) (Level 2), ICS Application Servers (Level 2.5), Jump Servers (Level 3/2.5), Active Directory Domain Controllers (Level 3)."
    range: "last 90 days"
    queries:
      - "FOR each logon session, CREATE feature vector (time, geo, post-logon activity). APPLY pre-trained Random Forest classifier. ALERT if session is classified as malicious precursor with high probability."