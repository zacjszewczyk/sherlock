name: T0801: Monitor Process State
id: a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d
description: This playbook helps answer the question: Has an unauthorized entity accessed or queried process state data from key ICS components? It focuses on detecting anomalous data collection activities by monitoring ICS protocol read requests from unapproved sources, identifying when approved sources exceed their normal data transfer volumes, and flagging hosts that exhibit network reconnaissance behavior by connecting to an unusual number of devices. Additionally, it correlates high-risk remote logons to critical systems with subsequent bursts of ICS read requests, providing a multi-faceted approach to uncovering illicit process state monitoring.
type: technique
related:
  - TA0100: Collection
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Are there ICS read requests originating from unapproved source IPs or user accounts?
    context: This question aims to identify unauthorized access attempts. By maintaining an allow-list of approved (Source IP, User Account, Destination Asset IP) combinations for ICS read operations, security teams can quickly detect and alert on any read requests that do not match this list. This is a fundamental step in enforcing access control policies within an OT environment. Enriching these alerts with user logon information provides immediate context about the potential actor.
    answer_sources:
      - Zeek conn.log
      - Zeek modbus.log
      - Zeek dnp3.log
      - Zeek opc.log
      - Windows Event ID 4624
      - Windows Event ID 4663
      - Data Historian servers (Level 3)
      - Process Control Network (PCN) gateways (Level 3/2)
      - PLC subnets (Level 1/2)
      - HMI/EWS subnets (Level 2.5/2)
      - DMZ between IT and OT networks.
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          SEARCH Zeek ICS logs (modbus, dnp3, opc) for read requests.
          FOR each request:
            EXTRACT (Source IP, Destination IP).
            CORRELATE Source IP with Windows logon events (4624) on Destination IP to get User Account.
            IF (Source IP, User Account, Destination IP) NOT IN allow_list:
              ALERT.
  - question: Have any authorized sources exceeded their normal daily volume of ICS read requests or data transfers?
    context: Even authorized users can be compromised or act maliciously. This question helps detect anomalous behavior from otherwise trusted sources. By establishing a statistical baseline (e.g., 99th percentile) for the daily number of read requests and the total volume of data transferred for each authorized source, we can identify significant deviations. An alert on a baseline breach could indicate data exfiltration, internal reconnaissance, or a misconfigured application.
    answer_sources:
      - Zeek conn.log
      - Zeek modbus.log
      - Zeek dnp3.log
      - Zeek opc.log
      - Windows Event ID 4624
      - Windows Event ID 4663
      - Data Historian servers (Level 3)
      - Process Control Network (PCN) gateways (Level 3/2)
      - PLC subnets (Level 1/2)
      - HMI/EWS subnets (Level 2.5/2)
      - DMZ between IT and OT networks.
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          FOR each authorized source (IP/user):
            CALCULATE 30-day rolling baseline (99th percentile) for daily_read_count and daily_bytes_transferred from Zeek logs.
          FOR each day:
            CALCULATE current_daily_read_count and current_daily_bytes_transferred for each source.
            IF current_daily_read_count > baseline_read_count OR current_daily_bytes_transferred > baseline_bytes_transferred:
              ALERT.
  - question: Can anomalous ICS read requests be detected using unsupervised machine learning?
    context: This question explores a more advanced, behavior-based detection method that can catch novel or sophisticated attacks that might evade static rules. By using an anomaly detection model like Isolation Forest, we can analyze multiple features of a read request simultaneously (e.g., source/destination, port, function code, data size, time). The model learns what 'normal' traffic looks like and assigns a high anomaly score to requests that deviate significantly, indicating a rare and potentially suspicious combination of attributes.
    answer_sources:
      - Zeek conn.log
      - Zeek modbus.log
      - Zeek dnp3.log
      - Zeek opc.log
      - Windows Event ID 4624
      - Windows Event ID 4663
      - Data Historian servers (Level 3)
      - Process Control Network (PCN) gateways (Level 3/2)
      - PLC subnets (Level 1/2)
      - HMI/EWS subnets (Level 2.5/2)
      - DMZ between IT and OT networks.
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          TRAIN Isolation Forest model on historical known-good Zeek ICS log data.
          FEATURES: source_ip, dest_ip, port, function_code, data_size, time_of_day, etc.
          APPLY trained model to live traffic.
          FOR each new read request:
            CALCULATE anomaly_score.
            IF anomaly_score > threshold:
              ALERT.
  - question: Are there network connections from ICS hosts that violate the established communication map?
    context: ICS networks often have highly predictable communication patterns. This question leverages that predictability to detect unauthorized network activity. By defining an explicit map of allowed connections (Source Host, Destination Device, Port), any deviation can be immediately flagged as a policy violation. This is effective for detecting lateral movement or reconnaissance where an attacker's machine tries to communicate with devices it has no legitimate reason to access. Correlating with process creation events helps pinpoint the malicious software responsible.
    answer_sources:
      - Zeek conn.log
      - Zeek modbus.log
      - Zeek dnp3.log
      - Zeek opc.log
      - Windows Event ID 5156
      - Windows Event ID 4688
      - Engineering Workstations (EWS) (Level 2)
      - Human-Machine Interface (HMI) systems (Level 2)
      - Level 2/3 network boundary devices
      - PLC/RTU subnets (Level 1/2)
      - ICS application servers (Level 2.5).
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          SEARCH Zeek conn.log for connections on ICS ports.
          FOR each connection:
            EXTRACT (Source Host, Destination Device, Port).
            IF (Source Host, Destination Device, Port) NOT IN communication_map:
              ALERT.
              CORRELATE with process creation events (4688) on Source Host to find responsible process.
  - question: Is any ICS host connecting to an unusually high number of unique devices, suggesting reconnaissance?
    context: An attacker attempting to map out an ICS network will often 'sweep' a range of IP addresses, resulting in one host connecting to many different devices in a short period. This question aims to detect such sweeping behavior. By establishing a baseline for how many unique devices a host normally communicates with in a given time window (e.g., 15 minutes), we can alert when a host significantly exceeds its own normal behavior. This is a powerful way to detect reconnaissance without needing a predefined network map.
    answer_sources:
      - Zeek conn.log
      - Zeek modbus.log
      - Zeek dnp3.log
      - Zeek opc.log
      - Windows Event ID 5156
      - Windows Event ID 4688
      - Engineering Workstations (EWS) (Level 2)
      - Human-Machine Interface (HMI) systems (Level 2)
      - Level 2/3 network boundary devices
      - PLC/RTU subnets (Level 1/2)
      - ICS application servers (Level 2.5).
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          FOR each ICS host:
            CALCULATE 30-day baseline (99th percentile) of unique_dest_ips_per_15_mins from Zeek conn.log.
          MONITOR live traffic in 15-minute rolling windows.
          FOR each host in each window:
            CALCULATE current_unique_dest_ips.
            IF current_unique_dest_ips > baseline_unique_dest_ips:
              ALERT.
  - question: Can we identify ICS hosts with anomalous communication patterns using clustering algorithms?
    context: This question addresses the detection of hosts whose overall communication behavior deviates from the norm, even if it doesn't trigger a single specific rule. Using a clustering algorithm like DBSCAN, we can group hosts with similar communication profiles (e.g., sets of ports and subnets they talk to). Hosts that don't fit into any cluster are labeled as 'noise' or outliers. These outliers represent anomalous behavior and could be compromised systems or attacker-controlled machines, warranting further investigation.
    answer_sources:
      - Zeek conn.log
      - Zeek modbus.log
      - Zeek dnp3.log
      - Zeek opc.log
      - Windows Event ID 5156
      - Windows Event ID 4688
      - Engineering Workstations (EWS) (Level 2)
      - Human-Machine Interface (HMI) systems (Level 2)
      - Level 2/3 network boundary devices
      - PLC/RTU subnets (Level 1/2)
      - ICS application servers (Level 2.5).
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          FOR each host over 1-hour windows:
            CREATE feature vector (e.g., set of destination ports, set of destination subnets, entropy of destination IPs).
          RUN DBSCAN algorithm on the set of all host feature vectors.
          FOR each host labeled as a 'noise' point by DBSCAN:
            ALERT.
  - question: Has a high-risk remote logon been followed by a burst of ICS read requests to multiple devices?
    context: Attackers often gain initial access via remote services like RDP and then immediately begin internal reconnaissance. This question links a suspicious logon event to subsequent suspicious network activity. A 'high-risk' logon can be defined by multiple factors, such as access from an unusual location, at an odd time, or a user logging into a machine for the first time. If such a logon is quickly followed by the same host querying many different PLCs or RTUs, it creates a high-fidelity alert for a potential hands-on-keyboard attack.
    answer_sources:
      - Windows Event ID 4624
      - Windows Event ID 4648
      - Zeek conn.log
      - Zeek rdp.log
      - Zeek modbus.log
      - Zeek dnp3.log
      - Zeek opc.log
      - Human-Machine Interfaces (HMIs) (Level 2)
      - Engineering Workstations (EWS) (Level 2)
      - ICS Application Servers (Level 2.5)
      - Jump Servers (Level 3/2.5)
      - Active Directory Domain Controllers (Level 3).
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          MONITOR Windows Event ID 4624 (Logon Type 10) on critical hosts.
          IF logon is 'high-risk' (e.g., new geo, off-hours):
            TRIGGER monitoring on source host IP for 10 minutes.
            COUNT unique PLC/RTU destinations queried in Zeek ICS logs.
            IF count > 3:
              ALERT.
  - question: Following a remote logon, has the number of unique devices queried exceeded the established baseline for that host?
    context: This is a behavior-based alternative to the previous rule-based question. Instead of a static threshold, it establishes a normal baseline for post-logon activity for each critical host. It measures the number of unique devices typically queried within 10 minutes of a remote logon. If a new logon session results in a number of queried devices that exceeds the 95th percentile of that host's normal behavior, it triggers an alert. This approach adapts to the specific role of each host and is less prone to false positives in environments where querying multiple devices post-logon is sometimes normal.
    answer_sources:
      - Windows Event ID 4624
      - Windows Event ID 4648
      - Zeek conn.log
      - Zeek rdp.log
      - Zeek modbus.log
      - Zeek dnp3.log
      - Zeek opc.log
      - Human-Machine Interfaces (HMIs) (Level 2)
      - Engineering Workstations (EWS) (Level 2)
      - ICS Application Servers (Level 2.5)
      - Jump Servers (Level 3/2.5)
      - Active Directory Domain Controllers (Level 3).
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          FOR each critical host:
            CALCULATE 30-day baseline (95th percentile) for unique_devices_queried_within_10_mins_post_logon.
          MONITOR for new remote logons (Event ID 4624, Type 10).
          AFTER a logon:
            CALCULATE current_unique_devices_queried in the next 10 minutes.
            IF current_unique_devices_queried > baseline:
              ALERT.
  - question: Can we classify remote logon sessions as potentially malicious precursors using a supervised machine learning model?
    context: This question proposes the most sophisticated approach, using a supervised model like a Random Forest to classify an entire logon session. By creating a rich feature set for each session (logon time, user, source location, and post-logon activity like devices queried and data transferred), the model can be trained on labeled historical examples of benign and malicious sessions. Once trained, it can predict with a certain probability whether a new, live session is a precursor to an attack, providing analysts with a high-confidence alert and an explanation based on the most important features.
    answer_sources:
      - Windows Event ID 4624
      - Windows Event ID 4648
      - Zeek conn.log
      - Zeek rdp.log
      - Zeek modbus.log
      - Zeek dnp3.log
      - Zeek opc.log
      - Human-Machine Interfaces (HMIs) (Level 2)
      - Engineering Workstations (EWS) (Level 2)
      - ICS Application Servers (Level 2.5)
      - Jump Servers (Level 3/2.5)
      - Active Directory Domain Controllers (Level 3).
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          TRAIN Random Forest classifier on labeled historical logon session data.
          FEATURES: logon_time, geolocation, user, post_logon_unique_dest_count, post_logon_bytes_transferred, etc.
          APPLY trained model to live logon sessions.
          IF model_prediction_probability > threshold:
            ALERT with feature importance for explanation.