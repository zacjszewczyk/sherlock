name: "T0823: Graphical User Interface"
id: "f47ac10b-58cc-4372-a567-0e02b2c3d479"
description: |
  This playbook helps investigate if an adversary is using GUI-based remote access for execution on critical ICS hosts. It focuses on identifying successful remote interactive logons (Windows Event ID 4624, Logon Type 10) to critical ICS assets that violate established policies (e.g., IP allow-lists, authorized user groups, maintenance windows). It also examines network traffic telemetry (e.g., Zeek conn.log) for RDP or VNC connections to critical assets that originate from unauthorized sources or exhibit anomalous characteristics like unusual data volume or duration.
type: "technique"
related:
  - "TA0104: Execution"
contributors:
  - "Zachary Szewczyk"
created: "2025-10-01"
modified: "2025-10-01"
version: 1.0
tags: "none"
investigative_questions:
  - question: "Are there any successful remote logons to critical ICS assets that violate established access policies?"
    context: |
      This question aims to detect policy violations in remote access. It involves maintaining an inventory of critical ICS assets (like HMIs and EWS) with their corresponding allow-lists for source IPs, user groups, and operational hours. By querying for successful remote logons (Windows Event ID 4624, Logon Type 10) and comparing them against these policies, we can identify unauthorized access attempts that may indicate adversarial activity. A high-priority alert should be triggered for any logon that breaches these defined rules.
    answer_sources:
      - "Windows Event ID 4624"
      - "Windows Event ID 4625"
      - "Windows Event ID 4634"
      - "Windows Event ID 4647"
      - "Active Directory Security Logs"
      - "Zeek conn.log"
      - "Human-Machine Interfaces (HMIs)"
      - "Engineering Workstations (EWS)"
      - "Operator Workstations (OWS)"
      - "ICS Domain Controllers"
      - "Jump Servers"
      - "Remote Access Gateways"
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "SEARCH for successful remote logons (EventID 4624, Logon Type 10) to critical assets. JOIN with asset inventory. FILTER for logons where source IP, user group, or timestamp is NOT in the allow-list."
  - question: "Have any recent RDP logons to critical assets shown statistically significant deviations from their historical baselines in terms of time or duration?"
    context: |
      This question seeks to identify anomalous logon behavior by establishing a baseline for each unique user-and-asset pair. It involves calculating the historical distribution (mean, standard deviation) of logon hour-of-day and session duration over a 30-day rolling window by correlating logon (4624) and logoff (4634/4647) events. A new logon's hour is then evaluated using a z-score. An alert is triggered if the logon time is highly unusual (z-score > 3) or if the session duration is excessively long (exceeds the 95th percentile), suggesting potential misuse or compromise.
    answer_sources:
      - "Windows Event ID 4624"
      - "Windows Event ID 4625"
      - "Windows Event ID 4634"
      - "Windows Event ID 4647"
      - "Active Directory Security Logs"
      - "Zeek conn.log"
      - "Human-Machine Interfaces (HMIs)"
      - "Engineering Workstations (EWS)"
      - "Operator Workstations (OWS)"
      - "ICS Domain Controllers"
      - "Jump Servers"
      - "Remote Access Gateways"
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "FOR each user-asset pair, CALCULATE baseline logon hour and duration stats. FOR each new logon, CALCULATE z-score for hour and percentile for duration. ALERT if z-score > 3 OR duration > 95th percentile."
  - question: "Can an unsupervised machine learning model detect anomalous RDP logon events that deviate from established normal access patterns?"
    context: |
      This question leverages machine learning to detect subtle anomalies in RDP logon patterns. It involves creating a feature vector for each logon event (including user, host, source IP, day, hour) and training an unsupervised model like an Isolation Forest on a baseline of known-good events. The trained model then scores new logons in real-time. An alert is generated if a logon receives a high anomaly score, indicating it is a significant outlier from the learned normal behavior, which could signify a compromised account or an intruder.
    answer_sources:
      - "Windows Event ID 4624"
      - "Windows Event ID 4625"
      - "Windows Event ID 4634"
      - "Windows Event ID 4647"
      - "Active Directory Security Logs"
      - "Zeek conn.log"
      - "Human-Machine Interfaces (HMIs)"
      - "Engineering Workstations (EWS)"
      - "Operator Workstations (OWS)"
      - "ICS Domain Controllers"
      - "Jump Servers"
      - "Remote Access Gateways"
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "TRAIN Isolation Forest model on baseline of benign RDP logons. SCORE new RDP logons in real-time. ALERT if anomaly score exceeds a pre-defined threshold."
  - question: "Are there any RDP or VNC network connections to critical ICS assets originating from unauthorized source IPs?"
    context: |
      This question focuses on enforcing network-level access controls. It requires maintaining an inventory of critical ICS asset IPs and an allow-list of authorized source IPs for RDP/VNC access. By querying network connection logs (like Zeek conn.log) for traffic on ports 3389 or 5900-5906 to these assets, we can check if the source IP is on the approved list. A high-priority alert should be triggered for any connection from a non-allow-listed IP, as this is a direct violation of network policy.
    answer_sources:
      - "Zeek conn.log"
      - "Zeek rdp.log"
      - "Zeek x509.log"
      - "Firewall logs"
      - "ICS Network Segments"
      - "Demilitarized Zone (DMZ) Firewalls"
      - "Connections between IT and OT networks"
      - "Remote Access Gateways/VPN Concentrators"
      - "Perimeter Firewalls (IT/OT boundary)"
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "SEARCH Zeek conn.log for dest_port in (3389, 5900-5906) and dest_ip in critical asset list. FILTER where source_ip is NOT in the allow-list for that asset. ALERT."
  - question: "Do any authorized RDP/VNC connections exhibit anomalous characteristics in duration, data volume, or protocol-specific fields?"
    context: |
      This question aims to find anomalies even within seemingly authorized connections. For each authorized source-destination pair, it involves establishing a 30-day rolling baseline for connection duration and total bytes transferred, as well as the Shannon entropy of the RDP 'cookie' field. An alert is generated if a new connection's duration or byte count exceeds the 99th percentile for that pair, or if the RDP cookie's entropy deviates significantly (e.g., by more than 3 standard deviations) from its baseline, potentially indicating a hijacked session or non-standard client.
    answer_sources:
      - "Zeek conn.log"
      - "Zeek rdp.log"
      - "Zeek x509.log"
      - "Firewall logs"
      - "ICS Network Segments"
      - "Demilitarized Zone (DMZ) Firewalls"
      - "Connections between IT and OT networks"
      - "Remote Access Gateways/VPN Concentrators"
      - "Perimeter Firewalls (IT/OT boundary)"
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "FOR each authorized source-dest pair, CALCULATE baseline stats (duration, bytes, RDP cookie entropy). FOR each new connection, ALERT if duration/bytes > 99th percentile OR cookie entropy deviates > 3 stddev."
  - question: "Can a time-series anomaly detection model identify unusual patterns in the overall volume and characteristics of remote access traffic to critical assets?"
    context: |
      This question uses a macroscopic approach to detect anomalies by analyzing aggregated traffic patterns over time. It involves grouping network connection data into time windows (e.g., 10 minutes) and engineering features like connection counts, total bytes, unique source IPs, and average session duration for each critical asset. A multivariate time-series model (like a VAE or LSTM autoencoder) is trained on this historical data to learn the 'normal rhythm' of access. The model's reconstruction error is then used to score new time windows, with high errors triggering alerts for anomalous traffic patterns.
    answer_sources:
      - "Zeek conn.log"
      - "Zeek rdp.log"
      - "Zeek x509.log"
      - "Firewall logs"
      - "ICS Network Segments"
      - "Demilitarized Zone (DMZ) Firewalls"
      - "Connections between IT and OT networks"
      - "Remote Access Gateways/VPN Concentrators"
      - "Perimeter Firewalls (IT/OT boundary)"
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "AGGREGATE Zeek logs into 10-min windows with features (conn_count, bytes, etc.). TRAIN time-series model (e.g., VAE) on historical windows. SCORE new windows based on reconstruction error. ALERT on high error."