name: T0823: Graphical User Interface
id: c18e1f5a-73d8-4f1b-8c2d-9e6a5b4f3c2d
description: This playbook helps determine if an adversary is using GUI-based remote access for execution on critical ICS hosts. It focuses on identifying successful remote interactive logons (Windows Event ID 4624, Logon Type 10) to critical assets that violate established policies (e.g., IP allow-lists, authorized user groups, maintenance windows). It also investigates network traffic telemetry (e.g., Zeek conn.log) for RDP (TCP/3389) or VNC (TCP/5900-5906) connections to critical ICS assets that originate from unauthorized sources or exhibit anomalous characteristics like unusual data volume or duration.
type: technique
related:
  - TA0104: Execution
contributors:
  - Zachary Szewczyk
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Are there any successful remote logons to critical ICS assets that violate established access policies?
    context: This question aims to detect policy violations in remote access. By maintaining an inventory of critical ICS assets with corresponding allow-lists for source IPs, user groups, and operational hours, analysts can identify unauthorized access attempts. A logon that violates these predefined rules (e.g., from an unapproved IP, by an unauthorized user, or outside of maintenance windows) is a strong indicator of potential malicious activity and requires immediate investigation.
    answer_sources:
      - Windows Event ID 4624
      - Windows Event ID 4625
      - Windows Event ID 4634
      - Windows Event ID 4647
      - Active Directory Security Logs
      - Zeek conn.log
      - Human-Machine Interfaces (HMIs)
      - Engineering Workstations (EWS)
      - Operator Workstations (OWS)
      - ICS Domain Controllers
      - Jump Servers
      - Remote Access Gateways
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |-
          SELECT logon_events
          FROM Windows Event Logs (ID 4624, Type 10)
          WHERE target_host IN critical_ics_assets
          JOIN asset_inventory ON logon_events.target_host = asset_inventory.host
          WHERE logon_events.source_ip NOT IN asset_inventory.allowed_ips
            OR logon_events.user NOT IN asset_inventory.allowed_user_groups
            OR logon_events.timestamp NOT WITHIN asset_inventory.allowed_hours
  - question: Have any recent remote logon sessions to critical ICS assets exhibited anomalous timing or duration compared to historical baselines?
    context: This question focuses on detecting behavioral anomalies in remote access patterns. Even authorized users can have their accounts compromised. By establishing a baseline of normal logon times and session durations for each user-asset pair, analysts can spot deviations that might indicate credential misuse. A logon occurring at an unusual hour or lasting significantly longer than normal for a specific user and system warrants further scrutiny.
    answer_sources:
      - Windows Event ID 4624
      - Windows Event ID 4625
      - Windows Event ID 4634
      - Windows Event ID 4647
      - Active Directory Security Logs
      - Zeek conn.log
      - Human-Machine Interfaces (HMIs)
      - Engineering Workstations (EWS)
      - Operator Workstations (OWS)
      - ICS Domain Controllers
      - Jump Servers
      - Remote Access Gateways
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |-
          FOR each new logon (Event ID 4624, Type 10):
            CALCULATE historical mean/stddev of logon_hour for user-asset pair (last 30 days)
            CALCULATE z_score for current logon_hour
            CALCULATE historical 95th percentile of session_duration for user-asset pair (correlate with Event ID 4634/4647)
            ALERT if z_score > 3 OR current_session_duration > 95th_percentile
  - question: Can machine learning models identify any anomalous remote logon events that deviate from established patterns of benign activity?
    context: This question leverages machine learning to find subtle or complex anomalies that rule-based or simple statistical methods might miss. By training an unsupervised model (like an Isolation Forest) on a feature set including user, host, source IP, and time, the system can learn what constitutes 'normal' access. Events that are flagged as outliers by the model represent significant deviations from the norm and could indicate sophisticated adversary behavior.
    answer_sources:
      - Windows Event ID 4624
      - Windows Event ID 4625
      - Windows Event ID 4634
      - Windows Event ID 4647
      - Active Directory Security Logs
      - Zeek conn.log
      - Human-Machine Interfaces (HMIs)
      - Engineering Workstations (EWS)
      - Operator Workstations (OWS)
      - ICS Domain Controllers
      - Jump Servers
      - Remote Access Gateways
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |-
          // Training Phase
          FEATURE_VECTORS = create_features(user, host, source_ip, day_of_week, hour) from historical benign logons
          MODEL = train_isolation_forest(FEATURE_VECTORS)

          // Real-time Scoring
          FOR each new logon:
            VECTOR = create_features(new_logon)
            ANOMALY_SCORE = MODEL.predict(VECTOR)
            ALERT if ANOMALY_SCORE > threshold
  - question: Are there any RDP or VNC network connections to critical ICS assets originating from unauthorized source IP addresses?
    context: This question provides a network-level check for policy violations. By monitoring network traffic for RDP (TCP/3389) or VNC (TCP/5900-5906) connections to critical systems, analysts can enforce network segmentation and access control policies. A connection from an IP address not on the explicit allow-list for a given asset is a clear violation and a high-fidelity indicator of a potential intrusion attempt or misconfiguration.
    answer_sources:
      - Zeek conn.log
      - Zeek rdp.log
      - Zeek x509.log
      - Firewall logs
      - ICS Network Segments
      - Demilitarized Zone (DMZ) Firewalls
      - Connections between IT and OT networks
      - Remote Access Gateways/VPN Concentrators
      - Perimeter Firewalls (IT/OT boundary)
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |-
          SELECT connections
          FROM Zeek conn.log
          WHERE dest_port IN (3389, 5900-5906)
            AND dest_ip IN critical_ics_assets
          JOIN asset_inventory ON connections.dest_ip = asset_inventory.ip
          WHERE connections.source_ip NOT IN asset_inventory.allowed_source_ips
  - question: Do any authorized RDP/VNC connections to critical assets show anomalous characteristics like excessive duration, data transfer, or unusual cookie entropy?
    context: This question seeks to find anomalies within otherwise legitimate communication channels. An adversary who has gained access to an authorized machine may use that access for malicious purposes, such as data exfiltration or lateral movement. By baselining normal connection metrics (duration, bytes transferred) and protocol-specific details (RDP cookie entropy) for each authorized source-destination pair, analysts can detect when a connection is being used in an abnormal way, which may indicate malicious activity.
    answer_sources:
      - Zeek conn.log
      - Zeek rdp.log
      - Zeek x509.log
      - Firewall logs
      - ICS Network Segments
      - Demilitarized Zone (DMZ) Firewalls
      - Connections between IT and OT networks
      - Remote Access Gateways/VPN Concentrators
      - Perimeter Firewalls (IT/OT boundary)
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |-
          FOR each new RDP/VNC connection:
            GET historical 99th_percentile_duration for source-dest pair
            GET historical 99th_percentile_bytes for source-dest pair
            GET historical baseline_entropy for RDP cookie
            ALERT if current_duration > 99th_percentile_duration
              OR current_bytes > 99th_percentile_bytes
              OR abs(current_cookie_entropy - baseline_entropy) > 3 * stddev
  - question: Can a time-series analysis model detect anomalous patterns in the overall volume and characteristics of remote access traffic to critical ICS assets?
    context: This question applies machine learning to a broader, aggregated view of network traffic to detect systemic changes in remote access behavior. Instead of analyzing individual connections, this approach models the 'rhythm' of traffic to a critical asset over time. A significant deviation from this learned rhythm, indicated by a high reconstruction error from a time-series model (like a VAE or LSTM), can signal a coordinated or widespread event, such as a large-scale reconnaissance or a distributed attack, that might not be apparent when looking at single connections in isolation.
    answer_sources:
      - Zeek conn.log
      - Zeek rdp.log
      - Zeek x509.log
      - Firewall logs
      - ICS Network Segments
      - Demilitarized Zone (DMZ) Firewalls
      - Connections between IT and OT networks
      - Remote Access Gateways/VPN Concentrators
      - Perimeter Firewalls (IT/OT boundary)
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |-
          // Training Phase
          AGGREGATE traffic data (conn_count, total_bytes, unique_sources) into 10-min windows for each asset
          MODEL = train_lstm_autoencoder(historical_time_series_data)

          // Real-time Scoring
          FOR each new 10-min window:
            RECONSTRUCTION_ERROR = MODEL.evaluate(new_window_data)
            ALERT if RECONSTRUCTION_ERROR > dynamic_threshold