name: 'T0891: Hardcoded Credentials'
id: 'f47ac10b-58cc-4372-a567-0e02b2c3d479'
description: This playbook helps detect adversaries using hardcoded credentials for lateral movement and persistence within an Industrial Control Systems (ICS) environment. It focuses on identifying anomalous login patterns, such as a single non-service account accessing numerous assets in a short time (fan-out), the successful use of known default or vendor-supplied credentials, highly regular and automated login timings indicative of malware, and unusual interactive sessions on sensitive, rarely-accessed field devices.
type: technique
related:
  - 'TA0109: Lateral Movement'
  - 'TA0110: Persistence'
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: '2025-10-01'
modified: '2025-10-01'
version: '1.0'
tags: none
questions:
  - question: Are non-service accounts logging in remotely from unapproved source IPs?
    context: This question aims to identify initial signs of unauthorized remote access. By correlating successful logins with network data and filtering out legitimate activity (service accounts, approved IPs), analysts can focus on potentially malicious connections that could be the start of lateral movement using compromised or hardcoded credentials.
    answer_sources:
      - Windows Event ID 4624
      - Zeek conn.log
      - Zeek ssh.log
      - Zeek telnet.log
      - Zeek rdp.log
      - Authentication and network traffic logs from the Supervisory Control network (Purdue Model Level 3) and Process Control Network (Purdue Model Level 2), including from Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), SCADA servers, Historian servers, and network gateways between OT segments.
    range: Last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          FIND successful remote logins (WinEvent 4624, Zeek SSH/Telnet)
          WHERE username NOT IN service_account_watchlist
          AND source_ip NOT IN approved_remote_ip_whitelist
          CORRELATE with network logs (Zeek conn.log) on timestamp and IPs
          RETURN count of events by username, source_ip, destination_ip
  - question: Is a single account exhibiting anomalous 'fan-out' behavior by logging into an unusually high number of distinct assets in a short time frame?
    context: This question helps detect an adversary using a single set of credentials to rapidly move across the network. A legitimate user typically accesses a predictable set of systems. A sudden spike in the number of distinct destinations, especially when exceeding a historical baseline, is a strong indicator of automated lateral movement.
    answer_sources:
      - Windows Event ID 4624
      - Zeek conn.log
      - Zeek ssh.log
      - Zeek telnet.log
      - Zeek rdp.log
      - Authentication and network traffic logs from the Supervisory Control network (Purdue Model Level 3) and Process Control Network (Purdue Model Level 2), including from Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), SCADA servers, Historian servers, and network gateways between OT segments.
    range: Last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          FOR each user
            CALCULATE 30-minute rolling count of distinct destination_ips from successful remote logins
            COMPARE current count to 90-day historical 99th percentile for that user
          ALERT IF current_count > 5 AND current_count > percentile_baseline
  - question: Do any remote login events exhibit multiple anomalous characteristics simultaneously when analyzed by an unsupervised machine learning model?
    context: This question uses machine learning to find subtle or complex anomalies that rule-based detections might miss. An adversary's activity may not trigger a single specific rule but can appear anomalous when multiple factors—like the time of day, source IP, and specific destination for a user—are considered together. High-scoring anomalies from the model point to logins that deviate significantly from established normal behavior.
    answer_sources:
      - Windows Event ID 4624
      - Zeek conn.log
      - Zeek ssh.log
      - Zeek telnet.log
      - Zeek rdp.log
      - Authentication and network traffic logs from the Supervisory Control network (Purdue Model Level 3) and Process Control Network (Purdue Model Level 2), including from Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), SCADA servers, Historian servers, and network gateways between OT segments.
    range: Last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          INPUT successful login events (features: src_ip, dest_ip, protocol, user, asset_criticality, time_of_day) into pre-trained anomaly detection model
          FLAG events with anomaly score in top 1%
          PRIORITIZE events with multiple feature deviations
  - question: Are known default or hardcoded vendor credentials being used to authenticate successfully in the environment?
    context: This is a direct check for a common security weakness. Adversaries often scan for and exploit default credentials. Alerting on any successful use of a credential from a known-bad list provides a high-fidelity signal of malicious activity or a critical policy violation.
    answer_sources:
      - Windows Event ID 4624
      - Zeek ssh.log
      - Zeek telnet.log
      - Zeek http.log
      - Zeek ftp.log
      - Zeek dce_rpc.log
      - Authentication and application layer traffic logs from all OT network segments, with a focus on management interfaces for PLCs, RTUs, and IEDs (Purdue Model Level 1/2), as well as SCADA servers, Historian servers, and Engineering Workstations (Purdue Model Level 2/3).
    range: Last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          SEARCH all successful authentication logs
          WHERE username IN known_hardcoded_credential_watchlist
          ALERT on any match
  - question: Is a known hardcoded credential being used to access an unusually diverse set of assets compared to its historical usage?
    context: Even if a default credential is known to be in use, a sudden change in its access pattern, such as touching many different systems, can indicate it has been compromised and is being used for network reconnaissance or lateral movement. Measuring the entropy of accessed assets helps quantify this change in behavior.
    answer_sources:
      - Windows Event ID 4624
      - Zeek ssh.log
      - Zeek telnet.log
      - Zeek http.log
      - Zeek ftp.log
      - Zeek dce_rpc.log
      - Authentication and application layer traffic logs from all OT network segments, with a focus on management interfaces for PLCs, RTUs, and IEDs (Purdue Model Level 1/2), as well as SCADA servers, Historian servers, and Engineering Workstations (Purdue Model Level 2/3).
    range: Last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          FOR each credential in watchlist with a successful login
            CALCULATE Shannon entropy of unique destination assets accessed in 24 hours
            COMPARE entropy to 30-day historical baseline for that credential
          ALERT IF current entropy > (baseline + 2 * standard_deviation)
  - question: Can a machine learning model classify any authentications involving known hardcoded credentials as suspicious based on contextual features?
    context: This question enhances watchlist-based detection. A classification model can learn the context of both benign and malicious logins. It can then flag an event as suspicious, especially when a watchlist credential is used with other anomalous features like a strange source IP or time of day, adding confidence to the alert.
    answer_sources:
      - Windows Event ID 4624
      - Zeek ssh.log
      - Zeek telnet.log
      - Zeek http.log
      - Zeek ftp.log
      - Zeek dce_rpc.log
      - Authentication and application layer traffic logs from all OT network segments, with a focus on management interfaces for PLCs, RTUs, and IEDs (Purdue Model Level 1/2), as well as SCADA servers, Historian servers, and Engineering Workstations (Purdue Model Level 2/3).
    range: Last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          INPUT authentication events (features: username, IPs, protocol, time, asset_type, is_on_watchlist) into pre-trained classification model
          FLAG events classified as 'suspicious' with high confidence
          PRIORITIZE if 'is_on_watchlist' is true and source IP is not a whitelisted management station
  - question: Are critical ICS assets receiving successful remote logins from unauthorized accounts or source locations?
    context: This is a foundational access control check focused on the most important assets. Any successful login to a critical system that bypasses established whitelists for users and source IPs is a major security event and requires immediate investigation, as it could be a precursor to a significant impact.
    answer_sources:
      - Windows Event ID 4624
      - Zeek conn.log
      - Zeek ssh.log
      - Zeek telnet.log
      - Zeek rdp.log
      - Authentication and network traffic logs from critical ICS assets defined in an asset inventory (e.g., Historians, SCADA servers, Domain Controllers in OT) and network security monitoring points at boundaries between the Enterprise (IT) and OT networks (Purdue Model Level 3.5).
    range: Last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          FIND successful remote logins to assets tagged 'critical'
          WHERE source_ip NOT IN asset_specific_ip_whitelist
          OR username NOT IN asset_specific_user_whitelist
          ALERT on any match
  - question: Are there patterns of repeated logins to a critical asset that suggest automated, non-human activity like a command-and-control beacon?
    context: Human-driven logins have natural variations in timing. Automated tools, like malware beacons, often connect at highly regular intervals. By measuring the 'jitter' (standard deviation of time between connections), we can distinguish machine-like regularity from human-like randomness, identifying potential persistence mechanisms.
    answer_sources:
      - Windows Event ID 4624
      - Zeek conn.log
      - Zeek ssh.log
      - Zeek telnet.log
      - Zeek rdp.log
      - Authentication and network traffic logs from critical ICS assets defined in an asset inventory (e.g., Historians, SCADA servers, Domain Controllers in OT) and network security monitoring points at boundaries between the Enterprise (IT) and OT networks (Purdue Model Level 3.5).
    range: Last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          GROUP unauthorized logins by src_ip, dest_ip, user
          FOR groups with >= 10 logins in 24 hours
            CALCULATE time deltas between consecutive logins
            CALCULATE standard deviation of time deltas
          ALERT IF standard_deviation < 5 seconds
  - question: Does the frequency of logins to a critical asset show a new, high-frequency pattern not seen in its 90-day history?
    context: This question uses time-series analysis to detect changes in the rhythm of access to a critical system. A new, persistent, high-frequency pattern of logins can indicate the establishment of a C2 channel or other automated persistence mechanism that deviates from normal operational periodicities.
    answer_sources:
      - Windows Event ID 4624
      - Zeek conn.log
      - Zeek ssh.log
      - Zeek telnet.log
      - Zeek rdp.log
      - Authentication and network traffic logs from critical ICS assets defined in an asset inventory (e.g., Historians, SCADA servers, Domain Controllers in OT) and network security monitoring points at boundaries between the Enterprise (IT) and OT networks (Purdue Model Level 3.5).
    range: Last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          INPUT hourly login frequency for each user-destination pair into pre-trained time-series model
          FLAG time windows with new, high-frequency periodicities or statistically significant residual activity
  - question: Are interactive logins occurring on sensitive field devices (PLCs, RTUs) from source IPs that are not approved engineering workstations?
    context: Field devices are at the core of the control process and should only be accessed interactively from specific, authorized management stations. A login from any other source is a major red flag, suggesting an adversary has gained a foothold in the OT network and is attempting to directly manipulate control devices.
    answer_sources:
      - Zeek conn.log
      - Zeek ssh.log
      - Zeek telnet.log
      - Zeek rdp.log
      - Windows Event ID 4624
      - Network traffic and access logs from the Process Control Network (Purdue Model Level 2) and Basic Control Network (Purdue Model Level 1), specifically from network TAPs or switch SPAN ports monitoring management traffic to PLCs, RTUs, IEDs, and other field controllers.
    range: Last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          FIND successful interactive logins to devices tagged 'field device'
          WHERE source_ip NOT IN device_specific_ip_whitelist
          ALERT on any match
  - question: Has an interactive login occurred on a field device that has not been accessed in this manner for over 90 days?
    context: Many field devices are configured once and then run without direct human interaction for long periods. A sudden interactive login to such a 'dormant' device is highly anomalous and suggests someone is either performing unauthorized maintenance or attempting to tamper with the device.
    answer_sources:
      - Zeek conn.log
      - Zeek ssh.log
      - Zeek telnet.log
      - Zeek rdp.log
      - Windows Event ID 4624
      - Network traffic and access logs from the Process Control Network (Purdue Model Level 2) and Basic Control Network (Purdue Model Level 1), specifically from network TAPs or switch SPAN ports monitoring management traffic to PLCs, RTUs, IEDs, and other field controllers.
    range: Last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          FOR each new successful interactive login to a 'field device'
            CHECK historical login count for that device over past 90 days
          ALERT IF historical count is 0
  - question: Do any interactive logins to field devices appear anomalous based on a machine learning model that understands the context of legitimate engineering access?
    context: This question provides a safety net to catch unusual activity that might not violate a specific rule. By modeling what normal engineering access looks like (e.g., typical source locations, times, protocols), the model can flag sessions that fall outside this norm, indicating a potential misuse of a legitimate workstation or credential.
    answer_sources:
      - Zeek conn.log
      - Zeek ssh.log
      - Zeek telnet.log
      - Zeek rdp.log
      - Windows Event ID 4624
      - Network traffic and access logs from the Process Control Network (Purdue Model Level 2) and Basic Control Network (Purdue Model Level 1), specifically from network TAPs or switch SPAN ports monitoring management traffic to PLCs, RTUs, IEDs, and other field controllers.
    range: Last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          INPUT features from interactive logins to field devices (e.g., source geo/ASN, device type, protocol, time) into pre-trained unsupervised anomaly model
          FLAG any login session scored as a high-confidence anomaly