name: T0891: Hardcoded Credentials
id: 18f8c2b0-4f5a-4b1e-8e2c-3d4a5b6c7d8e
description: This playbook helps analysts investigate whether an adversary is using hardcoded credentials for lateral movement or to establish persistence within an Industrial Control System (ICS) environment. It focuses on detecting anomalous login patterns, such as a single account accessing an unusual number of assets, and the use of known default or hardcoded credentials. The playbook also aims to identify signs of persistence, including automated, machine-like access to critical assets and unexpected interactive logins to dormant field devices like PLCs or RTUs. Evidence is gathered by analyzing authentication logs, network traffic, and comparing activity against historical baselines, whitelists, and machine learning models.
type: technique
related:
  - TA0109: Lateral Movement
  - TA0110: Persistence
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Are non-service accounts performing remote logins from unapproved source IPs?
    context: This question serves as a first-pass filter for suspicious remote access by identifying violations of established access policies. It correlates successful remote authentications with network connection data to flag any login from a non-service account that originates from an IP address not on the approved remote access whitelist. Detecting such an event is a strong indicator of unauthorized access.
    answer_sources:
      - Windows Event ID 4624
      - Zeek conn.log
      - Zeek ssh.log
      - Zeek telnet.log
      - Zeek rdp.log
      - Authentication and network traffic logs from the Supervisory Control network (Purdue Model Level 3) and Process Control Network (Purdue Model Level 2), including from Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), SCADA servers, Historian servers, and network gateways between OT segments.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: JOIN auth_logs on network_logs WHERE username NOT IN service_account_watchlist AND source_ip NOT IN approved_remote_access_ips AND event_status = 'success'
  - question: Is any single account exhibiting an anomalous fan-out of remote logins to multiple distinct assets?
    context: This question aims to detect a single compromised account being used to move laterally across the network. By calculating a rolling count of distinct destinations for each account over a short window (30 minutes) and comparing it to the account's historical 90-day baseline, this query can distinguish normal administrative activity from anomalous fan-out behavior that suggests an adversary is exploring or accessing multiple systems.
    answer_sources:
      - Windows Event ID 4624
      - Zeek conn.log
      - Zeek ssh.log
      - Zeek telnet.log
      - Zeek rdp.log
      - Authentication and network traffic logs from the Supervisory Control network (Purdue Model Level 3) and Process Control Network (Purdue Model Level 2), including from Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), SCADA servers, Historian servers, and network gateways between OT segments.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: GROUP successful_remote_logins by username | COUNT distinct destination_ip over 30_minute_window | ALERT if count > 5 AND count > 99th_percentile_baseline(username)
  - question: Are there remote logins that deviate significantly from established normal behavior patterns, as determined by an anomaly detection model?
    context: This question leverages an unsupervised machine learning model to identify subtle or complex anomalies that simple threshold-based rules might miss. By training a model on features like source/destination IP, protocol, user, and time of day, it can flag any new login that has a high anomaly score, indicating it does not conform to previously learned patterns of legitimate activity.
    answer_sources:
      - Windows Event ID 4624
      - Zeek conn.log
      - Zeek ssh.log
      - Zeek telnet.log
      - Zeek rdp.log
      - Authentication and network traffic logs from the Supervisory Control network (Purdue Model Level 3) and Process Control Network (Purdue Model Level 2), including from Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), SCADA servers, Historian servers, and network gateways between OT segments.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: INPUT login_features(source_ip, dest_ip, protocol, user, dest_asset_criticality, time) INTO anomaly_model | ALERT if anomaly_score > 99th_percentile
  - question: Are known hardcoded or default vendor credentials being used to successfully authenticate to ICS assets?
    context: This is a high-fidelity check for a known bad practice and a significant security risk. This question involves continuously scanning all authentication logs for successful logins where the username matches a maintained watchlist of known hardcoded or default credentials for ICS devices. Any match is a high-priority event that warrants immediate investigation.
    answer_sources:
      - Windows Event ID 4624
      - Zeek ssh.log
      - Zeek telnet.log
      - Zeek http.log
      - Zeek ftp.log
      - Zeek dce_rpc.log
      - Authentication and application layer traffic logs from all OT network segments, with a focus on management interfaces for PLCs, RTUs, and IEDs (Purdue Model Level 1/2), as well as SCADA servers, Historian servers, and Engineering Workstations (Purdue Model Level 2/3).
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH all_auth_logs WHERE username IN hardcoded_credential_watchlist AND event_status = 'success'
  - question: Is a known hardcoded credential being used to access an unusually diverse set of target systems?
    context: This question helps determine if a known weak credential, which may have some limited legitimate use, is suddenly being used more broadly. By calculating the Shannon entropy of the set of unique assets accessed by a watchlist credential, we can measure the diversity of its usage. A significant deviation from the historical baseline entropy suggests an adversary may be using the credential to explore the network.
    answer_sources:
      - Windows Event ID 4624
      - Zeek ssh.log
      - Zeek telnet.log
      - Zeek http.log
      - Zeek ftp.log
      - Zeek dce_rpc.log
      - Authentication and application layer traffic logs from all OT network segments, with a focus on management interfaces for PLCs, RTUs, and IEDs (Purdue Model Level 1/2), as well as SCADA servers, Historian servers, and Engineering Workstations (Purdue Model Level 2/3).
    range: last 90 days
    queries:
      - technology: pseudocode
        query: FOR each watchlist_credential with successful_login: CALCULATE shannon_entropy(destination_assets) over 24h | ALERT if entropy > (baseline_entropy + 2 * std_dev)
  - question: Can machine learning classify any authentication events as suspicious, particularly those involving watchlist credentials from non-whitelisted sources?
    context: This question uses a supervised classification model to provide a more nuanced verdict on authentication events. By incorporating features like username, source IP, and whether the credential is on a watchlist, the model can learn to distinguish between legitimate and suspicious activity with higher accuracy, flagging events that are classified as 'suspicious' with high confidence.
    answer_sources:
      - Windows Event ID 4624
      - Zeek ssh.log
      - Zeek telnet.log
      - Zeek http.log
      - Zeek ftp.log
      - Zeek dce_rpc.log
      - Authentication and application layer traffic logs from all OT network segments, with a focus on management interfaces for PLCs, RTUs, and IEDs (Purdue Model Level 1/2), as well as SCADA servers, Historian servers, and Engineering Workstations (Purdue Model Level 2/3).
    range: last 90 days
    queries:
      - technology: pseudocode
        query: INPUT auth_features(user, source, dest, proto, time, on_watchlist) INTO classification_model | ALERT if classification = 'suspicious' AND confidence > high_threshold
  - question: Are critical ICS assets being accessed remotely from unapproved IP addresses or by unauthorized user accounts?
    context: This is a fundamental access control check focused on the most critical assets in the ICS environment. Any violation of the defined whitelists for these high-value targets, such as a login from an unapproved IP or by an unauthorized account, is a significant security event that requires investigation for potential compromise or persistence.
    answer_sources:
      - Windows Event ID 4624
      - Zeek conn.log
      - Zeek ssh.log
      - Zeek telnet.log
      - Zeek rdp.log
      - Authentication and network traffic logs from critical ICS assets defined in an asset inventory (e.g., Historians, SCADA servers, Domain Controllers in OT) and network security monitoring points at boundaries between the Enterprise (IT) and OT networks (Purdue Model Level 3.5).
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH successful_remote_logins WHERE destination IN critical_asset_list AND (source_ip NOT IN asset_ip_whitelist OR username NOT IN asset_user_whitelist)
  - question: Is there evidence of automated, machine-like remote access to critical assets, indicated by highly regular login intervals?
    context: This question seeks to identify the tell-tale sign of automated malware or scripting, which often operates with very low "jitter" (variation in time intervals). By calculating the standard deviation of time deltas between consecutive logins from the same source to the same destination, a very low value (e.g., <5 seconds) for a series of logins strongly suggests a C2 beacon or other automated persistence mechanism, as opposed to irregular, human-initiated access.
    answer_sources:
      - Windows Event ID 4624
      - Zeek conn.log
      - Zeek ssh.log
      - Zeek telnet.log
      - Zeek rdp.log
      - Authentication and network traffic logs from critical ICS assets defined in an asset inventory (e.g., Historians, SCADA servers, Domain Controllers in OT) and network security monitoring points at boundaries between the Enterprise (IT) and OT networks (Purdue Model Level 3.5).
    range: last 90 days
    queries:
      - technology: pseudocode
        query: GROUP matching_logins by source, dest, user | IF count >= 10 in 24h: CALCULATE std_dev(time_deltas_between_logins) | ALERT if std_dev < 5_seconds
  - question: Does the frequency of logins for any user-asset pair show a new, high-frequency pattern not seen in the historical baseline?
    context: This question uses time-series analysis to find new, repeating patterns of access indicative of automated C2 beaconing. A time-series model (like STL or Prophet) can learn the normal operational periodicities of login frequency for a user-asset pair. It can then flag any new, high-frequency periodicity or statistically significant residual activity that deviates from the learned 90-day baseline.
    answer_sources:
      - Windows Event ID 4624
      - Zeek conn.log
      - Zeek ssh.log
      - Zeek telnet.log
      - Zeek rdp.log
      - Authentication and network traffic logs from critical ICS assets defined in an asset inventory (e.g., Historians, SCADA servers, Domain Controllers in OT) and network security monitoring points at boundaries between the Enterprise (IT) and OT networks (Purdue Model Level 3.5).
    range: last 90 days
    queries:
      - technology: pseudocode
        query: FOR each user-dest_pair: INPUT hourly_login_frequency INTO time_series_model | ALERT if model_detects_new_periodicity OR significant_unexplained_activity
  - question: Are interactive logins to field devices (PLCs, RTUs) originating from IP addresses not on the approved whitelist for that specific device?
    context: Field devices are sensitive and should only be accessed from specific, authorized engineering workstations. This question enforces that policy by checking if any interactive login (RDP, SSH, Telnet) to a device tagged as a 'field device' originates from a source IP not on that device's specific whitelist. A violation is a high-priority indicator of unauthorized access within the control network.
    answer_sources:
      - Zeek conn.log
      - Zeek ssh.log
      - Zeek telnet.log
      - Zeek rdp.log
      - Windows Event ID 4624
      - Network traffic and access logs from the Process Control Network (Purdue Model Level 2) and Basic Control Network (Purdue Model Level 1), specifically from network TAPs or switch SPAN ports monitoring management traffic to PLCs, RTUs, IEDs, and other field controllers.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH successful_interactive_logins WHERE destination_type = 'field_device' AND source_ip NOT IN device_specific_ip_whitelist
  - question: Has an interactive login occurred on a field device that has been dormant or has not been accessed interactively for over 90 days?
    context: Many field devices are configured once and then operate without direct human interaction for long periods. A sudden, unexpected interactive login to such a device is highly anomalous. This query identifies this behavior by generating an alert for the first successful interactive login to any field device that has had no such activity in the preceding 90 days, suggesting an adversary may be tampering with it.
    answer_sources:
      - Zeek conn.log
      - Zeek ssh.log
      - Zeek telnet.log
      - Zeek rdp.log
      - Windows Event ID 4624
      - Network traffic and access logs from the Process Control Network (Purdue Model Level 2) and Basic Control Network (Purdue Model Level 1), specifically from network TAPs or switch SPAN ports monitoring management traffic to PLCs, RTUs, IEDs, and other field controllers.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: FOR each new_successful_login to field_device: CHECK login_history for past 90 days | ALERT if historical_interactive_login_count = 0
  - question: Are there any interactive logins to field devices that are anomalous in their overall context (e.g., time of day, source location, protocol)?
    context: This question uses an unsupervised anomaly detection model to build a profile of 'normal' engineering access to field devices based on a variety of contextual features. It can then flag any login that deviates significantly from this learned behavior, such as access from a new country, at an unusual time (3 AM on a holiday), or to a device model the user has never accessed before, providing a holistic view of anomalous activity.
    answer_sources:
      - Zeek conn.log
      - Zeek ssh.log
      - Zeek telnet.log
      - Zeek rdp.log
      - Windows Event ID 4624
      - Network traffic and access logs from the Process Control Network (Purdue Model Level 2) and Basic Control Network (Purdue Model Level 1), specifically from network TAPs or switch SPAN ports monitoring management traffic to PLCs, RTUs, IEDs, and other field controllers.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: INPUT login_context_features(source_geo, dest_type, protocol, time_of_day) INTO anomaly_model | ALERT if anomaly_score > high_confidence_threshold