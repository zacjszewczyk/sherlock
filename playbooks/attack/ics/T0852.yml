name: "T0852: Screen Capture"
id: "f47ac10b-58cc-4372-a567-0e02b2c3d479"
description: "This playbook helps answer if an adversary is capturing screen data from Human-Machine Interfaces (HMIs) or Engineering Workstations (EWS). It focuses on detecting the use of screen capture utilities through process creation events, identifying the creation of image files in unusual circumstances, and spotting anomalous outbound network connections that could be used for exfiltrating captured screen data."
type: "technique"
related:
  - "TA0100: Collection"
contributors: "Zachary Szewczyk, Ask Sage"
created: "2025-10-01"
modified: "2025-10-01"
version: 1.0
tags: "none"
questions:
  - question: "Are known screen capture utilities, suspicious scripts, unapproved applications, or unauthorized services being executed on HMI/EWS assets?"
    context: "This question aims to identify direct evidence of screen capture activity by looking for specific indicators of compromise. This includes the execution of built-in Windows screen capture tools ('psr.exe', 'SnippingTool.exe'), the use of PowerShell scripting APIs for screen capture ('CopyFromScreen', 'BitBlt'), the execution of any application not on an established whitelist, and the installation of new, potentially malicious services. Detecting these events is a high-fidelity way to spot unauthorized screen capture attempts."
    answer_sources:
      - "Windows Event ID 4688"
      - "Windows Event ID 4104"
      - "Windows Event ID 4697"
      - "Human-Machine Interfaces (HMIs)"
      - "Engineering Workstations (EWS)"
      - "Operator Stations"
      - "Jump Servers within the ICS/OT network"
    range: "Last 90 days"
    queries:
      - "Search process creation logs (EID 4688) on HMI/EWS for process names 'psr.exe' or 'SnippingTool.exe'."
      - "Search PowerShell script block logs (EID 4104) for 'CopyFromScreen' or 'BitBlt' where parent process is 'powershell.exe'."
      - "Compare process names from EID 4688 against host-specific application whitelists and alert on mismatches."
      - "Search for new service installation logs (EID 4697) and compare service executables against a service whitelist."
  - question: "Is there a statistically unusual frequency or rarity of process executions on HMI/EWS assets that could indicate screen capture activity?"
    context: "This question seeks to uncover screen capture tools or malware that might not be on a known signature list. By establishing a baseline of normal process activity, we can detect anomalies. A sudden spike in the execution of a legitimate but infrequently used process, or the appearance of a process that is very rare across the entire fleet of assets, could signify malicious use for screen capture or other purposes."
    answer_sources:
      - "Windows Event ID 4688"
      - "Human-Machine Interfaces (HMIs)"
      - "Engineering Workstations (EWS)"
      - "Operator Stations"
      - "Jump Servers within the ICS/OT network"
    range: "Last 90 days"
    queries:
      - "For each host, aggregate process counts (EID 4688) per hour. Compare to 30-day baseline. Alert if count > (mean + 3 * std_dev)."
      - "Calculate the prevalence of each process name across all HMI/EWS assets. Flag processes running on < 5% of assets for review."
  - question: "Can machine learning models classify process creation events on HMI/EWS assets as malicious or suspicious, potentially identifying novel screen capture malware?"
    context: "This question leverages machine learning to move beyond simple rule-based detection. By training a model on the features of known benign processes within the specific ICS environment, it can learn to identify outliers. The model analyzes multiple features of a process event simultaneously (e.g., command-line entropy, parent process) to spot sophisticated or previously unseen malware that might be used for screen capture."
    answer_sources:
      - "Windows Event ID 4688"
      - "Human-Machine Interfaces (HMIs)"
      - "Engineering Workstations (EWS)"
      - "Operator Stations"
      - "Jump Servers within the ICS/OT network"
    range: "Last 90 days"
    queries:
      - "Feed process creation event features (process name, parent, cmdline entropy, user, path) into a pre-trained classification model."
      - "Alert if model output is 'malicious' or 'suspicious' with confidence > 0.90."
  - question: "Are image files being created on HMI/EWS assets by unauthorized applications or in unusual locations?"
    context: "This question investigates the output of screen capture activity. Adversaries often save captured images to disk before exfiltration. This query looks for the creation of image files by processes that shouldn't be creating them (e.g., not a reporting tool) or in temporary/hidden directories commonly used for staging malicious files. This can be a strong indicator that screen captures have been taken."
    answer_sources:
      - "Windows Event ID 4663"
      - "Windows Event ID 4656"
      - "Local file systems of HMIs and EWS"
      - "Temporary directories (%TEMP%, C:\\Windows\\Temp)"
      - "User profiles"
      - "Staging directories used for data transfer"
    range: "Last 90 days"
    queries:
      - "Search file creation logs (EID 4663/4656) for image extensions (.png, .jpg, .bmp, .gif)."
      - "Alert if creating process is not on the approved application list."
      - "Alert if file path is a temp or non-standard directory."
  - question: "Is there a statistically abnormal volume of image file creations or are filenames unusually random on HMI/EWS assets?"
    context: "This question uses statistical methods to find anomalies related to file creation. An adversary taking many screenshots in a short period would cause a spike in the volume of image files created, which would deviate from the normal baseline. Additionally, malware often generates random filenames to avoid detection; a high entropy score for a filename is a strong indicator of automated, non-human activity."
    answer_sources:
      - "Windows Event ID 4663"
      - "Windows Event ID 4656"
      - "Local file systems of HMIs and EWS"
      - "Temporary directories (%TEMP%, C:\\Windows\\Temp)"
      - "User profiles"
      - "Staging directories used for data transfer"
    range: "Last 90 days"
    queries:
      - "For each host, aggregate image file creation counts per hour. Compare to 30-day baseline. Alert if count > 99th percentile."
      - "Calculate Shannon entropy for new filenames. Alert if entropy > 4.0."
  - question: "Can a time-series anomaly detection model identify file creation events that deviate from the normal operational rhythm of an HMI/EWS?"
    context: "This question applies advanced machine learning to detect subtle deviations in file creation patterns. An LSTM Autoencoder can learn the complex temporal relationships of normal activity (e.g., 'reporting_tool.exe' creates '.jpg' files in 'C:\\Reports' every hour on the hour). An event that doesn't fit this learned pattern, such as a file created at an odd time or by an unusual process, will have a high reconstruction error, flagging it as a potential threat."
    answer_sources:
      - "Windows Event ID 4663"
      - "Windows Event ID 4656"
      - "Local file systems of HMIs and EWS"
      - "Temporary directories (%TEMP%, C:\\Windows\\Temp)"
      - "User profiles"
      - "Staging directories used for data transfer"
    range: "Last 90 days"
    queries:
      - "Feed file creation event vectors (timestamp, process, path) into a trained LSTM Autoencoder model."
      - "Calculate reconstruction error for each event. Alert if error > (mean_error + 3 * std_dev_error)."
  - question: "Are HMI/EWS assets making outbound network connections to unauthorized destinations or sending unusually large payloads?"
    context: "This question focuses on detecting the exfiltration phase of a screen capture attack. ICS networks should have highly restricted, predictable network traffic. Any connection from an HMI or EWS to a destination IP/domain or port that isn't on a strict whitelist is highly suspicious. Additionally, a large HTTP POST request could be an adversary uploading captured images, as this is an uncommon behavior for most HMI/EWS systems."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek http.log"
      - "Zeek dns.log"
      - "ICS Network Segments"
      - "OT/IT Network Boundary"
      - "Purdue Model Level 2/3 systems"
      - "ICS DMZ"
      - "Internet Gateway"
    range: "Last 90 days"
    queries:
      - "Search network/DNS logs for traffic from HMI/EWS IPs. Alert if destination IP/domain is not on the whitelist."
      - "Alert if destination port is not on the approved port list."
      - "Search HTTP logs for POST requests from HMI/EWS. Alert if request body > 1MB to a non-whitelisted destination."
  - question: "Is there a statistical anomaly in the size of data being sent from HMI/EWS assets?"
    context: "This question aims to detect data exfiltration by looking for statistical outliers in traffic volume. Even if a connection is to an allowed destination (e.g., a historian on port 443), the amount of data sent might be abnormal. A single connection sending significantly more data than usual (`orig_bytes`), or a sudden spike in the total data sent from a host over a short period, could indicate that an attacker is exfiltrating captured screen images or other large files."
    answer_sources:
      - "Zeek conn.log"
      - "ICS Network Segments"
      - "OT/IT Network Boundary"
      - "Purdue Model Level 2/3 systems"
      - "ICS DMZ"
      - "Internet Gateway"
    range: "Last 90 days"
    queries:
      - "For each new connection from an HMI/EWS, compare its 'orig_bytes' to the 99.9th percentile of its peer group (e.g., same destination port). Alert if it exceeds."
      - "Monitor total outbound bytes per host in 10-min intervals. Alert if total > (mean + 4 * std_dev) of its 30-day baseline."
  - question: "Can unsupervised machine learning identify anomalous network connections from HMI/EWS assets that don't fit normal patterns?"
    context: "This question uses clustering to identify outlier connections without pre-defined rules. A density-based algorithm like DBSCAN groups together 'normal' connections that share similar characteristics (e.g., HMI to Historian on port 443 with small payloads). Any connection that doesn't fit into a dense cluster is labeled as noise. These 'noise' points represent rare and potentially malicious activity, such as a C2 connection or data exfiltration, that warrants investigation."
    answer_sources:
      - "Zeek conn.log"
      - "ICS Network Segments"
      - "OT/IT Network Boundary"
      - "Purdue Model Level 2/3 systems"
      - "ICS DMZ"
      - "Internet Gateway"
    range: "Last 90 days"
    queries:
      - "Run DBSCAN on network connection logs using features like IPs, port, protocol, bytes, duration."
      - "Flag any connections labeled as 'noise' or belonging to very small clusters for analyst review."