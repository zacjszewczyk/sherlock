name: T0852: Screen Capture
id: a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d
description: This playbook helps determine if an adversary is capturing screen data from Human-Machine Interfaces (HMIs) or Engineering Workstations (EWS). The investigation focuses on detecting the execution of known screen capture utilities or scripts using screen capture APIs, identifying the creation of image files by unauthorized processes or in unusual locations, and flagging anomalous outbound network traffic that could indicate data exfiltration of the captured screens.
type: technique
related:
  - TA0100: Collection
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags:
  - none
questions:
  - question: Are known screen capture utilities, suspicious scripts, non-whitelisted processes, or unauthorized new services being executed on critical ICS assets like HMIs or EWS?
    context: This question aims to detect direct evidence of screen capture activity by looking for specific, high-fidelity indicators. It checks for built-in Windows tools ('psr.exe', 'SnippingTool.exe'), PowerShell scripts using screen capture APIs, any process not on an established software whitelist, and the installation of new, potentially malicious services. A positive finding strongly suggests unauthorized data collection on Human-Machine Interfaces (HMIs), Engineering Workstations (EWS), Operator Stations, and Jump Servers within the ICS/OT network.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 4104
      - Windows Event ID 4697
      - Human-Machine Interfaces (HMIs), Engineering Workstations (EWS), Operator Stations, and Jump Servers within the ICS/OT network.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH ProcessCreationEvents (EventID=4688) OR ScriptBlockLogs (EventID=4104) OR ServiceInstallEvents (EventID=4697) on HMI/EWS hosts WHERE (process_name IN ['psr.exe', 'SnippingTool.exe']) OR (parent_process='powershell.exe' AND script_block CONTAINS ['CopyFromScreen', 'BitBlt']) OR (process_name NOT IN ApplicationWhitelist) OR (service_executable NOT IN ServiceWhitelist)
  - question: Are there statistically unusual or rare process executions occurring on HMI/EWS assets that might indicate screen capture activity?
    context: This question uses statistical analysis to find anomalies that might be missed by signature-based rules. It looks for two types of outliers on Human-Machine Interfaces (HMIs) and Engineering Workstations (EWS): temporal (a process running more frequently than usual on a single host) and spatial (a process that is rare across the entire fleet of similar assets). This can help uncover novel or disguised screen capture tools.
    answer_sources:
      - Windows Event ID 4688
      - Human-Machine Interfaces (HMIs), Engineering Workstations (EWS), Operator Stations, and Jump Servers within the ICS/OT network.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH ProcessCreationEvents (EventID=4688) on HMI/EWS hosts | STATISTICAL_ANALYSIS AGGREGATE by host, process_name over 1-hour windows. COMPARE current count to 30-day baseline. ALERT if count > (mean + 3 * stdev). | RARITY_ANALYSIS CALCULATE prevalence of each process across all HMI/EWS hosts. FLAG for review if prevalence < 5%.
  - question: Can machine learning models identify process creation events on HMIs/EWS that are indicative of malicious screen capture activity?
    context: This question leverages a machine learning approach to detect subtle or complex patterns associated with malicious processes on Human-Machine Interfaces (HMIs) and Engineering Workstations (EWS). By training a model on features like command-line entropy and process relationships, it can identify suspicious behavior that doesn't match known signatures or simple statistical thresholds. An alert with high confidence suggests a high probability of a malicious process execution.
    answer_sources:
      - Windows Event ID 4688
      - Human-Machine Interfaces (HMIs), Engineering Workstations (EWS), Operator Stations, and Jump Servers within the ICS/OT network.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: INPUT ProcessCreationEvents (EventID=4688) into ML_MODEL (Random Forest) | EXTRACT_FEATURES process_name, parent_process, cmd_line_entropy, cmd_line_length, user, process_path | CLASSIFY event. ALERT if classification IN ['malicious', 'suspicious'] AND confidence_score > 0.90.
  - question: Are image files being created on HMIs/EWS by unauthorized applications or in suspicious locations?
    context: This question focuses on the output of screen capture activity: the image files themselves. It seeks to identify suspicious file creation events by checking if the creating process is whitelisted (e.g., a legitimate HMI reporting tool) and if the file is being saved to a typical staging or temporary directory (%TEMP%, C:\Windows\Temp) often used by malware on the local file systems of HMIs and EWS.
    answer_sources:
      - Windows Event ID 4663
      - Windows Event ID 4656
      - Local file systems of HMIs and EWS, focusing on temporary directories (%TEMP%, C:\Windows\Temp), user profiles, and staging directories used for data transfer.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH FileAuditLogs (EventID IN [4663, 4656]) on HMI/EWS hosts WHERE file_extension IN ['.png', '.jpg', '.bmp', '.gif'] AND (creating_process NOT IN ApprovedImageAppList OR file_path IN ['%TEMP%', '%APPDATA%', 'C:\\Windows\\Temp'])
  - question: Is there an anomalous volume of image file creations or are files being created with unusually random names on HMIs/EWS?
    context: This question applies statistical methods to file creation events on the local file systems of HMIs and EWS. It looks for a sudden spike in the number of images being created, which could indicate automated screen captures. It also checks for high-entropy filenames (a common tactic used by malware to avoid detection) by analyzing filenames in temporary directories, user profiles, and staging areas.
    answer_sources:
      - Windows Event ID 4663
      - Windows Event ID 4656
      - Local file systems of HMIs and EWS, focusing on temporary directories (%TEMP%, C:\Windows\Temp), user profiles, and staging directories used for data transfer.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH FileAuditLogs on HMI/EWS hosts | VOLUME_ANALYSIS AGGREGATE image file creations by host, per hour. COMPARE to 30-day baseline. ALERT if count > 99th percentile. | ENTROPY_ANALYSIS CALCULATE Shannon entropy for new filenames. ALERT if entropy_score > 4.0.
  - question: Can a time-series machine learning model detect deviations from the normal pattern of file creation activity on HMIs/EWS?
    context: This question employs an advanced machine learning model to understand the 'rhythm' of normal file creation on an HMI or EWS. The model learns what is normal based on time, creating process, and file location. It will flag any file creation event that doesn't fit this learned pattern, allowing it to detect novel or stealthy techniques that might not trigger other rules.
    answer_sources:
      - Windows Event ID 4663
      - Windows Event ID 4656
      - Local file systems of HMIs and EWS, focusing on temporary directories (%TEMP%, C:\Windows\Temp), user profiles, and staging directories used for data transfer.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: INPUT FileCreationEvents into ML_MODEL (LSTM Autoencoder) | EXTRACT_FEATURES time_of_day, day_of_week, creating_process, file_path | CALCULATE reconstruction_error. ALERT if reconstruction_error > (historical_error_mean + 3 * stdev).
  - question: Are HMIs or EWS making network connections to unauthorized destinations or using non-standard ports, potentially to exfiltrate captured screen data?
    context: This question focuses on the exfiltration phase, looking for network traffic that violates established policies for ICS Network Segments and the OT/IT boundary. It provides high-fidelity alerts by checking against whitelists of approved destinations and ports. It also specifically looks for large HTTP POST requests, a common method for uploading stolen data like images.
    answer_sources:
      - Zeek conn.log
      - Zeek http.log
      - Zeek dns.log
      - ICS Network Segments, OT/IT Network Boundary, Purdue Model Level 2/3 systems, ICS DMZ, and Internet Gateway.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH NetworkLogs (Zeek conn, dns, http) for HMI/EWS source IPs | ALERT if (destination_ip OR resolved_domain NOT IN Whitelist) OR (destination_port NOT IN ApprovedPorts) OR (http_method='POST' AND http_uri NOT IN Whitelist AND request_body_length > 1MB).
  - question: Is there a statistically significant anomaly in the amount of data being sent from an HMI or EWS?
    context: This question uses statistical analysis to detect data exfiltration from the ICS Network. It looks for two types of anomalies: a single connection that is unusually large compared to its peers (e.g., all HMI traffic on port 443), and a sudden increase in the total volume of data being sent from a host over a short period. This can catch exfiltration even if the destination is on a whitelist.
    answer_sources:
      - Zeek conn.log
      - ICS Network Segments, OT/IT Network Boundary, Purdue Model Level 2/3 systems, ICS DMZ, and Internet Gateway.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH NetworkLogs (Zeek conn.log) from HMI/EWS | INDIVIDUAL_CONNECTION_ANALYSIS For each connection, compare 'orig_bytes' to 99.9th percentile of baseline for that destination port. ALERT on exceed. | TOTAL_VOLUME_ANALYSIS AGGREGATE 'orig_bytes' per host in 10-min windows. Compare to 30-day baseline. ALERT if total > (mean + 4 * stdev).
  - question: Can machine learning identify anomalous network connections from HMIs/EWS that do not fit into normal patterns of communication?
    context: This question uses an unsupervised machine learning model (DBSCAN) to identify normal 'clusters' of network activity based on multiple features like destination, port, and data volume. Any connection from an HMI or EWS that does not fit into a well-established cluster is flagged as an anomaly or 'noise.' This is powerful for detecting novel command-and-control (C2) or exfiltration channels that don't match any known rule or signature.
    answer_sources:
      - Zeek conn.log
      - ICS Network Segments, OT/IT Network Boundary, Purdue Model Level 2/3 systems, ICS DMZ, and Internet Gateway.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: INPUT NetworkLogs (Zeek conn.log) from HMI/EWS into ML_MODEL (DBSCAN) | EXTRACT_FEATURES src_ip, dst_ip, dst_port, protocol, orig_bytes, duration | CLUSTER data. FLAG connections labeled as 'noise' or belonging to clusters with < 5 members for review.