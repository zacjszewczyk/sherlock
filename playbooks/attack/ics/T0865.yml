name: "T0865: Spearphishing Attachment"
id: "f47ac10b-58cc-4372-a567-0e02b2c3d479"
description: "This playbook helps determine if an adversary is attempting to gain initial access to the ICS environment by sending targeted emails with malicious attachments to high-value personnel. It focuses on identifying emails from external sources sent to groups like 'ICS_Engineers' or 'OT_Operators'. Key indicators include attachments with high-risk file types (e.g., .exe, .iso, .ACD), the presence of ICS-specific keywords (e.g., 'PLC Update', 'SCADA Alert'), and sender domains that fail authentication checks or are not on an organizational allowlist."
type: "technique"
related:
  - "TA0108: Initial Access"
contributors:
  - "Zachary Szewczyk, Ask Sage"
created: "2025-10-01"
modified: "2025-10-01"
version: "1.0"
tags:
  - "none"
questions:
  - question: "Are high-risk ICS personnel receiving emails with potentially malicious attachments based on predefined watchlists?"
    context: "This question aims to proactively detect targeted spearphishing attempts by creating and monitoring watchlists for high-risk individuals, suspicious file extensions (including common archive and ICS-specific project files), and keywords relevant to the OT environment. By correlating email and file logs, security analysts can generate high-fidelity alerts when an email from an external source matches multiple risk criteria, such as a blacklisted attachment hash or a combination of a risky file type and an ICS-related keyword in the subject or filename."
    answer_sources:
      - "Zeek smtp.log"
      - "Zeek files.log"
      - "Zeek dns.log"
      - "Zeek x509.log"
      - "Active Directory Logs"
      - "Corporate Email Gateway"
      - "OT Network Mail Relay (if present)"
      - "Corporate-to-OT DMZ"
      - "Engineering Workstations (local email client logs)"
      - "Control System Network (for internal email traffic if applicable)"
    range: "last 90 days"
    queries:
      - tech: "Pseudocode"
        query: "JOIN smtp.log and files.log on fuid. FILTER for emails to 'high-risk_personnel_watchlist'. ALERT if attachment_hash in 'threat_intel_hashes' OR (attachment_filename OR attachment_mime_type in 'high-risk_file_list' AND (email_subject OR attachment_filename contains 'ics_keyword_watchlist'))."
  - question: "Are high-risk ICS personnel receiving emails with high-risk attachments from anomalous senders or with obfuscated content?"
    context: "This question focuses on detecting sophisticated spearphishing by establishing behavioral baselines. It identifies anomalies by tracking the frequency of communication between senders and high-value recipients. An alert is triggered if a risky attachment comes from a new or highly infrequent sender. Additionally, it analyzes the Shannon entropy of email subjects and attachment filenames to spot randomization or obfuscation techniques, which are often used by adversaries to bypass simple signature-based filters. An unusually high entropy value would trigger an alert for further investigation."
    answer_sources:
      - "Zeek smtp.log"
      - "Zeek files.log"
      - "Zeek dns.log"
      - "Zeek x509.log"
      - "Active Directory Logs"
      - "Corporate Email Gateway"
      - "OT Network Mail Relay (if present)"
      - "Corporate-to-OT DMZ"
      - "Engineering Workstations (local email client logs)"
      - "Control System Network (for internal email traffic if applicable)"
    range: "last 90 days"
    queries:
      - tech: "Pseudocode"
        query: "FOR each email to 'high-risk_personnel' with 'high-risk_attachment': CALCULATE 90-day baseline of sender_domain frequency. CALCULATE Shannon entropy for attachment_filename and email_subject. ALERT if sender_domain_frequency < 1st_percentile OR filename_entropy > 99th_percentile OR subject_entropy > 99th_percentile."
  - question: "Can machine learning models identify and score spearphishing emails targeted at high-risk ICS personnel with high confidence?"
    context: "This question explores the use of advanced analytics to improve detection accuracy. By implementing a supervised machine learning model (e.g., Gradient Boosting), the system can assign a 'phishing probability score' to each incoming email. The model is trained on a rich set of features, including sender reputation, email authentication results (DMARC/SPF/DKIM), keyword density, attachment characteristics, and historical communication patterns. This provides a more nuanced and adaptive detection capability, generating critical alerts when the model identifies a high-probability phishing attempt targeting a key user with a confidence score exceeding a defined threshold (e.g., > 0.90)."
    answer_sources:
      - "Zeek smtp.log"
      - "Zeek files.log"
      - "Zeek dns.log"
      - "Zeek x509.log"
      - "Active Directory Logs"
      - "Corporate Email Gateway"
      - "OT Network Mail Relay (if present)"
      - "Corporate-to-OT DMZ"
      - "Engineering Workstations (local email client logs)"
      - "Control System Network (for internal email traffic if applicable)"
    range: "last 90 days"
    queries:
      - tech: "Pseudocode"
        query: "INPUT email_metadata (sender_domain_age, dmarc_spf_dkim_results, ics_keyword_density, attachment_mime_type, filename_entropy, etc.). APPLY trained classification_model. ALERT if recipient in 'high-risk_personnel' AND model_output_score > 0.90."