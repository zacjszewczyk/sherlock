name: T0820: Exploitation for Evasion
id: a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d
description: This playbook addresses the threat of an adversary exploiting software vulnerabilities in Industrial Control System (ICS) devices to evade security controls. It focuses on detecting anomalous network connections to or from ICS assets (PLCs, RTUs, HMIs), identifying unusual process creation on critical hosts like Engineering Workstations (EWS) and HMIs, monitoring for unauthorized transfers of sensitive firmware or project files, and spotting direct evidence of security control tampering, such as clearing audit logs or disabling security services.
type: technique
related:
  - TA0103: Evasion
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Are there network connections to or from ICS assets that violate the established network access whitelist?
    context: This question aims to identify unauthorized communication attempts with critical ICS devices. By maintaining a strict whitelist of allowed source IPs, destination assets, and protocol/port pairs, any deviation can be flagged as a potential exploit attempt. Violations, such as an unknown IP connecting to a PLC or the use of forbidden protocols like RDP or SMB, are strong indicators of malicious activity intended to bypass standard security measures.
    answer_sources:
      - Zeek conn.log
      - Zeek notice.log
      - Zeek dce_rpc.log
      - Zeek rdp.log
      - Process Control Network (PCN)
      - Engineering Workstations (EWS)
      - Human-Machine Interfaces (HMIs)
      - Network boundary between IT and OT networks
      - Industrial Demilitarized Zone (IDMZ)
    range: last 90 days
    queries:
      - pseudocode: SEARCH Zeek conn.log WHERE (connection NOT in whitelist) OR (protocol IN [RDP, SMB, FTP] AND destination_ip is ICS_asset). CORRELATE with Zeek notice.log for known exploit signatures.
  - question: Are there any authorized network connections exhibiting anomalous behavior in terms of data volume or duration?
    context: Even legitimate connections can be co-opted for malicious purposes. This question seeks to uncover exploits hiding within allowed communication channels by baselining normal connection metrics (byte volume, packet count, duration). A significant deviation (e.g., more than 3 standard deviations from the mean) can indicate activities like data exfiltration, large payload delivery, or a persistent connection used for command and control, which are characteristic of an exploit.
    answer_sources:
      - Zeek conn.log
      - Zeek notice.log
      - Zeek dce_rpc.log
      - Zeek rdp.log
      - Process Control Network (PCN)
      - Engineering Workstations (EWS)
      - Human-Machine Interfaces (HMIs)
      - Network boundary between IT and OT networks
      - Industrial Demilitarized Zone (IDMZ)
    range: last 90 days
    queries:
      - pseudocode: FOR each whitelisted connection_tuple, CALCULATE 30-day baseline (mean, stddev) for bytes, duration. SEARCH Zeek conn.log FOR connections WHERE (bytes > mean + 3*stddev) OR (duration > mean + 3*stddev).
  - question: Is there a significant deviation from the normal pattern of overall network traffic to or from critical ICS assets?
    context: Sophisticated adversaries may use multiple, subtle connections that individually don't trigger statistical alerts. This question uses a machine learning approach to detect broader anomalies in the aggregate traffic patterns. A sudden spike in connection counts or total data volume, even if individual connections seem normal, could signal a coordinated, low-and-slow attack or a large-scale exploit attempt against multiple devices.
    answer_sources:
      - Zeek conn.log
      - Zeek notice.log
      - Zeek dce_rpc.log
      - Zeek rdp.log
      - Process Control Network (PCN)
      - Engineering Workstations (EWS)
      - Human-Machine Interfaces (HMIs)
      - Network boundary between IT and OT networks
      - Industrial Demilitarized Zone (IDMZ)
    range: last 90 days
    queries:
      - pseudocode: APPLY time-series anomaly detection model to hourly connection_count and data_volume aggregates from Zeek conn.log for critical ICS assets. ALERT on significant deviations from forecasted patterns.
  - question: Has a suspicious process been created on a critical ICS host, such as an EWS or HMI?
    context: This question focuses on identifying the initial execution of malicious code on key ICS hosts. Adversaries often use unsigned executables, place them in non-standard directories like temp folders, or leverage legitimate system tools (LOLBins) with malicious parameters to evade detection. Alerting on these specific indicators helps catch the execution phase of an exploit before it can cause significant impact. Correlating with network connection events (Event ID 5156) helps prioritize processes attempting to communicate externally.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 5156
      - Engineering Workstations (EWS)
      - Human-Machine Interfaces (HMIs)
      - Jump Servers within the OT network
    range: last 90 days
    queries:
      - pseudocode: SEARCH Windows Event ID 4688 WHERE (executable is unsigned) OR (executable_path IN ['%TEMP%', 'C:\\Users\\Public']) OR (process_name is LOLBin AND command_line contains suspicious_args). CORRELATE with Windows Event ID 5156 for network connections.
  - question: Is there evidence of obfuscated commands or anomalous parent-child process relationships on ICS hosts?
    context: To hide their actions, attackers often obfuscate commands, leading to command-line arguments with unusually high randomness (entropy). This question aims to detect such obfuscation by baselining normal command-line entropy. Additionally, adversaries may cause legitimate programs to spawn unusual child processes (e.g., an HMI application spawning a command prompt). Detecting these rare parent-child relationships can uncover process injection or other evasive techniques.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 5156
      - Engineering Workstations (EWS)
      - Human-Machine Interfaces (HMIs)
      - Jump Servers within the OT network
    range: last 90 days
    queries:
      - pseudocode: CALCULATE Shannon entropy for command_lines in Event ID 4688. ALERT if entropy > 99th percentile of host baseline. TRACK parent-child process relationships. ALERT on relationships with frequency < 1st percentile.
  - question: Can machine learning models classify any newly created processes on ICS hosts as suspicious or malicious?
    context: This question leverages a more advanced, holistic approach to process analysis. Instead of relying on single indicators, a machine learning model can consider multiple features simultaneously (process name, parent, path, entropy, user context) to make a more nuanced judgment. This allows for the detection of novel or complex threats that might not trigger simpler, rule-based alerts, by classifying overall process behavior as 'benign' or 'suspicious' with a given confidence score.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 5156
      - Engineering Workstations (EWS)
      - Human-Machine Interfaces (HMIs)
      - Jump Servers within the OT network
    range: last 90 days
    queries:
      - pseudocode: APPLY process behavior classification model to new processes from Event ID 4688. USE features like process_name, parent_process, path, command_line_entropy. ALERT on processes classified as 'suspicious' with confidence > 0.8.
  - question: Has an unauthorized firmware, configuration, or project file been transferred to or from an ICS device?
    context: The integrity of firmware and project files is paramount in an OT environment. This question aims to detect unauthorized modifications or deployments by enforcing strict controls. Any file transfer that involves an unknown file (hash mismatch), comes from an unauthorized source IP, or occurs outside a planned maintenance window should be treated as a high-priority incident, as it could represent an adversary attempting to deploy malicious logic to a controller.
    answer_sources:
      - Zeek files.log
      - Zeek conn.log
      - Windows Event ID 4663
      - Process Control Network (PCN)
      - Engineering Workstations (EWS)
      - Industrial Demilitarized Zone (IDMZ) for firmware update servers
      - OT File Servers
    range: last 90 days
    queries:
      - pseudocode: SEARCH Zeek files.log and Windows Event ID 4663 for transfers of .bin, .hex, .acd files. ALERT if (file_hash NOT in known_good_list) OR (source_ip NOT in authorized_list) OR (timestamp is outside_maintenance_window).
  - question: Are there unusual patterns in firmware or project file transfers, such as a large fan-out or anomalous file size?
    context: Beyond single unauthorized transfers, adversaries' actions can create anomalous patterns at a larger scale. This question seeks to identify these patterns. For instance, a single malicious firmware file being pushed to many devices in a short period (high fan-out) is a strong indicator of a widespread attack. Similarly, a file that is significantly larger or smaller than its legitimate counterpart could be a sign of tampering or a malicious payload.
    answer_sources:
      - Zeek files.log
      - Zeek conn.log
      - Windows Event ID 4663
      - Process Control Network (PCN)
      - Engineering Workstations (EWS)
      - Industrial Demilitarized Zone (IDMZ) for firmware update servers
      - OT File Servers
    range: last 90 days
    queries:
      - pseudocode: ANALYZE Zeek files.log. ALERT if (count of destinations for a single file_hash in 1 hour > 99th percentile) OR (file_size deviates > 3 stddev from baseline for that file_type).
  - question: Can a machine learning model identify high-risk file transfer events based on their contextual features?
    context: This question uses machine learning to provide a comprehensive risk assessment for each file transfer. By combining multiple features—such as the source/destination, protocol, file type, time of day, and whether it's within a maintenance window—a model can learn to distinguish between benign administrative tasks and potentially malicious transfers. This provides a more robust detection capability than single-factor rules, flagging transfers with a high probability of being malicious for analyst review.
    answer_sources:
      - Zeek files.log
      - Zeek conn.log
      - Windows Event ID 4663
      - Process Control Network (PCN)
      - Engineering Workstations (EWS)
      - Industrial Demilitarized Zone (IDMZ) for firmware update servers
      - OT File Servers
    range: last 90 days
    queries:
      - pseudocode: APPLY file transfer classification model to events from Zeek files.log and conn.log. USE features like source_ip, protocol, file_extension, time_of_day, in_maintenance_window. ALERT on transfers classified as 'malicious' with probability > 0.85.
  - question: Is there direct evidence of an adversary tampering with security controls on a critical ICS host?
    context: A common precursor to or part of an attack is the disabling of security measures. This question looks for explicit evidence of such tampering. Events like clearing the audit log (Event ID 1102), stopping a security service like an antivirus or EDR (Event ID 7040), or modifying system audit policies (Event IDs 4719, 4657) are high-fidelity indicators of malicious intent and should be treated as critical, non-suppressible alerts.
    answer_sources:
      - Windows Event ID 1102
      - Windows Event ID 7040
      - Windows Event ID 4719
      - Windows Event ID 4657
      - Engineering Workstations (EWS)
      - Human-Machine Interfaces (HMIs)
      - Windows Servers within the ICS network
      - OT Domain Controllers
    range: last 90 days
    queries:
      - pseudocode: SEARCH for (Windows Event ID 1102) OR (Windows Event ID 7040 where service_name is security_service) OR (Windows Event ID 4719) OR (Windows Event ID 4657 on security_registry_keys). GENERATE high-priority alert.
  - question: Are there indirect signs of log tampering or unusual changes to security service states?
    context: Savvy attackers may try to tamper with logs without generating a specific 'log cleared' event. This question seeks to detect this by monitoring for a sudden, drastic drop in log volume from a host, which could indicate that logging has been stopped or manipulated. Additionally, by baselining the normal frequency of service state changes, the rare event of a security service being stopped or restarted can be flagged as anomalous, even if it's not a common occurrence.
    answer_sources:
      - Windows Event ID 1102
      - Windows Event ID 7040
      - Windows Event ID 4719
      - Windows Event ID 4657
      - Engineering Workstations (EWS)
      - Human-Machine Interfaces (HMIs)
      - Windows Servers within the ICS network
      - OT Domain Controllers
    range: last 90 days
    queries:
      - pseudocode: MONITOR hourly log volume per host. ALERT if volume drops > 90% in one hour. TRACK frequency of service state changes (Event ID 7040). ALERT on changes to security services that are historically rare (< 1st percentile).
  - question: Can an analysis of event sequences detect a chain of actions indicative of an attack?
    context: Individual events may seem benign in isolation, but in sequence, they can tell a story of an attack. This question uses sequence analysis models (like an HMM or LSTM) to learn the 'normal grammar' of system events. An anomalous sequence, such as an unusual login, followed by suspicious process creation, and then the disabling of a security service, would be flagged by the model as a high-risk deviation from normal behavior, allowing for detection of the entire attack chain.
    answer_sources:
      - Windows Event ID 1102
      - Windows Event ID 7040
      - Windows Event ID 4719
      - Windows Event ID 4657
      - Engineering Workstations (EWS)
      - Human-Machine Interfaces (HMIs)
      - Windows Servers within the ICS network
      - OT Domain Controllers
    range: last 90 days
    queries:
      - pseudocode: APPLY sequence analysis model (HMM/LSTM) to Windows Event ID stream from hosts. TRAIN on normal event sequences. ALERT when model detects an anomalous sequence (e.g., login -> process_creation -> service_disabled) with high probability.