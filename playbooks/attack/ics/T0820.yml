name: "T0820: Exploitation for Evasion"
id: "e5b8e9b0-13d8-4a46-8a71-9f79b37a54a0"
description: "This playbook helps determine if an adversary is exploiting software vulnerabilities in Industrial Control System (ICS) devices to evade security controls. It focuses on identifying anomalous network connections to or from ICS assets (e.g., non-standard protocols, unusual connection metrics), suspicious process creation on critical hosts like Engineering Workstations (EWS) or Human-Machine Interfaces (HMIs) (e.g., unsigned executables, LOLBins), unauthorized transfers of sensitive firmware or project files, and direct evidence of security control tampering (e.g., clearing audit logs, disabling security services)."
type: "technique"
related:
  - "TA0103: Evasion"
contributors:
  - "Zachary Szewczyk"
  - "Ask Sage"
created: "2025-10-01"
modified: "2025-10-01"
version: "1.0"
tags: "none"
questions:
  - question: "Is there network traffic violating the established whitelist of authorized IPs, assets, and protocols, or does it match known exploit signatures?"
    context: "This question aims to detect blatant policy violations, such as connections from unauthorized sources or the use of forbidden protocols like RDP or SMB to critical ICS assets. Such activity is a strong indicator of an initial breach or lateral movement attempt. Correlating this with known exploit signatures provides a higher level of confidence that the activity is malicious."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek notice.log"
      - "Zeek dce_rpc.log"
      - "Zeek rdp.log"
      - "Process Control Network (PCN)"
      - "Engineering Workstations (EWS)"
      - "Human-Machine Interfaces (HMIs)"
      - "Network boundary between IT and OT networks"
      - "Industrial Demilitarized Zone (IDMZ)"
    range: "last 90 days"
    queries:
      - "Pseudocode: SEARCH Zeek conn.log WHERE (source_ip NOT IN whitelist OR destination_ip NOT IN whitelist OR (protocol, port) NOT IN whitelist) OR (protocol IN [RDP, SMB, FTP]). CORRELATE with Zeek notice.log for matching signatures."
  - question: "Are there network connections to or from ICS assets whose metrics (e.g., data volume, duration) significantly deviate from their established historical baseline?"
    context: "This question helps identify subtle anomalies that might not violate a strict whitelist but are statistically unusual. An exploit or data exfiltration attempt might manifest as a connection that is unusually long or transfers an abnormally large amount of data compared to its normal behavior. Detecting deviations greater than 3 standard deviations helps filter out normal fluctuations and focuses on significant outliers."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek notice.log"
      - "Zeek dce_rpc.log"
      - "Zeek rdp.log"
      - "Process Control Network (PCN)"
      - "Engineering Workstations (EWS)"
      - "Human-Machine Interfaces (HMIs)"
      - "Network boundary between IT and OT networks"
      - "Industrial Demilitarized Zone (IDMZ)"
    range: "last 90 days"
    queries:
      - "Pseudocode: FOR each connection in Zeek conn.log, CALCULATE 30-day baseline (mean, stddev) for its source-dest-port-proto tuple. ALERT if current_connection.bytes > mean + (3 * stddev) OR current_connection.duration > mean + (3 * stddev)."
  - question: "Does the overall volume or frequency of network connections to critical ICS assets deviate from patterns predicted by a time-series anomaly detection model?"
    context: "This question seeks to identify coordinated or large-scale attacks that might not be apparent when looking at individual connections. A sudden spike in the number of connections or total data volume to a PLC, even if each connection is small, could indicate a distributed scanning or exploitation attempt. A time-series model can learn the 'rhythm' of the network and flag deviations from this learned normal pattern."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek notice.log"
      - "Zeek dce_rpc.log"
      - "Zeek rdp.log"
      - "Process Control Network (PCN)"
      - "Engineering Workstations (EWS)"
      - "Human-Machine Interfaces (HMIs)"
      - "Network boundary between IT and OT networks"
      - "Industrial Demilitarized Zone (IDMZ)"
    range: "last 90 days"
    queries:
      - "Pseudocode: INPUT historical Zeek conn.log data (count, volume per hour) into time-series model. FORECAST expected activity. ALERT if current observed activity significantly deviates from forecast."
  - question: "Has a suspicious process been created on a critical ICS host, characterized by being unsigned, running from a non-standard location, or being a LOLBin with suspicious parameters?"
    context: "This question focuses on detecting common malware execution patterns on endpoints like HMIs and EWS. Legitimate software in an OT environment is typically signed and runs from expected directories. Processes that are unsigned, run from temporary folders, or leverage built-in system tools (LOLBins) for malicious purposes (like downloading files with certutil.exe) are high-fidelity indicators of compromise."
    answer_sources:
      - "Windows Event ID 4688"
      - "Windows Event ID 5156"
      - "Engineering Workstations (EWS)"
      - "Human-Machine Interfaces (HMIs)"
      - "Jump Servers within the OT network"
    range: "last 90 days"
    queries:
      - "Pseudocode: SEARCH Windows Event ID 4688 WHERE (process is unsigned AND process NOT IN whitelist) OR (process_path IN [%TEMP%, C:\\Users\\Public]) OR (process_name IN LOLBin_list AND command_line contains suspicious_args). CORRELATE with Event ID 5156 for network connections."
  - question: "Are there new processes being created with unusually complex or obfuscated command-line arguments, or are they being spawned by unexpected parent processes?"
    context: "This question aims to uncover attempts to hide malicious commands through obfuscation (detected by high entropy) or to execute code through an unusual process chain. For example, an HMI application should not normally spawn a command prompt (cmd.exe). Baselining normal command line entropy and parent-child relationships allows for the detection of these statistically rare and suspicious events."
    answer_sources:
      - "Windows Event ID 4688"
      - "Windows Event ID 5156"
      - "Engineering Workstations (EWS)"
      - "Human-Machine Interfaces (HMIs)"
      - "Jump Servers within the OT network"
    range: "last 90 days"
    queries:
      - "Pseudocode: FOR each new process (Event ID 4688), CALCULATE shannon_entropy of command_line. ALERT if entropy > 99th_percentile_baseline. SEARCH for parent-child relationships with frequency < 1st_percentile_baseline."
  - question: "Has a machine learning model classified any newly created process on an ICS host as 'suspicious' with a high confidence score?"
    context: "This question leverages a more advanced, holistic approach to process analysis. By training a model on various features like process name, parent, path, and entropy, it can learn the subtle characteristics of both benign and malicious behavior specific to the ICS environment. This allows for the detection of novel threats that may not be caught by static rules or simple statistical thresholds."
    answer_sources:
      - "Windows Event ID 4688"
      - "Windows Event ID 5156"
      - "Engineering Workstations (EWS)"
      - "Human-Machine Interfaces (HMIs)"
      - "Jump Servers within the OT network"
    range: "last 90 days"
    queries:
      - "Pseudocode: INPUT features from Windows Event ID 4688 into trained classification model. ALERT if model_output == 'suspicious' AND confidence_score > 0.8."
  - question: "Has a firmware, configuration, or project file been transferred in a manner that violates established policy (e.g., from an unauthorized source, with an unknown hash, or outside a maintenance window)?"
    context: "This question is critical for protecting the integrity of ICS devices. Unauthorized changes to firmware or project files can cause catastrophic physical consequences. By strictly enforcing a policy based on known-good file hashes, authorized source systems, and pre-defined maintenance schedules, any deviation can be treated as a high-priority security incident."
    answer_sources:
      - "Zeek files.log"
      - "Zeek conn.log"
      - "Windows Event ID 4663"
      - "Process Control Network (PCN)"
      - "Engineering Workstations (EWS)"
      - "Industrial Demilitarized Zone (IDMZ) for firmware update servers"
      - "OT File Servers"
    range: "last 90 days"
    queries:
      - "Pseudocode: SEARCH Zeek files.log or Win Event 4663 for file types [.bin, .hex, .acd]. ALERT if (file_hash NOT IN known_good_hashes) OR (source_ip NOT IN authorized_ips) OR (timestamp NOT IN maintenance_window)."
  - question: "Are there file transfers exhibiting anomalous patterns, such as a single file being sent to an unusually large number of devices, or a file's size deviating significantly from the norm?"
    context: "This question seeks to identify malicious deployment at scale or file manipulation. An adversary might push a malicious firmware file to many devices at once (fan-out). Alternatively, they might inject a payload into a legitimate file, causing its size to change. Monitoring for these statistical outliers can reveal malicious activity that might otherwise appear legitimate if viewed in isolation."
    answer_sources:
      - "Zeek files.log"
      - "Zeek conn.log"
      - "Windows Event ID 4663"
      - "Process Control Network (PCN)"
      - "Engineering Workstations (EWS)"
      - "Industrial Demilitarized Zone (IDMZ) for firmware update servers"
      - "OT File Servers"
    range: "last 90 days"
    queries:
      - "Pseudocode: ANALYZE Zeek files.log. ALERT if (count of destinations for a single file_hash in 1 hour) > 99th_percentile_baseline. ALERT if file_size deviates > 3 standard deviations from baseline for that file type."
  - question: "Has a machine learning model assessed any file transfer event as high-risk or malicious based on a combination of its attributes?"
    context: "This question employs a machine learning model to provide a comprehensive risk score for each file transfer. The model can consider a wide range of features simultaneously (source, protocol, file name entropy, time of day) to make a more nuanced decision than simple rules. This is useful for detecting sophisticated attacks that try to blend in with normal activity."
    answer_sources:
      - "Zeek files.log"
      - "Zeek conn.log"
      - "Windows Event ID 4663"
      - "Process Control Network (PCN)"
      - "Engineering Workstations (EWS)"
      - "Industrial Demilitarized Zone (IDMZ) for firmware update servers"
      - "OT File Servers"
    range: "last 90 days"
    queries:
      - "Pseudocode: INPUT features from Zeek files.log and conn.log into trained classification model. ALERT if model_output == 'malicious' AND probability_score > 0.85."
  - question: "Is there direct evidence of security control tampering on a critical ICS host, such as audit logs being cleared, security services being stopped, or audit policies being modified?"
    context: "This question looks for unambiguous signs of an adversary trying to cover their tracks or disable defenses. Events like the audit log being cleared (Event ID 1102) or an EDR service being stopped are high-confidence indicators of malicious intent. These should be treated as immediate, critical alerts as they often precede or accompany further malicious actions."
    answer_sources:
      - "Windows Event ID 1102"
      - "Windows Event ID 7040"
      - "Windows Event ID 4719"
      - "Windows Event ID 4657"
      - "Engineering Workstations (EWS)"
      - "Human-Machine Interfaces (HMIs)"
      - "Windows Servers within the ICS network"
      - "OT Domain Controllers"
    range: "last 90 days"
    queries:
      - "Pseudocode: CREATE non-suppressible ALERT for Windows Event IDs 1102, 4719, 4657. CREATE ALERT for Event ID 7040 where service_name is a critical security service."
  - question: "Has there been an anomalous drop in log volume from a host, or have security services been modified in a statistically rare manner?"
    context: "This question provides an indirect way to detect tampering. An adversary might stop a logging service without generating a specific 'log cleared' event, resulting in a sudden drop in log volume. Similarly, while services can stop and start for legitimate reasons, a security service changing state is often a rare event. Flagging these statistical rarities can provide an early warning of tampering."
    answer_sources:
      - "Windows Event ID 1102"
      - "Windows Event ID 7040"
      - "Windows Event ID 4719"
      - "Windows Event ID 4657"
      - "Engineering Workstations (EWS)"
      - "Human-Machine Interfaces (HMIs)"
      - "Windows Servers within the ICS network"
      - "OT Domain Controllers"
    range: "last 90 days"
    queries:
      - "Pseudocode: BASELINE hourly log volume per host. ALERT if current_volume < 90% of baseline. TRACK frequency of service state changes (Event ID 7040) for security services. ALERT if change frequency is < 1st percentile."
  - question: "Has a sequence analysis model detected an anomalous series of events on a host, such as a suspicious login followed by process creation and then a security service being disabled?"
    context: "This question moves beyond individual events to analyze the 'story' they tell together. A single event might not be suspicious, but a specific sequence of events in a short time window can be a strong indicator of an attack. A sequence model learns normal workflows and can flag these malicious chains of activity, providing context-rich alerts for analysts."
    answer_sources:
      - "Windows Event ID 1102"
      - "Windows Event ID 7040"
      - "Windows Event ID 4719"
      - "Windows Event ID 4657"
      - "Engineering Workstations (EWS)"
      - "Human-Machine Interfaces (HMIs)"
      - "Windows Servers within the ICS network"
      - "OT Domain Controllers"
    range: "last 90 days"
    queries:
      - "Pseudocode: INPUT stream of Windows Event IDs into trained sequence analysis model (e.g., HMM, LSTM). ALERT when the model detects a low-probability (anomalous) sequence of events."