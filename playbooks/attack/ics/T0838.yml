name: 'T0838: Modify Alarm Settings'
id: 'a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d'
description: 'This playbook addresses the threat of an adversary attempting to modify or suppress critical process alarms. It provides investigative steps to detect unauthorized alarm setting modifications through direct file access, network file transfers, or by inhibiting critical alarm services. The goal is to identify tampering with alarm configurations on assets like HMIs and Engineering Workstations, which could prevent operators from being notified of hazardous process conditions.'
type: 'technique'
related:
  - 'TA0107: Inhibit Response Function'
contributors:
  - 'Zachary Szewczyk'
created: '2025-10-01'
modified: '2025-10-01'
version: 1.0
tags: 'none'
questions:
  - question: 'Has an unauthorized user or process attempted to modify a critical alarm configuration file outside of a designated maintenance window?'
    context: 'This question helps detect direct, unauthorized tampering with alarm configuration files on critical systems. By monitoring for specific file access events and correlating them with process creation data, analysts can identify modifications made by non-whitelisted entities or at unusual times, which are strong indicators of malicious activity aimed at suppressing alarms.'
    answer_sources:
      - 'Windows Event ID 4663'
      - 'Windows Event ID 4688'
      - 'Windows Event ID 5145'
      - 'Windows Event ID 4656'
      - 'Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Historian servers, Data Gateways/OPC Servers'
    range: 'last 90 days'
    queries:
      - type: 'pseudocode'
        query: |
          SEARCH for EventID 4663 or 5145 on critical file paths
          WHERE file path in watchlist
          EXTRACT ProcessID
          JOIN with EventID 4688 on ProcessID
          EXTRACT user, parent process
          ALERT if user or parent process NOT in whitelist OR event time outside maintenance window
  - question: 'Has there been a statistically anomalous spike in modification activity or a change in the variety of parent processes modifying critical alarm configuration files?'
    context: 'This question focuses on detecting deviations from normal modification patterns. A sudden increase in the frequency of file writes/deletes can indicate bulk changes or repeated tampering. Similarly, a significant change in the entropy of parent processes (e.g., a single, unusual process now responsible for all modifications) can expose a new or anomalous tool being used by an adversary.'
    answer_sources:
      - 'Windows Event ID 4663'
      - 'Windows Event ID 5145'
      - 'Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Historian servers, Data Gateways/OPC Servers'
    range: 'last 60 days'
    queries:
      - type: 'pseudocode'
        query: |
          // Query 1: Frequency Anomaly
          CALCULATE hourly count of EventID 4663/5145 on critical files over 60 days
          DETERMINE 99th percentile for each hour
          SEARCH for current hourly count
          ALERT if current count > 99th percentile threshold

          // Query 2: Entropy Anomaly
          CALCULATE rolling 24-hour Shannon entropy of parent process names modifying critical files
          DETERMINE 2-standard-deviation band from baseline
          ALERT if current entropy is outside the band
  - question: 'Can we use a machine learning model to predict whether a specific modification to an alarm configuration file is malicious?'
    context: 'This question aims to automate the detection of malicious modifications by using a supervised machine learning model. By training on historical data with known outcomes, the model can learn complex patterns that distinguish malicious from benign activity, allowing for real-time scoring and alerting on high-confidence predictions, reducing analyst workload and improving accuracy.'
    answer_sources:
      - 'Windows Event ID 4663'
      - 'Windows Event ID 4688'
      - 'Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Historian servers, Data Gateways/OPC Servers'
    range: 'last 90 days'
    queries:
      - type: 'pseudocode'
        query: |
          FOR each new EventID 4663 on critical file:
          GATHER features: process name, parent process, user, time of day, etc.
          INPUT features into trained classification model
          GET prediction score
          ALERT if prediction is 'malicious' AND score > 0.90
  - question: 'Has a known alarm configuration file been transferred to a critical ICS asset from an unapproved source, using an unapproved port, or with a hash that does not match a known-good version?'
    context: 'This question addresses the threat of an adversary introducing a modified alarm configuration file over the network. By monitoring file transfers and verifying the source, destination port, and file integrity against whitelists and known-good hashes, analysts can detect unauthorized file staging or replacement activities.'
    answer_sources:
      - 'Zeek files.log'
      - 'Zeek conn.log'
      - 'Zeek smb_files.log'
      - 'Zeek ftp.log'
      - 'IT/OT boundary firewalls, Industrial Demilitarized Zones (IDMZ), Control Network segments (Process Control, Safety Instrumented Systems), Wireless Industrial Networks'
    range: 'last 90 days'
    queries:
      - type: 'pseudocode'
        query: |
          SEARCH Zeek files.log WHERE filename in watchlist AND destination is critical asset
          JOIN with conn.log on UID
          ALERT if source IP NOT in whitelist
          OR destination port NOT in whitelist
          OR file SHA1 hash NOT in known-good hash list
  - question: 'Has there been a statistically anomalous increase in the number or volume of alarm configuration files transferred to a critical asset, or a change in the diversity of sources for these transfers?'
    context: 'This question seeks to identify unusual network transfer patterns. A spike in the volume or count of configuration files being transferred could indicate a large-scale modification attempt. A sudden drop in the entropy of source IPs (e.g., many files coming from a single, new IP) might point to a centralized staging host used by an attacker.'
    answer_sources:
      - 'Zeek files.log'
      - 'Zeek conn.log'
      - 'IT/OT boundary firewalls, Industrial Demilitarized Zones (IDMZ), Control Network segments (Process Control, Safety Instrumented Systems), Wireless Industrial Networks'
    range: 'last 60 days'
    queries:
      - type: 'pseudocode'
        query: |
          // Query 1: Volume/Count Anomaly
          CALCULATE daily count and volume of config file transfers to critical assets over 60 days
          DETERMINE 99th percentile for count and volume
          SEARCH for current daily metrics
          ALERT if current count > threshold OR current volume > threshold

          // Query 2: Source Entropy Anomaly
          CALCULATE rolling 24-hour Shannon entropy of source IPs transferring config files
          ALERT if entropy drops suddenly
  - question: 'Does overall network traffic to critical ICS assets show anomalous patterns that could indicate malicious activity, such as the transfer of modified alarm files?'
    context: 'This question uses an unsupervised machine learning model to find subtle deviations in network behavior that might otherwise be missed. By learning what "normal" traffic looks like across multiple dimensions (byte count, protocols, file transfers, etc.), the model can flag periods of unusual activity that warrant investigation, even if no single rule is explicitly violated.'
    answer_sources:
      - 'Zeek files.log'
      - 'Zeek conn.log'
      - 'IT/OT boundary firewalls, Industrial Demilitarized Zones (IDMZ), Control Network segments (Process Control, Safety Instrumented Systems), Wireless Industrial Networks'
    range: 'last 90 days'
    queries:
      - type: 'pseudocode'
        query: |
          AGGREGATE hourly network features (byte count, packet count, file transfers, etc.) for traffic to critical assets
          INPUT feature vector into trained LSTM Autoencoder model
          CALCULATE reconstruction error (anomaly score)
          ALERT if anomaly score is high
  - question: 'Has a critical alarm service been stopped outside of a legitimate system shutdown, or has its startup type been changed to ''Disabled''?'
    context: 'This question targets direct attempts to disable alarm services. An adversary might stop a service to prevent new alarms from being generated or processed. Monitoring for service stop events (and filtering out legitimate shutdowns) is a direct way to detect this. Additionally, changing a service''s startup type to ''Disabled'' is a persistence technique to ensure the service does not run on the next reboot.'
    answer_sources:
      - 'Windows Event ID 7036'
      - 'Windows Event ID 1074'
      - 'Windows Event ID 4688'
      - 'Windows Event ID 7040'
      - 'Operator Stations, Human-Machine Interfaces (HMIs), Alarm management servers, SCADA Servers, Data Historian Servers'
    range: 'last 90 days'
    queries:
      - type: 'pseudocode'
        query: |
          // Query 1: Service Stop
          SEARCH for EventID 7036 where service in watchlist AND state is 'stopped'
          CHECK for EventID 1074 on same host in preceding 5 minutes
          IF no shutdown event, ALERT and investigate initiator with EventID 4688

          // Query 2: Service Start Type Change
          SEARCH for EventID 7040 where service in watchlist
          ALERT if new start type is 'Disabled'
  - question: 'Has a critical alarm service stopped prematurely or more frequently than normal?'
    context: 'This question uses historical data to establish a baseline for normal service behavior. A service stopping much sooner than it typically does (low percentile uptime) could indicate a crash or a forced termination. Likewise, an increase in the frequency of stop events (high percentile count) could signal repeated, unsuccessful attempts by an adversary to disable the service.'
    answer_sources:
      - 'Windows Event ID 7036'
      - 'Operator Stations, Human-Machine Interfaces (HMIs), Alarm management servers, SCADA Servers, Data Historian Servers'
    range: 'last 90 days'
    queries:
      - type: 'pseudocode'
        query: |
          // Query 1: Uptime Anomaly
          CALCULATE uptime durations for critical services over 90 days
          DETERMINE 5th percentile of uptime
          FOR each new 'stopped' event, calculate uptime
          ALERT if uptime < 5th percentile

          // Query 2: Frequency Anomaly
          CALCULATE daily count of unsuppressed 'stopped' events over 90 days
          DETERMINE 99th percentile of daily counts
          ALERT if current daily count > 99th percentile
  - question: 'Can a machine learning model be used to determine if a service stop event is suspicious?'
    context: 'This question proposes using a supervised model to automate the classification of service stop events. By learning from labeled historical data, the model can identify complex relationships between features (like the time of day, initiating process, and proximity to a system shutdown) to accurately predict whether a stop event is legitimate or suspicious, thereby focusing analyst attention on high-probability threats.'
    answer_sources:
      - 'Windows Event ID 7036'
      - 'Windows Event ID 1074'
      - 'Windows Event ID 4688'
      - 'Operator Stations, Human-Machine Interfaces (HMIs), Alarm management servers, SCADA Servers, Data Historian Servers'
    range: 'last 90 days'
    queries:
      - type: 'pseudocode'
        query: |
          FOR each new EventID 7036 'stopped' event:
          GATHER features: service name, time of day, has preceding shutdown, initiator, etc.
          INPUT features into trained classification model
          GET prediction score
          ALERT if prediction is 'suspicious' AND score > 0.85