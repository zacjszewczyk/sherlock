name: T0863: User Execution
id: f47ac10b-58cc-4372-a567-0e02b2c3d479
description: This playbook focuses on detecting instances where an adversary tricks a user into executing malicious code, a common technique for initial access and execution in ICS environments. It covers scenarios such as malicious macros in Office documents launching command-line interpreters, execution of unauthorized software from user-writable directories, and the unsanctioned use of elevated privileges. The goal is to identify these user-driven execution events by analyzing process creation logs, network traffic, and system baselines for anomalous behavior.
type: technique
related:
- TA0104: Execution
- TA0108: Initial Access
contributors:
- Zachary Szewczyk
- Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
- question: Have any approved Office or PDF applications launched suspicious child processes like command-line interpreters or scripting engines?
  context: This is a classic spearphishing follow-on action where an attacker embeds a malicious macro or script in a document. When the user opens it, the document application (e.g., Word, Excel) is used to spawn a shell (like cmd.exe or powershell.exe) to download and execute the next stage of the attack. This question looks for that initial parent-child process relationship, which is highly anomalous in most ICS environments, and correlates it with suspicious network connections.
  answer_sources:
  - Windows Event ID 4688
  - Zeek conn.log
  - Zeek dns.log
  - Zeek files.log
  - Zeek pe.log
  - Endpoint devices within the ICS network, including Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Data Historians, and ICS DMZ servers; network traffic monitoring points at ICS zone boundaries and egress points.
  range: last 90 days
  queries:
  - pseudocode: SEARCH process_creation_logs (WinEvent:4688) | WHERE parent_process IN ['winword.exe', 'excel.exe', 'powerpnt.exe', 'acrord32.exe'] AND child_process IN ['cmd.exe', 'powershell.exe', 'wscript.exe', 'cscript.exe', 'rundll32.exe'] | FILTER command_line CONTAINS suspicious arguments like ['-EncodedCommand', 'IEX'] | CORRELATE with network_logs within 15s for outbound connections to non-whitelisted or low-reputation IPs.
- question: Are there instances of Office applications launching command-line tools with unusually complex, rare, or long command-line arguments?
  context: Attackers often obfuscate their commands to evade simple keyword-based detection. High Shannon entropy can indicate encoded or encrypted commands (e.g., Base64). Similarly, a command line that has never been seen before, is extremely rare, or is abnormally long for a specific host or parent-child pair is a strong indicator of malicious activity, as legitimate automated processes are typically repetitive and predictable.
  answer_sources:
  - Windows Event ID 4688
  - Zeek conn.log
  - Zeek dns.log
  - Zeek files.log
  - Zeek pe.log
  - Endpoint devices within the ICS network, including Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Data Historians, and ICS DMZ servers; network traffic monitoring points at ICS zone boundaries and egress points.
  range: last 90 days
  queries:
  - pseudocode: SEARCH process_creation_logs | WHERE parent_child_pair matches ['doc_app' -> 'interpreter'] | CALCULATE entropy(command_line) and length(command_line) | ALERT if entropy > 4.5 OR command_line is a zero-frequency event OR command_line_length > 99th_percentile for that pair.
- question: Has an anomaly detection model identified any suspicious process execution chains involving Office applications and scripting tools?
  context: This question leverages machine learning to move beyond static rules and identify novel or evolving attacker techniques. By training a model on what normal process activity looks like in an ICS environment, it can flag outliers that may represent malicious behavior, even if they don't match a known bad signature. Enriching these alerts with network data helps an analyst quickly prioritize the most critical threats.
  answer_sources:
  - Windows Event ID 4688
  - Zeek conn.log
  - Zeek dns.log
  - Zeek files.log
  - Zeek pe.log
  - Endpoint devices within the ICS network, including Engineering Workstations (EWS), Human-Machine Interfaces (HMIs), Data Historians, and ICS DMZ servers; network traffic monitoring points at ICS zone boundaries and egress points.
  range: last 90 days
  queries:
  - pseudocode: APPLY anomaly_detection_model (Isolation Forest) to process_creation_events | FEATURES include parent_process, child_process, cmdline_length, cmdline_entropy, pe_features | ALERT on high anomaly scores | AUTOMATICALLY enrich alert with correlated network and file data.
- question: Has any software been executed from non-standard, user-writable, or temporary directories on ICS assets?
  context: Legitimate software on critical ICS assets is almost always installed in protected system directories (e.g., Program Files). Execution from user-specific folders like Downloads, AppData, or Temp is a major red flag. It suggests a user downloaded and ran an unauthorized program, or malware has been dropped into a temporary location to execute. Checking the file hash against threat intelligence and internal software inventories provides immediate confirmation.
  answer_sources:
  - Windows Event ID 4688
  - Zeek conn.log
  - Zeek dns.log
  - Zeek x509.log
  - Zeek files.log
  - Zeek pe.log
  - Endpoint devices such as Engineering Workstations (EWS), HMIs, Maintenance Laptops, and Jump Boxes within ICS zones; network egress points from the ICS network; ICS DMZ network segments where software updates might be staged.
  range: last 90 days
  queries:
  - pseudocode: SEARCH process_creation_logs (WinEvent:4688) | WHERE process_path MATCHES ['\\Users\\', '\\AppData\\', '\\ProgramData\\'] AND process_path NOT IN [approved_installer_paths] | ALERT if file_hash is known-bad OR file_hash not in software_inventory OR OriginalFileName != NewProcessName.
- question: Have processes running from user-writable directories made network connections to rare geographical locations or on unusual ports?
  context: This question seeks to identify anomalous network behavior associated with potentially unauthorized software. Legitimate applications on ICS hosts typically communicate with a predictable set of destinations. A connection to a new or rare Autonomous System Number (ASN), country, or a port that the host has never used before is highly suspicious and could indicate C2 communication or data exfiltration.
  answer_sources:
  - Windows Event ID 4688
  - Zeek conn.log
  - Zeek dns.log
  - Zeek x509.log
  - Zeek files.log
  - Zeek pe.log
  - Endpoint devices such as Engineering Workstations (EWS), HMIs, Maintenance Laptops, and Jump Boxes within ICS zones; network egress points from the ICS network; ICS DMZ network segments where software updates might be staged.
  range: last 90 days
  queries:
  - pseudocode: FOR processes from user_writable_dirs | CORRELATE with network_logs (Zeek) | BASELINE destination ASNs, countries, and ports per host group | ALERT if connection is to a rare ASN/country (bottom 5th percentile) or a new destination port for that host.
- question: Has a machine learning model classified any process executions from user-writable directories as suspicious or malicious?
  context: This question uses a supervised machine learning model to provide a more definitive classification of process behavior. By training on known good and bad examples, the model can learn to weigh multiple features (e.g., execution path, command line entropy, network reputation, executable properties) to make a holistic judgment, helping to automate the detection of complex threats that might evade simpler rule-based logic.
  answer_sources:
  - Windows Event ID 4688
  - Zeek conn.log
  - Zeek dns.log
  - Zeek x509.log
  - Zeek files.log
  - Zeek pe.log
  - Endpoint devices such as Engineering Workstations (EWS), HMIs, Maintenance Laptops, and Jump Boxes within ICS zones; network egress points from the ICS network; ICS DMZ network segments where software updates might be staged.
  range: last 90 days
  queries:
  - pseudocode: APPLY classification_model (Gradient Boosting) to process_execution_events | FEATURES include process_path_type, cmdline_entropy, signature_status, destination_ip_rep, port_prevalence | TRIGGER automated enrichment (DNS, x509 lookups) for 'suspicious' or 'malicious' classifications.
- question: Have any processes run with elevated privileges that are not on the strictly controlled whitelist for the ICS environment?
  context: Administrative (elevated) privileges are required to make significant changes to a system. In a controlled ICS environment, only a very specific and small set of applications should ever run with these rights. Any unapproved process running with a full elevated token (Type 2) is a critical security event, as it could indicate an attacker successfully escalating privileges to take full control of the host.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 4624
  - All Windows-based ICS assets requiring strict change control, including Engineering Workstations, SCADA servers, Data Historians, and Domain Controllers in the process control network.
  range: last 90 days
  queries:
  - pseudocode: SEARCH process_creation_logs (WinEvent:4688) | WHERE token_elevation_type IS '%%1937' | FILTER (process_name, process_path, file_hash) NOT IN [privileged_process_whitelist] | ALERT on any match, especially if SubjectUserName is a non-admin account.
- question: Are users executing privileged processes they have never run before, or are there unusual spikes in the overall number of privileged executions?
  context: This question establishes a behavioral baseline for privileged activity. Even if a process is on the whitelist, its execution by an unexpected user or an unusual parent process can be an indicator of compromise. Likewise, a sudden increase in the total volume of privileged executions on a host can signal malicious activity, such as an attacker deploying tools or modifying system configurations.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 4624
  - All Windows-based ICS assets requiring strict change control, including Engineering Workstations, SCADA servers, Data Historians, and Domain Controllers in the process control network.
  range: last 90 days
  queries:
  - pseudocode: BASELINE privileged process executions per user over 90 days | ALERT if a user runs a privileged process for the first time | MONITOR daily count of privileged executions per host | ALERT if count > (mean + 3 * stdev) over a 14-day window.
- question: Have time-series or risk-scoring models detected anomalies in the pattern or context of privileged process executions?
  context: This approach models the rhythm of normal operations to detect subtle deviations. A time-series model can learn the expected daily and weekly patterns of privileged activity, including maintenance windows, and flag unexpected events. A secondary risk-scoring model can then assess the context of the anomaly (e.g., which user, what time, command line complexity) to help analysts focus on the most significant alerts.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 4624
  - All Windows-based ICS assets requiring strict change control, including Engineering Workstations, SCADA servers, Data Historians, and Domain Controllers in the process control network.
  range: last 90 days
  queries:
  - pseudocode: APPLY time-series_model (Seasonal-Hybrid ESD) to aggregated counts of privileged executions per host/role | FOR each detected anomaly, APPLY risk_scoring_model with features like user_role, historical_frequency, cmdline_entropy.
- question: Have any document readers or email clients launched a known Living Off the Land Binary (LOLBAS) that is not on the approved parent-child allowlist?
  context: This question targets a common initial access vector where a user is tricked into opening a malicious document that uses a legitimate, built-in Windows tool (a LOLBAS) to execute malicious commands. By maintaining a strict allowlist of which programs can launch which tools, any deviation, such as Outlook launching 'bitsadmin.exe', can be immediately flagged as highly suspicious.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 4104
  - Windows Event ID 4103
  - Windows Event ID 4624
  - Engineering Workstations, Human-Machine Interfaces (HMIs), Operator Consoles, Jump Servers within the OT network, Data Historians
  range: last 90 days
  queries:
  - pseudocode: SEARCH process_creation_logs (WinEvent:4688) | WHERE parent_process IN ['WINWORD.EXE', 'EXCEL.EXE', 'OUTLOOK.EXE'] AND child_process IN [LOLBAS_list] | FILTER (parent_process, child_process) NOT IN [approved_pair_allowlist] | ALERT on any match.
- question: Are there instances of document handlers launching LOLBAS with new or extremely rare command-line arguments?
  context: Attackers may use approved parent-child process pairs but with malicious command-line arguments. This question establishes a baseline of normal command-line usage for these pairs. An alert is triggered if a never-before-seen command is used, or if PowerShell command-line entropy is unusually high, indicating obfuscation. This helps detect attacks that try to blend in by using otherwise legitimate process chains.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 4104
  - Windows Event ID 4103
  - Windows Event ID 4624
  - Engineering Workstations, Human-Machine Interfaces (HMIs), Operator Consoles, Jump Servers within the OT network, Data Historians
  range: last 90 days
  queries:
  - pseudocode: BASELINE parent-child pairs and command-line tokens over 60 days | ALERT on new/unseen parent-child pair involving doc handler and LOLBAS | For powershell.exe, ALERT if command-line entropy > 98th_percentile OR an argument token is < 1st_percentile frequency.
- question: Has a graph-based or sequence-based anomaly detection model flagged a process execution chain originating from a document handler as anomalous?
  context: This question uses advanced machine learning to understand the entire sequence or tree of process executions, rather than just isolated parent-child pairs. Models like RNNs or graph algorithms can learn the normal flow of operations and detect when a process chain deviates significantly, such as when Word spawns PowerShell which then spawns another suspicious process. This provides a high-fidelity signal of complex attack behavior.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 4104
  - Windows Event ID 4103
  - Windows Event ID 4624
  - Engineering Workstations, Human-Machine Interfaces (HMIs), Operator Consoles, Jump Servers within the OT network, Data Historians
  range: last 90 days
  queries:
  - pseudocode: APPLY process_graph_model (RNN/Graph) to process execution sequences | FEATURES include process_names, parent_names, paths, cmd_args | ALERT if sequence from a document_handler has anomaly_score > 0.9.
- question: Has a suspicious process, spawned via user execution, initiated a network connection to a destination known to be malicious or exhibiting suspicious characteristics?
  context: After successful initial execution, malware often needs to 'call home' to a command-and-control (C2) server. This question seeks to identify this C2 communication by linking a suspicious process on the endpoint with its network activity. Red flags include connections to IPs on threat intel lists, domains using self-signed certificates, or traffic matching TLS fingerprints (JA3/JA3S) of known malware tools.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 5156
  - Zeek conn.log
  - Zeek dns.log
  - Zeek ssl.log
  - Zeek x509.log
  - Engineering Workstations, HMIs, OT Network Egress Firewalls, Industrial Demilitarized Zone (IDMZ) Firewalls, Corporate-to-OT DMZ
  range: last 90 days
  queries:
  - pseudocode: JOIN suspicious_process_events (WinEvent:4688) with network_connection_events (WinEvent:5156, Zeek) on ProcessID | CHECK destination_ip, domain, tls_sni, ja3_hash against threat_intel_feeds | ALERT if match OR if ssl_log shows 'self-signed' cert.
- question: Is a suspicious process exhibiting network behavior indicative of C2 beaconing, such as highly regular connection intervals or unusual data transfer patterns?
  context: Command-and-control (C2) traffic is often automated and periodic, creating a regular 'heartbeat' as the malware checks in for instructions. This question looks for such patterns by analyzing the timing between connections to the same destination. A very low variance in these time intervals is a strong sign of beaconing. Additionally, unusual data ratios (e.g., small requests followed by large responses) can also indicate C2 activity.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 5156
  - Zeek conn.log
  - Zeek dns.log
  - Zeek ssl.log
  - Zeek x509.log
  - Engineering Workstations, HMIs, OT Network Egress Firewalls, Industrial Demilitarized Zone (IDMZ) Firewalls, Corporate-to-OT DMZ
  range: last 90 days
  queries:
  - pseudocode: For connections from suspicious processes to a single destination | CALCULATE variance of inter-arrival times | ALERT if variance is near-zero | BASELINE outbound/inbound byte ratios per host | ALERT if ratio > 98th_percentile.