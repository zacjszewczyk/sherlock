name: T1568: Dynamic Resolution
id: c1d5b3f8-a2e4-4b9c-8d7e-6f0a1b2c3d4e
description: This playbook helps investigate whether an adversary is using dynamic resolution for Command and Control. Adversaries may use this technique to periodically change the IP address or domain name of their C2 server to evade detection and blocking. This can manifest as communication with known DGA or fast-flux C2 indicators, DNS responses with unusually high answer counts or low TTLs, use of DNS over HTTPS (DoH) to conceal C2 communications, DNS queries for domains with algorithmically generated characteristics, rapid resolution of a single domain to many IPs (client-side fast-flux), deriving C2 IPs from content on legitimate web services, or a spike in queries for newly registered domains.
type: technique
related:
  - TA0011: Command and Control
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Are internal hosts communicating with domains or IPs known to be associated with DGA or fast-flux C2 infrastructure?
    context: This question aims to detect direct communication with known malicious infrastructure. By comparing outbound DNS queries and network connections against a high-confidence threat intelligence feed, we can identify compromised hosts in real-time. A match indicates a high probability of C2 activity and should be treated as a critical alert requiring immediate investigation.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - Windows Event ID 4688
      - Windows Event ID 5156
      - Egress network gateways, internal DNS resolvers, and integrated Threat Intelligence Platforms
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: FOR each DNS query OR network connection, LOOKUP domain/IP IN threat_intel_feed. IF match, ALERT.
  - question: Is there a statistically significant increase in the number of internal hosts communicating with known DGA domains?
    context: This question helps identify a widespread campaign or outbreak. A sudden spike in the number of unique internal systems attempting to contact known DGA domains, compared to a historical baseline, suggests that multiple hosts may have been compromised simultaneously. This is a strong indicator of a coordinated attack launch.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - Windows Event ID 4688
      - Windows Event ID 5156
      - Egress network gateways, internal DNS resolvers, and integrated Threat Intelligence Platforms
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: CALCULATE daily_unique_hosts_contacting_DGA_feed. IF daily_count > (90_day_avg + 3 * 90_day_stddev), ALERT.
  - question: Can we proactively identify previously unknown DGA domains by using a machine learning model?
    context: This question addresses the challenge of zero-day DGAs that are not yet present in threat intelligence feeds. By training a classification model on the structural and linguistic features of known malicious and benign domains, we can score and classify newly observed domains in real-time. This allows for proactive detection of potential C2 infrastructure.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - Windows Event ID 4688
      - Windows Event ID 5156
      - Egress network gateways, internal DNS resolvers, and integrated Threat Intelligence Platforms
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: FOR each new_domain, EXTRACT features (length, entropy, etc.). APPLY classification_model. IF score > threshold, FLAG as potential_DGA.
  - question: Are we observing DNS responses with characteristics of fast-flux DNS, such as very low TTLs and a high number of IP addresses?
    context: This question seeks to identify fast-flux DNS, a technique used to rapidly change the IP addresses associated with a domain. By flagging DNS responses with a Time-To-Live (TTL) below a certain threshold (e.g., 300 seconds) and a high count of unique IP addresses in the answer (e.g., >5), we can detect potential C2 domains. Tuning these static thresholds to the network's baseline is crucial for accuracy.
    answer_sources:
      - Zeek dns.log
      - Internal DNS resolvers, Recursive DNS servers, Egress network gateways
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: FOR each DNS response, IF TTL < 300 AND count(answers) > 5, ALERT.
  - question: Are there domains exhibiting statistically anomalous TTL values or answer counts compared to their own historical behavior?
    context: This question provides a more dynamic approach to detecting fast-flux than static thresholds. By calculating a historical baseline (e.g., 30-day rolling average and standard deviation) for the TTL and answer count for each domain, we can alert when a new DNS response deviates significantly (e.g., 3 standard deviations) from its norm. This helps detect when a previously benign domain becomes part of a fast-flux network.
    answer_sources:
      - Zeek dns.log
      - Internal DNS resolvers, Recursive DNS servers, Egress network gateways
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: FOR each domain, CALCULATE historical_mean_and_stddev(TTL, answer_count). IF new_response > (mean + 3*stddev), ALERT.
  - question: Are domains resolving to an abnormally diverse and geographically dispersed set of IP addresses?
    context: This question aims to identify sophisticated fast-flux networks by analyzing the characteristics of the resolved IP addresses over time. By clustering the IP addresses based on their Autonomous System Number (ASN) and geolocation, we can identify domains that resolve to an unusually disparate set of networks and locations, which is a strong indicator of a resilient C2 infrastructure.
    answer_sources:
      - Zeek dns.log
      - Internal DNS resolvers, Recursive DNS servers, Egress network gateways
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: FOR each domain, CLUSTER resolved_IPs by ASN/geolocation. IF clusters are abnormally diverse, ALERT.
  - question: Are internal hosts using DNS over HTTPS (DoH) in a manner that violates corporate policy or warrants heightened monitoring?
    context: This question focuses on identifying the use of encrypted DNS, which can be used by adversaries to hide C2 communications. By maintaining a list of known public DoH resolvers and monitoring for TLS connections to them, security teams can either block this traffic if it's against policy or flag the originating hosts for closer inspection of their subsequent network activity.
    answer_sources:
      - Zeek conn.log
      - Zeek ssl.log
      - Windows Event ID 4688
      - Windows Event ID 5156
      - Egress network gateways/firewalls, Endpoint devices, Web proxies
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: MAINTAIN list of DoH_resolvers. IF internal_host connects to DoH_resolver, ALERT or FLAG for monitoring.
  - question: For hosts using DoH, is their subsequent network activity indicative of C2 beaconing?
    context: This question helps to determine if DoH usage is malicious by analyzing the characteristics of the traffic that follows. C2 beaconing often exhibits regular, periodic connections with small data payloads. By analyzing the time between connections (inter-arrival time) and data volume for a host after a DoH session, we can identify statistically regular patterns that are highly suggestive of automated C2 communication.
    answer_sources:
      - Zeek conn.log
      - Zeek ssl.log
      - Windows Event ID 4688
      - Windows Event ID 5156
      - Egress network gateways/firewalls, Endpoint devices, Web proxies
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: FOR DoH_user_host, ANALYZE subsequent connections. IF inter-arrival_time_stddev is low AND data_volume is low, FLAG as beaconing.
  - question: Can we use time-series forecasting to predict and identify C2 beaconing behavior following a DoH session?
    context: This is an advanced technique to confirm C2 beaconing. By modeling the sequence of outbound connection events from a host as a time series, we can use a forecasting model like ARIMA to predict the timing and size of the next connection. If the model can accurately predict a periodic, small connection, it provides strong, quantifiable evidence of a C2 beacon.
    answer_sources:
      - Zeek conn.log
      - Zeek ssl.log
      - Windows Event ID 4688
      - Windows Event ID 5156
      - Egress network gateways/firewalls, Endpoint devices, Web proxies
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: FOR DoH_user_host, MODEL outbound_connections as time_series. USE forecasting_model to predict next connection. IF prediction is accurate and periodic, CONFIRM beaconing.
  - question: Is any single host generating an excessive number of NXDOMAIN (non-existent domain) responses?
    context: This question helps detect a common side effect of Domain Generation Algorithms (DGAs). When a DGA-infected host tries to contact its C2, it may cycle through a long list of algorithmically generated domains, many of which are not yet registered, resulting in a high volume of NXDOMAIN errors. Alerting on a host that generates an abnormally high count of these errors (e.g., >100 in 5 minutes) can be an effective way to find infected systems.
    answer_sources:
      - Zeek dns.log
      - Internal DNS resolvers, Egress network gateways/firewalls
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: COUNT NXDOMAIN responses per source_host in 5_min_window. IF count > 100, ALERT.
  - question: Are we observing DNS queries for domains with unusually high Shannon entropy?
    context: This question uses a statistical property of DGA-generated domains. Because they are often random-looking strings, they tend to have higher information entropy than human-readable, legitimate domains. By calculating the Shannon entropy for each queried domain and comparing it to a baseline of normal traffic, we can flag domains that are statistical outliers (e.g., in the 99th percentile) as likely being algorithmically generated.
    answer_sources:
      - Zeek dns.log
      - Internal DNS resolvers, Egress network gateways/firewalls
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: FOR each domain_query, CALCULATE shannon_entropy. IF entropy > 99th_percentile_baseline, ALERT.
  - question: Can we use a machine learning model to classify domains as DGA-generated based on their linguistic and structural features?
    context: This question proposes a more sophisticated method for detecting DGAs. A machine learning model (e.g., Random Forest) can be trained on a variety of features like domain length, entropy, vowel-to-consonant ratio, and n-gram probability scores. This allows the model to learn the complex patterns that distinguish DGA domains from legitimate ones, enabling the classification of new, previously unseen domains.
    answer_sources:
      - Zeek dns.log
      - Internal DNS resolvers, Egress network gateways/firewalls
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: TRAIN classifier on features (length, entropy, n-grams). APPLY model to new domains. IF classified as DGA, ALERT.
  - question: Is any internal host rapidly resolving the same domain name to many different IP addresses in a short time?
    context: This question targets client-side fast-flux, where the compromised client itself is responsible for rapidly cycling through a list of IPs for a single C2 domain. A simple rule can detect this by triggering an alert when a single host resolves one domain name to a high number of unique IP addresses (e.g., >10) within a short window (e.g., 5 minutes).
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - Windows Event ID 4688
      - Endpoint devices, Internal DNS resolvers
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: FOR each host/domain pair, IF unique_IP_count > 10 in 5_min_window, ALERT.
  - question: Are there host-domain pairs that exhibit abnormally high IP address churn?
    context: This question uses entropy to identify client-side fast-flux. By grouping DNS logs by the source host and the domain they are querying, we can calculate the entropy of the set of resolved IP addresses over a given window (e.g., 1 hour). A host-domain pair with an entropy value in the top percentile indicates that the host is resolving that domain to a highly varied and unpredictable set of IPs, which is a strong sign of fast-flux activity.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - Windows Event ID 4688
      - Endpoint devices, Internal DNS resolvers
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: GROUP DNS logs by host/domain. CALCULATE entropy of resolved_IP_set. IF entropy is in top 1%, ALERT.
  - question: Can we identify fast-flux activity by modeling host-domain-IP relationships as a graph?
    context: This question applies graph analysis to detect fast-flux. By creating a tripartite graph of (host, domain, IP), we can use network analysis algorithms to find anomalies. Hosts involved in fast-flux will appear as central hubs in the graph, connecting a single domain to an unusually large and diverse community of IP addresses. This stands out from normal browsing behavior where a host typically resolves a domain to a small, stable set of IPs.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - Windows Event ID 4688
      - Endpoint devices, Internal DNS resolvers
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: CREATE tripartite graph of (host, domain, IP). FIND hosts with high centrality connecting one domain to many IPs.
  - question: Is a host making an unusual outbound connection immediately after visiting a legitimate web service known to be abused for C2?
    context: This question addresses the DNS Calculation technique, where malware retrieves its C2 IP from content hidden on legitimate sites (e.g., GitHub, Pastebin). A detection rule can be created to monitor for visits to these known-abused services and alert if the host initiates a connection to an IP not associated with that service within a very short timeframe (e.g., <5 seconds).
    answer_sources:
      - Zeek http.log
      - Zeek ssl.log
      - Zeek conn.log
      - Windows Event ID 4688
      - Egress network gateways/firewalls, Web proxies, Endpoint devices
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: IF host visits abused_service AND then connects to unrelated_IP within 5s, ALERT.
  - question: Does a host show a pattern of periodic, short-latency connections to external IPs after visiting abused web services?
    context: This question looks for statistical evidence of a scripted DNS Calculation C2 mechanism. By calculating the time difference (delta) between a visit to an abused service and a subsequent non-HTTP/S connection, we can identify patterns. If these deltas are consistently low and occur at regular intervals, it strongly suggests an automated process where the malware fetches its C2 IP and immediately beacons to it.
    answer_sources:
      - Zeek http.log
      - Zeek ssl.log
      - Zeek conn.log
      - Windows Event ID 4688
      - Egress network gateways/firewalls, Web proxies, Endpoint devices
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: CALCULATE time_delta between visit_to_abused_service and subsequent_connection. IF delta is consistently low and periodic, FLAG.
  - question: Are there user sessions that contain the rare event sequence of visiting an abused service followed immediately by a non-standard outbound connection?
    context: This question uses sequence analysis to model and detect anomalous user behavior. Normal browsing has predictable patterns. The specific sequence of events [Visit Abused Service -> Initiate non-standard outbound connection] is rare in normal activity. By modeling typical user sessions, we can flag sessions containing this rare event chain as highly suspicious and worthy of investigation.
    answer_sources:
      - Zeek http.log
      - Zeek ssl.log
      - Zeek conn.log
      - Windows Event ID 4688
      - Egress network gateways/firewalls, Web proxies, Endpoint devices
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: MODEL typical user browsing sequences. FLAG sessions containing the sequence [Visit Abused Service -> Non-standard outbound connection].
  - question: Are internal hosts querying for domains that were registered very recently?
    context: This question targets the use of Newly Registered Domains (NRDs) for C2 infrastructure. Adversaries often use NRDs because they have no prior reputation. By enriching DNS logs with WHOIS or passive DNS data, we can create a simple but effective rule to alert on any query for a domain registered within a short period (e.g., the last 7 days), as this is a high-risk indicator.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - Internal DNS resolvers, Egress network gateways, Threat Intelligence Platforms, Passive DNS databases
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: ENRICH DNS logs with domain_registration_date. IF registration_date < 7 days ago, ALERT.
  - question: Is there a statistically anomalous spike in the volume of queries for Newly Registered Domains (NRDs)?
    context: This question looks for campaign-level activity involving NRDs. Instead of looking at individual queries, it monitors the aggregate volume of queries to NRDs (e.g., registered < 30 days ago). By establishing a baseline and using statistical process control, we can detect when the hourly or daily count of NRD queries exceeds a significant threshold (e.g., 3 standard deviations above the mean), indicating a potential widespread attack.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - Internal DNS resolvers, Egress network gateways, Threat Intelligence Platforms, Passive DNS databases
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: ESTABLISH baseline for NRD_query_volume. IF current_volume > (mean + 3*stddev), ALERT.
  - question: Can we create a reputation score for domains to identify high-risk C2 infrastructure?
    context: This question proposes building a comprehensive domain reputation model. By combining multiple features—such as registration age, global query prevalence (from passive DNS), the reputation of its hosting ASN, and linguistic properties like entropy—we can develop a score. Domains that receive a low reputation score can be classified as high-risk, and any associated network connections should be prioritized for investigation.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - Internal DNS resolvers, Egress network gateways, Threat Intelligence Platforms, Passive DNS databases
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: SCORE domains based on (age, prevalence, ASN_rep, entropy). INVESTIGATE connections to low-score domains.