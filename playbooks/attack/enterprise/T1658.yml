name: "T1658: Exploitation for Client Execution"
id: "a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d"
description: >-
  This playbook helps determine if an adversary is exploiting client application vulnerabilities to achieve code execution on managed mobile devices. It focuses on detecting indicators such as mobile applications spawning shell processes or connecting to malicious domains, statistically significant increases in application or OS crashes correlated with the installation of non-sanctioned applications, and anomalous peer-to-peer (P2P) traffic that may precede a system compromise.
type: "technique"
related:
  - "TA0041: Execution"
contributors:
  - "Zachary Szewczyk"
  - "Ask Sage"
created: "2025-10-01"
modified: "2025-10-01"
version: 1.0
tags: "none"
questions:
  - question: "Is a mobile device querying known malicious or newly registered domains?"
    context: >-
      This question aims to detect the initial network reconnaissance or command-and-control (C2) communication stage of an exploit. Adversaries often use malicious or recently created domains to host exploit kits or C2 servers. Correlating DNS queries with established connections helps confirm successful communication, which is a strong indicator of compromise following a client-side exploit.
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Mobile EDR/MDM process logs"
      - "Mobile OS crash logs"
      - "Corporate Wi-Fi network gateways"
      - "Cloud-based mobile security gateways"
      - "Mobile Device Management (MDM) servers"
      - "Endpoint mobile devices"
    range: "Last 90 days"
    queries:
      - "SEARCH Zeek dns.log WHERE source_ip IN mobile_ip_range AND query IN (threat_intel_domains OR newly_registered_domains). CORRELATE source_ip, timestamp with Zeek conn.log WHERE dest_ip = resolved_ip."
  - question: "Has a mobile application spawned a rare or never-before-seen child process, or has it made a DNS query with unusually high entropy?"
    context: >-
      Exploited applications may spawn shell processes or command-line tools to execute further commands. Baselining normal process relationships helps identify these anomalous activities. Simultaneously, high-entropy (random-looking) domain names are a common characteristic of Domain Generation Algorithms (DGAs) used by malware for C2 communication, making them a key indicator of compromise.
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Zeek http.log"
      - "Mobile EDR/MDM process logs"
      - "Mobile OS crash logs"
      - "Corporate Wi-Fi network gateways"
      - "Cloud-based mobile security gateways"
      - "Mobile Device Management (MDM) servers"
      - "Endpoint mobile devices"
    range: "Last 90 days"
    queries:
      - "SEARCH MDM process_logs, GROUP BY parent_process, child_process. CALCULATE frequency. ALERT IF frequency < 1st_percentile. SEARCH Zeek dns.log, CALCULATE shannon_entropy(query). ALERT IF entropy > 3.5 AND query NOT IN allow_list."
  - question: "Does a network connection from a mobile device exhibit features characteristic of malicious activity?"
    context: >-
      This question leverages machine learning to proactively identify suspicious network traffic that might be missed by signature-based rules. By analyzing a combination of features like DNS query structure, connection duration, and data volume, a model can learn the subtle patterns of malicious C2 communication versus benign traffic, allowing for the detection of novel threats.
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Zeek http.log"
      - "Mobile EDR/MDM process logs"
      - "Mobile OS crash logs"
      - "Corporate Wi-Fi network gateways"
      - "Cloud-based mobile security gateways"
      - "Mobile Device Management (MDM) servers"
      - "Endpoint mobile devices"
    range: "Last 90 days"
    queries:
      - "INPUT Zeek conn.log, dns.log features (query_length, entropy, TLD, port, duration, bytes) INTO classification_model. ALERT IF model_output = 'malicious' AND confidence > 0.90."
  - question: "Was a non-sanctioned application or configuration profile installed shortly before an application or OS crash occurred?"
    context: >-
      Adversaries may trick users into installing malicious applications or profiles that exploit vulnerabilities, leading to system instability or crashes. Correlating an unauthorized installation with subsequent crashes within a short time window is a strong indicator of an attempted or successful exploitation attempt.
    answer_sources:
      - "Mobile OS crash logs"
      - "Mobile Device Management (MDM) application inventory logs"
      - "Mobile Device Management (MDM) configuration profile logs"
      - "Zeek conn.log"
      - "Mobile Device Management (MDM) servers"
      - "Endpoint mobile devices"
      - "Corporate Wi-Fi network gateways"
    range: "Last 90 days"
    queries:
      - "SEARCH MDM logs FOR app_install OR profile_update. IF app_bundle_id NOT IN allow_list, ALERT. ENRICH alert with crash_logs from same device WHERE event_time < install_time + 60_minutes."
  - question: "Is a mobile device experiencing an abnormally high crash rate compared to its peers, and does this coincide with unusual network data exfiltration patterns?"
    context: >-
      A sudden spike in crashes on a single device, when compared to a baseline of similar devices, can signal a targeted exploit attempt. If this instability is followed by a significant increase in outbound data traffic, it could indicate that the exploit was successful and the attacker is now exfiltrating data from the compromised device.
    answer_sources:
      - "Mobile OS crash logs"
      - "Mobile Device Management (MDM) application inventory logs"
      - "Mobile Device Management (MDM) configuration profile logs"
      - "Zeek conn.log"
      - "Mobile Device Management (MDM) servers"
      - "Endpoint mobile devices"
      - "Corporate Wi-Fi network gateways"
    range: "Last 90 days"
    queries:
      - "CALCULATE hourly_crash_rate per device_cohort. ALERT IF device_crash_count > 3 * stdev(cohort_mean). ESCALATE IF outbound_byte_ratio > 98th_percentile(device_history) within 15 minutes."
  - question: "Is there a fleet-wide, anomalous spike in critical crashes, or are there outlier applications with suspicious characteristics present on devices?"
    context: >-
      This question addresses two potential attack vectors. A time-series model can detect a widespread campaign exploiting a zero-day vulnerability affecting many devices simultaneously. In parallel, unsupervised clustering can identify trojanized or sideloaded applications by finding those that don't fit in with legitimate apps, based on permissions, signing certificates, and other metadata.
    answer_sources:
      - "Mobile OS crash logs"
      - "Mobile Device Management (MDM) application inventory logs"
      - "Mobile Device Management (MDM) configuration profile logs"
      - "Zeek conn.log"
      - "Mobile Device Management (MDM) servers"
      - "Endpoint mobile devices"
      - "Corporate Wi-Fi network gateways"
    range: "Last 90 days"
    queries:
      - "INPUT fleet_wide_crash_rate INTO time_series_model. ALERT on anomaly. INPUT MDM app_inventory features (permissions, certificate, name) INTO clustering_model. ALERT on outliers."
  - question: "Is there any Apple Wireless Direct Link (AWDL) or other peer-to-peer traffic occurring over corporate wireless segments?"
    context: >-
      P2P protocols like AWDL can be abused by attackers for proximity-based, zero-click exploits. Such traffic is often against corporate policy on enterprise networks. Detecting any instance of this traffic, especially if it cannot be correlated with legitimate user activity like AirDrop, is a high-fidelity indicator of a potential attack.
    answer_sources:
      - "Zeek conn.log"
      - "Zeek notice.log"
      - "Mobile OS crash logs"
      - "Mobile EDR/MDM process logs"
      - "Corporate Wi-Fi network gateways"
      - "Endpoint mobile devices"
    range: "Last 90 days"
    queries:
      - "SEARCH Zeek conn.log WHERE source_ip or dest_ip in 'fe80::/10' AND network_segment = 'corporate_wifi'. ALERT. CORRELATE with MDM logs to exclude legitimate AirDrop."
  - question: "Is a device exhibiting an anomalous amount of peer-to-peer traffic, and does this anomaly coincide with a system crash?"
    context: >-
      In environments where some P2P traffic is expected, this question focuses on detecting unusual spikes in activity. A sudden, significant increase in P2P connections or data volume for a specific device, especially when temporally linked to a system crash, strongly suggests that a P2P-based exploit was triggered, causing instability.
    answer_sources:
      - "Zeek conn.log"
      - "Zeek notice.log"
      - "Mobile OS crash logs"
      - "Mobile EDR/MDM process logs"
      - "Corporate Wi-Fi network gateways"
      - "Endpoint mobile devices"
    range: "Last 90 days"
    queries:
      - "CALCULATE hourly P2P traffic baseline per device. ALERT IF current_hour_P2P_traffic > 99th_percentile(baseline). INCREASE risk IF crash_log event occurs within 5 minutes."
  - question: "Are there any anomalous device-to-device connections on the wireless network that deviate from normal communication patterns?"
    context: >-
      This question uses machine learning to identify novel or stealthy P2P exploit techniques that might not use known protocols like AWDL. By modeling normal intra-WLAN communication based on features like ports, protocols, and data volumes, an unsupervised model can flag any connection that stands out as a statistical anomaly, which could represent a zero-click exploit attempt.
    answer_sources:
      - "Zeek conn.log"
      - "Zeek notice.log"
      - "Mobile OS crash logs"
      - "Mobile EDR/MDM process logs"
      - "Corporate Wi-Fi network gateways"
      - "Endpoint mobile devices"
    range: "Last 90 days"
    queries:
      - "INPUT intra-WLAN Zeek conn.log features (protocol, port, duration, bytes) INTO unsupervised_anomaly_model (e.g., Isolation Forest). ALERT on high anomaly score."