name: T1567.003: Exfiltration to Text Storage Sites
id: 86a7d9b4-3a5c-4e8f-9b1d-2c3f4a5b6c7d
description: This playbook helps identify if an adversary has exfiltrated data by uploading it to public or private text storage sites. It provides investigative questions to detect this activity through various means, including direct network connections to known sites (especially HTTP POSTs), command-line usage of tools like cURL or PowerShell to upload data, anomalous data upload volumes from a host, network connections initiated by non-browser processes, and correlated events where a process accesses sensitive data shortly before connecting to a text storage site.
type: technique
related:
  - TA0010: Exfiltration
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Are there any outbound network connections to known text storage sites, particularly HTTP POST requests?
    context: This question uses a signature-based approach to detect potential exfiltration. By maintaining a threat intelligence list of known text storage site domains, IPs, and certificates, analysts can create high-fidelity alerts. An alert is triggered when a network connection's destination matches an entry on this list. The presence of an HTTP 'POST' method strongly suggests a data upload, increasing the suspicion level. This is a direct method for identifying attempts to send data to sites like Pastebin or similar services.
    answer_sources:
      - Zeek conn.log
      - Zeek http.log
      - Zeek ssl.log
      - Network Egress Points
      - DNS Servers
      - Web Proxies
      - SIEM/Log Aggregator
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          DEFINE text_storage_sites AS a list of known hostnames, IPs, and cert subjects.
          SEARCH network_logs (Zeek conn, http, ssl)
          WHERE (destination_host IN text_storage_sites OR destination_ip IN text_storage_sites OR server_name IN text_storage_sites)
          AND http_method == 'POST'
          ALERT on each finding.
  - question: Has any host uploaded an anomalously large amount of data to a known text storage site compared to its own baseline?
    context: This question aims to detect exfiltration by identifying unusual data volumes. Adversaries might use legitimate-seeming connections to exfiltrate large files. By establishing a 30-day baseline of normal outbound data transfer sizes (`orig_bytes`) for each host, we can spot outliers. An alert is triggered if a connection to a known text storage site involves an upload size that exceeds the 99th percentile of that host's typical behavior, flagging a statistically significant and suspicious event.
    answer_sources:
      - Zeek conn.log
      - Zeek http.log
      - Zeek ssl.log
      - Network Egress Points
      - DNS Servers
      - Web Proxies
      - SIEM/Log Aggregator
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each source_host:
            CALCULATE 99th_percentile_upload_size from last 30 days of its network connections.
          SEARCH new network connections to known text storage sites.
          IF connection_upload_size > host's 99th_percentile_upload_size:
            ALERT on anomalous upload.
  - question: Can a machine learning model identify network connections that are likely malicious exfiltration attempts to text storage sites?
    context: This question leverages a machine learning classifier (e.g., a random forest) to distinguish between benign and malicious network activity. The model is trained on various features from network logs, such as bytes sent/received, connection duration, protocol, and whether the destination is a known text storage site. Once deployed, the model can score new connections in real-time, providing a probabilistic assessment of maliciousness that can be more nuanced and effective at finding novel threats than simple symbolic or statistical rules.
    answer_sources:
      - Zeek conn.log
      - Zeek http.log
      - Zeek ssl.log
      - Network Egress Points
      - DNS Servers
      - Web Proxies
      - SIEM/Log Aggregator
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          TRAIN a random forest classifier on labeled network connection data.
          Features: orig_bytes, resp_bytes, duration, proto, dest_port, http_method, is_known_text_site.
          DEPLOY model to score new connections in real-time.
          ALERT on connections with a high malicious probability score.
  - question: Is there any command-line activity showing tools like cURL or PowerShell being used to upload data to a text storage site?
    context: Adversaries often use command-line utilities for 'living off the land' attacks. This question looks for direct evidence of this by scanning process creation logs (Event ID 4688) and PowerShell script block logs (Event ID 4104). Using regular expressions, we can search for the co-occurrence of a command-line tool (`curl.exe`, `powershell.exe`, etc.), a flag indicating data upload (`-d`, `Invoke-RestMethod -Method Post`), and a URL belonging to a known text storage site. This provides strong evidence of an exfiltration attempt.
    answer_sources:
      - Windows Event ID 4688
      - Windows PowerShell Event ID 4104
      - User Workstations
      - Production Servers
      - Domain Controllers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          SEARCH process and script block logs.
          REGEX for process name in (`curl.exe`, `powershell.exe`, `wget.exe`)
          AND command arguments contain upload flags (`-d`, `-F`, `-Body`, `Invoke-RestMethod -Method Post`)
          AND command arguments contain a hostname from a list of text storage sites.
          ALERT on match.
  - question: Are there any command-line executions involving text storage site URLs that have an unusually high entropy?
    context: This question uses Shannon entropy to detect obfuscated or data-laden commands. Normal command-line strings have a relatively low, predictable entropy. When an attacker embeds encoded data (e.g., Base64) directly into a command, the string's randomness, and thus its entropy, increases significantly. By establishing a baseline entropy for common processes like PowerShell and cURL on each host, we can alert when a command involving a text storage site URL has an entropy score that is a statistical outlier (e.g., >3 standard deviations above the mean), suggesting hidden data or obfuscation.
    answer_sources:
      - Windows Event ID 4688
      - Windows PowerShell Event ID 4104
      - User Workstations
      - Production Servers
      - Domain Controllers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each host:
            CALCULATE baseline mean and std_dev of command-line entropy for powershell.exe, curl.exe.
          SEARCH for new command executions involving a text storage site URL.
          IF entropy(command_string) > (mean_entropy + 3 * std_dev):
            ALERT on high entropy command.
  - question: Can a machine learning model detect anomalous command-line invocations that may be attempting to exfiltrate data?
    context: This question applies anomaly detection to command-line activity. A one-class Support Vector Machine (SVM) or similar model is trained exclusively on benign command-line examples for common utilities like `powershell.exe` and `curl.exe`. The model learns the boundary of 'normal' behavior. When a new command is executed, the model determines if it falls outside this boundary. Any command identified as a significant outlier is flagged for review, with priority given to those containing URLs for text storage sites, as they represent a deviation from normal usage patterns.
    answer_sources:
      - Windows Event ID 4688
      - Windows PowerShell Event ID 4104
      - User Workstations
      - Production Servers
      - Domain Controllers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          TRAIN a One-Class SVM model on benign command-line invocations for powershell.exe and curl.exe.
          APPLY model to new process creation events.
          ALERT on any command flagged as an outlier, with high priority if it contains a text storage site URL.
  - question: Has any single host made an excessive number of connections to text storage sites or uploaded an excessive amount of data in a single connection?
    context: This question uses hard thresholds to catch blatant exfiltration activity. While less nuanced than statistical baselining, it can be effective for identifying high-volume or high-frequency attacks. The rule alerts if a host either makes more than a set number of connections (e.g., >10) to text storage sites in a short window (e.g., 1 hour) or uploads a large amount of data (e.g., >10MB) in a single session. These thresholds should be tuned to the specific environment to minimize false positives but can serve as a valuable tripwire.
    answer_sources:
      - Zeek conn.log
      - Zeek http.log
      - Network Egress Points
      - SIEM/Log Aggregator
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          SEARCH network logs for connections to text storage sites.
          ALERT IF count of connections from a single host > 10 within 1 hour.
          ALERT IF `orig_bytes` for a single connection > 10MB.
  - question: Has any host's daily data upload volume to text storage sites exceeded its normal statistical baseline?
    context: This question focuses on identifying anomalous behavior over a daily period. It establishes a 30-day rolling baseline of the total data volume each host sends to the category of text storage sites. Using a statistical method like the interquartile range (IQR), which is robust to outliers, we can define a 'normal' range of behavior. An alert is generated if a host's total upload volume for a day exceeds the upper bound of this normal range (e.g., Q3 + 1.5 * IQR), indicating a statistically significant and potentially malicious increase in activity.
    answer_sources:
      - Zeek conn.log
      - Zeek http.log
      - Network Egress Points
      - SIEM/Log Aggregator
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each host:
            CALCULATE 30-day rolling baseline of daily upload volume to text sites (Q1, Q3, IQR).
          FOR each day, for each host:
            IF daily_upload_volume > (Q3 + 1.5 * IQR):
              ALERT on anomalous daily volume.
  - question: Is the aggregate network traffic volume to text storage sites across the entire network deviating from its predicted normal pattern?
    context: This question takes a network-wide view to spot large-scale or coordinated exfiltration. It uses a time-series anomaly detection model (like ARIMA) to learn the normal 'rhythm' of traffic to text storage sites for the whole organization (e.g., higher during business hours, lower at night). The model continuously predicts the expected traffic volume and its confidence interval. An alert is triggered if the actual observed volume significantly deviates from this prediction, which could indicate a widespread attack or a single, massive exfiltration event.
    answer_sources:
      - Zeek conn.log
      - Zeek http.log
      - Network Egress Points
      - SIEM/Log Aggregator
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          TRAIN an ARIMA time-series model on hourly aggregate data volume to text storage sites.
          PREDICT expected volume and confidence interval for each hour.
          IF observed_volume is outside the confidence interval:
            ALERT on network-wide anomaly.
  - question: Is a non-browser process, such as PowerShell or svchost.exe, making network connections to a known text storage site?
    context: Legitimate user activity with text storage sites almost always originates from a web browser. This question identifies suspicious activity by looking for connections initiated by any process that is not on an approved list of browser executables (e.g., `chrome.exe`, `firefox.exe`). Sysmon Event ID 3 (Network Connection) provides the necessary process and destination details. An alert for a process like `powershell.exe` or `svchost.exe` connecting to Pastebin is a strong indicator of malicious, non-interactive exfiltration.
    answer_sources:
      - Windows Sysmon Event ID 3
      - Windows Sysmon Event ID 1
      - Zeek conn.log
      - User Workstations
      - Application Servers
      - SIEM for correlation
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          DEFINE approved_browsers AS a list of browser executables.
          SEARCH Sysmon Event ID 3 logs.
          WHERE DestinationHostname is a known text storage site.
          AND Image (process path) is NOT in approved_browsers.
          ALERT on non-browser connection.
  - question: Has a statistically rare pairing of a process and a connection to a text storage site occurred on any host?
    context: This question identifies anomalies by profiling which processes normally connect to which types of destinations on a per-host basis. Over a 30-day period, a baseline is built that captures the frequency of pairings like (`chrome.exe`, 'Social Media') or (`outlook.exe`, 'Email Server'). An alert is triggered when a very rare or never-before-seen pairing occurs, such as (`svchost.exe`, 'Text Storage Site'), if its observed frequency falls below a low percentile threshold. This method can uncover unusual process behavior that might be missed by signature-based rules.
    answer_sources:
      - Windows Sysmon Event ID 3
      - Windows Sysmon Event ID 1
      - Zeek conn.log
      - User Workstations
      - Application Servers
      - SIEM for correlation
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each host:
            PROFILE frequency of (process, destination_category) pairings over 30 days.
          SEARCH for new network connections.
          IF pairing of (process, 'Text Storage Site') has a frequency < 1st percentile for that host:
            ALERT on rare process-destination pairing.
  - question: Can a machine learning classifier predict whether a network connection to a text storage site is legitimate or suspicious based on its context?
    context: This question uses a supervised learning model (e.g., Logistic Regression) to classify the legitimacy of network connections. The model is trained on labeled data, using features like the initiating process (`Image`), the user, the destination port, and destination reputation. For example, connections from `chrome.exe` by an interactive user are labeled 'legitimate,' while connections from system services are 'suspicious.' The deployed model can then flag new connections with a high probability of being suspicious, providing a more intelligent and context-aware detection capability.
    answer_sources:
      - Windows Sysmon Event ID 3
      - Windows Sysmon Event ID 1
      - Zeek conn.log
      - User Workstations
      - Application Servers
      - SIEM for correlation
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          TRAIN a classifier on labeled Sysmon Event ID 3 data.
          Features: Image, User, DestinationPort, DestinationReputation.
          Label browser connections as 'legitimate', others as 'suspicious'.
          DEPLOY model to score new connections.
          ALERT on connections with high 'suspicious' probability.
  - question: Is there evidence of a process accessing a sensitive file and then immediately making a network connection to a text storage site?
    context: This question seeks to connect the dots in a classic data staging and exfiltration chain. It requires correlating multiple event sources in a SIEM. First, file access auditing (Windows Event ID 4663 or Sysmon Event ID 11) is enabled on sensitive data stores. A correlation rule is then built to look for a specific sequence: a process (identified by its `ProcessGuid`) accesses a sensitive file, and then the same process initiates a network connection (Sysmon Event ID 3) to a text storage site within a short time window (e.g., 5 minutes). A positive match is a very strong indicator of targeted data theft.
    answer_sources:
      - Windows Event ID 4663
      - Windows Sysmon Event ID 11
      - Windows Sysmon Event ID 1
      - Windows Sysmon Event ID 3
      - Zeek conn.log
      - File Servers
      - Databases
      - User Workstations with access to sensitive data
      - SIEM for correlation
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          CREATE SIEM correlation rule.
          TRIGGER on (Sysmon Event ID 11/Win Event 4663 for sensitive file) from ProcessGuid_X
          FOLLOWED BY (Sysmon Event ID 3 to text storage site) from ProcessGuid_X
          WITHIN 5 minutes.
          ALERT on sequence match.
  - question: Has a rare sequence of 'sensitive file access followed by text site connection' occurred, based on historical probabilities?
    context: This question adds a statistical lens to event sequence analysis. For processes that are observed accessing sensitive files, we can calculate the historical, conditional probability that they will then connect to a text storage site. For most legitimate processes, this probability will be extremely low or zero. An alert is triggered if this sequence occurs and its calculated probability is in the bottom 1st percentile of all observed sequential behaviors for that host or user, highlighting it as a statistically rare and therefore highly suspicious chain of events.
    answer_sources:
      - Windows Event ID 4663
      - Windows Sysmon Event ID 11
      - Windows Sysmon Event ID 1
      - Windows Sysmon Event ID 3
      - Zeek conn.log
      - File Servers
      - Databases
      - User Workstations with access to sensitive data
      - SIEM for correlation
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each host/user:
            CALCULATE historical P(Connect to Text Site | Access Sensitive File) for all processes.
          WHEN sequence occurs:
            IF its calculated probability is in the bottom 1st percentile of all behaviors:
              ALERT on rare event chain.
  - question: Can a sequence analysis model detect an anomalous chain of events culminating in a connection to a text storage site?
    context: This is the most advanced approach, using sequence analysis models like Hidden Markov Models (HMMs) or Recurrent Neural Networks (RNNs). These models are trained on vast amounts of endpoint event logs to learn the 'grammar' of normal user and system behavior (e.g., Word opens, accesses a document, connects to SharePoint). The model can then identify and alert on sequences that violate this learned grammar, such as a PowerShell script accessing a customer database and then connecting to Pastebin. This method is powerful for detecting novel attack patterns that don't match any predefined rules or signatures.
    answer_sources:
      - Windows Event ID 4663
      - Windows Sysmon Event ID 11
      - Windows Sysmon Event ID 1
      - Windows Sysmon Event ID 3
      - Zeek conn.log
      - File Servers
      - Databases
      - User Workstations with access to sensitive data
      - SIEM for correlation
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          TRAIN an HMM or RNN model on normal sequences of endpoint events.
          DEPLOY model to evaluate new event sequences in real-time.
          ALERT on sequences identified as anomalous, especially those that include:
          (Access sensitive data -> Connect to text storage site).