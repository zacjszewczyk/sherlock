name: T1608.004: Drive-by Target
id: 3c1a9f0e-7d6b-4c8a-9f1e-2b0c5d4a3b2c
description: This playbook addresses the threat of strategic web compromise (watering hole attacks) where an adversary stages malicious resources. It focuses on detecting user activity indicative of a drive-by compromise, such as connections to known malicious domains or IPs from threat intelligence, rapid automated redirection chains in browsing sessions, connections to newly registered domains, downloads of high-entropy or unusual files followed by process creation, and spikes in traffic to advertising networks followed by connections to suspicious domains.
type: technique
related:
  - TA0042: Resource Development
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Are any internal hosts connecting to domains or IP addresses known to be associated with drive-by-compromise, watering holes, or exploit kits?
    context: This question aims to identify direct communication with known malicious infrastructure. By cross-referencing outbound network logs (DNS, HTTP/S) with high-confidence threat intelligence feeds, analysts can detect initial compromise attempts from watering hole attacks. A match is a strong indicator of a host visiting a compromised or malicious site.
    answer_sources:
      - Zeek http.log
      - Zeek dns.log
      - Zeek conn.log
      - Enterprise DNS Resolvers
      - Egress Firewall/Proxy
      - Threat Intelligence Platform (TIP)
      - SIEM
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH outbound network logs (DNS, connection) WHERE destination_ip OR destination_domain IN threat_intel_watchlist. JOIN results and ALERT.
  - question: Which hosts are exhibiting an unusually high frequency of connections to known malicious domains or IPs over a 24-hour period?
    context: This question helps to identify hosts that may be persistently compromised or repeatedly attempting to access malicious sites, which might be missed by single-event alerts. By calculating a rolling 24-hour count of connections to watchlisted destinations and comparing it against a peer-group baseline (95th percentile), analysts can spot outlier behavior that suggests a more significant issue than a one-off connection.
    answer_sources:
      - Zeek http.log
      - Zeek dns.log
      - Zeek conn.log
      - Enterprise DNS Resolvers
      - Egress Firewall/Proxy
      - Threat Intelligence Platform (TIP)
      - SIEM
    range: last 90 days
    queries:
      - technology: pseudocode
        query: FOR each host, COUNT connections to threat_intel_watchlist over 24h. IDENTIFY hosts WHERE count > 95th_percentile_of_all_hosts.
  - question: Can outbound connections be automatically scored for risk to identify potential drive-by-compromise activity that doesn't rely solely on known IOCs?
    context: This question moves beyond simple blocklist matching to proactively identify suspicious connections. By using a machine learning model that considers multiple features (e.g., threat intel match, domain/ASN reputation, data volume, historical frequency), analysts can assign a risk score to every outbound connection. This allows for the detection of previously unknown or un-catalogued threats that exhibit characteristics of malicious infrastructure.
    answer_sources:
      - Zeek http.log
      - Zeek dns.log
      - Zeek conn.log
      - Enterprise DNS Resolvers
      - Egress Firewall/Proxy
      - Threat Intelligence Platform (TIP)
      - SIEM
    range: last 90 days
    queries:
      - technology: pseudocode
        query: FOR each outbound connection, CALCULATE risk_score using features (threat_intel_match, domain_reputation, ASN_reputation, data_volume, connection_frequency). ALERT on high scores.
  - question: Are any user browsing sessions being rapidly redirected through a chain of domains that includes known malicious redirectors or ad networks?
    context: Adversaries often use a series of rapid redirections to obscure the final payload's origin. This question seeks to identify these redirection chains by reconstructing browsing sessions from network logs (using source IP, user-agent, and Referer headers). Detecting a chain that includes a known malicious redirector is a strong indicator of a drive-by or malvertising attack in progress.
    answer_sources:
      - Zeek http.log
      - Zeek dns.log
      - Zeek conn.log
      - Enterprise Web Proxy
      - Network Security Monitoring (NSM) sensors
      - DNS Resolvers
      - Endpoint Browsers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: RECONSTRUCT browsing sessions by correlating logs on source_ip, user_agent, and referer_header. ALERT if any domain in the chain is on a malicious_redirector_list.
  - question: Are there any browsing sessions exhibiting statistically anomalous redirection behavior, such as unusually long or fast chains of domains?
    context: This question aims to find suspicious redirection chains without relying on known malicious indicators. By baselining normal browsing behavior (redirection length and speed), analysts can flag outliers that exceed a high percentile (e.g., 99th). This statistical approach can uncover novel attack chains. Further suspicion is warranted if the domains in the chain have low similarity to common, legitimate domains.
    answer_sources:
      - Zeek http.log
      - Zeek dns.log
      - Zeek conn.log
      - Enterprise Web Proxy
      - Network Security Monitoring (NSM) sensors
      - DNS Resolvers
      - Endpoint Browsers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: CALCULATE redirection chain length and speed for all sessions. FLAG sessions where length or speed > 99th_percentile. Additionally, FLAG if Jaccard similarity to legitimate domains is low.
  - question: Can we identify groups of anomalous browsing sessions by clustering them based on features like redirection length, duration, and destination domain age?
    context: This question uses unsupervised machine learning to discover suspicious browsing patterns. By clustering sessions based on a set of features (chain length, duration, unique ASNs, domain age, etc.), analysts can isolate groups of sessions that represent atypical or malicious behavior. These outlier clusters, which don't group with normal browsing, warrant a deeper investigation.
    answer_sources:
      - Zeek http.log
      - Zeek dns.log
      - Zeek conn.log
      - Enterprise Web Proxy
      - Network Security Monitoring (NSM) sensors
      - DNS Resolvers
      - Endpoint Browsers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: CLUSTER browsing sessions using features (chain_length, duration, unique_asns, domain_age). INVESTIGATE outlier clusters.
  - question: Are any internal hosts connecting to newly registered domains (NRDs) that may have been created for malicious purposes?
    context: Adversaries frequently use newly registered domains for their campaigns, as these domains have no prior reputation. This question aims to detect connections to these NRDs by matching outbound network traffic against a dedicated NRD feed. The risk is considered higher, and alerts should be prioritized, if the domain also uses privacy protection services or was registered very recently (e.g., within the last week).
    answer_sources:
      - Zeek dns.log
      - Zeek http.log
      - Zeek conn.log
      - WHOIS Lookup Data
      - Passive DNS Data
      - Internal DNS Resolvers
      - Enterprise Web Proxy
      - Threat Intelligence Platforms (for NRD and WHOIS feeds)
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH for any network connection to a domain in the NRD_watchlist. ESCALATE alert if WHOIS is private or domain age < 7 days.
  - question: Are any users visiting domains whose age is a statistical outlier compared to the enterprise baseline, or are specific hosts visiting NRDs at an anomalous rate?
    context: This question seeks to identify suspicious NRD activity through statistical analysis. It involves two checks: first, identifying any connection to a domain whose age is extremely low (e.g., bottom 1st percentile) compared to all domains visited across the organization. Second, monitoring individual hosts for a spike in their rate of NRD visits compared to their own historical behavior. Both can indicate a targeted user or a compromised host.
    answer_sources:
      - Zeek dns.log
      - Zeek http.log
      - Zeek conn.log
      - WHOIS Lookup Data
      - Passive DNS Data
      - Internal DNS Resolvers
      - Enterprise Web Proxy
      - Threat Intelligence Platforms (for NRD and WHOIS feeds)
    range: last 90 days
    queries:
      - technology: pseudocode
        query: BASELINE domain ages visited. ALERT on visits to domains in the 1st percentile. SEPARATELY, for each host, ALERT if the rate of NRD visits > 3 standard deviations from its baseline.
  - question: Is there a sudden, anomalous spike in the overall number of newly registered domains being visited across the entire enterprise?
    context: This question aims to detect a widespread campaign affecting multiple users simultaneously. By applying a time series forecasting model to the hourly count of NRD visits, analysts can identify significant deviations from the expected pattern. An observed count that drastically exceeds the forecast's confidence interval suggests a coordinated attack and requires immediate investigation to identify the contributing hosts.
    answer_sources:
      - Zeek dns.log
      - Zeek http.log
      - Zeek conn.log
      - WHOIS Lookup Data
      - Passive DNS Data
      - Internal DNS Resolvers
      - Enterprise Web Proxy
      - Threat Intelligence Platforms (for NRD and WHOIS feeds)
    range: last 90 days
    queries:
      - technology: pseudocode
        query: FORECAST hourly NRD visit counts. ALERT if the observed count significantly exceeds the forecast's upper confidence bound. IDENTIFY hosts contributing to the spike.
  - question: Has a file been downloaded that matches signatures for obfuscation or exploit kits, and was it immediately followed by a new process execution on the host?
    context: This question looks for the classic drive-by download and execution sequence. It involves scanning all downloaded files with YARA rules designed to detect malware and then correlating a positive match with a subsequent process creation event originating from the browser on the same host within a short time frame (e.g., 60 seconds). A successful correlation is a high-fidelity indicator of successful exploitation.
    answer_sources:
      - Zeek http.log
      - Zeek files.log
      - Windows Event ID 4688
      - Windows Event ID 1
      - Endpoint workstations and servers
      - Enterprise Web Proxy
      - Network File Analysis Sandbox
      - SIEM for correlation
    range: last 90 days
    queries:
      - technology: pseudocode
        query: ON file download, SCAN with YARA. IF match, CHECK for process creation from browser on same host within 1 minute. ALERT on correlation.
  - question: Are any downloaded scripts exhibiting unusually high entropy, or are files being downloaded from domains that do not typically serve that file type?
    context: This question uses statistical properties to find suspicious files. High Shannon entropy in a script often indicates packing or obfuscation used to hide malicious code. Additionally, a domain serving a file type it has never served before (e.g., an executable from a news site) is anomalous. Identifying either of these conditions provides a strong signal that a downloaded file may be malicious, even without a specific signature match.
    answer_sources:
      - Zeek http.log
      - Zeek files.log
      - Windows Event ID 4688
      - Windows Event ID 1
      - Endpoint workstations and servers
      - Enterprise Web Proxy
      - Network File Analysis Sandbox
      - SIEM for correlation
    range: last 90 days
    queries:
      - technology: pseudocode
        query: FOR downloaded scripts, CALCULATE entropy; ALERT if entropy > 95th percentile. SEPARATELY, for each domain, PROFILE served file types; ALERT on statistically significant deviations.
  - question: Can we use a machine learning model to predict whether a file download is malicious based on a combination of file, network, and process context?
    context: This question seeks to create a predictive model for malicious downloads, combining multiple weak signals into a strong indicator. By training a classifier with features like file entropy, file size, source domain reputation/age, redirection chain presence, parent process, and MIME type anomalies, analysts can score the risk of each download. A high probability score from the model would trigger an alert for investigation.
    answer_sources:
      - Zeek http.log
      - Zeek files.log
      - Windows Event ID 4688
      - Windows Event ID 1
      - Endpoint workstations and servers
      - Enterprise Web Proxy
      - Network File Analysis Sandbox
      - SIEM for correlation
    range: last 90 days
    queries:
      - technology: pseudocode
        query: FOR each download, PREDICT maliciousness using a classifier with features (entropy, size, domain_rep, domain_age, redirect_chain, parent_process). ALERT on high probability.
  - question: Are any hosts connecting to a known malvertising domain and then immediately connecting to a known malicious or newly registered domain?
    context: Malvertising attacks often involve a two-stage process a user visits a site with a malicious ad, which then redirects them to the actual exploit or payload server. This question aims to detect this sequence by alerting when a connection to a known malvertising domain is followed shortly by a connection to a domain on a threat intel blocklist or an NRD list.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Zeek http.log
      - Egress Firewalls/Proxies
      - DNS Resolvers
      - Threat Intelligence Platform
      - Ad-blocker logs
    range: last 90 days
    queries:
      - technology: pseudocode
        query: ALERT if connection to malvertising_watchlist is followed within 2 minutes by connection to threat_intel_blocklist OR NRD_list.
  - question: Are any hosts exhibiting a sudden spike in traffic to advertising networks, and if so, what is their subsequent network activity?
    context: A sudden, anomalous increase in connections to ad networks for a specific host can indicate that the user has landed on a page that is aggressively serving malicious ads. This question identifies such spikes by comparing a host's ad traffic against its own historical baseline. When a spike is detected, the host's subsequent network activity is closely scrutinized for rare or suspicious events, like connections to domains never before seen by the organization.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Zeek http.log
      - Egress Firewalls/Proxies
      - DNS Resolvers
      - Threat Intelligence Platform
      - Ad-blocker logs
    range: last 90 days
    queries:
      - technology: pseudocode
        query: FOR each host, BASELINE traffic to 'Advertising' domains. ALERT on spikes (> 3 std dev). If spike, SCRUTINIZE subsequent 5 mins of traffic for rare events.
  - question: Is there an enterprise-wide anomaly in traffic to advertising networks, and can we risk-score the subsequent traffic of contributing hosts?
    context: This question scales the detection of malvertising to the entire organization. It uses a multivariate anomaly detection model to find unusual patterns in aggregate traffic to ad networks (e.g., spikes in connections, data volume, and unique domains). For hosts identified as the main drivers of the anomaly, a risk-scoring model is applied to their subsequent traffic to pinpoint the likely victims of the malvertising campaign.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Zeek http.log
      - Egress Firewalls/Proxies
      - DNS Resolvers
      - Threat Intelligence Platform
      - Ad-blocker logs
    range: last 90 days
    queries:
      - technology: pseudocode
        query: DETECT enterprise-wide anomalies in ad network traffic. For contributing hosts, APPLY risk-scoring model to their subsequent traffic to find victims.