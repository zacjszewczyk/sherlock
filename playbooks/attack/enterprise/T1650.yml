name: T1650: Acquire Access
id: f47ac10b-58cc-4372-a567-0e02b2c3d479
description: This playbook focuses on detecting adversaries who have acquired access to an enterprise environment. It includes monitoring for the use of known-compromised credentials from CTI feeds, detecting brute-force or password spraying attacks by analyzing failed login volumes and patterns, identifying successful logins from anomalous or high-risk IP addresses, correlating post-breach logins with high-risk subsequent activity like privilege escalation, and detecting web shell execution through suspicious process creation on web servers. The primary goal is to answer the question: Has the adversary acquired and used access to the enterprise environment?
type: technique
related:
  - TA0042: Resource Development
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Has an authentication attempt (successful or failed) been made using an account known to be compromised from a CTI feed?
    context: This question aims to detect the active use of breached credentials. By continuously monitoring all authentication logs against a watchlist of compromised accounts from CTI feeds, an organization can immediately identify when an adversary attempts to leverage this stolen information to gain access. A match indicates a high probability of a targeted attack.
    answer_sources:
      - Windows Event ID 4624
      - Windows Event ID 4625
      - Zeek conn.log
      - Externally-facing authentication services (e.g., VPN gateways, Microsoft Entra ID)
      - Domain Controller security logs
      - CTI feed aggregation platforms
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: JOIN (AuthenticationLogs) ON (username) WITH (CompromisedCredentialWatchlist)
  - question: For a successful login using a compromised credential, is the source ASN anomalous for that user?
    context: This question adds a layer of validation to an alert on a compromised credential login. An adversary will likely use different infrastructure than a legitimate user. By comparing the login's source ASN against the user's 90-day baseline, we can distinguish between potentially legitimate (though risky) user activity and highly suspicious, anomalous logins that require immediate escalation.
    answer_sources:
      - Windows Event ID 4624
      - Zeek conn.log
      - Externally-facing authentication services (e.g., VPN gateways, Microsoft Entra ID)
      - Domain Controller security logs
      - CTI feed aggregation platforms
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: FOR each successful login from compromised account, CHECK if source ASN is in user's historical ASN baseline. ALERT if not present.
  - question: Does a machine learning model classify a new login event as malicious based on its features?
    context: This question leverages machine learning to provide a more nuanced and context-aware detection than simple rule-based alerts. By training a model on features like IP reputation, time of day, geolocation, ASN, and whether the account is on a breach list, the system can score each login in real-time and flag events that have a high probability of being malicious, even if they don't trigger a specific, rigid rule.
    answer_sources:
      - Windows Event ID 4624
      - Windows Event ID 4625
      - Zeek conn.log
      - Externally-facing authentication services (e.g., VPN gateways, Microsoft Entra ID)
      - Domain Controller security logs
      - CTI feed aggregation platforms
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: SCORE each login event with classification model. ALERT if score > threshold (e.g., 0.85).
  - question: Is a single source IP address generating a high volume of failed logins against many different user accounts in a short time frame?
    context: This question is designed to detect password spraying or brute-force attacks. An attacker will often try to authenticate to many different accounts from a single machine. By counting the number of distinct users targeted by a single source IP within a 5-minute window, we can identify and alert on this anomalous, high-volume activity.
    answer_sources:
      - Windows Event ID 4625
      - Zeek conn.log
      - Perimeter firewalls
      - VPN concentrators
      - Web Application Firewalls (WAFs)
      - Identity Provider logs (e.g., Microsoft Entra ID Sign-in logs)
      - Domain Controller security logs
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: COUNT distinct usernames per source IP in 5-min window. ALERT if count > 50.
  - question: Is the set of usernames being targeted by a single source IP abnormally diverse?
    context: This question provides a more sophisticated method for detecting password spraying than a simple count. By calculating the Shannon entropy of the usernames targeted from a source IP, we can quantify this randomness. An unusually high entropy score compared to a dynamic baseline indicates that the source IP is likely running through a large, diverse list, which is a strong indicator of an attack.
    answer_sources:
      - Windows Event ID 4625
      - Zeek conn.log
      - Perimeter firewalls
      - VPN concentrators
      - Web Application Firewalls (WAFs)
      - Identity Provider logs (e.g., Microsoft Entra ID Sign-in logs)
      - Domain Controller security logs
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: CALCULATE Shannon entropy of usernames per source IP. ALERT if entropy > dynamic 99th percentile threshold.
  - question: Is the overall rate of failed logins across the enterprise significantly higher than expected?
    context: This question seeks to identify large-scale, distributed attacks that might not be caught by single-source IP rules. By modeling the normal seasonal patterns of failed authentications, a time-series anomaly detection model can establish an expected forecast. When the actual number of failures dramatically exceeds this forecast, it indicates a significant deviation from the norm, such as a large-scale credential stuffing attack.
    answer_sources:
      - Windows Event ID 4625
      - Zeek conn.log
      - Perimeter firewalls
      - VPN concentrators
      - Web Application Firewalls (WAFs)
      - Identity Provider logs (e.g., Microsoft Entra ID Sign-in logs)
      - Domain Controller security logs
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: MONITOR aggregate failed login rate with time-series model. ALERT if observed rate exceeds forecasted upper bound.
  - question: Did a successful login originate from an IP address known to be a TOR exit node, anonymous proxy, or malicious C2 server?
    context: This question aims to detect logins from inherently high-risk network infrastructure. Adversaries frequently use anonymizing services. By enriching every external login with CTI data on the source IP, we can immediately flag any authentication coming from a source that is already categorized as malicious or a high-risk anonymizer.
    answer_sources:
      - Windows Event ID 4624
      - Zeek conn.log
      - Externally-facing authentication services
      - CTI data feeds for IP reputation
      - Geolocation databases
      - Network flow log collectors
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: FOR each successful login, CHECK if source IP is in CTI list of TOR/proxy/C2. ALERT if match found.
  - question: Has a user successfully logged in from a country-ASN pair that is both new for that user and globally rare across the organization?
    context: This question detects 'impossible travel' scenarios with higher fidelity. By baselining country-ASN pairs for each user and also tracking the global rarity of these pairs, we can create a more intelligent alert. A login from a pair that is new for the user AND rarely seen across the entire company is a much stronger signal of a potential compromise than just a new country alone.
    answer_sources:
      - Windows Event ID 4624
      - Zeek conn.log
      - Externally-facing authentication services
      - CTI data feeds for IP reputation
      - Geolocation databases
      - Network flow log collectors
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: FOR each successful login, CHECK if country-ASN pair is new for user AND globally rare (<1% of all logins). ALERT if both are true.
  - question: Is a user's successful login classified as an outlier by an anomaly detection model based on their historical login patterns?
    context: This question uses unsupervised machine learning to build a detailed 'pattern of life' for each user's login behavior. The model learns a user's normal routine based on features like time of day, day of week, source country, and source ASN. Any new login that significantly deviates from this established, multi-faceted pattern is flagged as an outlier.
    answer_sources:
      - Windows Event ID 4624
      - Zeek conn.log
      - Externally-facing authentication services
      - CTI data feeds for IP reputation
      - Geolocation databases
      - Network flow log collectors
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: SCORE each user login with their personal Isolation Forest model. ALERT if login is classified as an outlier.
  - question: Following the first login from an account known to be compromised, was there an immediate privilege escalation event within the same session?
    context: This question focuses on the critical moments immediately following the successful use of a breached credential. By specifically looking for the first login after a credential's exposure date and correlating it with subsequent privilege escalation events (like being added to an admin group) in the same session, we can detect the initial stages of an active compromise with high confidence.
    answer_sources:
      - Windows Event ID 4624
      - Windows Event ID 4732
      - Windows Event ID 4728
      - Windows Event ID 4672
      - Zeek dns.log
      - Domain Controllers
      - Member Servers
      - CTI data feeds
      - Privileged Access Management (PAM) systems
      - DNS servers
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: FIND first successful login post-breach date. CORRELATE with privilege escalation events (4732, 4728, 4672) in same session. ALERT on match.
  - question: Does the risk score of a user session, initiated after their credentials were breached, exceed a dynamically calculated threshold?
    context: This question moves beyond single-event alerts to score the risk of an entire session. For a session that starts with a high-risk event (a login using a known breached credential), we can track subsequent actions and assign risk points to them. If the cumulative score for the session surpasses a threshold based on normal behavior for that user's role, it indicates a chain of suspicious activities.
    answer_sources:
      - Windows Event ID 4624
      - Windows Event ID 4732
      - Windows Event ID 4728
      - Windows Event ID 4672
      - Zeek dns.log
      - Domain Controllers
      - Member Servers
      - CTI data feeds
      - Privileged Access Management (PAM) systems
      - DNS servers
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: FOR 'first use post-breach' sessions, CALCULATE risk score based on actions. ALERT if score > 99th percentile for user's role.
  - question: Is the sequence of actions following a login from a compromised account anomalous when compared to normal user behavior sequences?
    context: This question uses advanced sequence analysis to detect unusual chains of events. A model like an LSTM autoencoder is trained on normal sequences of user actions post-login. If the model has a high reconstruction error for a new sequence, it means the sequence is unlike normal behavior (e.g., login immediately followed by privilege escalation) and signals a likely attack.
    answer_sources:
      - Windows Event ID 4624
      - Windows Event ID 4732
      - Windows Event ID 4728
      - Windows Event ID 4672
      - Zeek dns.log
      - Domain Controllers
      - Member Servers
      - CTI data feeds
      - Privileged Access Management (PAM) systems
      - DNS servers
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: FOR 'first use post-breach' sessions, FEED action sequence to LSTM autoencoder. ALERT if reconstruction error is high.
  - question: Has a web server process spawned a suspicious child process like a command shell or a reconnaissance tool?
    context: This question is designed to detect the activation of a web shell. Web servers should typically not be spawning command-line interpreters (cmd.exe, powershell.exe) or system tools (whoami.exe). Such an event is a strong indicator that an attacker has compromised the web server and is using a web shell to execute commands.
    answer_sources:
      - Windows Event ID 4688
      - Zeek http.log
      - Externally-facing web servers
      - Application servers
      - Web server process logs
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: ALERT if parent process (w3wp.exe, apache.exe) spawns child process in (cmd.exe, powershell.exe, whoami.exe, etc.).
  - question: Has a web server process spawned a child process that has never been seen before in its historical baseline?
    context: This question uses baselining to detect novel and potentially malicious activity. By profiling the normal parent-child process relationships for web servers, we can identify what is normal. If a web server suddenly spawns a process that has a frequency of zero in this baseline, it represents a significant deviation and a potential sign of compromise.
    answer_sources:
      - Windows Event ID 4688
      - Zeek http.log
      - Externally-facing web servers
      - Application servers
      - Web server process logs
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: BASELINE all child processes of web servers. ALERT if a web server spawns a new, never-before-seen child process.
  - question: Does a machine learning model classify a process spawned by a web server as malicious based on its name and command-line arguments?
    context: This question applies machine learning to detect malicious web shell activity. A supervised model can be trained on benign and malicious process creation events. By analyzing features like the child process name and the full command-line arguments, the model can learn to identify malicious commands and scripts, even if they use legitimate system tools.
    answer_sources:
      - Windows Event ID 4688
      - Zeek http.log
      - Externally-facing web servers
      - Application servers
      - Web server process logs
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: SCORE each child process from web server with classification model. ALERT if predicted malicious with high confidence.