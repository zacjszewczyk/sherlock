name: T1486: Data Encrypted for Impact
id: a6c3f8e0-2b1d-4a9c-8f2e-1d7b3a9c5b4d
description: This playbook provides analytic guidance to detect adversary activity involving the encryption of data to disrupt availability and extort victims. It helps answer the primary investigative question, "Has the adversary encrypted data to impact system availability?" by identifying various stages and artifacts of a ransomware attack. Detections focus on identifying known ransomware binaries and file patterns, precursor actions like the deletion of volume shadow copies, anomalous high-volume file modifications on both local systems and network shares, the triggering of honeyfile tripwires, and the appearance of post-compromise artifacts like ransom notes and modified desktop wallpapers.
type: technique
related:
- TA0040: Impact
contributors:
- Zachary Szewczyk
- Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
- question: Are there any process executions or file creations matching known ransomware signatures, such as file hashes, ransom note names, or specific file extensions?
  context: This question seeks to identify ransomware activity by matching observed events against known threat intelligence. Finding a match for a known ransomware hash, a common ransom note filename (e.g., 'DECRYPT_INSTRUCTIONS.txt'), or a specific encrypted file extension (e.g., '.lockbit') provides a high-confidence indicator of a ransomware attack in progress.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 1 (Sysmon)
  - Windows Event ID 4663
  - Windows Event ID 11 (Sysmon)
  - Zeek files.log
  - All endpoints, User workstations, File servers, Domain Controllers, Web servers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: QUERY process creation logs and network file transfer logs FOR file hashes in ransomware threat intel feed. QUERY file creation logs FOR filenames matching known ransom note patterns OR file extensions matching known ransomware families.
- question: Has any process exhibited an unusually high Shannon entropy in the filenames it creates, suggesting the use of randomized names for encrypted files?
  context: Some ransomware families rename encrypted files using random character strings. This results in filenames with high entropy (randomness). This question aims to detect such behavior by baselining the normal filename entropy for processes on a system and alerting when a process deviates significantly, which could indicate an active encryption routine.
  answer_sources:
  - Windows Event ID 4663
  - Windows Event ID 11 (Sysmon)
  - All endpoints, User workstations, File servers, Domain Controllers, Web servers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: FOR each process, CALCULATE Shannon entropy of created filenames in a 1-minute window. COMPARE entropy score against the process's historical baseline. ALERT if entropy exceeds 99th percentile.
- question: Can machine learning models classify any recently executed processes as ransomware based on their behavioral and static features?
  context: This question leverages a machine learning classifier to proactively identify ransomware based on a combination of features like parent process, command-line arguments, PE header data, and file reputation. This approach can detect novel or obfuscated ransomware variants that might evade signature-based methods by focusing on the intrinsic characteristics of malicious execution.
  answer_sources:
  - Windows Event ID 1 (Sysmon)
  - All endpoints, User workstations, File servers, Domain Controllers, Web servers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: EXTRACT features from new process creation events. INPUT features into a trained classification model (e.g., Random Forest). SCORE process for ransomware probability. ALERT on high-probability classifications.
- question: Has a host exhibited commands to delete Volume Shadow Copies or disable recovery features, followed immediately by a high volume of file write operations?
  context: Ransomware often attempts to eliminate recovery options before encrypting data. This question looks for the specific sequence of an attacker disabling backups (e.g., using `vssadmin.exe delete shadows`) and then initiating the encryption process, indicated by a subsequent burst of file writes. This temporal correlation is a strong indicator of a ransomware attack.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 1 (Sysmon)
  - Windows Event ID 4663
  - Windows Event ID 11 (Sysmon)
  - Critical servers (e.g., database, application), Domain Controllers, Backup servers, Administrator workstations
  range: last 90 days
  queries:
  - technology: pseudocode
    query: CORRELATE process creation logs for recovery-disabling commands (vssadmin, bcdedit, etc.) with file write/create logs on the same host. TRIGGER alert if >500 file writes occur within 10 minutes of the command.
- question: Following the execution of a recovery-disabling command, did the rate of file operations on the host significantly deviate from its established baseline?
  context: This question provides a more dynamic way to detect the post-sabotage encryption phase. Instead of a fixed threshold, it compares the file operation rate against the host's own normal behavior. An alert is triggered if file writes spike to a statistically significant level (e.g., 4 standard deviations above the norm) after backup deletion, accounting for varying activity levels across different hosts.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 1 (Sysmon)
  - Windows Event ID 4663
  - Windows Event ID 11 (Sysmon)
  - Critical servers (e.g., database, application), Domain Controllers, Backup servers, Administrator workstations
  range: last 90 days
  queries:
  - technology: pseudocode
    query: ESTABLISH hourly baseline of file operations per host. ON detection of a recovery-disabling command, MONITOR file operation count for the next hour. ALERT if count exceeds 4 standard deviations above the baseline for that time.
- question: Has a sequence of command-line executions occurred that is anomalous and indicative of ransomware preparation and execution?
  context: This question uses a sequence analysis model to understand the 'grammar' of normal administrative actions. The model learns common command sequences. An alert is triggered when an unusual sequence appears, such as legitimate admin tools (`vssadmin.exe`) being used in a context that is then followed by high I/O from an unknown process. This detects deviations from expected administrative workflows.
  answer_sources:
  - Windows Event ID 1 (Sysmon)
  - Critical servers (e.g., database, application), Domain Controllers, Backup servers, Administrator workstations
  range: last 90 days
  queries:
  - technology: pseudocode
    query: TRAIN a sequence model (e.g., HMM, LSTM) on normal command-line sequences. ANALYZE new command sequences in real-time. ALERT on low-probability sequences, especially those involving recovery-disabling commands followed by high I/O processes.
- question: Has any single, non-whitelisted process performed an excessively high number of file write or create operations on common user data file types within a short time frame?
  context: This question aims to detect the core encryption activity of ransomware. A legitimate process rarely modifies hundreds of different user documents in under a minute. By setting a high threshold (e.g., >500 events/minute) and excluding known-good processes like backup software, this rule can effectively identify a rogue process systematically encrypting files.
  answer_sources:
  - Windows Event ID 4663
  - Windows Event ID 11 (Sysmon)
  - Windows Event ID 23 (Sysmon)
  - Windows Event ID 4688
  - Windows Event ID 1 (Sysmon)
  - User home directories, Shared network drives, Cloud storage synchronized folders (e.g., OneDrive, Dropbox), Document management system repositories
  range: last 90 days
  queries:
  - technology: pseudocode
    query: COUNT file write/create operations per process per minute for common user data extensions. IF count > 500 AND process is not on whitelist, TRIGGER alert.
- question: Is there a process that is modifying a statistically unusual number of unique file extensions compared to its normal behavior?
  context: Ransomware is often indiscriminate, targeting a wide variety of file types to maximize impact. This question focuses on the breadth of file extensions being modified by a process. A process that suddenly starts modifying dozens of different file types (.docx, .jpg, .pdf, .zip, etc.) when it normally only interacts with one or two is highly suspicious and deviates significantly from its baseline.
  answer_sources:
  - Windows Event ID 11 (Sysmon)
  - Windows Event ID 4663
  - User home directories, Shared network drives, Cloud storage synchronized folders (e.g., OneDrive, Dropbox), Document management system repositories
  range: last 90 days
  queries:
  - technology: pseudocode
    query: FOR each process, establish a baseline for the number of unique file extensions modified per minute. ALERT if a process modifies a number of unique extensions >3 standard deviations above its baseline.
- question: Has a time-series anomaly detection model identified a sudden, anomalous burst of file modification activity on any host?
  context: Every host has a unique rhythm of disk I/O activity. This question applies a time-series model to learn this normal rhythm. The model can then detect a sudden, sharp spike in file modifications that is inconsistent with the host's learned daily and weekly patterns. This is a strong indicator of an abnormal process, like ransomware encryption, consuming disk resources.
  answer_sources:
  - Windows Event ID 4663
  - Windows Event ID 11 (Sysmon)
  - User home directories, Shared network drives, Cloud storage synchronized folders (e.g., OneDrive, Dropbox), Document management system repositories
  range: last 90 days
  queries:
  - technology: pseudocode
    query: MODEL the rate of file modification events per host using a time-series model (e.g., LSTM autoencoder). FORECAST expected range of activity. ALERT when the observed rate sharply deviates from the forecast.
- question: Has a single host been observed writing to or renaming files on an unusually large number of different network hosts via SMB in a short period?
  context: This question is designed to detect a ransomware worm or a manually propagated attack spreading across the network. A single workstation rapidly writing files to more than 10 different servers or workstations within five minutes is not normal user or system behavior. It strongly suggests a compromised host is being used as a beachhead to encrypt data on network shares.
  answer_sources:
  - Windows Event ID 5145
  - Zeek smb_files.log
  - Zeek conn.log
  - File servers, Network Attached Storage (NAS) devices, SMB/CIFS shares
  range: last 90 days
  queries:
  - technology: pseudocode
    query: FROM SMB logs, COUNT distinct destination hosts a single source host writes to in a 5-minute window. IF count > 10, TRIGGER alert.
- question: Is any host accessing and writing to a statistically anomalous number of distinct network shares compared to its historical baseline?
  context: This question refines the symbolic approach by baselining 'normal' share access for each host. A user might regularly access 2-3 shares, while a server might access zero. An alert is triggered when a host suddenly accesses and writes to a number of shares that is highly unusual for that specific host, indicating a potential lateral spread of ransomware.
  answer_sources:
  - Windows Event ID 5145
  - Zeek smb_files.log
  - Zeek conn.log
  - File servers, Network Attached Storage (NAS) devices, SMB/CIFS shares
  range: last 90 days
  queries:
  - technology: pseudocode
    query: BASELINE the number of distinct shares each host writes to per hour. ALERT if a host writes to a number of shares exceeding the 98th percentile of its own history.
- question: Does a graph-based analysis of SMB connections reveal a host that is anomalously creating many new write connections across the network?
  context: This question models the network as a graph of connections. Normal activity creates predictable patterns and communities (e.g., workstations talking to a file server). Ransomware spreading laterally breaks this pattern by creating a 'star' shape, where one compromised host rapidly connects and writes to many others it doesn't normally interact with. Graph algorithms can detect this structural anomaly.
  answer_sources:
  - Zeek conn.log
  - Zeek smb_files.log
  - File servers, Network Attached Storage (NAS) devices, SMB/CIFS shares
  range: last 90 days
  queries:
  - technology: pseudocode
    query: MODEL hosts and SMB write operations as a graph. APPLY graph anomaly detection algorithms (e.g., PageRank on write activity). ALERT when a node (host) suddenly creates an anomalous number of new write edges to disparate parts of the graph.
- question: Has any process attempted to modify, rename, or delete a designated canary or honeyfile?
  context: Canary files are decoys with no legitimate reason to be accessed. Any modification is a high-fidelity, zero-tolerance indicator of malicious activity, most likely an automated process like ransomware scanning and encrypting files. This question provides a tripwire for an immediate and automated response, such as host isolation.
  answer_sources:
  - Windows Event ID 4663
  - Windows Event ID 11 (Sysmon)
  - Windows Event ID 23 (Sysmon)
  - Zeek smb_files.log
  - Designated canary file directories on high-value file shares, Hidden directories in user profiles, Root directories of mapped network drives, Bait directories with enticing names like 'Executive Salaries' or 'Passwords' on file servers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: MONITOR for any file modification event (e.g., Windows Event ID 4663) where the target file path matches a predefined list of canary files. TRIGGER a critical alert immediately upon detection.
- question: Has there been a sudden, anomalous increase in read attempts within directories containing canary files, prior to any modification?
  context: Before encrypting, ransomware must first enumerate files. This question looks for the reconnaissance phase. A sudden burst of read or directory listing attempts in a honey-directory, even without modification, is abnormal and can serve as an early warning that a process is scanning the file system, potentially just before it begins encryption.
  answer_sources:
  - Windows Event ID 4663
  - Designated canary file directories on high-value file shares, Hidden directories in user profiles, Root directories of mapped network drives, Bait directories with enticing names like 'Executive Salaries' or 'Passwords' on file servers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: MONITOR read access events to canary file directories. COUNT reads per process per minute. ALERT if read count exceeds a low threshold (e.g., >10 reads/minute).
- question: Can the definitive alert from a canary file modification be used to automatically label the responsible process and retrain other behavioral models?
  context: A canary file alert provides ground truth a a process that triggered it is malicious. This question proposes using this high-fidelity signal as a real-time training label. This feedback loop allows other, more heuristic-based models (like a process risk-scoring model) to learn from a confirmed attack, improving their ability to detect similar threats in the future.
  answer_sources:
  - Windows Event ID 4663
  - Windows Event ID 11 (Sysmon)
  - Windows Event ID 23 (Sysmon)
  - Zeek smb_files.log
  - Designated canary file directories on high-value file shares, Hidden directories in user profiles, Root directories of mapped network drives, Bait directories with enticing names like 'Executive Salaries' or 'Passwords' on file servers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: ON canary file alert, CAPTURE process, user, and host details. LABEL this event as 'confirmed ransomware'. FEED this labeled data point back into supervised ML models for continuous retraining.
- question: Has there been any activity related to changing the desktop wallpaper via the registry or the creation of files with names matching common ransom note patterns?
  context: After encryption, ransomware needs to inform the victim. This is often done by changing the desktop wallpaper or dropping ransom notes (e.g., 'README.txt') in prominent locations. This question looks for these explicit, post-encryption artifacts, which serve as a clear confirmation that a ransomware event has occurred.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 1 (Sysmon)
  - Windows Event ID 4657
  - Windows Event ID 11 (Sysmon)
  - Windows Event ID 4663
  - User desktops, Public and All Users directories, Web server root directories, Shared network drive root directories
  range: last 90 days
  queries:
  - technology: pseudocode
    query: MONITOR for registry modifications to the 'Wallpaper' key. SEARCH for file creation events with names matching ransom note patterns (e.g., *DECRYPT*, *RECOVER*) in common user directories.
- question: Has any process created an unusually high number of .txt or .html files across many directories in a short time frame?
  context: To ensure the victim sees the message, some ransomware variants 'spam' the ransom note into every directory they encrypt. This question detects this behavior by looking for a statistical anomaly a single process creating a large number of text or HTML files across the file system, which deviates sharply from normal activity.
  answer_sources:
  - Windows Event ID 11 (Sysmon)
  - Windows Event ID 4663
  - User desktops, Public and All Users directories, Web server root directories, Shared network drive root directories
  range: last 90 days
  queries:
  - technology: pseudocode
    query: BASELINE rate of .txt/.html file creations per process per minute across multiple directories. ALERT if a process exceeds 3 standard deviations above this baseline.
- question: Can a text classification model identify the content of newly created text or HTML files as being a ransom note?
  context: This question moves beyond just filenames and looks at the content of newly created files. By training a model on the language and keywords commonly found in ransom notes ('bitcoin', 'private key', 'encrypt'), it can score new files for their likelihood of being a ransom demand. This can detect notes with non-standard names.
  answer_sources:
  - Windows Event ID 11 (Sysmon)
  - Windows Event ID 4663
  - User desktops, Public and All Users directories, Web server root directories, Shared network drive root directories
  range: last 90 days
  queries:
  - technology: pseudocode
    query: ON new .txt or .html file creation, EXTRACT file content. SCORE content using a trained text classification model. ALERT on high probability of being a ransom note.