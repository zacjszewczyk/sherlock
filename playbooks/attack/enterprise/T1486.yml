name: T1486: Data Encrypted for Impact
id: a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d
description: This playbook helps identify if an adversary has encrypted data to impact
  system availability. It looks for various indicators, including the execution of
  known ransomware binaries, creation of ransom notes, deletion of volume shadow
  copies followed by high file activity, high-volume file modifications from a single
  process, rapid encryption across network shares (lateral movement), modification
  of canary/honey files, and changes to desktop wallpaper or the widespread creation
  of ransom notes.
type: technique
related:
- TA0040: Impact
contributors:
- Zachary Szewczyk
- Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
investigative_questions:
- question: Have any processes been executed that match known ransomware hashes, or
    have any files been created that match known ransom note names or ransomware
    file extensions?
  context: This question uses a symbolic, signature-based approach. It aims to find
    direct evidence of ransomware by matching process hashes against threat intelligence
    feeds and looking for characteristic file creations, such as ransom notes (e.g.,
    'DECRYPT_INSTRUCTIONS.txt') or files with extensions used by known ransomware
    families (e.g., '.lockbit'). A match provides a high-confidence indicator of
    a ransomware infection.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 1 (Sysmon)
  - Windows Event ID 4663
  - Windows Event ID 11 (Sysmon)
  - Zeek files.log
  - Relevant assets include All endpoints, User workstations, File servers, Domain
    Controllers, Web servers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      SEARCH process_creation_logs OR file_transfer_logs
      WHERE file_hash IN (ransomware_hash_threat_feed)
      ---
      SEARCH file_creation_logs
      WHERE file_name MATCHES (ransom_note_patterns) OR file_extension MATCHES (ransomware_extension_patterns)
- question: Has any process created a large number of files with unusually high-entropy
    (randomized) filenames, deviating from its normal behavior?
  context: This question uses a statistical approach to detect ransomware that randomizes
    filenames of encrypted files. By calculating the Shannon entropy of filenames
    created by a process and comparing it to a baseline, we can identify anomalous
    behavior. A sudden spike in filename entropy for a process can indicate an active
    encryption routine, even if the ransomware variant is unknown.
  answer_sources:
  - Windows Event ID 11 (Sysmon)
  - Windows Event ID 4663
  - Relevant assets include All endpoints, User workstations, File servers, Domain
    Controllers, Web servers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR each process in file_creation_logs:
        CALCULATE shannon_entropy of filenames in 1-minute window
        IF entropy > 99th_percentile_of_baseline:
          ALERT
- question: Can we use a machine learning model to classify newly executed processes
    as potential ransomware based on their characteristics?
  context: This question leverages machine learning to proactively identify ransomware.
    A classification model is trained on features from process execution events (e.g.,
    parent process, command-line arguments, PE header info). The model learns the
    complex patterns that distinguish ransomware from benign processes, allowing
    for the detection of novel or evasive threats that might not be caught by signature-based
    methods.
  answer_sources:
  - Windows Event ID 1 (Sysmon)
  - Relevant assets include All endpoints, User workstations, File servers, Domain
    Controllers, Web servers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR each new_process_event:
        EXTRACT features (parent_process, command_line_entropy, PE_info, hash_reputation)
        SCORE process with trained_ML_model
        IF score > malicious_threshold:
          ALERT
- question: Has any host executed commands to disable recovery mechanisms (like Volume
    Shadow Copy) and was this activity immediately followed by a large number of file
    write operations?
  context: This question looks for a common ransomware behavior sequence crippling
    a system's ability to recover and then encrypting files. By creating a correlation
    rule that links recovery-disabling commands (e.g., `vssadmin.exe delete shadows`)
    with a subsequent burst of file creation/modification events on the same host,
    we can detect this destructive pattern with high confidence.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 1 (Sysmon)
  - Windows Event ID 4663
  - Windows Event ID 11 (Sysmon)
  - Relevant assets include Critical servers (e.g., database, application), Domain
    Controllers, Backup servers, Administrator workstations
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      CORRELATE process_creation_logs with file_creation_logs ON host
      TRIGGER if process_command IN (recovery_disabling_commands)
      AND COUNT(file_creation_events) > 500 within 10 minutes
- question: Following the execution of a recovery-disabling command, did the host's
    file operation rate deviate significantly from its established baseline?
  context: This statistical question aims to detect the aftermath of defense evasion.
    After spotting a command meant to hinder recovery, we monitor the host's file
    I/O. A sharp increase in file operations that is statistically significant (e.g.,
    4 standard deviations above the norm for that hour) provides strong evidence
    that the defense evasion was a precursor to a mass file encryption event.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 1 (Sysmon)
  - Windows Event ID 4663
  - Windows Event ID 11 (Sysmon)
  - Relevant assets include Critical servers (e.g., database, application), Domain
    Controllers, Backup servers, Administrator workstations
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      WHEN process_command IN (recovery_disabling_commands):
        MONITOR file_operation_count for next hour
        IF file_operation_count > (baseline + 4 * std_dev):
          ALERT
- question: Has a machine learning model detected an abnormal sequence of commands,
    such as defense evasion followed by an unknown high I/O process?
  context: This question applies machine learning to understand the 'grammar' of
    system behavior. A sequence analysis model learns normal chains of command-line
    executions. It can then flag an unusual sequence, like the use of `vssadmin.exe`
    or `bcdedit.exe` followed by a process that begins heavy I/O activity, as a low-probability
    and therefore suspicious event, indicative of ransomware behavior.
  answer_sources:
  - Windows Event ID 1 (Sysmon)
  - Relevant assets include Critical servers (e.g., database, application), Domain
    Controllers, Backup servers, Administrator workstations
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR each sequence of process_commands on a host:
        SCORE sequence_probability with trained_sequence_model
        IF probability is low:
          ALERT
- question: Has a single, non-whitelisted process performed an unusually high number
    of file write/create operations (e.g., >500 in one minute) on common user data
    file types?
  context: This question seeks to identify the core encryption activity of ransomware
    using a simple but effective threshold. By counting file operations from a single
    process within a short time window and filtering out known-good processes (like
    backup agents), we can detect a process that is rapidly encrypting user documents.
    The focus on common data extensions (.docx, .pdf, etc.) helps confirm the malicious
    intent.
  answer_sources:
  - Windows Event ID 4663
  - Windows Event ID 11 (Sysmon)
  - Windows Event ID 4688
  - Windows Event ID 1 (Sysmon)
  - Relevant assets include User home directories, Shared network drives, Cloud storage
    synchronized folders (e.g., OneDrive, Dropbox), Document management system repositories
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      AGGREGATE file_write_create_events by process in 1-minute window
      WHERE file_extension IN (common_user_data_extensions) AND process NOT IN (whitelist)
      IF event_count > 500:
        ALERT
- question: Is any process modifying a statistically unusual number of unique file
    extension types per minute compared to its own baseline?
  context: This statistical question identifies ransomware by its indiscriminate
    nature. Unlike normal applications that work with a few file types, ransomware
    often encrypts everything it can. By tracking the variety (number of unique extensions)
    of files a process touches per minute, we can flag a process that suddenly starts
    modifying a much wider range of file types than it normally does, which is a strong
    indicator of ransomware.
  answer_sources:
  - Windows Event ID 11 (Sysmon)
  - Windows Event ID 4663
  - Relevant assets include User home directories, Shared network drives, Cloud storage
    synchronized folders (e.g., OneDrive, Dropbox), Document management system repositories
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR each process:
        CALCULATE unique_file_extensions_modified per minute
        IF count > (baseline + 3 * std_dev):
          ALERT
- question: Has a time-series anomaly detection model detected a sharp, unexpected
    spike in the rate of file modifications on a host?
  context: This question uses a machine learning model to learn the normal 'rhythm'
    of file I/O on a specific host. A time-series model (like ARIMA or an LSTM autoencoder)
    can predict the expected range of file modification activity for any given minute.
    When a ransomware process begins its encryption routine, it causes a massive,
    sudden burst of I/O that will fall far outside the model's predicted range, triggering
    a high-fidelity alert for anomalous activity.
  answer_sources:
  - Windows Event ID 4663
  - Windows Event ID 11 (Sysmon)
  - Relevant assets include User home directories, Shared network drives, Cloud storage
    synchronized folders (e.g., OneDrive, Dropbox), Document management system repositories
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR each host:
        MODEL file_modification_rate per minute
        FORECAST expected_rate_range
        IF actual_rate is outside forecasted_range:
          ALERT
- question: Is any single host writing or renaming files via SMB on an unusually
    large number of other hosts (e.g., >10) in a short time frame?
  context: This question aims to detect the lateral spread of ransomware across network
    shares. A worm-like ransomware variant will often try to encrypt files on as many
    accessible shares as possible. By monitoring SMB logs and triggering an alert
    when one source host rapidly connects to and writes files on many distinct destination
    hosts, we can detect this network-wide encryption activity.
  answer_sources:
  - Windows Event ID 5145
  - Zeek smb_files.log
  - Relevant assets include File servers, Network Attached Storage (NAS) devices,
    SMB/CIFS shares
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      AGGREGATE smb_write_rename_logs by source_ip in 5-minute window
      COUNT distinct destination_ip
      IF distinct_destination_count > 10:
        ALERT
- question: Is any host writing to a statistically anomalous number of distinct network
    shares compared to its own historical baseline?
  context: This statistical question provides a more tailored version of the previous
    symbolic rule. Instead of a fixed threshold, it compares a host's current SMB
    write activity to its own past behavior. An alert is triggered if a host suddenly
    starts writing to a number of shares that is in the top percentile of its normal
    activity, indicating a significant deviation that could be caused by ransomware
    spreading.
  answer_sources:
  - Windows Event ID 5145
  - Zeek smb_files.log
  - Relevant assets include File servers, Network Attached Storage (NAS) devices,
    SMB/CIFS shares
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR each source_host:
        CALCULATE distinct_shares_written_to per hour
        IF count > 98th_percentile_of_baseline:
          ALERT
- question: Using a graph-based model of SMB connections, has any host shown anomalous
    behavior by rapidly connecting to and writing on hosts outside its normal 'community'?
  context: This question uses a sophisticated graph-based machine learning approach
    to model network relationships. Normal operations show hosts connecting to a
    relatively stable set of servers (their community). Ransomware spreading laterally
    breaks this pattern, creating many new connections (edges) to hosts outside its
    normal community. Detecting this structural anomaly in the network graph can
    identify the source of a ransomware worm.
  answer_sources:
  - Zeek conn.log
  - Zeek smb_files.log
  - Relevant assets include File servers, Network Attached Storage (NAS) devices,
    SMB/CIFS shares
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      MODEL hosts and SMB writes as a graph
      IDENTIFY communities of normal activity
      IF a host rapidly creates edges to nodes outside its community:
        ALERT
- question: Has any process modified, renamed, or deleted a designated canary file?
  context: This question represents one of the highest-fidelity detection methods.
    Canary files (or honeyfiles) are bait files with no legitimate purpose, placed
    in strategic locations. Auditing is enabled so that any interaction with them
    generates an alert. Because no legitimate process should ever touch these files,
    any modification alert is a nearly certain indicator of malicious activity, such
    as a ransomware process beginning its encryption sweep.
  answer_sources:
  - Windows Event ID 4663
  - Windows Event ID 11 (Sysmon)
  - Windows Event ID 23 (Sysmon)
  - Zeek smb_files.log
  - Relevant assets include Designated canary file directories on high-value file
    shares, Hidden directories in user profiles, Root directories of mapped network
    drives, Bait directories with enticing names like 'Executive Salaries' or 'Passwords'
    on file servers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      SEARCH file_operation_logs
      WHERE file_path IN (list_of_canary_files) AND operation IN (modify, rename, delete)
      TRIGGER critical alert
- question: Has there been a statistically significant increase in read attempts
    within directories containing canary files, even if the files themselves haven't
    been modified?
  context: This question provides a statistical early-warning signal. Before encrypting
    files, a ransomware process must first enumerate directories. This can result
    in a burst of read operations in a directory containing a canary file. While
    not as definitive as a modification, a sudden spike in reads from a single process
    in a honey-directory can indicate that a malicious process is scanning the directory,
    providing an opportunity for detection before encryption begins.
  answer_sources:
  - Windows Event ID 4663
  - Relevant assets include Designated canary file directories on high-value file
    shares, Hidden directories in user profiles, Root directories of mapped network
    drives, Bait directories with enticing names like 'Executive Salaries' or 'Passwords'
    on file servers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      AGGREGATE file_read_events in canary_directories by process in 1-minute window
      IF read_count > 10:
        ALERT as early_warning
- question: Can a definitive alert from a canary file modification be used to automatically
    retrain and improve other behavioral machine learning models in real-time?
  context: This question describes a powerful feedback loop for improving ML-based
    detections. An alert from a modified canary file is a ground-truth label the
    process that triggered it is definitively malicious. This confirmed event can
    be automatically fed back as a new training example to other, more heuristic
    models (like a process risk-scoring model), helping them learn and become more
    accurate at identifying similar threats in the future.
  answer_sources:
  - Windows Event ID 4663
  - Windows Event ID 11 (Sysmon)
  - Relevant assets include Designated canary file directories on high-value file
    shares, Hidden directories in user profiles, Root directories of mapped network
    drives, Bait directories with enticing names like 'Executive Salaries' or 'Passwords'
    on file servers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      WHEN canary_file_alert is triggered:
        EXTRACT features of the malicious_process
        ADD (features, label='malicious') to training_dataset
        SCHEDULE retraining of behavioral_ML_models
- question: Has the desktop wallpaper been changed via the command line or registry,
    or have files matching ransom note naming patterns been created in common user
    directories?
  context: This question targets the final, visible artifacts of a ransomware attack.
    Ransomware often changes the user's wallpaper to the ransom note and/or drops
    text files with instructions in prominent locations. This rule looks for the
    specific commands used to change the wallpaper or the creation of files with
    names like 'README.txt' or 'RECOVER_FILES.html' to detect this activity.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 1 (Sysmon)
  - Windows Event ID 4657
  - Windows Event ID 11 (Sysmon)
  - Windows Event ID 4663
  - Relevant assets include User desktops, Public and All Users directories, Web
    server root directories, Shared network drive root directories
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      SEARCH process_creation_logs OR registry_modification_logs
      WHERE command MATCHES 'reg.exe add ... Wallpaper' OR registry_key MATCHES '...Control Panel\Desktop\Wallpaper'
      ---
      SEARCH file_creation_logs in common_directories
      WHERE file_name MATCHES (ransom_note_patterns)
- question: Has there been a statistically anomalous spike in the creation of .txt
    or .html files across multiple top-level directories on a single host?
  context: This question looks for the behavior of 'spamming' ransom notes. Some
    ransomware creates its instruction file in many different directories to ensure
    the user finds it. By baselining the normal rate of .txt/.html file creation
    in key directories, we can statistically detect a sudden, widespread creation
    of these files by a single process, which is highly indicative of ransom note
    dropping.
  answer_sources:
  - Windows Event ID 11 (Sysmon)
  - Windows Event ID 4663
  - Relevant assets include User desktops, Public and All Users directories, Web
    server root directories, Shared network drive root directories
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR each host:
        AGGREGATE .txt_and_.html_creation_events in top-level_directories per minute
        IF count > (baseline + 3 * std_dev):
          ALERT
- question: Has a machine learning text classification model identified the content
    of a newly created .txt or .html file as a likely ransom note?
  context: This question moves beyond just filenames and looks at file content. By
    training a text classification model on a large corpus of known ransom notes,
    it can learn to identify the language, keywords (e.g., 'bitcoin', 'encrypt',
    'private key'), and structure of a ransom demand. This allows the system to analyze
    the content of newly created text files and alert if they are classified as a
    ransom note, even if the filename is not suspicious.
  answer_sources:
  - Windows Event ID 11 (Sysmon)
  - Windows Event ID 4663
  - Relevant assets include User desktops, Public and All Users directories, Web
    server root directories, Shared network drive root directories
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR each new .txt or .html file_creation_event:
        READ file content
        SCORE content with trained_text_classifier
        IF score > ransom_note_threshold:
          ALERT