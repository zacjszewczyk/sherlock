name: T1098: Account Manipulation
id: a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d
description: This playbook focuses on detecting adversary activity related to MITRE ATT&CK technique T1098 Account Manipulation. It addresses two primary information requirements whether an adversary is maintaining persistence and whether they are escalating privileges. The playbook provides investigative questions to identify suspicious account modifications, such as those originating from malicious IPs, changes to password policies, manipulation of dormant accounts, actions outside business hours, additions to privileged groups, and modifications to critical Active Directory security descriptors.
type: technique
related:
- TA0003: Persistence
- TA0004: Privilege Escalation
contributors:
- Zachary Szewczyk
- Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
- question: Are successful account modifications originating from known malicious IP addresses or anonymizing services?
  context: This symbolic check correlates the source IP of an account modification event (e.g., password reset) against a threat intelligence feed of known malicious IPs (e.g., C2 servers, TOR exit nodes). A match is a high-fidelity indicator that an external adversary is manipulating an account for persistence and should be investigated with high priority.
  answer_sources:
  - Windows Event ID 4738
  - Windows Event ID 4724
  - Zeek conn.log
  - Domain Controllers
  - Authentication Servers
  - Internet Gateway
  range: last 90 days
  queries:
  - query_type: pseudocode
    query: |
      SEARCH (EventID:4738 OR EventID:4724) AND Status:Success
      JOIN 'Source Network Address' with Threat_Intel_Feed.IP
      WHERE Threat_Intel_Feed.IP IS NOT NULL
      TRIGGER High-Priority Alert
- question: Are account modifications originating from IP addresses that are statistically rare for the target user or from an unusual distribution of source countries?
  context: This statistical approach finds anomalies without known-bad indicators. An IP rarely used for a specific user's modifications could be an attacker's infrastructure. Similarly, a sudden spike in the diversity of source countries for account changes across the organization (measured by Shannon entropy) can indicate a widespread, coordinated attack.
  answer_sources:
  - Windows Event ID 4738
  - Windows Event ID 4724
  - Zeek conn.log
  - Domain Controllers
  - Authentication Servers
  - Internet Gateway
  range: last 90 days
  queries:
  - query_type: pseudocode
    query: |
      // IP Rarity Check
      FOR each user, CALCULATE historical IP frequency.
      FOR each modification event, IF source_IP_frequency < 1st_percentile for user, FLAG event.
      // Country Entropy Check
      CALCULATE Shannon entropy of source countries for all modifications in a 24hr window.
      IF entropy > (baseline_entropy + 3 * std_dev), ALERT.
- question: Is there an anomalous burst of account modification activity detected by a time-series forecasting model?
  context: This machine learning approach models the normal rhythm of account modification activity, including weekly seasonality. A time-series model (e.g., SARIMA) predicts the expected volume. When the actual number of events significantly exceeds the forecast's upper confidence bound, it indicates an unusual spike that could be caused by an automated attack.
  answer_sources:
  - Windows Event ID 4738
  - Windows Event ID 4724
  - Zeek conn.log
  - Domain Controllers
  - Authentication Servers
  - Internet Gateway
  range: last 90 days
  queries:
  - query_type: pseudocode
    query: |
      AGGREGATE hourly count of (EventID:4738 OR EventID:4724).
      TRAIN SARIMA model on historical hourly counts.
      FORECAST expected count and 99% confidence interval.
      IF actual_count > upper_bound_of_confidence_interval, ALERT.
- question: Has an account's 'UserAccountControl' attribute been modified to set the 'DONT_EXPIRE_PASSWD' flag?
  context: This symbolic rule detects a specific, high-risk change. Adversaries set the 'DONT_EXPIRE_PASSWD' flag on a compromised account to ensure their access persists indefinitely without being disrupted by password expiration policies. This is especially critical if the target account is privileged, a service account, or otherwise high-value.
  answer_sources:
  - Windows Event ID 4738
  - Windows Event ID 4739
  - Domain Controllers
  - Active Directory Database
  range: last 90 days
  queries:
  - query_type: pseudocode
    query: |
      SEARCH EventID:4738 AND 'UserAccountControl' change includes 'DONT_EXPIRE_PASSWD' flag (0x10000).
      IF TargetAccount is privileged or on watchlist, TRIGGER High-Priority Alert.
- question: Is there a statistical anomaly in the rate of accounts being set to never have their password expire?
  context: This statistical method monitors the population of accounts with the 'DONT_EXPIRE_PASSWD' flag. By establishing a baseline for how often this flag is legitimately set, it can detect abnormal increases. A sudden spike in new additions exceeding the moving average by several standard deviations can indicate an adversary applying this persistence mechanism at scale.
  answer_sources:
  - Windows Event ID 4738
  - Windows Event ID 4739
  - Domain Controllers
  - Active Directory Database
  range: last 90 days
  queries:
  - query_type: pseudocode
    query: |
      MONITOR new accounts with 'DONT_EXPIRE_PASSWD' flag.
      CALCULATE weekly moving average and standard deviation of additions.
      IF additions_in_24hrs > (moving_average + 3 * std_dev), ALERT.
- question: Can an unsupervised machine learning model identify anomalous account attribute modifications?
  context: This machine learning approach (e.g., Isolation Forest) profiles normal administrative behavior based on features like the attribute changed, time of day, and accounts involved. It can identify subtle, outlier modifications that do not match any specific rule but deviate from established patterns, potentially revealing novel or stealthy persistence techniques.
  answer_sources:
  - Windows Event ID 4738
  - Windows Event ID 4739
  - Domain Controllers
  - Active Directory Database
  range: last 90 days
  queries:
  - query_type: pseudocode
    query: |
      EXTRACT features from EventID 4738: attribute_changed, time_of_day, day_of_week, subject_group, target_group.
      TRAIN Isolation Forest model on historical modification events.
      PREDICT anomalies in new modification events.
      IF anomaly_score is high, ALERT.
- question: Has a dormant account (e.g., no logon for 90+ days) suddenly shown activity?
  context: This symbolic rule focuses on high-risk accounts. Dormant accounts, especially those of former employees, are prime targets for adversaries because their reactivation is inherently suspicious. Any successful logon, password reset, or modification of such an account is a strong indicator of compromise and warrants an immediate, high-priority investigation.
  answer_sources:
  - Windows Event ID 4724
  - Windows Event ID 4738
  - Windows Event ID 4624
  - Domain Controllers
  - Authentication Logs
  - HR System
  range: last 90 days
  queries:
  - query_type: pseudocode
    query: |
      MAINTAIN watchlist of dormant accounts (last logon > 90 days).
      ALERT if account on watchlist generates EventID 4624, 4724, or 4738.
- question: Has a user logged on after a statistically unusual period of inactivity?
  context: This statistical analysis examines the logon cadence for each user. It establishes a baseline for how frequently a user typically logs on. A logon that occurs after a time delta exceeding the 99th percentile of that user's historical logon gaps (or a global 90-day threshold) is a statistical anomaly that could indicate account hijacking.
  answer_sources:
  - Windows Event ID 4724
  - Windows Event ID 4738
  - Windows Event ID 4624
  - Domain Controllers
  - Authentication Logs
  - HR System
  range: last 90 days
  queries:
  - query_type: pseudocode
    query: |
      FOR each successful logon (EventID 4624):
        CALCULATE time_delta since user's previous logon.
        IF time_delta > 99th_percentile_for_user OR time_delta > 90_days, FLAG for review.
- question: Has a user account abruptly transitioned from a low-activity to a high-activity state?
  context: This machine learning approach uses clustering (e.g., K-Means) to group users into activity profiles (e.g., 'dormant', 'low-activity', 'high-activity') based on logon frequency and session data. An account suddenly moving from a 'dormant' cluster to a 'high-activity' cluster is a significant behavioral change that strongly suggests the account has been compromised.
  answer_sources:
  - Windows Event ID 4724
  - Windows Event ID 4738
  - Windows Event ID 4624
  - Domain Controllers
  - Authentication Logs
  - HR System
  range: last 90 days
  queries:
  - query_type: pseudocode
    query: |
      CLUSTER users based on logon_frequency, session_duration, unique_systems_accessed.
      MONITOR for users transitioning from 'low-activity' cluster to 'high-activity' cluster.
      FLAG such transitions for immediate review.
- question: Was a sensitive account modification performed by an unauthorized administrative account?
  context: This symbolic rule enforces separation of duties and authorized access. It checks if an account modification (like a password reset) was performed by a user who is not a member of a pre-defined authorized group (e.g., 'Helpdesk', 'Domain Admins'). Any such action is a policy violation and a potential sign of privilege abuse or a compromised non-admin account.
  answer_sources:
  - Windows Event ID 4738
  - Windows Event ID 4724
  - Windows Event ID 4739
  - Domain Controllers
  - Helpdesk Systems
  - Privileged Access Workstations (PAWs)
  range: last 90 days
  queries:
  - query_type: pseudocode
    query: |
      DEFINE list of authorized admin groups.
      ON EventID 4738 or 4724, CHECK if 'Subject' account is member of authorized groups.
      IF NOT, TRIGGER Alert.
- question: Was an account modification performed by an administrator outside of their typical working hours?
  context: This statistical method baselines the normal activity hours for each individual administrator. An action performed by an admin at a time that is highly unusual for them (e.g., 3 AM for someone who works 9-5) is a behavioral anomaly. This can detect compromised admin accounts being used by attackers in different time zones or during off-hours to avoid detection.
  answer_sources:
  - Windows Event ID 4738
  - Windows Event ID 4724
  - Windows Event ID 4739
  - Domain Controllers
  - Helpdesk Systems
  - Privileged Access Workstations (PAWs)
  range: last 90 days
  queries:
  - query_type: pseudocode
    query: |
      FOR each admin, BASELINE historical activity by 'hour of the week'.
      FOR each new modification event, CHECK if 'hour of the week' is outside the 5th-95th percentile of that admin's baseline.
      IF outside, FLAG as anomalous.
- question: Can a machine learning model classify an account modification as suspicious based on its context?
  context: This advanced ML approach uses a classification model (e.g., Gradient Boosting) to make a holistic judgment about whether a modification is suspicious. It considers a wide array of features, including time, source IP geolocation, and the historical relationship between the administrator and the target account. This allows it to detect complex, multi-faceted anomalies that simpler methods might miss.
  answer_sources:
  - Windows Event ID 4738
  - Windows Event ID 4724
  - Windows Event ID 4739
  - Zeek conn.log
  - Domain Controllers
  - Helpdesk Systems
  - Privileged Access Workstations (PAWs)
  range: last 90 days
  queries:
  - query_type: pseudocode
    query: |
      TRAIN classification model with features: time, day, source_geo, subject_groups, target_groups, subject-target_interaction_frequency.
      PREDICT 'suspicious' probability for new events.
      IF probability > 0.9, ALERT.
- question: Was a user added to a privileged group by an anomalous parent process?
  context: This symbolic rule provides crucial context for a privilege escalation event. By correlating the group addition event with the process that initiated it, we can check if the action was performed by a legitimate administrative tool. If the parent process is something unexpected, like 'winword.exe', it is a strong indicator that an exploit or macro was used to escalate privileges.
  answer_sources:
  - Windows Event ID 4728
  - Windows Event ID 4732
  - Windows Event ID 4756
  - Windows Event ID 4688
  - Domain Controllers
  - Endpoints
  range: last 90 days
  queries:
  - query_type: pseudocode
    query: |
      ON privileged group add (EventID 4728, 4732, 4756):
        CORRELATE Logon ID with EventID 4688 to find parent process.
        IF process name is NOT on admin tool allowlist, ALERT.
- question: Was a user added to a privileged group by a statistically rare parent process?
  context: This statistical approach identifies suspicious privilege escalations by finding parent processes that are rarely associated with such actions. While not on a specific blocklist, a process that has historically almost never been responsible for adding a user to a privileged group is an anomaly. This can uncover novel or custom attacker tools being used for escalation.
  answer_sources:
  - Windows Event ID 4728
  - Windows Event ID 4732
  - Windows Event ID 4756
  - Windows Event ID 4688
  - Domain Controllers
  - Endpoints
  range: last 90 days
  queries:
  - query_type: pseudocode
    query: |
      MAINTAIN frequency count of parent processes for privileged group additions.
      ALERT when an addition is triggered by a process in the bottom 5th percentile of historical frequency.
- question: Can graph-based anomaly detection identify unusual nodes involved in privilege escalation?
  context: This machine learning technique models relationships between users, processes, and groups as a graph. Algorithms like PageRank can then identify nodes (e.g., a specific user or process) that have an unusually high influence over privileged group additions. This can pinpoint a compromised account or malicious tool that is the central point of an escalation campaign.
  answer_sources:
  - Windows Event ID 4728
  - Windows Event ID 4732
  - Windows Event ID 4756
  - Windows Event ID 4688
  - Domain Controllers
  - Endpoints
  range: last 90 days
  queries:
  - query_type: pseudocode
    query: |
      CONSTRUCT a process-user-group interaction graph from security events.
      RUN graph-based anomaly detection (e.g., PageRank) to find nodes with unusually high influence scores related to privileged group additions.
      FLAG anomalous nodes for investigation.
- question: Was a new account created and immediately added to a privileged group?
  context: This symbolic rule detects a classic "create and elevate" adversary tactic. Creating a new user and adding it to a privileged group within a very short time window (e.g., 5 minutes) is highly suspicious behavior. It allows the adversary to create their own persistent, privileged backdoor account.
  answer_sources:
  - Windows Event ID 4720
  - Windows Event ID 4728
  - Windows Event ID 4732
  - Windows Event ID 4756
  - Domain Controllers
  range: last 90 days
  queries:
  - query_type: pseudocode
    query: |
      TRIGGER when EventID 4720 (creation) is followed by EventID 4728, 4732, or 4756 (privileged add) for the same account SID within 5 minutes.
- question: Does a new, privileged account have a suspicious username?
  context: This statistical method scrutinizes the names of newly created privileged accounts. A username with high entropy (random characters) or a name that is a close misspelling of an existing admin account (typosquatting, measured by Levenshtein distance) are red flags. This suggests an adversary is trying to create an account that either blends in or is hard to track.
  answer_sources:
  - Windows Event ID 4720
  - Windows Event ID 4728
  - Windows Event ID 4732
  - Windows Event ID 4756
  - Domain Controllers
  range: last 90 days
  queries:
  - query_type: pseudocode
    query: |
      FOR new accounts added to privileged groups:
        CALCULATE Shannon entropy of username.
        CALCULATE Levenshtein distance to existing privileged accounts.
        IF entropy is in top 5th percentile OR Levenshtein distance is < 3, ALERT.
- question: Does the sequence of events following a new account creation appear anomalous?
  context: This machine learning approach uses a Hidden Markov Model (HMM) to learn the normal "life cycle" of a new account (e.g., 'Created' -> 'Added to Standard Group' -> 'Logged On'). A sequence like 'Created -> Added to Domain Admins' is an extremely low-probability transition in a normal environment and would be flagged by the model as a severe anomaly, indicating privilege escalation.
  answer_sources:
  - Windows Event ID 4720
  - Windows Event ID 4728
  - Windows Event ID 4732
  - Windows Event ID 4756
  - Domain Controllers
  range: last 90 days
  queries:
  - query_type: pseudocode
    query: |
      TRAIN a Hidden Markov Model on normal event sequences following account creation (EventID 4720).
      CALCULATE the probability of the observed event sequence for a new account.
      IF a sequence like 'Created -> Added to Privileged Group' has a very low probability, FLAG as anomalous.
- question: Was a user added to a privileged group by an account not authorized for such actions?
  context: This is a critical symbolic check for access control violations. For every privileged group addition, this rule verifies that the account performing the action ('Subject') is a member of a pre-defined list of authorized administrator groups (e.g., 'Domain Admins'). If not, it means an unauthorized account has gained the ability to grant privileges, a clear sign of compromise.
  answer_sources:
  - Windows Event ID 4728
  - Windows Event ID 4732
  - Windows Event ID 4756
  - Domain Controllers
  range: last 90 days
  queries:
  - query_type: pseudocode
    query: |
      FOR every privileged group addition (4728, 4732, 4756):
        ENRICH with group memberships of the 'Subject' account.
        IF 'Subject' is NOT in authorized admin group list, TRIGGER High-Severity Alert.
- question: Was a privileged group membership change performed by an unusual administrator-group pair?
  context: This statistical method baselines which administrators typically manage which privileged groups. It flags actions that deviate from this norm, such as a helpdesk admin who normally only manages 'Local Admins' suddenly adding a user to 'Enterprise Admins'. This can detect an administrator's account being misused beyond its normal scope.
  answer_sources:
  - Windows Event ID 4728
  - Windows Event ID 4732
  - Windows Event ID 4756
  - Domain Controllers
  range: last 90 days
  queries:
  - query_type: pseudocode
    query: |
      MAINTAIN a baseline matrix of (Admin, Group) pair frequencies for additions.
      FLAG any new addition where the (Admin, Group) pair has never been seen or is in the bottom 5th percentile of historical frequency.
- question: Did an administrator perform a privileged group addition that is anomalous for their behavioral cluster?
  context: This machine learning approach (e.g., DBSCAN) groups administrators into clusters based on their typical actions. An alert is generated when an administrator performs an action, like a privileged group addition, that is inconsistent with their cluster's normal behavior (e.g., a 'Helpdesk' cluster admin performing a 'Schema Admins' group modification).
  answer_sources:
  - Windows Event ID 4728
  - Windows Event ID 4732
  - Windows Event ID 4756
  - Domain Controllers
  range: last 90 days
  queries:
  - query_type: pseudocode
    query: |
      CLUSTER admin accounts based on types of actions performed.
      GENERATE alert when an admin performs a privileged group addition that is anomalous for their assigned cluster.
- question: Was the security descriptor modified on a critical Active Directory object like AdminSDHolder?
  context: This symbolic rule is a critical-severity check for one of the most powerful persistence and escalation techniques in Active Directory. Modifying the 'nTSecurityDescriptor' on objects like 'AdminSDHolder' or the 'Domain Admins' group can grant an attacker's account persistent, resilient administrative rights. Any such change must be immediately investigated.
  answer_sources:
  - Windows Event ID 5136
  - Windows Event ID 4670
  - Domain Controllers (PDC Emulator FSMO role)
  range: last 90 days
  queries:
  - query_type: pseudocode
    query: |
      CREATE critical alert on EventID 5136 WHERE 'Object DN' is on a watchlist of critical objects (e.g., AdminSDHolder)
      AND 'Attribute LDAP Display Name' is 'nTSecurityDescriptor'.
- question: Is there a statistically significant increase in the rate of security descriptor modifications across Active Directory?
  context: This statistical method monitors the overall rate of 'nTSecurityDescriptor' modifications (Event ID 5136). While individual changes can be legitimate, a sudden spike in the volume of these events across the directory could indicate a large-scale, automated attack where an adversary is attempting to modify permissions on many objects at once (e.g., a "DCSync" rights attack).
  answer_sources:
  - Windows Event ID 5136
  - Windows Event ID 4670
  - Domain Controllers (PDC Emulator FSMO role)
  range: last 90 days
  queries:
  - query_type: pseudocode
    query: |
      TRACK the rate of nTSecurityDescriptor modifications (EventID 5136).
      CALCULATE a baseline rate (e.g., weekly moving average).
      TRIGGER alert if the event count in 24 hours exceeds the baseline by 2 standard deviations.
- question: Can a machine learning model automatically flag high-risk security descriptor (SDDL) changes?
  context: This advanced ML approach involves parsing the complex Security Descriptor Definition Language (SDDL) string from the event log. By extracting features like the trustee, access rights (Full Control, Write DACL), and ACE type, a classification model can be trained to distinguish between benign administrative changes and malicious modifications that grant dangerous permissions.
  answer_sources:
  - Windows Event ID 5136
  - Windows Event ID 4670
  - Domain Controllers (PDC Emulator FSMO role)
  range: last 90 days
  queries:
  - query_type: pseudocode
    query: |
      PARSE SDDL string from 'Value' field of EventID 5136.
      EXTRACT features: trustee, access rights, ACE type.
      TRAIN classification model on labeled benign/malicious SDDL changes.
      USE model to flag new high-risk modifications.