name: T1001.002: Steganography
id: c4d9a8e2-b1f0-4c8a-9d6e-8f0a1b2c3d4e
description: This playbook helps determine if an adversary is using steganography to hide data for command and control communications. It provides investigative questions to detect this technique by identifying known steganography tool hashes or C2 infrastructure, analyzing files for steganographic signatures or anomalous metadata, detecting statistical outliers in file sizes, observing unusual network activity from non-network-aware processes, and analyzing the entropy of image file LSB planes to uncover hidden, random-like data.
type: technique
related:
  - TA0011: Command and Control
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Are file hashes or network indicators matching known steganography tools or command and control infrastructure present on the network?
    context: This question seeks to find direct evidence of steganography tools or related C2 infrastructure by continuously comparing observed file and process hashes against threat intelligence feeds of known steganography tool hashes. It also involves checking network connection logs for destination IPs and DNS queries that match known malicious C2 infrastructure lists. A match provides a high-confidence indicator of compromise.
    answer_sources:
      - Zeek files.log
      - Windows Event ID 4688
      - Zeek conn.log
      - Zeek dns.log
      - Internet Gateways
      - DNS Resolvers
      - Proxy Servers
      - Endpoints
    range: last 90 days
    queries:
      - platform: pseudocode
        query: SEARCH (file_hashes OR process_hashes) IN (steganography_tool_hash_feed) OR (destination_ips OR dns_queries) IN (malicious_c2_feed)
  - question: Are there connections to rare external destinations that are also listed on threat intelligence watchlists?
    context: This question aims to find suspicious connections that might not be on a high-confidence blocklist but are unusual for the organization. By calculating the frequency of connections to all external IPs and domains, analysts can identify rare destinations. If these rare destinations also appear on lower-confidence threat intelligence lists, it increases the likelihood of malicious activity, potentially related to steganography C2.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Internet Gateways
      - DNS Resolvers
      - Proxy Servers
      - Endpoints
    range: last 90 days
    queries:
      - platform: pseudocode
        query: CALCULATE frequency of all destination_ips over 30_days. FIND rare_destinations (e.g., bottom 5%). CHECK if rare_destinations IN (suspicious_cti_watchlist).
  - question: Are there DNS requests for domains classified as malicious or algorithmically generated, especially if they are associated with file uploads?
    context: This question uses a machine learning approach to proactively identify potentially malicious domains that might be used for steganographic C2. The model analyzes domain characteristics (length, entropy, TLD, age) to score its maliciousness. Correlating a high-scoring domain with file upload activity (identified from network traffic logs) provides a strong signal for investigation into steganography.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - Zeek files.log
      - Internet Gateways
      - DNS Resolvers
      - Proxy Servers
      - Endpoints
    range: last 90 days
    queries:
      - platform: pseudocode
        query: CLASSIFY domains from dns.log using ML_model. IF score > threshold AND domain associated with file_upload, THEN alert.
  - question: Are there files being transferred that contain known signatures or watermarks from steganography tools?
    context: This question involves a direct search for evidence of specific steganography tools within the content of files transferred over the network. By using YARA or regex rules to scan extracted files for known tool-specific strings (like 'stegdetect', 'OpenStego') or byte patterns in headers, footers, or metadata fields, we can find definitive proof of steganography usage.
    answer_sources:
      - Zeek files.log
      - Network Security Monitoring (NSM) Sensor Grid
      - Internet Gateways
      - File Servers
    range: last 90 days
    queries:
      - platform: pseudocode
        query: SCAN extracted_file_content with YARA_rules for steganography_tool_signatures. ALERT on match.
  - question: Are there files with statistically anomalous metadata fields, such as unusually large comment sections?
    context: Adversaries may hide data in legitimate metadata fields. This question focuses on detecting this by baselining normal values and lengths for metadata fields in common file types (e.g., JPEG, PNG, PDF). A file with a metadata field that is a statistical outlier (e.g., a comment field far larger than the 99th percentile for that file type) is suspicious and could be hiding data.
    answer_sources:
      - Zeek files.log
      - Network Security Monitoring (NSM) Sensor Grid
      - Internet Gateways
      - File Servers
    range: last 90 days
    queries:
      - platform: pseudocode
        query: BASELINE metadata_field_lengths for each file_type. FOR each new_file, CHECK if metadata_field_length is a statistical_outlier. ALERT if true.
  - question: Can a machine learning model classify any transferred files as likely containing steganographic content based on their internal structure?
    context: This question leverages machine learning to identify subtle structural changes steganography introduces. By training a classifier on features like the size and entropy of different file segments (e.g., EXIF chunks in JPEGs, iTXt chunks in PNGs), the model can learn to distinguish between normal and manipulated files. A high probability score from the classifier indicates a likely steganographic payload.
    answer_sources:
      - Zeek files.log
      - Network Security Monitoring (NSM) Sensor Grid
      - Internet Gateways
      - File Servers
    range: last 90 days
    queries:
      - platform: pseudocode
        query: EXTRACT structural_features from files. CLASSIFY file using ML_steganography_model. IF probability > threshold, THEN alert.
  - question: Are highly standardized files, like company logos or icons, being transferred with sizes that exceed predefined thresholds?
    context: For files that should have a consistent and predictable size (e.g., website favicons, UI icons), any significant deviation is highly anomalous. This question involves setting simple, hard-coded size limits for these specific file types. An alert is triggered if a file exceeds its threshold, suggesting it may have been modified to carry extra data.
    answer_sources:
      - Zeek files.log
      - Internet Gateways
      - Web Application Servers
      - Content Delivery Networks (CDNs)
    range: last 90 days
    queries:
      - platform: pseudocode
        query: DEFINE static_size_thresholds for standard_file_types (e.g., favicon.ico < 100KB). ALERT if transferred_file_size > threshold.
  - question: Are any transferred files a statistical outlier in size compared to other files of the same type?
    context: This question aims to detect anomalously large files that could be carrying hidden data. By maintaining a rolling baseline of file sizes for each MIME type, we can use statistical methods like Z-score or the Interquartile Range (IQR) to identify outliers. A file significantly larger than its peers (e.g., Z-score > 3) is suspicious and warrants investigation.
    answer_sources:
      - Zeek files.log
      - Internet Gateways
      - Web Application Servers
      - Content Delivery Networks (CDNs)
    range: last 90 days
    queries:
      - platform: pseudocode
        query: MAINTAIN rolling_baseline of file_sizes per MIME_type. FOR each new_file, CALCULATE Z-score. ALERT if Z-score > 3.
  - question: Has there been an unpredicted spike in the total data volume for specific file types transferred over the network?
    context: This question analyzes aggregate data transfer volumes over time. By using a time series forecasting model (like SARIMA or Prophet), we can predict the expected volume of data for certain file types (e.g., 'image/png') per hour. A significant, unexplained spike in traffic that deviates from the model's prediction could indicate a large-scale data transfer using steganography.
    answer_sources:
      - Zeek files.log
      - Internet Gateways
      - Web Application Servers
      - Content Delivery Networks (CDNs)
    range: last 90 days
    queries:
      - platform: pseudocode
        query: MODEL hourly_data_volume per file_type using time_series_forecast. ALERT if actual_volume significantly exceeds predicted_volume_confidence_interval.
  - question: Is a process that is not on the network-approved whitelist, such as mspaint.exe, making an outbound network connection?
    context: Certain applications like Notepad or Paint have no legitimate reason to make network connections. This question involves creating a whitelist of processes that are allowed to communicate over the network. By monitoring process creation and network connection events, an alert can be triggered for any process that makes a connection but is not on the approved list.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 5156
      - Sysmon Event ID 3
      - Zeek conn.log
      - User Workstations
      - Terminal Servers
      - Virtual Desktop Infrastructure (VDI) Environments
    range: last 90 days
    queries:
      - platform: pseudocode
        query: CORRELATE process_creation_events with network_connection_events. ALERT if connecting_process_name NOT IN network_process_whitelist.
  - question: Is a statistically rare process making a network connection, especially one involving a file transfer?
    context: This question focuses on identifying anomalous process behavior by finding processes that rarely, if ever, make network connections across the enterprise. By baselining process network activity, we can flag any connection from a process in the bottom percentile of frequency (e.g., 'mspaint.exe'). This is highly suspicious, and becomes more so if network logs show the connection involves a file transfer.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 5156
      - Sysmon Event ID 3
      - Zeek conn.log
      - User Workstations
      - Terminal Servers
      - Virtual Desktop Infrastructure (VDI) Environments
    range: last 90 days
    queries:
      - platform: pseudocode
        query: BASELINE frequency of all connecting_processes. ALERT if a rare_process (e.g., bottom 1%) makes a network_connection.
  - question: Has any endpoint been clustered into a group characterized by anomalous process-to-network behavior?
    context: This question uses unsupervised machine learning to group endpoints with similar behaviors. An endpoint is represented by a vector of its process and network activities. If an endpoint suddenly moves from a large, 'normal' cluster into a small, new cluster defined by unusual behavior (like text editors making network calls), it signifies a significant deviation from its baseline and is a strong candidate for compromise.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 5156
      - Sysmon Event ID 3
      - Zeek conn.log
      - User Workstations
      - Terminal Servers
      - Virtual Desktop Infrastructure (VDI) Environments
    range: last 90 days
    queries:
      - platform: pseudocode
        query: CLUSTER endpoints based on process_and_network_behavior_vectors. ALERT if endpoint moves to an anomalous, sparsely_populated_cluster.
  - question: Does the least-significant bit (LSB) data of a transferred image contain a recognizable file header?
    context: This is a highly reliable method for detecting steganography. It involves programmatically extracting the least-significant bits from an image's pixel data to form a separate bitstream. This bitstream is then scanned for 'magic numbers' or headers of known file types (like 'PK' for a ZIP file). Finding a complete file header embedded in the LSBs is definitive proof that another file is hidden inside the image.
    answer_sources:
      - Zeek files.log
      - Network Security Monitoring (NSM) Sensor Grid
      - Data Loss Prevention (DLP) Systems
    range: last 90 days
    queries:
      - platform: pseudocode
        query: FOR each image_file, EXTRACT LSB_plane_data. SCAN LSB_data for known_file_headers (e.g., 'PK', '%PDF'). ALERT on match.
  - question: Does the least-significant bit (LSB) plane of a transferred image exhibit a statistically random distribution of byte values, unlike natural images?
    context: Encrypted or compressed data is statistically indistinguishable from random noise, whereas natural images have correlations in their LSBs. This question uses a chi-square goodness-of-fit test to check if the LSB data of an image follows a uniform (random) distribution. If the LSB plane appears random while higher-order bit planes do not, it strongly suggests an encrypted payload has been hidden using LSB steganography.
    answer_sources:
      - Zeek files.log
      - Network Security Monitoring (NSM) Sensor Grid
      - Data Loss Prevention (DLP) Systems
    range: last 90 days
    queries:
      - platform: pseudocode
        query: FOR each image_file, EXTRACT LSB_plane_data. PERFORM chi-square_test for uniform_distribution. ALERT if LSB_data is random-like (p > 0.05).
  - question: Can a specialized convolutional neural network (CNN) model classify any transferred images as containing steganographic content?
    context: This question leverages advanced machine learning with a CNN specifically trained for steganalysis. These models can detect very subtle statistical changes and artifacts in the pixel domain that are introduced by steganographic embedding algorithms but are invisible to the human eye or simpler statistical tests. A high-confidence classification from such a model is a strong indicator of steganography.
    answer_sources:
      - Zeek files.log
      - Network Security Monitoring (NSM) Sensor Grid
      - Data Loss Prevention (DLP) Systems
    range: last 90 days
    queries:
      - platform: pseudocode
        query: FEED extracted_images into steganalysis_CNN_model. ALERT if classification_confidence is high.