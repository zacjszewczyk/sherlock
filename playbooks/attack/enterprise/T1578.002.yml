name: T1578.002: Create Cloud Instance
id: a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d
description: |
  This playbook helps determine if an adversary is creating new cloud instances to evade defenses or stage data.
  Investigative focus is placed on several key indicators of malicious activity. This includes instance creation events originating from known malicious IP addresses or using unapproved public images. It also covers instances with suspicious names, tags, or User-Agent strings, such as those with high entropy or matching signatures of offensive tools. The playbook addresses potential account compromise by examining instances created by dormant, newly created, or anomalously active user principals. Additionally, it scrutinizes instance configurations that are statistically rare for the organization, like deployment in unused regions, non-standard instance types, or overly permissive security group rules. Finally, it looks for suspicious sequences of API calls, such as the rapid creation and configuration of an instance from a snapshot, which may indicate automated exfiltration or staging activities.
type: technique
related:
  - TA0005: Defense Evasion
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Is a new cloud instance being created from a known malicious IP address or using a denied public image?
    context: |
      This question aims to detect a common attack vector where adversaries use compromised infrastructure (malicious IPs) or pre-configured malicious virtual machine images to create instances. A match provides a strong signal of malicious intent, as legitimate operations should not originate from threat-listed IPs or use unapproved, potentially backdoored, public images.
    answer_sources:
      - AWS CloudTrail
      - Azure Activity Logs
      - GCP Admin Activity audit logs
      - Threat Intelligence Feed
      - Zeek conn.log
      - Cloud provider management plane API endpoints
      - Threat Intelligence Platform
      - Internet Gateway
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          // Query 1: Check against malicious IPs
          FOR each instance_creation_event in cloud_audit_logs
            IF instance_creation_event.sourceIPAddress IN malicious_ip_feed
              ALERT "Instance created from malicious IP"
          // Query 2: Check against denied image IDs
          FOR each instance_creation_event in cloud_audit_logs
            IF instance_creation_event.imageId IN denied_image_id_list
              ALERT "Instance created with denied image ID"
  - question: Is a new cloud instance being created from an ASN or geographic location that is rare for our organization?
    context: |
      Adversaries often operate from infrastructure that is geographically or logically distant from their target's normal operational footprint. By identifying instance creation events from statistically rare Autonomous Systems (ASNs) or countries, analysts can uncover attempts to provision infrastructure from unusual sources, which could be part of an external attack campaign.
    answer_sources:
      - AWS CloudTrail
      - Azure Activity Logs
      - GCP Admin Activity audit logs
      - Threat Intelligence Feed
      - Zeek conn.log
      - Cloud provider management plane API endpoints
      - Threat Intelligence Platform
      - Internet Gateway
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          // Build historical baseline
          ASN_frequency = calculate_frequency(instance_creation_events.sourceASN) over last 90 days
          Country_frequency = calculate_frequency(instance_creation_events.sourceCountry) over last 90 days

          // Check new events
          FOR each new_instance_creation_event
            source_ASN = enrich_ip(new_instance_creation_event.sourceIPAddress).ASN
            source_Country = enrich_ip(new_instance_creation_event.sourceIPAddress).Country
            IF ASN_frequency[source_ASN] < 1% OR Country_frequency[source_Country] < 1%
              ALERT "Instance created from rare ASN or country"
  - question: Does a machine learning model classify a new instance creation event as malicious based on its combined features?
    context: |
      This question leverages a machine learning model to perform a holistic assessment of an instance creation event. Instead of relying on a single indicator, the model considers multiple features simultaneously (e.g., source IP details, image properties, time of day) to identify complex patterns indicative of malicious activity that might be missed by simple rule-based alerts. An investigation is warranted for high-confidence malicious classifications.
    answer_sources:
      - AWS CloudTrail
      - Azure Activity Logs
      - GCP Admin Activity audit logs
      - Threat Intelligence Feed
      - Zeek conn.log
      - Cloud provider management plane API endpoints
      - Threat Intelligence Platform
      - Internet Gateway
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          FOR each new_instance_creation_event
            features = extract_features(event) // IP geo, ASN, image owner, etc.
            prediction, confidence = classification_model.predict(features)
            IF prediction == 'malicious' AND confidence > 0.85
              ALERT "ML model detected malicious instance creation"
  - question: Does the name, tag, or User-Agent of a new instance contain suspicious keywords or match known offensive tool signatures?
    context: |
      Adversaries may inadvertently leave traces of their tools in the metadata of the resources they create. This question seeks to find these artifacts by scanning instance names, tags, and the User-Agent string for known malicious tool names (like 'Pacu'), suspicious generic terms ('test'), or encoded commands. A match can be a strong indicator that the instance was created by an automated attack tool.
    answer_sources:
      - AWS CloudTrail
      - Azure Activity Logs
      - GCP Admin Activity audit logs
      - Cloud provider management plane
      - SIEM / Log Analytics Workspace
      - Organizational Naming Convention Policy Documents
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          suspicious_patterns = ['pacu', 'cloudsploit', 'test', 'temp', base64_regex]
          FOR each instance_creation_event
            IF any(pattern in event.userAgent for pattern in suspicious_patterns) OR
               any(pattern in event.instanceName for pattern in suspicious_patterns) OR
               any(pattern in event.tags for pattern in suspicious_patterns)
              ALERT "Suspicious keyword found in instance metadata"
  - question: Does a new cloud instance have a name with an unusually high degree of randomness (entropy)?
    context: |
      Malicious automation and command-and-control (C2) frameworks often generate random-looking names for resources to avoid detection and naming collisions. By calculating the Shannon entropy of instance names and comparing it to a historical baseline, we can identify names that are likely machine-generated rather than human-created, which is a common characteristic of malicious activity.
    answer_sources:
      - AWS CloudTrail
      - Azure Activity Logs
      - GCP Admin Activity audit logs
      - Cloud provider management plane
      - SIEM / Log Analytics Workspace
      - Organizational Naming Convention Policy Documents
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          // Establish baseline
          historical_entropies = calculate_entropy(instance_names) for last 90 days
          entropy_threshold = percentile(historical_entropies, 99)

          // Check new events
          FOR each new_instance_creation_event
            current_entropy = calculate_entropy(new_instance_creation_event.instanceName)
            IF current_entropy > entropy_threshold
              ALERT "High entropy detected in instance name"
  - question: Does the name or tag of a new instance deviate from the established naming conventions and patterns learned by an NLP model?
    context: |
      Organizations typically follow specific, often unwritten, naming conventions for their cloud resources. This question uses an NLP model to learn these legitimate patterns from historical data. The model can then flag new instances whose names or tags are grammatically or structurally dissimilar to known good examples, potentially indicating a resource created outside of normal processes, possibly by an adversary.
    answer_sources:
      - AWS CloudTrail
      - Azure Activity Logs
      - GCP Admin Activity audit logs
      - Cloud provider management plane
      - SIEM / Log Analytics Workspace
      - Organizational Naming Convention Policy Documents
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          // Train model on historical data
          nlp_model = train_on(historical_instance_names_and_tags)

          // Check new events
          FOR each new_instance_creation_event
            name_score = nlp_model.score_similarity(new_instance_creation_event.instanceName)
            tag_score = nlp_model.score_similarity(new_instance_creation_event.tags)
            IF name_score < low_similarity_threshold OR tag_score < low_similarity_threshold
              ALERT "Instance name/tag deviates from NLP-learned patterns"
  - question: Was a new cloud instance created by a recently created user account or a long-dormant user account?
    context: |
      This question aims to identify two common signs of account compromise or misuse. A newly created account performing sensitive actions (like creating an instance) may have been created specifically for malicious purposes. A long-dormant account that suddenly becomes active could have been compromised. Both scenarios deviate from normal user behavior and warrant investigation.
    answer_sources:
      - AWS CloudTrail
      - Azure Activity Logs
      - GCP Admin Activity audit logs
      - Azure AD Sign-in logs
      - Okta System Log
      - Cloud Identity and Access Management (IAM) service
      - IdP Administration Portal and Logs
      - Human Resources Information System (for peer grouping)
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          FOR each instance_creation_event
            user_principal = instance_creation_event.principalId
            account_details = query_idp_for(user_principal)
            is_new = (now - account_details.creation_date) < 72 hours
            is_dormant = (now - account_details.last_activity) > 90 days
            IF is_new OR is_dormant
              ALERT "Instance created by new or dormant account"
  - question: Is a user creating an anomalous number of instances compared to their own historical behavior or that of their peers?
    context: |
      Adversaries who have compromised an account may use it to provision resources at a much higher rate than the legitimate user. This question establishes a baseline of normal activity for each individual and their peer group (e.g., all developers). A significant statistical deviation from these baselines can indicate that the account is being used for automated, malicious provisioning.
    answer_sources:
      - AWS CloudTrail
      - Azure Activity Logs
      - GCP Admin Activity audit logs
      - Azure AD Sign-in logs
      - Okta System Log
      - Cloud Identity and Access Management (IAM) service
      - IdP Administration Portal and Logs
      - Human Resources Information System (for peer grouping)
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          // Individual baseline
          FOR each user
            user_baseline = calculate_daily_instance_creation_stats(user) over last 30 days
            IF today's_count > (user_baseline.mean + 3 * user_baseline.std_dev)
              ALERT "User's instance creation rate is anomalous"

          // Peer group baseline
          FOR each peer_group
            group_baseline = calculate_daily_instance_creation_stats(peer_group) over last 30 days
            FOR each user in peer_group
              IF user's_daily_count is_outlier_for group_baseline
                ALERT "User's instance creation rate deviates from peer group"
  - question: Does a user's overall cloud activity pattern identify them as an outlier when compared to all other users?
    context: |
      This question uses unsupervised machine learning to find users whose behavior doesn't fit any established pattern. By clustering users based on features like API call frequency, types of resources used, and active hours, the algorithm can group users with similar job functions. Users who don't fall into any cluster ('noise' points) are behavioral outliers and could represent compromised accounts or insider threats.
    answer_sources:
      - AWS CloudTrail
      - Azure Activity Logs
      - GCP Admin Activity audit logs
      - Azure AD Sign-in logs
      - Okta System Log
      - Cloud Identity and Access Management (IAM) service
      - IdP Administration Portal and Logs
      - Human Resources Information System (for peer grouping)
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          // Get activity features for all users
          user_features = extract_activity_features(all_users) // API calls, resource types, etc.
          
          // Run clustering
          clusters, noise_points = dbscan_cluster(user_features)
          
          // Alert on outliers
          FOR each user in noise_points
            ALERT "User identified as a behavioral outlier by clustering model"
  - question: Is a new instance being created with an overly permissive security group, especially one exposing management ports to the internet?
    context: |
      Exposing management ports (like SSH, RDP, WinRM) to the entire internet (`0.0.0.0/0`) is a critical security risk and a common misconfiguration exploited by attackers. This question seeks to detect this specific high-risk condition in real-time, as it provides a direct and easy path for an adversary to gain access to the newly created instance.
    answer_sources:
      - AWS CloudTrail
      - Azure Activity Logs
      - GCP Admin Activity audit logs
      - AWS Config
      - Azure Policy
      - Cloud provider management plane
      - Virtual network configuration (VPC/VNet)
      - Cloud Security Posture Management (CSPM) tool findings
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          unapproved_ports = [22, 3389, 5985, 1433, ...]
          FOR each security_group_change_event
            IF rule.source == '0.0.0.0/0' AND rule.port IN unapproved_ports
              ALERT "Critical: Management port exposed to the internet"
  - question: Is a new instance being created with a combination of attributes (region, type, size) that is statistically rare for our organization?
    context: |
      Adversaries may not be familiar with an organization's standard operating procedures and may create instances with unusual configurations (e.g., in an unused region, with an expensive GPU instance type). This question identifies anomalous configurations by scoring the rarity of each attribute and summing them. A high total score indicates a combination of attributes that is highly unusual and warrants investigation.
    answer_sources:
      - AWS CloudTrail
      - Azure Activity Logs
      - GCP Admin Activity audit logs
      - AWS Config
      - Azure Policy
      - Cloud provider management plane
      - Virtual network configuration (VPC/VNet)
      - Cloud Security Posture Management (CSPM) tool findings
    range: last 180 days
    queries:
      - search_technology: pseudocode
        query: |
          // Build rarity scores from historical data (180 days)
          region_rarity = calculate_rarity_score(instance_creation_events.awsRegion)
          type_rarity = calculate_rarity_score(instance_creation_events.instanceType)
          
          // Check new events
          FOR each new_instance_creation_event
            risk_score = region_rarity[event.awsRegion] + type_rarity[event.instanceType]
            IF risk_score > historical_risk_score_98th_percentile
              ALERT "Instance created with statistically rare configuration"
  - question: Has there been a sudden, anomalous spike in the number of instances being created, either overall or in a specific region/family?
    context: |
      This question uses time-series analysis to detect sudden changes in the volume of instance provisioning. A legitimate workload might scale up gradually, but a malicious script or compromised account might trigger a sudden, massive spike in instance creation. A time-series model can distinguish between normal fluctuations and a statistically significant anomaly that deviates from forecasted trends.
    answer_sources:
      - AWS CloudTrail
      - Azure Activity Logs
      - GCP Admin Activity audit logs
      - AWS Config
      - Azure Policy
      - Cloud provider management plane
      - Virtual network configuration (VPC/VNet)
      - Cloud Security Posture Management (CSPM) tool findings
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          // Model forecasts expected volume based on historical data
          forecast, uncertainty = timeseries_model.predict(current_time)
          
          // Check current volume
          current_volume = count(instance_creations_in_last_interval)
          
          IF current_volume > (forecast + uncertainty)
            ALERT "Anomalous spike in instance creation volume detected"
  - question: Has a user recently created a snapshot, launched a new instance, and attached a volume in a short time frame, especially across regions?
    context: |
      This sequence of actions—snapshot, run instance, attach volume—is a common pattern for data exfiltration or staging. An adversary might snapshot a volume containing sensitive data, create a new instance (often in a different region they control), and attach the snapshot to it. This question uses a stateful correlation rule to detect this specific, high-risk sequence of events.
    answer_sources:
      - AWS CloudTrail
      - Azure Activity Logs
      - GCP Admin Activity audit logs
      - Cloud provider management plane
      - SIEM correlation engine
      - Cloud data storage services (e.g., AWS EBS, Azure Managed Disks)
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          // Stateful SIEM rule
          ON CreateSnapshot event by principal P from region R1
          WITHIN 15 minutes
            LOOK FOR RunInstances event by principal P in region R2
            AND AttachVolume event by principal P
            IF found
              ALERT "Suspicious snapshot-to-instance sequence detected"
              IF R1 != R2
                ESCALATE "Cross-region data staging suspected"
  - question: Is a sequence of related API calls, like creating a snapshot and then an instance, happening much faster than is typical for human operators?
    context: |
      Automated scripts operate much faster than humans. By analyzing the typical time delays between related API calls in legitimate workflows, we can establish a baseline for human-driven activity. A sequence of actions performed significantly faster than this baseline (e.g., in the bottom 5th percentile of time deltas) is a strong indicator of a scripted, and therefore potentially malicious, operation.
    answer_sources:
      - AWS CloudTrail
      - Azure Activity Logs
      - GCP Admin Activity audit logs
      - Cloud provider management plane
      - SIEM correlation engine
      - Cloud data storage services (e.g., AWS EBS, Azure Managed Disks)
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          // Establish baseline
          historical_deltas = calculate_time_deltas('CreateSnapshot' -> 'RunInstances')
          time_threshold = percentile(historical_deltas, 5)

          // Check new sequences
          ON CreateSnapshot event FOLLOWED BY RunInstances event
            time_delta = timestamp(RunInstances) - timestamp(CreateSnapshot)
            IF time_delta < time_threshold
              ALERT "Anomalously fast API sequence detected (likely scripted)"
  - question: Is a user executing a sequence of API calls that is improbable or nonsensical according to a model trained on legitimate workflows?
    context: |
      Legitimate cloud operations follow logical, repeatable sequences of API calls (e.g., create instance, attach security group, assign IP). Adversaries may perform actions in an unusual or illogical order. This question uses a sequence analysis model (like an HMM or RNN) to learn the "grammar" of normal API call sequences. It can then flag new sequences that have a low probability of occurring, identifying novel or anomalous workflows that may be malicious.
    answer_sources:
      - AWS CloudTrail
      - Azure Activity Logs
      - GCP Admin Activity audit logs
      - Cloud provider management plane
      - SIEM correlation engine
      - Cloud data storage services (e.g., AWS EBS, Azure Managed Disks)
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          // Train model on legitimate historical API call sequences
          sequence_model = train_on(legitimate_api_sequences)
          
          // Score new sequences
          FOR each new_api_sequence from a user
            probability = sequence_model.score(new_api_sequence)
            IF probability < low_probability_threshold
              ALERT "Anomalous API call sequence detected"