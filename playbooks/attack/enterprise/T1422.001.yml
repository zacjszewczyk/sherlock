name: T1422.001: Internet Connection Discovery
id: 3a9e10f4-5d5c-4a3b-8f7e-1c9d8b7a6c5d
description: |
  This playbook helps investigate if an adversary is performing network discovery on a compromised mobile device. This can manifest as the execution of network diagnostic commands (e.g., 'netstat', 'ping', 'ifconfig', 'getprop') from an unusual parent process or a remote shell. It can also be observed through network traffic patterns, such as a burst of DNS queries to many distinct domains, a high ratio of short-lived TCP connections, and low data transfer per connection, all indicating automated probing rather than normal user activity.
type: technique
related:
  - TA0032: Discovery
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Has a network diagnostic command ('netstat', 'ping', 'ifconfig', 'getprop') been executed on a mobile device from an unauthorized parent process or a remote shell?
    context: |
      This question aims to identify direct execution of network discovery tools. Adversaries use these common utilities to understand the device's network configuration and connectivity. Detecting their execution from an unexpected context, such as a non-standard parent process or via a remote connection like Android Debug Bridge (ADB), is a strong indicator of malicious activity, as legitimate use by the system or administrators typically follows predictable patterns.
    answer_sources:
      - Mobile EDR process execution logs
      - Android Debug Bridge (ADB) logs
      - Corporate-managed mobile devices (Android, iOS)
      - Mobile Device Management (MDM) servers
      - Endpoint Detection and Response (EDR) platform consoles
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          SEARCH process creation logs on mobile devices for command-lines containing 'netstat', 'ping', 'ifconfig', or 'getprop net.dns1'.
          FILTER results where the parent process is NOT in the allowlist of system or MDM tools.
          CORRELATE device and timestamp with ADB logs to check for remote sessions from non-development IPs.
  - question: Has there been an anomalous or rare execution of a network discovery command on a mobile device compared to its own baseline or the wider device fleet?
    context: |
      This question focuses on detecting outliers. Even if a command is legitimate, a sudden spike in its use on one device, or its rare appearance on a device where it has never been seen, can signal misuse. By baselining normal behavior for both the individual device and the entire fleet, we can spot deviations that suggest an adversary is using built-in tools for reconnaissance.
    answer_sources:
      - Mobile EDR process execution logs
      - Corporate-managed mobile devices (Android, iOS)
      - Mobile Device Management (MDM) servers
      - Endpoint Detection and Response (EDR) platform consoles
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          BASELINE command-line executions across all mobile devices for the last 30 days.
          FOR each new network discovery command execution:
            CALCULATE its rarity score across the fleet.
            ALERT if rarity score is in the top 5%.
            CALCULATE the daily count for the device.
            ALERT if daily count exceeds the 99th percentile of the device's historical daily volume.
  - question: Does a machine learning model classify a recent process execution on a mobile device as malicious based on its characteristics?
    context: |
      This question leverages machine learning to identify suspicious processes that may not be caught by simple rules. By training a model on features like the command itself, its parent process, user privileges, and time of execution, the system can learn complex patterns of malicious behavior and flag new, previously unseen activity that fits this profile with a high degree of confidence.
    answer_sources:
      - Mobile EDR process execution logs
      - Corporate-managed mobile devices (Android, iOS)
      - Mobile Device Management (MDM) servers
      - Endpoint Detection and Response (EDR) platform consoles
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each new process event on mobile devices:
            EXTRACT features (command-line tokens, parent process, privileges, hour-of-day, remote shell flag).
            SCORE the event using the trained Random Forest classification model.
            ALERT if the malicious probability score is > 0.90.
  - question: Is a mobile device connecting to a known malicious command-and-control (C2) server?
    context: |
      This question seeks to identify high-confidence indicators of compromise by checking for communication with known bad destinations. An outbound connection from a mobile device to an IP address listed on a threat intelligence feed as a C2 server is a strong signal of infection. Correlating this with DNS and device ownership data helps confirm the threat and speeds up incident response.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Network egress points
      - Corporate Wi-Fi controllers
      - VPN concentrators
      - Internal DNS resolvers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          SEARCH outbound network connection logs from the mobile IP range.
          MATCH destination IPs against a high-confidence C2 threat intelligence feed.
          ON MATCH, enrich the alert with the corresponding DNS query and device owner information from MDM.
  - question: Is a mobile device exhibiting anomalous network traffic patterns, such as an unusually high variety of destinations or a high number of short-lived connections, compared to its own baseline?
    context: |
      This question looks for behavioral anomalies in network traffic that suggest automated discovery. An adversary's probing tools often contact many different servers in a short period to check for internet connectivity or discover services. This results in traffic with high entropy, a large number of unique DNS lookups, and many brief connections. By baselining normal device behavior and alerting on significant deviations, we can detect this type of reconnaissance.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Network egress points
      - Corporate Wi-Fi controllers
      - VPN concentrators
      - Internal DNS resolvers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          AGGREGATE Zeek logs into 1-minute windows per source mobile IP.
          FOR each window, calculate:
            1. Shannon entropy of destination IPs.
            2. Count of unique domains queried.
            3. Ratio of short-lived (<1s) connections.
          COMPARE metrics to the device's 28-day baseline.
          ALERT if two or more metrics exceed 3 standard deviations from their mean.
  - question: Does an unsupervised machine learning model identify a mobile device's network traffic as a significant outlier?
    context: |
      This question uses an unsupervised learning approach (Isolation Forest) to find 'unusual' devices without pre-existing labels for malicious traffic. By modeling various network traffic features—like connection volume, data totals, protocol ratios, and destination diversity (ports, ASNs)—the model can isolate devices whose traffic patterns differ significantly from the norm. Such outliers are candidates for investigation for network discovery or other malicious activities.
    answer_sources:
      - Zeek conn.log
      - Network egress points
      - Corporate Wi-Fi controllers
      - VPN concentrators
      - Internal DNS resolvers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each mobile device, create 1-minute windows of network traffic.
          ENGINEER features: connection count, total bytes, TCP/UDP ratio, destination port entropy, distinct destination ASN count.
          SCORE each window using a trained Isolation Forest model.
          INVESTIGATE devices consistently flagged as significant outliers.