name: "T1591.003: Identify Business Tempo"
id: "f5d8a9e6-7b2c-4e8d-9f1a-0c3b5a6e7d8f"
description: |
  This playbook helps to determine if an adversary is conducting reconnaissance to identify an organization's business tempo or leveraging this knowledge for malicious activity. It focuses on detecting indicators such as network communication with known reconnaissance infrastructure, probing of public-facing authentication services without login attempts, low-and-slow network scanning, privileged account activity during non-business hours, and the creation of scheduled tasks or services configured to execute during off-hours.
type: "technique"
related:
  - "TA0043: Reconnaissance"
contributors:
  - "Zachary Szewczyk"
  - "Ask Sage"
created: "2025-10-01"
modified: "2025-10-01"
version: 1.0
tags: "none"
questions:
  - question: "Are there any network connections originating from or destined for infrastructure known to be associated with reconnaissance tools or services?"
    context: |
      This question aims to identify direct communication with known malicious infrastructure. By matching network logs (IPs, domains, JA3/JA3S hashes) against threat intelligence feeds, we can detect initial reconnaissance probes from adversaries using established tools. A match provides a high-confidence signal of targeted reconnaissance activity.
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Zeek ssl.log"
      - "Perimeter firewalls"
      - "forward/reverse proxies"
      - "public-facing DNS servers"
      - "external-facing web application firewalls (WAFs)"
    range: "last 90 days"
    queries:
      - "pseudocode: SEARCH network_logs WHERE (source_ip IN threat_intel_feed OR dest_ip IN threat_intel_feed OR domain IN threat_intel_feed OR ja3_hash IN threat_intel_feed)"
  - question: "Are any external IP addresses, previously flagged by threat intelligence, exhibiting low-and-slow connection patterns indicative of stealthy reconnaissance?"
    context: |
      Adversaries often use low-volume, persistent connections to avoid detection. This question focuses on identifying such 'low-and-slow' behavior from IPs already considered suspicious. By analyzing connection volume over several days, we can distinguish between normal traffic and methodical, automated probing that might otherwise be missed.
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Zeek ssl.log"
      - "Perimeter firewalls"
      - "forward/reverse proxies"
      - "public-facing DNS servers"
      - "external-facing web application firewalls (WAFs)"
    range: "last 90 days"
    queries:
      - "pseudocode: FOR ip IN flagged_ips | CALCULATE connection_count over 7 days | IF connection_count < 10th_percentile AND connection_persists > 3 days | ALERT"
  - question: "Can we use machine learning to predict whether an inbound connection is part of a malicious reconnaissance campaign?"
    context: |
      This question leverages machine learning to proactively score and classify inbound connections. By training a model on features like connection duration, data volume, protocol, and threat intelligence hits, we can identify subtle patterns of malicious reconnaissance that are difficult to define with simple rules or statistics. This provides a probabilistic assessment of risk for new connections.
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Zeek ssl.log"
      - "Perimeter firewalls"
      - "forward/reverse proxies"
      - "public-facing DNS servers"
      - "external-facing web application firewalls (WAFs)"
    range: "last 90 days"
    queries:
      - "pseudocode: PREDICT connection_is_reconnaissance USING Random_Forest_Model(connection_duration, bytes_transferred, protocol, threat_intel_match)"
  - question: "Is any external IP repeatedly connecting to our authentication services without ever attempting to log in?"
    context: |
      This question aims to detect reconnaissance activity targeting authentication portals (like VPN or OWA). An adversary may probe these services to check for their existence and availability before launching an attack. A pattern of connections without corresponding login attempts (successful or failed) is a strong indicator of this pre-attack discovery phase.
    answer_sources:
      - "Zeek conn.log"
      - "Zeek http.log"
      - "Windows Event ID 4625"
      - "Windows Event ID 4624"
      - "VPN concentrators"
      - "Outlook Web Access (OWA) portals"
      - "single sign-on (SSO) platforms"
      - "other external-facing authentication gateways"
    range: "last 90 days"
    queries:
      - "pseudocode: SEARCH network_logs for connections to auth_services | GROUP BY source_ip | JOIN with auth_logs on source_ip | IF connection_count > 20 over 14 days AND login_attempts == 0 | ALERT"
  - question: "Are there any source IPs connecting to authentication services with an unusually regular, automated rhythm?"
    context: |
      Automated reconnaissance tools often make connections at fixed intervals. This question seeks to identify such automation by analyzing the time between connections (inter-arrival time). A very low standard deviation in these times suggests a machine-generated pattern, not human behavior, pointing to systematic probing of our authentication infrastructure.
    answer_sources:
      - "Zeek conn.log"
      - "Zeek http.log"
      - "Windows Event ID 4625"
      - "Windows Event ID 4624"
      - "VPN concentrators"
      - "Outlook Web Access (OWA) portals"
      - "single sign-on (SSO) platforms"
      - "other external-facing authentication gateways"
    range: "last 90 days"
    queries:
      - "pseudocode: FOR ip in auth_service_connections | CALCULATE inter_arrival_time_std_dev over 30 days | IF std_dev < 5th_percentile | ALERT"
  - question: "Can we detect anomalous connection patterns to our high-value authentication services that deviate from established normal behavior?"
    context: |
      This question uses time-series analysis to model the normal rhythm of connection activity for critical authentication services, accounting for time of day and day of week. The model can then detect anomalous deviations, such as a low, persistent stream of connections from an unknown source, which might represent a stealthy adversary trying to map out the attack surface.
    answer_sources:
      - "Zeek conn.log"
      - "Zeek http.log"
      - "Windows Event ID 4625"
      - "Windows Event ID 4624"
      - "VPN concentrators"
      - "Outlook Web Access (OWA) portals"
      - "single sign-on (SSO) platforms"
      - "other external-facing authentication gateways"
    range: "last 90 days"
    queries:
      - "pseudocode: PREDICT anomaly in connection_volume_time_series USING LSTM_Autoencoder_Model(connection_events)"
  - question: "Is any external IP address scanning a wide variety of ports over a long period without sending significant traffic?"
    context: |
      This question is designed to detect slow, horizontal scanning. Adversaries use this technique to discover open ports and running services across an organization's IP range without triggering high-volume alerts. Identifying IPs that touch many ports but transfer minimal data helps uncover this stealthy form of network mapping.
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Zeek http.log"
      - "Network DMZ"
      - "public cloud subnets (VPCs/VNETs)"
      - "public-facing application servers"
      - "external DNS servers"
    range: "last 90 days"
    queries:
      - "pseudocode: FOR ip in external_ips | IF unique_ports_contacted > 10 in 30 days AND total_traffic_per_port < 1KB AND ip NOT in allowlist | ALERT"
  - question: "Are any external IPs exhibiting a high degree of port scanning randomness combined with a low total connection count?"
    context: |
      This question uses information theory (Shannon entropy) to quantify the randomness of ports being scanned. A legitimate service typically communicates on a few predictable ports, resulting in low entropy. A scanner exploring a wide, random range of ports will have high entropy. By combining high port entropy with a low overall connection count, we can specifically target stealthy scanners and differentiate them from both normal traffic and noisy, high-volume scanners.
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Zeek http.log"
      - "Network DMZ"
      - "public cloud subnets (VPCs/VNETs)"
      - "public-facing application servers"
      - "external DNS servers"
    range: "last 90 days"
    queries:
      - "pseudocode: FOR ip in external_ips over 30 days | CALCULATE port_entropy and total_connections | IF port_entropy > 98th_percentile AND total_connections < 25th_percentile | ALERT"
  - question: "Can we use clustering to identify outlier IPs whose connection behavior does not match any known profile of normal user or internet scanner activity?"
    context: |
      This question applies unsupervised machine learning to group external IPs based on their connection behaviors (e.g., connection count, port variety, data volume). IPs that do not fit into large clusters of 'normal' behavior are flagged as anomalies or noise. These outliers often represent unique, potentially malicious activity, such as targeted, low-and-slow reconnaissance that doesn't conform to typical patterns.
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Zeek http.log"
      - "Network DMZ"
      - "public cloud subnets (VPCs/VNETs)"
      - "public-facing application servers"
      - "external DNS servers"
    range: "last 90 days"
    queries:
      - "pseudocode: CLUSTER external_ips USING DBSCAN(connection_count, unique_port_count, avg_bytes) | INVESTIGATE noise_points and small_clusters"
  - question: "Has a privileged account logged in interactively during non-business hours and immediately run discovery commands?"
    context: |
      This question looks for a very specific, high-confidence pattern of malicious behavior: an attacker who has compromised a privileged account using it 'after hours' to perform reconnaissance. The combination of a privileged interactive logon (Type 2 or 10), non-business hours, and the immediate execution of discovery tools (`net.exe`, `whoami.exe`) strongly indicates an active adversary exploring the network.
    answer_sources:
      - "Windows Event ID 4624"
      - "Windows Event ID 4688"
      - "Windows Event ID 4663"
      - "Zeek conn.log"
      - "Domain Controllers"
      - "certificate authorities"
      - "critical file servers"
      - "privileged user workstations"
      - "database servers"
      - "hypervisor management consoles"
    range: "last 90 days"
    queries:
      - "pseudocode: SEARCH for privileged_logon (Type 2/10) during off_hours | IF followed by process_creation for discovery_tool | HIGH_SEVERITY_ALERT"
  - question: "Is a privileged user's recent activity statistically anomalous compared to their own historical baseline?"
    context: |
      This question aims to detect compromised accounts by establishing a 'normal' for each privileged user. By baselining typical login times, processes executed, and servers accessed, we can score new activities based on how much they deviate from this established pattern. An activity that is several standard deviations away from the user's norm (e.g., a login at 3 AM for a 9-to-5 user) generates a high risk score and warrants investigation.
    answer_sources:
      - "Windows Event ID 4624"
      - "Windows Event ID 4688"
      - "Windows Event ID 4663"
      - "Zeek conn.log"
      - "Domain Controllers"
      - "certificate authorities"
      - "critical file servers"
      - "privileged user workstations"
      - "database servers"
      - "hypervisor management consoles"
    range: "last 90 days"
    queries:
      - "pseudocode: FOR each privileged_user_activity | CALCULATE z_score based on user's 90-day baseline for login_time, processes, etc. | IF total_risk_score > threshold | ALERT"
  - question: "Can we use machine learning to model the normal behavior of each privileged user and detect any outlier activity?"
    context: |
      This question applies a more sophisticated form of anomaly detection by building a dedicated behavioral model (a one-class SVM) for each privileged user. The model learns the multi-dimensional profile of the user's normal activity. Any new action that falls outside this learned 'normal' profile is flagged as an outlier for immediate review. This is particularly effective for catching novel or complex deviations that statistical methods might miss.
    answer_sources:
      - "Windows Event ID 4624"
      - "Windows Event ID 4688"
      - "Windows Event ID 4663"
      - "Zeek conn.log"
      - "Domain Controllers"
      - "certificate authorities"
      - "critical file servers"
      - "privileged user workstations"
      - "database servers"
      - "hypervisor management consoles"
    range: "last 90 days"
    queries:
      - "pseudocode: PREDICT activity_is_outlier USING One_Class_SVM_Model(activity_features) for each privileged_user"
  - question: "Has a new scheduled task or service been created that is set to run during non-business hours and executes a suspicious or obfuscated command?"
    context: |
      Adversaries often create scheduled tasks to establish persistence or execute payloads during off-hours to avoid detection. This question targets this technique by looking for the combination of a non-business hours trigger and a suspicious action, such as an obfuscated PowerShell command or a script interpreter. This combination is a strong indicator of malicious intent.
    answer_sources:
      - "Windows Event ID 4698"
      - "Windows Event ID 4702"
      - "Microsoft-Windows-TaskScheduler/Operational Event ID 106"
      - "Windows Event ID 4688"
      - "Windows Event ID 4697"
      - "All Windows endpoints and servers"
      - "particularly Domain Controllers"
      - "application servers"
      - "administrator workstations"
    range: "last 90 days"
    queries:
      - "pseudocode: SEARCH for new_task or new_service | IF trigger is off_hours AND command contains (powershell -enc, cscript, non-standard path) | ALERT"
  - question: "Is the rate of scheduled task creation on a host abnormally high, or is the command line of a new task unusually complex?"
    context: |
      This question uses statistics to find anomalies in persistence mechanisms. First, it flags hosts where tasks are being created more frequently than normal, which could indicate an automated malware dropper. Second, it measures the complexity (entropy) of the command line. A command with unusually high entropy often contains obfuscated or randomized code, a common tactic for hiding malicious payloads.
    answer_sources:
      - "Windows Event ID 4698"
      - "Windows Event ID 4702"
      - "Microsoft-Windows-TaskScheduler/Operational Event ID 106"
      - "Windows Event ID 4688"
      - "Windows Event ID 4697"
      - "All Windows endpoints and servers"
      - "particularly Domain Controllers"
      - "application servers"
      - "administrator workstations"
    range: "last 90 days"
    queries:
      - "pseudocode: FOR each host | IF task_creation_frequency > 99th_percentile | ALERT | FOR each new_task | IF command_entropy > historical_average | ALERT"
  - question: "Can we train a machine learning model to predict whether a newly created scheduled task or service is malicious?"
    context: |
      This question proposes building a classifier to automatically assess the risk of new persistence mechanisms. By feeding a model features like the user context, trigger type, command line entropy, and the parent process, it can learn to distinguish between benign administrative tasks and malicious ones. This automates the analysis and helps focus analyst attention on the highest-risk events.
    answer_sources:
      - "Windows Event ID 4698"
      - "Windows Event ID 4702"
      - "Microsoft-Windows-TaskScheduler/Operational Event ID 106"
      - "Windows Event ID 4688"
      - "Windows Event ID 4697"
      - "All Windows endpoints and servers"
      - "particularly Domain Controllers"
      - "application servers"
      - "administrator workstations"
    range: "last 90 days"
    queries:
      - "pseudocode: PREDICT task_is_malicious USING XGBoost_Model(run_as_user, trigger_type, command_entropy, parent_process)"