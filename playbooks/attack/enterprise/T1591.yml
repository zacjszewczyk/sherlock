name: T1591: Gather Victim Org Information
id: 5a9b8c7d-6e3f-4a1b-9c8d-0e1f2a3b4c5d
description: This playbook helps detect if an adversary is gathering organizational information to support future targeting. It focuses on identifying reconnaissance activities such as network connections to known malicious infrastructure, web requests for sensitive files or non-public URLs, use of common scanning tools, network-level horizontal and vertical scans, and various forms of DNS enumeration like subdomain brute-forcing.
type: technique
related:
  - TA0043: Reconnaissance
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
investigative_questions:
  - question: Are network connections being established with known malicious infrastructure, suggesting reconnaissance activity?
    context: This question aims to identify direct communication with adversary-controlled systems. By continuously correlating all network connection logs and DNS queries against a high-confidence threat intelligence feed, analysts can detect interactions with known malicious scanners, C2 servers, or other reconnaissance infrastructure. A match provides a strong, actionable signal of potential targeting.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Internet gateway
      - Perimeter firewalls
      - Cloud VPC flow logs
      - DNS resolvers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: >
          SEARCH conn.log, dns.log
          WHERE id.resp_h IN threat_intel_feed(category=reconnaissance)
          OR id.orig_h IN threat_intel_feed(category=reconnaissance)
          OR query IN threat_intel_feed(category=reconnaissance)
          GENERATE high-severity alert
  - question: Is any external IP showing an unusually high ratio of connections to known malicious IPs compared to its total connections?
    context: This question uses a statistical approach to find subtle reconnaissance activity. Instead of just one-off connections, it looks for source IPs that disproportionately communicate with known bad infrastructure compared to their overall traffic. This can uncover sources that are systematically probing or scanning, even if they don't trigger single-event alerts.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Internet gateway
      - Perimeter firewalls
      - Cloud VPC flow logs
      - DNS resolvers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: >
          FOR each external source_ip in a 24-hour window:
            CALCULATE ratio = (connections to IOC_flagged_ips / total_connections)
            BASELINE this ratio across all sources
            FLAG any source_ip where ratio > 95th_percentile
  - question: Can we predict if a new network connection is part of a reconnaissance campaign using machine learning?
    context: This question leverages machine learning to identify complex reconnaissance patterns that may evade traditional rules. By training a classification model on connection features like port, protocol, duration, and threat intelligence flags, the system can learn to predict the probability that a new, unseen connection is malicious, enabling detection of novel or evolving adversary techniques.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Internet gateway
      - Perimeter firewalls
      - Cloud VPC flow logs
      - DNS resolvers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: >
          FOR each new connection:
            EXTRACT features (dest_port, protocol, duration, is_on_ioc_list)
            APPLY pre-trained Random Forest model
            IF model_output_probability > threshold
              FLAG connection as reconnaissance
  - question: Are external entities requesting web pages with sensitive keywords or file types indicative of organizational information gathering?
    context: This question focuses on detecting attempts to download sensitive documents or discover organizational structure. By scanning web server logs for requests that contain keywords like 'orgchart' or 'policy', or target file types like .xlsx or .docx, analysts can identify adversaries who are actively searching for exploitable information on public-facing websites.
    answer_sources:
      - Zeek http.log
      - Public-facing web servers
      - Content Delivery Network (CDN) logs
      - Web Application Firewall (WAF) logs
    range: last 90 days
    queries:
      - technology: pseudocode
        query: >
          SEARCH http.log
          WHERE source_ip is external
          AND uri MATCHES REGEX (/(orgchart|directory|policy)/i, \.(xlsx?|docx?|csv|pdf)$)
          TRIGGER alert on match
  - question: Is any external IP exhibiting high entropy in its requested URI paths, suggesting automated directory fuzzing or traversal attempts?
    context: This question aims to detect automated scanning tools by analyzing the randomness of their requests. A normal user has predictable navigation patterns, while a fuzzing tool trying to discover hidden files or directories will generate a wide variety of non-sequential URIs. High Shannon entropy in the requested paths from a single IP is a strong indicator of such automated reconnaissance.
    answer_sources:
      - Zeek http.log
      - Public-facing web servers
      - Content Delivery Network (CDN) logs
      - Web Application Firewall (WAF) logs
    range: last 90 days
    queries:
      - technology: pseudocode
        query: >
          FOR each external source_ip in a 1-hour window:
            CALCULATE shannon_entropy of requested URIs
            BASELINE entropy for all external users
            FLAG any source_ip where entropy > (mean + 3 * std_dev)
  - question: Can we use unsupervised machine learning to identify clusters of suspicious web scanning behavior from external users?
    context: This question uses clustering to group user sessions and automatically identify scanners without pre-existing signatures. By grouping sessions based on features like request count, URI diversity, and response codes, the model can isolate clusters that represent 'suspicious scanners'. This allows for the detection of novel scanning tools and behaviors.
    answer_sources:
      - Zeek http.log
      - Public-facing web servers
      - Content Delivery Network (CDN) logs
      - Web Application Firewall (WAF) logs
    range: last 90 days
    queries:
      - technology: pseudocode
        query: >
          GROUP http.log data into sessions by source_ip and user_agent
          EXTRACT features (request_count, uri_diversity, response_codes) for each session
          APPLY K-Means clustering
          MONITOR for new sessions falling into pre-labeled 'suspicious scanner' cluster
  - question: Are we observing web requests with User-Agent strings from known reconnaissance tools or receiving suspicious DNS query types like AXFR or ANY from external sources?
    context: This question uses signature-based detection for well-known reconnaissance methods. It involves looking for User-Agent strings of common tools like Nmap, sqlmap, or masscan in web logs. Separately, it monitors for DNS zone transfer requests (AXFR) or wildcard queries (ANY) from external IPs, which are classic techniques for enumerating a network's structure and hosts.
    answer_sources:
      - Zeek http.log
      - Zeek dns.log
      - DNS resolvers (internal and external-facing)
      - Public-facing web servers
      - Internet gateway
    range: last 90 days
    queries:
      - technology: pseudocode
        query: >
          SEARCH http.log WHERE user_agent MATCHES REGEX (`.*sqlmap.*`, `.*nmap.*`)
          AND
          SEARCH dns.log WHERE source_ip is external AND query_type IN ('AXFR', 'ANY')
          ALERT on match
  - question: Is a statistically rare User-Agent string generating a high volume of requests from a single IP, potentially indicating a custom scanning tool?
    context: This question is designed to find attackers using custom or uncommon tools to evade simple signature matching. It identifies User-Agent strings that are rare across the entire user base but are used for a high volume of requests from a single source. This anomaly suggests a non-standard client, such as a custom script or a less common security tool, being used for targeted scanning.
    answer_sources:
      - Zeek http.log
      - Zeek dns.log
      - DNS resolvers (internal and external-facing)
      - Public-facing web servers
      - Internet gateway
    range: last 90 days
    queries:
      - technology: pseudocode
        query: >
          CALCULATE frequency of all user_agents over 24 hours
          IDENTIFY user_agents with frequency < 0.01% (rare)
          FOR each rare user_agent, CHECK if request volume from a single IP is high
          FLAG the responsible IP and user_agent
  - question: Does time-series forecasting reveal an anomalous spike in the volume of reconnaissance-related DNS queries (AXFR, ANY)?
    context: This question uses machine learning to establish a baseline for normal DNS query patterns and detect deviations. A time-series model (like ARIMA) forecasts the expected volume of sensitive query types like AXFR and ANY. If the actual observed volume dramatically exceeds the model's prediction, it signals a potential reconnaissance event that is abnormal for that time of day or week.
    answer_sources:
      - Zeek http.log
      - Zeek dns.log
      - DNS resolvers (internal and external-facing)
      - Public-facing web servers
      - Internet gateway
    range: last 90 days
    queries:
      - technology: pseudocode
        query: >
          FOR query_type IN (AXFR, ANY):
            TRAIN ARIMA model on historical hourly query volume
            FORECAST expected volume and confidence interval for current hour
            IF observed_volume > upper_confidence_bound
              GENERATE alert for anomalous query volume
  - question: Is a single external IP address scanning a large number of ports on one host (vertical scan) or a large number of hosts on one or more ports (horizontal scan)?
    context: This question addresses classic network scanning behavior using simple thresholds. A vertical scan (one source, one destination, many ports) and a horizontal scan (one source, many destinations, one port) are fundamental reconnaissance techniques. By setting a rule to trigger when a count of unique ports or hosts is exceeded in a short time frame, analysts can detect blatant scanning activity.
    answer_sources:
      - Zeek conn.log
      - Network perimeter
      - DMZ segments
      - Server subnets
      - Firewall logs
    range: last 90 days
    queries:
      - technology: pseudocode
        query: >
          FOR each external source_ip in a 5-minute window:
            COUNT distinct destination_ports on a single host
            COUNT distinct destination_hosts
            IF distinct_ports > 100 (vertical scan) OR distinct_hosts > 50 (horizontal scan)
              ALERT on scanning activity
  - question: Is any external source IP contacting a number of distinct hosts or ports that is statistically anomalous compared to a historical baseline?
    context: This question provides a more dynamic way to detect network scanning than fixed thresholds. It establishes a baseline of normal behavior by calculating the distribution of unique hosts and ports contacted by typical external IPs. It then flags any IP whose activity exceeds a high percentile (e.g., the 99th), catching scanners that may be operating below a hard-coded threshold but are still statistically significant outliers.
    answer_sources:
      - Zeek conn.log
      - Network perimeter
      - DMZ segments
      - Server subnets
      - Firewall logs
    range: last 90 days
    queries:
      - technology: pseudocode
        query: >
          FOR each external source_ip in a 1-minute window:
            CALCULATE distinct_hosts_contacted and distinct_ports_contacted
            COMPARE to historical baseline distribution
            IF count > 99th_percentile of baseline
              FLAG source_ip as a statistical outlier/scanner
  - question: Can we use density-based clustering to automatically identify network scanning patterns, including slow scans?
    context: This question applies a machine learning approach to find clusters of scanning activity. Algorithms like DBSCAN can group connection events in multi-dimensional space. Scans, where one source connects to many destinations in a short period, form dense clusters that are easily identified. This method is also effective at identifying slow scans that might be missed by time-windowed rules, as the connections still form a logical, dense group.
    answer_sources:
      - Zeek conn.log
      - Network perimeter
      - DMZ segments
      - Server subnets
      - Firewall logs
    range: last 90 days
    queries:
      - technology: pseudocode
        query: >
          APPLY DBSCAN algorithm on connection data (source_ip, dest_ip, dest_port, timestamp)
          IDENTIFY dense clusters as potential scans
          ANALYZE points classified as noise to find slow scans from a single source
  - question: Is a single external source IP generating a high number of failed DNS lookups (NXDomain), indicating a potential subdomain brute-force attack?
    context: This question targets a common DNS enumeration technique. When an adversary tries to discover subdomains (e.g., vpn.example.com, dev.example.com), they often use a wordlist, generating many queries for names that do not exist. A high volume of NXDomain (non-existent domain) responses coming from a single source is a strong indicator of this subdomain brute-forcing activity.
    answer_sources:
      - Zeek dns.log
      - Authoritative external DNS servers
      - Internal DNS resolvers
      - Domain controllers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: >
          SEARCH dns.log
          WHERE rcode_name == 'NXDOMAIN' AND query contains 'yourdomain.com'
          COUNT by source_ip over a 1-minute window
          IF count > 100
            ALERT on potential subdomain brute-force
  - question: Is any external IP showing a statistically high ratio of NXDomain responses or high entropy in its queried subdomains?
    context: This question uses statistical methods to find DNS enumeration. It identifies sources with an abnormally high failure rate (NXDomain ratio) in their DNS queries, suggesting they are guessing names. Additionally, calculating the Shannon entropy of the queried subdomain labels can detect the randomness characteristic of automated enumeration tools, as opposed to the more structured queries of human users.
    answer_sources:
      - Zeek dns.log
      - Authoritative external DNS servers
      - Internal DNS resolvers
      - Domain controllers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: >
          FOR each source_ip over a 10-minute window:
            CALCULATE ratio = (NXDomain_responses / total_queries)
            CALCULATE shannon_entropy of queried subdomain labels
            FLAG if ratio or entropy is > 3 standard deviations from the mean
  - question: Can an anomaly detection model identify unusual spikes in DNS query volumes by type, signaling a reconnaissance attempt?
    context: This question uses time-series analysis to spot abnormal patterns in DNS traffic. The model learns the normal rhythm of various query types (A, MX, SRV, etc.). An alert is generated when the observed volume for a specific type deviates significantly from the model's prediction. This can catch sudden enumeration attempts, such as an adversary querying for all mail exchange (MX) or service (SRV) records.
    answer_sources:
      - Zeek dns.log
      - Authoritative external DNS servers
      - Internal DNS resolvers
      - Domain controllers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: >
          FOR each query_type (A, AAAA, MX, SRV, NXDomain):
            AGGREGATE volume per minute
            APPLY LSTM autoencoder model to time-series data
            ALERT when reconstruction error exceeds a dynamic threshold
  - question: Are external IP addresses attempting to access known administrative or non-public web pages?
    context: This question focuses on protecting clearly defined sensitive assets. By maintaining a watchlist of URIs that should never be accessed from the public internet (e.g., /admin, /api/internal), an organization can create high-fidelity alerts. Any attempt to access these paths from an IP not on an explicit allow-list is a strong signal of targeted probing.
    answer_sources:
      - Zeek http.log
      - Zeek conn.log
      - Web application servers
      - Internal administrative portals
      - Staging or development environments inadvertently exposed to the internet
    range: last 90 days
    queries:
      - technology: pseudocode
        query: >
          MAINTAIN allow-list of admin IPs and watchlist of admin URIs
          SEARCH http.log
          WHERE uri IN admin_uri_watchlist
          AND source_ip NOT IN admin_ip_allowlist
          GENERATE high-severity alert
  - question: Is an external IP accessing a URI that is almost exclusively accessed by internal users, based on historical data?
    context: This question aims to automatically discover and protect non-public web assets without manual configuration. The system profiles every URI to determine its "publicity score"â€”the percentage of traffic from external IPs. An external request to a URI with a very low score is highly suspicious, as it indicates an outsider is probing a resource that is normally only used internally.
    answer_sources:
      - Zeek http.log
      - Zeek conn.log
      - Web application servers
      - Internal administrative portals
      - Staging or development environments inadvertently exposed to the internet
    range: last 90 days
    queries:
      - technology: pseudocode
        query: >
          OVER 30 days, for each URI, CALCULATE publicity_score = (external_requests / total_requests)
          MONITOR in real-time
          ALERT on any external access to a URI where publicity_score < 0.05
  - question: Can a one-class SVM model, trained on legitimate external user behavior, detect anomalous sessions indicative of reconnaissance?
    context: This question uses machine learning to build a model of "normal" user behavior and detect anything that deviates. A one-class SVM is trained only on data from legitimate public user sessions. It learns the boundaries of normal activity. Any new session from an external IP that falls outside this boundary is flagged as an outlier, effectively catching reconnaissance behavior that doesn't look like a normal user.
    answer_sources:
      - Zeek http.log
      - Zeek conn.log
      - Web application servers
      - Internal administrative portals
      - Staging or development environments inadvertently exposed to the internet
    range: last 90 days
    queries:
      - technology: pseudocode
        query: >
          TRAIN a one-class SVM model on feature sets from legitimate external user sessions
          FOR each new external session:
            EXTRACT features (request frequency, URI diversity, user-agent)
            APPLY model
            IF session is classified as an outlier
              FLAG for review