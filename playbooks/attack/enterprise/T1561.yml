name: "T1561: Disk Wipe"
id: "a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d"
description: "This playbook helps investigate whether an adversary is attempting to wipe or corrupt data to impact system availability. It focuses on detecting several key indicators of disk wiping activity, including the execution of known disk-wiping malware identified by file hash, the use of built-in system utilities with destructive command-line arguments, unauthorized processes performing raw disk access, anomalous rates of file deletion or modification by a single process, unusual SMB connection patterns indicating lateral movement for propagation, and the execution of destructive commands on network infrastructure devices."
type: "technique"
related:
  - "TA0040: Impact"
contributors:
  - "Zachary Szewczyk"
  - "Ask Sage"
created: "2025-10-01"
modified: "2025-10-01"
version: 1.0
tags: "none"
questions:
  - question: "Has a process executed with a file hash matching a known disk-wiping malware signature?"
    context: "This question seeks to identify the most direct evidence of a disk-wiping attack by matching the file hash of newly created processes against a curated list of known disk-wiping malware, such as WhisperGate or NotPetya. A match is a high-confidence indicator of compromise and requires immediate response."
    answer_sources:
      - "Windows Event ID 4688"
      - "Windows Event ID 1 (Sysmon)"
      - "All Windows endpoints and servers, particularly Domain Controllers, file servers, and database servers."
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "SEARCH process_creation_events | WHERE hash IN known_wiper_hashes | ALERT"
  - question: "Is a known wiper malware being spawned by a statistically rare parent process?"
    context: "This question adds context to a wiper malware detection. Wiper malware executed by an uncommon parent process (e.g., a Microsoft Word document spawning a wiper) is highly anomalous and can indicate the initial infection vector. Analyzing the parent-child process relationship helps increase the confidence of the alert and provides crucial forensic data."
    answer_sources:
      - "Windows Event ID 4688"
      - "Windows Event ID 1 (Sysmon)"
      - "All Windows endpoints and servers, particularly Domain Controllers, file servers, and database servers."
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "SEARCH process_creation_events | WHERE hash IN known_wiper_hashes | CALCULATE prevalence of parent_process_name | IF prevalence is low, INCREASE risk_score"
  - question: "Does a machine learning model classify any newly executed process as 'wiper-like' based on its metadata?"
    context: "This question leverages machine learning to proactively identify potential zero-day or unknown disk-wiping malware that may not be present in threat intelligence feeds. The model analyzes process characteristics like file path, parent process, and entropy to assign a probability score, enabling the detection of suspicious activity that would otherwise be missed by signature-based methods."
    answer_sources:
      - "Windows Event ID 4688"
      - "Windows Event ID 1 (Sysmon)"
      - "All Windows endpoints and servers, particularly Domain Controllers, file servers, and database servers."
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "FOR each new_process | EXTRACT features (path, parent, entropy) | PREDICT probability_is_wiper with ML_model | IF probability > 0.9, ALERT"
  - question: "Have any built-in system utilities been executed with command-line arguments known to perform destructive data wiping operations?"
    context: "This question aims to detect the malicious use of legitimate system tools (Living off the Land) for destructive purposes. Adversaries often use utilities like `vssadmin.exe`, `cipher.exe`, or `format.exe` with specific flags to delete shadow copies, overwrite free space, or format drives. Monitoring for these specific command-line patterns is a high-fidelity way to detect this technique."
    answer_sources:
      - "Windows Event ID 4688"
      - "Windows Event ID 1 (Sysmon)"
      - "Critical infrastructure servers (e.g., virtualization hosts, backup servers), domain controllers, and standard user workstations."
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "SEARCH process_creation_events | WHERE command_line MATCHES regex_list_of_destructive_commands | ALERT"
  - question: "Is a destructive command being executed for the first time by a specific user or on a specific host?"
    context: "This question helps reduce false positives from legitimate administrative activity by baselining command execution. A destructive command executed by a user or on a host where it has never been seen before is significantly more suspicious than one run by a system administrator as part of a routine task. It also looks for anomalies in command-line string entropy to detect obfuscation."
    answer_sources:
      - "Windows Event ID 4688"
      - "Windows Event ID 1 (Sysmon)"
      - "Critical infrastructure servers (e.g., virtualization hosts, backup servers), domain controllers, and standard user workstations."
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "SEARCH destructive_commands | CALCULATE historical_frequency by user, host | IF frequency is zero or near-zero, ALERT"
  - question: "Has there been a sudden, coordinated spike in the execution of destructive utilities across multiple hosts?"
    context: "This question aims to detect large-scale, coordinated attacks. A time-series model can distinguish between normal, isolated administrative use and a sudden burst of activity across the network, which is a strong indicator of an automated, widespread destructive campaign. This helps detect attacks that might be missed when looking at hosts individually."
    answer_sources:
      - "Windows Event ID 4688"
      - "Windows Event ID 1 (Sysmon)"
      - "Critical infrastructure servers (e.g., virtualization hosts, backup servers), domain controllers, and standard user workstations."
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "MONITOR execution_frequency of destructive_utilities network-wide | USE time_series_model to forecast expected_volume | IF observed_volume > forecast_confidence_interval, ALERT"
  - question: "Has an unauthorized process performed a raw disk access operation?"
    context: "This question seeks to identify processes that attempt to bypass the file system to directly read from the physical disk, a common behavior of wipers preparing to overwrite the Master Boot Record (MBR) or other critical disk structures. By maintaining an allow-list of legitimate tools (e.g., backup or forensic software), any other process performing this action is highly suspect."
    answer_sources:
      - "Windows Event ID 9 (Sysmon)"
      - "Boot drives of all Windows servers and endpoints, especially Domain Controllers and critical application servers."
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "SEARCH sysmon_eid_9 | WHERE device CONTAINS \"\\\\.\\PhysicalDrive\" AND process_hash NOT IN allow_list | ALERT"
  - question: "Is a process performing raw disk access statistically rare across the enterprise?"
    context: "This question helps prioritize alerts by focusing on rarity. A legitimate but unlisted tool might be present on many systems, whereas malware is often found on only a small number of compromised hosts. If a process that performs raw disk access is found on very few endpoints (e.g., less than 1%), it is much more likely to be malicious."
    answer_sources:
      - "Windows Event ID 9 (Sysmon)"
      - "Boot drives of all Windows servers and endpoints, especially Domain Controllers and critical application servers."
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "SEARCH raw_disk_access_events | FOR each process NOT IN allow_list | CALCULATE prevalence_across_endpoints | IF prevalence < 1%, ALERT"
  - question: "Does a machine learning model classify a process performing raw disk access as malicious based on its attributes?"
    context: "This question uses a machine learning model to score the likelihood that a process performing raw disk access is malicious, even if it's not on an allow-list. The model considers multiple features, such as the process's signature status, parent process, and file entropy, to make a more nuanced decision than a simple allow/deny list, helping to catch sophisticated or unknown threats."
    answer_sources:
      - "Windows Event ID 9 (Sysmon)"
      - "Boot drives of all Windows servers and endpoints, especially Domain Controllers and critical application servers."
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "FOR each raw_disk_access_event | EXTRACT features (path, signature, parent) | PREDICT probability_is_malicious with ML_model | IF probability > 0.9, ALERT"
  - question: "Has an unauthorized process deleted or modified critical system files or file types?"
    context: "This question focuses on protecting specific, high-value assets. By creating a watchlist of critical directories (e.g., C:\\Windows\\System32) and sensitive file extensions (e.g., .bak, .vhd), this query can trigger a high-fidelity alert when a non-allow-listed process attempts to delete them, indicating a targeted destructive action."
    answer_sources:
      - "Windows Event ID 11 (Sysmon)"
      - "Windows Event ID 23 (Sysmon)"
      - "Windows Event ID 26 (Sysmon)"
      - "File servers, document management systems, and developer workstations with access to source code repositories."
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "SEARCH file_delete_events | WHERE (target_directory IN critical_dirs OR target_extension IN critical_exts) AND process NOT IN allow_list | ALERT"
  - question: "Has any single process performed file deletion or modification operations at a rate that significantly exceeds its normal baseline?"
    context: "This question aims to detect anomalous behavior by baselining normal activity. A process that suddenly starts deleting or changing files at a rate far beyond its historical norm (e.g., exceeding the 99th percentile) is a strong indicator of ransomware or a wiper. This method can catch destructive activity without prior knowledge of the specific malware."
    answer_sources:
      - "Windows Event ID 11 (Sysmon)"
      - "Windows Event ID 23 (Sysmon)"
      - "Windows Event ID 26 (Sysmon)"
      - "File servers, document management systems, and developer workstations with access to source code repositories."
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "FOR each process on host | BASELINE file_operation_counts per minute | IF current_count > 99th_percentile_of_baseline, ALERT"
  - question: "Has the volume of file deletions on a critical server significantly deviated from the forecasted volume predicted by a time-series model?"
    context: "This question applies machine learning to detect both rapid and 'low-and-slow' wiping activity on high-value assets like file servers. A time-series model learns the normal rhythm of file operations and can alert when the observed activity falls outside the predicted confidence interval, indicating an anomaly that might be missed by simple thresholding."
    answer_sources:
      - "Windows Event ID 11 (Sysmon)"
      - "Windows Event ID 23 (Sysmon)"
      - "Windows Event ID 26 (Sysmon)"
      - "File servers, document management systems, and developer workstations with access to source code repositories."
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "MONITOR file_deletion_volume on critical_server | USE time_series_model to forecast expected_volume | IF observed_volume deviates from forecast, ALERT"
  - question: "Following a disk-wiping alert, did the source host attempt to connect to administrative shares on multiple other hosts?"
    context: "This question seeks to identify the propagation phase of a wormable wiper. After initial execution, some malware attempts to spread to other machines via administrative shares (e.g., ADMIN$, C$). Correlating a prior disk-wipe indicator with subsequent, rapid SMB share access provides strong evidence of an active, spreading threat."
    answer_sources:
      - "Zeek smb_mapping.log"
      - "Zeek conn.log"
      - "Windows Event ID 5140"
      - "Internal network segments, monitoring East-West traffic between workstations and servers."
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "TRIGGER on disk_wipe_alert | WITHIN 10 mins, SEARCH for SMB_access_to_admin_shares from source_host | IF destination_host_count > 5, ALERT"
  - question: "Has any host exhibited an anomalously high rate of new SMB connections, indicating worm-like behavior?"
    context: "This question identifies propagation behavior by baselining normal network activity for each host. A host that suddenly begins connecting to a large number of unique destination IPs on port 445 (SMB) is exhibiting 'fan-out' behavior inconsistent with normal user or server activity. This statistical anomaly is a strong indicator of a self-propagating threat."
    answer_sources:
      - "Zeek smb_mapping.log"
      - "Zeek conn.log"
      - "Windows Event ID 5140"
      - "Internal network segments, monitoring East-West traffic between workstations and servers."
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "FOR each host | CALCULATE rolling 5-min count of unique SMB destinations ('fan-out') | BASELINE fan-out score | IF current_score > 99.9th_percentile_of_baseline, ALERT"
  - question: "Using a graph-based model of the network, is any host behaving as an outlier by creating many new, short-lived SMB connections?"
    context: "This question applies graph analytics to detect sophisticated propagation. By modeling normal SMB communication patterns, an algorithm can identify a host that suddenly deviates by connecting to many other hosts it doesn't normally interact with. This approach can uncover complex or subtle propagation patterns that might be missed by simple statistical counts."
    answer_sources:
      - "Zeek smb_mapping.log"
      - "Zeek conn.log"
      - "Windows Event ID 5140"
      - "Internal network segments, monitoring East-West traffic between workstations and servers."
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "MODEL network as graph (nodes=hosts, edges=SMB_connections) | USE graph_outlier_detection_algorithm | IDENTIFY nodes with anomalous new edge creation | ALERT"
  - question: "Have any destructive commands, such as 'erase startup-config', been executed on core network devices?"
    context: "This question addresses the risk of an adversary destroying network infrastructure configurations. By monitoring syslog from routers, switches, and firewalls for specific, highly destructive command strings, security teams can immediately detect attempts to brick network devices, which is a critical impact tactic."
    answer_sources:
      - "Network Device Syslog"
      - "Zeek conn.log"
      - "Core network switches, routers, firewalls, and security appliances."
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "SEARCH network_syslog | WHERE command_string MATCHES destructive_command_watchlist | ALERT"
  - question: "Has a user account executed destructive commands on a network device at a rate that is anomalous for that specific user?"
    context: "This question helps distinguish between malicious activity and legitimate, albeit rare, administrative tasks. By baselining command usage per user, an alert can be triggered when a user executes destructive commands more frequently than their personal norm. It also adds context by checking if the command originates from an unusual IP address, suggesting account compromise."
    answer_sources:
      - "Network Device Syslog"
      - "Zeek conn.log"
      - "Core network switches, routers, firewalls, and security appliances."
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "FOR each admin_user | BASELINE command_frequency | IF destructive_command_frequency > (baseline_mean + 2*std_dev), ALERT"
  - question: "Did a destructive command on a network device appear in a sequence of commands that is highly improbable for a normal administrative session?"
    context: "This question detects malicious intent by analyzing the *order* of commands, not just their individual occurrence. A Markov model learns typical command workflows for administrators. A destructive command appearing out of its normal context (e.g., immediately after login without any preceding 'show' commands) would have a low transition probability and be flagged as a sequential anomaly, indicating a likely attack."
    answer_sources:
      - "Network Device Syslog"
      - "Zeek conn.log"
      - "Core network switches, routers, firewalls, and security appliances."
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "MODEL admin sessions with Markov_chains per user_role | FOR each new command | CALCULATE transition_probability from previous_command | IF command is destructive AND probability is low, ALERT"