name: 'T1056.002: GUI Input Capture'
id: 'a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d'
description: This playbook helps investigate attempts by an adversary to capture credentials by spoofing legitimate GUI prompts (T1056.002). It covers detecting the initial capture attempt through methods such as executing known malicious tools, running scripts that create GUI forms, or observing anomalous process creation chains (e.g., Office applications spawning scripting interpreters). The playbook also addresses the subsequent exfiltration of these captured credentials, looking for outbound network connections to known malicious destinations, HTTP/S requests containing credential data from unusual processes, or the use of covert channels like DNS or ICMP for data exfiltration shortly after a suspected capture event.
type: technique
related:
  - 'TA0006: Credential Access'
  - 'TA0009: Collection'
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: '2025-10-01'
modified: '2025-10-01'
version: 1.0
tags: none
questions:
  - question: Is a process associated with a known GUI-based credential theft tool running on the endpoint?
    context: This question aims to identify the most direct evidence of a GUI input capture attack by checking for the execution of tools specifically designed for this purpose. By comparing the file hash of newly created processes against a curated list of Indicators of Compromise (IoCs) for tools like PowerSploit, Mimikatz variants, or other credential phishing executables, an analyst can quickly confirm a high-confidence compromise. A match indicates an active attempt to spoof a GUI prompt and steal user credentials.
    answer_sources:
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - User workstations
      - Remote Desktop servers
      - Citrix servers
      - Virtual Desktop Infrastructure (VDI) instances
      - SIEM correlation engine
    range: Last 90 days
    queries:
      - 'Search process creation events (WEF 4688, Sysmon 1). FOR EACH event, EXTRACT file hash (MD5, SHA256). COMPARE hash against IoC list of known GUI credential theft tools. IF match found, ALERT with hostname, user, process name, and hash.'
  - question: Has a rare or previously unseen process been spawned by a common user application, potentially indicating a disguised credential phisher?
    context: Adversaries may use custom or packed tools that do not have a known malicious hash. This question helps uncover such tools by focusing on rarity. A process spawned by a common application like a web browser or email client that has only run on a very small number of endpoints across the enterprise is highly suspicious. This statistical anomaly suggests the process is not standard software and could be a custom-built tool for GUI-based credential theft.
    answer_sources:
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - User workstations
      - Remote Desktop servers
      - Citrix servers
      - Virtual Desktop Infrastructure (VDI) instances
      - SIEM correlation engine
    range: Last 90 days
    queries:
      - 'FROM process creation events, GROUP BY process hash. CALCULATE prevalence of each hash across all endpoints over the last 30 days. FILTER for processes spawned by common user applications (e.g., OUTLOOK.EXE, WINWORD.EXE). IF prevalence is below threshold (e.g., < 0.1% of hosts), FLAG as rare and suspicious for investigation.'
  - question: Does a newly created process exhibit characteristics of a known credential phishing tool based on a machine learning model?
    context: This question leverages a machine learning model to identify malicious processes that may evade hash-based and simple statistical detections. The model analyzes a combination of features like the parent process, command-line arguments, and user context to classify a process's intent. An alert from this model indicates that the process's behavior profile strongly matches patterns seen in previously identified GUI credential phishing attacks, even if the specific file or command is new.
    answer_sources:
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - User workstations
      - Remote Desktop servers
      - Citrix servers
      - Virtual Desktop Infrastructure (VDI) instances
      - SIEM correlation engine
    range: Last 90 days
    queries:
      - 'INPUT process creation event features (parent process, path, command-line length/entropy, user) into a pre-trained classification model. IF model output score is > confidence threshold (e.g., 0.90), CLASSIFY as credential phisher and ALERT.'
  - question: Is a scripting interpreter being used to generate a GUI element for potential credential capture?
    context: This question looks for adversaries using scripting languages like PowerShell to dynamically create fake login prompts. The presence of specific keywords related to GUI creation (e.g., 'System.Windows.Forms', 'Show-Dialog') in a script's command line or code block is a strong indicator of this technique. It's particularly suspicious if the script is not launched from a development environment (like powershell_ise.exe), as it suggests an attempt to run a malicious GUI-spoofing script on a user's machine.
    answer_sources:
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - Windows PowerShell Event ID 4104
      - User workstations
      - Domain Controllers
      - Application servers
      - Exchange servers
    range: Last 90 days
    queries:
      - 'SEARCH command-line arguments (WEF 4688, Sysmon 1) and PowerShell script blocks (WEF 4104) for keywords like ''System.Windows.Forms'', ''Show-Dialog'', etc. IF keywords are found AND parent process is not a known IDE, ALERT.'
  - question: Is a script being executed that is unusually long or complex compared to the baseline for that user or host?
    context: Adversaries often obfuscate or embed large payloads (like GUI generation code) within their scripts, making them statistically different from typical, simple administrative scripts. This question aims to detect these outliers by analyzing the length and character entropy (randomness) of script blocks. A script that is significantly longer or more complex than the established norm for a given user or host is suspicious and may contain malicious code for GUI spoofing.
    answer_sources:
      - Windows PowerShell Event ID 4104
      - User workstations
      - Domain Controllers
      - Application servers
      - Exchange servers
    range: Last 90 days
    queries:
      - 'FOR EACH PowerShell script execution (WEF 4104), CALCULATE script block length and entropy. ESTABLISH baseline distribution for these metrics per user/host. IF a new script''s metrics exceed a high percentile (e.g., 98th) of its baseline, FLAG for review.'
  - question: Does the content of a PowerShell script block classify as malicious based on a machine learning model trained to detect credential theft scripts?
    context: This question applies a sophisticated machine learning model to the full text of PowerShell scripts to identify malicious behavior. The model is trained to recognize the patterns, functions, and structures commonly found in credential-stealing scripts, including those that generate spoofed GUI prompts. An alert indicates that the script's content is highly similar to known malicious examples, providing a high-confidence detection that can bypass simple keyword or statistical checks.
    answer_sources:
      - Windows PowerShell Event ID 4104
      - User workstations
      - Domain Controllers
      - Application servers
      - Exchange servers
    range: Last 90 days
    queries:
      - 'INPUT tokenized PowerShell script block content (WEF 4104) into a pre-trained classification model. IF model classifies the script as malicious with high probability, ALERT.'
  - question: Has a common document-based application (like Word or Outlook) spawned a scripting interpreter?
    context: This question targets a common infection vector where a user opens a malicious document or email, which then launches a script to perform further actions. Applications like Microsoft Word, Outlook, or Adobe Reader should not normally spawn processes like powershell.exe or cmd.exe. Observing such a parent-child process relationship is a high-fidelity indicator of compromise, often representing the initial stage of an attack that could lead to GUI-based credential theft.
    answer_sources:
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - User workstations
      - File servers hosting Office documents
      - Mail servers
      - SIEM correlation engine
    range: Last 90 days
    queries:
      - 'MONITOR process creation events (WEF 4688, Sysmon 1). IF parent process is in list [WINWORD.EXE, OUTLOOK.EXE, AcroRd32.exe] AND child process is in list [powershell.exe, cmd.exe, wscript.exe], trigger a high-severity ALERT.'
  - question: Has a rare or never-before-seen parent-child process relationship occurred on the endpoint?
    context: Adversaries may use less common applications or scripts to evade simple rules. This question establishes a baseline of all normal parent-child process relationships across the enterprise and then looks for deviations. Any relationship that has never been seen before or is extremely infrequent is flagged as an anomaly. This can uncover novel attack paths, such as a legitimate but rarely used application being exploited to launch a malicious script or tool for credential capture.
    answer_sources:
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - User workstations
      - File servers hosting Office documents
      - Mail servers
      - SIEM correlation engine
    range: Last 90 days
    queries:
      - 'BUILD frequency table of all parent-child process pairs over 30 days. IF a newly observed pair is ''first seen'' or its frequency is in the bottom percentile (e.g., < 1%), ALERT as a rare process chain.'
  - question: Does a process creation event deviate significantly from the normal process activity patterns learned by an anomaly detection model?
    context: This question uses an unsupervised machine learning model to learn the complex web of normal process interactions on endpoints. The model considers factors like parent process, child process, user, and time of day. Any new process creation event that the model flags as a high-scoring anomaly represents a significant deviation from established behavior. This is a powerful way to detect sophisticated attacks that use legitimate tools in illegitimate ways (living-off-the-land) to initiate a credential capture sequence.
    answer_sources:
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - User workstations
      - File servers hosting Office documents
      - Mail servers
      - SIEM correlation engine
    range: Last 90 days
    queries:
      - 'INPUT features from parent-child process events (parent name, child name, user, time) into an unsupervised anomaly detection model (e.g., Isolation Forest). IF the event receives a high anomaly score, FLAG for investigation.'
  - question: Did a host that recently triggered a credential capture alert make an outbound connection to a known malicious IP or domain?
    context: This question directly links a suspected credential capture event with potential data exfiltration. By correlating a high-risk process alert with subsequent network traffic from the same host, an analyst can confirm the attack's progression. A connection to a destination on a threat intelligence blocklist within minutes of the initial alert is strong evidence that captured data is being sent to an adversary-controlled command-and-control (C2) server.
    answer_sources:
      - Zeek conn.log
      - Zeek http.log
      - Zeek dns.log
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - Sysmon Event ID 3
      - Network egress points (firewalls, proxies)
      - DNS servers
      - Endpoints
      - SIEM correlation engine
    range: Last 90 days
    queries:
      - 'CORRELATE credential capture alerts with network connection logs (Sysmon 3, Zeek). IF source host of alert initiates outbound connection within 5 minutes to a destination on a threat intel blocklist, ESCALATE to incident.'
  - question: Following a credential capture alert, did the host make DNS requests for statistically unusual domains (e.g., newly registered, high entropy)?
    context: Adversaries often use newly created or algorithmically generated domains for their C2 infrastructure to evade blocklists. This question aims to detect such activity by analyzing the characteristics of domains requested by a potentially compromised host. Domains that are very new, have random-looking names (high entropy), or are rarely visited by anyone else in the enterprise are statistically anomalous and likely malicious. This is a strong indicator of C2 communication for data exfiltration.
    answer_sources:
      - Zeek dns.log
      - Network egress points (firewalls, proxies)
      - DNS servers
      - Endpoints
      - SIEM correlation engine
    range: Last 90 days
    queries:
      - 'ON host with recent credential capture alert, ANALYZE subsequent DNS queries (Zeek dns.log). CALCULATE domain features (age, entropy, rarity). IF domain is anomalous (e.g., age < 30 days, entropy > 3.5), FLAG as potential C2.'
  - question: Did a host, after a suspected GUI capture event, attempt to resolve a domain that a machine learning model classifies as a likely Domain Generation Algorithm (DGA) domain?
    context: This question uses a specialized machine learning model to detect a specific C2 technique Domain Generation Algorithms (DGAs). These algorithms create large numbers of pseudo-random domain names, with the malware trying to connect to them until it finds one that the adversary has registered. A DGA detection model can identify these algorithmically generated names. A positive hit on a host that recently had a credential capture alert is a high-confidence indicator of active C2 communication.
    answer_sources:
      - Zeek dns.log
      - Network egress points (firewalls, proxies)
      - DNS servers
      - Endpoints
      - SIEM correlation engine
    range: Last 90 days
    queries:
      - 'INPUT all DNS queries (Zeek dns.log) into a DGA detection model. IF a domain is classified as DGA AND the query comes from a host with a recent GUI capture alert, ALERT.'
  - question: Is an unusual process (not a web browser) sending an HTTP/S POST request containing credential-like data patterns?
    context: This question targets the exfiltration of credentials over the common web protocols HTTP or HTTPS. With TLS inspection, the body of the request can be scanned for keywords like 'username=' or 'password='. Even without inspection, identifying the process that initiated the request is key. A process like powershell.exe or an unsigned binary making an HTTP POST is highly irregular, as these processes do not typically perform web-based authentication. This is a strong sign of data exfiltration.
    answer_sources:
      - Zeek http.log
      - Zeek ssl.log
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - Web proxies with TLS inspection
      - Network TAPs at egress points
      - Endpoints
    range: Last 90 days
    queries:
      - 'WITH TLS inspection, SCAN HTTP POST request bodies for credential patterns (e.g., /user|pass=/i). CORRELATE with process logs to find originating process. IF process is not a whitelisted browser, ALERT.'
  - question: Did a non-browser process make an HTTP POST request with a body size that is both small and a statistical outlier for that process?
    context: This question helps detect credential exfiltration without needing to inspect the encrypted traffic payload. The logic is that exfiltrated credentials constitute a small amount of data. By establishing a baseline for the normal size of HTTP POST requests made by each process, we can spot anomalies. A very small POST request from a process that normally sends larger data chunks (or none at all) is a statistical outlier and could represent a credential theft event.
    answer_sources:
      - Zeek http.log
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - Web proxies with TLS inspection
      - Network TAPs at egress points
      - Endpoints
    range: Last 90 days
    queries:
      - 'FOR all HTTP POST requests, CALCULATE request body size. ESTABLISH per-process baseline of POST sizes. IF request from non-browser has small size (e.g., < 1KB) AND is a statistical outlier (> 3 std dev from mean), FLAG as potential exfiltration.'
  - question: Is an HTTP/S connection being classified as malicious by a machine learning model based on its metadata and originating process?
    context: This question uses a machine learning model to holistically evaluate an HTTP/S connection for maliciousness, even without decrypting the traffic. The model considers features like the process that made the connection, the destination server name (SNI), the structure of the URI, and the TLS handshake fingerprint (JA3/JA3S). An alert from this model indicates that the entire connection profile matches known malicious patterns, providing a robust method for detecting C2 communication and data exfiltration.
    answer_sources:
      - Zeek http.log
      - Zeek ssl.log
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - Web proxies with TLS inspection
      - Network TAPs at egress points
      - Endpoints
    range: Last 90 days
    queries:
      - 'INPUT connection features (process name, SNI, URI, JA3 hash) into a pre-trained classifier. IF connection is classified as malicious with high confidence, ALERT.'
  - question: Is there evidence of data exfiltration via covert channels like DNS or ICMP shortly after a suspected credential capture event?
    context: This question looks for adversaries trying to sneak data out using protocols not designed for file transfer. By encoding data into long DNS subdomains or hiding it in ICMP packet payloads, they can bypass some network security controls. Detecting unusually long DNS queries or ICMP packets with payloads, and correlating them in time and source host with a prior credential capture alert, provides strong evidence of a stealthy exfiltration attempt.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - Zeek icmp.log
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - DNS resolvers
      - Network egress points (firewalls)
      - Endpoints
      - SIEM correlation engine
    range: Last 90 days
    queries:
      - 'MONITOR DNS logs for long FQDNs (>100 chars) or ICMP logs for packets with payload > 0. CORRELATE source host with recent credential capture alerts. IF match, ALERT.'
  - question: Has a host's DNS query behavior suddenly spiked in a way that suggests DNS tunneling?
    context: DNS tunneling for data exfiltration generates a distinct and anomalous traffic pattern. This question aims to detect that pattern by baselining a host's normal DNS activity (e.g., query length, number of subdomains). A sudden and sustained increase in these metrics, deviating significantly from the host's own historical norm, is a strong statistical indicator that the DNS protocol is being abused to exfiltrate data, likely credentials captured in a preceding attack phase.
    answer_sources:
      - Zeek dns.log
      - DNS resolvers
      - Network egress points (firewalls)
      - Endpoints
      - SIEM correlation engine
    range: Last 90 days
    queries:
      - 'CREATE time series of host''s DNS metrics (avg query length, unique subdomains). IF a sudden spike is > 3 standard deviations from the 30-day baseline, FLAG as potential DNS tunneling.'
  - question: Is a host's DNS traffic generating a high anomaly score from a machine learning model, indicating behavior consistent with data exfiltration?
    context: This question uses an unsupervised anomaly detection model to create a sophisticated, multi-faceted profile of a host's normal DNS behavior. The model learns the typical patterns of query types, sizes, and label entropy. Any real-time traffic that significantly deviates from this learned normal profile will receive a high anomaly score. This is an effective way to catch DNS exfiltration techniques that may be too subtle for simple statistical thresholds, providing a more robust detection of covert channel activity.
    answer_sources:
      - Zeek dns.log
      - DNS resolvers
      - Network egress points (firewalls)
      - Endpoints
      - SIEM correlation engine
    range: Last 90 days
    queries:
      - 'INPUT per-host DNS traffic features (query sizes, label entropy, type distribution) into an unsupervised anomaly detection model. IF traffic generates a high anomaly score, ALERT for potential exfiltration.'