name: T1596: Search Open Technical Databases
id: f47ac10b-58cc-4372-a567-0e02b2c3d479
description: |
  This playbook helps investigate whether an adversary is conducting reconnaissance against the enterprise by searching open technical databases. This involves identifying signs of active and passive information gathering, such as widespread port scanning from external IPs, inbound web requests with scanner-like user agents, low-and-slow connection patterns designed to evade detection, spikes in authentication failures from publicly sourced usernames, and anomalous DNS query patterns indicative of subdomain enumeration. The goal is to detect an adversary's attempts to map the organization's external footprint, identify vulnerabilities, and gather information for subsequent attack stages.
type: technique
related:
  - TA0043: Reconnaissance
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
investigative_questions:
  - question: Are known internet scanners or malicious IPs targeting our non-public or sensitive ports?
    context: |
      This question aims to provide high-fidelity alerts by detecting reconnaissance from known bad actors. By ingesting and cross-referencing external traffic with threat intelligence feeds of known scanners (e.g., Shodan, Censys) and malicious IPs, we can quickly identify targeted probes against sensitive infrastructure like RDP, SSH, or WinRM ports. A match indicates a clear and immediate threat that warrants investigation.
    answer_sources:
      - Zeek conn.log
      - CTI feeds of known internet scanners and malicious IPs
      - Internet gateways
      - external-facing firewalls
      - cloud network flow logs
    range: last 90 days
    queries:
      - pseudocode: JOIN (Zeek conn.log source IPs) WITH (CTI scanner/malicious IP reference set) WHERE (destination port is in sensitive port list) and (time window is 5 minutes).
  - question: Are any external IP addresses exhibiting port scanning behavior by contacting an anomalously high number of unique ports?
    context: |
      This question helps identify potential scanners that are not yet present on CTI lists. Adversaries often use new or rotating infrastructure for their scans. By establishing a baseline for normal traffic and using statistical analysis to find outliers (e.g., an IP connecting to an unusually high number of unique ports), we can detect scanning behavior that would otherwise be missed by signature-based methods.
    answer_sources:
      - Zeek conn.log
      - Internet gateways
      - external-facing firewalls
      - cloud network flow logs
    range: last 90 days
    queries:
      - pseudocode: FROM (Zeek conn.log) GROUP BY (source IP) over 1-hour window, CALCULATE (count of unique destination ports). ALERT IF (count > 98th percentile of baseline).
  - question: Is there a significant deviation from the normal volume of connection attempts from known internet scanners, suggesting a targeted campaign?
    context: |
      This question focuses on identifying a shift in adversary intent. While passive scanning from known services is common, a sudden, anomalous spike in that activity can signal that the organization has become a specific target. This moves beyond simple detection to trend analysis, allowing analysts to spot a potential pre-exploit campaign.
    answer_sources:
      - Zeek conn.log
      - Internet gateways
      - external-facing firewalls
      - cloud network flow logs
    range: last 90 days
    queries:
      - pseudocode: APPLY (time-series anomaly detection model) TO (volume of connections from known scanner IPs). ALERT IF (observed volume significantly exceeds forecasted volume).
  - question: Are we observing inbound web requests with User-Agents or URIs matching signatures of known scanning and vulnerability assessment tools?
    context: |
      This is a fundamental, signature-based question to detect automated scanning tools targeting web applications. Tools like 'masscan', 'nuclei', and 'nessus' often leave identifiable traces in User-Agent strings or request specific, known URIs. Detecting these signatures provides a direct indication that an adversary is probing for web vulnerabilities.
    answer_sources:
      - Zeek http.log
      - Internet-facing web servers
      - load balancers
      - reverse proxies
    range: last 90 days
    queries:
      - pseudocode: FROM (Zeek http.log) SEARCH for regex patterns for known scanner tools (e.g., 'masscan', 'nuclei') IN (user_agent, uri fields).
  - question: Are any external IP addresses exhibiting automated, non-human browsing behavior indicated by low-entropy URI requests?
    context: |
      This question helps detect automated tools that may not have a known signature or are attempting to blend in. A human user's browsing path is typically varied and complex (high entropy), whereas a bot scanning for a specific file or directory across many paths will issue repetitive, predictable requests (low entropy). Identifying this low-entropy behavior can unmask stealthy web scanners.
    answer_sources:
      - Zeek http.log
      - Internet-facing web servers
      - load balancers
      - reverse proxies
    range: last 90 days
    queries:
      - pseudocode: FROM (Zeek http.log) GROUP BY (source IP) over 15-minute window, CALCULATE (Shannon entropy of requested URIs). ALERT IF (entropy < 5th percentile of baseline).
  - question: Can we use a machine learning model to identify sophisticated scanner traffic that evades signature and simple statistical checks?
    context: |
      This question addresses the need for more advanced detection against adversaries who customize their tools to evade basic defenses. A machine learning model can learn complex patterns from multiple request features (URI structure, header count, request frequency, etc.) to identify scanner traffic that is designed to mimic legitimate user behavior.
    answer_sources:
      - Zeek http.log
      - Internet-facing web servers
      - load balancers
      - reverse proxies
    range: last 90 days
    queries:
      - pseudocode: APPLY (pre-trained classification model) TO (new HTTP requests). SCORE each request for likelihood of being scanner traffic. ALERT on high scores.
  - question: Are external entities attempting to connect to our 'honey-ports'?
    context: |
      This is a high-fidelity detection method using deception. Honey-ports are ports that are intentionally monitored but firewalled and have no legitimate services. Any connection attempt to a honey-port is, by definition, unauthorized and highly indicative of a network scan, providing a reliable and low-noise alert.
    answer_sources:
      - Zeek conn.log
      - Network perimeter firewalls
      - internet gateways
      - DMZ network segments
    range: last 90 days
    queries:
      - pseudocode: FROM (firewall/conn logs) ALERT IF (source IP is external) AND (destination port is in honey-port list).
  - question: Are any external IP addresses conducting 'low-and-slow' scans, characterized by connecting to many different hosts but with very few connections to each one?
    context: |
      This question targets stealthy scanning techniques designed to fly under the radar of volume-based alerting. By spreading a few connection attempts across a wide range of target hosts over a long period, attackers avoid triggering thresholds. This query specifically looks for that pattern of high 'fan-out' to many hosts combined with a low connection count per host.
    answer_sources:
      - Zeek conn.log
      - Network perimeter firewalls
      - internet gateways
      - DMZ network segments
    range: last 90 days
    queries:
      - pseudocode: FROM (Zeek conn.log) over 24 hours, GROUP BY (source IP). CALCULATE (unique destination host count) and (connection count per host). ALERT IF (host count > 95th percentile) AND (connection count < 5th percentile).
  - question: Can we identify coordinated, distributed 'low-and-slow' scans by clustering connection events?
    context: |
      This question addresses advanced, distributed scanning campaigns where an adversary uses multiple source IPs to evade per-IP detection logic. By applying clustering algorithms, we can group seemingly unrelated, disparate connection events based on shared characteristics (e.g., destination ports, timing, geo-location), revealing the underlying coordinated scan that would be invisible to simpler methods.
    answer_sources:
      - Zeek conn.log
      - Network perimeter firewalls
      - internet gateways
      - DMZ network segments
    range: last 90 days
    queries:
      - pseudocode: APPLY (clustering algorithm like DBSCAN) to (connection log features - source IP, destination port, inter-arrival time). ANALYZE resulting clusters for signs of coordinated scanning.
  - question: Has a dormant account, whose username was found in public data sources, successfully authenticated from an external source?
    context: |
      This is a very high-fidelity question for detecting account compromise resulting from reconnaissance. It correlates three key facts: the username is publicly known (e.g., from WHOIS or data breaches), the account has been inactive for a long time, and a successful login occurred from outside the corporate network. This combination is a strong indicator of an adversary operationalizing gathered intelligence.
    answer_sources:
      - Windows Event ID 4624
      - Zeek conn.log
      - Domain Controllers
      - ADFS servers
      - VPN concentrators
      - Public data sources (WHOIS, certificate transparency logs, etc.) for watchlist creation
    range: last 90 days
    queries:
      - pseudocode: JOIN (Successful Logins - Event 4624) with (public username watchlist) and (dormant account list > 90 days). ALERT on any match from an external source IP.
  - question: Are we observing an anomalous spike in authentication failures for a specific user or service, indicating a potential password spraying or brute-force attack?
    context: |
      This question aims to detect active attempts to guess passwords based on gathered usernames. By baselining normal authentication failure rates, we can use statistical deviations to spot attacks. A high number of failures for one user suggests a brute-force attack, while a broad increase in failures across many users with few attempts each indicates a password spraying attack.
    answer_sources:
      - Windows Event ID 4625
      - Domain Controllers
      - ADFS servers
      - VPN concentrators
      - other external authentication gateways (e.g., OWA)
    range: last 90 days
    queries:
      - pseudocode: FROM (Authentication Failures - Event 4625), CALCULATE (failure rate per user) and (failure rate per service). ALERT IF (user rate > 4 std dev from user baseline) OR (service rate > 99th percentile of service baseline).
  - question: Are there successful external authentications that are anomalous based on the user's typical location and login times?
    context: |
      This question helps detect successful account takeovers by identifying logins that defy the user's normal patterns. It enriches authentication logs with IP geolocation and analyzes login timestamps to build a behavioral baseline for each user. A login that occurs from an unusual country or at an odd hour (e.g., "impossible travel") would be flagged as a potential compromise.
    answer_sources:
      - Windows Event ID 4624
      - Zeek conn.log
      - Domain Controllers
      - ADFS servers
      - VPN concentrators
      - other external authentication gateways (e.g., OWA)
    range: last 90 days
    queries:
      - pseudocode: FOR (each successful login - Event 4624), GET (source IP from conn.log). APPLY (geolocation and time-series models). ALERT IF (composite anomaly score is high).
  - question: Are external sources attempting DNS zone transfers (AXFR/ANY queries) against our DNS servers?
    context: |
      This question looks for a classic and noisy reconnaissance technique. DNS zone transfers (using AXFR or ANY query types) are designed to replicate all records from a primary to a secondary DNS server. Legitimate external requests for a full zone transfer are exceptionally rare, making any such attempt a high-fidelity indicator that an attacker is trying to map the organization's entire DNS namespace.
    answer_sources:
      - Zeek dns.log
      - External DNS servers
      - internal DNS resolvers forwarding external queries
      - network egress points
    range: last 90 days
    queries:
      - pseudocode: FROM (Zeek dns.log) ALERT IF (query_type is 'AXFR' or 'ANY') AND (source is external).
  - question: Are any external IP addresses generating a high rate of NXDOMAIN responses, or querying for historically rare subdomains, suggesting subdomain brute-forcing?
    context: |
      This question targets subdomain enumeration attacks. An adversary attempting to discover non-public subdomains (e.g., 'vpn.company.com', 'dev.company.com') will often brute-force a list of common names. This generates a large number of queries for names that don't exist, resulting in a high ratio of NXDOMAIN (non-existent domain) errors from a single source IP.
    answer_sources:
      - Zeek dns.log
      - External DNS servers
      - internal DNS resolvers forwarding external queries
      - network egress points
    range: last 90 days
    queries:
      - pseudocode: FROM (Zeek dns.log) over 5-minute window, GROUP BY (source IP). CALCULATE (NXDOMAIN ratio). ALERT IF (ratio > 99th percentile). ALSO, ALERT IF query volume for rare subdomains spikes.
  - question: Can we use machine learning to detect anomalous DNS queries and correlate them with subsequent connection attempts to increase confidence?
    context: |
      This question aims to create a high-confidence alert by linking two stages of an attack: reconnaissance and initial access. It first uses a machine learning model (like Isolation Forest) to identify unusual DNS queries that might evade simpler checks. It then correlates those findings by checking if the same source IP that made the anomalous query subsequently attempts to connect to the resolved IP address, strongly suggesting the reconnaissance was actionable.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - External DNS servers
      - internal DNS resolvers forwarding external queries
      - network egress points
    range: last 90 days
    queries:
      - pseudocode: APPLY (Isolation Forest model) to (DNS query features). IF (query is anomalous), CHECK (Zeek conn.log) for connection from same source IP to resolved IP within 5 minutes. ALERT on match.