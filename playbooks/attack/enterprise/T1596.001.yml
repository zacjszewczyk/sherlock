name: "T1596.001: DNS-Passive DNS"
id: "a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d"
description: "This playbook helps determine if an adversary is conducting reconnaissance against the organization using passive DNS. It focuses on identifying several key indicators: DNS queries from external IP addresses listed on threat intelligence feeds; sequences of queries for sensitive service discovery (SRV) records; unauthorized zone transfer attempts (AXFR/IXFR) or anomalous 'ANY' queries; high volumes of queries resulting in NXDOMAIN responses, potentially with high-entropy subdomains; and sudden, significant increases in overall DNS query volume from diverse sources. By investigating these patterns, analysts can detect and respond to early-stage reconnaissance activities."
type: "technique"
related:
  - tactic_id: "TA0043"
    tactic_name: "Reconnaissance"
contributors:
  - "Zachary Szewczyk"
  - "Ask Sage"
created: "2025-10-01"
modified: "2025-10-01"
version: 1.0
tags: "none"
questions:
  - question: "Are any DNS queries originating from external IP addresses known to be reconnaissance scanners according to threat intelligence feeds?"
    context: "This question aims to identify straightforward reconnaissance attempts by cross-referencing the source IP of DNS queries with curated lists of known malicious scanners. A match is a high-confidence indicator that an external entity is actively probing the organization's DNS infrastructure."
    answer_sources:
      - "Zeek dns.log"
      - "Threat Intelligence Platform Feeds"
      - "Authoritative DNS Servers"
      - "Public-facing DNS Resolvers"
      - "Network Egress/Ingress Points (Firewalls)"
      - "Threat Intelligence Subscription Services"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: "SEARCH Zeek dns.log WHERE source_ip IN threat_intel_feed(type='scanner') | CREATE_ALERT"
  - question: "Among the IPs identified as reconnaissance scanners, which ones are exhibiting an unusually high query frequency compared to normal external clients?"
    context: "This question helps prioritize threats by focusing on scanners that are not just present but are also highly active. By comparing their query rate to a baseline of normal traffic, analysts can distinguish between passive, low-level scanning and a potentially more targeted or aggressive reconnaissance campaign."
    answer_sources:
      - "Zeek dns.log"
      - "Threat Intelligence Platform Feeds"
      - "Authoritative DNS Servers"
      - "Public-facing DNS Resolvers"
      - "Network Egress/Ingress Points (Firewalls)"
      - "Threat Intelligence Subscription Services"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: "SEARCH Zeek dns.log WHERE source_ip IN threat_intel_feed(type='scanner') | STATS count BY source_ip | WHERE count > 95th_percentile_of_external_clients"
  - question: "Can we use a machine learning model to classify incoming DNS queries as 'reconnaissance' with high confidence?"
    context: "This question leverages machine learning to move beyond simple blocklists and statistical thresholds. A supervised model trained on features like IP reputation, ASN, query type, and FQDN patterns can identify novel or complex reconnaissance behavior that might otherwise be missed, providing a more sophisticated layer of detection."
    answer_sources:
      - "Zeek dns.log"
      - "Threat Intelligence Platform Feeds"
      - "Authoritative DNS Servers"
      - "Public-facing DNS Resolvers"
      - "Network Egress/Ingress Points (Firewalls)"
      - "Threat Intelligence Subscription Services"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: "INPUT Zeek dns.log | APPLY ML_model(type='recon_classifier') | SEARCH model_prediction='reconnaissance' AND confidence_score > 0.90"
  - question: "Is any single external IP address rapidly querying for multiple sensitive service discovery (SRV) records?"
    context: "This question targets a common Active Directory reconnaissance technique where an adversary attempts to locate critical services like Global Catalogs, LDAP, or Kerberos. A burst of such queries from an external source is highly suspicious and indicative of an attempt to map internal network services."
    answer_sources:
      - "Zeek dns.log"
      - "Authoritative DNS Servers"
      - "Network Egress/Ingress Points (Firewalls)"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: "SEARCH Zeek dns.log WHERE query_type='SRV' AND query_name IN ('_gc._tcp', '_ldap._tcp', '_kerberos._tcp') | STATS distinct_count(query_name) BY source_ip, time_window(5m) | WHERE distinct_count > 3"
  - question: "Are any external IP addresses issuing a statistically anomalous proportion of SRV queries compared to their total DNS activity?"
    context: "This question identifies outliers whose behavior is heavily skewed towards service discovery. While a few SRV queries might be normal, an IP dedicating a high percentage of its activity to SRV lookups is abnormal and warrants investigation for targeted reconnaissance."
    answer_sources:
      - "Zeek dns.log"
      - "Authoritative DNS Servers"
      - "Network Egress/Ingress Points (Firewalls)"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: "SEARCH Zeek dns.log | STATS count, count(WHERE query_type='SRV') as srv_count BY source_ip | LET ratio = srv_count / count | WHERE ratio > 99.9th_percentile_of_all_clients"
  - question: "Does the sequence of DNS queries from any external IP match the patterns used by known reconnaissance tools?"
    context: "This question uses a more advanced technique to detect reconnaissance by analyzing the order and type of DNS queries, not just their volume or content. Sequence analysis models can learn the specific 'fingerprints' of automated tools like DNSenum, allowing them to detect a malicious actor even if the individual queries appear benign in isolation."
    answer_sources:
      - "Zeek dns.log"
      - "Authoritative DNS Servers"
      - "Network Egress/Ingress Points (Firewalls)"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: "INPUT Zeek dns.log | GROUP_BY source_ip | APPLY sequence_analysis_model(type='dns_recon_tool') | SEARCH model_prediction='malicious_sequence'"
  - question: "Are we receiving any DNS zone transfer requests (AXFR/IXFR) from unauthorized external IP addresses?"
    context: "This question addresses a critical security misconfiguration. A zone transfer exposes all DNS records for a domain, providing an adversary with a complete map of the organization's network infrastructure. Any unauthorized attempt is a serious incident and requires immediate investigation, as it suggests a direct attempt to gather comprehensive intelligence."
    answer_sources:
      - "Zeek dns.log"
      - "Authoritative DNS Servers"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: "SEARCH Zeek dns.log WHERE query_type IN ('AXFR', 'IXFR') AND source_ip NOT_IN zone_transfer_allowlist | CREATE_ALERT(severity='critical')"
  - question: "Is any external IP address making a statistically unusual number of 'ANY' type DNS queries?"
    context: "This question looks for another reconnaissance method. An 'ANY' query requests all available records for a given name. While sometimes used for diagnostics, a high volume of 'ANY' queries from a single external source is abnormal and may indicate an adversary's attempt to gather as much information as possible about specific hosts."
    answer_sources:
      - "Zeek dns.log"
      - "Authoritative DNS Servers"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: "SEARCH Zeek dns.log WHERE query_type='ANY' | STATS count BY source_ip over 1h | WHERE count > (mean + 3*stddev) of baseline"
  - question: "Can an unsupervised machine learning model identify anomalous DNS queries based on rare query types or unusual frequencies?"
    context: "This question applies machine learning to find 'unknown unknowns' in DNS traffic. Unlike rules that look for specific indicators, an anomaly detection model learns what normal traffic looks like and flags any deviation. This can effectively catch rare but significant events like unauthorized AXFR attempts or bursts of 'ANY' queries without needing pre-defined signatures."
    answer_sources:
      - "Zeek dns.log"
      - "Authoritative DNS Servers"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: "INPUT Zeek dns.log features(qtype_dist, query_volume) | APPLY anomaly_detection_model(type='isolation_forest') | SEARCH model_prediction='outlier'"
  - question: "Is any external IP address generating a high volume of DNS queries that result in a non-existent domain (NXDOMAIN) error?"
    context: "This question targets a common reconnaissance technique known as a DNS sweep, where an adversary uses a wordlist to guess subdomains (e.g., 'vpn', 'remote', 'test'). A high ratio of NXDOMAIN responses from a single source strongly suggests this brute-force enumeration activity."
    answer_sources:
      - "Zeek dns.log"
      - "Authoritative DNS Servers"
      - "DNS Resolvers"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: "SEARCH Zeek dns.log | STATS count, count(WHERE response_code='NXDOMAIN') as nx_count BY source_ip, time_window(5m) | WHERE (nx_count / count) > 0.8 AND count > 50"
  - question: "Are the subdomains being queried by any external IP address statistically random or complex, especially when also seeing many NXDOMAIN errors?"
    context: "This question looks for evidence of Domain Generation Algorithms (DGAs) being used for reconnaissance. Instead of a dictionary, the adversary uses an algorithm to generate a large number of pseudo-random subdomain names. High character entropy in the queried names is a key indicator of this automated technique, especially when paired with a high NXDOMAIN rate."
    answer_sources:
      - "Zeek dns.log"
      - "Authoritative DNS Servers"
      - "DNS Resolvers"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: "SEARCH Zeek dns.log | CALCULATE shannon_entropy(subdomain) per source_ip over 10m | WHERE entropy_score > 98th_percentile"
  - question: "Can a clustering algorithm group normal DNS client behavior and isolate anomalous clients based on query count, NXDOMAIN ratio, and subdomain entropy?"
    context: "This question uses unsupervised machine learning to automatically group clients with similar behavior. 'Normal' clients will form dense clusters, while malicious actors (e.g., those performing DNS sweeps) will have a unique combination of features (high query count, high NXDOMAIN ratio, high entropy) and will be classified as outliers or noise by the algorithm, making them easy to spot."
    answer_sources:
      - "Zeek dns.log"
      - "Authoritative DNS Servers"
      - "DNS Resolvers"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: "INPUT Zeek dns.log features(query_count, nxdomain_ratio, subdomain_entropy) | APPLY clustering_model(type='dbscan') | SEARCH model_prediction='outlier'"
  - question: "Has there been a sudden and sustained spike in the overall rate of DNS queries to our servers?"
    context: "This question provides a broad, top-level view to detect large-scale events. A sudden, drastic increase in query volume that isn't tied to a known legitimate event (like a marketing campaign) could indicate a distributed reconnaissance effort or the beginning of a DNS-based denial-of-service attack."
    answer_sources:
      - "Zeek dns.log"
      - "Authoritative DNS Servers"
      - "Network Egress/Ingress Points (Firewalls)"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: "MONITOR rate(dns_queries) per 1m | LET moving_avg = moving_average(rate, 1h) | TRIGGER IF current_rate > (moving_avg * 4) for 5 minutes"
  - question: "Is the current DNS query volume exceeding our historical baseline by a statistically significant amount (e.g., more than 4 standard deviations)?"
    context: "This question refines the simple rate-of-change detection by using historical time-series analysis. By comparing the current volume to a long-term baseline (e.g., 30 days), this method can more reliably identify true anomalies while accounting for normal fluctuations, reducing false positives."
    answer_sources:
      - "Zeek dns.log"
      - "Authoritative DNS Servers"
      - "Network Egress/Ingress Points (Firewalls)"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: "CALCULATE baseline(mean, stddev) for dns_query_volume over 30d | ALERT IF current_volume > (baseline.mean + 4*baseline.stddev)"
  - question: "Is the observed DNS traffic volume significantly deviating from what a time series forecasting model, which accounts for daily and weekly patterns, would predict?"
    context: "This is the most sophisticated approach to volume anomaly detection. A SARIMA model learns complex seasonal patterns (e.g., lower traffic on weekends, peaks during business hours). It then predicts an expected range for future traffic. If the actual volume falls outside this predicted confidence interval, it signals a high-confidence anomaly that cannot be explained by normal business cycles."
    answer_sources:
      - "Zeek dns.log"
      - "Authoritative DNS Servers"
      - "Network Egress/Ingress Points (Firewalls)"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: "INPUT dns_volume_timeseries | APPLY forecasting_model(type='sarima') | LET prediction = model.predict() | ALERT IF actual_volume is_outside prediction.confidence_interval(99%)"