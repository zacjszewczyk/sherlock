name: T1586.003: Cloud Accounts
id: e5d3f8a9-1b2c-4d5e-8f6a-7b8c9d0e1f2a
description: This playbook helps investigate whether an adversary is developing resources using compromised cloud accounts. This involves monitoring for anomalous outbound network connections to cloud infrastructure, unauthorized use of cloud management CLI tools, significant increases in outbound data volume to cloud services, and unusual patterns of DNS requests or API calls related to cloud platforms. The goal is to detect activities like connections to malicious domains, unauthorized provisioning of infrastructure, data exfiltration, and unusual administrative actions originating from within the corporate network.
type: technique
related:
  - TA0042: Resource Development
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Is an internal host connecting to known malicious cloud-hosted infrastructure identified by threat intelligence feeds?
    context: This question aims to identify direct connections from internal systems to command and control (C2), phishing, or anonymization services that adversaries have staged in cloud environments. By comparing outbound traffic against a curated list of known-malicious indicators, analysts can quickly detect potential compromises or malicious activity.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Network Egress Points
      - Corporate DNS Resolvers
      - Proxy Servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH (dns.log OR conn.log) WHERE destination_ip IN threat_intel_feed OR destination_domain IN threat_intel_feed
  - question: Is an internal host connecting to a newly registered cloud-hosted domain that is anomalously young compared to others accessed within the enterprise?
    context: Adversaries frequently use newly registered domains (NRDs) for their campaigns. This question focuses on identifying connections to cloud-hosted domains that are exceptionally new relative to the typical age of domains accessed by the organization. Flagging these can surface malicious infrastructure early in its lifecycle.
    answer_sources:
      - Zeek dns.log
      - Network Egress Points
      - Corporate DNS Resolvers
      - Proxy Servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH dns.log | ENRICH with whois_data | CALCULATE 5th_percentile_age | FILTER age < 5th_percentile
  - question: Can machine learning models identify outbound connections to cloud infrastructure that have a high probability of being malicious?
    context: This question explores the use of a classification model to proactively identify malicious connections that may not appear on static threat intelligence feeds. By training a model on features like ASN, DNS query length, TTL, and connection volume, it can learn to distinguish between benign and malicious traffic patterns to cloud services, providing a more dynamic detection capability.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Network Egress Points
      - Corporate DNS Resolvers
      - Proxy Servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SCORE new_connections_to_cloud with ML_model | ALERT on high_probability_malicious_score
  - question: Is an unauthorized user account executing a cloud management CLI tool on a host?
    context: This question seeks to detect when a user not belonging to a pre-approved administrative group (e.g., 'Cloud Admins') uses command-line tools like 'aws.exe' or 'az.cmd'. Such activity is a strong indicator of a compromised account or an insider threat attempting to manipulate cloud resources outside of authorized channels.
    answer_sources:
      - Zeek http.log
      - Zeek conn.log
      - Windows Event ID 4688
      - User Endpoints
      - Server Subnets (excluding designated admin hosts)
      - Developer Workstations
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH win_event_4688 WHERE process IN (cloud_clis) AND user NOT IN (cloud_admins_group) | CORRELATE with http.log WHERE user_agent IN (cli_user_agents)
  - question: Is a rarely used cloud CLI tool being executed on a non-administrative workstation?
    context: The purpose of this question is to find anomalous software usage. If a cloud CLI tool that is rarely seen across the enterprise is suddenly executed on a standard user's workstation, it could signify that an adversary has introduced the tool to a compromised machine to manage their illicit cloud resources.
    answer_sources:
      - Windows Event ID 4688
      - User Endpoints
      - Server Subnets (excluding designated admin hosts)
      - Developer Workstations
    range: last 90 days
    queries:
      - technology: pseudocode
        query: PROFILE process_frequency_per_host | CALCULATE inverse_host_frequency_score | ALERT on high_rarity_score for cloud_cli on non-admin_host
  - question: Has a host's behavior profile changed to resemble that of a developer or administrator, specifically due to the use of cloud CLI tools?
    context: This question uses unsupervised machine learning to detect behavioral changes. A standard user workstation that suddenly starts exhibiting process and network activity similar to a developer or cloud administrator's machine, especially driven by cloud CLI usage, may be compromised. This helps identify hosts that have changed roles in a suspicious manner.
    answer_sources:
      - Zeek http.log
      - Zeek conn.log
      - Windows Event ID 4688
      - User Endpoints
      - Server Subnets (excluding designated admin hosts)
      - Developer Workstations
    range: last 90 days
    queries:
      - technology: pseudocode
        query: CLUSTER hosts using K-Means on process/network data | DETECT hosts shifting from 'user' to 'admin' cluster | INVESTIGATE cause, focusing on cloud_cli_usage
  - question: Is a host, which is not a known backup server, exfiltrating an unusually large volume of data to a cloud storage provider?
    context: This question aims to detect potential data exfiltration by setting a simple, high-volume threshold for data transfers to cloud storage services. By alerting when a non-backup server sends an abnormally large amount of data (e.g., >1GB in an hour), analysts can quickly investigate potential data theft.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Network Egress Points
      - All Corporate Subnets
      - VPN User IP Pools
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH conn.log WHERE dest_ip IN (cloud_storage_ips) AND host NOT IN (backup_servers) | AGGREGATE sum(bytes_out) by host per hour | ALERT if sum(bytes_out) > 1GB
  - question: Has a host's outbound data volume to cloud providers significantly deviated from its own historical baseline or the baseline of its peer group?
    context: This question provides a more nuanced approach to detecting data exfiltration than a static threshold. By establishing a dynamic baseline of normal outbound data volume for each host and its peer group (e.g., 'Finance'), it can detect statistically significant increases that indicate anomalous activity, reducing false positives from hosts that normally transfer large amounts of data.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Network Egress Points
      - All Corporate Subnets
      - VPN User IP Pools
    range: last 90 days
    queries:
      - technology: pseudocode
        query: BASELINE hourly_bytes_out_to_cloud per host and peer_group | COMPARE current_hour_volume to baseline | ALERT if current_volume > 99th_percentile_of_baseline
  - question: Is the volume of outbound data from a specific host to a specific cloud service anomalous according to a time-series prediction model?
    context: This question uses advanced time-series analysis (e.g., ARIMA) to model the normal flow of data between a specific host and a specific cloud service. This highly targeted approach can detect subtle anomalies in data transfer volume that might be missed by broader methods, indicating a potential compromise or misuse of a specific service.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Network Egress Points
      - All Corporate Subnets
      - VPN User IP Pools
    range: last 90 days
    queries:
      - technology: pseudocode
        query: MODEL hourly_bytes_out per host-service pair with ARIMA | PREDICT expected_volume | ALERT if observed_volume > upper_confidence_bound
  - question: Is a server, which should not have interactive users, connecting to a cloud management web console?
    context: This question is designed to catch highly suspicious activity. Servers in production environments should typically not be used for interactive logins to cloud management portals (e.g., AWS Console, Azure Portal). Such a connection strongly suggests that an adversary has compromised the server and is using it as a pivot point to access and manage cloud resources.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Zeek ssl.log
      - Network Egress Points
      - VPN Concentrators
      - Administrative Workstations
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH ssl.log WHERE server_name IN (cloud_consoles) AND source_ip IN (server_subnets)
  - question: Is a host generating an anomalously high variety of DNS requests for cloud API endpoints, suggesting broad, exploratory activity?
    context: An adversary unfamiliar with the cloud environment may perform broad reconnaissance by querying many different API endpoints. This question seeks to detect such activity by measuring the Shannon entropy of DNS requests to cloud domains. A sudden spike in entropy compared to the host's or its peer group's baseline can indicate automated scanning or enumeration.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Zeek ssl.log
      - Network Egress Points
      - VPN Concentrators
      - Administrative Workstations
    range: last 90 days
    queries:
      - technology: pseudocode
        query: CALCULATE shannon_entropy of cloud_subdomains per host hourly | BASELINE entropy per host_group | ALERT if entropy > (baseline + 2*std_dev)
  - question: Is a non-administrative host making a sequence of cloud API calls that deviates from known, legitimate administrative workflows?
    context: Legitimate administrators often perform tasks in a predictable sequence. This question involves modeling these normal sequences (e.g., using a Markov Chain). When a non-administrative host performs a sequence of API calls that has a low probability of being legitimate, it suggests a malicious actor attempting to perform an unfamiliar or unauthorized task.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Zeek ssl.log
      - Network Egress Points
      - VPN Concentrators
      - Administrative Workstations
    range: last 90 days
    queries:
      - technology: pseudocode
        query: MODEL api_call_sequences with Markov_Chain from admin_hosts | SCORE sessions from non-admin_hosts | ALERT on low_probability_sequences
  - question: Is a non-administrative host performing a sequence of actions consistent with provisioning new cloud infrastructure (e.g., identity, compute, storage)?
    context: This question looks for a specific, logical chain of events that indicates an adversary is building out infrastructure. A non-admin host making DNS requests for identity services, followed by compute, and then storage services within a short time frame is a strong signal of unauthorized resource creation.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - Network Egress Points
      - Developer Subnets
      - Corporate DNS Resolvers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH dns.log for sequence [iam, ec2, s3] from same host within 15min WHERE host NOT IN (cloud_admins_group)
  - question: Has a host's daily pattern of cloud service category access significantly changed compared to its 30-day average behavior?
    context: This question aims to detect behavioral drift. By categorizing cloud services (e.g., Identity, Compute) and creating a daily activity profile for each host, a significant deviation from its historical 30-day profile can indicate that the host's role or usage has changed, possibly due to a compromise. Cosine similarity is used to measure this change.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - Network Egress Points
      - Developer Subnets
      - Corporate DNS Resolvers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: VECTORIZE daily_cloud_service_usage_by_category per host | CALCULATE cosine_similarity(daily_vector, 30day_avg_vector) | ALERT if similarity < threshold
  - question: Is a host accessing a rare or novel combination of cloud services that doesn't match common patterns established by legitimate administrators?
    context: This question uses association rule mining to learn which cloud services are commonly used together by legitimate administrators. If a host accesses a combination of services that is rarely or never seen, it suggests a novel workflow that could be malicious. This helps detect unusual chains of activity that deviate from established operational patterns.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - Network Egress Points
      - Developer Subnets
      - Corporate DNS Resolvers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: MINE association_rules for cloud_services from admin_logs | IDENTIFY frequent_itemsets | ALERT when a host accesses a rare_itemset