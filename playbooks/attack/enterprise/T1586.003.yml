name: T1586.003: Cloud Accounts
id: 4d1a4f07-8e6b-4e8c-9b9a-7f6d5c3e2b1a
description: This playbook helps investigate whether an adversary is developing resources using compromised cloud accounts. It focuses on detecting signs of compromise and misuse, such as outbound network connections to known-malicious cloud infrastructure, unauthorized use of cloud management CLI tools by non-administrators, statistically significant increases in outbound data volume to cloud services, unusual DNS query patterns for cloud API endpoints from non-administrative hosts, and sequences of network activity that suggest programmatic infrastructure provisioning.
type: technique
related:
- TA0042: Resource Development
contributors: Zachary Szewczyk, Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
- question: Has an internal host connected to a known-malicious domain or IP address hosted in a cloud environment?
  context: This question aims to identify direct communication with adversary infrastructure. A match against a high-confidence threat intelligence feed, particularly for domains categorized as C2, phishing, or anonymization services, is a strong indicator of compromise. This is often one of the first signs that an internal asset is being controlled or used by a threat actor.
  answer_sources:
  - Zeek conn.log
  - Zeek dns.log
  - Network Egress Points
  - Corporate DNS Resolvers
  - Proxy Servers
  range: last 90 days
  queries:
  - pseudocode: SEARCH Zeek logs WHERE destination_ip OR destination_domain IN threat_intel_feed AND cloud_provider_asn IS TRUE
- question: Is any host communicating with a newly registered domain (NRD) hosted in a cloud environment?
  context: Adversaries frequently use newly registered domains for their campaigns to evade reputation-based blocking. Identifying connections to domains that are exceptionally new compared to the organization's baseline can uncover malicious activity that has not yet been flagged by threat intelligence feeds. This is a proactive method to find emerging threats.
  answer_sources:
  - Zeek dns.log
  - Network Egress Points
  - Corporate DNS Resolvers
  - Proxy Servers
  range: last 90 days
  queries:
  - pseudocode: GET domain_age FROM WHOIS. FOR all_domains in Zeek dns.log, CALCULATE 5th_percentile_age. ALERT IF connection_to_domain.age < 5th_percentile_age
- question: Are there any outbound connections to cloud infrastructure that a machine learning model flags as potentially malicious?
  context: This question leverages machine learning to identify suspicious connections that may not be caught by signature-based rules. By training a model on features like ASN, DNS query characteristics, and connection metadata, it can learn the subtle patterns of malicious traffic and score new connections for their probability of being malicious, providing a more dynamic and adaptive detection capability.
  answer_sources:
  - Zeek conn.log
  - Zeek dns.log
  - Network Egress Points
  - Corporate DNS Resolvers
  - Proxy Servers
  range: last 90 days
  queries:
  - pseudocode: SCORE new_connections using trained_ML_model. ALERT IF score > threshold
- question: Has a user not authorized for cloud administration executed a cloud CLI tool?
  context: Execution of cloud management tools like aws.exe or az.cmd by users outside of a designated administrator group is a significant anomaly. It could indicate a compromised user account being used to manipulate cloud resources or an insider threat. Correlating this with network traffic confirms the tool was used to communicate with cloud APIs.
  answer_sources:
  - Windows Event ID 4688
  - Zeek http.log
  - Zeek conn.log
  - User Endpoints
  - Server Subnets (excluding designated admin hosts)
  - Developer Workstations
  range: last 90 days
  queries:
  - pseudocode: SEARCH process_creation_logs for cloud_cli_tools WHERE user NOT IN 'Cloud Admins' group. CORRELATE with network_logs for cloud_api_user_agents FROM same_host
- question: Has a rare process, specifically a cloud CLI tool, been executed on a non-administrative workstation?
  context: This question aims to find outliers in software usage. If a cloud CLI tool is executed on a very small number of hosts across the enterprise, its appearance on a new host (especially a non-admin workstation) is highly suspicious. This technique, known as rarity analysis or stack counting, is effective for detecting adversary tools or legitimate tools being used in an unauthorized context.
  answer_sources:
  - Windows Event ID 4688
  - User Endpoints
  - Server Subnets (excluding designated admin hosts)
  - Developer Workstations
  range: last 90 days
  queries:
  - pseudocode: CALCULATE process_rarity_score across all hosts. ALERT IF cloud_cli_tool is executed on non_admin_host AND rarity_score > threshold
- question: Has any host's behavior profile shifted to resemble a cloud administrator's, particularly due to cloud CLI tool usage?
  context: This question uses unsupervised machine learning to group hosts with similar behaviors (e.g., 'standard users', 'developers', 'admins'). A host that suddenly shifts from a 'standard user' cluster to an 'admin' cluster indicates a fundamental change in its activity. If this shift is caused by the new execution of cloud CLI tools, it strongly suggests a compromise or policy violation.
  answer_sources:
  - Windows Event ID 4688
  - Zeek http.log
  - Zeek conn.log
  - User Endpoints
  - Server Subnets (excluding designated admin hosts)
  - Developer Workstations
  range: last 90 days
  queries:
  - pseudocode: CLUSTER hosts based on process and network activity. ALERT IF host moves from 'user_cluster' to 'admin_cluster' AND change is driven by cloud_cli_usage
- question: Has any host, excluding known backup servers, exfiltrated an unusually large volume of data to cloud storage services?
  context: This question seeks to identify potential data exfiltration using a simple, high-volume threshold. A sudden, large data transfer (e.g., >1GB in an hour) to cloud storage services like AWS S3 or Azure Blob Storage from a standard user workstation is highly abnormal and warrants immediate investigation for data theft.
  answer_sources:
  - Zeek conn.log
  - Zeek dns.log
  - Network Egress Points
  - All Corporate Subnets
  - VPN User IP Pools
  range: last 90 days
  queries:
  - pseudocode: SEARCH Zeek conn.log WHERE destination_ip IN cloud_storage_ranges AND host NOT IN backup_server_list AND bytes_out > 1GB within 1 hour
- question: Has any host's outbound data volume to cloud services significantly deviated from its own historical baseline or that of its peer group?
  context: This question moves beyond fixed thresholds to a more dynamic, baselining approach. By comparing a host's current activity to its own past behavior (self-baselining) or the behavior of similar hosts (peer group analysis), this method can detect more subtle anomalies. An alert signifies that a host is behaving abnormally, which could be an indicator of compromise and data staging or exfiltration.
  answer_sources:
  - Zeek conn.log
  - Zeek dns.log
  - Network Egress Points
  - All Corporate Subnets
  - VPN User IP Pools
  range: last 90 days
  queries:
  - pseudocode: CALCULATE 30-day baseline of hourly_bytes_out to cloud_ips for each host. ALERT IF current_hour_bytes_out > 99th_percentile_of_baseline
- question: Is the pattern of outbound data volume from a host to a specific cloud service anomalous according to a time-series model?
  context: This question uses advanced time-series analysis to model the normal 'rhythm' of data transfers between a host and a cloud service. Models like ARIMA can capture seasonality and trends in the data. An alert is generated when the actual data volume significantly breaks from the model's prediction, indicating a statistically significant and potentially malicious deviation from the established communication pattern.
  answer_sources:
  - Zeek conn.log
  - Zeek dns.log
  - Network Egress Points
  - All Corporate Subnets
  - VPN User IP Pools
  range: last 90 days
  queries:
  - pseudocode: MODEL hourly_bytes_out to cloud_service using ARIMA. ALERT IF observed_bytes > predicted_upper_confidence_bound
- question: Has a server made a connection to a cloud management web portal?
  context: Cloud management web consoles are designed for human interaction. It is highly unusual for a server, especially one in a production subnet, to connect to these portals. Such activity could indicate an adversary has compromised the server and is using it as a jump box to manually access and manipulate cloud resources via the web interface.
  answer_sources:
  - Zeek conn.log
  - Zeek dns.log
  - Zeek ssl.log
  - Network Egress Points
  - VPN Concentrators
  - Administrative Workstations
  range: last 90 days
  queries:
  - pseudocode: SEARCH Zeek ssl.log WHERE server_name IN cloud_console_list AND source_ip IN server_subnets
- question: Is any host generating an unusually high variety of DNS requests for cloud API endpoints?
  context: This question aims to detect automated or exploratory activity against cloud APIs. A high entropy of DNS requests (meaning a high degree of randomness or variety in the subdomains being queried) can indicate a script enumerating or interacting with a wide range of cloud services. This behavior is often different from the more predictable patterns of normal user or application activity.
  answer_sources:
  - Zeek conn.log
  - Zeek dns.log
  - Zeek ssl.log
  - Network Egress Points
  - VPN Concentrators
  - Administrative Workstations
  range: last 90 days
  queries:
  - pseudocode: CALCULATE shannon_entropy of cloud_api_subdomains per host per hour. CALCULATE baseline_entropy for host_group. ALERT IF host_entropy > (baseline + 2 * std_dev)
- question: Has a non-administrative host exhibited a sequence of cloud API interactions that deviates from known legitimate workflows?
  context: Legitimate administrative tasks often follow predictable sequences of API calls. This question involves modeling these normal sequences (e.g., using a Markov Chain). When a non-administrative host performs a sequence of API calls that is highly improbable according to the model, it suggests an anomalous and potentially malicious workflow, such as an adversary attempting to provision resources in an unusual order.
  answer_sources:
  - Zeek conn.log
  - Zeek dns.log
  - Zeek ssl.log
  - Network Egress Points
  - VPN Concentrators
  - Administrative Workstations
  range: last 90 days
  queries:
  - pseudocode: MODEL legitimate_api_call_sequences with Markov Chain. SCORE api_call_sequences from non-admin_hosts. ALERT IF sequence_probability < threshold
- question: Has a non-administrative host performed a sequence of actions consistent with provisioning new cloud infrastructure?
  context: This question looks for a specific, logical sequence of events that mirrors a common infrastructure provisioning workflow: authenticating (Identity), creating a virtual machine (Compute), and attaching storage (Storage). When this pattern is observed from an unauthorized host, it is a strong indicator that an adversary is using a compromised account to build out their own infrastructure.
  answer_sources:
  - Zeek dns.log
  - Zeek conn.log
  - Network Egress Points
  - Developer Subnets
  - Corporate DNS Resolvers
  range: last 90 days
  queries:
  - pseudocode: SEARCH for sequence of DNS queries (identity -> compute -> storage) within 15 mins from a single host NOT IN 'Cloud Admins' group
- question: Has a host's daily pattern of cloud service category usage significantly changed compared to its 30-day average?
  context: This question abstracts individual API calls into broader service categories to identify high-level behavioral shifts. A host that normally only interacts with storage services but suddenly starts interacting with compute and identity services has undergone a significant change. By comparing a host's daily activity profile (as a vector) to its historical average using cosine similarity, we can quantify this change and flag significant deviations for investigation.
  answer_sources:
  - Zeek dns.log
  - Zeek conn.log
  - Network Egress Points
  - Developer Subnets
  - Corporate DNS Resolvers
  range: last 90 days
  queries:
  - pseudocode: CREATE daily_feature_vector of cloud_service_category_counts per host. CALCULATE 30-day_average_vector. ALERT IF cosine_similarity(daily_vector, avg_vector) < threshold
- question: Is any host accessing a rare or novel combination of cloud services not typically used together by legitimate administrators?
  context: This question uses association rule mining to discover which cloud services are frequently used together during legitimate operations (e.g., 'users who use EC2 also use S3'). If a host, particularly a non-administrative one, starts using a combination of services that is very rare or has never been seen before, it could indicate a new, malicious workflow developed by an adversary to achieve their objectives.
  answer_sources:
  - Zeek dns.log
  - Zeek conn.log
  - Network Egress Points
  - Developer Subnets
  - Corporate DNS Resolvers
  range: last 90 days
  queries:
  - pseudocode: MINE association rules (itemsets) from historical admin DNS logs. ALERT if a host accesses a service combination with low support/confidence