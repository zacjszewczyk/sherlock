name: T1213.001: Confluence
id: 9a7b1c3d-8e4f-4a0b-9c6d-1e2f3a4b5c6d
description: This playbook helps determine if an adversary is collecting sensitive information from Confluence repositories. It addresses threats such as logins from malicious IPs, anomalous search activity, programmatic access using non-standard User-Agents, excessive data viewing or downloading, access from privileged or dormant accounts, browsing of historically unpopular pages, and subsequent lateral movement following suspicious Confluence activity.
type: technique
related:
  - TA0009: Collection
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Is a successful Confluence login associated with a known malicious IP or a flagged user account?
    context: This question aims to identify straightforward indicators of compromise by correlating Confluence login events with external threat intelligence (malicious IPs) and internal watchlists (compromised accounts). A match provides a high-confidence signal that an adversary is using a known malicious infrastructure or a compromised credential to access the Confluence instance.
    answer_sources:
      - Zeek conn.log
      - Confluence Access Logs
      - Windows Event ID 4624
      - Confluence web server
      - Network gateway/firewall
      - Domain Controllers
    range: last 90 days
    queries:
      - pseudocode: JOIN Confluence logs and Zeek logs on timestamp/IP. CHECK source IP against threat intel list. CHECK username against internal watchlist. ALERT on match.
  - question: Are Confluence logins originating from statistically rare Autonomous System Numbers (ASNs)?
    context: Adversaries may use newly provisioned or obscure hosting providers for their operations. By profiling the frequency of all source ASNs over time, this question identifies logins from origins that are statistically unusual for the organization. An ASN in the bottom 5th percentile of access frequency is a potential indicator of anomalous or malicious activity.
    answer_sources:
      - Zeek conn.log
      - Confluence Access Logs
      - Windows Event ID 4624
      - Confluence web server
      - Network gateway/firewall
      - Domain Controllers
    range: last 90 days
    queries:
      - pseudocode: ENRICH login IP with ASN. PROFILE ASN frequency over 30 days. CALCULATE 5th percentile threshold. ALERT if login ASN is below threshold.
  - question: Does a Confluence login session exhibit characteristics that a machine learning model classifies as malicious?
    context: This question leverages machine learning to detect complex patterns that are difficult to define with simple rules. By training a logistic regression model on features like IP geolocation, ASN reputation, time of day, and user role, the system can score new login sessions in real-time. A high probability score (e.g., >0.9) indicates that the session strongly resembles previously identified malicious activity.
    answer_sources:
      - Zeek conn.log
      - Confluence Access Logs
      - Windows Event ID 4624
      - Confluence web server
      - Network gateway/firewall
      - Domain Controllers
    range: last 90 days
    queries:
      - pseudocode: SCORE new login events using pre-trained logistic regression model. ALERT if malicious probability > 0.9.
  - question: Is a user searching for sensitive keywords within Confluence?
    context: This question seeks to detect targeted data collection by monitoring for specific, high-value keywords. An adversary looking for credentials, configuration files, or network details will often use search terms like 'password', 'secret', or 'api_key'. Matching search queries against a predefined watchlist of such terms provides a direct and high-fidelity indicator of malicious intent.
    answer_sources:
      - Confluence Access Logs
      - Zeek http.log
      - Confluence web server
      - Network traffic sensor
    range: last 90 days
    queries:
      - pseudocode: FILTER logs for Confluence search events. SCAN search terms against sensitive keyword list. ALERT on match.
  - question: Is a user's search query volume anomalously high compared to their own baseline?
    context: This question aims to detect reconnaissance or data discovery activity by identifying unusual spikes in a user's search behavior. By establishing a personalized 30-day baseline, the system can flag when a user's search activity significantly deviates from their normal pattern (e.g., exceeds three standard deviations). This is a strong indicator that the account may be compromised and used for bulk information gathering.
    answer_sources:
      - Confluence Access Logs
      - Zeek http.log
      - Confluence web server
      - Network traffic sensor
    range: last 90 days
    queries:
      - pseudocode: FOR each user, CALCULATE 30-day baseline (mean, stddev) of hourly search count. CHECK current hourly search count against baseline. ALERT if count > (mean + 3 * stddev).
  - question: Are a user's search queries thematically inconsistent or unfocused, suggesting exploratory browsing?
    context: This question uses topic modeling (LDA) to identify normal patterns of search behavior. Legitimate users typically search within specific topic clusters related to their work. An adversary, however, may conduct broad, unfocused searches to understand the environment. This action detects such behavior by flagging sessions with high entropy (randomness) or queries that do not fit into established topic clusters, indicating potential reconnaissance.
    answer_sources:
      - Confluence Access Logs
      - Zeek http.log
      - Confluence web server
      - Network traffic sensor
    range: last 90 days
    queries:
      - pseudocode: AGGREGATE 90-day search history to build LDA topic model. FOR new user sessions, CALCULATE search term entropy and topic distribution. ALERT if entropy is high or topics are anomalous.
  - question: Is Confluence being accessed by a client with a User-Agent string associated with common scripting tools?
    context: This question aims to detect automated access by looking for User-Agent strings of common command-line tools or scripting libraries (e.g., 'curl', 'Wget', 'python-requests'). Adversaries frequently use these tools for automated data exfiltration. A match against a deny-list of such User-Agents is a strong indicator of non-interactive, and potentially malicious, access.
    answer_sources:
      - Zeek http.log
      - Confluence Access Logs
      - Confluence web server
      - Network traffic sensor
    range: last 90 days
    queries:
      - pseudocode: MONITOR User-Agent field in HTTP logs for Confluence traffic. COMPARE against deny-list of scripting tool User-Agents. ALERT on match.
  - question: Is a Confluence session using a rare User-Agent or exhibiting unnaturally consistent timing between requests?
    context: This question identifies two key indicators of automation. First, it flags access from extremely rare User-Agents that deviate from the common browsers used in the organization. Second, it analyzes the timing between requests within a session. Human users have variable think/read times, while scripts often have a very low, consistent delay between actions. A session with an abnormally low standard deviation in request timing is likely automated.
    answer_sources:
      - Zeek http.log
      - Confluence Access Logs
      - Confluence web server
      - Network traffic sensor
    range: last 90 days
    queries:
      - pseudocode: PROFILE User-Agent frequency over 30 days; ALERT on rare User-Agents (<0.1%). FOR each session, CALCULATE stddev of time between requests. ALERT if stddev is below threshold (e.g., 50ms).
  - question: Does a user's sequence of API calls during a Confluence session deviate from learned legitimate workflow patterns?
    context: This advanced question uses a machine learning model (like an LSTM) to learn the normal 'grammar' or sequence of user actions (API calls) within Confluence. Legitimate workflows have predictable patterns. An adversary's actions—such as rapidly iterating through spaces or using API calls in an unusual order—will deviate from these learned patterns. The model can score new sessions in real-time and flag those that are anomalous, indicating potential scripted attacks or abuse.
    answer_sources:
      - Zeek http.log
      - Confluence Access Logs
      - Confluence web server
      - Network traffic sensor
    range: last 90 days
    queries:
      - pseudocode: SCORE new session API call sequences against a pre-trained LSTM model. ALERT if the sequence has a high anomaly score.
  - question: Has a single user account accessed an excessive number of unique pages or downloaded an unusually large volume of data within a one-hour window?
    context: This question establishes a simple, high-threshold rule to catch blatant data exfiltration attempts. By setting fixed limits (e.g., 200 unique pages, 500 MB of data), it provides a clear tripwire for activity that is almost certainly malicious. This serves as a basic but effective safety net for large-scale, automated 'smash and grab' data theft.
    answer_sources:
      - Confluence Access Logs
      - Zeek http.log
      - Zeek files.log
      - Confluence web server
      - Network traffic sensor
    range: last 90 days
    queries:
      - pseudocode: FOR each user, COUNT unique pages accessed and SUM bytes downloaded in a 1-hour sliding window. ALERT if page count > 200 OR data volume > 500 MB.
  - question: Is a user's page view count or data download volume anomalously high compared to their own historical baseline?
    context: This question refines the detection of bulk data access by using personalized, dynamic baselines instead of a single static threshold. It accounts for the fact that different users have different legitimate usage patterns. By calculating a 30-day rolling baseline for each user, the system can more accurately identify when an individual's activity (page views or download volume) significantly exceeds their own normal behavior, which is a strong indicator of a compromised account being used for data collection.
    answer_sources:
      - Confluence Access Logs
      - Zeek http.log
      - Zeek files.log
      - Confluence web server
      - Network traffic sensor
    range: last 90 days
    queries:
      - pseudocode: FOR each user, CALCULATE 30-day baseline (mean, stddev) for hourly page views and download volume. CHECK current hourly activity against baseline. ALERT if activity > (mean + 3 * stddev) for either metric.
  - question: Has a user's overall access behavior abruptly shifted to a higher-activity profile or become an outlier compared to their peers?
    context: This question uses peer group analysis (clustering) to identify anomalous behavior. Users are grouped based on multiple access features (pages per day, data volume, etc.). An account takeover is often indicated when a user, who historically belonged to a low-activity cluster, suddenly shifts to a high-activity cluster. This method can also identify users who don't fit into any cluster (outliers), flagging them for investigation as their behavior is unique and potentially suspicious.
    answer_sources:
      - Confluence Access Logs
      - Zeek http.log
      - Zeek files.log
      - Confluence web server
      - Network traffic sensor
    range: last 90 days
    queries:
      - pseudocode: CLUSTER users based on access features (e.g., DBSCAN). MONITOR for users shifting between low- and high-activity clusters. IDENTIFY and ALERT on outlier users.
  - question: Has a highly privileged account, such as a Domain Admin, accessed Confluence?
    context: This question focuses on a high-risk scenario. Highly privileged accounts (e.g., 'Domain Admins') typically do not need to access content-collaboration platforms like Confluence for their administrative duties. Their access to such a system is inherently suspicious and could indicate that a compromised high-value account is being used to search for sensitive information. An alert on any such access warrants immediate investigation.
    answer_sources:
      - Confluence Access Logs
      - Windows Event ID 4624
      - Active Directory security logs
      - Confluence web server
      - Domain Controllers
    range: last 90 days
    queries:
      - pseudocode: MAINTAIN watchlist of privileged user groups. CHECK Confluence access logs for any user from the watchlist. GENERATE high-priority alert on match.
  - question: Has an account that has been dormant on Confluence for a long period (e.g., >180 days) suddenly become active?
    context: This question is based on the premise that long-dormant accounts are attractive targets for adversaries because their sudden reactivation is less likely to be noticed. By tracking the last logon time for each user, an alert can be triggered when an account is used after a prolonged period of inactivity (e.g., 180 days). This is a simple but effective way to detect the potential misuse of old or forgotten accounts.
    answer_sources:
      - Confluence Access Logs
      - Windows Event ID 4624
      - Active Directory security logs
      - Confluence web server
      - Domain Controllers
    range: last 90 days
    queries:
      - pseudocode: FOR each user, STORE last Confluence logon timestamp. ON new logon, CALCULATE time since last logon. ALERT if time is > 180 days.
  - question: Is a user's first-time access to Confluence considered a low-probability event based on their role and peer behavior?
    context: This question seeks to identify suspicious first-time access. A machine learning model can be trained to understand which types of users (based on role, department, etc.) are likely to access Confluence. When a user whose profile suggests they have no business reason to access Confluence logs in for the first time, the model would flag this as a low-probability, suspicious event, potentially indicating a compromised account being used for exploration.
    answer_sources:
      - Confluence Access Logs
      - Windows Event ID 4624
      - Active Directory security logs
      - Confluence web server
      - Domain Controllers
    range: last 90 days
    queries:
      - pseudocode: SCORE first-time Confluence access events using a pre-trained classification model. ALERT if the model predicts a low probability of legitimate access.
  - question: Is a user accessing a Confluence space they are not authorized for based on data sensitivity and group membership?
    context: This question enforces access control policies at the detection layer. By mapping users to authorized groups for specific Confluence spaces (especially those with sensitive data), this rule can immediately flag policy violations. Such an access event could indicate misconfiguration, privilege escalation, or a compromised account being used to access restricted information.
    answer_sources:
      - Confluence Access Logs
      - Confluence web server
    range: last 90 days
    queries:
      - pseudocode: MAINTAIN map of sensitive spaces and authorized user groups. ON access to a sensitive space, CHECK if user is in an authorized group. ALERT on mismatch.
  - question: Is a user accessing an unusually high number of unpopular or 'cold' Confluence pages?
    context: This question aims to detect indiscriminate browsing, a behavior often exhibited by attackers performing reconnaissance. Legitimate users typically access popular, relevant pages. By identifying pages that are rarely visited ('cold' pages), this action can flag a user who accesses a large number of them in a short period. This behavior suggests the user is not seeking specific information but rather exploring the environment broadly, which is highly suspicious.
    answer_sources:
      - Confluence Access Logs
      - Confluence web server
    range: last 90 days
    queries:
      - pseudocode: CALCULATE page popularity over 90 days to identify 'cold' pages (bottom 10%). COUNT 'cold' page access per user session. ALERT if count > 20 within 24 hours.
  - question: Is a user's access pattern traversing across multiple, distinct 'communities of practice' within the Confluence knowledge graph?
    context: This question employs graph analytics to model relationships between users and the pages they access, revealing 'communities of practice' (e.g., the engineering team and their documents). A legitimate user's activity is typically confined to one or a few communities. An adversary, however, may jump between disparate communities (e.g., from HR to Finance to IT). This action detects such anomalous traversal, which is a strong indicator of a compromised account being used for wide-ranging reconnaissance.
    answer_sources:
      - Confluence Access Logs
      - Confluence web server
    range: last 90 days
    queries:
      - pseudocode: MODEL Confluence as a graph of users, pages, and access events. IDENTIFY communities (clusters). MONITOR user access patterns. ALERT if a user traverses multiple, unrelated communities.
  - question: After triggering a high-volume Confluence download alert, did the same user log on to a server they have not accessed recently?
    context: This question connects suspicious data collection with potential lateral movement. It creates a stateful rule that looks for a specific sequence, first, a high-risk activity in Confluence (e.g., bulk download), followed by the same user accessing a new server. This sequence strongly suggests that the user found credentials or information in Confluence and is now using it to move to another system. Correlating these events provides much higher confidence than either event in isolation.
    answer_sources:
      - Confluence Access Logs
      - Windows Event ID 4624
      - Windows Event ID 4648
      - Zeek conn.log
      - Confluence web server
      - Domain Controllers
      - Critical internal servers
      - Endpoint devices
    range: last 90 days
    queries:
      - pseudocode: CREATE stateful rule. ON 'High Volume Confluence Download' alert for a user, MONITOR that user's authentications. IF user performs network logon (Type 3) to a new host (not seen in 90 days), ESCALATE to critical alert.
  - question: Following a high-risk Confluence alert, did the user log on to a host that is statistically rare for them to access?
    context: This question refines the detection of lateral movement by using personalized baselines. Instead of just looking for access to any new host, it maintains a profile of hosts each user typically accesses. After a Confluence-related alert, any logon to a host that is statistically rare for that specific user is flagged. This approach is more precise, as it can detect movement to a server that might be common for others but is highly unusual for the user in question.
    answer_sources:
      - Confluence Access Logs
      - Windows Event ID 4624
      - Windows Event ID 4648
      - Zeek conn.log
      - Confluence web server
      - Domain Controllers
      - Critical internal servers
      - Endpoint devices
    range: last 90 days
    queries:
      - pseudocode: MAINTAIN profile of typical hosts per user. ON high-risk Confluence alert for a user, MONITOR subsequent logons. ALERT if logon occurs to a host that is statistically rare for that user's profile.
  - question: Did a user's recent sequence of actions, including Confluence activity and subsequent logons, match a rare and high-risk pattern identified by a sequence analysis model?
    context: This question uses advanced sequence analysis (e.g., HMM or LSTM) to understand the entire 'story' of an attack chain. The model is trained on vast amounts of user activity data to learn normal sequences of events. It can then identify and score new sequences in real-time. A sequence of events that is individually suspicious but collectively forms a known attack pattern (e.g., bulk download -> access rare page -> logon to critical server) would be flagged by the model as a high-risk event chain, providing a holistic view of the threat.
    answer_sources:
      - Confluence Access Logs
      - Windows Event ID 4624
      - Windows Event ID 4648
      - Zeek conn.log
      - Confluence web server
      - Domain Controllers
      - Critical internal servers
      - Endpoint devices
    range: last 90 days
    queries:
      - pseudocode: SCORE real-time event chains using a sequence analysis model (e.g., LSTM). ALERT if a sequence is identified as rare and high-risk (e.g., Confluence bulk access followed by first-time logon to a critical server).