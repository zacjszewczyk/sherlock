name: "T1583: Acquire Infrastructure"
id: "a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d"
description: >
  This playbook helps determine if an adversary is leveraging newly acquired or fingerprinted infrastructure for command and control against the network. It focuses on identifying connections to known malicious destinations, detecting anomalous SSL/TLS sessions that fingerprint C2 frameworks, finding traffic to newly registered domains (NRDs) that exhibit suspicious flocking behavior, and identifying periodic 'heartbeat' patterns or connections from non-standard processes indicative of C2 communication.
type: "technique"
related:
  - "TA0042: Resource Development"
contributors:
  - "Zachary Szewczyk"
  - "Ask Sage"
created: "2025-10-01"
modified: "2025-10-01"
version: 1.0
tags: "none"
questions:
  - question: "Are internal hosts connecting to external destinations (IPs, domains) or using certificates that are on a known malicious infrastructure threat intelligence feed?"
    context: "This question aims to perform a direct match of outbound network traffic against a high-confidence list of known malicious Indicators of Compromise (IOCs). This is a foundational step in threat detection, as a positive match provides a strong signal of malicious activity. By continuously monitoring destination IPs, domains, and SSL/TLS certificate hashes, an organization can quickly identify communication with adversary-controlled C2 servers."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Zeek ssl.log"
      - "Zeek x509.log"
      - "Threat Intelligence C2 Feed"
      - "Enterprise network egress points (Firewalls, Proxies)"
      - "Internal DNS resolvers and forwarders"
      - "VPN concentrators"
      - "Cloud IaaS/PaaS VPC egress gateways"
    range: "last 90 days"
    queries:
      - type: "pseudocode"
        query: "FROM network_logs JOIN threat_intel_feed ON (network_logs.destination_ip = threat_intel_feed.ip OR network_logs.domain = threat_intel_feed.domain OR network_logs.cert_hash = threat_intel_feed.hash) GENERATE high_priority_alert"
  - question: "If a connection to a known malicious indicator is found, is the activity widespread across the network?"
    context: "This question helps an analyst assess the scope of a potential compromise. A single host connecting to a malicious IOC might indicate an isolated infection, but multiple distinct hosts connecting to the same IOC suggests a widespread campaign. By calculating the frequency of connections from unique internal sources and comparing it to a baseline, we can automatically escalate the priority for incidents that appear to be more broadly impacting the enterprise."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Zeek ssl.log"
      - "Zeek x509.log"
      - "Threat Intelligence C2 Feed"
      - "Enterprise network egress points (Firewalls, Proxies)"
      - "Internal DNS resolvers and forwarders"
      - "VPN concentrators"
      - "Cloud IaaS/PaaS VPC egress gateways"
    range: "last 90 days"
    queries:
      - type: "pseudocode"
        query: "FOR each matched_ioc, COUNT distinct source_ip over 24h. IF count > 95th_percentile_of_all_external_destinations, ESCALATE alert_priority."
  - question: "Can we proactively identify high-risk outbound connections that resemble malicious infrastructure communication, even without a direct IOC match?"
    context: "This question addresses the challenge of detecting threats from new or unknown infrastructure not yet present in threat intelligence feeds. By using a machine learning model to assign a risk score to all outbound connections based on a combination of features (e.g., IP reputation, domain age, ASN, certificate details), we can identify suspicious activity that shares characteristics with known malicious infrastructure. This provides a proactive detection capability beyond simple IOC matching."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Zeek ssl.log"
      - "Zeek x509.log"
      - "Threat Intelligence C2 Feed"
      - "Enterprise network egress points (Firewalls, Proxies)"
      - "Internal DNS resolvers and forwarders"
      - "VPN concentrators"
      - "Cloud IaaS/PaaS VPC egress gateways"
    range: "last 90 days"
    queries:
      - type: "pseudocode"
        query: "FOR each outbound_connection, CALCULATE risk_score using classification_model(features). IF risk_score > 0.85, FLAG for investigation."
  - question: "Is there any outbound SSL/TLS traffic matching the fingerprint (JA3/JA3S) or certificate details of known malicious C2 frameworks?"
    context: "This question leverages the concept of TLS fingerprinting to identify specific malware families or adversary tools. The way a client initiates a TLS session creates a unique fingerprint (JA3/JA3S). By comparing these fingerprints against a known list of malicious ones, we can detect C2 communication even if the destination IP and domain are unknown. Additionally, checking for default or suspicious values in self-signed certificates (e.g., 'localhost') can reveal lazy adversary setups."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek ssl.log"
      - "Zeek x509.log"
      - "Threat Intelligence JA3/C2 Certificate Feed"
      - "Enterprise network egress points"
      - "SSL/TLS inspection appliances"
      - "Demilitarized Zone (DMZ) servers"
      - "Application delivery controllers (ADCs)"
    range: "last 90 days"
    queries:
      - type: "pseudocode"
        query: "FROM ssl_logs JOIN ja3_watchlist ON (ssl_logs.ja3_hash = ja3_watchlist.hash) OR (ssl_logs.cert_subject CONTAINS 'suspicious_string') GENERATE alert."
  - question: "Are there statistical anomalies in the diversity of SSL/TLS client fingerprints (JA3) that suggest a specific tool or malware is becoming more prevalent?"
    context: "This question uses statistical analysis to find C2 activity without relying on pre-existing indicators. A healthy network has a wide variety of TLS clients, resulting in high entropy of JA3 hashes. If a specific malware is deployed across many machines, they will all use the same TLS client, causing a sudden spike in one JA3 hash's frequency and a decrease in overall entropy. Monitoring for these statistical shifts can reveal this 'homogenization' of C2 channels."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek ssl.log"
      - "Zeek x509.log"
      - "Threat Intelligence JA3/C2 Certificate Feed"
      - "Enterprise network egress points"
      - "SSL/TLS inspection appliances"
      - "Demilitarized Zone (DMZ) servers"
      - "Application delivery controllers (ADCs)"
    range: "last 90 days"
    queries:
      - type: "pseudocode"
        query: "FOR each ja3_hash, CALCULATE hourly_count. IF hourly_count > (30_day_moving_average + 3 * std_dev), FLAG as anomalous."
  - question: "Can we identify unknown or novel C2 communication by finding clusters of SSL/TLS traffic that are anomalous compared to normal application traffic?"
    context: "This question focuses on discovering novel threats using unsupervised machine learning. By clustering SSL/TLS sessions based on their features (JA3, certificate details, cipher suites, etc.), we can group traffic from similar applications. Any small, distinct clusters that do not group with known-good applications (like browsers or updaters) are inherently anomalous and warrant investigation as potential C2 channels."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek ssl.log"
      - "Zeek x509.log"
      - "Threat Intelligence JA3/C2 Certificate Feed"
      - "Enterprise network egress points"
      - "SSL/TLS inspection appliances"
      - "Demilitarized Zone (DMZ) servers"
      - "Application delivery controllers (ADCs)"
    range: "last 90 days"
    queries:
      - type: "pseudocode"
        query: "APPLY DBSCAN clustering on ssl_session_features. ANALYZE clusters that are not associated with known_good_applications."
  - question: "Are internal hosts connecting to newly registered domains (NRDs) that also exhibit other suspicious characteristics like WHOIS privacy or hosting on a malicious ASN?"
    context: "Adversaries frequently use newly registered domains (NRDs) for their campaigns, as these domains have no prior reputation. This question aims to identify connections to these NRDs (e.g., registered < 30 days ago) and increase confidence by correlating this with other risk factors, such as the use of WHOIS privacy services to hide ownership or hosting on an Autonomous System Number (ASN) known for malicious activity. This multi-factored approach reduces false positives from legitimate new domains."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Passive DNS and WHOIS Data Feed"
      - "Internal DNS resolvers and forwarders"
      - "Enterprise network egress points"
      - "External domain registration data providers"
    range: "last 90 days"
    queries:
      - type: "pseudocode"
        query: "FROM dns_logs ENRICH with whois_data. IF domain_age < 30d AND (has_whois_privacy OR is_on_risky_asn), FLAG connection."
  - question: "Is there an unusually high number of internal hosts ('flocking') connecting to a specific newly registered domain?"
    context: "While a single host connecting to an NRD might be benign, a large number of internal clients suddenly connecting to the same NRD is a strong indicator of a coordinated campaign. This behavior, often called 'flocking,' can signify that a piece of malware has been activated across multiple endpoints, all reaching out to the same C2 domain. This question seeks to detect this anomaly by baselining normal NRD traffic and alerting when a specific NRD exceeds a high-percentile threshold for unique clients or traffic volume."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Passive DNS and WHOIS Data Feed"
      - "Internal DNS resolvers and forwarders"
      - "Enterprise network egress points"
      - "External domain registration data providers"
    range: "last 90 days"
    queries:
      - type: "pseudocode"
        query: "FOR each NRD, COUNT unique_clients_per_day. IF count > 99th_percentile_of_all_NRDs, GENERATE alert for flocking_behavior."
  - question: "Is there a sudden, unexpected spike in the overall number of new NRDs being accessed across the enterprise, suggesting a broad new campaign?"
    context: "This question takes a macro view to detect large-scale campaigns. Instead of looking at a single NRD, it analyzes the total volume of new, previously unseen NRDs being accessed across the enterprise. By using a time series forecasting model, we can predict the expected number of new NRDs for any given day. A significant deviation from this forecast (i.e., a much higher observed count) could indicate that an adversary has activated a large batch of new domains for a widespread attack."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Passive DNS and WHOIS Data Feed"
      - "Internal DNS resolvers and forwarders"
      - "Enterprise network egress points"
      - "External domain registration data providers"
    range: "last 90 days"
    queries:
      - type: "pseudocode"
        query: "FORECAST daily_new_nrd_count using ARIMA model. IF observed_count > forecast_upper_confidence_bound, GENERATE alert."
  - question: "Is a non-standard or suspicious process on an endpoint making an outbound network connection?"
    context: "This question pivots to the endpoint to identify the origin of suspicious network traffic. Legitimate user-initiated traffic usually comes from web browsers. Outbound connections originating from processes like PowerShell, WScript, or unknown executables running from temporary directories are highly suspect. By correlating network connection events (Windows Event ID 5156) with process creation events (Event ID 4688), we can link suspicious traffic to its source process and command line for a full investigative picture."
    answer_sources:
      - "Zeek conn.log"
      - "Windows Event ID 4688"
      - "Windows Event ID 5156"
      - "Endpoint devices (workstations and servers)"
      - "Network egress points and flow collectors"
      - "Cloud provider network boundaries (e.g., VPC Flow Logs)"
    range: "last 90 days"
    queries:
      - type: "pseudocode"
        query: "JOIN event_4688 with event_5156 ON process_id. IF process_name NOT IN ('browser.exe') AND destination_ip NOT IN (allowlist), GENERATE alert."
  - question: "Is there any network traffic exhibiting a periodic 'heartbeat' or 'beaconing' pattern, characteristic of C2 communication?"
    context: "This question seeks to identify the machine-like regularity of automated C2 communications. Malware often 'calls home' to its C2 server on a fixed schedule (e.g., every 5 minutes) with a similarly sized payload. This results in a very low standard deviation in both the time between connections and the amount of data sent. By analyzing these metrics for all source-destination pairs, we can statistically identify these highly regular 'beacons' that stand out from more random human-driven traffic."
    answer_sources:
      - "Zeek conn.log"
      - "Windows Event ID 4688"
      - "Windows Event ID 5156"
      - "Endpoint devices (workstations and servers)"
      - "Network egress points and flow collectors"
      - "Cloud provider network boundaries (e.g., VPC Flow Logs)"
    range: "last 90 days"
    queries:
      - type: "pseudocode"
        query: "FOR each src_dst_pair, CALCULATE std_dev(inter_arrival_time) and std_dev(byte_size) over 1h. IF both values < 5th_percentile, FLAG as beaconing."
  - question: "Can we use a machine learning model to detect anomalous outbound connections that don't conform to the patterns of known-good traffic?"
    context: "This question proposes using an anomaly detection model, such as an autoencoder, to find unknown C2 activity. The model is trained exclusively on features from known-good network sessions. It learns to 'reconstruct' this normal traffic with high accuracy. When the trained model is then applied to all new traffic, any session that it cannot reconstruct accurately (resulting in a high 'reconstruction error') is flagged as an anomaly. This is a powerful technique for finding novel threats that do not match any known patterns."
    answer_sources:
      - "Zeek conn.log"
      - "Windows Event ID 4688"
      - "Windows Event ID 5156"
      - "Endpoint devices (workstations and servers)"
      - "Network egress points and flow collectors"
      - "Cloud provider network boundaries (e.g., VPC Flow Logs)"
    range: "last 90 days"
    queries:
      - type: "pseudocode"
        query: "FOR each new_connection, CALCULATE reconstruction_error using trained_autoencoder_model. IF reconstruction_error > threshold, FLAG as anomalous."