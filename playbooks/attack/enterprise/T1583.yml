name: "T1583: Acquire Infrastructure"
id: "5a9b3f8c-1d0e-4a6f-8b7c-2e9f0d1a3b5c"
description: "This playbook helps determine if an adversary is leveraging newly acquired or fingerprinted infrastructure for command and control (C2) against the network. It provides investigative questions to detect adversary infrastructure through several methods: matching network connections against threat intelligence feeds; identifying malicious SSL/TLS fingerprints (JA3/JA3S) or suspicious certificate attributes; detecting anomalous connections to newly registered domains (NRDs); and finding non-standard processes initiating periodic 'heartbeat' connections characteristic of C2 beaconing."
type: "technique"
related:
  - "TA0042: Resource Development"
contributors:
  - "Zachary Szewczyk"
  - "Ask Sage"
created: "2025-10-01"
modified: "2025-10-01"
version: "1.0"
tags: "none"
questions:
  - question: "Has any internal host connected to an external destination (IP or domain) or used an SSL/TLS certificate that matches a known malicious indicator from threat intelligence?"
    context: "This question aims to detect direct connections to adversary-controlled infrastructure by comparing outbound network traffic against high-confidence threat intelligence feeds. A match provides a strong signal that an internal system is communicating with a known command and control (C2) server, malware distribution point, or other malicious entity. This symbolic matching is a foundational step in identifying compromised systems."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Zeek ssl.log"
      - "Zeek x509.log"
      - "Threat Intelligence C2 Feed"
      - "Enterprise network egress points (Firewalls, Proxies)"
      - "Internal DNS resolvers and forwarders"
      - "VPN concentrators"
      - "Cloud IaaS/PaaS VPC egress gateways"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: "JOIN (conn.log, dns.log, ssl.log) WITH (threat_intel_feed) ON (destination_ip, domain, cert_hash). ALERT on match."
  - question: "Is a known malicious indicator being contacted by an unusually high number of distinct internal hosts, suggesting a widespread incident?"
    context: "After identifying a connection to a malicious indicator, it's crucial to understand the scope of the potential compromise. This question uses statistical analysis to determine if the number of internal systems contacting the indicator is anomalous. A high count of distinct sources connecting to the same malicious destination, exceeding a statistical baseline (95th percentile), strongly suggests a widespread campaign or outbreak rather than an isolated incident, requiring an escalated response."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Zeek ssl.log"
      - "Zeek x509.log"
      - "Threat Intelligence C2 Feed"
      - "Enterprise network egress points (Firewalls, Proxies)"
      - "Internal DNS resolvers and forwarders"
      - "VPN concentrators"
      - "Cloud IaaS/PaaS VPC egress gateways"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: "FOR each matched_ioc, COUNT(DISTINCT source_ip) over 24h. IF count > 95th_percentile(all_external_destinations), ESCALATE alert."
  - question: "Are there any outbound network connections that a machine learning model flags as high-risk, even if they don't match a known threat intelligence indicator?"
    context: "This question leverages machine learning to proactively identify suspicious connections that may not yet be on any threat intelligence list. By training a model on features associated with malicious infrastructure (e.g., poor IP reputation, newly registered domains, unusual ASNs, suspicious certificate details), we can score all outbound connections for their potential risk. This approach helps uncover novel or previously unknown C2 channels by flagging connections that exhibit malicious characteristics, moving beyond simple IOC matching."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Zeek ssl.log"
      - "Zeek x509.log"
      - "Threat Intelligence C2 Feed"
      - "Enterprise network egress points (Firewalls, Proxies)"
      - "Internal DNS resolvers and forwarders"
      - "VPN concentrators"
      - "Cloud IaaS/PaaS VPC egress gateways"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: "FOR each outbound_connection, CALCULATE risk_score using ML_model(features). IF risk_score > 0.85, ALERT for investigation."
  - question: "Has any outbound SSL/TLS session used a client fingerprint (JA3/JA3S) or certificate attribute associated with a known malicious tool or framework?"
    context: "This question focuses on identifying malicious actors by fingerprinting their tools. Many malware families and C2 frameworks use specific SSL/TLS libraries that produce a unique JA3 (client) or JA3S (server) hash. Additionally, they often use default, self-signed certificates with generic subject or issuer fields. By matching these fingerprints and certificate details against a watchlist, analysts can detect the presence of specific malicious tools on the network, even if the destination IP or domain is unknown."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek ssl.log"
      - "Zeek x509.log"
      - "Threat Intelligence JA3/C2 Certificate Feed"
      - "Enterprise network egress points"
      - "SSL/TLS inspection appliances"
      - "Demilitarized Zone (DMZ) servers"
      - "Application delivery controllers (ADCs)"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: "JOIN (ssl.log, x509.log) WITH (malicious_ja3_cert_feed) ON (ja3_hash, ja3s_hash, cert_attributes). ALERT on match."
  - question: "Has there been a statistically significant change in the diversity of SSL/TLS client fingerprints (JA3), such as a sudden spike in a rare fingerprint, indicating potential C2 activity?"
    context: "Normal network traffic exhibits a high degree of diversity in SSL/TLS client applications, resulting in high entropy for JA3 hashes. When a specific malware variant spreads across multiple hosts, they all begin communicating with a C2 server using the same client, causing a sudden drop in JA3 entropy and a spike in the count of a single, often rare, JA3 hash. This question aims to detect this 'homogenization' by flagging JA3 hashes whose frequency deviates significantly from their historical baseline, pointing to a coordinated C2 channel."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek ssl.log"
      - "Zeek x509.log"
      - "Threat Intelligence JA3/C2 Certificate Feed"
      - "Enterprise network egress points"
      - "SSL/TLS inspection appliances"
      - "Demilitarized Zone (DMZ) servers"
      - "Application delivery controllers (ADCs)"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: "CALCULATE hourly count for each ja3_hash. IF hourly_count > (30_day_moving_avg + 3 * std_dev), ALERT."
  - question: "Can we identify anomalous clusters of SSL/TLS traffic with similar characteristics that differ from known-good application traffic?"
    context: "This question uses unsupervised machine learning to find 'needles in a haystack.' Instead of looking for known-bad patterns, it groups all SSL/TLS sessions based on multiple features (JA3, certificate details, port, etc.). The underlying assumption is that legitimate traffic from common applications will form large, dense clusters, while malicious C2 traffic will form smaller, distinct clusters or be flagged as outliers. Analyzing these anomalous clusters can reveal novel C2 channels that would otherwise be missed by signature-based or statistical methods."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek ssl.log"
      - "Zeek x509.log"
      - "Threat Intelligence JA3/C2 Certificate Feed"
      - "Enterprise network egress points"
      - "SSL/TLS inspection appliances"
      - "Demilitarized Zone (DMZ) servers"
      - "Application delivery controllers (ADCs)"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: "APPLY clustering_model(DBSCAN) to SSL_session_features. ANALYZE clusters not matching known-good profiles."
  - question: "Are internal hosts connecting to newly registered domains (NRDs) that also exhibit other suspicious characteristics like WHOIS privacy or hosting on a malicious ASN?"
    context: "Adversaries frequently register new domains for their campaigns to evade reputation-based blocking. This question seeks to identify these potentially malicious domains by combining several risk factors. A domain that is newly registered (e.g., < 30 days old), hides its ownership details (WHOIS privacy), and is hosted in a 'bad neighborhood' (a known malicious ASN) is highly suspicious. Flagging connections to domains that meet these combined criteria provides a strong signal of potential C2 communication."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Passive DNS and WHOIS Data Feed"
      - "Internal DNS resolvers and forwarders"
      - "Enterprise network egress points"
      - "External domain registration data providers"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: "ENRICH dns.log with WHOIS/NRD feed. ALERT IF domain_age < 30d AND (uses_whois_privacy OR hosted_on_malicious_asn)."
  - question: "Is a specific newly registered domain (NRD) receiving an anomalously high amount of traffic or connections from an unusually large number of internal clients?"
    context: "While accessing an NRD is not inherently malicious, a sudden 'flocking' of many internal clients to the same, unknown NRD is highly irregular. This question establishes a statistical baseline for normal NRD traffic and looks for significant outliers. An NRD that suddenly receives connections from a number of clients exceeding the 99th percentile suggests a coordinated action, such as a phishing campaign driving users to a malicious site or compromised hosts beaconing to a new C2 server."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Passive DNS and WHOIS Data Feed"
      - "Internal DNS resolvers and forwarders"
      - "Enterprise network egress points"
      - "External domain registration data providers"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: "FOR each NRD, CALCULATE daily unique_clients and bytes_transferred. ALERT IF value > 99th_percentile(all_NRDs)."
  - question: "Is the overall number of new, previously unseen NRDs being accessed across the enterprise significantly higher than forecasted, suggesting a large-scale campaign?"
    context: "This question takes a macro view, looking for broad changes in organizational behavior. By using a time series model to forecast the expected number of new NRDs the enterprise will access on a given day, we can detect large-scale anomalies. If the actual number of accessed NRDs suddenly and significantly exceeds the model's prediction, it could indicate the start of a widespread phishing or malware campaign that is directing users and systems to a large set of newly created malicious domains."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Passive DNS and WHOIS Data Feed"
      - "Internal DNS resolvers and forwarders"
      - "Enterprise network egress points"
      - "External domain registration data providers"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: "FORECAST daily_new_NRD_count using time_series_model. ALERT IF observed_count > forecast_upper_confidence_bound."
  - question: "Has a non-standard or suspicious process on an endpoint, such as a script interpreter or a binary in a temp folder, initiated an outbound network connection?"
    context: "This question focuses on endpoint behavior to identify C2 channels initiated by 'living-off-the-land' binaries (LOLBins) or dropped malware. Legitimate user-driven web traffic typically originates from browser processes. An outbound connection from a process like PowerShell, WScript, or an executable running from an unusual location (e.g., %TEMP%) is highly suspicious and often indicative of malware execution or post-exploitation activity. Correlating network connection events with process creation events on the endpoint provides this crucial context."
    answer_sources:
      - "Zeek conn.log"
      - "Windows Event ID 4688"
      - "Windows Event ID 5156"
      - "Endpoint devices (workstations and servers)"
      - "Network egress points and flow collectors"
      - "Cloud provider network boundaries (e.g., VPC Flow Logs)"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: "JOIN WinEvent:5156 (network) with WinEvent:4688 (process) on PID. ALERT IF process_name is not browser AND destination_ip not in allowlist."
  - question: "Are there any network connections exhibiting a highly regular, periodic 'heartbeat' pattern in their timing and data volume, characteristic of C2 beaconing?"
    context: "Malware C2 communications often involve regular, automated 'beacons' or 'heartbeats' where the compromised host checks in with the C2 server. These connections typically occur at fixed intervals (e.g., every 5 minutes) and involve a similar amount of data each time. This regularity results in a very low standard deviation for both the time between connections and the size of the data transferred. This question uses statistical analysis of network flow data to identify these machine-like patterns, which stand out from the more variable patterns of human-generated traffic."
    answer_sources:
      - "Zeek conn.log"
      - "Windows Event ID 4688"
      - "Windows Event ID 5156"
      - "Endpoint devices (workstations and servers)"
      - "Network egress points and flow collectors"
      - "Cloud provider network boundaries (e.g., VPC Flow Logs)"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: "FOR each src-dst pair, CALCULATE std_dev(inter_arrival_time) and std_dev(byte_size) over 1h. ALERT IF both values < 5th_percentile."
  - question: "Can a machine learning anomaly detection model (autoencoder) identify outbound network sessions that do not conform to learned patterns of normal traffic?"
    context: "This question employs an autoencoder, a type of neural network, to learn a compressed representation of 'normal' network behavior. The model is trained exclusively on known-good traffic sessions, learning their typical features (process, port, duration, size, etc.). When the trained model is then used to process all new connections, it will be very good at reconstructing the normal traffic it was trained on (low reconstruction error). However, it will struggle to reconstruct anomalous traffic, like a C2 channel, resulting in a high reconstruction error. This error serves as a powerful anomaly score to flag previously unseen malicious activity."
    answer_sources:
      - "Zeek conn.log"
      - "Windows Event ID 4688"
      - "Windows Event ID 5156"
      - "Endpoint devices (workstations and servers)"
      - "Network egress points and flow collectors"
      - "Cloud provider network boundaries (e.g., VPC Flow Logs)"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: "FOR each new_connection, CALCULATE reconstruction_error using autoencoder_model. ALERT IF error > anomaly_threshold."