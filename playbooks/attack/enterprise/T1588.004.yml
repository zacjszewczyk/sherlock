name: T1588.004: Digital Certificates
id: 9e5c4a1b-9b4f-4d3e-9c1a-2b0a9d8c7e6f
description: This playbook helps determine if an adversary is acquiring or staging digital certificates for future operations. It focuses on identifying malicious certificates by matching them against threat intelligence feeds; detecting the use of typosquatted, homoglyph, or dynamic DNS domains with free certificates; finding anomalous certificate characteristics such as short validity periods, rare issuers, or use on newly registered domains; monitoring for unusual spikes in self-signed certificates or validation errors; and discovering infrastructure reuse patterns, such as a single certificate used across many IPs or a single IP hosting many suspicious certificates.
type: technique
related:
  - TA0042: Resource Development
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
investigative_questions:
  - question: Are we observing network traffic using digital certificates known to be malicious by threat intelligence?
    context: This is a high-fidelity detection method. Matching an observed certificate's thumbprint against a curated list of known-malicious certificates from a Cyber Threat Intelligence (CTI) feed is a direct way to identify adversary activity on the network.
    answer_sources:
      - Zeek ssl.log
      - Zeek conn.log
      - Threat Intelligence Platform
      - Network Egress/Ingress Points
      - Forward Web Proxies
    range: last 90 days
    queries:
      - "SIEM: JOIN network traffic logs (Zeek ssl.log) with CTI feed of malicious certificate thumbprints. ALERT on any match."
  - question: For connections using known-malicious certificates, are there signs of DGA or data staging?
    context: Once a CTI match is confirmed, further analysis of the connection can reveal the adversary's intent. High entropy in the Server Name Indication (SNI) field suggests Domain Generation Algorithm (DGA) activity for C2 communications, while a high ratio of inbound-to-outbound bytes could indicate data staging for exfiltration.
    answer_sources:
      - Zeek ssl.log
      - Zeek conn.log
      - Network Egress/Ingress Points
      - Forward Web Proxies
    range: last 90 days
    queries:
      - "Script: FOR each CTI-matched certificate, GET associated connection from Zeek conn.log. CALCULATE SNI entropy and inbound/outbound byte ratio. FLAG high entropy or high ratios."
  - question: Can we use machine learning to automatically prioritize and validate CTI alerts related to malicious certificates?
    context: CTI feeds can contain false positives. A supervised classification model can analyze multiple features from a CTI-matched event (e.g., CTI source reputation, connection duration, total bytes, SNI entropy) to produce a confidence score, allowing analysts to focus on the highest-risk alerts and automating the initial triage process.
    answer_sources:
      - Zeek ssl.log
      - Zeek conn.log
      - Threat Intelligence Platform
      - SIEM/Data Analytics Platform
    range: last 90 days
    queries:
      - "ML Model: FOR each CTI-matched event, EXTRACT features (CTI reputation, duration, bytes, protocol, SNI entropy). INPUT features into trained classification model. ESCALATE events with a confidence score > 0.9."
  - question: Are adversaries using free certificates for dynamic DNS domains to build their infrastructure?
    context: This combination is a common TTP for adversaries. They leverage free Certificate Authorities (e.g., Let's Encrypt) and dynamic DNS providers to quickly and cheaply stand up command and control (C2) or phishing infrastructure that appears legitimate with a valid TLS certificate.
    answer_sources:
      - Zeek ssl.log
      - Zeek conn.log
      - Zeek dns.log
      - Network Egress/Ingress Points
      - Forward Web Proxies
      - Internal DNS Resolvers
    range: last 90 days
    queries:
      - "SIEM: SEARCH Zeek ssl.log WHERE issuer is in 'free_CA_list' AND (subject_cn OR subject_alt_name) MATCHES regex for 'dynamic_dns_providers'. ALERT on match."
  - question: Are there any certificates for domains that are typosquatted versions of our organization's domains?
    context: Adversaries register domains that are visually similar (typosquats or homoglyphs) to a legitimate organizational domain to trick users in phishing campaigns or to masquerade C2 traffic. Calculating the Levenshtein distance, a measure of string similarity, between observed certificate domains and official company domains is an effective way to programmatically detect such attempts.
    answer_sources:
      - Zeek ssl.log
      - Zeek conn.log
      - Internal DNS Resolvers
      - Network Egress/Ingress Points
    range: last 90 days
    queries:
      - "Script: FOR each certificate in Zeek ssl.log, CALCULATE Levenshtein distance between certificate domain and 'official_domains_list'. FLAG for review if distance is between 1 and 3."
  - question: Can we use a machine learning model to proactively identify potentially malicious domains based on their name structure?
    context: Many malicious domains, such as those used for DGA or phishing, have character-level patterns that differ from human-generated domains. A character-level NLP model (e.g., an RNN) can be trained to recognize these patterns and score new domains for their likelihood of being malicious, providing a more advanced and scalable detection capability than simple blocklists.
    answer_sources:
      - Zeek ssl.log
      - Zeek dns.log
      - SIEM/Data Analytics Platform
    range: last 90 days
    queries:
      - "ML Model: FOR each new domain from Zeek ssl.log, INPUT domain string into trained NLP model. ALERT if maliciousness score exceeds confidence threshold."
  - question: Are newly registered domains using free certificates, potentially for short-lived malicious campaigns?
    context: Adversaries often register a domain and use it immediately for a malicious campaign, then discard it. The combination of a very young domain (e.g., registered within the last 7 days) and a certificate from a free CA is highly suspicious and indicative of throwaway adversary infrastructure.
    answer_sources:
      - Zeek ssl.log
      - Zeek conn.log
      - Zeek x509.log
      - Threat Intelligence Platforms
      - SIEM/Data Analytics Platform
    range: last 90 days
    queries:
      - "SIEM: ENRICH domains from Zeek ssl.log with WHOIS data. ALERT where certificate issuer is in 'free_CA_list' AND domain_registration_age < 7 days."
  - question: Are we observing certificates with unusually rare issuers or abnormally short validity periods?
    context: Deviations from normal environmental behavior can indicate malicious activity. A certificate issued by a CA that is rarely seen in the organization, or one with an abnormally short validity period (e.g., under 30 days), breaks established patterns and warrants investigation. This requires baselining normal certificate characteristics.
    answer_sources:
      - Zeek ssl.log
      - Zeek x509.log
      - SIEM/Data Analytics Platform
    range: last 90 days
    queries:
      - "SIEM: BASELINE frequency of certificate issuers and validity periods over 30 days. ALERT on any certificate with an issuer in the bottom 5th percentile of frequency OR a validity period in the bottom 10th percentile."
  - question: Can an unsupervised machine learning model identify anomalous certificates based on a combination of their attributes?
    context: Rather than analyzing single attributes in isolation, an unsupervised model like an Isolation Forest can consider multiple features simultaneously (e.g., validity period, domain age, number of SANs, public key length) to find unusual combinations. This is a powerful technique for identifying novel adversary TTPs that do not match predefined rules.
    answer_sources:
      - Zeek x509.log
      - Threat Intelligence Platforms
      - SIEM/Data Analytics Platform
    range: last 90 days
    queries:
      - "ML Model: FOR each certificate, CREATE feature vector (validity_days, domain_age, num_sans, key_length, is_free_ca). INPUT vector into trained Isolation Forest model. ALERT on high anomaly scores."
  - question: Is a host communicating externally with a self-signed certificate, and was that certificate recently trusted by the host?
    context: An internal host communicating with a public IP address using a self-signed certificate is highly suspicious. If this network event can be correlated with a host-based event showing that a new root certificate was just added to the trust store (e.g., Windows CAPI2 Event ID 53), it strongly suggests an adversary has compromised the host and is establishing a C2 channel using a certificate they've forced the machine to trust.
    answer_sources:
      - Zeek ssl.log
      - Windows Event ID CAPI2 53
      - Network Egress/Ingress Points
      - All Windows Endpoints and Servers
    range: last 90 days
    queries:
      - "SIEM: ALERT on Zeek ssl.log event where destination_ip is public AND validation_status is 'selfsigned'. CORRELATE with Windows Event ID 53 on source_host within a 5-minute window."
  - question: Has there been an abnormal spike in specific certificate validation errors across the environment?
    context: A sudden, sharp increase in a specific type of validation error (e.g., 'certificate_expired', 'bad_certificate_hash') can indicate a widespread attack, such as a man-in-the-middle attempt, or a configuration issue being exploited. Baselining the normal rate of these errors helps distinguish a significant event from operational noise.
    answer_sources:
      - Zeek ssl.log
      - Windows Event ID CAPI2 11
      - Windows Event ID CAPI2 21
      - Windows Event ID CAPI2 30
      - Windows Event ID CAPI2 41
      - All Windows Endpoints and Servers
    range: last 90 days
    queries:
      - "SIEM: For each validation error type, BASELINE daily counts per host and globally. ALERT when the count for any error type exceeds its 99th percentile."
  - question: Is the overall volume of certificate validation errors deviating from its normal, predictable pattern?
    context: The aggregate volume of certificate errors often follows predictable daily and weekly patterns. A time series anomaly detection model can learn this seasonality. An alert generated when the observed error volume significantly deviates from the model's prediction can catch subtle, widespread issues that a simple threshold-based alert might miss.
    answer_sources:
      - Zeek ssl.log
      - Windows CAPI2 logs (various IDs)
      - SIEM/Data Analytics Platform
    range: last 90 days
    queries:
      - "ML Model: FEED aggregate count of certificate validation errors into a trained time series model (e.g., SARIMA, Prophet). ALERT when observed count significantly deviates from the predicted value."
  - question: Is a single suspicious certificate being reused across multiple, disparate IP addresses?
    context: Adversaries often reuse their tools and infrastructure. Observing the same SSL/TLS certificate thumbprint being served from multiple, unrelated IP addresses (excluding large CDNs) is a strong indicator of a coordinated C2 network or phishing infrastructure. Tracking this helps map out the adversary's footprint.
    answer_sources:
      - Zeek ssl.log
      - Zeek x509.log
      - Zeek conn.log
      - SIEM/Data Analytics Platform
    range: last 90 days
    queries:
      - "SIEM: TRACK certificate thumbprints from Zeek x509.log. IF a single non-CDN thumbprint is served by > 5 distinct destination IPs over 7 days, ALERT for infrastructure reuse."
  - question: Are any single IP addresses hosting an unusually high number of distinct websites/certificates?
    context: While shared hosting is normal, a malicious server may be used as a redirector or host for a large number of different phishing or C2 domains. By baselining the number of unique certificate subjects typically served by an IP address, we can flag outliers that are serving an anomalously high number, which could indicate a malicious actor's server.
    answer_sources:
      - Zeek ssl.log
      - Zeek conn.log
      - SIEM/Data Analytics Platform
    range: last 90 days
    queries:
      - "SIEM: For each destination IP, COUNT unique certificate subjects over 24 hours. BASELINE this count across all servers. ALERT on any IP where the count exceeds the 99th percentile."
  - question: Can we use graph analysis to automatically discover clusters of related malicious infrastructure?
    context: Adversary infrastructure is often interconnected in non-obvious ways. By modeling IP addresses, certificate thumbprints, and subjects as nodes in a graph, we can use community detection algorithms to find clusters of related assets. Scoring these clusters based on the proportion of nodes with suspicious attributes (e.g., free CA, young domain) allows analysts to investigate entire campaigns at once.
    answer_sources:
      - Zeek ssl.log
      - Zeek x509.log
      - Zeek conn.log
      - Graph Database Platform
      - SIEM/Data Analytics Platform
    range: last 90 days
    queries:
      - "Graph DB: CREATE graph with nodes (IP, Thumbprint, Subject) and edges (IP-serves-Thumbprint). RUN community detection algorithm. SCORE communities based on density of suspicious attributes. PRIORITIZE investigation of high-score communities."