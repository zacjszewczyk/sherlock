name: T1566.004: Spearphishing Voice
id: a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d
description: This playbook helps determine if an adversary has gained initial access to the network via spearphishing voice (vishing). Vishing attacks involve tricking users over the phone into performing actions that compromise security. This can include directing them to malicious websites, convincing them to install unauthorized remote access software, instructing them to execute obfuscated commands, manipulating them into approving MFA prompts for the attacker, or establishing command and control channels. The playbook focuses on identifying network traffic to malicious destinations, unauthorized software execution, suspicious command-line activity, unusual authentication patterns, and anomalous network connections that are characteristic of a successful vishing attack.
type: technique
related:
  - TA0001: Initial Access
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Are any endpoints connecting to domains or IPs known to be associated with vishing campaigns?
    context: This question aims to find direct evidence of compromise by checking network logs against a high-confidence list of malicious indicators. A match strongly suggests a user was tricked into visiting a malicious site as part of a vishing attack, which is a common tactic where the attacker provides a URL over the phone.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Zeek http.log
      - Network egress points (e.g., firewalls, web proxies)
      - Corporate DNS resolvers
      - VPN concentrators
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          SEARCH Zeek logs (dns.log[query], http.log[host], conn.log[id.resp_h])
          WHERE destination_domain OR destination_ip IN threat_intel_list_vishing
          ALERT on match
  - question: Have any endpoints connected to statistically rare domains that were recently registered or use privacy-protected WHOIS details?
    context: Adversaries often use newly created domains for their campaigns. This question helps identify these suspicious domains by looking for those that are rarely visited across the enterprise and have characteristics common to malicious infrastructure, such as recent registration or hidden ownership. This is a strong indicator of a targeted attack, likely originating from a vishing call.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Zeek http.log
      - Network egress points (e.g., firewalls, web proxies)
      - Corporate DNS resolvers
      - VPN concentrators
    range: last 30 days
    queries:
      - technology: pseudocode
        query: |
          FIND rare_domains (bottom 1% frequency in dns.log over 30 days)
          FOR each domain, GET WHOIS_data
          IF registration_date < 30 days AGO OR registration is private, THEN INVESTIGATE
  - question: Are any requested domains, not on an allow-list, lexically suspicious of being malicious?
    context: This question uses a machine learning model to analyze the structure of domain names themselves. It helps find malicious domains that might not yet be on threat intelligence feeds by identifying features like high entropy, unusual length, or misspellings of brand names (typosquatting), which are common tactics in phishing and vishing.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Zeek http.log
      - Network egress points (e.g., firewalls, web proxies)
      - Corporate DNS resolvers
      - VPN concentrators
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each domain in dns.log:
            IF domain NOT IN allow_list, THEN SCORE domain with lexical_model
            IF score > malicious_threshold, THEN INVESTIGATE
  - question: Has an unapproved remote access tool been executed by a non-administrative process?
    context: Vishing attackers often coach users to install legitimate remote access tools (e.g., AnyDesk, TeamViewer) to gain control of their system. This question detects this activity by looking for the execution of these tools where the parent process is not an authorized IT management tool (like SCCM or Intune), indicating a user-initiated installation.
    answer_sources:
      - Windows Event ID 4688
      - User workstations and laptops
      - Virtual Desktop Infrastructure (VDI) instances
      - Help desk operator consoles
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          SEARCH process creation events (EID 4688)
          WHERE NewProcessName IN unapproved_rat_list
          AND CreatorProcessName NOT IN admin_tool_allow_list
          ALERT on match
  - question: Has any statistically rare software been executed on endpoints?
    context: This question helps identify the execution of non-standard software, which could be an unauthorized remote access tool or other malware introduced during a vishing attack. By calculating the prevalence of each executed process across the enterprise, security teams can focus on rare executables that deviate from normal software usage.
    answer_sources:
      - Windows Event ID 4688
      - User workstations and laptops
      - Virtual Desktop Infrastructure (VDI) instances
      - Help desk operator consoles
    range: last 30 days
    queries:
      - technology: pseudocode
        query: |
          CALCULATE prevalence of NewProcessName from EID 4688 across all endpoints over 30 days
          IF prevalence < 1%, THEN ALERT
  - question: Are there anomalous clusters of process executions that could indicate unauthorized remote access tool usage?
    context: This question uses unsupervised machine learning to find unusual patterns of software execution. By clustering process events based on features like process name, parent, and user, it can automatically surface small, dense clusters that represent anomalous behavior, such as the isolated execution of a remote access tool by a user who does not normally run it.
    answer_sources:
      - Windows Event ID 4688
      - User workstations and laptops
      - Virtual Desktop Infrastructure (VDI) instances
      - Help desk operator consoles
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          CLUSTER process events (EID 4688) using features (process name, parent, user, cmd line length)
          INVESTIGATE small, dense clusters not matching known benign patterns
  - question: Has a command-line interpreter been used with obfuscated commands or arguments to download files or disable security?
    context: After gaining a foothold, often through a vishing call, an adversary may instruct the user to run commands to download further malware or weaken security controls. This question uses regular expressions to scan command-line and PowerShell script logs for common indicators of malicious activity, such as Base64 encoding, download strings, or commands that disable antivirus.
    answer_sources:
      - Windows Event ID 4688
      - Windows PowerShell Event ID 4104
      - User workstations
      - Laptops
      - Application servers
      - Domain Controllers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          SCAN command lines (EID 4688) and script blocks (EID 4104)
          FOR patterns like '-enc', 'DownloadString', 'IEX', 'Set-MpPreference -DisableRealtimeMonitoring'
          ALERT on match
  - question: Are there any command-line executions with unusually high entropy or length?
    context: Obfuscated commands are often longer and more random-looking than benign commands. This question establishes a baseline for command-line entropy and length per user and flags significant deviations. This statistical approach can uncover obfuscated payloads or complex commands used in attacks that might be missed by signature-based rules.
    answer_sources:
      - Windows Event ID 4688
      - Windows PowerShell Event ID 4104
      - User workstations
      - Laptops
      - Application servers
      - Domain Controllers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each cmd.exe/powershell.exe execution:
            CALCULATE entropy and length of command line
            IF entropy > 99th_percentile_baseline OR length > 3 * std_dev_baseline, THEN ALERT
  - question: Have any PowerShell script blocks been classified as malicious by a machine learning model?
    context: This question applies a trained machine learning classifier to analyze the content of PowerShell scripts as they are executed. This allows for the detection of malicious scripts based on their intrinsic features (e.g., function calls, keywords, character frequencies), providing a powerful defense against novel or heavily obfuscated PowerShell-based attacks.
    answer_sources:
      - Windows Event ID 4688
      - Windows PowerShell Event ID 4104
      - User workstations
      - Laptops
      - Application servers
      - Domain Controllers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each new PowerShell script block (EID 4104):
            SCORE script with trained_classifier_model
            IF score > malicious_confidence_threshold, THEN ALERT
  - question: Has a user visited a suspicious website, downloaded a file, and executed it in a short time frame?
    context: This question correlates events across different data sources to detect a common attack chain following a vishing call: a user is directed to a site, downloads a malicious file (e.g., an executable or zip), and runs it. A stateful rule identifies this specific sequence, connecting network activity to endpoint execution.
    answer_sources:
      - Zeek http.log
      - Zeek files.log
      - Windows Event ID 4688
      - User workstations and laptops
      - Network egress points (e.g., web proxies)
      - Cloud storage sync folders
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          CORRELATE by hostname over 5 minutes:
          1. http.log event to suspicious_domain
          2. files.log event for executable/archive MIME type
          3. EID 4688 event from user_path for downloaded_filename
          ALERT on sequence match
  - question: Are there any rare process lineage chains involving a browser or communication client?
    context: A vishing attacker might trick a user into clicking a link in an email or chat that leads to malware execution. This question identifies such scenarios by looking for statistically rare process parent-child relationships, such as a browser (chrome.exe) or email client (outlook.exe) spawning a process that then executes a downloaded file.
    answer_sources:
      - Zeek http.log
      - Zeek files.log
      - Windows Event ID 4688
      - User workstations and laptops
      - Network egress points (e.g., web proxies)
      - Cloud storage sync folders
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          ANALYZE parent-child process relationships
          IF (parent is browser OR email_client) AND (sequence is rare < 0.1% of all sequences), THEN ALERT
  - question: Has a user exhibited a sequence of actions that is anomalous compared to their normal behavior?
    context: This question uses a sequence analysis model (like an LSTM) to learn a user's typical patterns of activity (web browsing, file downloads, process executions). The model can then detect when a new sequence of events deviates significantly from the user's established baseline, flagging it as a potential anomaly caused by an attacker's influence.
    answer_sources:
      - Zeek http.log
      - Zeek files.log
      - Windows Event ID 4688
      - User workstations and laptops
      - Network egress points (e.g., web proxies)
      - Cloud storage sync folders
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          MODEL user behavior with sequence analysis (LSTM) on events (web, file, process)
          SCORE new event sequences against the model
          IF anomaly_score is high, THEN ALERT
  - question: Has a user account experienced a burst of failed MFA challenges followed by a success?
    context: This question is designed to detect an "MFA fatigue" or "MFA bombing" attack, a common follow-up to vishing where an attacker who has stolen credentials repeatedly triggers MFA push notifications until the victim finally accepts one. The SIEM rule looks for this specific pattern of multiple denials followed by a success.
    answer_sources:
      - Azure AD Sign-in logs
      - Duo Authentication logs
      - Okta System Log
      - Windows Event ID 4624
      - Cloud identity provider platforms (e.g., Azure AD, Okta)
      - VPN concentrators
      - On-premise Active Directory Federation Services (ADFS)
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR a single user, within a 2-minute window:
          COUNT MFA 'denied' or 'timeout' events
          IF count > 5 AND is immediately followed by MFA 'success' event, THEN ALERT
  - question: Has a user experienced an anomalous spike in MFA prompts from a new geographic location?
    context: This question uses statistical analysis to detect unusual MFA activity. It baselines the normal rate and location of MFA prompts for each user and alerts on significant deviations (e.g., a sudden spike in volume or a successful login from a country the user has never logged in from before), which could indicate an MFA fatigue attack.
    answer_sources:
      - Azure AD Sign-in logs
      - Duo Authentication logs
      - Okta System Log
      - Windows Event ID 4624
      - Cloud identity provider platforms (e.g., Azure AD, Okta)
      - VPN concentrators
      - On-premise Active Directory Federation Services (ADFS)
    range: last 30 days
    queries:
      - technology: pseudocode
        query: |
          BASELINE MFA prompt rate and location per user
          DETECT spikes in volume (> 3 std dev)
          IF spike occurs and successful login is from new/rare country/ASN, THEN ALERT
  - question: Does a user's MFA activity deviate from their normal, time-based authentication patterns?
    context: This question employs a time-series model to learn the "rhythm" of a user's authentications (e.g., typical login times on weekdays vs. weekends). The model can then identify an MFA event sequence that is a statistical outlier from the user's predicted pattern, indicating a potential MFA fatigue attack occurring at an unusual time.
    answer_sources:
      - Azure AD Sign-in logs
      - Duo Authentication logs
      - Okta System Log
      - Windows Event ID 4624
      - Cloud identity provider platforms (e.g., Azure AD, Okta)
      - VPN concentrators
      - On-premise Active Directory Federation Services (ADFS)
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          MODEL MFA event time-series per user (e.g., with SARIMA)
          ALERT on any event sequence that is a statistically significant outlier from the predicted pattern
  - question: Has a compromised endpoint established a long-lived or high-volume connection over a non-standard port to a new IP address?
    context: After compromise, an attacker needs to establish a command and control (C2) channel. This question looks for network connections that are characteristic of C2: long duration, high data volume, use of non-standard ports, and communication with an IP address never before seen in the organization's traffic.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Zeek ssl.log
      - Network egress points (e.g., firewalls, web proxies)
      - User workstations and laptops
      - Server subnets
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          SEARCH conn.log for outbound connections WHERE destination_ip is new (last 90 days)
          AND duration > 3600s AND destination_port NOT IN {80, 443, 53}
          CORRELATE with recent endpoint alerts for the source host
  - question: Are there any outbound connections from an internal host that exceed its normal behavior for duration, volume, or TLS fingerprint?
    context: This question detects C2-like network behavior by baselining what is "normal" for each specific host. It flags any new connection that exceeds the host's typical connection duration or data volume. It adds another layer of detection by flagging connections that use a rare TLS client fingerprint (JA3/JA3S), which can indicate the use of non-standard or malicious client software.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Zeek ssl.log
      - Network egress points (e.g., firewalls, web proxies)
      - User workstations and laptops
      - Server subnets
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          BASELINE per-host 99th percentile for connection duration and bytes_transferred
          ALERT if new connection exceeds host baseline
          FLAG connections with rare JA3/JA3S hash (<0.01% prevalence)
  - question: Are there any anomalous network sessions detected by an autoencoder model?
    context: This question uses an autoencoder, a type of neural network, to learn a deep representation of "normal" network connections. The model is trained on benign traffic. Any new connection that the model cannot reconstruct accurately (i.e., has a high reconstruction error) is flagged as an anomaly, potentially indicating a novel or stealthy C2 channel.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Zeek ssl.log
      - Network egress points (e.g., firewalls, web proxies)
      - User workstations and laptops
      - Server subnets
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          TRAIN autoencoder on feature vectors from conn.log sessions
          PROCESS new connections through the model
          IF reconstruction_error is high, THEN ALERT and investigate