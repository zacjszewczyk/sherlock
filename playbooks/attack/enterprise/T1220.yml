name: T1220: XSL Script Processing
id: 3c8e4f1a-5b21-4f8e-a9b1-2c9d8e7f6a5b
description: Investigates whether an adversary is evading defenses by executing malicious scripts embedded in XSL files. This involves looking for wmic.exe or msxsl.exe initiating outbound network connections to malicious hosts, wmic.exe using the /FORMAT switch with remote or temporary files, msxsl.exe processing files with non-standard extensions, these processes being spawned by unusual parents like Office applications, and subsequent command-and-control network activity following their execution.
type: technique
related:
  - TA0005: Defense Evasion
contributors:
  - Zachary Szewczyk
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Are wmic.exe or msxsl.exe making network connections to known malicious destinations?
    context: This question seeks to identify high-confidence threats by correlating process execution with network activity. When wmic.exe or msxsl.exe, tools that can process XSL scripts, connect to an IP or domain listed in a threat intelligence feed as a malware C2 or script hosting site, it is a strong indicator of compromise.
    answer_sources:
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - Sysmon Event ID 3
      - Zeek conn.log
      - Zeek http.log
      - Zeek dns.log
      - Network perimeter firewalls
      - outbound web proxies
      - corporate DNS resolvers
      - all Windows workstations and servers
      - Threat Intelligence Feeds
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          JOIN (process_logs WHERE process_name IN ('wmic.exe', 'msxsl.exe'))
          WITH (network_logs) ON (host, time)
          WHERE destination_ip OR destination_domain IN (threat_intelligence_feed)
  - question: Are wmic.exe or msxsl.exe connecting to statistically rare domains within the enterprise?
    context: Adversaries often use newly created or specialized domains for C2 that are not widely accessed by legitimate users. This question aims to uncover these potentially malicious connections by identifying domains that are statistical outliers (least frequently visited) across the organization, even if they are not yet on a threat intelligence feed.
    answer_sources:
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - Sysmon Event ID 3
      - Zeek conn.log
      - Zeek http.log
      - Zeek dns.log
      - Network perimeter firewalls
      - outbound web proxies
      - corporate DNS resolvers
      - all Windows workstations and servers
    range: last 30 days
    queries:
      - technology: pseudocode
        query: |
          CALCULATE rarity of destination_domain for connections from 'wmic.exe' or 'msxsl.exe' over 30 days.
          FLAG domains in the bottom 1st percentile of access frequency.
  - question: Can a machine learning model identify high-risk network connections made by wmic.exe or msxsl.exe?
    context: This question leverages a supervised machine learning model to assign a risk score to network connections from XSL script processors. By analyzing a combination of features like IP reputation, TLS fingerprint (JA3/JA3S), domain name entropy, and domain age, the model can detect subtle patterns of maliciousness that might be missed by symbolic or statistical methods alone.
    answer_sources:
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - Sysmon Event ID 3
      - Zeek conn.log
      - Zeek http.log
      - Zeek dns.log
      - Zeek ssl.log
      - Network perimeter firewalls
      - outbound web proxies
      - corporate DNS resolvers
      - all Windows workstations and servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          APPLY supervised classification model to network connections from 'wmic.exe' or 'msxsl.exe'.
          FEATURES: destination_ip_reputation, ja3_hash, ja3s_hash, domain_entropy, domain_age, url_query_parameters.
          ALERT on high risk_score.
  - question: Is wmic.exe being used to execute a remote XSL script or one from a suspicious local directory?
    context: The /FORMAT switch in wmic.exe can be abused to fetch and execute XSL scripts from a URL (http or https) or a local file. This question looks for direct evidence of this abuse by flagging executions where the script source is a remote location or a user-writable/temporary directory, which are common staging areas for malware.
    answer_sources:
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - All Windows workstations and servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          SEARCH process_logs for process_name='wmic.exe' AND command_line contains '/FORMAT:'.
          ALERT if command_line contains '/FORMAT:http' OR '/FORMAT:https' OR path matches user/temp directories.
  - question: Does the file path used with wmic.exe's /FORMAT switch have unusually high entropy?
    context: To evade simple signature-based detections, malware often uses randomized file names for its components. This question attempts to detect such evasion by calculating the character entropy of the file path provided to the /FORMAT switch. A path with abnormally high entropy suggests an obfuscated or randomly generated name, warranting investigation.
    answer_sources:
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - All Windows workstations and servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each 'wmic.exe /FORMAT' execution:
            CALCULATE entropy of the file path argument.
          ALERT on executions where entropy is in the top 5th percentile of the baseline.
  - question: Can an unsupervised anomaly detection model find abnormal executions of wmic.exe?
    context: This question uses an unsupervised model, like Isolation Forest, to find wmic.exe executions that deviate from established normal behavior without relying on predefined rules. The model analyzes features like the parent process, command-line length, and file path characteristics to flag executions that are statistical outliers, which could represent novel or unknown attack patterns.
    answer_sources:
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - All Windows workstations and servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          APPLY unsupervised anomaly detection model to 'wmic.exe' executions.
          FEATURES: parent_process, cmd_length, cmd_special_chars, has_url_flag, is_temp_path_flag.
          ALERT on strong outliers.
  - question: Is msxsl.exe being executed with suspicious arguments, such as remote files or non-standard file extensions?
    context: This question seeks to identify blatant misuse of msxsl.exe. Since this tool is not installed by default on Windows, its mere presence is suspicious. This is compounded when it's executed to process remote scripts (via http/https) or to process files disguised with benign extensions (e.g., .txt, .jpeg) instead of the expected .xml or .xsl. We also check the file hash to ensure it's not a masquerading binary.
    answer_sources:
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - Zeek conn.log
      - File systems of all Windows workstations and servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          SEARCH process_logs for process_name='msxsl.exe'.
          ALERT if command_line contains 'http://' or 'https://'.
          ALERT if argument file extension is NOT '.xml' or '.xsl'.
          ALERT if process_hash is not a known-good hash.
  - question: Which hosts have the non-standard msxsl.exe binary, and what are its parent processes?
    context: Given that msxsl.exe is not a default Windows utility, its presence on a host is a strong anomaly. This question focuses on inventorying all systems where msxsl.exe exists for investigation. For systems where its presence might be authorized, it establishes a baseline of normal parent processes, flagging any deviation (e.g., being spawned by an Office application) as highly suspicious.
    answer_sources:
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - Zeek conn.log
      - File systems of all Windows workstations and servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          REPORT all hosts with 'msxsl.exe' present on filesystem.
          For authorized hosts, BASELINE normal parent processes.
          ALERT on any parent process not in the baseline (e.g., 'outlook.exe', 'winword.exe').
  - question: Is there an anomalous spike in the enterprise-wide execution count of msxsl.exe?
    context: A sudden increase in the number of msxsl.exe executions across the organization could signal a widespread, coordinated attack campaign. This question uses a time-series forecasting model to predict the expected number of daily executions. An alert is generated if the actual count significantly exceeds the forecast, allowing security teams to quickly identify and respond to a potential mass infection.
    answer_sources:
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - Zeek conn.log
      - File systems of all Windows workstations and servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          MODEL daily count of 'msxsl.exe' executions using time-series forecast (e.g., ARIMA).
          ALERT if observed count significantly exceeds the forecasted confidence interval.
  - question: Are wmic.exe or msxsl.exe being launched by suspicious parent processes like Office applications or script interpreters?
    context: Legitimate use of wmic.exe or msxsl.exe is typically initiated by administrators, developers, or system scripts. This question looks for a common adversary pattern where a user is tricked into opening a malicious document or script, causing an application like Word, Excel, or mshta.exe to spawn these tools to execute a malicious payload. Such a parent-child relationship is a strong indicator of compromise.
    answer_sources:
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - User workstations
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          SEARCH process_logs where child_process is 'wmic.exe' or 'msxsl.exe'.
          ALERT if parent_process is in ('winword.exe', 'excel.exe', 'powerpnt.exe', 'outlook.exe', 'mshta.exe', 'cscript.exe', 'wscript.exe').
  - question: Are there any rare or new parent-child process relationships involving wmic.exe or msxsl.exe?
    context: Adversaries may use novel or less common parent processes to launch their tools, which might not be covered by a static list. This question takes a statistical approach by baselining all parent-child process relationships over time. It flags any execution of wmic.exe or msxsl.exe that originates from a parent process never seen before, or seen very infrequently, highlighting potentially new or evasive techniques.
    answer_sources:
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - User workstations
    range: last 30 days
    queries:
      - technology: pseudocode
        query: |
          BASELINE all parent-child process pairs over 30 days.
          FOR new executions of 'wmic.exe' or 'msxsl.exe':
            ALERT if the parent-child pair is new or has a frequency in the 1st percentile.
  - question: Can graph-based analysis identify anomalous process execution chains leading to wmic.exe or msxsl.exe?
    context: Process activity can be modeled as a graph, where processes are nodes and parent-child relationships are edges. This question applies graph-based anomaly detection to identify entire execution chains that are structurally unusual. For example, a chain starting from an email client, to a browser, to a command shell, and finally to wmic.exe would be flagged as an anomalous path compared to normal system activity.
    answer_sources:
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - User workstations
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          MODEL process activity as a graph (nodes=processes, edges=parent-child links).
          APPLY graph anomaly detection algorithm.
          ALERT on anomalous paths leading to 'wmic.exe' or 'msxsl.exe'.
  - question: Following a suspicious wmic.exe or msxsl.exe execution, does the host make a direct-to-IP connection on a non-standard port?
    context: After a payload is executed via XSL script processing, the next step is often to establish a command and control (C2) channel. This question looks for a specific, high-confidence indicator of C2 an outbound network connection made directly to an IP address (bypassing DNS) on a port not typically used for web traffic, occurring within five minutes of the initial suspicious process execution.
    answer_sources:
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - Sysmon Event ID 3
      - Zeek conn.log
      - Zeek files.log
      - Network egress points
      - host-based network monitoring on endpoints
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          TRIGGER on suspicious 'wmic.exe' or 'msxsl.exe' execution.
          MONITOR host for 5 minutes.
          ALERT if host initiates outbound connection to a raw IP on a non-standard port.
  - question: After a suspicious XSL execution, does the host's network traffic exhibit statistical signs of C2 beaconing or data exfiltration?
    context: C2 traffic often has statistical properties that distinguish it from normal user traffic. This question looks for two such properties following a suspicious XSL execution robotic, periodic callbacks (beaconing), identified by a near-zero standard deviation in time between connections to a single destination, and high-entropy data transfers, which can indicate encrypted or packed data being exfiltrated.
    answer_sources:
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - Sysmon Event ID 3
      - Zeek conn.log
      - Zeek files.log
      - Network egress points
      - host-based network monitoring on endpoints
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          ON host with suspicious XSL execution:
            CALCULATE standard deviation of time between connections to a single destination; ALERT if near zero.
            CALCULATE entropy of connection payload; ALERT if above threshold.
  - question: Does a host's network behavior deviate significantly from its normal baseline after a suspicious XSL execution?
    context: This question uses an autoencoder, a type of unsupervised machine learning model, to learn a baseline of a host's normal network activity. After a suspicious XSL execution event, the model analyzes the host's subsequent network traffic. If the traffic patterns (e.g., bytes sent/received, protocols used) are significantly different from the learned baseline, resulting in a high reconstruction error, it signals an anomaly potentially related to C2 or data exfiltration.
    answer_sources:
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - Sysmon Event ID 3
      - Zeek conn.log
      - Zeek files.log
      - Network egress points
      - host-based network monitoring on endpoints
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          ON host with suspicious XSL execution:
            APPLY autoencoder model trained on host's normal network behavior.
            ALERT if reconstruction error for current traffic is high.