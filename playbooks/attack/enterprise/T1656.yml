name: T1656: Impersonation
id: f47ac10b-58cc-4372-a567-0e02b2c3d479
description: This playbook helps determine if an adversary is impersonating a trusted person or organization to persuade a user to perform an action on their behalf. This is investigated by checking for inbound emails from sources on threat intelligence feeds, emails with display names matching high-value internal targets but originating from external, unapproved domains, and emails from typosquatted domains. The playbook also looks for emails with high-urgency keywords or risky attachments targeting sensitive roles, and monitors for compromised internal accounts sending emails that deviate from established behavioral baselines, especially after an unusual login.
type: technique
related:
  - TA0005: Defense Evasion
contributors: Zachary Szewczyk, Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Has an inbound email originated from an IP, contained a domain, or included a URL that is known to be malicious based on threat intelligence?
    context: This question aims to detect direct communication from known malicious infrastructure. By correlating email, DNS, and HTTP logs and comparing indicators (source IP, requested domains, URLs) against a threat intelligence feed, analysts can quickly identify phishing or malware delivery attempts that leverage previously identified adversary assets. A match provides a high-confidence signal of malicious intent.
    answer_sources:
      - Zeek smtp.log
      - Zeek dns.log
      - Zeek http.log
      - Threat Intelligence Feed
      - Email Gateway
      - DNS Resolvers
      - Web Proxy
      - Threat Intelligence Platform
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: SEARCH smtp_logs, dns_logs, http_logs | JOIN by session_id | WHERE smtp.source_ip IN threat_intel_feed OR dns.query IN threat_intel_feed OR http.host IN threat_intel_feed OR http.uri IN threat_intel_feed | ALERT high_severity
  - question: Has an email been received from a suspicious, newly registered domain that has been seen very rarely in the past?
    context: Adversaries often use newly registered domains (NRDs) for short-lived campaigns. While an NRD isn't inherently malicious, its combination with low communication frequency can signal a targeted attack rather than a broad spam campaign. This question identifies these rare and risky domains to uncover potential spearphishing attempts that might otherwise be missed.
    answer_sources:
      - Zeek smtp.log
      - Zeek dns.log
      - Zeek http.log
      - Threat Intelligence Feed
      - Email Gateway
      - DNS Resolvers
      - Web Proxy
      - Threat Intelligence Platform
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: SEARCH smtp_logs over 90d | FILTER sender_domain IN grey_list | CALCULATE frequency of sender_domain | IF frequency < 5th_percentile_historical_frequency | ALERT
  - question: Does an incoming email exhibit a combination of risky characteristics that result in a high maliciousness score from a machine learning model?
    context: This question leverages a machine learning model to perform a holistic risk assessment of an email. Instead of relying on a single indicator, the model considers multiple features (e.g., sender reputation, domain age, email authentication status, threat intel matches) in concert. A high score suggests that the email has numerous suspicious attributes, warranting an analyst's review for a potential sophisticated impersonation attempt.
    answer_sources:
      - Zeek smtp.log
      - Zeek dns.log
      - Zeek http.log
      - Threat Intelligence Feed
      - Email Gateway
      - DNS Resolvers
      - Web Proxy
      - Threat Intelligence Platform
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: FOR each inbound_email | EXTRACT features (IP_reputation, domain_age, SPF/DKIM/DMARC_results, threat_feed_match) | APPLY classification_model | IF score > 0.85 | ALERT for_review
  - question: Has an email been received from an external, unapproved domain that is impersonating the display name of a high-value internal user (e.g., a C-suite executive)?
    context: This is a classic business email compromise (BEC) technique. Adversaries impersonate executives or other key personnel to create a sense of authority and urgency. This question specifically looks for this tactic by checking if an email's "From" display name matches a high-value target while the sending domain is not the organization's own or a trusted partner's, indicating a likely impersonation attempt.
    answer_sources:
      - Zeek smtp.log
      - Internal Identity List
      - Email Gateway
      - Directory Services
      - HR Information System
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: SEARCH smtp_logs | PARSE display_name from from_header | IF display_name IN high_value_watchlist AND sender_domain NOT IN (internal_domain, partner_domains) | ALERT high_severity
  - question: For an email impersonating an executive's display name, is there a significant mismatch between the display name and the local-part of the sender's email address?
    context: When impersonating a user, adversaries may create email addresses that are similar but not identical to the target's name (e.g., display name 'John Smith', address 'j.smith.84@example.com'). This question quantifies that mismatch using Levenshtein distance. By comparing this distance to a baseline of legitimate emails, it can flag outliers that suggest the sender address was algorithmically or carelessly generated for an impersonation campaign.
    answer_sources:
      - Zeek smtp.log
      - Internal Identity List
      - Email Gateway
      - Directory Services
      - HR Information System
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: SEARCH smtp_logs where display_name IN executive_list | CALCULATE levenshtein_distance(display_name, local_part_of_sender_address) | IF distance > 95th_percentile_of_baseline | ALERT
  - question: Are there small, isolated clusters of inbound emails with similar display names, sender domains, and TLDs that are distinct from normal email traffic?
    context: This question uses unsupervised machine learning to find the "unknown unknowns." A coordinated impersonation campaign might use a set of similar, but not identical, sender attributes. A clustering algorithm can group these emails together based on their shared features, revealing them as a distinct, anomalous cluster separate from the large, diverse cluster of legitimate mail. This helps detect campaigns without prior knowledge of the specific indicators.
    answer_sources:
      - Zeek smtp.log
      - Internal Identity List
      - Email Gateway
      - Directory Services
      - HR Information System
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: EXTRACT features (display_name, sender_domain, TLD) from smtp_logs | APPLY DBSCAN_clustering | IDENTIFY small, dense, outlier_clusters | ALERT
  - question: Has an email been received from a domain that is visually very similar (1-2 characters different) to the organization's own domain or a trusted partner's domain?
    context: Typosquatting is a form of impersonation where an adversary registers a domain that is a slight misspelling of a legitimate one (e.g., 'asksage.co' vs. 'asksaqe.co'). This question aims to detect these attempts by systematically calculating the Levenshtein distance (a measure of string difference) between all unapproved sender domains and a list of approved internal and partner domains. A small distance is a strong indicator of a typosquatting attack.
    answer_sources:
      - Zeek smtp.log
      - Zeek dns.log
      - Approved Domain List
      - Email Gateway
      - DNS Resolvers
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: GET unique sender_domains from smtp_logs | FOR each domain NOT IN approved_list | CALCULATE levenshtein_distance(domain, approved_domains) | IF min_distance <= 2 | ALERT medium_severity
  - question: Does a sender domain have a high risk score based on a combination of its rarity and its similarity to a legitimate domain?
    context: This question combines two key risk factors into a single score to identify the most suspicious domains. A domain is considered high-risk if it is both rarely seen (high $$ 1/f $$) and very similar to a trusted domain (high $$ 1/d $$). By flagging domains with scores in the top percentile, analysts can focus on the threats that are most likely to be targeted typosquatting attacks, rather than common spam. The weights $$ w_1 $$ and $$ w_2 $$ allow customization of the scoring based on organizational risk tolerance.
    answer_sources:
      - Zeek smtp.log
      - Zeek dns.log
      - Approved Domain List
      - Email Gateway
      - DNS Resolvers
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: FOR each sender_domain | GET frequency (f) and min_levenshtein_distance (d) to approved_domains | CALCULATE risk_score R = w1*(1/f) + w2*(1/d) | IF R > 98th_percentile_of_scores | ALERT
  - question: Does a new, previously unseen sender domain deviate significantly from the characteristics of known, legitimate domains?
    context: This question uses anomaly detection to identify suspicious domains without relying on predefined rules. A one-class SVM model is trained to understand what "normal" sender domains look like based on features like character patterns and structure. Any new domain that doesn't fit this learned profile is flagged as an outlier. This is effective for catching novel typosquatting variations and other domain impersonation techniques that might evade simpler checks.
    answer_sources:
      - Zeek smtp.log
      - Zeek dns.log
      - Approved Domain List
      - Email Gateway
      - DNS Resolvers
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: TRAIN one_class_svm_model on features from legitimate_domains | FOR each new_sender_domain | EXTRACT features | APPLY model | IF model_classifies_as_outlier | ALERT for_review
  - question: Has an email been received that uses high-urgency language in the subject or contains a high-risk attachment type, especially if sent to a user in a sensitive role?
    context: Adversaries often use social engineering tactics, such as creating a false sense of urgency or luring users with seemingly important documents, to compel them to act. This question looks for these common indicators subjects with keywords like 'urgent' or 'invoice', and dangerous attachment types often used to deliver malware. The risk is considered even higher if the recipient is in a sensitive department like finance or HR, making the alert more targeted and actionable.
    answer_sources:
      - Zeek smtp.log
      - Zeek files.log
      - Email Body Content
      - Email Gateway
      - Endpoint Devices
      - File Servers
      - Mail Content Inspection System
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: SEARCH smtp_logs, files_logs | JOIN by session_id | IF (smtp.subject MATCHES keyword_list) OR (files.filename MATCHES risky_extension_list) | IF smtp.recipient IN sensitive_roles_group | ALERT high_severity | ELSE ALERT medium_severity
  - question: Does an inbound email's subject line have an unusual level of randomness or simplicity compared to the baseline for the recipient's department?
    context: Legitimate email subjects within a department often follow certain patterns. Malicious emails can deviate from these patterns by being either overly simplistic (e.g., "Urgent") or randomly generated to bypass filters. Shannon entropy measures this level of randomness. By establishing a normal baseline for each department and alerting on significant deviations, this question can uncover emails with suspicious subject lines that might indicate a phishing attempt.
    answer_sources:
      - Zeek smtp.log
      - Zeek files.log
      - Email Body Content
      - Email Gateway
      - Endpoint Devices
      - File Servers
      - Mail Content Inspection System
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: FOR each department | CALCULATE baseline_entropy of subject_lines from smtp_logs | FOR each new_inbound_email | CALCULATE subject_entropy | IF entropy > (mean_entropy + 3 * stdev) | ALERT
  - question: Has an email with content classified as high-risk (e.g., financial request, credential harvesting) been received from a low-reputation external source?
    context: This question moves beyond simple keywords to understand the actual intent of an email's content using Natural Language Processing (NLP). An NLP model can analyze the text to determine if it's trying to solicit a wire transfer, steal credentials, or perform another malicious action. When this high-risk intent is combined with a sender from an untrusted, low-reputation domain, it creates a very strong signal of a targeted impersonation or BEC attack.
    answer_sources:
      - Zeek smtp.log
      - Zeek files.log
      - Email Body Content
      - Email Gateway
      - Endpoint Devices
      - File Servers
      - Mail Content Inspection System
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: FOR each inbound_email | ANALYZE body_content with NLP_model | GET intent_classification | IF intent IN ('financial_request', 'credential_harvest') AND sender_reputation == 'low' | ALERT high_severity
  - question: Did a user account send a large volume of external email shortly after a successful login from an unusual or untrusted network location?
    context: This question correlates authentication events with email activity to detect account takeovers. A successful login from an anomalous source (like an IP address belonging to an untrusted Autonomous System Number) immediately followed by atypical behavior, such as an email blast to many recipients, is a strong indicator that an adversary has compromised the account and is using it for internal phishing or spam.
    answer_sources:
      - Zeek smtp.log
      - Zeek conn.log
      - Windows Event ID 4624
      - Email Gateway
      - Authentication Servers
      - Endpoint Devices
      - VPN Concentrators
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: SEARCH for Windows_Event_ID_4624 from untrusted_ASN | IF followed_within 30_mins by outbound_smtp_log from same_user with recipient_count > 50 | ALERT
  - question: Is a user sending emails at a rate or to a number of recipients that is statistically abnormal compared to their own historical behavior?
    context: Every user has a unique email usage pattern. This question establishes a personalized baseline for each user's sending habits (e.g., emails per hour, recipients per email). By using a rolling 30-day window, the baseline adapts to changing roles and responsibilities. An alert is triggered only when a user's activity dramatically exceeds their own normal levels (e.g., hitting the 99th percentile), which is a strong indicator of an account compromise being used for malicious purposes.
    answer_sources:
      - Zeek smtp.log
      - Zeek conn.log
      - Windows Event ID 4624
      - Email Gateway
      - Authentication Servers
      - Endpoint Devices
      - VPN Concentrators
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: FOR each user | CALCULATE 30-day rolling_baseline (avg_recipients, avg_emails_per_hour) from smtp_logs | FOR each hour | CHECK current_activity | IF current_recipients > 99th_percentile OR current_emails_sent > 99th_percentile | ALERT
  - question: Is a user's current email sending volume significantly different from what a time-series model would have predicted based on their past activity?
    context: This question employs a more sophisticated form of behavioral analysis. A time-series forecasting model learns a user's complex sending patterns, including daily and weekly cycles. It then predicts an expected range of activity for any given hour. If the user's actual activity falls far outside this predicted range, it signifies a major break from their established routine, which could be caused by an account compromise. This method is effective at detecting anomalies that simpler percentile-based methods might miss.
    answer_sources:
      - Zeek smtp.log
      - Zeek conn.log
      - Windows Event ID 4624
      - Email Gateway
      - Authentication Servers
      - Endpoint Devices
      - VPN Concentrators
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: FOR each user | TRAIN time_series_model (ARIMA) on hourly_email_volume from smtp_logs | FOR each hour | PREDICT expected_volume_range | GET actual_volume | IF actual_volume is outside prediction_interval | ALERT