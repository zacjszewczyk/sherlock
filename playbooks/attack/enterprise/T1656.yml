name: T1656: Impersonation
id: d3a4b9c1-8e7f-4b0a-9c8d-6e5f4a3b2c1d
description: This playbook helps determine if an adversary is impersonating a trusted person or organization to persuade a user to perform an action on their behalf. This involves investigating inbound emails for signs of impersonation, such as malicious indicators from threat intelligence, spoofed display names of high-value internal identities, typosquatted domains, high-urgency language, suspicious attachments, or anomalous sending behavior from potentially compromised internal accounts.
type: technique
related:
- TA0005: Defense Evasion
contributors:
- Zachary Szewczyk
- Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
- question: Has an inbound email's source IP, sender domain, or an embedded URL been matched against a known malicious indicator from a threat intelligence feed?
  context: This question aims to identify direct threats by cross-referencing incoming email traffic with curated lists of known malicious infrastructure. A match provides a high-confidence signal that the email is part of a known attack campaign, allowing for rapid response. The query joins email, DNS, and web logs by session ID to create a comprehensive view of the communication chain initiated by the email.
  answer_sources:
  - Zeek smtp.log
  - Zeek dns.log
  - Zeek http.log
  - Threat Intelligence Feed
  - Email Gateway
  - DNS Resolvers
  - Web Proxy
  - Threat Intelligence Platform
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      JOIN smtp.log, dns.log, http.log ON session_id
      WHERE smtp.source_ip IN threat_feed_ips
      OR dns.query IN threat_feed_domains
      OR http.host IN threat_feed_domains
      ALERT with HIGH severity
- question: Has an email been received from a risky domain (e.g., newly registered) that is also rare in the organization's email history?
  context: This question seeks to uncover targeted attacks that use domains not yet on definitive blacklists but exhibiting risky characteristics, like being newly registered. By identifying domains that are both on a 'grey' list and have a very low communication frequency, we can pinpoint potential spear-phishing attempts that might otherwise be missed. This combination of risk and rarity is a strong indicator of a targeted threat.
  answer_sources:
  - Zeek smtp.log
  - Zeek dns.log
  - Zeek http.log
  - Threat Intelligence Feed
  - Email Gateway
  - DNS Resolvers
  - Web Proxy
  - Threat Intelligence Platform
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR each sender_domain in smtp.log over last 90 days:
        IF sender_domain IN grey_list_domains:
          CALCULATE frequency of sender_domain
          IF frequency < 5th_percentile_of_all_domain_frequencies:
            FLAG for review
- question: Can incoming emails be scored for impersonation risk based on a combination of technical indicators?
  context: This question proposes a machine learning approach to detect sophisticated impersonation attempts. By creating a model that scores emails based on features like sender reputation, domain age, email authentication results (SPF/DKIM/DMARC), and threat intelligence matches, the system can dynamically flag suspicious emails that might not trigger any single, static rule. This provides a more resilient and adaptive defense against evolving attacker techniques.
  answer_sources:
  - Zeek smtp.log
  - Zeek dns.log
  - Zeek http.log
  - Threat Intelligence Feed
  - Email Gateway
  - DNS Resolvers
  - Web Proxy
  - Threat Intelligence Platform
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR each inbound email:
        EXTRACT features (IP reputation, domain age, SPF/DKIM/DMARC status, threat feed match)
        INPUT features into classification model
        CALCULATE risk_score
        IF risk_score > 0.85:
          ALERT for analyst review
- question: Has an inbound email spoofed the display name of a high-value internal target while originating from an unapproved external domain?
  context: This question addresses a common spear-phishing tactic where an attacker impersonates a key internal figure, like a C-suite executive, to lend credibility to their request. By checking if an email with a sensitive display name comes from an external domain not on a pre-approved partner list, security teams can quickly identify and block these high-risk social engineering attempts.
  answer_sources:
  - Zeek smtp.log
  - Internal Identity List
  - Email Gateway
  - Directory Services
  - HR Information System
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR each inbound email in smtp.log:
        IF email.display_name IN high_value_watchlist
        AND email.sender_domain IS NOT internal_domain
        AND email.sender_domain NOT IN partner_domain_allowlist:
          ALERT with HIGH severity
- question: Is there a significant mismatch between an executive's display name and the sender's email address local-part?
  context: This question aims to detect subtle impersonation attempts where the display name is correct but the email address itself is slightly off. By calculating the string similarity (e.g., Levenshtein distance) between the display name and the email address local-part, and comparing it to a baseline, we can flag anomalies that suggest the sender is not who they claim to be, even if the domain is legitimate or looks similar.
  answer_sources:
  - Zeek smtp.log
  - Internal Identity List
  - Email Gateway
  - Directory Services
  - HR Information System
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR each email with executive_display_name:
        CALCULATE levenshtein_distance(display_name, local_part_of_email_address)
        IF distance > 95th_percentile_of_baseline_distances:
          FLAG for review
- question: Are there unusual clusters of inbound emails that suggest a coordinated impersonation campaign?
  context: This question uses unsupervised machine learning to find hidden attack patterns. By clustering inbound emails based on header features like display name, sender domain, and TLD, we can identify small, isolated groups of emails that are distinct from the bulk of legitimate mail. These outlier clusters often represent a targeted campaign from a single attacker infrastructure, allowing for proactive blocking.
  answer_sources:
  - Zeek smtp.log
  - Internal Identity List
  - Email Gateway
  - Directory Services
  - HR Information System
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      EXTRACT features (display_name, sender_domain, TLD) from smtp.log
      APPLY DBSCAN clustering algorithm to features
      IDENTIFY small, dense clusters separate from the main email cluster
      ALERT on outlier clusters
- question: Has an email been received from a domain that is a potential typosquat of the organization's domain or a partner's domain?
  context: This question is designed to detect typosquatting, a technique where attackers register domains that are visually similar to legitimate ones. By systematically calculating the Levenshtein distance between all unapproved incoming sender domains and a list of approved internal and partner domains, we can automatically flag domains that are only one or two characters different, which are highly likely to be malicious.
  answer_sources:
  - Zeek smtp.log
  - Zeek dns.log
  - Approved Domain List
  - Email Gateway
  - DNS Resolvers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR each sender_domain in smtp.log:
        IF sender_domain NOT IN approved_list:
          CALCULATE levenshtein_distance(sender_domain, all_approved_domains)
          IF min_distance is 1 or 2:
            ALERT with MEDIUM severity
- question: Can a risk score be calculated for new sender domains based on their rarity and similarity to legitimate domains?
  context: This question proposes a quantitative method for prioritizing the investigation of potentially malicious domains. By creating a risk score that combines the historical frequency of a domain (rarity) with its Levenshtein distance to known-good domains (typosquatting potential), analysts can focus on the highest-scoring domains, which represent the greatest risk of being part of a targeted impersonation attack.
  answer_sources:
  - Zeek smtp.log
  - Zeek dns.log
  - Approved Domain List
  - Email Gateway
  - DNS Resolvers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR each sender_domain:
        CALCULATE frequency_f = historical_frequency(sender_domain)
        CALCULATE distance_d = min_levenshtein_distance(sender_domain, approved_domains)
        CALCULATE risk_score = w1 * (1/f) + w2 * (1/d)
        IF risk_score > 98th_percentile_of_all_scores:
          FLAG for review
- question: Can a machine learning model identify new, unseen sender domains that are anomalous compared to legitimate domains?
  context: This question focuses on using anomaly detection to find novel impersonation attacks. By training a one-class SVM model on the characteristics of legitimate, frequently seen sender domains, the system can learn what "normal" looks like. Any new domain that the model classifies as an outlier is flagged for review, providing a powerful way to detect sophisticated typosquatting or other domain-based impersonation attempts that don't match simple rules.
  answer_sources:
  - Zeek smtp.log
  - Zeek dns.log
  - Approved Domain List
  - Email Gateway
  - DNS Resolvers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      TRAIN one-class SVM model on feature vectors from legitimate domains
      FOR each new sender_domain in smtp.log:
        EXTRACT feature vector
        PREDICT if domain is 'outlier' using trained model
        IF 'outlier':
          FLAG for analyst review
- question: Has an email been received that combines high-urgency keywords, a sensitive recipient, and a high-risk attachment type?
  context: This question looks for a convergence of high-risk indicators that strongly suggests a phishing attempt. An email using urgent language ('payment', 'invoice') sent to a user in a sensitive department (like finance) and carrying a dangerous attachment type (.iso, .html) is a classic combination used in business email compromise (BEC) and malware delivery. Alerting on this combination provides a high-fidelity signal of a likely attack.
  answer_sources:
  - Zeek smtp.log
  - Zeek files.log
  - Email Body Content
  - Email Gateway
  - Endpoint Devices
  - File Servers
  - Mail Content Inspection System
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR each email in smtp.log:
        IF (email.subject MATCHES urgent_keyword_list
            OR email.attachment_filename MATCHES high_risk_extensions)
            AND email.recipient IN sensitive_roles_group:
          ALERT with HIGH severity
- question: Is the subject line of an inbound email statistically unusual for the recipient's department?
  context: This question attempts to detect attacks by identifying anomalies in the complexity or structure of email subject lines. Attack campaigns often use either overly simplistic or algorithmically generated subject lines that deviate from normal human communication. By calculating the Shannon entropy of subject lines and comparing it to a departmental baseline, we can flag emails whose subjects are statistical outliers, indicating they may be part of an automated or unusual campaign.
  answer_sources:
  - Zeek smtp.log
  - Zeek files.log
  - Email Body Content
  - Email Gateway
  - Endpoint Devices
  - File Servers
  - Mail Content Inspection System
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      CALCULATE baseline Shannon entropy of subject lines per department
      FOR each new inbound email:
        CALCULATE shannon_entropy(email.subject)
        IF entropy > (mean_entropy_for_dept + 3 * std_dev):
          ALERT for review
- question: Does the content of an email from a low-reputation external source indicate malicious intent?
  context: This question leverages Natural Language Processing (NLP) to understand the purpose of an email's content. While keyword matching is useful, a pre-trained NLP model can analyze the full text to classify the sender's intent (e.g., 'Financial Request', 'Credential Harvest'). When a high-risk intent is detected in an email from an external, untrusted source, it provides a strong, context-aware signal of a sophisticated social engineering attack.
  answer_sources:
  - Zeek smtp.log
  - Zeek files.log
  - Email Body Content
  - Email Gateway
  - Endpoint Devices
  - File Servers
  - Mail Content Inspection System
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR each email from external, low-reputation domain:
        ANALYZE email body with NLP model
        CLASSIFY intent (e.g., 'Financial Request', 'Credential Harvest')
        IF intent is 'high-risk':
          ALERT with HIGH severity
- question: Is an internal user sending a high volume of emails shortly after an anomalous login event?
  context: This question aims to detect account takeover by correlating anomalous authentication with unusual email activity. An attacker who compromises an account will often log in from an unusual location (untrusted ASN) and then use the account to send internal phishing or spam. This correlation rule connects the suspicious login (Windows Event ID 4624) with the subsequent email blast, providing strong evidence of a compromised account.
  answer_sources:
  - Zeek smtp.log
  - Zeek conn.log
  - Windows Event ID 4624
  - Email Gateway
  - Authentication Servers
  - Endpoint Devices
  - VPN Concentrators
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      WHEN a Windows Event ID 4624 (Logon) from an untrusted ASN is seen:
        MONITOR user's email activity for 30 minutes
        IF user sends email with recipient count > 50 in that window:
          ALERT for account takeover
- question: Has a user's email sending behavior deviated significantly from their established personal baseline?
  context: This question focuses on detecting compromised accounts through behavioral anomaly detection specific to each user. Every user has a unique pattern of email usage (e.g., number of recipients, emails per hour). By establishing a 30-day rolling baseline for each person, the system can detect when their activity suddenly and dramatically exceeds their normal behavior (e.g., exceeding the 99th percentile), which is a strong indicator that their account has been compromised and is being used for malicious purposes.
  answer_sources:
  - Zeek smtp.log
  - Zeek conn.log
  - Windows Event ID 4624
  - Email Gateway
  - Authentication Servers
  - Endpoint Devices
  - VPN Concentrators
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR each user, maintain a 30-day rolling baseline of avg_recipients and emails_per_hour
      FOR each hour:
        IF user.current_recipients > 99th_percentile_baseline
        OR user.current_emails_sent > 99th_percentile_baseline:
          ALERT for anomalous activity
- question: Is a user's email sending volume no longer predictable based on their historical patterns?
  context: This question applies time-series forecasting to detect subtle account compromises. A forecasting model (like ARIMA) learns a user's normal rhythm of sending emails over time. When an attacker takes over, their activity (e.g., sending spam at 3 AM) will likely not fit this learned pattern. An alert is generated when the actual email volume falls significantly outside the model's prediction, indicating the account's behavior has changed in a way that suggests it is no longer controlled by the legitimate user.
  answer_sources:
  - Zeek smtp.log
  - Zeek conn.log
  - Windows Event ID 4624
  - Email Gateway
  - Authentication Servers
  - Endpoint Devices
  - VPN Concentrators
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR each user, train a time-series model (e.g., ARIMA) on hourly email volume
      FOR each hour:
        PREDICT expected email volume and confidence interval
        IF actual_volume is outside the prediction interval:
          ALERT for unpredictable behavior