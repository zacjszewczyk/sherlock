name: T1036.007: Double File Extension
id: a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d
description: This playbook addresses the threat of adversaries masquerading executable files using double extensions to evade defenses. It focuses on detecting files that match known malicious indicators or high-confidence signatures, identifying the creation of files with a benign-appearing first extension followed by an executable one (e.g., 'report.pdf.exe'), monitoring for processes launched from such files in high-risk directories like 'Downloads' or 'Temp', flagging network transfers of files with this double-extension pattern, and identifying subsequent anomalous behavior like persistence mechanism creation or unusual network connections initiated by these processes.
type: technique
related:
  - TA0005: Defense Evasion
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Has a file with a double extension been observed that matches a known malicious hash or a high-confidence threat intelligence signature?
    context: This question aims to identify definitive malicious activity by cross-referencing observed file hashes and filenames against curated threat intelligence. A match indicates a known threat is present in the environment, bypassing initial defenses, and requires immediate investigation to contain the potential breach.
    answer_sources:
      - Zeek files.log
      - Windows Event ID 4688
      - Windows Event ID 1 (Sysmon)
      - Windows Event ID 11 (Sysmon)
      - Network perimeter firewalls and web proxies, mail servers, and all enterprise workstations and servers.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH file creation and process execution logs WHERE (file_hash IN malicious_hash_feed) OR (filename IN malicious_filename_feed) and filename matches double_extension_pattern. RETURN hostname, user, process_name, file_hash, timestamp.
  - question: If a potentially malicious file with a double extension is found, does it originate from an uncommon source IP or parent process?
    context: This question adds risk context to an initial finding. A malicious file originating from a rare source (a new external IP or an unusual parent process) is more suspicious than one from a common source. Identifying low-prevalence origins helps prioritize alerts by flagging activity that deviates from established baselines, suggesting a targeted or novel attack vector.
    answer_sources:
      - Zeek files.log
      - Zeek conn.log
      - Windows Event ID 4688
      - Windows Event ID 1 (Sysmon)
      - Windows Event ID 11 (Sysmon)
      - Network perimeter firewalls and web proxies, mail servers, and all enterprise workstations and servers.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: GIVEN a source_ip or parent_process_name, COUNT occurrences over the last 90 days. COMPARE count against the distribution of all source IPs/parent processes. IF count is in the bottom 5th percentile, THEN increase alert priority.
  - question: Can we assign a risk score to unknown files with double extensions based on their characteristics to identify likely malicious activity?
    context: This question addresses the challenge of detecting novel threats that don't match known signatures. By using a machine learning model to score files based on features like filename entropy, file size, MIME type, and parent process, security teams can proactively identify suspicious files that exhibit malicious characteristics, even without a prior IOC match. A high score indicates the file warrants immediate review.
    answer_sources:
      - Zeek files.log
      - Windows Event ID 4688
      - Windows Event ID 1 (Sysmon)
      - Windows Event ID 11 (Sysmon)
      - Network perimeter firewalls and web proxies, mail servers, and all enterprise workstations and servers.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: FOR each new file with a double extension, EXTRACT features (entropy, size, MIME type, parent process). INPUT features into classification model. IF model_output_score > 0.85, THEN generate alert for review.
  - question: Has a file with a benign-appearing first extension and an executable second extension been created by a high-risk application like a browser, email client, or archive utility?
    context: This question focuses on a common delivery vector for malware. Legitimate applications like browsers or email clients should not typically create executable files disguised as documents or images. Detecting such an event is a strong indicator of a user being tricked into downloading or opening a malicious file from the web or an email attachment.
    answer_sources:
      - Windows Event ID 11 (Sysmon)
      - Windows Event ID 1 (Sysmon)
      - User profile directories (e.g., Downloads, Temp, AppData), application cache folders, and removable media drives.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH file creation or process creation logs WHERE (filename MATCHES regex '.*\.(txt|pdf|jpg|...)\.(exe|scr|bat|...)$') AND (parent_process IN ['chrome.exe', 'outlook.exe', '7z.exe', ...]). GENERATE high-severity alert.
  - question: Has a monitored parent process, such as a web browser, started creating files with unusual or statistically rare double-extension patterns?
    context: This question seeks to detect anomalies in file creation behavior for specific applications. By baselining the normal types of files created by a process (e.g., 'chrome.exe'), a sudden deviation, such as the appearance of a rare '.pdf.exe' file type or a spike in the variety of extensions, can signal a new attack campaign or a compromised application. It helps find the 'unknown unknowns' in file-based threats.
    answer_sources:
      - Windows Event ID 11 (Sysmon)
      - Windows Event ID 1 (Sysmon)
      - User profile directories (e.g., Downloads, Temp, AppData), application cache folders, and removable media drives.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: FOR each parent_process, CALCULATE baseline of file extension types created. MONITOR for new file creation events. IF a created file's extension pattern is a statistical outlier (>3 std dev from mean frequency) for its parent_process, GENERATE medium-severity alert.
  - question: Is there a sudden, anomalous spike in the volume of files with double extensions being created by a high-risk application, suggesting a large-scale attack?
    context: This question aims to identify widespread campaigns, such as a phishing attack affecting many users simultaneously. A time-series model can predict the normal rate of file creations with double extensions. A significant deviation from this forecast (e.g., 50 files created in a minute when the forecast was 1-2) is a strong indicator of a coordinated, large-scale event that requires an immediate, broad response.
    answer_sources:
      - Windows Event ID 11 (Sysmon)
      - Windows Event ID 1 (Sysmon)
      - User profile directories (e.g., Downloads, Temp, AppData), application cache folders, and removable media drives.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: FOR each high-risk parent process, TRAIN time-series model on historical counts of double-extension file creations. FORECAST expected counts. IF observed_count > forecasted_confidence_interval, GENERATE high-priority alert.
  - question: Has a process with a double-extension filename been executed from a high-risk or non-standard directory like a user's Downloads or Temp folder?
    context: This question targets a common malware execution pattern. Executables are often dropped in temporary or user-specific directories and then run. Alerting on processes with deceptive double-extension filenames that run from these locations helps pinpoint malware execution. The suspicion is further increased if the parent process is not a standard shell like 'explorer.exe', as it may indicate programmatic execution by a dropper.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 1 (Sysmon)
      - User workstations, terminal servers, and Virtual Desktop Infrastructure (VDI) instances.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH process creation logs WHERE (process_name MATCHES double_extension_regex) AND (process_path IN high_risk_directories) AND (parent_process NOT IN ['explorer.exe', 'cmd.exe']). GENERATE alert.
  - question: Has a user executed a process with a double extension from a directory they do not typically use for running applications?
    context: This question focuses on detecting anomalous user behavior. Users typically run programs from predictable locations (e.g., 'Program Files'). Executing a deceptively named file from an unusual location (e.g., a newly created temp folder) deviates from this baseline and is highly suspicious. This approach helps to identify compromised user accounts or users who have been tricked into running malware.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 1 (Sysmon)
      - User workstations, terminal servers, and Virtual Desktop Infrastructure (VDI) instances.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: FOR each user, CREATE baseline of frequent execution directories. ON process creation with double-extension, IF execution_directory is not in user's baseline, FLAG as anomalous user behavior and increase risk score.
  - question: Does a process creation event involving a double-extension file exhibit a combination of anomalous characteristics when compared to a baseline of normal process behavior?
    context: This question uses an unsupervised machine learning model (Isolation Forest) to find 'odd one out' events. The model learns what normal process creation looks like based on features like parent process, path depth, and user context. When a new process involving a double-extension file is created, the model can determine if its combination of features is anomalous compared to the learned benign activity, effectively flagging novel or sophisticated attacks that might otherwise be missed.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 1 (Sysmon)
      - User workstations, terminal servers, and Virtual Desktop Infrastructure (VDI) instances.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: TRAIN Isolation Forest model on benign process creation event features. FOR new process creation with double-extension, FEED features into model. IF anomaly_score is high, QUEUE for immediate investigation.
  - question: Has a file with a double-extension pattern been transferred over the network, and does the associated context (e.g., User-Agent, email headers) appear suspicious?
    context: This question aims to detect the delivery of malicious files over the network. By identifying files with deceptive double extensions in transit and enriching this data with protocol-specific details (like an anomalous User-Agent in an HTTP request or phishing indicators in an email), analysts can catch malware at the delivery stage, often before it is executed on an endpoint.
    answer_sources:
      - Zeek files.log
      - Zeek http.log
      - Zeek ftp.log
      - Zeek smtp.log
      - Network egress points, web proxy servers, Mail Transfer Agents (MTAs), and internal network sensors monitoring lateral movement.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH network file transfer logs WHERE filename MATCHES double_extension_regex. CORRELATE with protocol logs (HTTP, SMTP). IF HTTP User-Agent is anomalous OR Referer is missing OR SMTP headers are suspicious, GENERATE medium-severity alert.
  - question: Is there a statistical increase in the network transfer of a specific type of double-extension file (e.g., 'invoice.pdf.exe'), indicating a potential campaign?
    context: This question focuses on trend analysis to spot attack campaigns. A sudden surge in the frequency of a particular filename pattern (like 'pdf.exe') being transferred across the network, compared to its historical baseline, strongly suggests a coordinated attack campaign is underway. This allows security teams to move from investigating single events to recognizing and responding to a broader threat.
    answer_sources:
      - Zeek files.log
      - Zeek http.log
      - Zeek ftp.log
      - Zeek smtp.log
      - Network egress points, web proxy servers, Mail Transfer Agents (MTAs), and internal network sensors monitoring lateral movement.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: AGGREGATE daily counts of each double-extension file pair (e.g., 'pdf.exe'). CALCULATE 7-day moving average and standard deviation. IF daily_count > (moving_average + 3 * std_dev), TRIGGER alert for trend analysis.
  - question: Can we identify coordinated, anomalous network activity involving double-extension files by clustering related events together?
    context: This question uses clustering (DBSCAN) to find groups of related, suspicious network events that might not trigger individual alerts. By grouping events based on features like source/destination IPs, User-Agent, and file characteristics, it can uncover 'low and slow' attacks or distributed campaigns where multiple hosts are involved. Outlier clusters representing coordinated downloads of double-extension files are strong candidates for investigation.
    answer_sources:
      - Zeek files.log
      - Zeek http.log
      - Zeek ftp.log
      - Zeek smtp.log
      - Zeek conn.log
      - Network egress points, web proxy servers, Mail Transfer Agents (MTAs), and internal network sensors monitoring lateral movement.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: EXTRACT features (source IP, dest IP, User-Agent, file type, etc.) from network logs. RUN DBSCAN clustering algorithm on features. INVESTIGATE outlier clusters that involve double-extension files.
  - question: After a process with a double extension is executed, does it perform any suspicious follow-on actions, such as establishing persistence or making external network connections?
    context: This question aims to confirm malicious intent by linking the initial execution of a suspicious file to subsequent malicious behavior. A file with a deceptive name is suspicious, but if it immediately attempts to modify autorun registry keys, create files in system directories, or call out to a new IP address, it is almost certainly malware. This chained detection logic provides high-fidelity alerts by correlating an initial indicator with subsequent malicious actions.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 1 (Sysmon)
      - Windows Event ID 11 (Sysmon)
      - Windows Event ID 13 (Sysmon)
      - Windows Event ID 22 (Sysmon)
      - Zeek conn.log
      - Zeek dns.log
      - Domain Controllers (for registry monitoring), Endpoint devices, and DNS Servers.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: ON process creation with double-extension, TRIGGER monitoring on ProcessGUID for 5 minutes. IF child process is persistence tool OR autorun registry key is modified OR file created in system folder OR new external network connection is made, ESCALATE to critical incident.
  - question: Does a process launched from a double-extension file exhibit anomalous behavior, such as high-entropy DNS queries (DGA), an unusual number of child processes, or connections to rare network ports?
    context: This question seeks to identify malicious processes by profiling their runtime behavior. Malware often exhibits tell-tale signs after execution, such as using Domain Generation Algorithms (DGA) for C2 communication (visible as high-entropy DNS lookups), spawning an unusual number of helper processes, or connecting to non-standard ports. Identifying these behavioral anomalies helps to confirm that a suspicious process is indeed malicious.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 1 (Sysmon)
      - Windows Event ID 11 (Sysmon)
      - Windows Event ID 13 (Sysmon)
      - Windows Event ID 22 (Sysmon)
      - Zeek conn.log
      - Zeek dns.log
      - Domain Controllers (for registry monitoring), Endpoint devices, and DNS Servers.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: FOR a process from a double-extension file, CALCULATE DNS query entropy, child process count, and destination port rarity. IF any metric is anomalous compared to baselines, INCREASE process risk score.
  - question: Does the sequence of actions performed by a process launched from a double-extension file match known benign application behavior, or is it anomalous?
    context: This question uses advanced machine learning to detect malicious behavior based on the *order* of events. Benign applications have predictable workflows (e.g., open file -> read file -> close file). Malware often has a different sequence (e.g., process create -> network connect -> registry write). An LSTM autoencoder can learn the normal sequences and flag a process whose sequence of actions has a high 'reconstruction error,' meaning its behavior pattern is novel and highly suspicious.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 1 (Sysmon)
      - Windows Event ID 11 (Sysmon)
      - Windows Event ID 13 (Sysmon)
      - Windows Event ID 22 (Sysmon)
      - Zeek conn.log
      - Zeek dns.log
      - Domain Controllers (for registry monitoring), Endpoint devices, and DNS Servers.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: TRAIN LSTM autoencoder on benign process event sequences. FOR a new process from a double-extension file, CAPTURE its event sequence. IF model reconstruction error is high, FLAG as highly suspicious activity.