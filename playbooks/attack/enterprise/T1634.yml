name: T1634: Credentials from Password Store
id: d290f1ee-6c54-4b01-90e6-d701748f0851
description: This playbook focuses on detecting if adversaries are accessing and using credentials stolen from corporate mobile devices. It addresses this by identifying three primary attack patterns: 1) A mobile device is jailbroken or rooted, followed by brute-force login attempts against the user's account and subsequent data exfiltration. 2) An unauthorized, potentially malicious application is installed on a device, which then exhibits suspicious network behavior such as communicating with random-looking domains (DGA) or highly periodic C2 beaconing. 3) A user's credentials are used to log in from a high-risk or geographically anomalous location (e.g., an anonymizing proxy or a new country), followed by unusual access to sensitive applications or large data downloads.
type: technique
related:
  - TA0031: Credential Access
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Has a recently jailbroken or rooted device been associated with brute-force login attempts or connections to known malicious infrastructure?
    context: This question aims to identify the immediate aftermath of a device compromise. A jailbreak or root event significantly lowers a device's security posture, making it a prime target for credential theft. Detecting subsequent brute-force attacks (a high volume of failed logins) or communication with malicious servers can be a strong indicator that the compromised device is being used to attack the user's corporate account.
    answer_sources:
      - MDM/UEM device compliance logs
      - Zeek conn.log
      - Windows Event ID 4625
      - Windows Event ID 4624
      - Windows Event ID 4768
      - Windows Event ID 4769
      - Corporate MDM/UEM management server
      - Network egress points instrumented with Zeek sensors
      - VPN concentrators
      - Corporate Wi-Fi Access Point Controllers
      - Domain Controllers and Authentication Servers
      - Cloud identity provider logs (e.g., Azure AD, Okta)
    range: last 90 days
    queries:
      - query: "Pseudocode: CORRELATE (MDM/UEM logs WHERE compliance_status = 'non-compliant' AND reason IN ['jailbreak_detected', 'root_detected']) with (Windows logs WHERE EventID=4625 for same user) | COUNT events in 5min window | ALERT if count > 10. ALSO, JOIN (Zeek conn.log for device_ip) with (Threat Intel Feed) | ALERT on match."
  - question: Following a jailbreak event, has the user's account shown signs of compromise, such as successful logins from new geographic locations or unusual data exfiltration from the device?
    context: This question focuses on detecting two common post-compromise behaviors: credential abuse and data theft. A successful login from a completely new country or Autonomous System (ASN) for a user is a classic 'impossible travel' indicator. Simultaneously, a significant spike in outbound data from the compromised device, when compared to its own history, suggests that data is being exfiltrated.
    answer_sources:
      - MDM/UEM device compliance logs
      - Zeek conn.log
      - Windows Event ID 4625
      - Windows Event ID 4624
      - Windows Event ID 4768
      - Windows Event ID 4769
      - Corporate MDM/UEM management server
      - Network egress points instrumented with Zeek sensors
      - VPN concentrators
      - Corporate Wi-Fi Access Point Controllers
      - Domain Controllers and Authentication Servers
      - Cloud identity provider logs (e.g., Azure AD, Okta)
    range: last 90 days
    queries:
      - query: "Pseudocode: FOR each jailbroken_device_ip: BASELINE 30-day outbound data volume from Zeek conn.log. ALERT if daily volume > 95th percentile. FOR each affected_user: BASELINE 90-day source countries/ASNs from Windows EventID 4624. ALERT on successful login from new country/ASN."
  - question: Can machine learning models identify high-risk anomalies, such as unusual network traffic spikes or credential compromise patterns, associated with a jailbroken device?
    context: This question explores the use of advanced analytics to detect subtle indicators of compromise that rule-based systems might miss. A time-series model can spot anomalous spikes in network traffic that deviate from normal patterns, while a classification model can synthesize multiple weak signals (e.g., jailbreak status, login failures, new login locations) into a single, high-confidence risk score for an account. This helps prioritize analyst attention on the most likely compromised users.
    answer_sources:
      - MDM/UEM device compliance logs
      - Zeek conn.log
      - Windows Event ID 4625
      - Windows Event ID 4624
      - Windows Event ID 4768
      - Windows Event ID 4769
      - Corporate MDM/UEM management server
      - Network egress points instrumented with Zeek sensors
      - VPN concentrators
      - Corporate Wi-Fi Access Point Controllers
      - Domain Controllers and Authentication Servers
      - Cloud identity provider logs (e.g., Azure AD, Okta)
    range: last 90 days
    queries:
      - query: "Pseudocode: MODEL 1 (Time-Series): INPUT Zeek conn.log data (bytes, connections) per device/hour. ALERT on anomaly spike within 24hrs of jailbreak event. MODEL 2 (Classifier): INPUT features (is_jailbroken, outbound_data_zscore, failed_logins, is_new_country). OUTPUT user risk score, probability, and top features."
  - question: Are devices with unauthorized applications making direct-to-IP connections, potentially bypassing DNS to hide malicious communication?
    context: The installation of an unapproved application is a security risk. This question seeks to identify a specific type of malicious behavior associated with such apps: direct-to-IP C2 communication. Legitimate applications typically resolve a domain name via DNS before connecting to an IP. Bypassing DNS is a common evasion technique used by malware to connect to hardcoded C2 server IP addresses.
    answer_sources:
      - MDM/UEM application inventory logs
      - Zeek dns.log
      - Zeek conn.log
      - Corporate MDM/UEM management server
      - Corporate DNS resolvers logging to Zeek
      - Network egress points instrumented with Zeek sensors
      - Cloud Access Security Broker (CASB) logs
      - Mobile Application Management (MAM) servers
    range: last 90 days
    queries:
      - query: "Pseudocode: IDENTIFY devices with non-allowlisted apps from MDM logs. FOR each device_ip: CHECK Zeek conn.log for connections. ALERT if destination_ip has no corresponding DNS query in Zeek dns.log within last 5 minutes."
  - question: Do devices with unauthorized apps exhibit network traffic patterns indicative of DGA or C2 beaconing, such as high-entropy DNS queries or highly periodic connections?
    context: This question looks for two classic malware communication patterns. Domain Generation Algorithms (DGAs) create random-looking domain names to find C2 servers; these domains have high Shannon entropy. Regular, machine-like C2 beaconing often occurs at fixed intervals, resulting in a very low variance in the time between connections. Detecting either pattern from a device with a rogue app is a strong signal of malware infection.
    answer_sources:
      - MDM/UEM application inventory logs
      - Zeek dns.log
      - Zeek conn.log
      - Corporate MDM/UEM management server
      - Corporate DNS resolvers logging to Zeek
      - Network egress points instrumented with Zeek sensors
      - Cloud Access Security Broker (CASB) logs
      - Mobile Application Management (MAM) servers
    range: last 90 days
    queries:
      - query: "Pseudocode: FOR devices with unauth_apps: CALCULATE Shannon entropy on domains from Zeek dns.log. ALERT if hourly average > 3.5. ALSO, CALCULATE stddev of inter-arrival time for direct-to-IP connections in Zeek conn.log. ALERT if stddev < 10s for >10 events."
  - question: Can unsupervised machine learning models, like clustering or autoencoders, distinguish the anomalous network behavior of a device with an unauthorized app from the normal traffic of compliant devices?
    context: This question applies machine learning to find 'unknown unknowns.' Instead of looking for specific bad patterns, these models learn what 'normal' traffic looks like. Clustering algorithms (like DBSCAN) group similar connections together; anomalous traffic will form small, isolated clusters. Autoencoders learn to reconstruct normal traffic data; they will have a high reconstruction error when trying to process anomalous traffic, flagging it for review. This is effective for detecting novel threats that don't match predefined rules.
    answer_sources:
      - MDM/UEM application inventory logs
      - Zeek dns.log
      - Zeek conn.log
      - Corporate MDM/UEM management server
      - Corporate DNS resolvers logging to Zeek
      - Network egress points instrumented with Zeek sensors
      - Cloud Access Security Broker (CASB) logs
      - Mobile Application Management (MAM) servers
    range: last 90 days
    queries:
      - query: "Pseudocode: MODEL 1 (Clustering): INPUT Zeek conn.log features (protocol, port, duration, bytes, periodicity). FLAG traffic from devices with unauth_apps that fall in small, distant clusters. MODEL 2 (Autoencoder): TRAIN on traffic from compliant devices. TEST traffic from unauth_app devices. ALERT on high reconstruction error."
  - question: Is a user successfully authenticating from an IP address associated with anonymizing services like TOR or commercial VPNs, which could be used to hide an attacker's true location?
    context: While some users (e.g., security researchers) may have a legitimate need for anonymizing services, an unexpected login from such a source is highly suspicious. Attackers use these services to obfuscate their origin. This question aims to detect these high-risk logins by cross-referencing the login source IP with threat intelligence feeds that track anonymizer nodes.
    answer_sources:
      - Windows Event ID 4624
      - Zeek conn.log
      - Cloud/SaaS application access logs
      - VPN Logs
      - Domain Controllers
      - VPN Concentrators
      - Cloud Identity Providers (e.g., Azure AD, Okta)
      - SaaS application platforms (e.g., O365, Salesforce)
      - Network egress points instrumented with Zeek sensors
    range: last 90 days
    queries:
      - query: "Pseudocode: FOR each successful login (EventID 4624): JOIN source_ip with Threat Intel feed. ALERT if IP is on anonymizer blocklist AND user role does not require it."
  - question: Has a user logged in from a new or geographically improbable location, suggesting their credentials may have been stolen and are being used by an adversary elsewhere?
    context: This question operationalizes the concept of 'impossible travel' and baseline deviation. By tracking every user's historical login locations (by country and ASN), the system can immediately flag a login from a novel location. This is a powerful indicator of credential compromise. The risk can be further refined by considering how rare that location is for the entire organization.
    answer_sources:
      - Windows Event ID 4624
      - Zeek conn.log
      - Cloud/SaaS application access logs
      - VPN Logs
      - Domain Controllers
      - VPN Concentrators
      - Cloud Identity Providers (e.g., Azure AD, Okta)
      - SaaS application platforms (e.g., O365, Salesforce)
      - Network egress points instrumented with Zeek sensors
    range: last 90 days
    queries:
      - query: "Pseudocode: FOR each user: MAINTAIN 90-day baseline of source ASNs/countries from login events (EventID 4624). ON new successful login: ALERT if source ASN/country is not in user's baseline. SCORE risk based on organization-wide rarity of the ASN/country."
  - question: Can machine learning, through peer group analysis and predictive classification, identify users whose login behavior significantly deviates from their own past patterns and those of their peers?
    context: This question leverages two advanced ML techniques. Peer group analysis (clustering) automatically groups users with similar roles and access patterns. A login that doesn't fit a user's established group is anomalous. A supervised classifier can then take these anomaly signals, along with other features (like new ASN, time of day), and provide a concrete prediction of credential reuse, helping analysts focus on the most probable compromises.
    answer_sources:
      - Windows Event ID 4624
      - Zeek conn.log
      - Cloud/SaaS application access logs
      - VPN Logs
      - Domain Controllers
      - VPN Concentrators
      - Cloud Identity Providers (e.g., Azure AD, Okta)
      - SaaS application platforms (e.g., O365, Salesforce)
      - Network egress points instrumented with Zeek sensors
    range: last 90 days
    queries:
      - query: "Pseudocode: MODEL 1 (Clustering): GROUP users by login behavior (ASN, time, systems). FLAG login if it moves user to a new cluster. MODEL 2 (Classifier): INPUT features like is_new_ASN, is_new_country, time_of_day_zscore. OUTPUT prediction of credential reuse."