name: T1660: Phishing
id: f47ac10b-58cc-4372-a567-0e02b2c3d479
description: This playbook helps determine if an adversary is attempting to gain initial access to mobile devices via phishing. The investigation focuses on identifying network connections from mobile devices to suspicious domains, analyzing TLS certificates for malicious indicators, and correlating network events with subsequent authentication attempts. Suspicious activity includes connections to recently registered domains with high character entropy, domains rare to the enterprise, or domains hosted on known malicious infrastructure, often involving URL shorteners or certificates from free Certificate Authorities.
type: technique
related:
- TA0027: Initial Access
contributors:
- Zachary Szewczyk
- Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
- question: Are mobile devices querying domains that appear on known phishing threat intelligence lists?
  context: This is a high-fidelity check for known malicious activity. A DNS query from a mobile device to a domain on a reputable phishing list is a strong indicator of a user clicking a malicious link. Enriching this finding with the User-Agent string from HTTP logs helps confirm the device type and target platform, which is crucial for containment and remediation.
  answer_sources:
  - Zeek dns.log
  - Zeek http.log
  - Zeek conn.log
  - External WHOIS data
  - Corporate and guest Wi-Fi network segments, VPN concentrators, Mobile Device Management (MDM) logs, and network egress points.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH dns_logs WHERE source_ip IN mobile_ip_ranges AND query_domain IN phishing_threat_list | JOIN http_logs ON transaction_id | RETURN source_ip, query_domain, user_agent
- question: Are mobile devices communicating with domains exhibiting multiple high-risk characteristics, such as high entropy, recent registration, and uncommon TLDs?
  context: This question moves beyond known threats to heuristically identify suspicious domains that may be purpose-built for a phishing campaign. Adversaries often use algorithmically generated domains (high entropy), register them just before a campaign (recent registration), and use cheap or obscure TLDs. A scoring system that combines these weak signals into a stronger, actionable indicator can uncover novel phishing infrastructure.
  answer_sources:
  - Zeek dns.log
  - Zeek http.log
  - Zeek conn.log
  - External WHOIS data
  - Corporate and guest Wi-Fi network segments, VPN concentrators, Mobile Device Management (MDM) logs, and network egress points.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH dns_logs WHERE source_ip IN mobile_ip_ranges | CALCULATE domain_entropy, domain_age, tld_rarity | CALCULATE risk_score | FILTER risk_score >= 2 | JOIN http_logs ON transaction_id | RETURN source_ip, query_domain, risk_score, user_agent
- question: Can a machine learning model identify DNS requests from mobile devices that are likely malicious based on a combination of domain features?
  context: This question leverages advanced analytics to automate the detection of suspicious domains at scale. A logistic regression model can learn complex, non-linear patterns from various lexical features of a domain (e.g., length, entropy, n-grams, TLD rarity) and its registration data. This provides a probabilistic assessment of maliciousness, allowing for a tunable alert threshold that can adapt to an organization's risk tolerance.
  answer_sources:
  - Zeek dns.log
  - Zeek http.log
  - Zeek conn.log
  - External WHOIS data
  - Corporate and guest Wi-Fi network segments, VPN concentrators, Mobile Device Management (MDM) logs, and network egress points.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: STREAM dns_logs WHERE source_ip IN mobile_ip_ranges | APPLY ML_model(domain_features) | FILTER probability_malicious > 0.9 | RETURN source_ip, query_domain, probability_malicious
- question: Are mobile devices establishing TLS connections using certificates known to be malicious or exhibiting suspicious properties like self-signing or suspect issuer strings?
  context: Analyzing the TLS certificate provides a valuable layer of inspection independent of the domain name. Threat actors may reuse certificates across campaigns, making fingerprint matching against threat intelligence feeds effective. Furthermore, illegitimate certificates often have tell-tale signs like being self-signed for a public-facing site or having unusual issuer names, which are strong indicators of a potential man-in-the-middle or phishing attack.
  answer_sources:
  - Zeek dns.log
  - Zeek conn.log
  - Zeek ssl.log
  - Zeek http.log
  - Network sensors monitoring corporate and guest Wi-Fi networks, and VPN concentrators logging traffic from remote mobile devices.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH ssl_logs WHERE source_ip IN mobile_ip_ranges AND (cert_hash IN malicious_cert_list OR (is_self_signed AND is_external) OR issuer CONTAINS suspicious_strings) | RETURN source_ip, server_name, issuer, cert_hash
- question: Are mobile devices visiting domains that are rare both globally across the enterprise and locally among a small number of users, and does this visit represent a significant deviation from the user's normal browsing behavior?
  context: This question focuses on anomaly detection based on domain popularity and user behavior. Phishing links are often unique and sent to a small number of targets. Identifying a domain that is new to the entire organization ('globally rare') and visited by only a few users ('locally rare') is highly suspicious. Comparing this activity to a user's historical browsing profile (e.g., via Jaccard similarity) helps confirm if this is an anomalous and potentially malicious deviation from their norm.
  answer_sources:
  - Zeek dns.log
  - Zeek conn.log
  - Zeek ssl.log
  - Zeek http.log
  - Network sensors monitoring corporate and guest Wi-Fi networks, and VPN concentrators logging traffic from remote mobile devices.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH dns_logs WHERE source_ip IN mobile_ip_ranges | FILTER is_globally_rare(query_domain, 30d) AND is_locally_rare(query_domain, 24h, 3_users) | CALCULATE jaccard_similarity(user_session, user_history) | FILTER similarity < 0.2 | RETURN user, query_domain, similarity_score
- question: Can a user-specific machine learning model detect network connections from a mobile device that are anomalous compared to the user's established baseline of activity?
  context: This question applies user-level behavioral analytics to spot deviations that population-based models might miss. A One-Class SVM model can create a precise profile of a user's 'normal' network traffic based on features like TLDs, server ports, protocols, and JA3/JA3S hashes. Any new connection that falls outside this learned profile is flagged as an outlier, which could indicate a user has been tricked into clicking a phishing link (e.g., 'quishing') leading to an uncharacteristic destination.
  answer_sources:
  - Zeek dns.log
  - Zeek conn.log
  - Zeek ssl.log
  - Zeek http.log
  - Network sensors monitoring corporate and guest Wi-Fi networks, and VPN concentrators logging traffic from remote mobile devices.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: STREAM conn_logs WHERE user IN profiled_users AND source_ip IN mobile_ip_ranges | APPLY user_specific_OCSVM_model(connection_features) | FILTER is_outlier | RETURN user, source_ip, destination_ip, destination_port
- question: Are mobile devices using URL shorteners to connect to IP addresses listed on threat intelligence feeds, and is this activity followed by a successful authentication?
  context: Adversaries frequently use URL shorteners to obfuscate the final malicious destination and evade simple blocklists. This question focuses on de-cloaking this technique. By resolving the shortened URL to its final IP address and checking that IP against known bad infrastructure, we can identify high-risk connections. Correlating this with a subsequent authentication event from the same source IP strengthens the evidence that credentials may have been phished.
  answer_sources:
  - Zeek dns.log
  - Zeek http.log
  - Zeek ssl.log
  - Zeek conn.log
  - Windows Event ID 4624
  - Azure AD Sign-in logs
  - Network egress points, VPN concentrators, Active Directory Domain Controllers, and cloud identity provider infrastructure (e.g., Azure AD, Okta).
  range: last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH dns_logs WHERE source_ip IN mobile_ip_ranges AND query_domain IN url_shorteners | GET final_ip | IF final_ip IN phishing_ip_list THEN ALERT | CORRELATE auth_logs WHERE source_ip = final_ip
- question: Are mobile devices making connections to servers with high-risk TLS certificates (short validity, free CA, typosquatted domain), immediately followed by a successful user authentication from the same source IP?
  context: This question seeks to identify a classic phishing workflow: lure, land, and login. The high-risk TLS certificate (short validity, free CA) associated with a typosquatted or homoglyph domain strongly suggests a phishing landing page. A successful authentication from the same IP address shortly after the connection is made is a very strong indicator that the user was tricked into submitting their credentials on the malicious site. The tight time window (5 minutes) is key for high-fidelity correlation.
  answer_sources:
  - Zeek dns.log
  - Zeek http.log
  - Zeek ssl.log
  - Zeek conn.log
  - Windows Event ID 4624
  - Azure AD Sign-in logs
  - Network egress points, VPN concentrators, Active Directory Domain Controllers, and cloud identity provider infrastructure (e.g., Azure AD, Okta).
  range: last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH ssl_logs WHERE source_ip IN mobile_ip_ranges AND cert_validity < 90d AND issuer IN free_cas AND is_typosquat(server_name) | FOR_EACH_EVENT, SEARCH auth_logs in next 5_mins WHERE event_type = 'success' AND source_ip = event.source_ip | ALERT on match
- question: Can a two-stage detection model, combining a machine learning classifier for risky network connections with a time-bounded search for subsequent successful authentications, effectively identify potential credential compromise events originating from mobile devices?
  context: This question proposes a sophisticated, high-fidelity detection strategy to minimize false positives. The first stage uses a robust ML model (e.g., Random Forest) to identify potentially risky network connections with high accuracy. The second stage acts as a confirmation step, looking for the specific, high-impact outcome of a successful login from the same source. This two-stage approach only alerts on the full chain of events, indicating a likely successful phishing attack and credential compromise requiring immediate response.
  answer_sources:
  - Zeek dns.log
  - Zeek http.log
  - Zeek ssl.log
  - Zeek conn.log
  - Windows Event ID 4624
  - Azure AD Sign-in logs
  - Network egress points, VPN concentrators, Active Directory Domain Controllers, and cloud identity provider infrastructure (e.g., Azure AD, Okta).
  range: last 90 days
  queries:
  - technology: pseudocode
    query: STREAM conn_logs WHERE source_ip IN mobile_ip_ranges | APPLY RF_classifier(connection_features) | IF probability > 0.9 THEN TRIGGER search_auth_logs(source_ip, 5_mins) | IF auth_success_found THEN CREATE critical_alert