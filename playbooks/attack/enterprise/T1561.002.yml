name: T1561.002: Disk Structure Wipe
id: 5a83a0f9-2e9a-4e2b-9c7f-0d8e1a7b6c5d
description: |
  This playbook helps investigate whether an adversary is attempting to impact system availability by wiping disk structures. This destructive technique can render systems inoperable by targeting the Master Boot Record (MBR), partition tables, or the underlying file systems. The investigation focuses on detecting known wiper malware, unauthorized access to raw disk objects, execution of destructive commands on network devices, installation of malicious unsigned drivers, modification of critical boot files, and evidence of worm-like propagation used to spread the wiper across the network.
type: technique
related:
  - TA0040: Impact
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Has a process been created or a service installed whose name or hash matches a known wiper malware signature from threat intelligence feeds?
    context: |
      Adversaries often reuse or modify known wiper malware (e.g., Shamoon, NotPetya). This question aims to detect the execution or installation of these tools by comparing process names and file hashes against a curated threat intelligence feed of known wiper signatures. A match provides a high-confidence indicator of a disk-wiping attack.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 7045
      - Threat Intelligence Feeds
      - Assets: Critical Application Servers, Domain Controllers, File Servers, User Workstations
    range: the last 90 days
    queries:
      - search_technology: SIEM
        query: |
          SEARCH process_creation_events (EventID=4688) OR service_installation_events (EventID=7045)
          WHERE (process_name IN threat_intel_feed_wiper_names) OR (file_hash IN threat_intel_feed_wiper_hashes)
          GROUP BY hostname, process_name, file_hash
  - question: Has a statistically rare process or service been initiated with a name containing high-risk keywords like 'wipe', 'disk', 'erase', or 'mbr'?
    context: |
      This question seeks to identify potential new or unknown wipers by focusing on outlier behavior. It assumes that legitimate software rarely uses destructive keywords in its process or service names and that wiper malware may be deployed to only a few machines, making it statistically rare across the enterprise.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 7045
      - Assets: Critical Application Servers, Domain Controllers, File Servers, User Workstations
    range: the last 90 days
    queries:
      - search_technology: SIEM / UBA
        query: |
          CALCULATE enterprise_wide_frequency of all process/service names over 90 days.
          SEARCH process_creation_events (EventID=4688) OR service_installation_events (EventID=7045)
          WHERE frequency < 0.1% AND (process_name CONTAINS 'wipe' OR 'disk' OR 'erase' OR 'mbr')
          ALERT on rare, suspiciously named processes/services.
  - question: Has a machine learning model classified a newly executed process as a potential wiper based on its characteristics?
    context: |
      This question leverages a predictive model to identify sophisticated wipers that might evade signature or keyword-based detection. The model analyzes multiple features (process name entropy, parent process, command-line arguments) to score the likelihood of a process being malicious, enabling detection of novel threats.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 7045
      - Machine Learning Model Predictions
      - Assets: Critical Application Servers, Domain Controllers, File Servers, User Workstations
    range: the last 90 days
    queries:
      - search_technology: Machine Learning Platform
        query: |
          INPUT process_execution_events with features (name_entropy, parent_process, user_context, etc.) into classification model.
          FILTER for events where model_prediction == 'wiper' AND confidence_score > 0.9
          ALERT on high-confidence predictions.
  - question: Has a process not on a predefined allowlist attempted to write to a raw physical disk object?
    context: |
      Directly writing to physical disk objects (e.g., `\\.\PhysicalDrive0`) is a common technique for wipers to bypass file system permissions and erase the MBR or partition table. Legitimate access is rare and typically limited to specific system utilities. This question aims to detect this highly suspicious activity by monitoring for unauthorized write attempts.
    answer_sources:
      - Windows Event ID 4663 (Object Access)
      - Windows Event ID 4656 (Handle Requested)
      - Assets: Boot sectors of critical servers (especially Domain Controllers, Hypervisors) and executive workstations, System partitions
    range: the last 90 days
    queries:
      - search_technology: SIEM
        query: |
          SEARCH object_access_events (EventID=4656 OR EventID=4663)
          WHERE object_name MATCHES '\\.\PhysicalDrive*' AND access_mask CONTAINS 'write'
          AND process_name NOT IN (allowlist_of_disk_utilities)
          ALERT on unauthorized raw disk write access.
  - question: Has any process accessed raw disk objects with a statistically anomalous frequency?
    context: |
      While some legitimate processes may access raw disk objects, their behavior is typically predictable. A sudden, sharp increase in the frequency of these accesses by any process could indicate that a wiper is enumerating or overwriting disk sectors. This question uses statistical analysis to detect such deviations from the norm.
    answer_sources:
      - Windows Event ID 4663
      - Windows Event ID 4656
      - Assets: Boot sectors of critical servers, System partitions
    range: the last 90 days
    queries:
      - search_technology: SIEM / UBA
        query: |
          BASELINE normal frequency of raw disk access per process per host.
          CALCULATE Z-score for current access frequency against baseline.
          SEARCH object_access_events (EventID=4656 OR EventID=4663)
          WHERE Z-score > 3
          ALERT on statistically significant spikes in raw disk access.
  - question: Has an anomaly detection model flagged a deviation from normal raw disk access patterns?
    context: |
      This question uses a machine learning model to create a comprehensive baseline of normal raw disk access, considering factors like process name, user, and time of day. The model can then identify complex, multi-faceted anomalies that might not be apparent from simple frequency counts, indicating a potential wiper.
    answer_sources:
      - Windows Event ID 4663
      - Windows Event ID 4656
      - Machine Learning Model Predictions
      - Assets: Boot sectors of critical servers, System partitions
    range: the last 90 days
    queries:
      - search_technology: Machine Learning Platform
        query: |
          INPUT raw_disk_access_events (EventID=4663/4656) into anomaly detection model (e.g., Isolation Forest).
          FILTER for events flagged as anomalous with a high score.
          ALERT on anomalous raw disk access patterns.
  - question: Has a destructive command like 'format' or 'erase' been executed on a network device by an unauthorized user?
    context: |
      Adversaries may target network infrastructure to cause widespread disruption. This question looks for the execution of highly destructive commands on devices like routers and switches. Correlating the command with the user's authorization level helps distinguish between malicious activity and legitimate, albeit critical, administrative tasks.
    answer_sources:
      - Network Device AAA Logs
      - Assets: Core Routers, Core Switches, Firewalls, SAN Fabric Switches
    range: the last 90 days
    queries:
      - search_technology: SIEM / Log Management
        query: |
          SEARCH network_device_logs
          WHERE command IN ('format flash:', 'erase startup-config', 'write erase')
          AND user NOT IN (group: 'Senior Network Administrators')
          ALERT on destructive commands by non-privileged users.
  - question: Has a network administrator executed a statistically rare, destructive command or exhibited unusually low command entropy in a session?
    context: |
      Even authorized administrators can have their accounts compromised. This question seeks to identify anomalous behavior within an administrator's session. A rarely used destructive command or a sudden drop in command complexity (entropy) could indicate an automated script or an adversary using the compromised account to execute a simple, repetitive attack.
    answer_sources:
      - Network Device AAA Logs
      - Assets: Core Routers, Core Switches, Firewalls, SAN Fabric Switches
    range: the last 90 days
    queries:
      - search_technology: SIEM / UBA
        query: |
          BASELINE command frequency and session entropy for each network administrator.
          SEARCH network_device_logs for new sessions.
          ALERT if (command is statistically rare for user) OR (session_command_entropy is abnormally low).
  - question: Has a machine learning model detected an anomalous sequence of commands on a network device, such as a login followed immediately by a format command?
    context: |
      Normal administrative sessions on network devices often follow a predictable workflow (e.g., login, check status, make configuration change, verify, logout). This question uses a sequence-aware model (like an LSTM) to detect significant deviations from these learned workflows, which could indicate a compromised account being used for purely destructive purposes.
    answer_sources:
      - Network Device AAA Logs
      - Machine Learning Model Predictions
      - Assets: Core Routers, Core Switches, Firewalls, SAN Fabric Switches
    range: the last 90 days
    queries:
      - search_technology: Machine Learning Platform
        query: |
          INPUT sequences of admin commands from AAA logs into LSTM model.
          FILTER for sequences flagged as anomalous.
          ALERT on command sequences that deviate from normal administrative workflows.
  - question: Has a new service been created for an unsigned kernel-mode driver that is not on an established allowlist?
    context: |
      Kernel-mode drivers operate with the highest level of privilege. Adversaries may install a malicious, unsigned driver to gain deep system access for wiping activities, bypassing user-mode security controls. This question detects the installation of a new, untrusted, and potentially malicious kernel-mode driver.
    answer_sources:
      - Windows Event ID 7045 (Service Creation)
      - Windows Event ID 5038 (Code Integrity/Unsigned Driver)
      - Assets: Domain Controllers, Hypervisors, Database Servers, Tier 0 assets
    range: the last 90 days
    queries:
      - search_technology: SIEM
        query: |
          JOIN (SEARCH EventID=7045 WHERE ServiceType='0x1') with (SEARCH EventID=5038) on image_path
          WHERE service_name NOT IN (allowlist_of_drivers)
          ALERT on installation of new, unsigned, non-allowlisted kernel driver.
  - question: Have any new drivers been installed with service names or image paths that have statistically abnormal entropy?
    context: |
      Wiper malware may use algorithmically generated names (high entropy) to evade simple signature detection or overly generic names (low entropy) to blend in. This question analyzes the complexity of service and file names for new driver installations to flag those that are statistical outliers, suggesting they may not be legitimate software.
    answer_sources:
      - Windows Event ID 7045 (Service Creation)
      - Assets: Domain Controllers, Hypervisors, Database Servers, Tier 0 assets
    range: the last 90 days
    queries:
      - search_technology: SIEM / UBA
        query: |
          FOR each new driver installation (EventID=7045):
          CALCULATE Shannon entropy of 'Image Path' and 'Service Name'.
          ALERT if entropy score is in top 5% or bottom 5% of historical distribution.
  - question: Is there a time-series correlation between a spike in unsigned driver installations and a subsequent increase in unexpected system shutdowns across the enterprise?
    context: |
      A coordinated disk-wiping attack may involve deploying a malicious driver across many systems, leading to widespread, near-simultaneous crashes. This question uses time-series analysis to find a causal link between the mass installation of unsigned drivers and a wave of unexpected shutdowns, which would be strong evidence of a large-scale attack.
    answer_sources:
      - Windows Event ID 7045 (Service Creation)
      - Windows Event ID 5038 (Unsigned Driver)
      - Windows Event ID 6008 (Unexpected Shutdown)
      - Assets: Domain Controllers, Hypervisors, Database Servers, Tier 0 assets
    range: the last 90 days
    queries:
      - search_technology: Time-Series Analytics Platform
        query: |
          CORRELATE time-series of (unsigned driver installs per hour) with (unexpected shutdowns per hour).
          ALERT if a significant positive correlation is found where shutdowns lag installs.
  - question: Has a process not on a strict allowlist modified or deleted critical boot-related files?
    context: |
      To render a system unbootable, an adversary can target critical boot files like the Boot Configuration Data (BCD) or the Windows loader (winload.exe). This question focuses on detecting any modification or deletion of these protected files by an unauthorized process, which is a direct indicator of an attempt to sabotage the boot process.
    answer_sources:
      - Windows Event ID 4663 (File System Auditing)
      - Assets: System partitions (e.g., C:\Boot), Windows\System32 directories, Boot Configuration Data stores
    range: the last 90 days
    queries:
      - search_technology: SIEM
        query: |
          SEARCH file_system_events (EventID=4663)
          WHERE (access_type='DELETE' OR access_type='WRITE_DATA')
          AND (target_file IN ('C:\\Boot\\BCD', 'C:\\Windows\\System32\\winload.exe', ...))
          AND (process_name NOT IN ('TrustedInstaller.exe', 'bcdboot.exe', ...))
          ALERT on unauthorized modification of critical boot files.
  - question: Has there been a statistical spike in the rate of file modifications within critical system directories on any given host?
    context: |
      Instead of targeting one specific file, a wiper might rapidly modify or delete many files in a critical directory (e.g., C:\Boot). This question detects such activity by monitoring the rate of file modifications in these sensitive locations and alerting when the rate exceeds a dynamic, host-specific baseline, indicating abnormal and potentially destructive behavior.
    answer_sources:
      - Windows Event ID 4663 (File System Auditing)
      - Assets: System partitions (e.g., C:\Boot), Windows\System32 directories
    range: the last 90 days
    queries:
      - search_technology: SIEM / UBA
        query: |
          MONITOR rate of file modifications (EventID=4663) in critical directories per host.
          CALCULATE moving average and standard deviation of this rate.
          ALERT if current rate > (moving_average + 3 * standard_deviation).
  - question: Does graph-based analysis reveal a new or rare process rapidly modifying multiple critical boot files, potentially across several hosts?
    context: |
      This question models system activity as a graph of processes and files to uncover attack patterns. A wiper attack would appear as an anomalous subgraph where a single rare process node connects to (modifies) multiple critical file nodes in a short period. Detecting this pattern, especially if it repeats across multiple hosts, can identify a coordinated attack.
    answer_sources:
      - Windows Event ID 4663 (File System Auditing)
      - Windows Event ID 4688 (Process Creation)
      - Assets: System partitions, Windows\System32 directories
    range: the last 90 days
    queries:
      - search_technology: Graph Analytics Platform
        query: |
          BUILD graph of (process nodes) and (file nodes) with 'modifies' edges from event logs.
          USE community detection algorithm to find subgraphs where a rare process node modifies many critical file nodes in a short time.
          ALERT on detection of such anomalous subgraphs.
  - question: Has a host exhibited a pattern of mass logon failures, followed by a successful logon, and then immediate file transfer or remote process creation?
    context: |
      This sequence of events is a classic signature of a wormable threat attempting to propagate. The adversary brute-forces credentials (mass failures), finally succeeds, and then uses the access to transfer the wiper payload and execute it on the next victim. Detecting this specific chain of events is key to stopping lateral movement.
    answer_sources:
      - Windows Event ID 4625 (Logon Failure)
      - Windows Event ID 4624 (Successful Logon)
      - Windows Event ID 4688 (Process Creation)
      - Zeek smb_files.log
      - Assets: Authentication logs from Domain Controllers, Endpoint logs from server VLANs
    range: the last 90 days
    queries:
      - search_technology: SIEM
        query: |
          SEQUENCE of events from a single source IP within 5 minutes:
          1. >10 Logon Failures (EventID=4625) to >5 unique hosts.
          2. One Successful Logon (EventID=4624).
          3. Followed by SMB file transfer (Zeek) OR remote process creation (EventID=4688).
          ALERT on this propagation pattern.
  - question: Has a host initiated an anomalously high number of outbound SMB or RPC connections compared to its baseline?
    context: |
      A compromised host acting as a launch point for a wiper worm will exhibit a sudden change in its network behavior. It will transition from normal activity to aggressively scanning and connecting to other hosts on ports like 445 (SMB) to propagate. This question aims to detect this "fan-out" behavior, which is a strong indicator of worm-like activity.
    answer_sources:
      - Zeek conn.log
      - Firewall Logs
      - Assets: Network traffic at key network chokepoints, logs from server VLANs
    range: the last 90 days
    queries:
      - search_technology: SIEM / UBA / Network Monitoring
        query: |
          PROFILE normal hourly unique destination port 445 connections for each host.
          ALERT if a host's connection count exceeds the 99th percentile of its own baseline.
  - question: Has a Hidden Markov Model detected a system transitioning from a 'Normal' operational state to a 'Wiper Propagation' state?
    context: |
      This question applies a sophisticated machine learning model to understand the 'state' of a host. The model learns the characteristics of normal behavior (low failed logins, etc.) and the characteristics of propagation (high failed logins, high remote execution). It can then detect the transition between these states, providing an early warning of a propagating threat.
    answer_sources:
      - Windows Event Logs (4625, 4624, 4688)
      - Zeek conn.log
      - Machine Learning Model Predictions
      - Assets: Domain Controllers, Endpoint logs, Network chokepoints
    range: the last 90 days
    queries:
      - search_technology: Machine Learning Platform
        query: |
          INPUT time-series data (failed logins, remote executions, SMB volume) into a trained Hidden Markov Model.
          ALERT if the model reports a state transition from 'Normal' to 'Wiper Propagation'.