name: T1521.002: Asymmetric Cryptography
id: a5d8f7c9-4b2e-4d6f-8c1a-9b8e7d6c5f4b
description: This playbook helps identify adversaries using non-standard or suspicious asymmetric cryptography for command and control (C2) on mobile devices. It focuses on detecting anomalous TLS sessions, such as those using self-signed certificates, certificates from known malicious issuers, or certificates with unusual validity periods. It also looks for periodic, 'heartbeat'-like C2 traffic patterns characterized by low variance in timing and data volume, and connections to known C2 infrastructure. Finally, it addresses data tunneling techniques where C2 data is hidden within protocol fields like DNS query names or HTTP User-Agent strings, identifiable by matching known malicious patterns or by statistically high entropy.
type: technique
related:
  - TA0037: Command And Control
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Are mobile devices establishing TLS sessions with certificates whose issuer or subject matches a known malicious entity?
    context: This question aims to find high-confidence indicators of compromise by checking TLS certificate details against threat intelligence feeds. A match strongly suggests that a mobile device is communicating directly with a known malicious infrastructure, which is a clear sign of a potential C2 channel.
    answer_sources:
      - Zeek ssl.log
      - Zeek conn.log
      - Network egress points
      - Corporate Wi-Fi access points
      - VPN concentrators
      - MDM (Mobile Device Management) proxy servers
      - Cloud Access Security Brokers (CASB)
      - Cellular network gateways (for corporate-liable devices backhauling traffic)
    range: last 90 days
    queries:
      - SEARCH Zeek ssl.log WHERE (issuer IN threat_intel_list OR subject IN threat_intel_list). JOIN with conn.log on UID WHERE source_ip IN mobile_ip_range. ALERT.
  - question: Are mobile devices using self-signed TLS certificates or certificates with an unusually short validity period?
    context: This question helps detect adversary-generated certificates that deviate from standard public key infrastructure (PKI) practices. Self-signed certificates bypass normal chain-of-trust validation, while unusually short-lived certificates can be a tactic to evade reputation-based blocking systems. Both are anomalous and warrant investigation.
    answer_sources:
      - Zeek ssl.log
      - Zeek conn.log
      - Zeek ja3.log
      - Zeek ja3s.log
      - Network egress points
      - Corporate Wi-Fi access points
      - VPN concentrators
      - MDM (Mobile Device Management) proxy servers
      - Cloud Access Security Brokers (CASB)
      - Cellular network gateways (for corporate-liable devices backhauling traffic)
    range: last 90 days
    queries:
      - FOR each SSL session from mobile_ip_range, CALCULATE certificate_duration. IF (validation_status == 'self-signed' OR certificate_duration < 5th_percentile_baseline) THEN ALERT.
  - question: Can a machine learning model identify high-risk TLS sessions from mobile devices based on a combination of certificate, TLS, and connection features?
    context: This question leverages a holistic, machine-learning approach to detect subtle anomalies that might be missed by single-indicator checks. By training a model on features like certificate validity, key length, JA3/JA3S hashes, and connection volume, it can combine multiple weak signals into a single, actionable risk score for efficient analyst triaging.
    answer_sources:
      - Zeek ssl.log
      - Zeek conn.log
      - Zeek ja3.log
      - Zeek ja3s.log
      - Network egress points
      - Corporate Wi-Fi access points
      - VPN concentrators
      - MDM (Mobile Device Management) proxy servers
      - Cloud Access Security Brokers (CASB)
      - Cellular network gateways (for corporate-liable devices backhauling traffic)
    range: last 90 days
    queries:
      - TRAIN Random Forest model with features (cert_duration, key_length, tls_version, cipher, ja3, ja3s, conn_duration, conn_bytes). APPLY model to live mobile TLS sessions. ALERT on high probability scores.
  - question: Are mobile devices connecting to known command and control server IP addresses?
    context: This question provides a direct method for detecting C2 activity by comparing outbound connections from mobile devices against a threat intelligence feed of known C2 server IPs. A successful match is a high-priority indicator of a compromised device communicating with its controller.
    answer_sources:
      - Zeek conn.log
      - Network egress points
      - VPN concentrators
      - MDM (Mobile Device Management) proxy servers
      - Corporate Wi-Fi gateways
      - Cellular network gateways (for corporate-liable devices backhauling traffic)
    range: last 90 days
    queries:
      - SEARCH Zeek conn.log WHERE source_ip IN mobile_ip_range AND destination_ip IN c2_threat_intel_feed. ALERT.
  - question: Is there network traffic from mobile devices exhibiting unusually regular, 'heartbeat'-like patterns in timing and data volume?
    context: This question aims to detect automated C2 communications, which often manifest as highly periodic connections with consistent data payloads (beacons). By calculating the coefficient of variation for inter-arrival times and data volumes, we can statistically identify machine-generated traffic that stands out from more random human-generated network activity.
    answer_sources:
      - Zeek conn.log
      - Network egress points
      - VPN concentrators
      - MDM (Mobile Device Management) proxy servers
      - Corporate Wi-Fi gateways
      - Cellular network gateways (for corporate-liable devices backhauling traffic)
    range: last 90 days
    queries:
      - GROUP conn.log by (src_ip, dst_ip, dst_port, proto) over 1-hour windows. CALCULATE coefficient_of_variation for inter-arrival_time and total_bytes. ALERT if both are below 1st_percentile_baseline.
  - question: Can a time-series anomaly detection model detect deviations from normal traffic patterns for a given client-server flow, indicating potential C2 beaconing?
    context: This question applies advanced machine learning to model the expected behavior of a specific network flow over time. A model like an LSTM autoencoder learns the normal sequence of traffic characteristics (e.g., timing, duration, volume). A high reconstruction error on live traffic indicates a significant deviation from the learned norm, flagging the flow as potential C2 beaconing.
    answer_sources:
      - Zeek conn.log
      - Network egress points
      - VPN concentrators
      - MDM (Mobile Device Management) proxy servers
      - Corporate Wi-Fi gateways
      - Cellular network gateways (for corporate-liable devices backhauling traffic)
    range: last 90 days
    queries:
      - FOR each client-server flow, TRAIN LSTM autoencoder on baseline traffic features (inter-arrival_time, duration, total_bytes). APPLY model to live traffic. ALERT on high reconstruction error.
  - question: Are mobile devices making DNS requests to malicious domains or using HTTP User-Agents associated with known malware?
    context: This question looks for explicit indicators of compromise within DNS and HTTP traffic. Matching DNS queries or User-Agent strings against threat intelligence lists and known malicious patterns provides a high-confidence method for detecting C2 communication or connections to malicious infrastructure.
    answer_sources:
      - Zeek dns.log
      - Zeek http.log
      - Internal DNS resolvers
      - Forward web proxies
      - Reverse proxies
      - Cloud Access Security Brokers (CASB)
    range: last 90 days
    queries:
      - SEARCH Zeek dns.log WHERE query IN malicious_domain_list. SEARCH Zeek http.log WHERE user_agent IN malicious_ua_list. ALERT on any match.
  - question: Are there DNS queries or HTTP User-Agent strings from mobile devices with unusually high entropy, suggesting encoded data?
    context: This question helps detect covert data tunneling, where C2 information is encoded into protocol fields not intended for bulk data. Legitimate DNS queries and User-Agents have a relatively low, non-random character distribution. High Shannon entropy indicates a string is more random-like, which is a hallmark of encrypted or encoded data being smuggled in these fields.
    answer_sources:
      - Zeek dns.log
      - Zeek http.log
      - Internal DNS resolvers
      - Forward web proxies
      - Reverse proxies
      - Cloud Access Security Brokers (CASB)
    range: last 90 days
    queries:
      - FOR each DNS query, CALCULATE entropy of query_name. ALERT if entropy > 99th_percentile_baseline. FOR each HTTP request, CALCULATE entropy of user_agent. ALERT if entropy > 99th_percentile_baseline.
  - question: Can unsupervised clustering identify anomalous DNS and HTTP requests from mobile devices that may represent C2 activity?
    context: This question uses an unsupervised machine learning approach (DBSCAN) to find outliers without pre-existing labels or signatures. By clustering requests based on features like string length, subdomain count, and entropy, we can identify requests that do not fit into any normal group. These "noise" points are anomalies that warrant investigation as potential C2.
    answer_sources:
      - Zeek dns.log
      - Zeek http.log
      - Internal DNS resolvers
      - Forward web proxies
      - Reverse proxies
      - Cloud Access Security Brokers (CASB)
    range: last 90 days
    queries:
      - CREATE feature set from dns.log (query_length, subdomain_count, query_entropy) and http.log (user_agent_length, user_agent_entropy). APPLY DBSCAN clustering. ALERT on points classified as noise/outliers.