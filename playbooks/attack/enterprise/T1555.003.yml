name: "T1555.003: Credentials from Web Browsers"
id: "6f5b9d3a-1c8e-4a7f-8b2c-9d0e1f7a4b6c"
description: "This playbook helps determine if an adversary has attempted to acquire credentials from web browsers on enterprise hosts. It provides investigative questions to detect this activity through various means, including identifying the use of known credential theft tools via file hashes or C2 connections, analyzing command-line and PowerShell scripts for strings and functions related to browser credential access, monitoring for unauthorized process access to browser credential databases, detecting the copying of credential store files to staging directories for lock file evasion, and correlating credential file access with subsequent suspicious outbound network connections indicative of data exfiltration."
type: "technique"
related:
  - "TA0006: Credential Access"
contributors:
  - "Zachary Szewczyk"
  - "Ask Sage"
created: "2025-10-01"
modified: "2025-10-01"
version: 1.0
tags: "none"
questions:
  - question: "Are there any process creation events matching known credential theft tool hashes or network connections to known malicious C2 infrastructure?"
    context: "This question uses threat intelligence to find high-confidence indicators of compromise. It checks if any executed files on endpoints are known credential theft tools (e.g., LaZagne, Mimikatz, WebBrowserPassView) by comparing their file hashes against a known-bad list. Simultaneously, it monitors all outbound network traffic for connections to IP addresses or domains that are identified on a threat intelligence feed as Command and Control (C2) servers."
    answer_sources:
      - "Windows Event ID 4688"
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "User workstations, servers with interactive logins, and network egress points."
    range: "last 90 days"
    queries:
      - search_technology: "SIEM Pseudocode"
        query: "SEARCH Windows Event ID 4688 | HASH(process_executable) | LOOKUP credential_thief_hashes WHERE match=true; SEARCH Zeek conn.log OR Zeek dns.log | LOOKUP c2_indicators WHERE match=true"
  - question: "Have any hosts made connections to rare domains shortly after an unusual process was launched?"
    context: "This question uses statistical analysis to uncover potentially malicious activity without relying on known indicators. It identifies domains that are very rarely visited across the entire enterprise. A connection to such a domain is suspicious. The suspicion level is increased significantly if this rare connection occurs within a few minutes of a new or unusual process starting on the same host, suggesting the process initiated the connection."
    answer_sources:
      - "Windows Event ID 4688"
      - "Zeek dns.log"
      - "User workstations, servers with interactive logins, and network egress points."
    range: "last 90 days"
    queries:
      - search_technology: "SIEM Pseudocode"
        query: "SEARCH Zeek dns.log | STATS count(host) by domain | WHERE count < enterprise_1st_percentile | JOIN host, time (within 5 mins) with (SEARCH Windows Event ID 4688)"
  - question: "Has a host exhibited a significant deviation from its baseline outbound network traffic patterns following a suspicious process creation event?"
    context: "This question uses machine learning to detect anomalous network behavior that could signal C2 communication. A time-series model learns the normal pattern of outbound network traffic (e.g., volume, frequency) for each host. An alert is generated if the model observes a significant spike or change in traffic that deviates from its prediction, especially if this anomaly occurs right after a suspicious process was created on that host."
    answer_sources:
      - "Windows Event ID 4688"
      - "Zeek conn.log"
      - "User workstations, servers with interactive logins, and network egress points."
    range: "last 90 days"
    queries:
      - search_technology: "ML Model Pseudocode"
        query: "TRAIN time_series_model on Zeek conn.log per host | PREDICT traffic | DETECT anomaly where actual_traffic > forecast_error_99th_percentile | CORRELATE with recent suspicious process from Event ID 4688"
  - question: "Do any command line executions or PowerShell script blocks contain strings, file paths, or API calls associated with accessing browser credentials?"
    context: "This question looks for direct evidence of credential theft attempts within command line arguments and PowerShell scripts. It uses regular expressions to search for specific keywords, such as default paths to browser credential databases (e.g., '...\\Google\\Chrome\\User Data\\Default\\Login Data'), the use of tools like 'sqlite3.exe' to query these databases, or calls to Windows APIs like 'CryptUnprotectData' used to decrypt stored credentials."
    answer_sources:
      - "Windows Event ID 4688"
      - "Windows Event ID 4104"
      - "All Windows endpoints and servers where PowerShell v5+ Script Block Logging is enabled."
    range: "last 90 days"
    queries:
      - search_technology: "SIEM Pseudocode"
        query: "SEARCH (Event ID 4688 OR Event ID 4104) | WHERE command_line or script_block MATCHES REGEX ('Login Data', 'sqlite3.exe', 'CryptUnprotectData')"
  - question: "Have there been any command line or PowerShell executions with unusually high entropy scores, suggesting obfuscation?"
    context: "This question aims to detect malicious code that has been intentionally obscured to evade signature-based detection. Shannon entropy measures the randomness of data; highly obfuscated or encrypted code has high entropy. By establishing a baseline for normal scripts and commands, this method can flag executions with abnormally high entropy scores for further investigation."
    answer_sources:
      - "Windows Event ID 4688"
      - "Windows Event ID 4104"
      - "All Windows endpoints and servers where PowerShell v5+ Script Block Logging is enabled."
    range: "last 90 days"
    queries:
      - search_technology: "SIEM Pseudocode"
        query: "SEARCH (Event ID 4688 OR Event ID 4104) | CALCULATE entropy(command_line or script_block) | WHERE entropy > baseline_98th_percentile"
  - question: "Can a machine learning model classify any PowerShell script blocks as malicious based on features indicative of credential theft?"
    context: "This question leverages a supervised machine learning model to automatically identify malicious PowerShell scripts. The model is trained on a dataset of known benign and malicious scripts, learning to recognize patterns based on features like script length, the frequency of suspicious keywords (e.g., 'Unprotect', 'logins.json'), API call patterns, and entropy. It can then classify new, unseen scripts in real-time."
    answer_sources:
      - "Windows Event ID 4104"
      - "All Windows endpoints and servers where PowerShell v5+ Script Block Logging is enabled."
    range: "last 90 days"
    queries:
      - search_technology: "ML Model Pseudocode"
        query: "INPUT Event ID 4104 script_block | EXTRACT features (length, keywords, entropy) | PREDICT classification using trained_model | ALERT where prediction=malicious and confidence > threshold"
  - question: "Has a non-browser process attempted to read a browser's credential database file?"
    context: "This is a high-fidelity detection method that requires enabling specific file access auditing (SACLs) on browser credential store files. Once enabled, the system will log every read attempt (Event ID 4663). This question filters those logs to alert any time a process that is NOT on a pre-defined whitelist of legitimate web browsers (e.g., chrome.exe, firefox.exe) accesses these sensitive files."
    answer_sources:
      - "Windows Event ID 4663"
      - "Windows Event ID 4688"
      - "File systems on all user workstations and servers. This requires enabling SACLs on user profile directories containing browser data (e.g., '*\\AppData\\Local\\Google\\Chrome\\User Data\\*')."
    range: "last 90 days"
    queries:
      - search_technology: "SIEM Pseudocode"
        query: "SEARCH Event ID 4663 | WHERE target_file MATCHES browser_credential_paths AND access_type=read AND process_name NOT IN (browser_whitelist)"
  - question: "Has a statistically rare process accessed a browser credential file?"
    context: "This question identifies suspicious access by focusing on rarity. Over a baseline period (e.g., 30 days), it calculates how frequently different processes access browser credential files. An alert is generated if a process that very rarely or has never accessed these files before (e.g., 'powershell.exe', 'cscript.exe') suddenly does so, as this deviates from normal operational behavior."
    answer_sources:
      - "Windows Event ID 4663"
      - "Windows Event ID 4688"
      - "File systems on all user workstations and servers. This requires enabling SACLs on user profile directories containing browser data (e.g., '*\\AppData\\Local\\Google\\Chrome\\User Data\\*')."
    range: "last 90 days"
    queries:
      - search_technology: "SIEM Pseudocode"
        query: "SEARCH Event ID 4663 for browser_credential_paths | STATS frequency(process_name) over 30d | ALERT where current_access_process_frequency < 5th_percentile"
  - question: "Does an anomaly detection model identify any unusual access patterns to browser credential files, considering the process, parent process, user, and time?"
    context: "This question uses an unsupervised machine learning model (e.g., Isolation Forest) to learn the complex, multi-featured patterns of normal access to browser credential files. The model considers who (user), what (process and parent process), and when (time of day) access typically occurs. It can then flag any access event that deviates significantly from this learned norm as a potential anomaly, without needing pre-defined rules."
    answer_sources:
      - "Windows Event ID 4663"
      - "Windows Event ID 4688"
      - "File systems on all user workstations and servers. This requires enabling SACLs on user profile directories containing browser data (e.g., '*\\AppData\\Local\\Google\\Chrome\\User Data\\*')."
    range: "last 90 days"
    queries:
      - search_technology: "ML Model Pseudocode"
        query: "INPUT features (process_name, parent_process, user, time_of_day) from Event ID 4663/4688 | PREDICT anomaly_score using isolation_forest_model | ALERT on high anomaly_score"
  - question: "Has a process been observed copying a browser credential store file to a temporary or staging directory?"
    context: "This question targets a common adversary technique used to bypass file locks. Since browsers often lock their credential databases while running, adversaries copy the file to a different location (like C:\\Windows\\Temp) to read it. This analytic looks for process creation events where a copy command ('copy', 'xcopy', 'Copy-Item') is used with a browser credential file as the source and a known staging directory as the destination."
    answer_sources:
      - "Windows Event ID 4688"
      - "Windows Event ID 4663"
      - "Temporary file locations (e.g., C:\\Windows\\Temp, C:\\Users\\Public, %APPDATA%\\Temp) and user profile directories on all Windows endpoints."
    range: "last 90 days"
    queries:
      - search_technology: "SIEM Pseudocode"
        query: "SEARCH Event ID 4688 | WHERE command_line MATCHES ('copy', 'xcopy', 'Copy-Item') AND source_path MATCHES browser_credential_paths AND destination_path MATCHES staging_dirs"
  - question: "Have any files with unusual names or extensions, consistent with browser credential stores, been created in common staging directories?"
    context: "This question provides an alternative way to detect the file staging technique. Instead of watching the copy command, it monitors file creation events within common temporary directories (e.g., C:\\Windows\\Temp). It flags the creation of any file that has a name or extension that is statistically rare for that directory but is consistent with browser credential files (e.g., 'Login Data', '.db', '.sqlite')."
    answer_sources:
      - "Windows Event ID 4688"
      - "Windows Event ID 4663"
      - "Temporary file locations (e.g., C:\\Windows\\Temp, C:\\Users\\Public, %APPDATA%\\Temp) and user profile directories on all Windows endpoints."
    range: "last 90 days"
    queries:
      - search_technology: "SIEM Pseudocode"
        query: "SEARCH file_creation_events in staging_dirs | STATS frequency(file_extension) | ALERT where new_file_extension is rare OR file_name matches ('Login Data')"
  - question: "Has a machine learning model detected the specific sequence of a credential file being copied to a staging area and then read by a process?"
    context: "This question uses a more advanced model to detect a specific multi-step attack chain. It looks for a sequence of events in order: (1) a process executes a command to copy a browser credential file, (2) a new file is created in a staging area, and (3) the same process (or its child) reads the newly created file. Detecting this entire sequence with high probability provides very strong evidence of malicious activity."
    answer_sources:
      - "Windows Event ID 4688"
      - "Windows Event ID 4663"
      - "Temporary file locations (e.g., C:\\Windows\\Temp, C:\\Users\\Public, %APPDATA%\\Temp) and user profile directories on all Windows endpoints."
    range: "last 90 days"
    queries:
      - search_technology: "ML Model Pseudocode"
        query: "DETECT sequence: [Event 4688: copy browser_db], THEN [File Create: staging_dir], THEN [Event 4663: read new_file] by same/child process | ALERT if sequence probability is high"
  - question: "Has a non-browser process read a credential file, followed shortly by an outbound network connection from the same host to a known malicious destination?"
    context: "This question correlates host-based activity with network activity for a high-confidence alert. It creates a rule that triggers when two conditions are met on the same host within a short time window (e.g., 5 minutes): (1) a non-browser process reads a credential file, and (2) the host initiates a network connection to a destination IP or domain that is on a threat intelligence feed of known C2 servers."
    answer_sources:
      - "Windows Event ID 4663"
      - "Windows Event ID 4688"
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Network egress points, firewalls, and host-level event logs on all endpoints where SACL auditing for browser credential files is enabled."
    range: "last 90 days"
    queries:
      - search_technology: "SIEM Pseudocode"
        query: "TRIGGER on Event 4663 where process is not browser and target is credential_file | WITHIN 5 mins on same host, SEARCH Zeek logs for connection to destination on C2_feed"
  - question: "Following a non-browser process reading a credential file, did the host make DNS queries for statistically rare domains?"
    context: "This question correlates suspicious file access with suspicious network behavior using statistical rarity instead of threat intelligence. It first identifies when a non-browser process reads a credential file. It then examines the subsequent DNS queries from that same host. If the host queries for a domain that is very rarely visited by any other host in the enterprise, the activity is flagged as potential exfiltration to a non-standard destination."
    answer_sources:
      - "Windows Event ID 4663"
      - "Windows Event ID 4688"
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Network egress points, firewalls, and host-level event logs on all endpoints where SACL auditing for browser credential files is enabled."
    range: "last 90 days"
    queries:
      - search_technology: "SIEM Pseudocode"
        query: "TRIGGER on Event 4663 where process is not browser | SEARCH subsequent Zeek dns.log from same host | LOOKUP domain_prevalence | ALERT if prevalence < 0.5%"
  - question: "After a credential file was accessed by a non-whitelisted process, did an ML model detect an anomalous spike in outbound data volume from that host?"
    context: "This question uses a machine learning model to specifically look for signs of data exfiltration immediately following credential access. When the trigger event occurs (a non-browser process reads a credential file), a time-series model begins monitoring the outbound data volume for that host. If the model detects a sudden, anomalous spike in bytes sent that exceeds a dynamic threshold, it generates a high-priority alert."
    answer_sources:
      - "Windows Event ID 4663"
      - "Windows Event ID 4688"
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Network egress points, firewalls, and host-level event logs on all endpoints where SACL auditing for browser credential files is enabled."
    range: "last 90 days"
    queries:
      - search_technology: "ML Model Pseudocode"
        query: "TRIGGER on Event 4663 where process is not browser | MONITOR Zeek conn.log 'orig_bytes' for that host | ALERT if time-series_model detects anomaly (e.g., > 3 std dev) within 10 mins"