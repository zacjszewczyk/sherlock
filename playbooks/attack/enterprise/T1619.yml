name: T1619: Cloud Storage Object Discovery
id: d8c5b1f0-644a-4a8b-987c-01a2b3c4d5e6
description: This playbook helps investigate whether an adversary has enumerated objects in cloud storage environments like AWS S3 or Azure Blob Storage. This is often an initial discovery step. Detections focus on identifying enumeration API calls originating from malicious IP addresses, the use of specific discovery tools, unusually high rates of enumeration calls, first-time enumeration activity by an identity, or enumeration that is immediately followed by data access, deletion, or permission changes.
type: technique
related:
- TA0007: Discovery
contributors:
- Zachary Szewczyk
- Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
- question: Are cloud storage enumeration API calls originating from IP addresses known to be malicious?
  context: Adversaries often use compromised infrastructure, public proxies, or TOR nodes to obscure their origin. Correlating cloud enumeration API calls with high-confidence threat intelligence feeds is a direct way to identify discovery attempts from known-bad sources. A match provides a strong signal of malicious intent.
  answer_sources:
  - AWS CloudTrail
  - Azure Activity Logs
  - Google Cloud Audit Logs
  - Zeek conn.log
  - Cloud provider management plane (for API logs), network egress points (for traffic logs), and threat intelligence subscription services.
  range: last 90 days
  queries:
  - pseudocode: |
      SEARCH cloud_audit_logs WHERE event_name IN ('ListObjectsV2', 'Microsoft.Storage/storageAccounts/listKeys/action')
      JOIN source_ip with threat_intelligence_feed ON ip_address
      RETURN matched_events
- question: Is an enumeration API call originating from an anomalous geographic location or Autonomous System (AS)?
  context: Legitimate administrative activity often originates from a predictable set of countries and network providers (ASNs). When an enumeration call comes from a location or ASN that is rare for a specific user or role, it may indicate a compromised account being used from an unusual location. This helps detect account takeovers used for discovery.
  answer_sources:
  - AWS CloudTrail
  - Azure Activity Logs
  - Google Cloud Audit Logs
  - Zeek conn.log
  - Cloud provider management plane (for API logs), network egress points (for traffic logs), and threat intelligence subscription services.
  range: last 90 days
  queries:
  - pseudocode: |
      FOR each enumeration_event
      ENRICH source_ip with geoip and ASN data
      COMPARE source_country, source_asn against 30-day baseline for user/role
      ALERT if country or ASN is below 5th percentile of frequency
- question: Does a machine learning model classify a cloud enumeration event as malicious?
  context: A supervised machine learning model can learn complex patterns that distinguish between benign and malicious enumeration activity. By training on features like IP reputation, location, time of day, and user history, the model can identify suspicious events with higher accuracy and fewer false positives than simple rules, providing a more confident signal for alerting.
  answer_sources:
  - AWS CloudTrail
  - Azure Activity Logs
  - Google Cloud Audit Logs
  - Zeek conn.log
  - Cloud provider management plane (for API logs), network egress points (for traffic logs), and threat intelligence subscription services.
  range: last 90 days
  queries:
  - pseudocode: |
      FOR each enumeration_event
      EXTRACT features (ip_rep, asn, country, tod, user_agent, identity_type, history)
      SCORE event with trained_classification_model
      ALERT if score > 0.85
- question: Are there processes or network connections that indicate the use of known cloud storage discovery tools?
  context: Adversaries and red teamers often use specialized tools like 's3scanner' or 'cloud_enum' to automate the discovery of cloud storage objects. Monitoring for the execution of these tools via their command-line arguments or for their unique User-Agent strings in network traffic is a direct way to detect their usage on endpoints or within the network.
  answer_sources:
  - Windows Event ID 4688
  - Zeek http.log
  - Zeek conn.log
  - User Endpoints, DevOps/Cloud Engineering Workstations, CI/CD Pipeline Servers, Virtual Desktop Infrastructure (VDI)
  range: last 90 days
  queries:
  - pseudocode: |
      SEARCH process_creation_logs WHERE command_line MATCHES ('s3scanner', 'cloud_enum', 'aws s3 ls --recursive')
      OR
      SEARCH http_logs WHERE user_agent MATCHES (known_tool_user_agents)
      RETURN matched_events
- question: Is a user executing cloud CLI commands with unusually complex or random-looking arguments?
  context: To evade simple signature-based detection, adversaries may obfuscate commands or use complex, scripted arguments. Calculating the Shannon entropy of command-line arguments for cloud CLI tools can quantify this complexity. A sudden spike in entropy for a given user can indicate an attempt to hide malicious discovery activity within seemingly legitimate tool usage.
  answer_sources:
  - Windows Event ID 4688
  - Zeek http.log
  - Zeek conn.log
  - User Endpoints, DevOps/Cloud Engineering Workstations, CI/CD Pipeline Servers, Virtual Desktop Infrastructure (VDI)
  range: last 90 days
  queries:
  - pseudocode: |
      FOR each cloud_cli_process_event (e.g., aws.exe)
      CALCULATE shannon_entropy of command_line_arguments
      COMPARE entropy_score to user's historical baseline (mean, stddev)
      ALERT if score > (mean + 3 * stddev)
- question: Is a request to a cloud API endpoint using a User-Agent string that has never been seen before?
  context: While legitimate applications have predictable User-Agent strings, custom adversary tooling or modified legitimate tools may use unique or anomalous strings. By building a model of all normally observed User-Agent strings, it's possible to flag any new, unseen string as an anomaly, which could represent a previously unknown discovery tool.
  answer_sources:
  - Windows Event ID 4688
  - Zeek http.log
  - Zeek conn.log
  - User Endpoints, DevOps/Cloud Engineering Workstations, CI/CD Pipeline Servers, Virtual Desktop Infrastructure (VDI)
  range: last 90 days
  queries:
  - pseudocode: |
      FOR each http_request to cloud_api_endpoint
      SCORE user_agent_string with one_class_svm_or_isolation_forest_model
      ALERT if model flags user_agent as anomaly
- question: Has a single user or IP address made an excessive number of enumeration calls in a short time?
  context: Automated discovery scripts or tools used by adversaries typically perform enumeration actions at a much higher rate than a human administrator would. Monitoring for a high volume of enumeration API calls from a single source IP or user identity within a short window (e.g., 5 minutes) can detect this brute-force discovery behavior.
  answer_sources:
  - AWS CloudTrail
  - Azure Activity Logs
  - Google Cloud Audit Logs
  - Zeek conn.log
  - Cloud provider audit logs (CloudTrail, etc.), identity and access management (IAM) services, and network flow log collectors (e.g., Zeek sensors at internet egress).
  range: last 90 days
  queries:
  - pseudocode: |
      COUNT enumeration_api_calls by source_ip, user_identity over 5_minute_window
      ALERT if count > 1000
- question: Is an identity performing an unusually high number of enumeration calls compared to its own history?
  context: Every identity (user or role) has a typical pattern of activity. A static threshold for enumeration might be too noisy for active administrators but too permissive for service accounts. By comparing the current rate of enumeration calls to the identity's own historical baseline (e.g., 99th percentile), we can detect activity that is anomalous for that specific identity, indicating a potential compromise or misuse.
  answer_sources:
  - AWS CloudTrail
  - Azure Activity Logs
  - Google Cloud Audit Logs
  - Zeek conn.log
  - Cloud provider audit logs (CloudTrail, etc.), identity and access management (IAM) services, and network flow log collectors (e.g., Zeek sensors at internet egress).
  range: last 90 days
  queries:
  - pseudocode: |
      FOR each identity
      COUNT enumeration_calls in a 60-minute sliding window
      COMPARE current_count to the 99th percentile of that identity's historical hourly counts
      ALERT if current_count > baseline_99th_percentile
- question: Is the total volume of enumeration activity across the entire environment higher than predicted?
  context: While individual user behavior can be noisy, the aggregate activity of an entire cloud environment is often more predictable. A time series forecasting model can predict the expected volume of enumeration calls for the next minute. If the observed volume significantly exceeds the prediction, it could indicate a large-scale, coordinated discovery campaign by one or more adversaries.
  answer_sources:
  - AWS CloudTrail
  - Azure Activity Logs
  - Google Cloud Audit Logs
  - Zeek conn.log
  - Cloud provider audit logs (CloudTrail, etc.), identity and access management (IAM) services, and network flow log collectors (e.g., Zeek sensors at internet egress).
  range: last 90 days
  queries:
  - pseudocode: |
      AGGREGATE count of all enumeration_api_calls per minute
      FEED into a trained time_series_forecasting_model (e.g., SARIMA)
      ALERT if observed_count > predicted_upper_confidence_bound
- question: Is an identity performing an enumeration action for the very first time?
  context: In mature environments, administrative roles and users settle into predictable patterns of behavior. An identity performing a discovery-related API call (like 'ListObjectsV2') for the first time in a long period (e.g., 90 days) is a significant event. It could represent an attacker using a compromised account to begin exploring the environment, making it a valuable signal for early-stage threat detection.
  answer_sources:
  - AWS CloudTrail
  - Azure Activity Logs
  - Google Cloud Audit Logs
  - Cloud audit logs, Identity and Access Management (IAM) role/policy configurations, and historical user activity databases/look-up tables.
  range: last 90 days
  queries:
  - pseudocode: |
      MAINTAIN lookup_table of users who have performed enumeration in last 90 days
      ON new enumeration_event
      ALERT if user NOT IN lookup_table
- question: Is an identity performing an action on a resource that is completely novel for that user?
  context: Adversaries exploring a new environment will likely access resources and use API calls that the legitimate user never has. By tracking the historical set of API calls and resources for each user, we can detect when an identity performs an enumeration call against a storage resource it has never touched before. A Jaccard similarity score of 0 for both the action and resource is a strong indicator of anomalous exploration.
  answer_sources:
  - AWS CloudTrail
  - Azure Activity Logs
  - Google Cloud Audit Logs
  - Cloud audit logs, Identity and Access Management (IAM) role/policy configurations, and historical user activity databases/look-up tables.
  range: last 90 days
  queries:
  - pseudocode: |
      FOR each new_enumeration_event(identity, api_call, resource_arn)
      FETCH historical_api_calls and historical_resource_arns for identity
      CALCULATE jaccard_similarity between {new_api_call, new_resource_arn} and historical sets
      ALERT if similarity_score == 0
- question: Is an identity's enumeration activity anomalous compared to its behavioral peers?
  context: Users with similar roles and responsibilities tend to exhibit similar behavior. By clustering identities into peer groups based on their IAM roles and API usage, we can establish a behavioral norm for each group. An identity performing enumeration actions at a rate that is a statistical outlier from its peers is highly suspicious, even if that activity doesn't violate other rules. This helps find the 'black sheep' whose behavior indicates a potential compromise.
  answer_sources:
  - AWS CloudTrail
  - Azure Activity Logs
  - Google Cloud Audit Logs
  - Cloud audit logs, Identity and Access Management (IAM) role/policy configurations, and historical user activity databases/look-up tables.
  range: last 90 days
  queries:
  - pseudocode: |
      CLUSTER identities into peer_groups based on IAM roles and API usage
      WITHIN each peer_group, calculate mean and stddev of enumeration activity
      FOR each identity, check if their enumeration_count > (group_mean + 3 * group_stddev)
      ALERT if identity is an outlier
- question: Is an enumeration event by an identity quickly followed by a high volume of data access, deletion, or permission changes?
  context: A key indicator of malicious intent is the sequence of actions. Benign enumeration is often for inventory or review. However, an adversary who performs discovery is likely to follow it up with actions on the objects they found, such as exfiltrating data (GetObject), deleting data (DeleteObject), or changing permissions (PutBucketPolicy). Correlating enumeration with these subsequent actions provides strong evidence of an attack in progress.
  answer_sources:
  - AWS CloudTrail
  - Azure Activity Logs
  - Google Cloud Audit Logs
  - Zeek conn.log
  - Cloud Storage Buckets/Containers, Cloud Audit Logs, Network Egress Points
  range: last 90 days
  queries:
  - pseudocode: |
      ON enumeration_event by an identity
      MONITOR for subsequent Get*, Delete*, or Put* calls from the same identity within 30 minutes
      ALERT if count of subsequent calls > 20
- question: Did an identity's data egress volume significantly increase after performing an enumeration action?
  context: After discovering valuable data in cloud storage, an adversary's next logical step is often exfiltration. A sharp spike in data egress volume from an identity immediately following an enumeration event is a strong signal of this 'discovery followed by exfiltration' pattern. This connects the discovery phase to the impact phase of an attack.
  answer_sources:
  - AWS CloudTrail
  - Azure Activity Logs
  - Google Cloud Audit Logs
  - Zeek conn.log
  - Cloud Storage Buckets/Containers, Cloud Audit Logs, Network Egress Points
  range: last 90 days
  queries:
  - pseudocode: |
      ON enumeration_event by an identity
      MONITOR data_egress_volume from that identity for the next 30 minutes
      COMPARE egress_volume to the identity's historical 30-minute baseline
      ALERT if egress_volume > 99th_percentile_of_baseline
- question: Is a user's sequence of API calls, including enumeration, considered anomalous by a behavioral model?
  context: Normal user activity can be modeled as common sequences of API calls. Adversarial behavior often deviates from these normal sequences. A sequence-based model (like an HMM or LSTM) trained on benign activity can detect when a user's real-time actions form an improbable sequence, such as a 'ListObjects' call followed by an unusual number of 'GetObject' calls. This provides a sophisticated method for detecting entire attack chains, not just single events.
  answer_sources:
  - AWS CloudTrail
  - Azure Activity Logs
  - Google Cloud Audit Logs
  - Zeek conn.log
  - Cloud Storage Buckets/Containers, Cloud Audit Logs, Network Egress Points
  range: last 90 days
  queries:
  - pseudocode: |
      MODEL user sessions as sequences of API calls
      TRAIN a sequence_anomaly_model (e.g., LSTM) on benign sequences
      SCORE new, live API call sequences with the model
      ALERT when the model assigns a low probability to an observed sequence