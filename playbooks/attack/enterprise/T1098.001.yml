name: T1098.001: Additional Cloud Credentials
id: f47ac10b-58cc-4372-a567-0e02b2c3d479
description: This playbook focuses on detecting malicious additions of cloud credentials for the purposes of establishing persistence or escalating privileges. Detections involve analyzing cloud audit logs (AWS, Azure, GCP) and endpoint events (Windows Event Logs). Key indicators include credential modifications from malicious IPs, anomalous process creations involving cloud CLIs, unusual user behavior (e.g., off-hours activity, impossible travel), and specific API call sequences indicative of privilege escalation paths.
type: technique
related:
- TA0003: Persistence
- TA0004: Privilege Escalation
contributors:
- Zachary Szewczyk
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
- question: Has a cloud credential modification event originated from a known malicious IP address, anonymizing proxy, or TOR exit node?
  context: Adversaries often use compromised infrastructure or anonymizing services to hide their true location when creating new credentials. Correlating the source IP of a credential modification event with threat intelligence feeds can directly identify suspicious activity, indicating that an external attacker may be attempting to establish persistence in the cloud environment.
  answer_sources:
  - AWS CloudTrail
  - AzureAD Audit Logs
  - Google Cloud Audit Logs
  - Zeek conn.log
  - Cloud IAM Service Endpoints
  - Internet Gateway
  - Threat Intelligence Platform
  - Cloud audit log aggregation platform
  range: last 90 days
  queries:
  - pseudocode: JOIN cloud_audit_logs ON sourceIPAddress WITH threat_intel_feed WHERE event_name IN ('CreateAccessKey', 'updateApplication') AND threat_intel.IP = cloud_audit_logs.sourceIPAddress
- question: Has a user performed a cloud credential modification from an anomalous or previously unseen Autonomous System Number (ASN)?
  context: Users typically operate from a predictable set of network locations (ASNs). A sudden increase in the diversity of source ASNs for a user's credential modification activity, or a modification from a completely new ASN, can indicate account takeover or that an adversary is using geographically distributed infrastructure. Calculating the entropy of the user's ASN history helps quantify this deviation from normal behavior.
  answer_sources:
  - AWS CloudTrail
  - AzureAD Audit Logs
  - Google Cloud Audit Logs
  - Zeek conn.log
  - Cloud IAM Service Endpoints
  - Internet Gateway
  - Threat Intelligence Platform
  - Cloud audit log aggregation platform
  range: last 90 days
  queries:
  - pseudocode: FOR each_user, PROFILE historical source_ASNs. ON new_credential_modification, CALCULATE Shannon_entropy of user_ASN_set. ALERT IF entropy > 95th_percentile OR new_ASN is novel.
- question: Does a credential modification event for a high-privilege user deviate significantly from their established patterns of activity regarding frequency, source country, and time-of-day?
  context: High-privilege users often have regular, predictable administrative patterns. By modeling these patterns using time-series analysis, we can detect when a new credential modification event is a statistical outlier. A large forecast error (residual) suggests the event is anomalous and doesn't fit the user's normal behavior, which could signal a compromise.
  answer_sources:
  - AWS CloudTrail
  - AzureAD Audit Logs
  - Google Cloud Audit Logs
  - Zeek conn.log
  - Cloud IAM Service Endpoints
  - Internet Gateway
  - Threat Intelligence Platform
  - Cloud audit log aggregation platform
  range: last 90 days
  queries:
  - pseudocode: MODEL high_privilege_user_activity (frequency, country, time_of_day). ON new_credential_modification, CALCULATE forecast_error. ALERT IF error is high across multiple features.
- question: Was a cloud CLI tool executed by an unauthorized user or on a non-administrative workstation?
  context: Cloud command-line interface (CLI) tools are powerful and should only be used by authorized administrators on designated workstations. Observing their execution by a non-administrative user or on a standard user endpoint is highly suspicious and could indicate a compromised endpoint is being used to manipulate the cloud environment.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 4104
  - AWS CloudTrail
  - AzureAD Audit Logs
  - Zeek conn.log
  - Administrative Workstations
  - Cloud-connected Application Servers
  - Endpoint Detection and Response (EDR) platform
  range: last 90 days
  queries:
  - pseudocode: SEARCH process_creation_events WHERE process_name IN ('aws.exe', 'az.exe', 'gcloud.exe') AND (user NOT IN 'Cloud Admins' OR host NOT IN 'Admin Workstations').
- question: Did a cloud CLI tool execute from an unusual or rare parent process?
  context: Legitimate administrative activity typically follows predictable process chains (e.g., an admin opens powershell.exe which then runs az.exe). An adversary, however, might execute a cloud CLI from an unusual parent process, such as a compromised Microsoft Office application. Identifying statistically rare parent-child process relationships involving cloud CLIs can uncover these malicious execution chains.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 4104
  - AWS CloudTrail
  - AzureAD Audit Logs
  - Zeek conn.log
  - Administrative Workstations
  - Cloud-connected Application Servers
  - Endpoint Detection and Response (EDR) platform
  range: last 90 days
  queries:
  - pseudocode: PROFILE parent_child_process_chains. ALERT IF chain includes_cloud_CLI AND frequency < 1st_percentile.
- question: Does a machine learning model classify the execution of a cloud CLI tool as malicious based on its context?
  context: By training a classifier on various features of a process execution event (parent process, command line arguments, user, host), a model can learn to distinguish between benign and malicious CLI usage. This approach can detect novel or complex attacks that may evade simpler rule-based detections.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 4104
  - AWS CloudTrail
  - AzureAD Audit Logs
  - Zeek conn.log
  - Administrative Workstations
  - Cloud-connected Application Servers
  - Endpoint Detection and Response (EDR) platform
  range: last 90 days
  queries:
  - pseudocode: APPLY ML_model to new_CLI_executions. FEATURES parent_process, command_line_entropy, user, host. ALERT IF classification is 'malicious' with high confidence.
- question: Was a credential modification performed by a service principal that is not explicitly authorized for identity management?
  context: In a well-architected cloud environment, only a small, designated set of service principals (e.g., CI/CD pipelines) should have permissions to modify credentials. A credential modification initiated by any other service principal is a significant security risk, as it could indicate that the principal has been compromised or misconfigured.
  answer_sources:
  - AWS CloudTrail
  - AzureAD Audit Logs
  - Google Cloud Audit Logs
  - Cloud IAM Service
  - Identity Provider (IdP) Systems
  - Cloud Audit Log Aggregation Platform
  range: last 90 days
  queries:
  - pseudocode: SEARCH credential_modification_events WHERE actor_type is 'ServicePrincipal' AND actor_name NOT IN 'Authorized Identity Managers'.
- question: Did an administrative identity perform a credential modification outside of their normal working hours?
  context: Administrators typically perform their duties within a consistent time window. An alert for a credential modification occurring at an unusual time (e.g., 3 AM for a user who works 9-to-5) can be a strong indicator of account compromise. This behavioral analytic helps detect adversaries who have stolen credentials and are operating in a different time zone.
  answer_sources:
  - AWS CloudTrail
  - AzureAD Audit Logs
  - Google Cloud Audit Logs
  - Cloud IAM Service
  - Identity Provider (IdP) Systems
  - Cloud Audit Log Aggregation Platform
  range: last 90 days
  queries:
  - pseudocode: PROFILE historical_activity_hours for each admin. ON new_credential_modification, ALERT IF event_hour is outside 5th-95th percentile.
- question: Does a credential modification event appear as a statistical outlier when clustered with other similar events?
  context: Benign credential modification activities tend to form clusters based on features like source network, time of day, and roles. Malicious activity often deviates from these patterns. Using a clustering algorithm like DBSCAN can automatically identify these anomalous events (noise points) that don't fit into any normal cluster.
  answer_sources:
  - AWS CloudTrail
  - AzureAD Audit Logs
  - Google Cloud Audit Logs
  - Cloud IAM Service
  - Identity Provider (IdP) Systems
  - Cloud Audit Log Aggregation Platform
  range: last 90 days
  queries:
  - pseudocode: CLUSTER credential_modification_events using DBSCAN. FEATURES source_ASN, time_of_day, actor_role, target_role. INVESTIGATE events marked as noise.
- question: Was a newly created cloud credential used from a geographic location that would require impossible travel from its creation point?
  context: This is a classic "impossible travel" scenario. If a credential is created in one location and then used moments later from a distant location, it's physically impossible for the legitimate user to have made that journey. This is a high-fidelity indicator that the created credential was immediately stolen and used by an adversary.
  answer_sources:
  - AWS CloudTrail
  - AzureAD SignIn Logs
  - Google Cloud Audit Logs (data_access)
  - Zeek conn.log
  - VPN Concentrators
  - Cloud Authentication Endpoints
  - Internet Gateway
  - Geolocation IP Database
  range: last 90 days
  queries:
  - pseudocode: ON credential_creation, log timestamp and source_IP. ON first_use, calculate travel_speed = distance(creation_IP, usage_IP) / time_delta. ALERT IF speed > 800 km/h.
- question: Was a newly created credential used for the first time from a country that is unusual for the associated user or the organization as a whole?
  context: The first use of a new credential from a completely new country for that user, especially if that country is a rare source of traffic for the entire organization, is highly suspect. It suggests the credential may have been compromised and is being used by an attacker in a different geographic region.
  answer_sources:
  - AWS CloudTrail
  - AzureAD SignIn Logs
  - Google Cloud Audit Logs (data_access)
  - Zeek conn.log
  - VPN Concentrators
  - Cloud Authentication Endpoints
  - Internet Gateway
  - Geolocation IP Database
  range: last 90 days
  queries:
  - pseudocode: PROFILE user_login_countries. ON first_use of new_credential, ALERT IF source_country is novel for user. ELEVATE IF source_country is rare for organization.
- question: Did the first login event using a new credential deviate from the user's established behavioral profile across multiple factors?
  context: A machine learning model can create a comprehensive behavioral profile for a user's logins, considering factors like country, network (ASN), user agent, and time of day. An outlier classification provides a strong, multi-faceted signal that the activity is anomalous and potentially malicious.
  answer_sources:
  - AWS CloudTrail
  - AzureAD SignIn Logs
  - Google Cloud Audit Logs (data_access)
  - Zeek conn.log
  - VPN Concentrators
  - Cloud Authentication Endpoints
  - Internet Gateway
  - Geolocation IP Database
  range: last 90 days
  queries:
  - pseudocode: MODEL user_login_behavior with One-Class SVM. ON first_use of new_credential, FEED login_features to model. ALERT IF classified as outlier.
- question: Has a user rapidly executed the specific API sequence of creating a new policy version, setting it as default, and then creating new credentials for a principal?
  context: This specific sequence of actions is a known privilege escalation pattern in AWS. An adversary might create a new, more permissive version of an existing policy, make it the active version, and then immediately create credentials for a user or role governed by that policy. Detecting this exact sequence is a high-fidelity indicator of an attempt to elevate privileges.
  answer_sources:
  - AWS CloudTrail
  - Azure Activity Logs
  - Google Cloud Audit Logs
  - Cloud IAM Service
  - Cloud Audit Log Aggregation Platform
  range: last 90 days
  queries:
  - pseudocode: DETECT sequence in user_session within 10_minutes 1. CreatePolicyVersion -> 2. SetDefaultPolicyVersion -> 3. CreateAccessKey/UpdateApplication.
- question: Did a credential modification occur as part of a statistically rare sequence of API calls?
  context: Benign administrative tasks often involve common, repeated sequences of API calls. Attackers, however, may use novel or unusual combinations of actions. By analyzing the frequency of API call n-grams (short sequences), we can identify when a credential modification is part of a sequence that is rarely, if ever, seen. This can uncover unknown attack patterns.
  answer_sources:
  - AWS CloudTrail
  - Azure Activity Logs
  - Google Cloud Audit Logs
  - Cloud IAM Service
  - Cloud Audit Log Aggregation Platform
  range: last 90 days
  queries:
  - pseudocode: CALCULATE probability of all 3-gram API sequences in 5-min windows. ALERT IF sequence includes credential_modification AND probability < 1st_percentile.
- question: Does a sequence of API calls involving credential modification fail to match learned patterns of normal behavior?
  context: An LSTM autoencoder can learn the complex, temporal patterns of normal API call sequences. When a new sequence of calls is fed into the model, it attempts to reconstruct it. A high reconstruction error means the model struggled to recognize the sequence, indicating it's a significant deviation from normal behavior.
  answer_sources:
  - AWS CloudTrail
  - Azure Activity Logs
  - Google Cloud Audit Logs
  - Cloud IAM Service
  - Cloud Audit Log Aggregation Platform
  range: last 90 days
  queries:
  - pseudocode: TRAIN LSTM_autoencoder on benign API_call_sequences. ON new_session, calculate reconstruction_error. ALERT IF error is high AND session contains credential_modification.
- question: Did a principal with a lower privilege level add credentials to a principal with a higher privilege level?
  context: This is a direct and unambiguous form of privilege escalation. By assigning a numerical score to each role based on its power, we can create a clear hierarchy. An event where a principal with a low score (e.g., 'Contributor') modifies the credentials of a principal with a high score (e.g., 'Global Admin') is a critical security violation.
  answer_sources:
  - AWS CloudTrail
  - AzureAD Audit Logs
  - Google Cloud Audit Logs
  - Identity Governance and Administration (IGA) Platform Data
  - Cloud IAM Service
  - Identity Governance and Administration (IGA) Platform
  range: last 90 days
  queries:
  - pseudocode: DEFINE role_hierarchy_scores. ON credential_modification, GET actor_role_score, target_role_score. ALERT IF actor_role_score < target_role_score.
- question: Does a credential modification event represent a statistically significant jump in privilege level compared to historical norms?
  context: By analyzing the historical distribution of privilege level differences between actor and target, we can establish a baseline. A new event that shows an unusually large positive jump in privilege (e.g., >3 standard deviations from the mean) is a statistical anomaly worth investigating.
  answer_sources:
  - AWS CloudTrail
  - AzureAD Audit Logs
  - Google Cloud Audit Logs
  - Identity Governance and Administration (IGA) Platform Data
  - Cloud IAM Service
  - Identity Governance and Administration (IGA) Platform
  range: last 90 days
  queries:
  - pseudocode: CALCULATE historical mean and std_dev of (target_role_score - actor_role_score). ALERT IF new_event_difference > (mean + 3 * std_dev).
- question: Did a credential modification create a new, structurally anomalous relationship in the identity and access management graph?
  context: The relationships between users, roles, and permissions can be modeled as a graph. A Graph Neural Network (GNN) can learn the normal structural properties of this graph. An attacker creating new credentials might create an edge (a new permission) that is structurally out of place, which the GNN can detect as a structural anomaly.
  answer_sources:
  - AWS CloudTrail
  - AzureAD Audit Logs
  - Google Cloud Audit Logs
  - Identity Governance and Administration (IGA) Platform Data
  - Cloud IAM Service
  - Identity Governance and Administration (IGA) Platform
  range: last 90 days
  queries:
  - pseudocode: MODEL IAM as a graph. TRAIN GNN on normal graph structure. ON credential_modification (new_edge), ALERT IF GNN flags the new edge as a structural anomaly.
- question: Following a credential modification, did the identity immediately perform a high-impact or destructive action?
  context: A common adversary pattern is to gain new credentials and then immediately use them for a malicious purpose, such as disabling audit logs or deleting backups. By correlating a recent credential modification with subsequent high-impact activity, we can quickly detect the potential weaponization of newly acquired access.
  answer_sources:
  - AWS CloudTrail
  - Azure Activity Logs
  - Google Cloud Audit Logs
  - Zeek conn.log
  - Cloud IAM Service
  - Sensitive Data Repositories (e.g., S3 Buckets, Databases)
  - Cloud Administration Endpoints
  range: last 90 days
  queries:
  - pseudocode: ON credential_modification, START 60-min timer for that identity. ALERT IF identity performs action from 'High-Impact API List' within that window.
- question: Was there a statistically significant spike in sensitive API calls from an identity immediately after its credentials were modified?
  context: A sudden, anomalous burst of activity right after a credential change is a strong indicator of abuse. Comparing the post-change activity rate to the identity's historical baseline provides a data-driven way to detect this suspicious behavior.
  answer_sources:
  - AWS CloudTrail
  - Azure Activity Logs
  - Google Cloud Audit Logs
  - Zeek conn.log
  - Cloud IAM Service
  - Sensitive Data Repositories (e.g., S3 Buckets, Databases)
  - Cloud Administration Endpoints
  range: last 90 days
  queries:
  - pseudocode: PROFILE historical hourly rate of sensitive_API_calls for each privileged identity. AFTER credential_modification, ALERT IF next_hour_rate > 99th_percentile.
- question: After a credential modification, did the identity interact with a type of resource it has never accessed before?
  context: An administrator for databases is not expected to suddenly start modifying networking rules. If, right after a credential modification, an identity begins performing actions on resource types outside its established domain, it strongly suggests the access is being used by someone unfamiliar with the identity's normal role—likely an attacker.
  answer_sources:
  - AWS CloudTrail
  - Azure Activity Logs
  - Google Cloud Audit Logs
  - Zeek conn.log
  - Cloud IAM Service
  - Sensitive Data Repositories (e.g., S3 Buckets, Databases)
  - Cloud Administration Endpoints
  range: last 90 days
  queries:
  - pseudocode: PROFILE historical set of (action, resource_type) for each identity. AFTER credential_modification, ALERT IF new (action, resource_type) tuple is novel for that identity.
- question: Did a temporary or federated identity modify the credentials of a permanent, cloud-native identity?
  context: It is highly irregular for a temporary session (like one from an AssumedRole) or a federated user to alter the long-term credentials of a permanent cloud identity. This action breaks the typical security model and could be an attempt to establish a more durable form of persistence from a temporarily compromised session.
  answer_sources:
  - AWS CloudTrail
  - AzureAD Audit Logs
  - Zeek conn.log
  - Identity Federation Service (e.g., ADFS)
  - Cloud STS Endpoints
  - Cloud IAM Service
  range: last 90 days
  queries:
  - pseudocode: ALERT IF actor_identity_type IN ('AssumedRole', 'FederatedUser') AND action is credential_modification AND target_identity_type is 'IAMUser'/'ServicePrincipal'.
- question: Are temporary or federated identities, as a group, performing credential modifications at a disproportionately high rate compared to permanent identities?
  context: This analytic looks for systemic abuse patterns. If temporary sessions across the environment are being used to modify credentials far more often than permanent accounts, it could point to a widespread misconfiguration or a campaign by an adversary who has found a way to abuse temporary access.
  answer_sources:
  - AWS CloudTrail
  - AzureAD Audit Logs
  - Zeek conn.log
  - Identity Federation Service (e.g., ADFS)
  - Cloud STS Endpoints
  - Cloud IAM Service
  range: last 90 days
  queries:
  - pseudocode: CALCULATE ratio = (cred_mod_events / total_events). COMPARE ratio_temporary_identities vs ratio_permanent_identities. ALERT IF ratio_temporary is statistically significantly higher.
- question: Does a machine learning model predict a high probability of malicious intent for a temporary session that is modifying credentials?
  context: A logistic regression model can assess the risk of a session based on multiple features. A temporary session from an unusual network that has a short duration and performs a credential modification might be flagged with a high probability of being malicious, allowing for a more nuanced detection than a simple rule.
  answer_sources:
  - AWS CloudTrail
  - AzureAD Audit Logs
  - Zeek conn.log
  - Identity Federation Service (e.g., ADFS)
  - Cloud STS Endpoints
  - Cloud IAM Service
  range: last 90 days
  queries:
  - pseudocode: MODEL probability of credential_modification using logistic_regression. FEATURES session_type, source_ASN, duration. ALERT IF session_type is temporary AND action is credential_modification AND probability_score is in top 5%.