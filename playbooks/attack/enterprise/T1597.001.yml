name: T1597.001: Threat Intel Vendors
id: a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d
description: |
  This playbook helps investigate whether an adversary has gathered reconnaissance information from threat intelligence vendors to enable attacks. It focuses on identifying suspicious activities such as connection attempts from malicious or first-seen IPs, authentication events using compromised credentials, HTTP requests matching signatures of scanning tools like Nmap or Metasploit, statistically significant spikes in traffic to specific services following vulnerability disclosures, password spraying or credential stuffing attacks, and targeted scanning against assets recently mentioned in public reports or intelligence feeds.
type: technique
related:
  - TA0043: Reconnaissance
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Are external connections or authentication events originating from IP addresses or involving usernames found on threat intelligence feeds of malicious infrastructure or compromised credentials?
    context: |
      This question aims to detect direct matches between observed network activity and known indicators of compromise (IOCs). Adversaries often leverage previously compromised infrastructure or credentials obtained from data breaches. By continuously cross-referencing incoming connection and authentication data against curated threat intelligence, analysts can quickly identify and respond to high-confidence threats.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Windows Event ID 4624
      - Windows Event ID 4625
      - Internet Gateway
      - VPN Concentrators
      - External-facing Authentication Services (e.g., ADFS, OWA)
      - Domain Controllers
    range: last 90 days
    queries:
      - query: "FOR each external connection OR authentication event, CHECK if source_ip OR username EXISTS in threat_intel_feeds"
  - question: Is there an external IP address exhibiting an anomalously high ratio of failed to successful logins, potentially indicating a brute-force or credential stuffing attempt?
    context: |
      This question uses statistical analysis to identify suspicious authentication patterns that may not be caught by simple signature-based rules. A high failure-to-success ratio for a single IP is a strong indicator of an adversary attempting to guess passwords or use a list of stolen credentials. Correlating this with usernames from known breaches further increases the confidence that the activity is malicious.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Windows Event ID 4624
      - Windows Event ID 4625
      - Internet Gateway
      - VPN Concentrators
      - External-facing Authentication Services (e.g., ADFS, OWA)
      - Domain Controllers
    range: last 90 days
    queries:
      - query: "CALCULATE failed_login_ratio per source_ip over 1_hour_window. FLAG ip if ratio > 99th_percentile. INCREASE risk if username in breach_list."
  - question: Can machine learning models identify high-risk authentication events based on a combination of contextual features like IP reputation, time, location, and credential compromise status?
    context: |
      This question leverages machine learning to build a more sophisticated detection model that can identify malicious login attempts by considering multiple features simultaneously. Unlike simple rules or statistical thresholds, a trained classifier can learn complex, non-linear patterns indicative of an attack, potentially catching novel or evasive techniques. Flagging events with a high probability score allows for prioritized investigation.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Windows Event ID 4624
      - Windows Event ID 4625
      - Internet Gateway
      - VPN Concentrators
      - External-facing Authentication Services (e.g., ADFS, OWA)
      - Domain Controllers
    range: last 90 days
    queries:
      - query: "SCORE new authentication events using trained logistic_regression_model. FLAG event if malicious_probability > 0.9."
  - question: Are there any inbound HTTP requests containing User-Agent strings or URI paths that match known reconnaissance or vulnerability scanning tools?
    context: |
      This question focuses on detecting the use of common scanning tools by matching their unique signatures in web traffic logs. Adversaries frequently use tools like Nmap, Metasploit, or Nuclei for initial reconnaissance. Identifying these signatures provides a high-confidence indicator that an external entity is actively probing the organization's web-facing applications for vulnerabilities.
    answer_sources:
      - Zeek http.log
      - Zeek conn.log
      - Public-facing Web Servers
      - Application Gateways
      - Web Application Firewalls (WAFs)
    range: last 90 days
    queries:
      - query: "SEARCH http_logs for user_agent OR uri_path MATCHING regex for known_scanning_tools (e.g., nmap, nuclei, metasploit)."
  - question: Is any external IP address generating HTTP requests with an unusually high variety of URI paths, suggesting automated directory scanning or fuzzing?
    context: |
      This question uses a statistical measure, Shannon entropy, to detect automated scanning behavior that might not use a known tool signature. Directory traversal and fuzzing attacks often involve requesting a large number of non-existent or random-looking paths, resulting in high entropy. Flagging IPs with high URI entropy, especially when correlated with scanning across multiple ports, can uncover reconnaissance activity.
    answer_sources:
      - Zeek http.log
      - Zeek conn.log
      - Public-facing Web Servers
      - Application Gateways
      - Web Application Firewalls (WAFs)
    range: last 90 days
    queries:
      - query: "CALCULATE shannon_entropy of uri_paths per source_ip over 5_minute_window. FLAG ip if entropy > 98th_percentile. CORRELATE with multi-port scanning."
  - question: Can unsupervised machine learning identify anomalous clusters of HTTP traffic that represent previously unknown scanning tools or reconnaissance techniques?
    context: |
      This question employs unsupervised learning (k-means clustering) to establish a baseline of normal web traffic behavior and then identify deviations from it. This approach is powerful for detecting novel or customized attack tools that lack known signatures. Traffic that doesn't fit into established 'normal' clusters is flagged as anomalous, allowing analysts to investigate and potentially uncover new adversary TTPs.
    answer_sources:
      - Zeek http.log
      - Zeek conn.log
      - Public-facing Web Servers
      - Application Gateways
      - Web Application Firewalls (WAFs)
    range: last 90 days
    queries:
      - query: "CLUSTER http_log data using k-means on features (method, status, length, uri_depth). ANALYZE outlier clusters for new scanning_patterns."
  - question: Following the disclosure of a new vulnerability, is there a high volume of connection attempts to the affected port from a single source IP?
    context: |
      This question provides a rapid, targeted response to new threat intelligence. When a vulnerability is announced, adversaries often begin mass scanning the internet for unpatched systems. By immediately deploying a rule to monitor the specific port and count connection attempts, security teams can quickly detect and block opportunistic scanning and exploitation attempts related to the new vulnerability.
    answer_sources:
      - Zeek conn.log
      - Zeek notice.log
      - Network Perimeter Firewalls
      - Demilitarized Zone (DMZ) services
      - Public IP address space
    range: last 90 days
    queries:
      - query: "AFTER CTI report on new_vulnerability_port, COUNT connection_attempts to that port per source_ip. ALERT if count > 100 in 5_minutes."
  - question: Is there a statistically significant spike in the number of unique external IPs connecting to any public-facing service, indicating widespread scanning?
    context: |
      This question uses time series analysis to detect anomalous increases in connection volume that could indicate mass scanning. By establishing a baseline of normal traffic (moving average and standard deviation), the system can automatically flag any hourly traffic volume that is statistically improbable. This method is effective for detecting 'low and slow' scanning or widespread interest in a particular service, which might not be tied to a specific, recent CTI report.
    answer_sources:
      - Zeek conn.log
      - Zeek notice.log
      - Network Perimeter Firewalls
      - Demilitarized Zone (DMZ) services
      - Public IP address space
    range: last 90 days
    queries:
      - query: "FOR each service, CALCULATE moving_average and std_dev of unique_source_ips per hour. ALERT if current_hour_count > (moving_average + 3 * std_dev)."
  - question: Does the observed traffic volume for a critical service significantly deviate from the volume predicted by a machine learning forecasting model?
    context: |
      This question uses advanced time series forecasting to create a highly accurate prediction of expected traffic, accounting for trends and seasonality (e.g., time of day, day of week). When the actual observed traffic volume falls far outside the model's predicted range, it signals a strong anomaly that could be an exploitation attempt or mass scanning. This method is more sensitive than simple standard deviation-based alerts and can reduce false positives.
    answer_sources:
      - Zeek conn.log
      - Zeek notice.log
      - Network Perimeter Firewalls
      - Demilitarized Zone (DMZ) services
      - Public IP address space
    range: last 90 days
    queries:
      - query: "TRAIN forecasting_model (e.g., Prophet) on historical connection_volume. ALERT if observed_volume significantly exceeds forecasted_prediction_interval."
  - question: Is any single source IP generating a high number of failed logins across multiple user accounts in a short time frame, indicating a password spraying attack?
    context: |
      This question aims to detect a classic password spraying attack using a simple, effective rule. In a password spray, an adversary tries one or a few common passwords against many different usernames. This behavior creates a distinct pattern: one IP, many users, many failures. A threshold-based rule is highly effective at catching this specific TTP with low false positives.
    answer_sources:
      - Windows Event ID 4624
      - Windows Event ID 4625
      - Domain Controllers
      - VPN servers
      - Single Sign-On (SSO) platforms
      - Externally accessible applications (e.g., Outlook Web Access)
    range: last 90 days
    queries:
      - query: "FROM a single source_ip, COUNT failed_logins (event 4625) and distinct_usernames in 10_minutes. ALERT if failed_logins > 10 AND distinct_usernames > 5."
  - question: Are there any source IPs with a statistically anomalous number of failed logins, and are the targeted accounts consistent with corporate username formats or known breached credentials?
    context: |
      This question uses statistical outlier detection to identify suspicious IPs without relying on fixed thresholds. This can help find attackers who are attempting to stay 'under the radar' of simple rules. By identifying IPs with an abnormally high failure rate and then enriching that data—checking if usernames follow a corporate pattern or appear in breach lists—analysts can build a stronger case for malicious intent.
    answer_sources:
      - Windows Event ID 4624
      - Windows Event ID 4625
      - Domain Controllers
      - VPN servers
      - Single Sign-On (SSO) platforms
      - Externally accessible applications (e.g., Outlook Web Access)
    range: last 90 days
    queries:
      - query: "IDENTIFY source_ips with outlier failed_login_counts (e.g., > 99th percentile). FOR these IPs, CHECK if usernames match corporate_format OR exist in breach_data."
  - question: Can a machine learning classifier distinguish between benign failed logins and malicious credential-based attacks by analyzing features of the authentication attempt?
    context: |
      This question leverages a supervised machine learning model to provide a more nuanced and accurate detection of credential attacks. By training on features like the rate of attempts, number of unique users, time between attempts, and IP reputation, the model can learn the subtle differences between a user who forgot their password and an automated attack script. This allows for more confident, automated responses like blocking the source IP.
    answer_sources:
      - Windows Event ID 4624
      - Windows Event ID 4625
      - Domain Controllers
      - VPN servers
      - Single Sign-On (SSO) platforms
      - Externally accessible applications (e.g., Outlook Web Access)
    range: last 90 days
    queries:
      - query: "CLASSIFY failed_login events using a trained_model (e.g., Random Forest). FLAG or BLOCK events classified as high-probability_attack."
  - question: Is a known malicious IP address attempting to connect to a high-value or recently exposed internal asset?
    context: |
      This question focuses on protecting critical or newly vulnerable assets by correlating inbound connections with two key pieces of information: a 'watch list' of important internal assets and a threat intelligence feed of malicious IPs. A match between these two lists is a very high-fidelity signal that a known adversary is specifically targeting a sensitive part of the infrastructure, warranting immediate attention.
    answer_sources:
      - Zeek conn.log
      - Zeek http.log
      - Asset Management Database
      - Public DNS records
      - Network infrastructure mentioned in public reports or job postings
    range: last 90 days
    queries:
      - query: "FOR connections to assets on 'watch_list', CHECK if source_ip exists in CTI_feed_of_malicious_ips. ALERT on match."
  - question: Following a public mention, has there been a statistically significant increase in connection volume or variety directed at a specific high-value asset?
    context: |
      This question uses change point detection, a statistical method, to identify when the behavior of traffic to a specific asset has fundamentally changed. After an asset is mentioned in a press release, job posting, or vulnerability report, it may attract adversary attention. A sudden, sustained increase in connection volume is a strong indicator of this targeted interest, even if the sources are not on a known threat list.
    answer_sources:
      - Zeek conn.log
      - Zeek http.log
      - Asset Management Database
      - Public DNS records
      - Network infrastructure mentioned in public reports or job postings
    range: last 90 days
    queries:
      - query: "FOR assets on 'watch_list', BASELINE daily connection_volume. AFTER public mention, run change_point_detection. ALERT on significant upward shift."
  - question: Can an anomaly detection model (autoencoder) identify network connections to high-value assets that deviate from learned normal behavior?
    context: |
      This question uses an autoencoder, a type of neural network, to learn a deep representation of 'normal' traffic to a critical asset. The model is trained to reconstruct normal connection patterns accurately. When a new connection attempt is made (e.g., from an unusual location, using an odd port, with an atypical duration), the model will fail to reconstruct it well, resulting in a high 'reconstruction error'. This error serves as a powerful anomaly score, capable of detecting novel and sophisticated attacks that other methods would miss.
    answer_sources:
      - Zeek conn.log
      - Zeek http.log
      - Asset Management Database
      - Public DNS records
      - Network infrastructure mentioned in public reports or job postings
    range: last 90 days
    queries:
      - query: "TRAIN autoencoder on normal traffic to high-value_asset. IN production, calculate reconstruction_error for new connections. ALERT on high_error."