name: 'T1597.001: Threat Intel Vendors'
id: 'a7c9e0f1-b8d2-4e6a-9f4b-c1d0e8f2a3b9'
description: 'This playbook helps investigate whether an adversary has gathered reconnaissance information from threat intelligence vendors to enable attacks. This includes detecting connection attempts from new or known malicious IPs, identifying the use of compromised credentials, spotting HTTP requests from known scanning tools (like Nmap or Nuclei), observing spikes in traffic to services after a vulnerability disclosure, detecting password spraying or credential stuffing attacks, and identifying targeted scanning against assets recently mentioned in public sources.'
type: 'technique'
related:
- 'TA0043: Reconnaissance'
contributors:
- 'Zachary Szewczyk'
- 'Ask Sage'
created: '2025-10-01'
modified: '2025-10-01'
version: 1.0
tags:
- 'none'
questions:
- question: "Are external connection attempts or authentication events originating from IP addresses or involving usernames listed on threat intelligence feeds?"
  context: "This question aims to identify direct threats by cross-referencing incoming traffic and login attempts with known malicious indicators. A match on an ingested feed of malicious IPs or compromised credentials provides a high-confidence signal that an adversary is attempting to leverage pre-existing intelligence for initial access or reconnaissance."
  answer_sources:
  - 'Zeek conn.log'
  - 'Zeek dns.log'
  - 'Windows Event ID 4624'
  - 'Windows Event ID 4625'
  - 'Internet Gateway'
  - 'VPN Concentrators'
  - 'External-facing Authentication Services (e.g., ADFS, OWA)'
  - 'Domain Controllers'
  range: 'last 90 days'
  queries:
  - 'SEARCH external connection logs (Zeek conn.log) and authentication logs (Windows Event ID 4624/4625). JOIN source IP and username against threat intelligence feeds of malicious IPs and compromised credentials. ALERT on match.'
- question: "Are there any external IP addresses exhibiting an anomalously high ratio of failed to successful logins?"
  context: "This question seeks to uncover brute-force or password spraying attempts that may not use known malicious IPs. By calculating the ratio of failed to successful logins and comparing it to a baseline, analysts can identify suspicious activity from unknown sources. This statistical anomaly becomes a stronger indicator if the associated usernames are also known to be part of a public data breach."
  answer_sources:
  - 'Zeek conn.log'
  - 'Zeek dns.log'
  - 'Windows Event ID 4624'
  - 'Windows Event ID 4625'
  - 'Internet Gateway'
  - 'VPN Concentrators'
  - 'External-facing Authentication Services (e.g., ADFS, OWA)'
  - 'Domain Controllers'
  range: 'last 90 days'
  queries:
  - 'FOR each external source IP, CALCULATE ratio of failed logins (Event ID 4625) to successful logins (Event ID 4624) over 1-hour windows. FLAG IPs with a ratio in the 99th percentile. INCREASE risk score if usernames are on a known breach list.'
- question: "Can we use a machine learning model to predict and identify malicious login events in real-time?"
  context: "This question explores a proactive approach to detect sophisticated authentication attacks. A logistic regression model can learn complex patterns from various features (IP reputation, time of day, geolocation, etc.) to distinguish malicious logins from benign ones. This allows for the detection of novel or evasive attacks that symbolic or simple statistical methods might miss, flagging events with a high probability of being malicious for immediate review."
  answer_sources:
  - 'Zeek conn.log'
  - 'Zeek dns.log'
  - 'Windows Event ID 4624'
  - 'Windows Event ID 4625'
  - 'Internet Gateway'
  - 'VPN Concentrators'
  - 'External-facing Authentication Services (e.g., ADFS, OWA)'
  - 'Domain Controllers'
  range: 'last 90 days'
  queries:
  - 'SCORE new login events (Event ID 4624/4625) using a trained logistic regression model. USE features like IP reputation, time, geolocation, user agent, and breach list status. ALERT if predicted malicious probability > $$ 0.9 $$'
- question: "Are public-facing web servers receiving HTTP requests that contain signatures of known reconnaissance or vulnerability scanning tools?"
  context: "This question focuses on detecting the active use of automated scanning tools against web infrastructure. By searching for specific User-Agent strings and URI patterns (e.g., from Nmap, Metasploit, Nuclei), analysts can identify reconnaissance activities that often precede an attack. This provides an early warning of an adversary's interest in the organization's web-facing assets."
  answer_sources:
  - 'Zeek http.log'
  - 'Zeek conn.log'
  - 'Public-facing Web Servers'
  - 'Application Gateways'
  - 'Web Application Firewalls (WAFs)'
  range: 'last 90 days'
  queries:
  - 'SEARCH web logs (Zeek http.log) for User-Agent strings or URI paths matching regular expressions for known scanning tools (e.g., nmap, nuclei, metasploit). ALERT on match.'
- question: "Are any external IP addresses exhibiting high-entropy URI requests, indicative of web directory scanning or fuzzing?"
  context: "This question aims to identify automated scanning behavior by analyzing the randomness of requested web paths. A high Shannon entropy score for URIs from a single source IP suggests the client is not a normal user browsing the site but an automated tool systematically searching for hidden files or directories. Correlating this with connections to many ports strengthens the evidence of malicious reconnaissance."
  answer_sources:
  - 'Zeek http.log'
  - 'Zeek conn.log'
  - 'Public-facing Web Servers'
  - 'Application Gateways'
  - 'Web Application Firewalls (WAFs)'
  range: 'last 90 days'
  queries:
  - 'FOR each source IP in web logs (Zeek http.log), CALCULATE Shannon entropy of requested URIs in a 5-minute window. FLAG IPs with entropy in the 98th percentile. CORRELATE with connection logs (Zeek conn.log) to check for multi-port scanning.'
- question: "Can we use unsupervised machine learning to identify anomalous web traffic patterns indicative of new or unknown scanning tools?"
  context: "This question seeks to detect novel reconnaissance tools that do not have known signatures. By using a clustering algorithm like k-means to profile normal user traffic based on features like request method and URI depth, analysts can identify outliers or new clusters. These anomalies represent deviations from normal behavior and may correspond to previously unseen scanning techniques."
  answer_sources:
  - 'Zeek http.log'
  - 'Zeek conn.log'
  - 'Public-facing Web Servers'
  - 'Application Gateways'
  - 'Web Application Firewalls (WAFs)'
  range: 'last 90 days'
  queries:
  - 'CLUSTER web traffic (Zeek http.log) using k-means on features like request method, status code, and URI depth. ANALYZE outlier traffic or new clusters to identify potential unknown scanning activity.'
- question: "Are we observing a sudden, high volume of connection attempts to a specific port shortly after a CTI report detailed a vulnerability for that service?"
  context: "This question provides a timely and context-aware method for detecting targeted scanning. When a new vulnerability is disclosed for a specific service or port, adversaries often begin scanning the internet for vulnerable systems. A rule that alerts on a high number of connection attempts to that specific port from a single IP provides a strong, actionable signal of exploit-related reconnaissance."
  answer_sources:
  - 'Zeek conn.log'
  - 'Zeek notice.log'
  - 'Network Perimeter Firewalls'
  - 'Demilitarized Zone (DMZ) services'
  - 'Public IP address space'
  range: 'last 90 days'
  queries:
  - 'UPON CTI report for vulnerability on a port, COUNT connection attempts (Zeek conn.log) to that port from each external IP. ALERT if count exceeds 100 in a 5-minute window.'
- question: "Is there a statistically significant spike in the number of unique source IPs connecting to any of our public-facing services?"
  context: "This question helps to identify widespread scanning activity that might not be visible when looking at a single source IP. By baselining the normal hourly rate of unique connecting IPs for each service and alerting when the current rate exceeds a statistical threshold (e.g., three standard deviations above the moving average), analysts can detect distributed scanning campaigns or the initial phase of a large-scale attack."
  answer_sources:
  - 'Zeek conn.log'
  - 'Zeek notice.log'
  - 'Network Perimeter Firewalls'
  - 'Demilitarized Zone (DMZ) services'
  - 'Public IP address space'
  range: 'last 90 days'
  queries:
  - 'FOR each public service, CREATE a time series of unique source IPs per hour. CALCULATE a 24-hour moving average and standard deviation. ALERT if current count is > 3 standard deviations above the moving average.'
- question: "Can a time series forecasting model detect anomalous traffic volume to critical services that may indicate scanning or exploitation?"
  context: "This question leverages predictive analytics to find subtle anomalies in traffic volume. By training a model (like Prophet or LSTM) on historical connection data, we can forecast the expected traffic volume. An alert is generated when the actual observed traffic significantly deviates from the model's prediction, which can indicate a developing attack, especially if it coincides with a recent vulnerability disclosure."
  answer_sources:
  - 'Zeek conn.log'
  - 'Zeek notice.log'
  - 'Network Perimeter Firewalls'
  - 'Demilitarized Zone (DMZ) services'
  - 'Public IP address space'
  range: 'last 90 days'
  queries:
  - 'FOR critical services, TRAIN a time series forecasting model on historical connection volume (Zeek conn.log). ALERT if observed volume significantly exceeds the forecasted prediction interval.'
- question: "Is a single source IP generating a high number of failed logins across many different user accounts, indicating a password spraying attack?"
  context: "This question aims to detect a classic password spraying attack, a common initial access technique. A symbolic rule that looks for a one-to-many relationship—one source IP to many accounts with failed logins—within a short time frame is a highly effective and low-false-positive method for identifying this specific type of brute-force attack."
  answer_sources:
  - 'Windows Event ID 4624'
  - 'Windows Event ID 4625'
  - 'Domain Controllers'
  - 'VPN servers'
  - 'Single Sign-On (SSO) platforms'
  - 'Externally accessible applications (e.g., Outlook Web Access)'
  range: 'last 90 days'
  queries:
  - 'SEARCH for a single source IP generating > 10 failed logins (Event ID 4625) for > 5 distinct user accounts within a 10-minute window. ALERT on this pattern.'
- question: "Are there any source IPs with a statistically outlier rate of failed logins, and are they targeting usernames that match a common corporate format?"
  context: "This question uses statistical analysis to find potential brute-force or password spraying activity without relying on a fixed threshold. By identifying IPs with an unusually high rate of failed logins compared to the general population, analysts can uncover attacks. The suspicion is further increased if the targeted accounts follow a predictable pattern (e.g., first.last), suggesting the attacker is guessing usernames."
  answer_sources:
  - 'Windows Event ID 4624'
  - 'Windows Event ID 4625'
  - 'Domain Controllers'
  - 'VPN servers'
  - 'Single Sign-On (SSO) platforms'
  - 'Externally accessible applications (e.g., Outlook Web Access)'
  range: 'last 90 days'
  queries:
  - 'IDENTIFY source IPs with an outlier count of failed logins (Event ID 4625) per hour. CHECK if targeted usernames match a common format (e.g., first.last).'
- question: "Can a machine learning classifier distinguish between normal failed logins and credential-based attacks like password spraying or credential stuffing?"
  context: "This question proposes using a supervised model to automate the detection of credential attacks. By training a model like a Random Forest on features such as the number of unique usernames per IP, time between attempts, and IP reputation, the system can learn the subtle differences between benign user errors and malicious attacks, enabling more accurate and automated detection and response."
  answer_sources:
  - 'Windows Event ID 4624'
  - 'Windows Event ID 4625'
  - 'Domain Controllers'
  - 'VPN servers'
  - 'Single Sign-On (SSO) platforms'
  - 'Externally accessible applications (e.g., Outlook Web Access)'
  range: 'last 90 days'
  queries:
  - 'TRAIN a classification model (e.g., Random Forest) to classify failed logins (Event ID 4625). USE features like unique usernames per IP, time deltas, and IP reputation. FLAG high-probability attacks.'
- question: "Are we seeing connection attempts from known malicious IPs to specific, high-value assets that were recently mentioned in public sources?"
  context: "This question focuses on highly targeted threats. Adversaries often scan for assets that have been recently exposed through public disclosures, such as job postings or press releases. By maintaining a 'watch list' of these assets and alerting on any connection attempts from IPs on a threat intelligence feed, security teams can rapidly identify when an adversary is acting on this public information."
  answer_sources:
  - 'Zeek conn.log'
  - 'Zeek http.log'
  - 'Asset Management Database'
  - 'Public DNS records'
  - 'Network infrastructure mentioned in public reports or job postings'
  range: 'last 90 days'
  queries:
  - 'MAINTAIN a watch list of high-value/exposed asset IPs. ALERT on any connection attempt (Zeek conn.log) to a watched asset from a source IP on a malicious CTI feed.'
- question: "Has there been a statistically significant change in connection volume to a high-value asset immediately following its mention in a public report?"
  context: "This question uses change point detection to identify when an asset starts receiving unusual attention. After an asset is publicly mentioned, a sudden and sustained increase in connection volume is a strong indicator of targeted reconnaissance. This statistical approach can detect interest from a wide range of unknown actors, not just those on a pre-existing threat feed."
  answer_sources:
  - 'Zeek conn.log'
  - 'Zeek http.log'
  - 'Asset Management Database'
  - 'Public DNS records'
  - 'Network infrastructure mentioned in public reports or job postings'
  range: 'last 90 days'
  queries:
  - 'FOR assets on the watch list, ESTABLISH baseline connection volume. After a public mention, USE change point detection on the volume time series to identify a significant upward shift.'
- question: "Can an autoencoder model detect anomalous network connections to high-value assets that deviate from normal traffic patterns?"
  context: "This question proposes using an unsupervised anomaly detection model to identify novel or unexpected activity. An autoencoder is trained on the normal network traffic patterns for a specific asset. Any new connection that the model cannot accurately reconstruct (i.e., has a high reconstruction error) is flagged as an anomaly. This can uncover previously unseen reconnaissance or exploit attempts that don't match any known signature."
  answer_sources:
  - 'Zeek conn.log'
  - 'Zeek http.log'
  - 'Asset Management Database'
  - 'Public DNS records'
  - 'Network infrastructure mentioned in public reports or job postings'
  range: 'last 90 days'
  queries:
  - 'FOR high-value assets, TRAIN an autoencoder on baseline network traffic (Zeek conn.log). FLAG new connections that produce a high reconstruction error, indicating they are anomalous.'