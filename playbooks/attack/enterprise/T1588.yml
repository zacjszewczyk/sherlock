name: T1588: Obtain Capabilities
id: a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d
description: This playbook helps determine if an adversary is obtaining capabilities to support their operation. It focuses on detecting activities such as outbound network connections to known malicious infrastructure (malware distribution points, C2s), execution of known adversarial tools (like Cobalt Strike or Metasploit), use of suspicious SSL/TLS certificates (self-signed, typosquatted, short validity), and correlated event sequences indicating a file download followed by execution and network beaconing from a user-writable directory.
type: technique
related:
- TA0042: Resource Development
contributors:
- Zachary Szewczyk
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
- question: Is an internal host communicating with known malicious IPs, domains, or downloading known malicious files?
  context: This question seeks to identify direct communication with adversary infrastructure by comparing network, DNS, and file transfer logs against high-confidence threat intelligence. A match indicates a potential compromise or an attempt to download malicious tools or malware.
  answer_sources:
  - Zeek conn.log
  - Zeek dns.log
  - Zeek files.log
  - Internet gateways, egress firewalls, corporate DNS resolvers, and web proxies
  range: last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH network_logs, dns_logs, file_logs | JOIN with threat_intel_watchlist ON (ip, domain, file_hash) | WHERE match_found
- question: Are users downloading files with unusually high-entropy filenames or statistically rare MIME types?
  context: This question aims to uncover attempts to obfuscate malicious payloads. High-entropy filenames can suggest the use of Domain Generation Algorithms (DGAs) or other obfuscation techniques. Downloads of rare file types, such as executables ('application/x-dosexec'), are anomalous in most corporate environments and may indicate a user being tricked into downloading malware.
  answer_sources:
  - Zeek files.log
  - Internet gateways, egress firewalls, corporate DNS resolvers, and web proxies
  range: last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH file_logs | CALCULATE shannon_entropy(filename) | FILTER entropy > 99th_percentile | OR | CALCULATE frequency(mime_type) | FILTER frequency < 5th_percentile AND mime_type = 'application/x-dosexec'
- question: Has any internal host exhibited an anomalous spike in outbound data transfer volume?
  context: This question helps detect potential data exfiltration or the download of large malicious toolsets. By modeling normal data transfer behavior for each host, significant deviations (e.g., more than three standard deviations above the forecast) can be flagged as suspicious, especially if the destination is a low-reputation or newly seen domain.
  answer_sources:
  - Zeek conn.log
  - Internet gateways, egress firewalls, corporate DNS resolvers, and web proxies
  range: last 90 days
  queries:
  - technology: pseudocode
    query: FORECAST data_transfer_volume per host | SEARCH network_logs | WHERE actual_volume > (forecasted_volume + 3 * standard_deviation) | ENRICH with destination_reputation
- question: Is a process being executed on a host that matches known malicious tool signatures, command-line arguments, or file hashes?
  context: This question looks for direct evidence of malicious tool execution (e.g., Cobalt Strike, Metasploit) by matching process creation events against a database of known indicators. This includes searching for specific command-line patterns (like encoded PowerShell commands) and comparing process executable hashes against threat intelligence feeds.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 1 (Sysmon)
  - Domain Controllers, user workstations, and application servers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH process_creation_events | FILTER command_line MATCHES (regex_list) OR process_hash IN (malicious_hash_list)
- question: Has a common parent process (like winword.exe or outlook.exe) spawned a statistically rare or suspicious child process?
  context: This question aims to detect process execution anomalies that are common in phishing and lateral movement. Adversaries often abuse legitimate applications to launch malicious child processes (e.g., Outlook spawning cmd.exe). By baselining normal parent-child relationships, any statistically rare pairings (e.g., occurring less than 1% of the time) can be identified as highly suspicious.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 1 (Sysmon)
  - Domain Controllers, user workstations, and application servers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: BASELINE parent_child_process_frequency | SEARCH process_creation_events | WHERE parent_child_frequency < 1%_threshold
- question: Are there process creation events that a machine learning model classifies as suspicious based on their features?
  context: This question uses a machine learning approach to identify malicious process execution that may not match known signatures. By training a model on features like command-line length and entropy, a wider range of novel or obfuscated malicious activity can be flagged for analyst review based on a calculated probability score.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 1 (Sysmon)
  - Domain Controllers, user workstations, and application servers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: STREAM process_creation_events | EXTRACT_FEATURES (cmd_line_length, entropy, etc.) | PREDICT with ML_model | WHERE prediction_score > high_confidence_threshold
- question: Is network traffic using SSL/TLS certificates or JA3/JA3S hashes associated with known C2 frameworks?
  context: This question attempts to identify C2 communications by inspecting SSL/TLS certificate details (issuer, subject, serial number) and client/server fingerprints (JA3/JA3S). These artifacts can often be matched against threat intelligence for known adversary infrastructure, like the default certificates used by Cobalt Strike.
  answer_sources:
  - Zeek ssl.log
  - Zeek x509.log
  - Internet gateways, encrypted traffic inspection points (e.g., SSL/TLS offloading proxies), internal Certificate Authorities, and DNS resolvers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH ssl_logs, x509_logs | WHERE certificate_details IN (c2_defaults_list) OR ja3_hash IN (malicious_ja3_list)
- question: Are there any observed SSL/TLS certificates that appear to be typosquatting a legitimate domain or have an unusually short validity period?
  context: This question helps detect adversary attempts to impersonate legitimate services. By checking for small differences between a certificate's subject name and the organization's domains (typosquatting), and by flagging certificates with very short lifetimes (a common tactic to evade blocklists), suspicious infrastructure can be identified.
  answer_sources:
  - Zeek x509.log
  - Internet gateways, encrypted traffic inspection points (e.g., SSL/TLS offloading proxies), internal Certificate Authorities, and DNS resolvers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH x509_logs | CALCULATE levenshtein_distance(subject, internal_domains) | WHERE distance < 3 AND issuer IS NOT trusted | OR | WHERE validity_period < 30_days AND issuer IS NOT trusted
- question: Can anomalous clusters of SSL/TLS certificates be identified based on their technical attributes?
  context: This question uses unsupervised machine learning to find groups of suspicious certificates that don't match any known patterns. By clustering certificates based on features like validity duration, key length, and algorithms, outlier clusters can be isolated. These clusters may represent a single adversary's campaign-specific TTP for generating certificates.
  answer_sources:
  - Zeek x509.log
  - Internet gateways, encrypted traffic inspection points (e.g., SSL/TLS offloading proxies), internal Certificate Authorities, and DNS resolvers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: EXTRACT_FEATURES from x509_logs | CLUSTER with DBSCAN | INVESTIGATE outlier_clusters
- question: Has a correlated sequence of events occurred on a host: file download, execution from a temp directory, and subsequent outbound connection?
  context: This question looks for a classic 'drive-by' or phishing payload execution chain. By creating a correlation rule that triggers on this specific sequence (download of an executable, process creation from a temporary user directory, and an immediate network connection) within a short time window, analysts can detect the initial stage of a compromise with high confidence.
  answer_sources:
  - Zeek conn.log
  - Zeek files.log
  - Windows Event ID 4688
  - Windows Event ID 1 (Sysmon)
  - User workstations, public-facing web servers, and egress points to the internet
  range: last 90 days
  queries:
  - technology: pseudocode
    query: CORRELATE on hostname over 5_minutes | WHERE event_1 = (file_download AND mime_type = 'exe') AND event_2 = (process_create AND path IN temp_dirs) AND event_3 = (outbound_connection)
- question: Is there any evidence of C2 beaconing, characterized by periodic outbound connections with uniform timing and size?
  context: This question aims to detect the 'heartbeat' of malware communicating with its C2 server. This activity, known as beaconing, often manifests as highly regular network traffic. By calculating the standard deviation of time between connections ('jitter') and data size, connections with very low variance can be identified as potential C2 channels, especially from non-browser processes.
  answer_sources:
  - Zeek conn.log
  - Zeek files.log
  - Windows Event ID 4688
  - Windows Event ID 1 (Sysmon)
  - User workstations, public-facing web servers, and egress points to the internet
  range: last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH outbound_connections from non-browsers | GROUP by source, destination | CALCULATE stddev(inter_arrival_time), stddev(byte_size) | WHERE stddev(inter_arrival_time) < 10th_percentile AND stddev(byte_size) < 10th_percentile
- question: Does a real-time sequence of user activity (download, execution, network connection) match a known malicious pattern according to a sequence analysis model?
  context: This question uses advanced sequence analysis (like a Hidden Markov Model) to detect malicious TTPs. The model is trained to recognize the probability of state transitions in a malicious event chain. By feeding it live, correlated host and network events, it can calculate the likelihood that an observed sequence represents a malicious attack pattern, allowing for the detection of complex adversary behavior.
  answer_sources:
  - Zeek conn.log
  - Zeek files.log
  - Windows Event ID 4688
  - Windows Event ID 1 (Sysmon)
  - User workstations, public-facing web servers, and egress points to the internet
  range: last 90 days
  queries:
  - technology: pseudocode
    query: STREAM correlated_events (file, process, network) | PREDICT with HMM_model | WHERE probability > confidence_threshold