name: T1559.001: Component Object Model
id: 5a7e1f9b-6d4c-4a3b-8f2c-1e9d0a7b6c5d
description: This playbook helps investigate whether an adversary is executing code using the Component Object Model (COM). This can involve direct execution through known malicious COM objects, hijacking legitimate COM objects, or using COM for lateral movement. Indicators include suspicious process creation events involving known CLSIDs or ProgIDs, common COM host processes spawning script interpreters or LOLBAS, unusual network connections from COM server processes, unauthorized network logons following RPC traffic, and registry modifications to COM-related keys immediately preceding application launches.
type: technique
related:
- TA0002: Execution
contributors:
- Zachary Szewczyk
- Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
- question: Are there any process creation events that match known malicious COM objects based on CLSIDs, ProgIDs, or file hashes?
  context: This question aims to identify high-fidelity indicators of malicious COM execution by comparing command-line arguments and process hashes from process creation events against a threat intelligence feed of known malicious indicators. A match strongly suggests the use of a documented adversary tool or technique leveraging COM.
  answer_sources:
  - Windows Event ID 4688
  - User Workstations
  - Critical Application Servers
  - Domain Controllers
  range: Last 90 days
  queries:
  - technology: pseudocode
    query: search process_creation_logs | where command_line contains (known_malicious_clsids OR known_malicious_progids) OR process_hash in (known_malicious_com_hashes)
- question: Have any statistically rare COM CLSIDs been observed in process command lines across the enterprise?
  context: This question helps uncover novel or unknown malicious COM objects by focusing on rarity. Adversaries may use custom or seldom-seen COM objects for execution. By baselining the prevalence of all CLSIDs observed in command lines, any CLSID that appears infrequently is flagged as an anomaly worthy of investigation, as it deviates from normal software behavior.
  answer_sources:
  - Windows Event ID 4688
  - User Workstations
  - Critical Application Servers
  - Domain Controllers
  range: Last 30 days
  queries:
  - technology: pseudocode
    query: search process_creation_logs | parse command_line for clsid | calculate prevalence(clsid) over 30 days | filter clsid where prevalence < 5th_percentile
- question: Can a machine learning model identify process creation events indicative of malicious COM execution based on features like parent process, command-line entropy, and CLSID rarity?
  context: This question leverages machine learning to detect complex patterns of malicious COM execution that may evade simpler symbolic or statistical checks. By training a model on a variety of features, it can learn the subtle characteristics of malicious activity and score new events in real-time, providing a more nuanced and potentially proactive detection capability.
  answer_sources:
  - Windows Event ID 4688
  - User Workstations
  - Critical Application Servers
  - Domain Controllers
  range: Last 90 days
  queries:
  - technology: pseudocode
    query: stream process_creation_events | extract_features(parent_process, cmd_entropy, clsid_rarity) | score with ML_model | alert where score > 0.9
- question: Has a common COM host process spawned a script interpreter or a known Living Off the Land Binary (LOLBAS)?
  context: This question focuses on a common abuse pattern where adversaries use legitimate COM host processes (like dllhost.exe or svchost.exe) to proxy execution for malicious scripts or binaries. This parent-child relationship is often highly anomalous and can indicate an attempt to evade defenses by masquerading under a trusted process.
  answer_sources:
  - Windows Event ID 4688
  - User Workstations
  - Application Servers
  - Web Servers
  - Domain Controllers
  range: Last 90 days
  queries:
  - technology: pseudocode
    query: search process_creation_logs | where parent_process in (com_hosts) AND child_process in (script_interpreters OR lolbas)
- question: Has a known COM host process spawned a child process with command-line arguments that are statistically rare or have never been seen before?
  context: This question aims to detect anomalous execution by baselining the typical behavior of COM host processes. While a COM host spawning a child process might be normal, the specific child process or its command-line arguments may be unique to malicious activity. Detecting new or low-frequency combinations helps identify deviations from established normal behavior.
  answer_sources:
  - Windows Event ID 4688
  - User Workstations
  - Application Servers
  - Web Servers
  - Domain Controllers
  range: Last 30 days
  queries:
  - technology: pseudocode
    query: search process_creation_logs where parent_process in (com_hosts) | baseline frequency of (child_process, child_arguments) over 30 days | alert on new_combinations or combinations_with_frequency < 1%
- question: Can anomalous child process activity from COM hosts be identified by clustering process features like command-line length and entropy?
  context: This question uses unsupervised machine learning to find outliers in the behavior of COM host child processes. By grouping similar processes together based on their characteristics, any process that does not fit well into a cluster (i.e., is classified as noise or forms a very small cluster) represents a significant deviation from the norm and warrants investigation.
  answer_sources:
  - Windows Event ID 4688
  - User Workstations
  - Application Servers
  - Web Servers
  - Domain Controllers
  range: Last 90 days
  queries:
  - technology: pseudocode
    query: search process_creation_logs where parent_process in (com_hosts) | create_feature_vectors(cmd_length, arg_count, entropy) | apply DBSCAN_clustering | investigate noise_points and small_clusters
- question: Has a common COM host process initiated a network connection to a destination on a threat intelligence list?
  context: This question seeks to identify command and control (C2) or data exfiltration activity being proxied through a legitimate COM process. By correlating process execution with network logs and threat intelligence, analysts can detect when a trusted process like 'dllhost.exe' makes a connection to a known malicious IP or domain.
  answer_sources:
  - Windows Event ID 4688
  - Zeek conn.log
  - Zeek dns.log
  - Endpoint Devices
  - Network Egress Points (Firewalls/Gateways)
  - DNS Servers
  range: Last 90 days
  queries:
  - technology: pseudocode
    query: join (search process_creation_logs where process_name in (com_hosts)) with (search network_logs) on host, time | where destination_ip or destination_domain in (threat_intel_feed)
- question: Is a COM host process exhibiting anomalous network behavior, such as connecting to a rare port or sending an unusually large amount of data?
  context: This question helps detect suspicious network activity from COM hosts by establishing a baseline of normal behavior. An adversary might use a COM host for C2 on a non-standard port or to exfiltrate large volumes of data. Alerting on deviations from the established baseline for destination ports or data volume can uncover such covert activity.
  answer_sources:
  - Windows Event ID 4688
  - Zeek conn.log
  - Zeek dns.log
  - Endpoint Devices
  - Network Egress Points (Firewalls/Gateways)
  - DNS Servers
  range: Last 30 days
  queries:
  - technology: pseudocode
    query: search network_logs where process_name in (com_hosts) | baseline destination_ports and data_volume_percentiles over 30 days | alert where current_port not in baseline_ports or current_volume > 95th_percentile
- question: Does time-series analysis of network traffic from COM host processes reveal anomalous spikes in data volume or connection counts?
  context: This question applies anomaly detection to network traffic patterns over time to find behavior indicative of C2 or data exfiltration. A sudden, sharp spike in outbound data or connection frequency from COM hosts that cannot be explained by normal operations is a strong indicator of malicious activity that may be missed by simple thresholding.
  answer_sources:
  - Windows Event ID 4688
  - Zeek conn.log
  - Zeek dns.log
  - Endpoint Devices
  - Network Egress Points (Firewalls/Gateways)
  - DNS Servers
  range: Last 90 days
  queries:
  - technology: pseudocode
    query: aggregate network_logs by hour for process_name in (com_hosts) | apply time_series_anomaly_detection_model(data_volume, connection_count) | alert on significant_deviations_from_forecast
- question: Has a network logon (Logon Type 3) occurred on a server from an unauthorized source shortly after a connection on the RPC Endpoint Mapper port (TCP/135)?
  context: This question is designed to detect lateral movement via DCOM. An adversary often queries the RPC Endpoint Mapper to find services to interact with. Correlating this initial reconnaissance on TCP/135 with a subsequent network logon from a source IP not on an approved administrative list can reveal unauthorized remote COM-based access.
  answer_sources:
  - Zeek conn.log
  - Windows Event ID 4624
  - Domain Controllers
  - Member Servers
  - Internal Network Segments
  - VPN Concentrators
  range: Last 90 days
  queries:
  - technology: pseudocode
    query: join (search network_logs where dest_port=135) with (search logon_events where logon_type=3) on dest_host | where logon_time is within 5_mins of connection_time AND source_ip not in (authorized_admin_ips)
- question: Have any new or statistically rare DCOM/RPC connections (TCP/135) been observed between hosts in the environment?
  context: This question aims to identify unusual lateral movement paths by modeling DCOM/RPC interactions as a graph. Any new connection between two hosts that have never communicated this way before, or a connection that happens very infrequently, is anomalous and could represent an adversary exploring or moving through the network.
  answer_sources:
  - Zeek conn.log
  - Windows Event ID 4624
  - Domain Controllers
  - Member Servers
  - Internal Network Segments
  - VPN Concentrators
  range: Last 30 days
  queries:
  - technology: pseudocode
    query: search network_logs where dest_port=135 | build graph of source_dest_pairs over 30 days | alert on new_edges or edges with frequency < 5th_percentile
- question: Has a DCOM/RPC connection been made that bridges two previously separate network communities or operational clusters?
  context: This question uses graph analysis and community detection to identify high-risk lateral movement. Networks often have distinct clusters of hosts (e.g., web servers, domain controllers). A connection that links two of these previously isolated clusters is highly suspicious and may indicate an adversary moving from a compromised segment to a different, high-value one.
  answer_sources:
  - Zeek conn.log
  - Windows Event ID 4624
  - Domain Controllers
  - Member Servers
  - Internal Network Segments
  - VPN Concentrators
  range: Last 90 days
  queries:
  - technology: pseudocode
    query: build_network_graph from network_logs where dest_port=135 | apply community_detection_algorithm | alert on new_edge connecting two distinct_communities
- question: Has a registry modification to a COM CLSID key been immediately followed by the launch of the associated application on the same host?
  context: This question targets COM hijacking for persistence or execution. Adversaries may modify the registry keys for a COM object to point to their malicious code. When a legitimate application tries to use that object, the adversary's code is executed instead. Detecting this sequence of a registry write followed by a related process launch is a strong indicator of this technique.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 4657
  - User Workstations
  - Terminal Servers
  - Enterprise Registry Hives
  range: Last 90 days
  queries:
  - technology: pseudocode
    query: search registry_events where object_name contains 'CLSID' | for each event, search process_creation_logs on same_host within 5_mins for related_application_launch | alert on match
- question: Has any host exhibited an anomalous spike in the number of modifications to COM-related registry keys?
  context: This question provides a broader, statistical approach to detecting COM-related tampering. While a single modification might be missed, a large number of modifications in a short period could indicate an automated script or tool attempting to hijack multiple COM objects. This is detected by baselining normal registry modification rates and alerting on significant deviations.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 4657
  - User Workstations
  - Terminal Servers
  - Enterprise Registry Hives
  range: Last 7 days
  queries:
  - technology: pseudocode
    query: for each host, count COM_registry_modifications_per_hour | calculate moving_average and std_dev over 7 days | alert where current_hour_count > (moving_average + 3*std_dev)
- question: Can a sequence analysis model detect an improbable series of events, such as a rare registry write to a CLSID key followed by an application launch?
  context: This question uses advanced machine learning to identify COM hijacking by understanding normal sequences of system events. A model trained on typical user and system behavior can recognize a sequence of events as highly improbable (e.g., modifying a system COM object and then immediately launching an unrelated application). Such low-probability sequences are flagged as suspicious.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 4657
  - User Workstations
  - Terminal Servers
  - Enterprise Registry Hives
  range: Last 90 days
  queries:
  - technology: pseudocode
    query: stream system_events (process, file, registry) | feed into sequence_analysis_model (HMM/LSTM) | alert on sequences with low_probability_score