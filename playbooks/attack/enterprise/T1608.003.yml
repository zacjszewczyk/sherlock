name: T1608.003: Install Digital Certificate
id: 5b4c1a2e-8d6f-4c9b-9a7d-3e5f1b0c6d4a
description: This playbook focuses on detecting adversaries acquiring and installing digital certificates for their infrastructure. Detection methods include identifying outbound connections to servers with known malicious certificates, analyzing connections for suspicious certificate attributes (e.g., typosquatting, short validity, free CAs on newly registered domains), identifying statistical outliers in certificate usage (e.g., first-seen issuers, unusual entropy), detecting internal hosts communicating with an anomalous number of destinations using suspicious certificates, and monitoring for unusual certificate installation activities on corporate servers (e.g., outside change windows, by non-administrative accounts).
type: technique
related:
- TA0042: Resource Development
contributors:
- Zachary Szewczyk
- Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
- question: Have any internal systems established an outbound SSL/TLS connection with a remote server whose certificate hash or server name matches a known-malicious indicator from a threat intelligence feed?
  context: This question aims to identify direct communication with known adversary infrastructure. An exact match against a high-confidence threat intelligence feed is a strong indicator of compromise. This action provides the initial, high-fidelity alert that subsequent actions can enrich.
  answer_sources:
  - Zeek ssl.log
  - Zeek x509.log
  - Zeek conn.log
  - Network Egress/Ingress Points (Firewalls, Proxies)
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      EXTRACT cert_hash from x509_logs
      EXTRACT sni from ssl_logs
      JOIN connection_logs on uid
      LOOKUP cert_hash, sni against malicious_ioc_feed
      ALERT on match
- question: For any connection matching a known malicious indicator, how common is communication with that destination IP or domain across the enterprise?
  context: This question adds crucial context to an IOC match. A connection to a malicious indicator that has never or rarely been seen before is significantly more alarming than a connection to a potentially compromised but frequently visited site. This helps prioritize alerts by focusing on novel, high-risk connections.
  answer_sources:
  - Zeek conn.log
  - Network Egress/Ingress Points (Firewalls, Proxies)
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR each IOC_match_alert
      GET destination_ip, destination_domain
      COUNT connections to destination_ip, destination_domain over last 90 days
      ENRICH alert with connection_count and rarity_percentile
- question: How reliable and relevant is the threat intelligence feed that flagged the malicious indicator?
  context: Not all threat intelligence is created equal. This question seeks to quantify the trustworthiness of the source of an IOC match. By scoring threat feeds based on historical performance and other factors, analysts can dynamically adjust the priority of alerts, preventing false positives from low-quality feeds and ensuring high-quality alerts are addressed immediately.
  answer_sources:
  - Zeek ssl.log
  - Zeek x509.log
  - Zeek conn.log
  - Network Egress/Ingress Points (Firewalls, Proxies)
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      INPUT threat_feed_provider, indicator_age, historical_tp_fp_rates
      APPLY ML_model to score feed_reliability
      FOR each IOC_match_alert
      ADJUST alert_priority based on feed_reliability_score
- question: Are there any outbound SSL/TLS connections using certificates from a free Certificate Authority for a domain registered within the last 30 days, or where the certificate's common name mismatches the Server Name Indication (SNI)?
  context: This question looks for common red flags used by adversaries to quickly stand up infrastructure. The combination of a free CA and a newly registered domain is highly suspicious. A CN/SNI mismatch can indicate misconfiguration or a man-in-the-middle attempt. These rules provide a basic but effective layer of detection for suspicious certificates.
  answer_sources:
  - Zeek ssl.log
  - Zeek x509.log
  - Zeek dns.log
  - Network Egress Points
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      RULE 1: ALERT if cert_issuer in free_ca_list AND domain_age < 30 days
      RULE 2: ALERT if cert_common_name != ssl_sni
- question: Are any outbound SSL/TLS connections using certificates for domains that are potential typosquats of our organization's domains or brand names?
  context: Adversaries often use typosquatted domains to trick users or impersonate legitimate services. This question aims to proactively identify such domains by measuring their similarity to known, legitimate domains using the Damerau-Levenshtein distance. A low distance (e.g., 1 or 2) is a strong signal of a potential typosquatting attempt and warrants investigation.
  answer_sources:
  - Zeek ssl.log
  - Zeek x509.log
  - Zeek dns.log
  - Network Egress Points
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR each cert_subject_domain
      CALCULATE levenshtein_distance against internal_domain_list
      ALERT if distance <= 2
- question: Can we use a machine learning model to assign a 'suspicion score' to each observed SSL/TLS certificate based on its collective attributes?
  context: While individual attributes can be suspicious, a machine learning model can analyze multiple features in concert to identify complex patterns of maliciousness. This question focuses on creating a holistic suspicion score based on features like validity period, issuer, key length, and domain age, allowing for more nuanced and accurate detection of malicious certificates compared to simple rule-based approaches.
  answer_sources:
  - Zeek ssl.log
  - Zeek x509.log
  - Zeek dns.log
  - Network Egress Points
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      EXTRACT features (validity, issuer, key_length, domain_age, etc.) from certificates
      APPLY ML_classifier_model to generate suspicion_score
      ALERT on certificates with high suspicion_score
- question: Have any connections been made using a certificate or to a certificate issuer that has never been seen on the network before?
  context: Adversaries often deploy new infrastructure for their campaigns, resulting in the appearance of new, previously unseen certificates and issuers. This question aims to detect this activity by flagging any certificate or issuer that is not on a 90-day lookback list. While this can generate noise, it is a powerful method for detecting novel threats when triaged with other suspicious factors.
  answer_sources:
  - Zeek x509.log
  - Zeek ssl.log
  - SIEM/Data Lake
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      MAINTAIN lookup_table of cert_hashes and issuers seen in last 90 days
      FOR each new connection
      CHECK if cert_hash or issuer is in lookup_table
      ALERT if not found
- question: Are we observing certificates with unusually low or high-entropy subject or issuer names compared to our established baseline?
  context: The names used in certificate subjects and issuers can be revealing. Very low entropy names (e.g., 'localhost') can indicate lazy configurations, while very high entropy names can be a sign of domain generation algorithms (DGAs). This question seeks to identify these outliers by analyzing the Shannon entropy of these strings and comparing them to a baseline.
  answer_sources:
  - Zeek x509.log
  - Zeek ssl.log
  - SIEM/Data Lake
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      CALCULATE entropy for cert_subject and cert_issuer strings
      ESTABLISH baseline entropy distribution
      ALERT on entropy scores in bottom 5th or top 5th percentile
- question: Has there been a statistically significant spike in the number of new, first-seen certificate issuers on our network?
  context: A sudden increase in the variety of certificate issuers can indicate a large-scale adversary campaign. This question uses time series analysis to model the normal daily rate of new issuer discovery and automatically flags any day where this rate is anomalously high, pointing to a potential widespread event that requires investigation.
  answer_sources:
  - Zeek x509.log
  - Zeek ssl.log
  - SIEM/Data Lake
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      CREATE time_series of daily_count_of_new_issuers
      APPLY SARIMA or Prophet model to detect anomalies
      ALERT when count falls outside 99% prediction interval
- question: Is any single internal host connecting to an unusually high number of distinct external destinations using self-signed certificates within a one-hour window?
  context: This question targets a specific pattern of C2 beaconing where a compromised host cycles through a list of C2 servers that use self-signed certificates. By counting these distinct connections over a short time frame, we can detect this behavior, which would be missed by looking at total connection volume alone.
  answer_sources:
  - Zeek conn.log
  - Zeek ssl.log
  - Zeek x509.log
  - Core Network Switches (capturing East-West and North-South traffic)
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR each source_ip in 1-hour window
      COUNT distinct destination_ips where cert_is_self_signed
      ALERT if count > 10
- question: Is any internal host communicating with a number of distinct, newly-observed domains that is a statistical outlier compared to all other hosts?
  context: Adversaries often use newly created domains for C2. A compromised host may beacon out to many of these domains. This question identifies such hosts by finding those that contact a number of 'first seen today' domains far exceeding the norm (e.g., in the 99th percentile), pointing to a likely compromised asset.
  answer_sources:
  - Zeek conn.log
  - Zeek ssl.log
  - Zeek x509.log
  - Core Network Switches (capturing East-West and North-South traffic)
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR each source_ip in 24-hour period
      COUNT distinct destination_domains with newly_observed_certs
      CALCULATE 99th percentile for this count across all hosts
      ALERT on hosts exceeding the threshold
- question: Can we identify small groups of internal hosts that are all communicating with a common set of suspicious external servers/certificates?
  context: This question uses graph analysis to uncover coordinated activity. A targeted intrusion may involve several internal hosts beaconing to the same set of C2 servers. By modeling hosts and certificates as a graph and finding tightly-knit 'communities' using an algorithm like Louvain Modularity, we can identify these groups of compromised machines.
  answer_sources:
  - Zeek conn.log
  - Zeek ssl.log
  - Zeek x509.log
  - Core Network Switches (capturing East-West and North-South traffic)
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      CREATE bipartite_graph of (internal_hosts) <-> (external_cert_hashes)
      APPLY Louvain Modularity algorithm
      ALERT on small, dense communities of hosts and suspicious certificates
- question: Has a digital certificate been installed on a corporate server using common command-line tools like 'certutil.exe' or PowerShell's 'Import-Certificate' cmdlet?
  context: Adversaries may install their own certificates on compromised servers to enable man-in-the-middle attacks or establish persistence. This question looks for direct evidence of such an installation by monitoring for specific command-line executions. Correlating these events with change management tickets is crucial to separate legitimate administrative activity from malicious acts.
  answer_sources:
  - Windows Security Event ID 4688
  - Windows PowerShell Event ID 4104
  - Windows Security Event ID 4697
  - Public-facing Web Servers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      ALERT on process_name='certutil.exe' AND command_line contains '-addstore' or '-importpfx'
      ALERT on powershell_log contains 'Import-Certificate'
      ENRICH with change_ticket_lookup
- question: Was a certificate installation on a server performed by an unauthorized user, initiated by an unusual parent process, or conducted outside of normal business hours?
  context: Legitimate certificate management typically follows predictable patterns. This question aims to detect deviations from that norm. An installation by a non-administrative user, spawned by an odd process (e.g., winword.exe), or occurring at 3 AM on a Sunday are all strong behavioral anomalies that indicate a potential compromise.
  answer_sources:
  - Windows Security Event ID 4688
  - Windows PowerShell Event ID 4104
  - Windows Security Event ID 4697
  - Public-facing Web Servers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      BASELINE normal users, parent_processes, and times for cert installation
      FOR each installation event
      ALERT if user not in admin_group OR parent_process is anomalous OR time is outside business_hours
- question: Did a user or server exhibit a sequence of behaviors leading up to and including a certificate installation that is anomalous compared to their established profile?
  context: This question leverages a UEBA system to provide advanced behavioral analysis. Instead of just looking at the installation event in isolation, the model considers the entire chain of activity. A user from HR remotely logging into a web server and then executing certificate management commands is a highly suspicious sequence a UEBA system is designed to detect.
  answer_sources:
  - Windows Security Event ID 4688
  - Windows PowerShell Event ID 4104
  - Windows Security Event ID 4697
  - Public-facing Web Servers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      INGEST process, powershell, service logs into UEBA
      MODEL normal behavior for each user and entity
      ALERT on anomalous sequences involving certificate management commands