name: T1573: Encrypted Channel
id: 9a8b1c4d-2e3f-4a5b-8c7d-6e5f4a3b2c1d
description: This playbook helps determine if an adversary is using encrypted channels for command and control. It focuses on identifying malicious SSL/TLS connections by correlating with threat intelligence, analyzing connection patterns for beaconing behavior, fingerprinting TLS clients (JA3/JA3S), inspecting certificate attributes for anomalies, monitoring non-standard processes initiating encrypted traffic, and detecting SSL/TLS on non-standard ports.
type: technique
related:
- TA0011: Command and Control
contributors:
- Zachary Szewczyk
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
- question: Are any outbound SSL/TLS connections matching known malicious indicators from our threat intelligence feeds?
  context: This question aims to identify direct matches between network traffic and known-bad indicators. By joining network connection logs (IPs, SNI, certificate hashes) with a threat intelligence feed, analysts can quickly spot connections to confirmed command and control (C2) infrastructure, providing a high-confidence starting point for an investigation.
  answer_sources:
  - Zeek conn.log
  - Zeek ssl.log
  - Network egress points (e.g., firewalls, proxies)
  - Threat intelligence platform
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR each connection in (Zeek conn.log, Zeek ssl.log)
      JOIN connection.dest_ip, connection.sni, connection.cert_hash WITH threat_intel.indicators
      WHERE match is found
      ALERT on connection details
- question: Are there any domains with a low host-to-connection ratio and a recent registration date, suggesting potential C2 activity?
  context: Adversaries often use newly registered domains for C2. A low ratio of unique source hosts to total connections for a specific domain can indicate a single infected host making many automated connections (beaconing). Combining these two analytics helps uncover suspicious domains that are not yet on threat intelligence lists.
  answer_sources:
  - Zeek conn.log
  - Zeek ssl.log
  - Network egress points (e.g., firewalls, proxies)
  - Threat intelligence platform
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR each unique domain in ssl.log
      CALCULATE ratio = (unique source IPs) / (total connections)
      IF ratio < 0.1 AND domain_registration_date < 60 days
      FLAG domain for investigation
- question: Can a machine learning model identify malicious SSL/TLS connections based on their network characteristics?
  context: This question leverages machine learning to find subtle patterns in encrypted traffic that are indicative of malicious activity. By training a model on features like connection duration, data volume, SNI characteristics, and certificate details, analysts can score new connections and automatically flag those that exhibit properties similar to known malicious traffic, even without a direct indicator match.
  answer_sources:
  - Zeek conn.log
  - Zeek ssl.log
  - Network egress points (e.g., firewalls, proxies)
  - Threat intelligence platform
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR each new outbound SSL/TLS connection
      EXTRACT features (duration, bytes, SNI length/entropy, cert validity, etc.)
      APPLY pre-trained classification model
      IF prediction_score > 0.9
      ALERT as potentially malicious
- question: Are any TLS sessions using client (JA3) or server (JA3S) signatures known to be associated with malware or malicious tools?
  context: JA3 and JA3S hashes fingerprint the cryptographic parameters of a TLS client or server. Since specific malware families or tools often use the same libraries, they produce consistent and unique JA3/JA3S hashes. Matching observed hashes against a feed of known malicious ones is a highly effective way to identify the presence of specific threats on the network.
  answer_sources:
  - Zeek ssl.log
  - Network sensors capturing TLS handshakes (e.g., Zeek sensors at network chokepoints)
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR each ssl.log entry
      EXTRACT ja3 and ja3s hash
      MATCH hash against known-malicious JA3/JA3S feed
      IF match is found
      ALERT on connection details
- question: Are there any rare JA3 hashes present on only a few hosts, suggesting the use of non-standard client software?
  context: Standard applications like web browsers are widespread, so their JA3 hashes will be common across an enterprise. A JA3 hash that appears on only a handful of machines is anomalous and indicates the use of non-standard software. This could be a legitimate but niche application, or it could be malware. Investigating these rare hashes helps uncover potentially malicious tools.
  answer_sources:
  - Zeek ssl.log
  - Network sensors capturing TLS handshakes (e.g., Zeek sensors at network chokepoints)
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      AGGREGATE JA3 hashes over 24 hours
      CALCULATE frequency of each JA3 hash and count of hosts per hash
      IF host_count < 3 AND frequency_percentage < 0.01%
      FLAG JA3 hash for investigation
- question: Can clustering algorithms identify groups of hosts exhibiting similar, non-standard TLS client behavior?
  context: This question uses unsupervised machine learning to find groups of suspicious activity. By clustering rare JA3 hashes along with other connection metadata (like destination port or ASN), analysts can identify small but dense clusters. These clusters represent multiple hosts behaving in a similar, anomalous way, which could indicate a coordinated malware campaign using the same C2 tool.
  answer_sources:
  - Zeek ssl.log
  - Network sensors capturing TLS handshakes (e.g., Zeek sensors at network chokepoints)
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR all observed JA3 hashes
      ENRICH with metadata (dest_port, dest_ASN, SNI_TLD)
      APPLY DBSCAN clustering algorithm
      ANALYZE small, dense clusters of rare JA3 hashes
- question: Are any outbound SSL/TLS connections using self-signed certificates or certificates with empty or generic subject fields?
  context: While self-signed certificates have legitimate uses, their appearance in outbound connections to external IPs can be suspicious. Adversaries often use self-signed certificates for C2 channels to avoid the cost and traceability of legitimate certificates. Similarly, certificates with generic or empty subject information are anomalous and warrant scrutiny.
  answer_sources:
  - Zeek x509.log
  - Zeek ssl.log
  - Network egress points with SSL/TLS inspection capabilities
  - Certificate Transparency logs
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR each x509.log entry
      IF certificate.issuer == certificate.subject AND connection is external
      ALERT on certificate and connection
      IF certificate.subject is empty or generic
      ALERT on certificate and connection
- question: Are there any SSL/TLS certificates with unusually short or long validity periods, or with low-entropy subject names?
  context: Legitimate, publicly trusted certificates typically have standard validity periods (e.g., 90-398 days). Certificates with extremely short or long validities are statistical outliers. Likewise, algorithmically generated domain names used for C2 often result in low-entropy certificate subject names. Identifying these outliers helps to pinpoint potentially malicious certificates used for encrypted C2.
  answer_sources:
  - Zeek x509.log
  - Zeek ssl.log
  - Network egress points with SSL/TLS inspection capabilities
  - Certificate Transparency logs
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      CALCULATE distribution of certificate validity periods
      FLAG certificates with validity < 5th percentile or > 95th percentile
      CALCULATE Shannon entropy of certificate subject CN
      FLAG certificates with entropy < 5th percentile
- question: Can a machine learning model be used to classify newly observed certificates as benign or suspicious based on their attributes?
  context: This question applies machine learning to automate the detection of suspicious certificates. By training a model on features like whether a certificate is self-signed, its validity period, key length, and subject entropy, analysts can create a system to automatically score and flag new certificates that share characteristics with those known to be malicious.
  answer_sources:
  - Zeek x509.log
  - Zeek ssl.log
  - Network egress points with SSL/TLS inspection capabilities
  - Certificate Transparency logs
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR each newly observed certificate
      EXTRACT features (is_self_signed, validity_period, subject_entropy, key_length, etc.)
      APPLY pre-trained classification model
      IF prediction is 'suspicious'
      ALERT for review
- question: Are any hosts making an excessive number of connections to a non-CDN or non-cloud domain on port 443?
  context: High-frequency connections to major services like Google, AWS, or Akamai are normal. However, a large number of connections from a single host to a lesser-known domain can be a strong indicator of C2 beaconing. This query filters out the common, high-volume traffic to focus on potentially malicious, high-frequency communication channels.
  answer_sources:
  - Zeek conn.log
  - Client subnets
  - servers with direct internet access
  - Network flow collectors at key network boundaries
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      GROUP connections by source_ip, dest_ip over 24 hours
      IF connection_count > 100 AND dest_port == 443
      AND SNI is NOT in allow-list of major providers
      FLAG source-destination pair for review
- question: Are there any hosts making outbound connections with highly regular time intervals and consistent data sizes, indicative of automated beaconing?
  context: Malware often uses automated 'beaconing' to communicate with its C2 server. This activity is characterized by connections at very regular intervals (low standard deviation of time deltas) and with similar amounts of data transferred. Detecting this statistical regularity in network flows is a powerful method for uncovering C2 channels, even when they are encrypted.
  answer_sources:
  - Zeek conn.log
  - Client subnets
  - servers with direct internet access
  - Network flow collectors at key network boundaries
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR each source_ip, group connections by dest_ip over 24 hours
      CALCULATE time deltas between consecutive connections
      CALCULATE standard deviation of time deltas
      IF std_dev_time < 1 second
      FLAG as rigid beaconing
- question: Can a frequency analysis technique like Fast Fourier Transform (FFT) detect periodic beaconing signals in connection time series data?
  context: This question proposes a more advanced signal processing technique to detect beaconing, including jittered beaconing where timing is slightly randomized. By transforming a time series of connection events into the frequency domain using FFT, a strong, dominant frequency will emerge if a periodic signal is present. This is a high-fidelity method for identifying automated C2 communications.
  answer_sources:
  - Zeek conn.log
  - Client subnets
  - servers with direct internet access
  - Network flow collectors at key network boundaries
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR each source-destination pair
      CREATE time series of connection events
      APPLY FFT to time series
      IF a dominant frequency peak is detected
      ALERT on channel for beaconing activity
- question: Are any non-standard processes (not on an allow-list) initiating outbound encrypted connections, especially from unusual file paths?
  context: Outbound encrypted connections are typically initiated by a small set of standard applications, like web browsers and email clients. When an unexpected process (e.g., a command-line utility or an unsigned executable in a temp folder) makes an external SSL/TLS connection, it is highly suspicious. Correlating process and network data and using an allow-list helps to quickly identify this anomalous behavior.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 5156
  - Zeek conn.log
  - User workstations and critical servers (e.g., Domain Controllers, Application Servers)
  - EDR agent logs
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      JOIN process_creation_events with network_connection_events
      IF network_connection is external_ssl
      AND process_name is NOT in [chrome.exe, firefox.exe, outlook.exe, ...]
      ALERT on process and connection details
- question: Are any network-connected processes being spawned by unusual parent processes or executing from rare file paths?
  context: Adversaries often use legitimate processes to launch malicious ones (e.g., Microsoft Word spawning PowerShell). By baselining normal parent-child process relationships, analysts can spot anomalies that indicate process injection or other malicious execution chains. Similarly, analyzing the rarity of a process's file path can uncover malware masquerading in odd locations.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 5156
  - Zeek conn.log
  - User workstations and critical servers (e.g., Domain Controllers, Application Servers)
  - EDR agent logs
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR each process with a network connection
      CHECK if parent_process is unusual (e.g., winword.exe -> powershell.exe)
      CALCULATE rarity of process_image_path across enterprise
      IF parent is unusual OR path is rare
      FLAG for investigation
- question: Can an anomaly detection model identify suspicious processes that initiate network connections based on their execution context?
  context: This question uses unsupervised machine learning to find anomalous process execution behavior that leads to a network connection. By training a model on features like process name, parent process, command-line arguments, and signature status, the system can learn what 'normal' looks like and automatically flag any new network-initiating process that deviates significantly from this baseline.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 5156
  - Zeek conn.log
  - User workstations and critical servers (e.g., Domain Controllers, Application Servers)
  - EDR agent logs
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR each new network-initiating process
      EXTRACT features (process name, parent name, cmdline entropy, is_signed)
      APPLY pre-trained Isolation Forest model
      IF anomaly_score is high
      ALERT on process
- question: Is SSL/TLS traffic occurring on non-standard ports, or are there protocol violation warnings associated with TLS handshakes?
  context: While SSL/TLS is most common on port 443, adversaries may use it on any port to evade simple port-based firewall rules. Detecting SSL/TLS traffic on unusual ports is a classic sign of C2. This is often coupled with errors or 'weird' behavior during the handshake, detected by protocol analyzers like Zeek, which further increases suspicion.
  answer_sources:
  - Zeek conn.log
  - Zeek weird.log
  - Network egress points and internal network segment gateways
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR each connection in conn.log
      IF (service == 'ssl' OR service == 'tls')
      AND dest_port NOT IN [443, 465, 587, 993, 995, 8443]
      ALERT on connection
- question: Are there any rarely used destination ports for SSL/TLS traffic across the enterprise?
  context: This question uses a statistical approach to find non-standard port usage. By analyzing the frequency of all ports used for SSL/TLS, analysts can identify which ports are statistical outliers (e.g., in the bottom 1% of usage). These rare channels for encrypted traffic are highly suspicious and warrant investigation as potential C2 channels.
  answer_sources:
  - Zeek conn.log
  - Zeek weird.log
  - Network egress points and internal network segment gateways
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      AGGREGATE all SSL/TLS connections by destination port
      CALCULATE frequency distribution of ports
      FLAG ports with frequency < 1st percentile
- question: Can an anomaly detection model identify SSL/TLS connections that are outliers compared to a baseline of normal traffic?
  context: This question proposes building a model of what 'normal' SSL/TLS traffic looks like (e.g., on port 443, with a valid cert, and a common JA3 hash). A One-Class SVM or similar anomaly detection model can then be used to score all new connections against this baseline. Any connection that is a significant outlier from this normal profile is flagged as suspicious, providing a way to catch novel threats.
  answer_sources:
  - Zeek conn.log
  - Zeek weird.log
  - Network egress points and internal network segment gateways
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      TRAIN One-Class SVM model on 'normal' SSL/TLS connection features
      FOR each new SSL/TLS connection
      APPLY model to classify as 'inlier' or 'outlier'
      IF classification is 'outlier'
      ALERT for investigation