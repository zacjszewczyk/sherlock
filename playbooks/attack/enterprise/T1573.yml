name: 'T1573: Encrypted Channel'
id: 'a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d'
description: "This playbook helps identify if an adversary is using encrypted channels for command and control (C2). It focuses on detecting malicious indicators in SSL/TLS traffic, anomalous TLS client signatures (JA3/JA3S), unusual certificate attributes, periodic network beaconing, suspicious processes initiating encrypted connections, and the use of non-standard ports for TLS communication."
type: technique
related:
  - 'TA0011: Command and Control'
contributors:
  - Zachary Szewczyk
created: '2025-10-01'
modified: '2025-10-01'
version: 1.0
tags: none
questions:
  - question: "Are any outbound SSL/TLS connections matching known malicious indicators from our threat intelligence feeds?"
    context: "This question seeks to find high-confidence evidence of C2 by directly matching outbound connection artifacts (destination IPs, Server Name Indication, certificate hashes) against curated lists of known malicious indicators. A successful match is a strong signal of compromise."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek ssl.log"
      - "Network egress points (e.g., firewalls, proxies)"
      - "Threat intelligence platform"
    range: "Last 90 days"
    queries:
      - "pseudocode: |
          JOIN (conn_logs, ssl_logs) ON connection_uid;
          JOIN result WITH threat_intel_feed ON (dest_ip, sni, cert_hash);
          RETURN matches;"
  - question: "Are there any recently registered domains receiving a high volume of connections from a very small number of internal hosts?"
    context: "This helps detect potential C2 domains not yet in threat intelligence feeds. A low ratio of unique source hosts to total connections suggests one or a few infected machines repeatedly contacting a C2 server. Correlating this with a recent domain registration date increases the likelihood of maliciousness."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek ssl.log"
      - "Network egress points (e.g., firewalls, proxies)"
      - "Threat intelligence platform"
    range: "Last 90 days"
    queries:
      - "pseudocode: |
          CALCULATE host_to_connection_ratio per domain;
          FILTER for ratio < 0.1;
          CHECK domain registration_date < 60 days;
          RETURN suspicious_domains;"
  - question: "Can we use a machine learning model to identify malicious SSL/TLS connections based on their network and certificate features?"
    context: "This proactive approach uses machine learning to score and identify potentially malicious traffic that may evade signature-based detection. It learns the characteristics of both benign and malicious connections (e.g., duration, data volume, SNI entropy, certificate properties) to predict the nature of new, unseen traffic."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek ssl.log"
      - "Network egress points (e.g., firewalls, proxies)"
      - "Threat intelligence platform"
    range: "Last 90 days"
    queries:
      - "pseudocode: |
          SCORE new SSL/TLS connections with trained_model;
          FEATURES = [duration, bytes_sent, sni_entropy, cert_validity, is_self_signed];
          ALERT if score > 0.9;"
  - question: "Are we observing any TLS client (JA3) or server (JA3S) fingerprints that are known to be associated with malware or malicious tools?"
    context: "JA3 and JA3S hashes act as fingerprints for the cryptographic client and server applications. Malicious tools often use specific libraries, resulting in unique, identifiable fingerprints. Matching these hashes against a feed of known malicious fingerprints can directly identify malware families like Cobalt Strike or Metasploit."
    answer_sources:
      - "Zeek ssl.log"
      - "Network sensors capturing TLS handshakes (e.g., Zeek sensors at network chokepoints)"
    range: "Last 90 days"
    queries:
      - "pseudocode: |
          EXTRACT ja3, ja3s from ssl_logs;
          JOIN with malicious_ja3_feed;
          ALERT on match;"
  - question: "Are there any rare JA3 hashes present on only a few hosts within the enterprise?"
    context: "This question hunts for anomalies by identifying non-standard TLS clients. Widespread, legitimate software produces common JA3 hashes. A JA3 hash observed on only a handful of machines suggests the presence of unusual software, which could be a malicious tool and warrants investigation."
    answer_sources:
      - "Zeek ssl.log"
      - "Network sensors capturing TLS handshakes (e.g., Zeek sensors at network chokepoints)"
    range: "Last 90 days"
    queries:
      - "pseudocode: |
          CALCULATE frequency of each JA3 hash in 24h;
          FILTER for hosts_count < 3 AND total_connections_percent < 0.01;
          RETURN rare_ja3_hashes for investigation;"
  - question: "Can we identify groups of hosts exhibiting similar, rare TLS client behavior through clustering?"
    context: "This uses unsupervised machine learning to find groups of potentially compromised hosts. By clustering rare JA3 hashes along with other connection metadata (destination port, ASN), we can uncover coordinated activity where multiple machines use the same non-standard client, possibly indicating a single malware campaign."
    answer_sources:
      - "Zeek ssl.log"
      - "Network sensors capturing TLS handshakes (e.g., Zeek sensors at network chokepoints)"
    range: "Last 90 days"
    queries:
      - "pseudocode: |
          CLUSTER ja3 hashes with metadata (port, ASN, TLD) using DBSCAN;
          ANALYZE small, dense clusters of rare hashes;
          RETURN suspicious_clusters;"
  - question: "Are any external SSL/TLS connections using self-signed certificates or certificates with generic subject information?"
    context: "While self-signed certificates have legitimate internal uses, their use for external connections is highly suspicious and a common tactic for malware C2. Likewise, certificates with empty or generic subject names are a red flag, as legitimate entities provide valid identifying information."
    answer_sources:
      - "Zeek x509.log"
      - "Zeek ssl.log"
      - "Network egress points with SSL/TLS inspection capabilities"
      - "Certificate Transparency logs"
    range: "Last 90 days"
    queries:
      - "pseudocode: |
          FILTER x509_logs for (issuer == subject) OR (subject_cn is generic);
          CHECK connection is external;
          ALERT on matches;"
  - question: "Are we observing SSL/TLS certificates with unusually short or long validity periods, or with low-entropy subject names?"
    context: "Legitimate certificates typically have validity periods between 90 and 398 days. Significant deviations can indicate a hastily created or non-standard certificate used for malicious purposes. Low-entropy (random-looking) subject common names are also a common indicator of auto-generated C2 certificates."
    answer_sources:
      - "Zeek x509.log"
      - "Zeek ssl.log"
      - "Network egress points with SSL/TLS inspection capabilities"
      - "Certificate Transparency logs"
    range: "Last 90 days"
    queries:
      - "pseudocode: |
          CALCULATE validity_period distribution; FLAG certs in <5th or >95th percentile;
          CALCULATE subject_cn_entropy distribution; FLAG certs in <5th percentile;
          RETURN anomalous_certs;"
  - question: "Can a machine learning model be used to classify newly observed certificates as 'benign' or 'suspicious' based on their attributes?"
    context: "This question proposes a proactive method to automatically vet all new SSL/TLS certificates. By training a model on features like self-signed status, validity period, and key length, the system can learn to distinguish legitimate certificates from those used by adversaries, flagging them for review."
    answer_sources:
      - "Zeek x509.log"
      - "Zeek ssl.log"
      - "Network egress points with SSL/TLS inspection capabilities"
      - "Certificate Transparency logs"
    range: "Last 90 days"
    queries:
      - "pseudocode: |
          SCORE new certificates with trained_model;
          FEATURES = [is_self_signed, validity_period, subject_entropy, key_length];
          ALERT if classified as 'suspicious';"
  - question: "Are any internal hosts making an unusually high number of connections to external destinations that are not major cloud or CDN providers?"
    context: "Malware often communicates with its C2 server frequently. This question aims to catch this 'noisy' behavior by looking for a high connection count to a single destination. By excluding well-known services (like Akamai, Cloudflare, AWS), we can focus on high-frequency connections to more obscure destinations, which are more likely to be malicious."
    answer_sources:
      - "Zeek conn.log"
      - "Client subnets, servers with direct internet access"
      - "Network flow collectors at key network boundaries"
    range: "Last 90 days"
    queries:
      - "pseudocode: |
          COUNT connections per src-dest pair in 24h;
          IF count > 100 AND port == 443 AND SNI is not in (CDN_allow_list);
          FLAG for review;"
  - question: "Are there any communication channels exhibiting highly regular time intervals (beaconing) and consistent data sizes between connections?"
    context: "This question looks for the classic sign of automated malware: beaconing. By calculating the time difference between consecutive connections to the same destination, a very low standard deviation indicates a machine-like, periodic signal. Low variance in payload sizes further strengthens this hypothesis."
    answer_sources:
      - "Zeek conn.log"
      - "Client subnets, servers with direct internet access"
      - "Network flow collectors at key network boundaries"
    range: "Last 90 days"
    queries:
      - "pseudocode: |
          GROUP connections by src-dest;
          CALCULATE time_delta_std_dev;
          CALCULATE payload_size_std_dev;
          IF time_delta_std_dev < 1s;
          ALERT for beaconing;"
  - question: "Can we use frequency analysis (FFT) to detect periodic beaconing signals, even if they are jittered or hidden in noisy traffic?"
    context: "This is an advanced technique to detect beaconing where attackers add random delays ('jitter') to evade simple time-delta analysis. A Fast Fourier Transform (FFT) can reveal a strong underlying periodic signal even with jitter, providing a high-fidelity way to detect automated C2 communication."
    answer_sources:
      - "Zeek conn.log"
      - "Client subnets, servers with direct internet access"
      - "Network flow collectors at key network boundaries"
    range: "Last 90 days"
    queries:
      - "pseudocode: |
          CREATE time_series of connections for each src-dest channel;
          APPLY FFT to time_series;
          IF strong peak in frequency domain;
          ALERT for periodic beaconing;"
  - question: "Are any non-browser or unapproved processes initiating outbound SSL/TLS connections, especially from unusual file paths?"
    context: "Legitimate encrypted traffic usually originates from standard applications like web browsers. This question seeks to identify connections made by any other process. Such activity is highly suspicious, especially if the process runs from a temporary or user-writable directory (e.g., C:\\Users\\Public\\), a common malware tactic."
    answer_sources:
      - "Windows Event ID 4688"
      - "Windows Event ID 5156"
      - "Zeek conn.log"
      - "User workstations and critical servers (e.g., Domain Controllers, Application Servers)"
      - "EDR agent logs"
    range: "Last 90 days"
    queries:
      - "pseudocode: |
          CORRELATE process_creation (EID 4688) with network_connection (EID 5156);
          IF process_name NOT in (browser_allow_list) AND connection is external;
          ALERT;"
  - question: "Are any network-connected processes being spawned by an unusual parent process or running from a rare file path?"
    context: "Malware often uses legitimate processes to launch its components (e.g., winword.exe spawning powershell.exe). This question looks for these anomalous parent-child process relationships. It also uses 'long-tail analysis' to find processes running from paths that are rare across the enterprise, which can indicate a malicious tool placed in an obscure location."
    answer_sources:
      - "Windows Event ID 4688"
      - "Windows Event ID 5156"
      - "Zeek conn.log"
      - "User workstations and critical servers (e.g., Domain Controllers, Application Servers)"
      - "EDR agent logs"
    range: "Last 90 days"
    queries:
      - "pseudocode: |
          BASELINE normal parent-child relationships;
          ALERT on deviations (e.g., winword.exe -> powershell.exe with network conn);
          FIND rare process paths and investigate network activity;"
  - question: "Can we use an anomaly detection model to identify suspicious processes that initiate network connections?"
    context: "This question proposes using machine learning to automatically flag suspicious network-initiating processes. By training a model on normal process behavior (process name, parent, command line entropy, signature status), it can identify outliers that deviate from this baseline, which may represent malicious activity."
    answer_sources:
      - "Windows Event ID 4688"
      - "Windows Event ID 5156"
      - "Zeek conn.log"
      - "User workstations and critical servers (e.g., Domain Controllers, Application Servers)"
      - "EDR agent logs"
    range: "Last 90 days"
    queries:
      - "pseudocode: |
          SCORE new network-initiating processes with Isolation Forest model;
          FEATURES = [process_name, parent_name, cmd_line_entropy, is_unsigned];
          ALERT on anomalies;"
  - question: "Is SSL/TLS traffic occurring on non-standard ports, or are there any protocol violation warnings associated with TLS handshakes?"
    context: "While most TLS traffic uses port 443, adversaries may use non-standard ports to evade simple firewall rules. Detecting TLS on an unexpected port is a strong indicator of suspicious activity. Associated protocol warnings (e.g., from Zeek's weird.log) can further indicate a non-standard or malicious TLS implementation."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek weird.log"
      - "Network egress points and internal network segment gateways"
    range: "Last 90 days"
    queries:
      - "pseudocode: |
          FILTER conn_logs where service is 'ssl'/'tls' AND dest_port NOT in {443, 465, 587, 993, 995, 8443};
          INCREASE severity if related 'ssl_weird' alert exists;
          ALERT;"
  - question: "Are there any rarely used destination ports being used for SSL/TLS communication?"
    context: "This question uses frequency analysis to find anomalous port usage. By identifying which ports are very rarely used for SSL/TLS across the enterprise, analysts can focus their attention on these outliers. An adversary's C2 channel is likely to appear as a low-frequency, anomalous event in this analysis."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek weird.log"
      - "Network egress points and internal network segment gateways"
    range: "Last 90 days"
    queries:
      - "pseudocode: |
          CALCULATE frequency of all destination ports for SSL/TLS traffic;
          FLAG ports in the <1st percentile of usage;
          INVESTIGATE traffic to these rare ports;"
  - question: "Can an anomaly detection model identify SSL/TLS connections that deviate from a baseline of 'normal' traffic?"
    context: "This question suggests building a model of what constitutes normal SSL/TLS traffic (e.g., on port 443, with a valid cert, common JA3). Any connection that falls outside this learned boundary is flagged as an outlier. This can effectively catch traffic on non-standard ports or with other anomalous properties without needing pre-defined rules."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek weird.log"
      - "Network egress points and internal network segment gateways"
    range: "Last 90 days"
    queries:
      - "pseudocode: |
          TRAIN One-Class SVM on normal SSL/TLS traffic;
          FEATURES = [port, ja3_prevalence, cert_validity_flags];
          USE model to classify new connections;
          ALERT on outliers;"