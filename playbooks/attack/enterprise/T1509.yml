name: T1509: Non-Standard Port
id: f47ac10b-58cc-4372-a567-0e02b2c3d479
description: This playbook addresses the threat of adversaries establishing command and control (C2) with mobile devices using non-standard ports. It provides investigative context for identifying such activity by analyzing network connections from mobile device IP ranges. Key indicators include: a service (e.g., 'ssl') running on a port other than its IANA-assigned standard; a series of outbound connections to a single destination with characteristics of automated C2 beaconing (low variance in timing, short duration); and SSL/TLS connections with anomalous certificate properties (e.g., self-signed, short validity) or rare JA3/JA3S fingerprints.
type: technique
related:
  - TA0037: Command and Control
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Are mobile devices making connections where the identified service does not match the IANA-standard port, and is the destination a known C2 server?
    context: This question aims to detect blatant C2 channels that masquerade as legitimate services (like SSL) but operate on non-standard ports (e.g., SSL on TCP/8080). By creating rules that flag these mismatches for connections from mobile devices, analysts can quickly identify suspicious traffic. Enriching these alerts with threat intelligence on the destination IP provides immediate context on whether the connection is to a known malicious infrastructure.
    answer_sources:
      - Zeek conn.log
      - Zeek notice.log
      - Corporate and guest Wi-Fi network segments, VPN termination points, Unified Endpoint Management (UEM) traffic inspection points, and Internet gateway proxies where mobile device traffic is visible.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH Zeek 'Known_Services::Non_Standard_Port' notices WHERE source_ip IN mobile_ip_range. ENRICH destination_ip with threat_intel.
  - question: Are mobile devices communicating using statistically rare service-and-port combinations compared to the network baseline?
    context: Adversaries often use unique or uncommon ports for C2 to evade signature-based detection. This question helps uncover these covert channels by using a statistical approach. By calculating the frequency of all service-port pairs across the network over a 30-day baseline, we can identify new connections from mobile devices that are statistical outliers (e.g., below the 5th percentile). These rare combinations warrant investigation as potential C2 activity.
    answer_sources:
      - Zeek conn.log
      - Zeek notice.log
      - Corporate and guest Wi-Fi network segments, VPN termination points, Unified Endpoint Management (UEM) traffic inspection points, and Internet gateway proxies where mobile device traffic is visible.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: COMPARE new Zeek conn.log FROM mobile_ip_range AGAINST 30-day baseline of (service, dest_port) frequency. ALERT if frequency < 5th percentile.
  - question: Can a machine learning model identify malicious connections from mobile devices based on network traffic features?
    context: This question leverages supervised machine learning to move beyond simple rules and detect more nuanced patterns of malicious C2 traffic. By training a model (like a Random Forest) on features such as port, protocol, duration, bytes transferred, and whether the port is non-standard, we can create a classifier that scores new connections from mobile devices. Connections with a high malicious probability score can be automatically flagged for investigation, providing a more sophisticated and adaptable detection method.
    answer_sources:
      - Zeek conn.log
      - Zeek notice.log
      - Corporate and guest Wi-Fi network segments, VPN termination points, Unified Endpoint Management (UEM) traffic inspection points, and Internet gateway proxies where mobile device traffic is visible.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SCORE new Zeek conn.log from mobile_ip_range using trained ML model. ALERT if malicious_score > 0.85.
  - question: Is a mobile device connecting to a suspected DGA-generated domain on a non-standard port shortly after a DNS query?
    context: Malware frequently uses Domain Generation Algorithms (DGAs) to create a large number of potential C2 domains, making blocklisting difficult. This question targets this behavior by first identifying DNS queries for domains with high entropy (a characteristic of DGA). It then correlates this activity with subsequent network connections from the same source IP to the resolved address on a non-standard port. A successful connection within a short timeframe (e.g., 60 seconds) is a strong indicator of DGA-based C2.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Egress points for all corporate and guest networks, specifically monitoring subnets allocated to mobile devices via DHCP for Wi-Fi or VPN pools, and Cloud Access Security Broker (CASB) logs.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH Zeek dns.log for source_ip IN mobile_ip_range AND query_entropy > 3.5. CORRELATE with Zeek conn.log for connection to resolved_ip on non-standard port within 60s.
  - question: Is a mobile device exhibiting automated C2 beaconing behavior, characterized by numerous connections to a single destination with highly regular timing and duration?
    context: Automated C2 implants often 'beacon' back to their server at regular intervals. This activity looks very different from human-generated traffic. This question focuses on identifying this robotic pattern by analyzing groups of connections from a single mobile device to a single destination on a non-standard port. If a large number of connections (>10) occur within an hour and have very low variation in their timing and duration, it strongly suggests automated C2 beaconing.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Egress points for all corporate and guest networks, specifically monitoring subnets allocated to mobile devices via DHCP for Wi-Fi or VPN pools, and Cloud Access Security Broker (CASB) logs.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: GROUP Zeek conn.log by (src_ip, dst_ip, dst_port) over 60min window. ALERT if src_ip IN mobile_ip_range, port is non-standard, count > 10, AND stdev(time_delta) < 2s, AND stdev(duration) < 1s.
  - question: Can time-series anomaly detection identify periodic, machine-like communication patterns from mobile devices to non-standard ports?
    context: This question applies advanced time-series analysis to detect C2 beaconing that might be missed by simple statistical thresholds. By modeling the connection counts and data volume over time for each mobile device communication channel (source, destination, port), we can use algorithms like Isolation Forest to automatically flag patterns that deviate from a normal, human-driven baseline. This is effective at finding periodic, 'heartbeat' traffic characteristic of C2.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Egress points for all corporate and guest networks, specifically monitoring subnets allocated to mobile devices via DHCP for Wi-Fi or VPN pools, and Cloud Access Security Broker (CASB) logs.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: MODEL time-series of (connection_count, total_bytes) per minute for each (src_ip, dst_ip, dst_port) tuple. USE anomaly detection model (e.g., Isolation Forest) to find periodic or machine-like patterns.
  - question: Are mobile devices establishing TLS connections on non-standard ports using invalid or suspicious server certificates?
    context: Legitimate services typically use valid, trusted SSL/TLS certificates. Adversaries, however, often use self-signed certificates or certificates with very short validity periods for their C2 infrastructure to save cost and effort. This question hones in on this indicator by joining connection, SSL, and certificate logs. It triggers an alert if a mobile device connects to a non-standard port and the server's certificate is invalid (e.g., self-signed) or has a short lifespan (<90 days), which are strong signs of a malicious C2 server.
    answer_sources:
      - Zeek ssl.log
      - Zeek conn.log
      - Zeek x509.log
      - Network sensors with Deep Packet Inspection (DPI) at Internet gateways, SSL/TLS decryption zones, VPN concentrators, and forward proxies. UEM solutions with traffic inspection capabilities are also a key NAI.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: JOIN conn.log, ssl.log, x509.log. ALERT if src_ip IN mobile_ip_range, dest_port is non-standard, AND (ssl.validation_status != 'ok' OR x509.validity_length < 90).
  - question: Are mobile devices involved in TLS connections that use statistically rare client (JA3) or server (JA3S) fingerprints?
    context: JA3 and JA3S are methods for fingerprinting TLS clients and servers, respectively. Standard applications (like web browsers) have common fingerprints, while custom malware or attacker tools often have unique or rare ones. This question leverages this by baselining the frequency of all JA3/JA3S hashes on the network. An alert is generated if a mobile device connects to a non-standard port using a TLS fingerprint that is a statistical outlier (e.g., below the 1st percentile), pointing to the use of a non-standard or malicious application.
    answer_sources:
      - Zeek ssl.log
      - Zeek conn.log
      - Zeek x509.log
      - Network sensors with Deep Packet Inspection (DPI) at Internet gateways, SSL/TLS decryption zones, VPN concentrators, and forward proxies. UEM solutions with traffic inspection capabilities are also a key NAI.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: COMPARE JA3/JA3S hash from new mobile SSL connection AGAINST 30-day baseline frequency. ALERT if frequency < 1st percentile AND dest_port is non-standard.
  - question: Can unsupervised clustering group anomalous SSL/TLS connections from mobile devices based on shared, uncommon characteristics?
    context: This question uses unsupervised machine learning (like DBSCAN) to find 'clusters' of suspicious activity without pre-existing labels. By creating a feature set for each SSL connection (e.g., certificate status, port type, JA3 hash), the model can group connections that are similar to each other but different from the majority of normal traffic. Connections that are flagged as 'noise' or form small, distinct clusters represent groups of anomalous sessions that share uncommon traits, likely indicating a coordinated C2 campaign or a specific malicious tool.
    answer_sources:
      - Zeek ssl.log
      - Zeek conn.log
      - Zeek x509.log
      - Network sensors with Deep Packet Inspection (DPI) at Internet gateways, SSL/TLS decryption zones, VPN concentrators, and forward proxies. UEM solutions with traffic inspection capabilities are also a key NAI.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: APPLY DBSCAN clustering to feature vectors of mobile SSL connections. INVESTIGATE connections flagged as noise or belonging to small, distinct clusters.