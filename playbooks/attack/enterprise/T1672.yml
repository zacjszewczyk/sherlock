name: T1672: Email Spoofing
id: f5d8a1b0-6c9a-4f8d-8e7a-1b9c2d0f3e4a
description: This playbook helps investigate whether an adversary is using email spoofing for defense evasion. It focuses on identifying suspicious emails by checking for sender information (IPs, domains) on threat intelligence lists, analyzing SPF, DKIM, and DMARC authentication failures for high-value domains, detecting mismatches between friendly 'From' headers and SMTP envelope 'MAIL FROM' fields, identifying anomalous email volumes from specific sources, and flagging emails from sources with network or geographic attributes inconsistent with the sender's established profile.
type: technique
related:
  - TA0005: Defense Evasion
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
investigative_questions:
  - question: Are any inbound emails coming from source IPs or containing header domains that match a high-confidence threat intelligence list?
    context: This question directly targets known threats by checking if any part of an email's origin metadata is on a blocklist. A match is a high-fidelity indicator of a malicious campaign, enabling immediate blocking or alerting.
    answer_sources:
      - Zeek smtp.log
      - Zeek conn.log
      - DMZ network segment hosting email gateways
      - Network perimeter firewalls
      - Threat Intelligence Platform API endpoint
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          FOR each email in inbound_emails:
            IF email.source_ip IN threat_intel_ips OR email.from_domain IN threat_intel_domains OR email.reply_to_domain IN threat_intel_domains:
              TRIGGER_ALERT(high, email)
  - question: Do any inbound emails have a weighted risk score from aggregated threat intelligence feeds that exceeds the established threshold for maliciousness?
    context: Instead of a simple blocklist match, this question uses a more nuanced approach by aggregating reputation data from multiple sources. This helps identify suspicious emails that may not be on a specific list but are considered risky by the broader security community, reducing false negatives.
    answer_sources:
      - Zeek smtp.log
      - Zeek conn.log
      - DMZ network segment hosting email gateways
      - Network perimeter firewalls
      - Threat Intelligence Platform API endpoint
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          FOR each email in inbound_emails:
            risk_score = calculate_weighted_risk(email.source_ip, email.from_domain)
            IF risk_score > risk_threshold:
              FLAG_FOR_REVIEW(email)
  - question: Are any inbound emails being classified as malicious with high probability (>0.90) by our machine learning model?
    context: This question leverages a machine learning model to perform advanced analysis on a wide range of email features. This method can detect novel or sophisticated spoofing attempts that evade simpler rule-based or reputation-based checks by identifying complex patterns indicative of malicious activity.
    answer_sources:
      - Zeek smtp.log
      - Zeek conn.log
      - DMZ network segment hosting email gateways
      - Network perimeter firewalls
      - Threat Intelligence Platform API endpoint
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          FOR each email in inbound_emails:
            features = extract_features(email)
            prediction = ml_model.predict(features)
            IF prediction.probability_malicious > 0.90:
              TRIGGER_ALERT(high, email)
  - question: Are any inbound emails claiming to be from a high-value domain failing SPF or DKIM authentication?
    context: This question focuses on a common spoofing technique where an attacker impersonates a trusted internal or partner domain. An SPF or DKIM failure for such a domain is a strong indicator that the email is not from an authorized server and is likely spoofed.
    answer_sources:
      - Zeek smtp.log
      - Zeek dns.log
      - Email security gateway
      - Corporate DNS resolvers
      - Directory of trusted partner domains
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          FOR each email in inbound_emails:
            IF email.from_domain IN high_value_domains AND (email.spf_result == 'fail' OR email.dkim_result == 'fail'):
              TRIGGER_ALERT(high, email)
  - question: Has the daily rate of SPF or DKIM authentication failures for any external sender domain anomalously exceeded its historical baseline?
    context: This question seeks to detect targeted spoofing campaigns against a specific external domain by looking for statistical anomalies. A sudden spike in authentication failures for a domain, compared to its normal traffic, can indicate that an attacker is attempting to spoof that domain at scale.
    answer_sources:
      - Zeek smtp.log
      - Zeek dns.log
      - Email security gateway
      - Corporate DNS resolvers
      - Directory of trusted partner domains
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          FOR each sender_domain:
            daily_failure_rate = calculate_daily_auth_failure_rate(sender_domain)
            baseline_threshold = get_95th_percentile_failure_rate(sender_domain, last_30_days)
            IF daily_failure_rate > baseline_threshold:
              TRIGGER_ALERT(medium, sender_domain)
  - question: Is the hourly count of SPF/DKIM failures for any high-value domain significantly exceeding the range forecasted by our time-series anomaly detection model?
    context: This question uses a sophisticated time-series model to identify abnormal spikes in authentication failures that account for normal daily and weekly patterns. This helps detect targeted spoofing campaigns with higher precision and fewer false positives than simple thresholding, especially for domains with variable but predictable email traffic.
    answer_sources:
      - Zeek smtp.log
      - Zeek dns.log
      - Email security gateway
      - Corporate DNS resolvers
      - Directory of trusted partner domains
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          FOR each high_value_domain:
            hourly_failures = get_hourly_auth_failures(high_value_domain)
            forecast = timeseries_model.predict(current_hour)
            IF hourly_failures > forecast.upper_bound:
              TRIGGER_ALERT(high, high_value_domain)
  - question: Are we receiving emails where the friendly 'From' domain is a trusted entity, but the technical 'MailFrom' envelope domain does not match?
    context: This question targets a classic spoofing technique where the user-visible 'From' address is faked, while the underlying 'MailFrom' address (used for bounces) is different. When the faked 'From' is a trusted domain, this mismatch is a strong indicator of impersonation.
    answer_sources:
      - Zeek smtp.log
      - Mail Transfer Agent (MTA) logs
      - Email security gateway inspection point
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          FOR each email in inbound_emails:
            IF email.from_domain != email.mailfrom_domain AND email.from_domain IN high_value_domains:
              TRIGGER_ALERT(high, email)
  - question: Are we seeing new or rare 'MailFrom' domains being used for emails that claim to be from a trusted 'From' domain?
    context: This question establishes a baseline of normal sender relationships. Legitimate organizations typically use a consistent set of servers (and thus 'MailFrom' domains) to send email. A new or very rare pairing for a trusted 'From' domain suggests a deviation from normal behavior and could indicate a spoofing attempt from an unauthorized server.
    answer_sources:
      - Zeek smtp.log
      - Mail Transfer Agent (MTA) logs
      - Email security gateway inspection point
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          FOR each email in inbound_emails:
            IF email.from_domain IN high_value_domains:
              pair_freq = get_historical_frequency(email.from_domain, email.mailfrom_domain)
              IF pair_freq < 5th_percentile_threshold:
                FLAG_FOR_REVIEW(email)
  - question: For emails claiming to be from a high-value domain, are any associated 'MailFrom' domains generating a high reconstruction error from our autoencoder model?
    context: This question uses an unsupervised machine learning model (an autoencoder) to learn the 'normal' set of 'MailFrom' domains for a given 'From' domain. When a new email arrives, a 'MailFrom' domain that the model cannot accurately reconstruct is flagged as anomalous, indicating it's likely an unauthorized, spoofed sender.
    answer_sources:
      - Zeek smtp.log
      - Mail Transfer Agent (MTA) logs
      - Email security gateway inspection point
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          FOR each email in inbound_emails:
            IF email.from_domain IN high_value_domains:
              model = get_autoencoder_for_domain(email.from_domain)
              reconstruction_error = model.calculate_error(email.mailfrom_domain)
              IF reconstruction_error > anomaly_threshold:
                TRIGGER_ALERT(medium, email)
  - question: Has any single source IP sent an unusually high volume of email (e.g., >100) in a 5-minute window, where the emails claim to be from a single trusted domain?
    context: This question aims to detect bulk email spoofing campaigns. A legitimate server might send a lot of email, but a single, potentially compromised machine sending a high volume of email spoofing a trusted domain in a short time is highly suspicious and indicative of a phishing or malware distribution campaign.
    answer_sources:
      - Zeek smtp.log
      - Zeek conn.log
      - Network flow data collectors at the internet gateway
      - Email gateway transaction logs
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          COUNT emails by source_ip, from_domain in 5_minute_windows
          FOR each window:
            IF count > 100 AND from_domain IN trusted_domains:
              TRIGGER_ALERT(high, source_ip, from_domain)
  - question: Is the volume of email from any specific (Source IP, From Domain) pair exceeding its historical average by more than three standard deviations?
    context: This question uses statistical analysis (Z-score) to create a dynamic threshold for email volume, adapting to what is 'normal' for each specific sender. This is more effective than a static threshold for identifying anomalous spikes in traffic that could signal a compromised server or a targeted spoofing campaign.
    answer_sources:
      - Zeek smtp.log
      - Zeek conn.log
      - Network flow data collectors at the internet gateway
      - Email gateway transaction logs
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          FOR each (source_ip, from_domain) pair:
            baseline = calculate_volume_stats(pair, last_30_days)
            current_volume = get_current_volume(pair, last_10_mins)
            IF current_volume > baseline.mean + (3 * baseline.std_dev):
              TRIGGER_ALERT(medium, pair)
  - question: Are we observing email volume spikes from high-volume (Source IP, From Domain) pairs that cannot be explained by normal trends or seasonality?
    context: This question employs an advanced time-series model to filter out predictable, legitimate variations in email volume (like end-of-month billing). By analyzing the 'residual' or unexplained traffic, it can precisely identify anomalous bursts that are more likely to be malicious, reducing false alarms from normal business cycles.
    answer_sources:
      - Zeek smtp.log
      - Zeek conn.log
      - Network flow data collectors at the internet gateway
      - Email gateway transaction logs
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          FOR each high_volume_pair:
            model = get_timeseries_model(pair)
            residual = model.get_residual(current_volume)
            IF residual > residual_threshold:
              TRIGGER_ALERT(medium, pair)
  - question: Are we receiving emails claiming to be from a critical domain that originate from a country or Autonomous System Number (ASN) not on our explicit allow-list?
    context: This question uses a strict, rule-based approach for the most critical domains. Since legitimate email from these entities should only come from known infrastructure, any deviation is a high-confidence indicator of a spoofing attempt. It provides a simple but powerful defense for high-value targets.
    answer_sources:
      - Zeek smtp.log
      - Zeek conn.log
      - Internet gateway routers
      - Subscription-based GeoIP and ASN databases
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          FOR each email in inbound_emails:
            IF email.from_domain IN critical_domains:
              allowlist = get_origin_allowlist(email.from_domain)
              IF email.source_country NOT IN allowlist.countries OR email.source_asn NOT IN allowlist.asns:
                TRIGGER_ALERT(high, email)
  - question: Are emails claiming to be from a trusted domain originating from a new or statistically unusual country or ASN, based on historical patterns?
    context: This question moves beyond a static allow-list to a learned profile of normal behavior. By tracking which countries and ASNs a domain typically sends from, it can flag new or rare origins as suspicious. This is useful for detecting when attackers use novel infrastructure to launch spoofing campaigns.
    answer_sources:
      - Zeek smtp.log
      - Zeek conn.log
      - Internet gateway routers
      - Subscription-based GeoIP and ASN databases
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          FOR each email in inbound_emails:
            IF email.from_domain IN trusted_domains:
              IF is_new_origin(email.source_country, email.source_asn, email.from_domain):
                FLAG_FOR_REVIEW(email)
  - question: Are any inbound emails from high-value domains originating from IP addresses that are considered 'noise' or outliers by our infrastructure clustering model?
    context: This question uses advanced clustering to define 'normal sending infrastructure' in a multi-dimensional way, considering geography, network neighborhood (ASN), and reputation simultaneously. An email originating from an IP that doesn't fit into any established cluster is highly anomalous and likely part of a malicious campaign using atypical infrastructure.
    answer_sources:
      - Zeek smtp.log
      - Zeek conn.log
      - Internet gateway routers
      - Subscription-based GeoIP and ASN databases
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          FOR each email in inbound_emails:
            IF email.from_domain IN high_value_domains:
              model = get_clustering_model(email.from_domain)
              classification = model.classify(email.source_ip_features)
              IF classification == 'noise' OR classification IN sparse_clusters:
                TRIGGER_ALERT(medium, email)