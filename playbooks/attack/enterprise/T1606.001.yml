name: T1606.001: Web Cookies
id: 8f9b2d1c-7a0e-4b3f-8e2d-9c3f0a1b8d5e
description: This playbook focuses on detecting the malicious use of forged or stolen web cookies for unauthorized access to web resources. It provides investigative steps to identify sessions originating from suspicious sources (known malicious IPs, rare geolocations), sessions with anomalous attributes (unusual User-Agents, impossible travel), discrepancies between web access and endpoint logons, and unusual post-authentication behavior like accessing sensitive URLs or exfiltrating large amounts of data.
type: technique
related:
- TA0006: Credential Access
contributors:
- Zachary Szewczyk
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
- question: Is a successful authenticated web session originating from a known malicious IP address?
  context: This question aims to identify if an authenticated session, potentially using a stolen or forged cookie, is coming from an IP address listed on a high-confidence threat intelligence feed. Such sources include known command-and-control (C2) servers, anonymous proxies, or TOR exit nodes. A match indicates a high probability that the session is controlled by an adversary.
  answer_sources:
  - Zeek conn.log
  - Zeek http.log
  - Internet Gateway
  - Web Proxies
  - Public-facing Web Applications
  - Threat Intelligence Blocklist
  range: last 90 days
  queries:
  - search: pseudocode
    query: For each authenticated web request, extract source IP. Check if source IP exists in threat intelligence blocklist. Alert on match.
- question: Is a user authenticating from a network (ASN) that is statistically rare for them?
  context: This question seeks to detect compromised sessions by identifying logins from unusual network origins. By baselining the Autonomous System Numbers (ASNs) a user typically connects from, a login from a very infrequent ASN can indicate that an adversary is using the user's credentials or session cookie from a different network infrastructure.
  answer_sources:
  - Zeek conn.log
  - Zeek http.log
  - Internet Gateway
  - Web Proxies
  - Public-facing Web Applications
  - IP Geolocation/ASN Data
  range: last 90 days
  queries:
  - search: pseudocode
    query: For each user, baseline historical source ASNs. For new authenticated sessions, check if the source ASN is rare (e.g., <1% of historical sessions). Alert on rare ASN.
- question: Does a real-time machine learning model classify a session's source IP as malicious?
  context: This question leverages a machine learning model to provide a dynamic risk score for the source IP of an authenticated session. The model considers multiple features like ASN, country, and historical reputation to classify an IP in real-time. This approach can identify new or previously unknown malicious infrastructure that may not yet be on static blocklists.
  answer_sources:
  - Zeek conn.log
  - Zeek http.log
  - Internet Gateway
  - Web Proxies
  - Public-facing Web Applications
  - IP Reputation Model
  range: last 90 days
  queries:
  - search: pseudocode
    query: For each authenticated session, extract IP features (ASN, country, etc.). Input features into IP reputation model. Alert if classification is 'malicious'.
- question: Did a user's authenticated web session originate from a location that would require physically impossible travel since their last session?
  context: This question aims to detect 'impossible travel' scenarios, which are a strong indicator of credential or session compromise. It works by calculating the time and distance between a user's consecutive authenticated sessions. If the required travel speed to get from the first location to the second is physically impossible (e.g., faster than a commercial airplane), it suggests two different entities are using the same account from different places.
  answer_sources:
  - Zeek conn.log
  - Zeek http.log
  - Internet Gateway
  - VPN Concentrators
  - Public-facing Web Applications
  - Cloud Service Gateways
  - IP Geolocation Data
  range: last 90 days
  queries:
  - search: pseudocode
    query: For each new authenticated session, get source IP geolocation and timestamp. Compare with previous session's geolocation and timestamp. Calculate required travel speed. Alert if speed is impossible (e.g., >1000 km/h).
- question: Is a user logging in from a geolocation that is both new for them and rare for the organization?
  context: This question adds statistical context to location-based anomaly detection. Instead of just flagging any new location for a user, it cross-references the location's rarity across the entire organization. A login from a location that is both novel for the user and uncommon for the organization as a whole is a stronger indicator of a potential compromise.
  answer_sources:
  - Zeek conn.log
  - Zeek http.log
  - Internet Gateway
  - VPN Concentrators
  - Public-facing Web Applications
  - Cloud Service Gateways
  - IP Geolocation Data
  range: last 90 days
  queries:
  - search: pseudocode
    query: Baseline user's top 5 login geolocations. For a new login from a non-profiled location, check the rarity of that location across the organization. Alert if location is new for the user and rare for the organization.
- question: Does a machine learning model flag a user's sequence of login locations as a low-probability anomaly?
  context: This question uses a sequence-aware machine learning model (like a Markov Chain) to understand a user's typical patterns of movement between locations. The model learns common transitions (e.g., home to office). A login that represents a very unlikely transition is flagged as a high-risk anomaly, suggesting a compromised session.
  answer_sources:
  - Zeek conn.log
  - Zeek http.log
  - Internet Gateway
  - VPN Concentrators
  - Public-facing Web Applications
  - Cloud Service Gateways
  - IP Geolocation Data
  range: last 90 days
  queries:
  - search: pseudocode
    query: Model user's historical login location sequences. For a new login, calculate the transition probability from the previous location. Alert if the probability is below a learned threshold.
- question: Is an authenticated web session using a User-Agent string associated with known hacking tools?
  context: This question performs a straightforward check against a blocklist of User-Agent strings often used by adversaries and their automated tools (e.g., sqlmap, nmap). Matching a session's User-Agent against this list is a high-confidence method for identifying malicious activity.
  answer_sources:
  - Zeek http.log
  - Zeek conn.log
  - Public-facing Web Applications
  - Web Proxies
  - Internet Gateway
  - User-Agent Blocklist
  range: last 90 days
  queries:
  - search: pseudocode
    query: For each web request, extract the User-Agent string. Compare against a blocklist of malicious User-Agents. Alert on match.
- question: Is a user's authenticated session using a User-Agent string that has never been seen for that specific user before?
  context: This question uses a 'first-seen' statistical approach to detect behavioral deviations. Users typically use a limited set of browsers and devices, resulting in a stable set of User-Agent strings. A session initiated with a completely new User-Agent for that user is anomalous and could indicate an adversary is using a different toolset with a stolen cookie.
  answer_sources:
  - Zeek http.log
  - Zeek conn.log
  - Public-facing Web Applications
  - Web Proxies
  - Internet Gateway
  range: last 90 days
  queries:
  - search: pseudocode
    query: Maintain a historical set of User-Agents for each user. For each new authenticated session, check if the User-Agent is in the user's set. Alert if it is a first-seen User-Agent for that user.
- question: Does a multi-variate anomaly detection model identify the current web session as anomalous based on a combination of its attributes?
  context: This question seeks to identify sophisticated attacks by looking at a combination of session features holistically. A machine learning model can learn the normal relationships between multiple variables (time, ASN, country, User-Agent) and flag sessions where the combination of these attributes is highly abnormal, even if each individual attribute is not.
  answer_sources:
  - Zeek http.log
  - Zeek conn.log
  - Public-facing Web Applications
  - Web Proxies
  - Internet Gateway
  - Anomaly Detection Model
  range: last 90 days
  queries:
  - search: pseudocode
    query: For each session, extract features (time, ASN rarity, country rarity, User-Agent rarity). Input feature vector into a pre-trained anomaly detection model. Alert if the anomaly score exceeds the threshold.
- question: Did a user's authenticated web session from an external IP occur without a corresponding recent interactive or remote logon event on a corporate endpoint?
  context: This question aims to find sessions initiated directly with a stolen artifact (like a cookie). The expected behavior for a remote user is to first log on to their corporate device, generating a logon event. A web session from an external IP without a preceding endpoint logon event is highly suspicious and suggests the session was not initiated by the legitimate user on their managed device.
  answer_sources:
  - Zeek http.log
  - Windows Event ID 4624
  - Authentication Servers (e.g., Active Directory Domain Controllers)
  - Endpoints
  - Public-facing Web Applications
  range: last 90 days
  queries:
  - search: pseudocode
    query: For each external authenticated web session, get username and timestamp. Query endpoint logs for a corresponding Windows Logon Event (ID 4624, Type 2/3/10) for that user within the prior 30 minutes. Alert if no such event is found.
- question: Is the time delay between a user's Windows logon and their subsequent web session statistically abnormal for that user?
  context: This question builds a behavioral baseline for each user's typical workflow by measuring the time difference between machine logon and web access. A significant deviation from this personal baseline could indicate that the web session was initiated by an adversary who has gained access to a session cookie from a previously legitimate session.
  answer_sources:
  - Zeek http.log
  - Windows Event ID 4624
  - Authentication Servers (e.g., Active Directory Domain Controllers)
  - Endpoints
  - Public-facing Web Applications
  range: last 90 days
  queries:
  - search: pseudocode
    query: For each user, baseline the time delta between Windows logon (Event 4624) and first web access. For new web sessions, calculate the delta. Alert if the delta is a statistical outlier (e.g., >3 standard deviations from the mean).
- question: Does a sequence mining model identify a web session as an anomalous starting point in a user's typical event pathway?
  context: This question uses machine learning to understand the 'story' of a user's activity across different systems. It learns common sequences of events. A sequence that starts anomalously with web application access without a preceding valid logon event is flagged as a high-risk anomaly, suggesting the session was injected into the user's timeline using a stolen cookie.
  answer_sources:
  - Zeek http.log
  - Windows Event ID 4624
  - Authentication Servers (e.g., Active Directory Domain Controllers)
  - Endpoints
  - Public-facing Web Applications
  range: last 90 days
  queries:
  - search: pseudocode
    query: Model common user event sequences across endpoint and web logs. Identify valid starting events for sequences (e.g., logon). Alert if a sequence begins with a web session without a valid preceding event.
- question: Did a user's web session access sensitive or 'honeypot' URLs that are unusual for their role?
  context: This question uses the technique of monitoring access to predefined sensitive URLs. These 'honeypot' or critical paths (e.g., administrative consoles, data export functions) are often targeted by adversaries post-compromise but are rarely accessed by regular users. An alert on access to these URLs provides a high-fidelity signal of malicious exploration or data exfiltration.
  answer_sources:
  - Zeek http.log
  - Zeek files.log
  - Public-facing Web Applications
  - File Servers
  - Database Servers
  range: last 90 days
  queries:
  - search: pseudocode
    query: Maintain a list of sensitive/honeypot URLs. Monitor all web requests. Alert if any user session accesses a URL on this list.
- question: Is a user's web session exhibiting an unusually high rate of requests or downloading an abnormally large amount of data?
  context: This question seeks to detect brute-force enumeration and data exfiltration by monitoring the volume of activity within a session. By establishing a statistical baseline for each user's normal request rate and data transfer volume, the system can flag sessions that suddenly exceed these thresholds, indicating potential automated adversary activity.
  answer_sources:
  - Zeek http.log
  - Zeek files.log
  - Public-facing Web Applications
  - File Servers
  - Database Servers
  range: last 90 days
  queries:
  - search: pseudocode
    query: Baseline the 99th percentile of requests/minute and data downloaded/session for each user. Monitor active sessions in sliding windows. Alert if a user's activity exceeds their established baseline.
- question: Does a machine learning model flag the sequence of URLs visited within a user's session as anomalous navigation?
  context: This question uses a sequence-aware model (like an RNN) to learn the 'grammar' of how users normally navigate through a web application. When an adversary takes over a session, their navigation pattern will likely not conform to this learned grammar. The model can detect these low-probability sequences as anomalies, indicating malicious exploration.
  answer_sources:
  - Zeek http.log
  - Zeek files.log
  - Public-facing Web Applications
  - File Servers
  - Database Servers
  range: last 90 days
  queries:
  - search: pseudocode
    query: Train an RNN/LSTM model on normal user URL navigation sequences within sessions. For new requests in a session, predict the probability of that request given the prior sequence. Alert if the probability is anomalously low.