name: T1430.001: Remote Device Management Services
id: e4d2c1b0-a9f8-4e7d-8b6a-5c3d2e1f0a9b
description: |
  This playbook helps investigate whether an adversary is leveraging Remote Device Management Services to first discover and then collect the physical location of managed mobile devices. The investigation focuses on identifying anomalous administrative access to EMM/MDM consoles, characterized by logins from threat-listed IPs, novel geolocations or ASNs, unusual times, rare TLS fingerprints (JA3/JA3S), or non-standard user-agents. Following a suspicious login, the playbook looks for anomalous patterns of device location queries, such as an unusually high rate of API calls, querying an abnormal number of unique devices, scripted/automated query patterns (indicated by low Shannon entropy, $$ H(X) < 2.0 $$), or a focus on high-value personnel.
type: technique
related:
  - TA0032: Discovery
  - TA0035: Collection
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Has a successful administrative login to an EMM/MDM server originated from a known malicious IP address or used a malicious user-agent?
    context: |
      This question aims to detect the most straightforward sign of a compromise: an administrative login from a source already identified as malicious by threat intelligence. A match provides a high-confidence signal that an adversary is attempting to access sensitive device management capabilities. The focus is on real-time alerting for immediate response.
    answer_sources:
      - Windows Event ID 4624
      - EMM/MDM application logs
      - Zeek conn.log
      - Zeek ssl.log
      - Zeek http.log
      - Zeek notice.log
      - EMM/MDM web application servers
      - Authentication servers (e.g., Domain Controllers)
      - Network egress points and web proxies
      - Administrative workstations and VDI environments
      - Cloud Identity Provider (IdP) consoles and logs
    range: last 90 days
    queries:
      - technology: SIEM
        query: |
          SEARCH EMM/MDM successful admin logins (e.g., EventID 4624, Logon Type 3/10)
          | JOIN source IP with threat intelligence feed
          | JOIN user-agent with malicious signature list
          | WHERE threat_match OR signature_match
  - question: Did a successful administrative login to the EMM/MDM platform exhibit multiple behavioral anomalies when compared to the user's historical baseline?
    context: |
      This question seeks to identify suspicious administrative logins that deviate from a user's established pattern of activity. By baselining normal behavior (source country/ASN, login hours, user-agents, TLS fingerprints) and scoring deviations, this approach can uncover compromised accounts used by adversaries, even if the source isn't on a known threat list. A high cumulative risk score suggests a login that is highly uncharacteristic for the user and warrants investigation.
    answer_sources:
      - Windows Event ID 4624
      - EMM/MDM application logs
      - Zeek conn.log
      - Zeek ssl.log
      - Zeek http.log
      - Zeek notice.log
      - EMM/MDM web application servers
      - Authentication servers (e.g., Domain Controllers)
      - Network egress points and web proxies
      - Administrative workstations and VDI environments
      - Cloud Identity Provider (IdP) consoles and logs
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: |
          FOR each admin login
          | COMPARE source_country, login_hour, user_agent, ja3_hash against user's 90-day baseline
          | CALCULATE risk_score based on deviations
          | ALERT if risk_score >= 2
  - question: Has an unsupervised machine learning model identified a recent EMM/MDM administrative login as a significant statistical outlier?
    context: |
      This question leverages machine learning to detect novel or complex anomalies that rule-based systems might miss. An unsupervised model (like Isolation Forest or Local Outlier Factor) learns the characteristics of normal administrative logins from multiple features simultaneously. It can then flag events that are highly improbable or statistically isolated from the normal cluster, indicating a potential compromise that doesn't fit any single pre-defined rule.
    answer_sources:
      - Windows Event ID 4624
      - EMM/MDM application logs
      - Zeek conn.log
      - Zeek ssl.log
      - Zeek http.log
      - Zeek notice.log
      - EMM/MDM web application servers
      - Authentication servers (e.g., Domain Controllers)
      - Network egress points and web proxies
      - Administrative workstations and VDI environments
      - Cloud Identity Provider (IdP) consoles and logs
    range: last 90 days
    queries:
      - technology: ML Model
        query: |
          PREDICT anomaly_score for new admin login using trained Isolation Forest model
          | FEATURES: source_asn, source_country, time_of_day, user_agent_hash, ja3_hash
          | ALERT if anomaly_score is in top 1%
  - question: Did a user account trigger multiple device location queries shortly after a suspicious login event?
    context: |
      This question aims to directly link a suspicious access event to subsequent suspicious collection activity. An adversary who gains access will likely move quickly to achieve their objective. By correlating a high-risk login alert with a rapid succession of location API calls from the same account, we can generate a high-confidence alert that an active collection attempt is underway.
    answer_sources:
      - EMM/MDM application logs
      - Zeek http.log
      - Zeek conn.log
      - Zeek dns.log
      - Zeek notice.log
      - EMM/MDM web application servers
      - Network egress points and web proxies
      - Cloud service access points (for iCloud/Google Find My)
      - DNS resolvers and forwarders
    range: last 90 days
    queries:
      - technology: SIEM
        query: |
          TRIGGER on anomalous_login_alert
          | SEARCH for location API calls (e.g., to URI path `/api/v*/devices/locate`) from same user within 10 minutes
          | IF count(location_calls) > 5, CREATE critical alert
  - question: Is an administrative account exhibiting anomalous device location query patterns, such as an excessive rate of queries, targeting an unusual number of devices, using scripted timing, or focusing on high-value personnel?
    context: |
      This question focuses on identifying anomalous collection behavior, even if the initial login was not flagged. An adversary might use a "clean" session or their access might have been missed. By baselining normal query behavior for each admin, we can detect deviations like a sudden spike in query volume, targeting an abnormally high number of unique devices, automated/scripted query timing (low entropy), or a suspicious focus on sensitive user groups like executives.
    answer_sources:
      - EMM/MDM application logs
      - Zeek http.log
      - Zeek conn.log
      - Zeek dns.log
      - Zeek notice.log
      - EMM/MDM web application servers
      - Network egress points and web proxies
      - Cloud service access points (for iCloud/Google Find My)
      - DNS resolvers and forwarders
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: |
          FOR each admin user's 1-hour window
          | CALCULATE location_query_count, unique_device_count, time_interval_entropy, high_value_target_percent
          | COMPARE against user and global 30-day baselines
          | ALERT if thresholds are exceeded (e.g., query_count > 99th percentile, entropy < 2.0)
  - question: Has a machine learning model detected a system-wide anomaly in EMM/MDM device location activity, suggesting a coordinated collection effort?
    context: |
      This question seeks to identify large-scale or coordinated collection campaigns that might not be obvious when looking at a single user's activity. A time-series anomaly detection model (like an LSTM autoencoder) learns the normal rhythm and interplay of platform-wide metrics (total queries, unique users, unique devices, etc.). An alert is triggered when the actual system behavior deviates significantly from the model's prediction, indicating a potential widespread, coordinated attack.
    answer_sources:
      - EMM/MDM application logs
      - Zeek http.log
      - Zeek conn.log
      - Zeek dns.log
      - Zeek notice.log
      - EMM/MDM web application servers
      - Network egress points and web proxies
      - Cloud service access points (for iCloud/Google Find My)
      - DNS resolvers and forwarders
    range: last 90 days
    queries:
      - technology: ML Model
        query: |
          PREDICT next state of system-wide metrics using trained LSTM autoencoder model
          | CALCULATE reconstruction_error between prediction and actual minute-by-minute metrics
          | ALERT if error exceeds 99.5% confidence threshold