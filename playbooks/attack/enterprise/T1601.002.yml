name: 'T1601.002: Downgrade System Image'
id: 9c1f6a8e-4a0f-4b9b-9a8c-2d3e1f0b7a6d
description: 'This playbook investigates whether an adversary is evading defenses by downgrading system images on network devices. It focuses on detecting indicators such as: file transfers of known-vulnerable firmware images; explicit commands modifying boot configurations to unapproved images; devices rebooting into an older version than the baseline; firmware transfers from anomalous sources; and correlated event sequences of a file transfer, boot command, and reboot.'
type: technique
related:
  - 'TA0005: Defense Evasion'
contributors: 'Zachary Szewczyk, Ask Sage'
created: '2025-10-01'
modified: '2025-10-01'
version: 1.0
tags: none
questions:
  - question: 'Are files being transferred that match a watchlist of known-vulnerable or outdated network device firmware images?'
    context: 'This question aims to detect the transfer of malicious or downgraded firmware. By maintaining a pre-compiled list of file hashes (SHA256/MD5) for known-vulnerable firmware, analysts can proactively identify when these files traverse the network. A match provides a high-fidelity indicator that an adversary is staging a vulnerable image on a network device for a downgrade attack.'
    answer_sources: 'Zeek files.log, Zeek conn.log, Network traffic at aggregation points, Network management servers, Firmware distribution points, Core routers and switches'
    range: 'last 90 days'
    queries:
      - technology: pseudocode
        query: 'SEARCH Zeek files.log WHERE file_hash IN (vulnerable_firmware_hash_watchlist) | ALERT on match'
  - question: 'Are firmware files being transferred from unusual or non-standard sources at an anomalous frequency?'
    context: 'This question focuses on identifying deviations from normal firmware update behavior. Legitimate updates typically originate from specific management servers. By baselining these sources and protocols, analysts can detect when firmware files are transferred from new or rare IP addresses. An alert triggered when the frequency of such transfers exceeds a statistical threshold can indicate an adversary using a compromised machine to push a malicious image.'
    answer_sources: 'Zeek files.log, Zeek conn.log, Network traffic at aggregation points, Network management servers, Firmware distribution points, Core routers and switches'
    range: 'last 90 days'
    queries:
      - technology: pseudocode
        query: 'SEARCH Zeek logs for firmware file transfers | GROUPBY source_ip, device_type | COMPARE transfer frequency against historical baseline | ALERT if frequency > 95th percentile'
  - question: 'Are new firmware file transfers being classified as malicious by a trained machine learning model?'
    context: 'This question uses machine learning to distinguish between benign and malicious firmware transfers. A model can be trained on features from network traffic (e.g., source IP locality, file type, size, time of day) to learn what legitimate updates look like. The deployed model can then classify new transfers, providing a sophisticated method for detecting novel or cleverly disguised attack attempts that might evade simpler rule-based checks.'
    answer_sources: 'Zeek files.log, Zeek conn.log, Network traffic at aggregation points, Network management servers, Firmware distribution points, Core routers and switches'
    range: 'last 90 days'
    queries:
      - technology: pseudocode
        query: 'INPUT file transfer event features INTO classification_model | ALERT if classification is "malicious" with high confidence'
  - question: 'Are commands being executed on network devices to change the boot configuration to an unapproved system image?'
    context: 'This question targets the direct manipulation of a device''s boot configuration. An adversary must instruct the device to use a malicious image on reboot. By monitoring syslog for specific boot commands (e.g., `boot system flash`) and cross-referencing the specified image file against an authoritative list (CMDB), analysts can detect unauthorized changes. An alert signifies a direct attempt to arm a malicious image.'
    answer_sources: 'Zeek syslog.log, Windows Event ID 4688, Windows Event ID 4648, Syslog servers, Network device command line interfaces (CLIs), Windows-based network management workstations, SIEM/Log aggregation platform'
    range: 'last 90 days'
    queries:
      - technology: pseudocode
        query: 'SEARCH syslog for regex "boot system" OR "set system image" | EXTRACT image_file | LOOKUP image_file against approved CMDB list | ALERT if not approved'
  - question: 'Is an administrative user issuing boot configuration commands that are statistically rare or outside their normal behavior?'
    context: 'This question seeks to identify compromised or malicious insider activity by baselining administrative behavior. Every administrator and device has a typical pattern of activity. An alert is generated if a user issues a boot configuration command at an unusual time, or if the command itself is rare for that user, which could indicate that their credentials are being used by an adversary to execute a downgrade.'
    answer_sources: 'Zeek syslog.log, Windows Event ID 4688, Windows Event ID 4648, Syslog servers, Network device command line interfaces (CLIs), Windows-based network management workstations, SIEM/Log aggregation platform'
    range: 'last 90 days'
    queries:
      - technology: pseudocode
        query: 'ANALYZE user command history for boot config changes | CALCULATE frequency and entropy | ALERT if current command is > 3 standard deviations from user baseline'
  - question: 'Do command sequences on network devices represent an anomalous or malicious series of actions?'
    context: 'This question analyzes the entire lifecycle of an administrative session, not just a single command. Legitimate activities follow predictable patterns (e.g., login -> check status -> configure -> exit). A sequence analysis model can learn these patterns. An alert on a sequence with a low probability of being legitimate, such as one involving a direct boot image change without preceding checks, can uncover a hidden attack path.'
    answer_sources: 'Zeek syslog.log, Windows Event ID 4688, Windows Event ID 4648, Syslog servers, Network device command line interfaces (CLIs), Windows-based network management workstations, SIEM/Log aggregation platform'
    range: 'last 90 days'
    queries:
      - technology: pseudocode
        query: 'MODEL admin command sequences (e.g., HMM, LSTM) | SCORE new command sessions | ALERT if session probability is below legitimate threshold'
  - question: 'Have any network devices rebooted into an older OS version than what is recorded in the configuration baseline?'
    context: 'This question provides a definitive confirmation of a successful downgrade. By parsing boot-up messages from device syslog and comparing the reported OS version with an authoritative CMDB or asset inventory, analysts can immediately spot a discrepancy. Alerting when the logged version is verifiably older than the expected version is a critical, high-confidence signal that a device is now running a vulnerable image.'
    answer_sources: 'Zeek syslog.log, Syslog servers, Configuration Management Database (CMDB), Network devices themselves via polling'
    range: 'last 90 days'
    queries:
      - technology: pseudocode
        query: 'ON device boot syslog event | PARSE hostname, logged_version | LOOKUP cmdb_version for hostname | ALERT if logged_version is older than cmdb_version'
  - question: 'Has a network device reported a version that is older than its own previously reported version?'
    context: 'This question provides a simple yet effective stateful check for downgrades, without relying on an external CMDB. By tracking the last known OS version for each device, any change to an older version can be detected. This method is resilient to CMDB inaccuracies and quickly flags any regression in a device''s security posture, indicating a potential compromise or misconfiguration.'
    answer_sources: 'Zeek syslog.log, Syslog servers, Configuration Management Database (CMDB), Network devices themselves via polling'
    range: 'last 90 days'
    queries:
      - technology: pseudocode
        query: 'ON device version check-in | RETRIEVE last_known_version for device | ALERT if new_version is older than last_known_version | UPDATE last_known_version'
  - question: 'Is a time-series analysis of device version reporting flagging any anomalous changes?'
    context: 'This question applies anomaly detection to device versioning, treating it as a time-series dataset. For most devices, the version should be a stable value that only changes during planned maintenance. A model can learn this pattern and flag any version change outside of these windows as a highly suspicious anomaly, suggesting an unauthorized downgrade event.'
    answer_sources: 'Zeek syslog.log, Syslog servers, Configuration Management Database (CMDB), Network devices themselves via polling'
    range: 'last 90 days'
    queries:
      - technology: pseudocode
        query: 'APPLY time-series anomaly detection to device version history | ALERT on unexpected version changes outside of maintenance windows'
  - question: 'Is a firmware file being transferred to a network device from an unapproved source IP address?'
    context: 'This question establishes a simple but critical security boundary. Legitimate firmware updates should only come from a small, well-defined set of management servers. This rule creates an alert any time a file with a firmware extension (e.g., .bin, .img) is sent to a network device from any IP address not on the approved list, effectively catching attempts to push images from unauthorized external or internal hosts.'
    answer_sources: 'Zeek files.log, Zeek conn.log, Network traffic at aggregation points (e.g., core switch SPAN port), Network management subnet, Internet gateway'
    range: 'last 90 days'
    queries:
      - technology: pseudocode
        query: 'SEARCH file transfers TO network_device_ip_range WHERE file_extension IN (.bin, .img, .swi) AND source_ip NOT IN (approved_mgmt_servers) | ALERT'
  - question: 'Does a firmware transfer exhibit a high-risk score based on multiple behavioral deviations?'
    context: 'This question moves beyond single indicators to a holistic risk assessment. Instead of just one anomaly, it scores a transfer based on multiple deviations from a baseline, such as an external source IP, an unusual time of day, or an atypical file size. A high cumulative score indicates that the transfer is suspicious across several vectors, making it a higher-confidence candidate for investigation and reducing false positives from a single anomaly.'
    answer_sources: 'Zeek files.log, Zeek conn.log, Network traffic at aggregation points (e.g., core switch SPAN port), Network management subnet, Internet gateway'
    range: 'last 90 days'
    queries:
      - technology: pseudocode
        query: 'SCORE firmware transfer based on deviations (source, time, size) from baseline | ALERT if risk_score > 98th percentile'
  - question: 'Are firmware transfers being grouped into anomalous clusters separate from normal update activity?'
    context: 'This question uses unsupervised machine learning to find outliers. A clustering algorithm like DBSCAN can group all firmware transfer events based on their properties. Legitimate updates from management servers will form a dense, normal cluster. Any transfer that is isolated or forms its own small, sparse cluster is, by definition, different from the norm and should be investigated as a potential threat.'
    answer_sources: 'Zeek files.log, Zeek conn.log, Network traffic at aggregation points (e.g., core switch SPAN port), Network management subnet, Internet gateway'
    range: 'last 90 days'
    queries:
      - technology: pseudocode
        query: 'CLUSTER firmware transfers by source, protocol, size, time | ALERT on events classified as noise or belonging to anomalous, sparse clusters'
  - question: 'Has a correlated sequence of a firmware transfer, boot command, and device reboot occurred for a single device in a short time window?'
    context: 'This question connects the dots of a multi-stage attack. A downgrade requires a file transfer, a boot configuration change, and a reboot. This correlation rule looks for this exact sequence of events occurring for the same device within a short timeframe (e.g., 60 minutes). An alert on this sequence is a very strong indicator of a complete downgrade attack lifecycle, especially if it occurs outside a planned maintenance window.'
    answer_sources: 'Zeek files.log, Zeek syslog.log, Zeek conn.log, Windows Event ID 4688, SIEM/Log aggregation platform, Network management servers, Core network devices, Windows hosts used for network administration'
    range: 'last 90 days'
    queries:
      - technology: pseudocode
        query: 'CORRELATE events for same device_ip: (Event A: firmware transfer) FOLLOWED BY (Event B: boot command) FOLLOWED BY (Event C: reboot) within 60 minutes | ALERT'
  - question: 'Is the sequence of a firmware transfer, boot command, and reboot occurring at a statistically anomalous frequency?'
    context: 'This question adds a layer of behavioral analysis to the correlation rule. While the sequence of transfer-command-reboot is suspicious, it may occur legitimately during maintenance. This analytic establishes a baseline for how often this sequence occurs and alerts if it happens outside a maintenance window or at a frequency that is statistically unusual (e.g., more than once per quarter), indicating a potential attack.'
    answer_sources: 'Zeek files.log, Zeek syslog.log, Zeek conn.log, Windows EventID 4688, SIEM/Log aggregation platform, Network management servers, Core network devices, Windows hosts used for network administration'
    range: 'last 90 days'
    queries:
      - technology: pseudocode
        query: 'COUNT occurrences of (transfer -> command -> reboot) sequence per device | COMPARE against baseline frequency | ALERT if frequency is anomalous'
  - question: 'Does the graph of entities and actions related to a firmware update match a known attack pattern or deviate from normal activity?'
    context: 'This question uses advanced graph analysis to map out the entire context of an administrative action. By representing users, devices, and IPs as nodes and their actions (login, transfer, command) as edges, the model can visualize and analyze the structure of an event. It can then identify when a sub-graph matches a known attack pattern (e.g., external IP -> compromised host -> switch) or deviates significantly from the structure of a normal, legitimate update.'
    answer_sources: 'Zeek files.log, Zeek syslog.log, Zeek conn.log, Windows Event ID 4688, SIEM/Log aggregation platform, Network management servers, Core network devices, Windows hosts used for network administration'
    range: 'last 90 days'
    queries:
      - technology: pseudocode
        query: 'BUILD graph of entities and actions for firmware update event | COMPARE subgraph structure to known benign and malicious patterns | ALERT on match to malicious pattern'