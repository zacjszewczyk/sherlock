name: "T1430: Location Tracking"
id: "a3e8f9b0-1c7d-4b5a-9e6f-0a1b2c3d4e5f"
description: "This playbook is designed to help analysts investigate whether an adversary is discovering, collecting, and exfiltrating the physical location of mobile devices. It provides questions and queries to detect malicious applications with high-risk location permissions, identify anomalous spikes in location service API calls, and uncover suspicious network activity indicative of data exfiltration, such as connections to known C2 infrastructure, use of rare TLS fingerprints, or unusually large data uploads from location-aware applications."
type: "technique"
related:
  - "TA0032: Discovery"
  - "TA0035: Collection"
contributors:
  - "Zachary Szewczyk"
  - "Ask Sage"
created: "2025-10-01"
modified: "2025-10-01"
version: 1.0
tags: "none"
questions:
  - question: "Are any installed mobile applications known malicious tools that leverage high-risk location permissions?"
    context: "This question aims to identify obvious threats by cross-referencing applications that request sensitive background location permissions with known indicators of compromise from threat intelligence feeds. A match provides a high-confidence signal that a malicious actor has deployed a tool for location tracking."
    answer_sources:
      - "Mobile Device Management (MDM) application inventory logs"
      - "AndroidManifest.xml"
      - "Info.plist"
      - "Threat intelligence feeds"
      - "MDM/UEM server, internal application repository, cloud-hosted application vetting sandboxes, threat intelligence platform."
    range: "Last 90 days"
    queries:
      - "pseudocode: FOR each application in MDM inventory, IF app has high-risk location permission, THEN query threat intelligence platform with app package name and hash. ALERT on match."
  - question: "Are there any mobile applications exhibiting anomalous permission requests for their category, specifically for background location access?"
    context: "This question seeks to uncover suspicious applications that may not be on a known threat list. It operates on the principle that applications within a specific category (e.g., 'Productivity') tend to have similar permission profiles. An app that requests background location and has a significantly higher number of total permissions than its peers is an outlier that warrants manual investigation for potential misuse."
    answer_sources:
      - "Mobile Device Management (MDM) application inventory logs"
      - "AndroidManifest.xml"
      - "Info.plist"
      - "MDM/UEM server, internal application repository, cloud-hosted application vetting sandboxes."
    range: "Last 90 days"
    queries:
      - "pseudocode: PARSE manifests for all apps to get permissions. GROUP apps by category. FOR each category, CALCULATE permission distribution. FLAG apps requesting background location AND whose permission count > 95th percentile for its category."
  - question: "Can we use machine learning to proactively identify potentially malicious applications that request location permissions?"
    context: "This question focuses on using a predictive model to flag high-risk applications. By training a classifier on features extracted from application manifests (like permission sets and API calls), it's possible to identify applications that share characteristics with known malware. A high-confidence 'malicious' classification for an app with location permissions can trigger automated defensive actions, such as quarantining the device."
    answer_sources:
      - "AndroidManifest.xml"
      - "Info.plist"
      - "MDM/UEM server"
    range: "Last 90 days"
    queries:
      - "pseudocode: EXTRACT features (permissions, components, API calls) from app manifests. APPLY pre-trained classification model. IF app has location permissions AND model_confidence > 0.90, THEN trigger quarantine and ALERT."
  - question: "Is any mobile device communicating with known malicious command and control (C2) infrastructure?"
    context: "This question aims to detect active compromises by checking if network traffic from mobile devices is directed towards destinations associated with malicious activity. A match against a threat intelligence feed for C2 servers is a strong indicator that a device is compromised and potentially exfiltrating location or other sensitive data."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Threat intelligence feeds"
      - "MDM/VPN logs"
      - "Corporate-managed mobile devices, network egress points (e.g., VPN concentrators, corporate Wi-Fi access points), DNS resolvers, cloud-hosted MTD/MDM platforms."
    range: "Last 90 days"
    queries:
      - "pseudocode: FROM mobile IP range traffic, CORRELATE destination IPs and DNS queries with threat intelligence feeds. ALERT on match, enriching with device and user ID."
  - question: "Are there any mobile devices exhibiting an unusual spike in location service usage or connecting to new, un-baselined network destinations?"
    context: "This question uses two behavioral anomaly detection methods. First, it looks for a sudden, statistically significant increase in location API calls, which could indicate a malicious app has become active. Second, it identifies when a device communicates with a network destination never before seen from the entire mobile fleet, which could be a newly established C2 channel."
    answer_sources:
      - "Mobile Threat Defense (MTD) API call logs"
      - "Zeek conn.log"
      - "Zeek ssl.log"
      - "Corporate-managed mobile devices, network egress points (e.g., VPN concentrators, corporate Wi-Fi access points), DNS resolvers, cloud-hosted MTD/MDM platforms."
    range: "Last 90 days"
    queries:
      - "pseudocode: 1) For each device, IF hourly location API calls > (3 * 30-day_std_dev) + 30-day_mean, ALERT. 2) IF device connects to IP not in 60-day fleet baseline, ALERT."
  - question: "Can we detect anomalous user behavior based on a device's location history and API call patterns?"
    context: "This question applies more advanced modeling to detect subtle anomalies. It uses time-series analysis to find deviations from a user's normal daily/weekly location API usage patterns (e.g., usage outside of commute times). It also uses clustering on historical GPS data to identify when a device appears in a location inconsistent with the user's established areas of activity (e.g., home, office)."
    answer_sources:
      - "Mobile Threat Defense (MTD) API call logs"
      - "MDM location history logs"
      - "Corporate-managed mobile devices, cloud-hosted MTD/MDM platforms."
    range: "Last 90 days"
    queries:
      - "pseudocode: 1) APPLY time-series anomaly model to hourly location API calls. ALERT on deviation. 2) CLUSTER historical GPS coordinates. ALERT if new coordinate is an outlier."
  - question: "Is an application with location permissions communicating with a potential C2 server?"
    context: "This question seeks to identify covert C2 channels by correlating application-level network activity with network-level indicators. It specifically looks for connections from location-aware apps to destinations that are listed in threat intelligence feeds, indicating a high probability of malicious data exfiltration."
    answer_sources:
      - "MDM/MTD application network logs"
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Zeek ssl.log"
      - "Threat intelligence feeds"
      - "Network egress points, firewalls, proxies, VPN concentrators, DNS resolvers, threat intelligence platforms, MDM/MTD cloud consoles."
    range: "Last 90 days"
    queries:
      - "pseudocode: JOIN app network logs with Zeek logs. FOR connections from location-aware apps, CHECK destination IP/DNS/SNI against C2 threat feeds. ALERT on match."
  - question: "Is an application with location permissions using a non-standard or rare TLS client for its communications?"
    context: "This question focuses on identifying malicious tools that use custom or unusual networking libraries. The JA3 hash represents the client-side of a TLS session. Legitimate applications tend to use standard libraries, resulting in common JA3 hashes. A very rare JA3 hash from a location-aware app suggests it may be using a custom client specifically designed for stealthy C2 communication."
    answer_sources:
      - "Zeek ssl.log"
      - "MDM/MTD application network logs"
      - "Network egress points, firewalls, proxies, VPN concentrators, DNS resolvers, threat intelligence platforms, MDM/MTD cloud consoles."
    range: "Last 30 days"
    queries:
      - "pseudocode: CALCULATE frequency of all JA3 hashes from mobile fleet over 30 days. IF a location-aware app uses a JA3 with frequency < 0.01%, ALERT."
  - question: "Can we assign a risk score to outbound network connections to proactively identify potential data exfiltration?"
    context: "This question involves creating a composite risk score for network connections using a machine learning model. By combining multiple weak signals—such as IP reputation, data volume, and the rarity of the TLS fingerprint (JA3)—the model can identify high-risk connections that might be missed by single-indicator rules. A high score for a connection from a location-aware app is a strong signal of potential exfiltration."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Zeek ssl.log"
      - "MDM/MTD application network logs"
      - "Threat intelligence feeds"
      - "Network egress points, firewalls, proxies, VPN concentrators, DNS resolvers, threat intelligence platforms, MDM/MTD cloud consoles."
    range: "Last 90 days"
    queries:
      - "pseudocode: FOR each outbound connection, engineer features (IP reputation, port, JA3 prevalence, DNS entropy, bytes sent, etc.). APPLY trained ML model. IF risk_score > 0.85, create investigation ticket."
  - question: "Is a mobile device sending a large amount of data to a non-approved external destination?"
    context: "This question looks for blatant data exfiltration by setting a hard threshold for data uploads to destinations that are not on a corporate allow-list. This can be effective at catching unsophisticated exfiltration attempts where a large amount of data is sent in a single session."
    answer_sources:
      - "Zeek conn.log"
      - "MDM/MTD application activity logs"
      - "Network egress points (e.g., VPN concentrators, corporate Wi-Fi gateways), corporate-managed mobile devices, MDM/MTD cloud consoles."
    range: "Last 90 days"
    queries:
      - "pseudocode: FOR each connection from mobile IP range, IF destination is not on allow-list AND uploaded_bytes > 50MB, ALERT with device ID and active app."
  - question: "Is any mobile device exhibiting a statistically significant increase in its daily data upload volume?"
    context: "This question uses the device's own historical behavior as a baseline to detect anomalies in data exfiltration. By identifying days where a device's total data upload volume is unusually high (e.g., exceeds the 99th percentile of its 30-day history), analysts can spot potential exfiltration events that might be missed by fixed thresholds."
    answer_sources:
      - "Zeek conn.log"
      - "MDM/MTD application activity logs"
      - "Network egress points (e.g., VPN concentrators, corporate Wi-Fi gateways), corporate-managed mobile devices, MDM/MTD cloud consoles."
    range: "Last 30 days"
    queries:
      - "pseudocode: FOR each device, calculate 30-day baseline of daily upload volume. IF today's volume > 99th percentile of baseline, ALERT with top destinations and apps."
  - question: "Can we use predictive modeling to detect anomalous data upload volumes and automatically characterize the associated network activity?"
    context: "This question employs a more sophisticated, predictive approach to finding data exfiltration. A time-series model forecasts the expected data usage for a device, and an alert is triggered if the actual usage significantly deviates. It then automatically categorizes the destination domains visited during the anomaly using topic modeling, helping to quickly distinguish between benign activity and suspicious traffic."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek ssl.log"
      - "MDM/MTD application activity logs"
      - "Network egress points (e.g., VPN concentrators, corporate Wi-Fi gateways), corporate-managed mobile devices, MDM/MTD cloud consoles."
    range: "Last 90 days"
    queries:
      - "pseudocode: 1) APPLY time-series forecast model to daily upload volume. ALERT if actual volume exceeds predicted confidence interval. 2) On alert, APPLY topic modeling to destination domains to categorize traffic."