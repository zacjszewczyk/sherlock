name: T1087.004: Cloud Account
id: 5a8e0f4d-61b4-4b5a-939a-8a5e3f4e1c2d
description: This playbook helps identify adversarial attempts to enumerate cloud accounts. It focuses on detecting suspicious network traffic to cloud Identity and Access Management (IAM) API endpoints, execution of specific cloud command-line interface (CLI) tools with enumeration sub-commands, anomalously high rates of API requests indicative of 'spraying' activity, and correlated process and network events originating from unauthorized or anomalous user accounts.
type: technique
related:
  - TA0007: Discovery
contributors: Zachary Szewczyk, Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Is an internal host connecting to a cloud IAM API from an IP address known to be malicious or an anonymizing service?
    context: This question helps identify high-confidence threats by checking if connections to sensitive IAM endpoints originate from sources already flagged as malicious by threat intelligence. A match strongly indicates a compromised host or an external attacker communicating with your cloud environment.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Internet egress points, forward and reverse proxy servers, and enterprise DNS resolvers.
    range: last 90 days
    queries:
      - pseudocode: "SEARCH Zeek conn.log and threat intelligence data WHERE destination_ip is a cloud IAM API AND source_ip is in malicious_ip_feed"
  - question: Has a connection to a cloud IAM API originated from a geographically anomalous country?
    context: This question aims to detect access from unexpected locations. By baselining normal country origins for IAM API access, it can flag connections from rare or new countries, which may indicate unauthorized access by a geographically distant adversary.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Internet egress points, forward and reverse proxy servers, and enterprise DNS resolvers.
    range: last 90 days
    queries:
      - pseudocode: "SEARCH Zeek conn.log WHERE destination_ip is a cloud IAM API | GEOIP source_ip | COMPARE country against historical baseline | ALERT if country is statistically rare (<1st percentile)"
  - question: Can machine learning models identify network connections to cloud IAM APIs that are likely malicious based on their characteristics?
    context: This question leverages machine learning to identify subtler indicators of malicious activity. By analyzing multiple features of a network connection (e.g., duration, bytes transferred, ASN), the model can detect patterns characteristic of attacks that may not trigger specific threat feeds or geographic rules.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Internet egress points, forward and reverse proxy servers, and enterprise DNS resolvers.
    range: last 90 days
    queries:
      - pseudocode: "APPLY ML model on Zeek conn.log data for connections to cloud IAM APIs | ALERT if connection is classified as malicious with high confidence"
  - question: Has a known cloud CLI tool been executed with command-line arguments specific to account enumeration?
    context: This question targets the direct execution of commands used for reconnaissance. Detecting specific command strings like 'list-users' or 'Get-MsolRoleMember' provides strong evidence that an actor is actively trying to map out user accounts, roles, and permissions within the cloud environment.
    answer_sources:
      - Windows Event ID 4688
      - Administrator workstations, developer endpoints, and CI/CD pipeline servers
    range: last 90 days
    queries:
      - pseudocode: "SEARCH Windows Event ID 4688 WHERE process_name is in (aws.exe, az.exe, gcloud.exe, powershell.exe, pwsh.exe) AND command_line matches enumeration patterns (e.g., 'list-users', 'Get-MsolRoleMember')"
  - question: Has a user or host executed a cloud CLI command with unusually high complexity or that is rare for that entity?
    context: This question seeks to find outliers in user behavior. A high command-line entropy might indicate obfuscated or unusually long, complex commands, while a command that is new for a specific user can point to a deviation from their normal duties, possibly due to account compromise or insider threat.
    answer_sources:
      - Windows Event ID 4688
      - Administrator workstations, developer endpoints, and CI/CD pipeline servers
    range: last 90 days
    queries:
      - pseudocode: "SEARCH Windows Event ID 4688 for cloud CLI tools | CALCULATE command_line entropy per user/host | COMPARE against baseline | ALERT if entropy > 95th percentile or command is new for the user"
  - question: Are there any cloud CLI command executions that do not fit into established clusters of normal administrative activity?
    context: This question uses unsupervised machine learning to find novel or unknown attack techniques. By grouping similar, legitimate commands into clusters, any command that falls outside these groups (a 'noise point') is flagged as an anomaly, potentially representing a new or unusual method of cloud account enumeration.
    answer_sources:
      - Windows Event ID 4688
      - Administrator workstations, developer endpoints, and CI/CD pipeline servers
    range: last 90 days
    queries:
      - pseudocode: "VECTORIZE command_line data from Windows Event ID 4688 | APPLY clustering algorithm (e.g., DBSCAN) | ALERT on any command classified as a noise point or outlier"
  - question: Has a single source IP made an unusually high number of distinct API calls to cloud IAM endpoints in a short time frame?
    context: This question aims to detect brute-force or 'spraying' enumeration techniques. A legitimate user is unlikely to make many unique API calls in a few minutes; such behavior is characteristic of an automated script trying to discover accessible resources, users, or permissions.
    answer_sources:
      - Zeek http.log
      - Zeek conn.log
      - Network Security Monitoring sensors at internet egress points and cloud-native flow logs (e.g., AWS VPC Flow Logs).
    range: last 90 days
    queries:
      - pseudocode: "SEARCH Zeek logs for IAM API calls | COUNT distinct API calls per source_ip in a 5-minute window | ALERT if count > 20"
  - question: Is a source IP exhibiting a statistically significant increase in the volume or variety of its IAM API calls compared to its own baseline?
    context: This question provides a tailored approach to detecting high-volume activity. Instead of a fixed threshold, it compares an entity's current activity to its own past behavior. This helps reduce false positives from naturally 'chatty' but legitimate systems and more accurately flags true anomalies for a specific source IP.
    answer_sources:
      - Zeek http.log
      - Zeek conn.log
      - Network Security Monitoring sensors at internet egress points and cloud-native flow logs (e.g., AWS VPC Flow Logs).
    range: last 90 days
    queries:
      - pseudocode: "SEARCH Zeek logs for IAM API calls | PROFILE hourly call volume and variety per source_ip | COMPARE to baseline | ALERT if current volume > 3 standard deviations above mean or variety > 99th percentile"
  - question: Does the volume of IAM API calls from a source IP deviate significantly from what a time-series model predicts as normal?
    context: This question uses predictive modeling to identify anomalies in the cadence and rhythm of API requests. Time-series models can learn complex patterns, including seasonality, and can therefore detect sudden spikes or changes in request volume that simpler statistical methods might miss.
    answer_sources:
      - Zeek http.log
      - Zeek conn.log
      - Network Security Monitoring sensors at internet egress points and cloud-native flow logs (e.g., AWS VPC Flow Logs).
    range: last 90 days
    queries:
      - pseudocode: "APPLY time-series model (e.g., ARIMA, LSTM) to IAM API call volume per source_ip | ALERT if actual volume deviates from predicted confidence interval"
  - question: Has a user who is not a designated cloud administrator executed a cloud CLI tool that immediately made a connection to a cloud IAM API?
    context: This question correlates process and network data to identify unauthorized or suspicious activity. The execution of a cloud tool by a non-administrator followed by a connection to an IAM endpoint is a strong indicator of privilege escalation, lateral movement, or a compromised account being used for reconnaissance.
    answer_sources:
      - Windows Event ID 4688
      - Zeek conn.log
      - Active Directory Security Logs
      - User endpoints, Virtual Desktop Infrastructure (VDI), CI/CD servers, and Domain Controllers for user attribute enrichment.
    range: last 90 days
    queries:
      - pseudocode: "JOIN Windows Event ID 4688 (cloud CLI process) and Zeek conn.log (IAM API connection) on host_ip within 60 seconds | ENRICH with user's AD groups | ALERT if user is not in 'Cloud Administrators' group"
  - question: Has a cloud CLI command been executed by a user from a department that does not typically perform cloud administration tasks?
    context: This question focuses on identifying role-based anomalies. A user from a department like HR or Marketing executing cloud administrative tools is highly unusual and suspicious. This can indicate an insider threat or that a user's credentials have been compromised and are being used by an attacker to explore the environment.
    answer_sources:
      - Windows Event ID 4688
      - Zeek conn.log
      - Active Directory Security Logs
      - User endpoints, Virtual Desktop Infrastructure (VDI), CI/CD servers, and Domain Controllers for user attribute enrichment.
    range: last 90 days
    queries:
      - pseudocode: "SEARCH cloud CLI executions | ENRICH with user's department from AD | COMPARE user's department against baseline of typical CLI users | ALERT if department is anomalous (e.g., HR, Marketing)"
  - question: Based on a comprehensive risk model, does a correlated cloud CLI execution and network event pose a high risk of being malicious?
    context: This question synthesizes multiple data points into a single, actionable risk score. By considering the user's role, host criticality, time of day, and historical frequency of the action, the model can differentiate between benign administrative tasks and high-risk activities, allowing analysts to focus on the most critical alerts.
    answer_sources:
      - Windows Event ID 4688
      - Zeek conn.log
      - Active Directory Security Logs
      - User endpoints, Virtual Desktop Infrastructure (VDI), CI/CD servers, and Domain Controllers for user attribute enrichment.
    range: last 90 days
    queries:
      - pseudocode: "FOR correlated CLI/network events, GATHER features (user role, host criticality, time of day, command entropy) | APPLY risk scoring model | ESCALATE if risk score is above threshold"