name: "T1036.010: Masquerade Account Name"
id: "f47ac10b-58cc-4372-a567-0e02b2c3d479"
description: "This playbook helps investigate whether an adversary is attempting to evade defenses by masquerading account names. This involves looking for user account creation events (Windows Event ID 4720) with suspicious names (e.g., from a known malicious list, having high or low entropy, or matching common admin patterns but created by unauthorized users). It also covers detecting account creation or rename events (Windows Event IDs 4720, 4781) using non-standard characters, homoglyphs, or names with high similarity (typosquatting) to privileged accounts. Additionally, it focuses on identifying newly created accounts that are quickly granted privileges or exhibit anomalous network behavior."
type: "technique"
related:
  - "TA0005: Defense Evasion"
contributors: "Zachary Szewczyk, Ask Sage"
created: "2025-10-01"
modified: "2025-10-01"
version: 1.0
tags: "none"
questions:
  - question: "Are new user accounts being created with names that appear on a blocklist of known malicious account names?"
    context: "This question aims to detect the most straightforward form of account masquerading, where an adversary uses a known-bad username. By comparing new account names from Windows Event ID 4720 against a threat intelligence blocklist, an analyst can quickly identify high-confidence threats without complex analysis. Answering this helps catch low-sophistication attacks and provides a clear signal of malicious intent."
    answer_sources: "Windows Event ID 4720, Domain Controllers, Member Servers, Privileged Workstations"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: |
          SEARCH EventID=4720
          WHERE TargetAccountName IN (malicious_account_blocklist)
          RETURN Hostname, CreatorAccountName, TargetAccountName, Timestamp
  - question: "Are newly created usernames exhibiting unusually high or low randomness compared to existing legitimate accounts?"
    context: "Adversaries may use programmatically generated account names, which can result in usernames that are either highly random (e.g., 'x7g3f_svc') or overly simplistic (e.g., 'a'). This question uses Shannon entropy to measure the randomness of new usernames found in Windows Event ID 4720. By comparing this entropy score to a baseline of normal accounts, analysts can flag statistical outliers that may indicate automated, and potentially malicious, account creation."
    answer_sources: "Windows Event ID 4720, Domain Controllers, Member Servers, Privileged Workstations"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: |
          SEARCH EventID=4720
          CALCULATE entropy(TargetAccountName) as username_entropy
          WHERE username_entropy > 95th_percentile_baseline OR username_entropy < 5th_percentile_baseline
          RETURN Hostname, CreatorAccountName, TargetAccountName, username_entropy
  - question: "Can a machine learning model identify newly created user accounts as malicious based on their characteristics?"
    context: "This question leverages a supervised machine learning model to perform a multi-faceted analysis of new account creation events (Windows Event ID 4720). The model considers features like username length, character types, source of creation, and time of day to determine if a new account fits a malicious pattern. This provides a more sophisticated detection method than single-factor checks and can uncover complex masquerading attempts that might otherwise be missed."
    answer_sources: "Windows Event ID 4720, Domain Controllers, Member Servers, Privileged Workstations"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: |
          STREAM EventID=4720
          EXTRACT features(Username, SourceHost, Creator, Timestamp)
          SCORE with trained_classification_model
          WHERE score > 0.9
          ALERT with event_details, score
  - question: "Are accounts with names resembling standard service or admin accounts being created by unauthorized users?"
    context: "Adversaries often create accounts with names that mimic legitimate administrative or service accounts (e.g., 'backup_svc', 'sqladmin') to blend in. This question focuses on identifying such creations (via Windows Event ID 4720) and verifying if the creator is an authorized administrator. An alert is generated if a user not on the approved list creates an account matching these patterns, indicating a potential rogue admin account."
    answer_sources: "Windows Event ID 4720, Domain Controllers, Cloud IAM Services (e.g., Azure AD)"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: |
          SEARCH EventID=4720
          WHERE TargetAccountName MATCHES_REGEX (admin_service_patterns)
          AND CreatorAccountName NOT IN (authorized_admin_list)
          RETURN Hostname, CreatorAccountName, TargetAccountName, Timestamp
  - question: "Are accounts with admin-like names being created at unusual times compared to historical norms?"
    context: "Legitimate administrative and service accounts are typically created during business hours by IT staff. Adversaries, however, may operate at odd hours to avoid detection. This question involves baselining the normal creation times for accounts with admin-like names. By analyzing new account creations (Windows Event ID 4720) that match these patterns, an alert can be triggered if the creation time is a statistical anomaly (e.g., late at night or on a weekend), suggesting illicit activity."
    answer_sources: "Windows Event ID 4720, Domain Controllers, Cloud IAM Services (e.g., Azure AD)"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: |
          SEARCH EventID=4720 AND TargetAccountName MATCHES_REGEX (admin_service_patterns)
          COMPARE creation_time to historical_baseline_for_account_type
          WHERE creation_time IS_ANOMALOUS
          RETURN Hostname, CreatorAccountName, TargetAccountName, Timestamp
  - question: "Is there a sudden, anomalous spike in the creation of accounts with admin-like names?"
    context: "A sudden burst in the creation of multiple service or admin-style accounts can be a strong indicator of an automated attack script or a compromised administrative session. This question uses a time series model to forecast the expected number of such account creations. If the actual number of new accounts (from Windows Event ID 4720) significantly deviates from the forecast, it signals a potential mass-creation event that warrants immediate investigation."
    answer_sources: "Windows Event ID 4720, Domain Controllers, Cloud IAM Services (e.g., Azure AD)"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: |
          AGGREGATE count(EventID=4720 WHERE TargetAccountName MATCHES_REGEX (admin_service_patterns)) by hour
          FEED into time_series_anomaly_model
          ALERT if count > forecasted_upper_bound
          RETURN time_bucket, actual_count, forecasted_count
  - question: "Are new or renamed accounts using special characters or mixed character sets to impersonate existing privileged accounts?"
    context: "This question addresses homoglyph attacks, where an adversary uses visually similar characters from different character sets (e.g., Cyrillic 'Ð°' vs. Latin 'a') to create deceptive account names. By scanning new or renamed account names (from Windows Event IDs 4720 and 4781) for known homoglyphs or mixed scripts, analysts can flag suspicious accounts that require manual verification to determine if they are impersonating a legitimate, high-privilege user."
    answer_sources: "Windows Event ID 4720, Windows Event ID 4781, Domain Controllers, HR Systems, Financial Systems"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: |
          SEARCH EventID IN (4720, 4781)
          WHERE TargetAccountName CONTAINS (homoglyph_characters) OR TargetAccountName CONTAINS (mixed_char_sets)
          RETURN Hostname, EventID, CreatorAccountName, TargetAccountName, Timestamp
  - question: "Do any new or renamed accounts, when normalized, closely match the name of an existing privileged account?"
    context: "This question aims to programmatically uncover homoglyph and typosquatting attacks that might evade simple visual inspection. By converting both new account names (from events 4720 and 4781) and existing privileged account names to a 'normalized skeleton' (lowercase, alphanumeric only, with homoglyphs mapped to standard equivalents), we can use a string-distance algorithm like Levenshtein to find close matches. A very small distance (e.g., 1 or 2) between skeletons when the original names differ is a strong indicator of an impersonation attempt."
    answer_sources: "Windows Event ID 4720, Windows Event ID 4781, Domain Controllers, HR Systems, Financial Systems"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: |
          FOREACH new_account from EventID IN (4720, 4781):
            new_skeleton = normalize(new_account.TargetAccountName)
            FOREACH privileged_account in privileged_list:
              priv_skeleton = normalize(privileged_account.Name)
              distance = levenshtein(new_skeleton, priv_skeleton)
              IF distance <= 2 AND new_account.TargetAccountName != privileged_account.Name:
                ALERT with new_account, privileged_account, distance
  - question: "Can a neural network model detect anomalous character patterns in new or renamed usernames that are indicative of homoglyph attacks?"
    context: "This question proposes an advanced, unsupervised machine learning approach to detect unusual usernames. An autoencoder is trained to 'learn' the structure of legitimate usernames. When a new username from an account creation or rename event (4720, 4781) is fed into the model, it attempts to reconstruct it. A high reconstruction error suggests the username contains character patterns (like homoglyphs or other abnormalities) that the model has not seen in legitimate data, flagging it as anomalous for further review."
    answer_sources: "Windows Event ID 4720, Windows Event ID 4781, Domain Controllers, HR Systems, Financial Systems"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: |
          STREAM EventID IN (4720, 4781)
          CALCULATE reconstruction_error = autoencoder_model.predict(TargetAccountName)
          WHERE reconstruction_error > anomaly_threshold
          ALERT with event_details, reconstruction_error
  - question: "Are new or renamed accounts being created that exactly match a pre-generated list of typosquatted critical account names?"
    context: "This question targets typosquatting, a common technique where an adversary registers a username with a minor misspelling of a privileged account (e.g., 'admnistrator'). By proactively generating a list of likely typos for critical accounts and monitoring account creation/rename events (4720, 4781) for exact matches against this list, security teams can create high-fidelity alerts for blatant impersonation attempts."
    answer_sources: "Windows Event ID 4720, Windows Event ID 4781, Domain Controllers, Privileged Access Workstations (PAWs), Key IT Personnel Endpoints"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: |
          SEARCH EventID IN (4720, 4781)
          WHERE TargetAccountName IN (pregenerated_typosquat_list)
          RETURN Hostname, EventID, CreatorAccountName, TargetAccountName
  - question: "Are new account names being created that are unusually similar to existing privileged account names?"
    context: "This question provides a more dynamic way to detect typosquatting than a static list. It uses the Jaro-Winkler similarity algorithm, which is effective at scoring string similarity, to compare every new account name (from events 4720, 4781) against all known privileged accounts. A score that is exceptionally high (e.g., > 0.95) indicates that the new name is very close to a privileged one, which is a strong signal of a typosquatting attempt and should be investigated."
    answer_sources: "Windows Event ID 4720, Windows Event ID 4781, Domain Controllers, Privileged Access Workstations (PAWs), Key IT Personnel Endpoints"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: |
          FOREACH new_account from EventID IN (4720, 4781):
            max_similarity = 0
            closest_match = ""
            FOREACH privileged_account in privileged_list:
              score = jaro_winkler(new_account.TargetAccountName, privileged_account.Name)
              IF score > max_similarity:
                max_similarity = score
                closest_match = privileged_account.Name
            IF max_similarity > 0.95:
              ALERT with new_account, closest_match, max_similarity
  - question: "Do new account names fall outside of established naming convention clusters, indicating they are anomalous?"
    context: "This question uses unsupervised clustering to identify anomalous usernames based on naming conventions. Legitimate accounts often follow patterns (e.g., 'firstname.lastname', 'svc-appname') and will form dense clusters when analyzed. An adversary-created name may not fit any of these patterns. By using an algorithm like DBSCAN on vector representations of all usernames, any new account that is classified as 'noise' (i.e., not belonging to a cluster) can be flagged as an anomaly for further investigation, especially if it also has high string similarity to a privileged account."
    answer_sources: "Windows Event ID 4720, Windows Event ID 4781, Domain Controllers, Privileged Access Workstations (PAWs), Key IT Personnel Endpoints"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: |
          ON new account creation (EventID 4720 or 4781):
            username_vector = vectorize(TargetAccountName)
            cluster_label = dbscan_model.predict(username_vector)
            IF cluster_label == 'noise':
              ALERT on anomalous username
  - question: "Are newly created user accounts being immediately added to high-privilege groups?"
    context: "A very strong indicator of malicious activity is the rapid escalation of a brand-new account to a privileged status. This question looks for a specific sequence of events: a user creation (Event ID 4720) immediately followed by that same user being added to a critical administrative group like 'Domain Admins' (Event IDs 4728, 4732, 4756). Detecting this 'newborn admin' pattern within a very short time window (e.g., one hour) allows for the generation of a critical-severity alert for immediate response."
    answer_sources: "Windows Event ID 4720, Windows Event ID 4781, Windows Event ID 4624, Windows Event ID 4728, Windows Event ID 4732, Windows Event ID 4756, Zeek conn.log, Domain Controllers, Network Gateway, DNS Servers, Endpoint Devices"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: |
          JOIN (SEARCH EventID=4720) as creation_event
          WITH (SEARCH EventID IN (4728, 4732, 4756) AND GroupName IN (privileged_groups)) as group_event
          ON creation_event.TargetAccountName = group_event.TargetAccountName
          WHERE group_event.Timestamp < creation_event.Timestamp + 1_hour
          ALERT on 'Newborn Admin' activity
  - question: "Are newly created accounts logging in from geographically or network-level anomalous locations?"
    context: "This question seeks to identify suspicious activity from new accounts by analyzing their network behavior. After an account is created (Event ID 4720), its subsequent login activity (Event ID 4624) and network connections (Zeek conn.log) are monitored. If a new account logs in from a country or Autonomous System Number (ASN) that is rare for the organization, it is a significant anomaly. This suggests the account may be controlled by an external adversary, and its risk score should be increased accordingly."
    answer_sources: "Windows Event ID 4720, Windows Event ID 4781, Windows Event ID 4624, Windows Event ID 4728, Windows Event ID 4732, Windows Event ID 4756, Zeek conn.log, Domain Controllers, Network Gateway, DNS Servers, Endpoint Devices"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: |
          SEARCH EventID=4720 AND creation_time > now() - 7_days
          JOIN with EventID=4624 AND LogonType IN (2, 10)
          ENRICH SourceIP with GeoIP, ASN
          WHERE login_event.SourceCountry NOT IN (common_countries) OR login_event.SourceASN NOT IN (common_asns)
          ALERT on anomalous login location for new user
  - question: "Are new accounts performing their first privileged action significantly faster than normal?"
    context: "Legitimate new user accounts typically have a 'bedding-in' period before they perform sensitive actions. Adversaries, in contrast, will often use a newly created account to execute their objectives immediately. This question uses a model to establish a normal baseline for the time between account creation (Event ID 4720) and the first privileged action (e.g., RDP login, group change). If a new account performs such an action in an anomalously short time, it's a strong indicator of malicious intent."
    answer_sources: "Windows Event ID 4720, Windows Event ID 4781, Windows Event ID 4624, Windows Event ID 4728, Windows Event ID 4732, Windows Event ID 4756, Zeek conn.log, Domain Controllers, Network Gateway, DNS Servers, Endpoint Devices"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: |
          FOREACH new_account from EventID=4720:
            FIND first_privileged_action_event (e.g., RDP, group add) for new_account
            CALCULATE time_to_action = action_event.Timestamp - new_account.Timestamp
            COMPARE time_to_action with survival_analysis_model
            IF time_to_action IS ANOMALOUSLY_SHORT:
              ALERT on rapid privileged action