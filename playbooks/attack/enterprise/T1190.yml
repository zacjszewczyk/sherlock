name: 'T1190: Exploit Public-Facing Application'
id: 'f47ac10b-58cc-4372-a567-0e02b2c3d479'
description: >-
  This playbook helps investigate if an adversary has gained initial access by exploiting a vulnerability in an internet-facing application. It focuses on identifying indicators such as network traffic matching known exploit signatures, connections from malicious IPs, anomalous process execution spawned by web servers, suspicious outbound connections indicative of C2 communication, and statistical deviations in web traffic patterns (e.g., server errors, request entropy). The goal is to detect both the initial exploit attempt and subsequent post-exploitation activities originating from the compromised public-facing asset.
type: 'technique'
related:
  - 'TA0001: Initial Access'
contributors: 'Zachary Szewczyk, Ask Sage'
created: '2025-10-01'
modified: '2025-10-01'
version: 1.0
tags: 'none'
questions:
  - question: 'Has network traffic targeting our public-facing services matched signatures of known exploits?'
    context: >-
      This question aims to detect direct exploitation attempts by matching network traffic against a database of signatures for known vulnerabilities (e.g., specific CVEs). A positive match from an Intrusion Detection/Prevention System (IDS/IPS) is a high-fidelity indicator of a targeted attack against a specific service, providing a clear and immediate signal for investigation.
    answer_sources:
      - 'Zeek conn.log'
      - 'Zeek http.log'
      - 'IDS/IPS Alerts'
      - 'DMZ'
      - 'Network Gateway'
      - 'External-facing servers (VPN, Citrix, etc.)'
    range: 'last 90 days'
    queries:
      - technology: 'Pseudocode'
        query: 'SEARCH IDS/IPS logs FOR alert.signature MATCHING known_cve_patterns AND destination.ip IN public_services_ip_list'
  - question: 'Are there any web requests to our public-facing services with unusually high URI or parameter entropy, suggesting scanning or fuzzing?'
    context: >-
      This question looks for automated scanning or fuzzing attempts. Attackers often use tools that generate long, random, or complex strings in URIs and parameters to discover vulnerabilities. These requests have a higher character entropy than normal human-generated traffic. Detecting requests with entropy scores that are statistical outliers compared to an established baseline can proactively identify pre-exploitation probing.
    answer_sources:
      - 'Zeek conn.log'
      - 'Zeek http.log'
      - 'DMZ'
      - 'Network Gateway'
      - 'External-facing servers (VPN, Citrix, etc.)'
    range: 'last 90 days'
    queries:
      - technology: 'Pseudocode'
        query: 'SEARCH http.logs | CALCULATE entropy of uri_path and uri_query | ALERT where entropy > baseline_99th_percentile'
  - question: 'Have our remote services experienced a volume of connection attempts that significantly exceeds the predicted normal levels?'
    context: >-
      This question seeks to identify brute-force attacks or large-scale scanning by analyzing connection volumes. A time-series model can predict the expected number of connections to a service based on historical patterns. When the actual observed volume significantly surpasses the model's prediction, it indicates an anomalous event that could be a coordinated attack.
    answer_sources:
      - 'Zeek conn.log'
      - 'Zeek http.log'
      - 'DMZ'
      - 'Network Gateway'
      - 'External-facing servers (VPN, Citrix, etc.)'
    range: 'last 90 days'
    queries:
      - technology: 'Pseudocode'
        query: 'FORECAST connection_count by port using time-series_model | ALERT if actual_count > predicted_upper_bound'
  - question: 'Have any of our public-facing applications been accessed by IP addresses known to be malicious?'
    context: >-
      This question provides a high-confidence method for identifying threats by cross-referencing inbound connection logs with threat intelligence feeds. A successful connection from an IP address with a known bad reputation (e.g., associated with botnets, scanners, or previous attacks) to a public-facing asset is a strong indicator of malicious intent.
    answer_sources:
      - 'Zeek conn.log'
      - 'Zeek signatures.log'
      - 'Threat Intelligence Feeds'
      - 'Network perimeter firewalls'
      - 'DMZ network segments'
      - 'Internet-facing web servers'
    range: 'last 90 days'
    queries:
      - technology: 'Pseudocode'
        query: 'SEARCH conn.logs where conn_state is not "REJ" | JOIN source.ip with threat_intel_feed | ALERT on match'
  - question: 'Has any single source IP triggered an unusual number of high-severity CVE-related IDS signatures in a short time frame?'
    context: >-
      This question helps to distinguish targeted attacks from random internet background noise. While a single IDS alert could be a false positive, an IP address that repeatedly triggers a specific high-severity signature in a short period is likely performing a deliberate and targeted scan or exploit attempt against that particular vulnerability.
    answer_sources:
      - 'Zeek conn.log'
      - 'Zeek signatures.log'
      - 'Network perimeter firewalls'
      - 'DMZ network segments'
      - 'Cloud security group flow logs'
    range: 'last 90 days'
    queries:
      - technology: 'Pseudocode'
        query: 'SEARCH signatures.logs for high-severity CVEs | COUNT signature_id by source.ip over 1-hour window | ALERT if count > 3_std_dev_from_mean'
  - question: 'Are there incoming network connections that a machine learning model classifies as a "suspicious-exploit-attempt"?'
    context: >-
      This question leverages a supervised machine learning model, trained on historical data, to identify suspicious connections that may not trigger traditional signatures. By analyzing a combination of features (e.g., port, protocol, duration, data size), the model can flag new or evolving attack techniques that deviate from established benign patterns.
    answer_sources:
      - 'Zeek conn.log'
      - 'Zeek signatures.log'
      - 'Network perimeter firewalls'
      - 'VPN concentrators'
    range: 'last 90 days'
    queries:
      - technology: 'Pseudocode'
        query: 'STREAM conn.logs to classification_model | ALERT if prediction is "suspicious-exploit-attempt"'
  - question: 'Are there any HTTP requests containing patterns of known scanners or common web attack payloads like SQLi or LFI?'
    context: >-
      This question involves searching for tell-tale signs of web attacks within HTTP traffic. By using regular expressions to scan URIs, user agents, and POST bodies for strings associated with scanning tools (e.g., 'sqlmap', 'nmap') or common exploit payloads (e.g., '../', '<script>'), analysts can detect active reconnaissance or exploitation attempts.
    answer_sources:
      - 'Zeek http.log'
      - 'Zeek files.log'
      - 'Web Application Firewalls (WAFs)'
      - 'Public-facing web servers'
      - 'Reverse proxies'
    range: 'last 90 days'
    queries:
      - technology: 'Pseudocode'
        query: 'SEARCH http.logs where uri OR user_agent OR post_body MATCHES regex("sqlmap|nmap|../|<script>")'
  - question: 'Has a web server process spawned a command shell or an unexpected utility?'
    context: >-
      This is a critical question for detecting post-exploitation activity. A web server process (like w3wp.exe or httpd.exe) should not be spawning command-line interpreters (cmd.exe, bash) or network reconnaissance tools (whoami.exe, net.exe). Such an event is a very strong indicator that an attacker has successfully exploited the server and is executing commands.
    answer_sources:
      - 'Windows Event ID 4688'
      - 'Sysmon Event ID 1'
      - 'Public-facing web servers'
      - 'Application servers in the DMZ'
      - 'Container hosts running public applications'
    range: 'last 90 days'
    queries:
      - technology: 'Pseudocode'
        query: 'SEARCH process_creation_logs WHERE parent_process IN ("w3wp.exe", "httpd.exe") AND child_process IN ("cmd.exe", "powershell.exe", "whoami.exe")'
  - question: 'Have we observed a rare or never-before-seen parent-child process relationship on a public-facing server?'
    context: >-
      This question aims to detect anomalous behavior by baselining normal process activity. By tracking all parent-child process relationships over time, the system can identify when a new or extremely infrequent relationship occurs. For example, if a web server suddenly spawns a process it has never spawned before, it is highly suspicious and warrants immediate investigation.
    answer_sources:
      - 'Windows Event ID 4688'
      - 'Sysmon Event ID 1'
      - 'Public-facing web servers'
      - 'Application servers in the DMZ'
    range: 'last 90 days'
    queries:
      - technology: 'Pseudocode'
        query: 'SEARCH process_creation_logs | LOOKUP parent_child_pair in historical_baseline | ALERT if pair is new OR frequency < 1st_percentile'
  - question: 'Has a public-facing server initiated an outbound connection to a new or unusual destination port or country, or transferred an anomalously large amount of data?'
    context: >-
      This question focuses on detecting command-and-control (C2) communication or data exfiltration. Public-facing servers typically have predictable outbound traffic patterns. An alert on a connection to a never-before-seen country or a non-standard port, or a transfer of an unusually large volume of data, can indicate that a compromised server is communicating with an attacker.
    answer_sources:
      - 'Zeek conn.log'
      - 'Zeek dns.log'
      - 'Windows Event ID 5156'
      - 'DMZ network segments'
      - 'Egress points of the network'
      - 'Host-based firewalls on public-facing servers'
    range: 'last 90 days'
    queries:
      - technology: 'Pseudocode'
        query: 'SEARCH outbound conn.logs from public_servers | ALERT if destination.port or destination.country is not in baseline OR bytes_transferred > baseline_99th_percentile'
  - question: 'Has there been a sudden spike in server-side errors (HTTP 5xx) for a specific application?'
    context: >-
      This question investigates application health as an indicator of attack. A sudden increase in HTTP 5xx errors can mean an attacker's malformed requests are causing the application to crash. Monitoring for a high volume of these errors within a short time window can be an early warning sign of an ongoing exploit attempt.
    answer_sources:
      - 'Zeek http.log'
      - 'Application error logs (e.g., Apache error.log, IIS Failed Request Tracing)'
      - 'Public-facing web servers'
      - 'Web Application Firewalls (WAFs)'
      - 'Load balancers'
    range: 'last 90 days'
    queries:
      - technology: 'Pseudocode'
        query: 'SEARCH http.logs | COUNT by status_code over 1-minute window | ALERT if status_code >= 500 AND count > 50'
  - question: 'Has the mix of HTTP request methods (GET, POST, etc.) for an application significantly changed compared to its normal baseline?'
    context: >-
      This question uses statistical analysis to find deviations in user behavior. Normal users create a predictable distribution of HTTP methods (e.g., mostly GETs, some POSTs). A scanning tool or an exploit might cause a significant shift in this distribution (e.g., a spike in HEAD or PUT requests). A Chi-squared test can statistically validate if the current traffic pattern is anomalous compared to a historical baseline.
    answer_sources:
      - 'Zeek http.log'
      - 'Application error logs'
      - 'Public-facing web servers'
      - 'WAFs'
      - 'Load balancers'
    range: 'last 90 days'
    queries:
      - technology: 'Pseudocode'
        query: 'COMPARE hourly HTTP method distribution to 7-day baseline using Chi-squared test | ALERT if result is statistically significant'