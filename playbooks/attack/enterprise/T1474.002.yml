name: "T1474.002: Compromise Hardware Supply Chain"
id: f47ac10b-58cc-4372-a567-0e02b2c3d479
description: |
  This playbook helps determine if an adversary has gained initial access to the mobile device fleet through a compromised hardware supply chain. It focuses on three key areas of detection. First, it identifies unauthorized device modifications by analyzing MDM attestation reports for unlocked bootloaders or failed integrity checks, correlating these events against change management records to filter out legitimate activity. Second, it detects tampering within procurement batches by comparing device hardware and firmware identifiers against a pre-approved 'golden manifest' and by using statistical analysis to find outlier configurations. Third, it monitors for anomalous network behavior, such as connections to unapproved destinations or signs of DGA activity, within the first 60 minutes of a new device's enrollment, which could indicate pre-installed malware calling home.
type: technique
related:
- "TA0027: Initial Access"
contributors:
- "Zachary Szewczyk"
- "Ask Sage"
created: "2025-10-01"
modified: "2025-10-01"
version: 1.0
tags: none
questions:
- question: "Are we seeing device attestation failures or unlocked bootloaders for devices that are not undergoing authorized changes?"
  context: |
    This question targets unauthorized modifications by correlating real-time attestation failures (failed status or unlocked bootloader) with change management and developer device lists. An alert for a device that does not have a corresponding authorized change ticket or is not a registered developer device indicates a potential compromise at the hardware or boot-loader level, a key sign of a supply chain attack.
  answer_sources:
  - "MDM device attestation logs"
  - "Change management database records"
  - "Developer device registration list"
  - "Asset Management Database"
  - "MDM platform servers, Asset Management Database, Change Management System, and endpoint mobile devices."
  range: "last 90 days"
  queries:
  - "SIEM: SEARCH MDM logs for (attestation_status='failed' OR bootloader_status='unlocked') | JOIN device_id with (WATCHLIST of authorized_change_device_ids) WHERE NOT IN WATCHLIST"
- question: "Is there a statistically significant increase in attestation failures for any specific group of devices?"
  context: |
    This question uses statistical analysis (Z-score) to detect anomalies in the rate of attestation failures for device cohorts, which are grouped by model and OS version. A sudden spike in failures for a cohort, where the Z-score exceeds 3 compared to a 30-day rolling baseline, can indicate a widespread issue, such as a compromised batch of devices, that might otherwise be missed when looking at failures individually.
  answer_sources:
  - "MDM device attestation logs"
  - "Change management database records"
  - "Developer device registration list"
  - "Asset Management Database"
  - "MDM platform servers, Asset Management Database, Change Management System, and endpoint mobile devices."
  range: "last 90 days"
  queries:
  - "Pseudocode: CALCULATE daily attestation failure count per device_cohort | COMPARE to 30-day rolling average ($$ \\mu $$) and standard deviation ($$ \\sigma $$) | ALERT if Z-score $$ Z = (x - \\mu) / \\sigma $$ > 3"
- question: "Can we predict whether a new device attestation failure is malicious based on its characteristics?"
  context: |
    This question leverages a supervised machine learning model to proactively identify high-risk attestation failures. By training a model on historical, labeled data with features like device model, OS version, user role, and patch level, the system can score new failures in real-time. A high probability score (e.g., > 0.90) indicates a strong likelihood of malicious activity, allowing for faster, more focused incident response.
  answer_sources:
  - "MDM device attestation logs"
  - "Change management database records"
  - "Developer device registration list"
  - "Asset Management Database"
  - "MDM platform servers, Asset Management Database, Change Management System, and endpoint mobile devices."
  range: "last 90 days"
  queries:
  - "ML Model: INPUT new attestation failure event into trained classification model | GET prediction score | ALERT if score > 0.90"
- question: "Do any newly procured devices have hardware or firmware identifiers that don't match the expected 'golden manifest' for their batch?"
  context: |
    This question aims to detect tampering at the component level by comparing the actual hardware and firmware identifiers (like baseband version, build number) of devices in a new procurement batch against a pre-approved 'golden manifest'. Any deviation from the manifest indicates a potential supply chain compromise where components were swapped or firmware was altered before delivery.
  answer_sources:
  - "MDM device hardware inventory"
  - "Procurement records"
  - "Golden manifest files"
  - "MDM platform, Asset Management Database, and procurement department records."
  range: "last 90 days"
  queries:
  - "Script: FOREACH device in new procurement_batch | GET hardware/firmware identifiers from MDM | COMPARE against golden_manifest for batch | ALERT on mismatch"
- question: "Are there any rare or outlier hardware/firmware configurations within a single procurement batch?"
  context: |
    This question seeks to identify outliers within a supposedly uniform batch of devices. By calculating the frequency of each key identifier (e.g., kernel version) across all devices in a batch, any configuration that appears in a very small percentage (e.g., < 1%) of devices is flagged. Such rarity suggests the device is different from the rest, possibly due to targeted tampering or being a 'plant' in the supply chain.
  answer_sources:
  - "MDM device hardware inventory"
  - "Procurement records"
  - "Golden manifest files"
  - "MDM platform, Asset Management Database, and procurement department records."
  range: "last 90 days"
  queries:
  - "SIEM: FOREACH procurement_batch | CALCULATE frequency of each hardware/firmware identifier | ALERT on any identifier with prevalence < 1%"
- question: "Can we use clustering algorithms to automatically identify devices that are anomalous compared to the rest of their procurement batch?"
  context: |
    This question applies unsupervised machine learning (e.g., DBSCAN) to detect anomalous devices without a predefined 'golden' standard. By converting all hardware and firmware identifiers into a numerical feature vector for each device, the algorithm groups similar devices into clusters. Devices that are classified as 'noise' do not fit into any cluster, making them significant outliers that warrant immediate investigation for potential compromise.
  answer_sources:
  - "MDM device hardware inventory"
  - "Procurement records"
  - "Golden manifest files"
  - "MDM platform, Asset Management Database, and procurement department records."
  range: "last 90 days"
  queries:
  - "ML Model: FOREACH procurement_batch | CREATE feature vectors from device identifiers | APPLY DBSCAN clustering | ALERT on devices classified as 'noise'"
- question: "Are newly enrolled devices communicating with unauthorized destinations within the first hour of activation?"
  context: |
    This question focuses on detecting malicious 'phone home' activity immediately after a device is turned on and enrolled in MDM. By monitoring all network connections for 60 minutes post-enrollment and comparing destinations against a strict allow-list for provisioning and OS updates, any connection to an unapproved IP or domain is a strong indicator of pre-installed malware or a compromised firmware C2 channel.
  answer_sources:
  - "Zeek conn.log"
  - "Zeek dns.log"
  - "MDM enrollment logs"
  - "Firewall logs"
  - "Provisioning network allow-list"
  - "VPN logs"
  - "Proxy logs"
  - "Network egress points, DNS resolvers, Firewall appliances, MDM platform server, VPN concentrators, and forward proxy servers."
  range: "last 90 days"
  queries:
  - "SIEM: ON 'MDM Enrollment Success' event for device_ip | MONITOR network logs for 60 mins | ALERT if destination is NOT IN provisioning_allow_list"
- question: "Are newly enrolled devices attempting to resolve algorithmically generated domain names?"
  context: |
    This question aims to detect the use of Domain Generation Algorithms (DGA), a common malware technique for command-and-control communication. By calculating the Shannon entropy of domain names queried by a new device in its first hour, we can spot the high degree of randomness characteristic of DGA domains. An entropy score $$ H(X) = -\\sum_{i=1}^{n} p(x_i) \\log_2 p(x_i) $$ that exceeds a baseline threshold is a strong signal of malicious activity.
  answer_sources:
  - "Zeek conn.log"
  - "Zeek dns.log"
  - "MDM enrollment logs"
  - "Firewall logs"
  - "Provisioning network allow-list"
  - "VPN logs"
  - "Proxy logs"
  - "Network egress points, DNS resolvers, Firewall appliances, MDM platform server, VPN concentrators, and forward proxy servers."
  range: "last 90 days"
  queries:
  - "SIEM: ON 'MDM Enrollment Success' event | FOR 60 mins, CAPTURE DNS queries | CALCULATE Shannon entropy of queried domains | ALERT if entropy > baseline_threshold"
- question: "Does the sequence of network connections from a newly enrolled device deviate from the established pattern of a normal, clean provisioning session?"
  context: |
    This question uses a time-series autoencoder model to learn the 'normal' sequence and characteristics (protocol, port, data size, duration) of network traffic during a legitimate device setup. When a new device is monitored, its network activity sequence is fed to the model. If the model cannot accurately 'reconstruct' the observed sequence, resulting in a high reconstruction error, it means the behavior is anomalous and potentially malicious, even if it doesn't violate a specific rule.
  answer_sources:
  - "Zeek conn.log"
  - "Zeek dns.log"
  - "MDM enrollment logs"
  - "Firewall logs"
  - "Provisioning network allow-list"
  - "VPN logs"
  - "Proxy logs"
  - "Network egress points, DNS resolvers, Firewall appliances, MDM platform server, VPN concentrators, and forward proxy servers."
  range: "last 90 days"
  queries:
  - "ML Model: ON 'MDM Enrollment Success' event | CAPTURE sequence of network connection metadata | INPUT sequence into trained autoencoder model | ALERT if reconstruction_error > threshold"