name: "T1598: Phishing for Information"
id: "a4b1c2d3-e4f5-4a6b-7c8d-9e0f1a2b3c4d"
description: "This playbook helps determine if an adversary is conducting reconnaissance via phishing for information. This involves analyzing inbound emails for various indicators of malicious intent. Evidence includes emails containing metadata or URLs matching threat intelligence feeds, emails that fail authentication (DMARC/SPF/DKIM) or originate from newly registered or typosquatted domains, and high-volume email campaigns from a single source. The playbook also addresses targeted attacks against High-Value Targets (HVTs) and monitors for anomalous outbound user activity, such as data transfers, that occurs shortly after a user interacts with a suspected phishing email."
type: "technique"
related:
  - "TA0043: Reconnaissance"
contributors:
  - "Zachary Szewczyk"
  - "Ask Sage"
created: "2025-10-01"
modified: "2025-10-01"
version: "1.0"
tags: "none"
questions:
  - question: "Are inbound emails matching known malicious indicators from a threat intelligence feed?"
    context: "This question aims to identify obvious phishing attempts by cross-referencing email metadata (sender IP, domain) and content (URLs) with a curated list of known malicious indicators. A match provides a high-confidence signal that an email is part of a known phishing campaign, allowing for immediate blocking or alerting."
    answer_sources:
      - "Zeek smtp.log"
      - "Zeek dns.log"
      - "Zeek http.log"
      - "Zeek conn.log"
      - "Perimeter Firewall"
      - "Network DNS Resolvers"
      - "Web Proxy"
      - "Email Gateway"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: "FOR each inbound email: EXTRACT sender_ip, sender_domain, urls. CHECK threat_intel_feed FOR sender_ip, sender_domain, urls. IF match FOUND: GENERATE high_severity_alert."
  - question: "Are inbound emails originating from domains that are statistically rare for the organization?"
    context: "This question seeks to uncover phishing attempts using newly created or obscure domains. Adversaries often use domains with no prior history within the target organization. By identifying domains with very low query counts (e.g., in the bottom 5th percentile) and potentially rare Top-Level Domains (TLDs), we can flag suspicious emails that might otherwise evade signature-based detection."
    answer_sources:
      - "Zeek smtp.log"
      - "Zeek dns.log"
      - "Zeek http.log"
      - "Zeek conn.log"
      - "Perimeter Firewall"
      - "Network DNS Resolvers"
      - "Web Proxy"
      - "Email Gateway"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: "FOR each domain in dns.log not in allowlist: CALCULATE query_count over 90 days. IF query_count < 5th_percentile_threshold: FLAG domain as rare and suspicious. INCREASE suspicion if TLD is also rare."
  - question: "Can a machine learning model identify and score incoming emails for phishing characteristics in real-time?"
    context: "This question leverages machine learning to provide a more nuanced and dynamic assessment of phishing risk. Instead of relying on single indicators, a classification model analyzes a combination of features (sender reputation, domain age, keywords, etc.) to generate a holistic phishing score. Emails exceeding a certain score can be automatically quarantined or prioritized for analyst review, improving detection efficiency and accuracy."
    answer_sources:
      - "Zeek smtp.log"
      - "Zeek dns.log"
      - "Zeek http.log"
      - "Zeek conn.log"
      - "Perimeter Firewall"
      - "Network DNS Resolvers"
      - "Web Proxy"
      - "Email Gateway"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: "FOR each inbound email: EXTRACT features (sender_rep, domain_age, ASN, etc.). INPUT features into classification_model. GET phishing_score. IF phishing_score > threshold (e.g., 0.85): QUARANTINE or FLAG for review."
  - question: "Are inbound emails failing DMARC, SPF, or DKIM authentication checks?"
    context: "This question focuses on detecting email spoofing by verifying sender authentication mechanisms. DMARC, SPF, and DKIM are standards designed to prevent unauthorized use of a domain. A failure in these checks is a strong indicator that the sender's address is forged, a common tactic in phishing campaigns. Alerting on these failures helps catch spoofed emails at the gateway."
    answer_sources:
      - "Zeek smtp.log"
      - "Zeek dns.log"
      - "Email Gateway"
      - "Network DNS Resolvers"
      - "Corporate Domain Registrar"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: "FOR each inbound email: PARSE 'Authentication-Results' header. IF header contains 'spf=fail' OR 'dkim=fail' OR 'dmarc=fail': GENERATE alert."
  - question: "Are we receiving emails from newly registered domains (NRDs)?"
    context: "This question helps identify phishing attempts that use domains created very recently. Adversaries frequently register new domains for short-lived campaigns to bypass reputation-based blacklists. By checking the WHOIS registration date and flagging emails from domains that are exceptionally young (e.g., less than 30 days old or in the bottom 5th percentile of domain ages), we can identify high-risk senders."
    answer_sources:
      - "Zeek smtp.log"
      - "Zeek dns.log"
      - "Email Gateway"
      - "Network DNS Resolvers"
      - "Corporate Domain Registrar"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: "FOR each inbound sender domain: GET WHOIS registration_date. CALCULATE domain_age. IF domain_age < 5th_percentile_threshold: FLAG email for inspection."
  - question: "Are inbound emails coming from typosquatted or look-alike domains?"
    context: "This question aims to detect a deceptive phishing technique where adversaries register domains that are visually similar to legitimate ones (e.g., 'micros0ft.com' instead of 'microsoft.com'). By using string similarity algorithms to compare external sender domains against a list of our own and partner domains, we can programmatically identify and block these imposters, which are designed to trick users into trusting the sender."
    answer_sources:
      - "Zeek smtp.log"
      - "Zeek dns.log"
      - "Email Gateway"
      - "Network DNS Resolvers"
      - "Corporate Domain Registrar"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: "FOR each new external sender domain: CALCULATE similarity_score (e.g., Levenshtein distance) against internal_and_partner_domains list. IF score < low_distance_threshold: FLAG as potential typosquat and review."
  - question: "Is a single external source sending a high volume of emails to many unique internal users in a short time?"
    context: "This question is designed to detect the initial phase of a broad phishing campaign. A sudden blast of emails from a single IP or domain to a large number of employees is anomalous behavior for legitimate communication. By setting a threshold (e.g., >50 recipients in 60 minutes), we can quickly identify and respond to potential mass phishing attacks."
    answer_sources:
      - "Zeek smtp.log"
      - "Zeek conn.log"
      - "Email Gateway"
      - "Mail Transfer Agent (MTA)"
      - "Network Intrusion Detection System (NIDS)"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: "MONITOR inbound emails over 60-minute windows. FOR each source_ip or source_domain: COUNT unique_recipients. IF unique_recipients > 50: GENERATE alert."
  - question: "Are any external senders exhibiting an unusually high 'fan-out ratio' (unique recipients to total emails)?"
    context: "This question provides a more refined way to detect mass phishing than a simple volume threshold. The 'fan-out ratio' helps distinguish a targeted campaign (high ratio) from a newsletter or legitimate bulk mail (low ratio, many emails to the same list). A new or low-reputation sender with a fan-out ratio far exceeding the organizational baseline is highly suspicious and indicative of a reconnaissance or phishing attempt."
    answer_sources:
      - "Zeek smtp.log"
      - "Zeek conn.log"
      - "Email Gateway"
      - "Mail Transfer Agent (MTA)"
      - "Network Intrusion Detection System (NIDS)"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: "FOR each sender over 15-min window: CALCULATE fan_out_ratio = unique_recipients / total_emails. ESTABLISH baseline fan_out_ratio for legitimate senders. IF new_sender_ratio > 99th_percentile_of_baseline: GENERATE alert."
  - question: "Are we observing sudden, anomalous spikes in email volume from any single external domain?"
    context: "This question uses time-series analysis to detect deviations from normal sending patterns. Legitimate senders often have a predictable email volume. A sudden, sharp increase in emails from a domain, especially one with a previously stable or non-existent baseline, can signify that the domain has been compromised or was created for a phishing campaign. This method helps catch attacks that might not trigger simple threshold rules."
    answer_sources:
      - "Zeek smtp.log"
      - "Zeek conn.log"
      - "Email Gateway"
      - "Mail Transfer Agent (MTA)"
      - "Network Intrusion Detection System (NIDS)"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: "FOR each external domain: MODEL normal email volume using time-series analysis (e.g., LSTM). IF current_volume is a significant deviation from predicted_pattern: GENERATE anomaly alert."
  - question: "Are High-Value Targets (HVTs) receiving suspicious emails from un-allowlisted domains?"
    context: "This question focuses on protecting the organization's most critical personnel, who are often the targets of sophisticated spearphishing. By creating a specific, high-priority rule for HVTs, we can apply stricter scrutiny. This rule looks for a combination of risk factors: an unknown sender, urgency-inducing keywords, and deceptive subject lines (like fake replies), which together strongly indicate a targeted attack."
    answer_sources:
      - "Zeek smtp.log"
      - "Zeek dns.log"
      - "Executive Mailboxes"
      - "Finance Department Endpoints"
      - "IT Administrator Workstations"
      - "Privileged Access Management Systems"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: "DEFINE HVT_list. FOR emails to HVT_list: IF sender_domain NOT IN allowlist AND (subject contains urgency_keywords OR subject is fake_reply): GENERATE high_priority_alert."
  - question: "Is the communication pattern for the HVT group showing signs of an anomaly, such as a new persistent sender?"
    context: "This question moves beyond individual email analysis to profile the overall communication landscape for HVTs. A stable communication pattern has a certain level of diversity in senders. A sharp decrease in sender entropy (diversity) can indicate that a new, single sender is persistently targeting the group, which is a hallmark of a spearphishing campaign. This provides an early warning of a concerted attack."
    answer_sources:
      - "Zeek smtp.log"
      - "Zeek dns.log"
      - "Executive Mailboxes"
      - "Finance Department Endpoints"
      - "IT Administrator Workstations"
      - "Privileged Access Management Systems"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: "BASELINE normal communication patterns for HVT_group. CALCULATE weekly sender_domain_entropy. IF entropy decreases sharply OR a new sender is a statistical outlier in frequency: FLAG for investigation."
  - question: "Can a machine learning model specifically trained on HVT data detect spearphishing attempts against them?"
    context: "This question proposes a highly targeted defensive measure. A generic phishing model might miss the subtle cues of a well-crafted spearphishing email. By training a model specifically on data and features relevant to attacks on HVTs (e.g., sender reputation, use of HVT names, non-standard ports), we can create a more sensitive and accurate detection system for our most critical assets."
    answer_sources:
      - "Zeek smtp.log"
      - "Zeek dns.log"
      - "Executive Mailboxes"
      - "Finance Department Endpoints"
      - "IT Administrator Workstations"
      - "Privileged Access Management Systems"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: "FOR emails to HVTs: EXTRACT specific features (sender_rep, domain_age, HVT_name_in_body, etc.). INPUT to HVT_spearphishing_model. IF model_score is high: TRIGGER immediate investigation."
  - question: "Are users communicating with an external source shortly after receiving a suspected phishing email from that same source?"
    context: "This question aims to detect the successful compromise phase of a phishing attack. If a user receives a phishing email and then is observed sending data back to the attacker's domain or IP, it is a strong indication that they have been tricked into revealing information. A stateful rule that correlates inbound phishing alerts with subsequent outbound traffic from the victim is a critical detection for data exfiltration."
    answer_sources:
      - "Zeek smtp.log"
      - "Zeek files.log"
      - "Zeek conn.log"
      - "Windows Event ID 4688"
      - "Windows Event ID 4663"
      - "User Endpoints"
      - "Network Egress Points"
      - "Mail Transfer Agent (MTA)"
      - "File Servers"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: "ON phishing_alert for recipient.user from source.domain: MONITOR outbound traffic from recipient.user's workstation for 30 mins. IF outbound traffic to source.domain is detected: GENERATE high_severity_alert."
  - question: "Are users sending outbound emails that are anomalous in size or attachment characteristics?"
    context: "This question seeks to identify data exfiltration via email by detecting unusual outbound activity. An adversary who has phished credentials might use the victim's email account to send sensitive data out of the network. An email with an unusually large attachment or message size, especially when compared to the user's normal baseline and sent to a rare recipient, is a strong indicator of such exfiltration."
    answer_sources:
      - "Zeek smtp.log"
      - "Zeek files.log"
      - "Zeek conn.log"
      - "Windows Event ID 4688"
      - "Windows Event ID 4663"
      - "User Endpoints"
      - "Network Egress Points"
      - "Mail Transfer Agent (MTA)"
      - "File Servers"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: "FOR each user: BASELINE normal outbound email size/attachment patterns. ON new outbound email: IF message_size OR attachment_size > 3 standard deviations from user's mean: FLAG for review. INCREASE severity if recipient is rare for user."
  - question: "Are users exhibiting a sequence of actions that is statistically improbable and indicative of a phishing compromise?"
    context: "This question uses sophisticated modeling to connect a series of seemingly disparate events into a coherent attack narrative. A phishing attack isn't a single event, but a sequence: receiving an email, clicking a link, accessing a file, and sending data outbound. By training a model to recognize normal user behavior sequences, we can identify and alert on improbable sequences that match a phishing-to-exfiltration pattern, catching attacks that would be missed by analyzing each event in isolation."
    answer_sources:
      - "Zeek smtp.log"
      - "Zeek files.log"
      - "Zeek conn.log"
      - "Windows Event ID 4688"
      - "Windows Event ID 4663"
      - "User Endpoints"
      - "Network Egress Points"
      - "Mail Transfer Agent (MTA)"
      - "File Servers"
    range: "last 90 days"
    queries:
      - technology: "pseudocode"
        query: "MODEL benign user activity sequences (e.g., using HMM). MONITOR real-time user event sequences (inbound_email, dns_query, http_conn, file_access, outbound_email). IF observed sequence is statistically improbable based on model: GENERATE alert for anomalous behavior chain."