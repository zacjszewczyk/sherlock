name: "T1059.010: AutoHotKey & AutoIT"
id: "f47ac10b-58cc-4372-a567-0e02b2c3d479"
description: "This playbook helps investigate whether an adversary has executed commands using AutoHotKey or AutoIT scripts. Detections focus on identifying the execution of interpreters or compiled scripts, especially when they initiate network connections to known malicious infrastructure, run from non-standard file paths, exhibit characteristics of packing (e.g., high entropy, specific PE section names), spawn suspicious child processes like LOLBAS, or generate anomalous network traffic patterns such as C2 beaconing."
type: "technique"
related:
  - "TA0002: Execution"
contributors:
  - "Zachary Szewczyk, Ask Sage"
created: "2025-10-01"
modified: "2025-10-01"
version: "1.0"
tags: "none"
questions:
  - question: "Is an AutoHotkey/AutoIt process communicating with known malicious infrastructure?"
    context: "This question aims to identify definitive malicious activity by correlating process execution events with network connections to domains or IP addresses found on threat intelligence feeds. A match provides a high-confidence indicator of compromise, suggesting the script is being used for command and control (C2) or data exfiltration."
    answer_sources:
      - "Windows Event ID 4688"
      - "Sysmon Event ID 1"
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Zeek files.log"
      - "Enterprise workstations, Application Servers, Domain Controllers, Network Egress/Internet Gateway"
    range: "last 90 days"
    queries:
      - "SEARCH process_events (AutoHotkey.exe, AutoIt3.exe) AND network_events (conn.log, dns.log) on same host within 1 minute. EXTRACT file_hash, dest_ip, dest_domain. QUERY file_hash, dest_ip, dest_domain against threat_intel_feeds. ALERT on match."
  - question: "Is an AutoHotkey/AutoIt process making network connections to statistically rare ports or protocols?"
    context: "Adversaries may use non-standard ports to evade detection. This question seeks to identify anomalous network behavior by baselining normal port/protocol usage for AutoHotkey/AutoIt processes and flagging connections to ports that are rarely used across the enterprise. This could indicate a covert C2 channel."
    answer_sources:
      - "Zeek conn.log"
      - "Enterprise workstations, Application Servers, Domain Controllers, Network Egress/Internet Gateway"
    range: "last 90 days"
    queries:
      - "BASELINE network_connections (conn.log) from AutoHotkey/AutoIt processes over 30 days. CALCULATE frequency of dest_port/protocol pairs. FOR new connections, ALERT if port/protocol frequency is in bottom 5th percentile."
  - question: "Can a machine learning model classify an AutoHotkey/AutoIt execution event as malicious based on combined process and network features?"
    context: "This question leverages a machine learning classifier to make a holistic judgment on whether an AutoHotkey/AutoIt execution is malicious. By combining features from process creation (parent process, command line) and network activity (IP reputation, port rarity, JA3 hash), the model can detect complex patterns that are difficult to define with simple rules, improving detection of novel or sophisticated threats."
    answer_sources:
      - "Sysmon Event ID 1"
      - "Zeek conn.log"
      - "Zeek pe.log"
      - "Enterprise workstations, Application Servers, Domain Controllers, Network Egress/Internet Gateway"
    range: "last 90 days"
    queries:
      - "TRAIN classifier on process_events (Sysmon 1) and network_events (Zeek conn.log, pe.log) with features (process_name, parent, cmd_entropy, PE_info, IP_rep, port_rarity, JA3). FOR new AutoHotkey/AutoIt events, PREDICT benign/malicious. ALERT on high-probability malicious."
  - question: "Is an AutoHotkey or AutoIt interpreter running from a non-standard directory or executing a script from a high-risk location?"
    context: "Legitimate software is typically installed in standard directories like 'Program Files'. Adversaries often place tools in user-writable or temporary locations to bypass security controls and persist. This question checks for executions from unapproved paths or script executions from locations like '%TEMP%' or '%APPDATA%', which are strong indicators of malicious or unauthorized use."
    answer_sources:
      - "Windows Event ID 4688"
      - "Sysmon Event ID 1"
      - "Enterprise workstations, User profile directories on servers, Shared network drives"
    range: "last 90 days"
    queries:
      - "SEARCH process_events (AutoHotkey.exe, AutoIt3.exe). ALERT if process_path is NOT in allow-list (e.g., 'C:\\Program Files\\...'). PARSE command_line for script_path. ALERT if script_path is in deny-list (e.g., '%TEMP%', '%APPDATA%')."
  - question: "Are the interpreter or script file paths for an AutoHotkey/AutoIt execution statistically rare or previously unseen in the environment?"
    context: "This question aims to detect anomalous file paths by establishing a baseline of common execution locations for AutoHotkey/AutoIt. An execution from a path that is extremely infrequent or has never been observed before is a statistical outlier and may indicate an adversary attempting to hide their tools in an unusual location."
    answer_sources:
      - "Sysmon Event ID 1"
      - "Enterprise workstations, User profile directories on servers, Shared network drives"
    range: "last 90 days"
    queries:
      - "BASELINE all AutoHotkey/AutoIt interpreter and script paths from process_events (Sysmon 1) over 30 days. CALCULATE path frequency. FOR new executions, ALERT if interpreter_path or script_path frequency is below 1st percentile or is previously unseen."
  - question: "Can an anomaly detection model identify suspicious AutoHotkey/AutoIt executions based on file path and execution context features?"
    context: "This question uses an unsupervised machine learning model to find unusual executions without relying on predefined rules. By analyzing features like parent process, user account, and characteristics of the file path (depth, keywords), the model can learn what normal activity looks like and flag executions that deviate significantly, potentially catching novel adversary techniques."
    answer_sources:
      - "Sysmon Event ID 1"
      - "Enterprise workstations, User profile directories on servers, Shared network drives"
    range: "last 90 days"
    queries:
      - "TRAIN anomaly_detection_model (Isolation Forest) on process_events (Sysmon 1) with features (parent_process, user, path_depth, path_keywords). FOR new AutoHotkey/AutoIt executions, CALCULATE anomaly_score. ALERT if score exceeds threshold."
  - question: "Has a PE file with section names characteristic of a compiled AutoIt/AHK script been executed on an endpoint?"
    context: "Adversaries often compile AutoHotkey or AutoIt scripts into standalone executables to make them portable and harder to analyze. These compiled files often retain specific artifacts, such as PE section names like '.AU3!.' or '.AHK!.'. This question looks for these specific indicators in executables transferred over the network and correlates them with execution events on endpoints to find instances of malicious compiled scripts."
    answer_sources:
      - "Windows Event ID 4688"
      - "Sysmon Event ID 1"
      - "Zeek pe.log"
      - "Zeek files.log"
      - "Network Egress/Internet Gateway (for PE file capture), Enterprise workstations, Download directories"
    range: "last 90 days"
    queries:
      - "SEARCH network_pe_logs (Zeek pe.log) for section_names ('.AU3!.', '.AHK!.'). EXTRACT file_hash. SEARCH process_events for execution of matching file_hash. ALERT on confirmed execution."
  - question: "Has an unsigned executable with unusually high file entropy been observed, suggesting a packed AutoHotkey/AutoIt script?"
    context: "Packing is a common technique used by adversaries to obfuscate the true nature of an executable. This often results in a higher file entropy (a measure of randomness). This question identifies executables that are both unsigned (a common trait of malicious tools) and have a statistically high entropy, which is a strong indicator of a packed file, potentially a compiled AHK/AutoIt script."
    answer_sources:
      - "Sysmon Event ID 1"
      - "Zeek files.log"
      - "Network Egress/Internet Gateway (for PE file capture), Enterprise workstations, Download directories"
    range: "last 90 days"
    queries:
      - "FOR new executables (Zeek files.log), CALCULATE Shannon entropy. BASELINE entropy for known-good signed executables. ALERT if executable is unsigned AND its entropy is in top 2nd percentile (e.g., > 7.2)."
  - question: "Can a machine learning model classify an executable file as a compiled script based on its PE features?"
    context: "This question uses a classifier to automatically identify executables that are likely compiled scripts, even without obvious indicators. By training on a rich set of PE features (entropy, signatures, section names, imports), the model can learn the subtle characteristics that distinguish benign files from packed or compiled-script malware, enabling proactive detection of suspicious files as they enter the network."
    answer_sources:
      - "Zeek pe.log"
      - "Zeek files.log"
      - "Network Egress/Internet Gateway (for PE file capture), Enterprise workstations, Download directories"
    range: "last 90 days"
    queries:
      - "TRAIN classifier on PE_features (entropy, signature_validity, section_names, imports) to classify files as 'Benign', 'Packed', or 'Compiled-Script'. ALERT on 'Packed' or 'Compiled-Script' classifications, especially if observed executing."
  - question: "Has an AutoHotkey/AutoIt process spawned a suspicious child process, such as a LOLBAS with malicious command-line arguments?"
    context: "A common adversary technique is to use a legitimate scripting tool like AutoHotkey to launch other built-in Windows tools (Living Off the Land Binaries or LOLBAS) to execute malicious commands. This question looks for this specific parent-child relationship and inspects the child process's command line for keywords associated with code execution or file downloads (e.g., 'IEX', '-enc'), indicating malicious intent."
    answer_sources:
      - "Windows Event ID 4688"
      - "Sysmon Event ID 1"
      - "Enterprise workstations, Application Servers, Domain Controllers"
    range: "last 90 days"
    queries:
      - "SEARCH process_creation_events (Sysmon 1). ALERT if parent_process is 'AutoHotkey.exe'/'AutoIt3.exe' AND child_process is a LOLBAS (cmd.exe, powershell.exe). INCREASE severity if child_command_line contains ('-enc', 'IEX', 'DownloadString')."
  - question: "Does a child process spawned by AutoHotkey/AutoIt have a command line with statistically high entropy?"
    context: "Adversaries often encode or obfuscate commands passed on the command line to evade simple keyword-based detection. This obfuscation typically increases the entropy (randomness) of the command-line string. This question identifies child processes of AHK/AutoIt with unusually high command-line entropy, which is a strong indicator of hidden or malicious commands."
    answer_sources:
      - "Sysmon Event ID 1"
      - "Enterprise workstations, Application Servers, Domain Controllers"
    range: "last 90 days"
    queries:
      - "FOR child processes of AutoHotkey/AutoIt, CALCULATE Shannon entropy of command_line_arguments. BASELINE entropy across all processes. ALERT if entropy exceeds 99th percentile of baseline (e.g., > 4.5)."
  - question: "Is a sequence of processes initiated by AutoHotkey/AutoIt anomalous compared to a baseline of normal activity?"
    context: "This question uses sequence analysis to model normal chains of process execution (e.g., parent -> child -> grandchild). By learning common, benign sequences, the model can identify new process chains involving AutoHotkey/AutoIt that have a very low probability of occurring naturally. These anomalous sequences are highly suspect and could represent a new or unusual adversary TTP."
    answer_sources:
      - "Sysmon Event ID 1"
      - "Enterprise workstations, Application Servers, Domain Controllers"
    range: "last 90 days"
    queries:
      - "TRAIN sequence model (n-gram) on benign parent-child process chains. FOR new process chains involving AutoHotkey/AutoIt, CALCULATE probability score. ALERT if score is below a low-probability threshold."
  - question: "Is an AutoHotkey/AutoIt process making a network connection to a known malicious IP address or domain?"
    context: "This question provides a direct method for identifying malicious C2 communications by linking a specific process (AutoHotkey/AutoIt) to a network destination. By checking the destination against threat intelligence feeds, analysts can confirm with high confidence if the script is communicating with adversary-controlled infrastructure."
    answer_sources:
      - "Sysmon Event ID 3"
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Network Egress/Internet Gateway, DNS Servers, Enterprise workstations"
    range: "last 90 days"
    queries:
      - "SEARCH network_connection_events (Sysmon 3) where process_image is 'AutoHotkey.exe'/'AutoIt3.exe'. QUERY DestinationIp and DestinationHostname against threat_intel_feeds. ALERT on match."
  - question: "Is a network connection from an AutoHotkey/AutoIt process statistically rare for its host?"
    context: "This question seeks to identify anomalous outbound connections by creating a profile of normal network activity for each host. A connection from an AHK/AutoIt process to a destination (IP, ASN, country) that the host has rarely or never connected to before is a statistical anomaly. This could indicate a C2 channel or data exfiltration to an unusual location."
    answer_sources:
      - "Zeek conn.log"
      - "Network Egress/Internet Gateway, DNS Servers, Enterprise workstations"
    range: "last 90 days"
    queries:
      - "BASELINE outbound connections (dest_ip, dest_asn, dest_country, ja3s) per host from Zeek conn.log. FOR new AHK/AutoIt connections, CALCULATE rarity score based on combination of features. ALERT if score exceeds 99th percentile."
  - question: "Is an AutoHotkey/AutoIt process exhibiting periodic network 'heartbeat' activity indicative of C2 beaconing?"
    context: "Command and control channels often involve regular, periodic connections (beacons or heartbeats) from the compromised host back to the C2 server. This question analyzes the time intervals and data sizes of connections from AHK/AutoIt processes to identify these repeating, non-random patterns. Detecting such beaconing is a strong sign of an active C2 channel."
    answer_sources:
      - "Zeek conn.log"
      - "Network Egress/Internet Gateway, DNS Servers, Enterprise workstations"
    range: "last 90 days"
    queries:
      - "FOR each host-destination pair from an AHK/AutoIt process, CREATE time series of connections. ANALYZE time delta between connections and data size consistency. USE statistical methods (autocorrelation) to find periodic patterns. ALERT on strong periodic signals."