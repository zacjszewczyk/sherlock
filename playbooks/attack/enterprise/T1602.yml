name: T1602: Data from Configuration Repository
id: f8e1d2c3-b4a5-4f6e-8d9c-0a1b2c3d4e5f
description: This playbook helps identify if an adversary has collected sensitive data from configuration repositories. This is achieved by looking for various indicators, such as network connections or authentications from suspicious sources (e.g., threat intelligence feeds, compromised credentials), unauthorized execution of network management tools like snmpwalk, SNMP GET requests for sensitive configuration OIDs, access from unauthorized network segments, unusually large data transfers from repositories, anomalous authentication patterns like impossible travel, and unauthorized file system access to sensitive configuration files or backups on hosting servers.
type: technique
related:
  - TA0009: Collection
contributors:
  - Zachary Szewczyk
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Has a successful connection or authentication to a designated configuration repository occurred from a known malicious IP or with compromised credentials?
    context: This question seeks to find high-confidence indicators of compromise by correlating access attempts to critical configuration repositories with known threat intelligence. An adversary using a known malicious IP address or stolen credentials to access these systems is a strong signal of targeted collection activity.
    answer_sources:
      - Zeek conn.log
      - Zeek snmp.log
      - Zeek ssh.log
      - Zeek ssl.log
      - Windows Event ID 4624
      - Windows Event ID 4625
      - Network Management System (NMS) servers
      - TFTP servers
      - Core network infrastructure (routers, switches)
      - Domain Controllers hosting Group Policy Objects
      - Cloud management consoles and API endpoints
      - Version control systems (e.g., Git, SVN) storing infrastructure-as-code
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH successful connection and authentication logs FOR destination in NAI_list AND (source_ip IN threat_intel_feed OR username IN compromised_creds_list)
  - question: Has a connection to a configuration repository been made from a statistically rare source country, especially if the source IP is on a threat list?
    context: This question helps identify suspicious connections that may not be on high-confidence threat feeds but exhibit anomalous properties. By baselining normal access patterns, we can flag connections from geographically rare locations, which could indicate an adversary attempting to bypass region-based blocking or using a newly acquired overseas proxy. The correlation with a threat list increases confidence.
    answer_sources:
      - Zeek conn.log
      - Zeek snmp.log
      - Zeek ssh.log
      - Zeek ssl.log
      - Windows Event ID 4624
      - Windows Event ID 4625
      - Network Management System (NMS) servers
      - TFTP servers
      - Core network infrastructure (routers, switches)
      - Domain Controllers hosting Group Policy Objects
      - Cloud management consoles and API endpoints
      - Version control systems (e.g., Git, SVN) storing infrastructure-as-code
    range: last 90 days
    queries:
      - technology: pseudocode
        query: BASELINE source ASNs and countries for connections to NAIs. FOR each new connection, ALERT if source_ip is on threat_list AND source_country_rarity > 99th percentile.
  - question: Can we identify malicious sessions to configuration repositories using a machine learning model based on connection features?
    context: This question leverages machine learning to detect complex, non-obvious patterns of malicious activity. A model trained on features like IP reputation, ASN rarity, and time-of-day deviations can identify sessions that, while not matching a simple rule, collectively appear malicious, providing a more sophisticated and adaptable detection method.
    answer_sources:
      - Zeek conn.log
      - Zeek snmp.log
      - Zeek ssh.log
      - Zeek ssl.log
      - Windows Event ID 4624
      - Windows Event ID 4625
      - Network Management System (NMS) servers
      - TFTP servers
      - Core network infrastructure (routers, switches)
      - Domain Controllers hosting Group Policy Objects
      - Cloud management consoles and API endpoints
      - Version control systems (e.g., Git, SVN) storing infrastructure-as-code
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SCORE new connection sessions using a trained classification model. ALERT if malicious_probability_score > 0.85.
  - question: Has an SNMP GET/GETBULK request targeted a sensitive OID, or has a tool like snmpwalk or nmap been run on a non-administrative host?
    context: This question targets specific adversary actions related to configuration harvesting via SNMP. Monitoring for requests to OIDs known to contain configuration data or for the execution of SNMP reconnaissance tools on unauthorized workstations can directly uncover an adversary's attempt to enumerate and steal device configurations.
    answer_sources:
      - Zeek snmp.log
      - Zeek conn.log
      - Windows Event ID 4688
      - Network Management System (NMS) servers
      - Core network infrastructure (routers, switches)
      - Endpoints not designated for network administration
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH snmp_logs for requests with OIDs in sensitive_oid_list OR SEARCH process_creation_logs for 'snmpwalk' or 'nmap -sU' on hosts NOT IN network_admin_group.
  - question: Is there an SNMP source exhibiting unusually high entropy in its OID requests, suggesting a reconnaissance scan?
    context: This question aims to differentiate between legitimate, targeted SNMP polling and malicious reconnaissance. Legitimate tools typically query a stable set of OIDs, resulting in low entropy. An adversary using a tool to walk the entire MIB tree will generate a high variety of OID requests, leading to a statistically significant spike in entropy that can be detected.
    answer_sources:
      - Zeek snmp.log
      - Zeek conn.log
      - Windows Event ID 4688
      - Network Management System (NMS) servers
      - Core network infrastructure (routers, switches)
      - Endpoints not designated for network administration
    range: last 90 days
    queries:
      - technology: pseudocode
        query: BASELINE OID request entropy per source_ip. FOR each 5-min window, ALERT if a source_ip's entropy > (baseline_mean + 3 * baseline_stdev).
  - question: Has an unauthorized host initiated an SNMP query sequence that is highly improbable according to our model of legitimate activity?
    context: This question uses sequence analysis to model the *pattern* of SNMP requests, not just their content. Legitimate management servers follow predictable query sequences. An adversary's manual or scripted reconnaissance will likely deviate from this pattern, resulting in a low probability score from a model trained on legitimate sequences.
    answer_sources:
      - Zeek snmp.log
      - Zeek conn.log
      - Windows Event ID 4688
      - Network Management System (NMS) servers
      - Core network infrastructure (routers, switches)
      - Endpoints not designated for network administration
    range: last 90 days
    queries:
      - technology: pseudocode
        query: MODEL legitimate SNMP query sequences. FOR each new sequence from an unauthorized source, ALERT if probability_is_legitimate < threshold.
  - question: Has a connection or login attempt to a configuration repository originated from a host or account not on the authorized allow-list?
    context: This question enforces a strict security policy by defining exactly who and what is allowed to access critical configuration repositories. Any access attempt from an IP, subnet, or user account not on this explicit allow-list is a direct policy violation and a strong indicator of unauthorized activity or lateral movement.
    answer_sources:
      - Zeek conn.log
      - Zeek snmp.log
      - Windows Event ID 4624
      - Network Management System (NMS) servers
      - Core network infrastructure (routers, switches)
      - Domain Controllers hosting Group Policy Objects
      - Cloud management consoles and API endpoints
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH connection and login logs FOR destination in NAI_list AND (source_ip NOT IN admin_ip_list OR username NOT IN admin_user_list).
  - question: Has a connection to a configuration repository originated from a statistically rare network subnet?
    context: This question helps find unusual access paths that might be missed by static allow-lists. By baselining all connecting subnets, we can identify when a connection originates from a subnet that rarely, if ever, communicates with a given repository. This could represent a compromised host in an unexpected network segment being used for lateral movement.
    answer_sources:
      - Zeek conn.log
      - Zeek snmp.log
      - Windows Event ID 4624
      - Network Management System (NMS) servers
      - Core network infrastructure (routers, switches)
      - Domain Controllers hosting Group Policy Objects
      - Cloud management consoles and API endpoints
    range: last 90 days
    queries:
      - technology: pseudocode
        query: BASELINE source subnet frequency for connections to NAIs. FOR each new connection, ALERT if source_subnet_rarity > 98th percentile.
  - question: Can we use unsupervised machine learning to identify anomalous network sessions to configuration repositories that represent outliers from normal traffic clusters?
    context: This question applies outlier detection to find "unknown unknowns." By clustering all network sessions based on features like source, port, and data volume, the algorithm can group all legitimate traffic patterns. Any session that does not fit into a normal cluster is flagged as an outlier, representing a statistically anomalous event that warrants investigation.
    answer_sources:
      - Zeek conn.log
      - Zeek snmp.log
      - Windows Event ID 4624
      - Network Management System (NMS) servers
      - Core network infrastructure (routers, switches)
      - Domain Controllers hosting Group Policy Objects
      - Cloud management consoles and API endpoints
    range: last 90 days
    queries:
      - technology: pseudocode
        query: CLUSTER connection log metadata using DBSCAN/k-means. ALERT on any connection classified as noise or an outlier.
  - question: Has a network session to a configuration repository involved a data transfer volume that exceeds a predefined hard threshold?
    context: This question provides a simple, direct method for detecting potential bulk data exfiltration. While normal administrative tasks involve small data transfers, an adversary downloading an entire device configuration or repository backup will result in a large data transfer that can be caught by a static threshold (e.g., >50MB).
    answer_sources:
      - Zeek conn.log
      - Zeek snmp.log
      - Network Management System (NMS) servers
      - TFTP servers
      - Core network infrastructure (routers, switches)
      - Version control systems (e.g., Git, SVN) storing infrastructure-as-code
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH connection logs for destination in NAI_list AND server_to_client_bytes > threshold (e.g., 50MB).
  - question: Has a network session to a configuration repository involved a data transfer volume that is a statistically significant outlier compared to its historical baseline?
    context: This question improves upon a hard threshold by creating a dynamic baseline for each specific source-destination pair. This approach is more precise, as it can detect an unusually large transfer that might still be below a global hard limit, flagging it as abnormal for that specific, established communication channel. A high Z-score indicates a significant deviation from the norm.
    answer_sources:
      - Zeek conn.log
      - Zeek snmp.log
      - Network Management System (NMS) servers
      - TFTP servers
      - Core network infrastructure (routers, switches)
      - Version control systems (e.g., Git, SVN) storing infrastructure-as-code
    range: last 90 days
    queries:
      - technology: pseudocode
        query: BASELINE server_to_client_bytes per source-destination pair. FOR each new connection, ALERT if Z-score of server_to_client_bytes > 3.5.
  - question: Has the total data volume transferred from a configuration repository significantly exceeded the predicted volume from a time series forecast?
    context: This question looks for bulk data transfers at an aggregate level. By forecasting the expected data volume from a repository on an hourly basis, we can detect significant spikes that exceed the model's prediction. This is useful for identifying large-scale collection events that may be distributed across multiple sessions but are anomalous in aggregate.
    answer_sources:
      - Zeek conn.log
      - Zeek snmp.log
      - Network Management System (NMS) servers
      - TFTP servers
      - Core network infrastructure (routers, switches)
      - Version control systems (e.g., Git, SVN) storing infrastructure-as-code
    range: last 90 days
    queries:
      - technology: pseudocode
        query: FORECAST aggregate hourly data volume from each NAI. ALERT if actual_volume > predicted_upper_bound.
  - question: Has a successful login to a configuration repository occurred immediately after a high number of failed attempts from the same source?
    context: This question specifically targets brute-force or password-spraying attacks. A pattern of numerous failed logins followed by a single success from the same source IP is a classic indicator that an adversary was attempting to guess credentials and eventually succeeded. Correlating failed and successful events provides strong evidence of this attack pattern.
    answer_sources:
      - Windows Event ID 4624
      - Windows Event ID 4625
      - Zeek conn.log
      - Network Management System (NMS) servers
      - Domain Controllers
      - Cloud management consoles
      - Version control systems (e.g., Git, SVN)
    range: last 90 days
    queries:
      - technology: pseudocode
        query: FOR each successful login, COUNT failed logins from same source_ip on same host in prior 5 mins. ALERT if failed_count > 15.
  - question: Has an administrative user logged in under "impossible travel" conditions or at a statistically unusual time of day?
    context: This question focuses on identifying credential abuse by analyzing the context of the login. An "impossible travel" event (e.g., logins from New York and Tokyo within an hour) is physically impossible and indicates compromised credentials. Similarly, a login occurring at a time that is a major deviation from the user's established baseline can also indicate that someone other than the legitimate user is accessing the account.
    answer_sources:
      - Windows Event ID 4624
      - Windows Event ID 4625
      - Zeek conn.log
      - Network Management System (NMS) servers
      - Domain Controllers
      - Cloud management consoles
      - Version control systems (e.g., Git, SVN)
    range: last 90 days
    queries:
      - technology: pseudocode
        query: BASELINE user login hours and locations. ALERT on impossible travel events OR if login hour is > 4 standard deviations from user's mean.
  - question: Can we identify anomalous authentication events using an Isolation Forest model that flags outliers based on multiple login features?
    context: This question uses an unsupervised learning model designed for anomaly detection to find suspicious logins. The Isolation Forest algorithm learns a profile of normal activity for each user based on features like location, time, and logon type. It can effectively "isolate" and flag logins that deviate significantly from this learned profile, without requiring predefined rules.
    answer_sources:
      - Windows Event ID 4624
      - Windows Event ID 4625
      - Zeek conn.log
      - Network Management System (NMS) servers
      - Domain Controllers
      - Cloud management consoles
      - Version control systems (e.g., Git, SVN)
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SCORE new authentication events using a trained Isolation Forest model. ALERT on events flagged as anomalies/outliers.
  - question: Has an unauthorized process or user account attempted to read a sensitive configuration file?
    context: This question provides a final layer of defense by monitoring file access directly on the host system. By using System Access Control Lists (SACLs) to audit read access to critical files and directories, we can alert when a process or user not on an explicit allow-list (e.g., powershell.exe, a non-admin user) attempts to access a protected configuration file, indicating a potential local collection attempt.
    answer_sources:
      - Windows Event ID 4663
      - Windows Event ID 4656
      - File systems of Network Management System (NMS) servers
      - TFTP server root directories
      - Domain Controller SYSVOL shares containing GPOs
      - Local directories of version control systems (e.g., Git, SVN) on management servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH file_access_audit_logs FOR access to sensitive_files AND (process_name NOT IN approved_process_list OR username NOT IN approved_user_group).
  - question: Has a typically dormant configuration file been accessed, or has a file been accessed by a statistically rare process?
    context: This question uses statistical analysis to find anomalous file access patterns. Some sensitive files, like monthly backup archives, are rarely accessed. An alert on any access to such a file is highly significant. Likewise, if a common configuration file is suddenly read by a process that has never accessed it before (e.g., powershell.exe), it represents a deviation from normal behavior that requires investigation.
    answer_sources:
      - Windows Event ID 4663
      - Windows Event ID 4656
      - File systems of Network Management System (NMS) servers
      - TFTP server root directories
      - Domain Controller SYSVOL shares containing GPOs
      - Local directories of version control systems (e.g., Git, SVN) on management servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: BASELINE file access frequency by process and user. ALERT if a dormant file is accessed OR if a file is accessed by a rare process.
  - question: Can a machine learning model, trained on historical file access events, identify a malicious attempt to read a configuration file?
    context: This question applies supervised machine learning to the problem of detecting malicious file access. A model can be trained on labeled data to learn the subtle characteristics that differentiate legitimate administrative access from malicious access. Features like process rarity, user account privilege level, and time of day can be used to build a classifier that flags suspicious read events with high accuracy.
    answer_sources:
      - Windows Event ID 4663
      - Windows Event ID 4656
      - File systems of Network Management System (NMS) servers
      - TFTP server root directories
      - Domain Controller SYSVOL shares containing GPOs
      - Local directories of version control systems (e.g., Git, SVN) on management servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SCORE new file access events using a trained classification model. ALERT on events classified as malicious.