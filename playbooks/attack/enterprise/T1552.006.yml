name: T1552.006: Group Policy Preferences
id: f47ac10b-58cc-4372-a567-0e02b2c3d479
description: This playbook focuses on detecting adversaries attempting to access credentials stored in Group Policy Preferences (GPP). This technique involves searching for passwords that were historically stored in GPP XML files within the SYSVOL share. This playbook provides questions to help identify this activity through several means: detecting the execution of known GPP credential dumping tools, identifying command-line searches for the 'cpassword' string in SYSVOL, monitoring for anomalous access to GPP-related XML files by users or hosts, identifying patterns of broad directory enumeration followed by targeted file reads, and detecting any interaction with purpose-built GPP honeypot files.
type: technique
related:
  - TA0006: Credential Access
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Have any known Group Policy Preferences (GPP) credential dumping tools been executed?
    context: Adversaries use specific, known tools to find and decrypt credentials stored in GPP XML files. Detecting the execution of these tools by name, command-line arguments, or file hash is a high-confidence indicator of an attempted credential access attack.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 4104
      - Process execution logs on all endpoints, including Domain Controllers, Member Servers, and User Workstations.
    range: Last 90 days
    queries:
      - technology: Pseudocode
        query: SEARCH process_creation_logs OR powershell_script_logs WHERE command_line CONTAINS ('Get-GPPPassword' OR 'gpprefdecrypt.py' OR 'Gpp-Decrypt.ps1' OR 'cpassword') OR process_hash IN known_malicious_gpp_tool_hashes
  - question: Are there any processes with unusually high entropy names accessing the SYSVOL share, potentially indicating obfuscated GPP dumping tools?
    context: To evade simple signature-based detections, attackers often rename or pack their tools, resulting in process names with high character randomness (entropy). Correlating high-entropy process names with access to the SYSVOL share, where GPP files reside, can help uncover previously unknown or obfuscated credential dumping tools.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 4104
      - Process execution logs on all endpoints, including Domain Controllers, Member Servers, and User Workstations.
    range: Last 90 days
    queries:
      - technology: Pseudocode
        query: FIND processes with name_entropy > 95th_percentile_baseline AND making_network_connection_to_SYSVOL
  - question: Has a machine learning model detected any malicious processes making network connections to a Domain Controller's SYSVOL share?
    context: A machine learning model trained on process behaviors can identify malicious activity that evades traditional signatures. When a process flagged as malicious by such a model is also seen accessing the SYSVOL share, it strongly suggests an attempt to access or modify Group Policy, including GPP files containing credentials.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 4104
      - Process execution logs on all endpoints, including Domain Controllers, Member Servers, and User Workstations.
    range: Last 90 days
    queries:
      - technology: Pseudocode
        query: TRIGGER alert IF ml_process_detection_model flags process as 'malicious' AND process_accesses_path '\\<DOMAIN>\SYSVOL\'
  - question: Are there any command-line executions using text-searching utilities to find the string 'cpassword' in XML files on a SYSVOL share?
    context: Before the vulnerability was patched, GPP stored passwords in XML files, obfuscated with AES but decryptable with a publicly known key. The password was stored in a field named 'cpassword'. Searching for this specific string within XML files on the SYSVOL share is a classic adversary technique to locate these legacy credentials.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 4104
      - Process execution logs on all endpoints, and file access audit logs on Domain Controllers hosting the SYSVOL share.
    range: Last 90 days
    queries:
      - technology: Pseudocode
        query: SEARCH process_creation_logs OR powershell_script_logs WHERE command_line MATCHES REGEX '.*(findstr|grep|Select-String).*cpassword.*\\\\SYSVOL\\\\.*\\.xml'
  - question: Has a User Behavior Analytics (UBA) model detected any users executing historically anomalous commands related to searching for 'cpassword' on the SYSVOL share?
    context: Most users have predictable command-line activity. A user who does not typically use tools like 'findstr' or access the SYSVOL share suddenly doing so to search for 'cpassword' is a strong anomaly. A UBA system can baseline normal behavior and flag such deviations, which may indicate a compromised account being used for credential discovery.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 4104
      - Process execution logs on all endpoints, and file access audit logs on Domain Controllers hosting the SYSVOL share.
    range: Last 90 days
    queries:
      - technology: Pseudocode
        query: TRIGGER UBA_alert IF user_command_pattern IS anomalous(<5th_percentile) AND command INCLUDES ('findstr', 'cpassword', 'SYSVOL')
  - question: Has a time-series anomaly detection model identified any anomalous spikes in command-line activity targeting the SYSVOL path?
    context: Automated discovery scripts used by adversaries often result in a sudden, sharp increase in a specific activity, such as accessing the SYSVOL share. A time-series model can learn the normal rhythm of access to this path and automatically flag any unusual spikes that could represent an adversary's script running in the environment.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 4104
      - Process execution logs on all endpoints, and file access audit logs on Domain Controllers hosting the SYSVOL share.
    range: Last 90 days
    queries:
      - technology: Pseudocode
        query: TRIGGER alert IF time_series_model DETECTS anomalous_spike in count(commands_targeting_SYSVOL)
  - question: Have any non-administrative user accounts been observed reading sensitive GPP-related XML files from the SYSVOL share?
    context: Access to GPP XML files (like Groups.xml or ScheduledTasks.xml) is typically limited to system processes and high-level administrators for policy application. When a standard user account, which has no legitimate reason to read these files directly, is observed accessing them, it is a strong indicator of a compromised account being used for reconnaissance or credential theft.
    answer_sources:
      - Windows Event ID 4663
      - Windows Event ID 5145
      - Zeek smb_files.log
      - Zeek smb_mapping.log
      - File access audit logs on Domain Controllers; Network traffic monitoring points capturing SMB traffic to and from Domain Controllers.
    range: Last 90 days
    queries:
      - technology: Pseudocode
        query: SEARCH file_access_logs WHERE user_group NOT IN ('Domain Admins', 'Enterprise Admins') AND action = 'Read' AND file_path CONTAINS ('Groups.xml', 'Services.xml', 'ScheduledTasks.xml') AND path CONTAINS 'SYSVOL'
  - question: Has any user's access to GPP-related XML files statistically deviated from their established baseline behavior?
    context: Even if an account has some legitimate reason to access SYSVOL, a sudden change in the frequency or type of access can be suspicious. By baselining each user's normal file access patterns, a sudden spike in reads of GPP XML files that exceeds their normal behavior (e.g., more than 3 standard deviations from the mean) can signal malicious activity.
    answer_sources:
      - Windows Event ID 4663
      - Windows Event ID 5145
      - Zeek smb_files.log
      - Zeek smb_mapping.log
      - File access audit logs on Domain Controllers; Network traffic monitoring points capturing SMB traffic to and from Domain Controllers.
    range: Last 90 days
    queries:
      - technology: Pseudocode
        query: TRIGGER alert IF count(user_access_to_gpp_xml) in 1_hour > (user_baseline_mean + 3*stdev)
  - question: Has an unsupervised clustering algorithm identified any users whose SYSVOL access patterns have anomalously shifted to a suspicious cluster indicative of GPP XML file reads?
    context: Machine learning can group users into 'clusters' based on their shared behaviors. A user who normally belongs to a 'no SYSVOL access' cluster but suddenly exhibits behavior (e.g., targeted XML reads) that moves them into a 'suspicious access' cluster indicates a significant and potentially malicious change in their activity profile.
    answer_sources:
      - Windows Event ID 4663
      - Windows Event ID 5145
      - Zeek smb_files.log
      - Zeek smb_mapping.log
      - File access audit logs on Domain Controllers; Network traffic monitoring points capturing SMB traffic to and from Domain Controllers.
    range: Last 90 days
    queries:
      - technology: Pseudocode
        query a TRIGGER alert IF clustering_model moves user_profile FROM 'benign_sysvol_cluster' TO 'suspicious_gpp_read_cluster'
  - question: Has any source host performed a broad directory enumeration of the SYSVOL share followed by a targeted read of a GPP XML file within a short time frame?
    context: Adversaries often don't know the exact location of the files they need. A common pattern is to first list the contents of many directories (enumeration) and then, once a file of interest is found, perform a targeted read. Correlating a high volume of directory listing events from one host with a subsequent read of a GPP XML file from the same host is a strong indicator of this "scan then pounce" technique.
    answer_sources:
      - Windows Event ID 4663
      - Windows Event ID 4688
      - Windows Event ID 5145
      - File and network share audit logs on all Domain Controllers; Process execution logs on endpoints initiating the access.
    range: Last 90 days
    queries:
      - technology: Pseudocode
        query: TRIGGER alert IF source_ip generates >100 'ListDirectory' events on SYSVOL AND THEN, within 5 minutes, same source_ip generates 'ReadData' event for object_name ending in '.xml'
  - question: Have any users exhibited a high rate of directory listing on SYSVOL followed immediately by a small number of specific XML file reads, deviating from normal browsing behavior?
    context: This is a behavioral approach to detecting the "scan then pounce" technique. Normal user browsing involves a mix of directory listings and file reads. An automated script, however, will often perform a massive number of directory listings (placing it in a high percentile for that activity) followed by only one or two targeted file reads. This statistical outlier is a hallmark of malicious discovery.
    answer_sources:
      - Windows Event ID 4663
      - Windows Event ID 4688
      - Windows Event ID 5145
      - File and network share audit logs on all Domain Controllers; Process execution logs on endpoints initiating the access.
    range: Last 90 days
    queries:
      - technology: Pseudocode
        query: FIND users WHERE rate(directory_listings) > 99th_percentile AND rate(targeted_xml_reads) is low, indicating non-browsing behavior
  - question: Has a sequence analysis model detected any low-probability access patterns on SYSVOL, such as a broad directory listing followed by a targeted XML read?
    context: Sophisticated analytics can model the normal sequences of events for administrative tasks on SYSVOL. A sequence analysis model (like an HMM or LSTM) can learn these valid patterns. When it observes a sequence that has a very low probability of occurring under the normal model, such as 'list 100 directories -> read one XML file', it can flag this as a novel and suspicious attack path.
    answer_sources:
      - Windows Event ID 4663
      - Windows Event ID 4688
      - Windows Event ID 5145
      - File and network share audit logs on all Domain Controllers; Process execution logs on endpoints initiating the access.
    range: Last 90 days
    queries:
      - technology: Pseudocode
        query: TRIGGER alert IF sequence_analysis_model classifies event_sequence('broad_listing', 'targeted_xml_read') as low_probability
  - question: Has any access been detected for the purpose-built honeypot GPP XML file located in the SYSVOL share?
    context: A honeypot is a trap for an adversary. By creating a fake GPP XML file and placing it in a realistic SYSVOL location, any access to this file is, by definition, unauthorized and suspicious. An alert on any access (excluding known scanners) is a very high-fidelity signal that an attacker is actively searching for GPP credentials.
    answer_sources:
      - Windows Event ID 4663
      - Windows Event ID 4656
      - A designated honeypot GPP XML file within a Group Policy folder on the SYSVOL share of all Domain Controllers.
    range: Last 90 days
    queries:
      - technology: Pseudocode
        query: TRIGGER CRITICAL alert ON file_access_logs WHERE object_name = 'path\\to\\honey.xml' AND subject_user NOT IN scanner_allowlist
  - question: Have access attempts against the GPP honeypot file originated from multiple distinct users or hosts within a 24-hour period, suggesting widespread automated discovery?
    context: While a single access to a honeypot is a critical alert, multiple accesses from different sources in a short time frame change the context. This pattern suggests the attack is not an isolated, manual effort but a widespread, automated campaign, which requires a more urgent and broader incident response.
    answer_sources:
      - Windows Event ID 4663
      - Windows Event ID 4656
      - A designated honeypot GPP XML file within a Group Policy folder on the SYSVOL share of all Domain Controllers.
    range: Last 90 days
    queries:
      - technology: Pseudocode
        query: ESCALATE incident_priority IF count(distinct users OR hosts accessing 'honey.xml') in 24_hours > 1
  - question: Has a one-class SVM anomaly detection model, trained on the 'no-access' state of the GPP honeypot file, classified any access events as an outlier?
    context: This is an advanced method for validating a honeypot alert. A one-class SVM is a machine learning model trained only on 'normal' dataâ€”in this case, the complete absence of access to the honeypot file. Any access event is, by definition, an anomaly. Using the model to confirm this provides a machine-validated, high-confidence alert that is difficult for an analyst to dismiss as a false positive.
    answer_sources:
      - Windows Event ID 4663
      - Windows Event ID 4656
      - A designated honeypot GPP XML file within a Group Policy folder on the SYSVOL share of all Domain Controllers.
    range: Last 90 days
    queries:
      - technology: Pseudocode
        query: TRIGGER alert IF one_class_svm_model classifies honeypot_access_event AS outlier