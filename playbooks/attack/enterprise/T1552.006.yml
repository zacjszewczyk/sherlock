name: T1552.006: Group Policy Preferences
id: a4607798-8c54-4632-9c3f-362d2948195a
description: This playbook helps investigate whether an adversary has accessed credentials stored in Group Policy Preferences (GPP). Detections focus on identifying the use of known GPP credential dumping tools, command-line searches for the 'cpassword' string within SYSVOL XML files, anomalous access to sensitive GPP files (e.g., Groups.xml, Services.xml) by non-administrative users, patterns of broad SYSVOL enumeration followed by targeted file reads, and any access attempts on purpose-built GPP honeypot files.
type: technique
related:
- TA0006: Credential Access
contributors:
- Zachary Szewczyk
- Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
- question: Is there evidence of known Group Policy Preferences (GPP) credential dumping tools being executed?
  context: Adversaries use specific tools like 'Get-GPPPassword' or 'gpprefdecrypt.py' to automatically find and decrypt credentials stored in GPP XML files. This question aims to detect the direct execution of these tools by monitoring process creation and PowerShell logs for their characteristic command-line strings, script content, or known malicious file hashes.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 4104
  - Process execution logs on all endpoints, including Domain Controllers, Member Servers, and User Workstations.
  range: last 90 days
  queries:
  - SIEM | search (EventID=4688 OR EventID=4104) AND (CommandLine CONTAINS 'Get-GPPPassword' OR 'gpprefdecrypt.py' OR 'Gpp-Decrypt.ps1' OR 'cpassword')
- question: Has a process with an unusually random or high-entropy name been observed accessing the SYSVOL share?
  context: Attackers often use obfuscated or randomly generated filenames for their tools to evade simple signature-based detection. This question looks for processes with statistically unusual names (high Shannon entropy) that also interact with the SYSVOL share, a common target for GPP credential theft. This combination can indicate a novel or packed malicious tool.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 4104
  - Process execution logs on all endpoints, including Domain Controllers, Member Servers, and User Workstations.
  range: last 90 days
  queries:
  - EndpointLogs | calculate_shannon_entropy(process_name) | where entropy > baseline_95th_percentile AND network_connection_to_sysvol
- question: Has a machine learning model identified a malicious process that is also accessing a Domain Controller's SYSVOL share?
  context: This question leverages a machine learning model to detect suspicious processes based on a combination of features like parent process, command-line arguments, and user context. The goal is to identify sophisticated threats that might not be caught by simple rules, escalating alerts when such a process specifically targets the SYSVOL share where GPP files reside.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 4104
  - Process execution logs on all endpoints, including Domain Controllers, Member Servers, and User Workstations.
  range: last 90 days
  queries:
  - ML_Alerts | search classification='malicious' AND confidence='high' AND network_connection_to_sysvol
- question: Are there any command-line executions using text-searching utilities to find the string 'cpassword' in SYSVOL XML files?
  context: The string 'cpassword' is a well-known attribute in GPP XML files that contains an AES-encrypted password. Adversaries frequently search for this string within the SYSVOL share to locate files containing credentials. This question aims to detect this specific reconnaissance activity by looking for commands like `findstr` or `Select-String` targeting 'cpassword' in SYSVOL.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 4104
  - Process execution logs on all endpoints, and file access audit logs on Domain Controllers hosting the SYSVOL share.
  range: last 90 days
  queries:
  - SIEM | search (EventID=4688 OR EventID=4104) AND CommandLine MATCHES '.*(findstr|grep|Select-String).*cpassword.*\\\\SYSVOL\\\\.*\\.xml'
- question: Has a user executed an anomalous combination of commands, such as using a search utility to look for 'cpassword' in SYSVOL?
  context: This question uses User Behavior Analytics (UBA) to identify when a user's command-line activity deviates from their established baseline. A non-administrator suddenly searching for 'cpassword' in SYSVOL is highly unusual and suspicious. This approach helps detect insider threats or compromised accounts performing GPP reconnaissance.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 4104
  - Process execution logs on all endpoints, and file access audit logs on Domain Controllers hosting the SYSVOL share.
  range: last 90 days
  queries:
  - UBA_Alerts | search user_command_anomaly AND command_details CONTAINS 'findstr' AND 'cpassword' AND 'SYSVOL'
- question: Has there been an anomalous spike in the frequency of command-line executions targeting the SYSVOL path?
  context: Adversaries often use automated scripts to search for sensitive files, which can cause a sudden, sharp increase in activity targeting a specific location like the SYSVOL share. This question applies time-series analysis to detect such spikes, which stand out from the normal, sporadic access patterns of legitimate users and processes.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 4104
  - Process execution logs on all endpoints, and file access audit logs on Domain Controllers hosting the SYSVOL share.
  range: last 90 days
  queries:
  - Time_Series_Model | search event_source='command_line' AND target_path CONTAINS 'SYSVOL' AND anomaly_score > threshold
- question: Has a non-administrative user account been observed reading sensitive GPP XML files from the SYSVOL share?
  context: Access to GPP files like Groups.xml or Services.xml is typically limited to administrative accounts for policy management. This question aims to create a high-fidelity alert by detecting when any user account not in a privileged group (like Domain Admins) reads these specific files, as this is a strong indicator of credential access behavior.
  answer_sources:
  - Windows Event ID 4663
  - Windows Event ID 5145
  - Zeek smb_files.log
  - Zeek smb_mapping.log
  - File access audit logs on Domain Controllers; Network traffic monitoring points capturing SMB traffic to and from Domain Controllers.
  range: last 90 days
  queries:
  - File_Access_Logs | search (EventID=5145 OR EventID=4663 OR sourcetype='zeek:smb_files') AND file_name IN ('Groups.xml', 'Services.xml') AND user NOT IN ('Domain Admins')
- question: Has any user accessed GPP-related XML files from SYSVOL at a rate that significantly exceeds their personal or peer group's baseline?
  context: Even legitimate administrators have predictable access patterns. This question uses statistical analysis to identify when a user's access rate to GPP XML files deviates significantly (e.g., more than three standard deviations) from their normal behavior or the behavior of their peers. This can catch compromised administrator accounts being used for bulk credential harvesting.
  answer_sources:
  - Windows Event ID 4663
  - Windows Event ID 5145
  - Zeek smb_files.log
  - Zeek smb_mapping.log
  - File access audit logs on Domain Controllers; Network traffic monitoring points capturing SMB traffic to and from Domain Controllers.
  range: last 90 days
  queries:
  - File_Access_Logs | aggregate count by user, hour | where file_name IN GPP_XML_list AND count > (user_baseline_mean + 3 * user_baseline_stddev)
- question: Has a user's SYSVOL access pattern shifted from a benign cluster to a suspicious cluster characterized by targeted GPP XML file reads?
  context: This question employs unsupervised machine learning to group users based on their overall SMB access patterns to SYSVOL. The goal is to automatically identify when a user's behavior changes and moves into a cluster of activity associated with suspicious reconnaissance, such as specifically targeting GPP XML files, indicating a potential compromise or malicious intent.
  answer_sources:
  - Windows Event ID 4663
  - Windows Event ID 5145
  - Zeek smb_files.log
  - Zeek smb_mapping.log
  - File access audit logs on Domain Controllers; Network traffic monitoring points capturing SMB traffic to and from Domain Controllers.
  range: last 90 days
  queries:
  - ML_Model | search model='DBSCAN_SYSVOL_Access' AND alert='User shifted to suspicious cluster'
- question: Has a host been observed performing a broad directory enumeration of the SYSVOL share immediately followed by a targeted read of a GPP XML file?
  context: Adversaries often first list the contents of the SYSVOL share (enumeration) and then access the specific XML files they find. This question uses a stateful correlation rule to detect this distinct two-step pattern: a high volume of directory listing events followed closely by a read of a specific XML file from the same source.
  answer_sources:
  - Windows Event ID 4663
  - Windows Event ID 4688
  - Windows Event ID 5145
  - File and network share audit logs on all Domain Controllers; Process execution logs on endpoints initiating the access.
  range: last 90 days
  queries:
  - SIEM | transaction source_ip | where event1='directory_listing' AND count(event1) > 100 AND event2='file_read' AND file_name MATCHES '.xml' AND timespan < 5m
- question: Is a user performing an unusually high rate of directory enumerations on SYSVOL relative to the number of files they actually read?
  context: Normal user activity typically involves browsing to a known location and opening a file. In contrast, automated reconnaissance involves listing many directories to find a few specific files. This question flags users whose ratio of directory listings to file reads is anomalously high, suggesting they are searching for something rather than performing routine work.
  answer_sources:
  - Windows Event ID 4663
  - Windows Event ID 4688
  - Windows Event ID 5145
  - File and network share audit logs on all Domain Controllers; Process execution logs on endpoints initiating the access.
  range: last 90 days
  queries:
  - File_Access_Logs | calculate ratio(directory_listings, file_reads) by user | where ratio > 99th_percentile
- question: Has a sequence of file access events on SYSVOL occurred that is improbable according to a model of normal administrative behavior?
  context: This question uses a sequence analysis model (like an HMM or LSTM) trained on legitimate administrative access patterns to detect sequences of actions that do not fit the learned model. The specific sequence of 'broad directory listing -> targeted XML read' would be flagged as a low-probability, and therefore suspicious, event.
  answer_sources:
  - Windows Event ID 4663
  - Windows Event ID 4688
  - Windows Event ID 5145
  - File and network share audit logs on all Domain Controllers; Process execution logs on endpoints initiating the access.
  range: last 90 days
  queries:
  - ML_Model | search model='SYSVOL_Sequence_Analyzer' AND sequence_probability < threshold AND sequence_events CONTAINS 'directory_listing' AND 'xml_read'
- question: Has any user or process attempted to access the purpose-built honeypot GPP XML file in the SYSVOL share?
  context: A honeypot file is a decoy with no legitimate purpose. Any attempt to access it is, by definition, unauthorized and suspicious. This question aims to create a critical, high-fidelity alert that triggers immediately upon any read or access attempt on this specific file, indicating an adversary is actively searching for GPP credentials.
  answer_sources:
  - Windows Event ID 4663
  - Windows Event ID 4656
  - A designated honeypot GPP XML file within a Group Policy folder on the SYSVOL share of all Domain Controllers.
  range: last 90 days
  queries:
  - File_Access_Logs | search (EventID=4663 OR EventID=4656) AND file_path='...\\honey.xml' AND user NOT IN (allow_list)
- question: Have multiple distinct users or hosts accessed the GPP honeypot file within a short time frame?
  context: While a single access to a honeypot is a critical alert, access from multiple sources can indicate a more widespread, automated, and urgent threat. This question adds context by automatically escalating the incident's priority if the honeypot is touched by more than one user or host, suggesting a broad internal reconnaissance campaign.
  answer_sources:
  - Windows Event ID 4663
  - Windows Event ID 4656
  - A designated honeypot GPP XML file within a Group Policy folder on the SYSVOL share of all Domain Controllers.
  range: last 90 days
  queries:
  - Honeypot_Alerts | aggregate distinct_count(user), distinct_count(host) by 24h | where distinct_count(user) > 1 OR distinct_count(host) > 1
- question: Has a one-class SVM model, trained on the 'no-access' state of the honeypot file, detected an anomalous access event?
  context: This question formalizes the honeypot concept using a machine learning model. A one-class SVM is trained only on 'normal' dataâ€”in this case, the complete absence of access logs for the honeypot file. Any log event that appears is therefore an anomaly. This provides a machine-validated method for generating a high-confidence alert for any interaction with the honeypot.
  answer_sources:
  - Windows Event ID 4663
  - Windows Event ID 4656
  - A designated honeypot GPP XML file within a Group Policy folder on the SYSVOL share of all Domain Controllers.
  range: last 90 days
  queries:
  - ML_Model | search model='OneClassSVM_Honeypot' AND classification='anomaly' AND file_path='...\\honey.xml'