name: T1573.002: Asymmetric Cryptography
id: 5a8a1c9e-5c7d-4b8a-9e1f-6a2c3d4e5f6a
description: This playbook helps determine if an adversary has established an encrypted Command and Control channel using asymmetric cryptography. It focuses on identifying malicious SSL/TLS connections by matching against threat intelligence (IPs, domains, certs, JA3/JA3S), detecting suspicious certificate attributes (self-signed, generic subjects, non-standard ports), analyzing connection metadata for C2 patterns (beaconing, data exfiltration, long sessions), correlating network traffic with non-browser process activity on endpoints, and detecting algorithmically generated domains (DGA) or domain fluxing behavior.
type: technique
related:
  - TA0011: Command and Control
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Has any outbound SSL/TLS traffic matched known malicious indicators from threat intelligence feeds?
    context: This question aims to find direct evidence of C2 communications by comparing key attributes of SSL/TLS connections against high-confidence threat intelligence. A match on a destination IP, Server Name Indication (SNI), certificate serial/fingerprint, or JA3/JA3S hash is a strong indicator of compromise. This is a primary, high-fidelity check for known-bad activity.
    answer_sources:
      - Zeek conn.log
      - Zeek ssl.log
      - Zeek x509.log
      - Internet Gateway/Egress Points
    range: last 90 days
    queries:
      - query: "pseudocode: JOIN conn.log, ssl.log, x509.log | LOOKUP destination_ip, sni, cert_serial, cert_fingerprint, ja3, ja3s IN threat_intel_feeds | WHERE match_found | ALERT"
  - question: For any identified IOC match, is the destination indicator rare within the environment?
    context: This question adds crucial context to an IOC match. Widespread traffic to a compromised destination might indicate a broad, non-targeted attack or a compromised legitimate service. However, if only one or a very small number of internal hosts are communicating with the malicious destination, it strongly suggests a targeted intrusion and a dedicated C2 channel, which warrants a more urgent investigation.
    answer_sources:
      - Zeek conn.log
      - Zeek ssl.log
      - Internet Gateway/Egress Points
    range: last 7 days
    queries:
      - query: "pseudocode: FOR each IOC_match | SEARCH conn.log for destination_indicator in last 7 days | COUNT unique source_ips | IF count < threshold | ESCALATE alert"
  - question: Can a machine learning model identify new, potentially malicious SSL/TLS connections based on their attributes?
    context: This question explores a proactive, predictive approach. By training a model on features like JA3/JA3S hashes, certificate details, and ASN information, analysts can identify suspicious connections that don't match existing, known-bad indicators. This helps detect novel threats and C2 infrastructure that hasn't yet been added to threat intelligence feeds.
    answer_sources:
      - Zeek conn.log
      - Zeek ssl.log
      - Zeek x509.log
      - Internet Gateway/Egress Points
    range: last 90 days
    queries:
      - query: "pseudocode: EXTRACT features (JA3, cert_validity, key_length, etc.) from ssl.log | APPLY trained_model(features) | IF score > threshold | ALERT"
  - question: Are there any outbound SSL/TLS connections using self-signed or generic certificates, especially over non-standard ports?
    context: Legitimate services typically use certificates issued by a trusted Certificate Authority (CA). Adversaries often use self-signed certificates or certificates with generic, non-descriptive subject fields (like 'localhost') for their C2 infrastructure to avoid the cost and scrutiny of obtaining a legitimate one. Combining this with traffic on non-standard ports further increases the likelihood that the connection is malicious.
    answer_sources:
      - Zeek ssl.log
      - Zeek x509.log
      - Zeek conn.log
      - Internet Gateway/Egress Points
      - Internal Server Segments
    range: last 90 days
    queries:
      - query: "pseudocode: SEARCH x509.log WHERE cert_issuer == cert_subject OR cert_subject IN generic_list | JOIN conn.log | WHERE dest_port NOT IN standard_ssl_ports | ALERT"
  - question: Can outbound SSL/TLS connections be risk-scored to identify the most suspicious activity?
    context: This question moves beyond single indicators to a composite risk model. Instead of alerting on one suspicious attribute, this approach aggregates multiple weak signals (self-signed status, generic subject, non-standard port, JA3 rarity) into a single score. Connections that accumulate a high score are statistically more likely to be malicious, allowing analysts to focus on the riskiest traffic.
    answer_sources:
      - Zeek ssl.log
      - Zeek x509.log
      - Zeek conn.log
      - Internet Gateway/Egress Points
      - Internal Server Segments
    range: last 90 days
    queries:
      - query: "pseudocode: FOR each ssl_connection | CALCULATE score = points(self_signed) + points(generic_subject) + points(non_standard_port) + points(rare_ja3) | IF score > threshold | ALERT"
  - question: Can anomalous SSL/TLS connections be found by identifying statistical outliers in network traffic clusters?
    context: This question uses unsupervised machine learning to find the 'odd one out'. Legitimate traffic from browsers and common applications tends to form large, dense clusters based on its characteristics (certificate details, JA3 hash, etc.). Adversary C2 traffic, being different, will likely appear as a small, isolated cluster or a statistical outlier. This method is effective for finding unknown threats without relying on pre-existing labels or signatures.
    answer_sources:
      - Zeek ssl.log
      - Zeek x509.log
      - Zeek conn.log
      - Internet Gateway/Egress Points
      - Internal Server Segments
    range: last 90 days
    queries:
      - query: "pseudocode: EXTRACT features (cert_duration, key_algo, ja3, sni_length, port) from ssl.log | APPLY DBSCAN(features) | INVESTIGATE small_clusters and outliers"
  - question: Are there any long-lived SSL/TLS connections where the amount of data sent significantly exceeds the data received, suggesting data exfiltration?
    context: This question hunts for data exfiltration patterns over an encrypted channel. While some legitimate activity involves large uploads, a high upload-to-download ratio, combined with a long session duration to a destination that isn't a known cloud storage or file-sharing service, is highly suspicious. This could indicate an adversary exfiltrating stolen data.
    answer_sources:
      - Zeek conn.log
      - Zeek ssl.log
      - Internet Gateway/Egress Points
    range: last 90 days
    queries:
      - query: "pseudocode: SEARCH conn.log WHERE service=='ssl' | CALCULATE upload_ratio = sent_bytes / received_bytes | IF upload_ratio > 1.5 AND duration > 10m AND dest_ip NOT IN allowlist | ALERT"
  - question: Has any internal host exhibited a significant deviation from its normal SSL/TLS connection behavior?
    context: This question focuses on anomaly detection at the host level. Every host has a typical pattern of network behavior. By establishing a baseline for metrics like connection duration and data transfer ratios, we can automatically detect when a host suddenly behaves differently. A significant deviation, such as a connection lasting much longer or sending much more data than usual for that specific host, can be an early indicator of compromise.
    answer_sources:
      - Zeek conn.log
      - Zeek ssl.log
      - Internet Gateway/Egress Points
    range: last 30 days
    queries:
      - query: "pseudocode: FOR each source_ip | CALCULATE baseline (mean, stdev) of duration, bytes, ratio over 30 days | FOR each new_connection | IF metric > (mean + 3*stdev) | ALERT"
  - question: Is any internal host making periodic, regular SSL/TLS connections to an external destination, indicative of C2 beaconing?
    context: This question targets the 'heartbeat' of C2 malware. Automated implants regularly check in with their C2 server for new commands. This results in highly periodic connections with very little variation in the time interval between them (low jitter). Detecting this machine-like regularity is a classic and effective way to uncover active C2 channels, as human-generated traffic is typically much more random.
    answer_sources:
      - Zeek conn.log
      - Zeek ssl.log
      - Internet Gateway/Egress Points
    range: last 90 days
    queries:
      - query: "pseudocode: FOR each source_ip, dest_ip pair | CALCULATE time_delta between consecutive connections | IF stdev(time_deltas) is very low over 5+ connections | ALERT on beaconing"
  - question: Is a non-browser process, such as a script engine or LOLBin, making an outbound SSL/TLS connection?
    context: This question aims to find C2 activity originating from processes that shouldn't normally be making direct internet connections. While browsers are expected to make TLS connections, a PowerShell script, rundll32.exe, or a command prompt doing so is highly anomalous. By correlating process creation events with network connection events on the endpoint, we can pinpoint the exact unauthorized process responsible for the suspicious traffic.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 5156
      - Zeek conn.log
      - Endpoint Devices (User Workstations, Servers)
    range: last 90 days
    queries:
      - query: "pseudocode: JOIN EventID:4688 and EventID:5156 on ProcessID | IF process_name NOT IN browser_allowlist AND dest_port IN ssl_ports | ALERT"
  - question: Are network connections originating from processes that have a rare or suspicious parent process?
    context: This question adds context by examining the process lineage. Malware often uses legitimate processes to launch its components in a way that is abnormal. For example, Microsoft Word (winword.exe) should not be spawning PowerShell. By identifying network connections made by a process that was created through a statistically rare parent-child relationship, we can uncover sophisticated attempts by malware to hide its activity.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 5156
      - Endpoint Devices (User Workstations, Servers)
    range: last 90 days
    queries:
      - query: "pseudocode: CALCULATE frequency of all parent-child process pairs | SCORE rarity of each pair | IF network_connection initiated by process in rare_pair | ALERT"
  - question: Can graph analysis reveal high-risk chains of events, such as an Office application spawning a LOLBin that connects to a rare external IP?
    context: This question applies advanced graph analytics to connect disparate events into a single narrative. By representing processes, files, and network destinations as a graph, we can visualize and algorithmically detect entire attack chains. This is more powerful than looking at individual events in isolation and can uncover complex adversary behavior that might otherwise be missed.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 5156
      - Zeek conn.log
      - Endpoint Devices (User Workstations, Servers)
    range: last 90 days
    queries:
      - query: "pseudocode: BUILD graph from process, file, and network events | APPLY GNN anomaly_detection | IDENTIFY and ALERT on high-risk subgraphs (e.g., Office->LOLBin->Rare_IP)"
  - question: Is any host attempting to resolve a domain that matches known DGA patterns, and then connecting to it over SSL/TLS?
    context: This question seeks to identify C2 communication that relies on Domain Generation Algorithms (DGAs). Malware uses DGAs to rapidly generate thousands of potential C2 domains, making blocklisting ineffective. By matching DNS queries against known DGA regex patterns and then confirming a subsequent encrypted connection, we can reliably detect this advanced C2 technique.
    answer_sources:
      - Zeek ssl.log
      - Zeek dns.log
      - Zeek conn.log
      - Internal DNS Resolvers
      - Internet Gateway/Egress Points
    range: last 90 days
    queries:
      - query: "pseudocode: SEARCH dns.log for domains matching DGA_regex_list | GET resolved_ip | SEARCH conn.log for connections to resolved_ip on ssl ports | ALERT"
  - question: Is any host exhibiting DGA-like behavior, such as querying high-entropy domains or connecting to an unusually high number of unique IPs in a short time (domain fluxing)?
    context: This question looks for the statistical symptoms of DGA or domain fluxing. DGA domains are often random-looking and thus have high character entropy. Separately, a compromised host trying to find its C2 server may rapidly connect to many different domains/IPs. By alerting on high-entropy DNS queries or an anomalously high rate of new connections, we can detect potential DGA activity even if the specific DGA pattern is unknown.
    answer_sources:
      - Zeek ssl.log
      - Zeek dns.log
      - Zeek conn.log
      - Internal DNS Resolvers
      - Internet Gateway/Egress Points
    range: last 90 days
    queries:
      - query: "pseudocode: 1) CALCULATE entropy for each DNS query name; ALERT if > threshold. 2) COUNT unique destination IPs per host per 5-min window; ALERT if count > 99.5th percentile."
  - question: Is any host suddenly querying a significantly higher number of new, unique domains than its historical baseline predicts?
    context: This question uses time-series forecasting to detect a specific type of DGA behavior. A host typically has a predictable pattern of how many *new* domains it looks up over time. A DGA-infected host will show a sudden, massive spike in this number when the algorithm kicks in. By modeling the normal behavior and alerting on significant deviations from the forecast, we can pinpoint the start of a DGA-based C2 attempt.
    answer_sources:
      - Zeek dns.log
      - Internal DNS Resolvers
      - Internet Gateway/Egress Points
    range: last 90 days
    queries:
      - query: "pseudocode: FOR each host | FORECAST expected_new_domains_per_hour using SARIMA/Prophet | IF actual_count > prediction_interval_upper_bound | ALERT"