name: T1598.003: Spearphishing Link
id: 2e7a09c2-3e28-444e-a6a3-f1a26d1b7d8c
description: >
  Investigates whether an adversary is performing reconnaissance by sending spearphishing links to gather information. The playbook provides questions to detect various stages and methods of this technique, including: direct communication with known malicious infrastructure identified via threat intelligence; analysis of URLs for phishing characteristics like typosquatting or obfuscation; spotting unusual traffic spikes to new or low-reputation domains indicative of a coordinated campaign; tracking outbound data submissions (HTTP POSTs) to suspicious sites, which could be credential harvesting; identifying the subtle network signatures of email tracking pixels used to validate targets; monitoring mobile device traffic for signs of QR code-based phishing ('quishing'); and detecting anomalous process behavior on endpoints, such as a browser spawning a shell, which could indicate a Browser-in-the-Browser (BitB) attack.
type: technique
related:
  - TA0043: Reconnaissance
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Are internal hosts communicating with domains, IPs, or URLs known to be associated with phishing based on threat intelligence?
    context: >
      This question uses a direct, rule-based approach to detect compromise. By comparing outbound network traffic from DNS queries, TCP connections, and HTTP requests against a curated list of known malicious indicators, analysts can quickly identify successful spearphishing clicks with high confidence. An alert signifies a direct link to adversary infrastructure.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - Zeek http.log
      - Network egress points (e.g., Firewalls, Web Proxies)
      - Internal DNS Resolvers
      - Mail Gateway
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each record in (dns.log, conn.log, http.log)
          LOOKUP record.destination against phishing_threat_feed
          IF match exists
            ALERT on record
  - question: Are specific users or departments experiencing a statistically unusual rate of contact with known phishing infrastructure, potentially indicating a targeted campaign?
    context: >
      This question moves beyond single events to identify patterns of activity. A user or group repeatedly hitting known-bad indicators at a rate significantly higher than their peers is a strong signal of a targeted spearphishing campaign. This statistical approach helps prioritize investigations by focusing on the most anomalous and potentially targeted activity.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - Zeek http.log
      - Network egress points (e.g., Firewalls, Web Proxies)
      - Internal DNS Resolvers
      - Mail Gateway
    range: last 30 days
    queries:
      - technology: pseudocode
        query: |
          CALCULATE threat_intel_hits per user/department over 30 days
          CALCULATE 95th percentile threshold for organization
          FOR each user/department
            IF hit_count > threshold
              ALERT on user/department
  - question: Can we use machine learning to predictively identify and score new outbound connections that are likely malicious, even if they are not yet on a threat intelligence feed?
    context: >
      This question aims to proactively identify novel threats. A supervised model trained on features of known good and bad connections (e.g., duration, bytes transferred, user agent) can learn to generalize and score new, unseen connections. This allows for the detection of emerging phishing campaigns before their infrastructure is widely reported.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - Zeek http.log
      - Network egress points (e.g., Firewalls, Web Proxies)
      - Internal DNS Resolvers
      - Mail Gateway
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each new outbound connection
            EXTRACT features (duration, bytes, host, etc.)
            APPLY trained_classification_model to features
            IF model_score > malicious_threshold
              ALERT on connection
  - question: Are users accessing URLs that contain suspicious patterns like obfuscated credentials, typosquatting, or keywords commonly used in phishing?
    context: >
      This question uses pattern matching to find tell-tale signs of phishing directly within URLs. Attackers often use techniques like including '@' to confuse browsers or adding words like 'login' and 'verify' to trick users. A regular expression search can systematically flag these suspicious URL structures for review.
    answer_sources:
      - Zeek dns.log
      - Zeek http.log
      - Internal DNS Resolvers
      - Web Proxies
      - User Workstations
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each record in (dns.log, http.log)
          APPLY regex for '@' in hostname OR keywords ('login', 'verify') in non-corporate domain
          IF match
            ALERT on record
  - question: Are we observing URLs with unusually high randomness (entropy) or that are slight misspellings (typosquats) of legitimate domains?
    context: >
      This question uses statistical measures to identify algorithmically generated or typosquatted domains. High entropy in subdomains can indicate domain generation algorithms (DGAs), while a small Levenshtein distance to known good domains can reveal typosquatting. These methods find suspicious domains without prior knowledge of them being malicious.
    answer_sources:
      - Zeek dns.log
      - Zeek http.log
      - Internal DNS Resolvers
      - Web Proxies
      - User Workstations
    range: last 30 days
    queries:
      - technology: pseudocode
        query: |
          CALCULATE entropy for all URL subdomains/paths
          CALCULATE Levenshtein distance against known_good_domains
          IF entropy > 99th_percentile_baseline OR distance is small
            ALERT on URL
  - question: Can we use an unsupervised machine learning model to detect anomalous URLs that deviate from the structure of legitimate traffic?
    context: >
      This question seeks to identify phishing URLs by treating them as anomalies. An unsupervised model, like an Isolation Forest, can be trained on features from legitimate URLs (length, character types, etc.) to learn what 'normal' looks like. It can then flag any new URL that significantly deviates from this learned norm, indicating a potentially malicious or malformed link.
    answer_sources:
      - Zeek dns.log
      - Zeek http.log
      - Internal DNS Resolvers
      - Web Proxies
      - User Workstations
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each new URL
            EXTRACT structural features (length, char_dist, etc.)
            APPLY trained_unsupervised_model
            IF anomaly_score is high
              ALERT on URL
  - question: Are multiple internal hosts suddenly connecting to a single, recently registered external domain?
    context: >
      This question aims to detect the initial wave of a successful spearphishing campaign. Adversaries often use newly registered domains for their operations. A sudden burst of connections from multiple distinct internal hosts to such a domain within a short time is a strong indicator that several users have clicked the same malicious link.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - Network egress points
      - Internal DNS Resolvers
    range: last 30 days
    queries:
      - technology: pseudocode
        query: |
          FOR each new domain connection
            IF domain not seen in last 30 days
              CHECK domain registration date
              IF registered < 30 days ago
                COUNT distinct source IPs to domain in 1 hour
                IF count > 5
                  ALERT on domain and source IPs
  - question: Is any single external domain receiving a statistically significant spike in connections from unique internal sources?
    context: >
      This question identifies coordinated click-through events by looking for statistical anomalies in connection patterns. A sudden increase in the number of unique internal clients connecting to one external domain, exceeding a dynamic baseline (e.g., 3 standard deviations above the mean), points to a distributed event like a successful phishing email.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - Network egress points
      - Internal DNS Resolvers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each 5-minute window
            FOR each destination domain
              COUNT unique source IPs
            CALCULATE mean and std_dev for all domains
            IF source_ip_count > (mean + 3 * std_dev)
              ALERT on domain
  - question: Can a time-series model predict and detect anomalous spikes in request volume to any given external domain?
    context: >
      This question uses forecasting to find unexpected traffic surges. A time-series model (like ARIMA) learns the normal rhythm of request volume for various domains. When the actual number of requests suddenly and significantly exceeds the model's prediction, it signals an anomaly that could correspond to a phishing campaign's success.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - Network egress points
      - Internal DNS Resolvers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each destination domain
            APPLY trained_timeseries_model to request volume history
            GET predicted_request_count for current time
            IF actual_request_count >> predicted_request_count
              ALERT on domain
  - question: Are users submitting data via HTTP POST to external domains that are either known-bad or not on an approved list for such activity?
    context: >
      This question focuses on potential data exfiltration, specifically credential harvesting. An HTTP POST is used to send data to a server. By monitoring for POSTs to domains on threat intelligence feeds or to any domain not explicitly allow-listed for receiving form data, we can detect likely credential theft in real-time.
    answer_sources:
      - Zeek http.log
      - Zeek conn.log
      - User Workstations
      - Web Proxies
      - Network Egress Points
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each http.log record where method is 'POST'
            IF destination is external
              CHECK if destination in threat_intel OR NOT in post_allow_list
              IF true
                ALERT on record
  - question: Are we observing HTTP POST requests to external domains that have rarely or never received them before?
    context: >
      This question helps find credential harvesting sites by focusing on novelty. Legitimate POST activity is typically directed at a stable set of known sites. A POST request sent to a domain that has never received one before, or does so very infrequently, is highly suspicious and could indicate a user submitting credentials to a phishing page.
    answer_sources:
      - Zeek http.log
      - Zeek conn.log
      - User Workstations
      - Web Proxies
      - Network Egress Points
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          MAINTAIN baseline of domains receiving POSTs and their frequency
          FOR each new POST request
            IF destination_domain is new OR in < 5th percentile of frequency
              ALERT on request
  - question: Can we group similar HTTP POST behaviors together to identify clusters of activity directed at low-reputation or newly observed domains?
    context: >
      This question uses unsupervised learning to find groups of suspicious POST requests. By clustering requests based on features like URI path, content type, and destination reputation, we can isolate anomalous groups. A cluster forming around a new or untrusted domain is a strong indicator of a coordinated credential harvesting campaign.
    answer_sources:
      - Zeek http.log
      - Zeek conn.log
      - User Workstations
      - Web Proxies
      - Network Egress Points
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          EXTRACT features from all POST requests (URI, content-type, domain_rep)
          APPLY clustering algorithm (e.g., DBSCAN)
          INVESTIGATE clusters formed around low-reputation or new domains
  - question: Are we seeing network behavior consistent with tracking pixels, such as an immediate, short-lived connection with minimal data transfer to a new domain after a DNS lookup?
    context: >
      This question targets a common reconnaissance technique where attackers embed a tiny, invisible image (tracking pixel) in an email to verify that the recipient has opened it. This is detected by looking for a characteristic pattern: a DNS query immediately followed by a very brief TCP connection with almost no data exchanged, especially to a newly observed domain.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - User Workstations (specifically email client processes)
      - Network Egress Points
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          CORRELATE dns.log and conn.log by source IP and time
          IF dns_query is followed within 2s by a connection
            AND connection_bytes < 500
            AND connection_duration < 1s
            AND domain is newly observed
            ALERT on event chain
  - question: Are we observing network connections that are statistical outliers in terms of having extremely short durations and low data transfer volumes, especially to suspicious domains?
    context: >
      This question uses statistics to find connections that exhibit the properties of a tracking pixel. By identifying all connections that fall into the lowest percentile for both duration and data volume, we can isolate a population of events that are likely not legitimate content transfers. Cross-referencing these with suspicious domain characteristics (e.g., high entropy) enhances detection.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - User Workstations (specifically email client processes)
      - Network Egress Points
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          CALCULATE 1st percentile for connection_duration and total_bytes
          FOR each connection
            IF duration and bytes are both < 1st_percentile
              CHECK destination domain for suspicious properties (new, high-entropy)
              IF suspicious
                ALERT on connection
  - question: Can a machine learning classifier be trained to distinguish between legitimate API 'pings' and malicious tracking pixel 'pingbacks'?
    context: >
      This question aims to differentiate malicious reconnaissance from benign 'heartbeat' traffic with higher accuracy. A supervised model, like logistic regression, can be trained on a labeled dataset of both types of traffic, using features like duration, byte count, and domain reputation. This allows for automated classification and alerting on connections that have a high probability of being malicious pingbacks.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - User Workstations (specifically email client processes)
      - Network Egress Points
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each short/small connection
            EXTRACT features (duration, bytes, domain_age, entropy)
            APPLY trained_logistic_regression_model
            IF probability of 'pingback' is high
              ALERT on connection
  - question: Are mobile devices on our network connecting to domains known to be used in QR code-based phishing (quishing) campaigns?
    context: >
      This question addresses the rising threat of 'quishing,' where users scan malicious QR codes. By filtering for traffic from mobile user agents and correlating their destinations against threat intelligence feeds that specifically track QR phishing campaigns, we can detect when a user has been compromised through this vector.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - Zeek http.log
      - Corporate Wi-Fi Network Segments
      - Internal DNS Resolvers
      - User Mobile Devices
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FILTER http.log for mobile user-agents ('iPhone', 'Android')
          FROM matching source IPs, get connections from conn.log
          LOOKUP connection.destination against QR_phishing_threat_feed
          IF match
            ALERT on device and destination
  - question: Are mobile devices accessing domains that are both newly registered and appear to be typosquatted versions of legitimate sites?
    context: >
      This question uses statistical properties to detect mobile phishing without a specific threat feed. It establishes a baseline of normal domains accessed by mobile devices. An alert is triggered when a mobile device connects to a domain that is anomalous on two fronts: it's very new (recently registered) and it's a close misspelling of a known good domain, a classic phishing combination.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - Zeek http.log
      - Corporate Wi-Fi Network Segments
      - Internal DNS Resolvers
      - User Mobile Devices
    range: last 30 days
    queries:
      - technology: pseudocode
        query: |
          FILTER for mobile device traffic
          FOR each destination domain
            CHECK registration date
            CALCULATE Levenshtein distance against known_good_domains
            IF registered < 30 days AND distance is small
              ALERT on device and domain
  - question: Can an unsupervised model identify anomalous network sessions from mobile devices that deviate from established normal behavior?
    context: >
      This question seeks to find unknown threats from mobile devices by defining a 'normal' session profile. An unsupervised model can learn the typical features of mobile traffic (common destinations, data volumes, etc.). It can then flag entire sessions that are highly anomalous, which could indicate a user interacting with a malicious site after a QR code scan.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - Zeek http.log
      - Corporate Wi--Fi Network Segments
      - Internal DNS Resolvers
      - User Mobile Devices
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each mobile device session
            EXTRACT features (domain_category, reputation, data_volume)
            APPLY trained_unsupervised_model
            IF session is flagged as an anomaly
              ALERT on session
  - question: Are web browsers on our endpoints spawning unexpected child processes, such as another browser instance or a command-line interpreter, especially after visiting a low-reputation domain?
    context: >
      This question aims to detect Browser-in-the-Browser (BitB) attacks or other malicious post-click execution. A web browser spawning a shell (like powershell.exe) or another browser process is highly irregular and suspicious. Correlating this endpoint event with a preceding network connection to a risky domain provides strong evidence of a successful attack.
    answer_sources:
      - Windows Event ID 4688
      - Zeek conn.log
      - User Workstations
      - Endpoint Devices
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          MONITOR for Event ID 4688 where parent is browser (chrome.exe, etc.)
          AND child is unexpected (powershell.exe, another browser.exe)
          CORRELATE with recent conn.log from same host to low-reputation domain
          IF correlation exists
            ALERT on host and processes
  - question: Are we observing statistically rare parent-child process relationships originating from web browsers?
    context: >
      This question uses a statistical baseline of process behavior to find anomalies. Over time, browsers have a predictable set of child processes they spawn for normal operation. By monitoring for process relationships that are extreme outliers (e.g., occurring less than 0.1% of the time), we can automatically flag novel or unusual execution chains that may be malicious.
    answer_sources:
      - Windows Event ID 4688
      - Zeek conn.log
      - User Workstations
      - Endpoint Devices
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          CREATE baseline of parent-child process relationships for browsers
          MONITOR for Event ID 4688 with browser parent
          IF parent-child relationship is a statistical outlier (e.g., < 0.1% frequency)
            ALERT on host and processes
  - question: Can a machine learning model classify process creation events as benign or suspicious based on their attributes?
    context: >
      This question uses supervised learning to automate the detection of malicious process execution. A decision tree can be trained on features from process events (parent/child names, command-line arguments, etc.) to learn the rules that separate benign from malicious activity. This allows for a more nuanced and accurate classification than simple rule-based or statistical methods.
    answer_sources:
      - Windows Event ID 4688
      - Zeek conn.log
      - User Workstations
      - Endpoint Devices
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each Event ID 4688 with browser parent
            EXTRACT features (parent, child, command_line_keywords)
            APPLY trained_decision_tree_model
            IF classified as 'suspicious'
              ALERT on event