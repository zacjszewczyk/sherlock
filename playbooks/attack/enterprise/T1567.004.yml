name: T1567.004: Exfiltration Over Webhook
id: f8c4b2a0-6453-4f3b-8f3e-7a9d6b2c1f9d
description: >
  This playbook helps determine if an adversary has established a data exfiltration channel using webhooks. It provides investigative steps to detect this activity by analyzing various evidence types, including: outbound HTTP POST requests to known malicious endpoints; process creation events for command-line utilities like curl or PowerShell used to send data; outbound POST requests with suspicious content types (e.g., application/zip) or high-entropy data bodies; statistical anomalies in the volume of POST requests from a host; and correlated sequences of data archival process creation followed by an outbound POST to an uncommon domain.
type: technique
related:
  - TA0010: Exfiltration
contributors:
  - Zachary Szewczyk
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Are outbound HTTP POST requests being sent to known malicious webhook endpoints identified by threat intelligence?
    context: >
      This question aims to identify direct communication with known adversary infrastructure. By cross-referencing outbound network traffic (specifically HTTP POST requests) with a curated watch list of malicious domains, URLs, and IP addresses, analysts can quickly detect confirmed malicious activity. This is a high-fidelity detection method that relies on up-to-date threat intelligence.
    answer_sources:
      - Zeek http.log
      - Zeek conn.log
      - Zeek dns.log
      - Network egress points (e.g., proxies, firewalls)
      - DNS resolvers
      - Cloud Access Security Broker (CASB) logs
      - Threat intelligence feeds
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: >
          INGEST threat_intel_feed FOR malicious_webhook_endpoints INTO watchlist.
          JOIN zeek_http_logs WITH zeek_conn_logs ON uid.
          WHERE http_log.method == 'POST' AND (http_log.host IN watchlist OR http_log.uri IN watchlist OR conn_log.destination_ip IN watchlist).
          ALERT on match.
  - question: Are there any outbound POST requests to legitimate webhook services with unusually high-entropy URIs?
    context: >
      Adversaries often abuse legitimate services like Discord or Slack for C2 and exfiltration by generating unique, random-looking webhook URLs. While the domain is legitimate, the URI path is not. This question uses statistical analysis (Shannon entropy) to measure the randomness of URI paths. A high entropy score compared to a baseline of normal traffic to the same service can indicate a suspicious, non-human-generated endpoint that warrants investigation.
    answer_sources:
      - Zeek http.log
      - Zeek conn.log
      - Zeek dns.log
      - Network egress points (e.g., proxies, firewalls)
      - DNS resolvers
      - Cloud Access Security Broker (CASB) logs
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: >
          FOR EACH post_request TO known_webhook_domains (e.g., discord.com, slack.com).
          CALCULATE shannon_entropy of uri_path.
          ESTABLISH baseline_entropy_distribution.
          IF entropy > 95th_percentile_of_baseline, FLAG for review.
  - question: Can a machine learning model classify outbound HTTP POST requests as malicious based on their features?
    context: >
      This question leverages a machine learning approach to proactively identify malicious webhook traffic. By training a logistic regression classifier on a variety of features from HTTP POST requests (like URI length and entropy, user-agent), the model can learn the characteristics that distinguish malicious requests from benign ones. This allows for the detection of novel threats that may not match known signatures or simple statistical thresholds.
    answer_sources:
      - Zeek http.log
      - Zeek conn.log
      - Zeek dns.log
      - Network egress points (e.g., proxies, firewalls)
      - DNS resolvers
      - Cloud Access Security Broker (CASB) logs
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: >
          EXTRACT features (uri_length, uri_entropy, etc.) from http_post_requests.
          TRAIN logistic_regression_model on labeled_dataset (benign/malicious).
          FOR new_post_request, PREDICT probability_of_malice.
          IF probability > 0.8, ALERT.
  - question: Are command-line utilities like curl.exe or powershell.exe being used to make suspicious HTTP POST requests indicative of webhook abuse?
    context: >
      This question focuses on detecting webhook-based exfiltration at the endpoint level. Adversaries frequently use built-in command-line tools to send data. By monitoring process creation events (Windows Event ID 4688) and searching for specific command-line arguments (e.g., '-X POST', 'Invoke-RestMethod -Method Post') and URLs of known webhook services, analysts can catch the execution of the exfiltration action itself.
    answer_sources:
      - Windows Event ID 4688
      - Zeek http.log
      - User workstations
      - Servers (especially web and application servers)
      - Development environments
      - CI/CD pipeline runners
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: >
          FROM process_creation_logs (EID 4688), FILTER for processes 'curl.exe', 'wget.exe', 'bitsadmin.exe', 'powershell.exe'.
          SEARCH command_line_args for regex patterns like '-X POST' OR 'Invoke-RestMethod -Method Post' AND webhook_urls.
          ALERT on match.
  - question: Have command-line utilities been executed with statistically rare argument patterns that could indicate webhook usage?
    context: >
      This question aims to find anomalous command-line usage without relying on fixed signatures. By establishing a baseline of normal command-line argument patterns (n-grams) for utilities like `curl.exe` and `powershell.exe` on each host, analysts can identify executions that use statistically rare combinations of arguments. For example, `Invoke-RestMethod` followed by `-InFile` might be highly unusual on a user's workstation and could indicate an exfiltration attempt.
    answer_sources:
      - Windows Event ID 4688
      - Zeek http.log
      - User workstations
      - Servers (especially web and application servers)
      - Development environments
      - CI/CD pipeline runners
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: >
          FOR EACH host, PROFILE normal command-line n-gram frequency for 'curl.exe', 'powershell.exe', etc.
          FOR new_process_creation, CALCULATE n-gram frequency.
          IF frequency < 1st_percentile_of_baseline, FLAG as anomalous.
  - question: Can a machine learning model identify anomalous command-line invocations that deviate from a host's normal behavior?
    context: >
      This question uses an unsupervised machine learning model (One-Class SVM) to detect outlier activity at the endpoint. The model is trained exclusively on benign command-line invocations for a specific host or group of hosts, learning a profile of 'normal' behavior. Any new command that deviates significantly from this learned profile is flagged as an anomaly, allowing for the detection of novel or evasive techniques without predefined rules.
    answer_sources:
      - Windows Event ID 4688
      - Zeek http.log
      - User workstations
      - Servers (especially web and application servers)
      - Development environments
      - CI/CD pipeline runners
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: >
          FOR each host/group, TRAIN One-Class SVM model on benign command-line invocations from EID 4688.
          FEED new process creation events into the model.
          IF model classifies invocation as an outlier, ALERT for investigation.
  - question: Are there outbound POST requests to webhook services containing suspicious data archive content types?
    context: >
      This question attempts to identify the exfiltration of staged data. Adversaries often compress and archive data before exfiltrating it. A symbolic rule can detect outbound HTTP POST requests to known webhook providers where the `Content-Type` header indicates an archive format (e.g., `application/zip`, `application/x-rar-compressed`), which is highly suspicious and warrants immediate investigation.
    answer_sources:
      - Zeek http.log
      - Zeek files.log
      - Network egress points
      - Data Loss Prevention (DLP) systems
      - Servers hosting sensitive data
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: >
          DEFINE watchlist of suspicious_content_types ('application/zip', 'application/octet-stream', etc.).
          FROM http_logs, FILTER for method == 'POST' AND destination is known_webhook_provider.
          IF content_type IN watchlist, ALERT.
  - question: Are there any outbound POST requests with unusually high-entropy data in their body, suggesting encryption or compression?
    context: >
      This question focuses on the characteristics of the exfiltrated data itself. Encrypted or compressed data has high Shannon entropy (a measure of randomness). By calculating the entropy of POST request bodies and establishing a baseline for normal traffic, analysts can flag requests with abnormally high entropy. This can reveal exfiltration even when the content type or destination is not obviously suspicious.
    answer_sources:
      - Zeek http.log
      - Zeek files.log
      - Network egress points
      - Data Loss Prevention (DLP) systems
      - Servers hosting sensitive data
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: >
          FOR all outbound http_post_requests with body available, CALCULATE shannon_entropy of first 4096 bytes.
          ESTABLISH baseline entropy distribution.
          IF entropy > 7.5, FLAG for further analysis.
  - question: Has there been a sudden spike in the volume of data sent via POST requests for a specific content type from any host?
    context: >
      This question uses time-series analysis to detect large-scale exfiltration events. A machine learning model (like ARIMA or LSTM) can learn the normal baseline volume of data transferred via POST requests, segmented by source host and content type. An alert is generated when a sudden, anomalous spike in data volume breaks from this established pattern, indicating a potential mass data transfer that requires investigation.
    answer_sources:
      - Zeek http.log
      - Zeek files.log
      - Network egress points
      - Data Loss Prevention (DLP) systems
      - Servers hosting sensitive data
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: >
          FOR each host and content_type, TRAIN a time-series model (e.g., ARIMA) on POST request data volume.
          IF actual_volume significantly exceeds model's prediction, ALERT.
  - question: Has any host shown a sudden, significant increase in the number of POST requests to webhook domains compared to its recent average?
    context: >
      This question uses a simple threshold-based rule to detect a sudden change in behavior. By monitoring the number of POST requests a host makes to known webhook domains, an alert can be triggered if the count in a short time window (e.g., one hour) dramatically exceeds its recent rolling average (e.g., by 300%). This can be an early indicator of an automated exfiltration script being activated.
    answer_sources:
      - Zeek http.log
      - Zeek conn.log
      - All internal host subnets
      - Virtual Private Network (VPN) concentrators
      - Servers with direct internet access
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: >
          FOR each host, CALCULATE 24-hour rolling average of POST requests to webhook_domains.
          IF count of POSTs in a 1-hour window > (rolling_average * 3), ALERT.
  - question: Is any host exhibiting a statistically anomalous volume or count of outbound POST requests compared to its 30-day baseline?
    context: >
      This question uses a robust statistical method (Interquartile Range) to identify outlier behavior over a longer period. For each host, a 30-day profile of daily POST request counts and data volumes is maintained. Any day where the count or volume significantly exceeds the normal range (defined as $$ Q3 + 1.5 \times IQR $$) is flagged as an outlier, pointing to potential exfiltration activity that stands out from the host's typical behavior.
    answer_sources:
      - Zeek http.log
      - Zeek conn.log
      - All internal host subnets
      - Virtual Private Network (VPN) concentrators
      - Servers with direct internet access
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: >
          FOR each host, CREATE a 30-day rolling profile of daily POST request volume and count.
          CALCULATE Q1, Q3, and IQR for the profile.
          IF today's_volume > (Q3 + 1.5 * IQR), FLAG as daily outlier.
  - question: Is any host's outbound POST request volume to webhook domains significantly exceeding machine learning-based forecasts?
    context: >
      This question employs a sophisticated time-series forecasting model (e.g., Prophet) to predict expected traffic patterns, accounting for seasonality like time of day and day of week. The model learns a host's normal rhythm of outbound POST requests. An alert is generated if the actual observed data volume significantly exceeds the model's predicted upper bound, indicating a deviation from normal behavior that simple averages might miss.
    answer_sources:
      - Zeek http.log
      - Zeek conn.log
      - All internal host subnets
      - Virtual Private Network (VPN) concentrators
      - Servers with direct internet access
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: >
          FOR each host, TRAIN a Prophet time-series model on POST request volume to webhook_domains.
          FORECAST expected volume for the next hour.
          IF actual_volume > forecast_prediction_interval, GENERATE anomaly alert.
  - question: Has a data archiving process been executed on a host shortly before an HTTP POST request was made from the same host?
    context: >
      This question uses stateful correlation to link suspicious preparatory actions with a potential exfiltration event. It looks for a specific sequence: the creation of a process for an archiving tool (like `7z.exe` or `tar.exe`), followed within a short time window (e.g., 5 minutes) by an outbound HTTP POST from the same host. This sequence strongly suggests that data was staged and then immediately sent out.
    answer_sources:
      - Windows Event ID 4688
      - Zeek conn.log
      - Zeek http.log
      - Zeek dns.log
      - Staging servers
      - Developer workstations
      - CI/CD pipeline runners
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: >
          CREATE stateful rule.
          TRIGGER on process_creation for archiving_tool ('7z.exe', 'rar.exe', 'zip.exe').
          IF within 5 minutes, same host initiates HTTP POST, ALERT.
  - question: Has the sequence of data archiving followed by an HTTP POST involved a destination domain that is rarely visited by the organization?
    context: >
      This question enhances the previous correlation rule by adding a statistical measure of rarity. By analyzing DNS logs, we can determine how prevalent a domain is across the organization. If the destination domain of the POST request following an archiving event is very uncommon (e.g., in the bottom 5th percentile of prevalence), it significantly increases the likelihood that the destination is adversary-controlled infrastructure rather than a legitimate service.
    answer_sources:
      - Windows Event ID 4688
      - Zeek conn.log
      - Zeek http.log
      - Zeek dns.log
      - Staging servers
      - Developer workstations
      - CI/CD pipeline runners
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: >
          MAINTAIN 30-day list of domain prevalence from DNS logs.
          ENHANCE previous rule: IF destination_domain of POST is in bottom 5th percentile of prevalence, assign high risk score.
  - question: Can a sequence analysis model detect an anomalous transition from a 'Data Staging' state to an 'Exfiltration' state on a host?
    context: >
      This question applies a machine learning model (Hidden Markov Model) to learn normal sequences of host activities (process creations, network connections, etc.). The model can identify when a host transitions between states in a way that is highly uncharacteristic of benign behavior. An alert is generated if the model observes a high-probability transition from a 'Data Staging' state (e.g., archive process creation) directly to an 'Exfiltration' state (e.g., outbound POST to a rare domain), as this learned sequence is a strong indicator of malicious activity.
    answer_sources:
      - Windows Event ID 4688
      - Zeek conn.log
      - Zeek http.log
      - Zeek dns.log
      - Staging servers
      - Developer workstations
      - CI/CD pipeline runners
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: >
          TRAIN a Hidden Markov Model (HMM) on normal sequences of host events.
          DEFINE states like 'Data Staging' and 'Exfiltration'.
          IF model observes a high-probability anomalous transition from 'Data Staging' to 'Exfiltration', ALERT.