name: T1548.005: Temporary Elevated Cloud Access
id: f8d9e0c1-a2b3-4c5d-6e7f-8a9b0c1d2e3f
description: This playbook helps determine if an adversary has abused temporary elevated cloud access mechanisms for privilege escalation and defense evasion. It provides questions to investigate suspicious cloud CLI tool usage, anomalous role assumption parameters, access from unusual locations, high-risk post-escalation actions, C2 traffic masquerading as legitimate cloud activity, and other defense evasion techniques like log clearing or unauthorized lateral movement from cloud resources.
type: technique
related:
- TA0004: Privilege Escalation
- TA0005: Defense Evasion
contributors:
- Zachary Szewczyk
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
- question: Can we detect a correlation between cloud CLI tool execution and network connections to cloud IAM endpoints from a known malicious IP?
  context: Adversaries may use compromised hosts to execute cloud CLI tools to gain temporary elevated access. Correlating the tool's execution with network traffic to cloud identity services from an IP on a threat intelligence feed can indicate that the activity originates from a known malicious source.
  answer_sources:
  - Windows Event ID 4688, Zeek conn.log. Monitored on: User workstations, developer endpoints, CI/CD pipeline servers, and network egress points.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH (Windows Event ID 4688 WHERE process_name IN ['aws.exe', 'az.cmd']) JOIN (Zeek conn.log) WHERE source_ip IS ON threat_intel_feed WITHIN 5 seconds
- question: Is a host generating an anomalous number of threat intelligence watchlist hits, particularly when correlated with cloud CLI activity?
  context: While some hosts (like those behind a proxy) may generate regular threat intel hits, a sudden spike for a specific host can indicate new, suspicious activity. This is especially concerning if it coincides with the use of cloud CLI tools, suggesting an adversary is using a newly compromised host for cloud access.
  answer_sources:
  - Windows Event ID 4688, Zeek conn.log, Threat Intelligence Feeds. Monitored on: User workstations, developer endpoints, CI/CD pipeline servers, and network egress points.
  range: last 30 days
  queries:
  - technology: pseudocode
    query: PROFILE host_ip FROM threat_intel_hits OVER 30 days. ALERT IF daily_hits > 99th_percentile AND host_ip recently executed cloud_cli_tool
- question: Can we use a machine learning model to classify cloud CLI executions and their associated network traffic as benign or suspicious?
  context: A supervised machine learning model can learn the complex patterns of legitimate versus malicious cloud CLI usage. By analyzing features like command-line arguments, IP reputation, and connection details, the model can identify novel or subtle malicious activity that might evade simpler rule-based detections.
  answer_sources:
  - Windows Event ID 4688, Zeek conn.log. Monitored on: User workstations, developer endpoints, CI/CD pipeline servers, and network egress points.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: CLASSIFY (Windows Event ID 4688, Zeek conn.log) using ML_model(features=[process, args, src_ip_rep, dst_ip, dst_port]). ALERT IF classification == 'suspicious'
- question: Are users executing cloud CLI commands with arguments known to be used for assuming roles or creating temporary tokens?
  context: Adversaries must use specific commands and keywords (e.g., 'assume-role', 'get-session-token') to gain temporary elevated access. Directly monitoring for these strings in process command lines provides a high-fidelity signal of privilege escalation attempts.
  answer_sources:
  - Windows Event ID 4688. Monitored on: User workstations, servers with cloud SDKs/CLIs installed, and systems managed by infrastructure-as-code.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH Windows Event ID 4688 WHERE command_line MATCHES REGEX ('assume-role|get-session-token|impersonate-service-account|Get-AzAccessToken|PassRole')
- question: Is a user requesting temporary credentials with an anomalously long duration or for a role they have never used before?
  context: Adversaries may request unusually long session durations to maintain access. Similarly, an adversary using a compromised account may attempt to assume a role that the legitimate user has never accessed. Baselining normal user behavior for session duration and role usage can reveal these anomalies.
  answer_sources:
  - Windows Event ID 4688. Monitored on: User workstations, servers with cloud SDKs/CLIs installed, and systems managed by infrastructure-as-code.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: PROFILE user_role_pairs for session_duration and role_arn. ALERT IF requested_duration > 95th_percentile OR role_arn is first_seen_for_user
- question: Can we use an unsupervised machine learning model to detect anomalous command-line structures in role assumption events?
  context: Unsupervised models, like autoencoders, can learn the normal structure and syntax of legitimate role assumption commands. When an adversary uses a malformed or unusual combination of parameters, the model will fail to reconstruct it accurately, producing a high error score that signals a potential attack.
  answer_sources:
  - Windows Event ID 4688. Monitored on: User workstations, servers with cloud SDKs/CLIs installed, and systems managed by infrastructure-as-code.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: ANALYZE command_line_tokens FROM role_assumption_events using Autoencoder_model. ALERT IF reconstruction_error > threshold
- question: Is a user attempting to assume a cloud role from an unauthorized IP address or network location?
  context: Legitimate administrative access to cloud IAM/STS services should originate from known, trusted locations like corporate offices or VPNs. An access attempt from an unexpected source IP, even with valid credentials, is a strong indicator of a compromised account or an external threat.
  answer_sources:
  - Zeek conn.log, Windows Event ID 4688, Windows Event ID 4624. Monitored on: VPN concentrators, bastion hosts, corporate LAN/WLAN segments, and authentication logs.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH (Zeek conn.log WHERE destination is IAM_endpoint) JOIN (Windows Event ID 4624) by user. ALERT IF source_ip NOT IN authorized_subnets_ACL
- question: Is a user accessing cloud APIs from an unusual geographic location or at an abnormal time of day?
  context: User activity typically follows predictable patterns based on their location and work schedule. A significant deviation, such as access from a new country or at 3 AM for a 9-to-5 employee, can indicate account compromise. Analyzing the entropy of source locations can also detect an adversary operating from multiple geographically dispersed systems.
  answer_sources:
  - Zeek conn.log, Windows Event ID 4688, Windows Event ID 4624. Monitored on: VPN concentrators, bastion hosts, corporate LAN/WLAN segments, and authentication logs.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: PROFILE user_cloud_access for source_ASN, source_country, hour_of_day. ALERT IF hour_of_day_zscore > 3 OR source_country_entropy spikes
- question: Is there an anomalous spike in the volume of temporary access requests from a specific user or source subnet?
  context: A sudden increase in the number of role assumption or token requests can indicate automated activity, such as an adversary running a script to enumerate permissions or carry out a brute-force attack. A time-series model can distinguish this from normal fluctuations in user activity.
  answer_sources:
  - Zeek conn.log, Windows Event ID 4688, Windows Event ID 4624. Monitored on: VPN concentrators, bastion hosts, corporate LAN/WLAN segments, and authentication logs.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: MODEL volume_of_access_requests per user/subnet using SARIMA. ALERT IF observed_volume > predicted_forecast_interval
- question: Is a temporary privilege escalation event immediately followed by high-risk actions like accessing critical data or connecting to a C2 domain?
  context: A key indicator of malicious intent is what an adversary does after gaining elevated privileges. Chaining a role assumption event with subsequent suspicious activities, such as accessing sensitive files or making DNS queries for known malicious domains, creates a high-confidence alert for post-exploitation behavior.
  answer_sources:
  - Zeek conn.log, Zeek dns.log, Windows Event ID 4663, Windows Event ID 4688. Monitored on: File servers hosting sensitive data, database servers, domain controllers, and cloud storage buckets.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: SEQUENCE (Windows Event ID 4688 with 'assume-role') FOLLOWED BY (Windows Event ID 4663 on critical_share OR Zeek dns.log query for C2_domain) WITHIN 15 minutes FROM same_host
- question: Is a user performing actions after escalating privileges that are rare for them but common in known attack patterns?
  context: Legitimate administrators typically perform a predictable set of actions after assuming a role. An adversary, however, may perform unusual actions like enumerating permissions or searching for sensitive data. By identifying actions that are statistically rare for a user but common in attack methodologies, we can detect this deviation.
  answer_sources:
  - Zeek conn.log, Zeek dns.log, Windows Event ID 4663, Windows Event ID 4688. Monitored on: File servers hosting sensitive data, database servers, domain controllers, and cloud storage buckets.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: PROFILE user_actions post_role_assumption. SCORE actions using TF-IDF against known_attack_playbooks. ALERT IF score > threshold
- question: Does the sequence of actions following a privilege escalation event have a low probability of being legitimate according to a trained model?
  context: A sequence analysis model, like a Hidden Markov Model (HMM), can learn the normal "grammar" of administrative sessions. A sequence of actions that is highly improbable under this model—for instance, assuming a role, then immediately attempting to exfiltrate data—strongly suggests malicious activity.
  answer_sources:
  - Zeek conn.log, Zeek dns.log, Windows Event ID 4663, Windows Event ID 4688. Monitored on: File servers hosting sensitive data, database servers, domain controllers, and cloud storage buckets.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: MODEL action_sequences post_role_assumption using HMM. ALERT IF probability_of_new_sequence < threshold
- question: Is a company cloud resource connecting to or resolving a known command-and-control (C2) IP address or domain?
  context: Adversaries often use compromised cloud resources for C2 communications to evade egress filtering, as traffic from major cloud providers is often trusted. Matching outbound network connections from company cloud assets against a C2 threat intelligence feed is a direct way to detect this evasion technique.
  answer_sources:
  - Zeek conn.log, Zeek dns.log. Monitored on: Cloud VPC flow logs, DNS resolvers, and network egress points for cloud environments.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH (Zeek conn.log OR Zeek dns.log) WHERE source_ip IN company_cloud_range AND (destination_ip IN C2_feed OR query IN C2_feed)
- question: Are DNS queries originating from cloud resources exhibiting signs of algorithmic generation (DGA) or connections to newly registered domains?
  context: C2 channels frequently use DGAs to generate a large number of potential domains, making them difficult to block. High subdomain entropy is a key indicator of DGA. Additionally, adversaries often use newly registered domains for their infrastructure. Combining these indicators can uncover covert C2 channels.
  answer_sources:
  - Zeek conn.log, Zeek dns.log. Monitored on: Cloud VPC flow logs, DNS resolvers, and network egress points for cloud environments.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: ANALYZE Zeek dns.log from cloud_ips. ALERT IF subdomain_entropy > threshold OR domain_age < 24 hours
- question: Can a machine learning model identify C2 traffic from cloud resources based on network flow characteristics?
  context: Even when C2 destinations are unknown, the traffic itself often has distinct features (e.g., regular intervals, fixed packet sizes, long durations). A trained classifier can analyze these metadata patterns from network logs to identify potential C2 communications that might otherwise blend in with normal traffic.
  answer_sources:
  - Zeek conn.log. Monitored on: Cloud VPC flow logs, DNS resolvers, and network egress points for cloud environments.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: CLASSIFY Zeek conn.log from cloud_ips using ML_model(features=[duration, packets, bytes, protocol, inter_arrival_stats]). ALERT IF classification == 'C2'
- question: Are security audit logs being cleared or security tools being disabled on a cloud resource?
  context: Clearing security logs (Event ID 1102) or disabling security software are classic defense evasion techniques. These are high-confidence indicators of malicious activity on their own and are often performed by an adversary immediately after gaining access to a system to cover their tracks.
  answer_sources:
  - Windows Event ID 4688, Windows Event ID 1102. Monitored on: Cloud compute instances (VMs), container orchestration platforms, and centralized logging systems.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH (Windows Event ID 1102) OR (Windows Event ID 4688 WHERE command_line MATCHES ['wevtutil cl', 'Set-MpPreference -DisableRealtimeMonitoring'])
- question: Does a defense evasion event, like log clearing, occur shortly after a temporary cloud access grant?
  context: Adversaries often perform defense evasion actions immediately after escalating privileges. A strong temporal correlation (e.g., within an hour) between a temporary access event and an action like clearing logs on the target machine links the two activities and increases the likelihood of a malicious intrusion.
  answer_sources:
  - Windows Event ID 4688, Windows Event ID 1102. Monitored on: Cloud compute instances (VMs), container orchestration platforms, and centralized logging systems.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: SEQUENCE (temporary_access_grant) FOLLOWED BY (Windows Event ID 1102 OR defense_evasion_command) FOR same_user_or_host WITHIN 60 minutes
- question: Can a machine learning model detect suspicious sequences of commands on a cloud VM that indicate defense evasion?
  context: Legitimate administrative sessions have predictable command sequences. A sequence-based model can learn these patterns and flag anomalous sequences, such as a user logging in, immediately assuming a role, disabling a security tool, and then clearing logs. This holistic view of the session is more powerful than looking at individual events.
  answer_sources:
  - Windows Event ID 4688, Windows Event ID 1102. Monitored on: Cloud compute instances (VMs), container orchestration platforms, and centralized logging systems.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: MODEL command_sequences_on_cloud_vm using LSTM. ALERT IF sequence_probability for 'login -> assume-role -> disable-antivirus -> clear-logs' is low
- question: Is a cloud resource attempting to connect to an internal enterprise asset that is not on its pre-approved communication allow-list?
  context: To facilitate lateral movement, an adversary may use a compromised cloud resource to pivot into the internal on-premise network. Enforcing and monitoring network allow-lists between cloud and on-premise environments can detect these unauthorized connection attempts.
  answer_sources:
  - Zeek conn.log, Windows Event ID 4624. Monitored on: Cloud-to-on-premise network gateways (e.g., VPN, Direct Connect), Domain Controllers, and internal network segments housing high-value assets.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH Zeek conn.log WHERE source_ip IN cloud_range AND destination_ip IN internal_range. ALERT IF (destination_ip, destination_port) NOT IN allow_list_for_source_ip
- question: Is a cloud resource making a statistically rare or first-time connection to an internal asset?
  context: Adversaries moving laterally often create network connections that deviate from established patterns. By modeling the network as a graph and analyzing connection frequencies, we can identify anomalous edges, such as a web server in the cloud suddenly connecting to a human resources database on-premise for the first time.
  answer_sources:
  - Zeek conn.log, Windows Event ID 4624. Monitored on: Cloud-to-on-premise network gateways (e.g., VPN, Direct Connect), Domain Controllers, and internal network segments housing high-value assets.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: PROFILE connections between cloud_resources and internal_assets. ALERT IF connection is first_seen OR connection_frequency is < 5th_percentile
- question: Can we detect anomalous network traffic clusters between cloud and on-premise resources that may indicate lateral movement?
  context: Unsupervised clustering can group network flows into clusters representing normal application behaviors. A new, small cluster or a data point that doesn't fit any existing cluster (an outlier) could represent a new, unauthorized communication path established by an adversary for lateral movement.
  answer_sources:
  - Zeek conn.log, Windows Event ID 4624. Monitored on: Cloud-to-on-premise network gateways (e.g., VPN, Direct Connect), Domain Controllers, and internal network segments housing high-value assets.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: CLUSTER network_flows between cloud_and_onprem using DBSCAN. ALERT on outliers or new_small_clusters
- question: Is a cloud resource generating outbound traffic that violates expected protocol-port pairings or uses anonymization protocols?
  context: Adversaries often tunnel malicious traffic over common ports like 53 (DNS) or 443 (HTTPS) to bypass firewalls. Detecting traffic on these ports that doesn't conform to the expected protocol (e.g., non-DNS traffic on port 53) or identifying the use of protocols like TOR are strong indicators of evasion and C2 activity.
  answer_sources:
  - Zeek conn.log, Zeek dns.log, Zeek ssl.log. Monitored on: Cloud network egress points, VPC flow logs, and application servers within the cloud environment.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH Zeek logs WHERE (port==53 AND protocol!=DNS) OR (port==443 AND is_valid_tls==false) OR protocol==TOR
- question: Is a cloud resource exhibiting anomalous outbound data volume or periodic 'heartbeat' connection patterns?
  context: Data exfiltration often results in a significant, anomalous spike in outbound data volume. C2 channels frequently use periodic, low-and-slow connections ('heartbeats') to maintain contact. Baselining normal data volume and connection timing for each resource allows for the detection of these deviations.
  answer_sources:
  - Zeek conn.log, Zeek dns.log, Zeek ssl.log. Monitored on: Cloud network egress points, VPC flow logs, and application servers within the cloud environment.
  range: last 30 days
  queries:
  - technology: pseudocode
    query: PROFILE cloud_resource_outbound_traffic. ALERT IF daily_volume > 3_std_dev_above_mean OR connection_inter_arrival_time_std_dev is very low
- question: Can an autoencoder model detect anomalous network traffic from a cloud resource that may indicate a C2 channel or data exfiltration?
  context: An autoencoder can learn a compressed representation of normal network behavior across many features (protocol, port, duration, bytes, etc.). When anomalous traffic with an unusual combination of these features is observed, the model will have a high reconstruction error, flagging it as a potential threat that might not violate any single rule.
  answer_sources:
  - Zeek conn.log, Zeek dns.log, Zeek ssl.log. Monitored on: Cloud network egress points, VPC flow logs, and application servers within the cloud environment.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: MODEL network_flows from cloud_resource_group using Autoencoder. ALERT IF reconstruction_error > threshold