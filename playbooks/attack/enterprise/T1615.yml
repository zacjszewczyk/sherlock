name: T1615: Group Policy Discovery
id: f3a1b2c4-d5e6-4f7a-8b9c-0d1e2f3a4b5c
description: This playbook helps investigate whether an adversary has performed discovery of Group Policy settings to identify environmental weaknesses or misconfigurations. It focuses on detecting the use of specific discovery tools via file hashes, the execution of native utilities like gpresult.exe or PowerShell with suspicious arguments, unusual volumes of LDAP queries targeting 'groupPolicyContainer' objects, anomalous file access patterns within the SYSVOL 'Policies' directory, and the specific sequence of an LDAP GPO query followed by SMB access to the SYSVOL share.
type: technique
related:
  - TA0007: Discovery
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Has a process executed with a file hash matching a known Group Policy discovery tool?
    context: This question aims to detect the use of well-known malicious tools like PowerView or BloodHound ingestors. By matching process hashes against a threat intelligence feed, we can identify adversaries using off-the-shelf tooling for GPO discovery, which is a strong indicator of compromise.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 1 (Sysmon)
      - Domain-joined endpoints and member servers where command execution and process creation are logged.
    range: last 90 days
    queries:
      - pseudocode: SEARCH process_creation_events WHERE process_hash IN (known_gpo_discovery_tool_hashes)
  - question: Has a legitimate GPO discovery tool (like gpresult.exe) been spawned by an unusual parent process?
    context: Adversaries may try to evade detection by using legitimate tools. However, they often launch these tools from unexpected parent processes (e.g., a Microsoft Word macro). This question helps identify such anomalies by calculating the statistical rarity of the parent-child process relationship, flagging executions that deviate from normal administrative behavior.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 1 (Sysmon)
      - Domain-joined endpoints and member servers where command execution and process creation are logged.
    range: last 90 days
    queries:
      - pseudocode: SEARCH process_creation_events(gpresult.exe) | STATS rarity(parent_process) | FILTER rarity > 99th_percentile
  - question: Can process execution events related to GPO discovery be classified as malicious using a machine learning model?
    context: This question leverages a supervised machine learning model to provide a more nuanced detection than simple rules. By training on features like process name, parent process, user context, and command-line arguments, the model can learn the complex patterns of both benign and malicious GPO-related activity, identifying sophisticated threats that might otherwise be missed.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 1 (Sysmon)
      - Domain-joined endpoints and member servers where command execution and process creation are logged.
    range: last 90 days
    queries:
      - pseudocode: INPUT process_creation_events | APPLY ML_model(gpo_discovery_classifier) | FILTER prediction == 'malicious'
  - question: Have native utilities like gpresult.exe or PowerShell been executed with command-line arguments or script blocks indicative of GPO enumeration?
    context: This question focuses on detecting specific command-line patterns and PowerShell script content that are hallmarks of GPO discovery. Searching for strings like `gpresult /z` or `Get-GPO -All` provides a high-fidelity way to identify adversaries using built-in Windows tools to map out Group Policy configurations.
    answer_sources:
      - Windows Event ID 4688
      - Windows PowerShell Event ID 4104
      - All domain-joined endpoints and member servers, especially those used by system administrators where PowerShell logging is enabled.
    range: last 90 days
    queries:
      - pseudocode: SEARCH process_creation_events, powershell_script_block_logs WHERE command_line CONTAINS ('gpresult /z', 'Get-GPO -All', 'Get-NetGPO')
  - question: Are there GPO-related command-line executions with unusually high entropy or that are rare for a specific user or host?
    context: Adversaries may obfuscate their commands to avoid simple signature-based detection. This question helps uncover such attempts by analyzing the complexity (entropy) of the command-line string. Additionally, by identifying command executions that are rare for a particular user or on a specific host, it can flag activity that deviates from established user behavior baselines.
    answer_sources:
      - Windows Event ID 4688
      - Windows PowerShell Event ID 4104
      - All domain-joined endpoints and member servers, especially those used by system administrators where PowerShell logging is enabled.
    range: last 90 days
    queries:
      - pseudocode: SEARCH gpo_command_events | STATS entropy(command_line), frequency(user, host, command) | FILTER entropy > 95th_percentile OR frequency is rare
  - question: Has a user exhibited a sudden spike in the frequency of GPO discovery commands, as detected by a time-series anomaly model?
    context: This question aims to identify unusual bursts of GPO discovery activity from a single user. A time-series model learns the normal rhythm of administrative tasks for each user. A significant deviation from this learned pattern, such as an uncharacteristic spike in GPO queries, can indicate that the user's account has been compromised and is being used for reconnaissance.
    answer_sources:
      - Windows Event ID 4688
      - Windows PowerShell Event ID 4104
      - All domain-joined endpoints and member servers, especially those used by system administrators where PowerShell logging is enabled.
    range: last 90 days
    queries:
      - pseudocode: INPUT gpo_command_events | TIME_SERIES_ANALYSIS per_user_frequency | DETECT anomaly_spike
  - question: Have any LDAP queries specifically targeted 'groupPolicyContainer' objects?
    context: This question looks for a very specific and high-fidelity indicator of compromise. LDAP queries for 'groupPolicyContainer' objects are a common precursor to automated GPO enumeration by tools like BloodHound and PowerView. Alerting on this specific query filter can provide an early warning of an adversary's reconnaissance activities.
    answer_sources:
      - Zeek ldap.log
      - Windows Event ID 4661
      - Network traffic to and from Domain Controllers, and Directory Service Access audit logs on Domain Controllers.
    range: last 90 days
    queries:
      - pseudocode: SEARCH ldap_logs WHERE query_filter CONTAINS '(objectClass=groupPolicyContainer)'
  - question: Has any single host sent a statistically anomalous volume of LDAP queries for 'groupPolicyContainer' objects?
    context: While a single query for GPO containers might be suspicious, a large volume of such queries from one host is a much stronger signal of automated discovery. This question establishes a historical baseline for this activity per host and alerts when a host significantly exceeds its normal behavior (e.g., more than 3 standard deviations above the mean), indicating a potential enumeration sweep.
    answer_sources:
      - Zeek ldap.log
      - Windows Event ID 4661
      - Network traffic to and from Domain Controllers, and Directory Service Access audit logs on Domain Controllers.
    range: last 90 days
    queries:
      - pseudocode: SEARCH ldap_gpo_queries | STATS hourly_count by source_host | FILTER hourly_count > (historical_mean + 3 * historical_std_dev)
  - question: Does LDAP query activity fall into an 'anomalous enumeration' cluster as identified by an unsupervised machine learning model?
    context: This question uses unsupervised learning (clustering) to group all LDAP activity based on features like source, frequency, and query complexity. This allows the model to automatically identify distinct groups of behavior. Analysts can then focus their attention on the clusters that represent anomalous or outlier activity, which are likely to contain malicious GPO discovery attempts, without needing pre-labeled data.
    answer_sources:
      - Zeek ldap.log
      - Windows Event ID 4661
      - Network traffic to and from Domain Controllers, and Directory Service Access audit logs on Domain Controllers.
    range: last 90 days
    queries:
      - pseudocode: INPUT ldap_logs | APPLY clustering_model(DBSCAN) | FILTER cluster == 'anomaly'
  - question: Has a non-administrative user accessed an unusual number of files in the SYSVOL 'Policies' directory?
    context: The SYSVOL 'Policies' directory contains the GPO files. While some access is normal, extensive reading of these files, especially by a non-administrative user, is highly suspicious. This question sets a clear threshold to detect when a user account, not belonging to a privileged group, browses an excessive number of policy files, indicating they may be enumerating GPO settings manually or with a script.
    answer_sources:
      - Zeek smb_files.log
      - Windows Event ID 4663
      - SYSVOL share on all Domain Controllers where file system and SMB access auditing is enabled.
    range: last 90 days
    queries:
      - pseudocode: SEARCH sysvol_access_logs WHERE user NOT IN (admin_groups) | STATS distinct_file_count by user, time_window(10m) | FILTER distinct_file_count > 5
  - question: Has any user session involved reading a statistically anomalous number of unique policy files from the SYSVOL share?
    context: This question moves beyond a fixed threshold to a statistical one. It analyzes the distribution of file access counts across all user sessions over time. By flagging sessions that fall into a high percentile (e.g., the top 2%), it can dynamically identify unusually high levels of file access that suggest GPO enumeration, adapting to what is normal for the environment.
    answer_sources:
      - Zeek smb_files.log
      - Windows Event ID 4663
      - SYSVOL share on all Domain Controllers where file system and SMB access auditing is enabled.
    range: last 90 days
    queries:
      - pseudocode: SEARCH sysvol_access_logs | STATS distinct_file_count by user_session | FILTER distinct_file_count > 98th_percentile
  - question: Does a specific SYSVOL access event fall outside the boundary of 'normal' activity as defined by a One-Class SVM model?
    context: This question employs a machine learning model designed to learn what 'normal' SYSVOL access looks like based on features like user, host, and time of day. Any activity that falls outside this learned boundary of normalcy is flagged as an anomaly. This is particularly effective for detecting novel or previously unseen enumeration techniques that don't match known patterns.
    answer_sources:
      - Zeek smb_files.log
      - Windows Event ID 4663
      - SYSVOL share on all Domain Controllers where file system and SMB access auditing is enabled.
    range: last 90 days
    queries:
      - pseudocode: INPUT sysvol_access_logs | APPLY anomaly_detection_model(OneClassSVM) | FILTER prediction == 'anomaly'
  - question: Has a host performed an LDAP query for GPO containers and then immediately accessed the SYSVOL 'Policies' share?
    context: This question correlates two distinct but related adversary behaviors into a single, high-confidence alert. The sequence of an LDAP query to find GPO paths, followed by SMB access to read the policy files from SYSVOL, is a classic pattern for GPO discovery tools. A stateful rule that looks for this specific sequence in a short time window is extremely effective at detecting this technique.
    answer_sources:
      - Zeek ldap.log
      - Zeek smb_files.log
      - Windows Event ID 4661
      - Windows Event ID 4663
      - Domain Controllers and network segments connecting endpoints to Domain Controllers.
    range: last 90 days
    queries:
      - pseudocode: CORRELATE ldap_gpo_query(source_ip) FOLLOWED BY smb_sysvol_access(source_ip) WITHIN 5m
  - question: Has a statistically improbable sequence of an 'LDAP GPO Query' followed by an 'SMB SYSVOL Access' been observed from a single host?
    context: This question adds a statistical layer to sequence detection. By analyzing historical data, we can calculate the probability of one event following another. If the observed sequence of an LDAP GPO query followed by SYSVOL access is statistically rare (i.e., has a very low transition probability), it can be flagged as a significant behavioral anomaly, even if the individual events themselves are not.
    answer_sources:
      - Zeek ldap.log
      - Zeek smb_files.log
      - Windows Event ID 4661
      - Windows Event ID 4663
      - Domain Controllers and network segments connecting endpoints to Domain Controllers.
    range: last 90 days
    queries:
      - pseudocode: CALCULATE transition_probability(event_A, event_B) | FILTER event_A == 'ldap_gpo_query' AND event_B == 'smb_sysvol_access' AND probability < 0.01
  - question: Does a sequence of user/host actions, including LDAP and SMB events, have a low likelihood of occurring according to a sequence analysis model (e.g., HMM)?
    context: This is the most advanced form of sequence analysis, using a model like a Hidden Markov Model (HMM) to learn entire chains of normal user behavior. The model can then calculate the probability of any new sequence of events occurring. The specific 'LDAP GPO Query' -> 'SMB SYSVOL Access' sequence will be assigned a very low likelihood by a well-trained model, making it a powerful tool for flagging this adversary tactic with high confidence.
    answer_sources:
      - Zeek ldap.log
      - Zeek smb_files.log
      - Windows Event ID 4661
      - Windows Event ID 4663
      - Domain Controllers and network segments connecting endpoints to Domain Controllers.
    range: last 90 days
    queries:
      - pseudocode: INPUT event_sequences | APPLY sequence_model(HMM) | FILTER sequence_likelihood is low AND sequence CONTAINS ('ldap_gpo_query', 'smb_sysvol_access')