name: "T1587.002: Code Signing Certificates"
id: "f47ac10b-58cc-4372-a567-0e02b2c3d479"
description: "This playbook addresses the adversary tactic of developing or using malicious code signing certificates for execution, persistence, or defense evasion, as outlined in MITRE ATT&CK T1587.002. It provides investigative steps to detect threats related to code signing certificates, including the use of certificates matching threat intelligence feeds, the unauthorized addition of certificates to trusted stores, the presence of certificates with suspicious metadata (e.g., high entropy, long validity), the execution of binaries signed with self-signed or previously unseen certificates, unusual spikes in the volume of self-signed certificates, and the correlation of a single certificate being used for both code signing and C2 network communication."
type: "technique"
related:
  - "TA0042: Resource Development"
contributors:
  - "Zachary Szewczyk"
created: "2025-10-01"
modified: "2025-10-01"
version: 1.0
tags: "none"
questions:
  - question: "Are any executed binaries or TLS sessions using certificates with thumbprints that match a known-malicious list from threat intelligence?"
    context: "This question aims to identify the direct use of known-bad certificates. Cross-referencing certificate thumbprints from executed processes (captured via Sysmon or Zeek) and network TLS sessions against a list of malicious indicators from CTI feeds allows for high-confidence detection of malicious activity. A match indicates that a compromised or malicious component is active on the network, warranting an immediate high-severity alert."
    answer_sources:
      - "Sysmon Event ID 1"
      - "Zeek ssl.log"
      - "Zeek pe.log"
      - "SIEM/Data Lake aggregating endpoint and network telemetry"
      - "Network sensors at internet egress points"
      - "All endpoints with process and signature monitoring."
    range: "last 90 days"
    queries:
      - pseudocode: "JOIN (process_events, tls_events) ON certificate_thumbprint. FIND thumbprint IN threat_intel_list. ALERT on match."
  - question: "For a certificate identified as malicious by CTI, is its issuer exceptionally rare in the environment?"
    context: "This question adds context to a CTI match by assessing the novelty of the certificate's issuer. An adversary might use a newly created or stolen certificate authority to sign their tools. If a malicious certificate's issuer is rarely or never seen before (e.g., in the bottom 1st percentile of all issuers), it heightens the suspicion that the activity is part of a novel or highly targeted campaign, justifying an escalation in alert priority."
    answer_sources:
      - "Sysmon Event ID 1"
      - "Zeek ssl.log"
      - "Zeek pe.log"
      - "SIEM/Data Lake aggregating endpoint and network telemetry"
      - "Network sensors at internet egress points"
      - "All endpoints with process and signature monitoring."
    range: "last 90 days"
    queries:
      - pseudocode: "FOR matched_cert_thumbprint, GET issuer. COUNT occurrences of issuer in historical logs. IF count < 1st_percentile_of_all_issuers, ESCALATE."
  - question: "Has there been an anomalous spike in the number of new CTI-matched certificate detections?"
    context: "This question seeks to identify a sudden, widespread campaign using known-bad certificates. By applying a time series anomaly detection model to the daily count of new CTI certificate matches, we can establish a baseline of 'normal' activity. A significant deviation from this baseline, such as a count exceeding the 99th percentile of the forecast, strongly suggests a coordinated attack is underway and requires an immediate, high-priority investigation."
    answer_sources:
      - "Sysmon Event ID 1"
      - "Zeek ssl.log"
      - "Zeek pe.log"
      - "SIEM/Data Lake aggregating endpoint and network telemetry"
      - "Network sensors at internet egress points"
      - "All endpoints with process and signature monitoring."
    range: "last 90 days"
    queries:
      - pseudocode: "COUNT new_cti_matches_per_day. APPLY ARIMA model. IF count > upper_confidence_interval, ALERT."
  - question: "Is a user or process attempting to add a new certificate to a trusted root or publisher store using common command-line utilities?"
    context: "This question targets a key persistence and defense evasion technique where an adversary installs a malicious root certificate to make their malware appear trusted. Monitoring for specific command-line patterns used by utilities like 'certutil.exe' or PowerShell's 'Import-Certificate' cmdlet to modify the 'Root' or 'TrustedPublisher' certificate stores provides a direct way to detect this activity. Any such attempt should be considered suspicious and trigger an alert."
    answer_sources:
      - "Sysmon Event ID 1"
      - "Windows Event ID 4688"
      - "Windows Event ID 4104"
      - "Windows endpoints and servers, especially Domain Controllers, Public Key Infrastructure (PKI) servers, and developer workstations."
    range: "last 90 days"
    queries:
      - pseudocode: "SEARCH command_lines for patterns like 'certutil -addstore Root' OR 'Import-Certificate ... -CertStoreLocation ...Root'."
  - question: "Is a certificate store modification being performed by a user or host that rarely or never performs this action?"
    context: "This question helps to differentiate between legitimate administrative activity and suspicious behavior. While IT administrators may regularly manage certificates, the same action from a standard user or a non-administrative server is highly anomalous. By baselining which users and hosts normally perform these tasks, we can flag modifications from entities outside the top 5% of frequent actors as potentially malicious, reducing false positives from routine maintenance."
    answer_sources:
      - "Sysmon Event ID 1"
      - "Windows Event ID 4688"
      - "Windows Event ID 4104"
      - "Windows endpoints and servers, especially Domain Controllers, Public Key Infrastructure (PKI) servers, and developer workstations."
    range: "last 90 days"
    queries:
      - pseudocode: "FOR cert_store_modification_event, GET user and host. CALCULATE historical frequency of this action for user/host. IF frequency NOT IN top 5%, FLAG event."
  - question: "Can we classify the command used for certificate management as 'benign' or 'suspicious' based on its characteristics?"
    context: "This question applies machine learning to add intelligence to the detection of certificate management commands. A classification model can learn the nuances that distinguish benign administrative scripts from malicious one-liners. By analyzing features like command length, specific keywords, and the user's role (e.g., IT admin), the model can automatically classify an event as 'suspicious,' allowing analysts to focus on the highest-risk activities."
    answer_sources:
      - "Sysmon Event ID 1"
      - "Windows Event ID 4688"
      - "Windows Event ID 4104"
      - "Windows endpoints and servers, especially Domain Controllers, Public Key Infrastructure (PKI) servers, and developer workstations."
    range: "last 90 days"
    queries:
      - pseudocode: "EXTRACT features (command length, args, user role) from event. APPLY Logistic Regression model. IF classification is 'suspicious', ALERT."
  - question: "Are any executed binaries signed with certificates containing suspicious metadata patterns?"
    context: "This question focuses on identifying malicious certificates not by a known thumbprint, but by their intrinsic properties. Adversaries often create certificates with metadata that deviates from legitimate norms, such as unusually long validity periods (e.g., >20 years), weak cryptographic algorithms (e.g., MD5), or known-bad issuer/subject strings. Applying a ruleset like YARA to certificate metadata can effectively flag these suspicious indicators."
    answer_sources:
      - "Sysmon Event ID 1"
      - "Zeek pe.log"
      - "Endpoints and servers where binaries are executed"
      - "Network chokepoints where files are transferred (e.g., web proxies, email gateways)"
      - "Centralized file repositories and shares."
    range: "last 90 days"
    queries:
      - pseudocode: "FOR each signed binary execution, APPLY YARA ruleset to certificate metadata. ALERT on rule match for bad strings, long validity, or weak crypto."
  - question: "Do any signing certificates exhibit unusually high or low randomness in their Subject or Issuer fields?"
    context: "This question uses information theory to detect algorithmically generated or carelessly created certificate metadata. High entropy (randomness) in the Subject or Issuer fields may indicate the use of a Domain Generation Algorithm (DGA) for creating unique names, a common malware technique. Conversely, very low entropy can indicate generic, empty, or default values. Flagging certificates in the top or bottom 5th percentile for entropy, especially if self-signed, helps uncover these outliers."
    answer_sources:
      - "Sysmon Event ID 1"
      - "Zeek pe.log"
      - "Endpoints and servers where binaries are executed"
      - "Network chokepoints where files are transferred (e.g., web proxies, email gateways)"
      - "Centralized file repositories and shares."
    range: "last 90 days"
    queries:
      - pseudocode: "FOR each new certificate, CALCULATE Shannon entropy of 'Subject' and 'Issuer'. IF entropy in top 5th or bottom 5th percentile, FLAG for review."
  - question: "Are there any signing certificates that are statistical outliers compared to a baseline of known-good certificates?"
    context: "This question leverages anomaly detection to find suspicious certificates that don't match specific rules but differ from the norm. By training a model (like an Isolation Forest) on the metadata of legitimate, common software in the environment, we can create a profile of 'normal.' Any new certificate that significantly deviates from this profile, based on features like validity period, key length, and subject/issuer entropy, is flagged as an anomaly requiring investigation."
    answer_sources:
      - "Sysmon Event ID 1"
      - "Zeek pe.log"
      - "Endpoints and servers where binaries are executed"
      - "Network chokepoints where files are transferred (e.g., web proxies, email gateways)"
      - "Centralized file repositories and shares."
    range: "last 90 days"
    queries:
      - pseudocode: "EXTRACT feature set from new certificate metadata. APPLY Isolation Forest model. IF anomaly score is high, FLAG as suspicious."
  - question: "Are any processes being executed from binaries that are self-signed and contain generic keywords?"
    context: "This question targets a common tactic used by developers of potentially unwanted programs (PUPs) or malware, where they use self-signed certificates with generic or placeholder information. An alert should be triggered when a binary is executed where the certificate's Issuer and Subject fields are identical, and the subject contains non-specific terms like 'Test', 'Developer', or is empty. This helps filter out more legitimate self-signed certificates from suspicious ones."
    answer_sources:
      - "Sysmon Event ID 1"
      - "Zeek pe.log"
      - "All managed endpoints and servers"
      - "Network egress points monitoring file transfers"
      - "Software distribution points (e.g., SCCM, Intune)."
    range: "last 90 days"
    queries:
      - pseudocode: "SEARCH for process executions where cert.Issuer == cert.Subject AND cert.Subject CONTAINS ('Test', 'Developer', NULL)."
  - question: "Is a binary being executed that is signed by a certificate from a completely new or extremely rare issuer?"
    context: "This question helps identify threats from novel sources. Adversaries may acquire or create certificates from new or obscure certificate authorities. By maintaining a baseline of all certificate issuers seen in the environment, we can immediately identify when a binary is signed by a brand-new issuer. This, or an issuer with a very low prevalence (e.g., bottom 5th percentile), significantly increases the risk score of the event, as it's unlikely to be from a mainstream, trusted software vendor."
    answer_sources:
      - "Sysmon Event ID 1"
      - "Zeek pe.log"
      - "All managed endpoints and servers"
      - "Network egress points monitoring file transfers"
      - "Software distribution points (e.g., SCCM, Intune)."
    range: "last 90 days"
    queries:
      - pseudocode: "FOR each executed binary's certificate, CHECK issuer against historical baseline. IF issuer is new OR prevalence is in bottom 5th percentile, INCREASE risk score."
  - question: "Does a newly observed certificate deviate from a model trained exclusively on known-good, common enterprise software certificates?"
    context: "This question uses a highly tailored machine learning approach to detect suspicious certificates. A one-class SVM model is trained on the characteristics of certificates from trusted, frequently used applications within the organization. This creates a tight boundary defining 'normal.' Any new certificate that falls outside this boundary is, by definition, an outlier and likely not part of the standard software portfolio, making it a high-priority candidate for investigation."
    answer_sources:
      - "Sysmon Event ID 1"
      - "Zeek pe.log"
      - "All managed endpoints and servers"
      - "Network egress points monitoring file transfers"
      - "Software distribution points (e.g., SCCM, Intune)."
    range: "last 90 days"
    queries:
      - pseudocode: "EXTRACT feature vector from new certificate. APPLY trained one-class SVM model. IF classified as an outlier, ALERT for investigation."
  - question: "Has a single host exhibited a sudden burst of activity involving multiple unique, new, self-signed certificates?"
    context: "This question aims to detect an adversary staging multiple tools or components on a compromised host. A legitimate system will rarely, if ever, introduce numerous new self-signed certificates in a short period. A rule that alerts when a host uses more than a small threshold (e.g., 5) of unique, previously unseen, self-signed certificates within a one-hour window is a strong indicator of malicious activity, such as the deployment of a malware toolkit."
    answer_sources:
      - "Sysmon Event ID 1"
      - "Zeek pe.log"
      - "Zeek ssl.log"
      - "Enterprise-wide SIEM or data lake aggregating host and network logs."
    range: "last 90 days"
    queries:
      - pseudocode: "COUNT unique, new, self-signed certs per host in a 1-hour window. IF count > 5, ALERT."
  - question: "Has the enterprise-wide rate of new self-signed certificates appearing exceeded a statistical baseline?"
    context: "This question provides a broader, enterprise-wide view to detect widespread campaigns or environmental changes. By calculating a 30-day baseline (mean and standard deviation) for the number of new self-signed certificates observed in a 24-hour period, we can detect statistically significant spikes. A count that exceeds the mean by more than three standard deviations indicates an abnormal event that could be a coordinated attack or a misconfiguration affecting many systems."
    answer_sources:
      - "Sysmon Event ID 1"
      - "Zeek pe.log"
      - "Zeek ssl.log"
      - "Enterprise-wide SIEM or data lake aggregating host and network logs."
    range: "last 90 days"
    queries:
      - pseudocode: "COUNT new self-signed certs per 24-hour window. CALCULATE 30-day mean and stddev. IF current_count > (mean + 3*stddev), ALERT."
  - question: "Is there a time-series anomaly in the hourly count of new self-signed certificates across the enterprise?"
    context: "This question applies advanced time-series analysis to detect anomalous spikes in self-signed certificate activity that might be missed by simpler statistical methods. A model like Seasonal-Hybrid ESD can account for normal daily or weekly patterns (e.g., more activity during business hours). An alert is generated only when a spike is detected that cannot be explained by these normal trends, providing a high-fidelity signal of a potential threat."
    answer_sources:
      - "Sysmon Event ID 1"
      - "Zeek pe.log"
      - "Zeek ssl.log"
      - "Enterprise-wide SIEM or data lake aggregating host and network logs."
    range: "last 90 days"
    queries:
      - pseudocode: "APPLY Seasonal-Hybrid ESD model to hourly count of new self-signed certs. ALERT on detected anomalies."
  - question: "Is the same certificate being used to both sign a local binary and secure an outbound TLS session from the same host?"
    context: "This question seeks to identify a common malware pattern where a self-signed certificate is used to sign the malware executable and also to encrypt its command-and-control (C2) communications. Correlating process execution logs with network TLS logs to find a match between a binary's signing certificate and a server certificate for an outbound connection from the same host within a short time window is a powerful detection. This is especially suspicious if the destination IP is external and has a poor reputation."
    answer_sources:
      - "Sysmon Event ID 1"
      - "Zeek ssl.log"
      - "Zeek conn.log"
      - "SIEM or data lake capable of correlating host-based process execution data with network session data."
    range: "last 90 days"
    queries:
      - pseudocode: "JOIN process_events with tls_events on hostname within 5 mins. ALERT if process_cert_thumbprint == tls_server_cert_thumbprint AND destination_ip is external/low-rep."
  - question: "Are we observing a rare combination of process name, certificate issuer, and destination network (ASN)?"
    context: "This question uses statistical analysis to find anomalous correlations between process, certificate, and network activity. Most legitimate software has predictable patterns (e.g., chrome.exe, signed by Google, connecting to Google's ASN). By baselining common combinations of (process, issuer, destination ASN), we can flag any new, rare tuple that falls in the lowest 1st percentile of frequency. This points to unusual behavior that warrants investigation."
    answer_sources:
      - "Sysmon Event ID 1"
      - "Zeek ssl.log"
      - "Zeek conn.log"
      - "SIEM or data lake capable of correlating host-based process execution data with network session data."
    range: "last 90 days"
    queries:
      - pseudocode: "CREATE tuples of (process_name, cert_issuer, dest_ASN). BASELINE frequency of tuples. ALERT if a new tuple's frequency is in the bottom 1st percentile."
  - question: "Can we detect suspicious C2 activity by modeling host and network events as a graph?"
    context: "This question applies graph analysis to uncover complex relationships indicative of C2 activity. By representing processes, certificates, and IPs as nodes in a graph, we can use algorithms to find unusual structures. A small, tightly connected cluster of nodes that includes a process, a self-signed certificate, and a rare external IP address is a strong visual and analytical signal of a malicious C2 channel, distinct from the large, sprawling graphs of benign activity."
    answer_sources:
      - "Sysmon Event ID 1"
      - "Zeek ssl.log"
      - "Zeek conn.log"
      - "SIEM or data lake capable of correlating host-based process execution data with network session data."
    range: "last 90 days"
    queries:
      - pseudocode: "MODEL events in a graph database. RUN community detection algorithm. INVESTIGATE small, outlier clusters connecting a process, self-signed cert, and rare external IP."