name: T1587.002: Code Signing Certificates
id: f47ac10b-58cc-4372-a567-0e02b2c3d479
description: This playbook helps investigate whether an adversary is developing or using self-signed or suspicious code signing certificates for execution or persistence. It focuses on identifying certificates that match threat intelligence, are being improperly added to trusted stores, contain suspicious metadata (e.g., high entropy, long validity periods), are self-signed or issued by a rare entity, appear in sudden bursts, or are used to both sign local malware and secure its C2 communications.
type: technique
related:
  - TA0042: Resource Development
contributors:
  - Zachary Szewczyk
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Are any executed binaries or observed TLS sessions using a certificate with a thumbprint that matches a known-malicious entry in our threat intelligence feeds?
    context: This question aims to leverage cyber threat intelligence (CTI) to find high-confidence indicators of compromise. A match between an observed certificate thumbprint from a running process or network session and a known-malicious thumbprint from a CTI feed strongly suggests that a malicious file is active in the environment.
    answer_sources:
      - Sysmon Event ID 1
      - Zeek ssl.log
      - Zeek pe.log
      - SIEM/Data Lake aggregating endpoint and network telemetry
      - Network sensors at internet egress points
      - All endpoints with process and signature monitoring.
    range: last 90 days
    queries:
      - pseudocode: SEARCH process_execution_logs OR network_tls_logs WHERE certificate_thumbprint IN (threat_intel_feed_of_thumbprints)
  - question: For a certificate identified as malicious by CTI, is its issuer rarely seen in our environment?
    context: This question adds risk context to a CTI match. If a malicious certificate was issued by an entity that is extremely rare or new to the environment (e.g., in the bottom 1st percentile of all issuers), it heightens the suspicion. This could indicate a targeted attack or a newly established malicious infrastructure, warranting an escalated response.
    answer_sources:
      - Sysmon Event ID 1
      - Zeek ssl.log
      - Zeek pe.log
      - SIEM/Data Lake aggregating endpoint and network telemetry
      - Network sensors at internet egress points
      - All endpoints with process and signature monitoring.
    range: last 90 days
    queries:
      - pseudocode: GIVEN a malicious_thumbprint, FIND issuer. THEN SEARCH all_certificate_logs | STATS count by issuer | COMPARE target_issuer_count to distribution of all issuer_counts to identify percentile.
  - question: Is there a statistically significant spike in the daily number of new CTI-matched certificate detections?
    context: This question shifts the focus from individual detections to trend analysis. A sudden, anomalous increase in the volume of detections for CTI-matched certificates can signal a widespread, coordinated campaign against the organization. Answering this helps determine if an incident is isolated or part of a larger attack.
    answer_sources:
      - Sysmon Event ID 1
      - Zeek ssl.log
      - Zeek pe.log
      - SIEM/Data Lake aggregating endpoint and network telemetry
      - Network sensors at internet egress points
      - All endpoints with process and signature monitoring.
    range: last 90 days
    queries:
      - pseudocode: SEARCH certificate_logs WHERE thumbprint IN (cti_feed) | timechart count by day | APPLY anomaly_detection_model to identify spikes exceeding confidence intervals.
  - question: Has any user or process attempted to add a new certificate to a trusted root or publisher certificate store using utilities like certutil.exe or PowerShell?
    context: This question looks for a common defense evasion and persistence technique. Adversaries install their own malicious certificates into trusted stores so that their malware and network connections are implicitly trusted by the operating system, bypassing security warnings and controls. Monitoring for the specific commands used to perform this action is critical.
    answer_sources:
      - Sysmon Event ID 1
      - Windows Event ID 4688
      - Windows Event ID 4104
      - Windows endpoints and servers
      - Domain Controllers
      - Public Key Infrastructure (PKI) servers
      - developer workstations.
    range: last 90 days
    queries:
      - pseudocode: SEARCH command_line_logs OR powershell_logs FOR command_line CONTAINS ('certutil -addstore Root' OR 'certutil -addstore TrustedPublisher' OR 'Import-Certificate...Cert:\\LocalMachine\\Root').
  - question: Was a certificate store modification performed by a user or on a host that does not typically perform such administrative actions?
    context: This question aims to separate legitimate administrative activity from suspicious behavior. While system administrators modify certificate stores, it is highly anomalous for a standard user account or a non-administrative server to do so. By baselining this activity, analysts can focus on modifications made by entities for whom this is a rare or unprecedented action.
    answer_sources:
      - Sysmon Event ID 1
      - Windows Event ID 4688
      - Windows Event ID 4104
      - Windows endpoints and servers
      - Domain Controllers
      - Public Key Infrastructure (PKI) servers
      - developer workstations.
    range: last 90 days
    queries:
      - pseudocode: GIVEN a cert_store_modification_event, IDENTIFY user and host. THEN SEARCH historical_logs | STATS count of modification_events by user, host | ALERT if event_user_host is not in top 5% of actors.
  - question: Can we classify a given certificate management command as suspicious based on its features, such as arguments, command length, and user context?
    context: This question proposes a machine learning approach to improve detection fidelity. Instead of relying on simple string matches, a model can be trained to recognize the nuanced patterns of malicious commands versus benign ones by analyzing a combination of features. This helps to identify novel malicious command variations and reduce false positives from legitimate administrative scripts.
    answer_sources:
      - Sysmon Event ID 1
      - Windows Event ID 4688
      - Windows Event ID 4104
      - Windows endpoints and servers
      - Domain Controllers
      - Public Key Infrastructure (PKI) servers
      - developer workstations.
    range: last 90 days
    queries:
      - pseudocode: EXTRACT features (command_length, user_role, arguments) from command_line_event | APPLY classification_model | ALERT if classification is 'suspicious'.
  - question: Is an executed binary signed with a certificate containing suspicious metadata, such as known-bad issuer strings, an unusually long validity period, or weak cryptographic algorithms?
    context: This question focuses on identifying low-quality or fraudulent certificates often used by adversaries. Legitimate certificates follow certain standards, whereas malicious ones often have tell-tale flaws like absurdly long validity periods (e.g., >20 years), use of deprecated algorithms (e.g., MD5), or issuer names associated with malware campaigns.
    answer_sources:
      - Sysmon Event ID 1
      - Zeek pe.log
      - Endpoints and servers where binaries are executed
      - Network chokepoints where files are transferred
      - Centralized file repositories and shares.
    range: last 90 days
    queries:
      - pseudocode: FOR each process_execution_with_signature, EXTRACT certificate_metadata | APPLY ruleset (YARA) for suspicious patterns (e.g., validity > 20 years, algo = MD5) | ALERT on match.
  - question: Does a newly observed signing certificate have a Subject or Issuer name that is either highly random or suspiciously generic/empty?
    context: This question probes the quality of the certificate's identity fields. Adversaries may use randomly generated strings (high entropy) for subject/issuer names to avoid signature-based detection, or they may be lazy and use generic/empty fields (low entropy). Both extremes are deviations from the norm of legitimate, descriptive certificate fields and are therefore suspicious.
    answer_sources:
      - Sysmon Event ID 1
      - Zeek pe.log
      - Endpoints and servers where binaries are executed
      - Network chokepoints where files are transferred
      - Centralized file repositories and shares.
    range: last 90 days
    queries:
      - pseudocode: FOR each new_certificate, CALCULATE entropy of Subject and Issuer fields | COMPARE scores to historical distribution | ALERT if score is in top 5th percentile (random) or bottom 5th percentile (generic).
  - question: Does a signing certificate have a combination of metadata features that makes it an outlier compared to known-good certificates in the environment?
    context: This question suggests using an anomaly detection model for a holistic assessment of a certificate. A certificate might not have a single definitive "bad" feature, but its combination of properties (validity period, key length, entropy, etc.) may make it a statistical outlier when compared to the population of known-good certificates. This can uncover novel or sophisticated malicious certificates.
    answer_sources:
      - Sysmon Event ID 1
      - Zeek pe.log
      - Endpoints and servers where binaries are executed
      - Network chokepoints where files are transferred
      - Centralized file repositories and shares.
    range: last 90 days
    queries:
      - pseudocode: EXTRACT feature_vector (validity_duration, key_length, entropy, etc.) from certificate | APPLY anomaly_detection_model (e.g., Isolation Forest) | ALERT on high anomaly_score.
  - question: Has a process been executed from a binary signed with a self-signed certificate that also contains generic or empty keywords in its Subject field?
    context: This question looks for a combination of suspicious traits. While self-signed certificates have legitimate uses, they are also a favorite of attackers. When a self-signed certificate also has a generic subject name like 'Test' or 'Developer', it strongly indicates it was created hastily for malicious purposes rather than for a legitimate development reason.
    answer_sources:
      - Sysmon Event ID 1
      - Zeek pe.log
      - All managed endpoints and servers
      - Network egress points monitoring file transfers
      - Software distribution points.
    range: last 90 days
    queries:
      - pseudocode: SEARCH process_execution_logs WHERE certificate_issuer == certificate_subject AND certificate_subject_cn IN ('Test', 'Developer', 'Example', NULL).
  - question: Is an executed binary signed by a certificate from an issuer that is either brand new to the environment or extremely rare?
    context: This question assesses the reputation of a certificate's issuer within the context of the environment. Most legitimate software is signed by well-known, frequently seen issuers. A certificate from an issuer that has never been seen before, or is seen very infrequently, carries a higher risk because its trustworthiness has not been established.
    answer_sources:
      - Sysmon Event ID 1
      - Zeek pe.log
      - All managed endpoints and servers
      - Network egress points monitoring file transfers
      - Software distribution points.
    range: last 90 days
    queries:
      - pseudocode: GIVEN a process_execution_event with certificate_issuer, SEARCH historical_logs to check if issuer is new | IF not new, CALCULATE prevalence | INCREASE risk_score if new or low_prevalence.
  - question: Does a new certificate's properties deviate significantly from the profile of known-good certificates used within the enterprise?
    context: This question uses one-class classification to define a tight boundary around "normal" for certificates in the environment. By training a model exclusively on the features of known-good certificates, it can become highly effective at flagging any new certificate that doesn't conform to this profile as a suspicious outlier, requiring investigation.
    answer_sources:
      - Sysmon Event ID 1
      - Zeek pe.log
      - All managed endpoints and servers
      - Network egress points monitoring file transfers
      - Software distribution points.
    range: last 90 days
    queries:
      - pseudocode: EXTRACT feature_vector from new_certificate | APPLY one-class_SVM_model trained on known-good certs | ALERT if classified as outlier.
  - question: Has a single host rapidly started using multiple, unique, and previously unseen self-signed certificates in a short period of time?
    context: This question looks for a burst of suspicious activity on a single host. A single machine suddenly executing processes signed by, or making TLS connections with, numerous new self-signed certificates in a short window is highly anomalous. This behavior can indicate a compromised host where an attacker is deploying several tools or backdoors.
    answer_sources:
      - Sysmon Event ID 1
      - Zeek pe.log
      - Zeek ssl.log
      - Enterprise-wide SIEM or data lake aggregating host and network logs.
    range: last 90 days
    queries:
      - pseudocode: SEARCH certificate_logs WHERE is_self_signed AND is_new | STATS distinct_count(certificate_thumbprint) by host over 1_hour window | ALERT if distinct_count > 5.
  - question: Is there a statistically significant, enterprise-wide increase in the number of new self-signed certificates being observed compared to a historical baseline?
    context: This question elevates the scope from a single host to the entire enterprise, looking for a macro-level anomaly. A sudden, statistically significant increase in the appearance of new self-signed certificates across the organization (e.g., exceeding 3 standard deviations from the mean) could indicate a widespread malware campaign.
    answer_sources:
      - Sysmon Event ID 1
      - Zeek pe.log
      - Zeek ssl.log
      - Enterprise-wide SIEM or data lake aggregating host and network logs.
    range: last 90 days
    queries:
      - pseudocode: SEARCH certificate_logs WHERE is_self_signed AND is_new | timechart count over 24h | APPLY 3-sigma_check against 30-day baseline.
  - question: Does a time series analysis of the hourly count of new self-signed certificates reveal an anomalous spike that cannot be explained by normal patterns?
    context: This question applies more advanced statistical modeling to detect enterprise-wide anomalies. A sophisticated time-series model can account for normal business periodicities (e.g., time of day, day of week) and identify spikes in new self-signed certificates that are truly anomalous, reducing false positives from normal fluctuations.
    answer_sources:
      - Sysmon Event ID 1
      - Zeek pe.log
      - Zeek ssl.log
      - Enterprise-wide SIEM or data lake aggregating host and network logs.
    range: last 90 days
    queries:
      - pseudocode: SEARCH certificate_logs WHERE is_self_signed AND is_new | timechart count by 1h | APPLY seasonal_time_series_anomaly_detection_model.
  - question: Has a certificate used to sign a locally executed binary also been used as the server certificate for an outbound network connection from the same host?
    context: This question seeks to find a powerful correlation that is a strong indicator of a command-and-control (C2) channel. When an attacker reuses the same certificate to sign their implant (the local binary) and to secure their C2 server (the remote end of the TLS session), it directly links the malicious process to its C2 infrastructure.
    answer_sources:
      - Sysmon Event ID 1
      - Zeek ssl.log
      - Zeek conn.log
      - SIEM or data lake capable of correlating host-based process execution data with network session data.
    range: last 90 days
    queries:
      - pseudocode: JOIN process_execution_logs ON host, time_window WITH network_tls_logs ON host, time_window WHERE process.certificate_thumbprint == tls.server_certificate_thumbprint.
  - question: Does a correlation between a process, its signing certificate issuer, and a destination network Autonomous System (AS) represent a rare or never-before-seen combination?
    context: This question looks for anomalous relationships between process, identity, and destination. Certain combinations are normal (e.g., a Microsoft-signed process talking to a Microsoft ASN). This query aims to find outliers, such as a process signed by a rare issuer communicating with an IP in an unexpected ASN (e.g., a residential ISP), which is highly suspicious.
    answer_sources:
      - Sysmon Event ID 1
      - Zeek ssl.log
      - Zeek conn.log
      - SIEM or data lake capable of correlating host-based process execution data with network session data.
    range: last 90 days
    queries:
      - pseudocode: FOR each correlated_event, create tuple (process_name, issuer, dest_ASN) | CALCULATE frequency of tuple in historical data | ALERT if frequency is in lowest 1st percentile.
  - question: Can graph analysis reveal isolated clusters of activity connecting a process, a self-signed certificate, and a rare external IP address, indicating potential C2 communication?
    context: This question describes an advanced threat hunting technique using graph databases. By modeling entities (processes, certs, IPs) and their relationships, community detection algorithms can automatically surface small, isolated groups of activity. A newly formed cluster linking a process, a self-signed cert, and a rare external IP is a classic pattern for a C2 channel trying to blend in.
    answer_sources:
      - Sysmon Event ID 1
      - Zeek ssl.log
      - Zeek conn.log
      - SIEM or data lake capable of correlating host-based process execution data with network session data.
    range: last 90 days
    queries:
      - pseudocode: LOAD process, certificate, IP events into graph_database | RUN community_detection_algorithm | IDENTIFY and ALERT on small, isolated clusters connecting a process, a self-signed cert, and a rare external IP.