name: 'T1481.002: Bidirectional Communication'
id: 'a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d'
description: "This playbook helps investigate whether an adversary is using a legitimate external web service for command and control of a compromised mobile device. Indicators include periodic 'heartbeat' connections, anomalous data transfer volumes or ratios, high-entropy URIs, non-standard User-Agent strings, and mobile applications making network connections to services that are statistically rare for their application category or user role."
type: 'technique'
related: 
  - 'TA0037: Command And Control'
contributors:
  - 'Zachary Szewczyk, Ask Sage'
created: '2025-10-01'
modified: '2025-10-01'
version: 1.0
tags: 'none'
questions:
  - question: 'Is a mobile device connecting to a domain, subdomain, or IP address known to be abused for C2 via legitimate services?'
    context: "This question aims to identify direct connections to known-bad infrastructure masquerading as legitimate services. A match against a threat intelligence feed is a strong indicator of compromise, suggesting an adversary is leveraging a known C2 channel."
    answer_sources:
      - 'Zeek conn.log'
      - 'Zeek ssl.log'
      - 'Network security monitoring sensors at internet gateways, corporate Wi-Fi gateways, VPN concentrators, and Cloud Access Security Broker (CASB) or Unified Endpoint Management (UEM) log sources where mobile device traffic is observable.'
    range: 'Last 90 days'
    queries:
      - 'pseudocode': 'SEARCH Zeek logs (conn.log, ssl.log) JOINED on uid WHERE source_ip IN mobile_device_segments AND (destination_ip IN c2_ip_feed OR server_name IN c2_domain_feed)'
  - question: 'Is a mobile device exhibiting C2-like beaconing behavior or anomalous data transfer volumes to a specific service?'
    context: "This question looks for two common C2 patterns: automated, periodic 'heartbeat' connections (beaconing) and unusually large data transfers. A low standard deviation in connection timing suggests automation, while a significant spike in data volume compared to a historical baseline can indicate data exfiltration or payload delivery."
    answer_sources:
      - 'Zeek conn.log'
      - 'Zeek ssl.log'
      - 'Network security monitoring sensors at internet gateways, corporate Wi-Fi gateways, VPN concentrators, and Cloud Access Security Broker (CASB) or Unified Endpoint Management (UEM) log sources where mobile device traffic is observable.'
    range: 'Last 90 days'
    queries:
      - 'pseudocode': 'FOR each source_ip, destination_service pair: CALCULATE 30-day baseline stats (bytes, frequency). ALERT if current_connection_bytes > 99th_percentile_baseline OR stddev(inter_arrival_time) < 1s over 10min_window'
  - question: "Has a mobile device's data traffic to a specific service deviated significantly from its historically predicted pattern?"
    context: "This question uses time-series analysis to detect subtle anomalies in traffic volume that simpler thresholding might miss. By modeling normal daily and weekly patterns, the system can identify statistically significant deviations that could represent C2 activity, even if the absolute data volume is not extreme."
    answer_sources:
      - 'Zeek conn.log'
      - 'Zeek ssl.log'
      - 'Network security monitoring sensors at internet gateways, corporate Wi-Fi gateways, VPN concentrators, and Cloud Access Security Broker (CASB) or Unified Endpoint Management (UEM) log sources where mobile device traffic is observable.'
    range: 'Last 90 days'
    queries:
      - 'pseudocode': "FOR each device_service pair: TRAIN time-series model on 30-day history of 5-min aggregated traffic volume. ALERT if live_traffic_volume > 99%_prediction_interval_of_model"
  - question: 'Is a mobile device making HTTP/S requests with URIs or User-Agent strings matching known malicious patterns?'
    context: "This question targets known indicators of compromise embedded within HTTP/S traffic. Malware often uses specific, recognizable patterns in URIs for command and control or employs custom/unusual User-Agent strings. Matching against a curated list of these patterns provides a high-confidence signal of malicious activity."
    answer_sources:
      - 'Zeek http.log'
      - 'Zeek ssl.log'
      - 'Zeek dns.log'
      - 'SSL/TLS-inspecting forward proxies, corporate DNS servers, and other network traffic inspection points capable of decrypting and logging HTTP/S metadata.'
    range: 'Last 90 days'
    queries:
      - 'pseudocode': 'SEARCH decrypted http.log WHERE uri MATCHES malicious_c2_regex_ruleset OR user_agent IN known_bad_user_agent_list'
  - question: 'Is a mobile device sending HTTP/S requests with unusually complex/random URIs or statistically rare User-Agent strings for a given service?'
    context: "This question seeks to identify C2 communication that uses randomization to evade signature-based detection. High entropy (randomness) in a URI can indicate encoded data being sent to a C2 server. Similarly, a User-Agent that is rarely seen for a particular service can suggest a custom client or tool rather than a standard browser or application."
    answer_sources:
      - 'Zeek http.log'
      - 'Zeek ssl.log'
      - 'Zeek dns.log'
      - 'SSL/TLS-inspecting forward proxies, corporate DNS servers, and other network traffic inspection points capable of decrypting and logging HTTP/S metadata.'
    range: 'Last 90 days'
    queries:
      - 'pseudocode': 'FOR each destination_service: CALCULATE baseline URI entropy and User-Agent prevalence. ALERT if shannon_entropy(uri) > 3_std_dev_from_mean OR shannon_entropy(uri) > 4.5 OR prevalence(user_agent) < 0.1%'
  - question: 'Does an HTTP/S request from a mobile device have characteristics that a machine learning model classifies as malicious?'
    context: "This question leverages a machine learning model to perform a more sophisticated, multi-faceted analysis of HTTP requests. By training on features like URI length, character types, and entropy from known good and bad examples, the model can learn to identify complex C2 patterns that are difficult to define with simple rules or thresholds."
    answer_sources:
      - 'Zeek http.log'
      - 'Zeek ssl.log'
      - 'Zeek dns.log'
      - 'SSL/TLS-inspecting forward proxies, corporate DNS servers, and other network traffic inspection points capable of decrypting and logging HTTP/S metadata.'
    range: 'Last 90 days'
    queries:
      - 'pseudocode': 'FOR each http_request: EXTRACT features (URI_length, param_count, non_alphanum_%, entropy). SCORE with trained classification model. ALERT if malicious_confidence_score > 0.9'
  - question: 'Is a sensitive or high-risk mobile application communicating with an unapproved network destination?'
    context: "This question enforces a strict, policy-based control (allowlisting) on sensitive applications. By defining a limited set of legitimate destinations for an app, any deviation from this baseline is a clear policy violation and a strong indicator of potential misuse or compromise, such as data exfiltration to an unauthorized service."
    answer_sources:
      - 'Mobile Device Management (MDM/UEM) logs'
      - 'Zeek conn.log'
      - 'Zeek ssl.log'
      - 'HR Information System Data'
      - 'Managed mobile device endpoints via MDM/UEM agents, MDM/UEM management consoles, and network chokepoints like corporate Wi-Fi gateways or Cloud Access Security Brokers (CASBs).'
    range: 'Last 90 days'
    queries:
      - 'pseudocode': 'JOIN MDM/UEM logs with Zeek ssl.log. FOR high_risk_apps: ALERT if destination_service NOT IN app_whitelist'
  - question: 'Is a mobile application connecting to a network service that is statistically rare for its application category?'
    context: "This question seeks to identify anomalous behavior by comparing an application's network activity to that of its peers. For example, a calculator application connecting to a code repository like GitHub is highly unusual and suspicious. This approach finds outliers without needing pre-defined rules for every application."
    answer_sources:
      - 'Mobile Device Management (MDM/UEM) logs'
      - 'Zeek conn.log'
      - 'Zeek ssl.log'
      - 'HR Information System Data'
      - 'Managed mobile device endpoints via MDM/UEM agents, MDM/UEM management consoles, and network chokepoints like corporate Wi-Fi gateways or Cloud Access Security Brokers (CASBs).'
    range: 'Last 90 days'
    queries:
      - 'pseudocode': 'FOR each app_category: PROFILE destination_service prevalence over 30 days. FOR each new connection: ALERT if prevalence(destination_service, app_category) < 1%'
  - question: 'Is a mobile application connecting to a service that belongs to a different "community" of applications and services?'
    context: "This question uses graph analysis to uncover the underlying structure of application and service interactions. By identifying clusters (communities) of related entities, it can flag connections that bridge these communities, representing highly anomalous behavior (e.g., a 'Productivity' app connecting to a 'Gaming Services' community). This can detect novel threats that don't fit established patterns."
    answer_sources:
      - 'Mobile Device Management (MDM/UEM) logs'
      - 'Zeek conn.log'
      - 'Zeek ssl.log'
      - 'HR Information System Data'
      - 'Managed mobile device endpoints via MDM/UEM agents, MDM/UEM management consoles, and network chokepoints like corporate Wi-Fi gateways or Cloud Access Security Brokers (CASBs).'
    range: 'Last 90 days'
    queries:
      - 'pseudocode': 'CREATE bipartite graph of apps and services. RUN community detection algorithm. ALERT if an app connects to a service outside its primary community.'