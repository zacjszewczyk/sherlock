name: T1597.002: Purchase Technical Data
id: 6f4a8b1c-3d2e-4f5a-8b9c-1d2e3f4a5b6c
description: This playbook helps determine if an adversary has purchased technical data (e.g., credentials, infrastructure details) and is using it for reconnaissance or initial access. It focuses on detecting anomalies such as authentication attempts using known breached credentials, spikes in network scanning following threat intelligence reports of data sales, targeted port probing indicated by low entropy, impossible travel logins, exploit attempts against non-public applications, and anomalous data egress from cloud environments after a suspicious login.
type: technique
related:
  - TA0043: Reconnaissance
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
investigative_questions:
  - question: Is an adversary attempting to authenticate using credentials known to be compromised from a data breach?
    context: This question aims to directly identify credential stuffing or reuse attacks by matching usernames from both successful and failed login events against a continuously updated threat intelligence feed of breached credentials. A match provides a high-fidelity indicator that an adversary is leveraging purchased or publicly available data.
    answer_sources:
      - Windows Event ID 4624
      - Windows Event ID 4625
      - Threat Intelligence Feed (Breached Credentials)
      - Authentication servers (Domain Controllers, ADFS)
      - VPN Concentrators
      - Cloud Identity Providers (e.g., Azure AD)
    range: last 90 days
    queries:
      - pseudocode: SEARCH authentication logs (success and failure) WHERE username IN (breached_credential_list) | ALERT
  - question: Is a user account from a known data breach being targeted by a password spraying attack?
    context: Once an account is identified on a breach list, this question seeks to determine if it is under active attack. By analyzing the frequency of failed logins from distinct source IPs for that user, we can statistically identify password spraying, which manifests as a high volume of failed attempts from many sources, differentiating it from a user simply forgetting their password.
    answer_sources:
      - Windows Event ID 4624
      - Windows Event ID 4625
      - Threat Intelligence Feed (Breached Credentials)
      - Authentication servers (Domain Controllers, ADFS)
      - VPN Concentrators
      - Cloud Identity Providers (e.g., Azure AD)
    range: last 90 days
    queries:
      - pseudocode: SEARCH failed authentication logs FOR users IN (breached_credential_list) | GROUPBY user, source_ip | CALCULATE daily_failed_logins | COMPARE to 95th_percentile_threshold | ALERT if exceeded
  - question: Can we proactively identify a successful but malicious login from a compromised account using behavioral analysis?
    context: This question addresses the scenario where an adversary has a valid credential. It uses a machine learning model to classify successful logins as 'benign' or 'suspicious' based on behavioral and contextual features like time of day, IP geolocation, and whether the account is on a breach list. This allows for the detection of a successful but illegitimate login.
    answer_sources:
      - Windows Event ID 4624
      - Windows Event ID 4625
      - Threat Intelligence Feed (Breached Credentials)
      - Authentication servers (Domain Controllers, ADFS)
      - VPN Concentrators
      - Cloud Identity Providers (e.g., Azure AD)
    range: last 90 days
    queries:
      - pseudocode: INPUT successful_login_event_features (time, geo, asn, is_breached) INTO logistic_regression_model | IF classification is 'suspicious' AND confidence > 0.8 | ALERT
  - question: Are we observing network scanning or authentication failures from indicators of compromise (IOCs) mentioned in a recent threat intelligence report about our data being for sale?
    context: This question provides a method for rapid response to specific threat intelligence. Upon learning that organizational data is for sale, this query directly searches for any network or authentication activity originating from the specific IPs or domains listed as IOCs in the intelligence report, enabling a direct correlation between the report and observed hostile activity.
    answer_sources:
      - Zeek conn.log
      - Windows Event ID 4625
      - Threat Intelligence Report
      - Internet Gateways
      - Demilitarized Zone (DMZ) Servers
      - Threat Intelligence Platforms
    range: 7-day window following a threat intelligence report
    queries:
      - pseudocode: SEARCH network_connections AND failed_authentications in the last 7 days | WHERE source_ip IN (threat_report_IOC_list) | ALERT
  - question: Is there a statistically significant increase in scanning or failed logins shortly after a threat intelligence report was received?
    context: This question seeks to detect follow-on adversary activity that may not use the exact IOCs from a threat report. By employing change point detection on baselines of connection attempts and login failures, it can identify a statistically significant shift in activity that occurs within 72 hours of an intelligence trigger, indicating a likely but un-attributed reconnaissance effort.
    answer_sources:
      - Zeek conn.log
      - Windows Event ID 4625
      - Threat Intelligence Report
      - Internet Gateways
      - Demilitarized Zone (DMZ) Servers
      - Threat Intelligence Platforms
    range: last 90 days
    queries:
      - pseudocode: INPUT time_series_of_connection_attempts AND failed_logins TO CUSUM_algorithm | IF change_point_detected within 72_hours_of_TI_report | ALERT
  - question: Does the volume of scanning traffic or authentication failures exceed forecasted levels following a threat intelligence trigger?
    context: This question uses predictive modeling to identify anomalous activity. A time-series forecasting model (SARIMA) predicts the expected volume of normal network traffic and login failures. An alert is generated if the observed volume significantly and persistently exceeds the model's predicted upper bounds, suggesting an abnormal event potentially linked to a recent intelligence report.
    answer_sources:
      - Zeek conn.log
      - Windows Event ID 4625
      - Threat Intelligence Report
      - Internet Gateways
      - Demilitarized Zone (DMZ) Servers
      - Threat Intelligence Platforms
    range: last 90 days
    queries:
      - pseudocode: COMPARE observed_traffic_volume with SARIMA_forecast_prediction | IF observed > upper_99_percent_confidence_interval for > 1_hour | ALERT
  - question: Is an external entity attempting to connect to non-public internal ports?
    context: This question helps detect initial reconnaissance scans by using a simple, rule-based approach. It leverages an asset inventory to maintain a list of known, public-facing ports. Any successful connection from an external source to an internal port not on this approved list is flagged as a potential unauthorized probe of non-public services.
    answer_sources:
      - Zeek conn.log
      - Asset Inventory Database
      - Windows Event ID 3
      - Network Taps at Internet Egress/Ingress Points
      - Firewall Log Aggregators
      - Critical Servers
    range: last 90 days
    queries:
      - pseudocode: SEARCH successful_external_connections | WHERE destination_port NOT IN (public_services_list) | ALERT
  - question: Is an external IP address exhibiting targeted port scanning behavior rather than random background noise?
    context: This question differentiates between random internet scanning and a deliberate reconnaissance scan. By calculating the Shannon entropy of destination ports from a single source IP, we can quantify the randomness of its activity. A low entropy score indicates the IP is focusing on a small, specific set of ports, which is characteristic of a targeted scan.
    answer_sources:
      - Zeek conn.log
      - Asset Inventory Database
      - Windows Event ID 3
      - Network Taps at Internet Egress/Ingress Points
      - Firewall Log Aggregators
      - Critical Servers
    range: last 90 days
    queries:
      - pseudocode: FOR each source_IP | CALCULATE shannon_entropy of destination_ports in 5_min_window | IF entropy < 5th_percentile_of_baseline | ALERT
  - question: Can we identify coordinated, anomalous scanning activity by clustering connection events?
    context: This question aims to find coordinated reconnaissance that might be missed by single-IP analysis. By using a clustering algorithm like DBSCAN, connection events are grouped by similarity. Small, dense clusters that are distinct from the large cluster of 'normal' internet background noise often represent a coordinated scan from multiple sources targeting specific assets.
    answer_sources:
      - Zeek conn.log
      - Asset Inventory Database
      - Windows Event ID 3
      - Network Taps at Internet Egress/Ingress Points
      - Firewall Log Aggregators
      - Critical Servers
    range: last 90 days
    queries:
      - pseudocode: INPUT connection_events_features TO DBSCAN_algorithm | IDENTIFY and investigate small, dense clusters flagged as outliers | ALERT
  - question: Is a user successfully authenticating from a high-risk or non-business-related geographic location?
    context: This question provides a basic but useful layer of security by flagging logins from geographies where the organization has no business presence. While it can generate false positives (e.g., from VPNs or employee travel), it serves as a low-fidelity indicator that an account may be accessed from an unauthorized location, warranting further scrutiny.
    answer_sources:
      - Windows Event ID 4624
      - Zeek conn.log
      - IP Geolocation Database
      - Cloud Provider Audit Logs
      - Authentication Servers (Domain Controllers)
      - VPN Concentrators
      - Network Flow Collectors
      - Cloud Identity Providers (e.g., Azure AD)
    range: last 90 days
    queries:
      - pseudocode: ENRICH successful_login with source_IP_geolocation | IF source_country IN (denylist_countries) | ALERT
  - question: Has a user account logged in from two locations in a time frame that would require physically impossible travel speeds?
    context: This question identifies a high-confidence indicator of account compromise. By calculating the required travel speed between the geolocations of two consecutive successful logins for the same user, an alert can be generated if the speed is physically impossible (e.g., >600 mph). This strongly suggests that at least one of the logins is fraudulent.
    answer_sources:
      - Windows Event ID 4624
      - Zeek conn.log
      - IP Geolocation Database
      - Cloud Provider Audit Logs
      - Authentication Servers (Domain Controllers)
      - VPN Concentrators
      - Network Flow Collectors
      - Cloud Identity Providers (e.g., Azure AD)
    range: last 90 days
    queries:
      - pseudocode: FOR each successful_login | GET previous_login_location_and_time | CALCULATE distance / time_difference | IF speed > 600_mph | ALERT
  - question: Is a user's login behavior a significant outlier compared to their established normal patterns?
    context: This question moves beyond simple impossible travel to a more holistic view of user behavior. By building a profile of each user's normal login patterns (e.g., source countries, ASNs, time of day), an anomaly detection model can identify any single login event that significantly deviates from this established 'normal,' providing a powerful way to spot account takeover.
    answer_sources:
      - Windows Event ID 4624
      - Zeek conn.log
      - IP Geolocation Database
      - Cloud Provider Audit Logs
      - Authentication Servers (Domain Controllers)
      - VPN Concentrators
      - Network Flow Collectors
      - Cloud Identity Providers (e.g., Azure AD)
    range: last 90 days
    queries:
      - pseudocode: INPUT new_login_event to user's Isolation_Forest_model | IF event is scored as an outlier | ALERT
  - question: Is an external entity attempting to use known exploit patterns against our identified vulnerable, non-public web services?
    context: This question focuses on detecting targeted exploitation attempts. It correlates asset and vulnerability data to identify which non-public services are vulnerable to specific exploits. It then creates highly specific detection rules to watch for traffic patterns matching those exploits directed only at those vulnerable services, reducing noise and increasing alert fidelity.
    answer_sources:
      - Zeek http.log
      - Zeek files.log
      - Zeek notice.log
      - Windows Event ID 4688
      - Vulnerability Scan Data
      - Web Application Servers (DMZ and Internal)
      - Intrusion Detection System (IDS) Sensors
      - Network Taps
    range: last 90 days
    queries:
      - pseudocode: SEARCH web_traffic_logs for known_exploit_patterns | WHERE destination_service IS on vulnerable_non_public_list AND source_is_external | ALERT
  - question: Is an adversary attempting to enumerate or access hidden or rarely used endpoints on our non-public web applications?
    context: This question helps find adversary reconnaissance against web applications, such as scans for hidden admin panels or forgotten APIs. By creating a frequency distribution of all URIs requested over a 90-day baseline, any new request to a very rare or never-before-seen URI can be flagged as a potential enumeration attempt.
    answer_sources:
      - Zeek http.log
      - Zeek files.log
      - Zeek notice.log
      - Windows Event ID 4688
      - Vulnerability Scan Data
      - Web Application Servers (DMZ and Internal)
      - Intrusion Detection System (IDS) Sensors
      - Network Taps
    range: last 90 days
    queries:
      - pseudocode: CALCULATE frequency_distribution of all URIs for a web_app | IF a new request is for a URI in the bottom 1st_percentile | ALERT
  - question: Is a user session on a web application following an anomalous navigation path indicative of reconnaissance or exploitation?
    context: This question analyzes the sequence of user actions within a web session to detect anomalous behavior. A machine learning model (LSTM autoencoder) is trained on normal user navigation patterns. An adversary probing for vulnerabilities or navigating in an illogical way will create a session sequence that the model cannot reconstruct accurately, resulting in a high error score and an alert.
    answer_sources:
      - Zeek http.log
      - Zeek files.log
      - Zeek notice.log
      - Windows Event ID 4688
      - Vulnerability Scan Data
      - Web Application Servers (DMZ and Internal)
      - Intrusion Detection System (IDS) Sensors
      - Network Taps
    range: last 90 days
    queries:
      - pseudocode: MODEL user_session as a sequence of URI_requests | INPUT sequence to LSTM_autoencoder | IF reconstruction_error is high | ALERT
  - question: Is a user who logged in from a new cloud location subsequently making DNS requests for known data exfiltration sites?
    context: This question links a suspicious cloud login with potential data exfiltration activity. It creates a correlation rule that triggers when a successful cloud login occurs from a new, unseen country or ASN, and is followed within a short time window by DNS lookups for known file-sharing or data exfil domains from the same internal IP.
    answer_sources:
      - Zeek ssl.log
      - Zeek dns.log
      - Cloud Provider Audit Logs (e.g., Azure AD Sign-in logs, AWS CloudTrail)
      - Cloud Log Aggregator (SIEM)
      - Cloud Identity Provider
      - Network Flow Collectors monitoring traffic to cloud provider IP ranges
    range: last 90 days
    queries:
      - pseudocode: ON successful_cloud_login from new_geo | MONITOR for DNS_requests for exfil_domains from same_IP within 1_hour | ALERT
  - question: Is a user exfiltrating an anomalously large amount of data from cloud storage after a suspicious login?
    context: This question aims to detect bulk data theft from cloud services. It establishes a statistical baseline for each user's normal daily data egress volume from key repositories like S3 or SharePoint. An alert is raised if a user's egress volume dramatically exceeds their historical average (e.g., by 4 standard deviations), especially if it follows an anomalous login.
    answer_sources:
      - Zeek ssl.log
      - Zeek dns.log
      - Cloud Provider Audit Logs (e.g., Azure AD Sign-in logs, AWS CloudTrail)
      - Cloud Log Aggregator (SIEM)
      - Cloud Identity Provider
      - Network Flow Collectors monitoring traffic to cloud provider IP ranges
    range: last 90 days
    queries:
      - pseudocode: CALCULATE baseline_daily_egress_volume per user | IF today's_volume > (mean + 4 * std_dev) | ALERT
  - question: Is a user's activity in the cloud significantly different from that of their role-based peers?
    context: This question detects account takeover by identifying when a user's behavior deviates from their peers. Users are clustered into groups based on their job role and typical cloud application usage. If an individual user's activity (e.g., accessing unusual services, downloading anomalous data volumes) diverges significantly from the normal behavior of their peer group, it is flagged for investigation.
    answer_sources:
      - Zeek ssl.log
      - Zeek dns.log
      - Cloud Provider Audit Logs (e.g., Azure AD Sign-in logs, AWS CloudTrail)
      - Cloud Log Aggregator (SIEM)
      - Cloud Identity Provider
      - Network Flow Collectors monitoring traffic to cloud provider IP ranges
    range: last 90 days
    queries:
      - pseudocode: GROUP users into peer_groups via K-Means clustering | IF user_activity deviates from their group's_centroid | ALERT