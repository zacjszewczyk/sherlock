name: T1080: Taint Shared Content
id: a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d
description: This playbook addresses the threat of an adversary moving laterally by placing malicious content in a shared location. This is achieved by detecting several indicators: 1) Files written to network shares that are identified as malicious through hash matching or statistically unusual filenames. 2) The creation of suspicious script or shortcut files (.ps1, .lnk) on shares that contain obfuscated code or point to unexpected executables. 3) A user or process exhibiting anomalous behavior by modifying an unusually high volume of files or files with atypical extensions on a share. 4) A process being executed from a network share shortly after the file was written, especially when the writing and executing entities differ. This playbook provides investigative questions to explore these scenarios using symbolic, statistical, and machine learning approaches.
type: technique
related:
  - TA0008: Lateral Movement
contributors:
  - Zachary Szewczyk
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Have any new files on network shares been identified as malicious based on their hash matching a known threat?
    context: This is a high-fidelity check. Matching a file's hash against a database of known malicious hashes (threat intelligence) is a definitive way to confirm that a known piece of malware has been placed on a shared resource, likely for lateral movement or staging.
    answer_sources:
      - Sysmon Event ID 11
      - Windows Event ID 4663
      - Zeek files.log
      - Enterprise file shares (e.g., SMB, NFS), document management systems (e.g., SharePoint), and departmental or public-access network drives.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH file creation events (Sysmon 11, Win 4663) on network shares. FOR each new file, CALCULATE its SHA256 hash. JOIN hash with threat intelligence database. ALERT on any match.
  - question: Are there new files on network shares with statistically unusual filenames, such as those with high entropy or rare character sequences?
    context: Adversaries often use randomly generated filenames for their malware to evade simple signature-based detection. High Shannon entropy or unusual n-gram frequencies in a filename are strong mathematical indicators of this randomness, helping to uncover novel or polymorphic malware.
    answer_sources:
      - Sysmon Event ID 11
      - Windows Event ID 4663
      - Zeek files.log
      - Enterprise file shares (e.g., SMB, NFS), document management systems (e.g., SharePoint), and departmental or public-access network drives.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: FOR each new file on network shares, CALCULATE filename Shannon entropy and n-gram frequency. COMPARE to established baseline for the share. ALERT if entropy is above 95th percentile or n-gram is rare.
  - question: Has a machine learning model identified any new files on network shares as likely malicious based on their metadata?
    context: A machine learning classifier can analyze a combination of file metadata features (like extension, size, source user, and creating process) to identify subtle patterns indicative of malicious activity. This approach can detect suspicious files that may not have a known hash or an obviously random filename. An alert score of $$ p(malicious) > 0.85 $$ suggests high confidence.
    answer_sources:
      - Sysmon Event ID 11
      - Windows Event ID 4663
      - Zeek files.log
      - Enterprise file shares (e.g., SMB, NFS), document management systems (e.g., SharePoint), and departmental or public-access network drives.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: FOR each new file on network shares, FEED metadata (extension, size, source user, source process) into a classification model. ALERT if model probability score is > 0.85.
  - question: Have any new script or shortcut files on network shares been found to contain suspicious commands, obfuscation, or unexpected target paths?
    context: Adversaries use script files (.ps1, .vbs) and shortcuts (.lnk) on shares to execute code on other systems. Scanning these files for signs of obfuscation (e.g., 'Invoke-Expression', 'FromBase64String'), suspicious API calls, or .lnk files pointing to scripting engines can reveal attempts to stage malicious execution payloads.
    answer_sources:
      - Sysmon Event ID 11
      - Windows Event ID 4663
      - Zeek files.log
      - Windows Event ID 4688
      - User home directories on network shares, software deployment and update repositories, and staging directories used by developers or system administrators.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SCAN new files with extensions .lnk, .ps1, .vbs, .bat on shares. USE YARA rules to find obfuscation patterns or suspicious commands. PARSE .lnk files for unexpected targets. ALERT on detection.
  - question: Do any new script files on network shares exhibit unusually high character-level entropy compared to benign scripts?
    context: Malicious scripts are often packed or encrypted to hide their true purpose. This process increases the script's character-level Shannon entropy, making it statistically different from typical, human-written scripts. Flagging scripts with entropy scores that are significant outliers (e.g., > 3 standard deviations from the mean) can effectively detect this obfuscation.
    answer_sources:
      - Sysmon Event ID 11
      - Windows Event ID 4663
      - Zeek files.log
      - Windows Event ID 4688
      - User home directories on network shares, software deployment and update repositories, and staging directories used by developers or system administrators.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: FOR each new script on a share, CALCULATE character-level Shannon entropy. COMPARE score to baseline for that script type. ALERT if score is > 3 standard deviations above the mean.
  - question: Has a Natural Language Processing (NLP) model classified the content of any new script on a network share as malicious?
    context: Advanced machine learning models, like transformers, can be trained to "understand" the structure and intent of code. By analyzing the content of a new script (function calls, strings, code structure), an NLP model can classify it as malicious with high confidence, even if it uses novel obfuscation techniques.
    answer_sources:
      - Sysmon Event ID 11
      - Windows Event ID 4663
      - Zeek files.log
      - Windows Event ID 4688
      - User home directories on network shares, software deployment and update repositories, and staging directories used by developers or system administrators.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: FOR each new script on a share, FEED its full content into a trained NLP classifier. ALERT if the model classifies the script as 'malicious' with > 90% confidence.
  - question: Has a user or non-standard process modified sensitive file types (e.g., .exe, .dll) on a network share?
    context: System executables and configuration files on network shares should only be modified by trusted deployment tools or administrators. An alert on a regular user process modifying these file types can indicate an adversary is tampering with software or planting a backdoor.
    answer_sources:
      - Windows Event ID 4663
      - Windows Event ID 5140
      - Zeek smb_files.log
      - Sysmon Event ID 11
      - Critical file servers hosting intellectual property, financial records, or PII. Also includes application servers with shared configuration files and backup storage locations.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: MONITOR file write/modify events (Win 4663, Sysmon 11) on shares. CREATE watchlist of sensitive extensions (.exe, .dll) and standard deployment processes. ALERT if a non-watchlist process modifies a watchlist file type.
  - question: Has any user exhibited anomalous file write activity on network shares, such as writing an unusually high number of files or writing atypical file types?
    context: Every user has a typical pattern of interaction with network shares. A significant deviation from this baseline—like a sudden spike in the number of files written or a sudden change in the types of files being written (e.g., .docx user now writing .exe)—is a strong indicator of a compromised account being used for malicious purposes, such as deploying ransomware.
    answer_sources:
      - Windows Event ID 4663
      - Windows Event ID 5140
      - Zeek smb_files.log
      - Sysmon Event ID 11
      - Critical file servers hosting intellectual property, financial records, or PII. Also includes application servers with shared configuration files and backup storage locations.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: FOR each user, BASELINE file write count and file extension distribution on shares. USE IQR method to detect outliers. ALERT if a user's activity (e.g., file count/hour, new extension type) is a statistical outlier.
  - question: Has a time-series model detected a significant and anomalous spike in the overall volume of file write events on any network share?
    context: A sudden, large-scale file modification event across a network share can be a sign of a widespread attack, like ransomware encryption or mass data tampering. A time-series anomaly detection model (like ARIMA or an LSTM) can learn the normal rhythm of file activity on a share and alert when a statistically improbable spike occurs.
    answer_sources:
      - Windows Event ID 4663
      - Windows Event ID 5140
      - Zeek smb_files.log
      - Sysmon Event ID 11
      - Critical file servers hosting intellectual property, financial records, or PII. Also includes application servers with shared configuration files and backup storage locations.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: AGGREGATE file write events (Sysmon 11) per share in 5-min windows. APPLY a trained time-series model (e.g., LSTM). ALERT if the observed write count significantly exceeds the model's forecast.
  - question: Has a process been executed from a network share shortly after being written, especially if the user/host that wrote the file is different from the one that executed it?
    context: This is a classic lateral movement pattern. An attacker compromises one machine (Host A) to write a malicious executable to a share, then triggers its execution on another machine (Host B). Correlating a file write event with a subsequent process execution event for the same file path within a short time window (e.g., $$ \Delta t < 5 $$ minutes) is a very strong indicator of this attack.
    answer_sources:
      - Sysmon Event ID 1
      - Windows Event ID 4688
      - Sysmon Event ID 11
      - Windows Event ID 4663
      - Zeek conn.log
      - All endpoints with mounted network shares, especially those belonging to users with broad access (e.g., domain admins, help desk staff) and servers that execute tasks from shared locations.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: CORRELATE file write events (Sysmon 11) with process creation events (Sysmon 1) on the same UNC path. ALERT if execution occurs within 5 mins of write AND writing user/host is different from executing user/host.
  - question: Has a statistically rare process been executed from a network share?
    context: Network shares typically host a predictable set of executables. When a new or rarely seen process is executed from a share, it's a potential sign of novel malware. By maintaining a baseline of common process executions and alerting on infrequent ones (e.g., seen < 5 times in 90 days), analysts can detect threats that aren't yet in threat intelligence feeds.
    answer_sources:
      - Sysmon Event ID 1
      - Windows Event ID 4688
      - Sysmon Event ID 11
      - Windows Event ID 4663
      - Zeek conn.log
      - All endpoints with mounted network shares, especially those belonging to users with broad access (e.g., domain admins, help desk staff) and servers that execute tasks from shared locations.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: BUILD a frequency table of all process names executed from each network share. ALERT when a process is executed that is statistically rare (e.g., seen < 5 times in 90 days).
  - question: Has a User and Entity Behavior Analytics (UEBA) model flagged a user's execution of a process from a network share as anomalous for that specific user?
    context: A UEBA system learns the normal behavior for each individual user, including what applications they run and from where. If a user who never runs executables from network shares suddenly does so, the UEBA model will flag this as a significant deviation from their personal profile. This is effective for detecting compromised accounts being used in ways that are uncharacteristic for the legitimate user.
    answer_sources:
      - Sysmon Event ID 1
      - Windows Event ID 4688
      - Sysmon Event ID 11
      - Windows Event ID 4663
      - Zeek conn.log
      - All endpoints with mounted network shares, especially those belonging to users with broad access (e.g., domain admins, help desk staff) and servers that execute tasks from shared locations.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: INPUT user process execution events into a UEBA model (e.g., isolation forest). ALERT if the model classifies an execution from a network share as a significant anomaly for that user's profile.