name: T1123: Audio Capture
id: f8e9d0c1-b2a3-4f5e-8d9c-0a1b2c3d4e5f
description: This playbook helps investigate whether an adversary is capturing audio from endpoint devices. It provides questions and queries to detect evidence of audio capture, such as the execution of known audio capture malware, the use of command-line utilities or scripts to record audio, unusual process execution chains involving audio-capable applications, the creation of audio files by unexpected processes, and the subsequent exfiltration of captured data over the network.
type: technique
related:
  - TA0009: Collection
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Have any processes been created that match known audio capture malware IOCs, or have any antivirus alerts been triggered for related threats?
    context: This question aims to detect the presence of known malicious tools used for audio capture. By comparing newly created processes against a threat intelligence feed of hashes and names, and by searching for specific antivirus detections, we can quickly identify confirmed malicious activity. This is a high-fidelity check for known threats.
    answer_sources: Windows Event ID 4688, Sysmon Event ID 1, Windows Defender Event ID 1116, Windows Defender Event ID 1117. Applicable to: User workstations, laptops, conference room systems, and executive endpoints.
    range: last 90 days
    queries:
      - technology: SIEM
        query: |-
          SEARCH process_creation_logs WHERE (process_hash IN (threat_intel_hashes) OR process_name IN (threat_intel_names))
          SEARCH antivirus_logs WHERE (threat_name CONTAINS 'spyware' OR threat_name CONTAINS 'audiocapture')
  - question: Has there been a statistically significant spike in antivirus alerts related to spyware or audio capture tools?
    context: This question seeks to identify anomalies in the volume of antivirus detections. A sudden increase in alerts, even for lower-severity threats, can indicate a widespread campaign. Using a moving average and standard deviation helps to baseline normal activity and automatically flag unusual spikes that warrant investigation.
    answer_sources: Windows Defender Event ID 1116, Windows Defender Event ID 1117. Applicable to: User workstations, laptops, conference room systems, and executive endpoints.
    range: last 90 days
    queries:
      - technology: SIEM / Data Analytics
        query: |-
          CALCULATE daily_count of antivirus_alerts WHERE (threat_name CONTAINS 'spyware')
          CALCULATE 30_day_moving_average AND standard_deviation of daily_count
          ALERT IF daily_count > (moving_average + 3 * standard_deviation)
  - question: Are there any newly created processes that a machine learning model identifies as having a high probability of being malicious audio capture tools?
    context: This question leverages machine learning to detect novel or unknown threats. By analyzing features like file path entropy, signature status, and parent process, a classifier can assign a risk score to flag suspicious processes that exhibit characteristics commonly associated with malware.
    answer_sources: Sysmon Event ID 1. Applicable to: User workstations, laptops, conference room systems, and executive endpoints.
    range: last 90 days
    queries:
      - technology: Machine Learning / Python
        query: |-
          FOR each new process_creation_event:
            EXTRACT features (path_entropy, signature, parent_process, etc.)
            APPLY pre-trained_classifier to features
            IF risk_score > threshold, ALERT for investigation
  - question: Have any command-line arguments or PowerShell scripts been executed containing keywords or API calls associated with audio capture?
    context: This question focuses on detecting the "how" of audio capture by looking for the specific commands and code used to initiate it. Searching for keywords like `ffmpeg` or API calls like `mciSendString` in command-line and script logs can reveal attempts to record audio.
    answer_sources: Windows Event ID 4688, Sysmon Event ID 1, Windows PowerShell Event ID 4104. Applicable to: User workstations, Developer machines, Administrator jump boxes.
    range: last 90 days
    queries:
      - technology: SIEM
        query: |-
          SEARCH command_line_logs OR powershell_script_logs WHERE content MATCHES REGEX ('ffmpeg|sox|soundrecorder|System.Media.SoundPlayer|waveInOpen|mciSendString')
  - question: Have any PowerShell scripts been executed with unusually high information entropy, possibly indicating obfuscation?
    context: This question aims to uncover malicious PowerShell scripts that have been obfuscated to evade signature-based detection. High entropy often correlates with packed or encoded payloads. By baselining the entropy of legitimate scripts and flagging outliers, analysts can focus on scripts that are intentionally hard to read.
    answer_sources: Windows PowerShell Event ID 4104. Applicable to: User workstations, Developer machines, Administrator jump boxes.
    range: last 90 days
    queries:
      - technology: Data Analytics / Python
        query: |-
          FOR each powershell_script_block:
            CALCULATE entropy of script_content
            IF entropy > 95th_percentile_of_baseline, ALERT for review
  - question: Have any command-line executions been observed that are statistically rare or anomalous compared to a learned baseline of normal activity?
    context: This question uses a machine learning model (autoencoder) to identify unusual command-line usage. The model learns "normal" command sequences and flags new commands that deviate significantly, indicating a potentially malicious and novel sequence of arguments.
    answer_sources: Windows Event ID 4688, Sysmon Event ID 1. Applicable to: User workstations, Developer machines, Administrator jump boxes.
    range: last 90 days
    queries:
      - technology: Machine Learning / LSTM Autoencoder
        query: |-
          FOR each new command_line:
            PROCESS command_line through trained_LSTM_autoencoder
            CALCULATE reconstruction_error
            IF reconstruction_error > anomaly_threshold, ALERT for review
  - question: Have any known audio-capable applications been launched by an unexpected or unauthorized parent process?
    context: This question seeks to identify process injection or masquerading where an adversary uses a legitimate, audio-capable application for malicious purposes. Any deviation from a baseline of normal parent processes (e.g., being launched by an unsigned process in a temp directory) is highly suspicious.
    answer_sources: Windows Event ID 4688, Sysmon Event ID 1. Applicable to: User workstations, Executive laptops, Endpoints with collaboration software installed.
    range: last 90 days
    queries:
      - technology: SIEM
        query: |-
          SEARCH process_creation_logs WHERE child_process IN (known_audio_apps) AND parent_process NOT IN (parent_allowlist)
  - question: Have any rare parent-child process relationships involving audio-capable applications been observed?
    context: This question uses statistical analysis to find anomalous process execution chains. By analyzing the frequency of all parent-child relationships, we can identify pairs that rarely occur. A rare pairing involving an audio-capable application is a strong indicator of abnormal activity.
    answer_sources: Windows Event ID 4688, Sysmon Event ID 1. Applicable to: User workstations, Executive laptops, Endpoints with collaboration software installed.
    range: last 90 days
    queries:
      - technology: SIEM / Data Analytics
        query: |-
          CALCULATE frequency of all parent_child_pairs over 30 days
          SEARCH for new parent_child_pairs WHERE child_process IN (known_audio_apps)
          ALERT IF frequency < 1st_percentile
  - question: Using graph analysis, are there any unusual process execution chains leading to the launch of an audio-capable application?
    context: This question applies graph theory to model process relationships, providing a holistic view of execution chains. Anomaly detection algorithms can identify processes that act as unusual "bridges" between different groups of processes. If such a process is the parent of an audio-capable application, it could signify a sophisticated attack chain.
    answer_sources: Windows Event ID 4688, Sysmon Event ID 1. Applicable to: User workstations, Executive laptops, Endpoints with collaboration software installed.
    range: last 90 days
    queries:
      - technology: Graph Analytics
        query: |-
          BUILD process_ancestry_graph from process_creation_logs
          APPLY graph_anomaly_algorithm (e.g., PageRank)
          ALERT ON anomalous_nodes that are parents of known_audio_apps
  - question: Have any files with audio extensions (.wav, .mp3, etc.) been created by processes that are not approved media applications?
    context: This question targets the output of audio capture: the audio file itself. It is highly suspicious for a non-media application (e.g., a command shell) to create a .wav or .mp3 file. This is a strong indicator that a process is capturing audio and saving it for later exfiltration.
    answer_sources: Sysmon Event ID 11, Windows Event ID 4688, Sysmon Event ID 1. Applicable to: User home directories, Shared network drives, Temporary file system locations (e.g., C:\Users\<user>\AppData\Local\Temp).
    range: last 90 days
    queries:
      - technology: SIEM
        query: |-
          SEARCH file_creation_events WHERE file_extension IN ('.wav', '.mp3', '.m4a')
          AND creating_process_name NOT IN (media_app_allowlist)
  - question: Are any processes creating files at regular, periodic intervals, which could indicate automated recording?
    context: This question attempts to identify the behavior of automated surveillance tools. An adversary's implant might be configured to record audio in fixed-length chunks, resulting in files being created at very regular intervals. Analyzing the time between file creation events can reveal this periodicity.
    answer_sources: Sysmon Event ID 11. Applicable to: User home directories, Shared network drives, Temporary file system locations (e.g., C:\Users\<user>\AppData\Local\Temp).
    range: last 90 days
    queries:
      - technology: Data Analytics / Python
        query: |-
          FOR each process:
            GET timestamps of its file_creation_events
            CALCULATE standard_deviation of inter-arrival_times
            IF standard_deviation is low, ALERT for periodic activity
  - question: Has any process exhibited an anomalous pattern of file write activity compared to its historical baseline?
    context: This question uses time-series analysis to detect abnormal file I/O behavior. A process that suddenly starts writing files more frequently than its historical norm could be a malicious tool saving captured data. A time-series model can learn the normal "rhythm" for each process and flag significant deviations.
    answer_sources: Sysmon Event ID 11. Applicable to: User home directories, Shared network drives, Temporary file system locations (e.g., C:\Users\<user>\AppData\Local\Temp).
    range: last 90 days
    queries:
      - technology: Machine Learning / Time-Series Analysis
        query: |-
          MODEL file_write_volume and frequency per process/host over time
          APPLY time-series_anomaly_detection (e.g., Prophet, ESD)
          ALERT ON processes with anomalous file_write patterns
  - question: Has a process created an audio file and then immediately connected to a known malicious IP address or domain?
    context: This question links the creation of a potential audio recording directly to its exfiltration. The sequence of "create audio file" followed closely by "connect to bad IP" is a very strong indicator of a complete attack chain: capture, stage, and exfiltrate.
    answer_sources: Zeek conn.log, Zeek dns.log, Zeek files.log, Sysmon Event ID 3, Sysmon Event ID 1, Sysmon Event ID 11. Applicable to: Network egress points, DNS servers, Proxy servers, User workstations.
    range: last 90 days
    queries:
      - technology: SIEM
        query: |-
          JOIN file_creation_events (Sysmon 11) with network_connection_events (Sysmon 3) on ProcessGUID
          WHERE file_extension IN (audio_extensions)
          AND network_destination IN (threat_intel_blocklist)
          AND time_difference < 5 minutes
  - question: Have any endpoints made unusually large outbound data transfers to a rare destination?
    context: This question seeks to identify data exfiltration by looking for statistical anomalies in network traffic. A large upload of captured audio will likely stand out as an unusually large data transfer. Combining this with the rarity of the destination IP significantly increases the likelihood that the transfer is malicious.
    answer_sources: Zeek conn.log, Zeek dns.log. Applicable to: Network egress points, DNS servers, Proxy servers, User workstations.
    range: last 90 days
    queries:
      - technology: SIEM / Data Analytics
        query: |-
          CALCULATE 99th_percentile of bytes_sent per host over 30 days
          ALERT IF new_connection_bytes_sent > 99th_percentile
          ENRICH with destination_rarity and JA3_hash_rarity
  - question: Using machine learning, have any anomalous outbound network connections been detected, especially from processes that have also recently created files?
    context: This question employs an unsupervised learning model to find anomalous network connections based on a combination of features like data volume, duration, and TLS fingerprint (JA3). Prioritizing anomalies from processes that are also performing file I/O helps to connect potential exfiltration with the staging of captured data.
    answer_sources: Zeek conn.log, Sysmon Event ID 11. Applicable to: Network egress points, DNS servers, Proxy servers, User workstations.
    range: last 90 days
    queries:
      - technology: Machine Learning / Isolation Forest
        query: |-
          FOR each network_connection:
            EXTRACT features (duration, bytes, port, JA3, etc.)
            APPLY trained_isolation_forest_model
            IF anomaly_score is high, ALERT for review