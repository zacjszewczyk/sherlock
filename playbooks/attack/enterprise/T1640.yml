name: T1640: Account Access Removal
id: 1e4b5a04-9a4c-4a3d-8f2b-7e6d5c4b3a21
description: This playbook helps identify whether an adversary is attempting to remove or deny access to corporate user accounts, specifically by leveraging compromised mobile devices. It provides investigative steps to detect attacks characterized by anomalous account lockouts or password reset attempts originating from mobile network IP addresses, high volumes of malicious API requests targeting account management endpoints, and suspicious behavior on managed mobile devices, such as a non-standard application gaining administrative privileges immediately before authentication anomalies occur.
type: technique
related:
- TA0034: Impact
contributors:
- Zachary Szewczyk
- Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
investigative_questions:
- question: How can I detect a rapid password reset attempt followed by an account lockout from a mobile device that is not registered or compliant?
  context: This question aims to identify a specific attack pattern where an adversary, using a mobile device, tries to reset a password and immediately locks the account. Correlating these events in a short time frame from a mobile network, and then checking if the device is managed and compliant, helps to quickly spot a likely account takeover attempt. A non-compliant or unknown device significantly increases the suspicion level.
  answer_sources:
  - Windows Event ID 4740
  - Windows Event ID 4724
  - Zeek conn.log
  - Zeek http.log
  - MDM Device Logs
  - Cloud Identity Provider Logs
  - Active Directory Domain Controllers
  - VPN Concentrators
  - Internet Gateway
  - Mobile Device Management (MDM) Platform
  - Cloud Identity Provider (e.g., Azure AD, Okta)
  range: last 90 days
  queries:
  - search_technology: Pseudocode
    query: |
      FOR each Windows Event ID 4724 (password reset attempt)
        WITHIN 60 seconds
          SEARCH for Windows Event ID 4740 (lockout)
          WHERE username AND source_ip are the same
      IF match
        ENRICH source_ip with ASN from Zeek conn.log
        IF ASN in mobile_provider_watchlist
          QUERY MDM logs for source_ip/username
          IF device not registered OR not compliant
            TRIGGER CRITICAL ALERT
          ELSE
            TRIGGER HIGH ALERT
- question: Is a user experiencing an anomalous number of authentication events (password resets, lockouts) compared to their own baseline, originating from a suspicious mobile device?
  context: This question focuses on detecting unusual spikes in authentication activity for individual users. By establishing a personal baseline for each user, the system can flag deviations that might be lost in broader, organization-wide analytics. Escalating alerts based on the source being a mobile network and the device's user-agent not matching the user's known devices provides strong evidence of a compromised account being used from an unauthorized mobile device.
  answer_sources:
  - Windows Event ID 4740
  - Windows Event ID 4724
  - Zeek conn.log
  - Zeek http.log
  - MDM Device Logs
  - Cloud Identity Provider Logs
  - Active Directory Domain Controllers
  - VPN Concentrators
  - Internet Gateway
  - Mobile Device Management (MDM) Platform
  - Cloud Identity Provider (e.g., Azure AD, Okta)
  range: last 90 days
  queries:
  - search_technology: Pseudocode
    query: |
      FOR each user
        CALCULATE 30-day baseline and 99th percentile of hourly auth events (4724, 4740)
      IF current_hourly_count > 99th_percentile
        TRIGGER MEDIUM ALERT
        ENRICH source_ip with ASN from Zeek conn.log
        ENRICH with user-agent from Zeek http.log
        IF ASN is mobile_carrier AND (user-agent is new OR user-agent not in MDM profile)
          ESCALATE to HIGH ALERT
- question: Can a machine learning model identify anomalous authentication patterns for a user that indicate a high-risk event, such as an account access removal attempt from a mobile device?
  context: This question leverages advanced analytics to detect subtle anomalies that simple thresholding might miss. By using a time-series model with features like time of day and business hours, the system can learn a user's normal authentication rhythm. An anomaly score combined with risk factors like the source being a mobile network, a rare geolocation, or an unregistered device, allows for a sophisticated, risk-based alerting system to prioritize the most critical threats.
  answer_sources:
  - Windows Event ID 4740
  - Windows Event ID 4724
  - Zeek conn.log
  - Zeek http.log
  - MDM Device Logs
  - Cloud Identity Provider Logs
  - Active Directory Domain Controllers
  - VPN Concentrators
  - Internet Gateway
  - Mobile Device Management (MDM) Platform
  - Cloud Identity Provider (e.g., Azure AD, Okta)
  range: last 90 days
  queries:
  - search_technology: Pseudocode
    query: |
      FOR each user
        TRAIN time-series model (e.g., Seasonal-Hybrid ESD) on auth event counts (4724, 4740)
      IF model flags anomaly
        ENRICH with ASN, geolocation (from Zeek conn.log), user-agent (from Zeek http.log)
        CALCULATE risk_score based on (anomaly_score, is_mobile_ASN, is_rare_geo, is_unregistered_device)
        IF risk_score > threshold
          ESCALATE ALERT
- question: Are critical account management API endpoints being targeted with POST or DELETE requests from mobile networks, especially when the session lacks a recent MFA validation?
  context: This question focuses on protecting high-value API endpoints that can be used to lock users out or take over accounts. By monitoring these specific endpoints for dangerous methods (POST, DELETE) originating from mobile networks, we can detect targeted attacks. Checking the authentication token for an MFA claim adds a crucial layer of context, as the absence of recent MFA significantly increases the likelihood of a malicious, non-interactive attack.
  answer_sources:
  - Zeek http.log
  - Zeek conn.log
  - WAF Logs
  - API Gateway Logs
  - Cloud Identity Provider Logs
  - API Gateway Servers
  - Web Application Firewalls (WAFs)
  - Internet-facing application servers
  - Microservice infrastructure hosting account management functions
  range: last 90 days
  queries:
  - search_technology: Pseudocode
    query: |
      FOR each HTTP request to critical_api_watchlist
      IF method is POST or DELETE
        ENRICH source_ip with ASN from Zeek conn.log
        IF ASN in mobile_provider_watchlist
          TRIGGER HIGH ALERT
          PARSE Authorization header
          IF token lacks recent_mfa_claim
            INCREASE ALERT PRIORITY
- question: Is a specific mobile IP address generating an abnormally high volume of requests to a critical API endpoint with very low variation in the URI path, suggesting scripted or automated activity?
  context: This question aims to detect automated (bot-like) attacks against APIs from mobile devices. A legitimate user typically accesses a variety of endpoints, resulting in higher URI entropy. An attacker running a script against a single endpoint will have a high request rate but very low entropy. Combining these two metrics—high volume and low entropy—from a mobile network source is a strong indicator of a brute-force or credential stuffing attack aimed at account removal or takeover.
  answer_sources:
  - Zeek http.log
  - Zeek conn.log
  - WAF Logs
  - API Gateway Logs
  - Cloud Identity Provider Logs
  - API Gateway Servers
  - Web Application Firewalls (WAFs)
  - Internet-facing application servers
  - Microservice infrastructure hosting account management functions
  range: last 90 days
  queries:
  - search_technology: Pseudocode
    query: |
      FOR each critical API endpoint
        CALCULATE 30-day baseline and 99th percentile of request rate per source IP
      FOR each source IP
        IF request_rate > 99th_percentile AND ASN is mobile_carrier
          TRIGGER MEDIUM ALERT
          CALCULATE Shannon entropy of requested URIs
          IF entropy < 1.0
            ESCALATE to HIGH ALERT
- question: Can a machine learning model detect anomalous API requests to sensitive endpoints based on a combination of features like request method, size, user-agent, and source ASN?
  context: This question proposes using an unsupervised model (like Isolation Forest) to find "needles in a haystack" without pre-defined rules. The model learns what normal API traffic looks like across multiple dimensions. It can then flag requests that are outliers, even if they don't trigger a simple volume-based threshold. This is particularly effective for detecting novel or slow-and-low attacks. Prioritizing outliers that involve POST/DELETE methods from mobile ASNs allows analysts to focus on the most probable threats.
  answer_sources:
  - Zeek http.log
  - Zeek conn.log
  - WAF Logs
  - API Gateway Logs
  - Cloud Identity Provider Logs
  - API Gateway Servers
  - Web Application Firewalls (WAFs)
  - Internet-facing application servers
  - Microservice infrastructure hosting account management functions
  range: last 90 days
  queries:
  - search_technology: Pseudocode
    query: |
      TRAIN unsupervised model (e.g., Isolation Forest) on baseline of API traffic features (URI, method, size, user-agent, ASN, etc.)
      FOR each new API request to sensitive endpoint
        SCORE request with model
        IF request is outlier AND method is POST/DELETE AND ASN is mobile_carrier
          FLAG for immediate investigation, prioritized by anomaly score
- question: Has a user's account experienced a lockout or failed password reset shortly after a non-standard application was granted administrator rights on their managed mobile device?
  context: This question links a high-risk event on a mobile device (granting admin rights to an unapproved app) directly to a potential impact on the user's corporate account. The correlation is time-sensitive; malicious activity often follows quickly after compromise. An alert that combines these two distinct events provides a very strong signal that the mobile device has been compromised and is being used to attack the user's account.
  answer_sources:
  - MDM Device Logs
  - MDM Application Logs
  - Windows Event ID 4724
  - Windows Event ID 4740
  - Zeek conn.log
  - Cloud Identity Provider Logs
  - Mobile Device Management (MDM) Platform
  - Managed Mobile Devices
  - Active Directory Domain Controllers
  - Cloud Identity Provider (e.g., Azure AD, Okta)
  - VPN Concentrators
  range: last 90 days
  queries:
  - search_technology: Pseudocode
    query: |
      FOR each MDM log of 'Device Admin' permission grant to non-standard app
        WITHIN 60 minutes
          SEARCH for Event 4740 (lockout) or failed password reset for the same user
      IF match
        ESCALATE to HIGH ALERT
- question: Is a managed mobile device exhibiting an unusually high frequency of 'Device Administrator' permission grants, and is it also generating anomalous authentication-related network traffic?
  context: This question seeks to identify devices that are behaving suspiciously, even if a specific malicious app isn't immediately identified. A device that is frequently granting admin rights is inherently risky. By baselining this behavior and alerting on deviations, security teams can proactively investigate. Correlating this with unusual network traffic to authentication servers (like domain controllers) strengthens the case that the device is compromised and being used for malicious purposes, justifying an escalation.
  answer_sources:
  - MDM Device Logs
  - MDM Application Logs
  - Windows Event ID 4724
  - Windows Event ID 4740
  - Zeek conn.log
  - Cloud Identity Provider Logs
  - Mobile Device Management (MDM) Platform
  - Managed Mobile Devices
  - Active Directory Domain Controllers
  - Cloud Identity Provider (e.g., Azure AD, Okta)
  - VPN Concentrators
  range: last 90 days
  queries:
  - search_technology: Pseudocode
    query: |
      FOR each managed device
        CALCULATE 90-day baseline and 99th percentile for 'Device Admin' grants
      IF current_grants > 99th_percentile
        TRIGGER MEDIUM ALERT
        ANALYZE network traffic from device IP to auth servers (ports 88, 389, 445, etc.)
        CALCULATE user's daily norm for this traffic
        IF current_traffic_volume > (norm + 3 * std_dev)
          ESCALATE ALERT
- question: Can a machine learning model group managed mobile devices into risk-based clusters, and can we use this clustering to dynamically adjust alerting thresholds for devices that become high-risk?
  context: This question describes a proactive, risk-based approach to device management. Instead of treating all devices equally, a clustering model can identify devices that share high-risk characteristics (e.g., many installed apps, non-compliant, many permissions). Once a device is flagged as high-risk by moving into a "bad" cluster, it can be placed on a "watch list." This means that even minor subsequent anomalies, like a single account lockout, which might normally be ignored, would trigger an immediate alert for that specific device, allowing for earlier intervention.
  answer_sources:
  - MDM Device Logs
  - MDM Application Logs
  - Windows Event ID 4724
  - Windows Event ID 4740
  - Zeek conn.log
  - Cloud Identity Provider Logs
  - Mobile Device Management (MDM) Platform
  - Managed Mobile Devices
  - Active Directory Domain Controllers
  - Cloud Identity Provider (e.g., Azure AD, Okta)
  - VPN Concentrators
  range: last 90 days
  queries:
  - search_technology: Pseudocode
    query: |
      TRAIN clustering model (e.g., K-Means) on MDM device features (app_count, permissions, compliance, etc.) to create risk clusters
      IF device moves into high-risk cluster
        APPLY "sensitive" status to device
      FOR devices with "sensitive" status
        LOWER alerting threshold for auth anomalies (e.g., alert on single Event 4740)