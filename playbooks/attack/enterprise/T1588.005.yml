name: T1588.005: Exploits
id: f7b5c1a0-645d-4f1e-8a2b-9d0c8e4f3a1b
description: This playbook helps determine if an adversary has acquired exploits for use against the enterprise. It looks for indicators such as internal hosts connecting to known exploit repositories, the transfer of files matching exploit patterns, significant increases in inbound scanning activity after a vulnerability disclosure, or a suspicious sequence of user actions like visiting a vulnerability disclosure site, then a code repository, followed by downloading and executing a script.
type: technique
related:
  - TA0042: Resource Development
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Have any internal, non-research hosts connected to or resolved domains/IPs known to be associated with exploit repositories or hacking forums?
    context: This question aims to detect the initial reconnaissance or acquisition phase of an attack. Adversaries often visit exploit repositories, hacking forums, or exploit kit C2 servers to obtain tools. By correlating network and DNS logs with threat intelligence and excluding known security research hosts, analysts can identify potentially unauthorized or compromised systems seeking out exploits.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Corporate network egress points
      - DNS resolvers
      - Web proxies
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          SEARCH Zeek conn.log AND dns.log
          JOIN with threat_intelligence_feed ON destination_ip/domain
          WHERE source_ip NOT IN authorized_researcher_ip_list
          RETURN timestamp, source_ip, destination_ip, destination_domain
  - question: Has any host queried for an unusually rare domain, especially one that was recently registered or has a low TTL?
    context: Adversaries may use newly created or obscure domains for staging or C2 infrastructure related to exploit delivery. This question helps identify anomalous DNS activity that deviates from normal enterprise patterns. By profiling domain rarity and flagging queries for highly infrequent domains, especially those with other suspicious attributes like recent registration, analysts can uncover potential connections to malicious infrastructure.
    answer_sources:
      - Zeek dns.log
      - Corporate network egress points
      - DNS resolvers
      - Web proxies
    range: last 30 days
    queries:
      - technology: pseudocode
        query: |
          CALCULATE domain_rarity across enterprise DNS logs over 30 days
          PROFILE hosts based on query patterns
          ALERT when host queries a domain in the 99.9th percentile of rarity
          ENRICH with WHOIS data for domain age and TTL values
  - question: Are there outbound connections from non-research hosts that are highly probable of being exploit acquisition activity based on a machine learning model?
    context: This question uses a predictive approach to find subtle indicators of exploit acquisition that may not be caught by simple signature-based rules. By training a Random Forest classifier on various connection and DNS features, we can score new outbound connections for their likelihood of being related to downloading exploits. This allows for the detection of novel threats and behaviors that don't match known malicious indicators.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Corporate network egress points
      - DNS resolvers
      - Web proxies
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          EXTRACT features from Zeek conn.log and dns.log for outbound connections
          APPLY pre-trained Random Forest model
          ALERT on connections with a high probability score for 'exploit acquisition'
          WHERE source_host NOT IN authorized_researcher_list
  - question: Have any files been downloaded by non-security personnel that match exploit-related filenames, patterns, or known malicious hashes?
    context: This question focuses on detecting the direct transfer of exploit code. Adversaries often download Proof-of-Concept (PoC) scripts or compiled exploits. This query searches for file transfers where filenames contain keywords like 'CVE' or 'exploit', or where the file hash matches a known exploit signature. Correlating the destination host with user directory data helps verify if the activity is unauthorized.
    answer_sources:
      - Zeek files.log
      - Zeek http.log
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - Web proxies
      - Network taps at egress points
      - Endpoint devices
      - File servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          SEARCH Zeek files.log
          WHERE filename matches regex '(?i)(cve-\d{4,}-\d{4,}|poc|exploit)\.(py|rb|pl|ps1|sh|exe)'
          OR file_hash IN known_exploit_hash_list
          CORRELATE destination_host with Active Directory
          ALERT if user/host is NOT in an authorized security group
  - question: Has any host downloaded a file with a MIME type that is statistically unusual for that host and its peer group?
    context: This question provides a behavioral approach to detecting anomalous file downloads. A user in a non-technical department suddenly downloading a Python script or a compiler output is highly unusual. By establishing a baseline of normal file types for each host and its peers, this method can flag suspicious downloads even if the file itself is not a known threat, indicating a potential tool or exploit acquisition.
    answer_sources:
      - Zeek files.log
      - Zeek http.log
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - Web proxies
      - Network taps at egress points
      - Endpoint devices
      - File servers
    range: last 30 days
    queries:
      - technology: pseudocode
        query: |
          BASELINE downloaded file MIME types for each host and peer group over 30 days
          SEARCH Zeek files.log and http.log for new downloads
          ALERT when a host downloads a file with a MIME type that is rare for both the host and its peer group
  - question: Has a host exhibited anomalous file download behavior as identified by a high reconstruction error from an LSTM autoencoder?
    context: This question uses advanced anomaly detection to identify deviations from a host's typical file download patterns. An LSTM autoencoder is trained on sequences of normal download events. When a new sequence of downloads (e.g., a rapid succession of unusual file types from a new source) occurs, the model will fail to reconstruct it accurately, resulting in a high error score. This signals a significant behavioral shift, possibly due to exploit acquisition.
    answer_sources:
      - Zeek files.log
      - Zeek http.log
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - Web proxies
      - Network taps at egress points
      - Endpoint devices
      - File servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each host, TRAIN LSTM autoencoder on sequences of file download events
          FEED real-time download events into the host's trained model
          CALCULATE reconstruction error
          ALERT when reconstruction error is anomalously high
  - question: Are we seeing a sudden, widespread increase in inbound connection attempts to a specific port, especially one tied to a newly disclosed vulnerability?
    context: This question aims to detect opportunistic, automated scanning by adversaries immediately following a vulnerability disclosure. When a new CVE is announced, attackers often scan the internet for vulnerable systems. This query looks for a large number of unique external IPs attempting to connect to a specific port across the enterprise within a short time frame, which is a strong indicator of mass exploitation or scanning.
    answer_sources:
      - Zeek conn.log
      - External-facing firewalls
      - Demilitarized Zone (DMZ) network segments
      - Internet gateway
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          DEFINE watchlist_ports based on new CVEs from threat intel
          SEARCH Zeek conn.log for inbound traffic
          GROUP BY destination_port
          ALERT if COUNT(DISTINCT source_ip) > 50 AND COUNT(DISTINCT source_ip) > 10 WITHIN 1 hour FOR a port in watchlist_ports
  - question: Has any external-facing port experienced an inbound connection rate from unique sources that exceeds its historical baseline?
    context: This question helps to identify targeted scanning or exploitation attempts against specific services. Unlike mass scanning, this might be a more focused attack. By maintaining a rolling baseline of normal traffic for each port, we can statistically identify when the volume of unique connection sources becomes anomalous, indicating that a service is being probed or attacked by an unusual number of clients.
    answer_sources:
      - Zeek conn.log
      - External-facing firewalls
      - Demilitarized Zone (DMZ) network segments
      - Internet gateway
    range: last 30 days
    queries:
      - technology: pseudocode
        query: |
          MAINTAIN 30-day rolling baseline of hourly unique source IPs for each external port
          COMPARE current hour's count to the baseline
          ALERT when current count exceeds the 99.5th percentile of the historical distribution
          PRIORITIZE alerts for ports on CVE watchlist
  - question: Is the volume of unique source IPs for a critical external port exceeding the forecast of a time-series model?
    context: This question provides a more sophisticated, forward-looking method for detecting anomalous traffic patterns. An ARIMA model learns the normal rhythm (trend, seasonality) of traffic to a port. When the observed traffic consistently violates the model's predictions, it suggests a new, unpredicted factor is at play, such as a coordinated scan or the start of a distributed attack.
    answer_sources:
      - Zeek conn.log
      - External-facing firewalls
      - Demilitarized Zone (DMZ) network segments
      - Internet gateway
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each critical port, TRAIN an ARIMA model on the time series of unique source IPs per minute
          FORECAST expected volume and confidence interval for the next minute
          ALERT if observed volume breaches the upper confidence bound for a sustained period (e.g., 3 minutes)
  - question: Has a non-research host performed a sequence of actions suggesting exploit research and execution within a short timeframe?
    context: This question correlates events across different data sources to build a high-fidelity narrative of exploit acquisition and use. The specific sequence—visiting a vulnerability database, then a code repository, downloading a script, and finally executing it—is highly indicative of an adversary (or curious employee) obtaining and testing an exploit. This stateful rule helps connect the dots that isolated events might miss.
    answer_sources:
      - Zeek dns.log
      - Zeek http.log
      - Zeek files.log
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - User workstations
      - Developer environments
      - Web proxies
      - DNS Servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          CREATE stateful rule for non-research hosts, tracking activity over a 2-hour window
          ALERT if sequence is observed:
          1. DNS query for domain in 'vuln_db_list'
          2. DNS query for domain in 'code_repo_list'
          3. File download of script type
          4. Process creation executing that script
  - question: Is any user accumulating a high-risk score based on a weighted sum of suspicious activities over a rolling time window?
    context: This question provides a risk-scoring mechanism to bubble up suspicious users, even if no single action is definitively malicious. By assigning points to various activities (e.g., visiting rare domains, downloading scripts) and summing them, we can identify users whose overall behavior pattern deviates significantly from their own or their peer group's baseline. This can uncover low-and-slow activities that might otherwise go unnoticed.
    answer_sources:
      - Zeek dns.log
      - Zeek http.log
      - Zeek files.log
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - User workstations
      - Developer environments
      - Web proxies
      - DNS Servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          ASSIGN risk scores to actions (e.g., visit rare domain=+5, download script=+10)
          SUM scores for each user over a rolling 1-hour window
          ESTABLISH user and peer group baselines for risk scores
          ALERT when a user's score exceeds 3 stddev of personal baseline or 2 stddev of peer baseline
  - question: Has a user's sequence of actions been identified as highly improbable by a Hidden Markov Model trained on benign activity?
    context: This question seeks to identify unusual workflows or chains of events. A Hidden Markov Model (HMM) learns the normal transition probabilities between different user actions (e.g., the probability of a file download following a DNS query). A sequence of events that has a very low probability under the model—such as executing a script downloaded from a brand new domain—is flagged as anomalous and potentially malicious.
    answer_sources:
      - Zeek dns.log
      - Zeek http.log
      - Zeek files.log
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - User workstations
      - Developer environments
      - Web proxies
      - DNS Servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          TRAIN a Hidden Markov Model on sequences of events from benign user sessions
          APPLY the model to live event streams for each user
          CALCULATE the log-likelihood score for each user's event sequence
          ALERT when a sequence produces a very low log-likelihood score