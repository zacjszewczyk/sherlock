name: T1056.003: Web Portal Capture
id: c8a2b5e4-7d6c-4f0b-9e3a-1f8d7c6b5a43
description: This playbook helps determine if an adversary has compromised a web portal to capture credentials or collect sensitive data. It focuses on identifying unauthorized modifications to web portal login pages, suspicious outbound network traffic containing credential patterns, anomalous process execution by web server processes (e.g., spawning command shells), and unusual file access patterns indicative of data staging and collection.
type: technique
related:
  - TA0006: Credential Access
  - TA0009: Collection
contributors:
  - Zachary Szewczyk
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Has a web portal login page been modified to include scripts or forms pointing to a malicious or non-allowlisted external domain?
    context: This question seeks to identify credential skimming attacks where an adversary alters a login page's code. By monitoring file modifications on these pages, analysts can parse the HTML to extract domains from <script> and <form> tags. These domains are then checked against threat intelligence feeds and internal allowlists to detect diversions of credential data to attacker-controlled infrastructure.
    answer_sources:
      - Windows Event ID 4663
      - Windows Event ID 4688
      - Zeek http.log
      - Zeek files.log
      - Externally-facing web servers hosting login portals (VPN, OWA, SharePoint)
    range: last 90 days
    queries:
      - "SEARCH file modification events (Win Event 4663) for login pages. FOR each event, PARSE file content, EXTRACT domains from <script src> and <form action>. IF domain is in malicious_feed OR NOT in allowlist, THEN ALERT."
  - question: Is a new external domain found in a modified login page exhibiting high-risk characteristics, such as recent registration or low popularity?
    context: This question provides a method for identifying potentially malicious domains even if they are not yet on a threat intelligence feed. By enriching newly observed domains with metadata like age, popularity, and name complexity (entropy), a risk score can be calculated. This proactive approach helps detect attacker infrastructure that has been recently stood up for a specific campaign.
    answer_sources:
      - Windows Event ID 4663
      - Windows Event ID 4688
      - Zeek http.log
      - Zeek files.log
      - Externally-facing web servers hosting login portals (VPN, OWA, SharePoint)
    range: last 90 days
    queries:
      - "ON new external domain identified in login page, GET domain metadata (age, popularity). CALCULATE risk score based on age < 30 days, low popularity, and high entropy. IF score > threshold, THEN ALERT."
  - question: Did a modification to a web portal login page occur outside of a normally scheduled or predicted maintenance window?
    context: This question focuses on the timing of file changes to detect unauthorized activity. Legitimate updates often follow a predictable schedule. By creating a time-series model of past file modifications, it's possible to establish a baseline for normal update cycles. A modification occurring outside of a predicted window is anomalous and warrants investigation, especially when correlated with the responsible process.
    answer_sources:
      - Windows Event ID 4663
      - Windows Event ID 4688
      - Zeek http.log
      - Zeek files.log
      - Externally-facing web servers hosting login portals (VPN, OWA, SharePoint)
    range: last 90 days
    queries:
      - "MODEL historical file modification times (Win Event 4663) to predict legitimate update windows. ON new modification event, IF event_time is outside predicted window, THEN ALERT and correlate with parent process (Win Event 4688)."
  - question: Is a web portal server sending outbound HTTP/S traffic containing credential-like data patterns to a non-allowlisted destination?
    context: This question aims to detect the direct exfiltration of captured credentials over the network. Analysts should inspect outbound web traffic from portal servers, looking for common credential-related keywords (e.g., 'username=', 'password=') in the URI or POST body. If such patterns are found in traffic destined for an IP or domain not on a pre-approved allowlist, it is a strong indicator of a breach.
    answer_sources:
      - Zeek http.log
      - Zeek conn.log
      - Zeek dns.log
      - Network egress points for the DMZ hosting the web portal servers
    range: last 90 days
    queries:
      - "SEARCH Zeek http.log for traffic from web_portal_server to external_IP. IF uri or post_body MATCHES credential regex AND destination NOT in allowlist, THEN ALERT."
  - question: Has a web portal server initiated a connection to a historically rare destination?
    context: This question uses the historical frequency of outbound connections to spot anomalies. Web servers typically communicate with a relatively stable set of external destinations. By baselining these connections, it becomes possible to flag any new connection to a destination that is statistically rare (e.g., in the bottom 5th percentile of frequency). This is particularly suspicious if the connection's payload size also deviates from the norm.
    answer_sources:
      - Zeek http.log
      - Zeek conn.log
      - Zeek dns.log
      - Network egress points for the DMZ hosting the web portal servers
    range: last 90 days
    queries:
      - "BASELINE outbound destination IPs, ASNs, and countries for each web server over 90 days. CALCULATE frequency. ON new connection, IF destination is below 5th percentile of frequency, THEN ALERT."
  - question: Has a machine learning model classified an outbound connection from a web portal server as an anomaly?
    context: This question leverages a one-class SVM or similar anomaly detection model to identify suspicious network connections. The model is trained on features from legitimate outbound traffic (e.g., port, duration, bytes transferred). It can then score new connections in real-time, flagging any that are mathematically dissimilar to the established baseline. An anomalous connection containing credential patterns is a high-confidence indicator of compromise.
    answer_sources:
      - Zeek http.log
      - Zeek conn.log
      - Zeek dns.log
      - Network egress points for the DMZ hosting the web portal servers
    range: last 90 days
    queries:
      - "TRAIN one-class SVM on features of legitimate outbound connections. DEPLOY model to score new connections from web servers. IF connection is flagged as an outlier AND contains credential patterns, THEN ALERT."
  - question: Was a login page modified by an unauthorized process, followed shortly by an outbound connection to a new external IP?
    context: This question correlates host and network events to build a high-fidelity alert. The logic requires a sequence of events: first, a file modification on a login page by a process not on the authorized list (e.g., not a standard deployment script); second, within minutes, an outbound network connection from that same server to a destination IP not seen in the last 30 days. This combination strongly suggests a compromise and subsequent data exfiltration.
    answer_sources:
      - Windows Event ID 4663
      - Windows Event ID 4688
      - Zeek conn.log
      - Web portal application servers and their associated host-based monitoring agents
    range: last 90 days
    queries:
      - "ON login page modification (Win Event 4663), CHECK if process (Win Event 4688) is NOT in allowlist. IF TRUE, monitor for outbound connection (Zeek conn.log) from same host within 5 mins to a new IP. IF all conditions met, THEN ALERT."
  - question: Did a process that modified a login page have command-line arguments with unusually high entropy?
    context: This question seeks to detect obfuscated commands used to modify web pages. Adversaries often use encoding or obfuscation to hide their actions, which results in command-line arguments with high Shannon entropy (a measure of randomness). By baselining the entropy of legitimate commands, any command with an unusually high score can be flagged as suspicious, especially if it is also tied to a rare outbound network connection.
    answer_sources:
      - Windows Event ID 4663
      - Windows Event ID 4688
      - Zeek conn.log
      - Web portal application servers and their associated host-based monitoring agents
    range: last 90 days
    queries:
      - "FOR each process (Win Event 4688) that modifies a login page, CALCULATE entropy of command line. IF entropy > 99th percentile of baseline AND correlates with rare outbound connection, THEN ALERT."
  - question: Has a sequence analysis model detected an anomalous series of events on a web server, such as a file write followed by a connection to a rare IP?
    context: This question uses advanced sequence modeling (like an HMM or LSTM) to understand the "grammar" of normal server operations. The model is trained on typical sequences of events during legitimate activities like software updates. It can then detect when a new sequence of events (e.g., a web process writes to a login page and then connects to an unknown IP) has a low probability of being legitimate, flagging it as a deviation from normal behavior.
    answer_sources:
      - Windows Event ID 4663
      - Windows Event ID 4688
      - Zeek conn.log
      - Web portal application servers and their associated host-based monitoring agents
    range: last 90 days
    queries:
      - "TRAIN a sequence model (e.g., HMM) on normal event sequences for software updates. FEED real-time event sequences into model. IF a sequence has a low probability score, THEN ALERT."
  - question: Is a web portal server connecting to a destination country or ASN that is not on its explicit allowlist?
    context: This is a straightforward but effective question based on policy enforcement. By defining a strict allowlist of countries and Autonomous System Numbers (ASNs) that a web server is permitted to communicate with, any connection to a destination outside this list can be immediately flagged as a policy violation and a potential security incident. This requires enriching network logs with GeoIP and ASN data.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Network sensor data at the DMZ egress point
    range: last 90 days
    queries:
      - "MAINTAIN allowlist of destination countries/ASNs for each web server. ON new connection, CHECK if destination country/ASN is NOT in allowlist. IF TRUE, THEN ALERT."
  - question: Has the outbound traffic profile of a web portal server shifted to a high-frequency, low-volume, or fixed-interval pattern indicative of beaconing?
    context: This question looks for changes in the rhythm and volume of network traffic that could signal command-and-control (C2) beaconing. Adversaries often use small, periodic "heartbeat" connections for C2. An alert should trigger if, for example, the connection count spikes while the average data per connection drops, or if the time between connections becomes highly regular (low standard deviation), suggesting automated activity.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Network sensor data at the DMZ egress point
    range: last 90 days
    queries:
      - "BASELINE hourly outbound traffic profile (bytes, connection count, time delta). IF connection count > 3 STDEV AND bytes < 50th percentile, OR IF STDEV of time delta between connections drops significantly, THEN ALERT."
  - question: Have there been sudden, unexplained spikes in a web server's outbound traffic volume?
    context: This question uses time-series decomposition to find anomalous bursts of data exfiltration. By breaking down the server's traffic data into trend, seasonality, and residual components, analysts can isolate the "unexplained" variations. A sudden, sharp peak in the residual data, which cannot be attributed to normal daily or weekly patterns, could represent a data theft event and should be investigated.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Network sensor data at the DMZ egress point
    range: last 90 days
    queries:
      - "APPLY time-series decomposition to outbound data volume per minute. ISOLATE the residual component. USE a peak-finding algorithm on the residual to detect sudden spikes. IF spike is detected, THEN ALERT."
  - question: Has a new file appeared in a web directory that matches a known malicious hash or contains a web shell signature?
    context: This question focuses on detecting the placement of malicious files, such as web shells, on a server. The approach is two-fold: first, check the hash of every new file against a threat intelligence database of known malware. Second, scan the file's content with YARA rules designed to find patterns and functions commonly used in web shells and credential harvesters. A match on either check should generate a high-priority alert.
    answer_sources:
      - Windows Event ID 4663
      - Windows Event ID 4688
      - File systems of externally-facing web servers, particularly web root and temporary directories
    range: last 90 days
    queries:
      - "ON file creation in web directory, COMPUTE SHA256 hash and query threat intel. SCAN file content with web shell YARA rules. IF hash or YARA rule matches, THEN ALERT."
  - question: Has a web server process spawned an anomalous child process, such as a command-line interpreter or system utility?
    context: This question targets a highly anomalous and suspicious behavior. Web server processes (like w3wp.exe or httpd) should not be spawning command shells (cmd.exe, powershell.exe) or system reconnaissance tools (whoami.exe). Such an event is a strong indicator that an attacker has achieved code execution on the server, likely through a web shell, and is attempting to perform further actions.
    answer_sources:
      - Windows Event ID 4688
      - Process execution logs on web portal servers
    range: last 90 days
    queries:
      - "SEARCH for process creation events (Win Event 4688) where ParentProcess is a web server process AND NewProcess is a shell, script engine, or recon tool. IF found, THEN ALERT."
  - question: Is a web server process repeatedly writing to a non-log file, with write times correlating to inbound login POST requests?
    context: This question aims to find hidden log files used by adversaries to store captured credentials. The query looks for a file that is not a typical log file (e.g., an image or CSS file) but is receiving frequent write events from a web process. By cross-correlating the timestamps of these writes with the timestamps of inbound POST requests to a login page, a strong connection can be established, indicating the file is being used to log submitted credentials.
    answer_sources:
      - Windows Event ID 4663
      - Zeek http.log
      - File system audit logs for web server directories, including temporary, image, and document root folders
    range: last 90 days
    queries:
      - "CREATE time series of write events to a suspicious file and a time series of inbound POST requests to a login page. CALCULATE cross-correlation. IF correlation > 0.7, THEN ALERT."
  - question: Has a web server process read a sensitive system file and then immediately written to a file in a temporary directory?
    context: This question identifies a common pattern for data staging. An attacker, having gained control of a web process, may use it to read sensitive data from a configuration file or system file (e.g., web.config, SAM hive). They then write that data to a new file in a temporary, world-writable directory to stage it for later exfiltration. This sequence of a read from a sensitive location followed by a write to a temp location by the same process is highly suspicious.
    answer_sources:
      - Windows Event ID 4663
      - Windows Event ID 4656
      - System-level audit logs on web servers, with SACLs configured for sensitive configuration files and registry hives
    range: last 90 days
    queries:
      - "ENABLE SACL auditing on sensitive files. ON read access (Event 4663/4656) by a web process to a protected file, CHECK for a write event (Event 4663) by the same process to a temp directory within 60 seconds. IF found, THEN ALERT."