name: 'T1588.002: Tool'
id: 'a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d'
description: 'This playbook helps determine if an adversary is acquiring or staging tools to support their operations. It focuses on identifying malicious tool acquisition through several methods: detecting downloads or network connections that match threat intelligence for known tool distribution sites or malicious file hashes; identifying command-line execution patterns, arguments, or obfuscation techniques characteristic of offensive security tools; observing the download and subsequent execution of a file from a non-standard, user-writable directory; and flagging statistically anomalous remote administration connections that suggest the use of a new remote access or lateral movement tool.'
type: 'technique'
related:
  - 'TA0042: Resource Development'
contributors:
  - 'Zachary Szewczyk'
  - 'Ask Sage'
created: '2025-10-01'
modified: '2025-10-01'
version: '1.0'
tags: 'none'
questions:
  - question: 'Have any hosts downloaded files with known malicious hashes or connected to network destinations associated with adversary tool distribution?'
    context: 'This question seeks to identify the most direct evidence of tool acquisition by matching observed activity against known-bad indicators. It involves two concurrent checks: 1) monitoring all network traffic (DNS, HTTP, general connections) for communications with IPs, domains, or URLs listed in threat intelligence feeds as tool hosting or distribution sites, and 2) scanning all new files and processes on endpoints to see if their file hashes match signatures of known malicious tools. A positive match on either check is a high-confidence indicator that an adversary is staging tools.'
    answer_sources:
      - 'Windows Event ID 4688'
      - 'Zeek conn.log'
      - 'Zeek dns.log'
      - 'Zeek files.log'
      - 'Zeek http.log'
      - 'Internet Gateway'
      - 'DNS Servers'
      - 'Endpoints'
    range: 'last 90 days'
    queries:
      - 'QUERY: Cross-reference network logs (DNS, HTTP) against threat intel feeds for tool distribution sites. Separately, check file creation and process execution logs for file hashes matching known malicious tool hashes.'
  - question: 'Are there any rare executables being downloaded from unusually random-looking domain names?'
    context: 'This question attempts to find unknown or novel adversary tools by searching for statistical anomalies. Adversaries often use custom tools that will be rare within a target environment, or they may use Domain Generation Algorithms (DGAs) to host them, resulting in high-entropy, random-looking domain names. This query identifies suspicious activity by finding the intersection of these two anomalies: an executable file that has been seen on very few hosts (e.g., <0.1% of the fleet) being downloaded from a high-entropy domain that is not on an established allowlist.'
    answer_sources:
      - 'Zeek conn.log'
      - 'Zeek dns.log'
      - 'Zeek files.log'
      - 'Zeek http.log'
      - 'Internet Gateway'
      - 'DNS Servers'
      - 'Endpoints'
    range: 'last 90 days'
    queries:
      - 'QUERY: Identify executable file hashes with low prevalence (<0.1% of hosts). Separately, identify high-entropy FQDNs not on an allowlist. Correlate to see if rare executables are downloaded from these suspicious domains.'
  - question: 'Can machine learning models identify network connections indicative of malicious tool downloads that evade signature-based detection?'
    context: 'This question proposes a proactive, advanced detection method for finding novel threats. By training a supervised classification model on the characteristics of known benign and malicious network connections (e.g., duration, protocol, data volume, domain age, IP reputation), a predictive system can be built. This system can then score all new, unclassified outbound connections, assigning a probability of maliciousness. A high probability score (>0.8), especially for a connection that involves a file transfer, is a strong signal of a potential tool download that would be missed by traditional IOC-based methods.'
    answer_sources:
      - 'Zeek conn.log'
      - 'Zeek dns.log'
      - 'Zeek files.log'
      - 'Zeek http.log'
      - 'Internet Gateway'
      - 'DNS Servers'
      - 'Endpoints'
    range: 'last 90 days'
    queries:
      - 'QUERY: Apply a pre-trained classification model to score new outbound network connections. Flag connections with a high malicious probability score, especially those associated with file transfers.'
  - question: 'Has any command-line activity been observed that matches signatures of known offensive security tools?'
    context: 'Adversaries frequently use well-known offensive security tools (e.g., Mimikatz, AdFind, PsExec) and PowerShell frameworks (e.g., PowerSploit). These tools often have unique and recognizable command-line syntax, arguments, or patterns. This question involves actively searching process creation logs (Event ID 4688) and PowerShell script block logs (Event ID 4104) for these specific malicious signatures using keyword or regular expression-based detection rules, such as those provided by the Sigma project.'
    answer_sources:
      - 'Windows Event ID 4688'
      - 'Windows Event ID 4104'
      - 'Endpoints'
      - 'Application Servers'
      - 'Domain Controllers'
    range: 'last 90 days'
    queries:
      - 'QUERY: Scan process command-line arguments and PowerShell script block logs for keywords, regex, or specific argument combinations matching Sigma rules for common offensive tools.'
  - question: 'Have any processes been executed with statistically rare or unusually complex/random command-line arguments?'
    context: 'This question aims to uncover novel or obfuscated tool usage by identifying statistical outliers in command-line activity. An adversary might use a custom tool or encode their commands, both of which would deviate from normal administrative activity. This is detected in two ways: 1) identifying commands that use arguments that are extremely infrequent compared to a historical baseline for that specific parent process, and 2) identifying commands that have unusually high character entropy, which can indicate the use of obfuscation, encoding (like Base64), or encryption.'
    answer_sources:
      - 'Windows Event ID 4688'
      - 'Windows Event ID 4104'
      - 'Endpoints'
      - 'Application Servers'
      - 'Domain Controllers'
    range: 'last 90 days'
    queries:
      - 'QUERY: Analyze command-line arguments for statistical rarity compared to a historical baseline. Flag commands with very infrequent arguments or high character entropy.'
  - question: 'Can unsupervised machine learning identify clusters of suspicious command-line activity without prior knowledge of specific tools?'
    context: 'This advanced technique uses unsupervised clustering algorithms (like DBSCAN) to automatically group similar command-line executions without relying on pre-existing signatures. Normal administrative and user activity will form large, dense clusters. The goal is to identify small, distinct clusters that are separate from these benign groups. Such outlier clusters may represent a novel or unknown adversary tool being used in a consistent manner, allowing for detection of new attack patterns.'
    answer_sources:
      - 'Windows Event ID 4688'
      - 'Windows Event ID 4104'
      - 'Endpoints'
      - 'Application Servers'
      - 'Domain Controllers'
    range: 'last 90 days'
    queries:
      - 'QUERY: Use a clustering algorithm (e.g., DBSCAN) on vectorized command-line data. Investigate small, distinct clusters that do not correspond to known benign activity.'
  - question: 'Has an executable file been downloaded and then quickly executed from a suspicious, non-standard directory?'
    context: 'This question targets the common "download and execute" TTP. Adversaries often drop malicious tools into directories that are user-writable by default and not intended for applications, such as C:\\Users\\Public\\, C:\\Windows\\Temp\\, or user download folders. This query correlates network logs showing an executable file download with endpoint logs showing process creation. An alert is triggered if the process is executed from one of these suspicious locations within a short time window (e.g., 10 minutes) of the download, indicating a likely tool staging event.'
    answer_sources:
      - 'Zeek files.log'
      - 'Zeek http.log'
      - 'Windows Event ID 4688'
      - 'Internet Gateway'
      - 'Endpoints'
      - 'Shared Network Drives'
    range: 'last 90 days'
    queries:
      - 'QUERY: Correlate network file download events with process creation events on the same host. Alert if an executable is run from a non-standard directory (e.g., C:\\Users\\Public) within 10 minutes of being downloaded.'
  - question: 'Have any common applications (like browsers or email clients) spawned unexpected child processes from unusual locations?'
    context: 'Benign applications typically exhibit predictable process behaviors. For instance, an email client like Outlook should not be spawning a command shell or an unknown executable. This question involves establishing a baseline of normal parent-child process relationships and the directories from which child processes are typically executed. The query then flags statistically rare occurrences, such as chrome.exe spawning an executable from C:\\PerfLogs\\, which could indicate that a malicious download or exploit was used to drop and run an adversary tool.'
    answer_sources:
      - 'Windows Event ID 4688'
      - 'Endpoints'
      - 'Shared Network Drives'
    range: 'last 90 days'
    queries:
      - 'QUERY: Baseline normal parent-child process relationships and execution paths. Alert on statistically rare combinations, especially involving common applications spawning processes from unexpected directories.'
  - question: 'Can a machine learning model detect anomalous sequences of events (e.g., network connection -> file write -> process create) that indicate tool staging?'
    context: 'This advanced approach models the chronological sequence of events on a host to detect anomalies. A neural network (like an autoencoder) is trained on vast amounts of normal event sequences to learn what constitutes benign behavior. It can then be fed real-time event streams from hosts. If it encounters a sequence (e.g., an inbound network connection followed by a file write to a temp folder followed by a process creation) that it cannot accurately reconstruct based on its training, it flags the sequence with a high "reconstruction error." This indicates a deviation from normalcy that may represent a malicious tool staging and execution chain.'
    answer_sources:
      - 'Zeek files.log'
      - 'Zeek http.log'
      - 'Windows Event ID 4688'
      - 'Internet Gateway'
      - 'Endpoints'
      - 'Shared Network Drives'
    range: 'last 90 days'
    queries:
      - 'QUERY: Feed host event sequences (network, file, process) into a trained autoencoder model. Investigate sequences that produce a high reconstruction error, indicating anomalous behavior.'
  - question: 'Has any user or host initiated a "first time" remote administrative connection to another host?'
    context: 'When adversaries gain access to a host, they often use remote administration protocols (RDP, WinRM, etc.) to move laterally to other systems. This question focuses on detecting this initial hop by maintaining a stateful record of all unique remote administrative connections. An alert is generated the first time a new connection is observed, such as a specific user on their workstation connecting to a high-value server they have never accessed before. This "first-of-its-kind" event is a strong indicator of potential lateral movement using a newly acquired tool or credential.'
    answer_sources:
      - 'Zeek conn.log'
      - 'Zeek dce_rpc.log'
      - 'Zeek rdp.log'
      - 'Windows Event ID 4624'
      - 'Windows Event ID 4648'
      - 'Internal Network Segments'
      - 'Domain Controllers'
      - 'High-Value Servers'
    range: 'last 90 days'
    queries:
      - 'QUERY: Track all remote administrative logons. Alert on any unique combination of (Source User, Source Host, Destination Host, Protocol) that has not been observed in the last 30-90 days.'
  - question: 'Is any user exhibiting an unusually high amount of remote logon activity compared to their own history or to their peers?'
    context: 'A compromised user account may be used by an adversary to access far more systems than the legitimate user typically would. This question seeks to detect this behavior by identifying statistical outliers. It performs two checks: 1) it compares a user''s current remote logon activity against their own historical baseline, flagging significant spikes (e.g., >3 standard deviations from the mean), and 2) it compares the user''s activity against their peer group (e.g., other members of the HR department), flagging users whose activity is in the top percentile. A user who is an outlier in either their personal or peer group behavior warrants investigation.'
    answer_sources:
      - 'Zeek conn.log'
      - 'Windows Event ID 4624'
      - 'Windows Event ID 4648'
      - 'Internal Network Segments'
      - 'Domain Controllers'
      - 'High-Value Servers'
    range: 'last 90 days'
    queries:
      - 'QUERY: Baseline each user''s remote logon frequency. Alert if a user''s activity exceeds their personal baseline (e.g., >3 standard deviations) or their peer group''s baseline (e.g., >98th percentile).'
  - question: 'Can graph analysis reveal improbable remote connections between distinct groups of assets that could signify lateral movement?'
    context: 'This advanced method models the network as a graph, where hosts are nodes and remote logons are connections (edges). Using community detection algorithms, it first identifies normal clusters of activity (e.g., the "developer workstations" community talks to the "source code servers" community). It then uses link prediction models to identify new connections that are highly improbable given the established graph structure. An example would be a new connection forming between a host in the "HR" community and a host in the "Domain Controllers" community, which could signify tool-facilitated lateral movement across security boundaries.'
    answer_sources:
      - 'Zeek conn.log'
      - 'Windows Event ID 4624'
      - 'Internal Network Segments'
      - 'Domain Controllers'
      - 'High-Value Servers'
    range: 'last 90 days'
    queries:
      - 'QUERY: Model hosts and remote logons as a graph. Use community detection and link prediction algorithms to flag new connections between otherwise disconnected clusters of hosts.'