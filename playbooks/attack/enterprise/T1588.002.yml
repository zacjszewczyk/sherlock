name: 'T1588.002: Tool'
id: 4f7b3b1a-8c1e-4a6f-9d1a-5e7c8b9a0d2f
description: This playbook helps investigate whether an adversary is acquiring or staging tools to support their operations. This is done by looking for evidence of malicious tool acquisition or use, such as executable file hashes matching known tool signatures, network connections to tool distribution sites, command-line patterns characteristic of offensive tools, executables being run from non-standard user-writable directories shortly after download, and anomalous remote administration connections that suggest the use of a newly acquired remote access or lateral movement tool.
type: technique
related:
  - 'TA0042: Resource Development'
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Have any internal hosts connected to known adversary tool distribution sites, or have any known malicious tools been observed on endpoints?
    context: This question aims to detect the acquisition of adversary tools by cross-referencing network traffic and file creation events against threat intelligence feeds. A match indicates that an adversary may be staging their toolkit within the environment.
    answer_sources:
      - Windows Event ID 4688
      - Zeek conn.log
      - Zeek dns.log
      - Zeek files.log
      - Zeek http.log
      - Internet Gateway
      - DNS Servers
      - Endpoints
      - Threat Intelligence Feeds
    range: last 90 days
    queries:
      - tech: pseudocode
        query: |
          JOIN (Zeek conn, dns, http logs) WHERE (destination_ip OR domain OR uri) IN (IOC_tool_sites_list)
          UNION
          SEARCH (WinEvent 4688, Zeek files.log) WHERE (file_hash) IN (IOC_tool_hashes_list)
  - question: Have any rare executable files been downloaded, or have any file downloads originated from unusually random-looking domain names?
    context: This question seeks to identify potentially malicious tools that are not yet known to threat intelligence. It operates on the principle that adversary tools are often rare within an enterprise environment, and that domain generation algorithms (DGAs) used for malware distribution often produce high-entropy domain names.
    answer_sources:
      - Windows Event ID 4688
      - Zeek conn.log
      - Zeek dns.log
      - Zeek files.log
      - Zeek http.log
      - Internet Gateway
      - DNS Servers
      - Endpoints
    range: last 30 days
    queries:
      - tech: pseudocode
        query: |
          SEARCH (Zeek files.log) FOR EXECUTABLES
          CALCULATE PREVALENCE GROUP BY file_hash
          ALERT WHERE host_count < 5
          ---
          SEARCH (Zeek dns.log) WHERE FQDN_entropy > 95th_percentile AND FQDN NOT IN allowlist
          JOIN (Zeek files.log) ON executable_download
          ALERT
  - question: Can machine learning models identify outbound network connections indicative of tool downloads that evade signature-based detection?
    context: This question leverages a supervised machine learning model to detect suspicious network behavior that may correspond to the download of malicious tools. By analyzing a combination of network flow features, the model can identify connections to previously unseen or unclassified destinations that have a high statistical probability of being malicious.
    answer_sources:
      - Windows Event ID 4688
      - Zeek conn.log
      - Zeek dns.log
      - Zeek files.log
      - Zeek http.log
      - Internet Gateway
      - DNS Servers
      - Endpoints
      - Domain/IP reputation services
    range: last 90 days
    queries:
      - tech: pseudocode
        query: |
          FOR each new outbound_connection to unclassified_destination:
            EXTRACT features (duration, protocol, bytes, etc.)
            ENRICH with (domain_age, ip_reputation)
            SCORE with pre-trained_classification_model
            ALERT if score > 0.8 AND is_file_transfer
  - question: Have any command-line executions matched signatures of known offensive security tools or PowerShell frameworks?
    context: This question focuses on detecting the use of malicious tools by searching for their unique command-line fingerprints. Many offensive tools have specific argument patterns or keywords that can be identified in process creation and PowerShell script block logs.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 4104
      - Endpoints
      - Application Servers
      - Domain Controllers
      - Sigma Rules repository
    range: last 90 days
    queries:
      - tech: pseudocode
        query: |
          SEARCH (WinEvent 4688 [CommandLine], WinEvent 4104 [ScriptBlockText])
          WHERE content MATCHES (Sigma_rules_for_offensive_tools)
  - question: Have any processes been executed with statistically rare or unusually complex/random command-line arguments?
    context: This question aims to find novel or obfuscated tool usage by flagging statistical anomalies. Commands with very infrequent arguments or high character entropy (randomness) can indicate attempts to evade signature-based detection, such as using custom scripts or encoded payloads.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 4104
      - Endpoints
      - Application Servers
      - Domain Controllers
    range: last 30 days
    queries:
      - tech: pseudocode
        query: |
          BASELINE command_line_arguments for each parent_process over 30 days.
          ALERT on new command if argument_frequency < 5th_percentile.
          ---
          BASELINE command_line_entropy for each parent_process.
          ALERT on new command if entropy > (mean + 3 * stdev).
  - question: Can unsupervised machine learning identify clusters of suspicious command-line activity that differ from normal administrative behavior?
    context: This question uses unsupervised learning to discover previously unknown malicious activity. By converting command lines into numerical vectors and clustering them, analysts can isolate small, anomalous groups of commands that represent rare and potentially malicious tool usage without relying on pre-existing signatures.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 4104
      - Endpoints
      - Application Servers
      - Domain Controllers
    range: last 90 days
    queries:
      - tech: pseudocode
        query: |
          VECTORIZE all command_lines using TF-IDF model.
          APPLY clustering algorithm (e.g., DBSCAN) to vectors.
          INVESTIGATE small, dense, outlier clusters.
  - question: Has an executable file been downloaded and then quickly executed from a temporary or user-writable directory?
    context: This question identifies a common adversary tactic of staging tools in inconspicuous locations. Correlating a network download event with a nearly immediate process execution from a non-application folder (like a user's Downloads folder or a temp directory) is a strong indicator of malicious tool deployment.
    answer_sources:
      - Zeek files.log
      - Zeek http.log
      - Windows Event ID 4688
      - Internet Gateway
      - Endpoints
      - Shared Network Drives
    range: last 90 days
    queries:
      - tech: pseudocode
        query: |
          JOIN (Zeek file/http logs) with (WinEvent 4688) on host_ip
          WHERE event_type == "executable download"
          AND followed by event_type == "process creation"
          AND time_delta < 10 minutes
          AND process_path IN (non_standard_directories_list)
  - question: Have any common applications (like browsers or email clients) spawned an unusual child process or launched a process from an unexpected directory?
    context: This question seeks to detect anomalies in parent-child process relationships. Benign applications typically spawn a predictable set of child processes from standard locations. An adversary might exploit a browser or email client to launch a malicious tool, creating a statistically rare parent-child process relationship that can be flagged for investigation.
    answer_sources:
      - Zeek files.log
      - Zeek http.log
      - Windows Event ID 4688
      - Internet Gateway
      - Endpoints
      - Shared Network Drives
    range: last 90 days
    queries:
      - tech: pseudocode
        query: |
          BASELINE frequency of (parent, child, child_path) tuples.
          ALERT on new tuple if frequency < 1st_percentile.
  - question: Can a machine learning model detect anomalous sequences of system events on a host that might indicate a tool being staged and executed?
    context: This question applies deep learning to detect complex attack chains. By training a model on normal sequences of host activities (e.g., network connection -> file write -> process create), it can identify new, unseen sequences that deviate from this learned norm. A high "reconstruction error" suggests the sequence is abnormal and could represent a malicious kill chain.
    answer_sources:
      - Zeek files.log
      - Zeek http.log
      - Windows Event ID 4688
      - Registry Logs
      - Internet Gateway
      - Endpoints
      - Shared Network Drives
    range: last 90 days
    queries:
      - tech: pseudocode
        query: |
          FOR each host's event_stream:
            CREATE sequences of events (e.g., net_conn, file_write, proc_create)
            FEED sequence into trained autoencoder model.
            CALCULATE reconstruction_error.
            ALERT if reconstruction_error > threshold.
  - question: Has any user or host initiated a remote administrative connection to another host for the very first time?
    context: This question is designed to detect the "first-time" use of a remote access pathway, which is a strong signal for lateral movement. By tracking all historical administrative connections, any new, never-before-seen connection (especially involving privileged accounts or sensitive servers) can be immediately flagged as suspicious.
    answer_sources:
      - Zeek conn.log
      - Zeek dce_rpc.log
      - Zeek rdp.log
      - Windows Event ID 4624
      - Windows Event ID 4648
      - Internal Network Segments
      - Domain Controllers
      - High-Value Servers
    range: last 30 days
    queries:
      - tech: pseudocode
        query: |
          MAINTAIN stateful table of (src_user, src_host, dst_host, logon_type, protocol) over 30 days.
          ON new connection:
            CHECK if tuple exists in table.
            IF NOT EXISTS and protocol is administrative:
              ALERT.
            ELSE:
              ADD tuple to table.
  - question: Is any user exhibiting an unusual amount of remote logon activity compared to their own history or to their peer group?
    context: This question hunts for outliers in remote access behavior. An adversary who has compromised an account may use it to connect to an abnormally large number of machines. This behavior can be detected by comparing a user's activity against their own normal baseline (self-anomaly) or against the typical behavior of their colleagues (peer-group anomaly).
    answer_sources:
      - Zeek conn.log
      - Zeek dce_rpc.log
      - Zeek rdp.log
      - Windows Event ID 4624
      - Windows Event ID 4648
      - Internal Network Segments
      - Domain Controllers
      - High-Value Servers
      - User/Group directory
    range: last 90 days
    queries:
      - tech: pseudocode
        query: |
          BASELINE daily remote_logon_count per user.
          ALERT if today's count > (mean + 3 * stdev).
          ---
          COMPARE user's remote_access_count to peer_group.
          ALERT if user's count > 98th_percentile of group.
  - question: Are there any new remote connections that bridge previously separate clusters of hosts within the network?
    context: This question uses graph analysis to model the network's social structure. It identifies normal "communities" of hosts that frequently interact. A new connection between two otherwise disconnected communities (e.g., a host in the HR cluster suddenly connecting to a host in the server admin cluster) is highly improbable and a strong indicator of tool-assisted lateral movement.
    answer_sources:
      - Zeek conn.log
      - Zeek dce_rpc.log
      - Zeek rdp.log
      - Windows Event ID 4624
      - Windows Event ID 4648
      - Internal Network Segments
      - Domain Controllers
      - High-Value Servers
    range: last 90 days
    queries:
      - tech: pseudocode
        query: |
          BUILD graph with hosts as nodes and logons as edges.
          IDENTIFY communities using Louvain algorithm.
          USE link prediction model to score potential new edges.
          ALERT on new, low-probability edges that bridge communities.