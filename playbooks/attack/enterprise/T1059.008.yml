name: T1059.008: Network Device CLI
id: f47ac10b-58cc-4372-a567-0e02b2c3d479
description: This playbook helps investigate whether an adversary has gained execution on a network device by abusing its command-line interface (CLI). It looks for indicators such as management sessions from malicious IPs, suspicious command sequences like disabling logging before creating a user, anomalous login properties (e.g., unusual location or time), unauthorized configuration changes not tied to a change request, and outbound connections from network devices to non-approved destinations.
type: technique
related:
  - TA0002: Execution
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Have any network management sessions (SSH/Telnet) originated from IP addresses known to be malicious?
    context: This question aims to detect initial access or lateral movement attempts where an adversary uses a compromised host, part of their infrastructure, to log into a network device. Correlating session source IPs with threat intelligence feeds provides a direct way to identify connections from known bad actors.
    answer_sources:
      - Zeek conn.log
      - Zeek ssh.log
      - Zeek telnet.log
      - Zeek syslog.log
      - Windows Event ID 4624
      - Windows Event ID 4776
      - NAI: Edge firewalls, core routers, distribution/access layer switches, VPN concentrators, RADIUS/TACACS+ servers
    range: Last 90 days
    queries:
      - pseudocode: Search Zeek conn.log for connections where destination port is 22 or 23. Join source IP with threat intelligence feed. Alert on match.
  - question: Have any unusually rare commands been executed on network devices?
    context: Adversaries may use obscure or infrequently used commands to perform reconnaissance, configure persistence, or evade detection. By establishing a baseline of normal command usage and alerting on statistical outliers (rare commands), this question helps identify novel or suspicious activity that deviates from standard administrative practices.
    answer_sources:
      - Zeek syslog.log
      - NAI: Edge firewalls, core routers, distribution/access layer switches, VPN concentrators, RADIUS/TACACS+ servers
    range: Last 90 days
    queries:
      - pseudocode: Parse commands from syslog. Calculate 1-gram frequency over a baseline period. Search for commands containing tokens with a frequency below the 1st percentile. Alert on match.
  - question: Have any commands executed on network devices shown signs of obfuscation or exploitation techniques?
    context: Attackers often obfuscate commands to bypass simple signature-based detection. This question uses a Natural Language Processing (NLP) model to analyze the structure and content of commands, looking for complex patterns that suggest malicious intent, such as attempts to exploit a vulnerability or hide actions. A high confidence score from the model indicates a strong likelihood of malicious activity.
    answer_sources:
      - Zeek syslog.log
      - NAI: Edge firewalls, core routers, distribution/access layer switches, VPN concentrators, RADIUS/TACACS+ servers
    range: Last 90 days
    queries:
      - pseudocode: Pipe command strings from syslog into a pre-trained NLP classification model. Alert if the maliciousness confidence score is > 0.9.
  - question: Has a user disabled logging and then created a privileged user within a short timeframe?
    context: This sequence of actions is highly indicative of an adversary attempting to cover their tracks. Disabling logging prevents their subsequent actions, like creating a backdoor account, from being recorded. Detecting this specific, ordered pair of events is a strong signal of a compromise.
    answer_sources:
      - Zeek syslog.log
      - Network device configuration backups
      - NAI: Centralized syslog servers, TACACS+/RADIUS authentication servers, core network infrastructure
    range: Last 90 days
    queries:
      - pseudocode: From syslog, group events by source IP and hostname. Search for a logging-disabled event followed by a user-creation event within a 10-minute window. Alert on match.
  - question: Have any suspicious or highly improbable sequences of commands been executed during an administrative session?
    context: Normal administrative tasks often follow predictable patterns. This question models these patterns as a Markov chain, calculating the probability of one command following another. A sequence of commands with a very low transition probability suggests an unusual and potentially malicious workflow that deviates from established operational behavior.
    answer_sources:
      - Zeek syslog.log
      - Network device configuration backups
      - NAI: Centralized syslog servers, TACACS+/RADIUS authentication servers, core network infrastructure
    range: Last 90 days
    queries:
      - pseudocode: Build a Markov chain model of command transitions from a 90-day baseline. For new sessions, calculate transition probabilities. Alert if any transition probability is below the threshold (e.g., < 0.005).
  - question: Has any administrative session contained a sequence of commands that is anomalous compared to normal behavior?
    context: This question uses an LSTM autoencoder, a type of neural network adept at learning normal sequences, to profile benign administrative sessions. When a new session's command sequence is processed, the model tries to reconstruct it. A high reconstruction error means the model struggled to understand the sequence, indicating it is a significant outlier from all previously observed normal activity and is therefore highly suspicious.
    answer_sources:
      - Zeek syslog.log
      - Network device configuration backups
      - NAI: Centralized syslog servers, TACACS+/RADIUS authentication servers, core network infrastructure
    range: Last 90 days
    queries:
      - pseudocode: Process command sequences from new sessions through a trained LSTM autoencoder. Calculate the reconstruction error. Alert if the error exceeds the 99th percentile of baseline errors.
  - question: Have any administrative logins to network devices originated from unauthorized geographic locations or networks?
    context: Administrative access to critical network infrastructure should typically come from known, trusted locations and networks (ASNs). This question checks if a login originates from a country or network not on a pre-approved allow-list. Such a login is a strong indicator of an external adversary or a compromised remote-access account.
    answer_sources:
      - Zeek conn.log
      - Zeek ssh.log
      - Zeek telnet.log
      - Windows Event ID 4624
      - Windows Event ID 4776
      - NAI: VPN concentrators, jump boxes/bastion hosts, network management subnets, Domain Controllers, RADIUS/TACACS+ servers
    range: Last 90 days
    queries:
      - pseudocode: For successful SSH/Telnet connections, enrich source IP with GeoIP and ASN data. Compare against an allow-list of countries and ASNs. Alert on any connection from a non-allowed source.
  - question: Have any administrative logins exhibited a combination of multiple suspicious properties?
    context: A single anomaly might be benign, but a combination of several suspicious factors significantly increases the likelihood of malicious activity. This question creates a risk score for each login session by combining factors like unusual login time, rare source network, rare geographic location, and abnormal session duration. A high cumulative score indicates a session that is anomalous across multiple dimensions and warrants immediate investigation.
    answer_sources:
      - Zeek conn.log
      - Zeek ssh.log
      - Zeek telnet.log
      - Windows Event ID 4624
      - Windows Event ID 4776
      - NAI: VPN concentrators, jump boxes/bastion hosts, network management subnets, Domain Controllers, RADIUS/TACACS+ servers
    range: Last 90 days
    queries:
      - pseudocode: For each admin login, compare login time, source ASN, source country, and session duration against the user's 90-day baseline. Assign risk points for deviations. Alert if the total score is >= 3.
  - question: Have any administrative login sessions been identified as outliers when compared to established patterns of activity?
    context: This question uses an unsupervised machine learning algorithm (DBSCAN) to group similar login sessions into clusters representing "normal" behavior. Sessions that do not fit into any cluster are flagged as noise or outliers. This approach is powerful for detecting novel attack patterns, as it doesn't rely on pre-defined rules but instead identifies any activity that deviates from the established norms of the user population.
    answer_sources:
      - Zeek conn.log
      - Zeek ssh.log
      - Zeek telnet.log
      - Windows Event ID 4624
      - Windows Event ID 4776
      - NAI: VPN concentrators, jump boxes/bastion hosts, network management subnets, Domain Controllers, RADIUS/TACACS+ servers
    range: Last 90 days
    queries:
      - pseudocode: Create feature vectors for login sessions (user, source ASN, hour, duration). Apply a clustering algorithm like DBSCAN. Alert on any session classified as a noise point (outlier).
  - question: Have any network device configuration changes occurred without a corresponding approved change request ticket?
    context: In a mature operational environment, all changes to network devices should be documented and approved via a change management system. This question automates the verification process by cross-referencing configuration change logs with the change management system. A change made without an associated ticket is unauthorized and could be the result of malicious activity.
    answer_sources:
      - Zeek syslog.log
      - Network device configuration backups
      - CMDB/ITSM API
      - NAI: Configuration backup repositories, change management system (e.g., ServiceNow, Jira), centralized syslog servers
    range: Last 90 days
    queries:
      - pseudocode: On a configuration change event from syslog, query the ITSM API for an approved change ticket for the device within a +/- 1 hour window. Alert if no ticket is found.
  - question: Have any network devices undergone an unusually large configuration change compared to their historical baseline?
    context: While configuration changes are normal, the size of the change can be an indicator of suspicious activity. An adversary might make extensive modifications to establish persistence or reroute traffic. This question calculates the "edit distance" between daily configuration backups to quantify the magnitude of change. An alert is triggered if a change is statistically much larger than is typical for that type of device.
    answer_sources:
      - Zeek syslog.log
      - Network device configuration backups
      - CMDB/ITSM API
      - NAI: Configuration backup repositories, change management system (e.g., ServiceNow, Jira), centralized syslog servers
    range: Last 90 days
    queries:
      - pseudocode: Daily, calculate the normalized Levenshtein distance between the current and previous day's configuration backup for each device. Alert if the distance exceeds the 99th percentile for that device type.
  - question: Has there been an anomalous spike in the number of configuration changes on a device that cannot be explained by normal trends or seasonality?
    context: The frequency of configuration changes can have predictable patterns (e.g., more changes during business hours or specific maintenance windows). This question uses a time series model to decompose the change frequency into trend, seasonal, and residual components. By alerting on large spikes in the residual component, it can identify an abnormal burst of activity that doesn't fit any known pattern, which could indicate an automated attack or frantic activity by an adversary.
    answer_sources:
      - Zeek syslog.log
      - Network device configuration backups
      - CMDB/ITSM API
      - NAI: Configuration backup repositories, change management system (e.g., ServiceNow, Jira), centralized syslog servers
    range: Last 90 days
    queries:
      - pseudocode: Model the daily count of configuration changes per device using time series decomposition. Alert if the residual component for a day exceeds 3 standard deviations from its mean.
  - question: Have any network infrastructure devices initiated outbound connections to unauthorized destinations?
    context: Network devices like routers and switches should only initiate outbound connections to a very limited, well-defined set of destinations for management purposes (e.g., syslog, NTP, TACACS+). This question checks all outbound connections from these devices against a strict allow-list. Any connection to an unapproved destination is highly anomalous and a strong indicator of compromise, potentially for command and control (C2) or data exfiltration.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - NAI: Network device management VLANs, core and edge routers, internet gateways
    range: Last 90 days
    queries:
      - pseudocode: Filter Zeek conn.log for traffic originating from network device IP ranges. Compare the destination IP and port against an allow-list. Alert on any connection not on the list.
  - question: Is any network device connecting to an unusually diverse set of destination ports?
    context: Normally, a network device communicates with a small, predictable set of destination ports. An adversary might use a device to scan other hosts or communicate with a C2 server using non-standard ports. This question measures the diversity of destination ports using Shannon entropy. A sudden increase in entropy indicates the device is connecting to a wider and more random set of ports than usual, which is a suspicious deviation.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - NAI: Network device management VLANs, core and edge routers, internet gateways
    range: Last 90 days
    queries:
      - pseudocode: For each network device, calculate Shannon entropy of destination ports over a 24-hour window. Compare to a 30-day historical baseline. Alert if the current value exceeds the 98th percentile.
  - question: Has any outbound connection from a network device been identified as anomalous based on its protocol, port, and data volume?
    context: This question uses a machine learning model (OC-SVM) to create a multi-dimensional profile of "normal" outbound connections from network devices, considering factors like protocol, port, and the amount of data transferred. The model can then identify any new connection that doesn't fit this learned profile. This is effective for detecting subtle anomalies, such as a connection on an allowed port but with an unusually large data transfer, which might indicate data exfiltration.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - NAI: Network device management VLANs, core and edge routers, internet gateways
    range: Last 90 days
    queries:
      - pseudocode: Train an OC-SVM model on a baseline of benign outbound connection features (protocol, port, bytes). Classify new connections in real-time. Alert on any connection flagged as an anomaly.