name: 'T1585: Establish Accounts'
id: 'f47ac10b-58cc-4372-a567-0e02b2c3d479'
description: 'This playbook focuses on detecting adversaries establishing accounts on external services for use in targeting the organization. It identifies this activity by monitoring for inbound emails from known malicious infrastructure, from newly registered or typosquatted domains, and by identifying unusual sending patterns such as low-volume, high-recipient emails. The playbook also looks for anomalous volumes of email from free webmail providers and the creation of accounts on external services using corporate emails or impersonating key employees.'
type: 'technique'
related:
  - 'TA0042: Resource Development'
contributors: 'Zachary Szewczyk, Ask Sage'
created: '2025-10-01'
modified: '2025-10-01'
version: 1.0
tags: 'none'
questions:
  - question: 'Has an inbound email been received from an IP address or domain that is on a threat intelligence watchlist?'
    context: |
      This question aims to identify direct communication from known malicious infrastructure. Adversaries often reuse command and control (C2) servers, phishing domains, or other infrastructure across campaigns. Matching an inbound email's source IP or domain against a high-confidence threat intelligence feed provides a strong, initial indicator of malicious activity, allowing for rapid response and containment.
    answer_sources:
      - 'Zeek conn.log'
      - 'Zeek smtp.log'
      - 'Cloud-based Email Security Service'
      - 'On-premise Mail Transfer Agent (MTA)'
      - 'Network Egress/Ingress Points (Firewalls/Proxies)'
    range: 'last 90 days'
    queries:
      - technology: 'pseudocode'
        query: |
          SEARCH Zeek conn.log FOR id.orig_h IN threat_intel_watchlist
          SEARCH Zeek smtp.log FOR sender_domain IN threat_intel_watchlist
          IF match THEN ALERT high_severity
  - question: 'Can we risk-score inbound emails based on the threat intelligence associated with their source?'
    context: |
      Not all threat intelligence indicators carry the same weight. This question moves beyond simple matching to a more nuanced risk assessment. By scoring indicators based on the intelligence provider's reliability and the indicator's age, analysts can prioritize alerts more effectively. A dynamic threshold based on recent activity helps adapt to changing threat landscapes and reduces alert fatigue from stale or low-confidence IOCs.
    answer_sources:
      - 'Zeek conn.log'
      - 'Zeek smtp.log'
      - 'Cloud-based Email Security Service'
      - 'On-premise Mail Transfer Agent (MTA)'
      - 'Network Egress/Ingress Points (Firewalls/Proxies)'
    range: 'last 90 days'
    queries:
      - technology: 'pseudocode'
        query: |
          FOR each IOC_match FROM threat_intel_feed:
            CALCULATE risk_score = (weight_of_feed * (1 / age_of_IOC))
            CALCULATE threshold = 95th_percentile_of_scores_last_7_days
            IF risk_score > threshold THEN ALERT
  - question: 'Can a machine learning model predict if an inbound email connection is malicious based on network and CTI features?'
    context: |
      This question seeks to proactively identify malicious activity that may not yet be present in threat intelligence feeds. By training a classification model on features like IP geolocation, ASN, protocol, port, and domain reputation, the system can learn the characteristics of malicious connections. This allows for the detection of novel threats and provides a probabilistic score for each connection, enabling analysts to focus on the most likely malicious inbound traffic.
    answer_sources:
      - 'Zeek conn.log'
      - 'Zeek smtp.log'
      - 'Cloud-based Email Security Service'
      - 'On-premise Mail Transfer Agent (MTA)'
      - 'Network Egress/Ingress Points (Firewalls/Proxies)'
    range: 'last 90 days'
    queries:
      - technology: 'pseudocode'
        query: |
          FOR each new inbound_connection:
            EXTRACT features (geolocation, ASN, protocol, sender_rep, etc.)
            PREDICT probability_malicious = ML_model(features)
            IF probability_malicious > 0.90 THEN ALERT
  - question: 'Has an inbound email been received from a typosquatted domain or a domain registered within the last 30 days?'
    context: |
      Adversaries frequently register domains that are visually similar to legitimate ones (typosquatting) or use newly created domains for phishing campaigns to evade reputation-based blocking. This question aims to detect these two common techniques. By checking against a list of known typosquat variations and querying the WHOIS registration date of sender domains, we can identify suspicious emails that might otherwise appear legitimate.
    answer_sources:
      - 'Zeek smtp.log'
      - 'Zeek dns.log'
      - 'External WHOIS Data'
      - 'Email Gateway'
      - 'Internal/External DNS Resolvers'
      - 'Domain Registrar Data Feeds'
    range: 'last 90 days'
    queries:
      - technology: 'pseudocode'
        query: |
          FOR each new email in smtp.log:
            IF sender_domain IN typosquat_list THEN ALERT
            PERFORM WHOIS_lookup(sender_domain)
            IF domain_creation_date < 30_days_ago THEN ALERT
  - question: 'Are we receiving emails from domains that are anomalously new compared to typical inbound mail?'
    context: |
      Instead of using a fixed 30-day window, this question uses a statistical approach to identify suspicious domains. By establishing a baseline of domain ages for all inbound mail, we can dynamically identify outliers. An email from a domain whose age falls in the bottom 5th percentile is statistically unusual for the organization and warrants investigation, as it suggests the sender is not a typical, established correspondent.
    answer_sources:
      - 'Zeek smtp.log'
      - 'Zeek dns.log'
      - 'External WHOIS Data'
      - 'Email Gateway'
      - 'Internal/External DNS Resolvers'
      - 'Domain Registrar Data Feeds'
    range: 'last 90 days'
    queries:
      - technology: 'pseudocode'
        query: |
          CALCULATE domain_age_percentile_5th = percentile(domain_ages_last_90_days, 5)
          FOR each new inbound email:
            FETCH domain_age
            IF domain_age < domain_age_percentile_5th THEN ALERT medium_severity
  - question: 'Is there an anomalous spike in the number of newly registered domains sending us email?'
    context: |
      This question seeks to detect a sudden influx of emails from new domains, which could indicate the start of a large-scale phishing or spam campaign. By using a time series forecasting model, we can predict the expected number of new domains. An actual count that significantly exceeds the forecast's upper confidence bound is a strong indicator of an organized, anomalous event that requires immediate attention.
    answer_sources:
      - 'Zeek smtp.log'
      - 'Zeek dns.log'
      - 'External WHOIS Data'
      - 'Email Gateway'
      - 'Internal/External DNS Resolvers'
      - 'Domain Registrar Data Feeds'
    range: 'last 90 days'
    queries:
      - technology: 'pseudocode'
        query: |
          MODEL daily_new_domain_count with time_series_forecast
          GET daily_count_of_new_domains_age_less_than_30_days
          IF daily_count > forecast_upper_confidence_interval THEN ALERT
  - question: 'Has a single external source sent a low number of emails to a high number of internal recipients without receiving any replies?'
    context: |
      This question targets a common reconnaissance or phishing technique known as 'low and slow' or password spraying pre-checks. An adversary may send a small number of emails to many different employees to validate email addresses or conduct a broad but shallow phishing attempt. The lack of replies is key, as it distinguishes this activity from legitimate mass mailings (like newsletters) where some interaction is expected. This behavior is highly suspicious and warrants investigation.
    answer_sources:
      - 'Zeek smtp.log'
      - 'Zeek conn.log'
      - 'Mail Exchange (MX) Servers'
      - 'Email Gateway'
      - 'Network Egress Points'
    range: 'last 24 hours'
    queries:
      - technology: 'pseudocode'
        query: |
          AGGREGATE smtp.log over 24h window by source_ip/domain
            unique_recipients = COUNT_UNIQUE(recipient)
            total_emails = COUNT(email)
          IF unique_recipients > 10 AND total_emails < 20:
            CHECK conn.log for reply_traffic_from_recipients_to_source
            IF no_reply_traffic THEN ALERT
  - question: 'Can we detect anomalous sending patterns by analyzing the distribution of recipients for a given sender?'
    context: |
      This question provides a statistical method to identify suspicious sending behavior. Legitimate senders often have predictable recipient patterns, while an adversary conducting reconnaissance may have a highly random (high entropy) recipient list. By flagging senders with both high recipient entropy (top 5%) and low email volume (bottom 10%), we can pinpoint actors who are likely probing the organization rather than engaging in legitimate communication.
    answer_sources:
      - 'Zeek smtp.log'
      - 'Zeek conn.log'
      - 'Mail Exchange (MX) Servers'
      - 'Email Gateway'
      - 'Network Egress Points'
    range: 'last 24 hours'
    queries:
      - technology: 'pseudocode'
        query: |
          FOR each sender in 24h window:
            CALCULATE shannon_entropy(recipient_list)
            CALCULATE total_email_volume
          IF entropy IN top_5_percentile AND volume IN bottom_10_percentile THEN ALERT
  - question: 'Can we use graph analysis and clustering to identify anomalous senders who do not fit normal communication patterns?'
    context: |
      This question applies unsupervised machine learning to discover outlier senders. By representing sender-recipient relationships as a graph and then clustering senders based on features like recipient count and email volume, we can group legitimate senders into clusters. Senders that do not belong to any cluster (identified as 'noise' by algorithms like DBSCAN) are, by definition, anomalous and may represent suspicious probing or phishing activity that deviates from established communication norms.
    answer_sources:
      - 'Zeek smtp.log'
      - 'Zeek conn.log'
      - 'Mail Exchange (MX) Servers'
      - 'Email Gateway'
      - 'Network Egress Points'
    range: 'last 90 days'
    queries:
      - technology: 'pseudocode'
        query: |
          CREATE bipartite_graph of sender-recipient interactions
          FOR each sender, CREATE feature_vector (recipient_count, email_count, etc.)
          APPLY DBSCAN clustering to sender feature_vectors
          FOR each sender identified as noise_point THEN FLAG_FOR_INVESTIGATION
  - question: 'Has the number of unique source IPs from a single free webmail or dynamic DNS domain exceeded a set threshold in a short time frame?'
    context: |
      This question aims to detect abuse of legitimate services. An adversary might use a botnet or many compromised accounts from a single provider (e.g., Gmail) to launch an attack. A sudden spike in the number of unique IP addresses originating from a single, high-risk domain category within an hour suggests a distributed, coordinated effort and is a strong indicator of malicious activity, bypassing single-IP reputation blocks.
    answer_sources:
      - 'Zeek conn.log'
      - 'Zeek smtp.log'
      - 'Zeek dns.log'
      - 'Email Gateway'
      - 'DNS Resolvers'
      - 'Network Egress/Ingress Points (Firewalls/Proxies)'
    range: 'last 1 hour'
    queries:
      - technology: 'pseudocode'
        query: |
          MAINTAIN categorized_domain_list (webmail, dyndns, etc.)
          IN 1-hour window, for each domain on list:
            COUNT unique source_ips
            IF unique_source_ip_count > 100 THEN ALERT
  - question: 'Has the daily email volume or data transfer from a high-risk domain category (like free webmail) significantly deviated from its historical average?'
    context: |
      This question uses statistical process control (the '3-sigma rule') to detect anomalies in communication volume. While some level of traffic from free webmail providers is normal, a sudden, large increase in email count or data volume can signal a campaign. By comparing daily volume to a 30-day moving average, this method accounts for normal fluctuations and seasonality, alerting only on statistically significant deviations that could represent an attack.
    answer_sources:
      - 'Zeek conn.log'
      - 'Zeek smtp.log'
      - 'Zeek dns.log'
      - 'Email Gateway'
      - 'DNS Resolvers'
      - 'Network Egress/Ingress Points (Firewalls/Proxies)'
    range: 'last 90 days'
    queries:
      - technology: 'pseudocode'
        query: |
          FOR each domain_category (webmail, etc.):
            CALCULATE 30-day_moving_average and standard_deviation for email_count and data_volume
            GET current_daily_volume
            IF current_daily_volume > (moving_average + 3 * std_dev) THEN ALERT
  - question: 'Can an unsupervised machine learning model detect anomalous communication patterns from high-risk domain categories?'
    context: |
      This question advances from simple statistical thresholds to a more sophisticated, unsupervised machine learning approach. A model like Isolation Forest can learn complex, multi-dimensional patterns in time-series data, including seasonality and normal business cycles. It can then identify hourly connection counts that are statistical outliers, representing a significant deviation from the learned norm. This is more robust than static thresholds and can detect more subtle anomalies.
    answer_sources:
      - 'Zeek conn.log'
      - 'Zeek smtp.log'
      - 'Zeek dns.log'
      - 'Email Gateway'
      - 'DNS Resolvers'
      - 'Network Egress/Ingress Points (Firewalls/Proxies)'
    range: 'last 90 days'
    queries:
      - technology: 'pseudocode'
        query: |
          FOR each high-risk_domain_category:
            TRAIN anomaly_detection_model on hourly_connection_counts
            FOR each new hour's connection_count:
              IF model.predict(count) == 'anomaly' THEN ALERT
  - question: 'Has a corporate email address been used to create an account on a non-sanctioned external service, or has a new profile impersonating a key employee been detected?'
    context: |
      This question addresses two critical risks: data exfiltration/credential exposure and executive impersonation. A CASB policy can detect when corporate emails are used for sign-ups on unsanctioned services, indicating potential shadow IT or credential stuffing. Simultaneously, using an OSINT service to monitor for new profiles impersonating key personnel (like the CEO or CFO) can provide early warning of targeted phishing or social engineering campaigns.
    answer_sources:
      - 'CASB Logs'
      - 'Web Proxy Logs'
      - 'OSINT Monitoring Service Data'
      - 'Windows Event ID 4663'
      - 'Cloud Access Security Broker (CASB)'
      - 'Secure Web Gateway'
      - 'Public Internet (Social Media, Code Repositories)'
      - 'File Servers hosting HR data'
    range: 'last 90 days'
    queries:
      - technology: 'pseudocode'
        query: |
          CASB_ALERT on account_creation IF platform NOT IN sanctioned_list AND email_domain IS corporate
          OSINT_ALERT IF new_profile_name IN key_employee_watchlist
  - question: 'Have internal users visited a newly created, low-engagement social media profile that claims to be an employee?'
    context: |
      This question aims to detect the 'lure' phase of a social engineering attack. After an adversary creates a fake persona (identified via OSINT), they may try to entice internal employees to connect with or visit that profile. By baselining normal web traffic and alerting when a user visits a newly created, low-follower profile, security teams can identify potential targets of social engineering and investigate the suspicious profile before a larger attack occurs.
    answer_sources:
      - 'CASB Logs'
      - 'Web Proxy Logs'
      - 'OSINT Monitoring Service Data'
      - 'Windows Event ID 4663'
      - 'Cloud Access Security Broker (CASB)'
      - 'Secure Web Gateway'
      - 'Public Internet (Social Media, Code Repositories)'
      - 'File Servers hosting HR data'
    range: 'last 90 days'
    queries:
      - technology: 'pseudocode'
        query: |
          GET new_suspicious_profile from OSINT_feed
          SEARCH web_proxy_logs for visits to new_suspicious_profile.url
          IF visit_found THEN ALERT
  - question: 'Can we use machine learning and NLP to automatically identify and classify suspicious social media profiles impersonating our employees?'
    context: |
      This question seeks to automate the detection of impersonation at scale. An NLP model can parse unstructured text from social media bios to find mentions of the organization's name. A subsequent classification model can then analyze features of the profile (account age, follower count, post frequency, etc.) to distinguish between legitimate new employees and suspicious, fake personas. This automates a manual, time-consuming investigation and allows for faster detection of impersonation campaigns.
    answer_sources:
      - 'CASB Logs'
      - 'Web Proxy Logs'
      - 'OSINT Monitoring Service Data'
      - 'Windows Event ID 4663'
      - 'Cloud Access Security Broker (CASB)'
      - 'Secure Web Gateway'
      - 'Public Internet (Social Media, Code Repositories)'
      - 'File Servers hosting HR data'
    range: 'last 90 days'
    queries:
      - technology: 'pseudocode'
        query: |
          FOR each new profile from OSINT_feed:
            EXTRACT entities (person_name, company_name) using NLP
            IF company_name == our_organization:
              PREDICT is_suspicious = classification_model(profile_features)
              IF is_suspicious == TRUE THEN ALERT