name: T1003.008: -etc-passwd and -etc-shadow
id: f47ac10b-58cc-4372-a567-0e02b2c3d479
description: This playbook helps determine if an adversary has attempted to acquire credentials from Linux hosts by accessing /etc/passwd or /etc/shadow files. This is achieved by looking for indicators such as anomalous outbound network connections to rare or malicious destinations, process executions that read or copy these sensitive files, network traffic containing the specific format of these files, unauthorized file access events, and correlations between file access and subsequent network exfiltration.
type: technique
related:
  - TA0006: Credential Access
contributors:
  - Zachary Szewczyk, Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Are there any outbound network connections from Linux servers to destinations known to be malicious?
    context: This question seeks to identify data exfiltration or command-and-control (C2) communication following the theft of /etc/passwd or /etc/shadow. By joining network logs with threat intelligence feeds, we can detect connections to IPs, domains, or TOR nodes associated with known adversaries.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Network egress points, DNS resolvers, and border routers monitoring traffic originating from Linux server subnets.
    range: last 90 days
    queries:
      - search_technology: Pseudocode
        query: JOIN network_logs ON destination_ip WITH dns_logs ON query_name. RESOLVE query_name to IP. CHECK if destination_ip OR resolved_ip IN threat_intelligence_feed (malicious, C2, TOR).
  - question: Have any Linux servers initiated outbound connections to statistically rare destinations?
    context: Adversaries often use novel or unusual infrastructure for data exfiltration. This question helps identify anomalous connections by comparing the destination Autonomous System Number (ASN) and country against a historical baseline. A connection to a destination rarely seen before for a specific server is a strong indicator of suspicious activity.
    answer_sources:
      - Zeek conn.log
      - Network egress points, DNS resolvers, and border routers monitoring traffic originating from Linux server subnets.
    range: last 90 days
    queries:
      - search_technology: Pseudocode
        query: FOR each_server, BASELINE destination_asn, destination_country from last 30 days of network_logs. FOR new_connection, CALCULATE frequency of new_destination_asn and new_destination_country in baseline. ALERT if frequency < 5th percentile.
  - question: Can machine learning models identify anomalous outbound network connections that deviate from normal server behavior?
    context: This question leverages machine learning to build a sophisticated profile of normal network behavior for Linux servers. By analyzing multiple features like protocol, port, bytes transferred, and duration, an anomaly detection model (like One-Class SVM or Isolation Forest) can flag connections that do not conform to the learned profile, potentially indicating credential exfiltration.
    answer_sources:
      - Zeek conn.log
      - Network egress points, DNS resolvers, and border routers monitoring traffic originating from Linux server subnets.
    range: last 90 days
    queries:
      - search_technology: Pseudocode
        query: TRAIN anomaly_detection_model (e.g., Isolation Forest) on historical network_logs (features: proto, resp_p, orig_bytes, resp_bytes, duration, dest_asn). APPLY model to new_connections. ALERT if connection is flagged as anomaly.
  - question: Are there any processes being executed on Linux hosts with command lines indicating direct interaction with /etc/passwd or /etc/shadow?
    context: This question aims to detect the most direct evidence of an adversary attempting to read, copy, or manipulate credential files. By searching for specific command-line patterns (e.g., `cat /etc/shadow`, `scp /etc/shadow`, `unshadow`), we can identify blatant attempts to access these sensitive files.
    answer_sources:
      - AuditD logs
      - Sysmon for Linux Event ID 1
      - The local file systems and process tables of critical Linux servers, including domain controllers, database servers, and servers in a DMZ.
    range: last 90 days
    queries:
      - search_technology: Pseudocode
        query: SEARCH process_execution_logs WHERE command_line MATCHES REGEX `/(cat|cp|less|more|head|tail|grep|awk|sed|cut)\\s+.*\\/etc\\/shadow/` or other related patterns.
  - question: Are there any commands accessing /etc/passwd or /etc/shadow that appear to be obfuscated or executed by an unusual parent process?
    context: Adversaries may try to hide their actions by obfuscating commands or using non-standard process chains. This question looks for two indicators: high command-line entropy, which can signal obfuscation, and anomalous parent-child process relationships (e.g., a web server spawning a shell to read /etc/shadow), which deviate from normal administrative activity.
    answer_sources:
      - AuditD logs
      - Sysmon for Linux Event ID 1
      - The local file systems and process tables of critical Linux servers, including domain controllers, database servers, and servers in a DMZ.
    range: last 90 days
    queries:
      - search_technology: Pseudocode
        query: FOR process_events accessing sensitive_files, CALCULATE command_line_entropy. ALERT if entropy > 95th_percentile_baseline. ALSO, BASELINE parent-child process relationships. ALERT on new or rare relationships.
  - question: Can we detect anomalous sequences of user commands that involve accessing /etc/passwd or /etc/shadow?
    context: This question uses machine learning to model the typical sequence of commands issued by users on a host. An adversary's actions, even if they use legitimate commands, will likely form a sequence that deviates from normal administrative workflows. A high reconstruction error from an autoencoder model indicates such a deviation, pointing to suspicious behavior.
    answer_sources:
      - AuditD logs
      - Sysmon for Linux Event ID 1
      - The local file systems and process tables of critical Linux servers, including domain controllers, database servers, and servers in a DMZ.
    range: last 90 days
    queries:
      - search_technology: Pseudocode
        query: TRAIN sequence_autoencoder_model on historical command_line_sequences per user/host. FOR new_command_sequence involving sensitive_files, CALCULATE reconstruction_error. ALERT if error > threshold.
  - question: Is there any outbound network traffic that contains content matching the format of /etc/passwd or /etc/shadow files?
    context: This question focuses on detecting the exfiltration of credential files by inspecting the content of network traffic. By using Intrusion Detection Systems (IDS) with rules that recognize the specific line-by-line structure of /etc/passwd and /etc/shadow files, we can catch the data in transit, even if the file has been renamed or copied.
    answer_sources:
      - Zeek files.log
      - Zeek conn.log
      - Network egress points instrumented with Deep Packet Inspection (DPI) or content-aware Network Data Loss Prevention (NDLP) systems.
    range: last 90 days
    queries:
      - search_technology: Pseudocode
        query: MONITOR network streams/files with IDS. ALERT if content MATCHES REGEX for /etc/passwd format (`^user:x:[0-9]+...`) OR /etc/shadow format (`^user:\\$[1256y]...`).
  - question: Are there any outbound file transfers from Linux servers that are statistically unusual and consistent with credential file exfiltration?
    context: This question uses metadata analysis to find suspicious file transfers. Credential files like /etc/passwd or /etc/shadow are typically small, plain-text files. An adversary might rename the file before exfiltrating it. This query identifies files that fit the profile (plain text, small size) but have unusual names, making them stand out from normal log or configuration file transfers.
    answer_sources:
      - Zeek files.log
      - Zeek conn.log
      - Network egress points instrumented with Deep Packet Inspection (DPI) or content-aware Network Data Loss Prevention (NDLP) systems.
    range: last 90 days
    queries:
      - search_technology: Pseudocode
        query: SEARCH outbound_file_transfers WHERE mime_type = 'text/plain' AND size BETWEEN 1KB AND 100KB. BASELINE filenames. ALERT if filename is statistically rare or does not match common patterns.
  - question: Can a machine learning model classify the content of outbound text files to identify those that are likely /etc/passwd or /etc/shadow files?
    context: This question employs a supervised machine learning model to perform content classification. Unlike simple regex matching, a text classification model can learn more nuanced features of credential files, such as character patterns and the frequency of special characters. This allows it to identify exfiltrated credential files with higher accuracy, even if they are slightly modified.
    answer_sources:
      - Zeek files.log
      - Zeek conn.log
      - Network egress points instrumented with Deep Packet Inspection (DPI) or content-aware Network Data Loss Prevention (NDLP) systems.
    range: last 90 days
    queries:
      - search_technology: Pseudocode
        query: TRAIN text_classification_model on legitimate_text_files vs. credential_files. DEPLOY model on outbound plain_text_files. ALERT if file is classified as credential_file with high confidence.
  - question: Has the /etc/shadow file been read by any unauthorized process or user?
    context: The /etc/shadow file is highly sensitive and should only be accessed by a very small, well-defined set of system processes and administrative accounts. This question implements a strict allowlisting approach. Any access by a process or user not on this pre-approved list is a high-confidence indicator of compromise and requires immediate investigation.
    answer_sources:
      - AuditD logs
      - Sysmon for Linux Event ID 11
      - File system audit logs from all production Linux servers, particularly those hosting sensitive applications or data.
    range: last 90 days
    queries:
      - search_technology: Pseudocode
        query: MONITOR file_access_logs for read events on `/etc/shadow`. CREATE allowlist of legitimate processes/users. ALERT if accessing_process OR accessing_user NOT IN allowlist.
  - question: Has there been a statistically significant spike in the frequency of access to /etc/passwd or /etc/shadow on any Linux host?
    context: While some access to /etc/passwd is normal, an adversary performing reconnaissance or enumeration may cause a sudden increase in access frequency. This question establishes a historical baseline of access counts per hour for these files and uses a dynamic threshold (e.g., 99th percentile) to detect unusual spikes that could indicate malicious activity.
    answer_sources:
      - AuditD logs
      - Sysmon for Linux Event ID 11
      - File system audit logs from all production Linux servers, particularly those hosting sensitive applications or data.
    range: last 90 days
    queries:
      - search_technology: Pseudocode
        query: FOR each_host, LOG access counts for sensitive_files to time-series_db. ESTABLISH 30-day baseline of hourly access counts. ALERT if current_hour_count > 99th_percentile of baseline.
  - question: Can we identify anomalous access events for /etc/passwd and /etc/shadow that do not match known legitimate activity patterns?
    context: Legitimate access to credential files typically occurs in predictable contexts (e.g., a specific process, user, and time of day). This question uses an unsupervised clustering algorithm like DBSCAN to group historical access events into clusters of normal activity. Any new access event that does not belong to one of these defined clusters is treated as an outlier and potential threat.
    answer_sources:
      - AuditD logs
      - Sysmon for Linux Event ID 11
      - File system audit logs from all production Linux servers, particularly those hosting sensitive applications or data.
    range: last 90 days
    queries:
      - search_technology: Pseudocode
        query: CLUSTER historical file_access_events using features (process, parent_process, user, time). DEFINE normal clusters. FOR new_access_event, ALERT if it is an outlier (does not fit in a known cluster).
  - question: Following an anomalous access to /etc/shadow, did the same host make a network connection to a known malicious IP or an unusual port?
    context: This question connects two key pieces of evidence: suspicious file access and suspicious network activity. A correlation rule looks for an outbound connection within a short time window (5 minutes) after an anomalous read of /etc/shadow. The connection is considered suspicious if it goes to a CTI-flagged destination or uses a non-standard port, strengthening the case for data exfiltration.
    answer_sources:
      - AuditD logs
      - Sysmon for Linux Event ID 11
      - Zeek conn.log
      - Zeek files.log
      - A centralized security data lake or SIEM platform where host-based audit logs (AuditD, Sysmon) and network flow logs (Zeek) are aggregated and can be correlated by timestamp and host identifier.
    range: last 90 days
    queries:
      - search_technology: Pseudocode
        query: ON alert for anomalous `/etc/shadow` access, SEARCH network_logs from same_host in next 5 mins. ALERT if destination_ip IN cti_blocklist OR destination_port NOT IN server_allowlist.
  - question: Following an anomalous access to /etc/shadow, did the same host make any outbound connections with a high composite risk score?
    context: This question provides a more nuanced approach than a simple blocklist check. After a suspicious /etc/shadow access, it automatically scores all subsequent outbound connections from that host. The risk score is a composite of multiple factors, including the rarity of the destination ASN, country, and port, and the size of the data transfer. A high score provides a strong, risk-based signal of potential exfiltration.
    answer_sources:
      - AuditD logs
      - Sysmon for Linux Event ID 11
      - Zeek conn.log
      - Zeek files.log
      - A centralized security data lake or SIEM platform where host-based audit logs (AuditD, Sysmon) and network flow logs (Zeek) are aggregated and can be correlated by timestamp and host identifier.
    range: last 90 days
    queries:
      - search_technology: Pseudocode
        query: ON alert for anomalous `/etc/shadow` access, QUERY outbound connections from same_host in next 10 mins. CALCULATE risk_score based on rarity(dest_asn, dest_country, dest_port) and data_size. ALERT if score > threshold.
  - question: Can a graph-based analysis detect a complete attack chain involving /etc/shadow access and network exfiltration?
    context: This question models the entire attack path as a graph, connecting entities like hosts, processes, files, and IPs. By learning the structure of normal activity subgraphs, this model can detect the emergence of a new, suspicious subgraph that represents the full sequence of an attack: an anomalous process accessing /etc/shadow and then connecting to an external IP. This provides a holistic view of the threat.
    answer_sources:
      - AuditD logs
      - Sysmon for Linux Event ID 11
      - Zeek conn.log
      - Zeek files.log
      - A centralized security data lake or SIEM platform where host-based audit logs (AuditD, Sysmon) and network flow logs (Zeek) are aggregated and can be correlated by timestamp and host identifier.
    range: last 90 days
    queries:
      - search_technology: Pseudocode
        query: BUILD graph with nodes (host, process, file, ip) and edges (interactions). TRAIN model on normal subgraphs. ALERT if a new subgraph matching `(/etc/shadow) -> (anomalous_process) -> (external_ip)` is detected.