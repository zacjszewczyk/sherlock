name: T1583.007: Serverless
id: 9a8b7c6d-5e4f-4a3b-2c1d-0e9f8a7b6c5d
description: This playbook helps identify if an adversary is acquiring or configuring serverless infrastructure for operational use. This involves detecting network connections to known malicious or suspicious serverless domains, unauthorized execution of cloud CLI tools for deploying or modifying serverless functions, anomalous user authentications to cloud platforms followed by function creation, periodic network beaconing to serverless endpoints indicative of command-and-control, and unusual data transfers to serverless endpoints that may represent data exfiltration.
type: technique
related:
  - TA0042: Resource Development
contributors:
  - Zachary Szewczyk
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
investigative_questions:
  - question: Has an internal host connected to a known malicious serverless domain or IP address?
    context: This question aims to identify high-confidence threats by checking network traffic against a curated list of malicious serverless infrastructure. A match provides a strong signal that an internal host is communicating with an adversary's command and control (C2) or data exfiltration point.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Internet Gateway
      - DNS Resolvers
      - Network Egress Points
    range: last 90 days
    queries:
      - pseudocode: JOIN network_logs (destination_ip) and dns_logs (domain) WITH threat_intel_watchlist. ALERT on match.
  - question: Is an internal host contacting an anomalously high number of new or unique serverless domains?
    context: Adversaries may use domain generation algorithms (DGAs) or rapidly cycle through many serverless endpoints for C2. This question establishes a baseline of normal serverless domain interactions for each host and alerts on significant deviations, which can help uncover this type of automated malicious activity.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Internet Gateway
      - DNS Resolvers
      - Network Egress Points
    range: last 90 days
    queries:
      - pseudocode: COUNT DISTINCT serverless_domains per host per hour. COMPARE to 30-day baseline. ALERT if count exceeds 99th percentile of host or organizational baseline.
  - question: Is an internal host communicating with a serverless domain that appears to be algorithmically generated or malicious based on its lexical features?
    context: This question seeks to identify malicious domains that are not yet present on threat intelligence feeds. By analyzing features of the domain name itself—such as its randomness (entropy), length, and character patterns—a machine learning model can score its probability of being malicious, enabling proactive detection.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Internet Gateway
      - DNS Resolvers
      - Network Egress Points
    range: last 90 days
    queries:
      - pseudocode: FOR each new serverless_domain, CALCULATE lexical_features (e.g., entropy, length). SCORE with classification_model. ALERT if score > 0.85.
  - question: Has a cloud CLI tool been used to deploy or modify a serverless function by an unauthorized user or with parameters enabling public access?
    context: This question focuses on detecting the misuse of legitimate cloud tools for malicious purposes. By monitoring process execution logs for cloud CLI commands containing deployment keywords and correlating the action with the user's permissions, analysts can identify unauthorized infrastructure provisioning.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 4624
      - Developer Workstations
      - CI/CD Pipeline Servers
      - Administrator Endpoints
      - Endpoint Process and Authentication Logs
    range: last 90 days
    queries:
      - pseudocode: SEARCH process_logs for cloud_cli_process. IF command_line contains 'deploy' or 'publish' and user NOT IN 'Cloud Admins' or 'Developers' group, ALERT.
  - question: Is a cloud CLI command exhibiting unusually high entropy, potentially indicating obfuscation?
    context: Adversaries often obfuscate scripts and commands to evade basic keyword-based detection. This question involves calculating the entropy (randomness) of command-line arguments and comparing it to a baseline of normal commands. A significant deviation can indicate an attempt to hide malicious code.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 4624
      - Developer Workstations
      - CI/CD Pipeline Servers
      - Administrator Endpoints
      - Endpoint Process and Authentication Logs
    range: last 90 days
    queries:
      - pseudocode: FOR each cloud_cli_process, CALCULATE entropy of command_line_arguments. COMPARE to baseline. ALERT if deviation > 3 standard deviations from the mean.
  - question: Is there a sudden and anomalous spike in cloud CLI usage by a specific user or on a specific host?
    context: A compromised account or host may be used to rapidly deploy malicious infrastructure. This question uses time-series analysis to model the normal frequency of cloud CLI usage for each user and host, allowing it to detect sudden, uncharacteristic bursts of activity, especially outside of normal working hours.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 4624
      - Developer Workstations
      - CI/CD Pipeline Servers
      - Administrator Endpoints
      - Endpoint Process and Authentication Logs
    range: last 90 days
    queries:
      - pseudocode: MONITOR frequency of cloud_cli_executions per user/host. USE time-series model to detect anomalous spikes compared to historical data. ALERT on anomaly.
  - question: Has a user logged in from a non-corporate IP, accessed a cloud management console, and then deployed a serverless function, all within a short time window?
    context: This question uses event correlation to detect a high-confidence attack chain. Chaining together an anomalous login, access to a sensitive management portal, and a subsequent deployment action within minutes creates a narrative that strongly suggests account compromise for malicious purposes.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Windows Event ID 4688
      - Windows Event ID 4624
      - Authentication Servers
      - VPN Concentrators
      - Endpoint Process Logs
      - Network Egress Points
      - DNS Resolvers
    range: last 90 days
    queries:
      - pseudocode: CORRELATE login_event (non-corporate IP), dns_log (cloud console domain), and process_log (CLI deploy command) for the same user within a 15-minute window. ALERT on match.
  - question: Has a user authenticated to a cloud platform from a statistically improbable geographic location or network?
    context: This question aims to detect account compromise by identifying "impossible travel" scenarios. By creating a baseline of normal login geolocations and network providers (ASNs) for each user, it can flag authentications from highly unusual sources that are statistically unlikely to be legitimate.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Windows Event ID 4688
      - Windows Event ID 4624
      - Authentication Servers
      - VPN Concentrators
      - Endpoint Process Logs
      - Network Egress Points
      - DNS Resolvers
    range: last 90 days
    queries:
      - pseudocode: FOR each cloud_login, CALCULATE rarity of source_ip_geolocation/ASN. ALERT if modified Z-score > 3.5.
  - question: Does a sequence of user activities involving cloud platforms deviate from established patterns of legitimate administrative behavior?
    context: This question uses sequence analysis to detect subtle deviations from normal administrative workflows. By training a model (like an HMM) on legitimate event sequences, it can identify and score new sequences. An anomalous sequence, like a login immediately followed by a deployment and outbound traffic, can be flagged as suspicious.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Windows Event ID 4688
      - Windows Event ID 4624
      - Authentication Servers
      - VPN Concentrators
      - Endpoint Process Logs
      - Network Egress Points
      - DNS Resolvers
    range: last 90 days
    queries:
      - pseudocode: MODEL legitimate user_activity_sequences (e.g., login -> console -> CLI -> logout). SCORE new sequences against the model. ALERT on anomalous state transitions.
  - question: Is an internal host connecting to a newly observed serverless domain over a non-standard port?
    context: This question provides a simple yet effective heuristic for finding potential C2 channels. Adversaries often use newly created domains for their operations. A connection to a serverless domain never before seen in the enterprise, especially over a port not used for standard web traffic, is highly suspicious.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Workstation Subnets
      - Server Subnets
      - Internet Gateway
      - Critical Asset Subnets
      - DNS Resolvers
    range: last 90 days
    queries:
      - pseudocode: SEARCH for connections to serverless_endpoints. IF domain has not been seen in last 30 days AND destination_port is not 80 or 443, ALERT.
  - question: Is there network traffic to a serverless endpoint that is highly periodic and regular in size, characteristic of C2 beaconing?
    context: This question aims to find the "heartbeat" of malware C2 communications. Automated beacons are often very regular in their timing and data payload size. By calculating the statistical variance of connection timing and data volume, this analytic can identify machine-generated traffic patterns distinct from human activity.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Workstation Subnets
      - Server Subnets
      - Internet Gateway
      - Critical Asset Subnets
      - DNS Resolvers
    range: last 90 days
    queries:
      - pseudocode: FOR each source-destination pair, CALCULATE std_dev of inter-arrival_time and byte_size over 24h. IF both metrics are in the bottom 5th percentile, ALERT.
  - question: Can a strong, single frequency be detected in the connection patterns from a host to a serverless endpoint, indicating automated periodicity?
    context: This question applies a more advanced mathematical technique, Fast Fourier Transform (FFT), to uncover periodic C2 beaconing. FFT is excellent at identifying dominant frequencies in a time series of events. A strong peak in the frequency spectrum is a robust indicator of automated, periodic communication.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Workstation Subnets
      - Server Subnets
      - Internet Gateway
      - Critical Asset Subnets
      - DNS Resolvers
    range: last 90 days
    queries:
      - pseudocode: APPLY FFT to connection timestamps for each host-to-serverless_endpoint communication. IF a single, strong frequency peak is detected, ALERT.
  - question: Has an unusually large file been uploaded to a serverless endpoint from a host not authorized for such activity?
    context: This question is a straightforward approach to detecting bulk data exfiltration. It sets a static threshold for upload size (e.g., 100MB) and checks if the upload originates from a system that is not on an approved list of hosts that perform large cloud uploads, catching obvious policy violations.
    answer_sources:
      - Zeek conn.log
      - Zeek http.log
      - Data Center Egress Points
      - Servers Hosting Sensitive Data
      - Internet Gateway
      - User Workstation Subnets
    range: last 90 days
    queries:
      - pseudocode: SEARCH http_logs for POST/PUT to serverless_endpoint. IF request_body_size > 100MB AND source_host NOT IN authorized_upload_list, ALERT.
  - question: Is a host suddenly uploading a significantly larger volume of data to serverless endpoints than its historical average?
    context: This question provides a more dynamic approach to detecting data exfiltration by using baselining. It learns the normal daily upload volume for each host and alerts when a host's activity significantly exceeds its own historical behavior, which can detect exfiltration that might fall below a large static threshold.
    answer_sources:
      - Zeek conn.log
      - Zeek http.log
      - Data Center Egress Points
      - Servers Hosting Sensitive Data
      - Internet Gateway
      - User Workstation Subnets
    range: last 90 days
    queries:
      - pseudocode: FOR each host, CALCULATE daily upload volume to serverless_endpoints. COMPARE to 30-day rolling baseline. ALERT if volume > 3 standard deviations from mean.
  - question: Does a specific connection to a serverless endpoint appear anomalous when compared to a model of legitimate traffic patterns?
    context: This question uses advanced anomaly detection to find subtle malicious activity. By training a model (e.g., One-Class SVM) on multiple features of legitimate traffic, it can create a nuanced profile of "normal." It then flags any connection that deviates from this profile, potentially catching sophisticated C2 or exfiltration techniques.
    answer_sources:
      - Zeek conn.log
      - Zeek http.log
      - Data Center Egress Points
      - Servers Hosting Sensitive Data
      - Internet Gateway
      - User Workstation Subnets
    range: last 90 days
    queries:
      - pseudocode: TRAIN anomaly detection model (e.g., autoencoder) on features from legitimate traffic (sizes, duration, MIME type). SCORE new connections and ALERT on anomalies.