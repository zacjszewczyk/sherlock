name: T1583.007: Serverless
id: 3a1e9a2b-8c6d-4f7e-9b0a-5d1c2e3f4a5b
description: This playbook helps investigate whether an adversary is acquiring or configuring serverless infrastructure for operational use. This involves detecting connections to known malicious serverless domains, identifying unauthorized or anomalous deployment of serverless functions via cloud CLI tools, spotting unusual authentication patterns followed by function creation, recognizing command-and-control (C2) beaconing to serverless endpoints, and flagging anomalous data transfers that could signify exfiltration.
type: technique
related:
  - TA0042: Resource Development
contributors:
  - Zachary Szewczyk
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Has an internal host connected to a known malicious serverless domain or IP address?
    context: Adversaries may use serverless functions for C2 or data exfiltration. Connecting to a domain or IP address already identified as malicious by high-confidence threat intelligence is a strong indicator of compromise. This question aims to provide a high-fidelity alert based on known-bad infrastructure.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Internet Gateway
      - DNS Resolvers
      - Network Egress Points
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH (network_logs OR dns_logs) WHERE destination_domain OR destination_ip IN malicious_serverless_watchlist
  - question: Is an internal host contacting an anomalously high number of new or unique serverless domains?
    context: Before establishing persistent C2, an adversary's implant may probe or cycle through multiple domains. A sudden increase in the number of unique serverless domains contacted by a single host, compared to its own or organizational baselines, can indicate this type of automated or exploratory activity.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Internet Gateway
      - DNS Resolvers
      - Network Egress Points
    range: last 90 days
    queries:
      - technology: pseudocode
        query: PROFILE host_connections | DETECT spike_in_unique_serverless_domains > 99th_percentile_of_baseline
  - question: Has a serverless domain been queried that exhibits lexical features of a malicious domain?
    context: Adversaries often use Domain Generation Algorithms (DGAs) or random strings to create serverless endpoint names. These domains will not be on threat intelligence feeds initially. Analyzing lexical features like entropy, length, and character distribution can identify these algorithmically generated domains and flag them as potentially malicious.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Internet Gateway
      - DNS Resolvers
      - Network Egress Points
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH dns_logs | APPLY lexical_analysis_model to queried_domain | WHERE malicious_probability > 0.85
  - question: Has a cloud CLI tool been used to deploy or modify a serverless function by an unauthorized user or from a non-standard host?
    context: The creation of serverless infrastructure should only be performed by authorized personnel (e.g., developers, cloud administrators) from designated workstations. Detecting deployment commands executed by other users, especially those granting public access, can indicate a compromised account or insider threat.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 4624
      - Developer Workstations
      - CI/CD Pipeline Servers
      - Administrator Endpoints
      - Endpoint Process and Authentication Logs
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH process_creation_logs WHERE process_name IN (aws.exe, gcloud.cmd, wrangler.exe) AND command_line CONTAINS ('deploy', 'publish') AND user NOT IN 'Cloud Admins'
  - question: Does a cloud CLI execution exhibit unusually high command-line argument entropy, suggesting obfuscation?
    context: To evade simple keyword-based detections, adversaries may obfuscate the scripts or parameters passed to cloud CLI tools. This obfuscation often results in a command-line string with high entropy (randomness). Comparing the entropy of a command to an established baseline can help detect these evasive techniques.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 4624
      - Developer Workstations
      - CI/CD Pipeline Servers
      - Administrator Endpoints
      - Endpoint Process and Authentication Logs
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH process_creation_logs | CALCULATE entropy of command_line | WHERE entropy > (baseline_mean + 3 * baseline_stddev)
  - question: Has there been an anomalous spike in the frequency of cloud CLI usage by a specific user or on a specific host?
    context: Legitimate development activity typically follows a certain rhythm. A sudden, anomalous burst of cloud CLI executions, especially outside of business hours or on non-development systems, could indicate that an automated script is being used by an adversary to create or modify infrastructure.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 4624
      - Developer Workstations
      - CI/CD Pipeline Servers
      - Administrator Endpoints
      - Endpoint Process and Authentication Logs
    range: last 90 days
    queries:
      - technology: pseudocode
        query: PROFILE cli_executions by user, host over time | DETECT anomalous_spike in execution_frequency
  - question: Has a user logged in from a non-corporate IP, accessed a cloud management console, and then deployed a serverless function in a short time window?
    context: This specific sequence of events is highly indicative of an external attacker who has compromised a user's credentials. Correlating an external login with immediate cloud console access and subsequent infrastructure deployment allows for rapid detection of an active intrusion.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Windows Event ID 4688
      - Windows Event ID 4624
      - Authentication Servers
      - VPN Concentrators
      - Endpoint Process Logs
      - Network Egress Points
      - DNS Resolvers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: CORRELATE (login_event from non-corp_IP), (dns_query to cloud_console_domain), (process_creation of cli_deploy) within 15_minutes for same_user
  - question: Has a user authenticated to a cloud platform from a statistically rare geolocation or network (ASN)?
    context: Account compromise is often followed by the attacker logging in from their own infrastructure. By baselining the typical geolocations and network providers (ASNs) for each user, it's possible to detect statistically improbable logins (e.g., 'impossible travel') that are a hallmark of credential theft.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Windows Event ID 4688
      - Windows Event ID 4624
      - Authentication Servers
      - VPN Concentrators
      - Endpoint Process Logs
      - Network Egress Points
      - DNS Resolvers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: PROFILE user_login_locations | DETECT login where modified_Z-score(geolocation_rarity) > 3.5
  - question: Has a sequence of user actions related to serverless function deployment been flagged as anomalous by a behavior model?
    context: Advanced adversaries may try to blend in by performing actions that are individually legitimate. A sequence analysis model (like an HMM) can learn the normal workflow of administrators and detect when a new sequence of actions deviates from this learned behavior, flagging a potentially malicious but subtle set of activities.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Windows Event ID 4688
      - Windows Event ID 4624
      - Authentication Servers
      - VPN Concentrators
      - Endpoint Process Logs
      - Network Egress Points
      - DNS Resolvers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: INPUT user_activity_stream to sequence_model | DETECT anomalous_state_transition or low_probability_sequence
  - question: Is an internal host connecting to a newly observed serverless domain over a non-standard web port (not 80/443)?
    context: Adversaries often use non-standard ports for C2 communication to bypass security controls that only inspect standard web traffic. A connection to a serverless domain that has never been seen before in the environment, combined with the use of a non-standard port, is highly suspicious.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Workstation Subnets
      - Server Subnets
      - Internet Gateway
      - Critical Asset Subnets
      - DNS Resolvers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH network_logs WHERE destination_domain is_new_in_last_30_days AND destination_port NOT IN (80, 443)
  - question: Is a connection to a serverless endpoint exhibiting extremely low variance in timing and data volume, characteristic of automated beaconing?
    context: C2 implants often 'beacon' back to the adversary's server with high periodicity (e.g., every 60 seconds) and a consistent payload size. This machine-like regularity results in very low standard deviation for inter-arrival times and bytes sent. Identifying this pattern can uncover covert C2 channels.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Workstation Subnets
      - Server Subnets
      - Internet Gateway
      - Critical Asset Subnets
      - DNS Resolvers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: PROFILE connections by source-destination | WHERE stddev(inter_arrival_time) is_low AND stddev(bytes_sent) is_low
  - question: Does the connection history for a host to a serverless endpoint show a strong, single periodic frequency?
    context: A Fast Fourier Transform (FFT) is a powerful mathematical technique for identifying periodic signals within data. Applying FFT to a host's connection timestamps can reveal a dominant frequency, which is a strong indicator of automated C2 beaconing, even if the timing has some jitter that would defeat simple statistical methods.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Workstation Subnets
      - Server Subnets
      - Internet Gateway
      - Critical Asset Subnets
      - DNS Resolvers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: APPLY FFT to connection_timeseries for each host | DETECT strong_peak in frequency_spectrum
  - question: Has an unusually large data upload (e.g., >100MB) to a serverless endpoint occurred from a host not authorized for such transfers?
    context: This is a straightforward but effective method for detecting bulk data exfiltration. By setting a static threshold for data uploads and maintaining a list of hosts authorized to perform large transfers, any violation can be quickly flagged as a potential data theft incident.
    answer_sources:
      - Zeek conn.log
      - Zeek http.log
      - Data Center Egress Points
      - Servers Hosting Sensitive Data
      - Internet Gateway
      - User Workstation Subnets
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH http_logs WHERE http_method IN ('POST', 'PUT') AND request_body_size > 100MB AND source_host NOT IN authorized_uploaders_list
  - question: Has a host's daily data upload volume to serverless endpoints significantly deviated from its historical baseline?
    context: Rather than using a single static threshold, this approach creates a dynamic baseline of normal upload behavior for each host. An alert is triggered when a host's activity significantly exceeds its own normal patterns (e.g., more than 3 standard deviations), which can detect exfiltration that might be below a large static threshold.
    answer_sources:
      - Zeek conn.log
      - Zeek http.log
      - Data Center Egress Points
      - Servers Hosting Sensitive Data
      - Internet Gateway
      - User Workstation Subnets
    range: last 90 days
    queries:
      - technology: pseudocode
        query: PROFILE daily_upload_volume_per_host | DETECT daily_total_bytes > (30_day_average + 3 * 30_day_stddev)
  - question: Has a machine learning model identified a connection to a serverless endpoint as anomalous based on its traffic characteristics?
    context: Sophisticated adversaries may use techniques to make their exfiltration or C2 traffic look like normal web traffic. A machine learning model (like a one-class SVM or an autoencoder) can learn the subtle, multi-variate characteristics of legitimate traffic and flag connections that do not conform, detecting novel and evasive threats.
    answer_sources:
      - Zeek conn.log
      - Zeek http.log
      - Data Center Egress Points
      - Servers Hosting Sensitive Data
      - Internet Gateway
      - User Workstation Subnets
    range: last 90 days
    queries:
      - technology: pseudocode
        query: INPUT connection_features (sizes, duration, user_agent) to anomaly_model | WHERE anomaly_score > threshold