name: T1557.002: ARP Cache Poisoning
id: f8d9b1c0-a7e6-4f5a-8b3d-9c1e0a2b3f4d
description: This playbook investigates ARP Cache Poisoning (T1557.002), a technique
  used for both credential access and data collection. The primary goal is to determine
  if an adversary is attempting to intercept network traffic by sending forged ARP
  messages to poison the ARP cache of network hosts. This is achieved by looking
  for various indicators, such as ARP replies from MAC addresses associated with known
  malicious tools, unusual ARP scanning behavior followed by impersonation of critical
  assets (like gateways or DNS servers), IP address conflict events (Windows Event
  ID 4199) on critical endpoints, gratuitous ARP replies from MAC addresses that don't
  match the known MAC for a critical IP, and single endpoints claiming multiple IP
  addresses. The investigation aims to detect the setup of a Man-in-the-Middle (MitM)
  position and the subsequent misdirection of traffic to an attacker-controlled machine
  for capturing credentials or sensitive data.
type: technique
related:
- TA0006: Credential Access
- TA0009: Collection
contributors:
- Zachary Szewczyk
- Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
- question: Has an ARP reply been observed from a MAC address or OUI that is on a
    threat intelligence watchlist for malicious tools?
  context: This question aims to identify the use of known ARP poisoning tools. Adversaries
    often use specific software which may have hardcoded or common MAC addresses/OUIs.
    Matching an observed source hardware address against a watchlist of these indicators
    provides a high-confidence signal of a potential attack.
  answer_sources:
  - Zeek arp.log
  - Network traffic collection points (e.g., SPAN ports, network taps) monitoring
    internal network segments, particularly user VLANs and server subnets.
  range: last 90 days
  queries:
  - search_technology: Pseudocode
    query: SEARCH Zeek:arp.log WHERE (arp.sha IN malicious_mac_watchlist OR OUI(arp.sha)
      IN malicious_oui_watchlist)
- question: Is a MAC address associated with a low-reputation source sending an anomalously
    high number of ARP replies?
  context: Attackers performing ARP poisoning often generate a high volume of ARP
    replies to poison the caches of multiple hosts. This question seeks to detect
    this anomalous behavior by establishing a baseline for ARP reply rates per MAC
    address and alerting when a low-reputation MAC address significantly deviates
    from its normal activity.
  answer_sources:
  - Zeek arp.log
  - Network traffic collection points (e.g., SPAN ports, network taps) monitoring
    internal network segments, particularly user VLANs and server subnets.
  range: last 90 days
  queries:
  - search_technology: Pseudocode
    query: PROFILE Zeek:arp.log | COUNT(arp.replies) by arp.sha over 5m | WHERE arp.sha
      IN low_rep_feed AND count > 99th_percentile_baseline(arp.sha)
- question: Does a machine learning model classify an observed ARP event as malicious
    with high confidence based on its features?
  context: This question leverages a machine learning model to provide a more nuanced
    detection than simple rules. By analyzing multiple features of an ARP event simultaneously
    (like its OUI, whether it's gratuitous, and threat intel matches), the model can
    identify complex patterns indicative of an attack that might be missed by individual
    checks.
  answer_sources:
  - Zeek arp.log
  - Network traffic collection points (e.g., SPAN ports, network taps) monitoring
    internal network segments, particularly user VLANs and server subnets.
  range: last 90 days
  queries:
  - search_technology: Pseudocode
    query: INPUT Zeek:arp.log | INVOKE ML_Model(features=[OUI, is_gratuitous, threat_intel_match])
      | WHERE prediction == 'malicious' AND confidence > 0.9
- question: Has a single MAC address performed a rapid ARP scan of a subnet and then
    immediately sent gratuitous ARP replies impersonating a critical asset?
  context: This behavior is a classic signature of an attacker first mapping out a
    subnet (the scan) and then poisoning the ARP cache of discovered hosts to impersonate
    a high-value target like the default gateway. Correlating these two events in
    a short time frame provides strong evidence of a targeted Man-in-the-Middle attack
    setup.
  answer_sources:
  - Zeek arp.log
  - Network infrastructure segments containing assets like default gateways, DNS
    servers, and Domain Controllers.
  range: last 90 days
  queries:
  - search_technology: Pseudocode
    query: SEARCH Zeek:arp.log | CORRELATE (COUNT(DISTINCT arp.tpa) by arp.sha where
      opcode=1 over 60s > 20) FOLLOWED BY (SEARCH Zeek:arp.log where opcode=2 AND
      spa=tpa AND spa IN critical_ips from same arp.sha within 120s)
- question: Has a MAC address exhibited a sudden, high-entropy ARP scanning behavior
    followed by a burst of gratuitous ARP replies?
  context: A legitimate host typically communicates with a small, stable set of other
    hosts, resulting in low entropy in its ARP requests. An ARP scan, where an attacker
    probes many different IPs, causes a sharp spike in this entropy. This question
    identifies this statistical anomaly and correlates it with subsequent poisoning
    activity to detect the attack pattern.
  answer_sources:
  - Zeek arp.log
  - Network infrastructure segments containing assets like default gateways, DNS
    servers, and Domain Controllers.
  range: last 90 days
  queries:
  - search_technology: Pseudocode
    query: SEARCH Zeek:arp.log | CALCULATE entropy(arp.tpa) by arp.sha over 1m | WHERE
      entropy > 3_std_dev_baseline | CORRELATE with subsequent gratuitous_arp_burst
      from same arp.sha
- question: Does a sequence analysis model detect an anomalous pattern of ARP events
    consistent with a scan-then-poison attack?
  context: This question uses a sophisticated model that understands the normal sequence
    and timing of ARP events for hosts. The model can distinguish between benign network
    activity and the specific malicious sequence of a broad scan followed by targeted
    poisoning, identifying the attack based on its temporal pattern.
  answer_sources:
  - Zeek arp.log
  - Network infrastructure segments containing assets like default gateways, DNS
    servers, and Domain Controllers.
  range: last 90 days
  queries:
  - search_technology: Pseudocode
    query: INPUT sequence of Zeek:arp.log events per host | INVOKE LSTM_ARP_Model
      | WHERE prediction == 'scan-then-poison-anomaly'
- question: Has a Windows host reported an IP address conflict (Event ID 4199) involving
    the IP address of a critical network asset?
  context: Windows Event ID 4199 indicates that another host on the network is using
    the same IP address, a direct symptom of ARP poisoning. When the conflicting IP
    belongs to a critical asset like a domain controller or gateway, it strongly
    suggests an attacker is attempting to impersonate that asset to intercept traffic.
  answer_sources:
  - Windows Event ID 4199
  - Zeek arp.log
  - All Windows endpoints and servers, particularly Domain Controllers and other critical
    servers.
  range: last 90 days
  queries:
  - search_technology: Pseudocode
    query: SEARCH EventLog:System WHERE EventID == 4199 | ENRICH conflicting_ip with
      asset_inventory | WHERE asset_inventory.criticality == 'high'
- question: Has there been a sudden cluster of IP address conflict events (Event
    ID 4199) across multiple hosts in the same subnet, all reporting a conflict with
    the same IP?
  context: A single IP conflict might be a misconfiguration, but multiple hosts simultaneously
    reporting a conflict with the same IP address is a strong statistical indicator
    of a widespread ARP poisoning attack. This question aims to detect the scale of
    an attack by identifying these clusters of events.
  answer_sources:
  - Windows Event ID 4199
  - Zeek arp.log
  - All Windows endpoints and servers, particularly Domain Controllers and other critical
    servers.
  range: last 90 days
  queries:
  - search_technology: Pseudocode
    query: SEARCH EventLog:System WHERE EventID == 4199 | CLUSTER by conflicting_ip,
      subnet over 10m | WHERE event_count > 5
- question: Does a machine learning model assign a high-risk score to an IP address
    conflict event based on the context of the involved assets?
  context: This question uses a model to intelligently prioritize IP conflict events.
    Instead of treating all conflicts equally, the model assesses the risk based on
    factors like the importance of the machine reporting the error and the importance
    of the asset being impersonated, ensuring analysts focus on the most impactful
    events.
  answer_sources:
  - Windows Event ID 4199
  - Zeek arp.log
  - All Windows endpoints and servers, particularly Domain Controllers and other critical
    servers.
  range: last 90 days
  queries:
  - search_technology: Pseudocode
    query: INPUT EventLog:System where EventID=4199 | INVOKE ML_Risk_Model(features=[host_criticality,
      conflicting_ip_criticality, time_of_day]) | WHERE risk_score > 'high'
- question: Has a gratuitous ARP reply been observed for a critical asset where the
    source MAC address does not match the asset's known, legitimate MAC address?
  context: Critical infrastructure like gateways and DNS servers typically have static
    IP and MAC addresses. A gratuitous ARP announcing a new MAC for one of these critical
    IPs is a very strong indicator of an impersonation attempt. This question seeks
    to detect this by comparing observed ARP traffic against a maintained list of
    legitimate IP-to-MAC mappings.
  answer_sources:
  - Zeek arp.log
  - Network taps and SPAN ports monitoring core network switches, gateway routers,
    and DNS server subnets.
  range: last 90 days
  queries:
  - search_technology: Pseudocode
    query: SEARCH Zeek:arp.log WHERE event_type == 'gratuitous_arp' AND arp.spa IN
      critical_asset_list AND arp.sha != static_mapping_table[arp.spa]
- question: Is an anomalously high volume of gratuitous ARP replies being sent for
    a critical asset's IP address?
  context: While some gratuitous ARPs are normal (e.g., during failover), an attacker
    may send a high volume of them to ensure victim ARP caches remain poisoned. This
    question establishes a baseline for this traffic and alerts on significant deviations,
    which could indicate a poisoning flood attack.
  answer_sources:
  - Zeek arp.log
  - Network taps and SPAN ports monitoring core network switches, gateway routers,
    and DNS server subnets.
  range: last 90 days
  queries:
  - search_technology: Pseudocode
    query: PROFILE Zeek:arp.log WHERE arp.spa IN critical_asset_list | COUNT(gratuitous_arp)
      by arp.sha over 1m | WHERE count > 99th_percentile_baseline(arp.spa)
- question: Does a time-series model forecast a significant deviation in the volume
    of gratuitous ARP replies for a critical asset?
  context: This question uses a forecasting model to predict the expected volume
    of gratuitous ARPs for critical assets. An alert is triggered only when the observed
    volume significantly exceeds the model's prediction, allowing for more accurate
    detection of flooding attacks while accounting for normal network fluctuations.
  answer_sources:
  - Zeek arp.log
  - Network taps and SPAN ports monitoring core network switches, gateway routers,
    and DNS server subnets.
  range: last 90 days
  queries:
  - search_technology: Pseudocode
    query: INPUT timeseries of gratuitous_arp_counts for critical_ip | INVOKE ARIMA_Model
      | WHERE observed_volume > forecasted_upper_bound
- question: Is a non-infrastructure device sending gratuitous ARP replies claiming
    ownership of multiple different IP addresses?
  context: Normal endpoints should only ever claim their own IP address. Network
    infrastructure like routers in a high-availability pair might claim a shared virtual
    IP, but it's highly anomalous for a standard workstation or server to claim several
    distinct IPs. This behavior strongly suggests an attacker is attempting to impersonate
    multiple victims or assets simultaneously.
  answer_sources:
  - Zeek arp.log
  - Authentication servers (e.g., Domain Controllers, RADIUS servers) and the subnets
    containing them.
  range: last 90 days
  queries:
  - search_technology: Pseudocode
    query: SEARCH Zeek:arp.log WHERE event_type == 'gratuitous_arp' AND arp.sha NOT
      IN infrastructure_mac_list | COUNT(DISTINCT arp.spa) by arp.sha over 5m | WHERE
      distinct_ip_count > 3
- question: Has the Shannon entropy of IPs claimed by a single non-gateway MAC via
    gratuitous ARP replies suddenly spiked?
  context: A normal device claiming its one IP has an entropy of zero. If an attacker's
    machine begins claiming multiple IPs, the entropy of the set of IPs it claims
    will spike dramatically. This statistical measure provides a sensitive way to
    detect a single machine attempting to impersonate multiple hosts.
  answer_sources:
  - Zeek arp.log
  - Authentication servers (e.g., Domain Controllers, RADIUS servers) and the subnets
    containing them.
  range: last 90 days
  queries:
  - search_technology: Pseudocode
    query: SEARCH Zeek:arp.log WHERE event_type == 'gratuitous_arp' AND arp.sha NOT
      IN gateway_mac_list | CALCULATE entropy(arp.spa) by arp.sha over 10m | WHERE
      entropy > 1.5
- question: Does a clustering algorithm identify a device with anomalous ARP behavior,
    such as claiming multiple IPs?
  context: This question uses unsupervised machine learning to group devices by their
    typical ARP behavior. Normal endpoints and infrastructure devices will form distinct,
    stable clusters. An attacker's machine, by claiming multiple IPs and sending frequent
    replies, will not fit into these clusters and will be flagged as an outlier or
    anomaly, indicating suspicious activity.
  answer_sources:
  - Zeek arp.log
  - Authentication servers (e.g., Domain Controllers, RADIUS servers) and the subnets
    containing them.
  range: last 90 days
  queries:
  - search_technology: Pseudocode
    query: INPUT arp_behavior_features per MAC | INVOKE DBSCAN_Clustering | WHERE
      cluster_label == 'outlier'
- question: Has traffic destined for a high-value data asset been rerouted to a malicious
    MAC address following a suspicious ARP reply?
  context: This is a direct confirmation of a successful Man-in-the-Middle attack.
    The question correlates a suspicious ARP event (from a watchlisted MAC) with subsequent
    network traffic to show that data intended for a legitimate server is now being
    sent at Layer 2 to the attacker's machine, indicating interception for data collection.
  answer_sources:
  - Zeek arp.log
  - Zeek conn.log
  - Subnets containing high-value data assets (e.g., file servers, database servers,
    code repositories).
  range: last 90 days
  queries:
  - search_technology: Pseudocode
    query: CORRELATE (SEARCH Zeek:arp.log where arp.sha IN watchlist AND arp.spa IN
      high_value_ips) as attack_event | FOLLOWED BY (SEARCH Zeek:conn.log where id.resp_h
      == attack_event.spa AND destination_mac == attack_event.sha)
- question: Is an attacker's MAC address receiving an anomalous amount of traffic
    destined for a data server it is impersonating?
  context: After a successful ARP poisoning, the attacker's machine will start receiving
    traffic meant for the victim server. This question looks for a statistical anomaly
    where a MAC address, after a suspicious ARP event, suddenly begins receiving
    a volume of traffic far exceeding its normal baseline, confirming it is intercepting
    data.
  answer_sources:
  - Zeek arp.log
  - Zeek conn.log
  - Subnets containing high-value data assets (e.g., file servers, database servers,
    code repositories).
  range: last 90 days
  queries:
  - search_technology: Pseudocode
    query: DETECT suspicious_arp_event | MONITOR traffic to attacker_mac | WHERE inbound_bytes
      for victim_ip > 95th_percentile_baseline(attacker_mac)
- question: Does a machine learning model predict a high risk of interception for
    a network connection based on recent ARP events and asset criticality?
  context: This question uses a predictive model to score the risk of every network
    connection. The model considers factors like whether a recent suspicious ARP event
    occurred, if the destination MAC matches the known legitimate MAC, and the importance
    of the assets involved. This provides a proactive way to flag connections that
    are likely being intercepted.
  answer_sources:
  - Zeek arp.log
  - Zeek conn.log
  - Subnets containing high-value data assets (e.g., file servers, database servers,
    code repositories).
  range: last 90 days
  queries:
  - search_technology: Pseudocode
    query: INPUT Zeek:conn.log | INVOKE ML_Interception_Risk_Model(features=[recent_arp_event,
      mac_mismatch, asset_criticality]) | WHERE risk_score > 'high'
- question: Has a single MAC address sent targeted ARP replies to both a client and
    a server to place itself in the middle of their communication?
  context: This is the specific signature of a bidirectional Man-in-the-Middle attack
    setup. The attacker must poison the ARP cache of both the client (telling it the
    attacker is the server) and the server (telling it the attacker is the client).
    Detecting these two specific, targeted ARP replies from the same source in a short
    time window is high-fidelity evidence of an attack.
  answer_sources:
  - Zeek arp.log
  - Network traffic collection points monitoring communication paths between user
    workstations and sensitive data servers.
  range: last 90 days
  queries:
  - search_technology: Pseudocode
    query: SEARCH Zeek:arp.log from same arp.sha within 10s | FIND (reply where tha=MAC_A
      and spa=IP_B) AND (reply where tha=MAC_B and spa=IP_A)
- question: Has a non-gateway MAC address suddenly become central in the network
    communication graph, indicating a potential MitM position?
  context: In a typical network, the gateway is a central node in the communication
    graph. If a regular endpoint suddenly develops high 'betweenness centrality' (i.e.,
    it sits on the paths between many other nodes), it's a strong statistical sign
    that it has positioned itself as a man-in-the-middle to intercept traffic.
  answer_sources:
  - Zeek arp.log
  - Network traffic collection points monitoring communication paths between user
    workstations and sensitive data servers.
  range: last 90 days
  queries:
  - search_technology: Pseudocode
    query: BUILD communication_graph from Zeek:arp.log over 1m | CALCULATE betweenness_centrality
      for each node | WHERE centrality of non_gateway_mac > baseline_threshold
- question: Does a graph-based anomaly detection model identify a 'man-in-the-middle'
    subgraph pattern in ARP communications?
  context: This question applies graph theory and machine learning to detect the
    structural signature of a MitM attack. The model is trained on normal communication
    patterns (e.g., clients talking to a gateway). It will then flag the emergence
    of the specific triangular pattern where an attacker node sends replies to two
    other nodes that are communicating with each other.
  answer_sources:
  - Zeek arp.log
  - Network traffic collection points monitoring communication paths between user
    workstations and sensitive data servers.
  range: last 90 days
  queries:
  - search_technology: Pseudocode
    query: INPUT ARP communication graph | INVOKE Graph_Anomaly_Model | WHERE detected_pattern
      == 'man_in_the_middle'
- question: Has a high-value data asset or the workstation of a privileged user generated
    an IP address conflict event (Windows Event ID 4199)?
  context: An IP conflict on any machine is suspicious, but when it occurs on a critical
    server or the machine of a user with high privileges, the potential impact is
    much greater. This question specifically prioritizes these events, as they suggest
    an attacker is targeting high-value assets or users for data collection.
  answer_sources:
  - Windows Event ID 4199
  - Zeek arp.log
  - Designated high-value data servers (file servers, databases) and workstations
    of privileged users.
  range: last 90 days
  queries:
  - search_technology: Pseudocode
    query: SEARCH EventLog:System WHERE EventID == 4199 AND hostname IN (critical_data_assets
      OR privileged_user_workstations)
- question: Is the frequency of IP conflict events on high-value assets statistically
    significant compared to other assets?
  context: This question uses statistical analysis to determine if high-value assets
    are being disproportionately targeted. If the rate of Event ID 4199 on Tier 0
    or Tier 1 assets is significantly higher than on less critical assets, it provides
    evidence of a targeted campaign rather than random misconfigurations.
  answer_sources:
  - Windows Event ID 4199
  - Zeek arp.log
  - Designated high-value data servers (file servers, databases) and workstations
    of privileged users.
  range: last 90 days
  queries:
  - search_technology: Pseudocode
    query: COUNT EventID:4199 by asset_tier | PERFORM Chi-squared test against historical
      distribution | WHERE p_value < 0.05 for high_value_tiers
- question: Does a risk-scoring model assign a high priority to an IP conflict event
    based on the value of the asset and user involved?
  context: This question uses a purpose-built ML model to evaluate the risk of an
    IP conflict specifically in the context of data collection. The model considers
    the value of the data on the asset and the access level of the user to determine
    if the conflict is likely part of an attempt to steal sensitive information, allowing
    for more effective alert prioritization.
  answer_sources:
  - Windows Event ID 4199
  - Zeek arp.log
  - Designated high-value data servers (file servers, databases) and workstations
    of privileged users.
  range: last 90 days
  queries:
  - search_technology: Pseudocode
    query: INPUT EventID:4199 | INVOKE Collection_Risk_Model(features=[asset_value,
      user_privilege, recent_data_access]) | WHERE risk_score > 'critical'
- question: Following an ARP reply that changed a server's MAC address, are clients
    now sending traffic to the new, unauthorized MAC?
  context: This provides direct evidence of successful traffic interception. The
    question creates a stateful check: first, it notes when the legitimate MAC for
    a server is illegitimately changed by an ARP reply, and second, it confirms the
    attack's success by observing client traffic flowing to the attacker's MAC instead
    of the real server's MAC.
  answer_sources:
  - Zeek arp.log
  - Zeek conn.log
  - Network traffic flows to and from high-value data assets, monitored at network
    chokepoints.
  range: last 90 days
  queries:
  - search_technology: Pseudocode
    query: ON (ARP reply changes mac for server_ip to new_mac): TRIGGER | SEARCH Zeek:conn.log
      where dest_ip=server_ip AND dest_mac=new_mac
- question: After a suspected ARP poisoning event, has the percentage of traffic
    to a critical server's IP being sent to the wrong MAC address increased significantly?
  context: This question quantifies the impact of an ARP poisoning attack. By baselining
    the normal (ideally zero) percentage of misdirected traffic for a server, a sudden
    increase in this metric provides a clear, statistical confirmation that client
    traffic is being successfully intercepted.
  answer_sources:
  - Zeek arp.log
  - Zeek conn.log
  - Network traffic flows to and from high-value data assets, monitored at network
    chokepoints.
  range: last 90 days
  queries:
  - search_technology: Pseudocode
    query: For critical_server_ip, CALCULATE pct_traffic_to_wrong_mac over time |
      ALERT on sudden increase in percentage following an ARP anomaly
- question: Following an ARP poisoning event, has traffic volume between legitimate
    client/server MACs dropped while traffic to the attacker's MAC has increased?
  context: This question uses time-series analysis to confirm interception. A successful
    MitM attack would cause the volume of legitimate traffic to decrease (as it's
    being diverted) and the volume of traffic to the attacker's machine to increase.
    Observing this inverse correlation in traffic volumes post-ARP-anomaly strongly
    indicates a successful attack.
  answer_sources:
  - Zeek arp.log
  - Zeek conn.log
  - Network traffic flows to and from high-value data assets, monitored at network
    chokepoints.
  range: last 90 days
  queries:
  - search_technology: Pseudocode
    query: After arp_poison_event, FORECAST traffic between client_mac and server_mac
      | ALERT if observed_traffic drops AND traffic to attacker_mac increases
- question: Is traffic destined for a known data server being sent to the MAC address
    of a non-router endpoint?
  context: This is a fundamental rule violation in a properly configured network.
    Traffic destined for a server should go to that server's MAC address at Layer
    2. If it's being sent to another endpoint's MAC, it's a direct sign of traffic
    misdirection, likely due to ARP poisoning, for the purpose of data collection.
  answer_sources:
  - Zeek conn.log
  - Zeek files.log
  - Zeek smb_files.log
  - All non-gateway endpoints on internal network segments, with traffic monitored
    by network sensors.
  range: last 90 days
  queries:
  - search_technology: Pseudocode
    query: SEARCH Zeek:conn.log WHERE id.resp_h IN data_server_ips AND destination_mac
      NOT IN (legitimate_server_macs OR router_macs)
- question: Is a non-gateway endpoint receiving an anomalously high volume of inbound
    traffic on common data service ports?
  context: Endpoints like workstations are typically clients; they send requests
    and receive responses, but they don't usually receive large, unsolicited volumes
    of inbound traffic on ports like SMB (445) or SQL (1433). A spike in this type
    of traffic suggests the endpoint is impersonating a server and intercepting data.
  answer_sources:
  - Zeek conn.log
  - Zeek files.log
  - Zeek smb_files.log
  - All non-gateway endpoints on internal network segments, with traffic monitored
    by network sensors.
  range: last 90 days
  queries:
  - search_technology: Pseudocode
    query: PROFILE inbound_bytes on ports [445, 1433, 2049] for non_gateway_macs
      | ALERT if bytes_in > 95th_percentile_baseline
- question: Has an endpoint's network traffic profile abruptly shifted from a 'client'
    profile to a 'server-like' profile?
  context: This question uses unsupervised machine learning to classify the role
    of devices based on their network behavior. A device that is successfully intercepting
    traffic will see its profile change dramatically, for instance, from having mostly
    outbound traffic to having high inbound traffic on service ports. This shift
    from its normal cluster is a strong indicator of compromise.
  answer_sources:
  - Zeek conn.log
  - Zeek files.log
  - Zeek smb_files.log
  - All non-gateway endpoints on internal network segments, with traffic monitored
    by network sensors.
  range: last 90 days
  queries:
  - search_technology: Pseudocode
    query: CLUSTER endpoints by traffic_profile (bytes_in/out, ports) over time |
      ALERT if endpoint shifts from 'client_cluster' to 'server_cluster'