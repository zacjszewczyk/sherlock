name: 'T1052: Exfiltration Over Physical Medium'
id: 'a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d'
description: This playbook helps investigate whether an adversary is exfiltrating data via a physical medium such as a USB drive. It focuses on detecting file writes to removable media that are initiated by known malicious processes, triggered by suspicious command-line copy operations, part of a 'stage-and-copy' sequence involving archive files, or represent a behavioral anomaly for a specific user. The goal is to identify unauthorized data removal from the network through physical devices.
type: 'technique'
related:
  - 'TA0010: Exfiltration'
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: '2025-10-01'
modified: '2025-10-01'
version: 1.0
tags: none
questions:
  - question: 'Did a known malicious process write a file to a removable media device?'
    context: 'This question aims to identify high-confidence threats by correlating file write events to removable media with processes whose executable hashes are on a blocklist. A match indicates that a known malicious tool is attempting to exfiltrate data via a physical medium.'
    answer_sources:
      - 'Windows Event ID 4663'
      - 'Windows Event ID 4688'
      - 'Sysmon Event ID 1'
      - 'Threat intelligence feeds'
      - 'All endpoints (desktops, laptops), servers with accessible physical ports (e.g., USB), and workstations used by privileged accounts or users with access to sensitive data repositories.'
    range: 'last 90 days'
    queries:
      - 'pseudocode: SEARCH file write events to removable media (WinEvent 4663). FOR EACH event, GET process ID. FIND process creation event (WinEvent 4688, Sysmon 1) with matching process ID. HASH the process executable. CHECK hash against threat intelligence blocklist. ALERT on match.'
  - question: 'Has a statistically rare or previously unseen process written files to a removable media device?'
    context: 'This question seeks to uncover anomalous activity by identifying processes that rarely or never write to removable media. Such behavior could indicate a legitimate but compromised process or a novel malicious tool being used for exfiltration.'
    answer_sources:
      - 'Windows Event ID 4663'
      - 'Windows Event ID 4688'
      - 'Sysmon Event ID 1'
      - 'All endpoints (desktops, laptops), servers with accessible physical ports (e.g., USB), and workstations used by privileged accounts or users with access to sensitive data repositories.'
    range: 'last 90 days'
    queries:
      - 'pseudocode: GET all processes that wrote to removable media in the last 90 days. CALCULATE frequency of each process name. ESTABLISH baseline. FOR new events, CHECK if the writing process is a statistical outlier (e.g., bottom 5% frequency) or has not been seen before. ALERT on outliers.'
  - question: 'Does a machine learning model classify a removable media write event as suspicious based on its process and file characteristics?'
    context: 'This question leverages a machine learning model to classify the risk of a file write to removable media. The model analyzes a combination of features (process name, parent, integrity level, file type, signature) to identify complex patterns indicative of malicious exfiltration that might be missed by simple rules.'
    answer_sources:
      - 'Windows Event ID 4663'
      - 'Windows Event ID 4688'
      - 'Sysmon Event ID 1'
      - 'All endpoints (desktops, laptops), servers with accessible physical ports (e.g., USB), and workstations used by privileged accounts or users with access to sensitive data repositories.'
    range: 'last 90 days'
    queries:
      - "pseudocode: FOR each removable media write event, EXTRACT features (process name, parent process, integrity level, file extension, signature status). INPUT features into pre-trained classification model. ALERT if the model predicts 'suspicious' with high confidence."
  - question: 'Was a command-line utility used to copy files from a sensitive location to a removable media drive?'
    context: 'This question checks for explicit copy commands (e.g., xcopy, robocopy, Copy-Item) moving data from monitored sensitive directories to a removable drive, which is a direct indicator of potential data theft.'
    answer_sources:
      - 'Windows Event ID 4688'
      - 'Windows PowerShell Event ID 4104'
      - 'Sysmon Event ID 1'
      - 'All endpoints and servers with command-line auditing enabled, administrative jump boxes, developer workstations, and servers hosting critical data.'
    range: 'last 90 days'
    queries:
      - 'pseudocode: SEARCH process creation logs for file transfer utilities (xcopy, robocopy, etc.). CHECK if source argument matches a sensitive path AND destination argument matches a removable drive path. ALERT on match.'
  - question: 'Did a command-line file copy operation to removable media involve unusually complex paths or an anomalously large number of files?'
    context: 'This question aims to detect obfuscation or bulk data theft by analyzing command-line arguments. High path entropy can indicate attempts to hide file origins, and copying an unusually large number of files compared to a user''s baseline suggests bulk exfiltration.'
    answer_sources:
      - 'Windows Event ID 4688'
      - 'Windows PowerShell Event ID 4104'
      - 'Sysmon Event ID 1'
      - 'All endpoints and servers with command-line auditing enabled, administrative jump boxes, developer workstations, and servers hosting critical data.'
    range: 'last 90 days'
    queries:
      - "pseudocode: FOR command-line copy operations to removable media, CALCULATE Shannon entropy of file paths. COMPARE to baseline. CALCULATE number of files being copied. COMPARE to user's historical average. ALERT if entropy or file count are statistical outliers."
  - question: 'Does a sequence-based machine learning model identify a command-line operation involving removable media as anomalous?'
    context: 'This question uses an anomaly detection model (like an LSTM autoencoder) to learn the structure of normal command-line usage. A command that deviates significantly from learned patterns, especially one involving removable media, is flagged as suspicious, catching novel or unusual exfiltration techniques.'
    answer_sources:
      - 'Windows Event ID 4688'
      - 'Windows PowerShell Event ID 4104'
      - 'Sysmon Event ID 1'
      - 'All endpoints and servers with command-line auditing enabled, administrative jump boxes, developer workstations, and servers hosting critical data.'
    range: 'last 90 days'
    queries:
      - "pseudocode: TOKENIZE new command lines involving removable media. INPUT token sequence into a trained sequence model (e.g., LSTM autoencoder). CALCULATE reconstruction error. ALERT if error is high, indicating an anomalous command structure."
  - question: 'Was an archive file created and then immediately copied to a removable media device on the same host?'
    context: 'This question identifies a classic "stage-and-exfiltrate" pattern where an adversary first collects and compresses data into an archive file before copying it to a physical device. Correlating these two events within a short time window is a strong indicator of malicious intent.'
    answer_sources:
      - 'Windows Event ID 4688'
      - 'Windows Event ID 4663'
      - 'Sysmon Event ID 11'
      - 'User workstations, file servers, staging servers, and temporary directories on application servers.'
    range: 'last 90 days'
    queries:
      - "pseudocode: WATCH for archive file creation events (Sysmon 11, or process creation for 7z.exe, etc.). IF detected, WATCH for a file write event (WinEvent 4663) for the same file name to a removable drive on the same host within 10 minutes. ALERT on this correlated sequence."
  - question: "Did a 'stage-and-copy' to removable media sequence involve an unusually large file size or occur with an unusually short time delay between staging and copying?"
    context: "This question refines the 'stage-and-copy' detection by looking for statistical extremes. An exceptionally large archive (e.g., >1 GB) or a very rapid copy after creation (e.g., <30 seconds) suggests an automated or deliberate bulk data theft operation, rather than a casual user action."
    answer_sources:
      - 'Windows Event ID 4688'
      - 'Windows Event ID 4663'
      - 'Sysmon Event ID 11'
      - 'User workstations, file servers, staging servers, and temporary directories on application servers.'
    range: 'last 90 days'
    queries:
      - "pseudocode: FOR correlated 'stage-and-copy' events, ANALYZE archive file size and time delta between creation and copy. COMPARE to historical baselines. ALERT if file size is in the top percentile and/or time delta is in the bottom percentile."
  - question: 'Does a time-series anomaly detection model flag the sequence of events corresponding to staging and copying a file to removable media as abnormal for a given host?'
    context: "This approach models all system activity on a host as a time series. It aims to detect the specific temporal pattern of 'create archive -> copy to USB' as a rare sequence that stands out from the host's normal operational rhythm, providing a sophisticated method for detecting this exfiltration technique."
    answer_sources:
      - 'Windows Event ID 4688'
      - 'Windows Event ID 4663'
      - 'Sysmon Event ID 11'
      - 'User workstations, file servers, staging servers, and temporary directories on application servers.'
    range: 'last 90 days'
    queries:
      - "pseudocode: MODEL host event stream (process, file create, file write) as a time series. TRAIN anomaly detection model (e.g., Isolation Forest) on normal behavior. ALERT if the model identifies the specific sequence of 'archive creation followed by removable media write' as a rare, anomalous pattern."
  - question: 'Did a user write an excessive number of high-risk file types (e.g., .pst, .bak, .sql) to a removable media device within a short time frame?'
    context: 'This question focuses on the sensitivity of the data being exfiltrated. A rule that alerts when a user copies multiple sensitive file types (like email archives, database backups, or key stores) to a USB drive within an hour can quickly identify potential theft of critical information.'
    answer_sources:
      - 'Windows Event ID 4663'
      - 'Windows Event ID 4656'
      - 'All endpoints with object access auditing enabled for removable storage, particularly those used by privileged users, executives, or personnel in sensitive roles (e.g., HR, Finance, R&D).'
    range: 'last 90 days'
    queries:
      - "pseudocode: FOR each user, MONITOR file writes to removable media. COUNT writes of files with high-risk extensions (.pst, .bak, .sql, etc.) within a 1-hour window. ALERT if the count exceeds a predefined threshold (e.g., >5 files)."
  - question: "Has a user's daily activity of writing to removable media deviated significantly from their established 30-day baseline across multiple metrics like data volume, file count, or file types?"
    context: "This question establishes a profile of a user's normal behavior regarding removable media usage. An alert is triggered when a user's activity for a given day shows a multi-faceted deviation (e.g., unusually high volume AND high file count) from their own historical baseline, indicating a significant and suspicious change in behavior."
    answer_sources:
      - 'Windows Event ID 4663'
      - 'Windows Event ID 4656'
      - 'All endpoints with object access auditing enabled for removable storage, particularly those used by privileged users, executives, or personnel in sensitive roles (e.g., HR, Finance, R&D).'
    range: 'last 90 days'
    queries:
      - "pseudocode: MAINTAIN a 30-day rolling baseline for each user's daily removable media writes (volume, file count, etc.). FOR current day's activity, CALCULATE Z-score for each metric against the baseline. ALERT if two or more metrics have a Z-score > 3."
  - question: "Does a machine learning clustering model identify a user's removable media write activity as an outlier or as having shifted to a higher-risk peer group?"
    context: "This question uses peer group analysis to find anomalous user behavior. By clustering users based on their daily removable media activity, the model can identify individuals who either don't fit into any normal group (outliers) or who have suddenly moved from a low-activity group to a high-activity/high-risk group, suggesting a potential account compromise or insider threat."
    answer_sources:
      - 'Windows Event ID 4663'
      - 'Windows Event ID 4656'
      - 'All endpoints with object access auditing enabled for removable storage, particularly those used by privileged users, executives, or personnel in sensitive roles (e.g., HR, Finance, R&D).'
    range: 'last 90 days'
    queries:
      - "pseudocode: DAILY, featurize each user's removable media activity. USE a clustering algorithm (e.g., DBSCAN) to group users. ALERT on users identified as outliers (noise points) or users who have moved to a higher-risk cluster compared to their previous patterns."