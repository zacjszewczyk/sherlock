name: T1591.002: Business Relationships
id: f9a1b2c3-d4e5-4f6a-b7c8-d9e0f1a2b3c4
description: Investigates whether an adversary is conducting reconnaissance on the organization's business relationships. This involves detecting outbound network connections to known malicious infrastructure, identifying automated scraping of public-facing assets listing partners, monitoring for anomalous connection attempts to partner-exclusive services, analyzing for unauthorized internal network activity from partner IP ranges, and flagging unusual file access patterns on repositories containing sensitive partner data.
type: technique
related:
  - TA0043: Reconnaissance
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Are internal hosts connecting to or querying domains/IPs on a threat intelligence feed for reconnaissance or supply chain attacks?
    context: This question aims to directly identify communication with known malicious infrastructure. Threat actors often reuse servers for reconnaissance, and matching outbound traffic against a high-confidence threat intelligence feed is a primary method for detecting the initial stages of a targeted attack on the supply chain.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Internet gateway/egress points
      - DNS resolvers
      - Network Security Monitoring (NSM) sensor grid
      - Threat Intelligence Feeds
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH network_logs (conn, dns) | JOIN on unique connection ID | WHERE destination_ip IN threat_intel_ips OR query_domain IN threat_intel_domains | ALERT source_ip, destination_ip, query_domain
  - question: Are there DNS queries for domains that appear to be typosquatted versions of legitimate business partner domains?
    context: Adversaries use typosquatting to trick users or automated systems into connecting to malicious endpoints that mimic legitimate partner sites. Calculating the Levenshtein distance helps programmatically identify these subtle variations that might be missed by human analysts. Enrichment with ASN and WHOIS data helps validate if a suspicious domain belongs to the expected entity.
    answer_sources:
      - Zeek dns.log
      - Internet gateway/egress points
      - DNS resolvers
      - Network Security Monitoring (NSM) sensor grid
      - WHOIS data
      - ASN data
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH dns_logs | WHERE domain NOT IN allow_list | CALCULATE levenshtein_distance(domain, known_partner_domains) | WHERE distance < 3 AND distance > 0 | ENRICH domain with ASN, WHOIS | IF ASN not in partner_asns | ALERT source_ip, domain
  - question: Can we use a machine learning model to detect suspicious or malicious domains being queried by internal hosts?
    context: This question applies a predictive approach to find previously unknown malicious domains. By training a model on features like domain name structure (length, entropy) and registration details (age, privacy), it can score new domains for their likelihood of being malicious, catching novel threats that are not yet on threat intelligence feeds.
    answer_sources:
      - Zeek dns.log
      - Internet gateway/egress points
      - DNS resolvers
      - Network Security Monitoring (NSM) sensor grid
      - WHOIS data
      - Labeled Datasets
    range: last 90 days
    queries:
      - technology: pseudocode
        query: FOR each new_domain in dns_logs | EXTRACT features (length, entropy, TLD) | ENRICH with WHOIS data (domain_age, registration_privacy) | SCORE domain with classification_model | IF score > malicious_threshold | ALERT domain, score
  - question: Is an external source attempting a DNS zone transfer or using known scraping tools against our public-facing web assets?
    context: This question looks for explicit and easily identifiable reconnaissance techniques. A DNS zone transfer (AXFR) is a classic method to enumerate all DNS records for a domain. Similarly, known scraping tools and libraries often use unique User-Agent strings, providing a high-fidelity signature for detecting automated data collection.
    answer_sources:
      - Zeek dns.log
      - Zeek http.log
      - Public-facing web servers
      - DMZ network segments
      - Reverse proxy servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH dns_logs WHERE query_type = 'AXFR' OR query_type = 'ANY' | ALERT source_ip, domain; SEARCH http_logs WHERE user_agent IN known_scraper_agents | ALERT source_ip, user_agent, requested_uri
  - question: Is a single external IP address sending an unusually high rate of requests to our public web pages, particularly those listing partners or clients?
    context: This question aims to identify web scraping through statistical anomaly detection. A legitimate user will not browse hundreds of pages per minute. By establishing a baseline request rate for different parts of a website, we can detect when a single source IP exceeds this norm, which is a strong indicator of an automated scraping tool gathering information.
    answer_sources:
      - Zeek http.log
      - Public-facing web servers
      - DMZ network segments
      - Reverse proxy servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: GROUP http_requests by source_ip, url_path | CALCULATE requests_per_minute | COMPARE rate to historical_baseline_for_path | IF rate > 99th_percentile | ALERT source_ip, url_path, rate
  - question: Is the traffic volume to our key public-facing web pages significantly exceeding the forecasted volume based on historical trends?
    context: This question uses time-series forecasting to detect subtle, large-scale scraping events that might be distributed across multiple IPs. By modeling the normal daily and weekly traffic patterns (seasonality), we can identify significant deviations that suggest a coordinated reconnaissance effort, even if no single source IP stands out.
    answer_sources:
      - Zeek http.log
      - Public-facing web servers
      - DMZ network segments
      - Reverse proxy servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: MODEL http_request_volume for key_pages with SARIMA/Prophet | FORECAST expected_volume with confidence_interval | IF observed_volume > forecast_confidence_interval | ALERT page, observed_volume, expected_volume
  - question: Are unauthorized external IPs attempting to connect to network services exclusively reserved for business partners?
    context: This is a high-fidelity detection based on a clear violation of access control policy. By defining an explicit allow-list of partner IPs for sensitive services (like a partner portal or VPN), any connection attempt from an IP not on that list is immediately suspicious and warrants a high-severity alert.
    answer_sources:
      - Zeek conn.log
      - Zeek weird.log
      - Partner extranet servers
      - VPN concentrators
      - B2B API gateways
      - DMZ firewalls
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH connection_logs TO partner_services | IF source_ip NOT IN partner_ip_allow_list | ALERT source_ip, destination_ip, destination_port
  - question: Is an unknown external IP generating a statistically significant number of failed connections to a partner-only service?
    context: This question helps detect enumeration or brute-force attempts against partner services. A large number of failed connections (e.g., TCP resets 'REJ' or SYN packets with no reply 'S0') from a single unknown source is a strong indicator of a port scan or password spraying attack.
    answer_sources:
      - Zeek conn.log
      - Partner extranet servers
      - VPN concentrators
      - B2B API gateways
      - DMZ firewalls
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH connection_logs TO partner_services WHERE conn_state IN ('S0', 'REJ') AND source_ip NOT IN partner_ip_allow_list | GROUP by source_ip in 5_min_windows | CALCULATE z_score(failed_count) | IF z_score > 3.5 | ALERT source_ip
  - question: Are connections from unknown IPs to partner services showing characteristics that are anomalous compared to legitimate partner traffic?
    context: This question uses machine learning to build a profile of "normal" for partner connections and identify deviations. A one-class SVM can learn the typical patterns (e.g., connection duration, data volume) of legitimate partners. It can then flag new connections from unknown sources that don't fit this profile.
    answer_sources:
      - Zeek conn.log
      - Partner extranet servers
      - VPN concentrators
      - B2B API gateways
      - DMZ firewalls
    range: last 90 days
    queries:
      - technology: pseudocode
        query: TRAIN one_class_svm_model on legitimate_partner_connection_features | FOR new_connection from unknown_ip to partner_service | APPLY model | IF classified as 'anomalous' | ALERT source_ip, connection_details
  - question: Is a known business partner's IP address attempting to access internal systems outside of their explicitly permitted scope?
    context: This question aims to detect a compromised partner. An attempt from a partner IP to connect to a domain controller, an internal HR server, or a developer's workstation is a major red flag, indicating their network has been compromised and is being used for lateral movement.
    answer_sources:
      - Zeek conn.log
      - Zeek files.log
      - Internal network segments
      - Data center core
      - Application servers
      - Internal firewall logs
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH connection_logs FROM partner_ips | IF destination_ip OR destination_port NOT IN defined_partner_access_rules | ALERT source_ip, destination_ip, destination_port
  - question: Is the total daily data transfer volume for a business partner a statistical outlier compared to their historical baseline?
    context: This question helps detect bulk data exfiltration or other anomalous data movement from a potentially compromised partner account. By monitoring the total data transferred and using statistical methods like IQR to find outliers, we can spot days where the activity is unusually high.
    answer_sources:
      - Zeek conn.log
      - Zeek files.log
      - Internal network segments
      - Data center core
      - Application servers
      - Internal firewall logs
    range: last 90 days
    queries:
      - technology: pseudocode
        query: AGGREGATE daily_data_volume (orig_bytes + resp_bytes) by partner_ip_range | CALCULATE IQR_upper_fence from historical_data | IF daily_volume > upper_fence | ALERT partner, daily_volume
  - question: Is a partner IP address communicating with an internal system that it has never communicated with before, forming an anomalous link in the network graph?
    context: This question uses graph analysis to find unusual communication pathways. By modeling the network as a graph and identifying normal "communities" of communicating systems, an alert can be triggered when a new connection bridges two communities that shouldn't be talking, such as a partner connecting to an HR server.
    answer_sources:
      - Zeek conn.log
      - Zeek files.log
      - Internal network segments
      - Data center core
      - Application servers
      - Internal firewall logs
    range: last 90 days
    queries:
      - technology: pseudocode
        query: MODEL network_connections as graph | IDENTIFY communities with Louvain_Modularity | FOR new_connection FROM partner_ip | IF connection bridges two_previously_unconnected_communities | ALERT source_ip, destination_ip
  - question: Is a single user account accessing a large number of files from partner-related data repositories in a short period?
    context: This question uses a simple threshold to detect potential bulk data reconnaissance or staging. A rule that alerts on a high volume of file access events (e.g., >100 in an hour) from a critical, partner-related folder is an effective and easy-to-implement tripwire.
    answer_sources:
      - Windows Event ID 4663
      - Windows Event ID 4624
      - Active Directory Logs
      - File servers hosting partner data
      - SharePoint sites for vendor management
      - Active Directory domain controllers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH file_access_logs (EventID 4663) FROM tagged_partner_repositories | COUNT events by user in 1_hour_window | IF count > 100 | ALERT user, count
  - question: Is a user's daily file access activity on partner-related data repositories a statistical outlier compared to their own history or the behavior of their peers?
    context: This question adds context to file access by comparing it to two baselines: the user's own past behavior and that of their peer group. A user suddenly accessing 10x their normal number of files is suspicious. Likewise, an accountant accessing files in a pattern more typical of a contract lawyer is also suspicious.
    answer_sources:
      - Windows Event ID 4663
      - Windows Event ID 4624
      - Active Directory Logs
      - File servers hosting partner data
      - SharePoint sites for vendor management
      - Active Directory domain controllers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: CALCULATE daily_file_access_count per user on partner_data | CALCULATE user_baseline (avg, std_dev) AND peer_group_baseline (percentiles) | IF count > (user_avg + 3 * user_std_dev) OR count > 95th_percentile_of_peer_group | ALERT user, count
  - question: Does a user's overall behavior, including file access, logins, and process activity, deviate significantly from their established UEBA profile?
    context: This is a holistic approach leveraging a UEBA solution. An adversary might try to stay "low and slow," but a combination of small anomalies—accessing partner files at an unusual time, from a new location, while running an unfamiliar process—will trigger a high-risk score from the UEBA model.
    answer_sources:
      - Windows Event ID 4663
      - Windows Event ID 4624
      - Active Directory Logs
      - File servers hosting partner data
      - SharePoint sites for vendor management
      - Active Directory domain controllers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: INPUT file_access, login, process_execution data into UEBA_model | IF user_risk_score > high_risk_threshold | ALERT user, risk_score, contributing_factors