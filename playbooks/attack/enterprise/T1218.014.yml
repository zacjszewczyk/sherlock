name: T1218.014: MMC
id: f4b8f8a0-649b-4a5f-8e1e-2c9d6f3a7b1c
description: This playbook is designed to detect adversarial abuse of the Microsoft Management Console (mmc.exe) for defense evasion. The investigation focuses on identifying when mmc.exe is executed with malicious console files (.msc), uses suspicious command-line arguments like "-Embedding" or "delete catalog", is spawned by unusual parent processes such as Office applications or web browsers, loads files from non-standard locations like user profiles or temporary directories, initiates outbound network connections, or is used to invoke a maliciously registered COM object for persistence or execution.
type: technique
related:
  - TA0005: Defense Evasion
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Is mmc.exe being executed with a console file (.msc) known to be malicious?
    context: This question checks for the most direct evidence of abuse, which is the use of a file whose hash is already present in threat intelligence feeds. A match provides a high-confidence indicator of compromise that should be investigated immediately.
    answer_sources:
      - Sysmon Event ID 1
      - Windows Event ID 4688
      - All Windows Endpoints and Servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH process creation events for mmc.exe. EXTRACT .msc file path. GET file hash. MATCH hash against threat intelligence.
  - question: Is a rarely used .msc file being executed by mmc.exe?
    context: Adversaries often use custom or newly introduced .msc files for their operations. Identifying executions of files that are statistically rare across the environment can surface these novel tools that would not be caught by signature-based detections.
    answer_sources:
      - Sysmon Event ID 1
      - Windows Event ID 4688
      - All Windows Endpoints and Servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH mmc.exe executions over 30 days. AGGREGATE .msc file paths and count frequency. IDENTIFY executions with frequency in the bottom 5th percentile.
  - question: Does the file path of an executed .msc file exhibit characteristics of maliciousness?
    context: This question applies machine learning to predict if an .msc file path is malicious based on features like path depth, entropy, and location. It helps automate the detection of suspicious file paths that might not be rare but follow patterns seen in malware.
    answer_sources:
      - Sysmon Event ID 1
      - Windows Event ID 4688
      - All Windows Endpoints and Servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: FOR each mmc.exe execution, EXTRACT .msc file path features (depth, entropy, location). APPLY trained classification model. ALERT on high malicious probability score.
  - question: Is mmc.exe being run with known suspicious or destructive command-line arguments?
    context: Adversaries abuse specific mmc.exe command-line arguments for persistence or evasion, such as "-Embedding" for COM hijacking or "wbadmin.msc delete catalog" to tamper with backups. This question looks for these specific, high-fidelity indicators.
    answer_sources:
      - Sysmon Event ID 1
      - Windows Event ID 4688
      - All Windows Endpoints and Servers, Domain Controllers, Backup Servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH process creation events for mmc.exe. FILTER command line for "-Embedding" or regex "wbadmin.msc.*delete catalog".
  - question: Is an mmc.exe execution using a command line with unusually high complexity or randomness?
    context: Obfuscated commands, often used by attackers to hide their intent, can have higher entropy than normal commands. Baselining normal command-line entropy per host and flagging statistical outliers can uncover these hidden malicious commands.
    answer_sources:
      - Sysmon Event ID 1
      - Windows Event ID 4688
      - All Windows Endpoints and Servers, Domain Controllers, Backup Servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: FOR each host, BASELINE mmc.exe command-line entropy. FOR new executions, CALCULATE entropy. ALERT if entropy is a statistical outlier (e.g., >3 STDEV from mean).
  - question: Does an mmc.exe command line deviate from historically observed patterns in the environment?
    context: This question uses an unsupervised machine learning model to detect novel and anomalous mmc.exe command lines without prior knowledge of what is "bad." It is effective at finding new attack variations that don't match known signatures or simple statistical measures.
    answer_sources:
      - Sysmon Event ID 1
      - Windows Event ID 4688
      - All Windows Endpoints and Servers, Domain Controllers, Backup Servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: VECTORIZE mmc.exe command lines (TF-IDF, n-grams). TRAIN anomaly detection model (Isolation Forest). SCORE new executions and ALERT on anomalies.
  - question: Was mmc.exe launched by a suspicious parent process like an Office application or web browser?
    context: Legitimate use of mmc.exe is typically interactive by an administrator or launched from expected system processes. A launch from a non-interactive script host, Office application, or browser is a strong indicator of a phishing payload or script-based attack.
    answer_sources:
      - Sysmon Event ID 1
      - Windows Event ID 4688
      - User Workstations, Terminal Servers, Application Servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH mmc.exe process creation events. CHECK if parent process is in deny-list (winword.exe, excel.exe, chrome.exe, etc.). ALERT on match.
  - question: Has mmc.exe been spawned by a parent process that has rarely or never done so before in the environment?
    context: This question identifies anomalous execution chains by looking for parent-child process relationships involving mmc.exe that are statistically rare across the entire organization. This can catch novel attack vectors that don't use a predefined list of suspicious parents.
    answer_sources:
      - Sysmon Event ID 1
      - Windows Event ID 4688
      - User Workstations, Terminal Servers, Application Servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: AGGREGATE all parent->mmc.exe process pairs and count frequency. ALERT on pairs with frequency below a rarity threshold (e.g., 1st percentile).
  - question: Did the launch of mmc.exe occur as part of a statistically improbable sequence of process executions on the host?
    context: This question moves beyond simple parent-child relationships to model entire chains of execution. By learning normal workflows, a sequence model can detect when mmc.exe is launched in an abnormal context, indicating a deviation from established user or system behavior.
    answer_sources:
      - Sysmon Event ID 1
      - Windows Event ID 4688
      - User Workstations, Terminal Servers, Application Servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: TRAIN sequence model (LSTM, Markov) on legitimate process chains. FOR new mmc.exe execution, SCORE the preceding sequence. ALERT if sequence is statistically improbable.
  - question: Is mmc.exe loading a console file (.msc) from a non-standard or user-writable directory?
    context: Legitimate .msc files are almost always located in system directories. An adversary will often drop their malicious .msc file in a temporary or user-writable location like C:\Users or %APPDATA%. This question looks for executions from these suspicious locations.
    answer_sources:
      - Sysmon Event ID 1
      - Windows Event ID 4688
      - User Workstations, File Servers, Network Shares
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH mmc.exe executions. PARSE .msc file path. ALERT if path matches regex for non-standard locations (C:\Users, %TEMP%, \\*).
  - question: Is a user executing an .msc file from a directory that is unusual for both that user and the organization?
    context: This question refines the previous one by adding user-specific and organizational context to reduce false positives. An execution from a directory that is rare for both the user and the entire company is a very strong signal of anomalous activity.
    answer_sources:
      - Sysmon Event ID 1
      - Windows Event ID 4688
      - User Workstations, File Servers, Network Shares
    range: last 90 days
    queries:
      - technology: pseudocode
        query: BASELINE .msc execution directories per user. FOR new execution, check if directory is new for user. If new, check rarity across organization. ALERT if rare for both.
  - question: Does a machine learning model classify an .msc file's path as suspicious based on its characteristics?
    context: This question automates the analysis of file path characteristics. By training a model on features like path depth and directory keywords, it can learn to distinguish between legitimate system paths and attacker-chosen paths, providing a scalable way to flag suspicious file locations.
    answer_sources:
      - Sysmon Event ID 1
      - Windows Event ID 4688
      - User Workstations, File Servers, Network Shares
    range: last 90 days
    queries:
      - technology: pseudocode
        query: EXTRACT features from .msc file path (depth, keywords, location). APPLY trained classification model. ALERT on paths classified as suspicious.
  - question: Has the mmc.exe process initiated any outbound network connections?
    context: The mmc.exe process has no legitimate reason to make outbound network connections. Any such connection is highly anomalous and a strong indicator of compromise, potentially for command and control (C2) communication or data exfiltration.
    answer_sources:
      - Sysmon Event ID 3
      - Zeek conn.log
      - Network Egress Points, All Windows Endpoints and Servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH network connection events (Sysmon EID 3). FILTER for initiating process name 'mmc.exe'. ALERT on any match, especially to external IPs.
  - question: Is mmc.exe connecting to a destination IP that is rare or has never been seen before?
    context: Given that any network connection from mmc.exe is suspicious, connections to unique, low-frequency destination IPs are even more so. This approach helps prioritize investigations by focusing on novel C2 infrastructure that hasn't been seen before in the environment.
    answer_sources:
      - Sysmon Event ID 3
      - Zeek conn.log
      - Network Egress Points, All Windows Endpoints and Servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: AGGREGATE destination IPs from mmc.exe network connections. ALERT on any IP that is a low-frequency outlier (e.g., seen only once).
  - question: Has the mmc.exe process sent any data over the network?
    context: The expected baseline for network traffic originating from mmc.exe is zero. Monitoring the volume of outbound bytes and alerting on any non-zero traffic provides a high-confidence way to detect activity like C2 beaconing or data staging.
    answer_sources:
      - Sysmon Event ID 3
      - Zeek conn.log
      - Network Egress Points, All Windows Endpoints and Servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: MONITOR outbound byte volume from mmc.exe process. The baseline is zero. ALERT on any non-zero traffic spike.
  - question: Was mmc.exe executed with the '-Embedding' flag shortly after a suspicious COM object was registered in the registry?
    context: This question looks for a specific attack chain associated with COM hijacking. An adversary registers a malicious COM object and then uses "mmc.exe -Embedding" to execute it. Correlating these two events in a short time window is a strong indicator of this technique.
    answer_sources:
      - Sysmon Event ID 1
      - Sysmon Event ID 13
      - Windows Event ID 4688
      - Windows Registry on all endpoints, All Windows Endpoints and Servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH for suspicious HKCR\CLSID registry writes (Sysmon EID 13). CORRELATE with subsequent mmc.exe executions using "-Embedding" flag. ALERT on temporal correlation.
  - question: Has a new or modified COM registry entry been created that points to a server DLL/EXE with anomalous path characteristics?
    context: Legitimate COM server paths follow predictable patterns. This question aims to detect malicious COM registrations by analyzing the file path of the server. Paths with high entropy, unusual depth, or that point to user-writable locations are statistically likely to be malicious.
    answer_sources:
      - Sysmon Event ID 13
      - Windows Registry on all endpoints, All Windows Endpoints and Servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: MONITOR registry writes to InprocServer32. EXTRACT file path. CALCULATE path features (entropy, depth, location). ALERT on statistical outliers.
  - question: Does a machine learning model classify a new COM registry entry as high-risk or potentially malicious?
    context: This question operationalizes the detection of malicious COM registrations by using a classification model. By training on features from the registry key and value, the model can automatically score the risk of new entries, allowing analysts to focus on the most likely malicious persistence attempts.
    answer_sources:
      - Sysmon Event ID 13
      - Windows Registry on all endpoints, All Windows Endpoints and Servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: FOR new HKCR\CLSID entries, EXTRACT features (server path, threading model, etc.). APPLY trained classification model. ALERT on high-risk classifications.