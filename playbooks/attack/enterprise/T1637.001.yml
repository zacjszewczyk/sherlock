name: T1637.001: Domain Generation Algorithms
id: 5a8e9b0c-4d3f-4e1a-8c7b-9d0e1f2a3b4c
description: This playbook helps investigate whether an adversary is using Domain Generation Algorithms (DGAs) for command and control on mobile devices. It focuses on analyzing DNS traffic for indicators such as a high volume of requests for non-existent domains (NXDOMAINs) with high-entropy names, connections to newly registered domains with low internal prevalence, and patterns of DNS tunneling where data is encoded in a high volume of unique subdomains. The goal is to detect the automated, non-human patterns characteristic of DGA-based malware communication.
type: technique
related:
  - TA0037: Command and Control
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Are mobile devices querying domains that match known DGA patterns from threat intelligence feeds?
    context: This is a high-fidelity check to see if mobile devices are attempting to contact command and control servers using domains that are already identified as malicious and associated with known DGA families. A match provides a strong signal of compromise and is often the quickest way to identify known threats.
    answer_sources:
      - Zeek dns.log
      - Windows DNS Server Analytic Event ID 260
      - Network traffic from mobile device subnets, specifically DNS queries captured at internal DNS resolvers, egress firewalls, or via Network Security Monitoring (NSM) sensors.
      - Logs from Mobile Device Management (MDM) or Cloud Access Security Broker (CASB) platforms can also provide DNS context.
      - Threat intelligence feed of known DGA domain regular expressions.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH DNS logs FROM mobile_IPs WHERE domain MATCHES dga_threat_feed_regex.
  - question: Are any mobile devices generating an anomalously high volume of DNS requests for non-existent, high-entropy domains?
    context: This question aims to detect the characteristic behavior of DGA malware, which often generates a large number of potential domain names, most of which won't exist (resulting in NXDOMAIN responses). High entropy indicates the domains are algorithmically generated rather than human-readable. This is a key behavioral indicator of DGA activity when known patterns are not available.
    answer_sources:
      - Zeek dns.log
      - Windows DNS Server Analytic Event ID 260
      - Network traffic from mobile device subnets, specifically DNS queries captured at internal DNS resolvers, egress firewalls, or via Network Security Monitoring (NSM) sensors.
      - Logs from Mobile Device Management (MDM) or Cloud Access Security Broker (CASB) platforms can also provide DNS context.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH DNS logs FROM mobile_IPs | AGGREGATE by source_IP over 5min_windows | COUNT unique domains with NXDOMAIN response | CALCULATE average entropy of domains | ALERT where NXDOMAIN_count > baseline_99th_percentile AND average_entropy > 3.5.
  - question: Can we identify previously unknown DGA domains being queried by mobile devices using machine learning classification?
    context: This question moves beyond simple heuristics to proactively identify new or unknown DGA activity. By analyzing linguistic and structural features of domain names (length, entropy, character ratios), a machine learning model can score the probability that a domain is algorithmically generated, helping to uncover threats that are not yet on threat intelligence feeds.
    answer_sources:
      - Zeek dns.log
      - Windows DNS Server Analytic Event ID 260
      - Network traffic from mobile device subnets, specifically DNS queries captured at internal DNS resolvers, egress firewalls, or via Network Security Monitoring (NSM) sensors.
      - Logs from Mobile Device Management (MDM) or Cloud Access Security Broker (CASB) platforms can also provide DNS context.
      - Organizational domain allowlist.
      - Pre-trained ML classification model.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: GET unique domains from mobile_IPs NOT in allowlist | EXTRACT features (length, entropy, n-grams, etc.) | SCORE with ML_model | ALERT where score > 0.90.
  - question: Are mobile devices successfully resolving and connecting to domains that were registered very recently?
    context: Adversaries using DGAs often register the 'live' domain for a given period just before it's needed. A connection to a domain created within the last few days (a "newly registered domain" or NRD) is a common indicator of C2 activity, as legitimate domains are typically registered well in advance of use.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - External WHOIS Data
      - Egress network traffic captured at internet gateways or proxies, correlated with DNS resolution logs from internal resolvers.
      - Logs from MDM or CASB solutions can provide device context for connections.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH successful DNS logs FROM mobile_IPs | ENRICH domain with WHOIS data | ALERT where domain_creation_date < 3 days ago.
  - question: Are mobile devices connecting to newly registered domains that have very few other internal clients connecting to them?
    context: This question refines the search for suspicious newly registered domains. A legitimate new service might see connections from many clients, but C2 infrastructure is often specific to a small number of infected hosts. Combining recency (newly registered) with rarity (low internal prevalence) creates a high-fidelity indicator of targeted malicious activity.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - External WHOIS Data
      - Egress network traffic captured at internet gateways or proxies, correlated with DNS resolution logs from internal resolvers.
      - Logs from MDM or CASB solutions can provide device context for connections.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH connections FROM mobile_IPs to domains created < 30 days ago | GROUP by domain | COUNT unique source_IPs | ALERT where unique_source_IP_count < 5.
  - question: Is any single mobile device exhibiting an anomalous spike in connections to newly registered domains over time?
    context: This question aims to detect changes in a device's behavior. A device might be compromised and begin beaconing to new C2 domains. By tracking the rate of connections to NRDs for each device over time, anomaly detection algorithms can automatically flag a sudden, statistically significant increase that might indicate the activation of a malicious implant.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - External WHOIS Data
      - Egress network traffic captured at internet gateways or proxies, correlated with DNS resolution logs from internal resolvers.
      - Logs from MDM or CASB solutions can provide device context for connections.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: FOR each mobile_IP, CREATE time_series of daily_connections_to_NRDs | APPLY anomaly detection model | ALERT on statistically significant spikes.
  - question: Are mobile devices sending unusually long or encoded DNS queries, potentially indicating DNS tunneling?
    context: This question looks for DNS tunneling, a technique where data is exfiltrated or C2 communication is hidden within DNS queries. Exceeding standard length limits (63 bytes per label, 255 total) or including encoded data (e.g., Base64) in query names are strong indicators of this covert channel. Correlating this with prior DGA-like activity strengthens the hypothesis that it's malicious.
    answer_sources:
      - Zeek dns.log
      - DNS traffic logs from internal DNS resolvers and forwarders.
      - Network Security Monitoring (NSM) sensors at key network chokepoints.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH DNS logs FROM mobile_IPs WHERE query_label_length > 63 OR total_query_length > 255 OR query_contains_encoding | CORRELATE with recent high-entropy NXDOMAINs from same IP.
  - question: Is a mobile device rapidly querying an unusually high number of unique subdomains for a single parent domain?
    context: This is another classic indicator of DNS tunneling for C2. Instead of one long query, an adversary may break data into chunks, encoding each into a unique subdomain. This results in a burst of queries for many different subdomains of the same parent domain. Detecting anomalous rates of this behavior is key to identifying this technique.
    answer_sources:
      - Zeek dns.log
      - DNS traffic logs from internal DNS resolvers and forwarders.
      - Network Security Monitoring (NSM) sensors at key network chokepoints.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: AGGREGATE DNS logs by source_IP and parent_domain over 10min_windows | CALCULATE unique_subdomain_count and query_frequency | ALERT where metrics exceed 99.5th percentile baseline.
  - question: Can we use unsupervised machine learning to identify mobile devices exhibiting DNS behavior consistent with DNS tunneling?
    context: This question applies unsupervised learning to find outliers without pre-defined rules. By clustering devices based on various DNS traffic features (frequency, size, entropy), this method can automatically group normal behavior and isolate anomalous clusters. Devices in clusters characterized by high-frequency or high-subdomain-count queries are strong candidates for investigation.
    answer_sources:
      - Zeek dns.log
      - DNS traffic logs from internal DNS resolvers and forwarders.
      - Network Security Monitoring (NSM) sensors at key network chokepoints.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: FOR each source_IP over 1hr_windows, EXTRACT DNS features | APPLY unsupervised clustering model (e.g., DBSCAN) | INVESTIGATE outlier clusters with DNS tunneling characteristics.