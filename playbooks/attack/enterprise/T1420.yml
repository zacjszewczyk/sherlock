name: T1420: File and Directory Discovery
id: a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d
description: This playbook helps investigate whether an adversary is attempting to
  discover and potentially exfiltrate sensitive information from corporate mobile
  devices. It focuses on identifying anomalous file and directory discovery behaviors
  on Android devices. Key indicators include applications exhibiting unusually high
  file access activity, especially involving sensitive file types; the granting of
  high-risk storage permissions to untrusted or suspicious applications; and subsequent
  large outbound network transfers following a discovery-related security alert,
  which may indicate data exfiltration.
type: technique
related:
- TA0032: Discovery
contributors:
- Zachary Szewczyk
- Ask Sage
created: '2025-10-01'
modified: '2025-10-01'
version: 1.0
tags: none
questions:
- question: Is an unapproved application reading an unusual number of sensitive file
    types on a mobile device?
  context: This question aims to detect potential data staging or theft. An application
    that is not on the corporate allow-list and is accessing numerous sensitive files
    (like password databases, private keys, or database backups) in a short period
    is highly suspicious. Correlating this activity with device ownership and compliance
    status from MDM/UEM helps prioritize the incident by identifying the user and
    assessing the device's security posture.
  answer_sources:
  - MTD/EDR file access logs
  - MDM/UEM application allow-list
  - MDM/UEM device owner and compliance data
  range: last 90 days
  queries:
  - technology: Pseudocode
    query: FROM file_access_logs | WHERE process_name NOT IN (allow_list) AND file_extension
      IN ('.kdbx', '.pem', '.bak', '.sql', '.db', '.mdf') | GROUP BY device_id, process_name,
      5_minute_window | COUNT distinct file_path > 10 | ENRICH with device_owner,
      compliance_status FROM mdm_logs
- question: Is a managed application exhibiting an anomalous volume or pattern of
    file access compared to its historical baseline?
  context: This question seeks to identify compromised or malicious behavior within
    legitimate, managed applications. A sudden spike in file access volume, or a
    change in the randomness of accessed directories (high entropy), can indicate
    that an application is being used for unintended purposes, such as scanning the
    file system for valuable data (directory traversal/enumeration).
  answer_sources:
  - MTD/EDR file access logs
  - Historical application behavior baselines
  range: last 90 days
  queries:
  - technology: Pseudocode
    query: '1. FOR each application: CALCULATE 99th_percentile_hourly_access over
      last 30 days. 2. FROM file_access_logs: COMPARE current_hourly_access to 99th_percentile_baseline.
      ALERT if exceeded. 3. FOR each application: CALCULATE 95th_percentile_directory_entropy
      over last 30 days. 4. FROM file_access_logs: CALCULATE current_directory_entropy
      over 5 mins. ALERT if exceeded.'
- question: Does a process's file access behavior, based on multiple combined features,
    deviate significantly from established normal behavior?
  context: This question uses a machine learning model (Isolation Forest) to detect
    subtle anomalies that simple thresholding might miss. By combining multiple features
    like read/write counts, directory listing ratios, file path depth, and extension
    entropy, the model can identify complex patterns of malicious file discovery
    that deviate from the learned 'benign' behavior for an application.
  answer_sources:
  - MTD/EDR file access logs
  - Trained anomaly detection model (e.g., Isolation Forest)
  range: last 90 days
  queries:
  - technology: Pseudocode
    query: 'FROM file_access_logs, per process, per 5_minute_window: 1. ENGINEER
      features (read_count, write_count, dir_list_ratio, path_depth, extension_entropy).
      2. INPUT features into trained Isolation Forest model. 3. ALERT if anomaly_score
      < threshold.'
- question: Has an unapproved or sideloaded application been granted high-risk storage
    permissions?
  context: 'This question focuses on a critical risk event: an untrusted application
    gaining the ability to manage all files on external storage. The `MANAGE_EXTERNAL_STORAGE`
    permission is powerful and rarely needed by legitimate apps. Granting this to
    an unapproved or sideloaded app is a major red flag for malware or spyware and
    requires immediate investigation.'
  answer_sources:
  - MDM application inventory logs
  - MTD security policy violation events
  - MDM/UEM application allow-list
  - SIEM correlation rules
  range: last 90 days
  queries:
  - technology: Pseudocode
    query: FROM mdm_permission_logs | WHERE permission = 'MANAGE_EXTERNAL_STORAGE'
      AND state = 'GRANTED' | IF (app_package_name NOT IN (allow_list) OR app_source
      = 'Sideloaded') THEN CREATE high_priority_alert.
- question: Is a specific application suddenly receiving storage permissions at a
    rate significantly higher than its peers or its own history?
  context: This question aims to detect targeted campaigns or the spread of a trojanized
    application update. A sudden spike in permission grants for a single app, far
    exceeding the norm for its category (e.g., a 'Calculator' app suddenly getting
    storage permissions on many devices), suggests a coordinated event rather than
    random user actions.
  answer_sources:
  - MDM application inventory logs
  - MDM permission grant logs
  - Historical permission grant rate baselines
  range: last 90 days
  queries:
  - technology: Pseudocode
    query: '1. FOR each app_category: CALCULATE 30-day moving average and standard
      deviation of storage_permission_grants. 2. FOR each app: CALCULATE daily grant
      rate. 3. ALERT if daily_grant_rate > (category_average + 3 * category_std_dev).'
- question: Has a storage permission been granted to an application that a machine
    learning model classifies as high-risk?
  context: This question leverages a predictive model to assess the risk of an application
    at the moment it is granted a sensitive permission. The model considers multiple
    factors like its installation source, developer reputation, and other requested
    permissions to calculate a holistic risk score. This provides a more nuanced
    detection than a static allow-list, catching potentially unwanted applications
    that may not be explicitly malicious but exhibit risky characteristics.
  answer_sources:
  - MDM application inventory logs
  - MDM permission grant logs
  - Threat intelligence feeds
  - Trained logistic regression model
  range: last 90 days
  queries:
  - technology: Pseudocode
    query: 'ON event (storage_permission_granted): 1. GATHER features for the app
      (source, dev_rep, permission_count, etc.). 2. INPUT features into trained logistic
      regression model to get risk_score. 3. IF risk_score > 0.8 THEN TRIGGER automated_response
      (e.g., quarantine).'
- question: Following a mobile file discovery alert, is the device communicating
    with known malicious infrastructure?
  context: This question directly links a file discovery event with potential data
    exfiltration to a known command-and-control (C2) or data drop zone. A confirmed
    connection to an IP or domain on a high-confidence threat intelligence list,
    immediately after suspicious file access, is a strong indicator of a successful
    breach and active data theft.
  answer_sources:
  - Zeek conn.log
  - Zeek dns.log
  - MTD/EDR network flow logs
  - SIEM alerts (with tag=mobile_discovery)
  - Threat intelligence feeds
  range: last 90 days
  queries:
  - technology: Pseudocode
    query: 'ON alert (tag=''mobile_discovery'') for device_ip: 1. MONITOR network
      logs FROM device_ip for 60 minutes. 2. IF destination_ip OR destination_domain
      IN (threat_intel_feed) THEN CREATE critical_alert.'
- question: Following a mobile file discovery alert, is the device exfiltrating an
    anomalously large amount of data to a new, never-before-seen destination?
  context: 'This question looks for two combined indicators of exfiltration: novelty
    and volume. Communication with a destination the user has never contacted before
    (''new'' FQDN) is suspicious. When combined with a data transfer volume that is
    abnormally high for that user (exceeding their 98th percentile), it strongly
    suggests that stolen data is being sent to an attacker-controlled server.'
  answer_sources:
  - Zeek conn.log
  - Zeek dns.log
  - SIEM alerts (with tag=mobile_discovery)
  - Historical user network baselines (FQDNs and data volume)
  range: last 90 days
  queries:
  - technology: Pseudocode
    query: 'ON alert (tag=''mobile_discovery'') for user: 1. GET 30-day baseline
      of user''s destination FQDNs. 2. GET 30-day 98th percentile of user''s hourly
      outbound data. 3. MONITOR network logs for 1 hour. 4. ALERT if destination_fqdn
      is NEW OR outbound_data_sum > 98th_percentile_baseline.'
- question: Following a mobile file discovery alert, does the device's outbound
    data volume significantly exceed what a time-series model would predict for that
    specific time?
  context: This question uses advanced forecasting to detect exfiltration. A time-series
    model like Prophet learns the user's normal network traffic patterns, including
    daily and weekly cycles. If, after a discovery alert, the user's actual data
    output dramatically exceeds the model's prediction (the upper confidence bound),
    it's a statistically significant anomaly, indicating that the traffic is not
    part of their normal routine and is likely malicious exfiltration.
  answer_sources:
  - Zeek conn.log
  - SIEM alerts (with tag=mobile_discovery)
  - Trained time-series forecasting model (e.g., Prophet)
  range: last 90 days
  queries:
  - technology: Pseudocode
    query: 'ON alert (tag=''mobile_discovery'') for user: 1. GET forecasted data volume
      and upper_confidence_bound from Prophet model for next hour. 2. MEASURE actual
      outbound data volume for next hour. 3. ALERT if actual_volume > upper_confidence_bound.'