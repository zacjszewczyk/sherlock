name: T1489: Service Stop
id: f8c1b2a3-d4e5-4f6a-8b9c-0d1e2f3a4b5c
description: This playbook is designed to detect adversarial activity involving the stopping of system services, a technique often used for impact (TA0040). It focuses on identifying attempts to disrupt system availability or evade defenses. The playbook addresses various methods, such as stopping critical security services (e.g., antivirus, EDR), performing mass service stops to cripple systems, disabling data protection services like VSS before ransomware execution, and modifying service configurations in the registry to prevent them from starting. Investigations should look for unauthorized service control commands, statistically anomalous bursts of service stop events from a single user or host, and correlations between service stops and subsequent malicious activities like data destruction or exfiltration.
type: technique
related:
- TA0040: Impact
contributors:
- Zachary Szewczyk
- Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
- question: Are known malicious processes or any process stopping critical security services?
  context: Adversaries often stop security services (like antivirus or EDR agents) to disable defenses before executing other malicious actions. This question seeks to identify such defense evasion attempts by looking for service stop commands executed by known malicious processes or any process targeting a predefined list of critical security services.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 7036
  - All managed endpoints and servers, especially security infrastructure servers hosting AV/EDR management consoles.
  range: last 90 days
  queries:
  - technology: SIEM
    query: SEARCH process_creation_events WHERE process_name IN ('net.exe', 'sc.exe', 'powershell.exe') AND command_line CONTAINS ('stop', 'Stop-Service') AND process_hash IN threat_intel_feed OR SEARCH service_stop_events WHERE service_name IN critical_services_watchlist
- question: Are there any service stop commands exhibiting high entropy in their arguments, potentially indicating obfuscation?
  context: To evade simple keyword-based detections, adversaries may obfuscate their commands. High entropy (randomness) in command-line arguments can be an indicator of such obfuscation. This question aims to identify potentially malicious and obfuscated service stop commands by analyzing the complexity of their arguments.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 7036
  - All managed endpoints and servers, especially security infrastructure servers hosting AV/EDR management consoles.
  range: last 90 days
  queries:
  - technology: Analytics Platform
    query: FOR each process_creation_event with service-stop keywords, CALCULATE entropy(command_line). ALERT if entropy > 95th_percentile_baseline
- question: Can machine learning models classify service stop commands as malicious based on historical data?
  context: This question explores a proactive, machine learning-based approach to detection. By training a model on features from known benign and malicious service stop events (e.g., parent process, user, command structure), it's possible to automatically classify new, unseen events and identify threats that might evade traditional rule-based logic.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 7036
  - All managed endpoints and servers, especially security infrastructure servers hosting AV/EDR management consoles.
  range: last 90 days
  queries:
  - technology: Machine Learning
    query: PREDICT is_malicious(process_event_features) using trained_classifier. ALERT if prediction is 'malicious' with high_confidence
- question: Has a single user account or source host stopped an unusually high number of distinct services in a short time frame?
  context: A common pattern in disruptive attacks or ransomware deployment is the rapid, widespread stopping of services to cripple a system. This question looks for this 'mass service stop' behavior by flagging any single user or host that stops an abnormal number of different services within a minute, which is highly indicative of malicious automated activity.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 7036
  - All managed endpoints and servers, with a focus on server groups hosting the same application (e.g., web farms, database clusters).
  range: last 90 days
  queries:
  - technology: SIEM
    query: AGGREGATE service_stop_events by user, source_host over 1_minute_window. ALERT if distinct_service_count > 5
- question: Has any host experienced a statistically significant spike in service stop events compared to its own baseline?
  context: Instead of a fixed threshold, this question uses dynamic baselining to detect anomalies specific to each host's normal behavior. A sudden, statistically significant increase in the rate of service stops on a single machine can indicate a localized attack or system issue that warrants investigation.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 7036
  - All managed endpoints and servers, with a focus on server groups hosting the same application (e.g., web farms, database clusters).
  range: last 90 days
  queries:
  - technology: Analytics Platform
    query: FOR each host, CALCULATE baseline = mean(hourly_service_stops) + 3 * stdev(hourly_service_stops). ALERT if current_5_min_count > baseline
- question: Can clustering algorithms identify anomalous bursts of service stop activity concentrated in time and across specific users or hosts?
  context: This question applies unsupervised machine learning to find 'hotspots' of activity without predefined rules. Density-based clustering can automatically group together service stop events that are tightly correlated by time, user, and host, revealing concentrated bursts of activity that represent a potential coordinated attack.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 7036
  - All managed endpoints and servers, with a focus on server groups hosting the same application (e.g., web farms, database clusters).
  range: last 90 days
  queries:
  - technology: Machine Learning
    query: RUN DBSCAN on service_stop_events(features=[time, host, user]). ALERT on identified dense_clusters
- question: Have data protection services been stopped shortly before shadow copy deletion, mass file modification, or large data exfiltration events?
  context: Ransomware and other destructive malware often disable backup and data protection services (like Volume Shadow Copy Service - VSS) to prevent recovery. This question looks for this specific, high-confidence attack sequence by correlating the stopping of a data protection service with subsequent destructive or exfiltration activity on the same host.
  answer_sources:
  - Windows Event ID 7036
  - Windows Event ID 4688
  - Windows Event ID 4663
  - Zeek conn.log
  - Zeek files.log
  - File servers, database servers, virtualization hosts, backup infrastructure servers, and network egress points (e.g., Internet gateway).
  range: last 90 days
  queries:
  - technology: SIEM
    query: CORRELATE (service_stop_event WHERE service_name IN data_protection_watchlist) with (vssadmin_delete_command OR high_file_mod_count OR large_data_egress) on same_host within 15_minutes
- question: Does a host exhibit an anomalous spike in outbound network traffic shortly after a critical data protection service was stopped?
  context: This question aims to detect a potential 'smash and grab' scenario where an attacker disables backup services to prevent recovery and then immediately exfiltrates large amounts of data. By establishing a baseline for normal outbound traffic, any significant deviation following a critical service stop becomes a strong indicator of compromise.
  answer_sources:
  - Windows Event ID 7036
  - Windows Event ID 4688
  - Windows Event ID 4663
  - Zeek conn.log
  - Zeek files.log
  - File servers, database servers, virtualization hosts, backup infrastructure servers, and network egress points (e.g., Internet gateway).
  range: last 90 days
  queries:
  - technology: Analytics Platform
    query: CALCULATE 99th_percentile_outbound_traffic(host) over 30_days. IF data_protection_service_stops, MONITOR host for 30_mins. ALERT if outbound_traffic > 99th_percentile_baseline
- question: Does the sequence of events on a host, including stopping a service, match a known ransomware attack pattern as identified by a Hidden Markov Model?
  context: This advanced analytic approach models the typical stages of a ransomware attack (e.g., defense evasion, impact). The question seeks to determine if a real-time sequence of events, such as a service stop followed by mass file encryption, matches the learned malicious sequence in the model, allowing for detection of the entire attack chain rather than just isolated events.
  answer_sources:
  - Windows Event ID 7036
  - Windows Event ID 4688
  - Windows Event ID 4663
  - Zeek conn.log
  - Zeek files.log
  - File servers, database servers, virtualization hosts, backup infrastructure servers, and network egress points (e.g., Internet gateway).
  range: last 90 days
  queries:
  - technology: Machine Learning
    query: INPUT event_stream into HMM. ALERT if model_state transitions from 'Service_Stop_Defense_Evasion' to 'Impact_Data_Encryption' with high_probability
- question: Are services being disabled or their paths modified in the registry by unauthorized processes, potentially correlated with security log clearing?
  context: Adversaries may modify a service's registry configuration to disable it persistently across reboots. This is a stealthier alternative to a simple 'net stop' command. This question focuses on detecting these unauthorized registry changes, especially when performed by non-standard tools, and increases the alert's severity if it's accompanied by attempts to cover tracks, like clearing security logs.
  answer_sources:
  - Windows Event ID 4657
  - Windows Event ID 7040
  - Windows Event ID 1102
  - Domain Controllers, critical application servers, and endpoint workstations. The registry key HKLM\SYSTEM\CurrentControlSet\Services\ is the specific location on these systems.
  range: last 90 days
  queries:
  - technology: SIEM
    query: SEARCH registry_events WHERE key_path CONTAINS 'CurrentControlSet\\Services' AND value_name IN ('Start', 'ImagePath') AND process_name NOT IN allowlist. INCREASE severity if correlated with security_log_clear_event
- question: Are there statistically rare combinations of user, process, and target service involved in service configuration changes?
  context: Normal service configuration changes are typically performed by specific administrative accounts or automated tools at predictable times. This question seeks to identify outliers by calculating a rarity score for each configuration change event. A high score indicates a combination of user, process, service, and time that has rarely or never been seen before, making it highly suspicious.
  answer_sources:
  - Windows Event ID 4657
  - Windows Event ID 7040
  - Windows Event ID 1102
  - Domain Controllers, critical application servers, and endpoint workstations. The registry key HKLM\SYSTEM\CurrentControlSet\Services\ is the specific location on these systems.
  range: last 90 days
  queries:
  - technology: Analytics Platform
    query: FOR each service_config_change_event, CALCULATE rarity_score based on historical_frequency(process, user, service, time). ALERT if score > 98th_percentile
- question: Can an autoencoder neural network detect anomalous service configuration changes that deviate from learned normal behavior?
  context: This question leverages an autoencoder to learn the complex patterns of legitimate service configuration changes. The model is trained to reconstruct 'normal' events accurately. When a new, potentially malicious event is processed, it will have a high reconstruction error because it doesn't fit the learned patterns, thus flagging it as an anomaly.
  answer_sources:
  - Windows Event ID 4657
  - Windows Event ID 7040
  - Windows Event ID 1102
  - Domain Controllers, critical application servers, and endpoint workstations. The registry key HKLM\SYSTEM\CurrentControlSet\Services\ is the specific location on these systems.
  range: last 90 days
  queries:
  - technology: Machine Learning
    query: CALCULATE reconstruction_error for service_config_change_event using trained_autoencoder. ALERT if reconstruction_error > threshold
- question: Has a specific service stopped concurrently across a significant percentage of hosts within a defined asset group (e.g., all Exchange servers)?
  context: An adversary aiming to disrupt a specific business function (e.g., email, authentication) might target the same service across all relevant servers. This question looks for such a widespread, coordinated attack by monitoring for a single service stopping on a large portion of hosts within a logical group, which is a strong indicator of targeted impact.
  answer_sources:
  - Windows Event ID 7036
  - Logically grouped assets such as all Domain Controllers, all Exchange servers, all VDI instances, or all hosts within a specific production subnet.
  range: last 90 days
  queries:
  - technology: SIEM
    query: FOR each asset_group, COUNT distinct_hosts with stop_event for a single_service in a 5_minute_window. ALERT if count / total_hosts_in_group > 0.20
- question: Has an individual host experienced a stop event for an abnormally high number of unique services compared to its own baseline?
  context: While some hosts may routinely stop and start a few services, a sudden increase in the variety of services being stopped is abnormal. This question establishes a baseline for how many unique services typically stop on a host and alerts when this number is unusually high, suggesting a broad, indiscriminate attempt to disable the machine.
  answer_sources:
  - Windows Event ID 7036
  - Logically grouped assets such as all Domain Controllers, all Exchange servers, all VDI instances, or all hosts within a specific production subnet.
  range: last 90 days
  queries:
  - technology: Analytics Platform
    query: FOR each host, COUNT distinct_stopped_services hourly. CALCULATE 99th_percentile_baseline over 30_days. ALERT if current_hourly_count > baseline
- question: Are there enterprise-wide spikes in service stop events that are anomalous when accounting for normal operational trends and seasonality?
  context: This question takes a macro view to find large-scale, coordinated attacks. By analyzing the total count of service stops across the entire enterprise and removing predictable patterns (like increased activity during patch windows), it becomes possible to identify statistically significant spikes that represent widespread, anomalous behavior.
  answer_sources:
  - Windows Event ID 7036
  - Logically grouped assets such as all Domain Controllers, all Exchange servers, all VDI instances, or all hosts within a specific production subnet.
  range: last 90 days
  queries:
  - technology: Machine Learning
    query: AGGREGATE enterprise_wide_service_stops per minute. DECOMPOSE time_series. RUN IsolationForest on residuals. ALERT on identified anomalies