name: "T1201: Password Policy Discovery"
id: "f47ac10b-58cc-4372-a567-0e02b2c3d479"
description: "This playbook helps identify if an adversary is attempting to discover enterprise password policies. Adversaries may query for password policies to understand complexity requirements, lengths, and reuse history to aid in password-based attacks. This can be done by executing known discovery tools like PowerSploit or BloodHound, running native commands like 'net accounts' or 'Get-ADDefaultDomainPasswordPolicy', executing these commands from anomalous parent processes or at unusual times, chaining the discovery with other techniques like credential access, or making unauthorized API calls to cloud password policy endpoints."
type: "technique"
related:
  - "TA0007: Discovery"
contributors:
  - "Zachary Szewczyk"
created: "2025-10-01"
modified: "2025-10-01"
version: 1.0
tags: "none"
questions:
  - question: "Is a process being created with a file hash known to be associated with malicious discovery tools?"
    context: "This question aims to identify the execution of known malicious discovery tools like PowerSploit or BloodHound by matching process creation event file hashes against a threat intelligence feed. A match is a high-fidelity indicator of malicious activity and warrants immediate response, such as host quarantine."
    answer_sources:
      - "Windows Security Event ID 4688"
      - "Sysmon Event ID 1"
      - "Domain Controllers"
      - "Member Servers"
      - "Privileged Access Workstations"
    range: "last 90 days"
    queries:
      - search_technology: "Pseudocode"
        query: "SEARCH process_creation_events | JOIN file_hash with threat_intel_feed | WHERE threat_intel_match=true"
  - question: "Are there any rarely seen executables running with command-line arguments related to password policy discovery?"
    context: "This question helps uncover unknown or custom discovery tools by focusing on low-prevalence executables. Adversaries often use tools that are not widespread in the environment. Combining low prevalence with suspicious command-line keywords ('policy', 'password', 'net', 'accounts') helps to filter out noise and pinpoint potential threats."
    answer_sources:
      - "Windows Security Event ID 4688"
      - "Sysmon Event ID 1"
      - "Domain Controllers"
      - "Member Servers"
      - "Privileged Access Workstations"
    range: "last 30 days"
    queries:
      - search_technology: "Pseudocode"
        query: "SEARCH process_creation_events | CALCULATE prevalence of file_hash | WHERE prevalence < 1% AND command_line CONTAINS ('policy', 'password', 'net', 'accounts')"
  - question: "Can machine learning classify a newly observed, unknown executable as a malicious discovery tool based on its execution characteristics?"
    context: "This question leverages machine learning to proactively identify novel threats. By training a model on the features of known-good and known-bad tools, it can predict the maliciousness of new executables that haven't been seen before, based on context like parent process, user, and file path entropy."
    answer_sources:
      - "Windows Security Event ID 4688"
      - "Sysmon Event ID 1"
      - "Domain Controllers"
      - "Member Servers"
      - "Privileged Access Workstations"
    range: "last 90 days"
    queries:
      - search_technology: "Pseudocode"
        query: "INPUT process_creation_features (parent_process, user, etc.) INTO classification_model | OUTPUT prediction (benign/malicious)"
  - question: "Is a non-administrator user executing known password policy discovery commands?"
    context: "This question focuses on detecting the explicit use of built-in or common password policy discovery commands. Since these commands might be used for legitimate administrative purposes, the query filters for executions by users who are not part of a designated administrators group, significantly increasing the likelihood that the activity is malicious."
    answer_sources:
      - "Windows Security Event ID 4688"
      - "Windows PowerShell Event ID 4104"
      - "Sysmon Event ID 1"
      - "Zeek syslog.log"
      - "Domain Controllers"
      - "Linux/macOS Servers"
      - "End-user Workstations"
    range: "last 90 days"
    queries:
      - search_technology: "Pseudocode"
        query: "SEARCH command_line_logs WHERE command_line MATCHES ('net accounts', 'Get-ADDefaultDomainPasswordPolicy', etc.) AND user NOT IN (admin_group)"
  - question: "Is a user executing password policy discovery commands more frequently than their historical baseline or their peer group's baseline?"
    context: "This question aims to detect anomalous behavior even from users who might legitimately run discovery commands. By establishing a baseline of normal activity for each user and their peer group, it can flag unusual spikes in execution frequency, which could indicate a compromised account or an insider threat."
    answer_sources:
      - "Windows Security Event ID 4688"
      - "Windows PowerShell Event ID 4104"
      - "Sysmon Event ID 1"
      - "Zeek syslog.log"
      - "Domain Controllers"
      - "Linux/macOS Servers"
      - "End-user Workstations"
    range: "last 30 days"
    queries:
      - search_technology: "Pseudocode"
        query: "SEARCH discovery_command_executions | GROUP BY user, day | COMPARE daily_count to user_baseline and peer_group_baseline | WHERE daily_count > 99th_percentile"
  - question: "Are there any unusual or outlier command-line executions that appear related to password policy discovery?"
    context: "This question uses unsupervised machine learning to find novel or obfuscated discovery commands. By clustering all command-line arguments, commands that don't fit into common, large clusters (i.e., outliers) can be isolated. Analyzing these outliers for suspicious keywords can reveal new adversary techniques that would be missed by signature-based rules."
    answer_sources:
      - "Windows Security Event ID 4688"
      - "Windows PowerShell Event ID 4104"
      - "Sysmon Event ID 1"
      - "Zeek syslog.log"
      - "Domain Controllers"
      - "Linux/macOS Servers"
      - "End-user Workstations"
    range: "last 90 days"
    queries:
      - search_technology: "Pseudocode"
        query: "INPUT command_line_vectors INTO clustering_model (DBSCAN) | IDENTIFY outlier_clusters | ANALYZE outliers for discovery_keywords"
  - question: "Has a password policy discovery command been spawned by an unusual parent process, such as a web browser or office application?"
    context: "This question seeks to identify suspicious process chains. Legitimate administrative commands are typically spawned from an interactive shell or a management console. A discovery command being launched by an application like Outlook or Chrome is highly anomalous and a strong indicator of a phishing payload or a drive-by download executing a malicious script."
    answer_sources:
      - "Windows Security Event ID 4688"
      - "Windows Security Event ID 4624"
      - "Sysmon Event ID 1"
      - "End-user Workstations"
      - "Application Servers"
      - "Domain Controllers"
    range: "last 90 days"
    queries:
      - search_technology: "Pseudocode"
        query: "SEARCH discovery_command_executions | WHERE parent_process IN ('outlook.exe', 'chrome.exe', 'winword.exe', etc.)"
  - question: "Is a user executing a password policy discovery command at a time of day or day of week that is unusual for them?"
    context: "This question aims to detect activity outside of a user's normal behavior patterns. By modeling each user's typical working hours based on historical process execution data, it's possible to flag policy discovery commands executed at statistically improbable times (e.g., late at night or on a weekend), which could indicate a compromised account."
    answer_sources:
      - "Windows Security Event ID 4688"
      - "Windows Security Event ID 4624"
      - "Sysmon Event ID 1"
      - "End-user Workstations"
      - "Application Servers"
      - "Domain Controllers"
    range: "last 90 days"
    queries:
      - search_technology: "Pseudocode"
        query: "SEARCH discovery_command_executions | COMPARE execution_time to user_time_baseline | CALCULATE Z-score | WHERE Z-score > 3.5"
  - question: "Does the context of a password policy discovery command execution (user, parent process, host, time) deviate from established patterns of legitimate administrative activity?"
    context: "This question uses an anomaly detection model to score the overall context of an event, rather than just a single attribute. An Isolation Forest model, trained on known-good administrative sessions, can identify executions of discovery commands that are anomalous across multiple features simultaneously, providing a more robust detection method."
    answer_sources:
      - "Windows Security Event ID 4688"
      - "Windows Security Event ID 4624"
      - "Sysmon Event ID 1"
      - "End-user Workstations"
      - "Application Servers"
      - "Domain Controllers"
    range: "last 90 days"
    queries:
      - search_technology: "Pseudocode"
        query: "INPUT execution_context (user, parent, host, time) INTO isolation_forest_model | OUTPUT anomaly_score | WHERE score > threshold"
  - question: "Following a password policy discovery event, did the same user or host perform additional discovery or credential access activities within a short time frame?"
    context: "This question looks for attack chaining. Password policy discovery is often a precursor to other malicious actions. By correlating a T1201 event with subsequent discovery or credential access activities by the same user or on the same host, we can identify a developing attack sequence and escalate the priority of the alert."
    answer_sources:
      - "Windows Security Event ID 4688"
      - "Sysmon Event ID 1"
      - "Zeek conn.log"
      - "All hosts within the enterprise network"
      - "network egress points"
    range: "last 90 days"
    queries:
      - search_technology: "Pseudocode"
        query: "SEARCH for T1201_alert | WITHIN 60m ON same user/host, SEARCH for TA0007_or_TA0006_activity | TRIGGER alert if found"
  - question: "Did a password policy discovery event lead to a statistically unlikely follow-on technique, compared to enterprise-wide baselines?"
    context: "This question uses probabilistic analysis to identify high-risk attack paths. By understanding the normal probability of one technique following another (P(B|A)), we can flag user sessions where a transition from T1201 to a high-impact technique like T1003 (Credential Dumping) occurs with a much higher probability than the baseline."
    answer_sources:
      - "Windows Security Event ID 4688"
      - "Sysmon Event ID 1"
      - "Zeek conn.log"
      - "All hosts within the enterprise network"
      - "network egress points"
    range: "last 90 days"
    queries:
      - search_technology: "Pseudocode"
        query: "CALCULATE P(Technique B | T1201) baseline | FOR each session, IF P(Observed Technique | T1201) >> baseline, THEN increase risk_score"
  - question: "Does a sequence of commands including a password policy discovery event appear anomalous when compared to models of benign administrative command sequences?"
    context: "This question leverages sequence analysis to understand the narrative of an attack. An LSTM model can learn the typical order of benign command sequences. When a new sequence containing a T1201 event is observed, the model can determine if the entire sequence is probable or anomalous, catching sophisticated attackers who interleave malicious and benign commands."
    answer_sources:
      - "Windows Security Event ID 4688"
      - "Sysmon Event ID 1"
      - "Zeek conn.log"
      - "All hosts within the enterprise network"
      - "network egress points"
    range: "last 90 days"
    queries:
      - search_technology: "Pseudocode"
        query: "INPUT command_sequence INTO LSTM_model | WHERE sequence CONTAINS T1201_event | IF model_probability < threshold, THEN flag as anomalous"
  - question: "Is an unauthorized user or IP address attempting to query cloud password policies via API calls?"
    context: "This question extends discovery detection to cloud environments. This query specifically looks for API calls related to password policy discovery in AWS and Azure and alerts if the request originates from a user or IP that is not on an approved list of administrators or bastion hosts."
    answer_sources:
      - "Zeek http.log"
      - "Zeek syslog.log"
      - "Windows PowerShell Event ID 4104"
      - "AWS CloudTrail"
      - "Azure Activity Logs"
      - "Network backbone switches/routers"
      - "Cloud IAM infrastructure"
      - "Internet gateway"
    range: "last 90 days"
    queries:
      - search_technology: "Pseudocode"
        query: "SEARCH cloud_api_logs for 'GetAccountPasswordPolicy' OR 'Get-MgDomain' | WHERE source_user OR source_ip NOT IN allowlist"
  - question: "Is there a sudden focus of DNS queries for cloud identity management domains from a small number of hosts?"
    context: "This question aims to detect the preparatory phase of cloud reconnaissance. Normally, DNS requests for cloud IAM endpoints come from varied sources. A sudden drop in the entropy (randomness) of source IPs suggests that one or a few hosts are performing targeted enumeration, a potential indicator of an impending attack."
    answer_sources:
      - "Zeek http.log"
      - "Zeek syslog.log"
      - "Windows PowerShell Event ID 4104"
      - "AWS CloudTrail"
      - "Azure Activity Logs"
      - "Network backbone switches/routers"
      - "Cloud IAM infrastructure"
      - "Internet gateway"
    range: "last 90 days"
    queries:
      - search_technology: "Pseudocode"
        query: "SEARCH DNS_logs for cloud_IAM_domains | CALCULATE entropy of source_IPs per hour | ALERT if entropy drops > 50% from baseline"
  - question: "Is there an anomalous spike in the volume of API calls related to cloud password policies?"
    context: "This question uses time series analysis to detect unusual volumes of activity. By forecasting the expected number of password policy API calls, the model can automatically flag any significant deviation from the norm. This can catch brute-force or large-scale programmatic reconnaissance that might otherwise be missed in a high-volume environment."
    answer_sources:
      - "Zeek http.log"
      - "Zeek syslog.log"
      - "Windows PowerShell Event ID 4104"
      - "AWS CloudTrail"
      - "Azure Activity Logs"
      - "Network backbone switches/routers"
      - "Cloud IAM infrastructure"
      - "Internet gateway"
    range: "last 90 days"
    queries:
      - search_technology: "Pseudocode"
        query: "MODEL volume of cloud_policy_API_calls with ARIMA | ALERT if current_volume > upper_confidence_bound"