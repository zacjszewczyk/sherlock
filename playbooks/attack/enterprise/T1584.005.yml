name: T1584.005: Botnet
id: a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d
description: This playbook helps determine if an internal host is part of an adversary-controlled botnet or if the organization is being targeted by one. This is achieved by identifying several key indicators: outbound connections to known botnet C2 infrastructure; network traffic patterns indicative of automated C2 like DGA, non-standard protocols, or known malware TLS fingerprints (JA3/JA3S); rhythmic beaconing or scanning behavior from internal hosts; sudden, high-volume inbound traffic from distributed sources targeting public services (DDoS); and large-scale email campaigns with similar content originating from diverse, non-reputable IP addresses.
type: technique
related:
  - TA0042: Resource Development
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Are any internal hosts communicating with known botnet command and control (C2) infrastructure?
    context: This question aims to identify direct communication between internal assets and known malicious destinations. By correlating outbound network connection and DNS query logs with high-confidence threat intelligence feeds, we can detect compromised hosts that are part of a botnet. A match is a strong indicator of compromise and requires immediate investigation.
    answer_sources: Zeek conn.log, Zeek dns.log, Windows Event ID 5156, Internet Egress Points (Firewalls, Proxies), Internal DNS Resolvers, Endpoint Devices
    range: last 90 days
    queries:
      - pseudocode: SEARCH outbound_network_logs AND dns_logs WHERE destination_ip OR destination_domain IN threat_intel_feed_botnet_c2; ALERT on match
  - question: Are any hosts communicating with destinations flagged as malicious by multiple threat intelligence sources?
    context: A single threat intelligence hit can sometimes be a false positive. This question increases confidence by looking for destinations validated as malicious by multiple independent feeds. By calculating a risk score based on the number of unique feed hits per host, we can prioritize hosts that are communicating with infrastructure widely recognized as malicious, reducing noise and focusing on high-fidelity threats.
    answer_sources: Zeek conn.log, Zeek dns.log, Windows Event ID 5156, Internet Egress Points (Firewalls, Proxies), Internal DNS Resolvers, Endpoint Devices
    range: last 90 days
    queries:
      - pseudocode: FOR each host, COUNT unique threat_intel_feeds for destination_ip/domain in 1hr_window; CALCULATE risk_score; ALERT if risk_score > 99th_percentile
  - question: Can machine learning models predict if any outbound network connections are likely botnet C2 communications?
    context: This question leverages machine learning to proactively identify potential C2 traffic that may not yet be on a threat intelligence list. By training a model on known C2 connection features (like port, protocol, ASN, domain age), we can classify new, unseen connections. An alert on a high-confidence prediction allows for early detection of emerging botnet infrastructure.
    answer_sources: Zeek conn.log, Zeek dns.log, Windows Event ID 5156, Internet Egress Points (Firewalls, Proxies), Internal DNS Resolvers, Endpoint Devices
    range: last 90 days
    queries:
      - pseudocode: INPUT connection_features (port, protocol, ASN, domain_age) into ML_model; PREDICT probability_is_C2; ALERT if probability > 0.90
  - question: Is any outbound TLS traffic using a client fingerprint (JA3/JA3S) associated with a known botnet malware family?
    context: Malware often uses specific cryptographic libraries, resulting in a unique TLS client fingerprint (JA3 hash). This question aims to identify malware by its fingerprint, even if the destination IP or domain is unknown. Matching a JA3 or JA3S hash from our network with a known botnet malware fingerprint provides strong evidence of a specific infection on the source host.
    answer_sources: Zeek dns.log, Zeek conn.log, Zeek ssl.log, Internet Egress Points (Firewalls, Proxies), Internal DNS Resolvers
    range: last 90 days
    queries:
      - pseudocode: SEARCH tls_logs for ja3_or_ja3s_hash; ALERT if hash IN known_botnet_fingerprints_list
  - question: Are any internal hosts generating DNS queries for unusually random-looking domain names, indicative of a Domain Generation Algorithm (DGA)?
    context: Botnets often use DGAs to generate a large number of domain names for C2 communication, making them difficult to block. These domains often appear random. This question seeks to detect this activity by calculating the Shannon entropy (a measure of randomness) of queried domains per host. A host with a statistically significant high entropy score is likely running malware that employs DGA.
    answer_sources: Zeek dns.log, Zeek conn.log, Zeek ssl.log, Internet Egress Points (Firewalls, Proxies), Internal DNS Resolvers
    range: last 90 days
    queries:
      - pseudocode: FOR each host, CALCULATE shannon_entropy of queried_subdomains in 5min_window; ALERT if entropy > 98th_percentile_baseline
  - question: Are any hosts exhibiting an anomalous spike in the ratio of failed DNS lookups (NXDOMAIN)?
    context: DGA-based malware often queries many domains, most of which are not registered and will result in an NXDOMAIN (non-existent domain) response. This question uses a time-series model to learn the normal baseline of NXDOMAIN rates for each host. A sudden, anomalous increase in this rate strongly suggests that the host is attempting to contact a C2 server via a DGA, with most attempts failing until it finds a registered domain.
    answer_sources: Zeek dns.log, Zeek conn.log, Zeek ssl.log, Internet Egress Points (Firewalls, Proxies), Internal DNS Resolvers
    range: last 90 days
    queries:
      - pseudocode: MODEL per-host_nxdomain_ratio_over_time; ALERT on statistically_significant_anomaly from predicted_baseline
  - question: Is a newly created, suspicious process making persistent outbound network connections?
    context: This question seeks to link suspicious process activity directly to network behavior. Malware often spawns new processes to establish C2 communication. By correlating process creation events with network connection events, we can identify when a non-standard, unsigned process (unlike a legitimate browser) initiates a long-lived connection, especially to a non-standard port. This behavior is a strong indicator of a malware implant.
    answer_sources: Zeek conn.log, Windows Event ID 4688, Windows Event ID 5156, General User Workstation Subnets, Server Subnets, Internet Egress Points
    range: last 90 days
    queries:
      - pseudocode: JOIN process_creation_events (4688) with network_connection_events (5156); ALERT if new_process is unsigned AND not_browser AND establishes persistent_connection on non-standard_port
  - question: Are any internal hosts exhibiting rhythmic, periodic network beaconing to an external destination?
    context: Botnet agents must periodically check in with their C2 server for instructions. This results in highly regular, machine-generated network traffic known as beaconing. This question analyzes the time intervals between connections from a source to a destination. A very low standard deviation in these time intervals indicates a rhythmic pattern inconsistent with human behavior, pointing to automated C2 communication.
    answer_sources: Zeek conn.log, Windows Event ID 4688, Windows Event ID 5156, General User Workstation Subnets, Server Subnets, Internet Egress Points
    range: last 90 days
    queries:
      - pseudocode: GROUP connections by src_ip, dst_ip in 1hr_window; CALCULATE std_dev of time_delta_between_connections; ALERT if std_dev is near_zero AND frequency > 99th_percentile
  - question: Can unsupervised machine learning identify clusters of network traffic corresponding to beaconing or scanning behavior?
    context: This question uses unsupervised learning to find hidden patterns in network data without pre-defined rules. By clustering connections based on features like IPs, ports, and timing, algorithms like DBSCAN can automatically group similar behaviors. This can reveal beaconing (a dense cluster of connections from one host to one other) or scanning (a sparse cluster from one host to many others), identifying botnet activity that might evade simpler, rule-based detection.
    answer_sources: Zeek conn.log, Windows Event ID 4688, Windows Event ID 5156, General User Workstation Subnets, Server Subnets, Internet Egress Points
    range: last 90 days
    queries:
      - pseudocode: INPUT connection_metadata into DBSCAN_model; IDENTIFY clusters; ALERT on clusters matching beaconing_or_scanning_profile
  - question: Is our network monitoring system (Zeek) generating specific notices related to a potential Denial-of-Service (DoS) attack?
    context: Network security monitoring tools like Zeek have built-in detection capabilities for common attack patterns. This question leverages Zeek's own analysis to identify potential DDoS attacks. An alert from a notice like 'Scan::Address_Scan' or 'Attack::DOS' indicates that Zeek's heuristics have already flagged traffic as suspicious and consistent with a DoS or scanning, providing a direct, tool-generated signal of a potential botnet-driven attack against a public-facing service.
    answer_sources: Zeek conn.log, Zeek notice.log, Public-Facing Services (Web Servers, VPN Concentrators), DMZ Network Segments, Internet Ingress Points
    range: last 90 days
    queries:
      - pseudocode: MONITOR zeek_notice_log; ALERT if notice_type is 'Scan::Address_Scan' OR 'Attack::DOS' for a single destination
  - question: Is any public-facing service experiencing a statistically significant increase in both inbound connections and unique source IPs?
    context: A DDoS attack is characterized by a high volume of traffic from many different sources. This question aims to detect such volumetric attacks by establishing a normal baseline for traffic to public services. A simultaneous, significant spike (e.g., >3 standard deviations) in both the connection rate and the number of unique sources is a strong statistical indicator of a coordinated, distributed attack, characteristic of a botnet.
    answer_sources: Zeek conn.log, Zeek notice.log, Public-Facing Services (Web Servers, VPN Concentrators), DMZ Network Segments, Internet Ingress Points
    range: last 90 days
    queries:
      - pseudocode: FOR each public_service_ip, CALCULATE 30-day_baseline for connections/min AND unique_src_ips/min; ALERT if current_metrics > (baseline + 3*std_dev) for both
  - question: Does the current volume of inbound traffic and source diversity significantly exceed what a time-series forecasting model would predict as normal?
    context: This question uses a more advanced statistical method to detect DDoS attacks by forecasting expected traffic levels. A time-series model like ARIMA learns the historical patterns of traffic, including daily and weekly cycles. If the actual observed traffic volume and source ASN diversity dramatically exceed the model's prediction, it signals a significant anomaly that is not part of the normal pattern, strongly suggesting a DDoS attack.
    answer_sources: Zeek conn.log, Zeek notice.log, Public-Facing Services (Web Servers, VPN Concentrators), DMZ Network Segments, Internet Ingress Points
    range: last 90 days
    queries:
      - pseudocode: FORECAST next_5min_traffic_volume and unique_ASNs with ARIMA_model; ALERT if observed_traffic > predicted_upper_confidence_bound
  - question: Are we receiving a high volume of emails from many different sources that all contain the same malicious attachment or URL?
    context: Botnets are frequently used to send massive spam and phishing campaigns. The emails in these campaigns are often identical or very similar. This question aims to detect such campaigns by identifying a large number of unique sending IPs delivering emails with the same attachment hash or URL domain. This pattern is highly indicative of a coordinated, botnet-driven attack, as legitimate mail from diverse sources would not share these characteristics.
    answer_sources: Email Gateway Logs, Zeek smtp.log, Zeek files.log, Mail Gateway Servers, Internet Ingress Points, User Workstation Subnets
    range: last 90 days
    queries:
      - pseudocode: COUNT unique_src_ips for emails in 1hr_window with same attachment_hash OR same url_domain; ALERT if count > 50
  - question: Is there a statistically anomalous increase in the diversity of source IP addresses sending inbound email?
    context: Normal email traffic has a somewhat predictable level of source diversity. A botnet-driven spam or phishing campaign, however, will appear to come from a massive, highly distributed, and random set of IP addresses. This question measures the randomness (entropy) of the source IPs. A sudden spike in this entropy score, compared to a learned baseline, indicates that the sources of inbound mail have become far more diverse and less predictable, a classic sign of a botnet campaign.
    answer_sources: Email Gateway Logs, Zeek smtp.log, Zeek files.log, Mail Gateway Servers, Internet Ingress Points, User Workstation Subnets
    range: last 90 days
    queries:
      - pseudocode: CALCULATE shannon_entropy of src_ips for inbound_email in 10min_windows; ESTABLISH dynamic_baseline; ALERT if entropy > (baseline + 3*std_dev)
  - question: Can we identify large clusters of highly similar emails that originate from an unusually diverse set of network locations (ASNs)?
    context: This question combines content analysis with network origin analysis. First, it uses clustering to group emails that are very similar in content (subject, links, attachments). For any large cluster of similar emails (indicating a campaign), it then examines the diversity of their origins at the network level (ASNs). A campaign of similar emails coming from a vast and unusual number of ASNs is a strong signal of a botnet, as legitimate organizations do not send mail this way.
    answer_sources: Email Gateway Logs, Zeek smtp.log, Zeek files.log, Mail Gateway Servers, Internet Ingress Points, User Workstation Subnets
    range: last 90 days
    queries:
      - pseudocode: CLUSTER emails based on content_features; FOR large_clusters, ANALYZE source_ASN_distribution; ALERT if ASN_count is anomalously high