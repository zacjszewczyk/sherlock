name: T1584.005: Botnet
id: f47ac10b-58cc-4372-a567-0e02b2c3d479
description: This playbook helps determine if an internal host is part of an adversary-controlled botnet or if the organization is being targeted by one. It focuses on identifying several key indicators of botnet activity, including outbound network connections to known malicious C2 infrastructure, network traffic patterns characteristic of automated C2 (such as DGA or specific TLS fingerprints), rhythmic beaconing or scanning behavior, sudden distributed inbound traffic targeting public services (DDoS), and large-scale, similar inbound email campaigns from diverse, non-reputable sources.
type: technique
related:
  - TA0042: Resource Development
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Has any internal host established an outbound network connection to a known botnet C2 IP address or domain?
    context: This question aims to detect direct communication with adversary-controlled infrastructure by matching outbound network logs against high-confidence threat intelligence feeds. A positive match is a strong indicator of a compromised host being controlled as part of a botnet.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Windows Event ID 5156
      - Internet Egress Points (Firewalls, Proxies)
      - Internal DNS Resolvers
      - Endpoint Devices
    range: Last 90 days
    queries:
      - pseudocode: SEARCH outbound_network_logs AND dns_logs WHERE destination_ip OR destination_domain IN threat_intel_feed_of_botnet_c2
  - question: Is any internal host communicating with destinations flagged by multiple, distinct threat intelligence feeds, suggesting a high-confidence malicious connection?
    context: This question increases the confidence of a finding by requiring a destination to be flagged by multiple threat intelligence sources. A host communicating with such a destination has a higher probability of being compromised, as the destination's maliciousness is corroborated by several security vendors or communities.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Windows Event ID 5156
      - Internet Egress Points (Firewalls, Proxies)
      - Internal DNS Resolvers
      - Endpoint Devices
    range: Last 90 days
    queries:
      - pseudocode: CALCULATE risk_score for each host based on count of unique threat_intel_feeds per destination. ALERT where risk_score > 99th_percentile.
  - question: Have any outbound network connections been classified as botnet C2 activity by a machine learning model?
    context: This question leverages a machine learning model to identify potential botnet C2 communications that may not appear on static threat intelligence lists. The model analyzes various connection features (port, protocol, ASN, etc.) to find patterns indicative of malicious C2, providing a proactive detection method for new or unknown threats.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Windows Event ID 5156
      - Internet Egress Points (Firewalls, Proxies)
      - Internal DNS Resolvers
      - Endpoint Devices
    range: Last 90 days
    queries:
      - pseudocode: APPLY classification_model to outbound_connections. ALERT where prediction is 'botnet_c2' AND confidence > 0.90.
  - question: Has any internal host initiated a TLS connection using a client fingerprint (JA3/JA3S) associated with a known botnet malware family?
    context: This question seeks to identify specific malware families by their unique TLS client handshake signatures (JA3/JA3S). Since many malware families have a hardcoded TLS implementation, their fingerprint is a reliable indicator of their presence on a host, even if the destination C2 server is unknown.
    answer_sources:
      - Zeek ssl.log
      - Internet Egress Points (Firewalls, Proxies)
      - Internal DNS Resolvers
    range: Last 90 days
    queries:
      - pseudocode: SEARCH tls_logs WHERE ja3_hash OR ja3s_hash IN known_botnet_fingerprints_list.
  - question: Is any internal host generating a high volume of DNS queries for high-entropy, algorithmically generated domains (DGA)?
    context: This question aims to detect Domain Generation Algorithms (DGAs), a common technique used by botnets to evade static blocklists. By calculating the entropy of queried domains, we can spot the random, non-human-readable patterns characteristic of DGA, indicating a host is trying to locate its C2 server.
    answer_sources:
      - Zeek dns.log
      - Internet Egress Points (Firewalls, Proxies)
      - Internal DNS Resolvers
    range: Last 90 days
    queries:
      - pseudocode: FOR each host, CALCULATE entropy of queried_subdomains in 5-min window. ALERT if entropy > 98th_percentile_baseline.
  - question: Is any internal host exhibiting an anomalous spike in the ratio of failed DNS lookups (NXDOMAIN) to total DNS queries?
    context: This question identifies potential DGA activity by looking for its side effects. Since DGAs generate many domains, most of which are not registered, an infected host will produce a large number of failed DNS lookups (NXDOMAIN responses). An anomalous increase in this ratio for a specific host is a strong indicator of a bot attempting to contact its C2.
    answer_sources:
      - Zeek dns.log
      - Internet Egress Points (Firewalls, Proxies)
      - Internal DNS Resolvers
    range: Last 90 days
    queries:
      - pseudocode: APPLY anomaly_detection_model to NXDOMAIN/total_DNS_queries ratio per host. ALERT on statistically significant anomalies.
  - question: Has a newly created, unsigned, non-browser process initiated a persistent outbound network connection to a non-standard port?
    context: This question links process activity to network behavior to identify suspicious processes acting as a bot agent. Legitimate user applications typically don't behave this way. Correlating the creation of an untrusted process with suspicious network activity provides strong evidence of malware execution.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 5156
      - General User Workstation Subnets
      - Server Subnets
      - Internet Egress Points
    range: Last 90 days
    queries:
      - pseudocode: CORRELATE process_creation_events with outbound_network_connections. ALERT where process is new, unsigned, not a browser, AND connection is persistent on a non-standard port.
  - question: Is any internal host exhibiting highly regular, rhythmic outbound network connections (beaconing) to a single external destination?
    context: This question seeks to identify automated C2 communication by its periodic nature. Bot malware often "beacons" out to its C2 server at a fixed interval to check for commands. By analyzing the time between connections from a single host to a single destination, a near-zero standard deviation reveals this machine-like, non-human pattern.
    answer_sources:
      - Zeek conn.log
      - Windows Event ID 5156
      - General User Workstation Subnets
      - Server Subnets
      - Internet Egress Points
    range: Last 90 days
    queries:
      - pseudocode: GROUP connections by src_ip, dest_ip. CALCULATE std_dev of time_delta between connections. ALERT where std_dev is near zero AND frequency > 99th_percentile.
  - question: Does clustering analysis of network connection metadata reveal patterns consistent with beaconing or scanning from any internal host?
    context: This question uses an unsupervised machine learning approach to discover patterns of beaconing (one-to-one, periodic) or scanning (one-to-many, rapid) without pre-defined rules. By clustering connections based on their attributes, the algorithm can automatically group and flag suspicious activities that might be missed by simple threshold-based methods.
    answer_sources:
      - Zeek conn.log
      - Windows Event ID 4688
      - Windows Event ID 5156
      - General User Workstation Subnets
      - Server Subnets
      - Internet Egress Points
    range: Last 90 days
    queries:
      - pseudocode: APPLY DBSCAN clustering to connection_metadata. ALERT on clusters identified as beaconing (dense one-to-one) or scanning (sparse one-to-many).
  - question: Has our network monitoring system (Zeek) generated any specific notices indicating a potential DDoS attack against a public-facing service?
    context: This question leverages the built-in detection capabilities of network security monitoring tools like Zeek. These tools can identify common attack patterns, such as port scanning or denial-of-service attempts, and generate specific alerts (notices). Monitoring for these notices provides a direct, first-line indicator of a potential attack.
    answer_sources:
      - Zeek notice.log
      - Public-Facing Services (Web Servers, VPN Concentrators)
      - DMZ Network Segments
      - Internet Ingress Points
    range: Last 90 days
    queries:
      - pseudocode: MONITOR notice_log for DDoS-related notices (e.g., 'Scan::Address_Scan', 'Attack::DOS'). TRIGGER alert on detection.
  - question: Is any public-facing service experiencing a statistically significant, simultaneous increase in both inbound connection rate and the number of unique source IPs?
    context: This question aims to detect a distributed denial-of-service (DDoS) attack by baselining normal traffic patterns and alerting on significant deviations. A simultaneous spike in both connection volume and the diversity of source IPs is a classic sign of a volumetric attack orchestrated by a botnet, distinguishing it from a legitimate flash crowd.
    answer_sources:
      - Zeek conn.log
      - Public-Facing Services (Web Servers, VPN Concentrators)
      - DMZ Network Segments
      - Internet Ingress Points
    range: Last 90 days
    queries:
      - pseudocode: FOR each public_service_ip, CALCULATE baseline for connections_per_minute and unique_source_ips_per_minute. ALERT if current metrics > 3 * std_dev above baseline.
  - question: Has the observed volume of inbound traffic or unique source ASNs for a public-facing service significantly exceeded the levels predicted by a time-series forecasting model?
    context: This question uses a more sophisticated statistical method to detect DDoS attacks. By forecasting the expected traffic volume and source ASN diversity, the model can identify anomalies that deviate from normal, even cyclical, patterns. This approach can be more sensitive and produce fewer false positives than simple standard deviation-based methods.
    answer_sources:
      - Zeek conn.log
      - Public-Facing Services (Web Servers, VPN Concentrators)
      - DMZ Network Segments
      - Internet Ingress Points
    range: Last 90 days
    queries:
      - pseudocode: APPLY ARIMA model to forecast inbound_traffic and unique_source_asns. ALERT if observed_traffic > predicted_upper_confidence_interval.
  - question: Have we received a high volume of emails from many different source IPs that all contain the same malicious attachment or URL?
    context: This question aims to identify a botnet-driven spam or phishing campaign. A key indicator is the "many-to-one" pattern, where numerous, unrelated sending IPs distribute an identical payload (attachment hash) or lure (URL). This pattern is highly indicative of a coordinated, automated attack.
    answer_sources:
      - Email Gateway Logs
      - Zeek smtp.log
      - Zeek files.log
      - Mail Gateway Servers
      - Internet Ingress Points
      - User Workstation Subnets
    range: Last 90 days
    queries:
      - pseudocode: COUNT unique source_ips for emails with same attachment_hash OR same url_domain in 1-hour window. ALERT if count > 50.
  - question: Has the diversity (entropy) of source IP addresses for inbound email traffic spiked anomalously?
    context: This question seeks to detect a distributed email campaign by analyzing the randomness of the source IPs. A legitimate, high-volume email source (like a newsletter) will come from a small, predictable set of IPs (low entropy). A botnet campaign, however, will originate from a wide, distributed, and seemingly random set of IPs, resulting in a high entropy score.
    answer_sources:
      - Email Gateway Logs
      - Zeek smtp.log
      - Mail Gateway Servers
      - Internet Ingress Points
      - User Workstation Subnets
    range: Last 90 days
    queries:
      - pseudocode: CALCULATE entropy of source_ips for inbound_email in 10-min windows. ALERT if entropy > 3 * std_dev above baseline.
  - question: Does clustering analysis reveal a large group of highly similar emails originating from an unusually diverse set of Autonomous Systems (ASNs)?
    context: This question combines content analysis with network origin analysis. A clustering algorithm first groups emails based on content similarity (subject, body, links). Then, for any large cluster of similar emails, it checks the diversity of the originating ASNs. A high ASN diversity for a single campaign is a strong signal of a botnet, as the infected machines are spread across many different networks globally.
    answer_sources:
      - Email Gateway Logs
      - Zeek smtp.log
      - Mail Gateway Servers
      - Internet Ingress Points
      - User Workstation Subnets
    range: Last 90 days
    queries:
      - pseudocode: CLUSTER emails by content_features. FOR large clusters, ANALYZE source_asn distribution. ALERT if ASN count is anomalously high.