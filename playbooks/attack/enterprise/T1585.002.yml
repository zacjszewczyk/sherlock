name: T1585.002: Email Accounts
id: 5a8a1b6c-2f9b-4e1d-8c4a-9b7e0f8d1c3a
description: This playbook helps identify if an adversary is acquiring or creating email accounts for use in targeting. Detections focus on identifying inbound emails that match known malicious indicators from threat intelligence, exhibit signs of typosquatting, originate from newly registered domains, or show other anomalous behavior. It also includes checks for internal hosts connecting to disposable email services and suspicious user authentications, such as those from anonymizing services or indicating impossible travel, which may be related to account creation or takeover.
type: technique
related:
- TA0042: Resource Development
contributors:
- Zachary Szewczyk
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
- question: Are inbound emails matching known malicious indicators from threat intelligence feeds?
  context: This is a fundamental check to determine if known bad actors are communicating with the organization. It involves matching sender addresses, domains, source IPs, embedded URLs, and attachment file hashes from inbound emails against high-confidence threat intelligence lists of malicious indicators. A direct match is a strong signal of malicious activity and requires immediate attention.
  answer_sources:
  - Zeek smtp.log
  - Zeek http.log
  - Zeek files.log
  - Threat Intelligence Feed
  - Email Gateway
  - Web Proxy
  - DNS Resolver
  - Network Egress Points
  range: last 90 days
  queries:
  - pseudocode: |-
      FOR each inbound email event
        EXTRACT sender_address, source_ip, url, file_hash
        CHECK if any extracted value EXISTS in Threat_Intelligence_Feed
        IF match, GENERATE high-priority alert
- question: Are there inbound emails from domains with unusually low reputation scores?
  context: This question helps identify potentially malicious senders that are not yet on a specific blocklist. By flagging emails from domains in the bottom 5th percentile of reputation scores (as provided by a threat intelligence feed), analysts can proactively investigate senders that are statistically rare and therefore risky, especially if those emails contain URLs or attachments.
  answer_sources:
  - Zeek smtp.log
  - Zeek http.log
  - Zeek files.log
  - Threat Intelligence Feed
  - Email Gateway
  - Web Proxy
  - DNS Resolver
  - Network Egress Points
  range: last 90 days
  queries:
  - pseudocode: |-
      FOR each inbound email
        GET sender_domain_reputation_score from CTI_feed
        CALCULATE percentile_rank of score
        IF score_percentile < 5 AND email_has_url_or_attachment
          FLAG for review
- question: Can machine learning models identify potentially malicious emails based on their characteristics?
  context: This question explores a proactive, predictive approach to email security. A classification model, such as a Random Forest, can be trained on various features from email metadata (headers, sender), linked URLs (domain age, reputation), and attachments (file type, entropy) to learn the patterns of malicious emails. The model then assigns a probability score to new emails, enabling automated flagging or quarantine of high-risk messages that might otherwise evade simpler detection methods.
  answer_sources:
  - Zeek smtp.log
  - Zeek http.log
  - Zeek files.log
  - Threat Intelligence Feed
  - Email Gateway
  - Web Proxy
  - DNS Resolver
  - Network Egress Points
  range: last 90 days
  queries:
  - pseudocode: |-
      FOR each inbound email
        EXTRACT features (sender, headers, url_domain_age, file_entropy)
        INPUT features into classification_model
        IF predicted_probability > 0.9
          FLAG for review or quarantine
- question: Is there any communication with known typosquatted or combosquatted domains targeting our organization?
  context: This question addresses the threat of typosquatting, where adversaries register domains that are slight variations of a legitimate domain to trick users. By pre-generating a list of these potential imposter domains using permutation tools and continuously monitoring for any network traffic (DNS queries) or emails involving them, security teams can detect and block these attacks at an early stage.
  answer_sources:
  - Zeek dns.log
  - Zeek smtp.log
  - Internal DNS Resolvers
  - Email Gateway
  range: last 90 days
  queries:
  - pseudocode: |-
      GENERATE list of potential typosquat_domains
      FOR each DNS query or email event
        CHECK if domain in event MATCHES typosquat_domains list
        IF match, GENERATE high-priority alert
- question: Are we observing statistically unusual domain names that might indicate typosquatting or algorithmic generation?
  context: This question uses statistical methods to find suspicious domains without relying on a pre-generated list. It involves two distinct checks: 1) Calculating the Levenshtein distance between newly observed domains and a list of legitimate company and partner domains to find close lookalikes (typosquatting). 2) Calculating the Shannon entropy of domain names to spot the high degree of randomness typical of Domain Generation Algorithms (DGAs). A domain flagged by either method warrants further investigation.
  answer_sources:
  - Zeek dns.log
  - Zeek smtp.log
  - Internal DNS Resolvers
  - Email Gateway
  range: last 90 days
  queries:
  - pseudocode: |-
      FOR each newly observed domain
        CALCULATE Levenshtein_distance to known_legitimate_domains
        IF distance <= 2 AND domain is not allowlisted, FLAG for review
        CALCULATE Shannon_entropy of domain FQDN
        IF entropy > (population_mean + 3 * standard_deviation), FLAG for review
- question: Can a machine learning model automatically classify newly observed domains as legitimate or suspicious based on their linguistic structure?
  context: This question leverages Natural Language Processing (NLP) to detect sophisticated domain spoofing techniques. An ML classification model can be trained to recognize malicious patterns such as homoglyphs (using characters that look similar), added or omitted characters, and common combosquatting formats (e.g., 'company-support.com'). This allows for the automated classification of all newly observed domains, flagging suspicious ones for analyst review.
  answer_sources:
  - Zeek dns.log
  - Zeek smtp.log
  - Internal DNS Resolvers
  - Email Gateway
  range: last 90 days
  queries:
  - pseudocode: |-
      FOR each newly observed domain
        INPUT domain_name into NLP_classification_model
        IF model_output == 'suspicious'
          SUBMIT domain for analyst review
- question: Are we receiving emails from recently registered domains?
  context: This question targets a common adversary tactic of using newly created domains for malicious campaigns, as these domains lack any established history or reputation. The analytic involves performing a WHOIS lookup on the sender's domain for every inbound email and flagging any that were created within the last 30 days (and are not on a pre-approved allowlist) for closer inspection.
  answer_sources:
  - Zeek smtp.log
  - WHOIS Lookup Data
  - HR Information System
  - Email Gateway
  - External Threat Intelligence Platforms
  - Identity and Access Management System
  range: last 90 days
  queries:
  - pseudocode: |-
      FOR each inbound email
        GET sender_domain
        PERFORM WHOIS lookup on sender_domain
        IF domain_creation_date < 30 days ago AND domain NOT in allowlist
          FLAG email for further analysis
- question: Are any new, unknown domains sending an unusually high volume of emails to internal recipients, particularly high-value targets?
  context: This question aims to detect the start of a targeted campaign from a previously unseen source. By establishing a baseline of normal email traffic, we can identify when a new domain suddenly emails a large number of internal users, exceeding a statistical threshold (e.g., the 95th percentile for new domains). This is a strong indicator of a potential spear-phishing campaign, especially if the recipients are executives or hold sensitive roles.
  answer_sources:
  - Zeek smtp.log
  - WHOIS Lookup Data
  - HR Information System
  - Email Gateway
  - External Threat Intelligence Platforms
  - Identity and Access Management System
  range: last 90 days
  queries:
  - pseudocode: |-
      MAINTAIN 90-day baseline of known_sender_domains
      FOR each sender_domain not in baseline
        TRACK number of unique recipients over 24 hours
        IF recipient_count > 95th_percentile_for_new_domains
          GENERATE alert for potential targeted campaign
- question: Can we detect anomalous spikes in email volume from new domains using time-series analysis?
  context: This question uses a more advanced statistical method to spot malicious campaigns. A time-series model (e.g., ARIMA or LSTM) learns the normal pattern and volume of email traffic originating from new domains (those not seen in the last 90 days). The model then monitors this traffic, and if it detects a sudden, significant spike from a single new domain that deviates from the established pattern, it triggers an alert, indicating a possible coordinated attack.
  answer_sources:
  - Zeek smtp.log
  - WHOIS Lookup Data
  - HR Information System
  - Email Gateway
  - External Threat Intelligence Platforms
  - Identity and Access Management System
  range: last 90 days
  queries:
  - pseudocode: |-
      MODEL email volume from new_domains using a time-series model (e.g., ARIMA)
      FOR each new domain
        MONITOR its traffic volume
        IF volume is a significant anomaly compared to model prediction
          TRIGGER an alert
- question: Are any internal servers or hosts in restricted subnets attempting to connect to known disposable email services?
  context: This question helps enforce security policies and detect suspicious activity where it is least expected. Adversaries or malicious insiders might use disposable email services for data exfiltration or command and control. This action involves maintaining a blocklist of such services and monitoring for any outbound connection attempts from sensitive network zones, like server subnets, where this activity is forbidden.
  answer_sources:
  - Zeek dns.log
  - Zeek http.log
  - Zeek conn.log
  - Web Proxy
  - DNS Resolver
  - Network Egress Points
  - Server Subnets
  range: last 90 days
  queries:
  - pseudocode: |-
      MAINTAIN blocklist of disposable_email_service_indicators
      MONITOR outbound connections from restricted subnets
      IF connection from restricted_host to indicator in blocklist
        BLOCK connection and GENERATE high-priority alert
- question: Are any internal hosts connecting to an abnormally high number of unique email provider domains in a short time frame?
  context: This question aims to detect automated scripts used for creating or testing large numbers of email accounts. By establishing a behavioral baseline for each internal host, an alert can be triggered when a host suddenly connects to an unusually high number of unique email service domains (e.g., more than 5 in 10 minutes, or 3 standard deviations above its own baseline). This outlier behavior is a strong indicator of malicious automation.
  answer_sources:
  - Zeek dns.log
  - Zeek http.log
  - Zeek conn.log
  - Web Proxy
  - DNS Resolver
  - Network Egress Points
  - Server Subnets
  range: last 90 days
  queries:
  - pseudocode: |-
      FOR each internal host
        ESTABLISH baseline of unique email provider domains accessed per hour
        USING a 10-minute sliding window
          IF host connects to > 5 unique email domains OR > 3 standard deviations from its baseline
            GENERATE alert
- question: Can we use machine learning to identify clusters of network behavior that are indicative of automated email account creation?
  context: This is an unsupervised learning approach to find unknown malicious patterns. A clustering algorithm (like DBSCAN) groups network connections based on their metadata (duration, bytes sent/received, destination port). The goal is to detect the emergence of a new, distinct cluster. A cluster characterized by many short, repetitive, low-data connections to multiple unrelated domains would be highly suspicious and likely represent an automated script for account registration.
  answer_sources:
  - Zeek dns.log
  - Zeek http.log
  - Zeek conn.log
  - Web Proxy
  - DNS Resolver
  - Network Egress Points
  - Server Subnets
  range: last 90 days
  queries:
  - pseudocode: |-
      APPLY clustering algorithm (e.g., DBSCAN) to network connection metadata
      MONITOR for the emergence of new clusters
      IF a new cluster shows characteristics of automation (short, repetitive, low-volume connections)
        INVESTIGATE associated hosts
- question: Are successful user authentications originating from known malicious IP addresses, Tor nodes, or anonymizing services?
  context: This is a critical check for account compromise. It involves taking the source IP address from every successful login event (e.g., Windows Event ID 4624) and checking it against a threat intelligence feed of known malicious IPs, Tor exit nodes, and public VPN services. A match indicates a high-risk login that should trigger an immediate alert and an automated response, such as forcing MFA or terminating the session.
  answer_sources:
  - Windows Event ID 4624
  - Zeek conn.log
  - GeoIP Database
  - Authentication Servers (e.g., ADFS)
  - VPN Concentrators
  - Cloud Identity Provider Logs
  range: last 90 days
  queries:
  - pseudocode: |-
      FOR each successful login event
        GET source_ip
        CHECK if source_ip EXISTS in malicious_ip_feed
        IF match, GENERATE high-priority alert and INITIATE response
- question: Are there any successful logins that are statistically anomalous, such as indicating impossible travel or originating from a rare network (ASN)?
  context: This question seeks to identify compromised accounts through statistical anomalies in login patterns. It combines two checks: 1) 'Impossible travel' detection, which calculates the speed required to travel between two consecutive login locations and flags it if physically impossible (e.g., >1000 km/h). 2) ASN rarity, which flags a login if it originates from an Autonomous System Number (ASN) that the user has rarely or never used before. Both are strong indicators of a compromised account.
  answer_sources:
  - Windows Event ID 4624
  - Zeek conn.log
  - GeoIP Database
  - Authentication Servers (e.g., ADFS)
  - VPN Concentrators
  - Cloud Identity Provider Logs
  range: last 90 days
  queries:
  - pseudocode: |-
      FOR each user's successful login
        COMPARE with previous login's location and timestamp
        IF implied_velocity > 1000 km/h, FLAG as impossible travel
        MAINTAIN baseline of user's source ASNs
        IF login_asn accounts for < 1% of user's historical logins, FLAG as rare ASN
- question: Can a machine learning model, trained on a user's normal login behavior, detect anomalous and potentially compromised login attempts?
  context: This describes a sophisticated, user-centric anomaly detection system. For each user, a model (e.g., One-Class SVM or an autoencoder) is trained on their typical login patterns—including time of day, geolocation, source ASN, and user agent—to create a 'normal' behavioral profile. Every new login is then scored against this profile. Logins that deviate significantly are flagged as high-risk anomalies, providing a powerful way to detect account takeovers.
  answer_sources:
  - Windows Event ID 4624
  - Zeek conn.log
  - GeoIP Database
  - Authentication Servers (e.g., ADFS)
  - VPN Concentrators
  - Cloud Identity Provider Logs
  range: last 90 days
  queries:
  - pseudocode: |-
      FOR each user
        TRAIN behavioral anomaly detection model on historical login features
      FOR each new login
        SCORE login against user's model
        IF login is classified as an anomaly (high anomaly score)
          FLAG for immediate review