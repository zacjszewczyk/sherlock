name: T1592.001: Hardware
id: a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d
description: This playbook helps investigate whether an adversary is gathering information about the organization's host hardware during reconnaissance. This can manifest as external scanning from known malicious IPs, execution of hardware enumeration commands (like 'systeminfo') on internal hosts, high volumes of failed connection attempts indicative of network sweeps, unauthorized SNMP or SMB queries, or the correlation of hardware enumeration commands followed immediately by outbound network connections to suspicious destinations.
type: technique
related:
  - TA0043: Reconnaissance
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Are known malicious IPs from our threat intelligence feeds connecting to our network?
    context: This question seeks to identify inbound network connections originating from IP addresses that are already flagged as malicious, scanners, or TOR exit nodes. Detecting such connections early is crucial as it's a strong indicator of targeted reconnaissance or the initial stages of an attack. An alert from a pre-populated list provides a high-fidelity signal that warrants immediate investigation.
    answer_sources:
      - Zeek conn.log
      - Zeek http.log
      - Internet gateways
      - perimeter firewalls
      - public-facing web servers
      - DMZ subnets
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: SEARCH Zeek conn.log WHERE source_ip IN (threat_intelligence_feed) AND direction = 'inbound'
  - question: Is any single external IP address exhibiting scanning behavior by connecting to an unusually high number of unique hosts or ports?
    context: This question uses statistical analysis to uncover scanning activity that might not be caught by signature-based rules. Adversaries often perform horizontal scans (probing many hosts) or vertical scans (probing many ports on one host) to map the network and find vulnerabilities. By baselining normal traffic and alerting on statistical outliers (e.g., the 99th percentile), we can detect potential scanners even if their IP is not yet on a threat list.
    answer_sources:
      - Zeek conn.log
      - Zeek http.log
      - Internet gateways
      - perimeter firewalls
      - public-facing web servers
      - DMZ subnets
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: FROM Zeek conn.log, GROUP BY source_ip OVER 10_minutes, CALCULATE distinct_count(destination_host), distinct_count(destination_port). ALERT IF distinct_count(destination_host) > 99th_percentile OR distinct_count(destination_port) > 99th_percentile.
  - question: Can we use machine learning to classify incoming network connections and identify potential scanning or malicious activity?
    context: This question explores using a machine learning model (Random Forest) to automatically classify network traffic. By training on various features of a connection, the model can learn the subtle patterns that differentiate benign traffic from malicious reconnaissance or scanning. This approach can identify novel or sophisticated attacks that evade simpler statistical or signature-based methods, providing a more robust layer of detection.
    answer_sources:
      - Zeek conn.log
      - Zeek http.log
      - Internet gateways
      - perimeter firewalls
      - public-facing web servers
      - DMZ subnets
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: INPUT Zeek conn.log features (duration, bytes, protocol, etc.) INTO Random_Forest_Model. ALERT IF model_output = 'scan' OR model_output = 'malicious'.
  - question: Are hardware enumeration commands being executed by unusual parent processes like web servers or Office applications?
    context: Adversaries who have gained initial access may run commands like 'systeminfo' to learn about the compromised system. Legitimate use of these commands is rare from processes like a web server ('w3wp.exe') or Microsoft Word. This question looks for this specific, high-confidence indicator of compromise, where a typically non-interactive process spawns a command-line tool for system reconnaissance.
    answer_sources:
      - Windows Event ID 4688
      - Domain controllers
      - database servers
      - developer workstations
      - executive endpoints
      - web servers
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: SEARCH Windows Event ID 4688 WHERE (process_name IN ['systeminfo', 'dxdiag', 'msinfo32'] OR command_line CONTAINS 'Get-ComputerInfo') AND parent_process_name IN ['w3wp.exe', 'winword.exe', 'excel.exe']
  - question: Are hardware enumeration commands being executed with a statistically rare frequency by any user or on any host?
    context: This question aims to detect anomalous executions of reconnaissance commands by establishing a baseline of normal activity for each user and host. Even if a command is run by an administrative user, a sudden and unusual spike in its execution frequency could indicate malicious activity, such as a script being run across multiple machines. Alerting on rare events helps surface suspicious behavior that might otherwise be lost in the noise.
    answer_sources:
      - Windows Event ID 4688
      - Domain controllers
      - database servers
      - developer workstations
      - executive endpoints
      - web servers
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: FROM Windows Event ID 4688, GROUP BY user, host, process_name, CALCULATE frequency. ALERT IF frequency > 95th_percentile_baseline.
  - question: Can we use machine learning to detect anomalous parent-child process relationships involving hardware reconnaissance commands?
    context: This question applies an anomaly detection model (Isolation Forest) to learn the normal patterns of process creation on endpoints. The model can identify unusual sequences, such as a legitimate but rarely-used parent process spawning a reconnaissance tool. This is more powerful than a static rule, as it can adapt to the environment and flag novel combinations that indicate a compromise.
    answer_sources:
      - Windows Event ID 4688
      - Domain controllers
      - database servers
      - developer workstations
      - executive endpoints
      - web servers
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: INPUT Windows Event ID 4688 data (parent_process, child_process, command_line) INTO Isolation_Forest_Model. ALERT IF model_output = 'anomaly' AND child_process IN ['systeminfo', 'dxdiag', etc.].
  - question: Is any single external IP generating a high volume of rejected or reset connections, indicating a network sweep?
    context: This question looks for a classic sign of a network scan, a large number of failed connection attempts from a single source. When firewalls or closed ports reject connections, they generate 'REJ' or 'RST' statuses. A simple threshold rule (e.g., >100 failed connections in 5 minutes) is a highly effective way to detect brute-force scanning activity from an external adversary.
    answer_sources:
      - Zeek conn.log
      - Perimeter firewalls
      - internet-facing network sensors
      - network backbone taps
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: FROM Zeek conn.log, COUNT connections WHERE connection_state IN ['REJ', 'RSTO', 'RSTR'] GROUP BY source_ip OVER 5_minutes. ALERT IF count > 100.
  - question: Are any external IPs showing high port entropy or an abnormally low ratio of successful to failed connections?
    context: This question uses more sophisticated statistical measures to detect scanning. High Shannon entropy in destination ports indicates randomness, a hallmark of a port scan. Similarly, a very low ratio of successful connections to failed ones is abnormal for legitimate traffic but typical for a scanner probing for open ports. These metrics can detect stealthier scanning techniques that might fly under simple volume-based thresholds.
    answer_sources:
      - Zeek conn.log
      - Perimeter firewalls
      - internet-facing network sensors
      - network backbone taps
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: FROM Zeek conn.log, GROUP BY source_ip OVER 1_minute, CALCULATE shannon_entropy(destination_port), ratio(successful_connections, failed_connections). ALERT IF shannon_entropy > 98th_percentile OR ratio < 5th_percentile.
  - question: Can a time series model detect low-and-slow scanning activity from new external IPs?
    context: This question addresses the challenge of detecting 'low-and-slow' scans, where adversaries spread out their connection attempts over a long period to evade threshold-based detection. A time series model (like an LSTM autoencoder) can learn the normal 'background noise' of the network and detect subtle deviations caused by a slow, methodical scan, especially from IPs that have never connected before.
    answer_sources:
      - Zeek conn.log
      - Perimeter firewalls
      - internet-facing network sensors
      - network backbone taps
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: INPUT time_series_volume_of_new_IP_connections INTO LSTM_Autoencoder_Model. ALERT IF reconstruction_error > threshold.
  - question: Are we observing SNMP or SMB traffic from external sources or from internal hosts not on our authorized admin list?
    context: SNMP and SMB are powerful protocols for administration and information gathering, but they should never be exposed to the public internet. This question uses a simple but powerful rule, alert on any SNMP/SMB traffic from an external IP or from an internal host that is not on a pre-defined 'allowlist' of network management systems. This is a high-fidelity indicator of misconfiguration or malicious reconnaissance.
    answer_sources:
      - Zeek conn.log
      - Zeek smb_mapping.log
      - Zeek snmp.log
      - Internal server subnets
      - network management segments
      - legacy equipment zones
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: SEARCH Zeek logs FOR protocol IN ['SNMP', 'SMB'] WHERE (source_ip_is_external OR source_ip NOT IN (authorized_admin_hosts_allowlist)).
  - question: Are there new or statistically unusual SMB/SNMP communication patterns between internal hosts?
    context: This question looks for lateral movement or internal reconnaissance. By baselining which internal hosts normally communicate using SMB or SNMP, we can detect anomalous new connections. For example, if a user's workstation suddenly starts making SMB queries to a dozen servers it has never contacted before, it's a strong sign of compromise. Alerting on new pairs or a significant deviation in volume for existing pairs can uncover this activity.
    answer_sources:
      - Zeek conn.log
      - Zeek smb_mapping.log
      - Zeek snmp.log
      - Internal server subnets
      - network management segments
      - legacy equipment zones
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: FROM Zeek SMB/SNMP logs, BASELINE source-destination_pairs over 30_days. ALERT IF new_pair_appears OR connection_count > (mean + 3 * stdev).
  - question: Can a graph analysis model identify hosts making anomalous SMB or SNMP queries outside their normal activity cluster?
    context: This question models the network as a social graph, where hosts that frequently communicate form communities or clusters. A community detection algorithm can automatically identify these groups (e.g., the 'accounting servers' cluster). An alert is triggered if a host suddenly starts communicating via SMB/SNMP with many hosts outside its normal community, indicating it may be compromised and performing network-wide reconnaissance.
    answer_sources:
      - Zeek conn.log
      - Zeek smb_mapping.log
      - Zeek snmp.log
      - Internal server subnets
      - network management segments
      - legacy equipment zones
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: MODEL network as graph (nodes=hosts, edges=communications). APPLY Louvain_community_detection. ALERT IF host initiates SMB/SNMP to nodes outside its_community.
  - question: Has a hardware enumeration command been executed shortly before an outbound connection to a known-bad IP address?
    context: This question correlates two distinct but related events to detect data exfiltration following reconnaissance. An adversary runs a command like 'systeminfo' to gather data, then immediately connects to a command-and-control server to send it. A stateful rule that looks for Event A (recon command) followed by Event B (outbound connection to bad IP) within a short time window (e.g., 60 seconds) is a very strong indicator of an active compromise.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 5156
      - Zeek conn.log
      - Critical application servers
      - administrator workstations
      - endpoints handling sensitive data
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: CORRELATE (Windows Event 4688 WHERE process_name = 'systeminfo.exe') with (Zeek conn.log WHERE destination_ip_reputation = 'bad') ON same_host WITHIN 60_seconds.
  - question: Is the sequence of a hardware reconnaissance command followed by an outbound network connection statistically improbable?
    context: This question quantifies the likelihood of the reconnaissance-to-exfiltration event sequence. It first establishes a baseline probability of any process being followed by an outbound connection. It then calculates the specific conditional probability for a recon command. If this sequence is statistically rare (e.g., p-value < 0.01), it suggests the events are not coincidental and are likely part of a malicious chain of actions, even if the destination IP is not on a threat list.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 5156
      - Zeek conn.log
      - Critical application servers
      - administrator workstations
      - endpoints handling sensitive data
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: CALCULATE P(outbound_connection | any_process). CALCULATE P(outbound_connection | recon_process). ALERT IF P(outbound_connection | recon_process) is statistically significant (p-value < 0.01).
  - question: Can a sequence analysis model detect the anomalous pattern of reconnaissance followed by an external connection?
    context: This question uses a sequence analysis model, like a Hidden Markov Model (HMM), to learn the normal transitions between system events (states). The model learns what a 'normal' sequence of process creations and network connections looks like. It will then flag a sequence like 'reconnaissance process' -> 'outbound connection to new IP' as having a low probability, thus identifying it as an anomaly indicative of malicious behavior without relying on pre-defined signatures.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 5156
      - Zeek conn.log
      - Critical application servers
      - administrator workstations
      - endpoints handling sensitive data
    range: last 90 days
    queries:
      - technology: Pseudocode
        query: INPUT sequence_of(process_event, network_event) INTO HMM_Model. ALERT IF model identifies a low-probability_sequence involving recon_process.