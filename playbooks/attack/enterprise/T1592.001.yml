name: T1592.001: Hardware
id: d2d9b2e0-5a7c-4a3b-8f1e-9c0d1b2a3f4d
description: This playbook helps investigate if an adversary is gathering information about the organization's host hardware during reconnaissance. This can manifest as network scanning from external malicious IPs, execution of hardware enumeration commands (like 'systeminfo') on internal hosts, high volumes of rejected network connections indicative of sweeps, unauthorized SNMP or SMB queries from internal or external sources, or a combination of enumeration commands followed immediately by data exfiltration to a low-reputation IP address.
type: technique
related: TA0043: Reconnaissance
contributors: Zachary Szewczyk, Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Are known malicious IP addresses, network scanners, or TOR exit nodes attempting to connect to internal hosts?
    context: This question aims to identify initial reconnaissance attempts from known threat actors. By cross-referencing inbound connection logs with a threat intelligence feed of malicious IP addresses, analysts can detect high-confidence indicators of an adversary beginning to probe the network perimeter to gather information about accessible hardware and services.
    answer_sources: Zeek conn.log, Zeek http.log, Internet gateways, perimeter firewalls, public-facing web servers, DMZ subnets
    range: last 90 days
    queries:
      - technology: SIEM
        query: SEARCH Zeek conn.log WHERE source_ip IN threat_intel_feed AND connection_direction=inbound | ALERT
  - question: Are any external IP addresses exhibiting network scanning behavior by connecting to an unusually high number of unique hosts or ports in a short time frame?
    context: This question helps detect network scanning that may not originate from a known malicious IP. By analyzing the fan-out ratio (connections to many hosts) and port scan ratio (connections to many ports on one host), analysts can statistically identify outlier behavior indicative of horizontal or vertical scanning, which are common methods for hardware and service discovery.
    answer_sources: Zeek conn.log, Zeek http.log, Internet gateways, perimeter firewalls, public-facing web servers, DMZ subnets
    range: last 90 days
    queries:
      - technology: SIEM/Data Analytics Platform
        query: FROM Zeek conn.log OVER 10min_window | CALCULATE unique_dest_hosts, unique_dest_ports BY source_ip | ALERT if unique_dest_hosts > 99th_percentile OR unique_dest_ports > 99th_percentile
  - question: Can incoming network connections be automatically classified as benign, scanning, or malicious to prioritize analyst review?
    context: This question explores the use of machine learning to proactively identify reconnaissance activity. By training a model on various network traffic features, it can learn to distinguish normal traffic from scanning attempts. This allows for the automatic flagging of suspicious connections for an analyst to investigate, reducing manual effort and improving detection speed.
    answer_sources: Zeek conn.log, Zeek http.log, Internet gateways, perimeter firewalls, public-facing web servers, DMZ subnets
    range: last 90 days
    queries:
      - technology: Machine Learning Platform
        query: PREDICT connection_class FROM Zeek conn.log features (duration, bytes, protocol) | IF class='scan' THEN ROUTE to analyst_queue
  - question: Are hardware enumeration commands (e.g., systeminfo, Get-ComputerInfo) being executed by unusual processes, such as a web server or Office application?
    context: This question focuses on detecting internal reconnaissance on a compromised host. Adversaries often use built-in system utilities to gather information about the underlying hardware. Execution of these commands by a process that has no legitimate reason to do so (like a web server process) is a strong indicator of post-exploitation activity.
    answer_sources: Windows Event ID 4688, Domain controllers, database servers, developer workstations, executive endpoints, web servers
    range: last 90 days
    queries:
      - technology: SIEM/EDR
        query: SEARCH EventID=4688 WHERE (process_name IN ['systeminfo.exe', 'dxdiag.exe'] OR command_line CONTAINS 'Get-ComputerInfo') AND parent_process_name IN ['w3wp.exe', 'winword.exe'] | ALERT
  - question: Is there a statistically rare execution of a hardware reconnaissance command by a specific user or on a specific host?
    context: This question helps identify anomalous internal reconnaissance by establishing a baseline of normal command usage. While an administrator might run 'systeminfo' occasionally, the same command run by a regular user or on a sensitive server where it has never been run before could be malicious. Calculating a rarity score helps surface these statistically significant deviations from normal behavior.
    answer_sources: Windows Event ID 4688, Domain controllers, database servers, developer workstations, executive endpoints, web servers
    range: last 90 days
    queries:
      - technology: Data Analytics Platform
        query: FOR each EventID=4688 with recon_command | CALCULATE rarity_score based on historical user/host frequency | ALERT if rarity_score > 95th_percentile
  - question: Can anomalous parent-child process relationships involving hardware reconnaissance commands be detected using machine learning?
    context: This question leverages machine learning to automatically learn and detect abnormal process execution chains. An Isolation Forest model, for example, can baseline legitimate process behavior and flag any execution that deviates from this norm, such as a script launched by an Office macro that then runs 'Get-WmiObject' to enumerate hardware. This method can catch novel or obfuscated attack patterns.
    answer_sources: Windows Event ID 4688, Domain controllers, database servers, developer workstations, executive endpoints, web servers
    range: last 90 days
    queries:
      - technology: Machine Learning/EDR
        query: PREDICT anomaly_score for each process_creation_event (parent, child, command_line) | ALERT if score indicates anomaly AND child is recon_command
  - question: Is a single external IP address generating a high volume of failed or rejected connections across the network?
    context: This question aims to detect network sweeps, a common reconnaissance technique where an attacker sends packets to many hosts or ports to see what responds. A large number of rejected ('REJ') or reset ('RST') connections from a single source is a strong indication that an automated scanner is mapping the network perimeter by identifying which addresses are not live or which ports are closed.
    answer_sources: Zeek conn.log, Perimeter firewalls, internet-facing network sensors, network backbone taps
    range: last 90 days
    queries:
      - technology: SIEM
        query: FROM Zeek conn.log OVER 5min_window | COUNT connections WHERE conn_state IN ['REJ', 'RSTO', 'RSTR'] BY source_ip | ALERT if count > 100
  - question: Are there external source IPs exhibiting a high degree of randomness in destination ports or an extremely low ratio of successful to failed connections?
    context: This question uses statistical measures to identify more subtle scanning activity. High Shannon entropy in destination ports indicates the source is not targeting a specific service but is instead probing a wide, random range of ports. A very low success ratio suggests the source is blindly guessing at open ports. Both are hallmarks of a network scan.
    answer_sources: Zeek conn.log, Perimeter firewalls, internet-facing network sensors, network backbone taps
    range: last 90 days
    queries:
      - technology: Data Analytics Platform
        query: FROM Zeek conn.log OVER 1min_window | CALCULATE port_entropy, success_fail_ratio BY source_ip | ALERT if port_entropy > 98th_percentile OR success_fail_ratio < 5th_percentile
  - question: Can time-series analysis detect low-and-slow network scanning that deviates from normal background network noise?
    context: This question targets sophisticated adversaries who conduct reconnaissance over long periods to evade simple threshold-based alerts. A time-series model like an LSTM autoencoder can learn the normal rhythm and volume of inbound connection attempts from new IPs. It can then flag subtle, sustained increases in traffic that represent a "low-and-slow" scan, which would otherwise be lost in the noise.
    answer_sources: Zeek conn.log, Perimeter firewalls, internet-facing network sensors, network backbone taps
    range: last 90 days
    queries:
      - technology: Machine Learning Platform
        query: PREDICT anomaly_score for time_series of new_ip_connection_volume | ALERT if score indicates deviation from learned normal pattern
  - question: Are SNMP or SMB queries originating from an external IP or an unauthorized internal host?
    context: This question focuses on detecting reconnaissance that targets specific administrative protocols. SNMP and SMB can reveal detailed hardware, software, and configuration information. Since these protocols should only be used by specific administrative systems, any traffic from an external source or an internal host not on an authorized allowlist is highly suspicious and warrants an immediate alert.
    answer_sources: Zeek conn.log, Zeek smb_mapping.log, Zeek snmp.log, Internal server subnets, network management segments, legacy equipment zones
    range: last 90 days
    queries:
      - technology: SIEM
        query: SEARCH Zeek logs for SMB or SNMP traffic | ALERT if source_ip is external OR (source_ip is internal AND source_ip NOT IN admin_allowlist)
  - question: Are there new or statistically unusual internal SMB/SNMP communication patterns between hosts?
    context: This question seeks to identify lateral movement or internal reconnaissance by baselining normal administrative traffic. An attacker moving within the network might use a compromised workstation to query servers via SMB or SNMP. This action would create a new communication path (e.g., workstation-to-server) or a significant spike in traffic on an existing path, both of which can be detected as a statistical deviation from the norm.
    answer_sources: Zeek conn.log, Zeek smb_mapping.log, Zeek snmp.log, Internal server subnets, network management segments, legacy equipment zones
    range: last 90 days
    queries:
      - technology: Data Analytics Platform
        query: BASELINE SMB/SNMP source-dest_pairs and daily_counts over 30 days | ALERT if new source-dest_pair appears OR daily_count > 3_std_dev_from_avg
  - question: Can graph analysis and community detection identify hosts initiating SMB or SNMP reconnaissance outside of their normal activity clusters?
    context: This question applies a graph-based machine learning approach to network traffic. By modeling the network as a graph, algorithms can identify "communities" of hosts that frequently interact (e.g., a web server tier, a database cluster). An alert can be triggered if a host suddenly starts SMB or SNMP communication with a large number of hosts outside its usual community, suggesting it has been compromised and is being used for network-wide reconnaissance.
    answer_sources: Zeek conn.log, Zeek smb_mapping.log, Zeek snmp.log, Internal server subnets, network management segments, legacy equipment zones
    range: last 90 days
    queries:
      - technology: Graph Analytics/ML Platform
        query: MODEL network as graph from comm logs | IDENTIFY communities | ALERT if node initiates SMB/SNMP to many nodes outside its community
  - question: Has a hardware enumeration command been executed on a host, immediately followed by an outbound network connection to a low-reputation IP?
    context: This question correlates internal host activity with outbound network traffic to detect a common attack chain: gather and exfiltrate. An adversary who runs a command like 'systeminfo' to gather hardware details may immediately attempt to send that information to a command-and-control server. A stateful rule that links these two events within a short time window (e.g., 60 seconds) provides a high-fidelity alert for active reconnaissance and data staging.
    answer_sources: Windows Event ID 4688, Windows Event ID 5156, Zeek conn.log, Critical application servers, administrator workstations, endpoints handling sensitive data
    range: last 90 days
    queries:
      - technology: SIEM/XDR
        query: TRIGGER on EventID=4688 with recon_command | IF within 60s, same host makes outbound connection (EventID=5156 or Zeek conn.log) AND dest_ip_reputation=poor, THEN ALERT
  - question: Is the sequence of a hardware enumeration command followed by an outbound network connection a statistically significant event on a given host?
    context: This question aims to quantify the suspiciousness of the "gather and exfiltrate" pattern. For any given host, there is a baseline probability that a random process will be followed by a network connection. By calculating the conditional probability of this specific sequence (recon command -> outbound connection) and comparing it to the baseline, analysts can determine if the event is statistically rare (e.g., p-value < 0.01) and therefore highly likely to be malicious.
    answer_sources: Windows Event ID 4688, Windows Event ID 5156, Zeek conn.log, Critical application servers, administrator workstations, endpoints handling sensitive data
    range: last 90 days
    queries:
      - technology: Data Analytics Platform
        query: CALCULATE baseline probability P(outbound_conn | any_process) | WHEN recon_command -> outbound_conn occurs, CALCULATE P(outbound_conn | recon_command) | ALERT if p-value < 0.01 vs baseline
  - question: Can a sequence analysis model detect the anomalous pattern of a reconnaissance command followed by an outbound network connection?
    context: This question applies sequence modeling, like a Hidden Markov Model (HMM), to learn the normal transitions between host events (e.g., 'benign process' -> 'benign network activity'). The trained model can then identify low-probability sequences that don't fit the learned normal patterns. The sequence of 'reconnaissance process' followed by 'outbound connection to new IP' would be a very low-probability transition in a benign model, allowing for its detection as an anomaly.
    answer_sources: Windows Event ID 4688, Windows Event ID 5156, Zeek conn.log, Critical application servers, administrator workstations, endpoints handling sensitive data
    range: last 90 days
    queries:
      - technology: Machine Learning Platform
        query: TRAIN HMM on sequences of (process, network) events | FEED live events to model | ALERT if model observes low-probability transition, e.g., 'recon_process' -> 'outbound_conn_new_ip'