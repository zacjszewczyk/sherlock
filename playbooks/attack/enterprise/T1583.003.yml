name: T1583.003: Virtual Private Server
id: a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d
description: This playbook helps investigate if an adversary is using a Virtual Private
  Server (VPS) for operations. It provides methods to detect this activity by analyzing
  outbound network connections for matches against threat intelligence, identifying
  Command and Control (C2) framework signatures (like JA3/JA3S hashes or banners),
  examining DNS queries for suspicious domains (newly registered, high entropy, or
  dynamic DNS), monitoring for recurring 'heartbeat' connections to VPS provider
  IP ranges, and inspecting TLS certificates for anomalies like being self-signed
  or having a short validity period.
type: technique
related:
- TA0042: Resource Development
contributors:
- Zachary Szewczyk
- Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
- question: Are internal hosts connecting to IPs, domains, or using certificates
    associated with known malicious VPS infrastructure on threat intelligence feeds?
  context: This question aims to detect direct communication with known adversary
    infrastructure hosted on VPSs. By cross-referencing outbound network logs (connections,
    DNS, TLS) with a threat intelligence feed, analysts can quickly identify compromised
    hosts communicating with command and control servers or other malicious endpoints.
    A match is a high-fidelity indicator of a potential breach.
  answer_sources:
  - Zeek conn.log
  - Zeek dns.log
  - Zeek ssl.log
  - Zeek x509.log
  - Threat Intelligence Feed
  - Network Egress Points (e.g., Internet Gateway, Firewalls, Proxies)
  - Internal DNS Resolvers
  range: last 90 days
  queries:
  - search_technology: pseudocode
    query: JOIN (conn_logs, dns_logs, ssl_logs) WITH threat_intel_feed ON (destination_ip,
      domain, cert_hash); ALERT on match;
- question: Are any internal hosts making an unusually high number of connections
    to Autonomous Systems (ASNs) known to be associated with major VPS providers?
  context: Adversaries often use multiple servers within the same VPS provider. A
    sudden increase in connections from a single internal host to a VPS provider's
    ASN can indicate scanning, data exfiltration, or C2 communication. This question
    helps identify anomalous behavior by baselining normal connection patterns and
    flagging significant deviations, pointing to potential misuse of legitimate hosting
    services for malicious purposes.
  answer_sources:
  - Zeek conn.log
  - Zeek dns.log
  - Zeek ssl.log
  - Zeek x509.log
  - Threat Intelligence Feed
  - Network Egress Points (e.g., Internet Gateway, Firewalls, Proxies)
  - Internal DNS Resolvers
  range: last 90 days
  queries:
  - search_technology: pseudocode
    query: CALCULATE daily_connection_count per host to VPS_ASNs; COMPARE to 30-day
      baseline; ALERT if count > 95th_percentile;
- question: Can we use a machine learning model to predict and assign a risk score
    to outbound connections, identifying those likely associated with C2 activity
    on VPS infrastructure?
  context: This question explores a proactive, predictive approach to threat detection.
    By training a classification model on features like ASN, port, data volume, and
    threat intelligence, the system can learn the characteristics of malicious connections.
    This allows for the real-time scoring of new, unseen network traffic, enabling
    security teams to flag suspicious C2 connections that might not match any known,
    static indicators.
  answer_sources:
  - Zeek conn.log
  - Zeek dns.log
  - Zeek ssl.log
  - Zeek x509.log
  - Threat Intelligence Feed
  - Network Egress Points (e.g., Internet Gateway, Firewalls, Proxies)
  - Internal DNS Resolvers
  range: last 90 days
  queries:
  - search_technology: pseudocode
    query: INPUT connection_features (ASN, port, volume, etc.) into ML_Model; IF risk_score
      > threshold THEN ALERT as high-probability_C2;
- question: Are internal hosts communicating with external services using TLS fingerprints
    (JA3/JA3S) or service banners that match known Command and Control (C2) frameworks?
  context: C2 frameworks often have unique TLS implementation details, resulting
    in a specific JA3/JA3S hash. Similarly, their server-side components may present
    identifiable banners. This question focuses on identifying these specific signatures
    in network traffic. A match provides strong evidence that a specific C2 tool
    is active on the network, even if the destination IP or domain is not yet on a
    threat list.
  answer_sources:
  - Zeek conn.log
  - Zeek ssl.log
  - Network Egress Points (e.g., Internet Gateway, Firewalls, Proxies)
  range: last 90 days
  queries:
  - search_technology: pseudocode
    query: SCAN ssl_logs for JA3/JA3S_hashes AND conn_logs for service_banners; MATCH
      against known_C2_signatures; ALERT on match;
- question: Are any outbound TLS connections using a JA3/JA3S hash that is statistically
    rare within the enterprise?
  context: Legitimate, widely-used applications (like browsers) generate common JA3/JA3S
    hashes that appear frequently across an organization. Custom or niche malware,
    however, will often produce a rare hash. This question helps to surface these
    anomalies. By identifying infrequent TLS fingerprints, especially when the connection
    is to a VPS provider, analysts can uncover potentially malicious C2 channels that
    are trying to blend in.
  answer_sources:
  - Zeek conn.log
  - Zeek ssl.log
  - Network Egress Points (e.g., Internet Gateway, Firewalls, Proxies)
  range: last 90 days
  queries:
  - search_technology: pseudocode
    query: CALCULATE frequency of all JA3/JA3S_hashes over 30 days; ALERT if frequency
      < 0.1% for a new connection;
- question: Can we identify anomalous clusters of TLS handshakes that differ from
    the typical patterns of benign applications?
  context: This question uses unsupervised machine learning to find "the unknown
    unknowns." Instead of looking for specific known-bad signatures, this approach
    groups all TLS sessions by their characteristics (hashes, ciphers, extensions).
    Small, distinct clusters that separate from the large groups of benign traffic
    (browsers, OS updates) represent anomalous behavior. These clusters are prime
    candidates for investigation as they may represent a previously unseen C2 channel.
  answer_sources:
  - Zeek conn.log
  - Zeek ssl.log
  - Network Egress Points (e.g., Internet Gateway, Firewalls, Proxies)
  range: last 90 days
  queries:
  - search_technology: pseudocode
    query: CLUSTER TLS_sessions using features (JA3, ciphers, extensions); INVESTIGATE
      small, outlier clusters;
- question: Are internal hosts connecting to domains hosted by dynamic DNS (DDNS)
    providers?
  context: Adversaries frequently use DDNS services to quickly change the IP address
    associated with their C2 domain, making it harder to block. This question aims
    to detect connections to these high-risk domains. By monitoring DNS queries for
    known DDNS providers and correlating them with actual network connections, security
    teams can identify potential C2 communications that rely on this evasion technique.
  answer_sources:
  - Zeek dns.log
  - Zeek conn.log
  - WHOIS Data
  - Passive DNS Data
  - Internal DNS Resolvers
  - Network Egress Points (e.g., Internet Gateway, Firewalls)
  range: last 90 days
  queries:
  - search_technology: pseudocode
    query: IF DNS_query for domain in DDNS_provider_list AND connection_established
      THEN ALERT;
- question: Are internal hosts connecting to domains that are both newly registered
    and have a high-entropy name?
  context: Domain Generation Algorithms (DGAs) used by malware often create random-looking,
    high-entropy domain names. Adversaries also frequently use newly registered domains
    for their campaigns to evade reputation-based blocking. This question combines
    these two strong indicators. An alert for a connection to a domain that is both
    algorithmically generated (high entropy) and very new is a high-confidence signal
    of malicious activity.
  answer_sources:
  - Zeek dns.log
  - Zeek conn.log
  - WHOIS Data
  - Passive DNS Data
  - Internal DNS Resolvers
  - Network Egress Points (e.g., Internet Gateway, Firewalls)
  range: last 90 days
  queries:
  - search_technology: pseudocode
    query: CALCULATE entropy for domain; GET registration_date from WHOIS; IF entropy
      > 3.5 AND age < 30_days AND connection_made THEN ALERT;
- question: Is there a sudden, unpredicted spike in DNS query volume for a newly
    observed suspicious domain?
  context: When a malware infection spreads across multiple hosts, they may begin
    beaconing to the same C2 domain around the same time, causing a sudden surge
    in DNS queries. This question applies time-series analysis to detect this coordinated
    behavior. By modeling expected query patterns, the system can flag a sudden,
    anomalous spike for a new or suspicious domain, which could indicate the activation
    of a widespread C2 channel.
  answer_sources:
  - Zeek dns.log
  - Zeek conn.log
  - WHOIS Data
  - Passive DNS Data
  - Internal DNS Resolvers
  - Network Egress Points (e.g., Internet Gateway, Firewalls)
  range: last 90 days
  queries:
  - search_technology: pseudocode
    query: MODEL query_volume for new_domains; IF actual_volume > predicted_confidence_interval
      THEN ALERT for coordinated_beaconing;
- question: Are internal hosts connecting to known VPS provider IP addresses on non-standard
    ports or ports commonly used for C2?
  context: Adversaries often host C2 servers on VPS infrastructure and listen on
    either well-known C2 ports (e.g., 50050 for Cobalt Strike) or common ports used
    for non-standard services (e.g., DNS service on a port other than 53) to masquerade
    traffic. This question looks for these mismatches. An alert on such a connection
    is a strong indicator of C2 activity attempting to hide in plain sight.
  answer_sources:
  - Zeek conn.log
  - Windows Event ID 3
  - Network Egress Points (e.g., Internet Gateway, Firewalls)
  - Monitored Endpoint Devices
  range: last 90 days
  queries:
  - search_technology: pseudocode
    query: IF destination_ip in VPS_range AND (destination_port in known_C2_ports
      OR service != standard_for_port) THEN ALERT;
- question: Are any internal hosts exhibiting 'heartbeat' beaconing behavior or transferring
    an anomalous amount of data to an external IP?
  context: C2 implants regularly 'check in' with their server, creating a highly
    periodic connection pattern (a 'heartbeat') with a low standard deviation in
    the time between connections. This question aims to detect this automated behavior.
    By also flagging connections with unusual data volumes (using Z-score), analysts
    can identify both the consistent C2 check-ins and potential data staging or exfiltration
    activities.
  answer_sources:
  - Zeek conn.log
  - Windows Event ID 3
  - Network Egress Points (e.g., Internet Gateway, Firewalls)
  - Monitored Endpoint Devices
  range: last 90 days
  queries:
  - search_technology: pseudocode
    query: CALCULATE stddev of connection_time_deltas; CALCULATE Z-score of data_volume;
      IF stddev < threshold OR Z-score > threshold THEN ALERT;
- question: Can a sequence analysis model (like an LSTM) detect deviations from a
    host's normal network connection patterns that might indicate C2 activity?
  context: Every host has a typical rhythm of network activity. This question proposes
    using a sophisticated machine learning model (LSTM) that learns these temporal
    sequences. The model can then predict the 'next' expected connection. If an actual
    connection significantly deviates from the prediction in terms of timing, duration,
    or data volume, it signals an anomaly that could be a C2 implant breaking the
    host's normal pattern.
  answer_sources:
  - Zeek conn.log
  - Windows Event ID 3
  - Network Egress Points (e.g., Internet Gateway, Firewalls)
  - Monitored Endpoint Devices
  range: last 90 days
  queries:
  - search_technology: pseudocode
    query: TRAIN LSTM_model on host's historical connection_sequences; PREDICT next_connection;
      IF actual_connection deviates from prediction THEN ALERT;
- question: Are any internal hosts establishing TLS connections with servers using
    self-signed certificates?
  context: While some internal services use self-signed certificates, it is highly
    unusual for an external-facing service to do so. Adversaries often use self-signed
    certificates for their C2 servers because they are free and easy to generate.
    This question flags these connections, which are a strong indicator of communication
    with potentially malicious infrastructure, especially when the connection is not
    to a known, approved internal service.
  answer_sources:
  - Zeek x509.log
  - Zeek ssl.log
  - Network Egress Points with TLS Inspection Capabilities
  range: last 90 days
  queries:
  - search_technology: pseudocode
    query: PARSE x509_logs; IF issuer == subject AND source NOT in approved_list THEN
      ALERT;
- question: Are internal hosts connecting to servers using TLS certificates that
    have an unusually short validity period, especially if the domain is also newly
    registered?
  context: Legitimate services typically use certificates with a validity period
    of a year or more. Adversaries, anticipating their infrastructure will be discovered
    and blocked, often use certificates with very short lifespans (e.g., 90 days or
    less). This question focuses on identifying these outlier certificates. When combined
    with other risk factors like a recently registered domain, a short-lived certificate
    becomes a high-fidelity indicator of a malicious C2 server.
  answer_sources:
  - Zeek x509.log
  - Zeek ssl.log
  - Network Egress Points with TLS Inspection Capabilities
  range: last 90 days
  queries:
  - search_technology: pseudocode
    query: CALCULATE certificate validity_period distribution; IF validity_period
      in bottom_5_percentile AND correlated_with_other_risks THEN ALERT;
- question: Can a machine learning model be trained to score and identify malicious
    TLS certificates based on their attributes?
  context: This question proposes a proactive, learning-based approach to certificate
    analysis. Instead of relying on a few static rules (e.g., self-signed, short
    validity), a classifier can learn complex patterns from a wide range of features
    (issuer, key length, algorithm, SAN presence, etc.). This allows the system to
    identify suspicious certificates that may not trigger simpler rules, providing
    a more robust and adaptive detection capability for C2 infrastructure.
  answer_sources:
  - Zeek x509.log
  - Zeek ssl.log
  - Network Egress Points with TLS Inspection Capabilities
  range: last 90 days
  queries:
  - search_technology: pseudocode
    query: INPUT certificate_features into ML_Model; IF risk_score > threshold THEN
      ALERT as malicious_certificate;