name: T1558.003: Kerberoasting
id: b9d5a7e8-1f2a-4c9b-8d6f-3a2b1c0d9e4f
description: This playbook helps investigate whether an adversary is attempting to steal credentials using Kerberoasting. This involves detecting the use of known Kerberoasting tools via process monitoring, identifying anomalous Kerberos TGS service ticket requests (Event ID 4769) that use weak RC4-HMAC encryption, monitoring for high volumes of unique service ticket requests from a single source, and flagging requests for high-value or unusual Service Principal Names (SPNs).
type: technique
related:
  - TA0006: Credential Access
contributors:
  - Zachary Szewczyk
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Are there any process creation events that indicate the use of known Kerberoasting tools like Rubeus or Invoke-Kerberoast?
    context: This question aims to detect the direct execution of common Kerberoasting tools by looking for specific process names or command-line arguments. A match is a strong indicator of an active Kerberoasting attempt, as these tools are purpose-built for this attack.
    answer_sources:
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - Domain-joined endpoints, particularly workstations used by developers, system administrators, and security analysts, and member servers with connectivity to Domain Controllers.
    range: Last 90 days
    queries:
      - technology: Pseudocode
        query: SEARCH process_creation_logs WHERE process_name IN ('rubeus.exe', 'asktgs.exe') OR command_line CONTAINS ('kerberoast', 'asktgs', '-spn', 'invoke-kerberoast')
  - question: Are legitimate processes like PowerShell or CMD being used with unusually complex or high-entropy command lines, potentially to obfuscate Kerberoasting activity?
    context: Attackers often use legitimate system utilities to mask their activities (living off the land). This question focuses on identifying anomalous command-line arguments by measuring their entropy. A sudden spike in entropy for a common process could signal obfuscated scripts or commands, such as those used in fileless Kerberoasting attacks.
    answer_sources:
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - Domain-joined endpoints, particularly workstations used by developers, system administrators, and security analysts, and member servers with connectivity to Domain Controllers.
    range: Last 90 days
    queries:
      - technology: Pseudocode
        query: CALCULATE baseline_entropy(command_line) for process_name IN ('powershell.exe', 'cmd.exe'). ALERT IF current_entropy > 95th_percentile(baseline_entropy) AND has_network_connection_to_DC_port_88
  - question: Can we detect potential Kerberoasting activity by using a machine learning model to classify command-line arguments as malicious?
    context: This question leverages a machine learning approach to move beyond simple string matching or entropy analysis. A classification model trained on features from command-line arguments (n-grams, length, etc.) can identify more nuanced and previously unseen variations of Kerberoasting commands.
    answer_sources:
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - Domain-joined endpoints, particularly workstations used by developers, system administrators, and security analysts, and member servers with connectivity to Domain Controllers.
    range: Last 90 days
    queries:
      - technology: Pseudocode
        query: INPUT process_creation_logs INTO ML_model. ALERT IF classification == 'Kerberoasting' AND confidence_score > 0.9
  - question: Are there any Kerberos ticket requests using the weak RC4-HMAC encryption type from accounts that are not explicitly approved for its use?
    context: Kerberoasting relies on cracking tickets encrypted with weak ciphers like RC4-HMAC (0x17). Modern, secure environments should avoid RC4. This question identifies ticket requests using this weak encryption from non-approved accounts, which is a strong indicator of a Kerberoasting attempt.
    answer_sources:
      - Windows Event ID 4769
      - Zeek kerberos.log
      - All Domain Controllers within the Active Directory forest.
    range: Last 90 days
    queries:
      - technology: Pseudocode
        query: SEARCH kerberos_logs (EventID 4769) WHERE encryption_type == '0x17' AND account_name NOT IN 'Legacy_RC4_Allowed_Group'
  - question: Is any user account requesting an anomalously high proportion of Kerberos tickets with RC4 encryption compared to their normal behavior?
    context: This question uses behavioral analysis to detect deviations from a user's established baseline. A sudden increase in the proportion of RC4 ticket requests for a specific user, even if that user is allowed to use RC4, can indicate that their account is being used for a Kerberoasting attack.
    answer_sources:
      - Windows Event ID 4769
      - Zeek kerberos.log
      - All Domain Controllers within the Active Directory forest.
    range: Last 90 days
    queries:
      - technology: Pseudocode
        query: CALCULATE baseline_RC4_proportion per user. ALERT IF current_RC4_proportion > (baseline_RC4_proportion + 4 * stdev)
  - question: Can we identify outlier accounts or groups of accounts whose Kerberos ticket request patterns are indicative of Kerberoasting?
    context: This question uses unsupervised machine learning (clustering) to find accounts that behave differently from the norm. Accounts that form small, distinct clusters characterized by a high ratio of RC4 requests and requests for many different services are prime candidates for a Kerberoasting investigation.
    answer_sources:
      - Windows Event ID 4769
      - Zeek kerberos.log
      - All Domain Controllers within the Active Directory forest.
    range: Last 90 days
    queries:
      - technology: Pseudocode
        query: CLUSTER accounts ON features (encryption_types, service_name_count, time_patterns). INVESTIGATE outliers with high_RC4_proportion
  - question: Is any single account or IP address requesting an abnormally high number of unique service tickets in a short period?
    context: A key step in Kerberoasting is to request tickets for many different Service Principal Names (SPNs) to find one with a weak password. This question uses a simple threshold to detect this behavior, flagging any source that requests a large volume of unique tickets in a brief timeframe.
    answer_sources:
      - Windows Event ID 4769
      - Zeek kerberos.log
      - Domain Controllers and network monitoring points capturing traffic to and from Domain Controllers, such as network taps or SPAN ports.
    range: Last 90 days
    queries:
      - technology: Pseudocode
        query: SEARCH kerberos_logs (EventID 4769) GROUPBY client_address, 5_minute_window. ALERT IF distinct_count(service_name) > 20
  - question: Is any account requesting significantly more unique service tickets than its own historical baseline?
    context: This question refines the simple threshold detection by personalizing it for each account. By comparing current activity to the account's own 99th percentile baseline, it can more accurately detect anomalous behavior and reduce false positives from service accounts that normally request many tickets.
    answer_sources:
      - Windows Event ID 4769
      - Zeek kerberos.log
      - Domain Controllers and network monitoring points capturing traffic to and from Domain Controllers, such as network taps or SPAN ports.
    range: Last 90 days
    queries:
      - technology: Pseudocode
        query: CALCULATE baseline_99th_percentile(unique_service_names) per account. ALERT IF current_count > baseline_99th_percentile
  - question: Can a time-series forecasting model detect a statistically significant anomaly in the volume of unique TGS requests for any given account?
    context: This question applies advanced time-series analysis to detect anomalies. A forecasting model learns the normal rhythm of TGS requests for an account and can flag a sudden, unexpected spike in request volume that deviates significantly from the predicted pattern, indicating a potential Kerberoasting attack.
    answer_sources:
      - Windows Event ID 4769
      - Zeek kerberos.log
      - Domain Controllers and network monitoring points capturing traffic to and from Domain Controllers, such as network taps or SPAN ports.
    range: Last 90 days
    queries:
      - technology: Pseudocode
        query: FORECAST time_series(unique_TGS_requests) per account. ALERT IF observed_count > forecast_upper_bound
  - question: Has an unauthorized account requested a service ticket for a high-value or sensitive SPN?
    context: Attackers often target SPNs associated with privileged accounts or critical services. This question focuses on detecting requests for these specific, high-value SPNs (e.g., those for domain admin services, SQL servers) from any account not explicitly authorized, which is a critical and high-fidelity alert.
    answer_sources:
      - Windows Event ID 4769
      - Zeek kerberos.log
      - Domain Controllers, and servers hosting high-value services (e.g., SQL Servers, SAP instances, SharePoint farms) which have registered SPNs.
    range: Last 90 days
    queries:
      - technology: Pseudocode
        query: SEARCH kerberos_logs (EventID 4769) WHERE service_name IN 'High_Value_SPN_Watchlist' AND account_name NOT IN 'Approved_Accessor_List'
  - question: Is a user requesting a service ticket for an SPN that is both new to them and rarely accessed by anyone in the organization?
    context: This question identifies unusual access patterns by combining two factors: novelty for the user and rarity across the organization. An account suddenly accessing a very rare service for the first time is suspicious and could indicate an attacker exploring the network or targeting a specific, obscure service.
    answer_sources:
      - Windows Event ID 4769
      - Zeek kerberos.log
      - Domain Controllers, and servers hosting high-value services (e.g., SQL Servers, SAP instances, SharePoint farms) which have registered SPNs.
    range: Last 90 days
    queries:
      - technology: Pseudocode
        query: CALCULATE rarity(SPN) across organization. FOR each user, ALERT IF SPN is new for user AND rarity(SPN) is in top 5%
  - question: Can a graph-based machine learning model identify TGS requests that represent a highly improbable or unusual user-to-service access pattern?
    context: This question uses a sophisticated graph analysis approach to model the relationships between users and the services they access. A link prediction model learns what constitutes "normal" access. When a user requests a ticket for a service that the model predicts they are very unlikely to access, it signals a significant deviation from established patterns and warrants investigation.
    answer_sources:
      - Windows Event ID 4769
      - Zeek kerberos.log
      - Domain Controllers, and servers hosting high-value services (e.g., SQL Servers, SAP instances, SharePoint farms) which have registered SPNs.
    range: Last 90 days
    queries:
      - technology: Pseudocode
        query: MODEL user-SPN access patterns using a graph. SCORE each new user-SPN request. ALERT IF prediction_score is low