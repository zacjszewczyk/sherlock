name: T1091: Replication Through Removable Media
id: 5e63e2c3-a3d1-4b1a-9694-e877f0a9e7d9
description: This playbook addresses the adversary technique of Replication Through Removable Media (T1091). It covers detection strategies for both initial access, where an adversary introduces malware into an environment via a physical device like a USB drive, and lateral movement, where a compromised host spreads malware to other systems using the same method. The playbook focuses on analyzing process creation events, file creation events (especially for autorun.inf and .lnk files), device connection logs, and subsequent malicious activities like network connections or persistence modifications that originate from a process launched from removable media.
type: technique
related:
  - TA0001: Initial Access
  - TA0008: Lateral Movement
contributors: Zachary Szewczyk, Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Have any processes executed from removable media been identified as known malware by threat intelligence feeds?
    context: This question aims to detect the execution of known malware from a removable drive. Adversaries often use removable media to introduce malicious tools. By hashing every executable launched from removable media and comparing it against threat intelligence, security teams can identify high-confidence threats. A match indicates a direct attempt to compromise a system using a recognized malicious file.
    answer_sources:
      - Sysmon Event ID 1
      - Windows Event ID 4688
      - Threat intelligence feeds
      - All endpoint devices (workstations, laptops), Kiosks and shared-use terminals, Physical entry points to sensitive or air-gapped networks, Visitor check-in stations
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each process creation event
          WHERE process image path is on a removable drive
          CALCULATE SHA256 hash of the process image
          QUERY hash against threat intelligence feeds
          IF a match is found
            ALERT (critical) with event details
  - question: Are there any executables launched from removable media that are unusually rare in the enterprise?
    context: This question helps identify potentially unknown or targeted malware by focusing on rarity. Commodity malware might be seen across many hosts, but a targeted tool may only be seen on one or a few. By calculating the prevalence of every executable hash launched from removable media, analysts can flag executables that are statistically rare (e.g., below the 1st percentile) for deeper investigation as they may represent a novel or targeted threat.
    answer_sources:
      - Sysmon Event ID 1
      - Windows Event ID 4688
      - All endpoint devices (workstations, laptops), Kiosks and shared-use terminals, Physical entry points to sensitive or air-gapped networks, Visitor check-in stations
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          CALCULATE prevalence (unique host count) for each file hash executed from removable media over 90 days
          IDENTIFY the 1st percentile prevalence threshold
          FOR each file hash
          IF its prevalence is below the threshold
            FLAG for investigation
  - question: Has a machine learning model identified any process executions from removable media as malicious?
    context: This question leverages machine learning to detect suspicious process executions that may not be caught by signature-based methods. By training a classifier on features like file entropy, PE header details, command-line arguments, and parent process, the model can learn the characteristics of malicious executions. Flagging executions with a high malicious probability score provides a sophisticated, behavior-based detection method for novel threats.
    answer_sources:
      - Sysmon Event ID 1
      - Windows Event ID 4688
      - All endpoint devices (workstations, laptops), Kiosks and shared-use terminals, Physical entry points to sensitive or air-gapped networks, Visitor check-in stations
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each process execution from removable media
          EXTRACT feature vector (file entropy, PE details, cmdline args, parent process, etc.)
          APPLY pre-trained classification model to the feature vector
          IF malicious probability > 0.9
            FLAG for analyst review
  - question: Has an 'autorun.inf' or a suspicious LNK file been created on a removable drive?
    context: This question targets a classic mechanism for automatic execution. Adversaries create 'autorun.inf' files to automatically launch malware when a drive is connected. They also use malicious LNK files, often disguised as legitimate documents, to trick users into running code. Alerting on the creation of 'autorun.inf' or parsing LNK files to find suspicious targets is a direct way to detect this staging behavior.
    answer_sources:
      - Sysmon Event ID 11
      - Sysmon Event ID 1
      - Windows Event ID 4688
      - All endpoint devices with enabled USB ports, Systems used for imaging or deploying software, Vendor maintenance laptops
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          MONITOR file creation events on removable drives
          IF filename is 'autorun.inf'
            ALERT
          IF file is a .lnk file
            PARSE file to extract target path and arguments
            IF target is executable on the same removable media
              ALERT
  - question: Are there files being created on removable media with unusually random or obfuscated filenames?
    context: This question aims to detect malware that uses randomized filenames to evade simple signature-based detection. Malicious tools often generate random-looking filenames to avoid being blacklisted. By establishing a baseline of normal filename character entropy for each user and alerting on significant deviations, analysts can spot files whose names are algorithmically generated, a common indicator of malware.
    answer_sources:
      - Sysmon Event ID 11
      - All endpoint devices with enabled USB ports, Systems used for imaging or deploying software, Vendor maintenance laptops
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each user, create a baseline of filename entropy for files created on removable media
          FOR each new file creation on removable media
          CALCULATE character-level entropy of the filename
          IF entropy > 99th percentile of the user's baseline
            ALERT on anomalous filename
  - question: Has an anomaly detection model flagged any file creation events on removable media as suspicious?
    context: This question uses unsupervised machine learning to find anomalous file creation activities that may indicate malware staging. An Isolation Forest model can identify outliers based on a combination of features like filename length, entropy, file extension, and the parent process. Investigating these strong anomalies can uncover suspicious file staging activities that do not match any known patterns.
    answer_sources:
      - Sysmon Event ID 11
      - All endpoint devices with enabled USB ports, Systems used for imaging or deploying software, Vendor maintenance laptops
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          APPLY Isolation Forest model to file creation events on removable media
          USE features (filename length, entropy, extension, parent process, time of day)
          INVESTIGATE file creations identified as strong anomalies
  - question: Has a process executed from a removable drive automatically and immediately after the device was connected?
    context: This question seeks to identify automated execution (Autorun) behavior. A user manually launching a program will have a natural delay. Automated malware, however, will often execute almost instantly after the device is recognized by the system. By correlating device connection events with subsequent process creations and filtering out legitimate parent processes like 'explorer.exe', analysts can generate high-confidence alerts for malicious Autorun activity.
    answer_sources:
      - Sysmon Event ID 1
      - Microsoft-Windows-Kernel-PnP/Configuration Event ID 400
      - Microsoft-Windows-Kernel-PnP/Configuration Event ID 410
      - Windows Event ID 4688
      - All endpoint devices, High-security area workstations, Server room physical access points, Industrial Control System (ICS) Human-Machine Interfaces (HMIs)
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          CORRELATE device connection events with process creation events from the new drive
          IF time delta < 60 seconds AND parent process is not 'explorer.exe' or other whitelisted shell
            GENERATE alert for potential Autorun
  - question: Is a user executing a file from a removable drive faster than their typical interaction time?
    context: This question provides a user-centric, behavioral approach to detecting automated execution. By baselining the normal time it takes for each user to execute a file after inserting a USB device, the system can flag executions that happen anomalously fast. An execution time falling in the lowest percentile of the user's history suggests the action was automated rather than manual, pointing to a potential Autorun-like mechanism.
    answer_sources:
      - Sysmon Event ID 1
      - Microsoft-Windows-Kernel-PnP/Configuration Event ID 400
      - Microsoft-Windows-Kernel-PnP/Configuration Event ID 410
      - All endpoint devices, High-security area workstations, Server room physical access points, Industrial Control System (ICS) Human-Machine Interfaces (HMIs)
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each user, baseline the time delta between USB insertion and first process execution
          FLAG any execution where the time delta is < 5th percentile of the user's baseline
  - question: Is there an anomalous spike in process executions from removable media on any host?
    context: This question uses time-series analysis to detect a sudden burst of activity indicative of malware. A spike in the rate of process executions from removable media, especially immediately following a device connection, is highly abnormal. This pattern can suggest an Autorun event that triggers multiple malicious processes or a worm attempting to propagate.
    answer_sources:
      - Sysmon Event ID 1
      - Microsoft-Windows-Kernel-PnP/Configuration Event ID 400
      - Microsoft-Windows-Kernel-PnP/Configuration Event ID 410
      - All endpoint devices, High-security area workstations, Server room physical access points, Industrial Control System (ICS) Human-Machine Interfaces (HMIs)
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          APPLY time-series anomaly detection to the rate of process executions from removable media per host
          CORRELATE detected spikes with recent device connection events
          INVESTIGATE correlated spikes as likely Autorun events
  - question: Has a process launched from removable media performed suspicious follow-on actions like C2 communication or persistence?
    context: This question looks for post-exploitation activity originating from a removable media process. The initial execution is only the first step. By tracking the process and its children, analysts can detect if it attempts to establish a network connection to a malicious server, modify a registry autorun key for persistence, or drop files in sensitive system directories. This provides strong evidence that the initial execution was malicious.
    answer_sources:
      - Sysmon Event ID 1
      - Sysmon Event ID 3
      - Sysmon Event ID 11
      - Sysmon Event ID 13
      - Zeek conn.log
      - Zeek dns.log
      - Domain Controllers (for authentication logs), Network egress points (for C2 traffic), All endpoint devices, DNS Resolvers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR a process launched from removable media, track its ProcessGUID
          IF that ProcessGUID is associated with (network connection to bad IP/domain) OR (registry autorun key modification) OR (executable file creation in SystemRoot)
            ALERT
  - question: Does a process from removable media exhibit a high-risk score based on its child activities?
    context: This question uses a risk-scoring model to quantify the maliciousness of a process's behavior. Instead of a single high-fidelity indicator, this approach aggregates several moderately suspicious actions (e.g., connecting to a new country, using a high-entropy domain, spawning PowerShell). If the cumulative score for a process tree exceeds a threshold, it gets flagged, allowing for the detection of adversaries who chain together less-suspicious actions.
    answer_sources:
      - Sysmon Event ID 1
      - Zeek conn.log
      - Zeek dns.log
      - Domain Controllers (for authentication logs), Network egress points (for C2 traffic), All endpoint devices, DNS Resolvers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each process from removable media, initialize risk score = 0
          ADD points for suspicious child activities (e.g., new destination country, high-entropy DNS query, spawning script interpreters)
          IF total score > 99th percentile of benign process scores
            ALERT
  - question: Has a machine learning model classified the entire activity tree of a process from removable media as malicious?
    context: This question applies machine learning to an entire chain of events, not just a single process creation. By modeling the full activity tree (including child processes, network connections, file writes, etc.) as a single data structure, a tree-based classifier can learn complex, multi-step attack patterns. This holistic approach can detect sophisticated threats that might evade event-by-event analysis.
    answer_sources:
      - Sysmon Event ID 1
      - Sysmon Event ID 3
      - Sysmon Event ID 11
      - Sysmon Event ID 13
      - Domain Controllers (for authentication logs), Network egress points (for C2 traffic), All endpoint devices, DNS Resolvers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each process from removable media, construct its process activity tree
          EXTRACT features from the tree (depth, breadth, node types)
          APPLY pre-trained tree-based classification model
          IF tree is classified as malicious with high confidence
            FLAG for review
  - question: Is known malware being written to a removable drive on a corporate endpoint?
    context: This question aims to detect a compromised host attempting to create an infected removable drive for lateral movement. When a file is written to a removable drive, hashing it and checking against threat intelligence can reveal if a known malicious payload is being staged. This is a high-confidence indicator that an infected machine is trying to propagate the infection.
    answer_sources:
      - Sysmon Event ID 11
      - Threat intelligence feeds
      - All internal workstations, File servers, Jump boxes, Systems in secure network enclaves
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          ON file creation event to a removable drive
          HASH the created file
          QUERY hash against threat intelligence database
          IF match is found
            ALERT (high severity) for staging malware for lateral movement
  - question: Is any host writing an unusually high number of executable files to removable media?
    context: This question detects automated replication behavior. A user might copy one or two executables, but a worm or malware script will often write files programmatically and rapidly. By baselining the normal rate at which hosts write executables to removable drives, a significant spike above this baseline (e.g., 3 standard deviations above the mean) can indicate that the host is compromised and actively trying to spread malware.
    answer_sources:
      - Sysmon Event ID 11
      - All internal workstations, File servers, Jump boxes, Systems in secure network enclaves
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          BASELINE the rate of executable file writes to removable media per host/user
          ALERT when a host's rate exceeds a statistical threshold (e.g., >95th percentile or 3 std dev above mean)
  - question: Has a machine learning model identified any files written to removable media as malicious?
    context: This question uses a file classifier to detect novel or unknown malware being staged for lateral movement. Even if a file's hash is not in a threat intelligence feed, a machine learning model can analyze its features (entropy, PE import hash, etc.) to determine if it is malicious. Alerting on files with a high malicious probability score helps catch new malware variants before they spread.
    answer_sources:
      - Sysmon Event ID 11
      - All internal workstations, File servers, Jump boxes, Systems in secure network enclaves
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR every executable file written to removable media
          APPLY a pre-trained file classifier (using features like entropy, import hash, file size)
          IF file is classified as malicious with probability > 0.9
            ALERT
  - question: Has a file been written to a removable drive using a filename designed to deceive users, such as a double extension or RTLO character?
    context: This question targets social engineering techniques used in lateral movement. Adversaries create executables with deceptive filenames (e.g., 'report.pdf.exe') or use the Right-to-Left-Override (RTLO) Unicode character to reverse the name (e.g., 'report_cod.exe' appears as 'report_exe.doc'). Detecting the creation of files with these characteristics on removable media can proactively identify attempts to trick users on other machines.
    answer_sources:
      - Sysmon Event ID 11
      - Sysmon Event ID 1
      - All internal workstations and servers with USB access, Shared departmental file shares (as a source for files being copied)
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          MONITOR file creation events on removable drives
          ALERT on filename 'autorun.inf'
          ALERT on filenames containing RTLO character (U+202E)
          ALERT on filenames with common double extensions (e.g., .pdf.exe, .doc.scr)
  - question: Are executables with deceptive, document-like filenames being written to removable media?
    context: This question identifies executables masquerading as harmless documents. An adversary might name a malicious file 'Annual Report.exe' to trick a user. This analytic calculates the similarity (e.g., Levenshtein distance) between a filename and common document-related words. A file with an executable extension but a name that is very similar to 'report' or 'invoice' is highly suspicious and warrants investigation.
    answer_sources:
      - Sysmon Event ID 11
      - All internal workstations and servers with USB access, Shared departmental file shares (as a source for files being copied)
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each executable written to removable media
          CALCULATE Levenshtein distance between filename and a list of document-related terms ('report', 'invoice', etc.)
          IF distance is low
            FLAG as suspicious
  - question: Are clusters of anomalous files, possibly representing a replicating malware family, being written to removable drives?
    context: This question uses unsupervised learning to find groups of related malicious files. A malware family might replicate itself with slight variations in filenames or packing. By clustering files based on their feature vectors (file entropy, import hashes, etc.), analysts can identify these groups of anomalous files that stand out from normal activity, even if individual files don't trigger other alerts.
    answer_sources:
      - Sysmon Event ID 11
      - All internal workstations and servers with USB access, Shared departmental file shares (as a source for files being copied)
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          CLUSTER files written to removable drives using features like filename/file entropy and PE import hashes
          IDENTIFY and investigate clusters of anomalous files
  - question: Has a file, first written to a removable drive on one host, been executed from a removable drive on another host?
    context: This question provides high-confidence evidence of successful lateral movement via removable media. It directly links a staging event on one machine to an execution event on another. By maintaining a state table of file hashes written to removable drives, analysts can correlate them with execution events across the enterprise. A match where the source host is different from the executing host is a clear indicator of compromise and spread.
    answer_sources:
      - Sysmon Event ID 11
      - Sysmon Event ID 1
      - Windows Event ID 4688
      - All internal network segments containing multiple workstations or servers, Systems with high user mobility (e.g., shared operations centers), Air-gapped network transfer stations
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          MAINTAIN a state table of (Hash, SourceHost, Timestamp) for files written to removable media
          FOR each process execution from removable media on Host B
          QUERY state table for the process's hash
          IF match found where SourceHost is not Host B
            ALERT for confirmed lateral movement
  - question: Can we identify key 'spreader' machines responsible for propagating malware via removable media?
    context: This question uses graph analysis to understand the scope and dynamics of an outbreak. By modeling hosts as nodes and file transfers via removable media as edges, analysts can visualize the spread of malware. Network analysis metrics like out-degree or PageRank can then be used to identify the most influential 'spreader' machines, which should be prioritized for containment and remediation.
    answer_sources:
      - Sysmon Event ID 11
      - Sysmon Event ID 1
      - All internal network segments containing multiple workstations or servers, Systems with high user mobility (e.g., shared operations centers), Air-gapped network transfer stations
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          CONSTRUCT a directed graph where nodes are hosts and an edge (A, B) exists if a file from Host A executes on Host B via removable media
          ANALYZE graph to find nodes with high out-degree or high PageRank centrality
          PRIORITIZE these 'spreader' nodes for investigation
  - question: Can we detect anomalous user or host behavior related to file transfers via removable media?
    context: This question uses a sequence model to learn normal patterns of file sharing and flag deviations. For example, a file from a finance user's machine executing on an engineering host might be anomalous. By training a model on sequences of (file write, file execute) events, it can learn typical source/destination patterns and flag sequences that are statistically unlikely, indicating a potential policy violation or malicious lateral movement.
    answer_sources:
      - Sysmon Event ID 11
      - Sysmon Event ID 1
      - All internal network segments containing multiple workstations or servers, Systems with high user mobility (e.g., shared operations centers), Air-gapped network transfer stations
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          TRAIN a sequence model (e.g., LSTM) on event pairs: (file write to USB, process execute from USB)
          USE features like user, source host, destination host, and time delta
          FLAG sequences identified by the model as anomalous
  - question: Has a process from a removable drive attempted to scan the network or spread via SMB?
    context: This question seeks to identify worm-like behavior originating from a removable media infection. After compromising a host, the malware may attempt to find other vulnerable machines on the network. By tracking the child processes of a removable media execution and looking for widespread connection attempts to internal hosts on common lateral movement ports (like SMB port 445), analysts can detect this propagation attempt.
    answer_sources:
      - Sysmon Event ID 1
      - Sysmon Event ID 3
      - Zeek conn.log
      - Windows Event ID 4624
      - Internal network segments, Authentication servers (Domain Controllers), Network sensor tap points
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR a process from a removable drive, track its ProcessGUID
          IF this process or its children connect to > 10 unique internal hosts on port 445 within 5 minutes
            ALERT
  - question: Is a process from removable media exhibiting network scanning behavior?
    context: This question provides a behavioral analytic to detect scanning activity that may precede lateral movement. A benign process usually connects to a few specific hosts and ports. Malware, on the other hand, may connect to many different internal IPs or ports as it searches for targets. By baselining normal network behavior and alerting when a process from removable media exceeds the 98th percentile for distinct IPs or ports contacted, analysts can catch this scanning phase.
    answer_sources:
      - Sysmon Event ID 1
      - Sysmon Event ID 3
      - Zeek conn.log
      - Internal network segments, Authentication servers (Domain Controllers), Network sensor tap points
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          BASELINE the number of distinct internal IPs and destination ports contacted by processes from removable media
          ALERT if a process exceeds the 98th percentile for either metric
  - question: Is a removable media process correlated with a spike in failed network logons?
    context: This question aims to detect credential-based lateral movement attempts, like brute-force or password spraying, initiated by malware from a removable drive. Such an attack would generate a large volume of failed logon events (Event ID 4624, Logon Type 3). By using time-series analysis to find anomalous spikes in these events and correlating them with a recent process execution from removable media on the source host, analysts can connect the two activities and identify the attack.
    answer_sources:
      - Sysmon Event ID 1
      - Windows Event ID 4624
      - Internal network segments, Authentication servers (Domain Controllers), Network sensor tap points
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          ANALYZE the rate of failed network logon events (Type 3) per source host
          IF an anomalous spike is temporally correlated with a recent process execution from removable media on that host
            FLAG as a likely credential-based lateral movement attempt