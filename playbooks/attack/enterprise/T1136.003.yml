name: T1136.003: Cloud Account
id: f9e1d8a0-6c3b-4f8a-b9e7-5d4c3b2a1f0e
description: >
  This playbook investigates whether an adversary is using newly created or unauthorized cloud accounts to establish persistence. It focuses on detecting suspicious inbound network connections from cloud provider IPs, anomalous logons by cloud-synchronized accounts to critical assets, first-time logons from accounts not provisioned through standard IT/HR processes, unusual privileged actions performed by cloud-native accounts, and network traffic exhibiting command-and-control (C2) characteristics following a cloud account logon.
type: technique
related:
  - TA0003: Persistence
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
investigative_questions:
  - question: Are there established inbound connections from known cloud provider IP ranges, which are also on a threat intelligence feed, to non-public internal assets?
    context: This question aims to identify direct, potentially malicious connections from cloud infrastructure to sensitive internal systems. An adversary might use a compromised cloud server to bypass perimeter defenses. Correlating cloud source IPs with threat intelligence and checking against a list of approved public-facing destinations helps to pinpoint unauthorized access attempts that could signify a foothold for persistence.
    answer_sources:
      - Zeek conn.log
      - Threat Intelligence Feed
      - Internet Gateway
      - Perimeter Firewalls
      - Internal Network Segments
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          SEARCH Zeek conn.log WHERE conn_state = 'SF'
          AND source_ip IN [cloud_provider_ips]
          AND source_ip IN [threat_intelligence_feed]
          AND destination_ip NOT IN [public_servers_list]
          ALERT on results
  - question: Has a new source IP from a cloud provider, not seen in the last 30 days, connected to a high-value internal asset or a commonly exploited port with a frequency that is statistically rare?
    context: This question uses statistical analysis to detect novel and potentially malicious connections that a simple rule might miss. By baselining normal connection patterns from cloud providers, it can flag when a new or infrequent source IP connects to a critical system or a high-risk port (like RDP or SSH). An alert triggered by exceeding the 99th percentile of new connection frequencies indicates a highly unusual event warranting investigation for a potential breach.
    answer_sources:
      - Zeek conn.log
      - Threat Intelligence Feed
      - Internet Gateway
      - Perimeter Firewalls
      - Internal Network Segments
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each inbound connection from [cloud_provider_ips]:
            CALCULATE historical baseline of source_ip to destination_port connections over 90 days.
            IF source_ip not seen in last 30 days
            AND (destination_port IN [high_risk_ports] OR destination_ip IN [high_value_assets])
            AND connection_frequency > 99th_percentile_of_new_connections:
              ALERT on event
  - question: Does a machine learning model classify a new inbound connection from a cloud provider as malicious based on its network characteristics?
    context: This question leverages a machine learning model to score the risk of inbound connections from cloud IPs. The model is trained to recognize patterns of malicious activity by analyzing features like connection duration, data volume, and protocol. A high probability score from the model suggests the connection strongly resembles past malicious traffic, providing a more nuanced detection method than static rules and helping to identify sophisticated or evasive threats.
    answer_sources:
      - Zeek conn.log
      - Threat Intelligence Feed
      - Internet Gateway
      - Perimeter Firewalls
      - Internal Network Segments
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each new inbound connection from [cloud_provider_ips]:
            EXTRACT features (duration, bytes, service, etc.)
            INPUT features into trained classification model.
            IF model_score > high_confidence_threshold_for_malicious:
              ALERT for investigation
  - question: Has a cloud-synchronized or temporary service account performed an interactive or network logon to a critical Tier 0 or Tier 1 asset?
    context: This question seeks to detect unauthorized access to the most sensitive assets (like Domain Controllers or Privileged Access Workstations) by accounts synchronized from a cloud environment. Such accounts, identified by a specific SID format or naming convention, should generally not be used for interactive logons to on-premises critical infrastructure. A successful logon could indicate compromised cloud credentials being used to pivot to the on-premises environment for persistence.
    answer_sources:
      - Windows Event ID 4624
      - Domain Controllers
      - Member Servers hosting sensitive applications
      - Privileged Access Workstations (PAWs)
      - Certificate Authority Servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          SEARCH Windows Event Logs WHERE EventID = 4624 AND LogonType IN (2, 3, 10)
          AND TargetServer IN [Tier_0_or_1_Assets]
          AND (User_SID MATCHES 'S-1-12-1-*' OR UserName MATCHES ['AAD_*', 'svc-*', 'tmp_*', 'gcp-sa-*'])
          ALERT on results
  - question: Is a logon by a cloud-synchronized account to an on-premises server statistically rare compared to its baseline activity?
    context: This question uses statistical rarity to identify anomalous logon behavior that deviates from a user's established patterns. For example, a cloud-only user who suddenly performs their first-ever interactive logon to an on-premises domain controller is a highly unusual event. Calculating the rarity of such an event helps to surface potential credential misuse or account takeover that might be missed by rule-based detections.
    answer_sources:
      - Windows Event ID 4624
      - Domain Controllers
      - Member Servers hosting sensitive applications
      - Privileged Access Workstations (PAWs)
      - Certificate Authority Servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each logon event by a cloud-account (by SID/name):
            CALCULATE historical baseline of logon_type and target_server for that user.
            CALCULATE rarity_score of the current event against the baseline.
            IF rarity_score > 99th_percentile:
              ALERT on event
  - question: Has an unsupervised machine learning model identified a logon by a cloud-characteristic account as a significant anomaly?
    context: This question uses an anomaly detection model (like Isolation Forest) to find unusual logons without pre-existing labels of good or bad. The model learns what 'normal' activity looks like by clustering events based on features like logon type, target server, and time of day. A logon by a cloud account that falls far outside these normal clusters is flagged as an anomaly, potentially indicating a compromised account being used in an uncharacteristic way.
    answer_sources:
      - Windows Event ID 4624
      - Domain Controllers
      - Member Servers hosting sensitive applications
      - Privileged Access Workstations (PAWs)
      - Certificate Authority Servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          INPUT logon event features (LogonType, UserName structure, TargetServer, time, etc.) into Isolation Forest model.
          IF model flags event as an anomaly:
            ALERT for investigation
  - question: Has there been a successful first-time logon from a user account that was not officially provisioned through HR or ITSM systems in the last 72 hours?
    context: This question helps to identify potentially unauthorized or 'shadow' accounts. Every legitimate new user should have a corresponding record in an IT Service Management (ITSM) or HR system. By cross-referencing logon events with a watchlist of newly provisioned users, any logon from an account without a recent, official provisioning record can be flagged. This could indicate an adversary has created an account to establish persistence.
    answer_sources:
      - Windows Event ID 4624
      - Zeek conn.log
      - ITSM/HR provisioning logs
      - Domain Controllers
      - VPN Concentrators
      - Identity and Access Management (IAM) systems
      - HR Information Systems (HRIS)
      - IT Service Management (ITSM) platforms
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          GET list of newly_provisioned_users from HR/ITSM logs for last 72 hours.
          SEARCH Windows Event Logs WHERE EventID = 4624
          AND UserName NOT IN [newly_provisioned_users]
          AND is_first_logon_for(UserName)
          ALERT on results
  - question: Has there been a statistically significant spike in the number of first-time account logons per hour?
    context: This question looks for a sudden, anomalous increase in the volume of new accounts logging in for the first time. While individual unauthorized accounts might be missed, a large-scale account creation event by an adversary would likely cause a spike that exceeds the normal statistical variation (e.g., three standard deviations above the moving average). This provides a macro-level view to detect bulk persistence activity.
    answer_sources:
      - Windows Event ID 4624
      - Zeek conn.log
      - ITSM/HR provisioning logs
      - Domain Controllers
      - VPN Concentrators
      - Identity and Access Management (IAM) systems
      - HR Information Systems (HRIS)
      - IT Service Management (ITSM) platforms
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          CALCULATE 30-day moving average and standard deviation of first-time logons per hour.
          COUNT first-time logons in the current hour.
          IF count > (moving_average + 3 * standard_deviation):
            ALERT on spike
  - question: Does a machine learning model assign a high risk score to a first-time logon event based on its context?
    context: This question uses a predictive model to assess the risk of every first-time logon. By incorporating diverse features—such as the source IP's location, the time of day, the role of the target system, and whether the account was officially provisioned—the model can learn to distinguish between legitimate and high-risk first-time access. A high-risk score triggers an immediate investigation, allowing analysts to focus on the most suspicious new account activity.
    answer_sources:
      - Windows Event ID 4624
      - Zeek conn.log
      - ITSM/HR provisioning logs
      - Domain Controllers
      - VPN Concentrators
      - Identity and Access Management (IAM) systems
      - HR Information Systems (HRIS)
      - IT Service Management (ITSM) platforms
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each first-time logon event:
            EXTRACT features (source_ip_geo, time, target_system_role, provisioned_status)
            INPUT features into trained logistic regression model.
            IF risk_score > high_confidence_threshold:
              ALERT for investigation
  - question: Has a cloud-native or service account, not on an approved list, added a member to a privileged group or cleared a security event log?
    context: This question targets specific, high-impact privileged actions that are strong indicators of privilege escalation and persistence. Adversaries often use compromised cloud or service accounts to add their own accounts to groups like 'Domain Admins' or to clear security logs to hide their tracks. Alerting when a non-approved cloud account performs these actions provides a high-fidelity signal of malicious activity.
    answer_sources:
      - Windows Event ID 4624
      - Windows Event ID 4728
      - Windows Event ID 4732
      - Windows Event ID 4738
      - Windows Event ID 4756
      - Windows Event ID 1102
      - Domain Controllers
      - Active Directory Federation Services (ADFS) servers
      - Group Policy Management Servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          SEARCH Windows Event Logs WHERE (EventID IN [4728, 4732, 4756] AND SubjectUserName MATCHES [cloud/service_pattern] AND SubjectUserName NOT IN [approved_admins])
          OR (EventID = 1102 AND SubjectUserName MATCHES [cloud/service_pattern])
          ALERT on results
  - question: Has a cloud-synced or dormant account performed a privileged action it has never performed before, or has its overall activity pattern changed significantly?
    context: This question uses behavioral baselining to detect when a cloud or dormant account is used in an uncharacteristic way. An adversary taking over an account will likely perform actions the legitimate owner never has. By tracking the frequency of privileged actions for each user and calculating an entropy score, the system can detect a sudden shift in behavior (e.g., a spike in entropy) or a single, rare action, indicating a potential account compromise.
    answer_sources:
      - Windows Event ID 4624
      - Windows Event ID 4728
      - Windows Event ID 4732
      - Windows Event ID 4738
      - Windows Event ID 4756
      - Windows Event ID 1102
      - Domain Controllers
      - Active Directory Federation Services (ADFS) servers
      - Group Policy Management Servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each privileged action by a cloud/dormant account:
            CHECK if action is new for that user in last 90 days.
            CALCULATE Shannon entropy of user's actions.
            IF action is new OR entropy score spikes significantly:
              ALERT on event
  - question: Has a machine learning model detected that a cloud-native account is performing privileged actions characteristic of a different, more privileged peer group?
    context: This question uses peer group analysis to identify when an account's behavior deviates from its peers and begins to mimic a more privileged group. For example, a cloud service account that normally performs only automated tasks suddenly starts executing commands typical of a Domain Administrator. The model flags this shift in behavior as a high-risk anomaly, suggesting the account may be compromised and used for privilege escalation.
    answer_sources:
      - Windows Event ID 4624
      - Windows Event ID 4728
      - Windows Event ID 4732
      - Windows Event ID 4738
      - Windows Event ID 4756
      - Windows Event ID 1102
      - Domain Controllers
      - Active Directory Federation Services (ADFS) servers
      - Group Policy Management Servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          CLUSTER users into peer groups based on privileged action vectors.
          FOR each action by a cloud-native account:
            CHECK if the action causes the account to shift closer to a more privileged peer group (e.g., 'Domain Admins').
            IF significant shift is detected:
              ALERT as anomaly
  - question: Following a successful logon by a cloud account, was a connection made from the same source IP to an internal host over a non-approved port within 10 minutes?
    context: This question directly links a cloud account logon to subsequent suspicious network activity. An adversary might log in and immediately establish a command-and-control (C2) channel or connect to an internal service for lateral movement. By correlating logon events with network connections in a tight time window and checking against a list of allowed ports, this rule can provide strong evidence of post-compromise activity.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Windows Event ID 4624
      - Network Egress/Ingress Points
      - DNS Servers
      - Internal Server Segments
      - Domain Controllers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          JOIN Windows EventID 4624 (where user is cloud_account) with Zeek conn.log on source_ip.
          IF conn.log timestamp is within 10 minutes after logon_timestamp
          AND conn.log destination_port NOT IN [approved_ingress_ports]:
            ALERT on correlation
  - question: Following a cloud account logon, did a connection from the cloud IP exhibit a statistically rare destination port or an unusually high data transfer ratio?
    context: This question uses statistical baselines to identify C2-like network behavior. Adversaries may use non-standard ports to evade simple firewall rules or exfiltrate large amounts of data. By comparing a new connection's port and data transfer ratio to the historical baseline for that specific host, the system can flag statistically significant deviations. A very rare port or an abnormally high outbound-to-inbound data ratio are strong indicators of C2 or data theft.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Windows Event ID 4624
      - Network Egress/Ingress Points
      - DNS Servers
      - Internal Server Segments
      - Domain Controllers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each connection from a cloud_ip:
            COMPARE destination_port and (resp_bytes / orig_bytes) ratio to historical baseline for the destination_host.
            IF port_frequency < 1st_percentile OR data_ratio > 99th_percentile:
              ALERT on statistical anomaly
  - question: Does time-series analysis of network connections from a cloud IP to an internal host reveal a periodic, repeating pattern indicative of C2 beaconing?
    context: This question applies signal processing techniques to network traffic data to find the 'heartbeat' of command-and-control (C2) channels. Malicious implants often communicate with their C2 server at regular intervals (beaconing). By analyzing the timestamps of connections from a single source to a single destination, algorithms like FFT can detect these repeating patterns, which are highly unlikely to occur in normal user or system traffic. This provides a powerful method for uncovering hidden C2 channels.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Windows Event ID 4624
      - Network Egress/Ingress Points
      - DNS Servers
      - Internal Server Segments
      - Domain Controllers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR a stream of connections from a single source_ip to a single destination_ip:
            EXTRACT timestamps into a time-series.
            APPLY FFT or Autocorrelation to the time-series.
            IF a strong periodic signal is detected:
              ALERT as potential C2 beaconing