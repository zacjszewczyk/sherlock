name: T1596.005: Scan Databases
id: a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d
description: This playbook helps investigate whether an adversary is conducting reconnaissance by leveraging information from public scan databases. It focuses on identifying multiple inbound connection attempts from known internet-wide scanners, detecting requests with signatures of automated tools, correlating connection patterns with publicly listed open ports, monitoring for traffic spikes to newly exposed services, and identifying subsequent high-volume failed authentication attempts like password spraying against those services.
type: technique
related:
- TA0043: Reconnaissance
contributors:
- Zachary Szewczyk
- Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
- question: Are we observing inbound connection attempts from IP addresses known to be internet scanners?
  context: This question aims to identify reconnaissance activity by cross-referencing inbound connection source IPs from Zeek conn.log with a threat intelligence list of known internet scanners. A match indicates that a known scanning service is probing our network, regardless of whether the connection was successful. This provides an early warning of potential targeting.
  answer_sources:
  - Zeek conn.log
  - Threat Intelligence Feed
  - Perimeter network devices, including internet-facing firewalls, web servers, and VPN concentrators.
  range: last 90 days
  queries:
  - search_technology: pseudocode
    query: JOIN Zeek conn.log source IPs WITH threat_intel_scanner_IPs. ALERT on match.
- question: Has there been a statistically unusual increase in connection attempts from known scanning infrastructure?
  context: This question looks for anomalies in scanning activity. By establishing a 30-day baseline of daily unique scanner IPs connecting to external services, we can detect significant deviations. An alert triggered by the daily count exceeding the 95th percentile of this baseline suggests a potential targeted campaign or a broader scan wave, moving beyond simple one-off probes.
  answer_sources:
  - Zeek conn.log
  - Threat Intelligence Feed
  - Perimeter network devices, including internet-facing firewalls, web servers, and VPN concentrators.
  range: last 90 days
  queries:
  - search_technology: pseudocode
    query: CALCULATE daily_count of unique scanner_IPs from conn.log. IF daily_count > 95th_percentile of 30-day_baseline, ALERT.
- question: Can we predict if an inbound connection originates from a previously unknown scanner using machine learning?
  context: This question uses a logistic regression model to proactively identify scanning behavior from new or uncatalogued IP addresses. By training on historical connection data and features like protocol, port, duration, and connection state, along with whether the source was a known scanner, the model learns the characteristics of scanning traffic. This allows for the detection of emerging scanning infrastructure that isn't yet on threat intelligence feeds.
  answer_sources:
  - Zeek conn.log
  - Threat Intelligence Feed
  - Perimeter network devices, including internet-facing firewalls, web servers, and VPN concentrators.
  range: last 90 days
  queries:
  - search_technology: pseudocode
    query: PREDICT probability of 'is_scanner' for new conn.log events using trained logistic regression model. ALERT on high probability.
- question: Are we detecting inbound web requests with signatures matching known scanning or exploitation tools?
  context: This question focuses on identifying automated reconnaissance by looking for specific indicators in web traffic. By monitoring for tell-tale User-Agents (e.g., 'Nuclei'), URI patterns (e.g., '/.env'), or payloads using IDS/IPS signatures and correlating them with http.log data, analysts can confirm that automated tools are being used to probe for vulnerabilities in public-facing applications.
  answer_sources:
  - Zeek http.log
  - Zeek conn.log
  - IDS/IPS Alerts
  - Public-facing web applications, API gateways, and load balancers.
  range: last 90 days
  queries:
  - search_technology: pseudocode
    query: MONITOR for IDS/IPS alerts for tool signatures (Nuclei, nmap). CORRELATE alerts with http.log for full request details.
- question: Is any single external IP exhibiting directory fuzzing or parameter guessing behavior against our web applications?
  context: This statistical question aims to detect brute-force enumeration of web application directories or parameters. By calculating the Shannon entropy of URIs requested by a single source IP over a short time window (5 minutes), we can identify highly random, non-human browsing patterns. A high entropy value suggests an automated tool is guessing paths, which is a common reconnaissance technique.
  answer_sources:
  - Zeek http.log
  - Zeek conn.log
  - IDS/IPS Alerts
  - Public-facing web applications, API gateways, and load balancers.
  range: last 90 days
  queries:
  - search_technology: pseudocode
    query: FOR each source_IP, CALCULATE Shannon entropy of URI requests in 5-min window. IF entropy > 3 std deviations above mean, ALERT.
- question: Is there an anomalous spike in web requests containing high-risk keywords, suggesting a potential exploitation wave?
  context: This question uses a time-series forecasting model (like ARIMA) to detect emerging threats. The model learns the normal frequency of requests containing risky keywords (e.g., 'cve-', 'log4j') in URIs and request bodies. A significant deviation from the forecasted trend indicates a surge in interest for a specific vulnerability, possibly driven by its recent discovery or publication, allowing for a rapid response.
  answer_sources:
  - Zeek http.log
  - Zeek conn.log
  - IDS/IPS Alerts
  - Public-facing web applications, API gateways, and load balancers.
  range: last 90 days
  queries:
  - search_technology: pseudocode
    query: FORECAST expected frequency of high-risk keywords in http.log. IF observed_frequency significantly deviates from forecast, ALERT.
- question: Is an external IP connecting to a set of ports on a host that are known to be publicly exposed?
  context: This question seeks to identify targeted scanning based on public information. By proactively querying scan databases (like Shodan) for our public IPs, we create a list of 'known exposed ports'. A rule can then alert when a single external IP connects to a significant number of these specific ports on a host within a short timeframe, indicating the actor is using a pre-compiled list from a scan database.
  answer_sources:
  - Zeek conn.log
  - External Scan Database API
  - Network perimeter and DMZ, specifically monitoring traffic to all registered public IP addresses.
  range: last 90 days
  queries:
  - search_technology: pseudocode
    query: PRE-FETCH known_exposed_ports from scan database API. IF external_IP connects to > 5 known_exposed_ports on one host within 10 mins, ALERT.
- question: Does the set of ports an external IP is connecting to closely match the set of ports listed for that host in a public scan database?
  context: This question provides a more precise, statistical confirmation that an attacker is using data from a public scan database. By calculating the Jaccard similarity between the set of ports an IP connects to and the set of 'known exposed ports' for the target, we can quantify the overlap. A high similarity index (e.g., > 0.8) is strong evidence that the reconnaissance is not random but is specifically targeting known points of exposure.
  answer_sources:
  - Zeek conn.log
  - External Scan Database API
  - Network perimeter and DMZ, specifically monitoring traffic to all registered public IP addresses.
  range: last 90 days
  queries:
  - search_technology: pseudocode
    query: FOR each source_IP, create observed_port_set. CALCULATE Jaccard similarity between observed_port_set and known_exposed_ports. IF similarity > 0.8, ALERT.
- question: Can we identify targeted reconnaissance by clustering connection patterns?
  context: This question uses unsupervised machine learning (DBSCAN) to find anomalous clusters of activity without pre-defined rules. By clustering connection logs based on source IP, destination IP, and destination port, the algorithm can group normal traffic patterns. Small, dense clusters representing a single source IP connecting to many ports on a single host, where that port set is unusual compared to normal traffic, can reveal targeted scanning that mirrors scan database results.
  answer_sources:
  - Zeek conn.log
  - External Scan Database API
  - Network perimeter and DMZ, specifically monitoring traffic to all registered public IP addresses.
  range: last 90 days
  queries:
  - search_technology: pseudocode
    query: RUN DBSCAN clustering on conn.log data. INVESTIGATE small, dense clusters from a single source_IP to many destination_ports on a single host.
- question: Are we seeing connections from known malicious IPs to a newly exposed service shortly after a firewall change?
  context: This question links configuration changes directly to potential threats. By ingesting firewall change logs, the SIEM can identify when a new service is exposed. A rule then creates a heightened monitoring window (e.g., 48 hours) for that specific port. An alert on any connection attempt from a threat-listed IP during this critical window suggests the new service was quickly discovered and is being targeted.
  answer_sources:
  - Zeek conn.log
  - Windows Event ID 4625
  - Firewall/Network Device Change Logs
  - Authentication servers (e.g., Active Directory Domain Controllers), VPN gateways, Remote Desktop gateways, and change management logs for network devices.
  range: last 90 days
  queries:
  - search_technology: pseudocode
    query: ON firewall_change_event, monitor affected_port for 48 hrs. IF connection from threat_intel_IP, ALERT.
- question: Is there a statistical anomaly in connection volume to a service port immediately following its exposure to the internet?
  context: This question uses historical data to detect a rush of scanning activity to a newly available service. By baselining normal hourly connection counts for all ports over 30 days, we can define what 'normal' looks like. After a configuration change exposes a new port, any connection volume that exceeds the 99th percentile of the historical baseline for that port is a strong indicator of automated, widespread scanning.
  answer_sources:
  - Zeek conn.log
  - Windows Event ID 4625
  - Firewall/Network Device Change Logs
  - Authentication servers (e.g., Active Directory Domain Controllers), VPN gateways, Remote Desktop gateways, and change management logs for network devices.
  range: last 90 days
  queries:
  - search_technology: pseudocode
    query: AFTER new port exposure, IF hourly_connection_count for port > 99th_percentile of 30-day_baseline, ALERT.
- question: Can a machine learning model automatically detect anomalous traffic spikes to services after they become exposed?
  context: This question leverages a time-series anomaly detection model (e.g., Seasonal-Hybrid ESD) to automate the detection of post-exposure scanning. The model learns the normal daily and weekly traffic rhythms for each service port. It can then automatically flag significant, unexpected spikes in traffic that don't fit the learned pattern, pointing directly to a service that was likely just discovered by scanners and is now under active reconnaissance.
  answer_sources:
  - Zeek conn.log
  - Windows Event ID 4625
  - Firewall/Network Device Change Logs
  - Authentication servers (e.g., Active Directory Domain Controllers), VPN gateways, Remote Desktop gateways, and change management logs for network devices.
  range: last 90 days
  queries:
  - search_technology: pseudocode
    query: USE time-series anomaly detection model on per-port traffic volume. ALERT on significant positive anomalies.
- question: Is a single external IP generating a high volume of failed logins across many different user accounts?
  context: This question uses a simple rule to detect a common password spraying pattern. An attacker using a pre-compiled list of users will try a single password against many accounts. By looking for a source IP that generates a large number of failed logins (Event ID 4625) for multiple distinct user accounts in a short time, we can identify this brute-force technique, which often follows reconnaissance of an exposed authentication service.
  answer_sources:
  - Windows Event ID 4625
  - Windows Event ID 4624
  - Zeek conn.log
  - Externally-facing authentication services such as Microsoft Exchange (OWA), RDP Gateways, and Active Directory Federation Services (ADFS).
  range: last 90 days
  queries:
  - search_technology: pseudocode
    query: IF source_IP causes > 20 failed_logins for > 5 unique_users in 10 mins, ALERT.
- question: Is there a statistically high ratio of failed-to-successful logins from an external IP, indicative of a password spraying attack?
  context: This question provides a statistical method for identifying password spraying. Normal user activity has a low ratio of failed to successful logins. An attacker, however, will have a very high ratio. By alerting when the ratio from a single source IP exceeds a high threshold (e.g., 20:1) and involves multiple target accounts, we can confidently identify a password spraying attack while filtering out noise from legitimate users who simply forgot their password.
  answer_sources:
  - Windows Event ID 4625
  - Windows Event ID 4624
  - Zeek conn.log
  - Externally-facing authentication services such as Microsoft Exchange (OWA), RDP Gateways, and Active Directory Federation Services (ADFS).
  range: last 90 days
  queries:
  - search_technology: pseudocode
    query: FOR each source_IP, CALCULATE ratio of failed_logins:successful_logins in 1-hr window. IF ratio > 20:1 AND unique_target_accounts > 5, ALERT.
- question: Can a machine learning model be trained to predict if a source IP is conducting a password spraying attack?
  context: This question uses a supervised learning model, like a Random Forest, to identify sophisticated password spraying. The model can learn from a variety of features, including the rate of login attempts, the number of unique accounts targeted, the time between attempts, and even contextual information like whether the service was recently exposed. This allows it to identify attackers who may use 'low-and-slow' techniques to evade simple threshold-based rules.
  answer_sources:
  - Windows Event ID 4625
  - Windows Event ID 4624
  - Zeek conn.log
  - Externally-facing authentication services such as Microsoft Exchange (OWA), RDP Gateways, and Active Directory Federation Services (ADFS).
  range: last 90 days
  queries:
  - search_technology: pseudocode
    query: PREDICT probability of 'is_sprayer' for each source_IP using trained Random Forest model. ALERT on high probability.