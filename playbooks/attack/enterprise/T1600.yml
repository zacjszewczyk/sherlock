name: T1600: Weaken Encryption
id: d5e2b4f9-7d8c-4a1b-9f0e-3c6a8d7b5c4a
description: This playbook helps investigate if an adversary is attempting to evade defenses by weakening encryption. This can manifest in several ways, including establishing TLS/SSL connections to known malicious C2 infrastructure, using deprecated or weak TLS/SSL protocols and ciphers, sending unencrypted cleartext traffic to critical assets, modifying system cryptographic settings like the SCHANNEL registry key, conducting anomalous logins to network device management interfaces, or exfiltrating files from network infrastructure devices.
type: technique
related:
- TA0005: Defense Evasion
contributors:
- Zachary Szewczyk
- Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
- question: Is there a TLS/SSL connection to an external IP or domain known for C2 activity?
  context: Adversaries often use known command and control (C2) infrastructure for communication. Detecting outbound TLS/SSL connections to IPs or domains present on threat intelligence feeds is a strong indicator of compromise. This question aims to identify such connections, especially those originating from sensitive network devices, and enrich the findings with geographic and ownership data to speed up incident response.
  answer_sources:
  - Zeek conn.log
  - Zeek ssl.log
  - Zeek dns.log
  - Network egress points, such as firewalls and web proxies, and management interfaces of network devices (routers, switches, VPN concentrators).
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      SEARCH Zeek conn.log OR Zeek ssl.log
      WHERE destination_ip IN threat_intel_feed_ips OR server_name IN threat_intel_feed_domains
      ENRICH destination_ip with GeoIP, WHOIS
      ALERT high_severity
- question: Are any outbound TLS connections using rare or non-standard JA3/JA3S hash pairs?
  context: JA3 and JA3S hashes fingerprint the client and server side of an SSL/TLS communication. Malware and adversary tools often have unique fingerprints that differ from standard browser or application traffic. Identifying connections with JA3/JA3S hashes that are statistically rare within the network can uncover non-standard software potentially used for C2.
  answer_sources:
  - Zeek ssl.log
  - Network egress points, such as firewalls and web proxies, and management interfaces of network devices (routers, switches, VPN concentrators).
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      CALCULATE frequency of all JA3/JA3S pairs over last 30 days
      SEARCH Zeek ssl.log for current connections
      ALERT if JA3/JA3S frequency is below 1st percentile of baseline
- question: Are there anomalous spikes in the volume of new outbound TLS sessions from any internal host?
  context: C2 beaconing often manifests as a regular, periodic connection pattern or a sudden increase in outbound connections. This question uses a time-series model to learn the normal baseline of TLS connection volume for each host and destination. Deviations from this forecast can indicate the start of beaconing activity that might otherwise be missed.
  answer_sources:
  - Zeek conn.log
  - Zeek ssl.log
  - Zeek dns.log
  - Network egress points, such as firewalls and web proxies, and management interfaces of network devices (routers, switches, VPN concentrators).
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FORECAST expected TLS connection volume per host
      SEARCH current TLS connection volume per host
      ALERT if current volume significantly deviates from forecast
- question: Are any TLS/SSL sessions using deprecated protocols, weak ciphers, or insufficient key lengths in violation of security policy?
  context: The use of outdated protocols (SSLv3, TLS 1.0), weak ciphers (RC4, 3DES), or short keys (RSA < 2048) makes encrypted traffic vulnerable to decryption. Adversaries may intentionally force a downgrade to these weak standards to intercept or manipulate data. This question aims to detect these explicit policy violations in real-time.
  answer_sources:
  - Zeek ssl.log
  - All network segments, with a focus on traffic to/from critical assets (e.g., authentication servers, database servers, application servers) and all network egress points.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      SEARCH Zeek ssl.log
      WHERE version IN ('SSLv3', 'TLSv10') OR cipher CONTAINS ('RC4', 'DES', 'NULL', 'EXPORT') OR key_len < 2048
      ALERT high_severity
- question: Has the ratio of non-compliant TLS sessions to compliant sessions increased significantly across the network?
  context: A sudden, network-wide increase in the proportion of weak or non-compliant TLS sessions could indicate a systemic downgrade attack or a widespread misconfiguration being exploited by an adversary. This question monitors the overall health of TLS communications and flags statistically significant negative trends.
  answer_sources:
  - Zeek ssl.log
  - All network segments, with a focus on traffic to/from critical assets (e.g., authentication servers, database servers, application servers) and all network egress points.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      CALCULATE hourly ratio of (non-compliant_tls / compliant_tls)
      COMPARE to 30-day moving average
      ALERT if current ratio is > 3 standard deviations from the average
- question: Can a machine learning model identify TLS sessions with complex, suspicious patterns of non-compliance?
  context: Simple rule-based detection might miss nuanced combinations of TLS parameters that indicate malicious activity. A classification model trained on various session features can learn the subtle characteristics of both normal and suspicious TLS handshakes, allowing it to identify complex patterns of non-compliance that suggest an attempt to weaken encryption.
  answer_sources:
  - Zeek ssl.log
  - All network segments, with a focus on traffic to/from critical assets (e.g., authentication servers, database servers, application servers) and all network egress points.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      APPLY pre-trained classification model to new Zeek ssl.log records
      ALERT if session is classified as 'non-compliant/suspicious'
- question: Is unencrypted, cleartext traffic being sent to a critical asset where encryption is required?
  context: Protocols like HTTP, FTP, and Telnet transmit data, including credentials, in cleartext, making them easy to intercept. Policy often mandates that all communication with critical assets (like domain controllers or database servers) must be encrypted. This question seeks to identify any violation of this policy, which could represent a serious security risk or active attack.
  answer_sources:
  - Zeek conn.log
  - Zeek http.log
  - Zeek ftp.log
  - Network segments containing designated critical assets, such as data center networks, management VLANs, and segments hosting authentication servers (e.g., Active Directory Domain Controllers).
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      SEARCH Zeek conn.log
      WHERE destination_ip IN critical_asset_list AND destination_port IN (21, 23, 80, 110, 143) AND source_ip NOT IN exception_list
      ALERT high_priority
- question: Has the ratio of encrypted to unencrypted traffic volume dropped significantly in a critical network segment?
  context: A significant drop in the proportion of encrypted traffic within a critical zone could indicate that services have been misconfigured or that an adversary is forcing communications into cleartext. This question monitors the overall traffic profile of critical segments to detect such anomalous shifts.
  answer_sources:
  - Zeek conn.log
  - Zeek http.log
  - Zeek ftp.log
  - Network segments containing designated critical assets, such as data center networks, management VLANs, and segments hosting authentication servers (e.g., Active Directory Domain Controllers).
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      CALCULATE daily ratio of (encrypted_bytes / unencrypted_bytes) for critical segments
      COMPARE to 30-day rolling average
      ALERT if ratio drops by > 2 standard deviations
- question: Is a critical asset participating in a communication cluster that is typically associated with cleartext protocols?
  context: By clustering network connections based on their characteristics (ports, protocol, data volume, etc.), it's possible to identify groups of normal, expected cleartext traffic. If an IP belonging to a critical asset suddenly appears in one of these cleartext clusters, it represents a deviation from its expected, secure behavior and is a high-confidence anomaly.
  answer_sources:
  - Zeek conn.log
  - Zeek http.log
  - Zeek ftp.log
  - Network segments containing designated critical assets, such as data center networks, management VLANs, and segments hosting authentication servers (e.g., Active Directory Domain Controllers).
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      CLUSTER Zeek conn.log data based on connection features
      IDENTIFY clusters representing normal cleartext traffic
      ALERT if a critical_asset_ip appears in a cleartext cluster
- question: Has an unauthorized process modified a critical cryptographic registry key, such as SCHANNEL?
  context: Adversaries may weaken a system's defenses by directly modifying registry keys that control cryptographic protocols and ciphers (e.g., in the SCHANNEL provider). This question uses object access auditing to detect any modification to these sensitive keys and correlates the event with the parent process to determine if the change was made by an unauthorized user or program.
  answer_sources:
  - Windows Event ID 4657
  - Windows Event ID 4688
  - Windows Event ID 4663
  - Critical servers (especially web servers), domain controllers, and administrator workstations where system-wide cryptographic policies are managed.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      SEARCH for EventID 4657 where ObjectName contains 'SCHANNEL'
      CORRELATE with parent process from EventID 4688
      ALERT if process or user is NOT on allowlist
- question: Was a modification to cryptographic settings performed at an unusual time or by an unusual user or process?
  context: Modifications to system-wide cryptographic settings are typically rare and performed by specific administrative accounts or automated patching systems during predictable maintenance windows. By profiling this normal behavior, it becomes possible to assign a rarity score to each modification event. A high score suggests the change is anomalous and warrants investigation.
  answer_sources:
  - Windows Event ID 4657
  - Windows Event ID 4688
  - Windows Event ID 4663
  - Critical servers (especially web servers), domain controllers, and administrator workstations where system-wide cryptographic policies are managed.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      PROFILE frequency of user, process, and time_of_day for crypto setting modifications
      CALCULATE rarity score for each new modification event
      ALERT if score is high
- question: Does a sequence of events leading to a cryptographic setting modification deviate from learned normal administrative behavior?
  context: Normal administrative activity follows certain patterns (e.g., a specific admin tool process is launched, which then modifies a key). An anomaly detection model can be trained on these normal event sequences. An adversary's actions, which may involve a different sequence of processes or events, would be flagged by the model as an outlier, providing a high-confidence alert.
  answer_sources:
  - Windows Event ID 4657
  - Windows Event ID 4688
  - Windows Event ID 4663
  - Critical servers (especially web servers), domain controllers, and administrator workstations where system-wide cryptographic policies are managed.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      TRAIN anomaly detection model on normal sequences of EventIDs 4688 -> 4657
      APPLY model to new event sequences
      ALERT if sequence is flagged as an outlier
- question: Has a management session been established to a network device from an unauthorized source IP?
  context: Access to network device management interfaces (like routers, firewalls) should be strictly controlled and limited to specific administrative hosts or subnets. This question checks for any connection to a management port on a network device that originates from an IP not on the pre-approved allowlist, which is a strong indicator of an unauthorized access attempt.
  answer_sources:
  - Zeek conn.log
  - Windows Event ID 4624
  - Management VLANs, administrator jump boxes, and the network interfaces of core network infrastructure like firewalls, routers, and VPN concentrators.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      SEARCH Zeek conn.log
      WHERE destination_ip IN network_device_mgmt_list AND source_ip NOT IN admin_host_allowlist
      ALERT
- question: Did an administrator's session to a network device exhibit anomalous characteristics (e.g., unusual time, data volume)?
  context: Even if an authenticated session is from a legitimate administrator account, the behavior within that session can be anomalous. An adversary who has compromised an admin account may log in at an unusual time or transfer an abnormally large amount of data. This question baselines normal admin behavior to detect such multi-dimensional outliers.
  answer_sources:
  - Zeek conn.log
  - Windows Event ID 4624
  - Management VLANs, administrator jump boxes, and the network interfaces of core network infrastructure like firewalls, routers, and VPN concentrators.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR each admin user, baseline login_time and data_transfer_volume
      SEARCH for new logins
      ALERT if login time and/or data volume is a statistical outlier (e.g., >3 std dev from mean)
- question: Does a management session to a network device have a high reconstruction error when compared to a model of normal sessions?
  context: An autoencoder can learn a compressed representation of what normal administrative sessions look like based on features like duration, data volume, and time of day. When a new session is fed to the model, a high reconstruction error means the model struggles to represent it, indicating the session is anomalous and does not conform to learned patterns of normal activity.
  answer_sources:
  - Zeek conn.log
  - Windows Event ID 4624
  - Management VLANs, administrator jump boxes, and the network interfaces of core network infrastructure like firewalls, routers, and VPN concentrators.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      TRAIN autoencoder on features from normal admin sessions
      APPLY model to new sessions
      ALERT if reconstruction error is high
- question: Was a file transferred from a network infrastructure device to an unauthorized destination server?
  context: Network devices should only transfer files (like configuration backups) to a small, well-defined set of management or backup servers. A file transfer from a firewall or router to any other destination, especially using protocols like FTP, SCP, or TFTP, is highly suspicious and could indicate exfiltration of configurations or modified firmware.
  answer_sources:
  - Zeek files.log
  - Zeek conn.log
  - Network infrastructure devices, configuration backup servers, TFTP/FTP servers, and network egress points.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      SEARCH Zeek files.log or conn.log (ports 21, 22, 69)
      WHERE source_ip IS network_device AND destination_ip NOT IN backup_server_allowlist
      ALERT high_severity
- question: Was a file transferred from a network device that was unusually large or had a high-entropy (random-looking) name?
  context: Adversaries may try to hide their actions by exfiltrating data in files with randomized names or by transferring files that are much larger than a typical configuration backup (e.g., a full firmware image). This question looks for statistical anomalies in file size and filename entropy for transfers originating from network devices.
  answer_sources:
  - Zeek files.log
  - Zeek conn.log
  - Network infrastructure devices, configuration backup servers, TFTP/FTP servers, and network egress points.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      SEARCH file transfers from network_devices
      ALERT if file_size > 99th percentile of historical backups OR if filename_entropy > 4.0
- question: Can a machine learning model distinguish between a legitimate configuration backup and an anomalous file transfer from a network device?
  context: A classification model can be trained to recognize the multi-faceted profile of a legitimate backup operation (e.g., specific source/destination, time, file type, size). This allows it to flag transfers that deviate from this profile in subtle ways, potentially identifying the exfiltration of a modified firmware image or other sensitive data that might be missed by simple rules.
  answer_sources:
  - Zeek files.log
  - Zeek conn.log
  - Network infrastructure devices, configuration backup servers, TFTP/FTP servers, and network egress points.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      APPLY pre-trained classification model to new file transfers from network devices
      ALERT if transfer is classified as 'anomalous'