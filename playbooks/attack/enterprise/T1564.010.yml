name: T1564.010: Process Argument Spoofing
id: 1e9a3b8c-4d7f-4e6a-9b1c-0d8e2f4a6b0c
description: This playbook helps investigate whether an adversary is evading defenses by spoofing process arguments. This technique involves making a malicious process appear legitimate by manipulating its command line arguments. Indicators of this activity include a process with a seemingly benign command line initiating network connections to known malicious destinations; a common parent process spawning an unusual or high-risk child process (e.g., 'svchost.exe' spawning 'powershell.exe'); a process with a benign command line exhibiting anomalous network behavior (e.g., unusual port, protocol, or data volume); or a seemingly normal process creating persistence mechanisms like scheduled tasks or registry run key modifications shortly after its creation.
type: technique
related:
  - TA0005: Defense Evasion
contributors:
  - Zachary Szewczyk
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Has a process with an allowlisted, benign-appearing command line established a network connection to a destination flagged by our threat intelligence?
    context: This question aims to identify a classic bait-and-switch. Adversaries may run a process with legitimate-looking arguments (e.g., 'svchost.exe -k netsvcs') to bypass simple command-line monitoring, while the process's actual behavior is malicious. Correlating a supposedly benign process with a connection to a known command-and-control (C2) server or malware distribution point is a high-fidelity indicator of compromise.
    answer_sources:
      - Windows Event ID 4688
      - Zeek conn.log
      - Zeek dns.log
      - Threat Intelligence Feed
      - User Workstations
      - Application Servers
      - Internet Gateway
      - SIEM
    range: last 90 days
    queries:
      - pseudocode: JOIN ProcessCreationEvents ON Host WHERE CommandLine IN BenignAllowlist WITH NetworkConnectionEvents ON Host WITHIN 60s of ProcessCreation. ENRICH DestinationIP with ThreatIntelFeed. ALERT WHERE ThreatIntelFeed.IsMalicious IS TRUE.
  - question: Has a commonly abused process (e.g., svchost.exe, rundll32.exe) connected to a geographically rare destination for that process type?
    context: This question uses behavioral analytics to spot anomalies. Even if a command line looks normal, the network destination might not. Processes typically connect to a predictable set of geographic locations. A connection to a country where the organization has no business and the process has never connected before is highly suspicious and could indicate C2 communication.
    answer_sources:
      - Windows Event ID 4688
      - Zeek conn.log
      - GeoIP Database
      - User Workstations
      - Application Servers
      - Internet Gateway
      - SIEM
    range: last 90 days
    queries:
      - pseudocode: FOR each ProcessName in AbusedProcessList, BASELINE DestinationCountry from historical NetworkLogs. ALERT on NewConnection WHERE DestinationCountry NOT IN 95th_percentile_of_Baseline.
  - question: Has a machine learning model identified a process with a benign-looking command line as malicious based on its combined process and network features?
    context: This question leverages machine learning to find subtle patterns that rule-based detections might miss. The model considers multiple features simultaneously (process name, command line attributes, network port, protocol, data volume) to determine if an activity, despite appearing normal on the surface, fits a malicious profile. An alert from this model indicates a high-probability compromise that warrants investigation.
    answer_sources:
      - Windows Event ID 4688
      - Zeek conn.log
      - ML Model Inference Logs
      - User Workstations
      - Application Servers
      - Internet Gateway
      - SIEM
    range: last 90 days
    queries:
      - pseudocode: SCORE ProcessAndNetworkEvents with ML_Model. ALERT WHERE Event.CommandLine IN BenignAllowlist AND ML_Model.Score > 0.9.
  - question: Has a common, benign-looking parent process (e.g., 'svchost.exe') spawned a high-risk child process (e.g., 'powershell.exe', 'cmd.exe')?
    context: This question looks for suspicious process execution chains. Legitimate system processes like 'svchost.exe' rarely, if ever, spawn interactive shells or scripting engines. Such an event, especially when the parent process has a spoofed benign command line, is a strong indicator that an adversary has injected code into the parent process and is using it to launch further tools for reconnaissance or execution.
    answer_sources:
      - Windows Event ID 4688
      - User Workstations
      - Domain Controllers
      - Application Servers
    range: last 90 days
    queries:
      - pseudocode: SEARCH ProcessCreationEvents WHERE ParentProcess IN CommonParentList AND ParentCommandLine IN BenignAllowlist AND ChildProcess IN HighRiskChildList.
  - question: Has a statistically rare parent-child process relationship been observed?
    context: This question identifies anomalies in process lineage. Every environment has typical patterns of which processes spawn others. By establishing a baseline of these normal relationships, we can automatically flag new, infrequent pairings. An alert for a rare pairing suggests a deviation from normal operations that could be caused by malicious activity.
    answer_sources:
      - Windows Event ID 4688
      - User Workstations
      - Domain Controllers
      - Application Servers
    range: last 90 days
    queries:
      - pseudocode: FOR each ParentProcess, BASELINE frequency of ChildProcess names from historical logs. ALERT on NewProcessCreation WHERE Parent-Child_Pair_Frequency < 5th_percentile_of_Baseline.
  - question: Has an unsupervised machine learning model flagged a new process creation event as an outlier compared to established clusters of normal behavior?
    context: This question uses unsupervised learning to find 'unknown unknowns' in process execution behavior. Instead of looking for specific bad patterns, clustering algorithms group all activities into 'normal' clusters. Any new activity that doesn't fit into an existing cluster is flagged as an outlier. This is a powerful way to detect novel attack techniques or anomalous behavior that hasn't been seen before.
    answer_sources:
      - Windows Event ID 4688
      - ML Model Inference Logs
      - User Workstations
      - Domain Controllers
      - Application Servers
    range: last 90 days
    queries:
      - pseudocode: CLUSTER ProcessCreationEvents based on ParentName, ParentCommandLine, ChildName. ALERT on NewEvent that is flagged as an outlier (not in any cluster).
  - question: Has a process with a non-suspicious command line connected to a non-standard port often associated with command and control?
    context: This question focuses on identifying covert C2 channels. Adversaries often use custom or non-standard ports (e.g., 4444, 8443) to evade detection. Even if a process like PowerShell is launched without obviously malicious flags (like '-enc'), its connection to an unusual port is a significant red flag that it may be communicating with an attacker's infrastructure.
    answer_sources:
      - Windows Event ID 4688
      - Zeek conn.log
      - User Workstations
      - Application Servers
      - Internet Gateway
    range: last 90 days
    queries:
      - pseudocode: SEARCH for ProcessCreationEvents with benign command lines AND corresponding NetworkConnectionEvents WHERE DestinationPort IN NonStandardC2PortList.
  - question: Has a common process exhibited network behavior (e.g., data volume, connection duration) that is a statistical outlier compared to its own historical baseline?
    context: This question detects when a legitimate process behaves illegitimately. A web browser, for example, has a typical profile for data transfer and session length. If an instance of that browser process suddenly exfiltrates gigabytes of data or maintains an unusually long connection, it deviates significantly from its norm. This statistical anomaly, even with a benign command line, points to potential process compromise and malicious activity.
    answer_sources:
      - Windows Event ID 4688
      - Zeek conn.log
      - User Workstations
      - Application Servers
      - Internet Gateway
    range: last 90 days
    queries:
      - pseudocode: FOR each ProcessName, BASELINE network metrics (Bytes, Duration). ALERT on NewConnection WHERE a metric > 3 * standard_deviation_of_Baseline.
  - question: Did a process with a benign command line launch just before a significant, anomalous spike in outbound network traffic from a host?
    context: This question links a host-level network anomaly back to a potential source process. A sudden, unexplained spike in a host's outbound traffic is suspicious. By immediately looking at the processes created just before the spike, we can identify the likely culprit. If that process appears benign based on its command line, it's a strong candidate for argument spoofing being used to conceal data exfiltration or other malicious communication.
    answer_sources:
      - Windows Event ID 4688
      - Zeek conn.log
      - Time Series Anomaly Detection System
      - User Workstations
      - Application Servers
      - Internet Gateway
    range: last 90 days
    queries:
      - pseudocode: DETECT anomaly in host outbound traffic time series. IF anomaly detected, SEARCH for ProcessCreationEvents on that host within 5 minutes prior. ALERT on processes with benign command lines.
  - question: Has a common application (e.g., browser, Office app) created a persistence mechanism, such as a scheduled task or registry run key, shortly after launching?
    context: This question aims to detect when a legitimate application is exploited to establish persistence. Standard applications like web browsers or Word should not be creating scheduled tasks or modifying startup registry keys. This behavior, occurring shortly after the application starts, strongly suggests that a malicious document, extension, or exploit has compromised the process and is now setting up a way to survive a system reboot.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 12
      - Windows Event ID 13
      - Windows Event ID 4698
      - User Workstations
      - Critical Servers
      - Domain Controllers
    range: last 90 days
    queries:
      - pseudocode: JOIN ProcessCreationEvents for common apps WITH (ScheduledTaskCreationEvents OR RegistryPersistenceModifications) ON same ProcessID within 5 minutes. ALERT on match.
  - question: Has a common application performed a sequence of actions (e.g., creating a scheduled task) that it has never or very rarely performed before in the environment?
    context: This question uses historical frequency to identify unprecedented behavior. By baselining the typical actions that follow a process launch, we can spot deviations. If 'winword.exe' has never been observed to create a scheduled task in the entire history of the organization's logs, the first time it happens is an extremely high-confidence anomaly that almost certainly indicates malicious activity.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 4698
      - Sysmon Event IDs 12, 13
      - User Workstations
      - Critical Servers
      - Domain Controllers
    range: last 90 days
    queries:
      - pseudocode: BASELINE action sequences for common applications. ALERT on new sequence if its historical frequency is zero or near-zero.
  - question: Has a machine learning model detected an improbable sequence of events originating from a benign-looking process?
    context: This question leverages a more advanced form of behavioral analysis that understands the order of operations. A sequence model learns the normal 'grammar' of system events. A sequence like 'msedge.exe starts' -> 'msedge.exe modifies a startup registry key' is an 'ungrammatical' or highly improbable sentence in the language of normal system behavior. The model flags these low-probability sequences, indicating a likely compromise that evades simpler rules.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 4698
      - Sysmon Event IDs 12, 13
      - ML Model Inference Logs
      - User Workstations
      - Critical Servers
      - Domain Controllers
    range: last 90 days
    queries:
      - pseudocode: SCORE new event sequences with a trained sequence model (LSTM/Markov). ALERT on sequences with a low probability score, such as 'ProcessCreate:msedge.exe' -> 'RegistryModify:RunKey'.