name: T1578.004: Revert Cloud Instance
id: a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d
description: This playbook helps investigate whether an adversary is attempting to evade defenses by reverting cloud instances to a prior state. This technique is often used to remove malware, delete logs, or otherwise destroy forensic evidence from a compromised virtual machine. Indicators include the direct use of cloud restoration commands (e.g., 'Restore-AzVM', 'ec2 restore-snapshot'), anomalous spikes in API calls to cloud management endpoints, verifiable gaps in host-based logs following a restart, backward system time changes, and unexpected system shutdowns immediately following a high-severity security alert.
type: technique
related:
  - TA0005: Defense Evasion
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Are there any cloud provider audit log events indicating a snapshot restore or instance reset that are followed by an unexpected host shutdown?
    context: This question looks for direct evidence of a revert command (like 'RestoreSnapshot') in cloud logs, followed closely by the instance going offline. This combination is a strong indicator that an adversary is trying to erase their tracks by rolling back the virtual machine to a clean, pre-compromise state.
    answer_sources:
      - AWS CloudTrail
      - Azure Activity Logs
      - GCP Audit Logs
      - Windows Event ID 4688
      - Windows Event ID 1074
      - Cloud provider audit log streams (e.g., CloudTrail, Azure Monitor)
      - Cloud-hosted virtual machines (Windows)
      - Centralized SIEM/Log Management Platform
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH cloud_audit_logs FOR event_name IN ('RestoreSnapshot', 'RestoreFromSnapshot', 'ResetInstance') | CORRELATE with host_logs WHERE event_id = 1074 ON host_id WITHIN 30 minutes.
  - question: Has any administrative user or role exhibited an anomalous frequency of snapshot or revert-related API calls, especially outside of normal business hours?
    context: This question aims to detect the abuse of legitimate administrative functions. By establishing a baseline of normal snapshot and revert activity for each user or role, an analyst can identify when a user performs an unusually high number of these actions, which could indicate a compromised account being used to cover tracks.
    answer_sources:
      - AWS CloudTrail
      - Azure Activity Logs
      - GCP Audit Logs
      - Windows Event ID 4688
      - Windows Event ID 1074
      - Cloud provider audit log streams (e.g., CloudTrail, Azure Monitor)
      - Cloud-hosted virtual machines (Windows)
      - Centralized SIEM/Log Management Platform
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH cloud_audit_logs for revert_api_calls | GROUP BY user, time_window | ALERT if count > 95th_percentile_baseline(user) OR event_time is off_hours.
  - question: Can we use machine learning to classify cloud audit log events as either benign change management or suspicious revert activity?
    context: This question explores a more advanced, automated approach to detection. By training a classification model on various features of an audit log event (such as user identity, source IP, user agent, and time of day), the system can learn to automatically flag suspicious revert events that might be missed by simpler, threshold-based rules.
    answer_sources:
      - AWS CloudTrail
      - Azure Activity Logs
      - GCP Audit Logs
      - Windows Event ID 4688
      - Windows Event ID 1074
      - Cloud provider audit log streams (e.g., CloudTrail, Azure Monitor)
      - Cloud-hosted virtual machines (Windows)
      - Centralized SIEM/Log Management Platform
    range: last 90 days
    queries:
      - technology: pseudocode
        query: INPUT cloud_audit_logs INTO classification_model | OUTPUT classification ('benign' or 'suspicious') | ALERT on 'suspicious' restore/revert events.
  - question: Did a host connect to a cloud management API endpoint shortly before an unexpected system shutdown?
    context: This question looks for preparatory activity before a revert. An adversary may need to interact with the cloud management API to gather information or stage the revert operation. A spike in this specific type of network traffic immediately followed by the host going offline is a strong indicator of a planned anti-forensics action.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Windows Event ID 1074
      - Windows Event ID 6005
      - Windows Event ID 6006
      - Cloud environment network gateways
      - Virtual network flow log collectors
      - Centralized SIEM/Log Management Platform
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH network_logs FOR destination_fqdn IN cloud_api_watchlist | CORRELATE with host_logs WHERE event_id = 1074 ON host_ip WITHIN 10 minutes.
  - question: Has any instance shown a statistically significant increase in connection count or data volume to cloud management API endpoints?
    context: This question uses statistical analysis to find unusual network behavior. By baselining the normal traffic patterns between instances and management APIs, an analyst can detect significant deviations. An anomalous spike can reveal an adversary's interaction with the cloud control plane to orchestrate a revert, even without observing the specific command.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Windows Event ID 1074
      - Windows Event ID 6005
      - Windows Event ID 6006
      - Cloud environment network gateways
      - Virtual network flow log collectors
      - Centralized SIEM/Log Management Platform
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH network_logs to cloud_apis | GROUP BY host, time_window | ALERT if connection_count OR data_volume > 3_std_dev_above_mean(host).
  - question: Is there an anomalous spike in connections to the instance metadata service (169.254.169.254) that correlates with a subsequent loss of host telemetry?
    context: This question focuses on a critical internal service often abused by attackers. Adversaries query the metadata service to obtain credentials or instance information needed to perform a revert. A time-series anomaly detection model can pick up on these sudden, unusual spikes in traffic that precede a host disappearing from monitoring.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Windows Event ID 1074
      - Windows Event ID 6005
      - Windows Event ID 6006
      - Cloud environment network gateways
      - Virtual network flow log collectors
      - Centralized SIEM/Log Management Platform
    range: last 90 days
    queries:
      - technology: pseudocode
        query: INPUT network_logs to 169.254.169.254 INTO time_series_model | ALERT on anomaly | CORRELATE with host_shutdown ON host_ip.
  - question: Following a high-confidence security alert, is there a verifiable gap in the host's logs that corresponds with a system restart?
    context: This is a classic anti-forensics detection method. If a confirmed malicious event (like C2 traffic) is observed, and then the host restarts and logs from that time period are missing from the SIEM, it is highly probable that the attacker reverted the instance to destroy evidence of their activity.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Windows Event ID 1074
      - Windows Event ID 4688
      - Windows Event ID 4624
      - EDR Alerts
      - Centralized SIEM/Log Management Platform
      - Network sensor data lake
      - Cloud-hosted virtual machines (Windows)
    range: last 90 days
    queries:
      - technology: pseudocode
        query: ON high_confidence_alert(host) | QUERY host_logs for 15_min_window around alert_time | IF event_id=1074 AND logs_missing THEN ALERT 'Suspected Revert'.
  - question: After a host restart, is there a statistically unusual delay in log ingestion resuming for that host?
    context: This question uses log ingestion metadata as a proxy for detecting log gaps. A revert operation takes time, and the new instance may not start sending logs immediately. By baselining the normal delay between a restart and the first new log, we can flag instances that take an abnormally long time to reappear, suggesting a revert occurred.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Windows Event ID 1074
      - Windows Event ID 4688
      - Windows Event ID 4624
      - EDR Alerts
      - Centralized SIEM/Log Management Platform
      - Network sensor data lake
      - Cloud-hosted virtual machines (Windows)
    range: last 90 days
    queries:
      - technology: pseudocode
        query: ON event_id=1074(host) | MEASURE time_to_first_new_log | ALERT if time > 95th_percentile_baseline(host).
  - question: After a host restart, is the volume of ingested logs for the pre-restart period significantly less than what a time-series model would have predicted?
    context: This question uses forecasting to detect missing data. A model predicts the expected log volume for a given period. If a revert happened, the logs from the compromised state are gone, so the actual ingested volume will be much lower than the forecast, creating a large negative residual that signals an anomaly and a likely revert.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Windows Event ID 1074
      - Windows Event ID 4688
      - Windows Event ID 4624
      - EDR Alerts
      - Centralized SIEM/Log Management Platform
      - Network sensor data lake
      - Cloud-hosted virtual machines (Windows)
    range: last 90 days
    queries:
      - technology: pseudocode
        query: ON event_id=1074(host) | COMPARE actual_log_volume(pre-restart) with forecast_log_volume(pre-restart) | ALERT if actual is much less than forecast.
  - question: Has a Windows system time change event (Event ID 4616) been observed where the new time is chronologically earlier than the previous time?
    context: This question looks for a very specific, high-fidelity indicator of a revert. Reverting an instance from a snapshot often rolls back the system clock to the time the snapshot was taken. A system clock moving backwards is extremely unusual and almost always a sign of suspicious activity requiring immediate investigation.
    answer_sources:
      - Windows Event ID 4616
      - Windows Event ID 6005
      - Windows Event ID 1074
      - Cloud-hosted virtual machines (Windows)
      - Active Directory Domain Controllers
      - Centralized SIEM/Log Management Platform
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH host_logs FOR event_id=4616 | ALERT if NewTime < PreviousTime.
  - question: Has a backward system time change occurred that is statistically significant compared to normal NTP corrections?
    context: This question adds statistical rigor to the previous one. While small time corrections from NTP are normal, a revert will cause a large jump backwards. By baselining the normal time drift, an analyst can set a threshold (e.g., >5 minutes or 4 standard deviations) to specifically alert on significant, non-standard time rollbacks.
    answer_sources:
      - Windows Event ID 4616
      - Windows Event ID 6005
      - Windows Event ID 1074
      - Cloud-hosted virtual machines (Windows)
      - Active Directory Domain Controllers
      - Centralized SIEM/Log Management Platform
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH host_logs FOR event_id=4616 | CALCULATE delta = PreviousTime - NewTime | ALERT if delta > 5_minutes OR delta > 4_std_dev_baseline.
  - question: Can clustering algorithms automatically identify anomalous system time rollback events from normal time corrections?
    context: This question proposes using an unsupervised learning model to automatically separate normal time changes from suspicious ones. The algorithm would group the frequent, small NTP adjustments into one large cluster and isolate the rare, large, manual rollbacks as anomalous outliers, requiring no pre-defined thresholds.
    answer_sources:
      - Windows Event ID 4616
      - Windows Event ID 6005
      - Windows Event ID 1074
      - Cloud-hosted virtual machines (Windows)
      - Active Directory Domain Controllers
      - Centralized SIEM/Log Management Platform
    range: last 90 days
    queries:
      - technology: pseudocode
        query: INPUT event_id_4616_logs INTO clustering_model (e.g., DBSCAN) | ALERT on classified outliers.
  - question: Has a host experienced an unexpected shutdown within 60 minutes after a high-severity security alert was triggered for it?
    context: This question correlates two distinct events to infer attacker motive. A high-severity alert (from an EDR, IDS, etc.) indicates the attacker has likely been detected. If the host is shut down immediately after, it's a strong sign the attacker is trying to destroy evidence via a revert, a behavior known as "anti-forensics."
    answer_sources:
      - Windows Event ID 1074
      - Zeek conn.log
      - EDR Alerts
      - IDS Alerts
      - Centralized SIEM/Log Management Platform
      - EDR Management Console
      - IDS/IPS Management Console
    range: last 90 days
    queries:
      - technology: pseudocode
        query: ON high_severity_alert(host) | SEARCH host_logs for event_id=1074 WITHIN 60 minutes | ESCALATE to 'Suspected Anti-forensics' alert.
  - question: Is a host restarting with a statistically anomalous frequency in the 24 hours following a security alert?
    context: This question looks for a pattern of behavior over a slightly longer timeframe. An attacker, upon realizing they've been detected, might repeatedly try to revert or restart the machine to disrupt response efforts. Comparing the restart frequency after an alert to the host's normal baseline can reveal this panicked or disruptive activity.
    answer_sources:
      - Windows Event ID 1074
      - Zeek conn.log
      - EDR Alerts
      - IDS Alerts
      - Centralized SIEM/Log Management Platform
      - EDR Management Console
      - IDS/IPS Management Console
    range: last 90 days
    queries:
      - technology: pseudocode
        query: CALCULATE baseline_restart_freq(host) | ON security_alert(host) | MONITOR restart_freq for 24h | ALERT if post_alert_freq is anomalous (e.g., 99th percentile).
  - question: Can a Bayesian network calculate a high-confidence probability of an instance revert based on the occurrence of a security alert followed by an unexpected restart?
    context: This question describes a sophisticated probabilistic model that formalizes an analyst's reasoning. An EDR alert increases the suspicion of compromise, and a subsequent unexpected restart dramatically increases the probability that a revert has occurred. When the calculated probability crosses a high threshold (e.g., > 0.8), a confident alert can be generated.
    answer_sources:
      - Windows Event ID 1074
      - Zeek conn.log
      - EDR Alerts
      - IDS Alerts
      - Centralized SIEM/Log Management Platform
      - EDR Management Console
      - IDS/IPS Management Console
    range: last 90 days
    queries:
      - technology: pseudocode
        query: INPUT 'High-Severity EDR Alert' and 'Unexpected Restart' events into Bayesian_network | IF P(Revert|Evidence) > 0.8 THEN ALERT.