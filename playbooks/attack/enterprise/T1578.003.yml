name: T1578.003: Delete Cloud Instance
id: 3a1f8b2c-9d6e-4a7b-8c5d-0e1f2a3b4c5d
description: "Investigates whether an adversary has attempted to evade defenses by deleting cloud instances. This is often done to remove malicious infrastructure, destroy evidence of their activities, or disrupt services. The playbook looks for indicators such as instance deletions originating from anomalous IP addresses or using suspicious User-Agent strings, the deletion of unusually short-lived or long-running critical instances, and high-volume deletion activity from a single user or IP. These indicators help to distinguish malicious deletions from routine administrative actions."
type: technique
related:
  - TA0005: Defense Evasion
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
investigative_questions:
  - question: "Has a cloud instance deletion been initiated from a known malicious IP address (e.g., C2 server, TOR node, proxy)?"
    context: "Adversaries often use compromised infrastructure or anonymizing services to obscure their origin. Correlating the source IP of a deletion event with threat intelligence is a high-fidelity method to detect malicious activity, as legitimate administrators rarely operate from such locations."
    answer_sources:
      - AWS CloudTrail
      - Azure Activity Logs
      - Google Cloud Audit Logs
      - Zeek conn.log
      - Windows Security Event ID 5156
      - Cloud Management Plane
      - Identity and Access Management (IAM) Service
      - Internet Gateway/VPC Flow Logs
      - Threat Intelligence Platform
      - Administrator Workstations
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          SEARCH cloud_audit_logs for event_name='instance_deletion'
          JOIN source_ip with threat_intel_feed
          WHERE threat_intel_feed.is_malicious = TRUE
          RETURN timestamp, user, source_ip, instance_id
  - question: "Did a cloud instance deletion originate from a geographic location or network (ASN) that is unusual for the acting user or role?"
    context: "Legitimate administrative activity typically originates from a predictable set of locations and networks. A deletion command coming from a country or Autonomous System Number (ASN) where a user has never operated from before is a strong indicator of a compromised account. This requires baselining normal user behavior."
    answer_sources:
      - AWS CloudTrail
      - Azure Activity Logs
      - Google Cloud Audit Logs
      - Zeek conn.log
      - Windows Security Event ID 5156
      - Cloud Management Plane
      - Identity and Access Management (IAM) Service
      - Internet Gateway/VPC Flow Logs
      - Threat Intelligence Platform
      - Administrator Workstations
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          SEARCH cloud_audit_logs for event_name='instance_deletion'
          FOR EACH event:
            GET historical_locations for event.user
            CALCULATE rarity_score for event.source_ip_location against historical_locations
            IF rarity_score < 1st_percentile
              RETURN event
  - question: "Does a cloud instance deletion event register as an anomaly when analyzed by a machine learning model considering factors like IP rarity, time of day, and user privileges?"
    context: "A multi-faceted anomaly detection model can identify suspicious deletions that might not trigger simpler, single-variable rules. By combining features like the rarity of the source IP and ASN, time-of-day, user privilege level, and MFA status, the model can spot complex patterns indicative of an attack that evade basic thresholding."
    answer_sources:
      - AWS CloudTrail
      - Azure Activity Logs
      - Google Cloud Audit Logs
      - Zeek conn.log
      - Windows Security Event ID 5156
      - Cloud Management Plane
      - Identity and Access Management (IAM) Service
      - Internet Gateway/VPC Flow Logs
      - Threat Intelligence Platform
      - Administrator Workstations
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          INPUT enriched_deletion_events (source_IP_geo_rarity, source_ASN_rarity, time_of_day_anomaly, user_role_privilege, is_MFA_enabled)
          APPLY trained_anomaly_detection_model(events)
          RETURN events where anomaly_score > threshold
  - question: "Was a cloud instance deleted using a tool with a User-Agent string that is on a deny-list (e.g., known hacking tool) or not on the organizational allow-list of approved tools?"
    context: "Organizations typically use a standard set of tools (like Terraform, AWS CLI, SDKs) for cloud administration, each with a predictable User-Agent string. A deletion event originating from a tool with an unknown, suspicious, or explicitly denied User-Agent strongly suggests the use of an unauthorized or malicious tool."
    answer_sources:
      - AWS CloudTrail
      - Azure Activity Logs
      - Google Cloud Audit Logs
      - Zeek http.log
      - Windows Security Event ID 4688
      - Cloud Management Plane
      - CI/CD Pipeline Servers
      - Administrator Workstations
      - Proxy and Egress Firewalls
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          SEARCH cloud_audit_logs for event_name='instance_deletion'
          FILTER user_agent NOT IN (allow_list) OR user_agent IN (deny_list)
          RETURN event
  - question: "Was a cloud instance deleted using a tool with a User-Agent that is statistically rare or has never been seen before for that specific user or role?"
    context: "Individual administrators and automation roles tend to use a consistent set of tools. When a deletion is performed by a user with a tool they've never used before, it could indicate that their credentials have been compromised and are being used with an attacker's toolset. This requires baselining User-Agent strings on a per-user basis."
    answer_sources:
      - AWS CloudTrail
      - Azure Activity Logs
      - Google Cloud Audit Logs
      - Zeek http.log
      - Windows Security Event ID 4688
      - Cloud Management Plane
      - CI/CD Pipeline Servers
      - Administrator Workstations
      - Proxy and Egress Firewalls
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          SEARCH cloud_audit_logs for event_name='instance_deletion'
          FOR EACH event:
            GET historical_user_agents for event.user
            IF event.user_agent NOT IN historical_user_agents OR frequency(event.user_agent) < 2nd_percentile
              RETURN event
  - question: "Does the User-Agent string from an instance deletion event fall into an anomalous cluster or register as noise when analyzed with vectorization and clustering models?"
    context: "Advanced adversaries may slightly modify common User-Agent strings to evade simple list-based detection. By converting User-Agents into numerical vectors (e.g., using TF-IDF) and applying clustering algorithms, we can identify outliers that are syntactically different from the main clusters of legitimate toolsets, even if they aren't on a known deny-list."
    answer_sources:
      - AWS CloudTrail
      - Azure Activity Logs
      - Google Cloud Audit Logs
      - Zeek http.log
      - Windows Security Event ID 4688
      - Cloud Management Plane
      - CI/CD Pipeline Servers
      - Administrator Workstations
      - Proxy and Egress Firewalls
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          VECTORIZE user_agent from deletion_events using TF-IDF model
          APPLY clustering_algorithm (e.g., DBSCAN) on vectors
          RETURN events where user_agent_vector is classified as 'noise' or belongs to an anomalous_cluster
  - question: "Was a cloud instance deleted by its creator within an unusually short time (e.g., less than 15 minutes)?"
    context: "Adversaries may spin up instances for a quick, malicious task (e.g., running a command, exfiltrating data) and then immediately delete them to cover their tracks. A very short lifespan, especially when the same identity creates and destroys the resource, is highly suspicious and deviates from normal operational patterns where instances have a longer, more purposeful existence."
    answer_sources:
      - AWS CloudTrail
      - Azure Activity Logs
      - Google Cloud Audit Logs
      - Cloud Management Plane
      - Virtual Private Cloud (VPC)
      - Cloud Asset Inventory Database (CMDB)
      - Cloud orchestration and automation platforms
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          SEARCH cloud_audit_logs for event_name='instance_deletion' as D
          JOIN with cloud_audit_logs for event_name='instance_creation' as C on instance_id
          WHERE D.user = C.user AND (D.timestamp - C.timestamp) < 15_minutes
          AND D.user NOT IN (automation_service_accounts)
          RETURN D
  - question: "Was a cloud instance's lifespan a statistical outlier compared to other instances of the same type, image, or project group?"
    context: "Instances used for similar purposes (e.g., build agents, web servers) tend to have similar lifecycle durations. If a newly deleted instance's lifespan is in the bottom percentile compared to its peers, it suggests its purpose was abnormal. This could indicate an adversary spinning up a resource disguised as a legitimate one but using it for a much shorter, malicious purpose."
    answer_sources:
      - AWS CloudTrail
      - Azure Activity Logs
      - Google Cloud Audit Logs
      - Cloud Management Plane
      - Virtual Private Cloud (VPC)
      - Cloud Asset Inventory Database (CMDB)
      - Cloud orchestration and automation platforms
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          SEARCH cloud_audit_logs for event_name='instance_deletion'
          CALCULATE lifespan for deleted_instance
          GET historical_lifespan_distribution for instances with same_type/image/tag
          IF lifespan < 5th_percentile of distribution
            RETURN event
  - question: "Does the observed lifespan of a deleted instance have an extremely low probability (p-value) of occurring, based on a fitted statistical model of normal instance lifecycles?"
    context: "This is a more statistically rigorous version of percentile-based outlier detection. By fitting a probability distribution (like Weibull, which is often used for lifetime analysis) to historical data, we can calculate the precise probability of observing a lifespan as short as the one in question. A very low p-value (e.g., < 0.01) provides strong statistical evidence that the deletion is a significant deviation from the norm."
    answer_sources:
      - AWS CloudTrail
      - Azure Activity Logs
      - Google Cloud Audit Logs
      - Cloud Management Plane
      - Virtual Private Cloud (VPC)
      - Cloud Asset Inventory Database (CMDB)
      - Cloud orchestration and automation platforms
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          FIT probability_distribution_model (e.g., Weibull) on historical_instance_lifespans
          FOR EACH new_deletion_event:
            CALCULATE lifespan
            CALCULATE p_value of lifespan under the fitted_model
            IF p_value < 0.01
              RETURN event
  - question: "Was a critical or production instance deleted by a user not in a designated admin group, or outside of an approved change management window?"
    context: "The deletion of a critical production asset is a high-impact event that should only be performed by authorized administrators during planned maintenance periods. A deletion that violates these policies is a major red flag for either a malicious insider or an external attacker with compromised credentials, and could signal an attempt at service disruption or destruction."
    answer_sources:
      - AWS CloudTrail
      - Azure Activity Logs
      - Google Cloud Audit Logs
      - CMDB/Asset Inventory
      - Change Management System Logs
      - Production Environment VPCs
      - Cloud Asset Inventory Database (CMDB)
      - IT Service Management (ITSM) Platform
      - Identity and Access Management (IAM) Service
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          SEARCH cloud_audit_logs for event_name='instance_deletion'
          WHERE (instance_tag: 'production' OR instance_tag: 'critical')
          AND user NOT IN (CloudSystemAdministrators_group)
          OR timestamp NOT IN (approved_change_windows_for_instance)
          RETURN event
  - question: "Was a deleted cloud instance among the longest-running, most stable assets (e.g., in the top 10% of uptime for all active instances)?"
    context: "Long-running instances are often core, stable components of an infrastructure. Their unexpected deletion is highly anomalous and potentially destructive. Identifying the removal of such an asset can signal an adversary's attempt to disrupt key services or destroy a critical part of the environment."
    answer_sources:
      - AWS CloudTrail
      - Azure Activity Logs
      - Google Cloud Audit Logs
      - CMDB/Asset Inventory
      - Change Management System Logs
      - Production Environment VPCs
      - Cloud Asset Inventory Database (CMDB)
      - IT Service Management (ITSM) Platform
      - Identity and Access Management (IAM) Service
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          CALCULATE uptime_percentile for all active instances
          SEARCH cloud_audit_logs for event_name='instance_deletion'
          WHERE deleted_instance.uptime_percentile > 90th
          RETURN event
  - question: "Is an instance deletion predicted as 'unauthorized' by a machine learning model that considers actor permissions, time of day, change windows, and instance criticality?"
    context: "A supervised classification model can learn the complex patterns that differentiate legitimate, authorized deletions from unauthorized or malicious ones. By training on features like user permissions, time of day, instance tags, and uptime, the model can provide a confidence score for whether a deletion is malicious, enabling analysts to focus on the highest-risk events."
    answer_sources:
      - AWS CloudTrail
      - Azure Activity Logs
      - Google Cloud Audit Logs
      - CMDB/Asset Inventory
      - Change Management System Logs
      - Production Environment VPCs
      - Cloud Asset Inventory Database (CMDB)
      - IT Service Management (ITSM) Platform
      - Identity and Access Management (IAM) Service
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          FOR EACH deletion_event:
            EXTRACT features (actor_permissions, is_outside_business_hours, in_change_window, instance_uptime_percentile, num_critical_tags)
            APPLY trained_classifier_model(features)
            IF prediction is 'unauthorized' with confidence > threshold
              RETURN event
  - question: "Did a single user, role, or IP address delete a high number of instances (e.g., >20) within a short time window (e.g., 10 minutes)?"
    context: "While some automation may delete multiple instances, a very high volume of deletions from a single actor in a short period is a strong indicator of a destructive attack. This simple threshold-based rule can serve as a brute-force detector for widespread, rapid infrastructure destruction, tuned to avoid false positives from known, legitimate automation."
    answer_sources:
      - AWS CloudTrail
      - Azure Activity Logs
      - Google Cloud Audit Logs
      - Cloud Management Plane
      - Identity and Access Management (IAM) Service
      - Billing and Cost Management Dashboard
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          COUNT distinct instance_deletions by user/role/ip in 10_minute_sliding_window
          WHERE count > 20
          RETURN user/role/ip, count, timestamp
  - question: "Did the number of instance deletions by a user or role in the last hour significantly deviate (e.g., Z-score > 3.5) from their own historical average?"
    context: "Different users have different deletion patterns. A senior admin might delete more instances than a junior developer. By comparing a user's current activity to their own historical baseline (using moving average and standard deviation), we can spot significant spikes that are abnormal for that specific user. A high Z-score indicates a statistically significant deviation from their normal behavior."
    answer_sources:
      - AWS CloudTrail
      - Azure Activity Logs
      - Google Cloud Audit Logs
      - Cloud Management Plane
      - Identity and Access Management (IAM) Service
      - Billing and Cost Management Dashboard
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          FOR EACH user:
            MAINTAIN moving_average and std_dev of deletions_per_hour
          FOR EACH new_deletion_event:
            UPDATE count for current_hour
            CALCULATE z_score = (current_hour_count - moving_average) / std_dev
            IF z_score > 3.5
              RETURN user, current_hour_count, z_score
  - question: "Was there a statistically significant spike in the overall number of instance deletions across the entire organization, according to a time series anomaly detection model?"
    context: "Some attacks may involve multiple compromised accounts, so an organization-wide view is crucial. A time series model can learn the normal rhythm of deletions for the entire organization, including daily or weekly cycles (e.g., cleanup scripts running on weekends). The model can then flag any sudden, unexpected spike in overall deletion activity that falls outside the predicted confidence bands, indicating a potential large-scale event."
    answer_sources:
      - AWS CloudTrail
      - Azure Activity Logs
      - Google Cloud Audit Logs
      - Cloud Management Plane
      - Identity and Access Management (IAM) Service
      - Billing and Cost Management Dashboard
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: |
          APPLY time_series_anomaly_model (e.g., Seasonal-Hybrid ESD) to minute-by-minute org-wide deletion count
          RETURN timestamps where observed_count is outside model's confidence_interval