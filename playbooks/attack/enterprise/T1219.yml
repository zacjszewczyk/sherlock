name: 'T1219: Remote Access Tools'
id: 'a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d'
description: "This playbook helps determine if an adversary is using legitimate remote access software for command and control. It focuses on identifying suspicious network connections to known or look-alike remote access service infrastructure, unusual process execution patterns, and persistence mechanisms. Detections include matching outbound traffic against threat intelligence, finding typosquatted domains, and identifying connections to algorithmically generated domains (DGA). It also looks for the installation of persistence via Windows Services or Registry keys shortly after a RAT execution, anomalous execution paths or parent processes, and unusual data exfiltration volumes or beaconing behavior. Finally, it correlates event sequences indicative of an initial compromise leading to the download and execution of a remote access tool."
type: 'technique'
related:
  - 'TA0011: Command and Control'
contributors:
  - 'Zachary Szewczyk'
  - 'Ask Sage'
created: '2025-10-01'
modified: '2025-10-01'
version: 1.0
tags: 'none'
questions:
  - question: "Are any internal assets communicating with known malicious Remote Access Software C2 infrastructure?"
    context: "This question aims to detect direct communication with adversary-controlled servers by comparing outbound network traffic (IP addresses, domains, and SSL/TLS Server Name Indication) against threat intelligence feeds of known malicious RAT C2 indicators. A direct match is a high-fidelity indicator of a potential compromise and warrants immediate investigation."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Zeek ssl.log"
      - "Network egress points (e.g., firewalls, proxies), DNS resolvers"
    range: "last 90 days"
    queries:
      - "SEARCH network_logs (conn, dns, ssl) WHERE destination_ip OR destination_domain OR server_name IN threat_intel_feed_of_rat_c2"
  - question: "Is an internal asset connecting to a domain that is typosquatting a legitimate remote access service?"
    context: "Adversaries often register domains that are visually similar to legitimate ones (e.g., 'anydesl.com' instead of 'anydesk.com') to trick users or evade simple blocklists. This question uses the Levenshtein distance algorithm to find such 'look-alike' domains in TLS traffic (SNI field), which can indicate an attempt to masquerade malicious infrastructure as a legitimate service."
    answer_sources:
      - "Zeek ssl.log"
      - "Network egress points (e.g., firewalls, proxies), DNS resolvers"
    range: "last 90 days"
    queries:
      - "FOR EACH outbound_tls_connection: CALCULATE levenshtein_distance(connection.sni, known_good_rat_domains). IF distance > 0 AND distance <= 2, ALERT."
  - question: "Are internal assets attempting to resolve domains that appear to be generated by a Domain Generation Algorithm (DGA)?"
    context: "Malware, including some RATs, uses Domain Generation Algorithms (DGAs) to create a large, rotating set of potential C2 domains, making it difficult for defenders to block them all. This question involves using a pre-trained machine learning model to analyze newly observed DNS queries and identify domains that have the linguistic characteristics of being algorithmically generated, which are highly suspicious."
    answer_sources:
      - "Zeek dns.log"
      - "Network egress points (e.g., firewalls, proxies), DNS resolvers"
    range: "last 90 days"
    queries:
      - "FOR EACH new_domain IN dns_logs: IF dga_detection_model(domain) > confidence_threshold, ALERT."
  - question: "Has a remote access tool been installed silently and configured for persistence as a service or via a registry run key?"
    context: "Adversaries often install RATs using silent or unattended flags to avoid user interaction and then immediately create a persistence mechanism (like a new Windows Service or a Registry Run key) to ensure the tool runs automatically on system startup. This question looks for this specific chain of events occurring on the same host within a short time frame (e.g., 5 minutes), which strongly indicates a malicious installation rather than legitimate administrative use."
    answer_sources:
      - "Windows Event ID 4688"
      - "Windows Event ID 7045"
      - "Windows Event ID 4657"
      - "Endpoint devices (workstations, servers), Domain Controllers (for Group Policy changes)"
    range: "last 90 days"
    queries:
      - "CORRELATE process_creation (event 4688, process=rat.exe, args='--silent') with service_creation (event 7045) OR registry_mod (event 4657) for same executable WITHIN 5 minutes ON same_host."
  - question: "Is an authorized remote access tool being executed in a statistically unusual manner?"
    context: "Even legitimate, authorized tools can be used maliciously ('living off the land'). This question aims to find this abuse by first establishing a baseline of normal usage patterns, such as common parent processes and command-line arguments. Executions that deviate significantly from this established norm, such as a RAT being launched by an uncommon parent process or with rare arguments (e.g., in the bottom 5th percentile of historical frequency), are flagged as anomalous and potentially malicious."
    answer_sources:
      - "Windows Event ID 4688"
      - "Endpoint devices (workstations, servers), Domain Controllers (for Group Policy changes)"
    range: "last 90 days"
    queries:
      - "BASELINE frequency of (parent_process, command_line) for each authorized_rat. ALERT IF current_execution_combination_frequency < 5th_percentile."
  - question: "Does a machine learning model classify a specific remote access tool execution event as malicious?"
    context: "This question leverages a supervised machine learning model (e.g., a Random Forest classifier) trained to distinguish between benign and malicious RAT executions. By analyzing a combination of features like the process name, parent process, command-line complexity (entropy), and the presence of suspicious keywords ('install', 'password'), the model can provide a confidence score for whether a given execution is malicious, helping to automate the detection of sophisticated abuse."
    answer_sources:
      - "Windows Event ID 4688"
      - "Endpoint devices (workstations, servers), Domain Controllers (for Group Policy changes)"
    range: "last 90 days"
    queries:
      - "FOR EACH rat_process_creation_event: SCORE event using classification_model. IF score > 0.90, ALERT."
  - question: "Has a remote access tool been launched from a suspicious parent process or an atypical file path?"
    context: "Legitimate remote access tools are typically launched by administrators or their tools from standard installation directories like 'Program Files'. Adversaries, however, often drop and run RATs from user-writable temporary locations (e.g., AppData, Temp) or as child processes of compromised applications like web browsers or Microsoft Office documents. This question creates a rule to detect these highly suspicious execution patterns."
    answer_sources:
      - "Windows Event ID 4688"
      - "Endpoint devices (workstations, servers)"
    range: "last 90 days"
    queries:
      - "SEARCH process_creation (event 4688) WHERE (child_process=rat.exe AND parent_process IN [office_apps, browsers, script_interpreters]) OR (child_process=rat.exe AND path NOT IN ['C:\\Program Files\\', 'C:\\Program Files (x86)\\'])."
  - question: "Is a remote access tool being executed by a statistically improbable parent process, or is it running from a file path with unusually high entropy?"
    context: "This question uses statistical analysis to find anomalies. It identifies RAT executions by parent processes that rarely, if ever, launch them, indicating a break in normal operational patterns. It also looks for high-entropy (random-looking) file paths in standard system directories, which is a common tactic for malware trying to hide its payload by giving it a randomized name within a trusted location."
    answer_sources:
      - "Windows Event ID 4688"
      - "Endpoint devices (workstations, servers)"
    range: "last 90 days"
    queries:
      - "CALCULATE parent-child_probabilities. ALERT IF P(rat.exe | parent_process) < 0.0001. CALCULATE shannon_entropy(file_path). ALERT IF path in system_dirs AND entropy > threshold."
  - question: "Can remote access tool executions be clustered into 'normal' and 'outlier' groups to identify suspicious activity?"
    context: "This question applies unsupervised machine learning (e.g., DBSCAN clustering) to group all remote access tool executions based on their characteristics (file path, parent process, command line). The assumption is that legitimate administrative use will form large, dense clusters, while malicious activity will appear as small, isolated outlier clusters. This helps analysts focus their attention on the most unusual and likely malicious events without prior labeling."
    answer_sources:
      - "Windows Event ID 4688"
      - "Endpoint devices (workstations, servers)"
    range: "last 90 days"
    queries:
      - "CLUSTER rat_execution_events using DBSCAN on features (path, parent, cmdline). INVESTIGATE events in outlier clusters."
  - question: "Is there network traffic on common remote access ports originating from a restricted network segment or exhibiting an unusually long duration?"
    context: "This question uses policy and duration-based rules to find suspicious RAT activity. It checks for traffic on default RAT ports (e.g., 5938 for TeamViewer) originating from network zones where it should not exist based on security policy (e.g., server VLANs). It also flags connections that are active for an exceptionally long time (e.g., over 48 hours), which can indicate a persistent C2 channel rather than a temporary administrative session."
    answer_sources:
      - "Zeek conn.log"
      - "Network egress points, internal network sensor grid (e.g., core switch SPAN ports)"
    range: "last 90 days"
    queries:
      - "SEARCH conn_logs WHERE port IN [5938, 6568] AND ((source_ip IN server_vlan) OR (duration > 48_hours))."
  - question: "Is any host sending an anomalous amount of data to a remote access service, or is the traffic pattern indicative of data exfiltration?"
    context: "Legitimate remote access is interactive and typically has a balanced ratio of data sent and received. Adversaries using RATs for data exfiltration will send far more data than they receive. This question establishes a 30-day baseline of normal traffic volume for each host and alerts on significant deviations (e.g., exceeding the 99th percentile) or highly asymmetric traffic ratios (e.g., 20:1 sent to received), both of which are strong indicators of data theft."
    answer_sources:
      - "Zeek conn.log"
      - "Network egress points, internal network sensor grid (e.g., core switch SPAN ports)"
    range: "last 90 days"
    queries:
      - "BASELINE outbound_bytes per host for 30 days. ALERT IF daily_outbound_bytes > 99th_percentile. ALERT IF (bytes_sent / bytes_received) > 20."
  - question: "Is there an anomalous spike in overall remote access tool activity across the enterprise, especially during non-business hours?"
    context: "This question takes a macro view by analyzing enterprise-wide RAT traffic patterns over time. A time-series model (e.g., ARIMA) learns the normal 'heartbeat' of business activity (e.g., high activity during the workday, low activity at night and on weekends/holidays). Alerts are generated for significant deviations from this learned rhythm, which could indicate a widespread, coordinated malicious campaign operating outside of normal business hours."
    answer_sources:
      - "Zeek conn.log"
      - "Network egress points, internal network sensor grid (e.g., core switch SPAN ports)"
    range: "last 90 days"
    queries:
      - "MODEL hourly RAT activity using ARIMA. ALERT IF current_activity is an anomaly based on the model, especially during off-hours."
  - question: "Has a common initial access sequence (e.g., Office macro to PowerShell) been observed, immediately followed by the download and execution of a remote access tool?"
    context: "This question aims to detect a classic adversary kill chain on an endpoint. It correlates events across different data sources (process logs, network logs) to identify a specific, high-confidence attack pattern: a user-facing application (like Word) launching a script interpreter (like PowerShell), which then makes a network connection to download a file, followed by the execution of a known RAT, all within a very short timeframe (e.g., 2 minutes)."
    answer_sources:
      - "Windows Event ID 4688"
      - "Zeek http.log"
      - "Zeek files.log"
      - "Endpoint devices (workstations, servers), Web proxy/gateway"
    range: "last 90 days"
    queries:
      - "CORRELATE (process1: office_app -> powershell) with (network: powershell downloads file) with (process2: rat.exe execution) ON same_host WITHIN 2 minutes."
  - question: "Has a remote access tool been launched by a script interpreter with a time delay that suggests automated execution rather than manual user interaction?"
    context: "Humans have a natural delay when typing commands in a shell. Automated scripts, however, execute commands almost instantaneously. This question analyzes the time delta between a script interpreter (like PowerShell) starting and it launching a child process (like a RAT). An extremely short delay (e.g., under 500 milliseconds) is a strong indicator that the action was scripted and automated, which is characteristic of malware execution."
    answer_sources:
      - "Windows Event ID 4688"
      - "Endpoint devices (workstations, servers), Web proxy/gateway"
    range: "last 90 days"
    queries:
      - "CALCULATE time_delta between parent (script) and child (rat) process creation. ALERT IF time_delta < 500ms."
  - question: "Does a sequence-based machine learning model classify a chain of process executions as a known malicious pattern involving a remote access tool?"
    context: "This question uses a more advanced sequence-aware model (like a Hidden Markov Model) to understand the 'story' of process executions. The model is trained to recognize entire chains of events that are characteristic of attacks. It can then flag real-time event streams that match a malicious sequence, such as the state transition from an Office App -> to a Scripting Engine -> to a Remote Access Tool, even if each individual step might seem benign in isolation."
    answer_sources:
      - "Windows Event ID 4688"
      - "Endpoint devices (workstations, servers), Web proxy/gateway"
    range: "last 90 days"
    queries:
      - "FEED process_event_stream into HMM. ALERT IF sequence probability for malicious_path (e.g., Office->Script->RAT) > threshold."