name: "T1544: Ingress Tool Transfer"
id: "d9e8f7a6-c5b4-4a39-b2d1-e0f8c7b6a5a4"
description: "This playbook is designed to detect adversarial attempts to transfer malicious tools or files onto managed mobile devices. It focuses on identifying suspicious file transfers by analyzing file attributes (MIME type, filename), source reputation (domain age, threat intelligence), and network protocol characteristics (self-signed certificates). It also aims to detect statistical outliers in data transfer volumes compared to historical baselines for individual devices and their peer groups, while filtering out legitimate high-volume services. The primary goal is to answer the question: Is an adversary transferring malicious tools or files onto our managed mobile devices?"
type: "technique"
related:
  - "TA0037: Command And Control"
contributors:
  - "Zachary Szewczyk"
  - "Ask Sage"
created: "2025-10-01"
modified: "2025-10-01"
version: 1.0
tags: "none"
questions:
  - question: "Are file transfers to mobile devices originating from known malicious droppers or C2 servers?"
    context: "This question aims to identify high-confidence threats by cross-referencing the source of file transfers (IP address and hostname) against threat intelligence feeds. A match indicates a known malicious actor is attempting to place a tool on a corporate mobile device, which warrants an immediate critical alert and response."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek files.log"
      - "Zeek http.log"
      - "Zeek dns.log"
      - "Zeek ssl.log"
      - "Zeek x509.log"
      - "Network egress points capturing traffic from corporate-managed mobile devices, including VPN concentrators, corporate Wi-Fi access point controllers, and Mobile Device Management (MDM) or Unified Endpoint Management (UEM) platform traffic logs."
    range: "last 90 days"
    queries:
      - "pseudocode: FOR each file_transfer in (files.log OR http.log) WHERE destination_ip is in mobile_ip_range: GET source_ip, source_hostname. CHECK if source_ip OR source_hostname in threat_intel_feed. IF match, ALERT."
  - question: "Can we identify potentially malicious file transfers to mobile devices by calculating a composite risk score based on file and network attributes?"
    context: "This question seeks to uncover unknown or novel threats by scoring file transfers based on suspicious characteristics. These include high-entropy filenames (suggesting randomization), new source domains (often used in campaigns), specific file types associated with mobile malware ('application/vnd.android.package-archive', 'application/x-mach-binary'), and the use of self-signed or invalid SSL certificates. A high composite score flags a transfer for manual investigation, even if the source is not on a known blocklist."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek files.log"
      - "Zeek http.log"
      - "Zeek dns.log"
      - "Zeek ssl.log"
      - "Zeek x509.log"
      - "Network egress points capturing traffic from corporate-managed mobile devices, including VPN concentrators, corporate Wi-Fi access point controllers, and Mobile Device Management (MDM) or Unified Endpoint Management (UEM) platform traffic logs."
    range: "last 90 days"
    queries:
      - "pseudocode: FOR each file_transfer in files.log WHERE destination_ip is in mobile_ip_range: CALCULATE risk_score = (w1 * entropy_score) + (w2 * domain_age_score) + (w3 * mime_type_score) + (w4 * cert_validity_score). IF risk_score > threshold, ALERT for investigation."
  - question: "Can we detect anomalous network connections associated with file transfers to mobile devices using an unsupervised machine learning model?"
    context: "This question focuses on detecting deviations from normal network behavior during file transfers. By training a model like an Isolation Forest on legitimate connection metadata (e.g., JA3/JA3S hashes, TLS versions, ciphers, data volumes), we can identify connections that are statistical outliers. These anomalies could represent attacker C2 channels or tool transfer methods designed to blend in but possess subtle, abnormal characteristics. Highlighting which features contributed to the anomaly score helps focus the analyst's investigation."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek files.log"
      - "Zeek http.log"
      - "Zeek dns.log"
      - "Zeek ssl.log"
      - "Zeek x509.log"
      - "Network egress points capturing traffic from corporate-managed mobile devices, including VPN concentrators, corporate Wi-Fi access point controllers, and Mobile Device Management (MDM) or Unified Endpoint Management (UEM) platform traffic logs."
    range: "last 90 days"
    queries:
      - "pseudocode: TRAIN anomaly_model on baseline_connection_logs. FOR each new_connection associated with a file_transfer: CALCULATE anomaly_score using model. IF score is high, ALERT with contributing_features."
  - question: "Are mobile devices receiving unusually large files from sources not on an approved allow-list?"
    context: "This question aims to catch blatant data ingress by setting a simple, static threshold for file sizes. By filtering out traffic to known, legitimate high-volume services (like app stores or corporate cloud storage), we can quickly identify large transfers from unexpected or unapproved sources. This serves as a coarse but effective filter for potential malicious tool or data exfiltration staging."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Network egress points capturing traffic from corporate-managed mobile devices, including VPN concentrators, corporate Wi-Fi access point controllers, and Mobile Device Management (MDM) or Unified Endpoint Management (UEM) platform traffic logs."
    range: "last 90 days"
    queries:
      - "pseudocode: DEFINE allow_list_domains. FOR each connection in conn.log WHERE destination_ip is in mobile_ip_range: IF response_bytes > 100MB AND destination_domain NOT IN allow_list_domains, ALERT."
  - question: "Is a mobile device's total daily download volume a statistical outlier compared to its own historical baseline?"
    context: "This question focuses on detecting anomalous behavior at the device level over a 24-hour period. By calculating a Z-score, we can statistically quantify how much a device's daily download activity deviates from its own 'normal.' A Z-score greater than 3 is a significant statistical event, suggesting a major change in the device's activity, such as the download of a large malicious payload, warranting a high-severity alert."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Network egress points capturing traffic from corporate-managed mobile devices, including VPN concentrators, corporate Wi-Fi access point controllers, and Mobile Device Management (MDM) or Unified Endpoint Management (UEM) platform traffic logs."
    range: "last 90 days"
    queries:
      - "pseudocode: FOR each mobile_device: CALCULATE mean and std_dev of daily_download_volume over last 30 days. CALCULATE Z_score for current_day_volume. IF Z_score > 3, ALERT."
  - question: "Can we predict and detect anomalous hourly download volumes for mobile devices using a time series forecasting model?"
    context: "This question applies a more sophisticated, model-based approach to anomaly detection by forecasting expected data volumes on an hourly basis. A time series model (like SARIMA or Prophet) learns the daily and weekly patterns of a device's network activity. When the actual observed download volume significantly exceeds the model's predicted upper bound, it signals a strong anomaly that cannot be explained by normal user behavior patterns. This method is effective at catching spikes in activity that might be missed by daily averages."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Network egress points capturing traffic from corporate-managed mobile devices, including VPN concentrators, corporate Wi-Fi access point controllers, and Mobile Device Management (MDM) or Unified Endpoint Management (UEM) platform traffic logs."
    range: "last 90 days"
    queries:
      - "pseudocode: FOR each mobile_device: TRAIN time_series_model on 90-day history of hourly_download_volume. FORECAST expected volume for current_hour. IF actual_volume > prediction_interval_upper_bound, ALERT with details."