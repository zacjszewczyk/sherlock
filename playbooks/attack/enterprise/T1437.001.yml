name: T1437.001: Web Protocols
id: 6f4b8f8c-4a3d-4e2b-9c1a-0b9e8d7c6f5a
description: |
  This playbook helps answer the primary investigative requirement: "Is an adversary using web protocols for command and control on corporate mobile devices?". It focuses on identifying anomalous web traffic and TLS sessions from managed mobile devices that could indicate C2 activity. Key indicators include periodic 'heartbeat' connections, communication with low-reputation domains, use of rare User-Agent strings, high-entropy URIs, asymmetric data transfer ratios, and unusually long or short connection durations. The playbook also investigates TLS sessions for malicious JA3/JA3S fingerprints, statistically rare client fingerprints, and connections to servers with suspicious certificates (self-signed or newly created).
type: technique
related:
  - TA0037: Command And Control
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags:
  - none
questions:
  - question: Are mobile devices communicating with known command and control (C2) servers based on FQDN or IP address matches from threat intelligence?
    context: |
      This question aims to identify high-confidence indicators of compromise by checking if any network traffic from managed mobile devices is directed to destinations (domains or IPs) that are already listed on threat intelligence feeds as known C2 infrastructure. A direct match is a strong signal of malicious activity requiring immediate attention.
    answer_sources: |
      Data Sources: Zeek conn.log, Zeek http.log, Zeek dns.log
      NAI: Corporate Wi-Fi network egress points, VPN concentrators, Mobile Device Management (MDM) gateways, forward/reverse proxies, and central DNS resolvers that process traffic from managed mobile device subnets or enrolled devices.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          SEARCH Zeek dns.log and http.log FOR destination_fqdn OR destination_ip IN threat_intel_c2_feed WHERE source_subnet IN mobile_device_subnets
  - question: Is there evidence of statistical anomalies in mobile device web traffic, such as C2 beaconing, asymmetric data transfers, or high-entropy URIs?
    context: |
      This question seeks to uncover covert C2 communication by analyzing traffic patterns for statistical irregularities. Adversaries often use periodic "heartbeat" connections (beaconing), exfiltrate data in small chunks (asymmetric data ratio), or obfuscate commands in URLs (high entropy). Identifying multiple such anomalies in a single session strengthens the likelihood of it being malicious.
    answer_sources: |
      Data Sources: Zeek conn.log, Zeek http.log
      NAI: Corporate Wi-Fi network egress points, VPN concentrators, Mobile Device Management (MDM) gateways, forward/reverse proxies, and central DNS resolvers that process traffic from managed mobile device subnets or enrolled devices.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each mobile_device_ip: CALCULATE stddev of connection inter-arrival_times per destination; CALCULATE data transfer ratio; CALCULATE Shannon entropy of URI. ALERT if multiple anomalies are detected for a session.
  - question: Can machine learning models detect anomalous network sessions or data volume spikes from mobile devices that deviate from established baselines?
    context: |
      This question leverages machine learning to identify complex and subtle C2 patterns that rule-based methods might miss. An unsupervised model (like Isolation Forest) can score sessions based on multiple features to find outliers, while a time-series forecast can detect unusual spikes in data exfiltration, providing a more sophisticated and adaptive detection capability.
    answer_sources: |
      Data Sources: Zeek conn.log, Zeek http.log, Zeek ssl.log
      NAI: Corporate Wi-Fi network egress points, VPN concentrators, Mobile Device Management (MDM) gateways, forward/reverse proxies, and central DNS resolvers that process traffic from managed mobile device subnets or enrolled devices.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          TRAIN Isolation Forest model on baseline Zeek log features. SCORE new sessions for anomaly score. TRAIN ARIMA model on per-device outbound data volume. ALERT on sessions with high anomaly scores or when volume exceeds predicted confidence interval.
  - question: Are mobile devices initiating or receiving TLS connections that use fingerprints (JA3/JA3S) associated with known malicious tools?
    context: |
      This question focuses on identifying malicious software by its unique TLS handshake "fingerprint" (JA3 for the client, JA3S for the server). Since specific malware or C2 tools often use a consistent set of TLS parameters, matching these fingerprints against a threat intelligence feed provides a high-fidelity method for detecting their presence on the network.
    answer_sources: |
      Data Sources: Zeek ssl.log
      NAI: Network sensors at key chokepoints with visibility into traffic from managed mobile devices, including corporate Wi-Fi egress points, VPN concentrators, Mobile Device Management (MDM) gateways, and forward proxies capable of inspecting TLS handshakes to generate Zeek log data.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          SEARCH Zeek ssl.log FOR ja3 OR ja3s IN threat_intel_tls_fingerprint_feed WHERE source_subnet IN mobile_device_subnets. ALERT on match.
  - question: Are mobile devices using rare or unapproved TLS client applications, especially when connecting to servers with suspicious certificates?
    context: |
      This question helps uncover previously unknown or custom C2 tools by focusing on statistical rarity. A JA3 hash that is uncommon in the environment and not tied to a known, approved application is suspicious. This suspicion is amplified if the connection is made to a server using a newly-issued or self-signed certificate, which are common tactics for adversary infrastructure.
    answer_sources: |
      Data Sources: Zeek ssl.log, Zeek x509.log
      NAI: Network sensors at key chokepoints with visibility into traffic from managed mobile devices, including corporate Wi-Fi egress points, VPN concentrators, Mobile Device Management (MDM) gateways, and forward proxies capable of inspecting TLS handshakes to generate Zeek log data.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          CALCULATE frequency of all ja3 hashes. FOR new sessions from mobile devices: IF ja3 is not in allowlist AND frequency < 1st percentile, CHECK associated x509 certificate for self-signed status or recent creation date. ALERT on match.
  - question: Can a supervised machine learning model proactively classify TLS sessions from mobile devices as malicious based on their handshake characteristics?
    context: |
      This question proposes a proactive, predictive approach to threat detection. By training a model on the granular details of the TLS handshake (like cipher suites and extensions) from both known-good and known-bad examples, it can learn to classify new, unseen traffic. This allows for the detection of C2 channels that share characteristics with known malware families, even if their specific JA3 hash is not yet on a threat feed.
    answer_sources: |
      Data Sources: Zeek ssl.log, Zeek conn.log
      NAI: Network sensors at key chokepoints with visibility into traffic from managed mobile devices, including corporate Wi-Fi egress points, VPN concentrators, Mobile Device Management (MDM) gateways, and forward proxies capable of inspecting TLS handshakes to generate Zeek log data.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          TRAIN Random Forest model on labeled TLS handshake features (cipher suites, extensions, etc.). DEPLOY model to score new mobile device sessions. ALERT if malicious probability score > 0.90.