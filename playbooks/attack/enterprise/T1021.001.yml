name: T1021.001: Remote Desktop Protocol
id: 0c8e3a2b-9c7d-4b1f-8e6a-1d2c3b4a5e6f
description: This playbook helps determine if an adversary has moved laterally within the network using Remote Desktop Protocol (RDP). It provides investigative steps to detect RDP activity originating from known malicious IPs or user accounts, identify when RDP is suspiciously enabled on a host and then immediately used, find instances of a single source connecting to an anomalous number of destinations, flag connections that are new or violate network segmentation policies, and discover suspicious follow-on activity such as reconnaissance commands executed after a successful RDP logon.
type: technique
related:
  - TA0008: Lateral Movement
contributors:
  - Zachary Szewczyk
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Has a successful RDP authentication originated from a source IP or user account on a known threat watchlist?
    context: This question focuses on identifying high-confidence threats by correlating RDP login events with curated threat intelligence. A match indicates that a known malicious actor or compromised account is attempting to move laterally, requiring immediate attention.
    answer_sources:
      - Windows Event ID 4624
      - Zeek rdp.log
      - Zeek conn.log
      - Domain Controllers
      - Critical Application Servers
      - Threat Intelligence Feeds
      - VPN Concentrators
    range: Last 90 days
    queries:
      - pseudocode: SEARCH RDP_success_logs WHERE (source_ip IN threat_intel_ips OR username IN threat_intel_users)
  - question: Is a successful RDP connection from a watchlisted entity statistically anomalous compared to the target host's typical inbound RDP activity?
    context: This question helps prioritize alerts by adding behavioral analysis. It seeks to distinguish between a potentially false-positive watchlist hit and a genuinely suspicious connection by checking if the source IP's connection pattern to the specific destination is novel or deviates significantly from its established baseline.
    answer_sources:
      - Windows Event ID 4624
      - Zeek rdp.log
      - Zeek conn.log
      - Domain Controllers
      - Critical Application Servers
      - Threat Intelligence Feeds
      - VPN Concentrators
    range: Last 90 days
    queries:
      - pseudocode: FOREACH alert from_watchlist_logon GET historical_RDP_connections_to_target_host | CALCULATE frequency_of_alerting_source_ip | IF frequency is_outlier THEN elevate_priority
  - question: Can a machine learning model, trained on historical data, predict the likelihood that an RDP session from a watchlisted entity is malicious?
    context: This question aims to automate the prioritization of suspicious RDP sessions. By training a model on features like IP subnet, user role, and time of day, it can provide a probabilistic score of maliciousness for new connections, allowing analysts to focus on the highest-risk events first.
    answer_sources:
      - Windows Event ID 4624
      - Zeek rdp.log
      - Zeek conn.log
      - Domain Controllers
      - Critical Application Servers
      - Threat Intelligence Feeds
      - VPN Concentrators
    range: Last 90 days
    queries:
      - pseudocode: PREDICT malicious_probability USING ML_model ON new_RDP_session_features
  - question: Has a host been configured to allow RDP (via registry or firewall change) and then immediately initiated an outbound RDP connection?
    context: This question identifies a common adversary tactic where they enable RDP on a compromised machine to establish a foothold or pivot. The close succession of enabling RDP and then using it is a strong indicator of malicious activity, as legitimate changes are rarely followed immediately by usage in this manner.
    answer_sources:
      - Windows Event ID 4657
      - Windows Event ID 4688
      - Zeek conn.log
      - Windows Security Event ID 4947
      - User Endpoints
      - Workstations
      - Servers not typically configured for RDP access
    range: Last 90 days
    queries:
      - pseudocode: SEARCH (registry_RDP_enable OR firewall_RDP_allow) AND outbound_RDP_connection FROM same_host WITHIN 10_minutes
  - question: Was the process that enabled RDP initiated by a command line with high entropy, suggesting obfuscation?
    context: This question adds context to alerts about RDP being enabled. High entropy in the parent process's command line (e.g., PowerShell) suggests that the command was obfuscated, a technique frequently used by attackers to hide their actions from simple signature-based detection.
    answer_sources:
      - Windows Event ID 4657
      - Windows Event ID 4688
      - Zeek conn.log
      - Windows Security Event ID 4947
      - User Endpoints
      - Workstations
      - Servers not typically configured for RDP access
    range: Last 90 days
    queries:
      - pseudocode: FOREACH alert from_RDP_enable_and_connect GET parent_process_command_line | CALCULATE Shannon_entropy | IF entropy > threshold THEN increase_suspicion
  - question: Does the sequence of events 'Enable RDP -> Execute Process -> Outbound RDP Connection' represent a statistically rare anomaly compared to normal administrative activity on the host?
    context: This question uses advanced sequence analysis to detect malicious patterns. By modeling legitimate administrative workflows, the playbook can identify when a sequence of actions, even if individually benign, constitutes a rare and suspicious pattern indicative of an attack.
    answer_sources:
      - Windows Event ID 4657
      - Windows Event ID 4688
      - Zeek conn.log
      - Windows Security Event ID 4947
      - User Endpoints
      - Workstations
      - Servers not typically configured for RDP access
    range: Last 90 days
    queries:
      - pseudocode: ANALYZE event_sequence on_host | IF sequence matches 'enable_RDP->execute->outbound_RDP' AND is_anomaly THEN alert
  - question: Has a single source IP or user account connected via RDP to an unusually high number of unique hosts within a short time frame?
    context: This question is designed to detect RDP-based scanning or rapid lateral movement. An attacker who has compromised an account or system may try to connect to many different hosts to find their next target. This behavior is distinct from normal user activity, which is typically limited to a small number of machines.
    answer_sources:
      - Windows Event ID 4624
      - Zeek rdp.log
      - Zeek conn.log
      - Internal network segments
      - Core Switches
      - Domain Controller security logs
    range: Last 90 days
    queries:
      - pseudocode: GROUPBY source_ip, username OVER 1_hour | COUNT distinct destination_ip | IF count > 5 THEN alert
  - question: Is the number of unique RDP destinations for a specific user or IP address significantly higher than their own established historical baseline?
    context: This question refines fan-out detection by personalizing it. Instead of a single static threshold, it compares a user's or IP's current activity to their own past behavior. An alert is triggered only if the activity is abnormal for that specific entity, reducing false positives from legitimate power users.
    answer_sources:
      - Windows Event ID 4624
      - Zeek rdp.log
      - Zeek conn.log
      - Internal network segments
      - Core Switches
      - Domain Controller security logs
    range: Last 90 days
    queries:
      - pseudocode: FOREACH user, source_ip GET current_hourly_unique_RDP_dest_count | COMPARE to historical_99th_percentile | IF current > historical THEN alert
  - question: Can anomalous RDP fan-out behavior be identified as noise points using a density-based clustering algorithm?
    context: This question leverages unsupervised machine learning to find outliers without pre-defined rules. By clustering normal RDP connection patterns, an algorithm like DBSCAN can automatically identify sporadic, non-clustered connection attempts (noise) that represent anomalous fan-out activity.
    answer_sources:
      - Windows Event ID 4624
      - Zeek rdp.log
      - Zeek conn.log
      - Internal network segments
      - Core Switches
      - Domain Controller security logs
    range: Last 90 days
    queries:
      - pseudocode: APPLY DBSCAN to RDP_connection_logs | IDENTIFY noise_points as anomalous_fan_out
  - question: Has an RDP connection occurred that violates established network segmentation policies (e.g., user VLAN to database VLAN)?
    context: This question checks for clear policy violations. By enriching network data with asset roles and locations, it's possible to create high-fidelity alerts for RDP connections that should never happen, such as a workstation connecting directly to a production database server.
    answer_sources:
      - Zeek conn.log
      - Zeek rdp.log
      - Windows Event ID 4624
      - Network Firewalls
      - VLAN access control lists (ACLs)
      - Core Switches
      - Server and Endpoint logs
    range: Last 90 days
    queries:
      - pseudocode: SEARCH RDP_connections WHERE source_segment NOT_IN allowed_segments_for_destination_segment
  - question: Has an RDP connection been established between a source and destination pair that have never communicated via RDP before?
    context: This question focuses on identifying novel lateral movement paths. Attackers often create new connections as they explore a network. By tracking all historical RDP connections, any 'first-time' connection can be flagged for review, with special priority given to those involving high-value assets.
    answer_sources:
      - Zeek conn.log
      - Zeek rdp.log
      - Windows Event ID 4624
      - Network Firewalls
      - VLAN access control lists (ACLs)
      - Core Switches
      - Server and Endpoint logs
    range: Last 90 days
    queries:
      - pseudocode: FOREACH new_RDP_connection CHECK IF (source_ip, dest_ip) exists_in_90day_baseline | IF NOT exists THEN alert
  - question: Does a new RDP connection bridge two previously disconnected communities of hosts in the network graph?
    context: This question uses graph analytics to detect anomalous lateral movement. By modeling the network as a graph of RDP relationships, it can identify distinct clusters or 'communities.' A new connection that links two separate communities is a strong indicator of an adversary moving between different zones of the network.
    answer_sources:
      - Zeek conn.log
      - Zeek rdp.log
      - Windows Event ID 4624
      - Network Firewalls
      - VLAN access control lists (ACLs)
      - Core Switches
      - Server and Endpoint logs
    range: Last 90 days
    queries:
      - pseudocode: ADD new_RDP_connection as_edge_to_network_graph | RUN community_detection | IF new_edge connects_two_different_communities THEN alert
  - question: Following a successful RDP login, were any suspicious reconnaissance, credential dumping, or lateral movement commands executed within that logon session?
    context: This question looks for malicious activity immediately following a successful RDP connection. By linking the logon session to subsequent process creations, it can detect common attacker behaviors like running `whoami` or `net user` to gather information or using tools like `mimikatz`.
    answer_sources:
      - Windows Event ID 4624
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - Zeek conn.log
      - Zeek dns.log
      - Domain Controllers
      - Critical Servers
      - Privileged Access Workstations
      - DNS Servers
      - Endpoint Process Logs
    range: Last 90 days
    queries:
      - pseudocode: SEARCH RDP_logon_event | GET logon_id | SEARCH process_creation_events with same_logon_id WHERE command_line MATCHES suspicious_strings
  - question: Did the RDP session execute processes or command-line arguments that are statistically rare or have unusually high entropy compared to an enterprise-wide baseline?
    context: This question aims to find outliers in post-RDP activity. Attackers often use custom tools or obfuscated commands that are rare. By comparing commands run in a session to a baseline of normal activity, this method can flag sessions that deviate from the norm, even if the commands are not on a known-bad signature list.
    answer_sources:
      - Windows Event ID 4624
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - Zeek conn.log
      - Zeek dns.log
      - Domain Controllers
      - Critical Servers
      - Privileged Access Workstations
      - DNS Servers
      - Endpoint Process Logs
    range: Last 90 days
    queries:
      - pseudocode: FOREACH RDP_session GET child_processes_and_commands | IF process_is_rare OR command_entropy_is_high THEN flag_session
  - question: Can a machine learning model, using features from the entire session, assign a risk score to an RDP session to prioritize it for investigation?
    context: This question proposes a holistic, ML-based approach to scoring RDP sessions. By combining multiple features (command counts, rare processes, network traffic), a model can provide a comprehensive risk score, allowing analysts to triage and focus on the sessions most likely to be malicious.
    answer_sources:
      - Windows Event ID 4624
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - Zeek conn.log
      - Zeek dns.log
      - Domain Controllers
      - Critical Servers
      - Privileged Access Workstations
      - DNS Servers
      - Endpoint Process Logs
    range: Last 90 days
    queries:
      - pseudocode: EXTRACT features_from_RDP_session | USE ML_model to_predict_malicious_probability