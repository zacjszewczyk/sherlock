name: 'T1589.002: Email Addresses'
id: 'a7b1c1d8-4e3f-4e12-8f2c-5a9b8d7e6f5a'
description: 'This playbook helps to determine if an adversary is actively gathering email addresses from the organization for targeting purposes. It focuses on identifying external reconnaissance activity by detecting anomalously high connection rates from threat-listed IPs, the use of automated harvesting tools identified by their User-Agent strings, statistically significant deviations in authentication failure rates indicative of password spraying, and web scraping behavior characterized by high request rates and systematic URI traversal. It also correlates these reconnaissance events with subsequent targeted authentication attacks against specific user groups.'
type: 'technique'
related:
  - 'TA0043: Reconnaissance'
contributors:
  - 'Zachary Szewczyk'
  - 'Ask Sage'
created: '2025-10-01'
modified: '2025-10-01'
version: 1.0
tags: 'none'
questions:
  - question: "Is a known malicious IP address from a high-confidence threat feed attempting to connect to our network?"
    context: "This question aims to identify direct connection attempts from actors already flagged for malicious activities. Correlating network connection logs with high-confidence threat intelligence feeds provides an early warning of targeted reconnaissance by known adversaries, allowing for immediate blocking and investigation."
    answer_sources:
      - 'Zeek conn.log'
      - 'Zeek http.log'
      - 'Threat Intelligence Feed'
      - 'Internet gateway, network DMZ, public-facing web servers, external-facing authentication services (e.g., M365, VPN concentrators).'
    range: 'last 90 days'
    queries:
      - search_technology: 'pseudocode'
        query: 'SEARCH Zeek conn.logs WHERE source_ip IN (High_Confidence_Threat_Feed) | ALERT'
  - question: "Is an IP from a lower-confidence threat feed connecting to our services at an anomalous rate?"
    context: "This helps detect suspicious activity from sources that are not confirmed malicious but exhibit unusual behavior, such as using generic VPNs. By establishing a baseline for connection frequency and alerting on significant deviations (e.g., exceeding the 99th percentile), we can uncover potential reconnaissance hidden among legitimate traffic."
    answer_sources:
      - 'Zeek conn.log'
      - 'Zeek http.log'
      - 'Threat Intelligence Feed'
      - 'Internet gateway, network DMZ, public-facing web servers, external-facing authentication services (e.g., M365, VPN concentrators).'
    range: 'last 90 days'
    queries:
      - search_technology: 'pseudocode'
        query: 'SEARCH Zeek conn.logs WHERE source_ip IN (Low_Confidence_Feed) | STATS count by source_ip, destination_port over 10m | WHERE count > 99th_percentile_baseline | ALERT'
  - question: "Is the overall volume of connections from known anonymizing services significantly higher than predicted seasonal norms?"
    context: "Adversaries often use anonymizing services (like TOR) to hide their tracks. A time-series model can predict expected traffic volumes from these services. A sudden spike above the predicted range can indicate a coordinated, large-scale reconnaissance effort that individual statistical alerts might miss."
    answer_sources:
      - 'Zeek conn.log'
      - 'Zeek http.log'
      - 'Threat Intelligence Feed'
      - 'Internet gateway, network DMZ, public-facing web servers, external-facing authentication services (e.g., M365, VPN concentrators).'
    range: 'last 90 days'
    queries:
      - search_technology: 'pseudocode'
        query: 'COMPARE current_connection_volume_from_anonymizers TO time_series_prediction_model | IF volume > 95%_prediction_interval | ALERT'
  - question: "Are there any HTTP requests to our public web services using User-Agents associated with known email harvesting or reconnaissance tools?"
    context: "Adversaries use automated tools like 'theHarvester' or 'Recon-ng' to scrape websites for email addresses. These tools often have unique User-Agent strings. Searching for these specific signatures in web server logs is a direct way to detect the use of such tools against our infrastructure."
    answer_sources:
      - 'Zeek http.log'
      - 'Zeek weird.log'
      - "Public-facing web servers (e.g., company 'About Us' or 'Contact' pages), SharePoint sites, and web application frontends."
    range: 'last 90 days'
    queries:
      - search_technology: 'pseudocode'
        query: 'SEARCH Zeek http.logs WHERE user_agent MATCHES (regex_for_recon_tools) | ALERT'
  - question: "Is any single IP address browsing our web services with an unusually high request rate and very low URI randomness, suggesting automated directory enumeration?"
    context: "Human users browse websites in a somewhat random pattern. Automated bots often traverse directories sequentially (e.g., /users/1, /users/2). This leads to a high request rate and very low randomness (entropy) in the requested URIs. Detecting this combination helps identify automated scraping attempts that might use generic User-Agents."
    answer_sources:
      - 'Zeek http.log'
      - 'Zeek weird.log'
      - "Public-facing web servers (e.g., company 'About Us' or 'Contact' pages), SharePoint sites, and web application frontends."
    range: 'last 90 days'
    queries:
      - search_technology: 'pseudocode'
        query: 'FOR each source_ip | CALCULATE shannon_entropy(uri) and request_rate over 5m | IF entropy < 1.0 AND request_rate > 30/min | ALERT'
  - question: "Are machine learning models classifying any HTTP requests as 'automated' or 'scraping' with high confidence?"
    context: "A sophisticated approach is to use a machine learning model trained on various request features (headers, URI structure, etc.) to distinguish between human and bot traffic. This can catch novel or customized scraping tools that signature-based or simple statistical methods might miss."
    answer_sources:
      - 'Zeek http.log'
      - 'Zeek weird.log'
      - "Public-facing web servers (e.g., company 'About Us' or 'Contact' pages), SharePoint sites, and web application frontends."
    range: 'last 90 days'
    queries:
      - search_technology: 'pseudocode'
        query: 'FOR each http_request | SCORE with classification_model | IF score > 0.9 AND classification is "automated" | ALERT'
  - question: "Has a single external IP address generated a high number of failed logons across multiple user accounts in a short time frame?"
    context: "This is a classic indicator of a password spraying attack, where an adversary tries a few common passwords against many different usernames. Setting a clear threshold (e.g., >10 failures for >5 users in 1 minute) provides a high-fidelity alert for this specific reconnaissance and initial access technique."
    answer_sources:
      - 'Windows Event ID 4625'
      - 'Windows Event ID 4624'
      - 'Zeek conn.log'
      - 'Domain Controllers, Active Directory Federation Services (ADFS) servers, Remote Desktop Gateway servers, VPN concentrators, Microsoft 365 / Entra ID tenant.'
    range: 'last 90 days'
    queries:
      - search_technology: 'pseudocode'
        query: 'SEARCH auth_logs for failed_logons from external_ips | STATS distinct_count(user) by source_ip over 1m | IF distinct_count(user) > 5 AND count(failures) > 10 | ALERT'
  - question: "Is any external IP address exhibiting a ratio of failed-to-successful logins that is statistically anomalous compared to the established baseline?"
    context: "Legitimate users occasionally fail to log in, but their failure ratio is typically low. An adversary guessing passwords will have a much higher ratio. By baselining normal behavior and alerting on significant statistical deviations (e.g., 3 standard deviations above the mean), we can detect password spraying or guessing attacks that may not trigger a simple threshold rule."
    answer_sources:
      - 'Windows Event ID 4625'
      - 'Windows Event ID 4624'
      - 'Zeek conn.log'
      - 'Domain Controllers, Active Directory Federation Services (ADFS) servers, Remote Desktop Gateway servers, VPN concentrators, Microsoft 365 / Entra ID tenant.'
    range: 'last 90 days'
    queries:
      - search_technology: 'pseudocode'
        query: 'FOR each external_source_ip | CALCULATE ratio(failed_logons / total_logons) over 15m | IF ratio > (baseline_ratio + 3 * std_dev) AND distinct_target_accounts > 3 | ALERT'
  - question: "Has an unsupervised machine learning model detected an anomalous cluster of authentication activity indicative of credential enumeration or password spraying?"
    context: "Unsupervised learning models like Isolation Forest or DBSCAN can analyze multiple features of authentication behavior (source IP, user count, timing between attempts) simultaneously. These models excel at finding novel or complex attack patterns that do not fit predefined rules or statistical thresholds, identifying outliers that represent probable attacks."
    answer_sources:
      - 'Windows Event ID 4625'
      - 'Windows Event ID 4624'
      - 'Zeek conn.log'
      - 'Domain Controllers, Active Directory Federation Services (ADFS) servers, Remote Desktop Gateway servers, VPN concentrators, Microsoft 365 / Entra ID tenant.'
    range: 'last 90 days'
    queries:
      - search_technology: 'pseudocode'
        query: 'PROCESS auth_logs through unsupervised_clustering_model | IF an anomalous_cluster is identified | ALERT'
  - question: "Has a single external IP rapidly requested a large number of pages from directories known to contain employee or contact information?"
    context: "Adversaries looking for email addresses will often target specific sections of a website, such as staff directories or contact pages. A simple rule that alerts when an IP accesses an unusually high number of these specific pages in a short time is a direct indicator of targeted information gathering."
    answer_sources:
      - 'Zeek http.log'
      - 'Zeek conn.log'
      - 'Zeek files.log'
      - 'Public-facing websites, especially those with employee directories, contact lists, or profile pages.'
    range: 'last 90 days'
    queries:
      - search_technology: 'pseudocode'
        query: "SEARCH Zeek http.logs for external_ips WHERE uri contains ('/profile/', '/staff/') | STATS count by source_ip over 5m | IF count > 100 | ALERT"
  - question: "Is any IP session exhibiting behavior that exceeds normal user baselines for requests-per-minute and pages-viewed, while also showing signs of sequential URI traversal?"
    context: "This combines two statistical methods. First, it identifies sessions that are abnormally active compared to typical users. Second, it checks for programmatic browsing patterns by measuring the 'distance' or difference between consecutive URLs requested. A low distance (e.g., changing a number in the URL) is a strong sign of automated enumeration, not human browsing."
    answer_sources:
      - 'Zeek http.log'
      - 'Zeek conn.log'
      - 'Zeek files.log'
      - 'Public-facing websites, especially those with employee directories, contact lists, or profile pages.'
    range: 'last 90 days'
    queries:
      - search_technology: 'pseudocode'
        query: 'FOR each ip_session | CALCULATE requests_per_minute, pages_viewed, levenshtein_distance_of_uris | IF (requests_per_minute > baseline AND pages_viewed > baseline) AND avg_levenshtein_distance is low | ALERT'
  - question: "Has a session-based machine learning classifier identified any traffic sessions as 'malicious bot' or 'scraper'?"
    context: "By analyzing entire user sessions, a machine learning model can learn the subtle, holistic differences between human and bot behavior. It considers features like request frequency, URI patterns, and time-of-day to make a classification. This is effective at detecting sophisticated bots designed to mimic human behavior."
    answer_sources:
      - 'Zeek http.log'
      - 'Zeek conn.log'
      - 'Zeek files.log'
      - 'Public-facing websites, especially those with employee directories, contact lists, or profile pages.'
    range: 'last 90 days'
    queries:
      - search_technology: 'pseudocode'
        query: 'PROCESS http_sessions through session_classifier_model | IF session classified as "malicious bot" | ALERT'
  - question: "Following a reconnaissance alert, did the same source IP begin attempting to authenticate to any of our services?"
    context: "This question directly links reconnaissance activity to subsequent initial access attempts. If an IP that was just caught scraping the website starts trying to log in, it is a strong indicator that the gathered information is being actively used. This correlation dramatically increases the confidence that a real attack is underway."
    answer_sources:
      - 'Windows Event ID 4625'
      - 'Windows Event ID 4624'
      - 'Zeek conn.log'
      - 'HR Information System Data'
      - 'Domain Controllers, ADFS servers, VPN concentrators, and SIEM correlation environment.'
    range: 'last 90 days'
    queries:
      - search_technology: 'pseudocode'
        query: 'IF recon_alert for source_ip | THEN monitor auth_logs for source_ip for 72h | IF any auth_failure from source_ip | ESCALATE ALERT'
  - question: "Is there a statistically significant spike in failed login attempts for a specific department or user group?"
    context: "Adversaries may target a specific department (e.g., Finance, Engineering) after identifying its members. By enriching authentication logs with HR data, we can monitor login failures on a per-department basis. A sudden spike for one group, compared to its own baseline, can reveal a highly targeted password spray attack."
    answer_sources:
      - 'Windows Event ID 4625'
      - 'Windows Event ID 4624'
      - 'Zeek conn.log'
      - 'HR Information System Data'
      - 'Domain Controllers, ADFS servers, VPN concentrators, and SIEM correlation environment.'
    range: 'last 90 days'
    queries:
      - search_technology: 'pseudocode'
        query: 'JOIN auth_logs with HR_data by user | GROUP by department | CALCULATE failed_logon_count over 1h | IF count > (30day_moving_avg + 3 * std_dev) | ALERT'
  - question: "Has a graph-based analysis of authentication logs revealed a dense cluster of failed logins from a few IPs against a related group of users?"
    context: "Graph analysis can uncover relationships that are difficult to see with other methods. By modeling users and IPs as nodes and failed logins as edges, a dense cluster immediately visualizes an attack pattern: one or more attackers (IPs) targeting a community of victims (users). Cross-referencing this user community with HR data can confirm if they belong to the same team or department."
    answer_sources:
      - 'Windows Event ID 4625'
      - 'Windows Event ID 4624'
      - 'Zeek conn.log'
      - 'HR Information System Data'
      - 'Domain Controllers, ADFS servers, VPN concentrators, and SIEM correlation environment.'
    range: 'last 90 days'
    queries:
      - search_technology: 'pseudocode'
        query: 'CREATE graph from auth_logs (nodes=users,ips; edges=failed_logins) | RUN community_detection_algorithm | IF dense_cluster is found | ALERT'