name: T1567: Exfiltration Over Web Service
id: a8c9b0d1-f2e3-4a5b-8c9d-0e1f2a3b4c5d
description: This playbook helps identify if an adversary has exfiltrated data using legitimate external web services. The investigation focuses on detecting anomalies in network traffic that suggest covert data transfer, such as connections to known malicious domains, the use of non-standard tools for data transfer, unusually large outbound data volumes compared to inbound, network connections originating from processes that are not approved web browsers, machine-like periodic network connections indicative of beaconing, and outbound data payloads with high entropy suggesting encryption or compression.
type: technique
related:
  - TA0010: Exfiltration
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Is any outbound network traffic directed to destination IPs, domains, or host headers that match known malicious indicators from a threat intelligence feed?
    context: Adversaries often use known malicious infrastructure for command and control or data exfiltration. Continuously correlating network logs (IPs, DNS requests, SNI/Host headers) against a real-time threat intelligence feed is a fundamental detection method. A match provides a high-confidence signal of malicious activity that requires immediate investigation.
    answer_sources:
      - Zeek conn.log
      - Zeek http.log
      - Zeek ssl.log
      - Zeek dns.log
      - Internet Gateway Firewalls
      - DNS Resolvers
      - Web Proxies
      - Network Security Monitoring Sensors
    range: last 90 days
    queries:
      - symbolic: SEARCH network logs (Zeek conn, dns, http, ssl) FOR connections WHERE destination_ip OR requested_domain OR server_name IN threat_intelligence_feed; ALERT on match.
  - question: Are there newly observed domains being accessed by a very small percentage of internal hosts, suggesting targeted or non-widespread activity?
    context: Legitimate web services are typically accessed by a broad user base. When a new, unknown domain is only visited by one or a few hosts within a 24-hour period, it can be an indicator of targeted malicious activity, such as a connection to a newly stood-up exfiltration point. This statistical approach helps find unknown threats not yet present in CTI feeds.
    answer_sources:
      - Zeek conn.log
      - Zeek http.log
      - Zeek ssl.log
      - Zeek dns.log
      - Internet Gateway Firewalls
      - DNS Resolvers
      - Web Proxies
      - Network Security Monitoring Sensors
    range: last 90 days
    queries:
      - statistical: For each new_domain, CALCULATE prevalence = (distinct_source_hosts / total_internal_hosts) over 24h. FLAG domain for review if prevalence < 1%.
  - question: Are internal hosts attempting to resolve domains that are algorithmically generated (DGA) or have a very low reputation score?
    context: Malware often uses Domain Generation Algorithms (DGA) to create a large number of potential command and control domains, making blocklisting difficult. Machine learning models can be trained to recognize the patterns of DGAs or to calculate a reputation score based on features like domain age and registrar. Detecting such domains can preemptively identify compromised hosts.
    answer_sources:
      - Zeek conn.log
      - Zeek http.log
      - Zeek ssl.log
      - Zeek dns.log
      - Internet Gateway Firewalls
      - DNS Resolvers
      - Web Proxies
      - Network Security Monitoring Sensors
    range: last 90 days
    queries:
      - machine_learning: For each domain in dns.log, CLASSIFY using DGA_model and SCORE using reputation_model. FLAG domain if classified as DGA or score is below 'suspicious' threshold.
  - question: Is there an outbound HTTP/S request using a User-Agent for a non-interactive tool (like curl or wget) that can be linked to a script or command-line process on the source host?
    context: While developers and administrators use command-line tools for legitimate purposes, adversaries use them to script data exfiltration. Detecting User-Agents for tools like curl, wget, or python-requests and correlating them with non-interactive parent processes (cmd.exe, powershell.exe) on the source host can reveal automated, unauthorized data transfers.
    answer_sources:
      - Zeek http.log
      - Zeek ssl.log
      - Windows Event ID 4688
      - Endpoints (Workstations and Servers)
      - Application Servers
      - DMZ Web Servers
      - API Gateways
    range: last 90 days
    queries:
      - symbolic: SEARCH http.log for user_agent matching 'curl', 'wget', 'python-requests'. On match, CORRELATE source_ip and timestamp with process logs (Event ID 4688) to find process. ALERT if parent process is non-interactive.
  - question: Are there any User-Agent strings that are extremely rare across the enterprise, indicating the use of non-standard software?
    context: Most enterprise workstations use a standardized set of web browsers, resulting in a predictable and limited set of User-Agent strings. A User-Agent that appears on only a tiny fraction of the endpoint population is a statistical anomaly that may represent unauthorized software, custom malware, or a specialized data transfer tool used by an adversary.
    answer_sources:
      - Zeek http.log
      - Zeek ssl.log
      - Windows Event ID 4688
      - Endpoints (Workstations and Servers)
      - Application Servers
      - DMZ Web Servers
      - API Gateways
    range: last 90 days
    queries:
      - statistical: CALCULATE prevalence of each user_agent across all hosts over 30 days. ALERT on user_agents seen on < 0.5% of hosts.
  - question: Is network traffic originating from a User-Agent that a machine learning model classifies as 'non-browser' coming from a standard user workstation?
    context: This question aims to automatically distinguish between legitimate browser traffic and programmatic, non-browser traffic. By training a model to recognize the features of browser User-Agents, any traffic from a user workstation that is flagged as 'non-browser' becomes suspicious, as it suggests an automated script or tool is making web requests rather than a user.
    answer_sources:
      - Zeek http.log
      - Zeek ssl.log
      - Windows Event ID 4688
      - Endpoints (Workstations and Servers)
      - Application Servers
      - DMZ Web Servers
      - API Gateways
    range: last 90 days
    queries:
      - machine_learning: For each http request from a user workstation, CLASSIFY user_agent string. FLAG for investigation if classified as 'non-browser'.
  - question: Is there a network connection where the amount of data sent is massively larger than the data received, and the total sent volume is significant?
    context: Data exfiltration is an inherently asymmetric activity where a large amount of data is sent outbound with minimal data received in return. This rule looks for a strong imbalance (e.g., sent bytes > 20x received bytes) combined with a high total volume (e.g., >50 MB) to create a high-confidence alert for bulk data transfer disguised as a web connection.
    answer_sources:
      - Zeek conn.log
      - Zeek http.log
      - Internet Gateway
      - Core Network Switches
      - Servers hosting sensitive data
      - Database Servers
    range: last 90 days
    queries:
      - symbolic: SEARCH conn.log WHERE orig_bytes > (resp_bytes * 20) AND orig_bytes > 50MB. ALERT on match.
  - question: For any given host-destination pair, has the ratio of outbound-to-inbound data or the size of an HTTP POST request suddenly exceeded its historical statistical baseline?
    context: Adversaries may exfiltrate data to a destination that is also used for legitimate traffic. This statistical method establishes a normal baseline for data transfer volume and ratio for every unique host-destination pair. An alert is triggered when a new connection dramatically deviates from this established norm, which can detect exfiltration even to otherwise legitimate services.
    answer_sources:
      - Zeek conn.log
      - Zeek http.log
      - Internet Gateway
      - Core Network Switches
      - Servers hosting sensitive data
      - Database Servers
    range: last 90 days
    queries:
      - statistical: For each host-destination pair, BASELINE 98th percentile of (orig_bytes/resp_bytes) and request_body_len over 30 days. ALERT if new connection exceeds baseline.
  - question: Is any host's total hourly outbound data volume significantly exceeding the amount predicted by a time-series forecasting model?
    context: The total outbound data from a host often follows a predictable pattern based on time of day and day of the week (seasonality). A time-series model can learn this pattern and predict the expected range of data volume. If a host's actual outbound traffic significantly exceeds the model's prediction, it could indicate an anomalous event like bulk data exfiltration.
    answer_sources:
      - Zeek conn.log
      - Zeek http.log
      - Internet Gateway
      - Core Network Switches
      - Servers hosting sensitive data
      - Database Servers
    range: last 90 days
    queries:
      - machine_learning: For each host, FORECAST expected hourly outbound data volume. ALERT if actual volume > predicted upper confidence bound.
  - question: Is a process that is not on an approved allowlist of web-facing applications initiating an outbound connection on port 80 or 443?
    context: Enterprise environments should maintain a list of approved applications permitted to make web connections (e.g., Chrome, Edge, Teams, Outlook). This question seeks to identify any process *not* on this list that makes an outbound web connection. This is a strong indicator of potentially malicious software attempting to communicate with an external server.
    answer_sources:
      - Zeek conn.log
      - Windows Event ID 4688
      - Windows Event ID 5156
      - Domain Controllers
      - File Servers
      - User Workstations
      - Critical System Servers
      - Developer Machines
    range: last 90 days
    queries:
      - symbolic: CORRELATE process creation (Event 4688) with network connection (Event 5156). ALERT if process_name is NOT IN allowlist AND destination_port is 80 or 443.
  - question: Is any running process exhibiting network behavior (e.g., bytes sent, distinct destinations) that deviates significantly from its own historical baseline?
    context: Even legitimate processes have predictable network behavior. This question aims to profile the normal activity of every process (e.g., svchost.exe, powershell.exe) and alert when one deviates from its own baseline by a significant margin (e.g., 3 standard deviations). This can catch a legitimate process that has been hijacked or is being abused for malicious purposes like data exfiltration.
    answer_sources:
      - Zeek conn.log
      - Windows Event ID 4688
      - Windows Event ID 5156
      - Domain Controllers
      - File Servers
      - User Workstations
      - Critical System Servers
      - Developer Machines
    range: last 90 days
    queries:
      - statistical: For each process_name, PROFILE mean and std_dev of outbound_bytes and distinct_destinations. ALERT if current activity > (mean + 3 * std_dev).
  - question: Is there a new process whose execution and network behavior is a statistical outlier compared to established clusters of normal activity?
    context: This machine learning approach groups all process activity into clusters of 'normal' behavior based on features like parent process, command-line arguments, and network patterns. Any new process that does not fit into an existing cluster is flagged as an outlier. This is a powerful method for detecting novel malware or adversary tools without prior signatures.
    answer_sources:
      - Zeek conn.log
      - Windows Event ID 4688
      - Windows Event ID 5156
      - Domain Controllers
      - File Servers
      - User Workstations
      - Critical System Servers
      - Developer Machines
    range: last 90 days
    queries:
      - machine_learning: CLUSTER process activity using features (process name, parent, cmdline, network stats). FLAG any new activity classified as an outlier or forming a new, small cluster.
  - question: Is any host making outbound connections to a single destination with machine-like regularity (e.g., every 5 minutes)?
    context: Automated malware often uses a 'beacon' to communicate with its command and control server at precise, regular intervals. This symbolic rule looks for a series of connections from a single source to a single destination where the time between each connection is almost exactly the same. This is a classic and reliable indicator of C2 beaconing.
    answer_sources:
      - Zeek conn.log
      - All internal network segments
      - VPN Concentrators
      - Remote Access Servers
      - IoT/OT Network Segments
    range: last 90 days
    queries:
      - symbolic: GROUP connections by src_ip, dst_ip, dst_port. For each group, CALCULATE time deltas between connections. ALERT if a series of deltas are constant (e.g., 300s +/- 5s).
  - question: Is a host exhibiting highly periodic connection behavior (low time delta variance) or making an unusual number of connections during off-hours?
    context: This statistical approach enhances symbolic beacon detection. It identifies periodicity by calculating the standard deviation of time between connectionsâ€”a value near zero indicates strong regularity. It also profiles the typical connection volume per hour for each host and flags significant activity during normally quiet times (e.g., 3 AM), which is highly suspicious for user workstations.
    answer_sources:
      - Zeek conn.log
      - All internal network segments
      - VPN Concentrators
      - Remote Access Servers
      - IoT/OT Network Segments
    range: last 90 days
    queries:
      - statistical: For each src-dst pair, CALCULATE std_dev of time deltas between connections; ALERT if near zero. Also, PROFILE hourly connection count per host; ALERT on significant volume during off-hours (e.g., 1-5 AM).
  - question: Is a time-series model detecting a deviation from a host's normal rhythm of network activity (frequency, timing, duration)?
    context: An advanced machine learning model like an LSTM autoencoder can learn the complex, normal patterns of a host's network communications over time. The model can then identify any sequence of network events that doesn't fit the learned pattern (a high 'reconstruction error'). This can detect sophisticated, non-obvious beaconing or other anomalous communications that other methods might miss.
    answer_sources:
      - Zeek conn.log
      - All internal network segments
      - VPN Concentrators
      - Remote Access Servers
      - IoT/OT Network Segments
    range: last 90 days
    queries:
      - machine_learning: For each host, apply a trained LSTM autoencoder to the stream of connection events. ALERT on any sequence with a high reconstruction error.
  - question: Is a user uploading a common archive file type (.zip, .rar, .7z) to a non-corporate or uncategorized cloud storage or file-sharing website?
    context: Adversaries frequently compress and archive stolen data before exfiltrating it to make the transfer more efficient and to bundle many files together. This rule specifically looks for the upload of archive files to external web services that are not approved business partners, as this is a common method for data theft.
    answer_sources:
      - Zeek http.log
      - Zeek files.log
      - Network Egress Points
      - Web Application Firewalls (WAFs)
      - Servers permitted to upload files to external sites
      - Managed File Transfer Systems
    range: last 90 days
    queries:
      - symbolic: SEARCH files.log for uploads with extensions (.zip, .rar, .7z) WHERE destination_domain is NOT IN approved_partner_list. ALERT on match.
  - question: Is any outbound file transfer or HTTP POST request containing data with a Shannon entropy value significantly higher than the historical baseline for that specific destination?
    context: Shannon entropy measures the randomness of data. Encrypted or compressed data has very high entropy, close to random. Normal data like text or images has lower, more predictable entropy. By establishing a normal entropy baseline for each destination, this method can detect when a transfer suddenly contains high-entropy data, suggesting it has been compressed or encrypted for exfiltration.
    answer_sources:
      - Zeek http.log
      - Zeek files.log
      - Network Egress Points
      - Web Application Firewalls (WAFs)
      - Servers permitted to upload files to external sites
      - Managed File Transfer Systems
    range: last 90 days
    queries:
      - statistical: For each destination_domain, BASELINE 99th percentile of entropy for POST bodies and file uploads over 30 days. ALERT if a new transfer's entropy exceeds the baseline.
  - question: Is data being sent to a web service that normally handles text (e.g., a paste site) being classified by a machine learning model as an 'archive' or 'encrypted blob'?
    context: Adversaries may try to hide exfiltrated data by sending it to services that expect plain text. A machine learning model trained on file content features (like byte distribution and entropy) can classify the *type* of data being sent. If a transfer to a paste site is classified as an encrypted file or an archive, it strongly suggests that the service is being abused for data exfiltration.
    answer_sources:
      - Zeek http.log
      - Zeek files.log
      - Network Egress Points
      - Web Application Firewalls (WAFs)
      - Servers permitted to upload files to external sites
      - Managed File Transfer Systems
    range: last 90 days
    queries:
      - machine_learning: For transfers to text-based web services, CLASSIFY content type using a file content model. FLAG transfer if classified as 'archive', 'encrypted', or 'executable'.