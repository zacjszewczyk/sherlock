name: 'T1567: Exfiltration Over Web Service'
id: 'f9d9d3a7-6b6f-4a0e-8c3b-2d1f0e9b8c7a'
description: 'This playbook helps investigate whether an adversary has exfiltrated data using legitimate external web services. This is achieved by analyzing network traffic for several key indicators: connections to known malicious destinations identified via threat intelligence; the use of non-interactive data transfer tools like cURL or Wget; anomalous data transfer volumes where sent data significantly exceeds received data; network connections originating from non-browser or unauthorized processes; machine-like connection patterns indicative of automated beaconing; and data payloads with unusually high entropy, suggesting encryption or compression.'
type: 'technique'
related:
  - 'TA0010: Exfiltration'
contributors:
  - 'Zachary Szewczyk'
  - 'Ask Sage'
created: '2025-10-01'
modified: '2025-10-01'
version: '1.0'
tags: 'none'
questions:
  - question: 'Are outbound network connections being made to destinations known to be malicious or associated with data exfiltration?'
    context: 'This question aims to identify direct evidence of data exfiltration by correlating network logs (DNS, HTTP/S, general connections) with threat intelligence feeds. A match provides a high-confidence signal that an internal host is communicating with an adversary-controlled infrastructure for exfiltration purposes.'
    answer_sources:
      - 'Zeek conn.log'
      - 'Zeek http.log'
      - 'Zeek ssl.log'
      - 'Zeek dns.log'
      - 'Internet Gateway Firewalls'
      - 'DNS Resolvers'
      - 'Web Proxies'
      - 'Network Security Monitoring Sensors'
    range: 'last 90 days'
    queries:
      - 'SEARCH (Zeek conn.log OR dns.log OR http.log OR ssl.log) | JOIN destination_ip, domain, server_name WITH threat_intelligence_feed ON indicator | WHERE match_found'
  - question: 'Are there any newly observed external domains being contacted by a very small number of internal hosts, suggesting targeted or non-widespread activity?'
    context: 'This question seeks to uncover potentially malicious domains that are not yet present in threat intelligence feeds. By calculating the prevalence of a domain across the internal network, we can flag domains with very low prevalence as suspicious. This could indicate a newly registered C2 domain or a specific exfiltration endpoint used by an adversary against a limited set of targets.'
    answer_sources:
      - 'Zeek conn.log'
      - 'Zeek dns.log'
      - 'Zeek http.log'
      - 'Zeek ssl.log'
      - 'Internet Gateway Firewalls'
      - 'DNS Resolvers'
      - 'Web Proxies'
      - 'Network Security Monitoring Sensors'
    range: 'last 90 days'
    queries:
      - 'SEARCH (Zeek dns.log OR http.log) | CALCULATE prevalence_score = (distinct_source_hosts / total_internal_hosts) over 24h | FILTER prevalence_score < 0.01'
  - question: 'Are hosts attempting to resolve or connect to domains that are algorithmically generated (DGA) or have a poor reputation?'
    context: 'This question uses machine learning to proactively identify malicious domains. DGA detection models can spot patterns indicative of malware C2 channels, while domain reputation models assess risk based on factors like age and registration details. This helps find threats without relying on known bad indicators.'
    answer_sources:
      - 'Zeek dns.log'
      - 'Internet Gateway Firewalls'
      - 'DNS Resolvers'
      - 'Web Proxies'
      - 'Network Security Monitoring Sensors'
    range: 'last 90 days'
    queries:
      - 'SEARCH Zeek dns.log | APPLY dga_detection_model to query | APPLY domain_reputation_model to query | FILTER classification == "dga" OR reputation_score < "suspicious_threshold"'
  - question: 'Are non-interactive command-line tools (e.g., curl, wget) being used to make outbound HTTP/S requests from non-interactive shells?'
    context: 'This question looks for the use of common data transfer utilities, like cURL or Wget, which are often used by adversaries for scripted exfiltration. By correlating network traffic showing these tools'' User-Agents with process logs on the source host, we can confirm if a non-interactive process (like cmd.exe or powershell.exe) initiated the transfer, which is highly suspicious for a user workstation.'
    answer_sources:
      - 'Zeek http.log'
      - 'Zeek ssl.log'
      - 'Windows Event ID 4688'
      - 'Endpoints (Workstations and Servers)'
      - 'Application Servers'
      - 'DMZ Web Servers'
      - 'API Gateways'
    range: 'last 90 days'
    queries:
      - 'SEARCH Zeek http.log WHERE user_agent matches (''curl'', ''wget'', ''python-requests'') | CORRELATE source_ip, timestamp with Windows Event ID 4688 logs | FILTER parent_process in (''cmd.exe'', ''powershell.exe'')'
  - question: 'Are there rare or uncommon User-Agent strings observed in outbound web traffic, suggesting the use of non-standard software?'
    context: 'This question identifies anomalous software by baselining User-Agent strings across the enterprise. A User-Agent seen on a very small percentage of hosts could indicate custom malware, a specialized hacking tool, or unauthorized software being used for exfiltration.'
    answer_sources:
      - 'Zeek http.log'
      - 'Endpoints (Workstations and Servers)'
      - 'Application Servers'
      - 'DMZ Web Servers'
      - 'API Gateways'
    range: 'last 90 days'
    queries:
      - 'SEARCH Zeek http.log | CALCULATE rarity of user_agent over 30 days | FILTER host_count_for_user_agent < (0.005 * total_endpoints)'
  - question: 'Can we detect web traffic originating from non-browser applications on standard user workstations using a machine learning model?'
    context: 'This question applies a classification model to distinguish between legitimate browser traffic and traffic from other applications based on User-Agent string characteristics. Flagging ''non-browser'' traffic from workstations provides a scalable way to find potentially unauthorized or malicious data transfers that might otherwise be missed.'
    answer_sources:
      - 'Zeek http.log'
      - 'Endpoints (Workstations and Servers)'
      - 'Application Servers'
      - 'DMZ Web Servers'
      - 'API Gateways'
    range: 'last 90 days'
    queries:
      - 'SEARCH Zeek http.log from user_workstations | APPLY user_agent_classifier_model | FILTER classification == "non-browser"'
  - question: 'Are there any outbound web connections with a highly asymmetric data flow, where the amount of data sent is significantly larger than the data received?'
    context: 'This question targets a classic sign of data exfiltration: large uploads with minimal downloads. A simple rule checking for a high ratio of sent-to-received bytes, combined with a minimum total volume, can effectively catch bulk data transfers disguised as web traffic.'
    answer_sources:
      - 'Zeek conn.log'
      - 'Zeek http.log'
      - 'Internet Gateway'
      - 'Core Network Switches'
      - 'Servers hosting sensitive data'
      - 'Database Servers'
    range: 'last 90 days'
    queries:
      - 'SEARCH Zeek conn.log | FILTER (orig_bytes > 20 * resp_bytes) AND (orig_bytes > 50MB)'
  - question: 'Do any web connections exhibit data upload volumes or byte ratios that are statistically anomalous compared to their historical baseline?'
    context: 'This question moves beyond static thresholds by creating dynamic baselines for each host-destination pair. It identifies deviations from normal behavior, such as a host suddenly sending a much larger HTTP POST request to a specific website than it ever has before. This is effective at finding subtle exfiltration that might not trigger a simple high-volume alert.'
    answer_sources:
      - 'Zeek conn.log'
      - 'Zeek http.log'
      - 'Internet Gateway'
      - 'Core Network Switches'
      - 'Servers hosting sensitive data'
      - 'Database Servers'
    range: 'last 90 days'
    queries:
      - 'SEARCH (Zeek conn.log OR http.log) | COMPARE current_orig_bytes_ratio OR current_request_body_len WITH 30-day_98th_percentile_baseline for host-destination_pair | FILTER current > baseline'
  - question: 'Is any host''s total hourly outbound data volume significantly exceeding its predicted normal amount based on a time-series forecast?'
    context: 'This question uses time-series forecasting to model the normal ''rhythm'' of a host''s data output, including daily and weekly patterns. An alert is triggered when the actual data volume deviates significantly from this learned pattern, which can detect bulk exfiltration events that occur at unusual times or in unusual amounts.'
    answer_sources:
      - 'Zeek conn.log'
      - 'Zeek http.log'
      - 'Internet Gateway'
      - 'Core Network Switches'
      - 'Servers hosting sensitive data'
      - 'Database Servers'
    range: 'last 90 days'
    queries:
      - 'FOR_EACH host | APPLY time-series_forecasting_model to outbound_volume_per_hour | FILTER actual_volume > predicted_upper_confidence_bound'
  - question: 'Are processes not on an approved list of web-enabled applications making outbound connections over ports 80 or 443?'
    context: 'This question aims to identify unauthorized software making web connections. By correlating process creation events with network connection events on an endpoint, we can pinpoint the exact process responsible for the traffic. If that process is not an approved browser or other legitimate application, it is highly suspicious and could be malware exfiltrating data.'
    answer_sources:
      - 'Zeek conn.log'
      - 'Windows Event ID 4688'
      - 'Windows Event ID 5156'
      - 'Domain Controllers'
      - 'File Servers'
      - 'User Workstations'
      - 'Critical System Servers'
      - 'Developer Machines'
    range: 'last 90 days'
    queries:
      - 'SEARCH Windows Event ID 5156 (port 80/443) | JOIN ProcessID with Windows Event ID 4688 | FILTER Process_Image_Name NOT IN approved_app_list'
  - question: 'Is any running process exhibiting network behavior (e.g., data volume, number of destinations) that deviates significantly from its own historical baseline?'
    context: 'This question profiles the normal network activity for every process. It can detect when a legitimate, but compromised, process (like powershell.exe) begins acting abnormally, such as sending more data or connecting to more destinations than it usually does. This helps spot abuse of legitimate tools.'
    answer_sources:
      - 'Zeek conn.log'
      - 'Windows Event ID 4688'
      - 'Windows Event ID 5156'
      - 'Domain Controllers'
      - 'File Servers'
      - 'User Workstations'
      - 'Critical System Servers'
      - 'Developer Machines'
    range: 'last 90 days'
    queries:
      - 'FOR_EACH process_name | CALCULATE baseline of network_behavior (mean/stddev of bytes, destinations) | FILTER current_activity > (baseline_mean + 3 * baseline_stddev)'
  - question: 'Can we identify anomalous process executions related to network activity using clustering algorithms?'
    context: 'This question uses unsupervised machine learning to group normal process activities into clusters. Any process activity that doesn''t fit into an established cluster (an outlier) is flagged for review. This is useful for finding novel or unusual execution chains that an adversary might use to initiate a network connection for exfiltration.'
    answer_sources:
      - 'Zeek conn.log'
      - 'Windows Event ID 4688'
      - 'Windows Event ID 5156'
      - 'Domain Controllers'
      - 'File Servers'
      - 'User Workstations'
      - 'Critical System Servers'
      - 'Developer Machines'
    range: 'last 90 days'
    queries:
      - 'SEARCH process_execution_data | APPLY clustering_model on features (process_name, parent_process, cmd_line, net_conn_count) | FILTER classification == "outlier"'
  - question: 'Are any hosts making outbound web connections to a single destination with highly regular time intervals, indicative of automated beaconing?'
    context: 'This question searches for the classic ''heartbeat'' of malware command and control (C2) or automated exfiltration scripts. A sustained series of connections to the same destination with a nearly constant delay between them (e.g., every 5 minutes) is unnatural for human behavior and is a strong indicator of an automated process.'
    answer_sources:
      - 'Zeek conn.log'
      - 'All internal network segments'
      - 'VPN Concentrators'
      - 'Remote Access Servers'
      - 'IoT/OT Network Segments'
    range: 'last 90 days'
    queries:
      - 'SEARCH Zeek conn.log | GROUP by source_ip, dest_ip, dest_port | CALCULATE time_delta between connections | FILTER count > 10 AND stddev(time_delta) < 5_seconds'
  - question: 'Are hosts exhibiting strong connection periodicity or making an unusual number of connections during off-hours?'
    context: 'This question uses statistics to find beaconing and other automated activity. A low standard deviation in the time between connections indicates regularity. Additionally, profiling normal connection times for a host allows for the detection of anomalous activity during hours when the user is typically inactive, such as overnight.'
    answer_sources:
      - 'Zeek conn.log'
      - 'All internal network segments'
      - 'VPN Concentrators'
      - 'Remote Access Servers'
      - 'IoT/OT Network Segments'
    range: 'last 90 days'
    queries:
      - 'SEARCH Zeek conn.log | CALCULATE stddev of time_deltas per source-dest pair | FILTER stddev < 5_seconds OR (connection_count > threshold AND hour IN (1,2,3,4,5))'
  - question: 'Can a time-series anomaly detection model identify sequences of network connections that deviate from a host''s normal learned patterns?'
    context: 'This question employs a sophisticated machine learning model (like an LSTM autoencoder) to learn the complex temporal patterns of a host''s network activity. The model can detect subtle anomalies in the sequence, frequency, and timing of connections that would be missed by simpler statistical methods, providing a powerful way to uncover novel C2 channels.'
    answer_sources:
      - 'Zeek conn.log'
      - 'All internal network segments'
      - 'VPN Concentrators'
      - 'Remote Access Servers'
      - 'IoT/OT Network Segments'
    range: 'last 90 days'
    queries:
      - 'FOR_EACH host | APPLY LSTM_autoencoder_model to connection_event_stream | FILTER reconstruction_error > threshold'
  - question: 'Are files with common archive extensions (.zip, .rar) being uploaded to non-corporate or uncategorized web services?'
    context: 'This question provides a simple, high-fidelity check for policy violations and potential data exfiltration. Adversaries often compress and archive data before exfiltrating it. By monitoring for common archive file types being sent to destinations not approved for business use (like personal cloud storage), we can catch blatant attempts to move stolen data.'
    answer_sources:
      - 'Zeek http.log'
      - 'Zeek files.log'
      - 'Network Egress Points'
      - 'Web Application Firewalls (WAFs)'
      - 'Servers permitted to upload files to external sites'
      - 'Managed File Transfer Systems'
    range: 'last 90 days'
    queries:
      - 'SEARCH Zeek files.log | FILTER file_extension IN (''.zip'', ''.rar'', ''.7z'') AND destination_domain NOT IN corporate_allowlist'
  - question: 'Are any outbound file transfers or HTTP POST requests exhibiting data entropy levels that are statistically anomalous for that specific destination?'
    context: 'This question aims to detect encrypted or compressed data by measuring its randomness (Shannon entropy). Since different web services have different normal data types, we establish a per-destination baseline for entropy. An alert is triggered when a transfer to a site that normally handles text suddenly shows high-entropy data, suggesting that encrypted data is being hidden within a seemingly legitimate connection.'
    answer_sources:
      - 'Zeek http.log'
      - 'Zeek files.log'
      - 'Network Egress Points'
      - 'Web Application Firewalls (WAFs)'
      - 'Servers permitted to upload files to external sites'
      - 'Managed File Transfer Systems'
    range: 'last 90 days'
    queries:
      - 'SEARCH (Zeek http.log OR files.log) | CALCULATE shannon_entropy of payload | COMPARE current_entropy with 30-day_99th_percentile_baseline for destination_domain | FILTER current_entropy > baseline'
  - question: 'Can a machine learning model classify the content type of data uploads and identify when the content (e.g., an encrypted blob) is inappropriate for the destination service?'
    context: 'This question uses a content classifier to identify the true nature of uploaded data (e.g., text, image, archive, encrypted). This is more robust than just checking file extensions. If data classified as ''encrypted'' or ''archive'' is sent to a service that should only receive simple text (like a paste site), it is a strong signal of malicious activity, such as staging stolen data.'
    answer_sources:
      - 'Zeek http.log'
      - 'Zeek files.log'
      - 'Network Egress Points'
      - 'Web Application Firewalls (WAFs)'
      - 'Servers permitted to upload files to external sites'
      - 'Managed File Transfer Systems'
    range: 'last 90 days'
    queries:
      - 'SEARCH http.log POST requests | APPLY content_classifier_model to payload | FILTER destination is "paste_site" AND classification IN (''archive'', ''encrypted_blob'', ''executable'')'