name: T1550.002: Pass the Hash
id: d4c5c1b0-f8d2-4e9a-8f9b-1c2d3e4f5a6b
description: >
  This playbook helps investigators determine if an adversary is bypassing authentication mechanisms using stolen NTLM hashes, a technique known as Pass the Hash (PtH). It focuses on identifying anomalous network logon patterns (Windows LogonType 3) that are indicative of PtH activity, often used for defense evasion and lateral movement. Key indicators include NTLM logons originating from threat-listed IP addresses, followed by immediate suspicious activity like service or process creation, or logons from hosts where the user has not recently logged in interactively. The playbook also covers unusual machine account logons, first-time access patterns between hosts, connections to high-value assets from unauthorized sources, rapid 'fan-out' logon activity, and sequences characteristic of Overpass-the-Hash attacks.
type: technique
related:
  - TA0005: Defense Evasion
  - TA0008: Lateral Movement
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Are there successful NTLM network logons involving IP addresses found on threat intelligence feeds or internal watchlists?
    context: This question aims to detect PtH attempts originating from or targeting known malicious infrastructure. Adversaries often use compromised hosts as pivot points. By cross-referencing logon event IP addresses with threat intelligence, we can identify connections that have a high a priori likelihood of being malicious. An exact match is a strong indicator of compromise.
    answer_sources:
      - Windows Event ID 4624
      - Zeek conn.log
      - Threat Intelligence Feed
      - Domain Controllers, Member Servers, Threat Intelligence Platforms, SIEM, Network Egress/Ingress Points
    range: last 90 days
    queries:
      - technology: pseudocode
        query: >
          SEARCH WindowsEventID=4624 AND LogonType=3
          | JOIN source_ip OR destination_ip WITH threat_intel_ips
          | RETURN count by user, source_ip, destination_ip
  - question: Are any NTLM network logons assigned an unusually high-risk score based on the reputation of the source and destination IPs?
    context: This question moves beyond simple blocklisting to a risk-based approach. Not all IPs on a threat list carry the same weight. By scoring logons based on IP reputation (e.g., age on list, number of sources), we can prioritize alerts for the most suspicious connections, identifying activity that exceeds a statistical threshold (e.g., 95th percentile) for risk in the environment.
    answer_sources:
      - Windows Event ID 4624
      - Zeek conn.log
      - Threat Intelligence Feed
      - Domain Controllers, Member Servers, Threat Intelligence Platforms, SIEM, Network Egress/Ingress Points
    range: last 90 days
    queries:
      - technology: pseudocode
        query: >
          SEARCH WindowsEventID=4624 AND LogonType=3 | CALCULATE risk_score based on source_ip_reputation, dest_ip_reputation | FILTER risk_score > 95th_percentile_baseline | RETURN user, source_ip, destination_ip, risk_score
  - question: Has a machine learning model predicted a high probability of a specific NTLM network logon being a malicious Pass the Hash attempt?
    context: This question leverages a predictive model to identify PtH attempts that may not be caught by simple rules or statistical thresholds. The model considers a combination of features (IP reputation, user privileges, connection history) to assess the likelihood of an event being malicious, providing a more nuanced detection capability for novel or complex attack patterns.
    answer_sources:
      - Windows Event ID 4624
      - Zeek conn.log
      - Threat Intelligence Feed
      - Domain Controllers, Member Servers, Threat Intelligence Platforms, SIEM, Network Egress/Ingress Points
    range: last 90 days
    queries:
      - technology: pseudocode
        query: >
          PIPE logon_events (LogonType=3) TO ML_model | FILTER prediction_probability > 0.85 | RETURN user, source_ip, destination_ip, prediction_probability
  - question: Are successful NTLM network logons quickly followed by the creation of services or processes with names matching known malicious patterns (e.g., 'PSEXESVC')?
    context: Adversaries using PtH for lateral movement often immediately execute code on the target system. This is commonly done by creating a malicious service or process. This question looks for this specific, high-confidence sequence of events (logon followed by malicious service/process creation within minutes) to detect post-exploitation activity.
    answer_sources:
      - Windows Event ID 4624
      - Windows Event ID 4688
      - Windows Event ID 7045
      - Zeek dce_rpc.log
      - Zeek smb_files.log
      - Authentication, process creation, and service creation logs from all servers and workstations; network traffic inspection points.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: >
          SEQUENCE [SEARCH WindowsEventID=4624 AND LogonType=3] within 5m [SEARCH (EventID=7045 AND ServiceName matches 'PSEXESVC') OR (EventID=4688 AND ProcessName matches known_malicious_tools)] by hostname, user | RETURN suspicious_sequences
  - question: Are new services or named pipes created with statistically anomalous high-entropy names immediately following a network logon?
    context: To evade simple signature-based detection, malicious tools often use randomly generated names for services or pipes. These random names typically have high Shannon entropy compared to legitimate, human-readable names. This question seeks to identify these outliers, which are strong indicators of automated malicious tool execution following a successful PtH logon.
    answer_sources:
      - Windows Event ID 4624
      - Windows Event ID 4688
      - Windows Event ID 7045
      - Zeek dce_rpc.log
      - Zeek smb_files.log
      - Authentication, process creation, and service creation logs from all servers and workstations; network traffic inspection points.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: >
          SEQUENCE [SEARCH WindowsEventID=4624 AND LogonType=3] followed by [SEARCH EventID=7045 OR named_pipe_creation] by hostname, user | CALCULATE entropy of new_service_or_pipe_name | FILTER entropy > 3_std_dev_from_baseline | RETURN suspicious_high_entropy_creations
  - question: Has a sequence analysis model detected an anomalous series of events, such as a network logon followed by high-entropy service creation, that deviates from normal behavior?
    context: This question uses a model that understands normal sequences of system activity. A PtH attack followed by code execution creates a sequence of events (e.g., network logon -> high-entropy service creation -> command shell process) that is highly unlikely in normal operations. The model flags such improbable sequences as anomalous, detecting the entire attack chain rather than just a single event.
    answer_sources:
      - Windows Event ID 4624
      - Windows Event ID 4688
      - Windows Event ID 7045
      - Zeek dce_rpc.log
      - Zeek smb_files.log
      - Authentication, process creation, and service creation logs from all servers and workstations; network traffic inspection points.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: >
          PIPE event_streams_per_host TO sequence_anomaly_model | FILTER anomaly_score > threshold AND sequence contains [LogonType3, ServiceCreate, ProcessCreate] | RETURN anomalous_sequences
  - question: Are there successful NTLM network logons from a workstation where the authenticating user has not had a recent interactive session?
    context: A legitimate network logon from a user's workstation is typically preceded by that user logging into the workstation interactively (e.g., at the console or via RDP). A PtH attack circumvents this. This question looks for network logons that lack a preceding interactive logon within a reasonable timeframe (e.g., 24 hours), which is a strong indicator that the user's credentials were used without their presence.
    answer_sources:
      - Windows Event ID 4624
      - Centralized authentication logs (Windows Event ID 4624) from all domain-joined workstations and servers.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: >
          FOREACH NTLM_Logon (LogonType=3) as L1 | SEARCH for Interactive_Logon (LogonType=2 or 10) on L1.source_host for L1.user within last 24h | IF no_interactive_logon_found, ALERT
  - question: Has a user's ratio of network logons to interactive logons dropped to a statistically unusual low?
    context: This question establishes a behavioral baseline for each user's typical logon activity. A sudden, sharp increase in network logons without a corresponding increase in interactive logons can indicate that the user's credentials are being used by an automated tool for lateral movement. A dramatic drop in the interactive-to-network logon ratio is a statistical red flag for this behavior.
    answer_sources:
      - Windows Event ID 4624
      - Centralized authentication logs (Windows Event ID 4624) from all domain-joined workstations and servers.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: >
          CALCULATE daily ratio of (LogonType 2/10) to (LogonType 3) per user | COMPARE ratio to user's historical baseline | ALERT if ratio drops below 5th_percentile
  - question: Has a clustering algorithm identified a group of network logon events for a user that is not associated with any corresponding interactive logon activity?
    context: This question uses unsupervised learning to find anomalous patterns in logon data. By clustering logon events based on user, host, and type, legitimate activity (interactive logons followed by network logons) will form predictable clusters. A cluster composed solely of network logons for a user from a specific host would be isolated by the algorithm as an anomaly, pointing to potential PtH activity.
    answer_sources:
      - Windows Event ID 4624
      - Centralized authentication logs (Windows Event ID 4624) from all domain-joined workstations and servers.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: >
          CLUSTER logon_events using features [user, source_host, logon_type, time] | IDENTIFY clusters containing only LogonType=3 events for a given user/host | ALERT on anomalous_clusters
  - question: Is a machine account (ending in '$') performing a network logon from a host that is not an authorized Domain Controller or management server?
    context: Machine account logons should follow predictable patterns, typically originating from specific infrastructure like Domain Controllers. A logon from an unexpected source, such as a standard user workstation, is highly anomalous and suggests an adversary may have compromised the machine account's credentials to move laterally.
    answer_sources:
      - Windows Event ID 4624
      - Asset Inventory/CMDB
      - Domain Controller and Member Server Authentication Logs, Asset Inventory/CMDB
    range: last 90 days
    queries:
      - technology: pseudocode
        query: >
          SEARCH WindowsEventID=4624 AND LogonType=3 AND AccountName ends with '$' | FILTER Source_IP NOT IN allow_list_of_DCs_and_mgmt_servers | ALERT
  - question: Is a machine account performing a network logon from a statistically rare source host?
    context: This question identifies deviations from normal machine-to-machine communication without relying on a static allow-list. By profiling the frequency of source hosts for machine account logons, any host that rarely or never performs such logons but suddenly does so becomes a statistical outlier. This can uncover misconfigured systems or compromised hosts being used as launch points.
    answer_sources:
      - Windows Event ID 4624
      - Asset Inventory/CMDB
      - Domain Controller and Member Server Authentication Logs, Asset Inventory/CMDB
    range: last 90 days
    queries:
      - technology: pseudocode
        query: >
          PROFILE frequency of source_hosts for machine_account_logons | IDENTIFY source hosts in bottom 1st percentile of logon frequency | ALERT on rare_source_hosts
  - question: Has a one-class SVM model, trained on legitimate machine account logon behavior, classified a new logon event as an anomaly?
    context: This question uses a model to build a complex boundary of what constitutes 'normal' for machine account logons, considering features like source, destination, and time. Any new logon that falls outside this learned boundary is flagged as an anomaly, providing a powerful way to detect novel or sophisticated attacks that might not be statistically rare in a single dimension but are anomalous as a whole.
    answer_sources:
      - Windows Event ID 4624
      - Asset Inventory/CMDB
      - Domain Controller and Member Server Authentication Logs, Asset Inventory/CMDB
    range: last 90 days
    queries:
      - technology: pseudocode
        query: >
          PIPE machine_account_logons TO one_class_SVM_model | FILTER classification is 'anomaly' | ALERT on anomalous_logons
  - question: Is a user, especially a privileged one, performing an NTLM network logon between a source and destination host pair for the first time in over 90 days?
    context: Users typically exhibit consistent access patterns. A logon between two hosts that have never communicated on behalf of that user before is a significant event. This is especially true for privileged accounts, as it could represent the first step of an adversary's lateral movement into a new part of the network. This rule-based check against a long-term baseline is effective at spotting this 'first-time' activity.
    answer_sources:
      - Windows Event ID 4624
      - Centralized, long-term historical authentication logs (e.g., >90 days); Identity and Access Management (IAM) database; CMDB.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: >
          FOREACH NTLM_Logon (LogonType=3) as L1 | CHECK if L1.user, L1.source_host, L1.dest_host pair exists in 90-day baseline | IF not exists, ALERT with severity based on L1.user_privilege
  - question: Has a user's set of accessed hosts changed so significantly that its similarity to their historical baseline drops below a statistical threshold?
    context: This question quantifies changes in a user's access behavior. The Jaccard similarity index measures the overlap between the set of hosts a user accessed today versus their historical norm. A sharp drop in this score indicates a user is suddenly accessing a very different set of machines, which could be a sign their account is being used by an adversary to explore and move through the network.
    answer_sources:
      - Windows Event ID 4624
      - Centralized, long-term historical authentication logs (e.g., >90 days); Identity and Access Management (IAM) database; CMDB.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: >
          CALCULATE daily Jaccard_similarity of accessed_hosts vs 90-day_baseline per user | ALERT if Jaccard_score < 0.5
  - question: Has a link prediction model flagged an observed user-to-host logon as a highly improbable connection?
    context: This question models the network as a graph of users and hosts, learning which connections are likely. A link prediction algorithm can forecast future connections based on this graph structure. If a logon occurs that the model assigned a very low probability to, it signifies a connection that breaks established patterns and is therefore highly suspicious, potentially indicating an adversary forging a new path.
    answer_sources:
      - Windows Event ID 4624
      - Centralized, long-term historical authentication logs (e.g., >90 days); Identity and Access Management (IAM) database; CMDB.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: >
          PIPE user_host_logon_graph TO link_prediction_model | FOREACH new_logon, get connection_probability | ALERT if probability is very low
  - question: Is there an NTLM network logon to a high-value asset, such as a Domain Controller, from a workstation not on the authorized administrative source list?
    context: Access to critical, high-value assets (HVAs) should be strictly controlled and originate only from hardened administrative workstations or jump boxes. This question enforces that policy by alerting on any network logon to an HVA from an unauthorized source, which is a major security violation and a strong indicator of a lateral movement attempt.
    answer_sources:
      - Windows Event ID 4624
      - Asset Inventory/CMDB
      - High-Value Asset Inventory (CMDB), Domain Controller Security Logs, Critical Server Security Logs
    range: last 90 days
    queries:
      - technology: pseudocode
        query: >
          SEARCH WindowsEventID=4624 AND LogonType=3 | FILTER destination_ip IN high_value_asset_list AND source_ip NOT IN authorized_admin_list | ALERT
  - question: Has a network logon event generated an unusually high-risk score based on the criticality of the source and destination assets?
    context: This question provides a dynamic way to assess the risk of lateral movement. By assigning criticality tiers to all assets, we can calculate a risk score for every connection (e.g., a logon from a low-tier workstation to a high-tier domain controller gets a high score). Alerting on logons that exceed the 99th percentile of these scores helps focus attention on the most dangerous potential lateral movement activities.
    answer_sources:
      - Windows Event ID 4624
      - Asset Inventory/CMDB
      - High-Value Asset Inventory (CMDB), Domain Controller Security Logs, Critical Server Security Logs
    range: last 90 days
    queries:
      - technology: pseudocode
        query: >
          SEARCH WindowsEventID=4624 AND LogonType=3 | ENRICH with source_asset_tier, dest_asset_tier | CALCULATE risk_score = source_tier * dest_tier | ALERT if risk_score > 99th_percentile
  - question: Has a machine learning model predicted a high risk of lateral movement for a network logon based on asset criticality, user privileges, and connection history?
    context: This question uses a predictive model to evaluate the risk of a logon event in a multi-faceted way. The model can learn complex, non-linear relationships between features like asset value, user roles, and historical connection paths to identify logons that represent a high risk of malicious lateral movement, even if they don't violate a single hard-coded rule.
    answer_sources:
      - Windows Event ID 4624
      - Asset Inventory/CMDB
      - High-Value Asset Inventory (CMDB), Domain Controller Security Logs, Critical Server Security Logs
    range: last 90 days
    queries:
      - technology: pseudocode
        query: >
          PIPE logon_events TO lateral_movement_risk_model | FILTER predicted_risk_score is 'high' | ALERT on high_risk_logons
  - question: Is a successful NTLM network logon immediately followed by remote process, service, or task creation on the target host, initiated from the source host?
    context: This question identifies the classic 'land and execute' pattern of lateral movement. Adversaries use PtH to authenticate to a remote machine and then immediately use tools like PsExec or WMI to run commands. This correlation rule looks for the tight temporal link between the logon and the remote execution event, which is a hallmark of this technique.
    answer_sources:
      - Windows Event ID 4624
      - Windows Event ID 4688
      - Windows Event ID 7045
      - Windows Event ID 4698
      - Zeek dce_rpc.log
      - Endpoint Process Creation, Service, and Task Scheduler Logs; Network Inspection Points (for DCE/RPC traffic); Server Authentication Logs
    range: last 90 days
    queries:
      - technology: pseudocode
        query: >
          SEQUENCE [SEARCH NTLM_Logon (LogonType=3) from S to T] within 2m [SEARCH Remote_Execution_Event on T from S (e.g., ServiceCreate, ProcessCreate via WMI)] by S, T | ALERT on sequence
  - question: Is the time delta between a network logon and subsequent remote execution from the same source to the same target a statistical outlier (i.e., extremely short)?
    context: Automated lateral movement tools operate at machine speed, resulting in a very short and consistent delay between authentication and execution. Human administrators are much slower. This question identifies source-target pairs where this time delta is statistically very low, suggesting the activity is programmatic and likely malicious.
    answer_sources:
      - Windows Event ID 4624
      - Windows Event ID 4688
      - Windows Event ID 7045
      - Windows Event ID 4698
      - Zeek dce_rpc.log
      - Endpoint Process Creation, Service, and Task Scheduler Logs; Network Inspection Points (for DCE/RPC traffic); Server Authentication Logs
    range: last 90 days
    queries:
      - technology: pseudocode
        query: >
          CALCULATE time_delta between LogonType=3 and subsequent Remote_Execution per source/target pair | IDENTIFY pairs where time_delta is in lowest 1st percentile | ALERT on anomalously_fast_execution
  - question: Has a sequence model flagged a series of events, such as NTLM logon followed by remote service creation and process execution, as an anomalous lateral movement pattern?
    context: This question leverages a model that understands normal event sequences on hosts. An attack sequence, where a logon is immediately followed by specific types of remote execution, creates a pattern that deviates from learned normal administrative behavior. The model can detect this anomalous sequence as a single, high-confidence malicious event chain.
    answer_sources:
      - Windows Event ID 4624
      - Windows Event ID 4688
      - Windows Event ID 7045
      - Windows Event ID 4698
      - Zeek dce_rpc.log
      - Endpoint Process Creation, Service, and Task Scheduler Logs; Network Inspection Points (for DCE/RPC traffic); Server Authentication Logs
    range: last 90 days
    queries:
      - technology: pseudocode
        query: >
          PIPE event_streams_per_host TO sequence_anomaly_model | FILTER anomaly_score > threshold AND sequence contains [NTLM_Logon, DCE_RPC_SVC_Create, Process_Create_From_Service] | ALERT
  - question: Has a single user account or source host performed an excessive number of NTLM network logons to unique destinations in a short time (e.g., >20 hosts in 10 minutes)?
    context: This question aims to detect the 'fan-out' or 'spraying' pattern common in automated lateral movement or network reconnaissance. A single compromised account or host rapidly connecting to many different systems is not typical user behavior. A simple threshold-based rule can effectively detect this brute-force style of movement.
    answer_sources:
      - Windows Event ID 4624
      - Centralized Authentication Logs from all Endpoints and Servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: >
          SEARCH WindowsEventID=4624 AND LogonType=3 | BUCKET time into 10m windows | COUNT unique destination_hosts by source_ip, user | ALERT if unique_host_count > 20
  - question: Has the number of unique destinations a source host connects to via NTLM logon exceeded its own historical baseline by a significant statistical margin?
    context: This question creates a dynamic, self-tuning baseline for each host's connection behavior. Instead of a single global threshold, it alerts when a host's activity deviates significantly (e.g., 3 standard deviations) from its own norm. This is more effective at finding anomalies in diverse environments where some hosts (like scanners) are normally 'noisy' while others are not.
    answer_sources:
      - Windows Event ID 4624
      - Centralized Authentication Logs from all Endpoints and Servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: >
          MONITOR count of unique NTLM destinations per hour per source_host | COMPARE to historical baseline for that host | ALERT if current_count > (mean + 3 * std_dev)
  - question: Has a time-series forecasting model predicted a significantly lower number of unique NTLM destinations for a host than what was actually observed?
    context: This question uses a forecasting model (like SARIMA) to predict the expected range of a host's fan-out activity. When the actual observed activity dramatically exceeds the upper bound of the model's prediction, it signals a statistically improbable event that is highly indicative of an anomaly, such as a compromised host being used for lateral movement.
    answer_sources:
      - Windows Event ID 4624
      - Centralized Authentication Logs from all Endpoints and Servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: >
          FORECAST unique_NTLM_destinations per source_host using SARIMA model | COMPARE observed_count to forecast_upper_confidence_bound | ALERT if observed_count > forecast_bound
  - question: Are there NTLM network logons that create a path between hosts that violates pre-defined network segmentation policies?
    context: This question directly enforces network security architecture. By codifying segmentation rules (e.g., hosts in the user VLAN cannot directly access the database VLAN), this query can detect logon events that represent a policy violation. Such a violation could indicate an adversary is pivoting through misconfigured hosts to bypass security controls.
    answer_sources:
      - Windows Event ID 4624
      - Zeek conn.log
      - Network Flow Logs, Firewall Logs, Centralized Authentication Logs, Network Architecture Policies
    range: last 90 days
    queries:
      - technology: pseudocode
        query: >
          SEARCH WindowsEventID=4624 AND LogonType=3 | ENRICH source_ip, destination_ip with network_zone | CHECK if connection between source_zone and destination_zone violates segmentation_rules | ALERT on violation
  - question: Are there statistically rare or unusually long chains of sequential NTLM logons (e.g., A -> B -> C) occurring between hosts?
    context: Legitimate remote administration may involve one or two 'hops,' but long chains of connections are rare. This question analyzes the graph of logon events to find these paths. Alerting on paths that are longer than a baseline maximum (e.g., > 2 hops) or are statistically infrequent can uncover adversary pivoting activity as they move deeper into a network.
    answer_sources:
      - Windows Event ID 4624
      - Zeek conn.log
      - Network Flow Logs, Firewall Logs, Centralized Authentication Logs, Network Architecture Policies
    range: last 90 days
    queries:
      - technology: pseudocode
        query: >
          CONSTRUCT logon_graph from NTLM events | FIND all paths and calculate length and frequency | ALERT on paths where length > 2 OR path_frequency is statistically rare
  - question: Has a graph-based anomaly detection model identified a host whose connection behavior has shifted significantly, indicating it may be acting as a pivot point?
    context: This question models host relationships and behaviors using graph embeddings. A host's 'vector' represents its typical connection patterns. When a host is compromised and used as a pivot, it begins connecting to new and different types of hosts, causing its vector to change significantly. The model detects this shift as an anomaly, identifying the pivot point in a lateral movement chain.
    answer_sources:
      - Windows Event ID 4624
      - Zeek conn.log
      - Network Flow Logs, Firewall Logs, Centralized Authentication Logs, Network Architecture Policies
    range: last 90 days
    queries:
      - technology: pseudocode
        query: >
          CALCULATE Node2Vec embeddings for hosts based on logon_graph | MONITOR embeddings for significant changes over time | ALERT on hosts with anomalous vector shifts
  - question: On a Domain Controller, is a successful NTLM logon immediately followed by a Kerberos ticket request from the same user and source IP?
    context: This question targets a specific technique variant called Overpass-the-Hash. An adversary uses a stolen NTLM hash to authenticate to a DC (the 'Pass-the-Hash' part) and immediately uses that authenticated session to request a valid Kerberos TGT. This sequence of an NTLM logon followed seconds later by a Kerberos ticket request from the same source is a high-fidelity indicator of this attack.
    answer_sources:
      - Windows Event ID 4624
      - Windows Event ID 4768
      - Windows Event ID 4769
      - Domain Controller Security Logs
    range: last 90 days
    queries:
      - technology: pseudocode
        query: >
          ON Domain Controllers: SEQUENCE [SEARCH EventID=4624 AND LogonType=3] within 10s [SEARCH EventID=4768 OR EventID=4769] by user, source_ip | ALERT on sequence
  - question: Is the time delay between an NTLM logon to a DC and a subsequent Kerberos request from the same source a low-percentile statistical outlier?
    context: Similar to other automated attacks, the Overpass-the-Hash technique is performed programmatically, resulting in a minimal and consistent delay between the NTLM and Kerberos events. This question identifies source IPs where this delay is extremely short (e.g., under a second), which is a statistical anomaly compared to any potential legitimate (and much slower) sequences, strongly indicating an automated attack.
    answer_sources:
      - Windows Event ID 4624
      - Windows Event ID 4768
      - Windows Event ID 4769
      - Domain Controller Security Logs
    range: last 90 days
    queries:
      - technology: pseudocode
        query: >
          CALCULATE time_delta between NTLM_logon_to_DC and Kerberos_request from same source_ip | IDENTIFY source_ips where average_delta is in lowest 1st percentile | ALERT on anomalously_fast_sources
  - question: Has a Bayesian network model identified an anomalously high probability of a Kerberos request occurring immediately after an NTLM logon for a given user/source?
    context: This question uses a probabilistic model to understand the relationships between different authentication events on a Domain Controller. In a normal environment, the probability of a Kerberos request immediately following an NTLM logon from the same source is very low. The model would flag any instance where this conditional probability is anomalously high as a likely Overpass-the-Hash attack.
    answer_sources:
      - Windows Event ID 4624
      - Windows Event ID 4768
      - Windows Event ID 4769
      - Domain Controller Security Logs
    range: last 90 days
    queries:
      - technology: pseudocode
        query: >
          PIPE DC_auth_events TO Bayesian_network_model | IDENTIFY events where P(Kerberos_Request | NTLM_Logon) is anomalously high | ALERT on high_probability_sequences