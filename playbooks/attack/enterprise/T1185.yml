name: T1185: Browser Session Hijacking
id: a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d
description: This playbook helps determine if an adversary is leveraging browser sessions for collection or lateral movement. It focuses on detecting anomalous browser behavior, such as connections to malicious sites, unauthorized access to credential stores, suspicious process relationships, unusual network traffic patterns, and the fraudulent use of session tokens from multiple locations or devices.
type: technique
related:
  - TA0009: Collection
contributors: Zachary Szewczyk, Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Is a user's browser connecting to known malicious infrastructure?
    context: A browser process making a network connection to an IP or domain known for command and control (C2) or malware hosting is a strong indicator of compromise. This question aims to detect this direct communication with threat actor infrastructure by correlating network and DNS logs with threat intelligence feeds.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Windows Event ID 5156
      - Windows Event ID 4688
      - Enterprise web proxy
      - DNS resolvers
      - All user endpoints
    range: last 90 days
    queries:
      - query_type: pseudocode
        query: JOIN network_connections ON ip, timestamp WITH dns_logs. FILTER process_name IS 'chrome.exe' OR 'firefox.exe' OR 'msedge.exe'. CHECK destination_ip OR destination_domain AGAINST threat_intel_feed. ALERT on match.
  - question: Is a user's browser connecting to an unusually rare or newly created domain?
    context: Adversaries often use newly registered domains (NRDs) for C2 to evade reputation-based blocking. By baselining normal browsing habits and identifying connections to domains that are extremely uncommon across the organization and newly created, we can uncover potential C2 channels that have not yet been added to threat intelligence feeds.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Windows Event ID 5156
      - Windows Event ID 4688
      - WHOIS lookup data
      - Enterprise web proxy
      - DNS resolvers
      - All user endpoints
    range: last 90 days
    queries:
      - query_type: pseudocode
        query: FOR each user, FOR each new domain visited, CALCULATE prevalence of domain across organization. GET domain_creation_date from WHOIS. IF prevalence < 1st percentile AND domain_age < 30 days THEN ALERT.
  - question: Can a machine learning model classify browser network connections as malicious based on their characteristics?
    context: A supervised machine learning model can learn the subtle patterns of malicious network traffic from labeled examples. By analyzing features like connection duration, data volume, protocol behavior, and destination reputation, the model can identify suspicious connections that might otherwise be missed, providing a score to prioritize investigation.
    answer_sources:
      - Zeek conn.log
      - IP reputation data
      - ASN information
      - Domain age data
      - Enterprise web proxy
      - DNS resolvers
      - All user endpoints
    range: last 90 days
    queries:
      - query_type: pseudocode
        query: FROM browser_network_logs, EXTRACT features (duration, bytes, protocol, etc.). ENRICH with IP reputation, ASN, domain age. INPUT features into trained ML model. IF prediction_score > 0.9 THEN ALERT.
  - question: Is a browser being launched with suspicious command-line flags that could enable hijacking or disable security features?
    context: Adversaries may launch a browser with specific command-line arguments to facilitate session hijacking, such as '--remote-debugging-port' for external control or '--disable-web-security' to weaken security. Monitoring for the use of these dangerous flags is a high-fidelity way to detect attempts to compromise or control a browser session.
    answer_sources:
      - Windows Event ID 4688
      - All user endpoints (workstations, VDIs)
      - Terminal servers
    range: last 90 days
    queries:
      - query_type: pseudocode
        query: FROM process_creation_events (EID 4688), FILTER process_name IS browser. PARSE command_line. IF command_line contains '--remote-debugging-port' OR '--load-extension' OR '--disable-web-security' THEN ALERT.
  - question: Is a rare or unauthorized process accessing sensitive browser files like cookie or credential stores?
    context: Browser data, including cookies and saved passwords, is stored in specific files. Legitimate access is almost exclusively limited to the browser process itself. This question aims to detect when other processes, especially uncommon ones like script interpreters, attempt to access these files to steal credentials or session data.
    answer_sources:
      - Windows Event ID 4663
      - All user endpoints (workstations, VDIs) and terminal servers
      - User profile directories (e.g., C:\Users\<username>\AppData\)
    range: last 90 days
    queries:
      - query_type: pseudocode
        query: FROM file_access_events (EID 4663), FILTER target_file IS 'Login Data' OR 'Cookies'. FOR each accessing_process, CALCULATE rarity across environment baseline. IF process_rarity > 99th percentile THEN ALERT.
  - question: Are there anomalous browser launch command lines that deviate from normal patterns?
    context: An unsupervised machine learning model can learn the structure of normal browser launch commands. By flagging any command line that significantly deviates from this learned baseline, this approach can detect new or unknown variations of browser-based attacks without prior knowledge of the specific flags being used.
    answer_sources:
      - Windows Event ID 4688
      - All user endpoints (workstations, VDIs)
      - Terminal servers
    range: last 90 days
    queries:
      - query_type: pseudocode
        query: VECTORIZE browser command lines using TF-IDF. TRAIN autoencoder model on baseline data. FOR new browser launch events, CALCULATE reconstruction_error. IF reconstruction_error > threshold THEN ALERT.
  - question: Is a browser spawning a shell/script, or is a browser process being injected into by another process?
    context: A web browser should not typically spawn a command shell (cmd.exe) or script interpreter (powershell.exe). Similarly, another process creating a remote thread in a browser is a common injection technique. This question uses two high-confidence rules to detect these specific, suspicious process relationships.
    answer_sources:
      - Windows Event ID 4688
      - Sysmon Event ID 8
      - All endpoints running user-facing web browsers
    range: last 90 days
    queries:
      - query_type: pseudocode
        query: RULE 1- FROM process_creation (EID 4688), IF parent_process is browser AND child_process is shell/script THEN ALERT. RULE 2- FROM remote_thread_creation (Sysmon EID 8), IF target_process is browser AND source_process is NOT browser THEN ALERT.
  - question: Has a browser spawned a child process that is rare or has never been seen before in the environment?
    context: Beyond just shells, a browser spawning any unexpected child process can be a sign of compromise. This question involves creating a baseline of all normal child processes spawned by browsers. By comparing new process creation events against this baseline, we can automatically flag any new or very rare parent-child relationships for investigation.
    answer_sources:
      - Windows Event ID 4688
      - All endpoints running user-facing web browsers
    range: last 90 days
    queries:
      - query_type: pseudocode
        query: BUILD baseline of browser-child relationships. FOR new process_creation events where parent is browser, CHECK child_process against baseline. IF child_process is new OR frequency < 0.1% THEN ALERT.
  - question: Does the process activity graph on a host show an anomalous structure originating from a browser?
    context: By modeling process relationships as a graph, we can use specialized algorithms to find unusual patterns, such as a browser spawning a long chain of processes. This provides a holistic view of process behavior and can uncover complex attack sequences that might be missed by single-event rules.
    answer_sources:
      - Windows Event ID 4688
      - Sysmon Event ID 8
      - All endpoints running user-facing web browsers
    range: last 90 days
    queries:
      - query_type: pseudocode
        query: FOR each host, CONSTRUCT process graph from process and remote_thread events. APPLY graph anomaly detection algorithm. IF anomalous subgraph involving a browser is found THEN ALERT.
  - question: Is a browser process communicating with internal systems on non-standard web ports?
    context: When a browser is observed making connections to internal IPs on ports for services like SSH (22), SMB (445), or RDP (3389), it strongly indicates an attacker is using the compromised browser as a pivot point to move laterally or perform internal reconnaissance.
    answer_sources:
      - Zeek conn.log
      - Windows Event ID 5156
      - Network gateways
      - Internal network segments
      - User endpoints
    range: last 90 days
    queries:
      - query_type: pseudocode
        query: FROM network_events, FILTER process_name is browser. IF destination_ip is internal (RFC1918) AND destination_port is IN (22, 139, 445, 3389) THEN ALERT.
  - question: Has a user's browser network traffic profile significantly deviated from their own historical baseline?
    context: A sudden change in a user's stable network pattern can signal compromise. By monitoring metrics like data upload/download ratio, internal hosts contacted, or port variety, we can spot deviations that might indicate an attacker is using the hijacked session for data exfiltration or internal scanning.
    answer_sources:
      - Zeek conn.log
      - Zeek http.log
      - Windows Event ID 5156
      - Network gateways
      - Internal network segments
      - User endpoints
    range: last 90 days
    queries:
      - query_type: pseudocode
        query: FOR each user, CALCULATE 30-day rolling baseline of network metrics (bytes ratio, unique internal IPs, port entropy). ON new activity, IF current metric > 3 * stdev(baseline) THEN ALERT.
  - question: Has a user's browser behavior profile anomalously shifted when compared to their peers?
    context: This question aims to detect when a user's behavior suddenly changes to be inconsistent with their peer group (e.g., users in the same job role). A user who typically only browses external sites suddenly behaving like an administrator with heavy internal traffic could indicate their session has been hijacked.
    answer_sources:
      - Zeek conn.log
      - Zeek http.log
      - Network gateways
      - Internal network segments
      - User endpoints
    range: last 90 days
    queries:
      - query_type: pseudocode
        query: DAILY, featurize each user's browser activity. CLUSTER users into behavioral groups (e.g., DBSCAN). TRACK user's cluster membership over time. IF user makes anomalous cluster transition THEN ALERT.
  - question: Is a single web application session being used with multiple, conflicting User-Agent strings?
    context: A legitimate user session, identified by a session token, will consistently have the same User-Agent string. If a request is seen with a valid session token but a different User-Agent, it strongly implies that the token has been stolen and is being used by an attacker on a different machine.
    answer_sources:
      - Zeek http.log
      - Application-level logs (WAF, reverse proxy, application server)
      - Network traffic inspection points
    range: last 90 days
    queries:
      - query_type: pseudocode
        query: FOR each session_id, STORE initial User-Agent. ON new request with same session_id, IF new_User_Agent != initial_User_Agent THEN ALERT.
  - question: Is a single web application session being used from multiple geolocations in an impossibly short amount of time?
    context: Known as "impossible travel," this technique detects session hijacking by calculating the speed required to travel between the geolocations of consecutive requests for the same session. If the velocity is physically impossible, it indicates the session token is compromised.
    answer_sources:
      - Zeek http.log
      - Application-level logs (WAF, reverse proxy, application server)
      - Geolocation IP database
      - Network traffic inspection points
    range: last 90 days
    queries:
      - query_type: pseudocode
        query: FOR each session_id, STORE last_request_timestamp and last_request_geolocation. ON new request, CALCULATE travel_velocity = distance(new_geo, last_geo) / (new_time - last_time). IF travel_velocity > 800 mph THEN ALERT.
  - question: Is the sequence of actions within a web session inconsistent with learned legitimate user behavior?
    context: Legitimate users follow predictable workflows in an application. An attacker may perform actions that are out of order. This question proposes using a sequence-aware machine learning model (like an RNN) to learn the "grammar" of normal user sessions and flag sessions that do not conform.
    answer_sources:
      - Zeek http.log
      - Application-level logs (WAF, reverse proxy, application server)
      - Network traffic inspection points
    range: last 90 days
    queries:
      - query_type: pseudocode
        query: MODEL user sessions as sequences of events. TRAIN RNN/LSTM autoencoder on legitimate session sequences. FOR active sessions, feed sequence into model. IF reconstruction_error > threshold THEN ALERT.