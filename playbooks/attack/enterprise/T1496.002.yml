name: T1496.002: Bandwidth Hijacking
id: a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d
description: This playbook helps investigate whether an adversary is causing network impact through bandwidth hijacking. It provides questions to detect this activity by looking for connections to known malicious infrastructure (botnets, proxyware, TOR), the execution of related software (miners, proxyware clients), anomalous DNS or network traffic volumes, and behaviors consistent with DDoS participation or network scanning.
type: technique
related:
- TA0040: Impact
contributors:
- Zachary Szewczyk
- Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
- question: Are internal hosts communicating with known malicious infrastructure associated with bandwidth hijacking, such as botnet C2s, proxyware services, or TOR nodes?
  context: This question aims to find direct evidence of compromise by comparing outbound network connections against high-confidence threat intelligence feeds. A match provides a strong signal that an internal host is being used for malicious purposes like proxying traffic or participating in a botnet, directly contributing to bandwidth hijacking.
  answer_sources:
  - Zeek conn.log
  - Zeek dns.log
  - Internet Gateway, DNS Resolvers, Web Proxies, Cloud Egress Points
  range: last 90 days
  queries:
  - technology: Pseudocode
    query: SEARCH network_logs (conn OR dns) | JOIN threat_intel ON (destination_ip OR query_domain) | WHERE threat_intel.category IN ('botnet_c2', 'proxyware', 'tor_exit_node', 'malicious_scanner')
- question: Are any internal hosts showing a statistically significant increase in connections to low-reputation IP addresses?
  context: This question seeks to identify hosts that may be communicating with suspicious, but not definitively malicious, destinations. A significant spike in traffic to low-reputation IPs compared to the host's own baseline or its peers can be an early indicator of bandwidth hijacking, even before the destinations are added to high-confidence blocklists.
  answer_sources:
  - Zeek conn.log
  - Zeek dns.log
  - Internet Gateway, DNS Resolvers, Web Proxies, Cloud Egress Points
  range: last 90 days
  queries:
  - technology: Pseudocode
    query: SEARCH network_logs | STATS count BY source_ip, destination_ip | JOIN reputation_intel ON destination_ip | CALCULATE percentage_low_rep_traffic BY source_ip | ALERT WHERE percentage > baseline_95th_percentile
- question: Can we use machine learning to predict and identify network connections likely associated with bandwidth hijacking based on their characteristics?
  context: This question uses a predictive approach to identify malicious connections that may not match known indicators. By training a model on features like connection duration, data volume, and domain characteristics, it's possible to flag novel or evasive bandwidth hijacking activity that symbolic and statistical methods might miss.
  answer_sources:
  - Zeek conn.log
  - Zeek dns.log
  - Internet Gateway, DNS Resolvers, Web Proxies, Cloud Egress Points
  range: last 90 days
  queries:
  - technology: Pseudocode
    query: STREAM network_events | EXTRACT_FEATURES (duration, bytes, protocol, domain_entropy) | PREDICT likelihood = ML_MODEL(features) | ALERT WHERE likelihood > risk_threshold
- question: Is known proxyware, botnet, or crypto-mining software being executed on any hosts?
  context: This question looks for the most direct evidence of bandwidth hijacking software on an endpoint. By monitoring process creation events for specific process names, command-line arguments, or file hashes associated with these tools, an analyst can confirm that a host has been compromised for resource abuse.
  answer_sources:
  - Windows Event ID 4688
  - Workstations, Servers, Virtual Desktop Infrastructure (VDI) fleet, Domain Controllers
  range: last 90 days
  queries:
  - technology: Pseudocode
    query: SEARCH process_creation_logs | WHERE process_name IN ('xmrig.exe', 'honeygain.exe') OR command_line CONTAINS ('--pool', '-service')
- question: Are commonly abused system processes being executed with rare or suspicious command-line arguments?
  context: Adversaries often use legitimate system utilities (like powershell.exe or rundll32.exe) to execute malicious code, a technique known as living-off-the-land. This question aims to detect such abuse by identifying when these processes are run with statistically unusual argument combinations, which can indicate the presence of fileless malware used for bandwidth hijacking.
  answer_sources:
  - Windows Event ID 4688
  - Workstations, Servers, Virtual Desktop Infrastructure (VDI) fleet, Domain Controllers
  range: last 90 days
  queries:
  - technology: Pseudocode
    query: SEARCH process_creation_logs | PROFILE command_line BY process_name | IDENTIFY rare_combinations | ALERT on execution of rare command_line
- question: Can we detect anomalous process executions that deviate from normal host activity?
  context: This question uses unsupervised machine learning to establish a baseline of normal process activity on hosts. By flagging executions that have a high anomaly score, this approach can detect novel or heavily obfuscated malware used for bandwidth hijacking that might not have known signatures or patterns.
  answer_sources:
  - Windows Event ID 4688
  - Workstations, Servers, Virtual Desktop Infrastructure (VDI) fleet, Domain Controllers
  range: last 90 days
  queries:
  - technology: Pseudocode
    query: STREAM process_events | EXTRACT_FEATURES (parent_process, cmd_entropy, user) | CALCULATE anomaly_score = ML_MODEL(features) | ALERT WHERE anomaly_score > threshold
- question: Are internal hosts querying DNS for domains associated with cryptocurrency mining pools, proxyware C2, or botnets?
  context: This question uses DNS logs as a high-fidelity source for detecting malicious activity. Since bandwidth hijacking tools often need to resolve domains for C2 or mining pools, matching DNS queries against a threat intelligence list of such domains provides a strong indicator of compromise.
  answer_sources:
  - Zeek dns.log
  - Internal DNS Resolvers, Domain Controllers, Network Egress Points
  range: last 90 days
  queries:
  - technology: Pseudocode
    query: SEARCH dns_logs | JOIN mining_pool_domains ON query_name | ALERT on match
- question: Are any hosts exhibiting a sudden drop in DNS query randomness, suggesting repetitive C2 or mining communication?
  context: Normal user and system activity generates DNS requests for a wide variety of domains. In contrast, a compromised machine communicating with a C2 server or mining pool will often make highly repetitive queries to a very small set of domains. This question seeks to detect this behavior by flagging a statistically significant drop in the randomness (entropy) of a host's DNS queries.
  answer_sources:
  - Zeek dns.log
  - Internal DNS Resolvers, Domain Controllers, Network Egress Points
  range: last 90 days
  queries:
  - technology: Pseudocode
    query: SEARCH dns_logs | CALCULATE entropy(query_name) BY source_ip OVER 5m_window | ALERT WHERE entropy < baseline - 2*stdev
- question: Are there unusual spikes in DNS query volume from any hosts that cannot be explained by normal daily or weekly patterns?
  context: This question uses time-series analysis to model the expected DNS query volume for each host. An alert is generated when the actual volume significantly exceeds the predicted amount, which can indicate an automated process like a botnet client or P2P software generating a burst of DNS activity.
  answer_sources:
  - Zeek dns.log
  - Internal DNS Resolvers, Domain Controllers, Network Egress Points
  range: last 90 days
  queries:
  - technology: Pseudocode
    query: FORECAST dns_query_volume BY source_ip | COMPARE actual_volume with predicted_upper_bound | ALERT WHERE actual_volume > predicted_upper_bound
- question: Has any host sent an abnormally large amount of data in a single session?
  context: This question aims to catch egregious instances of data exfiltration or bandwidth consumption using a simple, high-threshold rule. While it may not catch more subtle activity, it is effective at identifying clear-cut cases where a host is moving an amount of data that is almost certainly not related to legitimate business functions.
  answer_sources:
  - Zeek conn.log
  - Network Firewalls, Internet Gateway, Core Switches, Cloud VPC Flow Logs
  range: last 90 days
  queries:
  - technology: Pseudocode
    query: SEARCH network_conn_logs | WHERE outbound_bytes > 10GB AND duration < 1h | ALERT on source_ip
- question: Is any host's outbound network traffic volume statistically anomalous compared to its own history?
  context: This question establishes a dynamic baseline of normal outbound bandwidth usage for each host. By alerting when a host's traffic significantly exceeds its own historical average (e.g., by more than 3 standard deviations), this method can detect sustained bandwidth abuse that is abnormal for that specific host, even if the total volume isn't extreme.
  answer_sources:
  - Zeek conn.log
  - Network Firewalls, Internet Gateway, Core Switches, Cloud VPC Flow Logs
  range: last 90 days
  queries:
  - technology: Pseudocode
    query: SEARCH network_conn_logs | AGGREGATE sum(outbound_bytes) BY source_ip OVER 10m_intervals | ALERT WHERE current_usage > (30d_avg + 3*stdev) FOR 3_consecutive_intervals
- question: Is any host exhibiting unusual spikes in outbound traffic that are not explained by its normal daily or weekly cycles?
  context: This question uses a more advanced time-series model to separate a host's traffic into normal patterns (trend, seasonality) and unexplained anomalies (residuals). This allows for the detection of unusual traffic spikes that might otherwise be hidden within the noise of regular activity, providing a sensitive method for finding anomalous bandwidth usage.
  answer_sources:
  - Zeek conn.log
  - Network Firewalls, Internet Gateway, Core Switches, Cloud VPC Flow Logs
  range: last 90 days
  queries:
  - technology: Pseudocode
    query: DECOMPOSE_TIME_SERIES outbound_bytes BY source_ip | ANALYZE residual_component | ALERT on significant_spike in residual
- question: Is any internal host sending a high rate of unanswered connection requests (SYN packets), indicative of a SYN flood attack?
  context: This question looks for a specific pattern associated with DDoS attacks where a host sends a large number of TCP SYN packets but does not complete the handshake. Monitoring for a high rate of connections in a 'S0' state (SYN sent, no reply) is a direct way to detect if an internal host is being used as a bot to conduct a SYN flood.
  answer_sources:
  - Zeek conn.log
  - Internet Gateway, Edge Routers, External-facing Firewalls
  range: last 90 days
  queries:
  - technology: Pseudocode
    query: SEARCH network_conn_logs | WHERE conn_state == 'S0' | STATS count BY source_ip OVER 1m_window | ALERT WHERE count > 100
- question: Does any host have a highly skewed ratio of outbound to inbound packets, suggesting participation in a traffic flood?
  context: In many forms of DDoS attacks, a compromised host sends a large volume of packets to a target but receives very few in return. This question identifies hosts with a statistically abnormal ratio of sent-to-received packets, which serves as a strong indicator of participation in a one-way traffic flood.
  answer_sources:
  - Zeek conn.log
  - Internet Gateway, Edge Routers, External-facing Firewalls
  range: last 90 days
  queries:
  - technology: Pseudocode
    query: SEARCH network_conn_logs | CALCULATE ratio = outbound_pkts / inbound_pkts BY source_ip | ALERT WHERE ratio > 99th_percentile_of_all_hosts
- question: Can we identify clusters of network traffic consistent with DDoS activity?
  context: This question uses unsupervised machine learning to group network connections based on their characteristics. By analyzing the resulting clusters, an analyst can identify groups of traffic that match the profile of DDoS activity (e.g., short duration, high outbound packets, low outbound bytes) and pinpoint the internal hosts generating this traffic.
  answer_sources:
  - Zeek conn.log
  - Internet Gateway, Edge Routers, External-facing Firewalls
  range: last 90 days
  queries:
  - technology: Pseudocode
    query: CLUSTER network_conn_logs ON (duration, pkts, bytes, state) | IDENTIFY clusters with DDoS_characteristics | FIND source_ips in DDoS_cluster
- question: Is any host connecting to an abnormally large number of unique destinations on a common scanning port?
  context: This question is designed to detect targeted scanning activity. When a host attempts to connect to many different IP addresses on the same port (e.g., RDP port 3389) in a short period, it is a strong indication of a worm or a bot attempting to find new victims. This rule provides a clear, signature-based method for detecting this behavior.
  answer_sources:
  - Zeek conn.log
  - Windows Event ID 5156
  - Workstation and Server Subnets, Internet Gateway, Core Switches
  range: last 90 days
  queries:
  - technology: Pseudocode
    query: SEARCH network_conn_logs | STATS distinct_count(destination_ip) BY source_ip, destination_port OVER 1m_window | WHERE destination_port IN (23, 445, 3389) AND distinct_count > 50
- question: Is any host connecting to a statistically unusual number of unique destination IPs compared to its peers or its own history?
  context: This question provides a more general approach to detecting scanning or P2P communication. By establishing a baseline for the number of unique destinations a host typically communicates with, it can flag any significant deviation. This can detect less obvious scanning that doesn't use common ports or internet-wide P2P communication used by some botnets.
  answer_sources:
  - Zeek conn.log
  - Windows Event ID 5156
  - Workstation and Server Subnets, Internet Gateway, Core Switches
  range: last 90 days
  queries:
  - technology: Pseudocode
    query: SEARCH network_conn_logs | STATS distinct_count(destination_ip) BY source_ip OVER 5m_window | ALERT WHERE distinct_count > baseline_Q3 + 1.5*IQR
- question: Can we classify a host's traffic as normal, targeted scanning, or internet-wide scanning based on its characteristics?
  context: This question uses machine learning to automatically classify the nature of a host's outbound connections. By analyzing the randomness (entropy) of destination IPs and ports, a model can distinguish between normal behavior and different types of scanning, providing a sophisticated method for detecting various forms of malicious reconnaissance or botnet activity.
  answer_sources:
  - Zeek conn.log
  - Windows Event ID 5156
  - Workstation and Server Subnets, Internet Gateway, Core Switches
  range: last 90 days
  queries:
  - technology: Pseudocode
    query: CALCULATE entropy(dest_ip), entropy(dest_port) BY source_ip | PREDICT traffic_type = ML_MODEL(ip_entropy, port_entropy) | ALERT WHERE traffic_type == 'scanning'