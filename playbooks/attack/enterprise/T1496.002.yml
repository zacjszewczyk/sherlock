name: T1496.002: Bandwidth Hijacking
id: 8f9b2c1d-6e4a-4b0f-8c3d-9e1a2b3c4d5e
description: "Identifies if an adversary is causing network impact through bandwidth hijacking. This is indicated by observed network connections to malicious IPs/domains (botnets, proxyware, TOR), the creation of processes associated with proxyware or miners, unusual DNS activity (high volume, malicious domains), abnormally high outbound traffic volume, connection patterns consistent with DDoS attacks, or network scanning activity directed at numerous unique destinations."
type: technique
related:
  - TA0040: Impact
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Are any internal hosts making network connections to external destinations known to be associated with botnet C2s, proxyware services, TOR nodes, or malicious scanners?
    context: This question seeks to identify direct communication with known malicious infrastructure by matching network logs against high-confidence threat intelligence. A positive match is a strong indicator that a host is compromised and its bandwidth is being used for nefarious purposes like botnet operations or proxying traffic.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Internet Gateway
      - DNS Resolvers
      - Web Proxies
      - Cloud Egress Points
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          QUERY network_logs
          WHERE destination_ip IN (threat_intel_botnet_c2_list) OR
                destination_domain IN (threat_intel_proxyware_list) OR
                destination_ip IN (threat_intel_tor_exit_node_list)
          ALERT on matches
  - question: Are any internal hosts directing an anomalously high percentage of their outbound connections to IP addresses with a poor reputation?
    context: This question uses statistical analysis to find hosts exhibiting suspicious, but not definitively malicious, network behavior. By flagging hosts whose traffic to low-reputation IPs exceeds their own baseline or that of their peers, analysts can uncover potential bandwidth hijacking that might be missed by signature-based methods alone.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Internet Gateway
      - DNS Resolvers
      - Web Proxies
      - Cloud Egress Points
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each host:
            CALCULATE percentage_of_connections_to_low_rep_ips
            COMPARE to 95th_percentile_of_host_baseline
            COMPARE to 95th_percentile_of_peer_group_baseline
          ALERT if percentage > threshold
  - question: Can we predict which network connections are likely associated with bandwidth hijacking based on their characteristics?
    context: This question leverages a machine learning classification model to proactively identify suspicious connections. By training on features like connection duration, data volume, and domain entropy, the model can score new connections for their likelihood of being related to bandwidth hijacking, enabling detection of novel or evasive threats.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Internet Gateway
      - DNS Resolvers
      - Web Proxies
      - Cloud Egress Points
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each new network_connection:
            EXTRACT features (duration, bytes, protocol, etc.)
            PREDICT probability = classification_model(features)
          ALERT if probability > risk_threshold
  - question: Are there any processes being created that match the names or command-line arguments of known proxyware, cryptocurrency miners, or botnet clients?
    context: This question aims to detect the execution of malicious software associated with bandwidth hijacking directly on endpoints. By monitoring for specific process names (e.g., 'xmrig.exe') or command-line flags (e.g., '--pool'), analysts can catch the initial execution of these tools.
    answer_sources:
      - Windows Event ID 4688
      - Workstations
      - Servers
      - Virtual Desktop Infrastructure (VDI) fleet
      - Domain Controllers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          QUERY process_creation_logs (EventID 4688)
          WHERE process_name IN (known_miner_proxy_list) OR
                command_line CONTAINS (known_miner_proxy_args)
          ALERT on matches
  - question: Are commonly abused system processes (like powershell.exe) being executed with statistically rare or never-before-seen command-line arguments?
    context: This question helps to identify legitimate processes being used for malicious purposes (living-off-the-land). Attackers often use standard utilities with unusual arguments to evade simple signature-based detection. Flagging these statistical anomalies can reveal hidden malware execution.
    answer_sources:
      - Windows Event ID 4688
      - Workstations
      - Servers
      - Virtual Desktop Infrastructure (VDI) fleet
      - Domain Controllers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each execution of 'powershell.exe', 'rundll32.exe', etc.:
            CALCULATE frequency of argument_combination
          ALERT if frequency is anomalously low or zero
  - question: Can we detect anomalous process executions that deviate significantly from a learned baseline of normal activity?
    context: This question uses an unsupervised anomaly detection model to identify unusual process behavior without relying on predefined signatures. By analyzing features like parent-child process relationships and command-line characteristics, the model can flag novel or obfuscated malware that would otherwise go unnoticed.
    answer_sources:
      - Windows Event ID 4688
      - Workstations
      - Servers
      - Virtual Desktop Infrastructure (VDI) fleet
      - Domain Controllers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each new process_execution:
            EXTRACT features (parent_process, cmd_length, entropy, etc.)
            CALCULATE anomaly_score = anomaly_detection_model(features)
          ALERT if anomaly_score > threshold
  - question: Are any internal hosts querying DNS for domains known to be associated with cryptocurrency mining pools, proxyware C2, or botnets?
    context: This question focuses on detecting the reconnaissance or communication phase of bandwidth hijacking malware. By checking DNS queries against threat intelligence lists, analysts can identify hosts attempting to resolve malicious domains, often a precursor to establishing a connection.
    answer_sources:
      - Zeek dns.log
      - Internal DNS Resolvers
      - Domain Controllers
      - Network Egress Points
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          QUERY dns_logs
          WHERE queried_domain IN (known_mining_pool_list) OR
                queried_domain IN (known_proxyware_c2_list)
          ALERT on matches
  - question: Are any hosts exhibiting a significant drop in DNS query entropy, suggesting repetitive lookups to a small set of domains?
    context: A host that is repeatedly querying the same few domains will have a much lower DNS query entropy than a host used for normal web browsing. A sharp drop from its own baseline is a strong indicator of automated, non-human activity like C2 beaconing.
    answer_sources:
      - Zeek dns.log
      - Internal DNS Resolvers
      - Domain Controllers
      - Network Egress Points
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each host:
            CALCULATE shannon_entropy of queried_domains over 5_min_window
            COMPARE to host's historical baseline
          ALERT if entropy drops > 2 standard deviations from baseline
  - question: Are any hosts showing a sudden spike in DNS query volume that cannot be explained by normal daily or weekly patterns?
    context: This question uses time series forecasting to establish a sophisticated baseline of expected DNS activity for each host. An alert is generated when the actual query volume significantly exceeds the predicted volume, which can indicate a burst of automated activity from newly activated malware or a bot.
    answer_sources:
      - Zeek dns.log
      - Internal DNS Resolvers
      - Domain Controllers
      - Network Egress Points
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each host:
            MODEL normal DNS query volume using time_series_model (e.g., SARIMA)
            PREDICT upper_confidence_bound for current time
            OBSERVE current_dns_volume
          ALERT if current_dns_volume > upper_confidence_bound
  - question: Has any internal host exceeded a hard threshold for outbound data transfer to a single destination, suggesting a large, unauthorized data egress?
    context: This question uses a simple but effective static threshold to catch egregious cases of bandwidth consumption. An alert for a massive data transfer (e.g., 10GB in an hour) to a single IP warrants immediate investigation as it is highly abnormal for most user activities.
    answer_sources:
      - Zeek conn.log
      - Network Firewalls
      - Internet Gateway
      - Core Switches
      - Cloud VPC Flow Logs
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          QUERY network_logs
          AGGREGATE outbound_bytes by source_ip, destination_ip over 1_hour
          WHERE aggregated_bytes > 10GB
          ALERT on matches
  - question: Is any host's current outbound bandwidth usage significantly higher than its own dynamic, historical baseline?
    context: This question employs a dynamic, host-specific baseline to detect anomalous traffic volume. By comparing current usage to a 30-day rolling average, this method is more sensitive and adaptable than a static threshold, allowing it to flag sustained, abnormal increases in bandwidth consumption.
    answer_sources:
      - Zeek conn.log
      - Network Firewalls
      - Internet Gateway
      - Core Switches
      - Cloud VPC Flow Logs
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each host:
            CALCULATE 30-day_rolling_avg and std_dev of outbound_bytes
            MEASURE current_outbound_bytes
          ALERT if current_outbound_bytes > (avg + 3 * std_dev) for 3 consecutive intervals
  - question: Is there a spike in a host's outbound traffic that is anomalous after accounting for regular trends and seasonal patterns?
    context: This question uses a sophisticated time series decomposition model to isolate true anomalies from predictable traffic patterns (e.g., daily backup jobs). By stripping away the trend and seasonal components, the model can flag spikes in the 'residual' data, which represent unexpected and potentially malicious bandwidth usage.
    answer_sources:
      - Zeek conn.log
      - Network Firewalls
      - Internet Gateway
      - Core Switches
      - Cloud VPC Flow Logs
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each host's traffic time_series:
            DECOMPOSE into trend, seasonal, and residual components
          ALERT on significant spikes in the residual component
  - question: Is any internal host generating a high rate of unanswered connection attempts (TCP SYN packets with no reply)?
    context: This question looks for a classic indicator of a host participating in a SYN flood DDoS attack. A high volume of connections in the 'S0' state (SYN sent, no reply received) from a single source strongly suggests it is being used to overwhelm a target with connection requests.
    answer_sources:
      - Zeek conn.log
      - Internet Gateway
      - Edge Routers
      - External-facing Firewalls
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          QUERY network_logs
          COUNT connections where state = 'S0' by source_ip per minute
          ALERT if count > 100
  - question: Does any host exhibit a highly asymmetric ratio of outbound to inbound packets, suggesting one-way traffic flooding?
    context: This question identifies hosts that are sending a large amount of traffic without receiving much in return, a pattern consistent with various flood-based DDoS attacks. Identifying hosts with a packet ratio that is a statistical outlier compared to their peers can pinpoint compromised machines.
    answer_sources:
      - Zeek conn.log
      - Internet Gateway
      - Edge Routers
      - External-facing Firewalls
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each host:
            CALCULATE ratio = outbound_packets / inbound_packets per minute
          ALERT if ratio exceeds 99th percentile of all hosts
  - question: Does a host's network traffic fall into a cluster characterized by patterns consistent with DDoS activity?
    context: This question uses unsupervised clustering to group network flows based on their characteristics. The goal is to see if any clusters emerge that match the profile of DDoS traffic (e.g., short duration, high outbound packets, low data volume). Internal hosts whose traffic belongs to such a cluster are likely compromised.
    answer_sources:
      - Zeek conn.log
      - Internet Gateway
      - Edge Routers
      - External-facing Firewalls
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          CLUSTER all network flows using K-Means on features (duration, packets, bytes, state)
          IDENTIFY clusters matching DDoS profile
          INVESTIGATE source hosts contributing to those clusters
  - question: Is any internal host connecting to an abnormally large number of unique destination IPs on a common scanning port within a short time frame?
    context: This question aims to detect network scanning behavior, where a compromised host is used to probe other systems for vulnerabilities. A rule that triggers on a high count of unique destinations on a specific port (like RDP port 3389 or Telnet port 23) is a strong indicator of scanning.
    answer_sources:
      - Zeek conn.log
      - Windows Event ID 5156
      - Workstation and Server Subnets
      - Internet Gateway
      - Core Switches
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          QUERY network_logs
          COUNT distinct destination_ips by source_ip on specific ports (23, 445, 3389) per minute
          ALERT if count > 50
  - question: Are any hosts connecting to a number of distinct destination IPs that is statistically anomalous compared to their peer group or their own history?
    context: This question uses statistical methods to identify scanning behavior that may not hit a hard-coded threshold. By comparing the count of unique destinations to a baseline (either peer-based or self-based) using a method like the IQR, analysts can detect more subtle or slow scanning activity.
    answer_sources:
      - Zeek conn.log
      - Windows Event ID 5156
      - Workstation and Server Subnets
      - Internet Gateway
      - Core Switches
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each host:
            CALCULATE distinct_destination_count in 5_min_window
            COMPARE count to peer group 98th percentile
            COMPARE count to host's own IQR baseline
          ALERT if anomalous
  - question: Can we classify a host's traffic as normal, targeted scanning, or internet-wide scanning based on the entropy of destination IPs and ports?
    context: This question leverages machine learning to provide a more nuanced classification of scanning. By analyzing the entropy of both destination IPs and ports, a model can differentiate between normal activity, port scanning a single target (low IP entropy, high port entropy), and host discovery across a network (high IP entropy).
    answer_sources:
      - Zeek conn.log
      - Windows Event ID 5156
      - Workstation and Server Subnets
      - Internet Gateway
      - Core Switches
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each host:
            CALCULATE entropy of destination_ips and destination_ports
            CLASSIFY traffic_type = classifier_model(ip_entropy, port_entropy)
          ALERT if traffic_type is 'scanning'