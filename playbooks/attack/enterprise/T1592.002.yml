name: T1592.002: Software
id: 5f9b9b3e-3b7d-4b1e-8f9a-2e7b8c7d6e5f
description: This playbook helps investigate whether an adversary is gathering information about an organization's software. This involves detecting activities such as scanning from malicious IP addresses, probing for specific software vulnerabilities using characteristic tool signatures, enumerating services through high-volume connection attempts, triggering verbose errors to leak system information, and identifying internal hosts communicating with malicious domains associated with reconnaissance frameworks. The goal is to identify reconnaissance efforts aimed at discovering the software and services used within the environment to plan for future exploitation.
type: technique
related:
- TA0043: Reconnaissance
contributors:
- Zachary Szewczyk
- Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: '1.0'
tags: none
questions:
- question: Are inbound source IP addresses from Zeek conn.log traffic matching known malicious IPs from a threat intelligence feed of scanners, TOR nodes, malicious proxies, or C2 infrastructure?
  context: This question helps detect initial reconnaissance attempts by correlating inbound traffic with known malicious actors. A match against a threat intelligence feed is a high-fidelity indicator that an external entity is performing targeted scanning or probing of the network perimeter.
  answer_sources:
  - Zeek conn.log
  - Network perimeter/internet gateway
  - Firewall logs
  - External-facing DNS servers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR each connection in inbound_zeek_connections
      IF connection.source_ip is in threat_intelligence_feed
        CREATE alert for potential reconnaissance
- question: Are any external source IPs exhibiting port scanning behavior by connecting to a disproportionately high number of unique destination ports within a short time frame?
  context: Port scanning is a common technique adversaries use to map open services on a target. This question identifies this behavior by flagging source IPs that show a high ratio of unique ports contacted versus total connections, which is a strong statistical indicator of a scan rather than legitimate traffic.
  answer_sources:
  - Zeek conn.log
  - Network perimeter/internet gateway
  - Firewall logs
  - External-facing DNS servers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR each source_ip in a 5_minute_window
        CALCULATE ratio = unique_destination_ports / total_connections
        IF ratio is in the top 99th percentile
          CREATE alert for port scanning behavior
- question: Are we observing a significant and anomalous volume of connections from IP addresses classified as high-risk by a reputation model?
  context: This question leverages machine learning to proactively identify threats. It uses an IP reputation model to score incoming connections and a time series forecast to detect unusual spikes in traffic from these high-risk sources, which could indicate a coordinated reconnaissance campaign that deviates from normal traffic patterns.
  answer_sources:
  - Zeek conn.log
  - Network perimeter/internet gateway
  - Firewall logs
  - External-facing DNS servers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR each inbound_ip
        SCORE ip_risk using pre-trained_reputation_model
      FORECAST expected connection volume from high-risk_ips
      IF observed_volume > forecasted_upper_bound
        CREATE alert for anomalous high-risk traffic volume
- question: Are inbound HTTP/S requests containing User-Agent strings, URI paths, or JA3/JA3S hashes that match signatures of known scanning tools or vulnerability probes?
  context: This question looks for specific, tell-tale signs of automated scanning tools like Nmap, Nikto, or Metasploit, or attempts to find sensitive files (e.g., .git/config). These signatures provide direct, high-confidence evidence of an adversary trying to identify the software and potential vulnerabilities on web-facing assets.
  answer_sources:
  - Zeek http.log
  - Zeek ssl.log
  - Public-facing web servers
  - Reverse proxies
  - Web Application Firewalls (WAFs)
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR each inbound http_or_ssl_request
      IF request.user_agent OR request.uri OR request.ja3_hash MATCHES known_scanner_signatures
        CREATE alert for scanning tool activity
- question: Are any external source IPs generating HTTP requests with unusually high URI path entropy, suggesting directory or file enumeration?
  context: This question aims to detect brute-force attempts to discover hidden files or directories. High Shannon entropy (randomness) in the requested URIs from a single source is a strong statistical indicator of an automated tool trying to guess valid paths, as opposed to a human navigating a website.
  answer_sources:
  - Zeek http.log
  - Zeek ssl.log
  - Public-facing web servers
  - Reverse proxies
  - Web Application Firewalls (WAFs)
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR each source_ip in a 10_minute_window
        CALCULATE shannon_entropy of requested_uri_paths
        IF entropy_score > 98th percentile of baseline
          CREATE alert for file or directory enumeration
- question: Are inbound HTTP requests being classified as malicious scanning activity by a machine learning model based on their features?
  context: This question uses a supervised machine learning model to distinguish between normal user traffic and automated scanning. By analyzing features like URI length, character patterns, and User-Agent rarity, the model can identify suspicious requests that may not be caught by simple signature matching, providing a more robust detection method.
  answer_sources:
  - Zeek http.log
  - Zeek ssl.log
  - Public-facing web servers
  - Reverse proxies
  - Web Application Firewalls (WAFs)
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR each inbound http_request
        APPLY logistic_regression_classifier
        IF classification is "malicious_scan" with high_confidence
          CREATE alert for ML-detected scanning
- question: Is any single external source IP generating an excessive number of connections to distinct destination ports within a one-minute window?
  context: This is a direct, rule-based question to detect blatant port scanning. A high volume of connection attempts across many ports from a single IP is a classic indicator of an adversary mapping the attack surface. A simple threshold (e.g., >100 distinct ports in 60 seconds) can effectively catch this noisy activity.
  answer_sources:
  - Zeek conn.log
  - Zeek http.log
  - Demilitarized Zone (DMZ)
  - Network edge firewalls
  - Public-facing application servers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR each source_ip in a 1_minute_window
        COUNT distinct destination_ports
        IF distinct_port_count > 100
          CREATE alert for high-volume port scanning
- question: Are any external source IPs causing an unusually high rate of HTTP 404 'Not Found' errors, indicating web content enumeration?
  context: This question identifies attackers who are scanning for non-existent web pages or directories (forceful browsing). A spike in 404 errors from a single IP is a strong statistical signal that an automated tool is guessing paths, as it deviates significantly from the baseline error rate for normal traffic.
  answer_sources:
  - Zeek conn.log
  - Zeek http.log
  - Demilitarized Zone (DMZ)
  - Network edge firewalls
  - Public-facing application servers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR each external source_ip in a 5_minute_window
        CALCULATE rate of http_404_responses
        IF rate > 95th percentile of baseline
          CREATE alert for web content enumeration
- question: Does clustering analysis of connection events reveal anomalous, sparse clusters of activity indicative of targeted scanning from a single source?
  context: This question uses an unsupervised machine learning approach (like DBSCAN) to find unusual patterns. Normal traffic forms dense clusters, while a targeted scan across multiple ports from a single source would appear as a sparse, anomalous cluster, allowing for detection of stealthy reconnaissance without pre-defined signatures.
  answer_sources:
  - Zeek conn.log
  - Zeek http.log
  - Demilitarized Zone (DMZ)
  - Network edge firewalls
  - Public-facing application servers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      APPLY DBSCAN clustering on connection_events (source_ip, dest_port, protocol)
      FOR each cluster identified as anomaly/noise
        CREATE alert for anomalous cluster activity
- question: Are HTTP responses to external IPs containing verbose error messages or specific software version banners?
  context: This question looks for information leakage that an adversary could exploit. Verbose errors (like stack traces, database errors) or software banners (like 'Apache/2.4.54') reveal underlying technologies and versions, which helps an attacker find and tailor exploits for known vulnerabilities.
  answer_sources:
  - Zeek http.log
  - Windows Application Event Log
  - Public-facing web servers and applications
  - Application-level logging systems
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      SEARCH http_response_bodies and application_logs
      FOR regex_patterns matching 'stack trace', 'fatal error', or software_version_banners
      IF match found in response to an external_ip
        CREATE alert for information leakage
- question: Are we observing a statistically significant deviation in the distribution of HTTP status codes, such as a spike in 5xx server errors, correlated with a single source IP?
  context: This question detects when an attacker's probing causes an application to fail. A sudden increase in server-side errors (5xx codes) linked to a specific source IP suggests that malformed or crafted requests are successfully finding bugs or stressing the application, which is a key reconnaissance finding.
  answer_sources:
  - Zeek http.log
  - Windows Application Event Log
  - Public-facing web servers and applications
  - Application-level logging systems
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      MONITOR distribution of http_status_codes per application
      USE Chi-squared test to detect significant deviation from baseline
      IF deviation is a spike in 5xx errors and correlates with a single source_ip
        CREATE alert for potential application probing
- question: Is a time series anomaly detection model identifying unusually large server response sizes, which could indicate the presence of a verbose error message?
  context: This question uses machine learning to detect information leakage by focusing on response size. A large, verbose error message or a stack trace will create an anomalously large response compared to normal content, which a time series model (like an LSTM autoencoder) can detect as a deviation from the norm.
  answer_sources:
  - Zeek http.log
  - Windows Application Event Log
  - Public-facing web servers and applications
  - Application-level logging systems
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      APPLY LSTM autoencoder to time series of response_sizes per application
      IF reconstruction_error for a response is anomalously high
        CREATE alert for potentially large error message in response
- question: Are any internal hosts resolving and connecting to domains known to host reconnaissance frameworks or malicious infrastructure?
  context: This question aims to detect a compromised internal host being used for further reconnaissance (e.g., via a ScanBox framework) or as part of a watering hole attack. A DNS query and subsequent connection to a known malicious domain from an internal machine is a high-confidence indicator of compromise.
  answer_sources:
  - Zeek conn.log
  - Zeek dns.log
  - Zeek http.log
  - Zeek files.log
  - Windows Event ID 4688
  - Internal user workstations
  - DNS resolvers
  - Egress points/Network proxy servers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR each outbound DNS query from an internal_host
      IF query.domain is in malicious_domain_threat_feed
        CREATE alert for connection to known malicious domain
- question: Are any internal hosts querying an anomalously high number of newly registered domains (NRDs) compared to their peers?
  context: This question identifies suspicious outbound activity, as adversaries often use NRDs for command and control, phishing, or watering hole attacks. A host contacting significantly more NRDs than its peers is a statistical anomaly that warrants investigation for potential compromise.
  answer_sources:
  - Zeek conn.log
  - Zeek dns.log
  - Zeek http.log
  - Zeek files.log
  - Windows Event ID 4688
  - Internal user workstations
  - DNS resolvers
  - Egress points/Network proxy servers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR each internal_host
        COUNT DNS queries to domains registered < 30 days ago
        CALCULATE mean and std_dev for peer group
        IF host_count > mean + (3 * std_dev)
          CREATE alert for anomalous NRD activity
- question: Are outbound web connections from internal hosts being classified as high-risk by a machine learning model based on domain features?
  context: This question provides a dynamic risk score for outbound connections, helping to prioritize alerts. A model using features like domain age, domain reputation, and TLD can proactively identify connections to potentially malicious sites that might be part of a watering hole attack or C2 communication, even if the domain is not yet on a threat list.
  answer_sources:
  - Zeek conn.log
  - Zeek dns.log
  - Zeek http.log
  - Zeek files.log
  - Windows Event ID 4688
  - Internal user workstations
  - DNS resolvers
  - Egress points/Network proxy servers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR each outbound web_connection
        SCORE risk using random_forest_classifier (features: domain_age, reputation, etc.)
        IF risk_score is "high"
          CREATE alert for high-risk outbound connection