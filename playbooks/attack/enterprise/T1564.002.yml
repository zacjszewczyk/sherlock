name: T1564.002: Hidden Users
id: 123e4567-e89b-12d3-a456-426614174000
description: This playbook helps investigate attempts by adversaries to evade defenses by creating hidden user accounts. Indicators of this activity include the creation of new users with anomalous names (e.g., high entropy, non-standard characters), registry modifications to hide user accounts from the login screen by setting a value to '0' under `HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\SpecialAccounts\UserList`, the use of command-line utilities like `reg.exe` to perform these registry changes, a rapid sequence of user creation followed by the hiding action, and any authentication or network activity from an account that is confirmed to be hidden.
type: technique
related:
  - TA0005: Defense Evasion
contributors:
  - Zachary Szewczyk
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Has a new user account been created with a name matching known malicious patterns or threat intelligence?
    context: Adversaries often use specific tools or scripts that generate predictable or known malicious usernames. This question aims to identify user creation events where the username matches a predefined watchlist of malicious names or conforms to a regular expression pattern associated with known adversary tooling. A match provides a high-confidence indicator of compromise.
    answer_sources:
      - Windows Event ID 4720
      - Domain Controllers, Member Servers, Endpoint Devices
    range: last 90 days
    queries:
      - language: pseudocode
        query: SEARCH user_creation_events (WinEvent:4720) WHERE username MATCHES (threat_intel_list OR regex_pattern)
  - question: Has a new user account been created with a name exhibiting unusually high randomness (entropy)?
    context: To avoid simple signature-based detection, adversaries may generate random-looking usernames. This question focuses on detecting such names by calculating their Shannon entropy. A username with an entropy score significantly higher than the established baseline for legitimate users suggests it may have been algorithmically generated and warrants investigation.
    answer_sources:
      - Windows Event ID 4720
      - Domain Controllers, Member Servers, Endpoint Devices
    range: last 90 days
    queries:
      - language: pseudocode
        query: SEARCH user_creation_events (WinEvent:4720) | CALCULATE entropy(username) | FILTER entropy > baseline_98th_percentile
  - question: Does a newly created username deviate from the typical character patterns of existing legitimate usernames?
    context: This question uses machine learning to identify anomalous usernames. By training a model on the character patterns (n-grams) of all known-good usernames, it can learn what 'normal' looks like. Any new username that the model flags as an 'outlier' is structurally different from legitimate names and could be malicious.
    answer_sources:
      - Windows Event ID 4720
      - Domain Controllers, Member Servers, Endpoint Devices
    range: last 90 days
    queries:
      - language: pseudocode
        query: SEARCH user_creation_events (WinEvent:4720) | APPLY ML_model(username) | FILTER classification == 'outlier'
  - question: Has the registry been modified to hide a user account from the login screen?
    context: A common technique to hide a user account on a Windows system is to add it to the 'SpecialAccounts\UserList' registry key and set its value to '0'. This action is highly suspicious and rarely legitimate. This question directly searches for this specific registry modification, which is a strong indicator of an adversary attempting to maintain a hidden presence.
    answer_sources:
      - Windows Event ID 4657
      - Windows Event ID 4688
      - Windows Endpoint and Server Registries
    range: last 90 days
    queries:
      - language: pseudocode
        query: SEARCH registry_events (WinEvent:4657) WHERE object_name CONTAINS '\Winlogon\SpecialAccounts\UserList\' AND value_data == 0
  - question: Was the registry key for hiding user accounts modified by an unusual or unexpected process?
    context: While administrative tools might legitimately modify the registry, it is highly unusual for applications like Microsoft Word or a web browser to do so. This question aims to identify when a non-standard parent process is responsible for modifying the 'SpecialAccounts\UserList' key, suggesting a process injection or a script executed from a compromised application.
    answer_sources:
      - Windows Event ID 4657
      - Windows Event ID 4688
      - Windows Endpoint and Server Registries
    range: last 90 days
    queries:
      - language: pseudocode
        query: SEARCH registry_events (WinEvent:4657/4688) WHERE object_name CONTAINS '\SpecialAccounts\UserList\' | FILTER parent_process NOT IN (baseline_admin_tools)
  - question: Is there a sudden spike or anomalous frequency in modifications to the registry key used for hiding user accounts on a specific host?
    context: Adversaries may use scripts to hide multiple accounts or attempt to hide an account repeatedly. This question uses time-series analysis to detect an abnormal burst of modification activity to the 'SpecialAccounts\UserList' key. A sudden increase compared to the historical baseline for a host can indicate an automated attack.
    answer_sources:
      - Windows Event ID 4657
      - Windows Event ID 4688
      - Windows Endpoint and Server Registries
    range: last 90 days
    queries:
      - language: pseudocode
        query: SEARCH registry_events (WinEvent:4657/4688) WHERE object_name CONTAINS '\SpecialAccounts\UserList\' | AGGREGATE count by hour, host | APPLY time_series_model | FILTER count > forecast_upper_bound
  - question: Was the command-line utility 'reg.exe' used to hide a user account?
    context: Adversaries frequently use built-in command-line tools like 'reg.exe' to perform actions, as it helps them blend in with normal administrative activity. This question looks for the specific command-line execution of 'reg.exe' with arguments that add or modify the 'SpecialAccounts\UserList' key to hide a user, which is a strong indicator of malicious intent.
    answer_sources:
      - Windows Event ID 4688
      - Endpoint Command-Line Logs, Server Command-Line Logs
    range: last 90 days
    queries:
      - language: pseudocode
        query: SEARCH process_creation_events (WinEvent:4688) WHERE process_name == 'reg.exe' AND command_line MATCHES /add ".*\SpecialAccounts\UserList.*" \/d 0/
  - question: Did an unlikely parent process spawn 'reg.exe' to hide a user account?
    context: Similar to direct registry modifications, the parent process that spawns 'reg.exe' provides crucial context. A legitimate administrator is likely to run this from a standard command prompt or administrative script. This question seeks to identify instances where an unusual parent, such as an Office application, spawns 'reg.exe' to hide a user, suggesting a compromised process is being used to execute commands.
    answer_sources:
      - Windows Event ID 4688
      - Endpoint Command-Line Logs, Server Command-Line Logs
    range: last 90 days
    queries:
      - language: pseudocode
        query: SEARCH process_creation_events (WinEvent:4688) WHERE process_name == 'reg.exe' AND command_line CONTAINS 'SpecialAccounts\UserList' | CALCULATE probability(parent_process) | FILTER probability < threshold
  - question: Based on its execution context, does a 'reg.exe' process appear to be malicious activity rather than benign administration?
    context: This question leverages a machine learning model to differentiate between legitimate and malicious use of 'reg.exe'. By analyzing features like command-line entropy, parent process, and argument structure, the model can classify 'reg.exe' executions that modify the user list. This helps to automatically flag suspicious instances that might otherwise be missed by simple rules.
    answer_sources:
      - Windows Event ID 4688
      - Endpoint Command-Line Logs, Server Command-Line Logs
    range: last 90 days
    queries:
      - language: pseudocode
        query: SEARCH process_creation_events (WinEvent:4688) WHERE process_name == 'reg.exe' | EXTRACT_FEATURES(command_line, parent_process) | APPLY ML_model | FILTER classification == 'malicious'
  - question: Was a user account created and then immediately hidden?
    context: Adversaries often automate their actions. Creating a user and then quickly hiding it is a common and highly suspicious sequence of events. This question uses a correlation rule to detect this specific patternâ€”a user creation event followed by a registry modification to hide that same user on the same host within a short time frame (e.g., 5 minutes).
    answer_sources:
      - Windows Event ID 4720
      - Windows Event ID 4657
      - Windows Event ID 4688
      - Domain Controllers, Endpoint Device Event Logs, Server Event Logs
    range: last 90 days
    queries:
      - language: pseudocode
        query: CORRELATE user_creation_events (WinEvent:4720) AS E1 WITH registry_modification_events (WinEvent:4657/4688) AS E2 ON (hostname, username) WHERE timestamp(E2) - timestamp(E1) < 5 minutes
  - question: Is the time between user creation and the action to hide the user statistically unusual?
    context: Legitimate administrative processes for user creation and modification are typically not performed in immediate succession. This question analyzes the time delay between user creation and the hiding action. A very short delay is anomalous and suggests automated, malicious activity, as opposed to separate, manual administrative tasks.
    answer_sources:
      - Windows Event ID 4720
      - Windows Event ID 4657
      - Windows Event ID 4688
      - Domain Controllers, Endpoint Device Event Logs, Server Event Logs
    range: last 90 days
    queries:
      - language: pseudocode
        query: CORRELATE user_creation (4720) WITH user_hiding (4657/4688) | CALCULATE time_delta | FILTER time_delta < 5th_percentile_baseline
  - question: Did an anomalous sequence of security events, such as 'Create User' immediately followed by 'Hide User', occur?
    context: User activity on a system typically follows predictable event sequences (e.g., create, logon, logoff). This question uses a sequence analysis model to learn these normal patterns. An alert is triggered when an unlikely sequence, such as creating a user and then immediately hiding it without any intervening logon activity, is detected. This points to a deviation from normal behavior and is a strong indicator of malicious scripting.
    answer_sources:
      - Windows Event ID 4720
      - Windows Event ID 4657
      - Windows Event ID 4688
      - Domain Controllers, Endpoint Device Event Logs, Server Event Logs
    range: last 90 days
    queries:
      - language: pseudocode
        query: SEARCH security_events (4720, 4657, etc.) by user, host | APPLY sequence_analysis_model | FILTER sequence_probability < threshold AND sequence == [CreateUser, HideUser]
  - question: Is a known hidden user account showing any authentication or network activity?
    context: A hidden user account should, by definition, not be used for interactive logons or other activities. This question aims to detect any activity whatsoever from an account confirmed to be hidden. By maintaining a watchlist of hidden users and alerting on any logon (interactive, remote, network) or network connection from them, security teams can identify an active, hidden adversary.
    answer_sources:
      - Windows Event ID 4624
      - Zeek conn.log
      - Zeek dns.log
      - Authentication Servers, Network Gateway, DNS Servers, Endpoint Device Event Logs
    range: last 90 days
    queries:
      - language: pseudocode
        query: SEARCH (authentication_events (WinEvent:4624) OR network_connections (Zeek)) WHERE username IN (hidden_user_watchlist)
  - question: Has a hidden user account logged in from a geographically anomalous location?
    context: Adversaries often operate from locations outside of an organization's typical geographic footprint. This question focuses on network logins from hidden users and enriches the source IP with geolocation data. A login from a country or region where the organization has no presence and from which no user has ever logged in is a high-confidence indicator of an external threat actor using a hidden account.
    answer_sources:
      - Windows Event ID 4624
      - Zeek conn.log
      - Zeek dns.log
      - Authentication Servers, Network Gateway, DNS Servers, Endpoint Device Event Logs
    range: last 90 days
    queries:
      - language: pseudocode
        query: SEARCH network_logon_events (WinEvent:4624) WHERE username IN (hidden_user_watchlist) | ENRICH geoip(source_ip) | FILTER source_country NOT IN (baseline_countries)
  - question: Is a hidden user account exhibiting unusual behavior patterns within the network, such as connecting to new or critical assets?
    context: This question uses graph analytics to model user behavior and identify outliers. By mapping relationships between users, hosts, and resources, we can spot when a hidden user (marked as an 'is_hidden' node) starts acting in an unusual way. This could include connecting to a large number of new hosts, accessing a critical server for the first time, or becoming a central 'hub' of activity, all of which are red flags for lateral movement or data staging.
    answer_sources:
      - Windows Event ID 4624
      - Zeek conn.log
      - Zeek dns.log
      - Authentication Servers, Network Gateway, DNS Servers, Endpoint Device Event Logs
    range: last 90 days
    queries:
      - language: pseudocode
        query: BUILD user_entity_graph from auth/network_logs | APPLY graph_anomaly_detection | FILTER node_is_hidden == true AND anomaly_score > threshold