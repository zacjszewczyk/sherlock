name: 'T1421: System Network Connections Discovery'
id: '2a9b3c4d-5e6f-4a7b-8c9d-0e1f2a3b4c5d'
description: 'Investigates whether an adversary is enumerating local or adjacent networks from a managed mobile device. This is achieved by monitoring for anomalous network discovery API calls (e.g., based on frequency, application category, or background state) and correlating these events with subsequent high-risk outbound network connections, such as communications to known C2 servers, newly registered domains, or destinations exhibiting beaconing behavior.'
type: 'technique'
related:
  - 'TA0032: Discovery'
contributors:
  - 'Zachary Szewczyk, Ask Sage'
created: '2025-10-01'
modified: '2025-10-01'
version: '1.0'
tags: 'none'
questions:
  - question: 'Is an application making network discovery API calls a known malicious actor based on threat intelligence?'
    context: 'This question aims to identify if an application performing network discovery is already flagged as malicious. By comparing the application''s identifiers (package name, certificate hash, developer ID) against a mobile threat intelligence feed, we can quickly identify known threats without needing complex behavioral analysis. This is a high-confidence, low-effort check for recognized malware.'
    answer_sources:
      - 'Mobile EDR API Logs'
      - 'Android Logcat'
      - 'UEM Application State Logs'
      - 'MDM Application Inventory'
      - 'MDM Permission Logs'
      - 'MDM/UEM Platform'
      - 'Mobile EDR/MTD Platform'
      - 'SIEM/Data Lake'
      - 'Managed Mobile Endpoints'
      - 'Threat Intelligence Feeds'
    range: 'last 90 days'
    queries:
      - 'pseudocode: SEARCH Mobile_EDR_API_Logs WHERE api_call IN (discovery_calls) | JOIN Threat_Intelligence_Feed ON app_package_name, app_cert_hash, app_developer_id | RETURN device_id, user, app_name, threat_match'
  - question: 'Is an application performing an anomalous number of network discovery scans or scanning under suspicious circumstances?'
    context: 'This question focuses on identifying unusual or contextually inappropriate network scanning behavior. It establishes a baseline of normal activity for each app and flags significant deviations (e.g., a sudden spike in scans). The check is further refined by escalating alerts for applications whose primary function shouldn''t involve network scanning (like a game) or when scanning occurs from a long-running background process, which could indicate a hidden malicious component.'
    answer_sources:
      - 'Mobile EDR API Logs'
      - 'Android Logcat'
      - 'UEM Application State Logs'
      - 'MDM Application Inventory'
      - 'MDM Permission Logs'
      - 'MDM/UEM Platform'
      - 'Mobile EDR/MTD Platform'
      - 'SIEM/Data Lake'
      - 'Managed Mobile Endpoints'
    range: 'last 90 days'
    queries:
      - 'pseudocode: SEARCH Mobile_EDR_API_Logs WHERE api_call IN (discovery_calls) | AGGREGATE count BY app_name, hour | COMPARE count to 30-day_baseline.98th_percentile | ALERT IF count > baseline OR (app_category NOT IN (''Networking'', ''Navigation'', ''System Tools'')) OR (process_state = ''background'' AND process_duration > 5_minutes)'
  - question: 'Does a network discovery API call exhibit a combination of features that mark it as a statistical outlier indicative of evasive activity?'
    context: 'This question uses a machine learning model (Local Outlier Factor) to detect subtle, evasive discovery attempts that might not trigger simple rule-based alerts. The model considers multiple features simultaneously (like time of day, app category, permissions) to identify events that are anomalous compared to their local neighborhood of data points. Flagging the top 1% of outliers helps surface sophisticated or novel threats that try to blend in.'
    answer_sources:
      - 'Mobile EDR API Logs'
      - 'Android Logcat'
      - 'UEM Application State Logs'
      - 'MDM Application Inventory'
      - 'MDM Permission Logs'
      - 'MDM/UEM Platform'
      - 'Mobile EDR/MTD Platform'
      - 'SIEM/Data Lake'
      - 'Managed Mobile Endpoints'
    range: 'last 90 days'
    queries:
      - 'pseudocode: STREAM Mobile_EDR_API_Logs WHERE api_call IN (discovery_calls) | ENRICH with features (app_category, install_time, permissions, background_flag) | APPLY LOF_model | ALERT IF anomaly_score > threshold (top 1%)'
  - question: 'Following a network discovery scan, did the device connect to a known malicious command and control (C2) server or a high-risk destination?'
    context: 'This question investigates the immediate aftermath of a network discovery event. Adversaries often scan the network to find a path out and then communicate with their C2 infrastructure. This query correlates the discovery activity with subsequent outbound connections, specifically looking for connections to destinations on threat intelligence lists. The risk is considered even higher if the destination is a newly registered domain (NRD) or a direct-to-IP connection, as these are common tactics for C2 communication.'
    answer_sources:
      - 'Mobile EDR API Logs'
      - 'Zeek conn.log'
      - 'Zeek dns.log'
      - 'Zeek ssl.log'
      - 'Zeek notice.log'
      - 'Threat Intelligence Feeds'
      - 'Passive DNS Data'
      - 'WHOIS Data'
      - 'Network Gateway (Wireless Access Points, Firewalls)'
      - 'DNS Servers'
      - 'SIEM/Data Lake'
      - 'Threat Intelligence Platform'
    range: 'last 90 days'
    queries:
      - 'pseudocode: SEARCH Mobile_EDR_API_Logs FOR discovery_calls | FOR each event, SEARCH Zeek_logs (conn, dns) FOR outbound_connections FROM device_ip within 5_minutes | IF connection_destination IN C2_threat_feed, ALERT (High) | ENRICH with WHOIS | IF domain_age < 30_days OR connection_type = ''direct-to-IP'', ESCALATE (Critical)'
  - question: 'Following a network discovery scan, did the device exhibit network behaviors associated with algorithmically generated domains (DGA), long-tail domains, or beaconing?'
    context: 'This question looks for more subtle indicators of malicious follow-on activity after a discovery scan. It checks for three specific patterns: 1) High entropy in DNS requests, a hallmark of Domain Generation Algorithms (DGAs) used to find C2 servers. 2) Connections to very rare domains (long-tail analysis), which are less likely to be legitimate. 3) A high rate of failed connection attempts to a single destination, which can indicate a C2 beaconing mechanism trying to establish contact.'
    answer_sources:
      - 'Mobile EDR API Logs'
      - 'Zeek conn.log'
      - 'Zeek dns.log'
      - 'Zeek ssl.log'
      - 'Zeek notice.log'
      - 'Threat Intelligence Feeds'
      - 'Passive DNS Data'
      - 'WHOIS Data'
      - 'Network Gateway (Wireless Access Points, Firewalls)'
      - 'DNS Servers'
      - 'SIEM/Data Lake'
      - 'Threat Intelligence Platform'
    range: 'last 90 days'
    queries:
      - 'pseudocode: SEARCH Mobile_EDR_API_Logs FOR discovery_calls | FOR each event, MONITOR Zeek_logs FROM device_ip for 10_minutes | CALCULATE shannon_entropy(dns_queries) | COUNT unique_devices_contacting_domain | CALCULATE failed_connection_ratio | ALERT IF entropy > 4.2 OR unique_devices < 5 OR failed_ratio > 0.9'
  - question: 'Following a network discovery scan, did the device make any outbound network connections that are statistical outliers, potentially indicating anomalous C2 communication?'
    context: 'This question employs a machine learning model (one-class SVM) to identify anomalous C2 communications that may not match known patterns. By training a model on what normal network connections look like, it can flag any connection that deviates significantly. This approach uses features like port, protocol, data volume, and SSL/TLS fingerprinting (JA3/JA3S) to detect unusual C2 channels that might otherwise go unnoticed.'
    answer_sources:
      - 'Mobile EDR API Logs'
      - 'Zeek conn.log'
      - 'Zeek dns.log'
      - 'Zeek ssl.log'
      - 'Zeek notice.log'
      - 'Threat Intelligence Feeds'
      - 'Passive DNS Data'
      - 'WHOIS Data'
      - 'Network Gateway (Wireless Access Points, Firewalls)'
      - 'DNS Servers'
      - 'SIEM/Data Lake'
      - 'Threat Intelligence Platform'
    range: 'last 90 days'
    queries:
      - 'pseudocode: SEARCH Mobile_EDR_API_Logs FOR discovery_calls | FOR each event, STREAM Zeek_logs FROM device_ip for 10_minutes | EXTRACT features (port, protocol, bytes, duration, ja3, ja3s) | APPLY one-class_SVM_model | ALERT IF connection classified as outlier'