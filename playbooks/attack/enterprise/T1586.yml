name: "T1586: Compromise Accounts"
id: "f8e1a2b3-c4d5-4e6f-8a9b-0c1d2e3f4a5b"
description: "Investigates whether an adversary is compromising external or internal accounts to support their operations. This is identified by monitoring for authentication attempts using known breached credentials, high rates of login failures indicative of password spraying or brute-force attacks, successful logins following suspicious patterns like impossible travel, inbound emails from trusted partners that fail authentication or contain suspicious links, and social media accounts impersonating key personnel or exhibiting anomalous behavior post-compromise."
type: "technique"
related:
- "TA0042: Resource Development"
contributors:
- "Zachary Szewczyk"
- "Ask Sage"
created: "2025-10-01"
modified: "2025-10-01"
version: 1.0
tags: "none"
questions:
- question: "Are there any login attempts using usernames from known credential breaches or originating from IPs on a credential abuse threat feed?"
  context: "This question aims to detect the most direct form of account compromise: the use of stolen or leaked credentials. By correlating real-time login events with threat intelligence on breached user accounts and malicious IP addresses, an analyst can proactively identify and respond to attempts to gain unauthorized access using readily available information from the dark web or previous data breaches. Answering this helps catch attackers early in the reconnaissance or initial access phase before they can establish a persistent foothold."
  answer_sources:
  - "Windows Event ID 4624"
  - "Windows Event ID 4625"
  - "Zeek conn.log"
  - "Threat Intelligence Feeds"
  - "Public-facing authentication services (e.g., VPN, OWA, M365)"
  - "Internal authentication servers (e.g., Domain Controllers)"
  - "Network egress points"
  - "Threat intelligence platforms"
  range: "last 90 days"
  queries:
  - technology: "pseudocode"
    query: |
      SEARCH login_events (successful OR failed)
      JOIN with breached_credential_list ON username
      JOIN with threat_intel_feed ON source_ip
      WHERE breached_credential_list.username IS NOT NULL OR threat_intel_feed.ip IS NOT NULL
      RETURN timestamp, username, source_ip, login_status
- question: "Is there an anomalous rate of login attempts from IPs on threat intelligence watchlists?"
  context: "This question moves beyond simple matching by baselining activity from known-bad sources (e.g., TOR nodes, known attacker C2). A spike in login attempts from these sources, even if not yet successful, indicates a targeted campaign and helps prioritize alerts from noisy threat feeds. This helps an analyst distinguish between random background noise and a concerted attack."
  answer_sources:
  - "Windows Event ID 4624"
  - "Windows Event ID 4625"
  - "Zeek conn.log"
  - "Threat Intelligence Feeds"
  - "Public-facing authentication services (e.g., VPN, OWA, M365)"
  - "Internal authentication servers (e.g., Domain Controllers)"
  - "Network egress points"
  - "Threat intelligence platforms"
  range: "last 90 days"
  queries:
  - technology: "pseudocode"
    query: |
      SEARCH login_events WHERE source_ip IN threat_watchlist
      BUCKET by 1_hour, source_ip
      STATS count AS hourly_attempts
      COMPARE hourly_attempts to historical_baseline for that watchlist_category
      ALERT if hourly_attempts > 95th_percentile_of_baseline
- question: "Can a machine learning model identify high-risk login events based on features like breached credentials, IP reputation, and user agent rarity?"
  context: "This question proposes a sophisticated, multi-factor approach to detect subtle compromise attempts. A supervised model can learn complex patterns from historical data that simple rules might miss, providing a risk score to focus analyst attention on the most suspicious logins. This is useful for reducing alert fatigue and finding novel attack patterns."
  answer_sources:
  - "Windows Event ID 4624"
  - "Windows Event ID 4625"
  - "Zeek conn.log"
  - "Threat Intelligence Feeds"
  - "Public-facing authentication services (e.g., VPN, OWA, M365)"
  - "Internal authentication servers (e.g., Domain Controllers)"
  - "Network egress points"
  - "Threat intelligence platforms"
  range: "last 90 days"
  queries:
  - technology: "pseudocode"
    query: |
      INPUT login_events
      FEATURE_ENGINEER is_username_breached, is_ip_on_threat_feed, source_as_rarity, login_hour_of_day, user_agent_commonality
      PREDICT risk_score with random_forest_model
      FILTER risk_score > dynamically_tuned_threshold
- question: "Is a single external IP address generating a high volume of failed logins across many different user accounts in a short time frame?"
  context: "This question aims to detect classic password spraying or credential stuffing attacks. This pattern—one source, many targets—is a strong indicator of an automated attack attempting to find a valid password for any account. Correlating this activity with known attack tool user-agents adds high-confidence validation to the finding."
  answer_sources:
  - "Windows Event ID 4625"
  - "Zeek http.log"
  - "Zeek conn.log"
  - "Public web application servers"
  - "API gateways"
  - "VPN concentrators"
  - "Network perimeter firewalls"
  - "Cloud identity provider log streams"
  range: "last 90 days"
  queries:
  - technology: "pseudocode"
    query: |
      SEARCH failed_logins
      BUCKET by 5_minutes, source_ip
      STATS distinct_count(username) as unique_failed_users, count(*) as total_failures
      FILTER unique_failed_users > 10 AND total_failures > 20
      ENRICH with http_user_agent from same session
      IF user_agent matches attack_tool_list, increase alert severity
- question: "Are any external IP addresses exhibiting a high 'spray ratio' (unique failed usernames / total failed logins)?"
  context: "This question seeks to quantify the 'spraying' behavior of an attacker. A ratio approaching 1.0 indicates the attacker is trying one or a few passwords against a large list of accounts, a hallmark of a password spray. This statistical measure provides a more robust detection method than a simple threshold and can adapt to different attack volumes."
  answer_sources:
  - "Windows Event ID 4625"
  - "Zeek http.log"
  - "Zeek conn.log"
  - "Public web application servers"
  - "API gateways"
  - "VPN concentrators"
  - "Network perimeter firewalls"
  - "Cloud identity provider log streams"
  range: "last 90 days"
  queries:
  - technology: "pseudocode"
    query: |
      SEARCH failed_logins from external_ips
      BUCKET by 5_minutes, source_ip
      STATS spray_ratio = distinct_count(username) / count(*), distinct_count(username) as unique_fails
      COMPARE spray_ratio to 24_hour_all_ip_baseline
      ALERT if spray_ratio > 99th_percentile AND unique_fails > 5
- question: "Can clustering algorithms identify dense groups of failed authentications that point to a coordinated password spraying attack?"
  context: "This question helps an analyst find coordinated attacks that may not be caught by single-IP rules. A density-based algorithm like DBSCAN can find clusters of activity linked by source IP and time, revealing slow-and-low attacks or distributed attacks from a small set of IPs that are working together, which might otherwise appear as unrelated events."
  answer_sources:
  - "Windows Event ID 4625"
  - "Zeek http.log"
  - "Zeek conn.log"
  - "Public web application servers"
  - "API gateways"
  - "VPN concentrators"
  - "Network perimeter firewalls"
  - "Cloud identity provider log streams"
  range: "last 90 days"
  queries:
  - technology: "pseudocode"
    query: |
      INPUT failed_logins over 15_minute_window
      FEATURES source_ip, hashed_username, timestamp
      RUN DBSCAN algorithm
      IDENTIFY clusters dense in unique_usernames from a small set of source_ips
- question: "Is a single user account experiencing a high volume of failed logins from a wide distribution of network locations (Autonomous Systems)?"
  context: "This question is designed to specifically detect a *distributed* brute-force attack. Attackers use botnets to spread the attack across many IPs and networks to evade simple source-IP blocking. Checking the diversity of source Autonomous System Numbers (ASNs) is an effective way to identify this distributed nature and distinguish it from a non-distributed attack from a single network."
  answer_sources:
  - "Windows Event ID 4625"
  - "Zeek conn.log"
  - "Authentication servers (Domain Controllers, RADIUS)"
  - "Public-facing application servers"
  - "Cloud identity provider logs (e.g., Azure AD Sign-in logs)"
  - "Network perimeter flow logs"
  range: "last 90 days"
  queries:
  - technology: "pseudocode"
    query: |
      SEARCH failed_logins
      ENRICH source_ip with ASN
      BUCKET by 5_minutes, username
      STATS count(*) as failures, distinct_count(asn) as unique_asns
      ALERT if failures > 20 AND unique_asns > 5
- question: "Has any user account experienced a statistically significant spike in failed logins compared to its historical baseline, or a sudden increase in the randomness of source IPs?"
  context: "This question combines time-series anomaly detection with a measure of source distribution. A deviation from the user's normal failed login baseline catches brute-force attacks, while a spike in the Shannon entropy of source IPs can signal the shift from a single attacker to a distributed botnet. This two-pronged approach provides a more robust signal of an attack in progress."
  answer_sources:
  - "Windows Event ID 4625"
  - "Zeek conn.log"
  - "Authentication servers (Domain Controllers, RADIUS)"
  - "Public-facing application servers"
  - "Cloud identity provider logs (e.g., Azure AD Sign-in logs)"
  - "Network perimeter flow logs"
  range: "last 90 days"
  queries:
  - technology: "pseudocode"
    query: |
      FOR each user:
        SEARCH hourly failed_logins, COMPARE to 30-day_moving_avg + 3*stdev
        SEARCH failed_logins in 5-min_window, CALCULATE shannon_entropy of source_ips
        ALERT on baseline deviation OR sudden entropy spike
- question: "Can a time-series model trained on a user's login history detect a sequence of failed logins that is anomalous compared to their normal behavior?"
  context: "This question proposes applying advanced machine learning for high-fidelity detection on high-value accounts. Models like ARIMA or LSTMs can learn the complex temporal patterns of a user's normal login behavior (or lack thereof) and are highly effective at detecting subtle deviations that indicate a targeted brute-force attempt, which might be missed by simple statistical baselines."
  answer_sources:
  - "Windows Event ID 4625"
  - "Zeek conn.log"
  - "Authentication servers (Domain Controllers, RADIUS)"
  - "Public-facing application servers"
  - "Cloud identity provider logs (e.g., Azure AD Sign-in logs)"
  - "Network perimeter flow logs"
  range: "last 90 days"
  queries:
  - technology: "pseudocode"
    query: |
      FOR each high-value_user:
        INPUT stream of failed_login_counts_per_minute
        FEED into trained LSTM_autoencoder_model
        ALERT if model_reconstruction_error > threshold
- question: "Has a successful login occurred from an IP address that was just used for a high number of failed login attempts against the same user?"
  context: "This is a classic and high-confidence indicator of a successful brute-force or password guessing attack. By correlating the final success with the preceding failures, analysts can immediately pinpoint a compromised account and the attacker's source IP, enabling rapid response to contain the breach."
  answer_sources:
  - "Windows Event ID 4624"
  - "Windows Event ID 4625"
  - "Zeek conn.log"
  - "GeoIP Enrichment Database"
  - "Domain Controller and member server security logs"
  - "VPN access logs"
  - "Internet gateway flow logs (Zeek conn.log)"
  - "Geolocation data enrichment services"
  range: "last 90 days"
  queries:
  - technology: "pseudocode"
    query: |
      SEARCH successful_login(user, source_ip)
      LOOKUP for failed_logins in last 15 minutes where user and source_ip match
      IF count(failed_logins) > 10, ALERT
- question: "Has a user logged in from a geographic location that would be impossible to travel to since their last login, or from a country/ASN they have never used before?"
  context: "This question helps to identify account takeovers by leveraging geographic and network context. Impossible travel is a strong signal of compromise, indicating two logins from distant locations in an impossibly short time. Similarly, a login from a completely new country or network provider for that user is highly suspicious and warrants investigation, as it breaks from their established pattern of behavior."
  answer_sources:
  - "Windows Event ID 4624"
  - "Windows Event ID 4625"
  - "Zeek conn.log"
  - "GeoIP Enrichment Database"
  - "Domain Controller and member server security logs"
  - "VPN access logs"
  - "Internet gateway flow logs (Zeek conn.log)"
  - "Geolocation data enrichment services"
  range: "last 90 days"
  queries:
  - technology: "pseudocode"
    query: |
      ON successful_login:
        GET current_location, current_time, user
        GET user's_previous_location, user's_previous_time
        CALCULATE implied_travel_speed
        IF implied_travel_speed > 1000 km/h, ALERT
        IF current_country NOT IN user's_90-day_country_history, ALERT
- question: "Can a machine learning model score the risk of each successful login based on contextual features like travel distance, location novelty, and prior failed attempts?"
  context: "This question aims to synthesize multiple weak signals into a single, strong indicator of compromise. A classification model can weigh factors like impossible travel, a new device, a new ASN, and preceding failures to produce a single risk score. This allows analysts to focus on the most anomalous successful logins instead of investigating each one individually, improving efficiency."
  answer_sources:
  - "Windows Event ID 4624"
  - "Windows Event ID 4625"
  - "Zeek conn.log"
  - "GeoIP Enrichment Database"
  - "Domain Controller and member server security logs"
  - "VPN access logs"
  - "Internet gateway flow logs (Zeek conn.log)"
  - "Geolocation data enrichment services"
  range: "last 90 days"
  queries:
  - technology: "pseudocode"
    query: |
      ON successful_login:
        FEATURE_ENGINEER time_since_last_login, distance_from_last_login, is_new_country, is_new_asn, count_of_prior_failures_in_session
        PREDICT probability_of_anomaly with logistic_regression_model
        ALERT if probability > 0.9
- question: "Are we receiving emails from a known partner domain that are failing DMARC authentication or contain links to known malicious domains?"
  context: "This question helps detect when a trusted external partner's email account has been compromised and is being used to attack your organization. A DMARC failure indicates the email wasn't sent from an authorized server, and a malicious link is a clear sign of malicious intent. This helps stop phishing attacks that abuse the trust established with partners."
  answer_sources:
  - "Email Gateway Logs"
  - "Zeek dns.log"
  - "Zeek http.log"
  - "WHOIS lookup data"
  - "Mail Transfer Agents (MTAs)"
  - "Email security gateways"
  - "Network DNS resolvers"
  - "Web proxies"
  - "External domain intelligence services"
  range: "last 90 days"
  queries:
  - technology: "pseudocode"
    query: |
      SEARCH inbound_email
      WHERE sender_domain IN partner_list AND dmarc_result = 'fail' AND dmarc_policy = 'reject'
      OR
      WHERE url_in_body IN malicious_url_threat_feed
      ALERT
- question: "Do emails from key partners or executives contain links to very recently registered domains?"
  context: "This question helps identify phishing campaigns that use newly created domains to bypass reputation-based security controls. Attackers frequently register new domains just for their campaigns. Flagging emails from important senders (like partners or executives) that link to domains less than 30 days old is a highly effective heuristic for detecting targeted spear-phishing attempts."
  answer_sources:
  - "Email Gateway Logs"
  - "Zeek dns.log"
  - "Zeek http.log"
  - "WHOIS lookup data"
  - "Mail Transfer Agents (MTAs)"
  - "Email security gateways"
  - "Network DNS resolvers"
  - "Web proxies"
  - "External domain intelligence services"
  range: "last 90 days"
  queries:
  - technology: "pseudocode"
    query: |
      SEARCH inbound_email where sender_is_partner OR sender_is_executive
      EXTRACT all domains from URLs
      GET domain_registration_date for each domain via WHOIS
      CALCULATE domain_age
      IF min(domain_age) < 30 days, ALERT
- question: "Does the writing style or topic of an inbound email from a key partner deviate significantly from their historical communication patterns?"
  context: "This question aims to detect sophisticated account takeovers where the attacker crafts a seemingly legitimate email. By creating a linguistic fingerprint (stylometry and topic model) for key contacts, an NLP system can spot anomalies in writing style, tone, or subject matter that a human reader might miss, indicating the sender is not who they claim to be. This is a powerful tool against business email compromise (BEC)."
  answer_sources:
  - "Email Gateway Logs"
  - "Zeek dns.log"
  - "Zeek http.log"
  - "WHOIS lookup data"
  - "Mail Transfer Agents (MTAs)"
  - "Email security gateways"
  - "Network DNS resolvers"
  - "Web proxies"
  - "External domain intelligence services"
  range: "last 90 days"
  queries:
  - technology: "pseudocode"
    query: |
      ON inbound_email from key_partner:
        CALCULATE stylometry_features and topic_model
        COMPARE to sender's historical_baseline using cosine_similarity
        IF similarity_score < learned_threshold, ALERT
- question: "Have any new social media profiles been created that appear to be impersonating our executives or brands?"
  context: "This question focuses on proactively detecting brand impersonation and executive spoofing on social media. Attackers create these fake profiles for phishing, disinformation, or fraud. This query seeks to find newly created look-alike accounts, especially those that begin posting links to suspicious or newly registered domains, to get ahead of such campaigns."
  answer_sources:
  - "OSINT Monitoring Platform Data"
  - "Social Media Site APIs"
  - "Zeek dns.log"
  - "Zeek http.log"
  - "Public social media platforms (e.g., LinkedIn, X/Twitter)"
  - "OSINT data aggregation services"
  - "Brand protection services"
  - "Internal web proxy logs"
  range: "last 90 days"
  queries:
  - technology: "pseudocode"
    query: |
      SEARCH social_media_monitoring_data for new_profiles
      IF profile_name is_similar_to executive_or_brand_name
      AND profile posts links to domains registered < 60 days ago
      ALERT
- question: "Are our monitored, legitimate social media accounts exhibiting anomalous activity in terms of posting frequency, content, or network growth?"
  context: "This question helps to detect the takeover of a legitimate, company-controlled social media account. By baselining normal activity, an analyst can automatically flag significant deviations—like a sudden flood of posts, a sharp change in the topics being discussed, or an unusual spike in followers—which are strong indicators of a compromise."
  answer_sources:
  - "OSINT Monitoring Platform Data"
  - "Social Media Site APIs"
  - "Zeek dns.log"
  - "Zeek http.log"
  - "Public social media platforms (e.g., LinkedIn, X/Twitter)"
  - "OSINT data aggregation services"
  - "Brand protection services"
  - "Internal web proxy logs"
  range: "last 90 days"
  queries:
  - technology: "pseudocode"
    query: |
      FOR each monitored_account:
        COMPARE current_activity_metrics (posting_frequency, content_keywords, follower_growth_rate) to 90-day_moving_average
        ALERT if any metric deviates by > 3 standard deviations
        CALCULATE Jaccard similarity of hashtags/mentions vs historical corpus
        ALERT on sudden drop in similarity
- question: "Does the writing style of new posts on a monitored account match the established author profile of the legitimate owner?"
  context: "This question uses advanced NLP to determine if the person posting to an account is the same person who has always posted. An author attribution model creates a unique 'fingerprint' of a person's writing style based on word choices, punctuation, and sentence structure. If a new post doesn't match that fingerprint, it's a strong signal that someone else has taken over the account."
  answer_sources:
  - "OSINT Monitoring Platform Data"
  - "Social Media Site APIs"
  - "Zeek dns.log"
  - "Zeek http.log"
  - "Public social media platforms (e.g., LinkedIn, X/Twitter)"
  - "OSINT data aggregation services"
  - "Brand protection services"
  - "Internal web proxy logs"
  range: "last 90 days"
  queries:
  - technology: "pseudocode"
    query: |
      ON new_post from monitored_account:
        EXTRACT stylometric_features (word n-grams, punctuation usage)
        PREDICT author with trained_attribution_model
        IF predicted_author is 'unknown' or NOT legitimate_owner with high confidence, ALERT