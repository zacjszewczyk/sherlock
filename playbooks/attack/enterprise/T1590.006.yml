name: T1590.006: Network Security Appliances
id: a7b0c1d2-e3f4-4a5b-6c7d-8e9f0a1b2c3d
description: |
  This playbook helps determine if an adversary is actively gathering information about an organization's network security appliances. It provides investigative steps to detect various reconnaissance techniques, including connection attempts from known malicious IPs, fingerprinting of web interfaces using scanner-specific signatures, horizontal and vertical scanning across the network, and anomalous access attempts to management ports. The goal is to identify precursor activities that indicate an adversary is mapping out network defenses for a future attack.
type: technique
related:
  - TA0043: Reconnaissance
contributors:
  - Zachary Szewczyk
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Are IP addresses from high-confidence threat intelligence feeds attempting to connect to our network security appliances?
    context: |
      This question aims to detect initial reconnaissance activity by cross-referencing inbound connection logs with known malicious IP addresses. A match indicates that a known threat actor or scanning service is probing our security infrastructure, which is a strong precursor to more targeted attacks. The symbolic approach provides a direct, high-fidelity signal based on curated intelligence.
    answer_sources:
      - Zeek conn.log
      - DMZ Firewalls, VPN Concentrators, Internet Gateway Routers
    range: last 90 days
    queries:
      - pseudocode: |
          SIEM: Search Zeek conn.log where source_ip is in CTI_feed AND destination_ip is in security_appliance_list.
  - question: Is a known malicious IP address scanning an unusually high number of destination ports on our network?
    context: |
      This question identifies scanning behavior from known malicious actors by looking for statistically significant deviations in port scanning activity. Exceeding the 99th percentile for distinct destination ports from a CTI-listed IP suggests a more aggressive and less targeted form of reconnaissance than a simple connection attempt.
    answer_sources:
      - Zeek conn.log
      - DMZ Firewalls, VPN Concentrators, Internet Gateway Routers
    range: last 90 days
    queries:
      - pseudocode: |
          SIEM: For source_ips in CTI_feed, count distinct destination_ports per 1-minute window. Alert if count > 99th_percentile_baseline.
  - question: Can we classify inbound connections to security appliances as reconnaissance using machine learning?
    context: |
      This question leverages machine learning to proactively identify reconnaissance activity that may not be caught by simple symbolic or statistical rules. By training a model on features like IP reputation, connection volume, success/failure ratios, and ASN data, the system can learn the subtle characteristics of reconnaissance and classify new, unseen traffic with a high degree of accuracy.
    answer_sources:
      - Zeek conn.log
      - DMZ Firewalls, VPN Concentrators, Internet Gateway Routers
    range: last 90 days
    queries:
      - pseudocode: |
          ML Model: Predict 'reconnaissance' class for inbound connections to security appliances based on source_ip_reputation, connection_count, failure_ratio, and ASN.
  - question: Are inbound web requests to our network security appliances using User-Agents, URIs, or JA3 hashes associated with known scanning tools?
    context: |
      This question focuses on identifying application-layer reconnaissance by looking for specific signatures of common scanning tools (like Nmap, Zgrab, Nuclei) within HTTP/S traffic. Detecting their unique fingerprints in request headers, URI paths, or TLS handshakes (JA3) provides direct evidence of tool-based scanning.
    answer_sources:
      - Zeek http.log
      - Zeek ssl.log
      - Web Application Firewalls (WAFs), Reverse Proxies, VPN Concentrator Web Portals
    range: last 90 days
    queries:
      - pseudocode: |
          SIEM: Search http.log and ssl.log for requests to security_appliances where user_agent, uri, or ja3 matches known_scanner_signatures.
  - question: Do inbound web requests to security appliances have User-Agent strings with abnormal entropy?
    context: |
      This question seeks to identify automated or non-standard clients by analyzing the complexity (entropy) of the User-Agent string. Legitimate browsers have predictable User-Agents, while scanning tools may use randomly generated or overly simplistic strings. A significant deviation from the normal entropy baseline can indicate traffic from a tool rather than a human user.
    answer_sources:
      - Zeek http.log
      - Zeek ssl.log
      - Web Application Firewalls (WAFs), Reverse Proxies, VPN Concentrator Web Portals
    range: last 90 days
    queries:
      - pseudocode: |
          SIEM: Calculate Shannon entropy for user_agent in http.log for requests to security_appliances. Alert if entropy is outside 3 standard deviations of the mean.
  - question: Is there an anomalous spike in the volume of web requests that match scanner signatures, suggesting a coordinated campaign?
    context: |
      This question uses time series forecasting to detect large-scale, coordinated scanning campaigns. By modeling the expected volume of 'normal' scanning traffic, the system can identify significant, unexpected increases. A spike that exceeds the model's predicted confidence interval is a strong indicator of an organized reconnaissance effort.
    answer_sources:
      - Zeek http.log
      - Zeek ssl.log
      - Web Application Firewalls (WAFs), Reverse Proxies, VPN Concentrator Web Portals
    range: last 90 days
    queries:
      - pseudocode: |
          ML Model: Using a time series model (ARIMA), predict hourly volume of requests with scanner signatures. Alert if observed volume exceeds the predicted confidence interval.
  - question: Is a single external IP address attempting to connect to a large number of unique internal hosts, indicating horizontal scanning?
    context: |
      This question aims to detect horizontal scanning, where an attacker attempts to discover other live hosts within the network. By setting a clear threshold (e.g., >50 hosts in <10 minutes), this provides a simple but effective rule to identify this 'fan-out' behavior, which is a common tactic for internal reconnaissance.
    answer_sources:
      - Zeek conn.log
      - Internet Gateway Routers, Core Network Switches, DMZ Firewalls
    range: last 90 days
    queries:
      - pseudocode: |
          SIEM: Alert if a single source_ip connects to > 50 unique destination_ips on the same destination_port within a 10-minute window.
  - question: Are there any external source IPs connecting to a statistically anomalous number of unique internal hosts?
    context: |
      This question provides a dynamic approach to detecting horizontal scanning. By calculating a distribution of unique destinations per source IP and flagging outliers (e.g., those in the 99.9th percentile), this method can adapt to changing network traffic patterns and identify anomalous fan-out behavior that might fall just under a static rule's threshold.
    answer_sources:
      - Zeek conn.log
      - Internet Gateway Routers, Core Network Switches, DMZ Firewalls
    range: last 90 days
    queries:
      - pseudocode: |
          SIEM: For each 10-minute window, calculate unique destination_ips per source_ip. Alert if a source_ip's count exceeds the 99.9th percentile of the distribution.
  - question: Can we identify clusters of connections that represent horizontal scanning activity?
    context: |
      This question uses unsupervised machine learning (clustering) to identify horizontal scanning without predefined rules. By grouping connections based on features like source IP, destination port, and timing, algorithms can naturally isolate dense clusters of activity that correspond to a single source rapidly connecting to many destinations.
    answer_sources:
      - Zeek conn.log
      - Internet Gateway Routers, Core Network Switches, DMZ Firewalls
    range: last 90 days
    queries:
      - pseudocode: |
          ML Model: Use a clustering algorithm (DBSCAN) on connection logs. Identify and alert on dense clusters where a single source_ip connects to many destination_ips on the same port.
  - question: Is a single external IP attempting to connect to an abnormally high number of ports on one of our network security appliances?
    context: |
      This question is designed to detect vertical port scanning, where an attacker probes a single target to discover open ports and services. A rule that triggers when a source IP connects to a high number of ports (>100) in a short time frame provides a clear, actionable signal of this reconnaissance tactic.
    answer_sources:
      - Zeek conn.log
      - DMZ Firewalls, VPN Concentrators, Public-facing Routers
    range: last 90 days
    queries:
      - pseudocode: |
          SIEM: Alert if a single source_ip connects to > 100 unique destination_ports on a single security_appliance_ip within a 5-minute window.
  - question: Are there external IPs exhibiting a statistically high ratio of failed-to-successful connections against a security appliance?
    context: |
      This question identifies port scanning by focusing on its most common characteristic: a large number of failed connections. By calculating the failure ratio for each source IP and flagging those with an anomalously high ratio (e.g., >95th percentile), we can detect scanning activity even if it's slow or doesn't cross a simple port count threshold.
    answer_sources:
      - Zeek conn.log
      - DMZ Firewalls, VPN Concentrators, Public-facing Routers
    range: last 90 days
    queries:
      - pseudocode: |
          SIEM: For each source_ip connecting to a security_appliance, calculate ratio of failed_connections to total_connections. Alert if ratio > 95th_percentile_baseline.
  - question: Can we use anomaly detection to identify connections to security appliances that deviate from normal traffic profiles?
    context: |
      This question employs anomaly detection (e.g., a one-class SVM) to build a model of what 'normal' traffic to a security appliance looks like. Any new connection that significantly deviates from this learned profile is flagged as an anomaly, which is effective for detecting vertical scanning attempts that are inherently different from legitimate user traffic.
    answer_sources:
      - Zeek conn.log
      - DMZ Firewalls, VPN Concentrators, Public-facing Routers
    range: last 90 days
    queries:
      - pseudocode: |
          ML Model: Train a one-class SVM on normal traffic features. Use the model to score new connections; alert on connections with high anomaly scores.
  - question: Are there connection attempts to management ports on our security appliances from IP addresses not on the approved allow-list?
    context: |
      This question provides a high-fidelity method for detecting unauthorized access attempts to critical management interfaces. By maintaining a strict allow-list of approved IP ranges, any connection attempt or failed login from an IP outside this list is immediately suspicious and warrants a high-severity alert.
    answer_sources:
      - Zeek conn.log
      - Zeek ssl.log
      - Windows Event ID 4625
      - Firewall Management Interfaces, VPN Administrator Portals, Router Management Consoles, Bastion Hosts
    range: last 90 days
    queries:
      - pseudocode: |
          SIEM: Alert if a connection is made to a management_port from a source_ip not in the management_ip_allow_list.
  - question: Are there connection attempts to management services from new or unusual countries or Autonomous Systems (ASNs)?
    context: |
      This question helps identify malicious access attempts by baselining the geographic and network origin of legitimate administrative activity. A connection attempt from a country or ASN that has never before been seen accessing a specific management service is a statistical anomaly and can be an early indicator of a targeted attack.
    answer_sources:
      - Zeek conn.log
      - Zeek ssl.log
      - Windows Event ID 4625
      - Firewall Management Interfaces, VPN Administrator Portals, Router Management Consoles, Bastion Hosts
    range: last 90 days
    queries:
      - pseudocode: |
          SIEM: For management services, baseline source countries and ASNs. Alert on connection attempts from a source country or ASN not in the historical baseline.
  - question: Can we detect anomalous connection patterns to management interfaces that indicate targeted fingerprinting?
    context: |
      This question uses an autoencoder to learn the intricate patterns of normal administrative connections. When an attacker attempts to fingerprint a management interface, their activity will likely deviate from this 'normal' pattern. The model will fail to reconstruct this anomalous connection accurately, resulting in a high reconstruction error and triggering an alert.
    answer_sources:
      - Zeek conn.log
      - Zeek ssl.log
      - Windows Event ID 4625
      - Firewall Management Interfaces, VPN Administrator Portals, Router Management Consoles, Bastion Hosts
    range: last 90 days
    queries:
      - pseudocode: |
          ML Model: Train an autoencoder on normal connection patterns to management interfaces. Alert if a new connection has a high reconstruction error.