name: T1600.001: Reduce Key Space
id: f8b1c2d3-e4f5-4a6b-7c8d-9e0f1a2b3c4d
description: This playbook helps investigate attempts by adversaries to evade defenses by weakening encryption on network devices. This is often achieved by replacing firmware with malicious versions. Indicators include the transfer of files with known malicious hashes to network devices, anomalous command-line activity on administrative hosts related to firmware updates, a shift towards using weak or deprecated cryptographic protocols and ciphers, suspicious sequences of events like a large file transfer followed by a device reboot and new network behaviors, and network devices violating established communication baselines by contacting unusual peers or using unauthorized protocols.
type: technique
related:
- TA0005: Defense Evasion
contributors:
- Zachary Szewczyk
- Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
- question: Has a file transfer to a managed network device occurred where the file hash matches a known malicious signature?
  context: This question aims to directly detect the transfer of malicious firmware or software to critical network infrastructure. Adversaries may attempt to replace legitimate device firmware with compromised versions that weaken security controls. Matching file hashes against a threat intelligence feed is a high-fidelity method for identifying known malicious payloads.
  answer_sources:
  - Zeek files.log
  - Zeek conn.log
  - Network management VLANs, administrative jump boxes, core routers and switches, VPN concentrators, and network taps monitoring traffic to/from management subnets.
  range: last 90 days
  queries:
  - pseudocode: SEARCH Zeek files.log WHERE destination_ip IN network_device_inventory AND (md5_hash IN malicious_hashes OR sha1_hash IN malicious_hashes)
- question: Has there been an anomalous file transfer to a network device based on its size or type?
  context: This question seeks to identify suspicious file transfers that deviate from established norms. Adversaries transferring malicious firmware may use files with unusual sizes or MIME types compared to legitimate updates. Baselining normal activity and alerting on deviations can surface these suspicious transfers, especially when correlated with change management records to filter out authorized activity.
  answer_sources:
  - Zeek files.log
  - Zeek conn.log
  - Network management VLANs, administrative jump boxes, core routers and switches, VPN concentrators, and network taps monitoring traffic to/from management subnets.
  range: last 90 days
  queries:
  - pseudocode: SEARCH Zeek files.log FOR transfers to network_devices | COMPARE file_size and mime_type against 30-day baseline | ALERT if size > 95th percentile OR mime_type is new
- question: Does machine learning classify a recent file transfer to a network device as suspicious?
  context: This question leverages a supervised machine learning model to provide a more nuanced classification of file transfers than simple rule-based alerts. By training on a wide range of features from historical data, the model can learn subtle patterns that distinguish between benign and malicious transfers, potentially detecting novel threats that evade signature-based methods.
  answer_sources:
  - Zeek files.log
  - Zeek conn.log
  - Network management VLANs, administrative jump boxes, core routers and switches, VPN concentrators, and network taps monitoring traffic to/from management subnets.
  range: last 90 days
  queries:
  - pseudocode: FOR EACH new file transfer to network_device | EXTRACT features (source_ip, dest_ip, size, mime_type, etc.) | INPUT into classification model | ALERT if classification is 'suspicious'
- question: Has a network management utility been used on an administrative host to push a potential firmware update to a network device?
  context: This question focuses on the execution of commands on administrative workstations, a common vector for managing network devices. Adversaries gaining access to these hosts could use legitimate tools to perform malicious actions. This query looks for the specific combination of network tools, target device IPs, and command-line keywords associated with firmware updates to pinpoint suspicious activity.
  answer_sources:
  - Windows Event ID 4688
  - Designated network administration workstations, jump servers, and configuration management servers.
  range: last 90 days
  queries:
  - pseudocode: SEARCH Windows Event Logs (ID 4688) WHERE process_name IN (plink.exe, scp.exe) AND command_line contains IP from network_device_list AND command_line contains keyword from (copy, upgrade, firmware)
- question: Has an administrator executed an unusual or never-before-seen command line with a network management tool?
  context: This question aims to detect anomalous command-line usage by administrators, which could indicate account compromise or insider threat. By baselining normal commands for each user and tool, this method can flag novel or unusually complex commands (indicated by high entropy) that deviate from established administrative patterns.
  answer_sources:
  - Windows Event ID 4688
  - Designated network administration workstations, jump servers, and configuration management servers.
  range: last 90 days
  queries:
  - pseudocode: FOR EACH new command_line from admin_user with network_tool | CALCULATE Shannon entropy | COMPARE to user's baseline | ALERT if entropy > 99th percentile OR if command_line is first_seen
- question: Did a sequence of commands executed on an administrative host deviate from normal workflow patterns?
  context: This question employs a sophisticated autoencoder model to understand the normal sequence and rhythm of administrative tasks. It moves beyond single command analysis to evaluate entire user sessions. An alert on high reconstruction error suggests the observed sequence of commands is inconsistent with any learned, legitimate workflow, indicating a potential compromise or malicious activity.
  answer_sources:
  - Windows Event ID 4688
  - Designated network administration workstations, jump servers, and configuration management servers.
  range: last 90 days
  queries:
  - pseudocode: FOR EACH user_session on admin_host | CAPTURE sequence of command_lines | INPUT sequence into autoencoder model | ALERT if reconstruction_error > learned_threshold
- question: Has a network device been observed using a weak or deprecated cryptographic protocol or cipher?
  context: This question provides a direct method for detecting weakened security configurations. An adversary who has successfully compromised a device may downgrade its cryptographic settings to facilitate eavesdropping or further attacks. Alerting on the use of explicitly blacklisted ciphers and protocols is a high-confidence indicator of a security regression or compromise.
  answer_sources:
  - Zeek ssl.log
  - Zeek ssh.log
  - Network traffic inspection points monitoring connections to/from critical infrastructure like VPN gateways, external-facing firewalls, and core switches. Network taps providing traffic to Zeek sensors, specifically at network chokepoints and in management VLANs.
  range: last 90 days
  queries:
  - pseudocode: SEARCH Zeek ssl.log or ssh.log WHERE ip IN network_device_list AND (cipher OR protocol OR kex_alg OR mac_alg) IN weak_crypto_list
- question: Has there been a statistically significant shift towards weaker cryptography on a network device?
  context: This question looks for subtle, systemic changes in cryptographic usage rather than a single event. A sudden spike in the use of a weak cipher, or a significant change in the overall distribution of ciphers, can indicate a device-wide configuration change pushed by an adversary. Statistical methods like percentile analysis or Chi-squared tests can detect these shifts against a historical baseline.
  answer_sources:
  - Zeek ssl.log
  - Zeek ssh.log
  - Network traffic inspection points monitoring connections to/from critical infrastructure like VPN gateways, external-facing firewalls, and core switches. Network taps providing traffic to Zeek sensors, specifically at network chokepoints and in management VLANs.
  range: last 90 days
  queries:
  - pseudocode: FOR EACH network_device | ANALYZE 1-hour windows of ssl.log | COUNT weak_cipher usage | ALERT if count > 99th percentile of 30-day baseline | RUN Chi-squared test on cipher distribution vs previous day
- question: Is the observed usage of a weak cryptographic protocol on a network device higher than forecasted?
  context: This question uses time series forecasting to predict the expected "background noise" level of weak protocol usage. Many networks have legacy systems that necessitate some use of older protocols. This model predicts that expected volume, allowing analysts to receive alerts only when the observed volume significantly exceeds the prediction, indicating a new or anomalous event rather than routine background traffic.
  answer_sources:
  - Zeek ssl.log
  - Zeek ssh.log
  - Network traffic inspection points monitoring connections to/from critical infrastructure like VPN gateways, external-facing firewalls, and core switches. Network taps providing traffic to Zeek sensors, specifically at network chokepoints and in management VLANs.
  range: last 90 days
  queries:
  - pseudocode: FOR EACH network_device and weak_protocol | FORECAST expected usage for next hour using ARIMA/Prophet model | OBSERVE actual usage | ALERT if actual_usage > upper_bound of prediction
- question: Has a sequence of a large file transfer, device reboot, and new external communication been observed for a network device?
  context: This question correlates multiple data sources to identify a classic attack pattern for firmware compromise: the adversary transfers the malicious file, the device reboots to install it, and then the newly compromised device "calls home" or begins other malicious communication. Detecting this specific sequence provides strong evidence of a successful compromise.
  answer_sources:
  - Zeek conn.log
  - Zeek files.log
  - SNMP/Syslog server logs
  - Core network taps, network device management subnets, perimeter monitoring points, and centralized logging platforms collecting SNMP and Syslog data from network infrastructure.
  range: last 90 days
  queries:
  - pseudocode: TRIGGER on file transfer to network_device | IF syslog for device stops within 15m for >60s | THEN IF new external connection from device occurs within 1hr of syslog resuming | ALERT
- question: Following a large file transfer, did the network device's communication profile change significantly?
  context: This question seeks to quantify the behavioral change of a network device after a potential firmware update. A legitimate update should result in largely similar communication patterns, while a malicious one would likely cause the device to talk to new peers over new ports/protocols. A low Jaccard similarity score between the before and after communication sets indicates a significant and suspicious change in behavior.
  answer_sources:
  - Zeek conn.log
  - Zeek files.log
  - SNMP/Syslog server logs
  - Core network taps, network device management subnets, perimeter monitoring points, and centralized logging platforms collecting SNMP and Syslog data from network infrastructure.
  range: last 90 days
  queries:
  - pseudocode: ON file transfer > 98th percentile to network_device | CAPTURE connection tuples 1hr before (Set A) and 1hr after (Set B) | CALCULATE Jaccard similarity of Set A and Set B | ALERT if similarity < 0.5
- question: Does a multi-stage model detect a suspicious file transfer followed by a device reboot and an anomalous new traffic profile?
  context: This question describes a comprehensive, multi-stage detection pipeline that combines several analytic techniques. It uses anomaly detection for file transfers and device availability (reboots) to flag prerequisite conditions, and then applies unsupervised machine learning (clustering) to determine if the device's behavior post-reboot is a true outlier. This layered approach increases detection confidence and reduces false positives.
  answer_sources:
  - Zeek conn.log
  - Zeek files.log
  - SNMP/Syslog server logs
  - Core network taps, network device management subnets, perimeter monitoring points, and centralized logging platforms collecting SNMP and Syslog data from network infrastructure.
  range: last 90 days
  queries:
  - pseudocode: PIPELINE [Stage 1: Flag suspicious file transfer] -> [Stage 2: Detect device reboot via SNMP/syslog anomaly] -> [Stage 3: Cluster post-reboot traffic profile and ALERT if outlier]
- question: Has a network device violated its predefined communication allow-list?
  context: This question implements a zero-trust policy for network infrastructure. By defining exactly what each class of device is allowed to communicate with (and how), any deviation from this explicit allow-list is immediately flagged as a policy violation and a potential security incident. This is a very effective method for detecting unexpected behavior in highly controlled environments.
  answer_sources:
  - Zeek conn.log
  - Zeek dns.log
  - Egress/ingress traffic points, DNS server logs, intra-VLAN traffic monitoring points, and Zeek sensors monitoring north-south and east-west traffic segments.
  range: last 90 days
  queries:
  - pseudocode: FOR EACH connection in Zeek conn.log involving a network_device | CHECK if (protocol, dest_port, peer_subnet) matches role-based allow-list | ALERT on mismatch
- question: Has a network device communicated with a rare or never-before-seen remote host?
  context: This question uses the principle of "first seen" to detect anomalous network connections. Network devices typically have a stable set of peers they communicate with. A connection to a completely new IP address is inherently suspicious and warrants investigation. The query enhances this by prioritizing alerts where the port used is also uncommon for the device, adding another layer of anomaly.
  answer_sources:
  - Zeek conn.log
  - Zeek dns.log
  - Egress/ingress traffic points, DNS server logs, intra-VLAN traffic monitoring points, and Zeek sensors monitoring north-south and east-west traffic segments.
  range: last 90 days
  queries:
  - pseudocode: FOR EACH connection from network_device | CHECK if remote_peer was seen in last 30 days | ALERT if 'first seen' | INCREASE priority if dest_port is statistically rare for this device
- question: Does a graph-based machine learning model consider a new connection from a network device to be topologically anomalous?
  context: This question models the entire network as a graph to learn its normal structure and traffic flows. A Graph Neural Network (GNN) can identify connections that do not fit the learned topology, even if the source and destination are individually known. This is powerful for detecting lateral movement or command-and-control channels that create unusual "shortcuts" or links in the network graph.
  answer_sources:
  - Zeek conn.log
  - Zeek dns.log
  - Egress/ingress traffic points, DNS server logs, intra-VLAN traffic monitoring points, and Zeek sensors monitoring north-south and east-west traffic segments.
  range: last 90 days
  queries:
  - pseudocode: MODEL network traffic as a graph | TRAIN GNN autoencoder on historical graph data | FOR EACH new connection | CALCULATE reconstruction error | ALERT if error is high