name: T1600.001: Reduce Key Space
id: f47ac10b-58cc-4372-a567-0e02b2c3d479
description: This playbook focuses on detecting adversary attempts to evade defenses by weakening encryption on network devices. It identifies malicious firmware transfers through file hash matching, anomalous file sizes/types, and suspicious command-line activity on administrative hosts. It also monitors for the use of weak or deprecated cryptographic protocols (e.g., SSLv3, RC4) and ciphers in network traffic. Finally, it correlates sequences of events, such as a file transfer followed by a device reboot and subsequent anomalous C2-like communication, and flags any network device communications that violate established baselines or normal topological patterns.
type: technique
related:
  - TA0005: Defense Evasion
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Has a known malicious firmware file been transferred to a managed network device?
    context: This question aims to detect the direct transfer of malicious firmware to a network device. Adversaries may replace legitimate firmware with a compromised version to weaken encryption, gain persistence, or evade detection. Matching file hashes against threat intelligence feeds is a high-fidelity method for identifying these known malicious files.
    answer_sources:
      - Zeek files.log
      - Zeek conn.log
      - Network management VLANs
      - Administrative jump boxes
      - Core routers and switches
      - VPN concentrators
      - Network taps monitoring traffic to/from management subnets
      - Threat intelligence feeds
    range: Last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH Zeek files.log WHERE destination_ip IN (network_device_inventory) AND (file_md5 IN (threat_feed) OR file_sha1 IN (threat_feed))
  - question: Has there been an anomalous file transfer to a network device based on its size or type?
    context: Adversaries might transfer custom tools or modified firmware that deviates from normal administrative files. This question seeks to identify such transfers by baselining file characteristics. A file that is unusually large or has a novel MIME type for a given device could indicate a suspicious payload, especially if it doesn't correlate with a scheduled maintenance activity.
    answer_sources:
      - Zeek files.log
      - Zeek conn.log
      - Network management VLANs
      - Administrative jump boxes
      - Core routers and switches
      - VPN concentrators
      - Network taps monitoring traffic to/from management subnets
      - Change management tickets
    range: Last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH Zeek files.log WHERE destination_ip IN (network_device_inventory) | BASELINE file_size, mime_type over 30 days | ALERT if file_size > 95th_percentile OR mime_type is 'first_seen'
  - question: Does a machine learning model classify a recent file transfer to a network device as suspicious?
    context: This question leverages machine learning to identify subtle patterns that might indicate a malicious file transfer. By training a model on various features of historical transfers, it can learn the complex characteristics of 'normal' activity and flag new transfers that deviate significantly, potentially catching novel or obfuscated attack attempts that simpler rules might miss.
    answer_sources:
      - Zeek files.log
      - Zeek conn.log
      - Network management VLANs
      - Administrative jump boxes
      - Core routers and switches
      - VPN concentrators
      - Network taps monitoring traffic to/from management subnets
    range: Last 90 days
    queries:
      - technology: pseudocode
        query: MODEL Random Forest on Zeek files.log and conn.log features | PREDICT classification for new file transfers to network devices | ALERT if classification is 'suspicious'
  - question: Was a process executed on an administrative host to push a potential firmware update to a network device?
    context: This question focuses on the actions taken on administrative workstations to initiate a firmware transfer. Adversaries often use legitimate network administration tools to carry out malicious actions. By monitoring process creation events for specific tools, command-line arguments targeting network devices, and keywords related to firmware updates, we can detect potentially unauthorized attempts to modify device software.
    answer_sources:
      - Windows Event ID 4688
      - Designated network administration workstations
      - Jump servers
      - Configuration management servers
    range: Last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH Windows Event ID 4688 WHERE process_name IN (network_tool_watchlist) AND command_line CONTAINS (network_device_ip) AND command_line CONTAINS (firmware_keywords)
  - question: Has an administrator executed an unusually complex or novel command to manage a network device?
    context: This question aims to detect anomalous command-line usage by administrators. Adversaries may use long, complex, or obfuscated commands that differ from a user's typical behavior. High Shannon entropy can indicate randomness or complexity, while a 'first seen' command for a specific user and tool combination is inherently suspicious and warrants investigation.
    answer_sources:
      - Windows Event ID 4688
      - Designated network administration workstations
      - Jump servers
      - Configuration management servers
    range: Last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH Windows Event ID 4688 | BASELINE command_line per user, process_name | CALCULATE Shannon entropy for new command_line | ALERT if entropy > 99th_percentile OR command_line is 'first_seen' for user-process pair
  - question: Did a sequence of commands executed by an administrator deviate from their normal workflow patterns?
    context: This question moves beyond single commands to analyze the entire workflow of an administrative session. Adversaries, even when using legitimate tools, may perform actions in an unusual order or combination. A sequence-to-sequence autoencoder can learn the 'grammar' of normal administrative sessions and flag entire sessions that don't conform to learned patterns, indicating a potential compromise or insider threat.
    answer_sources:
      - Windows Event ID 4688
      - Designated network administration workstations
      - Jump servers
      - Configuration management servers
    range: Last 90 days
    queries:
      - technology: pseudocode
        query: MODEL LSTM autoencoder on sequences of command_line per user session | CALCULATE reconstruction_error for new sessions | ALERT if reconstruction_error > threshold
  - question: Has a network device been observed using a known weak or deprecated cryptographic protocol or cipher?
    context: This is a direct check for weak encryption. An adversary might force a downgrade to a vulnerable protocol or cipher to facilitate eavesdropping or man-in-the-middle attacks. Alerting on any use of explicitly blacklisted cryptographic parameters provides a clear signal of a potential configuration weakness or an active attack.
    answer_sources:
      - Zeek ssl.log
      - Zeek ssh.log
      - Network traffic inspection points monitoring connections to/from critical infrastructure
      - Network taps providing traffic to Zeek sensors
    range: Last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH Zeek ssl.log OR ssh.log WHERE device_ip IN (network_device_inventory) AND (version IN (weak_list) OR cipher IN (weak_list) OR kex_alg IN (weak_list))
  - question: Has there been a statistically significant increase in the use of weak ciphers or a shift in the overall cipher distribution for a network device?
    context: Rather than just looking for a single instance, this question seeks to identify trends. A sudden spike in the use of a weak cipher, even if it's occasionally seen, could indicate an adversary is actively exploiting it. Similarly, a fundamental shift in the distribution of all ciphers used can signal a device misconfiguration or compromise.
    answer_sources:
      - Zeek ssl.log
      - Zeek ssh.log
      - Network traffic inspection points monitoring connections to/from critical infrastructure
      - Network taps providing traffic to Zeek sensors
    range: Last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH Zeek logs | TIME_SERIES count of weak ciphers per hour per device | ALERT if count > 99th_percentile | COMPARE daily cipher distribution to baseline using Chi-squared test and ALERT on significant change
  - question: Is the observed volume of weak cipher usage for a network device higher than what a forecasting model predicted?
    context: This question uses predictive analytics to find anomalous spikes in weak cipher usage. Time series models can learn patterns, including seasonality. If the actual number of connections using a weak cipher significantly exceeds the model's forecast, it suggests an anomaly that isn't explained by normal historical patterns, pointing to a potential attack.
    answer_sources:
      - Zeek ssl.log
      - Zeek ssh.log
      - Network traffic inspection points monitoring connections to/from critical infrastructure
      - Network taps providing traffic to Zeek sensors
    range: Last 90 days
    queries:
      - technology: pseudocode
        query: MODEL ARIMA/Prophet on historical weak cipher volume per device | PREDICT expected volume for next hour | ALERT if observed_volume > prediction_upper_bound
  - question: Has a network device exhibited a sequence of suspicious activities: a file transfer, followed by a reboot, and then new external communication?
    context: This question correlates multiple indicators to build a high-confidence alert for a device compromise. The sequence of a file transfer (potential firmware/tool), a device reboot (to apply the changes), and subsequent command-and-control (C2) traffic to a new external entity is a classic attack pattern. Detecting this entire sequence significantly reduces false positives.
    answer_sources:
      - Zeek conn.log
      - Zeek files.log
      - SNMP/Syslog server logs
      - Core network taps
      - Network device management subnets
      - Perimeter monitoring points
      - Centralized logging platforms
    range: Last 90 days
    queries:
      - technology: pseudocode
        query: CORRELATE (EVENT 1: file transfer to device) FOLLOWED BY (EVENT 2: device logs stop > 60s) WITHIN 15m FOLLOWED BY (EVENT 3: device connects to new external IP) WITHIN 1h | ALERT on sequence completion
  - question: Following a large file transfer, did the network communication profile of a device change significantly?
    context: This question quantifies the change in a device's behavior after a potentially malicious event. A low Jaccard similarity score between the pre- and post-transfer communication profiles indicates a major behavioral shift, suggesting the file had a significant, and likely malicious, impact on the device's function.
    answer_sources:
      - Zeek conn.log
      - Zeek files.log
      - Core network taps
      - Network device management subnets
      - Perimeter monitoring points
      - Centralized logging platforms
    range: Last 90 days
    queries:
      - technology: pseudocode
        query: TRIGGER on large file transfer to device | CAPTURE connection tuples 1h before (Set A) and 1h after (Set B) | CALCULATE Jaccard_Similarity(Set A, Set B) | ALERT if similarity < 0.5
  - question: Did a device's post-reboot network behavior, following a suspicious file transfer, fall into an anomalous cluster?
    context: This question uses a multi-stage ML pipeline. It first identifies a suspicious transfer, confirms a reboot, and then analyzes the resulting behavior. By clustering historical post-reboot traffic profiles, the system learns what 'normal' behavior looks like. If a new profile is an outlier, it strongly indicates the device is now behaving in a novel, and likely malicious, way.
    answer_sources:
      - Zeek conn.log
      - Zeek files.log
      - SNMP/Syslog server logs
      - Core network taps
      - Network device management subnets
      - Perimeter monitoring points
      - Centralized logging platforms
    range: Last 90 days
    queries:
      - technology: pseudocode
        query: PIPELINE: Stage1(flag suspicious file transfer) -> Stage2(detect reboot via SNMP/syslog anomaly) -> Stage3(cluster post-reboot traffic features) | ALERT if new traffic profile is an outlier cluster
  - question: Did a network device communicate in a way that violates its pre-defined role-based access policy?
    context: This question enforces a zero-trust model on network infrastructure. Devices like core switches have specific, predictable communication patterns. By defining an explicit allow-list of what communications are permitted, any deviation is immediately flagged as suspicious. This is effective at catching unexpected behavior, such as a switch trying to access the internet.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Egress/ingress traffic points
      - DNS server logs
      - Intra-VLAN traffic monitoring points
      - Zeek sensors monitoring north-south and east-west traffic
    range: Last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH Zeek conn.log WHERE (device_ip in (network_device_inventory)) AND (connection NOT IN (role_based_allow_list)) | ALERT
  - question: Has a network device communicated with a new or rare remote peer?
    context: This question focuses on identifying novel connections that could represent C2 traffic or data exfiltration. A network device communicating with an external IP for the first time is inherently suspicious, especially if the communication also uses a port that is rarely used by that device.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Egress/ingress traffic points
      - DNS server logs
      - Intra-VLAN traffic monitoring points
      - Zeek sensors monitoring north-south and east-west traffic
    range: Last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH Zeek conn.log | BASELINE remote_peers and ports per device over 30 days | ALERT when remote_peer is 'first_seen' | INCREASE_SEVERITY if port is statistically rare for device
  - question: Did a new network connection represent a topologically anomalous link in the network graph?
    context: This question uses graph-based machine learning to understand the network's structure. A Graph Neural Network (GNN) can learn complex relationships and flag connections that violate these learned structural rules (e.g., a printer connecting to a domain controller), detecting structurally significant deviations from the norm.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Egress/ingress traffic points
      - DNS server logs
      - Intra-VLAN traffic monitoring points
      - Zeek sensors monitoring north-south and east-west traffic
    range: Last 90 days
    queries:
      - technology: pseudocode
        query: MODEL GNN autoencoder on historical network graph from Zeek conn.log | CALCULATE reconstruction_error for new connections | ALERT if reconstruction_error > threshold