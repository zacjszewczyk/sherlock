name: T1490: Inhibit System Recovery
id: d8b5c9a0-f8d2-4e1b-9c7a-6e3f0d5a1b2c
description: This playbook helps analysts investigate whether an adversary is attempting to inhibit system recovery, a common tactic used in ransomware and destructive attacks. It focuses on detecting several key malicious behaviors: the execution of known ransomware or wiper tools identified via hash matching; the abuse of native Windows utilities (such as vssadmin.exe, wmic.exe, and bcdedit.exe) to delete shadow copies, backups, or disable recovery features; high-volume deletion of files with backup-related extensions (.bak, .vhd); and unauthorized network access to hypervisor or cloud management interfaces to delete virtual machine snapshots or cloud backups. By answering the investigative questions within, an analyst can identify and respond to attempts to undermine an organization's ability to restore systems after an attack.
type: technique
related:
- TA0040: Impact
contributors:
- Zachary Szewczyk
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
- question: Has a process been executed whose file hash matches a known malicious hash from threat intelligence feeds, specifically for ransomware or wiper tools?
  context: This question aims to detect the execution of known malicious tools designed to inhibit system recovery, such as ransomware or wipers. A match against a reliable threat intelligence feed is a high-fidelity indicator of a severe attack in progress, as these tools are the primary payload for achieving the adversary's impact objective.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 1 (Sysmon)
  - Zeek files.log
  - Applicable to all domain-joined Windows endpoints and servers, especially critical application servers and domain controllers, and network egress points.
  range: Last 90 days
  queries:
  - technology: Pseudocode
    query: SEARCH process_creation_events | HASH file | LOOKUP threat_intel_feed for hash | WHERE category is 'ransomware' or 'wiper' | RETURN host, user, process_name, hash
- question: Have any extremely rare and unsigned executables been observed running across the enterprise?
  context: This question seeks to identify potentially unknown or polymorphic malware by focusing on statistical outliers. Adversaries often use custom or packed tools that are not widely distributed and lack valid digital signatures. Identifying executables with very low prevalence (e.g., running on only a few machines) that are also unsigned helps uncover novel threats that might evade signature-based detection.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 1 (Sysmon)
  - Zeek files.log
  - Applicable to all domain-joined Windows endpoints and servers, especially critical application servers and domain controllers, and network egress points.
  range: Last 30 days
  queries:
  - technology: Pseudocode
    query: SEARCH process_creation_events | STATS count(host) by hash, signature_status | WHERE host_count < 5 AND signature_status is 'unsigned' | SORT by host_count | RETURN hash, signature_status, host_count
- question: Has a machine learning model identified any new process executions as malicious with high confidence based on features like parent process, command-line arguments, and file prevalence?
  context: This question leverages a machine learning model to proactively score and classify process behavior. By analyzing a combination of features in real-time, the model can detect suspicious executions that may not match known signatures or simple statistical thresholds, providing a more sophisticated and adaptive detection capability for novel recovery inhibition tools.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 1 (Sysmon)
  - Zeek files.log
  - Applicable to all domain-joined Windows endpoints and servers, especially critical application servers and domain controllers, and network egress points.
  range: Last 90 days
  queries:
  - technology: Pseudocode
    query: STREAM process_creation_events | APPLY ML_model(features) | WHERE model_score > 0.90 AND model_classification is 'malicious' | ALERT on host, user, process_name, score
- question: Have native Windows utilities like vssadmin.exe or bcdedit.exe been executed with command-line arguments known to delete backups or disable recovery features?
  context: Adversaries frequently abuse legitimate system utilities ("living off the land") to evade detection while disabling recovery mechanisms. This question directly targets the specific command-line syntax used for these destructive actions, such as deleting volume shadow copies or disabling automatic repair, which are strong indicators of malicious intent to prevent system restoration.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 1 (Sysmon)
  - Windows Event ID 4104 (PowerShell Script Block Logging)
  - Applicable to Domain Controllers, file servers with Volume Shadow Copy enabled, Windows servers hosting critical backups, and all other Windows endpoints and servers.
  range: Last 90 days
  queries:
  - technology: Pseudocode
    query: SEARCH process_creation_events OR powershell_logs | WHERE process_name IN ('vssadmin.exe', 'wmic.exe', 'wbadmin.exe', 'bcdedit.exe', 'diskshadow.exe', 'REAgentC.exe') AND command_line MATCHES REGEX /(delete\s+shadows|shadowcopy\s+delete|delete\s+catalog|recoveryenabled\s+no|bootstatuspolicy\s+ignoreallfailures)/i | RETURN host, user, process_name, command_line
- question: Has there been an anomalous execution of a recovery-related utility, such as a first-time execution by a user or an execution with an unusually complex command line?
  context: This question aims to detect abnormal usage of sensitive system utilities that might not be caught by specific signature-based rules. By baselining normal administrative behavior, we can flag deviations like a non-admin user running `vssadmin` for the first time, or the use of obfuscated or unusually long command lines (high entropy), which could indicate malicious activity.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 1 (Sysmon)
  - Windows Event ID 4104 (PowerShell Script Block Logging)
  - Applicable to Domain Controllers, file servers with Volume Shadow Copy enabled, Windows servers hosting critical backups, and all other Windows endpoints and servers.
  range: Last 90 days
  queries:
  - technology: Pseudocode
    query: SEARCH process_creation_events | WHERE process_name IN ('vssadmin.exe', 'wmic.exe', ...) | CALCULATE baseline_entropy and first_time_user_execution | ALERT if current_entropy > 95th_percentile OR is_first_time_execution
- question: Has an anomalous sequence of commands been observed, such as a reconnaissance command followed immediately by a destructive command related to system recovery?
  context: Adversaries often follow a logical progression of commands, first enumerating recovery options (e.g., `vssadmin list shadows`) before destroying them (e.g., `vssadmin delete shadows`). This question uses a model to learn normal administrative command sequences and flags deviations, providing a powerful way to detect malicious intent based on the context of an action rather than the action in isolation.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 1 (Sysmon)
  - Windows Event ID 4104 (PowerShell Script Block Logging)
  - Applicable to Domain Controllers, file servers with Volume Shadow Copy enabled, Windows servers hosting critical backups, and all other Windows endpoints and servers.
  range: Last 90 days
  queries:
  - technology: Pseudocode
    query: STREAM command_executions | GROUP by user, host | ANALYZE sequence of commands | APPLY sequence_model | ALERT if sequence is anomalous (e.g., 'list shadows' -> 'delete shadows')
- question: Has a single process or user account generated a high volume of file deletions (e.g., >100 in 5 minutes) targeting backup-related files or directories?
  context: A rapid, large-scale deletion of files with backup-specific extensions (like .bak, .vhd) or in critical locations (like 'System Volume Information') is a hallmark of ransomware and wiper attacks. This question uses a simple threshold-based rule to detect this brute-force behavior, providing a clear signal of an active attempt to destroy recovery data.
  answer_sources:
  - Windows Event ID 23 (Sysmon)
  - Windows Event ID 4663
  - Windows Event ID 5145
  - Applicable to network file shares hosting backups, servers with local backup copies, and the 'System Volume Information' directory on all Windows hosts.
  range: Last 90 days
  queries:
  - technology: Pseudocode
    query: SEARCH file_delete_events | WHERE file_extension IN ('.bak', '.vhd', '.vhdx') OR file_path CONTAINS 'System Volume Information' | STATS count by user, process over 5m | WHERE count > 100 | ALERT
- question: Has there been a statistically significant spike in the rate of file deletions for a specific user or host, particularly involving backup files?
  context: This question moves beyond fixed thresholds to detect anomalous deletion rates relative to a learned baseline for each user and host. This approach is more adaptive and can detect subtler or "low and slow" deletion activity that might fall below a hardcoded limit, while also reducing false positives from normally "noisy" systems.
  answer_sources:
  - Windows Event ID 23 (Sysmon)
  - Windows Event ID 4663
  - Windows Event ID 5145
  - Applicable to network file shares hosting backups, servers with local backup copies, and the 'System Volume Information' directory on all Windows hosts.
  range: Last 90 days
  queries:
  - technology: Pseudocode
    query: SEARCH file_delete_events | CALCULATE baseline deletion_rate per user, host, file_type | COMPARE current_rate to baseline | ALERT if current_rate > 99th_percentile_of_baseline
- question: Has a machine learning model detected a cluster of hosts simultaneously exhibiting anomalous, high-volume file deletion behavior?
  context: Widespread ransomware campaigns often involve multiple hosts being compromised and executing their destructive payload around the same time. This question uses clustering to identify groups of machines that suddenly begin behaving similarly in terms of file deletions. Detecting such synchronized, anomalous behavior is a powerful indicator of a coordinated, large-scale attack in progress.
  answer_sources:
  - Windows Event ID 23 (Sysmon)
  - Windows Event ID 4663
  - Windows Event ID 5145
  - Applicable to network file shares hosting backups, servers with local backup copies, and the 'System Volume Information' directory on all Windows hosts.
  range: Last 90 days
  queries:
  - technology: Pseudocode
    query: STREAM host_behavior_features (file_deletions, process_activity) | APPLY clustering_model (DBSCAN) | ALERT if a new cluster of hosts with high_deletion_rates is formed
- question: Has a network connection been made to a hypervisor or cloud backup management interface from an unauthorized IP address?
  context: Access to critical backup infrastructure (like VMware vCenter, ESXi hosts, or cloud storage consoles) should be tightly controlled. This question checks for violations of this control by looking for any network connection from a source IP that is not on a pre-defined allowlist of administrative workstations. Such a connection is a serious security event and a potential precursor to the deletion of backups and snapshots.
  answer_sources:
  - Zeek conn.log
  - Zeek ssl.log
  - Windows Event ID 3 (Sysmon)
  - Applicable to hypervisor management network segment (vCenter, ESXi hosts), network egress points to public cloud providers, and network boundaries between user and server segments.
  range: Last 90 days
  queries:
  - technology: Pseudocode
    query: SEARCH network_connections | WHERE destination_port IN (443, 902, 9443) AND destination_ip IN (vcenter_ips, cloud_api_ips) | LOOKUP source_ip in admin_allowlist | WHERE lookup_result is NULL | ALERT
- question: Has an authorized administrative user or system performed a statistically unusual number of destructive actions (e.g., snapshot deletions) against backup infrastructure?
  context: Even authorized accounts can be compromised. This question seeks to detect malicious activity from a legitimate source by baselining normal administrative behavior. A sudden, massive spike in destructive API calls, far exceeding the user's typical activity (e.g., 3 standard deviations above their mean), could indicate that the account has been compromised and is being used to systematically destroy backups.
  answer_sources:
  - Zeek conn.log
  - Zeek ssl.log
  - Windows Event ID 3 (Sysmon)
  - Applicable to hypervisor management network segment (vCenter, ESXi hosts), network egress points to public cloud providers, and network boundaries between user and server segments.
  range: Last 90 days
  queries:
  - technology: Pseudocode
    query: SEARCH api_logs or network_traffic | WHERE action_type is 'destructive' | CALCULATE baseline_rate per user | COMPARE current_rate to baseline | ALERT if current_rate > (mean + 3 * stdev)
- question: Has a machine learning model detected an anomalous sequence of API calls to backup infrastructure, such as immediate deletion without prior reconnaissance?
  context: Legitimate administrators typically follow a predictable workflow: they log in, list resources (VMs, snapshots), inspect them, and then perform an action. An adversary, however, might log in and immediately issue a command to delete everything. This question uses a sequence model (autoencoder) to learn normal workflows and flag sessions that deviate significantly, such as those lacking reconnaissance steps, which are highly indicative of malicious, automated attacks.
  answer_sources:
  - Zeek conn.log
  - Zeek ssl.log
  - Windows Event ID 3 (Sysmon)
  - Applicable to hypervisor management network segment (vCenter, ESXi hosts), network egress points to public cloud providers, and network boundaries between user and server segments.
  range: Last 90 days
  queries:
  - technology: Pseudocode
    query: STREAM api_call_sequences per session | APPLY autoencoder_model | CALCULATE reconstruction_error | ALERT if reconstruction_error is high