name: "T1586.002: Email Accounts"
id: "a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d"
description: "This playbook helps determine if an adversary possesses compromised email accounts that could be used to target the organization. It provides investigative questions to detect inbound emails with malicious indicators (sender, links, attachments), phishing characteristics, anomalous sending patterns (volume, new senders), and evidence of successful brute-force or password spraying attacks against internet-facing authentication services."
type: "technique"
related:
  - "TA0042: Resource Development"
contributors:
  - "Zachary Szewczyk"
created: "2025-10-01"
modified: "2025-10-01"
version: "1.0"
tags: "none"
questions:
  - question: "Is an inbound email associated with known malicious indicators from threat intelligence feeds?"
    context: "This question aims to detect threats by matching elements of an inbound email—such as the sender's address, domains in links, or file attachment hashes—against a curated list of known malicious or compromised indicators. A match provides a high-confidence signal that the email is part of a targeted attack or a broader malicious campaign, allowing for immediate blocking or quarantine."
    answer_sources:
      - "Zeek smtp.log"
      - "Zeek dns.log"
      - "Zeek http.log"
      - "Zeek files.log"
      - "Perimeter email gateway (SMTP relay); Network security monitoring sensor tap points; DNS resolvers; Web proxies"
    range: "last 90 days"
    queries:
      - "SEARCH smtp logs, dns logs, http logs, and file logs for sender addresses, domains, and file hashes. JOIN results with threat intelligence feeds. ALERT on match."
  - question: "Is an inbound email from a low-reputation sender domain and does it contain a risky attachment?"
    context: "This question identifies potentially suspicious emails by calculating a reputation score for sender domains based on their age, email volume, and recipient count. Emails from domains with low reputation scores (e.g., newly seen, low volume) that also contain executable or archive attachments are flagged. This helps uncover spear-phishing attempts from newly created or rarely used malicious domains."
    answer_sources:
      - "Zeek smtp.log"
      - "Zeek files.log"
      - "Perimeter email gateway (SMTP relay); Network security monitoring sensor tap points; DNS resolvers; Web proxies"
    range: "last 90 days"
    queries:
      - "FOR each sender domain, CALCULATE reputation score (age, volume, recipient count). IF reputation is in lowest 25th percentile AND email contains executable/archive attachment, ALERT."
  - question: "Does a machine learning model classify an inbound email as malicious based on its features?"
    context: "This question leverages a supervised machine learning model to classify emails as malicious or benign. The model is trained on features extracted from network logs, such as sender TLD, subject line characteristics, URL-to-domain ratio, and file MIME types. This approach can detect novel and sophisticated phishing attacks that may evade simpler rule-based systems by learning complex patterns from historical data."
    answer_sources:
      - "Zeek smtp.log"
      - "Zeek dns.log"
      - "Zeek http.log"
      - "Zeek files.log"
      - "Perimeter email gateway (SMTP relay); Network security monitoring sensor tap points; DNS resolvers; Web proxies"
    range: "last 90 days"
    queries:
      - "EXTRACT features (sender TLD, subject length, URL ratio, MIME type) from new emails. APPLY trained classification model. IF classified 'malicious' with high confidence, ALERT."
  - question: "Does an inbound email exhibit structural features of phishing, such as links to dynamic DNS domains or high-risk attachments?"
    context: "This question seeks to identify phishing attempts by looking for specific, high-risk patterns in email content. It involves scanning for links pointing to known dynamic DNS providers or URL shorteners and checking for attachments with file types (like .iso, .vhd, .lnk) that are commonly used to deliver malware but are rare in legitimate business correspondence. This helps catch common phishing vectors."
    answer_sources:
      - "Zeek dns.log"
      - "Zeek http.log"
      - "Zeek files.log"
      - "Zeek smtp.log"
      - "Perimeter email gateway; DNS resolvers; Web proxies"
    range: "last 90 days"
    queries:
      - "SEARCH dns and http logs for dynamic DNS/URL shortener patterns. SEARCH file logs for high-risk attachment types (.iso, .vhd, .lnk). ALERT on match."
  - question: "Does an email contain a link to a domain with an unusually high entropy score compared to normal traffic?"
    context: "This question aims to detect algorithmically generated domains (DGAs) often used in malware command-and-control or phishing. By calculating the Shannon entropy (a measure of randomness) of domain names in email links and comparing it to a baseline of known-good domains, we can flag domains that are suspiciously random. A high entropy score suggests the domain may be machine-generated and malicious."
    answer_sources:
      - "Zeek dns.log"
      - "Zeek http.log"
      - "Perimeter email gateway; DNS resolvers; Web proxies"
    range: "last 90 days"
    queries:
      - "FOR each domain in email links, CALCULATE Shannon entropy. COMPARE score to baseline of known-good domains. IF score is in top 5th percentile, ALERT."
  - question: "Is there an anomalous spike in the volume of a specific high-risk attachment type, suggesting a mass-mailing campaign?"
    context: "This question uses time series analysis to detect sudden increases in the delivery of specific high-risk file types (e.g., ZIP files, ISO images). By forecasting the expected daily volume based on historical data, the system can alert when the observed count significantly exceeds the prediction. This can indicate a coordinated, large-scale attack campaign leveraging a particular malware delivery method."
    answer_sources:
      - "Zeek files.log"
      - "Perimeter email gateway; DNS resolvers; Web proxies"
    range: "last 90 days"
    queries:
      - "MODEL daily counts of high-risk attachment types using a time series model (e.g., SARIMA). FORECAST expected volume for next day. IF observed volume exceeds predicted upper confidence interval, ALERT."
  - question: "Has a newly observed sender domain sent a high volume of emails to a specific group of internal recipients in a short period?"
    context: "This question is designed to detect the initial stages of a spear-phishing campaign. It identifies sender domains that have not been seen in the last 60 days and triggers an alert if they suddenly send a burst of emails (e.g., more than 10) to a group of recipients within a short window (e.g., 1 hour). This targets attacks from newly registered or compromised domains."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek smtp.log"
      - "Network security monitoring sensor tap points; Perimeter email gateway logs; Directory services (for recipient group enrichment)"
    range: "last 90 days"
    queries:
      - "MAINTAIN list of sender domains seen in last 60 days. IF a new domain sends > 10 emails in 1 hour, ALERT."
  - question: "Is an external sender domain exhibiting a sudden spike in email volume or the number of unique recipients?"
    context: "This question identifies anomalous sending behavior from external domains by baselining their normal activity. It monitors the hourly email volume and number of unique recipients for each sender. An alert is generated if a sender's activity significantly deviates from its established norm (e.g., exceeds 3 standard deviations above the 30-day moving average), which could indicate a compromised account or the start of a spam/phishing campaign."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek smtp.log"
      - "Network security monitoring sensor tap points; Perimeter email gateway logs; Directory services (for recipient group enrichment)"
    range: "last 90 days"
    queries:
      - "FOR each external sender, BASELINE hourly email volume and recipient count over 30 days. IF current hour's volume exceeds 3 standard deviations above average, ALERT."
  - question: "Has a new external sender sent an email that precisely targets a known internal communication group?"
    context: "This question uses graph analysis and community detection to model internal communication patterns. It identifies clusters of employees who frequently email each other (e.g., 'Finance Team'). An email from a new or unknown external sender that is sent to a high percentage of a single, well-defined community is flagged as highly anomalous. This suggests the attacker has performed reconnaissance and is targeting a specific business unit."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek smtp.log"
      - "Network security monitoring sensor tap points; Perimeter email gateway logs; Directory services (for recipient group enrichment)"
    range: "last 90 days"
    queries:
      - "BUILD sender-recipient graph. IDENTIFY internal communities using Louvain Modularity. IF new sender emails >80% of a single community, ALERT."
  - question: "Has a series of failed login attempts from a single IP been immediately followed by a successful login for an account known to be exposed in a data breach?"
    context: "This question aims to detect successful brute-force or password-spraying attacks. It correlates a pattern of multiple failed authentication events with a subsequent successful login for the same user from the same source IP. The alert is enriched and prioritized if the compromised user account is found in a database of credentials exposed in public data breaches, indicating a high likelihood of account takeover."
    answer_sources:
      - "Windows Event ID 4625"
      - "Windows Event ID 4624"
      - "Zeek conn.log"
      - "Internet-facing authentication servers (e.g., ADFS, Exchange OWA); VPN concentrators; Domain Controllers"
    range: "last 90 days"
    queries:
      - "IF >10 failed logins (Event 4625) from same IP for same user in 5 mins, FOLLOWED by successful login (Event 4624), AND user is in public breach database, ALERT."
  - question: "Is an external source IP exhibiting an anomalously high ratio of failed-to-successful login attempts?"
    context: "This question identifies potential credential-based attacks by monitoring the behavior of external IP addresses. It calculates the ratio of failed to total login attempts for each source IP within a short time window. An IP whose failure ratio is in the top percentile (e.g., 99th) compared to a baseline of all external IPs is flagged, as this is a strong indicator of a brute-force or password-spraying attempt."
    answer_sources:
      - "Windows Event ID 4625"
      - "Windows Event ID 4624"
      - "Zeek conn.log"
      - "Internet-facing authentication servers (e.g., ADFS, Exchange OWA); VPN concentrators; Domain Controllers"
    range: "last 90 days"
    queries:
      - "FOR each external IP, CALCULATE failed/total login ratio in a 5-min window. IF ratio exceeds 99th percentile of baseline, ALERT."
  - question: "Did a successful user login, especially one following a series of failures, deviate from the user's established login behavior model?"
    context: "This question builds a behavioral profile for each user's successful logins, considering factors like time of day, source ASN, and logon type. An unsupervised machine learning model (e.g., Isolation Forest) scores each new login against this profile. A login with a high anomaly score, particularly one that occurs after a burst of failed attempts, is a strong indicator of account compromise, even if the credentials used were correct."
    answer_sources:
      - "Windows Event ID 4625"
      - "Windows Event ID 4624"
      - "Zeek conn.log"
      - "Internet-facing authentication servers (e.g., ADFS, Exchange OWA); VPN concentrators; Domain Controllers"
    range: "last 90 days"
    queries:
      - "FOR each user, MODEL normal login behavior (time, ASN, etc.). SCORE each new successful login. IF score is highly anomalous, ALERT."