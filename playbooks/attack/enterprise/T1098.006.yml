name: T1098.006: Additional Container Cluster Roles
id: 5a1b3c4d-6e7f-4a8b-9c0d-1e2f3a4b5c6d
description: This playbook investigates adversary activity where Kubernetes RBAC roles are created or modified to establish persistence or escalate privileges. It focuses on detecting suspicious API requests, the creation of overly permissive roles (e.g., 'cluster-admin'), unusual user behavior patterns, and activity sequences indicative of reconnaissance followed by modification. The goal is to identify and respond to unauthorized changes to container cluster roles.
type: technique
related:
  - TA0003: Persistence
  - TA0004: Privilege Escalation
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Are Kubernetes RBAC API requests originating from IPs on threat intelligence feeds or using User-Agents associated with malicious tools?
    context: This question helps detect attacks using known malicious infrastructure or tools. By monitoring API requests to RBAC endpoints, we can identify traffic from IPs on threat intelligence lists (e.g., TOR exit nodes) or requests with User-Agent strings from known Kubernetes attack tools (e.g., 'kube-hunter', 'peirates'). A match is a high-fidelity indicator of a potential compromise attempt.
    answer_sources:
      - Zeek conn.log
      - Zeek http.log
      - Kubernetes API Server
      - Network Egress/Ingress Points
      - Threat Intelligence Platform
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          SEARCH Zeek logs for traffic to k8s_api_server
          WHERE (source_ip IN threat_intel_feed) OR (http_user_agent IN malicious_tool_signatures)
          ALERT on match
  - question: Is an RBAC modification request originating from an IP with a rare ASN or country of origin?
    context: This question aims to identify suspicious RBAC modification attempts by baselining the geographic and network origin of API traffic. By calculating the historical frequency of ASNs and source countries for API requests, we can flag requests from origins that are statistically rare (e.g., accounting for less than 0.1% of traffic), which may indicate an anomalous or malicious source.
    answer_sources:
      - Zeek conn.log
      - Zeek http.log
      - Kubernetes API Server
      - Network Egress/Ingress Points
      - Threat Intelligence Platform
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each new RBAC modification request
          CALCULATE historical frequency of source_ip.asn and source_ip.country
          IF frequency < threshold (e.g., 0.1%)
          ALERT on anomaly
  - question: Can a machine learning model classify a new RBAC API request as malicious based on its characteristics?
    context: This question leverages machine learning to detect complex malicious requests that might evade simpler rules. A classification model is trained on labeled historical data using features like User-Agent characteristics, request method, URI, and IP reputation. The deployed model then scores new requests in real-time, providing a probabilistic assessment of whether a request is malicious.
    answer_sources:
      - Zeek conn.log
      - Zeek http.log
      - Kubernetes API Server
      - Network Egress/Ingress Points
      - Threat Intelligence Platform
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each new RBAC API request
          EXTRACT features (user_agent, method, uri, ip_reputation)
          SCORE request with trained classification model
          IF score > confidence_threshold
          ALERT on malicious classification
  - question: Is a new role binding being created that suspiciously binds a high-privilege role like 'cluster-admin' to a ServiceAccount or has a name like 'backdoor' or 'pwn'?
    context: This question focuses on detecting the creation of overtly malicious or high-privilege role bindings. By inspecting the payload of POST requests to RBAC endpoints, we can look for specific red flags: binding the 'cluster-admin' role to a ServiceAccount outside the 'kube-system' namespace, or naming the binding with suspicious keywords. These are strong indicators of persistence or privilege escalation.
    answer_sources:
      - Zeek http.log
      - Kubernetes API Server
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          SEARCH http.log for POST to RBAC endpoints
          PARSE JSON body
          IF (roleRef.name == 'cluster-admin' AND subject.kind == 'ServiceAccount' AND subject.namespace != 'kube-system') OR (metadata.name MATCHES '.*-backdoor.*|.*-pwn.*')
          ALERT on match
  - question: Is the creation of a new high-privilege role binding a statistically rare event?
    context: This question helps identify anomalous privilege grants by understanding the normal frequency of such events. By establishing a baseline for how often high-privilege bindings occur, we can alert when a new one is created if the event is statistically rare (e.g., occurs less than once a quarter), suggesting an unplanned or unauthorized action.
    answer_sources:
      - Zeek http.log
      - Kubernetes API Server
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          MAINTAIN baseline frequency of high-privilege role bindings
          ON new high-privilege role binding event
          IF event_frequency is a statistical outlier (e.g., > 99th percentile)
          ALERT on anomaly
  - question: Does an anomaly detection model identify a new role binding request as a significant outlier?
    context: This question applies machine learning to identify novel or unusual role binding requests. An anomaly detection model is trained on a baseline of legitimate binding events, learning the normal combinations of features (creator, role, subject, source IP). The model can then flag new requests that deviate significantly from this learned norm.
    answer_sources:
      - Zeek http.log
      - Kubernetes API Server
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each new role binding request
          EXTRACT features (subject, role, creator_ua, source_ip)
          SCORE request with trained anomaly detection model
          IF anomaly_score > threshold
          ALERT on outlier
  - question: Was a Kubernetes RBAC modification performed by a user principal not on the authorized list of administrators?
    context: This question provides a high-fidelity method for detecting unauthorized changes. By maintaining a static, curated list of user accounts permitted to modify RBAC roles, any modification attempt from a user not on this list can be immediately flagged as a security incident, enforcing strict change control.
    answer_sources:
      - Zeek http.log
      - Kubernetes API Server
      - Identity and Access Management System
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          SEARCH http.log for RBAC modification
          WHERE user NOT IN authorized_admin_list
          ALERT on match
  - question: Did an authorized administrator perform an RBAC modification at an unusual time (e.g., late at night or on a weekend)?
    context: This question helps detect account compromise or insider threats by baselining the typical working hours for administrative activity. An RBAC modification that occurs far outside an administrator's established activity pattern (e.g., more than two standard deviations from the mean time) is flagged as anomalous.
    answer_sources:
      - Zeek http.log
      - Kubernetes API Server
      - Identity and Access Management System
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each admin RBAC modification
          CALCULATE time deviation from user's baseline
          IF deviation > threshold (e.g., 2 STDEV)
          ALERT on anomaly
  - question: Did the number of RBAC changes made by an administrator significantly exceed the forecasted number for a given time interval?
    context: This question uses a time-series model (e.g., ARIMA) to detect an abnormal volume of activity from a single administrator. If the actual number of changes spikes and significantly exceeds the model's prediction for a given hour, it could indicate a compromised account being used to make rapid, unauthorized changes.
    answer_sources:
      - Zeek http.log
      - Kubernetes API Server
      - Identity and Access Management System
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FORECAST expected RBAC changes for user per hour
          IF actual_changes > forecast_upper_bound
          ALERT on volume anomaly
  - question: Did a source IP rapidly enumerate RBAC resources and then immediately attempt to create or modify a role binding?
    context: This question aims to detect the common attack pattern of "reconnaissance followed by action." A stateful rule triggers an alert if a source IP generates a high number of GET requests to RBAC endpoints (e.g., >50 in 5 minutes), and then follows up with a POST or PUT request to create or modify a binding.
    answer_sources:
      - Zeek http.log
      - Zeek conn.log
      - Kubernetes API Server
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          TRACK source IP API calls
          IF (count(GET to RBAC) > 50 in 5min) AND (subsequent POST/PUT to RBAC from same IP in next 5min)
          ALERT on pattern
  - question: Did a user's ratio of read-to-write operations on RBAC objects significantly exceed their normal baseline?
    context: This question identifies abnormal enumeration by focusing on the ratio of read (GET) to write (POST/PUT) operations for each user. An attacker performing reconnaissance will likely have a much higher read-to-write ratio. Alerting when a user's ratio exceeds a high percentile threshold detects this pre-attack behavior.
    answer_sources:
      - Zeek http.log
      - Zeek conn.log
      - Kubernetes API Server
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each user
          CALCULATE read/write ratio in time window
          IF ratio > 99th_percentile_baseline
          ALERT on ratio anomaly
  - question: Does a user's sequence of API calls deviate from the patterns of a normal administrative session?
    context: This question uses sequence analysis (e.g., a Hidden Markov Model) to detect attack patterns that manifest as an abnormal order of operations. An attacker's session (e.g., rapid 'list', 'get', then 'create') would have a low probability under a model trained on normal administrative workflows and be flagged as a deviation.
    answer_sources:
      - Zeek http.log
      - Zeek conn.log
      - Kubernetes API Server
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          MODEL sequence of admin API calls
          FOR each new user session
          IF session_sequence_probability < threshold
          ALERT on anomalous sequence
  - question: Did an RBAC modification request originate from a node IP that was recently flagged for suspicious process activity?
    context: This question correlates host-level security events with Kubernetes API activity. A SIEM rule can place a node's IP on a watchlist after a suspicious process alert (e.g., from Event ID 4688). If an RBAC modification request is then seen from that IP, it's a strong indicator that a compromised node is being used to escalate privileges.
    answer_sources:
      - Zeek conn.log
      - Zeek http.log
      - Windows Event ID 4688
      - Cluster Worker Nodes
      - Kubernetes API Server
      - Security Incident and Event Management (SIEM) System
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          ON suspicious process alert (Event ID 4688)
          ADD host IP to watchlist for 60min
          IF RBAC modification from IP on watchlist
          TRIGGER critical alert
  - question: Was an RBAC modification initiated from a node with a high cumulative risk score?
    context: This question uses a risk-scoring model to prioritize threats. Each node's risk score increases with each security event. An RBAC modification from a node whose score has crossed a high threshold (e.g., 95th percentile) is flagged, suggesting the action is part of a chain of suspicious activities.
    answer_sources:
      - Zeek conn.log
      - Zeek http.log
      - Windows Event ID 4688
      - Cluster Worker Nodes
      - Kubernetes API Server
      - Security Incident and Event Management (SIEM) System
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          MAINTAIN risk score for each node IP
          ON RBAC modification
          IF source_node_ip.risk_score > 95th_percentile_threshold
          ALERT on high-risk action
  - question: Does a graph-based model identify a highly anomalous path linking a suspicious process to an RBAC modification?
    context: This question uses a graph model to visualize and detect multi-stage attacks. Entities (pods, nodes, users) and their interactions (API calls, processes) are modeled. The model can identify highly improbable paths, such as an anomalous process on a node followed by an API call from that node to modify RBAC, flagging it as a likely attack chain.
    answer_sources:
      - Zeek conn.log
      - Zeek http.log
      - Windows Event ID 4688
      - Cluster Worker Nodes
      - Kubernetes API Server
      - Security Incident and Event Management (SIEM) System
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          MODEL cluster activity as a graph (nodes, pods, users, etc.)
          IDENTIFY anomalous subgraphs, e.g., (Anomalous Process) -> [on Node X] -> (RBAC Mod API Call)
          ALERT on anomalous path detection
  - question: Is a new role binding granting high-risk permissions, such as 'impersonate', wildcard ('*'), or the ability to modify RBAC itself?
    context: This question targets the creation of roles with inherently dangerous permissions. By parsing the role definition associated with a new binding, we can create high-severity alerts if the role's rules grant the ability to 'impersonate' users, use wildcards for verbs or resources, or allow the creation/updating of other roles.
    answer_sources:
      - Zeek http.log
      - Kubernetes API Server
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          ON new role binding
          PARSE associated role definition
          IF role.rules contains 'impersonate', '*', or 'create/update' on rbac resources
          TRIGGER critical alert
  - question: Does a new role binding assign a role with a statistically anomalous 'privilege score' to a non-administrative account?
    context: This question quantifies the risk of a role to detect when a high-risk role is assigned to a low-privilege subject. A 'privilege score' is calculated for each role. An alert is triggered if a new binding assigns a role with a score that is a statistical outlier for that subject type (e.g., a non-admin service account).
    answer_sources:
      - Zeek http.log
      - Kubernetes API Server
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          CALCULATE privilege_score for each role
          FOR new bindings to non-admin subjects
          IF assigned_role.privilege_score is outlier for subject_type
          ALERT on anomaly
  - question: Is a machine learning model classifying a newly bound role as 'high-risk' for a subject not previously associated with such roles?
    context: This question uses a classifier to automate identifying risky role assignments. A model categorizes roles as 'high-risk' or 'low-risk'. If a role is classified as 'high-risk' and is bound to a subject (user or service account) that does not typically have high-risk roles, the event is flagged as a potential privilege escalation.
    answer_sources:
      - Zeek http.log
      - Kubernetes API Server
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          CLASSIFY role as 'high-risk' or 'low-risk' with ML model
          IF role is 'high-risk' AND subject is not a privileged user
          ALERT on risky assignment
  - question: Has a 'ServiceAccount' been bound to the 'cluster-admin' role?
    context: This question addresses a critical privilege escalation vector. Binding a ServiceAccount to the 'cluster-admin' role gives any pod with that account full control over the cluster. A zero-tolerance rule should generate an immediate, critical alert if a POST request creates such a binding.
    answer_sources:
      - Zeek http.log
      - Kubernetes API Server
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          SEARCH http.log for POST to /clusterrolebindings
          PARSE body
          IF subject.kind == 'ServiceAccount' AND roleRef.name == 'cluster-admin'
          TRIGGER IMMEDIATE CRITICAL ALERT
  - question: Has the count of ServiceAccounts bound to 'cluster-admin' increased from a baseline of zero?
    context: This question provides a simple statistical confirmation for the previous symbolic rule. In a secure environment, the number of ServiceAccounts bound to 'cluster-admin' should be zero. Any increase from this baseline is a critical statistical deviation that must be alerted on.
    answer_sources:
      - Zeek http.log
      - Kubernetes API Server
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          MAINTAIN count of ServiceAccount-to-cluster-admin bindings
          IF count > 0
          ALERT
  - question: Would an anomaly detection model flag the binding of a ServiceAccount to 'cluster-admin' as a massive outlier?
    context: While best handled by a symbolic rule, this question confirms the event's severity using a different methodology. An anomaly detection model trained on legitimate binding events would not have seen this pattern, so it would assign an extremely high anomaly score, confirming it as a critical event.
    answer_sources:
      - Zeek http.log
      - Kubernetes API Server
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          SCORE ServiceAccount-to-cluster-admin binding with anomaly model
          CONFIRM high anomaly score
  - question: Did a user successfully modify an RBAC binding despite lacking the necessary permissions to do so?
    context: This question aims to detect the exploitation of a privilege escalation vulnerability in the Kubernetes API server. It checks if a user who successfully modified an RBAC binding (HTTP 200/201) actually had the required permissions. A success despite lacking permissions points to a potential exploit.
    answer_sources:
      - Zeek http.log
      - Kubernetes API Server
      - Identity and Access Management System
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          ON successful RBAC modification (HTTP 200/201)
          CHECK user's cached permissions
          IF user lacks 'create/update' permission for the resource
          ALERT on potential exploit
  - question: Did a user grant a role with a significantly higher privilege level than they typically do?
    context: This question detects anomalous behavior by analyzing the 'privilege delta'â€”the change in privilege a user grants. If a user who normally grants low-privilege roles suddenly grants a high-privilege one, this creates a statistical anomaly in their behavior. Alerting on large deltas can uncover compromised accounts.
    answer_sources:
      - Zeek http.log
      - Kubernetes API Server
      - Identity and Access Management System
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          FOR each user
          PROFILE the privilege score of roles they grant
          IF new grant has privilege_delta > 95th percentile for that user
          ALERT on anomaly
  - question: Did a user perform an RBAC modification that is highly unusual compared to the behavior of their peers?
    context: This question uses peer group analysis to spot outliers. A model learns the typical RBAC modification behaviors for each group (e.g., by department). If a user's action significantly deviates from their peers' collective behavior, it is flagged as an anomaly, even if the user has the technical permissions to perform it.
    answer_sources:
      - Zeek http.log
      - Kubernetes API Server
      - Identity and Access Management System
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          GROUP users into peer groups
          MODEL typical RBAC actions for each group
          IF user action deviates significantly from their peer group's model
          ALERT on peer-based anomaly
  - question: Was a known Kubernetes exploit process executed on a node shortly before an RBAC modification API call was made from that same node?
    context: This question links an exploit with subsequent malicious activity. It monitors for processes matching known Kubernetes exploits (from Event ID 4688). If a match occurs, it correlates the node's IP with API logs. An RBAC modification call from that IP within 15 minutes is a strong indicator of a successful attack.
    answer_sources:
      - Windows Event ID 4688
      - Zeek conn.log
      - Zeek http.log
      - Cluster Worker Nodes
      - Kubernetes API Server
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          ON known exploit process detection (Event ID 4688)
          IF RBAC modification from same host IP within 15 mins
          TRIGGER critical alert
  - question: Was a process with a highly random command-line argument executed on a node shortly before an RBAC modification API call from that node?
    context: This question uses command-line entropy as a proxy for obfuscated scripts. An unusually high entropy score in a process's command-line arguments (from Event ID 4688) is treated as a suspicious event and correlated with subsequent Kubernetes API calls from the same host, linking host and cluster activity.
    answer_sources:
      - Windows Event ID 4688
      - Zeek conn.log
      - Zeek http.log
      - Cluster Worker Nodes
      - Kubernetes API Server
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          CALCULATE entropy of process command lines (Event ID 4688)
          IF entropy > 99th percentile
          CORRELATE with subsequent API calls from same host IP and ALERT
  - question: Did a machine learning classifier flag a process as malicious on a node shortly before an RBAC modification was initiated from that node?
    context: This question automates the detection and correlation of malicious host activity. A classifier is trained to identify malicious processes from Event ID 4688 data. When the model flags a process, it triggers a workflow that monitors for and critically alerts on any subsequent Kubernetes API interactions from that host's IP.
    answer_sources:
      - Windows Event ID 4688
      - Zeek conn.log
      - Zeek http.log
      - Cluster Worker Nodes
      - Kubernetes API Server
    range: last 90 days
    queries:
      - technology: pseudocode
        query: |
          CLASSIFY processes with ML model
          ON malicious classification
          TRIGGER monitoring of host IP for k8s API activity
          ALERT on any interaction