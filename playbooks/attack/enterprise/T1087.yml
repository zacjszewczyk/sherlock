name: "T1087: Account Discovery"
id: "a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d"
description: "This playbook helps investigate if an adversary is attempting to discover local, domain, or cloud accounts. This involves detecting the execution of known discovery utilities (e.g., AdFind), the use of built-in command-line tools (`net user`, `Get-ADUser`), unusual process execution chains (e.g., Office spawning PowerShell), anomalous directory service query patterns (LDAP, SAMR), and access to decoy accounts or files (honeytokens)."
type: "technique"
related: "TA0007: Discovery"
contributors: "Zachary Szewczyk, Ask Sage"
created: "2025-10-01"
modified: "2025-10-01"
version: 1.0
tags: "none"
questions:
  - question: "Are known malicious account discovery utilities being executed on the network, identified by their file hash or filename?"
    context: "This question aims to detect the use of well-known adversary tools like AdFind or SharpHound. By cross-referencing process creation events against a list of known malicious tool hashes and names, we can quickly identify blatant discovery attempts. A match provides high-fidelity evidence of malicious intent."
    answer_sources: "Windows Event ID 4688, Domain Controllers, Member Servers, Privileged Access Workstations"
    range: "last 90 days"
    queries: "SIEM Query: Search process creation logs (EID 4688) where ProcessHash-SHA256 or OriginalFileName matches a threat intelligence list of account discovery tools."
  - question: "Are any rarely seen or unusually named processes being executed that are not on the corporate allow-list?"
    context: "This question helps find discovery tools that are renamed or are not yet in threat intelligence feeds. By baselining normal application usage and flagging executions of rare executables, analysts can uncover custom or obfuscated tools that would otherwise be missed by signature-based detection."
    answer_sources: "Windows Event ID 4688, Domain Controllers, Member Servers, Privileged Access Workstations"
    range: "last 90 days"
    queries: "Statistical Query: For each host, calculate the prevalence of each OriginalFileName over 30 days. Alert if a filename is not on an allow-list and its prevalence is below a rarity threshold (e.g., < 0.01%)."
  - question: "Can machine learning models identify process execution events that are highly indicative of malicious account discovery activity?"
    context: "This question leverages a machine learning model to perform nuanced detection. By training a model on features like command-line entropy, parent process, and user context, it can identify complex patterns of malicious behavior that are difficult to define with simple rules, providing a more robust and adaptive detection capability."
    answer_sources: "Windows Event ID 4688, Domain Controllers, Member Servers, Privileged Access Workstations"
    range: "last 90 days"
    queries: "ML Query: Score new process events in real-time using a trained classification model. Alert on events classified as malicious with high probability."
  - question: "Are command-line interpreters being used with specific arguments to enumerate local, domain, or cloud accounts?"
    context: "Adversaries frequently use native Windows utilities like 'net.exe' or PowerShell cmdlets like 'Get-ADUser' for discovery. This question focuses on detecting the exact command-line syntax used for account enumeration, providing a clear sign of 'living off the land' techniques."
    answer_sources: "Windows Event ID 4688, All Windows Endpoints, Domain Controllers, Application Servers, Cloud Tenant Environments"
    range: "last 90 days"
    queries: "SIEM Query: Search process command-line logs for regex patterns matching enumeration commands (e.g., 'net user', 'Get-ADUser', 'az ad user list')."
  - question: "Is any user or system executing an anomalous number of account enumeration commands compared to their historical baseline?"
    context: "While a single enumeration command might be legitimate, a sudden burst of them from a single user or host is highly suspicious. This question aims to detect this anomalous frequency, which often indicates automated scripting used by an adversary for large-scale reconnaissance."
    answer_sources: "Windows Event ID 4688, All Windows Endpoints, Domain Controllers, Application Servers, Cloud Tenant Environments"
    range: "last 90 days"
    queries: "Statistical Query: For each user/host, baseline the hourly frequency of enumeration commands. Alert if the count exceeds a statistical threshold (e.g., 3 standard deviations above the mean)."
  - question: "Can unsupervised machine learning models detect rare or obfuscated enumeration commands in command-line logs?"
    context: "Adversaries may obfuscate commands to evade simple regex-based rules. This question uses unsupervised learning (like Isolation Forest) to identify statistically unusual or outlier command-line strings, which can reveal novel or obfuscated enumeration techniques without prior knowledge of the specific syntax."
    answer_sources: "Windows Event ID 4688, All Windows Endpoints, Domain Controllers, Application Servers, Cloud Tenant Environments"
    range: "last 90 days"
    queries: "ML Query: Vectorize command-line strings using TF-IDF. Use an Isolation Forest model to identify and alert on outlier commands."
  - question: "Are command-line utilities (like cmd.exe or powershell.exe) being spawned by unusual parent processes such as Office applications or web browsers?"
    context: "Legitimate user activity rarely involves a program like Microsoft Word or Chrome launching a command prompt. This behavior is a classic indicator of a successful phishing attack or browser exploit. This question looks for these illogical parent-child process relationships, which are high-fidelity indicators of compromise."
    answer_sources: "Windows Event ID 4688, User Workstations, Web Servers, Microsoft Exchange Servers, Virtual Desktop Infrastructure (VDI)"
    range: "last 90 days"
    queries: "SIEM Query: Alert when a parent process from a list of unlikely parents (e.g., WINWORD.EXE, chrome.exe) spawns a child process like cmd.exe or powershell.exe."
  - question: "Are any statistically improbable parent-child process relationships occurring across the enterprise?"
    context: "Beyond a static list of 'bad' parents, this question seeks to identify any parent-child process pairing that is extremely rare in the environment's historical data. This can help uncover novel attack chains or malware behavior that doesn't fit pre-defined rules by flagging any process creation event that is a statistical anomaly."
    answer_sources: "Windows Event ID 4688, User Workstations, Web Servers, Microsoft Exchange Servers, Virtual Desktop Infrastructure (VDI)"
    range: "last 90 days"
    queries: "Statistical Query: Build a graph of all parent-child process relationships over 30 days. Alert on any new relationship with a conditional probability below a rarity threshold (e.g., < 0.001%)."
  - question: "Can machine learning models detect anomalous sequences of process creations within a user's session?"
    context: "Attacks are often a sequence of actions, not a single event. This question uses a sequence-based model (like an LSTM Autoencoder) to learn what a 'normal' series of process creations looks like for a user. It then flags entire user sessions that deviate from this norm, allowing it to detect complex attack chains like `OUTLOOK.EXE -> powershell.exe -> net.exe`."
    answer_sources: "Windows Event ID 4688, User Workstations, Web Servers, Microsoft Exchange Servers, Virtual Desktop Infrastructure (VDI)"
    range: "last 90 days"
    queries: "ML Query: Train an LSTM Autoencoder on normal user process sequences. Alert on user sessions where the model's reconstruction error is high."
  - question: "Are there specific, known-bad directory service queries (like SAMR EnumDomainUsers) or Kerberos errors (KDC_ERR_S_PRINCIPAL_UNKNOWN) occurring on the network?"
    context: "This question targets specific network-level indicators of Active Directory enumeration. Operations like `EnumDomainUsers` via SAMR or a large number of Kerberos requests for non-existent service principal names (SPNs) are hallmark signs of tools like BloodHound or Kerbrute. Detecting these specific operations provides direct evidence of active reconnaissance."
    answer_sources: "Zeek conn.log, Zeek ldap.log, Zeek dce_rpc.log, Zeek kerberos.log, Windows Event ID 4662, Network segments fronting Domain Controllers, The Domain Controllers themselves"
    range: "last 90 days"
    queries: "Network Query: From Zeek logs, alert on SAMR EnumDomainUsers operations or a high volume of Kerberos TGS-REQ requests with the KDC_ERR_S_PRINCIPAL_UNKNOWN error code from a single source."
  - question: "Is any client host generating an anomalously high volume or variety of LDAP queries to a domain controller?"
    context: "While LDAP queries are normal, a massive volume or an unusually diverse set of queries from a single host is not. This question aims to detect this behavior by monitoring both the quantity of LDAP requests and the complexity (entropy) of the search filters used. A sudden spike in either metric is a strong indicator of automated enumeration."
    answer_sources: "Zeek conn.log, Zeek ldap.log, Zeek dce_rpc.log, Zeek kerberos.log, Windows Event ID 4662, Network segments fronting Domain Controllers, The Domain Controllers themselves"
    range: "last 90 days"
    queries: "Statistical Query: Baseline LDAP requests per source IP. Alert if a source exceeds the 95th percentile. Also, alert if the Shannon entropy of LDAP filter attributes from a source spikes suddenly."
  - question: "Is any endpoint behaving differently from its peers in terms of its directory service query patterns?"
    context: "Hosts with similar roles (e.g., all finance department workstations) should have similar network behavior. This question uses machine learning to cluster hosts into peer groups and then looks for outliers within each group. A host that suddenly starts making many more LDAP/SAMR queries than its peers is anomalous and warrants investigation."
    answer_sources: "Zeek conn.log, Zeek ldap.log, Zeek dce_rpc.log, Zeek kerberos.log, Windows Event ID 4662, Network segments fronting Domain Controllers, The Domain Controllers themselves"
    range: "last 90 days"
    queries: "ML Query: Peer group hosts using K-Means clustering on network traffic features. Use a time-series anomaly detection model to flag hosts whose LDAP/SAMR query volume deviates from their peer group's forecast."
  - question: "Has any access been attempted on a pre-defined canary object, such as a decoy user account or a fake password file?"
    context: "Honeytokens (or canaries) are traps. No legitimate process or user should ever interact with them. This question focuses on creating high-fidelity alerts that trigger upon any access to these decoy objects. An alert from a honeytoken is a nearly certain indicator of compromise."
    answer_sources: "Windows Event ID 4663, Windows Event ID 5145, Windows Event ID 4720, File Servers, SharePoint Sites, Network-accessible Script Repositories, Domain Controllers"
    range: "last 90 days"
    queries: "SIEM Query: Create a high-priority alert that triggers on any access attempt (EID 4663/5145) to decoy files or any activity (e.g., EID 4720) related to a decoy user account."
  - question: "Is a single user or process accessing an anomalously high number of distinct user home directories or profiles in a short period?"
    context: "Adversaries often iterate through user directories to find sensitive information. Normal users or processes typically do not access a large number of different users' home folders in a short time. This question establishes a baseline for this behavior and alerts when a process or user grossly exceeds it, suggesting automated data harvesting."
    answer_sources: "Windows Event ID 4663, Windows Event ID 5145, Windows Event ID 4720, File Servers, SharePoint Sites, Network-accessible Script Repositories, Domain Controllers"
    range: "last 90 days"
    queries: "Statistical Query: Baseline the number of unique user directories accessed per user/process per hour. Alert when this count exceeds 3 standard deviations above the baseline."
  - question: "Can machine learning models identify anomalous file access patterns indicative of discovery or data staging?"
    context: "This question uses a machine learning model to learn what 'normal' file access looks like in terms of the process, user, file path, and access velocity. By identifying events that are outliers to this normal model, it can detect suspicious activity like a single process rapidly accessing many different user-related objects, even if it doesn't cross a simple volumetric threshold."
    answer_sources: "Windows Event ID 4663, Windows Event ID 5145, Windows Event ID 4720, File Servers, SharePoint Sites, Network-accessible Script Repositories, Domain Controllers"
    range: "last 90 days"
    queries: "ML Query: Train a One-Class SVM on normal file access features (process name, user, path entropy, access velocity). Use the model to score and identify outlier access events."