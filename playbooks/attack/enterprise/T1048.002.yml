name: T1048.002: Exfiltration Over Asymmetric Encrypted Non-C2 Protocol
id: 3c5e8456-42d8-4f2b-8a1e-967b0d1c3e9a
description: This playbook helps to determine if an adversary is exfiltrating data from the network over an encrypted, non-C2 channel. This involves identifying outbound encrypted connections to known malicious destinations, connections using suspicious TLS certificates (e.g., self-signed), or connections exhibiting anomalous data volumes. The playbook also investigates statistical deviations from established baselines, such as sudden spikes in outbound data from a host, highly asymmetric data flows where outbound data far exceeds inbound data, and connections initiated by unapproved or suspicious processes (e.g., dual-use tools running from temp directories).
type: technique
related:
  - TA0010: Exfiltration
contributors:
  - Zachary Szewczyk
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Are there any outbound encrypted connections to IP addresses or domains known to be malicious?
    context: This question aims to identify direct communication with known malicious infrastructure. By joining network connection logs (Zeek conn.log), DNS request logs (Zeek dns.log), and SSL/TLS handshake logs (Zeek ssl.log), analysts can correlate destination IPs, requested domains, and the Server Name Indication (SNI) from the encrypted session. Matching any of these indicators against a threat intelligence feed provides a high-confidence signal that an outbound connection is associated with malicious activity, potentially for data exfiltration.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Zeek ssl.log
      - Threat Intelligence Feed
      - Internet Gateway/Egress Points
      - Internal DNS Resolvers
      - Outbound Web Proxies
    range: last 90 days
    queries:
      - pseudocode: JOIN Zeek conn, dns, ssl logs ON uid | LOOKUP destination_ip, query_domain, server_name in threat_intel_feed | WHERE match_found | ALERT
  - question: Are there any high-volume data transfers to rare or newly observed domains?
    context: Adversaries often use new or unique domains for data exfiltration to avoid blocklists. This question focuses on identifying statistical outliers. It involves calculating the frequency of connections to all external domains/IPs across the organization. Destinations that are rarely contacted (e.g., by a small percentage of hosts) and are also receiving an unusually large amount of outbound data (e.g., in the top 5th percentile) are highly suspicious and warrant investigation for potential data exfiltration.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Zeek ssl.log
      - Internet Gateway/Egress Points
      - Internal DNS Resolvers
      - Outbound Web Proxies
    range: last 90 days
    queries:
      - pseudocode: CALCULATE frequency of destination_ip/domain across all hosts | IDENTIFY rare destinations (<1% of hosts) | FILTER rare destination connections with high outbound_bytes (top 5th percentile) | ALERT
  - question: Can we predict if a new encrypted connection is malicious based on its characteristics?
    context: This question leverages machine learning to proactively identify malicious connections that may not appear on threat intelligence feeds yet. A supervised classification model can be trained on a rich feature set from network logs, including JA3/JA3S hashes (TLS client/server fingerprints), certificate details, and connection statistics. By training the model with known benign and malicious connections, it can learn to predict the probability that a new, unseen connection is malicious, allowing for the detection of novel exfiltration channels.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Zeek ssl.log
      - Threat Intelligence Feed
      - Internet Gateway/Egress Points
      - Internal DNS Resolvers
      - Outbound Web Proxies
    range: last 90 days
    queries:
      - pseudocode: EXTRACT features (JA3, cert_details, conn_stats) from Zeek logs | INPUT features into trained classification model | WHERE prediction is 'malicious' with high_confidence | ALERT
  - question: Are there any high-volume data transfers using self-signed or invalid TLS certificates?
    context: Legitimate services typically use valid, trusted TLS certificates. Adversaries may use self-signed or improperly configured certificates for their exfiltration channels to avoid the cost and traceability of legitimate certificates. This question seeks to find connections that use suspicious certificates (e.g., 'self-signed certificate' status) and are also associated with a large amount of outbound data, which could indicate a data staging or exfiltration attempt.
    answer_sources:
      - Zeek conn.log
      - Zeek ssl.log
      - Internet Gateway/Egress Points
      - Endpoints initiating TLS traffic
    range: last 90 days
    queries:
      - pseudocode: FILTER Zeek ssl.log for validation_status == 'self-signed certificate' or contains 'error' | JOIN with conn.log ON uid | WHERE outbound_bytes > 10MB | ALERT
  - question: Which outbound TLS connections have the most suspicious certificate and data transfer characteristics combined?
    context: This question uses a scoring system to find connections that are anomalous across multiple dimensions. Instead of relying on a single indicator, it aggregates suspicious attributes like the use of a self-signed certificate, a low-entropy (random-looking) subject/issuer name, and a short validity period. Connections that accumulate a high anomaly score and also exhibit a highly asymmetric data flow (many more bytes sent than received) are strong candidates for investigation.
    answer_sources:
      - Zeek conn.log
      - Zeek ssl.log
      - Internet Gateway/Egress Points
      - Endpoints initiating TLS traffic
    range: last 90 days
    queries:
      - pseudocode: FOR each TLS connection, CALCULATE anomaly_score based on cert_status, subject/issuer_entropy, validity_duration | WHERE anomaly_score > 98th percentile AND outbound_bytes/inbound_bytes > 10 | ALERT
  - question: Can we automatically detect anomalous TLS connections without prior labels?
    context: This question applies unsupervised machine learning to find outliers without needing pre-labeled malicious examples. An anomaly detection model, like an Isolation Forest, can be trained on features from TLS handshakes (certificate validity, key length, issuer details, etc.). The model learns what 'normal' TLS connections look like and can then identify connections that deviate significantly from this norm. When these outliers are also linked to high-volume outbound data transfers, they become high-priority events.
    answer_sources:
      - Zeek conn.log
      - Zeek ssl.log
      - Internet Gateway/Egress Points
      - Endpoints initiating TLS traffic
    range: last 90 days
    queries:
      - pseudocode: EXTRACT features (cert_validity, key_length, issuer) from ssl.log | INPUT features into trained anomaly detection model | WHERE model_classifies as 'outlier' | CORRELATE with high outbound_bytes from conn.log | ALERT
  - question: Are there any single, exceptionally large outbound data transfers to destinations other than sanctioned cloud services?
    context: This question seeks to identify bulk data exfiltration in a single session. It sets a high, static threshold for outbound data (e.g., 500MB) to catch significant data dumps. To reduce false positives, it's crucial to exclude traffic to known, legitimate large-file-transfer services used by the organization. Any connection that meets the size threshold and is not on the allowlist is considered highly suspicious.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Zeek ssl.log
      - Internet Gateway/Egress Points
      - High-Value Asset Servers
      - User Workstations
    range: last 90 days
    queries:
      - pseudocode: FILTER Zeek conn.log for outbound_bytes > 500MB | EXCLUDE connections to known_good_large_file_services | ALERT
  - question: Has any host sent a statistically unusual amount of data to an external destination compared to its own baseline?
    context: This question aims to detect changes in a host's behavior over time. By calculating a rolling 30-day baseline (mean and standard deviation) of outbound data volume for each unique host-destination pair, we can detect when a host suddenly sends significantly more data than it normally does to a specific destination. An alert is triggered when the volume exceeds a statistical threshold (e.g., 3 standard deviations above the mean).
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Zeek ssl.log
      - Internet Gateway/Egress Points
      - High-Value Asset Servers
      - User Workstations
    range: last 90 days
    queries:
      - pseudocode: FOR each host-destination pair, CALCULATE 30-day rolling baseline (mean, stdev) of daily_outbound_bytes | WHERE today's_outbound_bytes > (mean + 3 * stdev) | ALERT
  - question: Can we forecast a host's normal outbound data volume and detect unpredicted spikes?
    context: This question uses time-series forecasting to model the expected outbound data traffic for each host. Models like ARIMA or Prophet can learn the normal patterns of a host's data transfer behavior. When the actual observed data volume significantly exceeds the model's prediction (i.e., falls outside the forecast's confidence interval), it signals a sudden, anomalous spike in traffic that is not explained by past behavior.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Zeek ssl.log
      - Internet Gateway/Egress Points
      - High-Value Asset Servers
      - User Workstations
    range: last 90 days
    queries:
      - pseudocode: FOR each host, TRAIN time-series model on historical daily_outbound_volume | FORECAST expected volume for today | WHERE observed_volume > forecasted_confidence_interval | ALERT
  - question: Are there any connections with a very high outbound-to-inbound data ratio?
    context: This question looks for highly asymmetric connections, a hallmark of data exfiltration. A connection where the amount of data sent is an order of magnitude larger than the data received (e.g., a 50:1 ratio) is highly abnormal. This query filters for connections that exceed a large outbound data threshold and a high asymmetry ratio, indicating a one-way 'data dump'.
    answer_sources:
      - Zeek conn.log
      - Internet Gateway/Egress Points
    range: last 90 days
    queries:
      - pseudocode: FILTER Zeek conn.log WHERE inbound_bytes > 0 AND outbound_bytes > 1MB AND (outbound_bytes / inbound_bytes) > 50 | ALERT
  - question: Are there any connections with an outbound-to-inbound data ratio that is anomalous for their specific service type?
    context: This question refines the search for asymmetric connections by adding service context. Different application protocols have different typical data flow ratios. By establishing a baseline of the outbound/inbound byte ratio for each service, we can identify connections that are outliers for that specific service. This method flags connections whose asymmetry exceeds a high percentile (e.g., 99th) for their protocol.
    answer_sources:
      - Zeek conn.log
      - Internet Gateway/Egress Points
    range: last 90 days
    queries:
      - pseudocode: FOR each service, CALCULATE percentile distribution of outbound/inbound byte ratio | FOR each new connection, CHECK if its ratio > 99th percentile for its service | ALERT
  - question: Can we identify clusters of network connections that represent data dumping behavior?
    context: This question uses unsupervised clustering to group connections with similar characteristics. By feeding features like connection duration, outbound bytes, and inbound bytes into a clustering algorithm like DBSCAN, we can automatically discover groups of connections. Clusters characterized by high outbound bytes, low inbound bytes, and short durations are of particular interest, as this profile strongly matches data exfiltration tactics.
    answer_sources:
      - Zeek conn.log
      - Internet Gateway/Egress Points
    range: last 90 days
    queries:
      - pseudocode: EXTRACT features (duration, outbound_bytes, inbound_bytes) from conn.log | INPUT to DBSCAN clustering model | INVESTIGATE clusters with high avg_outbound_bytes and low avg_inbound_bytes | ALERT
  - question: Is a suspicious process (e.g., PowerShell, certutil) or a process in a temp directory making a large outbound connection?
    context: This question correlates endpoint process activity with network activity to identify the source of potential exfiltration. By linking process creation events (from Sysmon or Windows Event Logs) to network connection logs (from Zeek), we can alert when a process from a watchlist or a non-standard path initiates a connection that transfers a large amount of data.
    answer_sources:
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - Sysmon Event ID 3
      - Zeek conn.log
      - User Workstations
      - Servers
      - Domain Controllers
    range: last 90 days
    queries:
      - pseudocode: CORRELATE process_events (Sysmon) with network_logs (Zeek) by host and time | WHERE process_name IN watchlist OR process_path IN ('C:\\Windows\\Temp\\*') AND associated_outbound_bytes > 5MB | ALERT
  - question: Has a statistically rare parent-child process relationship resulted in a large outbound data transfer?
    context: This question hunts for unusual process behavior that could indicate code injection or living-off-the-land techniques. A rare relationship, like Microsoft Word (winword.exe) spawning PowerShell, is highly suspicious. This query identifies such rare process pairs and alerts when they are also associated with a high-volume outbound network connection.
    answer_sources:
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - Sysmon Event ID 3
      - Zeek conn.log
      - User Workstations
      - Servers
      - Domain Controllers
    range: last 90 days
    queries:
      - pseudocode: BUILD frequency table of parent-child process pairs | IDENTIFY rare pairs | CORRELATE rare pairs with network connections (Sysmon EID 3) | WHERE associated_outbound_bytes is in top 5th percentile | ALERT
  - question: Are suspicious command-line executions correlated with high-ratio outbound network connections?
    context: This question uses machine learning to analyze the command-line arguments of a process. A model can be trained to recognize suspicious commands based on features like length, entropy, and certain keywords. When a process execution is flagged as suspicious by the model and is also linked to a network connection with a high outbound-to-inbound data ratio, it creates a very high-fidelity alert.
    answer_sources:
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - Sysmon Event ID 3
      - Zeek conn.log
      - User Workstations
      - Servers
      - Domain Controllers
    range: last 90 days
    queries:
      - pseudocode: EXTRACT features from command-line (Sysmon EID 1) | INPUT to suspicious command classification model | WHERE prediction is 'suspicious' | CORRELATE with network logs (Zeek) | WHERE outbound/inbound byte ratio is high | ALERT