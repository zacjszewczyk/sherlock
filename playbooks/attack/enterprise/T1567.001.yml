name: 'T1567.001: Exfiltration to Code Repository'
id: 'f9e7b3a0-1c6d-4b8a-9e0f-1a2b3c4d5e6f'
description: "This playbook helps investigate potential data exfiltration to code repository services like GitHub or GitLab. It focuses on identifying suspicious network connections to code repository domains, unusual process sequences involving data compression and 'git push' commands, high volumes of outbound data transfer, connections from unauthorized users or hosts, and connections initiated by non-standard development processes such as LOLBins."
type: 'technique'
related:
  - 'TA0010: Exfiltration'
contributors:
  - 'Zachary Szewczyk'
  - 'Ask Sage'
created: '2025-10-01'
modified: '2025-10-01'
version: '1.0'
tags: 'none'
questions:
  - question: "Have any network connections been made to code repository domains or IPs flagged by threat intelligence?"
    context: "This question aims to detect direct connections to known malicious or suspicious code repository infrastructure. Adversaries may use compromised or purpose-built repositories for data exfiltration. Matching network logs against a threat intelligence feed provides a high-fidelity signal for this specific TTP."
    answer_sources:
      - 'Zeek conn.log'
      - 'Zeek ssl.log'
      - 'Zeek dns.log'
      - 'Internet Gateway'
      - 'DNS Resolvers'
      - 'Egress Proxies'
    range: 'last 90 days'
    queries:
      - 'SEARCH network_logs (dns, ssl, conn) WHERE destination_ip OR destination_domain IN threat_intel_feed_of_code_repos;'
  - question: "Are any hosts connecting to statistically rare or uncommon code repository domains compared to the rest of the enterprise?"
    context: "This question helps identify outlier activity. If only a few hosts are connecting to a specific code repository, it could indicate unauthorized or malicious activity, as legitimate development work often involves common, widely-used repositories. This is a statistical approach to find needles in the haystack without relying solely on known-bad indicators."
    answer_sources:
      - 'Zeek ssl.log'
      - 'Internet Gateway'
      - 'DNS Resolvers'
      - 'Egress Proxies'
    range: 'last 90 days'
    queries:
      - 'SEARCH ssl_logs | GROUPBY server_name | CALCULATE host_count_per_domain | FILTER domain is_code_repo AND host_count < 1st_percentile_of_all_repo_counts;'
  - question: "Have any new code repository domains been observed that have characteristics of malicious domains?"
    context: "This question proactively identifies potentially malicious, newly created code repository domains that may not yet be on threat intelligence feeds. By analyzing features like domain name entropy, age, and DNS history, a machine learning model can score the likelihood of a domain being malicious, enabling detection of emergent threats."
    answer_sources:
      - 'Zeek ssl.log'
      - 'WHOIS data'
      - 'Passive DNS'
      - 'Internet Gateway'
      - 'DNS Resolvers'
      - 'Egress Proxies'
    range: 'last 90 days'
    queries:
      - 'FOR each new_domain in ssl_logs | IF is_code_repo(new_domain) | SCORE domain_features (entropy, age, etc.) with ML_model | ALERT if score > threshold;'
  - question: "Has any host executed a data archiving command followed by a 'git push' command within a short time frame?"
    context: "This question looks for the common adversary pattern of staging and exfiltrating data. An adversary will often compress sensitive data into a single archive file before pushing it to a remote repository. Detecting this specific sequence of events on a host is a strong indicator of potential data exfiltration."
    answer_sources:
      - 'Windows Event ID 4688'
      - 'Developer Workstations'
      - 'Build Servers'
      - 'CI/CD Pipeline Servers'
    range: 'last 90 days'
    queries:
      - "SEARCH process_events (EID 4688) | SEQUENCE by host, user [process is archive_tool] followed by [process is 'git.exe' and command_line contains 'push'] within 5 minutes;"
  - question: "Has an unusual or rare sequence of data archiving followed by a 'git push' occurred on any host, based on its historical behavior?"
    context: "This question identifies anomalous process sequences on a per-host basis. While a developer might occasionally archive and push code, a sequence that is highly unusual for a specific host or user could signal malicious activity. This statistical approach helps differentiate between normal developer workflow and potential data theft."
    answer_sources:
      - 'Windows Event ID 4688'
      - 'Developer Workstations'
      - 'Build Servers'
      - 'CI/CD Pipeline Servers'
    range: 'last 90 days'
    queries:
      - 'FOR each host | BASELINE frequency of (archive_tool -> git_push) sequence | SEARCH process_events | ALERT if observed sequence frequency is in bottom 5th percentile of baseline;'
  - question: "Has a machine learning model detected an anomalous sequence of process executions involving data archiving and a 'git push'?"
    context: "This question leverages advanced sequence analysis to detect sophisticated attacks. A model trained on normal process activity can identify subtle deviations that might indicate a malicious actor attempting to hide their actions. An alert on a low-probability sequence involving archiving and git pushing provides a data-driven signal of a potential threat."
    answer_sources:
      - 'Windows Event ID 4688'
      - 'Developer Workstations'
      - 'Build Servers'
      - 'CI/CD Pipeline Servers'
    range: 'last 90 days'
    queries:
      - 'FOR each new_process_sequence on host | SCORE sequence with RNN/HMM model | IF sequence contains (archive -> git_push) and score is low_probability | ALERT;'
  - question: "Has there been any large, single network session to a code repository where the amount of data sent was significantly greater than the data received?"
    context: "This question targets bulk data exfiltration. A normal 'git push' might involve sending a moderate amount of data, but a session where hundreds of megabytes are sent with very little data received in return is highly suspicious. This rule looks for this asymmetric data flow, which is a classic indicator of data being uploaded or exfiltrated."
    answer_sources:
      - 'Zeek conn.log'
      - 'Internet Gateway'
      - 'Core Network Taps'
    range: 'last 90 days'
    queries:
      - 'SEARCH conn_logs WHERE destination is_code_repo AND sent_bytes > 100MB AND (sent_bytes / received_bytes) > 10;'
  - question: "Has any host sent an anomalously large volume of data to code repositories today compared to its own 30-day baseline?"
    context: "This question helps detect unusual spikes in data exfiltration on a per-host basis. By establishing what is 'normal' for each host's daily upload volume to code repositories, we can automatically flag days where the activity is statistically significant. This helps catch exfiltration that might be spread across multiple connections but is anomalous in total volume."
    answer_sources:
      - 'Zeek conn.log'
      - 'Internet Gateway'
      - 'Core Network Taps'
    range: 'last 90 days'
    queries:
      - 'FOR each host | CALCULATE 30-day_baseline (mean, stddev) of daily_upload_volume_to_repos | IF today_volume > (mean + 3*stddev) | ALERT;'
  - question: "Has a time series model forecasted that today's outbound data volume to code repositories is significantly higher than expected for a given host?"
    context: "This question uses predictive analytics to identify abnormal data transfers. Unlike a simple standard deviation, a time series model can account for trends, seasonality, and other complex patterns in a host's behavior. An alert from this model indicates that the current data volume is not just high, but unexpectedly high given its recent historical context."
    answer_sources:
      - 'Zeek conn.log'
      - 'Internet Gateway'
      - 'Core Network Taps'
    range: 'last 90 days'
    queries:
      - 'FOR each host | FORECAST expected_upload_volume_range with ARIMA_model | IF actual_volume > upper_bound_of_forecast | ALERT;'
  - question: "Has a user or host not explicitly authorized for development activity connected to an external code repository?"
    context: "This question enforces policy-based access control as a detection mechanism. By defining which users and groups (e.g., 'Developers') are allowed to access code repositories, any connection from an unauthorized entity (e.g., a user from the 'Marketing' department) is an immediate policy violation and a strong indicator of a compromised account or insider threat."
    answer_sources:
      - 'Zeek conn.log'
      - 'Windows Event ID 4624'
      - 'Windows Event ID 4688'
      - 'Domain Controllers'
      - 'Endpoint Devices (All Departments)'
      - 'Identity and Access Management (IAM) Systems'
    range: 'last 90 days'
    queries:
      - 'SEARCH network_connections to code_repos | CORRELATE with user_logon_data and AD_group_membership | ALERT if user_group NOT IN developer_allow_list;'
  - question: "Has any user's web browsing behavior shown an anomalous increase in variety, specifically involving a new connection to a code repository?"
    context: "This question seeks to identify behavioral changes in a user's network activity. A user typically visits a relatively stable set of domains. A sudden increase in the variety (entropy) of domains visited, especially when the new domain is a code repository, can indicate that the user's account has been compromised and is being used for activities outside its normal profile."
    answer_sources:
      - 'Zeek ssl.log'
      - 'Domain Controllers'
      - 'Endpoint Devices (All Departments)'
      - 'Identity and Access Management (IAM) Systems'
    range: 'last 90 days'
    queries:
      - 'FOR each user | CALCULATE 30-day_baseline (mean, stddev) of daily_domain_entropy | IF today_entropy > (mean + 2*stddev) AND new_domain is_code_repo | ALERT;'
  - question: "Are any users whose overall network behavior profiles them as 'non-technical' making connections to code repositories?"
    context: "This question uses unsupervised machine learning to find users acting outside their peer group. By clustering users based on their typical network activity, we can establish behavioral profiles (e.g., 'Sales', 'Engineering'). A user who belongs to a non-technical cluster but suddenly connects to a code repository is a cross-cluster anomaly, suggesting a potential account takeover or policy violation."
    answer_sources:
      - 'Zeek conn.log'
      - 'Zeek ssl.log'
      - 'Domain Controllers'
      - 'Endpoint Devices (All Departments)'
      - 'Identity and Access Management (IAM) Systems'
    range: 'last 90 days'
    queries:
      - 'CLUSTER users based on network_activity_features | FOR each user in non_technical_cluster | IF user connects_to_code_repo | ALERT as cross-cluster_anomaly;'
  - question: "Has a known Living-Off-the-Land Binary (LOLBin) initiated a network connection to a code repository?"
    context: "This question focuses on detecting the abuse of legitimate system tools for malicious purposes. Adversaries use LOLBins like 'powershell.exe' or 'cscript.exe' to evade defenses. A connection to a code repository from one of these processes, instead of a standard developer tool like 'git.exe', is highly indicative of malicious activity and an attempt to exfiltrate data covertly."
    answer_sources:
      - 'Windows Event ID 5156'
      - 'Windows Event ID 4688'
      - 'All Endpoint Devices and Servers'
    range: 'last 90 days'
    queries:
      - 'SEARCH network_connection_events (EID 5156) WHERE process_name IN LOLBin_list AND destination_ip is_code_repo;'
  - question: "Has any process that is not an approved developer tool made a new, never-before-seen connection to a code repository from a specific host?"
    context: "This question establishes a baseline of normal process-to-destination network behavior on a per-host basis. It helps detect when a process communicates with a code repository for the first time. This is especially powerful for identifying when a legitimate but non-developer tool (e.g., 'winword.exe') is compromised and used to exfiltrate data, as this behavior would be a clear deviation from its established baseline."
    answer_sources:
      - 'Windows Event ID 5156'
      - 'Windows Event ID 4688'
      - 'All Endpoint Devices and Servers'
    range: 'last 90 days'
    queries:
      - 'FOR each host | BASELINE known (process, destination_ip) pairs | SEARCH new_connection_events | IF (process, destination_ip) is new AND destination_ip is_code_repo AND process NOT IN dev_tool_allow_list | ALERT;'
  - question: "Has a machine learning model detected an anomalous network connection to a code repository based on the initiating process and connection details?"
    context: "This question uses anomaly detection to identify unusual network connections originating from a host. A One-Class SVM model learns the 'normal' boundary of network activity for a host. Any connection that falls outside this boundary, particularly one destined for a code repository, is flagged as an anomaly. This can catch novel or sophisticated attempts to use unexpected processes for data exfiltration."
    answer_sources:
      - 'Windows Event ID 5156'
      - 'Windows Event ID 4688'
      - 'All Endpoint Devices and Servers'
    range: 'last 90 days'
    queries:
      - 'FOR each host | TRAIN one-class_SVM_model on normal_connection_features | FOR each new_connection | IF model_classifies as anomaly AND destination is_code_repo | ALERT;'