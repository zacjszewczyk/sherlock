name: T1628.002: User Evasion
id: b7e5a8f0-1c9d-4b8e-9c0a-3d1f4e7a6b2c
description: This playbook helps identify if an adversary is attempting to evade user detection on corporate-managed mobile devices. Adversaries may employ malware that monitors the device's physical state using motion or proximity sensors. The malware alters its network behavior, such as C2 communication or data exfiltration, based on this sensor input. It typically performs malicious actions only when the device is at rest, in a pocket, or face down, assuming the user is not actively observing the screen. This playbook provides questions and queries to detect these evasive patterns by correlating sensor data from Mobile Threat Defense (MTD) with network logs.
type: technique
related:
  - TA0030: Defense Evasion
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Is an application ceasing C2-like beaconing immediately after device motion is detected?
    context: This question attempts to identify malware that halts its command-and-control (C2) communications when it detects the user has picked up or is using the device. The pattern involves observing periodic, low-volume network traffic (indicative of C2 beaconing) while the device is idle, followed by an abrupt stop in that traffic immediately after motion sensors (accelerometer, gyroscope) are activated. This behavior is a strong indicator of an adversary actively trying to hide their presence from the user.
    answer_sources:
      - Mobile Threat Defense (MTD) sensor access logs
      - Mobile Device Management (MDM) application inventory logs
      - Zeek conn.log
      - Zeek dns.log
      - Endpoints: Corporate-managed mobile devices with MTD/MDM agents.
      - Network: Network taps at corporate Wi--Fi access points, VPN egress points, and internet gateways where Zeek sensors are deployed.
      - Infrastructure: MDM servers and DNS servers.
      - Analytics Platform: SIEM or data lake where MTD, MDM, and Zeek logs are aggregated for correlation.
    range: last 90 days
    queries:
      - search_technology: Pseudocode
        query: |
          // Stateful SIEM correlation rule
          TRIGGER on MTD event where sensor in ('accelerometer', 'gyroscope') AND app not in motion-access allowlist
          SEARCH Zeek conn.log for device IP in 10 minutes prior to trigger
          IF prior traffic shows periodic, low-volume connections
          AND SEARCH Zeek conn.log for device IP in 5 minutes after trigger shows traffic has ceased
          THEN GENERATE ALERT 'Potential User Evasion via Motion Sensing'
  - question: Is there a strong negative correlation between device motion and an application's network activity?
    context: This question seeks to find a statistical link where an application consistently stops or reduces its network activity whenever the device is in motion. A strong negative Pearson correlation coefficient (e.g., $$ r < -0.8 $$) between a time series representing device motion and a time series representing the app's network connections is a powerful mathematical indicator that the app is deliberately hiding its network communications from an active user.
    answer_sources:
      - Mobile Threat Defense (MTD) sensor access logs
      - Mobile Device Management (MDM) application inventory logs
      - Zeek conn.log
      - Zeek dns.log
      - Endpoints: Corporate-managed mobile devices with MTD/MDM agents.
      - Network: Network taps at corporate Wi--Fi access points, VPN egress points, and internet gateways where Zeek sensors are deployed.
      - Infrastructure: MDM servers and DNS servers.
      - Analytics Platform: SIEM or data lake where MTD, MDM, and Zeek logs are aggregated for correlation.
    range: last 90 days
    queries:
      - search_technology: Pseudocode
        query: |
          // Continuous statistical analysis
          FOR EACH application not in motion-access allowlist
            CREATE time_series_motion from MTD logs (1 for motion, 0 for rest) over 24 hours
            CREATE time_series_network from Zeek conn.log (connection count per minute) over 24 hours
            CALCULATE Pearson correlation 'r' between time_series_motion and time_series_network
            IF r < -0.8
            THEN GENERATE ALERT 'Strong Negative Correlation Between Motion and Network Activity'
  - question: Can an application's network traffic patterns be used to accurately predict the device's motion state?
    context: An application's network behavior should not normally be a good predictor of the device's physical motion. If a machine learning model can achieve high accuracy (e.g., >85%) in predicting whether a device is 'at rest' or 'in motion' using only network traffic features as input, it strongly implies the application is programmatically altering its network behavior in response to motion. This is a highly anomalous characteristic and a sophisticated method for detecting user evasion logic.
    answer_sources:
      - Mobile Threat Defense (MTD) sensor access logs
      - Mobile Device Management (MDM) application inventory logs
      - Zeek conn.log
      - Zeek dns.log
      - Endpoints: Corporate-managed mobile devices with MTD/MDM agents.
      - Network: Network taps at corporate Wi-Fi access points, VPN egress points, and internet gateways where Zeek sensors are deployed.
      - Infrastructure: MDM servers and DNS servers.
      - Analytics Platform: SIEM or data lake where MTD, MDM, and Zeek logs are aggregated for correlation.
    range: last 90 days
    queries:
      - search_technology: Pseudocode
        query: |
          // Machine Learning anomaly detection
          FOR EACH application not in motion-access allowlist
            EXTRACT network features from Zeek logs (e.g., connection_rate, byte_rate, protocol_mix)
            EXTRACT motion state labels from MTD logs ('at rest', 'in motion')
            TRAIN a classifier (e.g., Random Forest) to predict motion state from network features
            IF model accuracy > 85%
            THEN GENERATE ALERT 'Anomalous Predictive Relationship Between Network and Motion'
  - question: Is an unapproved application increasing its network traffic significantly only when the proximity sensor is covered, and stopping when it's uncovered?
    context: The proximity sensor being 'covered' typically indicates the phone is in a pocket, face down, or against the user's ear. An adversary can use this as a trigger to perform malicious network activity, assuming the user is not looking at the screen. This question looks for a specific sequence: an application not on the allowlist accesses the proximity sensor, data exfiltration or C2 traffic surges while the sensor is covered, and the traffic abruptly stops when the sensor becomes 'uncovered'.
    answer_sources:
      - Mobile Threat Defense (MTD) sensor access logs
      - Mobile Device Management (MDM) application inventory logs
      - Zeek conn.log
      - Zeek dns.log
      - Endpoints: Corporate-managed mobile devices with MTD/MDM agents.
      - Network: Network taps at corporate Wi-Fi access points, VPN egress points, and internet gateways where Zeek sensors are deployed.
      - Infrastructure: MDM servers and DNS servers.
      - Analytics Platform: SIEM or data lake where MTD, MDM, and Zeek logs are aggregated for correlation.
    range: last 90 days
    queries:
      - search_technology: Pseudocode
        query: |
          // Stateful SIEM correlation rule
          TRIGGER on MTD event where sensor is 'proximity', state is 'covered', AND app not in proximity-access allowlist
          IF during 'covered' state, outbound_data_volume > (5 * 30_day_baseline_for_app)
          AND IF anomalous traffic ceases within 10 seconds of MTD state changing to 'uncovered'
          THEN GENERATE ALERT 'Potential User Evasion via Proximity Sensing'
  - question: Does an application exhibit a statistically significant increase in network data transfer rate when the proximity sensor is covered compared to when it is uncovered?
    context: This question uses statistical analysis to find anomalous network behavior. It establishes a 'normal' baseline for an application's network data rate when the user is likely observing the screen (proximity sensor 'uncovered'). It then checks for significant deviations from this baseline when the screen is likely obscured ('covered'). A persistently high Z-score (e.g., $$ Z > 3 $$) indicates that the application's network activity is abnormally high specifically during times when the user is not watching.
    answer_sources:
      - Mobile Threat Defense (MTD) sensor access logs
      - Mobile Device Management (MDM) application inventory logs
      - Zeek conn.log
      - Zeek dns.log
      - Endpoints: Corporate-managed mobile devices with MTD/MDM agents.
      - Network: Network taps at corporate Wi-Fi access points, VPN egress points, and internet gateways where Zeek sensors are deployed.
      - Infrastructure: MDM servers and DNS servers.
      - Analytics Platform: SIEM or data lake where MTD, MDM, and Zeek logs are aggregated for correlation.
    range: last 90 days
    queries:
      - search_technology: Pseudocode
        query: |
          // Continuous statistical analysis
          FOR EACH application
            CALCULATE baseline (mean, stddev) of data rate from Zeek when proximity sensor is 'uncovered'
            MONITOR data rate in 5-minute intervals when sensor is 'covered'
            CALCULATE Z-score of 'covered' rate against 'uncovered' baseline
            IF Z > 3 for more than two consecutive intervals
            THEN GENERATE ALERT 'Statistical Anomaly in Network Use During Proximity Obscurement'
  - question: Can an application's network traffic be used to predict that the proximity sensor is covered, even when sensor logs show it is not?
    context: This advanced detection method trains a machine learning model to associate certain network patterns (like high data transfer) with the 'covered' state of the proximity sensor. The key insight occurs when the model, based on a surge in network traffic, predicts the sensor is 'covered' with high confidence, but the actual MTD sensor log reports the state is 'uncovered'. This logical contradiction indicates the application is initiating its "hidden" network behavior at an unexpected time, suggesting a malfunction or a more complex evasion attempt.
    answer_sources:
      - Mobile Threat Defense (MTD) sensor access logs
      - Mobile Device Management (MDM) application inventory logs
      - Zeek conn.log
      - Zeek dns.log
      - Endpoints: Corporate-managed mobile devices with MTD/MDM agents.
      - Network: Network taps at corporate Wi-Fi access points, VPN egress points, and internet gateways where Zeek sensors are deployed.
      - Infrastructure: MDM servers and DNS servers.
      - Analytics Platform: SIEM or data lake where MTD, MDM, and Zeek logs are aggregated for correlation.
    range: last 90 days
    queries:
      - search_technology: Pseudocode
        query: |
          // Machine Learning contradiction detection
          TRAIN a logistic regression model to predict 'covered'/'uncovered' state from network features
          DEPLOY model for real-time analysis
          IF model predicts 'covered' with probability > 0.9 based on network traffic
          AND actual MTD log reports sensor state is 'uncovered'
          THEN GENERATE ALERT 'Logical Contradiction Detected in Proximity Evasion Behavior'