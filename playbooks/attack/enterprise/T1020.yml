name: "T1020: Automated Exfiltration"
id: "a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d"
description: "This playbook helps determine if an adversary has exfiltrated sensitive data using automated methods. It focuses on identifying several key indicators: outbound network connections to known malicious C2 or exfiltration destinations; DNS tunneling or high-entropy data in HTTP requests; the use of archiving tools immediately followed by large data transfers; unusual processes staging data by accessing a high number of files; and coordinated file access and exfiltration across multiple hosts to a common external destination."
type: "technique"
related:
  - "TA0010: Exfiltration"
contributors:
  - "Zachary Szewczyk"
  - "Ask Sage"
created: "2025-10-01"
modified: "2025-10-01"
version: 1.0
tags: "none"
questions:
  - question: "Have any internal hosts connected to external IP addresses or domains known to be associated with C2, exfiltration, or malware?"
    context: "This question aims to detect direct communication with known malicious infrastructure. By joining network connection and DNS logs with threat intelligence feeds, we can identify hosts that are potentially compromised or actively exfiltrating data to adversary-controlled systems."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Internet Egress Points"
      - "Internal DNS Resolvers"
      - "Web Proxies"
      - "Threat Intelligence Feed"
    range: "Last 90 days"
    queries:
      - "SEARCH network_logs JOIN dns_logs JOIN threat_intel WHERE indicator_category IN ('C2', 'Exfiltration', 'Malware')"
  - question: "Are there any unusually large outbound data transfers to low-reputation or suspicious domains?"
    context: "This question seeks to identify potential data exfiltration to destinations that are not yet on a threat intelligence list but exhibit suspicious characteristics (e.g., newly registered). By baselining normal traffic volumes to these categories, we can flag anomalous transfers that might represent exfiltration."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Internet Egress Points"
      - "Internal DNS Resolvers"
      - "Web Proxies"
    range: "Last 90 days"
    queries:
      - "SEARCH network_logs WHERE destination_category IN ('Low Reputation', 'Dynamic DNS', 'Newly Registered') | CALCULATE total_bytes_out | ALERT IF total_bytes_out > 95th_percentile_for_category"
  - question: "Can we predictively identify network connections that are likely associated with data exfiltration based on their characteristics?"
    context: "This question uses a supervised machine learning model to proactively classify outbound network connections. By training a model on features like destination reputation, port, protocol, and data volume, it can learn the patterns of malicious exfiltration and identify new, previously unseen activity with high confidence."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Internet Egress Points"
      - "Internal DNS Resolvers"
      - "Web Proxies"
    range: "Last 90 days"
    queries:
      - "CLASSIFY network_connections USING trained_exfil_model | FEATURES: dest_ip_rep, dest_port, protocol, duration, bytes_sent, bytes_received, state | ALERT IF classification == 'potential exfiltration' AND confidence > high_threshold"
  - question: "Are there any DNS queries or HTTP requests that match the signatures of known data exfiltration or tunneling tools?"
    context: "This question looks for specific, known-bad patterns associated with tools like Iodine, DNSCat2, or Cobalt Strike. Matching these signatures in DNS or HTTP traffic provides a strong indication that an adversary is using a specific tool to exfiltrate data."
    answer_sources:
      - "Zeek dns.log"
      - "Zeek http.log"
      - "Internal DNS Resolvers"
      - "Web Proxies"
      - "Application Servers"
    range: "Last 90 days"
    queries:
      - "SEARCH dns_logs, http_logs FOR regex_patterns IN (known_exfil_tool_signatures)"
  - question: "Are there any DNS queries with unusually high entropy or HTTP POST requests with high-entropy content?"
    context: "This question identifies attempts to conceal exfiltrated data within DNS queries (DNS tunneling) or HTTP requests. High entropy (randomness) often indicates that data has been encoded or encrypted. By baselining normal entropy levels, we can detect outliers that suggest hidden data channels."
    answer_sources:
      - "Zeek dns.log"
      - "Zeek http.log"
      - "Internal DNS Resolvers"
      - "Web Proxies"
      - "Application Servers"
    range: "Last 90 days"
    queries:
      - "SEARCH dns_logs | CALCULATE entropy(query_name) | ALERT IF entropy > 4.5; SEARCH http_post_logs | CALCULATE entropy(request_body) | ALERT IF entropy > 99th_percentile"
  - question: "Can we identify clusters of anomalous DNS queries that may indicate DNS tunneling activity?"
    context: "This question uses unsupervised machine learning to find groups of DNS queries that behave differently from the norm. By clustering queries based on features like length, entropy, and character distribution, we can isolate suspicious clusters that might represent a DNS tunneling C2 channel without relying on pre-existing signatures."
    answer_sources:
      - "Zeek dns.log"
      - "Internal DNS Resolvers"
      - "Web Proxies"
      - "Application Servers"
    range: "Last 90 days"
    queries:
      - "CLUSTER dns_queries USING DBSCAN | FEATURES: query_length, query_entropy, char_frequency, query_type | INVESTIGATE outlier_clusters"
  - question: "Has a known archiving tool been used to compress sensitive directories, followed immediately by a large data transfer from the same host?"
    context: "This question correlates two distinct events to detect a classic 'smash and grab' exfiltration pattern. The adversary stages data by compressing it and then sends the archive out. Correlating the process creation with the subsequent large network transfer provides high-fidelity evidence of this specific tactic."
    answer_sources:
      - "Windows Event ID 4688"
      - "Zeek conn.log"
      - "User Workstations"
      - "File Servers"
      - "Domain Controllers"
      - "Application Servers"
    range: "Last 90 days"
    queries:
      - "CORRELATE process_events (process IN [7z.exe, rar.exe] AND command_line CONTAINS sensitive_dirs) WITH network_logs (orig_bytes > 50MB) FROM same_host WITHIN 15 minutes"
  - question: "Did a host's outbound traffic volume significantly deviate from its normal baseline shortly after an archiving tool was run?"
    context: "This question looks for anomalous outbound traffic spikes that are temporally linked to data staging activities. By establishing a normal traffic baseline for each host, a significant deviation (e.g., 3 standard deviations) following the use of an archiver strongly suggests the exfiltration of the newly created archive."
    answer_sources:
      - "Windows Event ID 4688"
      - "Zeek conn.log"
      - "User Workstations"
      - "File Servers"
      - "Domain Controllers"
      - "Application Servers"
    range: "Last 90 days"
    queries:
      - "SEARCH process_events FOR archiver_process | MONITOR subsequent_network_traffic FROM same_host | ALERT IF outbound_volume > (daily_avg_baseline + 3 * std_dev) in next hour"
  - question: "Can a time-series model detect network traffic anomalies that are conditioned by preceding data archiving events?"
    context: "This question uses a sophisticated anomaly detection model (LSTM autoencoder) that understands a host's normal network traffic patterns over time. By feeding archival process events into the model, it can specifically look for traffic anomalies that occur right after staging, providing a more intelligent and context-aware detection method than simple statistical thresholds."
    answer_sources:
      - "Windows Event ID 4688"
      - "Zeek conn.log"
      - "User Workstations"
      - "File Servers"
      - "Domain Controllers"
      - "Application Servers"
    range: "Last 90 days"
    queries:
      - "DETECT anomaly IN network_traffic_timeseries USING LSTM_autoencoder | INPUT archiver_process_events as exogenous_variable | ALERT on high reconstruction_error post-event"
  - question: "Has a scripting host like PowerShell or CScript been observed accessing an unusually large number of sensitive file types in a short period?"
    context: "This question targets a common data staging technique where adversaries use built-in scripting engines to rapidly collect sensitive files. Alerting on a single script process accessing over 100 documents, spreadsheets, or database files within a minute is a strong indicator of malicious collection activity."
    answer_sources:
      - "Windows Event ID 4663"
      - "Windows Event ID 4688"
      - "Sensitive Data Repositories"
      - "User Workstations"
      - "Source Code Repositories"
      - "File Servers"
    range: "Last 90 days"
    queries:
      - "SEARCH process_events (process IN [powershell.exe, cscript.exe]) | CORRELATE WITH file_access_events (file_extension IN ['.docx', '.pdf']) FROM same_process_id | ALERT IF file_count > 100 within 1 minute"
  - question: "Has any process accessed a number of files or a variety of file types that is statistically anomalous compared to its own historical behavior?"
    context: "This question establishes a behavioral baseline for every process on a host. It detects when a process, even a legitimate one, is used in an abnormal way, such as a web server process suddenly reading thousands of user documents. Alerting on deviations from the norm for both file count and file type variety helps catch compromised processes being used for data staging."
    answer_sources:
      - "Windows Event ID 4663"
      - "Windows Event ID 4688"
      - "Sensitive Data Repositories"
      - "User Workstations"
      - "Source Code Repositories"
      - "File Servers"
    range: "Last 90 days"
    queries:
      - "BASELINE file_access_count AND file_extension_entropy per process | SEARCH file_access_events | ALERT IF access_count > 99th_percentile OR extension_entropy > 99th_percentile for that process"
  - question: "Can we identify anomalous process behaviors indicative of data staging using an unsupervised model?"
    context: "This question uses an Isolation Forest model to create a holistic profile of normal process behavior, including parent process, command line arguments, and file access patterns. This allows it to flag complex anomalies that might not trigger simple statistical thresholds, such as a legitimate process spawned with unusual arguments that begins accessing files in a strange pattern."
    answer_sources:
      - "Windows Event ID 4663"
      - "Windows Event ID 4688"
      - "Sensitive Data Repositories"
      - "User Workstations"
      - "Source Code Repositories"
      - "File Servers"
    range: "Last 90 days"
    queries:
      - "DETECT outliers IN process_behavior USING IsolationForest | FEATURES: parent_process, cmd_line_args, file_access_count, accessed_dirs | INVESTIGATE outliers for staging"
  - question: "Has a known malicious script been executed across multiple hosts, followed by those hosts communicating with a common external destination?"
    context: "This question looks for evidence of a widespread, automated exfiltration campaign using a specific tool or script. Identifying the same malicious file hash executing on many machines, which then all 'phone home' to the same IP address, is a clear sign of a coordinated attack."
    answer_sources:
      - "Windows Event ID 4663"
      - "Windows Event ID 4688"
      - "Zeek conn.log"
      - "Entire Workstation Subnet"
      - "Server Farm"
      - "Internet Egress Points"
      - "Domain Controllers"
    range: "Last 90 days"
    queries:
      - "SEARCH process_events FOR script_hash on > 5 hosts within 10 mins | IF found, QUERY network_logs for common_external_destination FROM those hosts"
  - question: "Have an anomalous number of hosts within the same group begun accessing sensitive shares concurrently, followed by a traffic spike from that group to a single external IP?"
    context: "This question detects coordinated internal data access, which may precede exfiltration. By baselining concurrent activity for a group of hosts (e.g., a subnet), a sudden spike in hosts accessing a file share, correlated with a new, shared external destination for their traffic, can uncover a distributed exfiltration effort."
    answer_sources:
      - "Windows Event ID 4663"
      - "Windows Event ID 4688"
      - "Zeek conn.log"
      - "Entire Workstation Subnet"
      - "Server Farm"
      - "Internet Egress Points"
      - "Domain Controllers"
    range: "Last 90 days"
    queries:
      - "MONITOR concurrent_hosts_accessing_shares per group | ALERT IF count > (hourly_baseline + 3 * std_dev) | CORRELATE with concurrent_traffic_spike FROM same_group to single_external_IP"
  - question: "Does graph analysis reveal a sudden convergence of multiple internal hosts connecting to a single, new external destination?"
    context: "This question models the network as a graph to identify coordinated exfiltration. A sudden change in the graph structure, where many previously unrelated internal hosts all form connections to a single new external destination in a short time, creates a 'star' or 'hub-and-spoke' pattern that is highly indicative of a synchronized exfiltration event."
    answer_sources:
      - "Windows Event ID 4663"
      - "Windows Event ID 4688"
      - "Zeek conn.log"
      - "Entire Workstation Subnet"
      - "Server Farm"
      - "Internet Egress Points"
      - "Domain Controllers"
    range: "Last 90 days"
    queries:
      - "MODEL network as graph(nodes=[internal_IPs, external_IPs], edges=[connections]) | DETECT anomaly where many internal_nodes create new edges to single external_node in short time_window"