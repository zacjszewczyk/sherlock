name: T1565.001: Stored Data Manipulation
id: f8a5a3a1-7c4d-4e9b-8a21-3f6e9c0b1a23
description: This playbook focuses on detecting an adversary's manipulation of stored data to impact business operations or conceal their activities. This can involve using known data wiper tools, misusing legitimate system utilities for data destruction, modifying critical system or configuration files, causing an abnormally high rate of file modifications/deletions, or performing mass file renaming operations characteristic of ransomware. The goal is to identify these activities across various data sources to mitigate their impact on business operations and data integrity.
type: technique
related: TA0040: Impact
contributors: Zachary Szewczyk, Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Is a process executing that matches the name or hash of a known data wiper or manipulation tool?
    context: This question seeks to identify the execution of known malicious tools designed for data destruction. By continuously monitoring for new processes and comparing their identifiers (name and hash) against a threat intelligence list (e.g., WhisperGate, NotPetya, IsaacWiper), analysts can detect high-confidence threats early and initiate a rapid response.
    answer_sources: Windows Event ID 4688, Windows Event ID 4663, Zeek files.log, Domain Controllers, Database Servers, Critical Application Servers, Enterprise File Shares, Internet Gateways
    range: Last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH Windows Event ID 4688 WHERE ProcessName IN (threat_intel_list) OR ProcessHash IN (threat_intel_list)
  - question: Is any process exhibiting an unusually high rate of file write or delete operations compared to its historical baseline?
    context: This question aims to detect data manipulation activity by identifying processes with anomalous file system behavior. Even if the tool is unknown, a sudden, statistically significant spike in file writes or deletes (e.g., exceeding the mean by four standard deviations) can indicate destructive intent and warrants investigation.
    answer_sources: Windows Event ID 4688, Windows Event ID 4663, Zeek files.log, Domain Controllers, Database Servers, Critical Application Servers, Enterprise File Shares, Internet Gateways
    range: Last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH Windows Event ID 4663 | CALCULATE rate of events per minute by host, process | COMPARE rate against historical baseline (mean + 4 * stddev)
  - question: Does a machine learning model classify any running process as a malicious wiper based on its combined characteristics?
    context: This question leverages a machine learning model to provide a sophisticated, holistic assessment of a process's legitimacy. By analyzing features like parent process, user context, command line arguments, and I/O rates, the model can identify complex patterns indicative of a malicious wiper, potentially catching novel threats that evade simpler detection methods.
    answer_sources: Windows Event ID 4688, Windows Event ID 4663, Zeek files.log, Domain Controllers, Database Servers, Critical Application Servers, Enterprise File Shares, Internet Gateways
    range: Last 90 days
    queries:
      - technology: pseudocode
        query: INPUT process metadata (parent, user, cmdline), I/O stats, network activity INTO classification model | TRIGGER on 'malicious wiper' classification
  - question: Has a legitimate system utility been executed with command-line arguments associated with data destruction?
    context: This question focuses on detecting the misuse of legitimate tools ('living off the land') for malicious purposes. Adversaries use utilities like 'cipher.exe' or 'sdelete.exe' to overwrite data. Searching for specific command-line patterns (e.g., 'cipher.exe /w:') provides a high-fidelity signal of potential data destruction.
    answer_sources: Windows Event ID 4688, All Windows Endpoints and Servers, particularly those hosting sensitive data (e.g., financial records, intellectual property) or critical system configurations.
    range: Last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH Windows Event ID 4688 | REGEX match on CommandLine for patterns like 'cipher.exe /w:', 'format.com /p:', 'sdelete.exe -p'
  - question: Has a potentially destructive utility been executed in a statistically rare or anomalous manner?
    context: This question aims to find unusual executions of legitimate tools that might indicate malicious use. By flagging executions that are rare for a given user or host (e.g., 99th percentile rarity) or have unusual command-line complexity (entropy), analysts can surface suspicious activity that might otherwise be lost in the noise of normal system administration.
    answer_sources: Windows Event ID 4688, All Windows Endpoints and Servers, particularly those hosting sensitive data (e.g., financial records, intellectual property) or critical system configurations.
    range: Last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH Windows Event ID 4688 for utility execution | CALCULATE rarity score based on historical user/host frequency | CALCULATE Shannon entropy of command line | FLAG high rarity or anomalous entropy
  - question: Does a machine learning model identify the execution of a system utility as an anomaly based on its context?
    context: This question uses a multivariate anomaly detection model to identify suspicious executions of legitimate tools. The model considers the combination of user, host, parent process, and command. An execution that falls outside of established normal clusters, such as a destructive command run by a non-administrative user, is a strong indicator of compromise.
    answer_sources: Windows Event ID 4688, All Windows Endpoints and Servers, particularly those hosting sensitive data (e.g., financial records, intellectual property) or critical system configurations.
    range: Last 90 days
    queries:
      - technology: pseudocode
        query: INPUT user, host, parent process, command into anomaly detection model (e.g., Isolation Forest) | FLAG anomalous executions
  - question: Has the integrity of a critical system or configuration file been compromised?
    context: This question is crucial for ensuring the integrity of critical systems. By monitoring a list of essential files, calculating their hash upon modification, and comparing it to a known-good baseline, analysts can immediately detect unauthorized changes that could compromise system stability, security, or function.
    answer_sources: Windows Event ID 4663, File Integrity Monitoring (FIM) tool logs, Configuration-sensitive systems such as Domain Controllers, Public Key Infrastructure (PKI) Servers, Web Servers, Database Servers, and hosts with critical business applications.
    range: Last 90 days
    queries:
      - technology: pseudocode
        query: ON file write event (Windows Event ID 4663) to critical file list | CALCULATE file hash | COMPARE hash to stored baseline | ALERT on mismatch
  - question: Has there been a statistically significant spike in file modifications on critical assets outside of approved maintenance windows?
    context: This question helps differentiate between legitimate administrative changes and potentially malicious activity. A sudden burst of file modifications on a critical server that occurs outside of a scheduled maintenance window is highly suspicious. Comparing the activity volume against a 30-day rolling average helps quantify this deviation and reduce false positives.
    answer_sources: Windows Event ID 4663, File Integrity Monitoring (FIM) tool logs, Configuration-sensitive systems such as Domain Controllers, Public Key Infrastructure (PKI) Servers, Web Servers, Database Servers, and hosts with critical business applications.
    range: Last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH Windows Event ID 4663 on critical assets | CHECK if event is outside maintenance window | ALERT if modification count exceeds 98th percentile of 30-day rolling average
  - question: Does a machine learning model score a file modification event on a critical file as having a low legitimacy score?
    context: This question uses a classification model to assess the legitimacy of each file change on a critical asset. By considering multiple factors—such as the modifying process, user privileges, and time of day—the model can provide a nuanced risk score, allowing analysts to prioritize the most suspicious modifications for investigation.
    answer_sources: Windows Event ID 4663, File Integrity Monitoring (FIM) tool logs, Configuration-sensitive systems such as Domain Controllers, Public Key Infrastructure (PKI) Servers, Web Servers, Database Servers, and hosts with critical business applications.
    range: Last 90 days
    queries:
      - technology: pseudocode
        query: INPUT modifying process, user privileges, time of day, maintenance window flag INTO classification model | ALERT on low legitimacy score
  - question: Has a user deleted an excessive number of files from a critical file share in a short time frame?
    context: This question aims to detect bulk data destruction using a simple, high-impact rule. By setting a hard threshold (e.g., 500 deletions in 5 minutes) for delete operations by a single user on a critical system, security teams can quickly identify and respond to potential insider threats or compromised accounts attempting to cause damage.
    answer_sources: Windows Event ID 4663, Windows Event ID 4659, Windows Event ID 4660, Zeek smb_files.log, High-value file shares, document management systems, source code repositories, database servers, and backup storage volumes.
    range: Last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH delete events (Win 4660, Zeek smb_files.log) | COUNT events by user over 5-minute window on critical NAI | ALERT if count > 500
  - question: Is the rate of file write or delete operations for any user or host statistically anomalous compared to their normal behavior?
    context: This question provides a more dynamic approach than a hard threshold by establishing a personalized baseline of file activity for each user and host. Flagging activity that exceeds this baseline by a set number of standard deviations (e.g., mean plus 3 sigma) allows for more sensitive detection of abnormal behavior that might not cross a fixed limit.
    answer_sources: Windows Event ID 4663, Windows Event ID 4659, Windows Event ID 4660, Zeek smb_files.log, High-value file shares, document management systems, source code repositories, database servers, and backup storage volumes.
    range: Last 90 days
    queries:
      - technology: pseudocode
        query: CALCULATE rolling baseline (mean, stddev) of file write/delete ops per minute by user/host | FLAG any window where count > mean + 3 * stddev
  - question: Does a time-series model predict that the current volume of file modifications or deletions is anomalous?
    context: This question leverages a time-series forecasting model (like ARIMA) to understand the normal rhythm of file activity, including daily and weekly patterns. The model can then identify deviations from this expected rhythm with high precision, flagging events that are truly out of the ordinary and reducing alerts from regularly scheduled, high-volume activities.
    answer_sources: Windows Event ID 4663, Windows Event ID 4659, Windows Event ID 4660, Zeek smb_files.log, High-value file shares, document management systems, source code repositories, database servers, and backup storage volumes.
    range: Last 90 days
    queries:
      - technology: pseudocode
        query: INPUT file modification/deletion event counts into time-series model (e.g., ARIMA) | ALERT if actual count is outside model's predicted confidence interval
  - question: Are files being renamed with extensions associated with known ransomware, and is this correlated with suspicious network activity?
    context: This question seeks to identify a classic ransomware behavior mass file renaming (encryption). By looking for file rename events that use extensions from a known malicious list and correlating that activity with network connections to suspicious IPs or domains, analysts can gain high-confidence alerts for active ransomware incidents.
    answer_sources: Windows Event ID 4663, Zeek conn.log, Zeek dns.log, User workstations, file servers, backup servers, and network egress points.
    range: Last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH for file rename events (Win 4663) with extensions from a blocklist | CORRELATE with network connections (Zeek conn.log, dns.log) from same host within 5 minutes
  - question: Has there been a sudden drop in the diversity of file extensions within a directory, indicating mass renaming?
    context: This question provides a clever way to detect mass file renaming without relying on a known list of malicious extensions. A directory normally has a variety of file types. When ransomware encrypts files, it often renames them all to a single new extension. This causes a sharp, measurable drop in the statistical diversity (Shannon entropy) of file extensions, which can be used as an effective alert trigger.
    answer_sources: Windows Event ID 4663, Zeek conn.log, Zeek dns.log, User workstations, file servers, backup servers, and network egress points.
    range: Last 90 days
    queries:
      - technology: pseudocode
        query: CALCULATE rolling Shannon entropy of file extensions per directory | ALERT on a sharp drop in entropy below a dynamic threshold
  - question: Does a clustering algorithm identify a dense group of file rename events indicative of ransomware?
    context: This question uses a density-based clustering model to find the 'signal in the noise' of file system activity. A ransomware attack creates a very dense cluster of 'rename' events, all to a new extension, performed by a single process in a short time. The DBSCAN algorithm is particularly effective at identifying this dense cluster as an anomaly, providing a powerful detection method for ransomware behavior.
    answer_sources: Windows Event ID 4663, Zeek conn.log, Zeek dns.log, User workstations, file servers, backup servers, and network egress points.
    range: Last 90 days
    queries:
      - technology: pseudocode
        query: INPUT event type, file extension, process name, time delta into clustering model (e.g., DBSCAN) | CLASSIFY dense clusters of 'rename' events as high-confidence ransomware indicator