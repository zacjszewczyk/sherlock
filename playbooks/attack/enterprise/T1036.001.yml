name: T1036.001: Invalid Code Signature
id: a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d
description: This playbook helps investigate whether an adversary is using defense evasion techniques by executing code with an invalid signature. This involves checking for processes created from executables that match known malicious hashes or certificate thumbprints, fail OS digital signature validation, have a mismatch between the re-computed Authenticode hash and the one in the PE header, are signed with statistically rare certificates, or are downloaded and immediately executed with an invalid signature.
type: technique
related:
  - TA0005: Defense Evasion
contributors:
  - Zachary Szewczyk
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Are processes being created from executables that match known malicious indicators (hash or certificate thumbprint) from threat intelligence feeds?
    context: This question seeks to identify direct evidence of compromise by continuously monitoring for the execution of files that are already known to be malicious. A match against a high-confidence threat intelligence blocklist is a strong indicator of an intrusion and requires immediate investigation.
    answer_sources:
      - Sysmon Event ID 1
      - Sysmon Event ID 7
      - Windows Event ID 4688
      - Endpoint devices (workstations, servers)
      - Domain Controllers
      - Code repositories
      - Build servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: Monitor process creation and image load events. Extract file hash and certificate thumbprint. Query against threat intel blocklist. Alert on match.
  - question: Is there an anomalous spike in the daily frequency of unique known-malicious indicator hits on any single endpoint?
    context: This question aims to differentiate between sporadic, opportunistic malware infections and a targeted attack. By baselining the normal rate of IOC hits for each endpoint, a significant deviation can highlight a system that is being actively compromised or used as a beachhead for further lateral movement.
    answer_sources:
      - Sysmon Event ID 1
      - Sysmon Event ID 7
      - Windows Event ID 4688
      - Endpoint devices (workstations, servers)
      - Domain Controllers
      - Code repositories
      - Build servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: Calculate daily frequency of unique IOC hits per endpoint. Compare to 30-day baseline mean and standard deviation. Alert if daily count > 3 standard deviations above baseline.
  - question: Is there a widespread campaign underway indicated by an unforecasted, enterprise-wide spike in malicious indicator matches?
    context: This question uses a time series model to detect large-scale attacks that might be missed by per-endpoint analysis. A sharp, anomalous increase in IOC matches across the organization, especially for a single new indicator, suggests a coordinated campaign that needs a broader, strategic response.
    answer_sources:
      - Sysmon Event ID 1
      - Sysmon Event ID 7
      - Windows Event ID 4688
      - Endpoint devices (workstations, servers)
      - Domain Controllers
      - Code repositories
      - Build servers
    range: last 90 days
    queries:
      - technology: pseudocode
        query: Model aggregate count of IOC matches with time series anomaly detection. Alert on sharp, unforecasted spikes. Use anomaly score to set alert priority.
  - question: Are processes being created from executables that fail the operating system's built-in digital signature validation?
    context: This question looks for executables that are improperly signed, which is a common characteristic of malware or tampered legitimate tools. Triggering on 'Invalid' signature status events, while filtering out known-good exceptions, provides a direct method for detecting suspicious code execution.
    answer_sources:
      - Sysmon Event ID 7
      - Microsoft-Windows-CodeIntegrity/Operational Event ID 3077
      - Sysmon Event ID 1
      - All enterprise workstations
      - Application servers
      - Developer workstations
      - Systems with strict application control policies (e.g., WDAC)
    range: last 90 days
    queries:
      - technology: pseudocode
        query: Monitor for Sysmon Event ID 7 with 'SignatureStatus: Invalid'. Correlate with process creation event to get parent process and command line. Alert, excluding allowlisted files/signers.
  - question: Has any specific host or user shown an anomalous increase in the number of invalid signature events?
    context: This question helps to find outliers in activity related to improperly signed code. By establishing a baseline of normal invalid signature events for each user and host, a sudden increase beyond a high-percentile threshold can signal a compromised account or system being used to run multiple malicious tools.
    answer_sources:
      - Sysmon Event ID 7
      - Microsoft-Windows-CodeIntegrity/Operational Event ID 3077
      - Sysmon Event ID 1
      - All enterprise workstations
      - Application servers
      - Developer workstations
      - Systems with strict application control policies (e.g., WDAC)
    range: last 90 days
    queries:
      - technology: pseudocode
        query: Calculate a rolling 30-day baseline of invalid signature events per host/user. Alert if 24-hour count exceeds the 99th percentile threshold.
  - question: Can we automatically prioritize alerts for invalid signature events based on their likelihood of being malicious?
    context: This question addresses the challenge of alert fatigue by using a machine learning model to score the risk of an invalid signature event. By training a model on features like file path, parent process, and command-line arguments, security teams can focus their attention on the events most likely to be true positives, enabling faster and more effective response.
    answer_sources:
      - Sysmon Event ID 7
      - Microsoft-Windows-CodeIntegrity/Operational Event ID 3077
      - Sysmon Event ID 1
      - All enterprise workstations
      - Application servers
      - Developer workstations
      - Systems with strict application control policies (e.g., WDAC)
    range: last 90 days
    queries:
      - technology: pseudocode
        query: Train a classification model on historical invalid signature events using features like file path, parent process, etc. Use the model's output probability to triage and escalate alerts.
  - question: Are any executed files showing evidence of tampering, where the file's content hash does not match the hash stored in its digital signature?
    context: This question targets a specific code-tampering technique known as 'signature stripping' or modification after signing. A mismatch between the calculated Authenticode hash and the signed hash is a definitive indicator that the file has been altered, which is highly suspicious and warrants immediate investigation.
    answer_sources:
      - File binary from endpoint
      - Sysmon Event ID 1
      - All enterprise workstations
      - Critical servers (Domain Controllers, Database Servers)
      - Software distribution points
      - File shares
    range: last 90 days
    queries:
      - technology: pseudocode
        query: On process creation for new PE files, acquire the binary. Extract the signed hash from the WIN_CERTIFICATE structure. Re-calculate the file's Authenticode hash. Alert if hashes do not match.
  - question: Are there any hosts with a statistically unusual percentage of signed files that have an Authenticode hash mismatch?
    context: This question provides a hunting mechanism to proactively find compromised systems. By periodically scanning critical directories and comparing the percentage of tampered files on each host to a network-wide baseline, analysts can identify outlier systems that may have been targeted by an adversary modifying legitimate tools.
    answer_sources:
      - File binary from endpoint
      - Sysmon Event ID 1
      - All enterprise workstations
      - Critical servers (Domain Controllers, Database Servers)
      - Software distribution points
      - File shares
    range: last 90 days
    queries:
      - technology: pseudocode
        query: Perform weekly scan of critical directories on endpoints. Check for hash mismatch on signed PE files. Calculate mismatch percentage per host. Alert on hosts with a Z-score > 3 compared to the fleet baseline.
  - question: Among all files found with an Authenticode hash mismatch, which ones are the most anomalous and should be prioritized for investigation?
    context: This question helps analysts focus on the most unusual instances of file tampering. By using an unsupervised anomaly detection model on file and signature metadata, it's possible to score each mismatched file. This allows analysts to prioritize investigation on files that deviate most from normal patterns, increasing the efficiency of the hunt.
    answer_sources:
      - File binary from endpoint
      - Sysmon Event ID 1
      - All enterprise workstations
      - Critical servers (Domain Controllers, Database Servers)
      - Software distribution points
      - File shares
    range: last 90 days
    queries:
      - technology: pseudocode
        query: For files with a hash mismatch, extract features (PE metadata, signature metadata, context). Use an unsupervised anomaly detection model to assign a score. Prioritize investigation based on score.
  - question: Are any processes being signed with certificates that have suspicious attributes, such as known-bad issuers or subjects that mimic legitimate companies?
    context: This question aims to detect malicious code masquerading as legitimate software by using fraudulent or suspicious certificates. By maintaining a watchlist of known-bad certificate attributes, typosquatted company names, or unusual validity periods, security teams can quickly identify and alert on the execution of such files.
    answer_sources:
      - Sysmon Event ID 7
      - Sysmon Event ID 1
      - All enterprise workstations and servers
      - Certificate Authority servers
      - Developer workstations
    range: last 90 days
    queries:
      - technology: pseudocode
        query: Monitor image load events. Query certificate issuer and subject against a watchlist of suspicious attributes (known-bad names, typosquatting, long validity). Alert on match.
  - question: Are any executables being signed by a certificate issuer or subject that is statistically rare within the environment?
    context: This question is based on the premise that malware often uses newly created or obscure certificates. By tracking the frequency of all certificate issuers and subjects over time, it's possible to identify and flag the execution of a file signed by a certificate that has rarely or never been seen before, which is a strong indicator of suspicious activity.
    answer_sources:
      - Sysmon Event ID 7
      - Sysmon Event ID 1
      - All enterprise workstations and servers
      - Certificate Authority servers
      - Developer workstations
    range: last 90 days
    queries:
      - technology: pseudocode
        query: Maintain a lookup of certificate subject/issuer counts from image load events. For new executions, calculate a rarity score (inverse of count). Alert on executions with a score in the top 1% percentile.
  - question: Can we identify anomalous signing practices by clustering certificates based on their intrinsic properties?
    context: This question seeks to find unusual certificates without relying on prior knowledge of what is 'bad'. By clustering all observed certificates based on features like validity duration and string entropy, certificates that don't fit into common clusters (i.e., are flagged as noise or belong to very small clusters) can be surfaced for review as they represent abnormal signing behavior.
    answer_sources:
      - Sysmon Event ID 7
      - Sysmon Event ID 1
      - All enterprise workstations and servers
      - Certificate Authority servers
      - Developer workstations
    range: last 90 days
    queries:
      - technology: pseudocode
        query: Run weekly clustering on certificate features (validity duration, subject/issuer entropy, self-signed status). Flag certificates classified as noise or belonging to very small clusters for review.
  - question: Is there evidence of a file being downloaded from the internet and executed shortly thereafter, with the execution failing a signature validation check?
    context: This question correlates network and endpoint data to detect a common attack pattern 'drive-by' or 'download-and-run'. An alert that combines evidence of a recent download with an immediate execution that has an invalid signature provides a high-fidelity signal of a potentially malicious payload delivery.
    answer_sources:
      - Zeek files.log
      - Zeek conn.log
      - Sysmon Event ID 1
      - Sysmon Event ID 7
      - Network Egress/Internet Gateway
      - Proxy server logs
      - All enterprise workstations
    range: last 90 days
    queries:
      - technology: pseudocode
        query: Correlate a file hash from network logs (Zeek) with a process creation event on the destination host within 10 minutes. Join with the corresponding image load event. Alert if 'SignatureStatus' is 'Invalid'.
  - question: Which external domains are the most statistically significant sources of downloaded files that are subsequently executed with an invalid signature?
    context: This question helps to identify malicious infrastructure or watering holes. By calculating a 'risk ratio' for each source domain, analysts can rank and prioritize investigations into the domains that are most frequently associated with delivering improperly signed executables, potentially leading to the discovery of C2 servers or malicious content hosts.
    answer_sources:
      - Zeek files.log
      - Zeek conn.log
      - Sysmon Event ID 1
      - Sysmon Event ID 7
      - Network Egress/Internet Gateway
      - Proxy server logs
      - All enterprise workstations
    range: last 90 days
    queries:
      - technology: pseudocode
        query: Track the source domain for each 'download -> invalid execution' event. Calculate a weekly 'risk ratio' for each domain. Investigate the top 5% of domains by this ratio.
  - question: Is there an anomalous, enterprise-wide spike in the number of 'download and execute with invalid signature' events?
    context: This question aims to detect a widespread campaign by monitoring the overall rate of these correlated events. A time series anomaly detection model can identify a sudden, significant increase in these events across the organization, which could indicate a coordinated attack leveraging a new malicious file distributed from one or more sources.
    answer_sources:
      - Zeek files.log
      - Zeek conn.log
      - Sysmon Event ID 1
      - Sysmon Event ID 7
      - Network Egress/Internet Gateway
      - Proxy server logs
      - All enterprise workstations
    range: last 90 days
    queries:
      - technology: pseudocode
        query: Create an hourly time series of 'download -> invalid execution' event counts. Apply a time series anomaly detection algorithm. Alert on significant, unexplained spikes.