name: T1583.004: Server
id: f47ac10b-58cc-4372-a567-0e02b2c3d479
description: This playbook addresses the question of whether an adversary is developing server infrastructure for use in operations. It provides investigative steps to detect such activity by monitoring for several key indicators: internal hosts connecting to IPs or domains on threat intelligence feeds; SSL/TLS sessions whose certificate, JA3/JA3S hash, or server header match known adversary C2 profiles; connections to newly registered domains not previously seen in the environment; and concurrent DNS queries from multiple hosts to a single, uncommon external domain, which may indicate C2 rallying.
type: technique
related:
  - TA0042: Resource Development
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Has an internal host connected to or resolved a domain/IP on a high-confidence threat intelligence feed?
    context: This question aims to detect direct communication with known adversary infrastructure. By cross-referencing network and DNS logs with a curated list of malicious indicators, we can identify compromised hosts or initial access attempts. An alert from this check is a strong signal of potential malicious activity that requires immediate investigation.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Windows Event ID 5156
      - Threat Intelligence Platform Data
      - Network Egress Points
      - DNS Resolvers
      - Endpoint Devices
      - Threat Intelligence Platforms
    range: last 90 days
    queries:
      - technology: pseudocode
        query: JOIN (network_logs, dns_logs) WITH threat_intel_watchlist ON (destination_ip OR destination_domain). ALERT on match.
  - question: For a connection to a known malicious indicator, how prevalent is that destination across the enterprise?
    context: This question helps prioritize alerts by identifying uncommon connections. Widespread, legitimate services can sometimes be falsely flagged by threat intelligence. By focusing on destinations contacted by only a few hosts, analysts can filter out noise and concentrate on activity that is more likely to be targeted and malicious, such as a C2 server used by a specific malware implant.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Windows Event ID 5156
      - Threat Intelligence Platform Data
      - Network Egress Points
      - DNS Resolvers
      - Endpoint Devices
      - Threat Intelligence Platforms
    range: last 90 days
    queries:
      - technology: pseudocode
        query: FOREACH alert from previous query, COUNT distinct source_hosts connecting to alert_destination in last 30 days. IF count < threshold, INCREASE alert priority.
  - question: Can machine learning classify a connection matching a threat intelligence feed as truly malicious based on its network characteristics?
    context: This question seeks to enhance detection accuracy by applying a machine learning model. Instead of relying solely on a threat intelligence match, this approach analyzes other features of the connection (e.g., duration, data volume) to provide a confidence score. This helps automate the triage process, escalating only the highest-probability threats for manual review and reducing analyst fatigue from false positives.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Windows Event ID 5156
      - Threat Intelligence Platform Data
      - Network Egress Points
      - DNS Resolvers
      - Endpoint Devices
      - Threat Intelligence Platforms
    range: last 90 days
    queries:
      - technology: pseudocode
        query: FOREACH alert, EXTRACT features (duration, bytes_sent, etc.). INPUT features into trained_ML_model. IF model_score > confidence_threshold, ESCALATE alert.
  - question: Has an internal host established an SSL/TLS session with an external server whose certificate, JA3/JA3S hash, or server header matches a known C2 profile?
    context: This question focuses on identifying adversary C2 channels by looking for specific fingerprints in encrypted traffic. Adversaries often reuse tools with hardcoded or default values for SSL/TLS certificates and headers. Matching these known malicious signatures provides a high-fidelity method for detecting C2 communications, even when the destination IP or domain is not yet on a threat list.
    answer_sources:
      - Zeek ssl.log
      - Zeek http.log
      - Zeek ja3.log
      - Network Egress Points
      - Proxies with SSL/TLS Inspection
      - Network Security Monitoring (NSM) Sensors
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SCAN (ssl_logs, http_logs, ja3_logs) FOR signatures in C2_profile_library. ALERT on match.
  - question: Are there any external SSL/TLS connections using certificates with unusually low-entropy subject or issuer fields?
    context: This question aims to find suspicious SSL/TLS certificates by analyzing their randomness. Legitimate certificates typically have complex, high-entropy subject and issuer names. In contrast, default or auto-generated certificates used by C2 frameworks often have simple, non-random, or even empty fields, resulting in low entropy. Flagging these anomalies can uncover previously unknown C2 infrastructure.
    answer_sources:
      - Zeek ssl.log
      - Zeek http.log
      - Zeek ja3.log
      - Network Egress Points
      - Proxies with SSL/TLS Inspection
      - Network Security Monitoring (NSM) Sensors
    range: last 90 days
    queries:
      - technology: pseudocode
        query: FOREACH new SSL connection, CALCULATE entropy of certificate_subject and certificate_issuer. IF entropy < baseline_threshold, FLAG for review.
  - question: Can unsupervised clustering of SSL/TLS session features identify outlier groups of connections that may represent C2 activity?
    context: This question uses machine learning to find 'needles in a haystack'. Most network traffic goes to a few common destinations (Google, CDNs), forming large, dense clusters. C2 traffic, however, often involves unique certificate attributes and JA3/JA3S hashes, forming small, isolated clusters. By algorithmically identifying these outlier groups, analysts can discover novel adversary infrastructure without relying on pre-existing signatures.
    answer_sources:
      - Zeek ssl.log
      - Zeek http.log
      - Zeek ja3.log
      - Network Egress Points
      - Proxies with SSL/TLS Inspection
      - Network Security Monitoring (NSM) Sensors
    range: last 90 days
    queries:
      - technology: pseudocode
        query: EXTRACT features from SSL logs. APPLY DBSCAN or other clustering algorithm. INVESTIGATE small, outlier clusters.
  - question: Has an internal host connected to an external domain that was registered within the last 60 days and has never been seen before in the environment?
    context: This question targets a common adversary tactic of using newly registered domains (NRDs). Since these domains have no history, they are unlikely to be on reputation blocklists. By identifying connections to domains that are both new to the world (recently registered) and new to the enterprise (first seen), we can proactively detect potential phishing, malware distribution, or C2 infrastructure early in its lifecycle.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Sysmon Event ID 22
      - Passive DNS Data
      - WHOIS Data
      - Network Egress Points
      - DNS Resolvers
      - Endpoint Devices
      - Threat Intelligence Platforms
    range: last 90 days
    queries:
      - technology: pseudocode
        query: FOREACH new domain, CHECK against 90-day baseline. IF not found, QUERY WHOIS for creation_date. IF creation_date < 60 days, ALERT.
  - question: Do any newly observed domains exhibit statistical properties (e.g., high entropy, long name) indicative of being algorithmically generated or malicious?
    context: This question provides a method for risk-scoring new domains to find suspicious ones. Adversaries often use Domain Generation Algorithms (DGAs) or typo-squatted domains, which have distinct statistical characteristics (e.g., random-looking names, unusual character ratios). By scoring domains based on these features, we can prioritize the most suspicious-looking new domains for investigation.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Sysmon Event ID 22
      - Passive DNS Data
      - WHOIS Data
      - Network Egress Points
      - DNS Resolvers
      - Endpoint Devices
      - Threat Intelligence Platforms
    range: last 90 days
    queries:
      - technology: pseudocode
        query: FOREACH new domain, CALCULATE risk_score based on (length, entropy, etc.). IF risk_score > threshold, FLAG for review.
  - question: Has there been an anomalous spike in the daily volume of newly observed domains being contacted by the enterprise?
    context: This question looks for macro-level changes in network behavior. A sudden, significant increase in the number of new domains being accessed across the organization can signal a coordinated, widespread attack campaign, such as a mass phishing email or a new malware variant spreading. Detecting this spike allows security teams to respond to the campaign as a whole.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Sysmon Event ID 22
      - Passive DNS Data
      - WHOIS Data
      - Network Egress Points
      - DNS Resolvers
      - Endpoint Devices
      - Threat Intelligence Platforms
    range: last 90 days
    queries:
      - technology: pseudocode
        query: MODEL daily count of new domains using time-series analysis. ALERT on anomalous spikes. INVESTIGATE domains from spike day.
  - question: Have an unusually large number of hosts simultaneously queried a single, newly observed domain within a short time frame?
    context: This question aims to detect 'rallying,' a behavior where many compromised machines check in with a C2 server around the same time. This synchronized activity, especially when directed at a domain that has not been seen before, is a strong indicator of a botnet or a widespread malware infection being activated.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - Sysmon Event ID 22
      - Internal DNS Resolvers
      - Network Egress Points
      - Endpoint Devices
    range: last 90 days
    queries:
      - technology: pseudocode
        query: IN 5-min windows, COUNT distinct hosts per domain. IF host_count > threshold AND domain is new, ALERT for 'suspected C2 rallying'.
  - question: Has the hourly query count for any single domain experienced a statistically significant spike compared to its historical baseline?
    context: This question uses statistical analysis to find anomalous query patterns. This can detect a sudden increase in C2 activity, such as an adversary pushing a new command to all bots, which results in a burst of DNS lookups. This differs from rallying by looking for a significant increase in total queries over a longer period (an hour) rather than many hosts in a short window.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - Sysmon Event ID 22
      - Internal DNS Resolvers
      - Network Egress Points
      - Endpoint Devices
    range: last 90 days
    queries:
      - technology: pseudocode
        query: FOR each domain, track hourly query count. IF current_hour_count > (14-day_average + 3 * std_dev), ALERT.
  - question: Has the underlying pattern of DNS query volume for a specific domain abruptly changed?
    context: This question employs a more advanced statistical technique to detect subtle shifts in C2 behavior. Simple thresholding might miss a change where, for example, a C2 server's beaconing interval is modified, leading to a new but stable query rate. Change point detection algorithms are designed to identify exactly these kinds of shifts in the statistical properties of a time series, revealing changes in adversary tactics that might otherwise go unnoticed.
    answer_sources:
      - Zeek dns.log
      - Zeek conn.log
      - Sysmon Event ID 22
      - Internal DNS Resolvers
      - Network Egress Points
      - Endpoint Devices
    range: last 90 days
    queries:
      - technology: pseudocode
        query: FOR each domain's query time-series, APPLY change point detection algorithm. ALERT if a statistically significant change point is found.