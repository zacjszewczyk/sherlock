name: T1542.005: TFTP Boot
id: 0c2d1e8f-4b6a-4f9e-8d7c-1a3b5e7f9a2b
description: This playbook provides analytic guidance for detecting adversaries using TFTP Boot (T1542.005) for persistence and defense evasion on network devices. It focuses on identifying malicious firmware transfers by checking against threat intelligence, analyzing file and connection metadata for anomalies, detecting communication with unauthorized servers, and identifying suspicious post-transfer activity like C2 communication or significant changes in the device's network behavior.
type: technique
related:
- TA0003: Persistence
- TA0005: Defense Evasion
contributors:
- Zachary Szewczyk
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
- question: Are file hashes or IP addresses from TFTP transfers associated with known malicious indicators?
  context: This is a high-fidelity check to determine if a TFTP transfer involves known-malicious components. Adversaries may reuse firmware with embedded backdoors or connect to known C2 infrastructure. Matching file hashes (SHA256) or connection IPs against threat intelligence feeds can provide a direct link to a known threat.
  answer_sources:
  - Zeek file.log
  - Zeek conn.log
  - Core network switches and routers
  - Network management servers
  - Network management VLAN
  - Internet gateways and perimeter firewalls
  range: Last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH Zeek file.log AND conn.log FOR TFTP events | EXTRACT file_hash, source_ip, dest_ip | JOIN with threat_intelligence_feed ON file_hash OR ip_address | ALERT on match
- question: Are adversaries using slightly modified or patched versions of legitimate firmware, detectable via fuzzy hashing?
  context: Adversaries may alter legitimate firmware images to insert backdoors, making them difficult to detect with exact hash matching (e.g., SHA256). Fuzzy hashing (e.g., ssdeep) calculates a similarity score between files. By comparing a transferred file's fuzzy hash to a baseline of known-good firmware, analysts can detect potentially trojanized versions that are similar but not identical to legitimate images.
  answer_sources:
  - Zeek file.log
  - Network management servers
  - File repositories for OS images
  - Network device management VLAN
  range: Last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH Zeek file.log FOR TFTP file transfers | CALCULATE fuzzy_hash(file) | COMPARE fuzzy_hash against baseline_of_good_firmware_hashes | ALERT where similarity_score > 70 AND exact_match IS FALSE
- question: Are adversaries using high-entropy or otherwise anomalous filenames in TFTP transfers to obfuscate malicious activity?
  context: To evade simple signature-based detections, adversaries may use randomized or unusual filenames for their malicious firmware or toolkits. Calculating the Shannon entropy of filenames can detect randomization. Additionally, using NLP models trained on legitimate filenames can identify names that deviate significantly from established naming conventions, flagging them as anomalous.
  answer_sources:
  - Zeek file.log
  - Core network switches and routers
  - Network management servers
  - Network management VLAN
  range: Last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH Zeek file.log FOR TFTP transfers | CALCULATE shannon_entropy(filename) | COMPARE against 30_day_baseline_95th_percentile | ALERT where entropy > threshold
- question: Are there anomalous or rare file extensions being used in TFTP transfers compared to a historical baseline?
  context: Network device firmware and configuration files typically use a predictable set of extensions. The appearance of unusual extensions (e.g., .sh, .py, .elf) or a sudden spike in a historically rare extension can indicate an adversary is transferring scripts or executables not associated with standard device management, potentially for execution on the device.
  answer_sources:
  - Zeek file.log
  - Core network switches and routers
  - Network management servers
  - Network management VLAN
  range: Last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH Zeek file.log FOR TFTP transfers | EXTRACT file_extension | CALCULATE frequency distribution over last 30 days | ALERT if new extension appears with frequency < 0.1% OR existing extension frequency > 3 standard deviations from mean
- question: Is a network device communicating with an unauthorized, external, or statistically rare TFTP server?
  context: Legitimate TFTP transfers for network devices should originate from a small, well-defined set of internal management servers. A connection to any server not on this allowlist, especially an external IP address, is highly suspicious. This could indicate the device is downloading malicious firmware from an adversary-controlled server.
  answer_sources:
  - Zeek conn.log
  - Firewall Logs
  - Network device management VLAN
  - Perimeter firewall logs
  - Core router and switch ACLs
  range: Last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH Zeek conn.log OR Firewall Logs FOR dest_port = 69 AND source_ip IN network_device_subnets | CHECK if dest_ip is NOT IN authorized_tftp_server_allowlist | ALERT on mismatch
- question: Is TFTP activity involving network devices occurring outside of approved maintenance windows or from unauthorized source IPs?
  context: Network device updates are typically scheduled during specific maintenance windows to minimize disruption. TFTP activity occurring outside these hours is anomalous and warrants investigation. Similarly, transfers should only be initiated from designated management hosts. Activity from any other source could indicate a compromised host being used to pivot to network infrastructure.
  answer_sources:
  - Zeek conn.log
  - Zeek file.log
  - Core network switches and routers
  - Network management servers
  - Network management VLAN
  range: Last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH Zeek logs FOR TFTP events involving network_device_ips | CHECK if event_time is OUTSIDE maintenance_window OR source_ip is NOT IN authorized_management_hosts | ALERT on true
- question: Does a TFTP transfer exhibit multiple deviations from a device's normal behavior, such as anomalous time, file size, or source?
  context: A single anomaly might be a false positive, but multiple concurrent anomalies create a stronger signal. This involves building a multi-metric baseline for each device (e.g., typical file sizes, source IPs, time of day) and using a scoring system. A TFTP transfer that deviates across several of these metrics (e.g., an unusually large file, transferred at midday, from a new source) would receive a high risk score, indicating a high probability of malicious activity.
  answer_sources:
  - Zeek conn.log
  - Zeek file.log
  - Core network switches and routers
  - Network management servers
  - Network management VLAN
  range: Last 90 days
  queries:
  - technology: pseudocode
    query: FOR each TFTP event | CALCULATE risk_score based on deviations from baseline (time_of_day, file_size, source_ip) | ALERT if cumulative_risk_score > threshold
- question: Is there a correlated sequence of events: a TFTP transfer, followed by a device reboot, and then suspicious outbound C2-like traffic?
  context: This question looks for the full attack chain. An adversary transfers malicious firmware (TFTP), the device reboots to load it, and the new firmware establishes a C2 channel. Correlating these events in a short time window (e.g., 15 minutes) provides strong evidence of a successful compromise and persistence mechanism. The C2 traffic could be connections to known malicious IPs or patterns like DNS tunneling.
  answer_sources:
  - Zeek conn.log
  - Zeek file.log
  - Zeek dns.log
  - Zeek notice.log
  - Device Syslog
  - Core network switches and routers
  - Perimeter firewall logs
  range: Last 90 days
  queries:
  - technology: pseudocode
    query: TRIGGER on TFTP file transfer to device_ip | WITHIN 15 minutes, LOOK FOR reboot_event(device_ip) | AFTER reboot, LOOK FOR anomalous_outbound_connection(device_ip) | ALERT on completed sequence
- question: Following a TFTP event, is a network device's traffic profile statistically different from its historical baseline?
  context: A compromised device may exhibit new network behaviors. After detecting a TFTP transfer and reboot, monitoring the device's subsequent traffic for anomalies can reveal the impact. This involves comparing the post-transfer traffic profile (e.g., new protocols, ports, higher data volume, increased unique destinations) against a long-term baseline. A significant statistical deviation suggests the new firmware has altered the device's function.
  answer_sources:
  - Zeek conn.log
  - Zeek dns.log
  - Zeek protocol logs (e.g., http.log)
  - Core network switches and routers
  - East-West traffic collection points
  range: Last 90 days
  queries:
  - technology: pseudocode
    query: ON TFTP event for device_ip | CAPTURE traffic profile for next 1 hour | COMPARE new_profile to 30_day_baseline_profile using K-S test | ALERT if p-value < 0.01
- question: Can machine learning models be used to classify TFTP connections or transferred files as suspicious?
  context: For environments with complex TFTP activity, rule-based detections can be noisy. Machine learning models can learn the patterns of benign activity and identify outliers. A decision tree could classify connections based on metadata (geolocation, time, size), while a one-class SVM could identify connections from anomalous source IPs. This provides a more dynamic and adaptive detection method.
  answer_sources:
  - Zeek conn.log
  - Zeek file.log
  - Firewall Logs
  - Core network switches and routers
  - Network management servers
  range: Last 90 days
  queries:
  - technology: pseudocode
    query: STREAM TFTP connection metadata (source_ip, geo, asn, file_size, time) | INPUT features into trained_classifier_model (e.g., Decision Tree, One-Class SVM) | ALERT if model_prediction is 'anomalous' or 'suspicious'