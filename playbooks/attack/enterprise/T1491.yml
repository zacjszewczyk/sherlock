name: T1491: Defacement
id: 4e1a8b2c-9d0f-4e3a-8b1c-9a2d8e4f6b0c
description: This playbook helps determine if an adversary has impacted the integrity of internal or external web assets through defacement. It focuses on detecting unauthorized changes by analyzing network traffic for known IOCs, monitoring for suspicious process creation on web servers (e.g., shells spawned by web processes), tracking unusual or unauthorized file modifications in web content directories, identifying significant deviations in web page content from historical baselines, and flagging suspicious file transfers to web servers from unauthorized sources or with anomalous file types.
type: technique
related:
- TA0040: Impact
contributors:
- Zachary Szewczyk
- Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
- question: Is a web server communicating with any known malicious IP addresses, domains, or URLs associated with defacement campaigns?
  context: This question aims to identify direct communication between web assets and infrastructure known to be used by threat actors for defacement. Matching network logs against threat intelligence feeds is a high-fidelity method for detecting potential compromises or reconnaissance activities. An alert here could indicate an ongoing attack or a compromised server being used to stage further attacks.
  answer_sources:
  - Zeek conn.log
  - Zeek http.log
  - Zeek dns.log
  - Public-facing web servers, Content Delivery Network (CDN) edge nodes, Web Application Firewalls (WAF), Network egress points, DNS resolvers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH network_logs (conn, http, dns) WHERE destination_ip IN web_server_list AND (source_ip IN threat_feed OR destination_domain IN threat_feed OR url IN threat_feed)
- question: Are web servers receiving connections from source IPs with unusually high threat reputation scores?
  context: This question seeks to identify suspicious inbound traffic that may not be on a specific blocklist but exhibits characteristics of malicious activity. By aggregating connection data and evaluating source IP reputation, analysts can proactively spot potential brute-force attempts, vulnerability scanning, or other precursor activities to defacement from sources with a history of malicious behavior. A sustained high threat score from a source IP warrants investigation.
  answer_sources:
  - Zeek conn.log
  - Public-facing web servers, Content Delivery Network (CDN) edge nodes, Web Application Firewalls (WAF), Network egress points, DNS resolvers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH conn_logs WHERE destination_ip IN web_server_list | AGGREGATE by source_ip over 5min | JOIN with reputation_feed | ALERT where average_threat_score > threshold
- question: Does the content of HTTP responses from our web servers contain text classified as defacement or hacktivist messaging?
  context: This question focuses on directly analyzing the content being served by web servers to detect defacement. An NLP model can identify characteristic language, symbols, or themes common in defacement pages, providing a direct confirmation of a successful integrity compromise even if other indicators were missed. This is a reactive but highly effective detection method.
  answer_sources:
  - Zeek http.log
  - Public-facing web servers, Content Delivery Network (CDN) edge nodes, Web Application Firewalls (WAF), Network egress points, DNS resolvers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH http_logs | PIPE response_body to NLP_model | ALERT where classification is 'defacement' and confidence > 0.90
- question: Has a web server process (e.g., w3wp.exe, nginx) spawned a command shell or scripting engine (e.g., cmd.exe, powershell.exe)?
  context: This question is designed to detect a common post-exploitation technique where an attacker, having compromised a web application, uses the web server's process to execute commands on the underlying operating system. Legitimate web applications rarely, if ever, spawn command shells. Such an event is a strong indicator that an attacker is attempting to escalate privileges, modify files, or establish persistence.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 4663
  - Web servers (application layer), Web server host operating systems
  range: last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH process_creation_logs (EID 4688) WHERE parent_process_name IN web_server_processes AND child_process_name IN shell_processes
- question: Have any statistically rare parent-child process relationships been observed on web servers?
  context: This question uses anomaly detection to identify suspicious process behavior that may not be covered by a static rule. By baselining normal process activity, this method can uncover novel or unusual attack techniques. An alert for a rare process relationship, such as a web server process spawning an FTP client, could indicate an attacker's attempt to exfiltrate data or download additional tools, which would deviate from normal operational patterns.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 4663
  - Web servers (application layer), Web server host operating systems
  range: last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH process_creation_logs (EID 4688) on web_servers | CALCULATE frequency of parent_child_pairs | ALERT where frequency < 1st_percentile
- question: Has a machine learning model classified any process creation events on web servers as suspicious?
  context: This question leverages a more sophisticated machine learning approach to distinguish between benign administrative or deployment activities and malicious actions. The model considers multiple features (parent, child, command line, user) to make a holistic assessment. This can help reduce false positives from simple rules and detect more nuanced attacks that attempt to masquerade as legitimate activity.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 4663
  - Web servers (application layer), Web server host operating systems
  range: last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH process_creation_logs (EID 4688) | PIPE features to ML_model | ALERT where classification is 'suspicious' and confidence is high
- question: Have critical web files been modified by an unauthorized user account or process?
  context: This question aims to enforce change control policies by monitoring file integrity. Web content should only be modified by specific, authorized deployment accounts and processes. Any modification by another user or an unexpected process is a strong indicator of a security breach and potential defacement.
  answer_sources:
  - Windows Event ID 4663
  - Windows Event ID 4688
  - Web server file systems (content directories), Version control systems, Change management databases
  range: last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH file_modification_logs (EID 4663) WHERE file_path IN critical_web_directories AND (user_name NOT IN authorized_users OR process_name NOT IN authorized_processes)
- question: Has an anomalous volume of file modifications occurred in web content directories outside of normal maintenance windows?
  context: This question focuses on the temporal aspect of file changes. Legitimate deployments typically happen during scheduled maintenance windows. A sudden spike in file modifications at an unusual time, such as overnight or on a weekend, is highly suspicious and could represent an attacker defacing multiple files at once. This detects abnormal patterns of activity, not just single unauthorized changes.
  answer_sources:
  - Windows Event ID 4663
  - Windows Event ID 4688
  - Web server file systems (content directories), Version control systems, Change management databases
  range: last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH file_modification_logs (EID 4663) in web_directories | AGGREGATE count by hour, day_of_week | COMPARE to baseline | ALERT where count > (mean + 3 * stdev)
- question: Have any anomalous clusters of file modification activity been identified that differ from normal deployment patterns?
  context: This question uses unsupervised machine learning to group file modification events based on their characteristics (user, process, time, number of files). Normal deployments will form large, dense clusters. An attacker's activity, which might involve a different user or process, will likely form a small, separate cluster (an anomaly), allowing analysts to quickly pinpoint suspicious change events that don't fit the established norm.
  answer_sources:
  - Windows Event ID 4663
  - Windows Event ID 4688
  - Web server file systems (content directories), Version control systems, Change management databases
  range: last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH file_modification_logs (EID 4663) | EXTRACT features (user, process, time, count) | APPLY clustering_algorithm (DBSCAN) | ALERT on anomalous clusters
- question: Does the hash of a critical web page's content match its known-good baseline hash following a modification event?
  context: This is a classic file integrity monitoring (FIM) question. By comparing the current hash of a file with a trusted, pre-calculated baseline, any unauthorized modification can be detected with high certainty. This provides definitive proof that the integrity of a web page has been compromised.
  answer_sources:
  - Zeek http.log
  - Zeek files.log
  - Windows Event ID 4663
  - Network egress points (monitoring HTTP responses), Web server file systems (for at-rest analysis)
  range: last 90 days
  queries:
  - technology: pseudocode
    query: ON file_modification_event (EID 4663) for critical_file | TRIGGER http_request_for_file | CALCULATE hash_from_response_body | COMPARE new_hash to baseline_hash | ALERT if not match
- question: Has the content complexity (entropy) of a key web page significantly deviated from its historical baseline?
  context: This question looks for substantial changes in the structure and content of a web page. A defacement often involves replacing structured HTML and text with simple messages or images, which would drastically change the page's entropy (a measure of randomness or complexity). A significant shift in this metric is a strong indicator of a major, unauthorized content change.
  answer_sources:
  - Zeek http.log
  - Zeek files.log
  - Windows Event ID 4663
  - Network egress points (monitoring HTTP responses), Web server file systems (for at-rest analysis)
  range: last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH http_logs for critical_page | CALCULATE entropy of response_body | COMPARE to baseline | ALERT if change > (mean + 2 * stdev)
- question: Has a time-series anomaly detection model flagged a web page's features (e.g., size, script count, image count) as anomalous?
  context: This question uses a sophisticated model to learn the normal characteristics of a web page over time. The model can detect subtle deviations that might not be caught by simple hash or entropy checks. For example, an attacker might inject a malicious script or a single image, which would change the feature vector enough for the model to flag it as an anomaly.
  answer_sources:
  - Zeek http.log
  - Zeek files.log
  - Windows Event ID 4663
  - Network egress points (monitoring HTTP responses), Web server file systems (for at-rest analysis)
  range: last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH http_logs | EXTRACT features (size, script_count, etc.) | PIPE to time_series_model | ALERT if reconstruction_error > threshold
- question: Has a file been written to a web content directory from an unauthorized network source via FTP or SMB?
  context: This question aims to detect attackers uploading malicious files or defacement content to a web server using common file transfer protocols. Legitimate content updates should only come from known, trusted network locations (e.g., developer workstations, CI/CD servers). A file transfer originating from any other source is highly suspicious and requires immediate investigation.
  answer_sources:
  - Zeek ftp.log
  - Zeek smb_files.log
  - Zeek conn.log
  - Windows Event ID 4663
  - Zeek files.log
  - Web server network interfaces, Internal network segments with access to web servers, File Transfer Protocol (FTP) servers, Server Message Block (SMB) shares
  range: last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH file_transfer_logs (ftp, smb) WHERE destination_ip IN web_servers AND destination_path IN web_directories AND source_ip NOT IN authorized_subnets
- question: Has a file with a statistically rare or suspicious MIME type (e.g., application/zip, application/x-dosexec) been transferred to a web directory?
  context: This question focuses on the type of file being uploaded. Web directories typically contain a predictable set of file types (HTML, CSS, JS, images). The appearance of an unusual file type, such as a compressed archive or an executable, is anomalous and could indicate an attacker uploading a web shell or toolkit.
  answer_sources:
  - Zeek ftp.log
  - Zeek smb_files.log
  - Zeek conn.log
  - Windows Event ID 4663
  - Zeek files.log
  - Web server network interfaces, Internal network segments with access to web servers, File Transfer Protocol (FTP) servers, Server Message Block (SMB) shares
  range: last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH file_transfer_logs with mime_type info | CALCULATE frequency of mime_types in web_directories | ALERT where mime_type_frequency < 5th_percentile
- question: Has an anomaly detection model (Isolation Forest) identified any outlier file transfer events to web servers?
  context: This question uses a machine learning model to find unusual file transfers. The model considers multiple dimensions at once (source IP, port, protocol, size, MIME type) to identify transfers that deviate from the norm in complex ways. This can catch sophisticated attackers who might try to blend in by using a common port but an unusual file size or a combination of other subtle factors.
  answer_sources:
  - Zeek ftp.log
  - Zeek smb_files.log
  - Zeek conn.log
  - Windows Event ID 4663
  - Zeek files.log
  - Web server network interfaces, Internal network segments with access to web servers, File Transfer Protocol (FTP) servers, Server Message Block (SMB) shares
  range: last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH file_transfer_logs | EXTRACT features (src_ip, dst_port, protocol, size, mime_type) | APPLY isolation_forest_model | ALERT on anomalous scores