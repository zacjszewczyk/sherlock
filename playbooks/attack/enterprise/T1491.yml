name: "T1491: Defacement"
id: "a3e8f6d2-4c1b-4d9e-8f7a-1b2c3d4e5f6a"
description: "Has the adversary impacted the integrity of internal or external web assets through defacement? This playbook helps investigate this by detecting suspicious network traffic to web servers from known-bad sources, anomalous process creation on web servers (e.g., a web process spawning a shell), unauthorized or unusual file modifications in web content directories, significant deviations in served web page content from historical baselines, and anomalous file transfers to web servers from untrusted sources or with unexpected file types."
type: "technique"
related:
  - "TA0040: Impact"
contributors:
  - "Zachary Szewczyk"
  - "Ask Sage"
created: "2025-10-01"
modified: "2025-10-01"
version: "1.0"
tags: "none"
questions:
  - question: "Has any network traffic to or from a web server matched a known indicator of compromise (IOC) associated with defacement campaigns?"
    context: "This question aims to identify direct communication with malicious infrastructure known to be involved in defacement activities. Correlating network, HTTP, and DNS logs with threat intelligence feeds provides a high-fidelity signal that a web server is being targeted or has been compromised by a known threat actor."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek http.log"
      - "Zeek dns.log"
      - "Public-facing web servers, Content Delivery Network (CDN) edge nodes, Web Application Firewalls (WAF), Network egress points, DNS resolvers"
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "SEARCH network, http, dns logs WHERE destination_ip is a web_server AND (source_ip IN threat_intel_ips OR destination_domain IN threat_intel_domains OR url IN threat_intel_urls)"
  - question: "Have any source IPs communicating with web servers exhibited a threat score that exceeds a statistically determined threshold?"
    context: "This question seeks to identify potentially malicious source IPs that may not be on a static threat intelligence list. By analyzing the reputation of all connecting IPs and looking for statistical outliers in threat scores over a short time window, we can detect emerging threats or attackers using previously unknown infrastructure."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek http.log"
      - "Zeek dns.log"
      - "Public-facing web servers, Content Delivery Network (CDN) edge nodes, Web Application Firewalls (WAF), Network egress points, DNS resolvers"
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "AGGREGATE conn_logs by source_ip over 5_min_window | JOIN with ip_reputation_feed | CALCULATE average_threat_score | ALERT if average_threat_score > threshold (e.g., 95th percentile)"
  - question: "Has an NLP model detected content consistent with defacement or hacktivist messaging in HTTP response bodies?"
    context: "This question attempts to directly detect the outcome of a successful defacement by analyzing the content of web pages as they are served. An NLP model trained to recognize common patterns in defacement pages (e.g., specific keywords, political messages) can provide a direct confirmation of a compromise, even if other indicators were missed."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek http.log"
      - "Zeek dns.log"
      - "Public-facing web servers, Content Delivery Network (CDN) edge nodes, Web Application Firewalls (WAF), Network egress points, DNS resolvers"
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "FROM http_logs, EXTRACT http_response_body | APPLY NLP_classification_model to response_body | ALERT if classification is 'defacement' AND confidence_score > 0.90"
  - question: "Has a known web server process spawned a command shell or scripting engine?"
    context: "This question looks for a common post-exploitation technique where an attacker, having compromised a web application, uses the web server process to spawn a shell for further interaction. This is highly anomalous behavior, as web servers should not typically be creating interactive shells."
    answer_sources:
      - "Windows Event ID 4688"
      - "Windows Event ID 4663"
      - "Web servers (application layer), Web server host operating systems"
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "SEARCH process_creation_logs (EID 4688) WHERE parent_process IN (web_server_processes) AND child_process IN (shell_processes)"
  - question: "Have any rare or never-before-seen parent-child process relationships occurred on web servers?"
    context: "This question aims to detect anomalous process behavior without relying on a predefined list of suspicious processes. By baselining all normal parent-child process relationships, any deviation or statistically rare event can be flagged for investigation, potentially uncovering novel attack techniques."
    answer_sources:
      - "Windows Event ID 4688"
      - "Windows Event ID 4663"
      - "Web servers (application layer), Web server host operating systems"
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "BASELINE frequency of all (parent_process, child_process) pairs from process_creation_logs | MONITOR for new events | ALERT if frequency of (parent, child) pair is below 1st percentile"
  - question: "Has a machine learning model classified any process creation events on web servers as suspicious?"
    context: "This question leverages a machine learning model to provide a more nuanced detection of suspicious process activity. By considering multiple features like process names, command line arguments, and user context, the model can distinguish between benign administrative or deployment actions and potentially malicious activity with greater accuracy."
    answer_sources:
      - "Windows Event ID 4688"
      - "Windows Event ID 4663"
      - "Web servers (application layer), Web server host operating systems"
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "FOR each process_creation_event, EXTRACT features (parent_name, child_name, cmd_entropy, user) | APPLY random_forest_classifier | ALERT if classification is 'suspicious' with high confidence"
  - question: "Has a critical web file been modified by an unauthorized user account or process?"
    context: "This question seeks to detect unauthorized changes to web content by enforcing access control based on an allow-list. Any modification to sensitive web directories by an account or process not explicitly authorized for deployment or maintenance is a strong indicator of a potential compromise."
    answer_sources:
      - "Windows Event ID 4663"
      - "Windows Event ID 4688"
      - "Web server file systems (content directories), Version control systems, Change management databases"
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "SEARCH file_modification_logs (EID 4663) WHERE target_directory IN (web_content_dirs) AND (user NOT IN authorized_users OR process NOT IN authorized_processes)"
  - question: "Has there been an anomalous spike in file modification activity in web content directories outside of normal patterns?"
    context: "This question aims to identify unusual bursts of file modification activity that deviate from established baselines. Legitimate deployments often happen at regular, predictable times. A sudden flurry of changes at an odd hour could indicate an attacker modifying multiple files as part of a defacement."
    answer_sources:
      - "Windows Event ID 4663"
      - "Windows Event ID 4688"
      - "Web server file systems (content directories), Version control systems, Change management databases"
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "BASELINE hourly file_mod_count by day_of_week from logs (EID 4663) | CALCULATE mean and std_dev for each hour | ALERT if current_hour_count > (mean + 3 * std_dev)"
  - question: "Have any clusters of anomalous file modification events been identified on web servers?"
    context: "This question uses unsupervised machine learning to group file modification events based on their properties. Normal deployment activities should form large, dense clusters. Smaller, outlier clusters may represent malicious activity that differs in terms of the user, process, time, or number of files modified."
    answer_sources:
      - "Windows Event ID 4663"
      - "Windows Event ID 4688"
      - "Web server file systems (content directories), Version control systems, Change management databases"
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "FROM file_mod_logs (EID 4663), CREATE feature_vectors (user, process, time, file_count) | APPLY DBSCAN clustering | INVESTIGATE clusters identified as noise/anomalies"
  - question: "Has the file hash of a critical web page changed unexpectedly after a modification event?"
    context: "This question provides a definitive way to confirm unauthorized content modification through file integrity monitoring. By comparing the hash of a served page against a known-good baseline immediately after a file modification is detected, any change, malicious or otherwise, can be instantly flagged."
    answer_sources:
      - "Zeek http.log"
      - "Zeek files.log"
      - "Windows Event ID 4663"
      - "Network egress points (monitoring HTTP responses), Web server file systems (for at-rest analysis)"
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "ON file_mod_event (EID 4663) for critical_file, TRIGGER hash_check | CAPTURE next http_response_body for that file from http.log | CALCULATE new_hash | ALERT if new_hash != known_good_hash"
  - question: "Has the entropy or structural complexity of a served web page deviated significantly from its baseline?"
    context: "This question seeks to detect subtle or significant changes in a web page's content that might not be caught by simple hash comparison (e.g., if the change is dynamic). A sudden, large change in entropy can indicate that the page's content structure has been dramatically altered, as is common in defacements where original content is replaced with simple text or images."
    answer_sources:
      - "Zeek http.log"
      - "Zeek files.log"
      - "Windows Event ID 4663"
      - "Network egress points (monitoring HTTP responses), Web server file systems (for at-rest analysis)"
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "BASELINE shannon_entropy for each key web_page | MONITOR http_responses, recalculate entropy from response_body | ALERT if new_entropy deviates from baseline by > 2 * std_dev"
  - question: "Has a time-series model detected an anomalous change in the structural features of a served web page?"
    context: "This question uses a sophisticated machine learning approach to monitor the health of a web page over time. By modeling the normal behavior of various page features (size, tag counts, etc.), an autoencoder can detect subtle deviations that might indicate a compromise, providing a robust and adaptive detection mechanism."
    answer_sources:
      - "Zeek http.log"
      - "Zeek files.log"
      - "Windows Event ID 4663"
      - "Network egress points (monitoring HTTP responses), Web server file systems (for at-rest analysis)"
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "EXTRACT feature_vectors (size, script_tags, etc.) from http_responses over time | TRAIN LSTM_autoencoder model | MONITOR live traffic | ALERT if model_reconstruction_error > dynamic_threshold"
  - question: "Has a file been written to a web content directory from a source IP outside the designated administrative network range?"
    context: "This question aims to detect unauthorized file uploads to a web server. By restricting file transfers (e.g., via FTP or SMB) to a small, well-defined set of administrative subnets, any attempt to write to web directories from an external or unauthorized internal source can be immediately identified as suspicious."
    answer_sources:
      - "Zeek ftp.log"
      - "Zeek smb_files.log"
      - "Zeek conn.log"
      - "Windows Event ID 4663"
      - "Zeek files.log"
      - "Web server network interfaces, Internal network segments with access to web servers, File Transfer Protocol (FTP) servers, Server Message Block (SMB) shares"
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "SEARCH ftp_logs or smb_logs for file_write | WHERE destination_ip is web_server AND destination_path is web_content_dir AND source_ip NOT IN admin_subnets"
  - question: "Has a file with a statistically rare or suspicious mime-type (e.g., executable, archive) been transferred to a web directory?"
    context: "This question focuses on the type of files being transferred to a web server. Web directories should typically only receive web-related files (HTML, CSS, images). The appearance of unusual file types, like executables or zip archives, is highly anomalous and could indicate an attacker uploading tools or a defacement kit."
    answer_sources:
      - "Zeek ftp.log"
      - "Zeek smb_files.log"
      - "Zeek conn.log"
      - "Windows Event ID 4663"
      - "Zeek files.log"
      - "Web server network interfaces, Internal network segments with access to web servers, File Transfer Protocol (FTP) servers, Server Message Block (SMB) shares"
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "BASELINE frequency of mime_types in file_transfer_logs to web_dirs | MONITOR new transfers | ALERT if mime_type is in bottom 5th percentile (e.g., 'application/zip')"
  - question: "Has an anomaly detection model identified any outlier file transfer events to web servers?"
    context: "This question uses an unsupervised learning model to find unusual file transfers that don't fit normal patterns. By considering a combination of features like source IP, protocol, file size, and mime-type, the model can flag transfers that are outliers, even if no single feature is suspicious on its own."
    answer_sources:
      - "Zeek ftp.log"
      - "Zeek smb_files.log"
      - "Zeek conn.log"
      - "Windows Event ID 4663"
      - "Zeek files.log"
      - "Web server network interfaces, Internal network segments with access to web servers, File Transfer Protocol (FTP) servers, Server Message Block (SMB) shares"
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "FROM file_transfer_logs, CREATE feature_vectors (src_ip, port, proto, size, mime_type) | APPLY isolation_forest model | INVESTIGATE transfers with high anomaly_score"