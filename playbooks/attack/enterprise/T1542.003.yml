name: "T1542.003: Bootkit"
id: "a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d"
description: "This playbook investigates adversary persistence and defense evasion through bootkits (T1542.003). It focuses on detecting modifications to the system boot process by looking for known bootkit file hashes, malicious use of boot-related system utilities (`bootsect.exe`, `bcdedit.exe`), raw disk access by unusual processes, and unauthorized modifications to the EFI System Partition (ESP). It also aims to identify bootkit activity by monitoring for C2 communications, command-line disabling of security features (like Secure Boot), suspicious network activity between boot and user logon, and network connections that are not attributed to any running process on the host, which could indicate a rootkit's presence."
type: "technique"
related:
  - "TA0003: Persistence"
  - "TA0005: Defense Evasion"
contributors:
  - "Zachary Szewczyk"
  - "Ask Sage"
created: "2025-10-01"
modified: "2025-10-01"
version: 1.0
tags: "none"
questions:
  - question: "Have any files matching known bootkit hashes been observed being created on endpoints or transferred over the network?"
    context: "This question aims to detect the initial introduction of a bootkit. By comparing file hashes from network traffic and file creation events against a continuously updated list of known malicious bootkit hashes, we can identify the presence of specific, known threats with high confidence. A match indicates a bootkit component has been downloaded or written to a system."
    answer_sources:
      - "Zeek files.log"
      - "Windows Event ID 4688"
      - "Sysmon Event ID 11"
      - "Internet Gateway"
      - "Email Gateway"
      - "Endpoint File Systems"
      - "Server File Systems"
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "SEARCH (Zeek files.log OR Sysmon Event ID 11) | JOIN file_hash with threat_intel_feed_of_bootkit_hashes | WHERE match_found"
  - question: "Have any newly created executable files exhibited unusually high entropy, suggesting they might be packed or encrypted bootkit droppers?"
    context: "This question seeks to identify potential bootkit installers that may not be known to threat intelligence. Malware is often packed or encrypted to evade signature-based detection, which results in high entropy (randomness). By baselining the normal entropy of executables in the environment, we can flag new files with statistically significant high entropy as suspicious, warranting further investigation."
    answer_sources:
      - "Zeek files.log"
      - "Windows Event ID 4688"
      - "Sysmon Event ID 11"
      - "Internet Gateway"
      - "Email Gateway"
      - "Endpoint File Systems"
      - "Server File Systems"
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "FOREACH new_executable from Sysmon Event ID 11 | CALCULATE shannon_entropy | IF entropy > 98th_percentile_baseline THEN ALERT"
  - question: "Has a machine learning model identified any newly observed executable files as likely being malicious bootkit components based on their characteristics and context?"
    context: "This question leverages a machine learning model to provide a more nuanced detection of unknown bootkits. By analyzing a combination of features—including PE header structure, file metadata, and the context of its arrival (e.g., downloaded from a low-reputation IP, created by an unusual parent process)—the model can identify complex patterns indicative of malware that simpler methods might miss. An alert from this model suggests a high probability of a malicious file."
    answer_sources:
      - "Zeek files.log"
      - "Windows Event ID 4688"
      - "Sysmon Event ID 11"
      - "Internet Gateway"
      - "Email Gateway"
      - "Endpoint File Systems"
      - "Server File Systems"
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "FOREACH new_executable | EXTRACT features (PE header, metadata, context) | SCORE with classification_model | IF score > confidence_threshold THEN ALERT"
  - question: "Have system utilities like `bootsect.exe`, `bcdedit.exe`, or `debug.exe` been executed with command-line arguments known to modify boot records or disable security?"
    context: "This question looks for direct, explicit commands used to install or configure bootkits. Adversaries use these legitimate Windows utilities with specific arguments to write to the MBR/VBR or disable integrity checks. Detecting these specific command-line patterns is a high-fidelity indicator of an attempt to establish persistence via a bootkit."
    answer_sources:
      - "Windows Event ID 4688"
      - "Sysmon Event ID 1"
      - "Domain Controllers"
      - "Critical Application Servers"
      - "Standard User Endpoints"
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "SEARCH Sysmon Event ID 1 | WHERE process_name IN ('bootsect.exe', 'bcdedit.exe', 'debug.exe') AND command_line MATCHES known_malicious_patterns"
  - question: "Has `bcdedit.exe` been executed by an unusual parent process or with a statistically rare combination of command-line arguments?"
    context: "This question aims to find abnormal usage of `bcdedit.exe` that might not be caught by specific signature-based rules. A legitimate administrator's usage patterns are typically consistent. An execution by an unexpected process (like Microsoft Word) or with a novel set of arguments is a strong statistical anomaly, suggesting the process was hijacked or is being used maliciously."
    answer_sources:
      - "Windows Event ID 4688"
      - "Sysmon Event ID 1"
      - "Domain Controllers"
      - "Critical Application Servers"
      - "Standard User Endpoints"
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "SEARCH Sysmon Event ID 1 WHERE process_name='bcdedit.exe' | IF parent_process OR command_line_combo IS RARE (<0.1% frequency) THEN ALERT"
  - question: "Has a machine learning model detected novel or obfuscated malicious command-line arguments for `bcdedit.exe` that deviate from normal administrative usage?"
    context: "This question uses machine learning to understand the 'language' of benign `bcdedit.exe` commands. By vectorizing the command-line arguments and training a classifier, the model can identify command structures that are syntactically different from established safe patterns, even if they don't match a known-bad signature. This helps detect new or evasive techniques for boot record modification."
    answer_sources:
      - "Windows Event ID 4688"
      - "Sysmon Event ID 1"
      - "Domain Controllers"
      - "Critical Application Servers"
      - "Standard User Endpoints"
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "FOREACH bcdedit_execution | VECTORIZE command_line | CLASSIFY with model | IF class='malicious' THEN ALERT"
  - question: "Has any process gained raw write access to a physical disk and then immediately initiated a system restart or shutdown?"
    context: "This question identifies a critical sequence of events for bootkit installation. A bootkit must write to the raw disk (e.g., `\\.\\PhysicalDrive0`) to infect the boot sector, and a reboot is required to activate it. Correlating these two actions by the same process within a short time window is a strong indicator of a successful bootkit installation attempt."
    answer_sources:
      - "Sysmon Event ID 9"
      - "Sysmon Event ID 1"
      - "Windows Event ID 1074"
      - "Endpoint Devices"
      - "Physical Servers"
      - "Virtualization Hosts"
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "CORRELATE Sysmon Event ID 9 (RawAccess) with Sysmon Event ID 1 (shutdown.exe) by ProcessGuid within 5 minutes"
  - question: "Has a process not on the approved allowlist for disk imaging or backup utilities performed a raw disk access operation?"
    context: "This question focuses on the rarity of legitimate raw disk access. Only a very small, specific set of system tools should ever perform this action. By creating an allowlist of these known-good processes, any other process triggering a raw disk access event is, by definition, a high-confidence statistical anomaly that warrants an immediate investigation for bootkit activity."
    answer_sources:
      - "Sysmon Event ID 9"
      - "Sysmon Event ID 1"
      - "Windows Event ID 1074"
      - "Endpoint Devices"
      - "Physical Servers"
      - "Virtualization Hosts"
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "SEARCH Sysmon Event ID 9 | WHERE process_name NOT IN raw_access_allowlist | ALERT"
  - question: "Has a machine learning model detected a low-probability sequence of events, such as a non-system process launching, accessing the raw disk, and then initiating a reboot?"
    context: "This question uses a model (like an HMM) to learn the normal 'rhythm' or sequence of system events on a host. A bootkit installation sequence—a user process starting, followed by raw disk access, then a shutdown command—is a highly abnormal transition between system states. The model can detect this anomalous sequence as a low-probability event, flagging it as suspicious behavior."
    answer_sources:
      - "Sysmon Event ID 9"
      - "Sysmon Event ID 1"
      - "Windows Event ID 1074"
      - "Endpoint Devices"
      - "Physical Servers"
      - "Virtualization Hosts"
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "INPUT event_sequence to HMM | IF sequence_probability IS LOW THEN ALERT"
  - question: "Has any process not on the approved allowlist of OS installers or updaters created or modified a file in the EFI System Partition (ESP)?"
    context: "This question targets UEFI bootkit installation. The ESP contains critical boot loaders, and modifications to it are tightly controlled. By maintaining an allowlist of legitimate processes (like `Bcdboot.exe`) that are authorized to write to the ESP, any file creation by an unauthorized process is a clear and high-confidence indicator of a potential UEFI bootkit infection."
    answer_sources:
      - "Sysmon Event ID 11"
      - "Sysmon Event ID 23"
      - "Sysmon Event ID 1"
      - "UEFI-based Endpoints"
      - "UEFI-based Servers"
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "SEARCH Sysmon Event ID 11 | WHERE target_filename contains '/EFI/' AND process_hash NOT IN esp_writer_allowlist | ALERT"
  - question: "Has there been a statistically significant spike in file modification activity within the EFI System Partition on any given host, especially outside of a patch window?"
    context: "This question looks for anomalous volumes of activity in the ESP. Legitimate modifications to the ESP are infrequent and often tied to system updates. By baselining the normal rate of file changes, a sudden burst of activity (e.g., more than 3 standard deviations above the mean) is a statistical anomaly that could indicate an adversary is tampering with EFI boot files."
    answer_sources:
      - "Sysmon Event ID 11"
      - "Sysmon Event ID 23"
      - "Sysmon Event ID 1"
      - "UEFI-based Endpoints"
      - "UEFI-based Servers"
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "COUNT daily Sysmon Event ID 11 in ESP per host | IF count > (mean + 3*stdev) THEN ALERT"
  - question: "Has a machine learning model flagged any file modifications in the EFI System Partition as anomalous based on the context of the event?"
    context: "This question uses a one-class SVM model to define the boundary of 'normal' ESP modification activity. The model learns the typical characteristics of legitimate events, including the parent process, process name, and time of day. Any new event that falls outside this learned boundary is flagged as a potential anomaly, allowing for the detection of novel or evasive bootkit installation techniques."
    answer_sources:
      - "Sysmon Event ID 11"
      - "Sysmon Event ID 23"
      - "Sysmon Event ID 1"
      - "UEFI-based Endpoints"
      - "UEFI-based Servers"
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "FOREACH ESP_modification_event | EXTRACT features | SCORE with one-class_SVM_model | IF score='anomaly' THEN ALERT"
  - question: "Has any host communicated with network indicators (IPs, domains, TLS fingerprints) associated with known bootkit command and control (C2) infrastructure?"
    context: "This question seeks to identify active bootkit infections by looking for their C2 communications. By matching outbound network connection logs against threat intelligence feeds of known malicious IPs, domains, and JA3/JA3S hashes, we can detect with high confidence when an infected machine is 'calling home' for instructions or exfiltrating data."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Zeek ssl.log"
      - "Internet Gateway"
      - "DNS Resolvers"
      - "Network Traffic Taps"
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "SEARCH (Zeek conn.log, dns.log, ssl.log) | JOIN on (IP, domain, JA3) with bootkit_C2_intel_feed | WHERE match_found"
  - question: "Has any host been observed connecting to a statistically rare domain that has not been seen in the environment before?"
    context: "This question aims to find C2 domains that are not yet on threat intelligence feeds. Adversaries often use newly registered or obscure domains for C2. By identifying domains that are exceptionally rare (e.g., in the bottom 1% of popularity across the enterprise) and have no history, we can flag them as statistically suspicious and potentially related to a novel C2 channel."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Zeek ssl.log"
      - "Internet Gateway"
      - "DNS Resolvers"
      - "Network Traffic Taps"
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "FROM Zeek dns.log, CALCULATE domain_prevalence | IF prevalence < 1st_percentile AND domain_is_new THEN ALERT"
  - question: "Has a machine learning model detected anomalous network traffic patterns from any host that are characteristic of C2 beaconing?"
    context: "This question uses an LSTM autoencoder to learn the normal network behavior of each host. Bootkit C2 traffic often manifests as a regular, low-volume 'heartbeat' beacon. This pattern differs from normal user-driven traffic and will result in a high reconstruction error from the model, flagging the host's traffic as anomalous and indicative of a potential C2 channel."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Zeek ssl.log"
      - "Internet Gateway"
      - "DNS Resolvers"
      - "Network Traffic Taps"
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "INPUT host_connection_timeseries to LSTM_autoencoder | IF reconstruction_error IS HIGH THEN ALERT"
  - question: "Has `bcdedit.exe` been used with arguments that disable core OS security features like driver signature enforcement or integrity checks?"
    context: "This question looks for explicit commands used to weaken system defenses, a common prerequisite for loading an unsigned bootkit. Commands like `/set nointegritychecks Yes` or `/set testsigning on` are direct indicators of an attempt to bypass security controls to enable malicious code execution at boot time."
    answer_sources:
      - "Windows Event ID 4688"
      - "Sysmon Event ID 1"
      - "Domain Controllers"
      - "Administrator Workstations"
      - "Endpoint Devices"
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "SEARCH Sysmon Event ID 1 | WHERE process_name='bcdedit.exe' AND command_line contains ('nointegritychecks Yes' OR 'testsigning on')"
  - question: "Has `bcdedit.exe` been executed by a non-administrator user or by an administrator who shows a sudden increase in its usage?"
    context: "This question identifies anomalous usage of a powerful system utility. The execution of `bcdedit.exe` should be an extremely rare event, restricted to a few Tier 0 administrators. Any execution by a standard user is a major red flag. Similarly, a sudden spike in usage by a legitimate admin could indicate their account has been compromised and is being used to prepare for a bootkit installation."
    answer_sources:
      - "Windows Event ID 4688"
      - "Sysmon Event ID 1"
      - "Domain Controllers"
      - "Administrator Workstations"
      - "Endpoint Devices"
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "SEARCH Sysmon Event ID 1 WHERE process_name='bcdedit.exe' | IF user NOT IN tier_0_admins OR usage_frequency_spike THEN ALERT"
  - question: "Has a UEBA model flagged the execution of `bcdedit.exe` by any user as a significant deviation from their established behavioral baseline?"
    context: "This question uses a UEBA platform to contextualize command-line activity. The model builds a profile of normal behavior for each user. An execution of a sensitive utility like `bcdedit.exe` by a user who has never used it before—even if they have the privileges to do so—would be flagged as a severe behavioral anomaly, suggesting potential account misuse or a malicious actor."
    answer_sources:
      - "Windows Event ID 4688"
      - "Sysmon Event ID 1"
      - "Domain Controllers"
      - "Administrator Workstations"
      - "Endpoint Devices"
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "INGEST Sysmon Event ID 1 into UEBA | IF UEBA_model flags 'bcdedit.exe' as behavioral_anomaly THEN ALERT"
  - question: "Has a host made outbound network connections to non-approved services in the time window between system boot and the first interactive user logon?"
    context: "This question seeks to identify network activity from a bootkit before the OS is fully loaded and a user has logged on. By defining a narrow time window between the boot event and the first logon, and creating an allowlist of essential services (like DHCP, DNS, NTP), any other network traffic is highly suspicious and could be a bootkit establishing a C2 channel."
    answer_sources:
      - "Zeek conn.log"
      - "Windows System Log Event ID 6005"
      - "Windows Security Log Event ID 4624"
      - "Network Traffic Taps"
      - "Endpoint System Logs"
      - "Endpoint Security Logs"
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "FIND time_window between boot (EID 6005) and logon (EID 4624) | SEARCH Zeek conn.log in window | IF destination NOT IN allowlist THEN ALERT"
  - question: "Has the volume or pattern of network activity during the boot-to-logon window for a specific host deviated statistically from its historical baseline?"
    context: "This question establishes a normal network profile for each host during its boot sequence. By tracking metrics like bytes sent and unique destinations, we can detect statistical anomalies. A sudden increase in traffic volume or connections to new destinations during this pre-logon phase, compared to the host's own history, suggests a change in boot-time behavior that could be caused by a bootkit."
    answer_sources:
      - "Zeek conn.log"
      - "Windows System Log Event ID 6005"
      - "Windows Security Log Event ID 4624"
      - "Network Traffic Taps"
      - "Endpoint System Logs"
      - "Endpoint Security Logs"
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "PROFILE network metrics in boot_to_logon window per host | IF current_metrics > 3*stdev from baseline THEN ALERT"
  - question: "Has a machine learning model identified any network connections during the boot-to-logon window as outliers compared to the typical boot-time activity of all hosts?"
    context: "This question uses a clustering algorithm (like DBSCAN) to find unusual boot-time connections across the entire enterprise. Legitimate boot-time traffic (e.g., all hosts contacting a domain controller) will form dense clusters. A connection from one or two hosts to a unique destination will not belong to any cluster and will be flagged as a noise point or outlier, indicating a rare and suspicious communication channel."
    answer_sources:
      - "Zeek conn.log"
      - "Windows System Log Event ID 6005"
      - "Windows Security Log Event ID 4624"
      - "Network Traffic Taps"
      - "Endpoint System Logs"
      - "Endpoint Security Logs"
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "CLUSTER all boot_to_logon connections using DBSCAN | IF connection is 'noise_point' (outlier) THEN ALERT"
  - question: "Are there network connections observed at the network layer (e.g., Zeek) that cannot be attributed to a specific process on the host (e.g., Sysmon)?"
    context: "This question is designed to hunt for 'ghost' network connections, a classic sign of a rootkit. A rootkit can initiate network traffic from the kernel level, bypassing user-space APIs that tools like Sysmon monitor. By comparing network-level logs with host-level logs, any connection seen on the wire but not associated with a running process on the endpoint is a strong indicator of a rootkit's presence."
    answer_sources:
      - "Sysmon Event ID 3"
      - "Zeek conn.log"
      - "Suspect Endpoint Devices"
      - "Network Egress Points"
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "LEFT JOIN Zeek conn.log with Sysmon Event ID 3 on connection_tuple | WHERE Sysmon_match is NULL | ALERT"
  - question: "Does any host exhibit a statistically anomalous 'discrepancy score' representing a high ratio of unattributed network connections to total connections?"
    context: "This question operationalizes the hunt for 'ghost' connections. By periodically calculating the number of connections that are unattributed to a host process, we can create a score for each host. For healthy systems, this score should be zero or very close to it. A host with a score that is a statistical outlier compared to its peers is highly suspect and may be infected with a rootkit."
    answer_sources:
      - "Sysmon Event ID 3"
      - "Zeek conn.log"
      - "Suspect Endpoint Devices"
      - "Network Egress Points"
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "CALCULATE discrepancy_score = unattributed_connections / total_connections per host | IF score is statistical_outlier THEN ALERT"
  - question: "Has a machine learning model flagged any host as anomalous based on a discrepancy between its network-level and host-level connection telemetry?"
    context: "This question uses an anomaly detection model to learn the profile of a 'healthy' host where network and host telemetry are in sync. The model takes features like total connections from Zeek, total connections from Sysmon, and the difference between them. A live host whose feature vector deviates from this healthy profile will be flagged, indicating a potential telemetry mismatch caused by a rootkit."
    answer_sources:
      - "Sysmon Event ID 3"
      - "Zeek conn.log"
      - "Suspect Endpoint Devices"
      - "Network Egress Points"
    range: "last 90 days"
    queries:
      - technology: "Pseudocode"
        query: "EXTRACT features (zeek_count, sysmon_count, unattributed_count) per host | SCORE with one-class_SVM_model | IF score='anomaly' THEN ALERT"