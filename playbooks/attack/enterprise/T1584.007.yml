name: T1584.007: Serverless
id: f8a5e5a0-41f8-4b2e-8e8f-9a0b1c2d3e4f
description: This playbook helps investigate whether an adversary is leveraging compromised or purpose-built serverless infrastructure for command and control (C2) or data exfiltration. It focuses on identifying suspicious network traffic patterns, such as connections to known malicious serverless domains, requests containing C2 framework signatures, and beaconing behavior. It also correlates network activity with endpoint data to identify anomalous processes making these connections and subsequent internal reconnaissance or lateral movement activities.
type: technique
related:
  - TA0042: Resource Development
contributors:
  - Zachary Szewczyk
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Are internal hosts communicating with known malicious serverless domains or URLs based on threat intelligence?
    context: This question seeks to identify direct communication with known-bad infrastructure. By matching DNS queries and HTTP requests against a curated list of malicious serverless domains and URLs, analysts can quickly find compromised hosts that are part of a C2 channel or involved in data exfiltration using serverless platforms. A positive match is a high-fidelity indicator of malicious activity.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Zeek http.log
      - Internet egress points (e.g., firewalls, web proxies)
      - Enterprise DNS resolvers
      - SIEM or log aggregation platform
    range: last 90 days
    queries:
      - pseudocode: JOIN (dns_logs.query, http_logs.host) WITH threat_intel_feed.serverless_domains ON domain. RETURN matches
  - question: Are any internal hosts showing an unusually high frequency of requests to serverless domains?
    context: Adversaries may use serverless functions for frequent C2 check-ins or large-scale data exfiltration, resulting in a high volume of requests. This question aims to identify outlier hosts by analyzing the frequency of their communications with domains matching common serverless patterns. Hosts with activity in the top percentile may indicate automated malicious behavior rather than legitimate, user-driven traffic.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Zeek http.log
      - Internet egress points (e.g., firewalls, web proxies)
      - Enterprise DNS resolvers
      - SIEM or log aggregation platform
    range: last 90 days
    queries:
      - pseudocode: FROM network_logs WHERE domain MATCHES serverless_patterns | GROUP BY source_ip, time_window='24h' | COUNT requests | IDENTIFY outliers > 99th_percentile
  - question: Are any queried serverless domains likely to be algorithmically generated (DGA) for C2 purposes?
    context: To evade blocklists, adversaries often use Domain Generation Algorithms (DGAs) to create a large number of C2 domains. This question uses a machine learning model to analyze the linguistic and structural properties of serverless subdomains to detect those that appear random or algorithmically generated, which are hallmarks of DGA. This helps find new and unknown C2 infrastructure.
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Zeek http.log
      - Internet egress points (e.g., firewalls, web proxies)
      - Enterprise DNS resolvers
      - SIEM or log aggregation platform
    range: last 90 days
    queries:
      - pseudocode: FOR domain in dns_logs WHERE domain MATCHES serverless_patterns | APPLY dga_detection_model(domain) | RETURN domains with high_dga_score
  - question: Do any outbound HTTP/S requests to serverless domains contain URI patterns, User-Agents, or TLS fingerprints associated with known C2 frameworks?
    context: Many post-exploitation frameworks (e.g., Sliver, Covenant) have unique signatures in their HTTP/S traffic, even when routed through serverless redirectors. This question applies regular expressions to URIs and User-Agent strings and matches TLS/SSL fingerprints (JA3/JA3S) against known-bad lists to identify specific C2 toolkits in use, providing valuable context about the adversary's tools.
    answer_sources:
      - Zeek http.log
      - Zeek ssl.log
      - Internet egress points (e.g., firewalls, web proxies)
      - TLS/SSL inspection points
    range: last 90 days
    queries:
      - pseudocode: FROM http_logs, ssl_logs WHERE destination_domain MATCHES serverless_patterns | APPLY regex_rules ON (uri, user_agent) OR MATCH ja3_hash WITH known_bad_list | RETURN matches
  - question: Are there any HTTP/S requests to serverless domains with unusually high entropy in the URI, suggesting encoded C2 data?
    context: Adversaries often encode or encrypt C2 data within URI paths or query parameters to obfuscate it. This results in high-entropy (random-looking) strings. This question establishes a baseline for normal URI entropy for serverless traffic and flags significant deviations. High entropy is a strong indicator of non-human, malicious communication attempting to hide its content.
    answer_sources:
      - Zeek http.log
      - Zeek ssl.log
      - Internet egress points (e.g., firewalls, web proxies)
      - TLS/SSL inspection points
    range: last 90 days
    queries:
      - pseudocode: FROM http_logs WHERE destination_domain MATCHES serverless_patterns | CALCULATE shannon_entropy(uri) | IDENTIFY requests where entropy > (baseline_mean + 3*std_dev)
  - question: Can we classify HTTP requests to serverless domains as malicious or benign using a machine learning model?
    context: This question leverages a machine learning classifier to perform a holistic assessment of HTTP requests. By training a model on various features like URI length, parameter counts, and keyword presence, it can learn the subtle characteristics that distinguish malicious C2 traffic from legitimate API calls. This provides a more robust and adaptable detection method than static rules alone.
    answer_sources:
      - Zeek http.log
      - Zeek ssl.log
      - Internet egress points (e.g., firewalls, web proxies)
      - TLS/SSL inspection points
    range: last 90 days
    queries:
      - pseudocode: FOR request in http_logs WHERE destination_domain MATCHES serverless_patterns | APPLY http_classifier_model(request_features) | RETURN requests with high_malicious_score
  - question: Are any hosts making a high number of connections with consistently small payload sizes to a single serverless domain?
    context: This question aims to detect simple beaconing behavior. Malicious implants often send frequent, small 'heartbeat' signals to their C2 server. A rule that flags a high connection count paired with a consistent, small payload size can effectively identify this type of automated C2 communication, which is distinct from typical user browsing or API usage.
    answer_sources:
      - Zeek conn.log
      - Internet egress points (e.g., firewalls, web proxies)
      - Network tap or SPAN port monitoring Zeek sensors
    range: last 90 days
    queries:
      - pseudocode: FROM conn_logs WHERE destination_domain MATCHES serverless_patterns | GROUP BY source_ip, dest_ip, time_window='1h' | IF COUNT(connections) > 100 AND AVG(payload_size) BETWEEN 50 AND 250 | ALERT
  - question: Is there evidence of periodic, low-jitter beaconing from an internal host to a serverless domain?
    context: Sophisticated malware often uses precisely timed C2 check-ins to appear like legitimate traffic. This question analyzes the time intervals (jitter) between connections from a single host to a serverless destination. A very low standard deviation in these intervals points to automated, robotic beaconing characteristic of malware, as human-generated traffic is typically random and irregular.
    answer_sources:
      - Zeek conn.log
      - Internet egress points (e.g., firewalls, web proxies)
      - Network tap or SPAN port monitoring Zeek sensors
    range: last 90 days
    queries:
      - pseudocode: FROM conn_logs WHERE destination_domain MATCHES serverless_patterns | GROUP BY source_ip, dest_ip | CALCULATE std_dev(inter_arrival_time) AND coefficient_of_variation(payload_size) | RETURN pairs with low_jitter AND low_payload_variance
  - question: Can we identify periodic C2 beaconing signals hidden in network traffic to serverless domains using time-series analysis?
    context: This question applies advanced signal processing techniques, like Fast Fourier Transform (FFT), to connection timestamps. This method can uncover periodic beaconing even when the interval is long or obscured by other network noise. By transforming time-based data into the frequency domain, a strong, repeating signal (the beacon) will appear as a distinct peak, revealing the malware's C2 cadence.
    answer_sources:
      - Zeek conn.log
      - Internet egress points (e.g., firewalls, web proxies)
      - Network tap or SPAN port monitoring Zeek sensors
    range: last 90 days
    queries:
      - pseudocode: FOR each source-dest_pair in conn_logs | APPLY FFT to connection_timestamps | IDENTIFY pairs with strong peak in frequency_domain | CLUSTER results to find anomalous groups
  - question: Is an unapproved or suspicious process responsible for network connections to serverless domains?
    context: This question correlates network events with host-based process creation logs to attribute suspicious network traffic to its source process. By linking a connection to a serverless domain with a process that is not on an allowlist (e.g., not a web browser) or that was launched with a suspicious command line (e.g., encoded PowerShell), analysts can pinpoint the specific malicious executable or script responsible for the C2 communication.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 5156
      - Zeek conn.log
      - Critical servers (e.g., Domain Controllers, database servers)
      - User endpoint devices
      - SIEM or log aggregation platform
    range: last 90 days
    queries:
      - pseudocode: JOIN (win_evt_5156, win_evt_4688) ON process_id | WHERE dest_ip MATCHES serverless_domain_ips AND (process_name NOT IN allowlist OR command_line MATCHES suspicious_patterns) | ALERT
  - question: Are there any rare or anomalous parent-child process relationships associated with connections to serverless domains?
    context: Malware often executes through unusual process chains, such as Microsoft Word spawning PowerShell. This question establishes a baseline of normal process lineages and execution paths and then flags any rare or first-seen combinations that are also observed making connections to serverless domains. This behavioral approach is effective at detecting fileless malware and living-off-the-land techniques.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 5156
      - Zeek conn.log
      - Critical servers (e.g., Domain Controllers, database servers)
      - User endpoint devices
      - SIEM or log aggregation platform
    range: last 90 days
    queries:
      - pseudocode: FROM process_logs JOIN network_logs | CREATE (parent_process, child_process, execution_path) tuples | CALCULATE frequency of each tuple | FLAG rare tuples where network_dest MATCHES serverless_patterns
  - question: Can a machine learning model identify anomalous process behaviors that are correlated with connections to serverless domains?
    context: This question employs an unsupervised anomaly detection model (like Isolation Forest) to identify suspicious processes without relying on predefined rules or signatures. The model learns the characteristics of normal process activity and then scores new events based on features like command-line entropy and parent process. Events that are flagged as highly anomalous and are also tied to serverless communication are strong candidates for investigation.
    answer_sources:
      - Windows Event ID 4688
      - Windows Event ID 5156
      - Zeek conn.log
      - Critical servers (e.g., Domain Controllers, database servers)
      - User endpoint devices
      - SIEM or log aggregation platform
    range: last 90 days
    queries:
      - pseudocode: ENRICH process_logs with features (entropy, length, etc.) and serverless_conn_flag | TRAIN isolation_forest_model on baseline_data | APPLY model to new_process_events | RETURN events with high_anomaly_score AND serverless_conn_flag=true
  - question: Does a connection to a serverless domain precede internal reconnaissance or lateral movement attempts from the same host?
    context: A common adversary pattern is to establish C2 communication and then immediately begin internal discovery or lateral movement. This question creates a sequence rule that looks for this specific chain of events a connection to a serverless C2 channel followed shortly by activities like running `net group` commands or attempting to log into other systems. This connects the C2 activity directly to its malicious purpose.
    answer_sources:
      - Zeek conn.log
      - Zeek http.log
      - Windows Event ID 4624
      - Windows Event ID 4688
      - Windows Event ID 4663
      - SIEM or log aggregation platform
      - Domain Controllers (for auth logs)
      - File servers (for access logs)
      - User endpoint devices
    range: last 90 days
    queries:
      - pseudocode: DEFINE sequence_rule: (EVENT A: connection to serverless_domain) FOLLOWED BY (EVENT B: internal_recon_command OR EVENT C: failed_lateral_logon) within 10_minutes from same_host | ALERT on match
  - question: Is there a statistically significant spike in internal reconnaissance or failed authentications from a host shortly after it communicates with a serverless domain?
    context: Rather than looking for a single event, this question analyzes the rate of suspicious behaviors. It establishes a normal baseline for activities like port scanning and failed logons for each host. If a host contacts a serverless domain and then exhibits a sharp, statistically significant increase in these activities, it strongly suggests that the host received commands from the C2 server to begin exploring the internal network.
    answer_sources:
      - Zeek conn.log
      - Zeek http.log
      - Windows Event ID 4624
      - Windows Event ID 4688
      - Windows Event ID 4663
      - SIEM or log aggregation platform
      - Domain Controllers (for auth logs)
      - File servers (for access logs)
      - User endpoint devices
    range: last 90 days
    queries:
      - pseudocode: FOR each host | IF connection to serverless_domain | THEN monitor(internal_recon_rate, failed_auth_rate) for 1_hour | IF rate > 95th_percentile_baseline | ALERT
  - question: Does the sequence of activities observed on a host match a known malicious attack chain involving serverless C2?
    context: This question treats an attack as a 'grammar' or sequence of TTPs. It uses a sequence analysis model, trained on known attack patterns, to evaluate the stream of events from a host. The model calculates the probability that the observed sequence (e.g., serverless connection -> PowerShell execution -> lateral movement attempt) matches a learned malicious 'story,' allowing for the detection of complex, multi-stage attacks.
    answer_sources:
      - Zeek conn.log
      - Zeek http.log
      - Windows Event ID 4624
      - Windows Event ID 4688
      - Windows Event ID 4663
      - SIEM or log aggregation platform
      - Domain Controllers (for auth logs)
      - File servers (for access logs)
      - User endpoint devices
    range: last 90 days
    queries:
      - pseudocode: FROM event_stream for host | APPLY sequence_analysis_model(events) | RETURN probability_of_match with known_attack_chains