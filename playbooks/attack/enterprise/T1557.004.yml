name: T1557.004: Evil Twin
id: 8b1f2c3d-4e5f-4a6b-8c9d-0e1f2a3b4c5d
description: This playbook helps identify Evil Twin attacks, where an adversary sets up a rogue Wi-Fi access point spoofing a legitimate network to intercept traffic, steal credentials, or pivot into a network. The investigation focuses on detecting adversary attempts to gain credentials and collect data by analyzing Wi-Fi connection logs, network traffic, and DNS records. Key indicators include connections to unauthorized or suspicious BSSIDs, interaction with malicious captive portals identified by known artifacts or behavioral anomalies, DNS responses for corporate domains resolving to private IPs, signs of Man-in-the-Middle (MitM) interception through weak TLS configurations, and subsequent data exfiltration or C2 activity following a connection to a suspicious network.
type: technique
related:
- TA0006: Credential Access
- TA0009: Collection
contributors:
- Zachary Szewczyk
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
- question: Is a device connecting to a Wi-Fi network whose BSSID or captive portal SSL certificate is on a known threat intelligence blocklist?
  context: This is a high-fidelity detection method. A match against a threat intelligence feed of known malicious BSSIDs or SSL certificate thumbprints provides a strong signal that a device has connected to an access point confirmed to be part of a malicious campaign, indicating an immediate threat.
  answer_sources:
  - Zeek wifi.log
  - Zeek ssl.log
  - Windows Event ID 8001
  - Corporate endpoints with wireless capabilities
  - Wireless access point controllers
  - Network sensors monitoring egress traffic
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      SEARCH wifi_logs OR ssl_logs
      JOIN with threat_intel_list ON (bssid OR ssl_thumbprint)
      IF match_found, ALERT
- question: Has a device connected to a BSSID that, while broadcasting a corporate SSID, is statistically rare or anomalous?
  context: Adversaries often use transient, short-lived access points that spoof corporate SSIDs. By establishing a historical baseline of BSSID frequency for each corporate SSID, we can detect these outliers. A BSSID observed very infrequently is suspicious and warrants investigation as a potential Evil Twin AP.
  answer_sources:
  - Zeek wifi.log
  - Windows Event ID 8001
  - Corporate endpoints with wireless capabilities
  - Wireless access point controllers
  - Network sensors monitoring egress traffic
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      SEARCH wifi_logs
      FOR each corporate_ssid, CALCULATE frequency of all associated bssids
      IF a bssid_frequency < threshold (e.g., 0.1%), ALERT
- question: Does a new Wi-Fi connection exhibit characteristics matching a machine learning model trained to identify malicious access points?
  context: This predictive approach scores new connections based on multiple features (e.g., BSSID vendor, channel, signal strength, connection duration). It can detect novel or sophisticated Evil Twin attacks that might evade simpler signature-based checks by learning the subtle, combined patterns of malicious connections.
  answer_sources:
  - Zeek wifi.log
  - Zeek ssl.log
  - Windows Event ID 8001
  - Corporate endpoints with wireless capabilities
  - Wireless access point controllers
  - Network sensors monitoring egress traffic
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR each new_wifi_connection
      EXTRACT features (bssid_vendor, channel, signal, duration)
      SCORE with trained classification model
      IF score > malicious_threshold, ALERT
- question: Is a device interacting with a captive portal that contains known artifacts (e.g., headers, HTML content) of an Evil Twin framework like WiFi Pineapple or Evilginx?
  context: Common Evil Twin toolkits often leave specific signatures in their captive portal pages, such as unique server headers or recurring JavaScript filenames. Searching network traffic for these known bad strings is an effective way to identify the use of off-the-shelf attack tools.
  answer_sources:
  - Zeek http.log
  - Zeek wifi.log
  - Zeek files.log
  - Network traffic sensors at egress points
  - Endpoint EDR agents with network visibility
  - DNS resolvers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      SEARCH http_logs or file_logs (HTML/JS)
      APPLY regex for known Evil Twin artifacts (e.g., 'Server: WiFi-Pineapple')
      IF match, ALERT
- question: Does the URI of a captive portal page exhibit unusually high entropy, suggesting automated or randomized path generation by an attack tool?
  context: Legitimate captive portals typically have simple, predictable URIs. Automated attack tools may generate long, randomized URI paths or parameters to evade signature-based blocking. Calculating the entropy (randomness) of these URIs and flagging high-entropy outliers can help detect the programmatic nature of an attack framework.
  answer_sources:
  - Zeek http.log
  - Zeek wifi.log
  - Zeek files.log
  - Network traffic sensors at egress points
  - Endpoint EDR agents with network visibility
  - DNS resolvers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      SEARCH http_logs for captive_portals
      CALCULATE Shannon entropy of URI path and query parameters
      IF entropy > baseline_95th_percentile, ALERT
- question: Does the text content of a captive portal login page fall into a suspicious or outlier topic cluster, as determined by an NLP model?
  context: This behavioral approach analyzes the actual text on login pages. By using topic modeling to cluster pages, we can identify those with unusual or suspicious language (e.g., poorly worded credential harvesting attempts) that deviate from legitimate corporate login portals, even if they lack known bad signatures.
  answer_sources:
  - Zeek http.log
  - Zeek wifi.log
  - Zeek files.log
  - Network traffic sensors at egress points
  - Endpoint EDR agents with network visibility
  - DNS resolvers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR each captive_portal_page_content
      APPLY LDA topic model
      IF page topic is an outlier or known_suspicious_topic, ALERT
- question: Has a device connected to a BSSID that is broadcasting a corporate SSID but is not on the authorized list of approved access points?
  context: This is a fundamental check for rogue access points. By maintaining a strict, authoritative inventory of all legitimate BSSIDs for each corporate SSID, any connection to a BSSID not on that list is immediately suspicious and a strong indicator of an Evil Twin.
  answer_sources:
  - Zeek wifi.log
  - Windows Event ID 8001
  - Wireless LAN Controller Logs
  - Enterprise asset management database
  - Endpoint wireless logs
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      SEARCH wifi_connection_logs
      IF ssid IS corporate AND bssid IS NOT IN authorized_bssid_inventory, ALERT
- question: Has a new, un-baselined BSSID-SSID pair appeared at a physical location and attracted multiple corporate devices?
  context: This method detects new rogue APs by location. A single device connecting to a new AP might be a misconfiguration, but multiple devices connecting to a new BSSID spoofing a corporate SSID at a specific site strongly suggests a targeted Evil Twin attack is underway at that location.
  answer_sources:
  - Zeek wifi.log
  - Windows Event ID 8001
  - Wireless LAN Controller Logs
  - Enterprise asset management database
  - Endpoint wireless logs
  - Physical security access logs for location correlation
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      BASELINE known (bssid, ssid) pairs per location
      MONITOR wifi_logs for new pairs
      IF new_pair appears AND unique_device_count > 1, ALERT
- question: Does connection data reveal a small, dense cluster of devices connecting to a previously unseen BSSID that is spoofing a corporate SSID?
  context: Clustering algorithms can automatically find anomalous groups in data. An Evil Twin AP will create a distinct cluster: multiple victim devices (a dense group) connecting to a new, shared BSSID. This approach can find these small, dense anomaly clusters that signify a localized attack.
  answer_sources:
  - Zeek wifi.log
  - Windows Event ID 8001
  - Wireless LAN Controller Logs
  - Enterprise asset management database
  - Endpoint wireless logs
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      RUN clustering algorithm (e.g., DBSCAN) on connection_data (features: bssid, ssid, client_mac)
      IF small, dense cluster with spoofed corporate SSID is found, ALERT
- question: Has a device received a DNS response for a known corporate domain that resolves to a private (RFC1918) IP address shortly after connecting to a new Wi-Fi network?
  context: This is a strong indicator of DNS hijacking, a core component of many Evil Twin attacks. The adversary's rogue AP provides a malicious DNS response to redirect the user to a fake login page hosted on the local network instead of the legitimate internet-facing site.
  answer_sources:
  - Zeek dns.log
  - Zeek conn.log
  - Zeek wifi.log
  - Centralized DNS servers
  - Network sensors capturing DNS traffic
  - Endpoint DNS client logs
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      TRIGGER on new BSSID connection
      MONITOR dns_logs for 5 minutes
      IF dns_query for corporate_domain resolves to RFC1918_address, ALERT
- question: After connecting to a new network, did a device receive a DNS response for a frequently accessed domain that resolves to an IP address not in its historical baseline?
  context: Devices typically resolve a given domain to a predictable set of IP addresses. By baselining these responses, we can detect anomalies. A DNS response providing a novel IP address after connecting to a new network suggests DNS manipulation by a malicious actor.
  answer_sources:
  - Zeek dns.log
  - Zeek conn.log
  - Zeek wifi.log
  - Centralized DNS servers
  - Network sensors capturing DNS traffic
  - Endpoint DNS client logs
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR each device, BASELINE typical DNS responses for top_50_domains
      AFTER new network connection, MONITOR dns_logs
      IF response_ip IS NOT IN baseline for that domain, ALERT
- question: Was there a sudden spike in the rate of DNS responses resolving to private IPs for a host immediately following a new Wi-Fi connection?
  context: A time-series anomaly detection model can identify sudden changes in behavior. A sharp, unexpected increase in the rate of DNS queries resolving to private IP addresses, correlated with a new Wi-Fi connection, is a strong statistical indicator of DNS-based redirection by an Evil Twin.
  answer_sources:
  - Zeek dns.log
  - Zeek conn.log
  - Zeek wifi.log
  - Centralized DNS servers
  - Network sensors capturing DNS traffic
  - Endpoint DNS client logs
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      MODEL time-series of private_IP_DNS_responses per host
      IF rate significantly deviates from forecast after new Wi-Fi connection, ALERT
- question: Did a device interact with a login portal that used a self-signed or invalid SSL certificate?
  context: Legitimate login portals for major services use valid, trusted SSL certificates. An adversary's captive portal may use a self-signed, expired, or mismatched certificate. Detecting these validation errors is a key way to identify a fraudulent site designed to intercept credentials.
  answer_sources:
  - Zeek http.log
  - Zeek ssl.log
  - Zeek wifi.log
  - Zeek x509.log
  - Network egress points
  - Endpoint browsers (via EDR)
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      SEARCH ssl_logs where (validation_status is 'self-signed' or 'wrong_host')
      CORRELATE with http_logs where URI contains 'login'
      CORRELATE with recent non-corporate wifi_log connection
      IF all conditions met, ALERT
- question: Has the ratio of HTTP to HTTPS login pages encountered by a device or the entire fleet suddenly increased?
  context: Adversaries may perform SSL stripping attacks to downgrade a connection from HTTPS to unencrypted HTTP, making it easier to capture credentials. A sudden, statistically significant increase in the proportion of login pages served over HTTP is a strong indicator of this type of MitM attack.
  answer_sources:
  - Zeek http.log
  - Zeek ssl.log
  - Zeek wifi.log
  - Zeek x509.log
  - Network egress points
  - Endpoint browsers (via EDR)
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      TRACK daily ratio of (HTTP login pages / HTTPS login pages)
      IF ratio increases > 3 standard deviations from 30-day mean, ALERT
- question: Does a captive portal exhibit a combination of features (e.g., served over HTTP, new BSSID) that a machine learning model predicts as malicious?
  context: A decision tree or similar classifier can be trained to recognize malicious captive portals based on a combination of high-risk attributes. This approach automates the correlation of multiple weak signals (e.g., unencrypted protocol, new BSSID, presence of 'login' keyword) into a single high-confidence alert.
  answer_sources:
  - Zeek http.log
  - Zeek ssl.log
  - Zeek wifi.log
  - Zeek x509.log
  - Network egress points
  - Endpoint browsers (via EDR)
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR each captive portal, EXTRACT features (is_http, ssl_status, uri_keywords, is_new_bssid)
      SCORE with trained decision tree model
      IF prediction is 'malicious' with high confidence, ALERT
- question: After connecting to a suspicious Wi-Fi network, did a device connect to an IP or domain on a C2 or data exfiltration threat intelligence list?
  context: Once credentials are stolen or malware is delivered via an Evil Twin, the compromised device will often connect to a command-and-control (C2) server. Correlating outbound connections from a device on a suspicious network with a high-confidence list of C2 indicators provides a direct link to post-exploitation activity.
  answer_sources:
  - Zeek conn.log
  - Zeek dns.log
  - Zeek wifi.log
  - Network security gateways
  - DNS servers
  - Integrated threat intelligence platforms
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      TRIGGER on connection to suspicious BSSID
      MONITOR subsequent outbound conn_logs and dns_logs
      JOIN with C2_threat_intel_list ON (destination_ip or domain)
      IF match, ALERT
- question: Did a device on a suspicious network make a TLS connection using an extremely rare JA3 hash?
  context: A JA3 hash is a fingerprint of a TLS client's configuration. Standard browsers and operating systems have common JA3 hashes. Custom malware used for C2 often has a unique JA3 hash. An extremely rare or unique JA3 hash from a device on a suspicious network is a high-fidelity indicator of a non-standard client, likely malware.
  answer_sources:
  - Zeek conn.log
  - Zeek dns.log
  - Zeek wifi.log
  - Network security gateways
  - DNS servers
  - Integrated threat intelligence platforms
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR device on suspicious network
      CALCULATE enterprise-wide rarity of its TLS JA3 hash
      IF JA3 hash is seen only once (or very rarely), ALERT
- question: Did a device, after joining a suspicious network, connect to a destination IP that is an outlier with few or no other connections from the enterprise?
  context: Legitimate web services are contacted by many devices across an enterprise. C2 servers are often dedicated to a small number of victims. Using a graph model, if a device on a suspicious network connects to a destination 'island' with very few other inbound connections, it is a strong anomaly indicative of a C2 channel.
  answer_sources:
  - Zeek conn.log
  - Zeek dns.log
  - Zeek wifi.log
  - Network security gateways
  - DNS servers
  - Integrated threat intelligence platforms
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      MODEL connections as a graph (nodes = devices, IPs)
      IF device on suspicious network connects to an outlier IP node, ALERT
- question: Is a device on a suspicious network generating HTTP or DNS traffic that matches patterns of known exfiltration tools?
  context: Data exfiltration tools often use specific URI patterns, User-Agent strings (e.g., for Cobalt Strike), or domain patterns (for DNS tunneling). Scanning traffic from a potentially compromised device for these signatures can directly detect the data collection phase of an attack.
  answer_sources:
  - Zeek dns.log
  - Zeek http.log
  - Zeek conn.log
  - DNS servers
  - Network traffic sensors at egress points
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR device on suspicious network
      SCAN http_logs and dns_logs with regex for known exfil tool patterns
      IF match, ALERT
- question: Is a device on a suspicious network exhibiting high-entropy DNS queries or sending unusually large HTTP POST requests?
  context: These are two common methods for data exfiltration. High-entropy subdomains in DNS queries are a hallmark of DNS tunneling, where data is encoded into subdomains. An HTTP POST request that is significantly larger than the user's historical baseline can indicate bulk data (e.g., a stolen file archive) being uploaded.
  answer_sources:
  - Zeek dns.log
  - Zeek http.log
  - Zeek conn.log
  - DNS servers
  - Network traffic sensors at egress points
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR device on suspicious network
      CALCULATE Shannon entropy of DNS query subdomains; IF > 4.0, ALERT
      CHECK HTTP POST body size; IF > 99th percentile of user's baseline, ALERT
- question: Has the length or frequency of a device's DNS queries significantly deviated from a forecasted baseline after connecting to a suspicious network?
  context: Time-series forecasting can model a device's normal DNS behavior. DNS tunneling for data exfiltration often involves sending an abnormally high frequency of queries or using unusually long query names. A significant deviation from the forecasted behavior after connecting to a suspicious network is a strong indicator of this activity.
  answer_sources:
  - Zeek dns.log
  - Zeek http.log
  - Zeek conn.log
  - DNS servers
  - Network traffic sensors at egress points
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      MODEL time-series of DNS query length and frequency per host
      IF observed values significantly deviate from forecast after suspicious connection, ALERT
- question: Is a device on a suspicious network transferring files with sensitive MIME types to a non-corporate IP address?
  context: This is a direct check for the exfiltration of sensitive data. A rule that alerts when file transfers containing specific MIME types (e.g., 'application/zip', 'application/x-7z-compressed') or file extensions ('.pst', '.kdbx') are sent to an external destination from a device on a suspicious network can catch data theft in progress.
  answer_sources:
  - Zeek conn.log
  - Zeek files.log
  - Zeek wifi.log
  - Network egress points
  - Data Loss Prevention (DLP) systems
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FOR device on suspicious network
      MONITOR file_logs for outbound transfers
      IF file_mime_type is sensitive AND destination is non-corporate, ALERT
- question: Has a device's outbound data volume significantly exceeded its historical baseline after connecting to a suspicious network?
  context: Every user and device has a typical pattern of data usage. A sudden, dramatic increase in the volume of outbound data, measured in bytes, is a classic indicator of data exfiltration. Comparing a short-term spike against a long-term historical average for that user can effectively detect this anomaly.
  answer_sources:
  - Zeek conn.log
  - Zeek files.log
  - Zeek wifi.log
  - Network egress points
  - Data Loss Prevention (DLP) systems
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      BASELINE daily outbound data volume per user/device
      AFTER suspicious network connection, monitor outbound bytes
      IF 1-hour volume > 3 standard deviations above daily average, ALERT
- question: Does a data transfer from a device on a suspicious network fall outside the boundary of its normal behavior as learned by a one-class SVM model?
  context: A one-class SVM can learn a complex boundary around a device's normal data transfer behavior, considering multiple features like protocol, port, data volume, and time of day. Any transfer that falls outside this learned 'normal' boundary is flagged as an anomaly, providing a sophisticated way to detect unusual exfiltration activity.
  answer_sources:
  - Zeek conn.log
  - Zeek files.log
  - Zeek wifi.log
  - Network egress points
  - Data Loss Prevention (DLP) systems
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      TRAIN one-class SVM on normal transfer behavior per device (features: bytes, protocol, port, time)
      IF transfer from suspicious network is flagged as outlier by model, ALERT
- question: Is a device on a suspicious network using weak TLS versions (e.g., TLS 1.0, SSLv3) or communicating with a server whose certificate is not from a trusted CA?
  context: This is an indicator of a Man-in-the-Middle (MitM) proxy decrypting traffic. Adversaries may force a downgrade to a weak protocol or present their own untrusted certificate to intercept the connection. Alerting on the use of deprecated protocols or untrusted issuers for high-value domains is critical.
  answer_sources:
  - Zeek ssl.log
  - Zeek x509.log
  - Zeek wifi.log
  - Network traffic sensors
  - Enterprise PKI and trusted CA lists
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      SEARCH ssl_logs from suspicious network
      IF (tls_version is 'TLSv1.0' or 'SSLv3') OR (certificate_issuer is not in trusted_CA_list), ALERT
- question: After connecting to a suspicious network, did a device use a statistically rare TLS cipher or version when connecting to a common domain?
  context: For any given popular domain (e.g., office.com), the vast majority of legitimate clients will negotiate a small, predictable set of modern TLS versions and cipher suites. A connection from a device on a suspicious network that uses a rare or unusual cipher/version for that specific destination is a strong sign of a MitM proxy altering the connection parameters.
  answer_sources:
  - Zeek ssl.log
  - Zeek x509.log
  - Zeek wifi.log
  - Network traffic sensors
  - Enterprise PKI and trusted CA lists
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      BASELINE common (cipher, version) pairs for top 100 domains
      FOR connection from suspicious network
      IF (cipher, version) pair is rare (<1% frequency) for that domain, ALERT
- question: Does a TLS session from a device on a suspicious network fall into a small, isolated cluster based on its technical features?
  context: Clustering can group TLS sessions by features like cipher suite, TLS version, certificate issuer, and JA3 hash. Normal, legitimate connections will form large clusters. A session from a device on a suspicious network that falls into a small, distinct cluster indicates it has a unique combination of attributes, likely due to a MitM proxy.
  answer_sources:
  - Zeek ssl.log
  - Zeek x509.log
  - Zeek wifi.log
  - Network traffic sensors
  - Enterprise PKI and trusted CA lists
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      CLUSTER TLS sessions using features (cipher, version, issuer, ja3)
      IF session from suspicious network falls into a small, outlier cluster, ALERT
- question: Is a device that recently joined a suspicious Wi-Fi network generating alerts for network or port scanning?
  context: After gaining a foothold on a device via an Evil Twin, an adversary may scan the local network to find other targets. Correlating network scan alerts (e.g., from Zeek or an EDR) with a recent connection to a suspicious Wi-Fi network helps identify the initial point of entry for a broader network intrusion.
  answer_sources:
  - Zeek conn.log
  - Zeek notice.log
  - Windows Event ID 5156
  - Network taps or SPAN ports
  - Endpoint firewalls and EDR logs
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      SEARCH for 'Scan::Address_Scan' or 'Scan::Port_Scan' notices
      CORRELATE source_ip with devices that recently connected to a suspicious BSSID
      IF match, ALERT
- question: Is a device on a suspicious network attempting to connect to an abnormally high number of distinct local IP addresses in a short time?
  context: Legitimate devices typically communicate with a small, stable set of local resources (like printers or file shares). A device that suddenly attempts to connect to tens or hundreds of different IP addresses within its local subnet is almost certainly performing a network scan to map the local environment for lateral movement.
  answer_sources:
  - Zeek conn.log
  - Zeek notice.log
  - Windows Event ID 5156
  - Network taps or SPAN ports
  - Endpoint firewalls and EDR logs
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      IN a 1-minute window, COUNT distinct destination IPs in same subnet for each source device
      IF count > 99th percentile of all devices' typical rate, ALERT
- question: Has a device's local connection 'fan-out' (number of unique local IPs contacted) suddenly increased after joining a new, suspicious network?
  context: Modeling the 'fan-out' of a device's local connections over time can establish a clear baseline of normal behavior. A sudden, sharp increase in this metric that significantly deviates from a time-series forecast immediately following a connection to a suspicious network provides a high-confidence signal of scanning activity.
  answer_sources:
  - Zeek conn.log
  - Zeek notice.log
  - Windows Event ID 5156
  - Network taps or SPAN ports
  - Endpoint firewalls and EDR logs
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      MODEL time-series of local connection fan-out per device
      IF observed fan-out significantly deviates from forecast after new network connection, ALERT