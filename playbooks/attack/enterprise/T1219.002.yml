name: 'T1219.002: Remote Desktop Software'
id: 'f4b3a4e8-8e6d-4c3a-9b1f-7d1e8c0b2a9c'
description: "This playbook helps investigate whether an adversary is using remote desktop software for command and control. It focuses on detecting the presence of unsanctioned remote desktop tools (e.g., AnyDesk, TeamViewer) and their malicious use. Detections include identifying outbound network connections to known malicious C2 infrastructure or unsanctioned services, analyzing process executions for anomalies such as non-standard file paths or unusual parent processes, and inspecting command-line arguments for silent installation or unattended access flags. The playbook also covers correlating sequences of events like file download, execution, and network connection, as well as identifying statistical outliers in connection duration, data volume, and remote logon behavior (e.g., anomalous time of day or source location)."
type: 'technique'
related:
  - 'TA0011: Command and Control'
contributors:
  - 'Zachary Szewczyk'
created: '2025-10-01'
modified: '2025-10-01'
version: 1.0
tags: 'none'
questions:
  - question: "Are there outbound network connections to known malicious C2 domains/IPs or unsanctioned remote desktop services?"
    context: "This question aims to identify direct C2 communication by cross-referencing network logs with threat intelligence. A match provides a high-confidence indicator of a policy violation at minimum, or an active compromise if the destination is a known malicious C2 server. This is a foundational, indicator-based detection method."
    answer_sources:
      - "Zeek conn.log"
      - "Zeek dns.log"
      - "Corporate network egress points (firewalls, proxies)"
      - "DNS resolvers"
      - "Network sensor grid"
    range: "last 90 days"
    queries:
      - symbolic: "Query DNS and connection logs for destination IPs or domains present in threat intelligence feeds or lists of unsanctioned remote desktop software."
  - question: "Are hosts making DNS queries for remote desktop service subdomains with unusually high entropy, possibly indicating DGA usage?"
    context: "Adversaries may use Domain Generation Algorithms (DGAs) to create random-looking subdomains for C2 communication, making blocklisting difficult. Calculating the Shannon entropy of subdomains for known RDP services (e.g., *.anydesk.com) can reveal these algorithmically generated names, which appear more random than human-created ones. High entropy suggests potential DGA-based C2."
    answer_sources:
      - "Zeek dns.log"
      - "DNS resolvers"
      - "Network sensor grid"
    range: "last 90 days"
    queries:
      - statistical: "For domains related to remote desktop services, calculate the Shannon entropy of the subdomain. Alert if entropy exceeds a baseline threshold."
  - question: "Can a machine learning model identify malicious, long-lived connections to unknown external IP addresses masquerading as legitimate traffic?"
    context: "This question addresses the detection of unknown or novel C2 channels that bypass indicator-based searches. By training a classification model (e.g., Random Forest) on connection metadata (duration, bytes, protocol), the model can learn to distinguish the characteristics of malicious traffic from benign traffic, even when the destination is not on a known blocklist."
    answer_sources:
      - "Zeek conn.log"
      - "Corporate network egress points (firewalls, proxies)"
      - "Network sensor grid"
    range: "last 90 days"
    queries:
      - machine_learning: "Apply a pre-trained Random Forest model to new connection log data. Flag connections classified as 'malicious' with high confidence."
  - question: "Is remote desktop software being executed from a non-standard file path or spawned by an unusual parent process?"
    context: "Legitimate applications are typically installed in standard directories like 'C:\\Program Files\\'. An adversary might drop a portable version of an RDP tool into a temporary or user-writable directory. Detecting executions from non-standard paths or from unusual parent processes (e.g., 'wscript.exe' instead of 'explorer.exe') is a strong indicator of malicious activity."
    answer_sources:
      - "Windows Event ID 4688"
      - "Endpoint Detection and Response (EDR) agents on workstations and servers"
      - "SIEM log collectors for Windows Event Logs"
    range: "last 90 days"
    queries:
      - symbolic: "Search process execution logs (Event ID 4688) for remote desktop process names where the file path is NOT 'C:\\Program Files\\*' or 'C:\\Program Files (x86)\\*'."
  - question: "Is a remote desktop process being spawned by a statistically rare parent process?"
    context: "This question aims to find anomalous execution chains. By establishing a baseline of normal parent-child process relationships on each host, you can identify when an RDP tool is launched by a process that has rarely or never launched it before. This can uncover attempts by malware or scripts to initiate a remote session."
    answer_sources:
      - "Windows Event ID 4688"
      - "Endpoint Detection and Response (EDR) agents on workstations and servers"
    range: "last 90 days"
    queries:
      - statistical: "Analyze parent-child process relationships. Alert when a remote desktop process is spawned by a statistically rare parent process for that child."
  - question: "Can an anomaly detection model identify illegitimate executions of remote desktop software?"
    context: "This question seeks to identify malicious executions that deviate from established normal behavior. A one-class SVM model can be trained on features of known-good RDP software executions (e.g., user context, parent process, file path). The model can then flag new executions that are classified as outliers, indicating a potentially unauthorized or malicious use case."
    answer_sources:
      - "Windows Event ID 4688"
      - "Endpoint Detection and Response (EDR) agents on workstations and servers"
    range: "last 90 days"
    queries:
      - machine_learning: "Apply a pre-trained one-class SVM model to new remote desktop process executions. Flag executions identified as outliers."
  - question: "Is remote desktop software being executed with command-line arguments that indicate silent installation or unattended access configuration?"
    context: "Adversaries need to install and configure remote access tools without alerting the user. They often use specific command-line flags like '--silent', '--set-password', or '--start-with-win'. Searching for these flags in process creation logs provides direct evidence of an attempt to establish persistent, unattended remote access."
    answer_sources:
      - "Windows Event ID 4688"
      - "All Windows endpoints (workstations and servers) forwarding process creation logs"
    range: "last 90 days"
    queries:
      - symbolic: "Search process execution logs (Event ID 4688) for remote desktop processes with command-line arguments matching a list of suspicious flags (e.g., /S, --silent, --set-password)."
  - question: "Are statistically rare command-line arguments being used with authorized remote desktop applications?"
    context: "This question addresses the misuse of legitimate, sanctioned software. Even an approved RDP tool can be used maliciously. By profiling the frequency of all command-line arguments used across the enterprise, you can detect when an employee or attacker uses a rare argument, especially one related to unattended access, which might signal misuse."
    answer_sources:
      - "Windows Event ID 4688"
      - "All Windows endpoints (workstations and servers) forwarding process creation logs"
    range: "last 90 days"
    queries:
      - statistical: "Calculate the frequency of command-line arguments for remote desktop tools. Alert on the use of arguments that are statistically rare across the enterprise."
  - question: "Can topic modeling on command-line arguments reveal malicious remote desktop software usage?"
    context: "This question explores the semantic context of command-line usage. Latent Dirichlet Allocation (LDA) can be used to discover 'topics' from a large set of command-line arguments. Some topics will naturally correspond to malicious activity (e.g., a topic containing terms like 'password', 'silent', 'wget'). New RDP process commands can be scored against these topics to identify malicious intent."
    answer_sources:
      - "Windows Event ID 4688"
      - "All Windows endpoints (workstations and servers) forwarding process creation logs"
    range: "last 90 days"
    queries:
      - machine_learning: "Apply a pre-trained LDA model to command-line arguments of remote desktop processes. Alert if the command has a high probability of belonging to a malicious topic."
  - question: "Has a host exhibited a correlated sequence of downloading, executing, and connecting to a remote desktop service within a short time window?"
    context: "This question looks for a common attack chain: drop, execute, and connect. By creating a stateful rule that links a file download, a subsequent process execution of that file, and a new outbound network connection from that process, all within a few minutes, you can create a high-fidelity alert for a fresh RDP tool deployment."
    answer_sources:
      - "Zeek http.log"
      - "Zeek files.log"
      - "Windows Event ID 4688"
      - "Zeek conn.log"
      - "User workstations, Network egress points, DNS resolvers, EDR-enabled endpoints"
    range: "last 90 days"
    queries:
      - symbolic: "Correlate across hosts: file download of an executable, followed by process execution of that file, followed by an outbound network connection from that process within 10 minutes."
  - question: "Has a download-execute-connect sequence involving a specific remote desktop tool been observed for the first time on a host, and is this sequence rare across the enterprise?"
    context: "This question adds statistical rarity to the correlation rule to reduce false positives from legitimate first-time installations. If the download-execute-connect sequence is a first for a particular host AND that specific tool's installation is rare across the entire organization, the likelihood of it being malicious is significantly higher."
    answer_sources:
      - "Zeek http.log"
      - "Zeek files.log"
      - "Windows Event ID 4688"
      - "Zeek conn.log"
      - "User workstations, Network egress points, DNS resolvers, EDR-enabled endpoints"
    range: "last 90 days"
    queries:
      - statistical: "Identify download-execute-connect sequences. Alert if the sequence is a first-time observation for the host AND has occurred on less than 1% of all endpoints."
  - question: "Can a sequence analysis model detect the pattern of a malicious remote desktop software installation in real-time?"
    context: "This question involves using advanced models (like RNNs or HMMs) to detect attack patterns that may be more complex or varied than a simple A->B->C sequence. By training a model on event streams from both benign and malicious activities, it can learn to identify when a host's real-time event stream indicates it is in a 'malicious RDP install' state with a certain probability."
    answer_sources:
      - "Zeek http.log"
      - "Zeek files.log"
      - "Windows Event ID 4688"
      - "Zeek conn.log"
      - "User workstations, Network egress points, DNS resolvers, EDR-enabled endpoints"
    range: "last 90 days"
    queries:
      - machine_learning: "Feed real-time host event streams into a sequence analysis model (RNN/HMM). Alert if the model indicates a high probability of the host being in a 'malicious RDP install' state."
  - question: "Are there any connections to remote desktop services with excessively long durations or suspicious connection history flags?"
    context: "This question aims to find C2 channels that an attacker leaves open for extended periods. A simple rule can flag any RDP connection that lasts longer than a reasonable workday (e.g., 24 hours). Additionally, Zeek's 'history' field can contain flags indicating protocol anomalies or potential tunneling within the session, which are also strong indicators of non-standard use."
    answer_sources:
      - "Zeek conn.log"
      - "Network flow collectors (e.g., Zeek sensors) at network egress points and internal network chokepoints"
    range: "last 90 days"
    queries:
      - symbolic: "Query connection logs for connections to RDP services where duration > 24 hours OR the connection history field contains suspicious flags."
  - question: "Is a host exhibiting anomalous outbound data volume or connection duration for a remote desktop session compared to its own baseline?"
    context: "This question seeks to find anomalies by comparing a host's activity against its own past behavior. A large data exfiltration event over an RDP session would generate a much higher outbound byte count than normal interactive use. By baselining each host's typical RDP session duration and data volume, you can detect significant deviations that suggest misuse."
    answer_sources:
      - "Zeek conn.log"
      - "Network flow collectors (e.g., Zeek sensors) at network egress points and internal network chokepoints"
    range: "last 90 days"
    queries:
      - statistical: "For each host, compare new RDP session duration and data volume against its 30-day rolling baseline. Alert if new session exceeds the 95th percentile."
  - question: "Can a time-series model detect anomalous traffic patterns within an active remote desktop session?"
    context: "This question focuses on detecting anomalies within the traffic flow of a live RDP session. An LSTM autoencoder can learn the normal 'rhythm' (bytes/sec, packets/sec) of an interactive session. A significant deviation from this learned pattern, such as the steady flow of a large file transfer, will cause a spike in the model's reconstruction error, triggering an alert for anomalous in-session activity."
    answer_sources:
      - "Zeek conn.log"
      - "Network flow collectors (e.g., Zeek sensors) at network egress points and internal network chokepoints"
    range: "last 90 days"
    queries:
      - machine_learning: "Apply a pre-trained LSTM autoencoder to time-series data from active RDP sessions. Alert if the model's reconstruction error spikes."
  - question: "Has a remote interactive logon occurred from a user-host combination that is not on an explicit allow-list?"
    context: "This question provides a high-confidence detection method for environments with strict access controls. By maintaining an explicit list of which users are authorized to remotely access which hosts, any interactive logon (Logon Type 10) that does not match an entry on this list is an immediate and actionable security alert."
    answer_sources:
      - "Windows Event ID 4624"
      - "Domain Controllers, RADIUS/authentication servers, and endpoint logs from user workstations and servers"
    range: "last 90 days"
    queries:
      - symbolic: "Check remote interactive logons (Event ID 4624, Type 10) against a user-to-host allow-list. Alert on any logon not on the list."
  - question: "Has a user performed a remote logon that deviates from their established behavioral profile in terms of time, source IP, or source hostname?"
    context: "This question seeks to identify suspicious logons by building a 'pattern of life' for each user. A new remote logon is scored based on how much it deviates from the user's normal behavior (e.g., logon at 3 AM, from a new country, or from a server they've never accessed before). A high risk score indicates a logon that is highly anomalous for that specific user and warrants investigation."
    answer_sources:
      - "Windows Event ID 4624"
      - "Zeek conn.log"
      - "Domain Controllers, RADIUS/authentication servers, and endpoint logs from user workstations and servers"
    range: "last 90 days"
    queries:
      - statistical: "Score new remote logons based on deviation from the user's historical baseline for logon hour, source IP/ASN, and source hostname. Alert if the score exceeds a threshold."
  - question: "Can a clustering algorithm identify anomalous remote logons that do not fit a user's normal 'pattern of life'?"
    context: "This question uses machine learning to formalize 'pattern of life' analysis. A clustering algorithm like DBSCAN can group a user's past logons into clusters of normal activity. A new logon that does not fall into any of these clusters is considered an outlier or 'noise' and represents a significant deviation from all previously observed behaviors for that user, triggering an alert."
    answer_sources:
      - "Windows Event ID 4624"
      - "Domain Controllers, RADIUS/authentication servers, and endpoint logs from user workstations and servers"
    range: "last 90 days"
    queries:
      - machine_learning: "Apply a pre-trained clustering model (DBSCAN) to new user logon events. Alert if a logon is classified as an outlier (noise)."