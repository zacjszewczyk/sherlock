name: T1003.006: DCSync
id: a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d
description: This playbook helps identify adversary activity leveraging the Directory Replication Service (DRS) Remote Protocol via DCSync to exfiltrate credentials from a Domain Controller. Detection focuses on identifying unauthorized directory replication requests through analysis of Windows event logs, spotting anomalous network traffic patterns related to the DRSUAPI RPC interface, finding command-line evidence of DCSync tool execution, and reacting to specific high-fidelity alerts from network sensors like Zeek.
type: technique
related:
  - TA0006: Credential Access
contributors:
  - Zachary Szewczyk
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Is a directory replication request (Event ID 4662) originating from an unauthorized account or IP address?
    context: This question targets the core of DCSync abuse by checking if a system that is not an authorized Domain Controller is requesting replication data. Legitimate replication only occurs between Domain Controllers. A request originating from any other system's account or IP address is a strong indicator of a DCSync attack. This relies on maintaining an allow-list of known, good Domain Controller IPs and machine account SIDs.
    answer_sources:
      - Windows Security Event ID 4662
      - Zeek conn.log
      - All Domain Controllers within the enterprise.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH Windows Event ID 4662 WHERE Properties CONTAINS ('1131f6aa-9c07-11d1-f79f-00c04fc2dcd2' OR '1131f6ad-9c07-11d1-f79f-00c04fc2dcd2') AND (SubjectSecurityID NOT IN [DC_SID_Allow_List] OR Correlated_Source_IP NOT IN [DC_IP_Allow_List])
  - question: Has an account that is not a Domain Controller machine account initiated a directory replication request?
    context: This question focuses on the identity of the requester. Legitimate replication is performed by Domain Controller machine accounts. Any user account or non-DC machine account making these requests is highly suspicious and represents a zero-expected-frequency anomaly, pointing directly to credential compromise and DCSync activity.
    answer_sources:
      - Windows Security Event ID 4662
      - All Domain Controllers within the enterprise.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: PROFILE accounts generating Event ID 4662 with replication GUIDs. ALERT IF account_type IS NOT 'Domain Controller Machine Account'.
  - question: Does a directory replication request exhibit anomalous characteristics compared to the established baseline of normal replication activity?
    context: This question uses machine learning to find subtle deviations from normal DC-to-DC replication. It looks at a combination of factors (source account, source IP, destination DC, time of day) to spot outliers that might be missed by simple allow-list rules. This could indicate a compromised administrative account or a legitimate (but compromised) DC being used for the attack.
    answer_sources:
      - Windows Security Event ID 4662
      - Zeek conn.log
      - All Domain Controllers within the enterprise.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: APPLY anomaly detection model ON features (source SID, source IP, destination DC, time) from Event ID 4662 and Zeek conn.log. ALERT ON outliers.
  - question: Is there DRSUAPI RPC traffic originating from an IP address that is not an authorized Domain Controller?
    context: This question moves the detection to the network layer. It directly looks for the specific RPC interface used by DCSync (DRSUAPI) and verifies if the traffic is coming from a non-DC system. This is a high-fidelity indicator because non-DC systems have no legitimate reason to use this replication protocol.
    answer_sources:
      - Zeek conn.log
      - Zeek dcerpc.log
      - Network sensor monitoring traffic on internal network segments containing Domain Controllers, and at key network choke points.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH Zeek dcerpc.log WHERE interface_uuid IS 'E3514235-4B06-11D1-AB04-00C04FC2DCD2' AND Correlated_Source_IP in conn.log NOT IN [DC_IP_Allow_List].
  - question: Is the volume of data transferred during a DRSUAPI session from a non-DC IP to a DC anomalously large?
    context: This question focuses on the data volume of a potential DCSync attack. An attacker pulling the entire directory or a large portion of it will generate a significantly larger response from the DC than typical replication updates. By comparing the traffic volume from a suspicious source to the baseline of normal DC-to-DC replication, we can spot these large-scale data exfiltration attempts.
    answer_sources:
      - Zeek conn.log
      - Zeek dcerpc.log
      - Network sensor monitoring traffic on internal network segments containing Domain Controllers, and at key network choke points.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: CALCULATE baseline (mean, stddev) of resp_bytes for DC-to-DC DRSUAPI connections. ALERT IF non-DC to DC DRSUAPI connection resp_bytes > (baseline_mean + 3*baseline_stddev).
  - question: Has the network traffic volume over the DRSUAPI port from a non-DC system to a DC significantly deviated from its forecasted normal behavior?
    context: This is an advanced question for detecting anomalous data transfers even from systems that might have some legitimate traffic to a DC, like admin workstations. By forecasting the expected traffic volume for specific source-destination pairs, it can flag a sudden, unexpected spike in data transfer over the DRSUAPI port that indicates a DCSync attack.
    answer_sources:
      - Zeek conn.log
      - Zeek dcerpc.log
      - Network sensor monitoring traffic on internal network segments containing Domain Controllers, and at key network choke points.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: APPLY time-series model (ARIMA) on resp_bytes for specific non-DC to DC pairs. ALERT IF observed resp_bytes significantly exceeds forecasted volume.
  - question: Has a process been executed with command-line arguments indicative of a known DCSync tool?
    context: This question looks for the most direct evidence of a DCSync attack: the execution of the tools themselves. By searching for specific strings and patterns (like `lsadump::dcsync` or `secretsdump.py -just-dc`) in process command lines, analysts can catch the attack as it happens. This is a high-confidence indicator, especially when found on a non-DC system.
    answer_sources:
      - Windows Security Event ID 4688 (with Command Line Auditing enabled)
      - All workstations and member servers within the Active Directory environment, with heightened monitoring on systems used by administrators or those with network access to Domain Controllers.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH Process Creation Events (4688) WHERE CommandLine MATCHES REGEX '(lsadump.*::.*dcsync|secretsdump\\.py.*(-just-dc|-just-dc-user|-just-dc-ntlm))'.
  - question: Has a common process like PowerShell or Python been launched with an unusually complex or high-entropy command line?
    context: This question aims to detect obfuscated DCSync attacks. Attackers often encode their commands to evade simple signature-based detection. A command line with high entropy (a measure of randomness) can be a sign of an encoded payload. By flagging command lines that are statistically more complex than normal, this method can uncover hidden attack scripts.
    answer_sources:
      - Windows Security Event ID 4688 (with Command Line Auditing enabled)
      - All workstations and member servers within the Active Directory environment, with heightened monitoring on systems used by administrators or those with network access to Domain Controllers.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: CALCULATE Shannon entropy for command lines of processes like powershell.exe, python.exe. ALERT IF entropy > 98th percentile of baseline.
  - question: Does a newly created process command line classify as malicious based on a trained machine learning model?
    context: This question employs a sophisticated, proactive approach. By training a model on the characteristics of thousands of known good and bad command lines (including DCSync variants), it can classify new, never-before-seen commands as potentially malicious in real-time. This helps detect novel or slightly modified attack tools that might evade signature or entropy detection.
    answer_sources:
      - Windows Security Event ID 4688 (with Command Line Auditing enabled)
      - All workstations and member servers within the Active Directory environment, with heightened monitoring on systems used by administrators or those with network access to Domain Controllers.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: APPLY supervised classification model (Random Forest) on features from new process command lines. ALERT IF classification is 'malicious'.
  - question: Has a Zeek sensor generated a specific `DCSync::Replication_From_Non_DC` notice?
    context: This question relies on a specialized, high-fidelity network security monitoring rule. The Zeek network analysis framework can be configured with scripts that specifically understand the DCSync protocol. The generation of a `DCSync::Replication_From_Non_DC` notice is an explicit, high-confidence alert that this specific malicious activity has been observed on the network and requires immediate investigation.
    answer_sources:
      - Zeek notice.log
      - Network sensors monitoring traffic to and from Domain Controllers.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH Zeek notice.log WHERE note == 'DCSync::Replication_From_Non_DC'. GENERATE high-severity alert.
  - question: Has there been a sudden burst or an unusual increase in the frequency of DCSync-related Zeek notices?
    context: This question helps to assess the scope and scale of an attack. While a single DCSync alert is critical, a sudden spike in these alerts from various sources across the network indicates a much larger, potentially automated campaign. Detecting this "burst" of activity helps analysts prioritize the incident appropriately, as it suggests a widespread compromise.
    answer_sources:
      - Zeek notice.log
      - Network sensors monitoring traffic to and from Domain Controllers.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: APPLY burst detection algorithm to time series of 'DCSync::Replication_From_Non_DC' notices. ALERT on detected bursts.
  - question: Which DCSync-related alerts should be prioritized for investigation based on a risk score?
    context: In a large environment, even high-fidelity alerts can become numerous. This question addresses the need for efficient incident response by triaging alerts. A model can assign a risk score to each DCSync alert based on contextual factors like the source's reputation, the target's criticality, and the time of day. This allows analysts to focus on the highest-risk events first.
    answer_sources:
      - Zeek notice.log
      - Network sensors monitoring traffic to and from Domain Controllers.
    range: last 90 days
    queries:
      - technology: pseudocode
        query: APPLY triage model (Logistic Regression) to score severity of DCSync notices based on features (source IP reputation, target DC criticality, etc.). PRIORITIZE alerts with highest scores.