name: T1542.002: Component Firmware
id: f8a5c1b2-9d3e-4f6a-8b7c-0e1f2a3b4c5d
description: This playbook helps determine if an adversary has established persistence or is evading defenses by modifying component firmware. The investigation focuses on identifying anomalous network communications, suspicious execution of firmware update utilities, unattributed network traffic originating from below the operating system, persistent hardware errors that survive OS re-imaging, and attempts to disable or interfere with security tools prior to firmware modification.
type: technique
related:
- TA0003: Persistence
- TA0005: Defense Evasion
contributors:
- Zachary Szewczyk
- Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
- question: Is there outbound network activity matching known firmware implant C2 infrastructure indicators?
  context: Firmware implants like LoJax and CosmicStrand require command and control (C2) infrastructure to receive commands and exfiltrate data. This question aims to detect these implants by matching outbound network connections or DNS queries against a high-confidence threat intelligence feed of known C2 domains and IP addresses. A match is a strong indicator of a compromise.
  answer_sources:
  - Zeek conn.log
  - Zeek dns.log
  - Network egress points (e.g., firewalls, internet gateways), DNS resolvers, network security monitoring sensor grid
  range: last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH zeek_conn OR zeek_dns | JOIN threat_intel_feed on destination_ip OR destination_domain | WHERE threat_match = true
- question: Is any host exhibiting DNS query patterns indicative of Domain Generation Algorithms (DGA)?
  context: To evade blacklisting, some malware, including firmware implants, use DGAs to generate a large number of potential C2 domains. This activity often results in DNS queries for domains that have high character randomness (entropy). This question seeks to identify hosts making high-entropy DNS queries, which is a common indicator of DGA-based C2 communication.
  answer_sources:
  - Zeek dns.log
  - Network egress points (e.g., firewalls, internet gateways), DNS resolvers, network security monitoring sensor grid
  range: last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH zeek_dns | CALCULATE shannon_entropy(query_name) by host | STATS rolling_avg(entropy) | WHERE rolling_avg > threshold
- question: Are there anomalous spikes in network traffic volume or patterns from any host that could signal implant activation?
  context: A firmware implant may remain dormant for a period before activating. This activation can cause a sudden, anomalous change in the host's network behavior, such as a spike in outbound data, connections to new destinations, or a change in protocol usage. This question uses a time-series anomaly detection model to identify such deviations from a host's established baseline.
  answer_sources:
  - Zeek conn.log
  - Network egress points (e.g., firewalls, internet gateways), DNS resolvers, network security monitoring sensor grid
  range: last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH zeek_conn | MODEL timeseries_anomaly_detection(outbound_bytes, unique_dest_ips) by host | WHERE anomaly_score > high
- question: Has a known firmware flashing utility been executed with suspicious command-line arguments or by an unusual parent process?
  context: Adversaries must use legitimate or malicious firmware flashing tools to write their implant to a component's firmware. This question looks for executions of these tools in an anomalous context, such as being launched by an unexpected process (e.g., a web browser) or with risky command-line flags (e.g., forcing a flash without validation), which can indicate malicious use.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 4104
  - Critical servers (e.g., domain controllers, database servers), executive workstations, administrator workstations, endpoint detection and response (EDR) logs
  range: last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH event_id=4688 AND process_name IN (flashing_utilities) AND (command_line CONTAINS risky_flags OR parent_process NOT IN (common_parents))
- question: Has a firmware flashing utility been launched by a historically rare parent process?
  context: Legitimate use of firmware update utilities typically originates from a predictable set of parent processes, such as an administrator's command prompt or a standard software deployment tool. This question aims to identify executions where the parent process is statistically rare for that utility across the enterprise, suggesting an abnormal and potentially malicious execution chain.
  answer_sources:
  - Windows Event ID 4688
  - Critical servers (e.g., domain controllers, database servers), executive workstations, administrator workstations, endpoint detection and response (EDR) logs
  range: last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH event_id=4688 AND process_name IN (flashing_utilities) | STATS frequency(parent_process) | WHERE frequency < low_percentile
- question: Does the execution of a firmware utility exhibit a combination of features classified as malicious by a machine learning model?
  context: A single indicator of a malicious firmware flash might not be enough to generate an alert. This question leverages a machine learning model that considers multiple features in concert—such as the parent process, command-line arguments, user context, and time of day—to make a more accurate classification of whether the utility's execution is suspicious or benign.
  answer_sources:
  - Windows Event ID 4688
  - Critical servers (e.g., domain controllers, database servers), executive workstations, administrator workstations, endpoint detection and response (EDR) logs
  range: last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH event_id=4688 | MODEL classify_malicious(process_name, parent_process, command_line_entropy, user_context) | WHERE classification = 'malicious'
- question: Is there outbound network traffic from a host that cannot be attributed to a process recorded by the operating system?
  context: Firmware implants operate at a level below the operating system kernel. Consequently, the network traffic they generate may not be associated with any running process that the OS is aware of. This question seeks to find these discrepancies by correlating network flow data with host-based network connection events, flagging any external traffic that has no corresponding process on the source host.
  answer_sources:
  - Zeek conn.log
  - Windows Event ID 5156
  - Network egress points, endpoint Windows Filtering Platform (WFP) logs on all servers and workstations
  range: last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH zeek_conn | LEFT_JOIN event_id=5156 ON (src_ip, dest_ip, dest_port, timestamp) | WHERE event_id IS NULL
- question: Has any host shown a significant increase in the proportion of its network traffic that is unattributed to an OS process?
  context: While some unattributed traffic can be normal, a sudden increase in its volume relative to normal, attributed traffic on a host is suspicious. This question aims to detect the activation of a hidden network agent, like a firmware implant, by monitoring this ratio and flagging hosts that deviate significantly from their own historical baseline.
  answer_sources:
  - Zeek conn.log
  - Windows Event ID 5156
  - Network egress points, endpoint Windows Filtering Platform (WFP) logs on all servers and workstations
  range: last 90 days
  queries:
  - technology: pseudocode
    query: CALCULATE ratio(unattributed_connections / attributed_connections) by host, day | WHERE ratio > 3_std_dev_of_rolling_avg
- question: Is the volume of unattributed network connections from any host significantly higher than predicted by historical patterns?
  context: This question uses a time-series forecasting model to predict the expected number of unattributed network connections for a host at a given time. If the actual count significantly exceeds the model's prediction, it suggests a new, unmodeled source of traffic has appeared, which could be a malicious firmware implant.
  answer_sources:
  - Zeek conn.log
  - Windows Event ID 5156
  - Network egress points, endpoint Windows Filtering Platform (WFP) logs on all servers and workstations
  range: last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH unattributed_connections | MODEL forecast(count) by host, hour | WHERE actual_count > forecast_upper_bound
- question: Is a host generating a high volume of critical disk or driver errors, especially shortly after being re-imaged?
  context: A malicious firmware implant can cause instability by interfering with normal hardware operations, leading to disk and driver errors. If these errors persist even after the operating system has been completely re-installed (re-imaged), it strongly suggests the root cause is at the firmware or hardware level, not the software level.
  answer_sources:
  - Windows Event ID 7000
  - Windows Event ID 7026
  - Windows Event ID 7
  - Windows Event ID 11
  - Windows Event ID 55
  - Endpoint and server system event logs, IT service management/ticketing system for re-imaging history, asset management database
  range: last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH event_id IN (disk_driver_errors) | COUNT by host, 24h | WHERE count > 10 | JOIN asset_db on host | WHERE last_reimaged < 7_days_ago
- question: Is a specific host generating hardware errors at a rate that is anomalously high compared to other hosts of the same model?
  context: Different hardware models can have different baseline error rates. This question seeks to identify outliers by comparing a host's error rate to that of its peers (i.e., other machines of the same model). A host that generates significantly more errors than its peers is a strong candidate for having a unique issue, such as a firmware compromise.
  answer_sources:
  - Windows Event ID 7000
  - Windows Event ID 7026
  - Windows Event ID 7
  - Windows Event ID 11
  - Windows Event ID 55
  - Endpoint and server system event logs, IT service management/ticketing system for re-imaging history, asset management database
  range: last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH event_id IN (disk_driver_errors) | COUNT by host, hardware_model, day | WHERE daily_count > 98th_percentile_for_model
- question: Does a host belong to a cluster of 'unhealthy' systems based on its hardware error profile, and does it remain in that cluster after an OS re-image?
  context: This question uses clustering algorithms to group hosts with similar hardware error patterns. A host that is consistently grouped into an 'unhealthy' cluster, even after remediation attempts like re-imaging the OS, is a prime suspect for a persistent, low-level compromise in the firmware.
  answer_sources:
  - Windows Event ID 7000
  - Windows Event ID 7026
  - Windows Event ID 7
  - Windows Event ID 11
  - Windows Event ID 55
  - Endpoint and server system event logs, IT service management/ticketing system for re-imaging history, asset management database
  range: last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH event_id IN (disk_driver_errors) | CLUSTER hosts by error_counts | IDENTIFY unhealthy_clusters | TRACK hosts in unhealthy_clusters across re-imaging_events
- question: Is there network traffic containing signatures associated with known firmware implant C2 protocols?
  context: This question focuses on detecting known malicious C2 channels by inspecting network traffic for specific indicators. This includes matching on known byte patterns in the payload, identifying unusual protocol structures, or matching TLS fingerprinting hashes (like JA3/JA3S) against a feed of those known to be used by firmware implants.
  answer_sources:
  - Zeek conn.log
  - Zeek dns.log
  - Zeek files.log
  - Zeek weird.log
  - Zeek ssl.log
  - Network taps at key aggregation points, network security monitoring (NSM) sensor grid, internet gateways
  range: last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH zeek_ssl or suricata_alerts | JOIN threat_intel_feed on ja3_hash or signature_id | WHERE threat_match = true
- question: Is any host using DNS record types (TXT, NULL) in a way that suggests C2 communication or data exfiltration?
  context: Adversaries often abuse DNS for C2 because it is a fundamental protocol that is rarely blocked. This question looks for the abuse of non-standard record types (like TXT, NULL, CNAME) which can be used to tunnel data. A high ratio of these query types compared to standard A/AAAA lookups on a host is a strong indicator of a DNS-based C2 channel.
  answer_sources:
  - Zeek dns.log
  - Network taps at key aggregation points, network security monitoring (NSM) sensor grid, internet gateways
  range: last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH zeek_dns | CALCULATE ratio(count(TXT,NULL,CNAME)/count(A,AAAA)) by host | WHERE ratio > 99th_percentile
- question: Are there DNS or ICMP packets with structurally anomalous payloads that are flagged by a deep learning model?
  context: To detect unknown or novel C2 channels, this question uses an autoencoder model trained on the raw byte content of normal DNS and ICMP packets. The model learns the structure of legitimate traffic. Packets carrying malicious payloads for C2 will likely have a different structure, resulting in a high reconstruction error and flagging them as anomalous.
  answer_sources:
  - Zeek conn.log
  - Zeek dns.log
  - Network taps at key aggregation points, network security monitoring (NSM) sensor grid, internet gateways
  range: last 90 days
  queries:
  - technology: pseudocode
    query: STREAM dns_icmp_payloads | MODEL autoencoder(payload) | WHERE reconstruction_error > threshold
- question: Has a security agent been disabled immediately before the execution of a firmware flashing utility or the installation of a suspicious service?
  context: A classic defense evasion tactic is to disable security software before performing a malicious action. This question looks for a highly suspicious sequence of events: a security service (like an AV or EDR agent) stopping, followed shortly thereafter by the execution of a firmware utility. This temporal correlation strongly suggests an attempt to flash firmware while defenses are down.
  answer_sources:
  - Windows Event ID 7036
  - Windows Event ID 4688
  - Windows Event ID 4697
  - Windows Event ID 1001
  - Endpoint and server security and system event logs, SIEM correlation engine, EDR platform alerts
  range: last 90 days
  queries:
  - technology: pseudocode
    query: SEQUENCE [SEARCH event_id=7036 AND service=security_agent] FOLLOWED_BY [SEARCH event_id=4688 AND process=firmware_utility OR event_id=4697] WITHIN 5m ON same_host
- question: Has a security agent remained disabled for an unusually long time in conjunction with the execution of a firmware utility?
  context: While security agents may stop briefly for legitimate updates, a prolonged outage is abnormal. This question identifies situations where a security service is stopped for a duration that exceeds the normal update cycle time, especially if a firmware utility was executed during that outage. This indicates a potential tampering with the security agent to provide a window for malicious activity.
  answer_sources:
  - Windows Event ID 7036
  - Windows Event ID 4688
  - Endpoint and server security and system event logs, SIEM correlation engine, EDR platform alerts
  range: last 90 days
  queries:
  - technology: pseudocode
    query: CALCULATE duration(service_stop_event, service_start_event) for security_agent | WHERE duration > 95th_percentile AND firmware_utility_executed_during_outage
- question: Has a host exhibited a statistically improbable sequence of events, such as a security service being disabled followed by a suspicious utility execution?
  context: This question uses a Hidden Markov Model (HMM) to learn the normal sequences of events on a host. An attack often involves a sequence of state transitions that is highly unlikely under normal operating conditions (e.g., transitioning from 'Stable' to 'Security Disabled' to 'Firmware Flash'). The model flags these low-probability sequences as potential multi-stage attacks.
  answer_sources:
  - Windows Event ID 7036
  - Windows Event ID 4688
  - Windows Event ID 4697
  - Endpoint and server security and system event logs, SIEM correlation engine, EDR platform alerts
  range: last 90 days
  queries:
  - technology: pseudocode
    query: STREAM host_events | MODEL hmm(event_sequence) | WHERE sequence_probability < low_threshold
- question: Are security scanning tools crashing in conjunction with disk corruption errors?
  context: A sophisticated firmware implant may try to protect itself by interfering with security tools. This question looks for evidence of this by correlating application crashes of security scanners (like antivirus or chkdsk.exe) with preceding disk corruption errors. This pattern suggests the implant may be causing I/O errors when the scanner attempts to read its location, leading to a crash.
  answer_sources:
  - Windows Event ID 55
  - Windows Event ID 137
  - Windows Event ID 1001
  - Endpoint and server system and application event logs, hosts with high-value data, EDR/AV management consoles
  range: last 90 days
  queries:
  - technology: pseudocode
    query: SEQUENCE [SEARCH event_id IN (55, 137)] FOLLOWED_BY [SEARCH event_id=1001 AND process=security_scanner] WITHIN 1h ON same_host
- question: Is a host consistently failing to complete security scans at a rate significantly higher than its peers?
  context: This question provides a higher-level, behavioral view of potential interference with security tools. By monitoring scan completion rates from a central EDR or AV console, it identifies hosts that are chronic outliers, consistently failing to complete scans. This points to a persistent problem on the host that could be caused by a defensive firmware implant.
  answer_sources:
  - Endpoint and server system and application event logs, hosts with high-value data, EDR/AV management consoles
  range: last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH scan_logs | CALCULATE completion_rate by host | WHERE completion_rate < (avg_completion_rate - 3_std_dev)
- question: Has a security scan failed on a 'healthy' host that had a very low predicted probability of failure?
  context: Not all scan failures are malicious; some occur on older or unstable machines. This question uses a model to predict the likelihood of a scan failure based on host characteristics. A failure on a host that the model deemed very stable and healthy (low probability of failure) is highly anomalous and suggests a new, unmodeled factor—like a malicious implant—is causing the failure.
  answer_sources:
  - Endpoint and server system and application event logs, hosts with high-value data, EDR/AV management consoles
  range: last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH scan_logs | MODEL predict_failure(host_age, model, error_counts) | WHERE actual_result='failed' AND predicted_probability < 0.05
- question: Is there DNS or ICMP traffic that exhibits characteristics of data tunneling or covert channels?
  context: Firmware implants need to exfiltrate data and receive commands, often using covert channels to do so. This question looks for common tunneling techniques, such as encoding data into long, hexadecimal subdomains in DNS queries or using abnormally large ICMP echo request packets to carry data payloads, both of which are strong indicators of a covert channel.
  answer_sources:
  - Zeek conn.log
  - Zeek dns.log
  - Network traffic captures at internet gateways, internal network core, and DMZ segments
  range: last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH zeek_dns WHERE subdomain MATCHES regex_hex_string OR SEARCH zeek_conn WHERE proto=icmp AND payload_size > 128
- question: Is there highly periodic network traffic with low jitter between a host and an external destination, indicative of C2 beaconing?
  context: C2 communication from malware is often automated and highly regular, unlike traffic generated by human activity. This question seeks to identify this machine-generated behavior by analyzing the time intervals between connections. A connection stream with a very low standard deviation in these intervals (low jitter) is a classic sign of C2 beaconing.
  answer_sources:
  - Zeek conn.log
  - Network traffic captures at internet gateways, internal network core, and DMZ segments
  range: last 90 days
  queries:
  - technology: pseudocode
    query: SEARCH zeek_conn | STATS stdev(time_delta) as jitter by src_ip, dest_ip | WHERE jitter < 1s AND connection_count > 10
- question: Are there network sessions flagged as strong anomalies by an unsupervised machine learning model based on their combined characteristics?
  context: To detect novel or unknown C2 channels that evade signature-based methods, this question uses an unsupervised model like an isolation forest. By analyzing multiple features of a network session (duration, bytes transferred, protocol, TCP flags), the model can identify sessions that are statistical outliers compared to normal traffic, flagging them as potential covert channels used by firmware implants.
  answer_sources:
  - Zeek conn.log
  - Network traffic captures at internet gateways, internal network core, and DMZ segments
  range: last 90 days
  queries:
  - technology: pseudocode
    query: STREAM zeek_conn | MODEL isolation_forest(duration, orig_bytes, resp_bytes, proto) | WHERE anomaly_score > high