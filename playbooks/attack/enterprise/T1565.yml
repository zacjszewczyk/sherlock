name: T1565: Data Manipulation
id: f47ac10b-58cc-4372-a567-0e02b2c3d479
description: This playbook helps to identify if an adversary has manipulated data integrity or availability on critical systems. It focuses on detecting indicators of data manipulation such as the presence of known malicious tools (wipers, ransomware), the use of native utilities for data destruction, unusually high volumes of file modifications or deletions, suspicious sequences of file and network events suggesting tampering, and mass file renaming operations characteristic of ransomware.
type: technique
related:
  - TA0040: Impact
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Has a file been created whose hash matches a known malicious tool associated with data manipulation?
    context: Adversaries often deploy known tools like wipers or ransomware. This question aims to identify the creation of such tools on disk by comparing the file's hash against a database of known malicious indicators. A match provides a high-confidence signal that a data manipulation attack is imminent or in progress.
    answer_sources:
      - Sysmon Event ID 11
      - Windows Event ID 4663
      - Sysmon Event ID 1
      - Critical file servers, database servers, domain controllers, application servers, and user workstations.
    range: Last 90 days
    queries:
      - search: pseudocode
        query: |
          search file_creation_events
          for_each event, calculate_hash(file)
          lookup threat_intel_db on hash
          where match_found, alert
  - question: Have file write events occurred where the file's content entropy significantly deviates from the established baseline, suggesting encryption or obfuscation?
    context: Encryption and obfuscation, common in ransomware and other data manipulation attacks, significantly alter a file's data randomness (entropy). This question seeks to detect such activity by establishing a baseline entropy for normal files and alerting on significant deviations, which could indicate a file has been maliciously encrypted.
    answer_sources:
      - Sysmon Event ID 11
      - Windows Event ID 4663
      - Sysmon Event ID 1
      - Critical file servers, database servers, domain controllers, application servers, and user workstations.
    range: Last 90 days
    queries:
      - search: pseudocode
        query: |
          search file_write_events
          for_each event, calculate_entropy(file_content)
          compare entropy to baseline_for_filetype
          where deviation > 3_std_dev, alert
  - question: Has a machine learning model classified any newly created files as malicious with a high confidence score?
    context: This question leverages a machine learning model to proactively identify malicious files at the time of creation. By analyzing features like file path, process context, and entropy, the model can detect novel or polymorphic threats that might evade signature-based detection, providing an advanced layer of defense against data manipulation tools.
    answer_sources:
      - Sysmon Event ID 11
      - Windows Event ID 4663
      - Sysmon Event ID 1
      - Critical file servers, database servers, domain controllers, application servers, and user workstations.
    range: Last 90 days
    queries:
      - search: pseudocode
        query: |
          search file_creation_events
          for_each event, extract_features(event)
          predict_malicious_probability(features)
          where probability > 0.9, alert
  - question: Have any processes been executed using native utilities or scripting engines with command-line arguments matching known data wiping patterns?
    context: Adversaries often abuse legitimate system utilities (`cipher.exe`, `fsutil.exe`) or scripting languages (PowerShell) to perform destructive actions. This question looks for specific command-line patterns known to be used for overwriting or deleting data, providing a direct indicator of malicious intent to impact data integrity.
    answer_sources:
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - Zeek files.log
      - All enterprise endpoints and servers, particularly those hosting critical applications, databases, or file shares.
    range: Last 90 days
    queries:
      - search: pseudocode
        query: |
          search process_creation_events
          filter command_line matches regex_for_wiping_tools
          where match_found, alert
  - question: Have any statistically rare or anomalous command lines been executed, particularly involving data manipulation utilities?
    context: Malicious activity often deviates from normal user and system behavior. This question aims to identify such deviations by flagging command-line executions that are statistically infrequent for a given user, host, or system role. For example, a web service account running `cipher.exe` is highly unusual and warrants investigation for data manipulation.
    answer_sources:
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - Zeek files.log
      - All enterprise endpoints and servers, particularly those hosting critical applications, databases, or file shares.
    range: Last 90 days
    queries:
      - search: pseudocode
        query: |
          search process_creation_events
          for_each event, calculate_frequency(user, host, command)
          where frequency < 5th_percentile, alert
  - question: Has a machine learning model scored any recently executed command lines as having a high risk of being malicious?
    context: This question uses a machine learning model to score the maliciousness of command lines based on their characteristics (length, special characters, keywords). This allows for the detection of novel or obfuscated malicious commands that might not match static rules or regex patterns, providing a more robust defense against adversaries using command-line tools for data manipulation.
    answer_sources:
      - Windows Event ID 4688
      - Sysmon Event ID 1
      - Zeek files.log
      - All enterprise endpoints and servers, particularly those hosting critical applications, databases, or file shares.
    range: Last 90 days
    queries:
      - search: pseudocode
        query: |
          search process_creation_events
          for_each event, extract_features(command_line)
          score_command_line(features)
          where score > risk_threshold, alert
  - question: Has any user or process exceeded a hard threshold for file deletion events on a critical repository within a short time frame?
    context: A massive number of file deletions in a short period is a strong indicator of a wiper or ransomware attack. This question uses a simple, high-volume threshold to quickly detect such blatant destructive activity against critical data repositories, enabling a rapid response.
    answer_sources:
      - Windows Event ID 4663
      - Windows Event ID 4659
      - Sysmon Event ID 23
      - Sysmon Event ID 26
      - Sensitive data repositories, including network file shares, source code management systems, code repositories (e.g., Git servers), and SharePoint sites.
    range: Last 90 days
    queries:
      - search: pseudocode
        query: |
          search file_deletion_events
          group by user, process
          count events over 5_minute_window
          where count > 500, alert
  - question: Has any user's file modification or deletion activity on a critical repository deviated significantly from their established baseline?
    context: This question aims to detect anomalous behavior on a per-user basis. By establishing a normal baseline of file activity for each user, it can identify when a user's account—perhaps compromised—is suddenly performing an unusual volume of file modifications or deletions, which could signal a targeted data manipulation attack.
    answer_sources:
      - Windows Event ID 4663
      - Windows Event ID 4659
      - Sysmon Event ID 23
      - Sysmon Event ID 26
      - Sensitive data repositories, including network file shares, source code management systems, code repositories (e.g., Git servers), and SharePoint sites.
    range: Last 90 days
    queries:
      - search: pseudocode
        query: |
          search file_mod_delete_events
          for_each user, compare_activity_to_baseline(user, time_of_day)
          where activity > 99th_percentile, alert
  - question: Has a time-series anomaly detection model identified an unusual spike in file modification or deletion events on critical servers?
    context: This question employs advanced analytics to detect anomalous patterns in file activity over time. A time-series model can understand normal business rhythms (e.g., seasonality, daily trends) and flag sudden spikes in file modifications or deletions that are abnormal for that specific time, even if the volume isn't high enough to trigger a simple threshold alert.
    answer_sources:
      - Windows Event ID 4663
      - Windows Event ID 4659
      - Sysmon Event ID 23
      - Sysmon Event ID 26
      - Sensitive data repositories, including network file shares, source code management systems, code repositories (e.g., Git servers), and SharePoint sites.
    range: Last 90 days
    queries:
      - search: pseudocode
        query: |
          stream file_mod_delete_events to time_series_model
          model.detect_anomalies(event_stream)
          where anomaly_detected, alert
  - question: Has a single process executed a sequence of reading a sensitive file, making an external network connection, and then writing back to the same file within a short time window?
    context: This specific sequence of events—read, exfiltrate, modify—can indicate data tampering. An adversary might read a sensitive file, send its contents to a C2 server for modification, and then write the altered (tampered) data back. This question aims to detect this precise attack chain through event correlation.
    answer_sources:
      - Windows Event ID 4663
      - Zeek conn.log
      - Sysmon Event ID 3
      - Sysmon Event ID 11
      - Endpoints of high-value users (e.g., developers, system administrators), servers hosting sensitive data, DMZ servers, and network egress points.
    range: Last 90 days
    queries:
      - search: pseudocode
        query: |
          correlate file_read, network_connection, and file_write events
          filter for same_process, same_host, same_file, within_60_seconds
          where sequence_matched, alert
  - question: After accessing a sensitive file, has a process connected to a statistically rare or never-before-seen network destination?
    context: Processes that handle sensitive data usually communicate with a predictable set of network destinations. This question seeks to identify anomalous behavior where, after reading sensitive data, a process connects to an unusual destination (e.g., a new country, a rare ASN). This could indicate data exfiltration or communication with a C2 server as part of a data tampering attack.
    answer_sources:
      - Windows Event ID 4663
      - Zeek conn.log
      - Sysmon Event ID 3
      - Sysmon Event ID 11
      - Endpoints of high-value users (e.g., developers, system administrators), servers hosting sensitive data, DMZ servers, and network egress points.
    range: Last 90 days
    queries:
      - search: pseudocode
        query: |
          search file_read events on sensitive_files
          join with subsequent network_connections by same_process
          for_each connection, check_destination_rarity
          where destination_is_rare, alert
  - question: Has a sequence analysis model detected an abnormal sequence of operations (e.g., file read, network connect, file write) for a given process?
    context: This question uses a machine learning model to learn the "grammar" of normal process behavior. By analyzing sequences of events, it can identify when a process performs actions in an order that has a low probability of being legitimate, indicating a potential deviation caused by malicious activity like data tampering.
    answer_sources:
      - Windows Event ID 4663
      - Zeek conn.log
      - Sysmon Event ID 3
      - Sysmon Event ID 11
      - Endpoints of high-value users (e.g., developers, system administrators), servers hosting sensitive data, DMZ servers, and network egress points.
    range: Last 90 days
    queries:
      - search: pseudocode
        query: |
          stream system_events to sequence_model
          model.calculate_sequence_probability(new_event_sequence)
          where probability is low, alert
  - question: Has a process rapidly renamed a large number of files to a known ransomware extension?
    context: Ransomware commonly encrypts files and renames them with a specific extension. This is often observed as a rapid series of file delete and file create events. This question uses a threshold-based rule to detect this behavior, looking for a high volume of renames by a single process to an extension associated with known ransomware families.
    answer_sources:
      - Sysmon Event ID 11
      - Sysmon Event ID 23
      - Windows Event ID 4663
      - User workstations, file servers, and backup servers.
    range: Last 90 days
    queries:
      - search: pseudocode
        query: |
          search file_delete and file_create events
          correlate by process over 1_minute_window
          where count > 100 AND new_extension matches ransomware_list, alert
  - question: Has there been a sudden decrease in the entropy of file extensions in a directory, coupled with a high rate of file creation/deletion activity?
    context: When ransomware renames many files with different original extensions to a single new extension, the variety (entropy) of file extensions in that directory plummets. This question aims to detect this statistical anomaly, which, when combined with a high rate of file operations, is a strong indicator of a mass renaming event characteristic of a ransomware attack.
    answer_sources:
      - Sysmon Event ID 11
      - Sysmon Event ID 23
      - Windows Event ID 4663
      - User workstations, file servers, and backup servers.
    range: Last 90 days
    queries:
      - search: pseudocode
        query: |
          monitor file_extensions in directory
          calculate entropy over time
          where entropy drops sharply AND file_op_rate is high, alert
  - question: Has a clustering algorithm identified a process whose file system activity (creation/deletion rates, path patterns) is anomalous and consistent with a mass rename event?
    context: This question uses unsupervised machine learning to group processes by their file system behavior. Normal user and system activities form predictable clusters. A process executing a ransomware payload would exhibit a unique and intense pattern of file operations that would not fit into any existing cluster, flagging it as an anomaly for investigation.
    answer_sources:
      - Sysmon Event ID 11
      - Sysmon Event ID 23
      - Windows Event ID 4663
      - User workstations, file servers, and backup servers.
    range: Last 90 days
    queries:
      - search: pseudocode
        query: |
          collect file_system_activity_features per process
          apply clustering_algorithm (DBSCAN)
          where process is flagged as noise or anomalous_cluster, alert