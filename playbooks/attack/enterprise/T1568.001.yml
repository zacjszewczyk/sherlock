name: T1568.001: Fast Flux DNS
id: f47ac10b-58cc-4372-a567-0e02b2c3d479
description: This playbook helps determine if an adversary is using fast flux DNS for command and control communications. It provides investigative questions to detect various indicators of fast flux, such as: matching DNS queries against threat intelligence feeds; identifying domains with high character-entropy and geographically diverse IP resolutions; detecting domains with a high number of resolved IPs and low TTLs; tracking rapid changes in a domain's authoritative Name Server (NS) records (double-flux); and correlating bursts of DNS queries with subsequent outbound network connections from an endpoint.
type: technique
related:
- TA0011: Command And Control
contributors:
- Zachary Szewczyk, Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
- question: Are there DNS queries or network connections matching known fast flux indicators from a threat intelligence feed?
  context: This question aims to identify immediate threats by matching internal DNS and network traffic logs against a high-confidence threat intelligence feed specifically curated for known fast flux domains and IP addresses. A match indicates a potential connection to malicious infrastructure and should be treated as a high-severity alert.
  answer_sources:
  - Zeek dns.log
  - Zeek conn.log
  - Network Egress/Internet Gateway
  - Corporate DNS Resolvers
  range: last 90 days
  queries:
  - search_technology: pseudocode
    query: |
      JOIN (dns_logs WHERE query IN fast_flux_ti_domains) OR 
           (conn_logs WHERE destination_ip IN fast_flux_ti_ips)
      CREATE high_severity_alert
- question: For hosts triggering a fast flux IOC match, is the query frequency for the malicious domain abnormally high, suggesting C2 beaconing?
  context: After an initial IOC match, this question seeks to add behavioral context. By calculating the percentile rank of the query count for the suspicious domain against all other domains queried by that same host, analysts can distinguish between a one-off event and the repetitive, periodic lookups characteristic of automated command and control beaconing. A high percentile rank (e.g., >95th) strengthens the case for an active compromise.
  answer_sources:
  - Zeek dns.log
  - Zeek conn.log
  - Network Egress/Internet Gateway
  - Corporate DNS Resolvers
  range: last 90 days
  queries:
  - search_technology: pseudocode
    query: |
      FOR each host WITH fast_flux_ioc_match:
        CALCULATE percentile_rank of query_count(malicious_domain) vs query_count(all_other_domains) in last 24h
        IF percentile_rank > 95, ESCALATE alert
- question: Can a machine learning model be used to score new IOC matches and predict their association with specific campaigns?
  context: This question proposes a more advanced, predictive approach to incident response. By training a supervised classification model with a rich feature set—combining external data from threat intelligence (like domain age) with internal network metadata (like query frequency)—analysts can score new IOC matches. This score can predict the likelihood that a domain is part of a known campaign, helping to prioritize and contextualize alerts more effectively.
  answer_sources:
  - Zeek dns.log
  - Zeek conn.log
  - Network Egress/Internet Gateway
  - Corporate DNS Resolvers
  range: last 90 days
  queries:
  - search_technology: pseudocode
    query: |
      TRAIN classification_model with features (ti_data, network_metadata)
      FOR each new ioc_match:
        SCORE with model
        PRIORITIZE based on score
- question: Are internal hosts querying domains that match known Domain Generation Algorithm (DGA) patterns?
  context: This question focuses on identifying algorithmically generated domains, a common precursor or companion to fast flux techniques. By deploying a watchlist of known DGA patterns (using regular expressions) and public DGA feeds, analysts can generate alerts when a DNS query from the internal network matches a suspicious pattern, indicating a potential malware infection attempting to locate its C2 server.
  answer_sources:
  - Zeek dns.log
  - Corporate DNS Resolvers
  - Endpoint devices
  range: last 90 days
  queries:
  - search_technology: pseudocode
    query: |
      FOR each query IN dns_logs:
        IF query MATCHES dga_watchlist (regex or feed)
        CREATE alert
- question: Are there domains with high character entropy that also resolve to a geographically or AS-diverse set of IP addresses?
  context: This question seeks to identify fast flux domains that are not on a known DGA list by looking for two key characteristics. First, a high Shannon entropy score in the domain name suggests it is randomly generated. Second, if that same domain resolves to multiple IP addresses spanning different countries or Autonomous Systems (ASNs) in a short time, it strongly suggests the use of a fast flux network to obscure C2 infrastructure.
  answer_sources:
  - Zeek dns.log
  - Corporate DNS Resolvers
  - Endpoint devices
  range: last 90 days
  queries:
  - search_technology: pseudocode
    query: |
      FOR each domain IN dns_logs within 60min_window:
        CALCULATE shannon_entropy(domain_name)
        ENRICH resolved_ips with GeoIP and ASN data
        IF entropy > 3.5 AND unique_countries(resolved_ips) > 3 OR unique_asns(resolved_ips) > 3
        FLAG as suspicious
- question: Can a machine learning model identify DGA domains and, for those domains, detect geographically dispersed IP clusters indicative of fast flux?
  context: This question outlines a two-stage machine learning approach for high-fidelity detection. First, a pre-trained model (e.g., an LSTM network) classifies domains as DGA or benign in near-real-time. Second, for domains classified as DGA, a clustering algorithm (e.g., HDBSCAN) is applied to their resolved IP addresses (enriched with location data) to identify geographically dispersed clusters, which are a hallmark of sophisticated fast flux C2 networks.
  answer_sources:
  - Zeek dns.log
  - Corporate DNS Resolvers
  - Endpoint devices
  range: last 90 days
  queries:
  - search_technology: pseudocode
    query: |
      FOR each domain IN dns_logs:
        CLASSIFY domain with dga_model
        IF classified as DGA:
          CLUSTER resolved_ips (lat, long, asn) with hdbscan
          FLAG clusters with high geographic dispersion
- question: Are any domains resolving to an unusually high number of unique IP addresses while also having a very low DNS Time-To-Live (TTL)?
  context: This question aims to detect single-flux DNS using a simple but effective rule. Fast flux networks rapidly cycle through IP addresses for a single domain, which requires a very low TTL to prevent caching. This rule alerts when a domain exhibits both behaviors simultaneously (e.g., >10 unique IPs and <300s average TTL) within a short time window, providing a strong signal of malicious activity.
  answer_sources:
  - Zeek dns.log
  - Corporate DNS Resolvers
  - Network Egress/Internet Gateway
  range: last 90 days
  queries:
  - search_technology: pseudocode
    query: |
      FOR each domain in 30min_sliding_window:
        COUNT unique_ips in 'answers'
        CALCULATE average_ttl
        IF unique_ips > 10 AND average_ttl < 300
        CREATE alert
- question: Are there domains exhibiting a 'flux ratio' (Unique IPs / Average TTL) that is anomalously high compared to a network baseline?
  context: This question introduces a quantitative metric, the 'flux ratio', to normalize and compare the 'fluxiness' of different domains. By calculating a baseline distribution of this ratio across all network domains, analysts can use statistical methods to alert on any domain whose ratio exceeds a high percentile (e.g., 99th), indicating it is a significant outlier and highly likely to be using fast flux.
  answer_sources:
  - Zeek dns.log
  - Corporate DNS Resolvers
  - Network Egress/Internet Gateway
  range: last 90 days
  queries:
  - search_technology: pseudocode
    query: |
      ESTABLISH baseline distribution of (unique_ips / avg_ttl) for all domains
      FOR each domain in 60min_window:
        CALCULATE flux_ratio = unique_ips / avg_ttl
        IF flux_ratio > 99th_percentile(baseline)
        CREATE alert
- question: Can an unsupervised machine learning model identify clusters of domains exhibiting fast flux characteristics?
  context: This question proposes using unsupervised learning to discover previously unknown fast flux activity without relying on predefined rules or signatures. By using a clustering algorithm like DBSCAN on a set of features (IP count, TTL average and standard deviation, subnet diversity), the model can group domains with similar behavior. Clusters that are identified as anomalies or that form their own distinct, dense groups represent probable fast flux domains.
  answer_sources:
  - Zeek dns.log
  - Corporate DNS Resolvers
  - Network Egress/Internet Gateway
  range: last 90 days
  queries:
  - search_technology: pseudocode
    query: |
      FOR domains in 60min_window:
        EXTRACT features (unique_ips, avg_ttl, stddev_ttl, unique_subnets)
        APPLY DBSCAN to feature set
        LABEL outlier_clusters as probable_fast_flux
- question: Are any domain zones exhibiting rapid changes in their authoritative Name Server (NS) records coupled with low TTLs, indicating double-flux DNS?
  context: This question specifically targets 'double-flux' DNS, where adversaries rotate not only the A/AAAA records but also the authoritative name servers themselves. A stateful rule can track the set of NS records for each domain zone. An alert is triggered if this set changes an abnormal number of times (e.g., >5) within 24 hours and the TTLs for those NS records are consistently low (e.g., <1800s).
  answer_sources:
  - Zeek dns.log
  - Corporate DNS Resolvers
  - External-facing authoritative DNS servers
  range: last 90 days
  queries:
  - search_technology: pseudocode
    query: |
      FOR each domain_zone in 24hr_period:
        TRACK set of NS records
        COUNT changes to NS record set
        CALCULATE average_ttl of NS records
        IF ns_set_changes > 5 AND average_ttl < 1800
        CREATE alert
- question: Can domains indicative of double-flux be identified by plotting their NS record change rate against their average NS record TTL?
  context: This question provides a data visualization and analysis method for identifying double-flux candidates. By calculating the rate of change of a domain's NS record set and the average TTL of those records over a 24-hour window, analysts can create a 2D scatter plot. Domains that are statistical outliers in the high-change-rate, low-TTL quadrant are strong candidates for double-flux activity and warrant further investigation.
  answer_sources:
  - Zeek dns.log
  - Corporate DNS Resolvers
  - External-facing authoritative DNS servers
  range: last 90 days
  queries:
  - search_technology: pseudocode
    query: |
      FOR each domain_zone in 24hr_window:
        CALCULATE ns_change_rate
        CALCULATE avg_ns_ttl
      PLOT (ns_change_rate vs avg_ns_ttl)
      FLAG domains in top-5th-percentile(change_rate) AND bottom-5th-percentile(ttl)
- question: Can dynamic graph analysis of the DNS ecosystem reveal communities with high 'churn' in their name server infrastructure, pointing to double-flux networks?
  context: This is an advanced analytics technique that models the entire DNS environment as a dynamic graph. By applying graph analysis algorithms, it's possible to detect 'communities' of related DNS nodes (domains, IPs, name servers) that exhibit high 'churn'—a rapid and frequent change in their internal structure over time. A community where the name server nodes for a domain are constantly being replaced is a powerful indicator of a double-flux C2 network.
  answer_sources:
  - Zeek dns.log
  - Corporate DNS Resolvers
  - External-facing authoritative DNS servers
  range: last 90 days
  queries:
  - search_technology: pseudocode
    query: |
      MODEL DNS data as a dynamic graph (nodes=domains,ips,ns; edges=resolutions)
      APPLY graph analysis to detect communities with high node churn
      FLAG communities where NS nodes are frequently replaced
- question: Are there instances where a DNS query for a known fast flux domain is immediately followed by a network connection from the same host to one of the resolved IPs?
  context: This question focuses on creating a high-confidence alert by correlating multiple data sources. It links a suspicious DNS query (from a fast flux IOC list) to a subsequent network connection to one of the resolved IPs, all originating from the same host within a short time frame (e.g., 60 seconds). Enriching this alert with the parent process that initiated the activity provides crucial context for incident responders.
  answer_sources:
  - Zeek dns.log
  - Zeek conn.log
  - Windows Event ID 4688
  - Windows Event ID 5156
  - Endpoint devices
  - Network Egress/Internet Gateway
  - Domain Controllers
  range: last 90 days
  queries:
  - search_technology: pseudocode
    query: |
      CORRELATE ON host_ip within 60s:
        1. dns_log.query IN fast_flux_ioc_list
        2. conn_log.dest_ip IN dns_log.answers
        3. process_log.process_id initiated connection
      ENRICH alert with process_log.parent_process
- question: Do any hosts exhibit a statistically significant burst of DNS queries to a single domain, followed by a high rate of successful connections to the resolved IPs?
  context: This question uses statistical anomaly detection to find active C2 behavior. First, it identifies a burst of DNS queries from a host by looking for a high Z-score in the query count over a short window. Second, it validates this by calculating a 'connection success ratio' (Unique IPs Connected To / Unique IPs Resolved). A high Z-score combined with a high success ratio (>0.5) strongly indicates that the host is actively communicating with a fast flux C2 network.
  answer_sources:
  - Zeek dns.log
  - Zeek conn.log
  - Windows Event ID 4688
  - Windows Event ID 5156
  - Endpoint devices
  - Network Egress/Internet Gateway
  - Domain Controllers
  range: last 90 days
  queries:
  - search_technology: pseudocode
    query: |
      FOR each host in 5min_window:
        CALCULATE z_score(dns_query_count) against 30-day baseline
        IF z_score > 3:
          CALCULATE success_ratio = unique_ips_connected / unique_ips_resolved
          IF success_ratio > 0.5, FLAG as active C2
- question: Can a per-host machine learning model detect anomalous time windows of activity, and can feature analysis confirm if a DNS query spike is the cause?
  context: This question describes an advanced, host-centric anomaly detection system. An ML model (like an LSTM autoencoder) is trained on a time-series of normal activity for each host. The model then monitors live activity, and an alert is generated if the 'reconstruction error' exceeds a threshold, indicating behavior that deviates from the norm. Post-alert, feature importance techniques (like SHAP) can be used to analyze the anomalous window and confirm if a spike in DNS queries was the primary driver of the anomaly.
  answer_sources:
  - Zeek dns.log
  - Zeek conn.log
  - Windows Event ID 4688
  - Windows Event ID 5156
  - Endpoint devices
  - Network Egress/Internet Gateway
  - Domain Controllers
  range: last 90 days
  queries:
  - search_technology: pseudocode
    query: |
      TRAIN per-host LSTM autoencoder on time-series features (dns_rate, etc.)
      FOR each host's live activity:
        CALCULATE reconstruction_error
        IF error > threshold:
          ANALYZE feature importance (SHAP) on anomalous window
          CONFIRM if dns_query_spike is primary cause