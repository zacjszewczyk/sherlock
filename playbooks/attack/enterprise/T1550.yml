name: T1550: Use Alternate Authentication Material
id: f3b1c9a0-1d2e-4f3c-8a7b-9d0e1f2a3b4c
description: This playbook helps investigators determine if an adversary is using alternate authentication material, such as stolen tickets or hashes, to bypass access controls, evade defenses, and move laterally within the environment. It focuses on detecting the use of credential theft tools like Mimikatz, identifying Pass-the-Ticket and Pass-the-Hash attacks through anomalous Kerberos and NTLM logon patterns, and spotting unusual logon behaviors like a single user accessing numerous systems in a short period or privileged accounts authenticating from non-standard workstations. The playbook also covers the detection of remote process execution and service creation that often follows the use of stolen credentials.
type: technique
related:
- TA0005: Defense Evasion
- TA0008: Lateral Movement
contributors:
- Zachary Szewczyk
- Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
- question: Have any known credential theft tools been executed or accessed on the network?
  context: This question seeks to identify direct evidence of credential dumping activity by searching for signatures of common tools like Mimikatz or Rubeus. Detecting the execution of these tools or access to their characteristic named pipes is a high-fidelity indicator that an adversary is attempting to harvest credentials to escalate privileges or move laterally.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 17 (Sysmon)
  - Windows Event ID 18 (Sysmon)
  - Zeek smb.log
  - Zeek dce_rpc.log
  - Domain Controllers, Member Servers, Privileged Access Workstations, File Servers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: search process_creation_events where process_name in ('mimikatz.exe', ...) or command_line contains ('sekurlsa::logonpasswords', ...); search named_pipe_events where pipe_name contains ('mimi', 'psexesvc', ...)
- question: Are there any instances of unusually long or complex command-line arguments for common processes that could indicate obfuscated credential theft activity?
  context: Adversaries often use obfuscated scripts or inject commands into legitimate processes like PowerShell to evade simple signature-based detection. This question uses statistical analysis (baselining length and entropy) to uncover these hidden commands, which might be used for in-memory credential dumping, thereby avoiding dropping known malicious tools to disk.
  answer_sources:
  - Windows Event ID 4688
  - Domain Controllers, Member Servers, Privileged Access Workstations, File Servers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: search process_creation_events for parent_process in ('powershell.exe', 'services.exe') | baseline command_line_length and command_line_entropy over 30 days | alert where current_value > (mean + 3*stdev)
- question: Can machine learning models identify suspicious process creation events that are indicative of credential theft, based on a combination of features?
  context: This question leverages a machine learning approach to move beyond simple rules and statistics. By training a model on various features of a process event, it can learn the subtle, combined characteristics of malicious activity, potentially identifying novel or heavily obfuscated credential theft techniques that other methods might miss.
  answer_sources:
  - Windows Event ID 4688
  - Sysmon Event ID 1
  - Domain Controllers, Member Servers, Privileged Access Workstations, File Servers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: score all process_creation_events using ML_model | alert where classification is 'malicious' and confidence_score > 0.9
- question: Have any Kerberos service tickets been requested without a preceding ticket-granting ticket request from the same source, or using weak encryption, suggesting a Pass-the-Ticket attack?
  context: A legitimate Kerberos workflow involves a user first obtaining a Ticket-Granting Ticket (TGT) before requesting a Service Ticket (TGS). A TGS request without a recent, corresponding TGT request from the same IP address is a strong indicator that a stolen TGT is being used. Additionally, the use of the weaker RC4-HMAC encryption type is often associated with Kerberoasting or other ticket-based attacks.
  answer_sources:
  - Windows Event ID 4769
  - Windows Event ID 4768
  - Zeek kerberos.log
  - Domain Controllers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: for each event_4769, lookup event_4768 where user and source_ip match within last 10 hours | alert if no match is found or if event_4769.encryption_type is 'RC4-HMAC'
- question: Are users requesting access to services (SPNs) that they rarely or have never used before?
  context: Adversaries using stolen tickets may not know what services the compromised user typically accesses. They might probe for high-value services. This question aims to detect such anomalous access attempts by baselining normal user-to-service interactions and flagging statistically rare requests.
  answer_sources:
  - Windows Event ID 4769
  - Zeek kerberos.log
  - Domain Controllers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: for each user, baseline requested_spn frequency over 30 days | for each new event_4769, check if requested_spn is in the bottom 5th percentile of user's historical requests | alert on match
- question: Is there an anomalous spike in the volume of Kerberos service ticket requests for any user, suggesting automated tool usage?
  context: Tools like Rubeus can be used to request a large number of service tickets in a short amount of time as part of a Kerberoasting attack. This behavior deviates from normal, human-driven activity. This question uses time-series analysis to detect significant deviations from a user's normal ticket request cadence.
  answer_sources:
  - Windows Event ID 4769
  - Zeek kerberos.log
  - Domain Controllers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: for each user, model event_4769 volume over time | forecast expected volume | alert if actual volume significantly exceeds forecast
- question: Have there been any unapproved processes authenticating with explicit credentials using Logon Type 9?
  context: Logon Type 9 (NewCredentials) is used when a process authenticates as a different user, for example, with 'runas'. While legitimate for some administrative tools and applications, malware can use this to escalate privileges or move laterally using stolen credentials. This question filters for this specific logon type and checks the initiating process against an allowlist.
  answer_sources:
  - Windows Event ID 4624
  - All Windows Endpoints and Servers, especially developer workstations and administrative servers.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: search logon_events where logon_type is 9 | alert if process_name is not in ('runas.exe', 'backup.exe', ...)
- question: Are there new or unusually frequent combinations of processes and accounts using explicit credentials (Logon Type 9)?
  context: This question establishes a baseline of normal Logon Type 9 activity. An adversary using a stolen credential with a common process for the first time, or an automated tool repeatedly using a specific credential, would create a new or statistically unusual pairing of process and account, which this behavioral analytic is designed to detect.
  answer_sources:
  - Windows Event ID 4624
  - All Windows Endpoints and Servers, especially developer workstations and administrative servers.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: baseline frequency of (process_name, account_name) for logon_type 9 events over 30 days | alert on new combinations or if frequency > 99th percentile
- question: Can an unsupervised machine learning model detect anomalous Logon Type 9 events based on context?
  context: This question uses an Isolation Forest model to identify unusual Logon Type 9 events that might not be caught by simple frequency analysis. The model considers multiple features together, such as the process, user, source workstation, and time of day, to find combinations that are outliers compared to established normal administrative and application behavior.
  answer_sources:
  - Windows Event ID 4624
  - All Windows Endpoints and Servers, especially developer workstations and administrative servers.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: score logon_type_9 events with isolation_forest_model using features (process, account, workstation, hour) | alert on anomalous events
- question: Has any user account rapidly logged into an excessive number of distinct systems?
  context: This question seeks to identify rapid, widespread lateral movement. An adversary who has compromised a user credential may use it to quickly access many systems. This rule uses a simple static threshold to detect this "fan-out" behavior within a short time window, which is highly uncharacteristic of normal user activity.
  answer_sources:
  - Windows Event ID 4624
  - Zeek conn.log
  - Log Aggregation Platform (SIEM), Domain Controllers, Network Flow Data Collectors
  range: last 90 days
  queries:
  - technology: pseudocode
    query: for each user, count distinct source_ips from logon_type_3 events in a 10-minute window | alert if count > 5
- question: Is any user logging on from more distinct systems than is normal for them or their peers?
  context: This question moves beyond a static threshold to a more tailored, behavioral approach. It establishes a personal baseline for each user's logon activity and compares their current activity against it. This helps reduce false positives for users who normally access many systems (like administrators) while still flagging unusual behavior for users who typically access very few.
  answer_sources:
  - Windows Event ID 4624
  - Zeek conn.log
  - Log Aggregation Platform (SIEM), Domain Controllers, Network Flow Data Collectors
  range: last 90 days
  queries:
  - technology: pseudocode
    query: for each user, baseline distinct source_systems per hour over 30 days | calculate 95th percentile | alert if current hour's count > 95th_percentile_threshold
- question: Has a user's logon behavior shifted to a different community or cluster of hosts?
  context: This question models user-to-host relationships as a graph to understand normal "communities of activity" (e.g., the finance team accessing finance servers). An adversary using a compromised account to access systems outside the user's normal community (e.g., finance user accessing developer servers) would cause a shift in their classification, indicating a significant and suspicious behavioral change.
  answer_sources:
  - Windows Event ID 4624
  - Zeek conn.log
  - Log Aggregation Platform (SIEM), Domain Controllers, Network Flow Data Collectors
  range: last 90 days
  queries:
  - technology: pseudocode
    query: model user-host logon graph and identify communities | for each new logon, classify user into a community | alert if user's predicted community changes
- question: Is there correlated network and host activity indicating remote service or process creation via tools like PsExec?
  context: This question aims to detect lateral movement techniques like those used by PsExec. By correlating network indicators of remote administration (RPC calls to `svcctl` or SMB access to `psexesvc`) with subsequent service or process creation on the target host within a very short time window, we can identify this specific toolchain with high confidence.
  answer_sources:
  - Windows Event ID 4688
  - Zeek dce_rpc.log
  - Zeek smb.log
  - Windows Event ID 7045
  - Member Servers, Privileged Access Workstations, Domain Controllers, Network Choke Points
  range: last 90 days
  queries:
  - technology: pseudocode
    query: join network_events (dce_rpc or smb) with host_events (process_creation or service_creation) on target_host and user | alert where network_event matches ('svcctl', 'psexesvc') and host_event occurs within 5 seconds
- question: Have any statistically rare parent-child process relationships been observed?
  context: Adversaries often abuse legitimate processes to execute malicious code, creating unusual process lineages. For example, a web server process should not be spawning a command shell. This question baselines normal parent-child process relationships on each host and alerts on new, rare combinations that could indicate a pivot from a compromised application.
  answer_sources:
  - Windows Event ID 4688
  - Member Servers, Privileged Access Workstations, Domain Controllers, Network Choke Points
  range: last 90 days
  queries:
  - technology: pseudocode
    query: for each host, baseline frequency of parent-child process relationships over 30 days | alert on observation of a statistically rare relationship
- question: Can a sequence of user events be identified as a probable malicious toolchain?
  context: This question uses a Hidden Markov Model (HMM) to analyze the entire sequence of a user's actions (logon, RPC, process creation) rather than individual events. By training the model on what benign administrative sessions look like, it can identify and score new sessions, flagging sequences of events that have a low probability of being legitimate and are more likely to be generated by a malicious tool like PsExec.
  answer_sources:
  - Windows Event ID 4688
  - Zeek dce_rpc.log
  - Zeek smb.log
  - Windows Event ID 7045
  - Member Servers, Privileged Access Workstations, Domain Controllers, Network Choke Points
  range: last 90 days
  queries:
  - technology: pseudocode
    query: model benign user sessions with HMM | score new user sessions | alert if session probability is low
- question: Is there evidence of a high-confidence Pass-the-Hash attack, indicated by a rapid NTLM logon followed by process or service creation?
  context: This question looks for a very specific and high-fidelity pattern of a Pass-the-Hash attack. The attack often involves an adversary using a stolen NTLM hash to authenticate to a remote machine (Logon Type 3) and immediately execute a command, which manifests as a process or service creation event under the context of that user. The tight time correlation (within 2 seconds) is key to this detection.
  answer_sources:
  - Windows Event ID 4624
  - Windows Event ID 4688
  - Windows Event ID 7045
  - All Windows Endpoints and Servers, particularly those not configured to disable NTLM.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: on event_4624 where logon_type is 3 and auth_package is 'NTLM', check for event_4688 or event_7045 with same user_sid within 2 seconds | alert on match
- question: Is there a statistical increase in the ratio of NTLM to Kerberos authentications for any user or host?
  context: In a healthy Kerberos environment, NTLM usage should be minimal. An adversary with a stolen hash (but not a password or ticket) may be forced to use Pass-the-Hash, which relies on NTLM. This question aims to detect a potential attacker by monitoring for a significant shift away from Kerberos towards NTLM authentication, which could indicate an attacker is forcing a protocol downgrade.
  answer_sources:
  - Windows Event ID 4624
  - All Windows Endpoints and Servers, particularly those not configured to disable NTLM.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: for each user and host, baseline ratio of NTLM vs Kerberos for logon_type 3 | alert if NTLM ratio increases significantly
- question: Can a machine learning model classify logon-then-execution event pairs as likely Pass-the-Hash activity?
  context: This question uses a supervised machine learning model to provide a more nuanced risk score for potential Pass-the-Hash activity. By considering features like the time delta, authentication package, user privileges, and hosts involved, the model can learn to distinguish between benign remote administration and malicious lateral movement, helping to prioritize the most suspicious events.
  answer_sources:
  - Windows Event ID 4624
  - Windows Event ID 4688
  - Windows Event ID 7045
  - All Windows Endpoints and Servers, particularly those not configured to disable NTLM.
  range: last 90 days
  queries:
  - technology: pseudocode
    query: create event pairs of (logon_type_3, subsequent_process/service_creation) | classify pairs with decision_tree_model | alert on pairs classified as malicious
- question: Has a chain of sequential network logons across multiple hosts been observed for a single user?
  context: This question is designed to detect an adversary "hopping" from one machine to another. By linking network logon events where the target machine of one logon becomes the source machine of the next, we can explicitly trace the path of lateral movement and alert when a user moves across two or more systems in a chain-like fashion within a short period.
  answer_sources:
  - Windows Event ID 4624
  - Zeek conn.log
  - Log Aggregation Platform (SIEM), Domain Controllers, Network Flow Collectors
  range: last 90 days
  queries:
  - technology: pseudocode
    query: join event_4624 with itself where event1.target_host = event2.source_host and event1.user = event2.user and event1.time < event2.time | alert if chain_length >= 2 within 60 minutes
- question: Has any host shown an anomalous increase in either outbound or inbound logon activity?
  context: Lateral movement often involves pivot points—compromised machines used to launch further attacks—or convergence points—high-value targets that many accounts are trying to access. This question models host logon activity as a graph and looks for statistical deviations in the number of incoming or outgoing logons, which could identify these key pivot or target systems.
  answer_sources:
  - Windows Event ID 4624
  - Zeek conn.log
  - Log Aggregation Platform (SIEM), Domain Controllers, Network Flow Collectors
  range: last 90 days
  queries:
  - technology: pseudocode
    query: for each host, baseline hourly in-degree and out-degree of logons over 30 days | alert if current hour's value > (mean + 3*stdev)
- question: Is there an anomalous increase in the number of new lateral movement paths being discovered in the environment?
  context: This question takes a macro view of lateral movement across the entire network. By mapping all logon paths and then using a time-series model to forecast how many new paths are expected on a given day, it can detect a widespread campaign. A significant deviation from the forecast suggests that an adversary is actively exploring and moving through the network on a larger scale than usual.
  answer_sources:
  - Windows Event ID 4624
  - Zeek conn.log
  - Log Aggregation Platform (SIEM), Domain Controllers, Network Flow Collectors
  range: last 90 days
  queries:
  - technology: pseudocode
    query: model daily count of new lateral movement paths (length > 1) using time-series forecast | alert if actual count significantly exceeds forecast
- question: Has a privileged account logged on from a non-approved workstation?
  context: This question enforces a strict security policy known as Tiered Access or Privileged Access Workstation (PAW) management. Highly privileged accounts (like Domain Admins) should only ever be used from dedicated, hardened administrative workstations. Any logon from a standard user endpoint is a major security violation and a strong indicator of credential compromise.
  answer_sources:
  - Windows Event ID 4624
  - Zeek conn.log
  - Domain Controllers, Privileged Access Workstations (PAWs), Tier 0/1 Servers, Log Aggregation Platform (SIEM)
  range: last 90 days
  queries:
  - technology: pseudocode
    query: for logon_events where user in ('Domain Admins') and logon_type in (3, 10), alert if source_workstation is not in approved_PAW_list
- question: Is a privileged account exhibiting logon behavior that is inconsistent with its established patterns?
  context: This question creates a multi-faceted behavioral profile for each privileged account, learning their normal source/destination systems, protocols, and times of activity. It flags any logon that deviates from this established "pattern of life," which could indicate an adversary using the compromised credential in a way that is abnormal for the legitimate user.
  answer_sources:
  - Windows Event ID 4624
  - Zeek conn.log
  - Domain Controllers, Privileged Access Workstations (PAWs), Tier 0/1 Servers, Log Aggregation Platform (SIEM)
  range: last 90 days
  queries:
  - technology: pseudocode
    query: for each privileged_user, baseline logon behavior (source, destination, protocol, hour) | alert if new logon falls outside the established profile
- question: Can a machine learning model identify anomalous logon events for privileged users?
  context: This question uses a One-Class SVM, an unsupervised learning algorithm ideal for anomaly detection, to create a complex, high-dimensional boundary of normal behavior for each privileged user. This is more powerful than simple baselining as it can detect unusual combinations of features. Any new logon that falls outside this learned boundary is flagged as a potential credential compromise.
  answer_sources:
  - Windows Event ID 4624
  - Zeek conn.log
  - Domain Controllers, Privileged Access Workstations (PAWs), Tier 0/1 Servers, Log Aggregation Platform (SIEM)
  range: last 90 days
  queries:
  - technology: pseudocode
    query: for each privileged_user, train one-class_svm model on historical logon data | score new logon events | alert if classified as an outlier