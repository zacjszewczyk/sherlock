name: T1535: Unused-Unsupported Cloud Regions
id: f5d8a9c3-1b6e-4f2a-8d9c-7e0a1b2c3d4e
description: This playbook addresses the threat of adversaries evading defenses by operating in unused or unsupported cloud regions. It focuses on detecting suspicious activities such as API calls originating from malicious IPs or using malicious images, rapid sequences of resource and user setup calls, resource creation in regions not on the organization's allow-list, modifications that weaken security posture, and anomalous outbound network traffic indicative of C2 communication or data exfiltration from resources in these unapproved regions.
type: technique
related:
  - TA0005: Defense Evasion
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: Are API calls originating from known malicious IP addresses or utilizing known malicious image IDs, particularly in unapproved regions?
    context: This question aims to identify direct indicators of compromise by correlating cloud audit logs with external threat intelligence. An adversary might use compromised infrastructure (identified by IP) or pre-configured malicious virtual machine images (identified by AMI/image ID) to establish a foothold. Detecting such activity, especially in regions where the organization does not operate, is a strong signal of an attempted breach.
    answer_sources:
      - AWS CloudTrail logs
      - Azure Activity Logs
      - GCP Audit Logs
      - Threat Intelligence Feed
      - Cloud Provider Management Console/API Endpoints
      - Threat Intelligence Platform
      - Cloud Provider Image Marketplace
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH cloud_audit_logs WHERE (source_ip IN malicious_ip_feed OR image_id IN malicious_image_id_feed). ALERT if region is unapproved.
  - question: Are there statistically rare source IP addresses or user agents successfully authenticating and performing high-privilege actions in unapproved cloud regions?
    context: Adversaries often use new or temporary infrastructure for their attacks, resulting in source IPs and user agents that are not commonly seen in an organization's logs. This question helps uncover these 'first-use' or 'low and slow' activities. By calculating the frequency of these attributes, we can flag events that deviate from normal operational patterns, especially when they involve sensitive actions in regions that are not typically used.
    answer_sources:
      - AWS CloudTrail logs
      - Azure Activity Logs
      - GCP Audit Logs
      - Threat Intelligence Feed
      - Cloud Provider Management Console/API Endpoints
      - Threat Intelligence Platform
      - Cloud Provider Image Marketplace
    range: last 90 days
    queries:
      - technology: pseudocode
        query: CALCULATE frequency of source_ip and user_agent over 90 days. ALERT if source_ip_frequency < 5th_percentile AND action is high-privilege AND region is unapproved.
  - question: Can we use machine learning to predict whether an API call is malicious based on its attributes, especially for events occurring in unapproved regions?
    context: This question leverages machine learning to build a predictive model that can identify complex, non-obvious patterns of malicious behavior. By training a model on features like IP reputation, geolocation, time of day, and API call type, it can learn to distinguish between legitimate and malicious activity with higher accuracy than simple rule-based methods. This is particularly effective for detecting novel attack techniques in unusual cloud regions.
    answer_sources:
      - AWS CloudTrail logs
      - Azure Activity Logs
      - GCP Audit Logs
      - Threat Intelligence Feed
      - Cloud Provider Management Console/API Endpoints
      - Threat Intelligence Platform
      - Cloud Provider Image Marketplace
    range: last 90 days
    queries:
      - technology: pseudocode
        query: TRAIN classification_model on features (ip_rep, geo, time, user_agent_rarity, api_call). PREDICT probability_of_malice for new API calls. ALERT if probability > threshold AND region is unapproved.
  - question: Is there a rapid sequence of user creation, key generation, and resource deployment API calls occurring in an unapproved region?
    context: Adversaries often follow a predictable pattern after gaining initial access: create a new user for persistence, generate access keys for that user, and then use those keys to deploy resources (like virtual machines for C2 or cryptomining). Detecting this specific sequence within a short time frame, especially in an unused region, is a high-fidelity indicator of an active compromise.
    answer_sources:
      - AWS CloudTrail logs
      - Azure Activity Logs
      - GCP Audit Logs
      - Cloud Provider Management Console/API Endpoints
      - Identity and Access Management (IAM) Service Endpoints
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH for sequence ('CreateUser' -> 'CreateAccessKey' -> 'RunInstances') by same user_identity within 15 minutes. ALERT if region is unapproved.
  - question: Is there a statistically significant increase in the variety (entropy) of API calls made by a single user in a historically unused region?
    context: A user's normal activity typically involves a limited set of repetitive API calls. When an adversary compromises an account or creates a new one, their actions—exploring the environment, escalating privileges, deploying resources—result in a much more diverse and less predictable sequence of API calls. Measuring the Shannon entropy of these call sequences can quantify this randomness. A sudden spike in entropy for a user, particularly in an unapproved region, suggests anomalous and potentially malicious activity.
    answer_sources:
      - AWS CloudTrail logs
      - Azure Activity Logs
      - GCP Audit Logs
      - Cloud Provider Management Console/API Endpoints
      - Identity and Access Management (IAM) Service Endpoints
    range: last 90 days
    queries:
      - technology: pseudocode
        query: CALCULATE Shannon entropy of event_name sequence per user per region in 1-hour windows. ALERT if entropy > (user_baseline + 2 * std_dev) AND region is unused.
  - question: Can a sequence-based machine learning model detect anomalous patterns of API calls in unapproved regions that deviate from learned legitimate behavior?
    context: This question uses an autoencoder, a type of neural network, to learn the 'normal' sequences of API calls for developers and administrators. The model is trained to reconstruct legitimate sequences accurately. When an anomalous sequence, such as one generated by an attacker, is fed into the model, it will struggle to reconstruct it, resulting in a high 'reconstruction error'. This method is powerful for detecting novel or sophisticated attack patterns that do not match predefined rules.
    answer_sources:
      - AWS CloudTrail logs
      - Azure Activity Logs
      - GCP Audit Logs
      - Cloud Provider Management Console/API Endpoints
      - Identity and Access Management (IAM) Service Endpoints
    range: last 90 days
    queries:
      - technology: pseudocode
        query: TRAIN seq2seq autoencoder on legitimate API call sequences. FEED real-time sequences to model. ALERT if reconstruction_error > threshold AND region is unapproved.
  - question: Are cloud resources being created in regions that are not on the organization's approved allow-list?
    context: This is a fundamental security question. Organizations should operate only in specific, approved cloud regions to maintain security posture, ensure data residency, and control costs. Any resource creation outside of this defined set of regions is a direct violation of policy and a strong indicator of either misconfiguration or malicious activity. This can be enforced preventatively (e.g., with SCPs) or detected via audit logs.
    answer_sources:
      - AWS CloudTrail logs
      - Azure Activity Logs
      - GCP Audit Logs
      - Service Control Policies (SCPs) or equivalent preventative control logs
      - Organization's allow-list of approved cloud regions
      - Cloud Provider Management Console/API Endpoints
      - Cloud account/organization-level policy enforcement points
    range: last 90 days
    queries:
      - technology: pseudocode
        query: MAINTAIN allow-list of regions. SEARCH for resource creation events. ALERT if event_region NOT IN allow-list.
  - question: Are active resources statistically appearing in cloud regions that have historically been empty?
    context: This question provides a different angle on detecting activity in unused regions. Instead of relying solely on event logs, it involves actively inventorying resources across all possible regions. For any region that has had a baseline of zero active resources over a long period (e.g., 90 days), the appearance of even a single new resource is a highly anomalous event that warrants immediate investigation.
    answer_sources:
      - AWS CloudTrail logs
      - Azure Activity Logs
      - GCP Audit Logs
      - Service Control Policies (SCPs) or equivalent preventative control logs
      - Organization's allow-list of approved cloud regions
      - Cloud Provider Management Console/API Endpoints
      - Cloud account/organization-level policy enforcement points
    range: last 90 days
    queries:
      - technology: pseudocode
        query: PERIODICALLY query all regions for active resources. MAINTAIN 90-day baseline of resource count per region. ALERT if resource_count > 0 for a region where baseline_mean is 0.
  - question: Does the number of active resources in a non-primary region exceed the amount predicted by a time series forecasting model?
    context: For regions that may have some sporadic but legitimate use, a simple 'is greater than zero' check isn't sufficient. This question uses a time series model (like ARIMA) to forecast the expected number of resources in a given region based on historical data. If the actual number of resources suddenly spikes and exceeds the model's predicted upper limit, it signifies a statistically significant and unexpected increase in activity that could be malicious.
    answer_sources:
      - AWS CloudTrail logs
      - Azure Activity Logs
      - GCP Audit Logs
      - Service Control Policies (SCPs) or equivalent preventative control logs
      - Organization's allow-list of approved cloud regions
      - Cloud Provider Management Console/API Endpoints
      - Cloud account/organization-level policy enforcement points
    range: last 90 days
    queries:
      - technology: pseudocode
        query: TRAIN time series model on daily resource count per region. FORECAST expected count and confidence interval. ALERT if actual_count > upper_confidence_interval for a non-primary region.
  - question: Are API calls that weaken security posture being executed in unapproved cloud regions?
    context: Adversaries often need to disable security controls to carry out their objectives. This question focuses on detecting specific, high-risk API calls (e.g., stopping logging, deleting trails, or opening firewalls to the world) that directly degrade an environment's security. When these actions occur in an unapproved region, it is a critical red flag, as it may be a precursor to a larger attack.
    answer_sources:
      - AWS CloudTrail logs
      - Azure Activity Logs
      - GCP Audit Logs
      - Cloud Security Configuration Management Database
      - Cloud Provider Management Console/API Endpoints
      - Network Security Group / Firewall Rule configurations
    range: last 90 days
    queries:
      - technology: pseudocode
        query: MAINTAIN watchlist of security-degrading API calls. SEARCH for these calls in logs. ALERT if call is on watchlist AND region is unapproved.
  - question: Are statistically rare resource types being created, or is there a statistical increase in security-modifying API calls, within an unapproved region?
    context: This question uses statistical analysis to find two types of anomalies. First, adversaries may deploy unusual resource types (e.g., expensive GPU instances for cryptomining) that are not typically used by the organization. Second, a sudden burst of security-modifying API calls in an unapproved region, even if the individual calls are not on a watchlist, can indicate malicious activity. Both scenarios compare activity in unapproved regions against a baseline of normal behavior.
    answer_sources:
      - AWS CloudTrail logs
      - Azure Activity Logs
      - GCP Audit Logs
      - Cloud Security Configuration Management Database
      - Cloud Provider Management Console/API Endpoints
      - Network Security Group / Firewall Rule configurations
    range: last 90 days
    queries:
      - technology: pseudocode
        query: BASELINE frequency of instance types in approved regions. ALERT if instance created in unapproved region has type_frequency < 1%. SEPARATELY, ALERT if rate of security-modifying calls in unapproved region > (mean + 3 * std_dev).
  - question: Can an unsupervised machine learning model identify highly anomalous API call events, particularly those occurring in unapproved regions?
    context: This question applies unsupervised learning (like Isolation Forest) to find outliers without prior labeling of 'good' or 'bad' behavior. The model analyzes multiple features of an API call (user, IP, action, region, parameters) simultaneously to calculate an 'anomaly score'. This approach is excellent at catching novel or unusual combinations of attributes that would be missed by rules or single-variate statistical checks, with a focus on investigating high-scoring events in unapproved regions.
    answer_sources:
      - AWS CloudTrail logs
      - Azure Activity Logs
      - GCP Audit Logs
      - Cloud Security Configuration Management Database
      - Cloud Provider Management Console/API Endpoints
      - Network Security Group / Firewall Rule configurations
    range: last 90 days
    queries:
      - technology: pseudocode
        query: TRAIN unsupervised anomaly model (e.g., Isolation Forest) on API call features. SCORE all events. ALERT on high anomaly scores, especially in unapproved regions.
  - question: Is outbound network traffic from a resource in an unapproved region communicating with known malicious destinations like C2 servers or cryptomining pools?
    context: Once an adversary deploys a resource, it often needs to 'call home' to a command-and-control (C2) server or connect to a cryptomining pool. This question aims to detect this malicious communication by correlating network and DNS logs from resources in unapproved regions against threat intelligence feeds. A confirmed match is a high-confidence indicator of compromise.
    answer_sources:
      - AWS VPC Flow Logs
      - Azure NSG Flow Logs
      - Zeek conn.log
      - Zeek dns.log
      - Windows Sysmon Event ID 3: Network Connection
      - Virtual Private Cloud (VPC) Egress points
      - Cloud Network Flow Log Aggregation Point
      - DNS Resolvers
      - Virtual Machines in unapproved cloud regions
    range: last 90 days
    queries:
      - technology: pseudocode
        query: SEARCH network and DNS logs from unapproved regions. CORRELATE destination_ip and dns_query against C2/cryptomining threat feeds. ALERT on match.
  - question: Is there statistically anomalous outbound network activity, such as unusual connection sizes/durations or high DNS query entropy (DGA), from resources in unapproved regions?
    context: Adversary C2 traffic often exhibits statistical anomalies. Connections might be unusually long or short, or transfer unusual amounts of data (e.g., beaconing or data exfiltration). Furthermore, Domain Generation Algorithms (DGA) used by malware result in a high variety of random-looking DNS queries, leading to high entropy. This question seeks to detect these statistical deviations from normal network behavior for resources in unapproved regions.
    answer_sources:
      - AWS VPC Flow Logs
      - Azure NSG Flow Logs
      - Zeek conn.log
      - Zeek dns.log
      - Windows Sysmon Event ID 3: Network Connection
      - Virtual Private Cloud (VPC) Egress points
      - Cloud Network Flow Log Aggregation Point
      - DNS Resolvers
      - Virtual Machines in unapproved cloud regions
    range: last 90 days
    queries:
      - technology: pseudocode
        query: BASELINE connection duration/bytes for resource types. ALERT if connection from unapproved region > (baseline + 3 * std_dev). SEPARATELY, calculate DNS query entropy per host; ALERT on high entropy.
  - question: Can machine learning models detect anomalous egress data volumes or identify patterns of C2 beaconing from resources in unapproved regions?
    context: This question applies two machine learning techniques to network data. A time series model can forecast expected data egress volume, flagging significant, unexpected spikes that could indicate data exfiltration. A clustering algorithm can analyze connection metadata (port, protocol, duration, byte counts) to find groups of repetitive, periodic connections ('heartbeats') that are characteristic of C2 beaconing, even if the destination isn't on a known threat list.
    answer_sources:
      - AWS VPC Flow Logs
      - Azure NSG Flow Logs
      - Zeek conn.log
      - Zeek dns.log
      - Windows Sysmon Event ID 3: Network Connection
      - Virtual Private Cloud (VPC) Egress points
      - Cloud Network Flow Log Aggregation Point
      - DNS Resolvers
      - Virtual Machines in unapproved cloud regions
    range: last 90 days
    queries:
      - technology: pseudocode
        query: FORECAST egress volume per region; ALERT if actual > forecast. SEPARATELY, CLUSTER connection metadata; ALERT on clusters matching beaconing profile (e.g., regular interval, similar size).