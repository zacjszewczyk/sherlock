name: T1535: Unused-Unsupported Cloud Regions
id: 5c9f1a8e-7d6b-4e3f-8a9c-0d1e2f3b4c5d
description: This playbook helps identify adversarial activity where defenses are evaded by operating in cloud regions that are not used or supported by the organization. This involves detecting anomalous API calls from malicious sources, suspicious sequences of resource and user setup activities, the creation of any resources in unapproved regions, modifications to weaken security controls, and unusual network egress patterns like data exfiltration or connections to known malicious infrastructure.
type: technique
related:
- TA0005: Defense Evasion
contributors:
- Zachary Szewczyk
- Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
investigative_questions:
- question: Are there any cloud API calls originating from known malicious IP addresses or using known malicious image IDs, particularly in unapproved regions?
  context: Adversaries often leverage compromised infrastructure or known malicious tools to conduct their operations. This question aims to identify direct indicators of compromise by checking if the source IP address of an API call or the image ID used to create a resource (like an EC2 instance) is listed in a threat intelligence feed. A match, especially for an action occurring in an unusual or unapproved cloud region, is a strong signal of malicious activity and an attempt to operate outside of standard security monitoring zones.
  answer_sources:
  - AWS CloudTrail logs
  - Azure Activity Logs
  - GCP Audit Logs
  - Threat Intelligence Feed
  - Cloud Provider Management Console/API Endpoints
  - Threat Intelligence Platform
  - Cloud Provider Image Marketplace
  range: Last 90 days
  queries:
  - technology: Pseudocode
    query: JOIN cloud_audit_logs ON (source_ip) WITH threat_intel_feed ON (malicious_ip) WHERE event_time > T-90d. ALSO, JOIN cloud_audit_logs ON (image_id) WITH threat_intel_feed ON (malicious_image_id) WHERE event_time > T-90d. FILTER for events in unapproved regions.
- question: Have any high-privilege API calls in unapproved regions been initiated from statistically rare source IP addresses or user agents?
  context: Adversaries often use new or temporary infrastructure for their attacks, resulting in source IPs and user agents that are not commonly seen within an organization's environment. This question focuses on identifying these statistical outliers. By calculating the historical frequency of source IPs and user agents, we can flag events that deviate from the established baseline. A rare IP combined with a rare user agent performing a sensitive action in a region with no legitimate business use is highly suspicious.
  answer_sources:
  - AWS CloudTrail logs
  - Azure Activity Logs
  - GCP Audit Logs
  - Threat Intelligence Feed
  - Cloud Provider Management Console/API Endpoints
  - Threat Intelligence Platform
  - Cloud Provider Image Marketplace
  range: Last 90 days
  queries:
  - technology: Pseudocode
    query: CALCULATE frequency of source_ip and user_agent over 90 days. FIND API calls in unapproved regions where source_ip_frequency < 5th_percentile AND user_agent_frequency is low. PRIORITIZE high-privilege actions (e.g., RunInstances).
- question: Can we use a machine learning model to predict and identify malicious cloud API calls based on a combination of factors, especially in unapproved regions?
  context: Individual indicators can sometimes be benign, but a combination of suspicious factors often points to malicious activity. This question proposes using a machine learning model to analyze multiple features of an API call—such as IP reputation, geolocation, time of day, user agent rarity, and the specific API call—to calculate a risk score. This holistic approach can detect complex, novel, or subtle attack patterns that might be missed by simple symbolic rules, with a particular focus on flagging high-risk events in regions where they should not occur.
  answer_sources:
  - AWS CloudTrail logs
  - Azure Activity Logs
  - GCP Audit Logs
  - Threat Intelligence Feed
  - Cloud Provider Management Console/API Endpoints
  - Threat Intelligence Platform
  - Cloud Provider Image Marketplace
  range: Last 90 days
  queries:
  - technology: Pseudocode
    query: INPUT api_call_features (ip_rep, asn, geo, time, user_agent, event_name) INTO classification_model. ALERT on events with high malicious_probability_score WHERE region is unapproved.
- question: Has a known sequence of suspicious setup API calls (e.g., CreateUser, CreateAccessKey, RunInstances) been executed by a single user within a short time frame in an unapproved region?
  context: Adversaries often follow a predictable script after gaining initial access: create a new user, generate credentials for persistence, and then provision resources for their objectives. This question aims to detect this specific, logical chain of events. Identifying this sequence occurring in rapid succession, especially in a non-standard or unapproved region, is a strong indicator of an adversary establishing a foothold.
  answer_sources:
  - AWS CloudTrail logs
  - Azure Activity Logs
  - GCP Audit Logs
  - Cloud Provider Management Console/API Endpoints
  - Identity and Access Management (IAM) Service Endpoints
  range: Last 90 days
  queries:
  - technology: Pseudocode
    query: SEARCH for event_sequence ['CreateUser', 'CreateAccessKey', 'RunInstances'] FROM same_user WITHIN 15m. ALERT if event_region is in unapproved_list.
- question: Has any user identity exhibited a sudden and significant increase in the variety of API calls (entropy) within a historically unused region?
  context: Normal user activity often involves a repetitive and limited set of API calls. In contrast, an adversary exploring an environment or setting up new infrastructure will likely use a wide and unusual variety of commands. This question uses Shannon entropy to statistically measure this variety. A sharp spike in API call entropy for a specific user in an unused region suggests a deviation from normal behavior and could represent reconnaissance or setup activities.
  answer_sources:
  - AWS CloudTrail logs
  - Azure Activity Logs
  - GCP Audit Logs
  - Cloud Provider Management Console/API Endpoints
  - Identity and Access Management (IAM) Service Endpoints
  range: Last 90 days
  queries:
  - technology: Pseudocode
    query: GROUP api_calls by user, region, 1h_window. CALCULATE shannon_entropy of event_names. ALERT if entropy > (user_baseline_entropy + 2*stdev) AND region is historically unused.
- question: Are there any sequences of API calls in unapproved regions that a machine learning model identifies as deviating from learned, legitimate user behavior patterns?
  context: This question leverages a more advanced machine learning approach to understand 'normal' sequences of operations for users in the cloud environment. An autoencoder is trained on vast amounts of legitimate API call sequences to learn what constitutes typical workflows. When a new sequence of events is observed, the model attempts to reconstruct it. If the reconstruction error is high, it means the sequence is anomalous and does not fit learned patterns. This is particularly powerful for detecting novel attack techniques in unusual regions.
  answer_sources:
  - AWS CloudTrail logs
  - Azure Activity Logs
  - GCP Audit Logs
  - Cloud Provider Management Console/API Endpoints
  - Identity and Access Management (IAM) Service Endpoints
  range: Last 90 days
  queries:
  - technology: Pseudocode
    query: INPUT real_time_api_sequence INTO seq2seq_autoencoder_model. ALERT if reconstruction_error > threshold AND region is unapproved.
- question: Have any resources (e.g., virtual machines, storage buckets, databases) been created in a cloud region that is not on the organization's approved allow-list?
  context: This is a fundamental security check. Organizations should operate only in specific, approved cloud regions to simplify management, ensure compliance, and reduce their attack surface. This question aims to enforce this policy by directly checking if any resource creation events occur outside of the designated regions. This is often the most direct and high-fidelity way to detect this technique and can be implemented as a preventative control.
  answer_sources:
  - AWS CloudTrail logs
  - Azure Activity Logs
  - GCP Audit Logs
  - Service Control Policies (SCPs) or equivalent preventative control logs
  - Organization's allow-list of approved cloud regions
  - Cloud Provider Management Console/API Endpoints
  - Cloud account/organization-level policy enforcement points
  range: Last 90 days
  queries:
  - technology: Pseudocode
    query: SEARCH for resource_creation_events (e.g., RunInstances, CreateBucket). ALERT if event_region NOT IN approved_region_list.
- question: Are there any active resources present in cloud regions that have historically had zero resources?
  context: This question provides a state-based, rather than event-based, method of detection. Instead of watching logs for creation events, it periodically scans all possible cloud regions to inventory active resources. If a resource suddenly appears in a region that has been empty for the last 90 days (or longer), it signifies a change in state that warrants immediate investigation, as it bypasses the need to catch the specific creation log.
  answer_sources:
  - AWS CloudTrail logs
  - Azure Activity Logs
  - GCP Audit Logs
  - Service Control Policies (SCPs) or equivalent preventative control logs
  - Organization's allow-list of approved cloud regions
  - Cloud Provider Management Console/API Endpoints
  - Cloud account/organization-level policy enforcement points
  range: Last 90 days
  queries:
  - technology: Pseudocode
    query: SCHEDULE hourly_script. FOREACH region in all_cloud_regions: GET active_resource_count. CALCULATE baseline_count over 90d. ALERT if current_count > 0 AND baseline_count == 0.
- question: Has the number of active resources in any non-primary cloud region anomalously exceeded the forecasted count based on historical data?
  context: For organizations that may have sporadic or low-volume legitimate activity in non-primary regions, a simple 'count > 0' alert might be too noisy. This question uses a time series forecasting model to predict the expected number of resources in each region. An alert is only triggered if the actual count significantly surpasses the model's prediction, indicating a statistically unusual increase in activity that is unlikely to be part of normal operations.
  answer_sources:
  - AWS CloudTrail logs
  - Azure Activity Logs
  - GCP Audit Logs
  - Service Control Policies (SCPs) or equivalent preventative control logs
  - Organization's allow-list of approved cloud regions
  - Cloud Provider Management Console/API Endpoints
  - Cloud account/organization-level policy enforcement points
  range: Last 90 days
  queries:
  - technology: Pseudocode
    query: FOR EACH non_primary_region: INPUT daily_resource_count_history INTO time_series_model. GET forecasted_count and confidence_interval. ALERT if actual_count > upper_confidence_bound.
- question: Have any API calls known to weaken security posture (e.g., stopping logging, opening firewalls to the internet) occurred in an unapproved region?
  context: Adversaries often need to modify security controls to enable their objectives, such as exfiltrating data or establishing command and control. This question focuses on detecting these explicit defense evasion actions. By monitoring a specific watchlist of high-risk API calls, an alert can be generated when such an action takes place in an unapproved region, where there is no legitimate reason for such changes to occur.
  answer_sources:
  - AWS CloudTrail logs
  - Azure Activity Logs
  - GCP Audit Logs
  - Cloud Security Configuration Management Database
  - Cloud Provider Management Console/API Endpoints
  - Network Security Group / Firewall Rule configurations
  range: Last 90 days
  queries:
  - technology: Pseudocode
    query: SEARCH for api_call IN security_degradation_watchlist (e.g., StopLogging, UpdateSecurityGroup with '0.0.0.0/0'). ALERT if event_region IN unapproved_list.
- question: Have any statistically rare activities occurred in unapproved regions, such as the creation of an uncommon resource type or an unusual spike in security-modifying API calls?
  context: This question looks for two types of statistical anomalies. First, adversaries may use specialized or expensive resource types (e.g., GPU instances for cryptomining) that are not typically used in the organization. Second, a burst of security configuration changes can indicate an adversary preparing the environment. By baselining normal resource types and the rate of security changes in approved regions, we can detect deviations in unapproved regions that signal malicious intent.
  answer_sources:
  - AWS CloudTrail logs
  - Azure Activity Logs
  - GCP Audit Logs
  - Cloud Security Configuration Management Database
  - Cloud Provider Management Console/API Endpoints
  - Network Security Group / Firewall Rule configurations
  range: Last 90 days
  queries:
  - technology: Pseudocode
    query: 1. BASELINE instance_type_frequency in approved regions. ALERT on resource_creation in unapproved region if instance_type_frequency < 1%. 2. BASELINE daily_rate of security_api_calls per region. ALERT if daily_rate in unapproved region > (mean + 3*stdev).
- question: Can an unsupervised machine learning model identify highly anomalous API call events, particularly those occurring in unapproved regions?
  context: This question proposes using a model that can learn 'normal' activity without being explicitly trained on labeled malicious data. By analyzing multiple features of an API call (user, source, action, region, parameters), an algorithm like Isolation Forest can assign an anomaly score to each event. This allows for the detection of novel or unusual combinations of activities that don't fit any predefined rule. High-scoring events in unapproved regions should be prioritized for immediate investigation.
  answer_sources:
  - AWS CloudTrail logs
  - Azure Activity Logs
  - GCP Audit Logs
  - Cloud Security Configuration Management Database
  - Cloud Provider Management Console/API Endpoints
  - Network Security Group / Firewall Rule configurations
  range: Last 90 days
  queries:
  - technology: Pseudocode
    query: INPUT api_call_features (user, ip, event, region, params) INTO isolation_forest_model. GET anomaly_score. ALERT on events with high_score WHERE region is unapproved.
- question: Is any resource in an unapproved region communicating with known malicious destinations, such as C2 servers or cryptomining pools?
  context: Once an adversary deploys a resource, its primary purpose is often to communicate with external infrastructure for command and control or to perform malicious actions like cryptomining. This question seeks to detect this communication by correlating network and DNS logs against threat intelligence feeds. A match provides a high-confidence indicator that a resource in an unapproved region is compromised or malicious.
  answer_sources:
  - AWS VPC Flow Logs
  - Azure NSG Flow Logs
  - Zeek conn.log
  - Zeek dns.log
  - Windows Sysmon Event ID 3: Network Connection
  - Virtual Private Cloud (VPC) Egress points
  - Cloud Network Flow Log Aggregation Point
  - DNS Resolvers
  - Virtual Machines in unapproved cloud regions
  range: Last 90 days
  queries:
  - technology: Pseudocode
    query: JOIN network_logs ON (destination_ip) WITH threat_intel ON (malicious_ip). JOIN dns_logs ON (query) WITH threat_intel ON (malicious_domain). ALERT on match WHERE source_resource_region is unapproved.
- question: Is any resource in an unapproved region exhibiting statistically anomalous network behavior, such as unusually long connections, large data transfers, or high DNS query entropy?
  context: Adversary network traffic often has different characteristics than normal application traffic. This can manifest as large, unexplained data transfers (exfiltration), long-lived connections (C2 channels), or a high variety of random-looking DNS queries (DGA). This question uses statistical methods to baseline normal network behavior and alert on deviations, such as connections that are longer or larger than normal, or a spike in DNS entropy that could indicate DGA activity.
  answer_sources:
  - AWS VPC Flow Logs
  - Azure NSG Flow Logs
  - Zeek conn.log
  - Zeek dns.log
  - Windows Sysmon Event ID 3: Network Connection
  - Virtual Private Cloud (VPC) Egress points
  - Cloud Network Flow Log Aggregation Point
  - DNS Resolvers
  - Virtual Machines in unapproved cloud regions
  range: Last 90 days
  queries:
  - technology: Pseudocode
    query: 1. BASELINE connection duration and bytes_sent per resource_type. ALERT if new_connection in unapproved region > (mean + 3*stdev). 2. CALCULATE shannon_entropy of DNS queries per host over 5m. ALERT if entropy > threshold.
- question: Can machine learning models detect anomalous data exfiltration volumes or C2-like beaconing patterns from resources in unapproved regions?
  context: This question applies two machine learning techniques to network data. First, a time series model forecasts expected data egress, flagging any unexpected spikes that could represent data exfiltration. Second, a clustering algorithm groups network connections based on their metadata (port, protocol, size, timing). This can automatically identify periodic, 'heartbeat' connections that are characteristic of C2 beaconing, without needing a predefined signature.
  answer_sources:
  - AWS VPC Flow Logs
  - Azure NSG Flow Logs
  - Zeek conn.log
  - Zeek dns.log
  - Windows Sysmon Event ID 3: Network Connection
  - Virtual Private Cloud (VPC) Egress points
  - Cloud Network Flow Log Aggregation Point
  - DNS Resolvers
  - Virtual Machines in unapproved cloud regions
  range: Last 90 days
  queries:
  - technology: Pseudocode
    query: 1. FORECAST hourly_egress_volume using time_series_model. ALERT if actual_volume > forecast. 2. CLUSTER connection_logs using (port, proto, duration, bytes). INVESTIGATE clusters with beaconing characteristics.