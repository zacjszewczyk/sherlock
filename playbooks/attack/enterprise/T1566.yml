name: T1566: Phishing
id: f47ac10b-58cc-4372-a567-0e02b2c3d479
description: This playbook helps investigate whether an adversary has gained initial access to the network via phishing. It covers indicators such as network traffic matching threat intelligence, emails with suspicious characteristics (e.g., spoofed headers, deceptive filenames), unusual process creation events originating from user applications (e.g., Office spawning PowerShell), multi-stage event sequences involving newly registered domains, anomalous email patterns from external senders, and credential submissions to low-reputation websites.
type: technique
related:
- TA0001: Initial Access
contributors:
- Zachary Szewczyk
- Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
- question: How can we detect if network activity (email, web, file downloads) involves known malicious indicators from threat intelligence feeds?
  context: This question aims to identify direct matches between our network logs and commercial or open-source threat intelligence (CTI). A match is a strong signal that an adversary is using known malicious infrastructure or malware against our environment. Continuously monitoring for these hits is a foundational detection strategy.
  answer_sources:
  - Zeek files.log
  - Zeek smtp.log
  - Zeek http.log
  - Zeek conn.log
  - Zeek dns.log
  - Email Gateway
  - Web Proxy
  - DNS Resolvers
  - User Endpoints
  range: last 90 days
  queries:
  - pseudocode: SEARCH (Zeek logs OR proxy logs OR DNS logs) WHERE (URL OR domain OR IP OR file_hash) IN (CTI_feed) | GENERATE high-severity alert
- question: How can we statistically monitor our threat intelligence feeds for operational health and detect anomalous patterns in indicator hits?
  context: This question focuses on the integrity of our CTI pipeline and the nature of the threats we're seeing. A drop in the hit rate could mean a feed is broken, leaving us blind. A sudden spike in a rare type of indicator might signal a new, targeted campaign that differs from common opportunistic attacks.
  answer_sources:
  - Zeek files.log
  - Zeek smtp.log
  - Zeek http.log
  - Zeek conn.log
  - Zeek dns.log
  - Email Gateway
  - Web Proxy
  - DNS Resolvers
  - User Endpoints
  range: last 90 days
  queries:
  - pseudocode: CALCULATE daily hit_rate per CTI_source | ALERT if hit_rate == 0. CALCULATE historical probability of indicator_type | ALERT if frequency spikes in 24h window.
- question: Can we use machine learning to prioritize CTI matches and reduce false positives by predicting the likelihood of a true positive event?
  context: Raw CTI feeds can be noisy. This question seeks to apply a classification model to enrich CTI hits with a confidence score. By training a model on features from both the CTI and the corresponding log data, we can learn what a true positive looks like and automatically surface the most critical alerts for analysts.
  answer_sources:
  - Zeek files.log
  - Zeek smtp.log
  - Zeek http.log
  - Zeek conn.log
  - Zeek dns.log
  - Email Gateway
  - Web Proxy
  - DNS Resolvers
  - User Endpoints
  range: last 90 days
  queries:
  - pseudocode: PREDICT is_true_positive using classification_model ON (CTI_features, log_features) | PRIORITIZE alerts WHERE prediction_score > 0.9
- question: How can we identify phishing emails by searching for common deceptive characteristics in email metadata and attachments?
  context: This question addresses rule-based detection of classic phishing traits. Adversaries often use specific keywords to create urgency, use double extensions to disguise malicious executables, or spoof sender information. Searching for these static patterns provides a quick way to flag obviously suspicious emails.
  answer_sources:
  - Zeek smtp.log
  - Zeek files.log
  - Email Gateway
  - Mail Servers
  range: last 90 days
  queries:
  - pseudocode: SEARCH smtp.log for subject_keywords ('Urgent', 'Invoice') OR header mismatches ('From:' != 'Reply-To:'). SEARCH files.log for filenames with double_extensions ('file.pdf.exe') OR malicious_extensions ('.iso', '.vbs').
- question: Can we statistically baseline email metadata to detect anomalies like new email headers or unusually complex subject lines?
  context: This question moves beyond static rules to find deviations from normal email patterns. The appearance of a novel 'X-' header could indicate a specific phishing toolkit being used. Unusually high entropy in a subject line can suggest an adversary is using randomization to evade simple keyword filters.
  answer_sources:
  - Zeek smtp.log
  - Zeek files.log
  - Email Gateway
  - Mail Servers
  range: last 90 days
  queries:
  - pseudocode: BASELINE frequency of 'X-' headers over 30 days | ALERT on new headers. CALCULATE entropy of email subjects | ALERT if entropy > 98th percentile of baseline.
- question: Can we apply machine learning and NLP to classify emails as phishing and identify emerging campaign themes from email content?
  context: This question involves using more advanced analytics to understand email content. A Naive Bayes classifier can score emails for their likelihood of being malicious based on their text. Topic modeling (LDA) can group emails by theme, allowing analysts to spot a coordinated campaign even if the individual indicators differ.
  answer_sources:
  - Zeek smtp.log
  - Zeek files.log
  - Email Gateway
  - Mail Servers
  range: last 90 days
  queries:
  - pseudocode: CLASSIFY email using Naive_Bayes_model on body/subject | GENERATE phishing_score. IDENTIFY email topics using LDA on email bodies | FLAG clusters that deviate from benign topics.
- question: How can we detect when a user-facing application, like an email client or browser, spawns a potentially malicious process like a command shell or script interpreter?
  context: This question targets a common post-exploitation behavior. After a user clicks a malicious link or opens a weaponized document, the compromised application (e.g., Outlook, Word) is often used to launch a command-line tool (like PowerShell or cmd.exe) to execute further commands. This is highly suspicious and a strong indicator of compromise.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 4104
  - User Endpoints
  - Virtual Desktop Infrastructure (VDI) fleet
  - Application Servers
  range: last 90 days
  queries:
  - pseudocode: SEARCH Windows Event ID 4688 WHERE parent_process IN ('outlook.exe', 'winword.exe', 'chrome.exe') AND child_process IN ('powershell.exe', 'cmd.exe', 'wscript.exe') | ALERT
- question: Can we statistically baseline normal parent-child process relationships to identify rare or new combinations that may indicate malicious activity?
  context: This question focuses on finding the "unknown unknowns" in process activity. While we know Outlook spawning PowerShell is bad, what about other, less common combinations? By baselining all process relationships, we can automatically flag any new or very rare pairings for investigation, as these often represent adversary actions.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 4104
  - User Endpoints
  - Virtual Desktop Infrastructure (VDI) fleet
  - Application Servers
  range: last 90 days
  queries:
  - pseudocode: BASELINE parent-child process pairs over 30 days | CALCULATE rarity of each pair | ALERT on new or very rare (<5 occurrences) relationships.
- question: Can we use machine learning to model entire process execution chains and analyze PowerShell script content to detect sophisticated attacks?
  context: This question addresses more complex attack sequences. Graph analytics can identify anomalous execution paths that might be missed by looking at single parent-child pairs. Additionally, a one-class SVM can be trained on the features of known-good PowerShell scripts to detect malicious ones, even if they are heavily obfuscated.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 4104
  - User Endpoints
  - Virtual Desktop Infrastructure (VDI) fleet
  - Application Servers
  range: last 90 days
  queries:
  - pseudocode: MODEL process chains as a graph | FIND anomalous paths using centrality algorithms. DETECT malicious PowerShell scripts by training a one-class SVM on script block features (Event ID 4104).
- question: How can we detect a sequence of events where a user resolves a newly registered domain, connects to it, and then uploads data?
  context: This question aims to correlate multiple network events to identify a classic phishing workflow a user is lured to a malicious site (often newly created for the campaign), connects, and then submits data (like credentials). Correlating DNS, web, and data transfer logs within a short time window for newly registered domains is a high-fidelity detection method.
  answer_sources:
  - Zeek smtp.log
  - Zeek dns.log
  - Zeek http.log
  - Zeek conn.log
  - Zeek ssl.log
  - DNS Resolvers
  - Web Proxy
  - User Endpoints
  range: last 90 days
  queries:
  - pseudocode: CORRELATE dns.log, http.log, conn.log per user in 5-min window | CHECK domain registration date via WHOIS | ALERT if domain is < 30 days old AND (http.log shows POST OR conn.log shows large upload).
- question: Can we statistically identify anomalous data uploads or rare client fingerprints associated with connections to newly seen domains?
  context: This question seeks to find suspicious connections using statistical outliers. A high ratio of uploaded to downloaded data for a web connection is abnormal and may indicate data exfiltration. Similarly, a rare JA3/JA3S TLS fingerprint can indicate the use of a non-standard client, like a malicious tool, connecting to a new domain.
  answer_sources:
  - Zeek smtp.log
  - Zeek dns.log
  - Zeek http.log
  - Zeek conn.log
  - Zeek ssl.log
  - DNS Resolvers
  - Web Proxy
  - User Endpoints
  range: last 90 days
  queries:
  - pseudocode: BASELINE upload/download ratio for web traffic | ALERT if ratio for a rare domain connection > 99th percentile. CALCULATE rarity of JA3/JA3S hashes | FLAG connections to new domains using a rare fingerprint.
- question: Can we use machine learning to forecast DNS query volumes for new domains and cluster web requests to spot targeted phishing activity?
  context: This question applies ML to find subtle signals. Time-series forecasting can detect a sudden, anomalous spike in queries for a new domain, suggesting a coordinated campaign launch. Clustering similar web requests can isolate small, unique groups of activity that might represent targeted attacks, as opposed to widespread, noisy web traffic.
  answer_sources:
  - Zeek smtp.log
  - Zeek dns.log
  - Zeek http.log
  - Zeek conn.log
  - Zeek ssl.log
  - DNS Resolvers
  - Web Proxy
  - User Endpoints
  range: last 90 days
  queries:
  - pseudocode: FORECAST DNS query volume for new domains using ARIMA | ALERT if actual volume > confidence interval. CLUSTER http requests using DBSCAN on features (URI, user-agent) | FLAG small, distinct clusters.
- question: How can we detect and alert on emails received from an external domain that has never been seen before, especially if it fails email authentication?
  context: This question focuses on identifying emails from completely new sources. An email from a domain with no prior history in the organization is inherently suspicious. This suspicion is greatly amplified if the email also fails standard authentication checks like SPF, DKIM, or DMARC, which strongly suggests spoofing or a misconfigured, potentially malicious, mail server.
  answer_sources:
  - Zeek smtp.log
  - Email Gateway
  - Mail Servers
  range: last 90 days
  queries:
  - pseudocode: MAINTAIN state table of sender-domain/recipient pairs | ALERT on email from a domain not in the 90-day history | ESCALATE if SPF/DKIM/DMARC checks fail.
- question: Can we statistically monitor the volume and recipient patterns of emails from external domains to detect anomalous behavior?
  context: This question aims to detect changes in the behavior of known or new sender domains. A sudden, massive spike in email volume from a single domain could indicate a spam or phishing campaign. Conversely, a sudden shift from a broad distribution of recipients to a very narrow, targeted list (a drop in entropy) could signal a move to spear-phishing.
  answer_sources:
  - Zeek smtp.log
  - Email Gateway
  - Mail Servers
  range: last 90 days
  queries:
  - pseudocode: BASELINE daily email volume per sender domain | ALERT if volume > 3 standard deviations from 30-day average. CALCULATE recipient entropy per domain | ALERT on a sudden drop in entropy.
- question: Can we use an autoencoder to model normal email traffic patterns and detect anomalous emails that might be part of a novel phishing campaign?
  context: This question proposes using an unsupervised machine learning model to find novel attacks. An autoencoder is trained to "reconstruct" normal email events based on features like time of day and recipient count. When a new, anomalous email arrives that doesn't fit the learned pattern, the model will have a high "reconstruction error," flagging it as a potential threat that doesn't match any known rules.
  answer_sources:
  - Zeek smtp.log
  - Email Gateway
  - Mail Servers
  range: last 90 days
  queries:
  - pseudocode: TRAIN autoencoder on normal email feature vectors | CALCULATE reconstruction error for new emails | ALERT on emails with high reconstruction error.
- question: How can we detect a user submitting credentials to a newly registered domain, potentially followed by an anomalous login?
  context: This question targets the final stage of a credential phishing attack. It involves correlating a web data submission (HTTP POST) to a suspicious (newly registered) domain with a subsequent successful login for that same user from an unusual location. This sequence is a very strong indicator that credentials have been compromised and are being actively used.
  answer_sources:
  - Zeek http.log
  - Zeek conn.log
  - Zeek dns.log
  - Windows Event ID 4624
  - Web Proxy
  - DNS Resolvers
  - Domain Controllers
  - VPN Concentrators
  range: last 90 days
  queries:
  - pseudocode: CORRELATE HTTP POST to a new domain (<30 days old) with a subsequent successful login (Event ID 4624) from a foreign IP/ASN for the same user within 15 minutes | CRITICAL ALERT.
- question: Can we statistically identify when a user submits data to a domain they don't normally interact with, or when an upload to a rare domain is unusually large?
  context: This question uses user-specific and global baselines to find anomalies. A user suddenly sending data to a brand-new domain is suspicious. A data upload (POST) to a rarely visited domain that is significantly larger than typical uploads is also suspicious and could represent more than just credentials being exfiltrated.
  answer_sources:
  - Zeek http.log
  - Zeek conn.log
  - Zeek dns.log
  - Windows Event ID 4624
  - Web Proxy
  - DNS Resolvers
  - Domain Controllers
  - VPN Concentrators
  range: last 90 days
  queries:
  - pseudocode: BASELINE domains per user for HTTP POSTs | ALERT when user POSTs to a domain not in their 90-day baseline. CALCULATE percentile of upload size for POSTs | FLAG POSTs to rare domains that are > 95th percentile.
- question: Can we use machine learning to identify credential phishing pages and cluster login events to detect anomalous access patterns?
  context: This question applies ML to both the cause (phishing page) and effect (anomalous login). A classifier can proactively identify likely phishing URLs based on their characteristics. Separately, clustering login events can reveal unusual groups of activity (e.g., a set of logins from a new country at an odd time) that point to compromised accounts being used.
  answer_sources:
  - Zeek http.log
  - Zeek conn.log
  - Zeek dns.log
  - Windows Event ID 4624
  - Web Proxy
  - DNS Resolvers
  - Domain Controllers
  - VPN Concentrators
  range: last 90 days
  queries:
  - pseudocode: CLASSIFY URLs as phishing using Random Forest model on URL/domain/cert features. CLUSTER login events (Event ID 4624) based on time, IP, ASN, etc. to identify anomalous login groups.