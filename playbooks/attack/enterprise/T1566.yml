name: T1566: Phishing
id: 5a8a1e2f-3b9c-4e8d-8a2b-9f6c7d4e5f6a
description: This playbook helps determine if an adversary has gained initial access
  to the network via phishing (T1566). It provides investigative questions to detect
  phishing attempts by correlating network data with threat intelligence, analyzing
  email metadata for suspicious characteristics, identifying anomalous process creation
  chains originating from user applications, tracking multi-stage event sequences
  involving newly registered domains, monitoring for unusual external email patterns,
  and detecting credential submission to suspicious websites followed by anomalous
  logins.
type: technique
related: TA0001: Initial Access
contributors: Zachary Szewczyk, Ask Sage
created: '2025-10-01'
modified: '2025-10-01'
version: 1.0
tags: none
questions:
- question: Have any network events (email, web, file downloads) matched indicators
    from active threat intelligence feeds?
  context: This question aims to find direct hits between our network traffic and
    known malicious indicators from threat intelligence. A match is a strong signal
    of a potential compromise or phishing attempt, as it connects internal activity
    to infrastructure or files confirmed to be malicious by external security researchers.
  answer_sources:
  - Zeek files.log
  - Zeek smtp.log
  - Zeek http.log
  - Zeek conn.log
  - Zeek dns.log
  - Email Gateway
  - Web Proxy
  - DNS Resolvers
  - User Endpoints
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      SEARCH logs (smtp, dns, conn, files, http)
      JOIN with CTI_feed ON log.indicator == CTI.indicator
      WHERE event_time > now() - 90d
      RETURN log.timestamp, log.source_ip, log.destination_ip, CTI.source
- question: Are there statistical anomalies in our threat intelligence hit rates,
    such as a feed failure or a sudden spike in a rare indicator type?
  context: This question addresses the health and effectiveness of our threat intelligence
    integration. A sudden drop in hits from a specific feed could indicate a data
    ingestion problem, leaving us blind. Conversely, a sudden spike in a typically
    rare type of indicator (e.g., a file hash vs. a domain) could signal a new, specific
    attack campaign that deviates from common patterns.
  answer_sources:
  - Zeek files.log
  - Zeek smtp.log
  - Zeek http.log
  - Zeek conn.log
  - Zeek dns.log
  - Email Gateway
  - Web Proxy
  - DNS Resolvers
  - User Endpoints
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      CALCULATE daily hit count per CTI source; ALERT if count == 0.
      CALCULATE historical frequency of indicator types; ALERT if rare type spikes over 24 hours.
- question: Can a machine learning model identify high-probability true positive
    matches between network logs and threat intelligence, reducing alert fatigue?
  context: This question focuses on improving the fidelity of threat intelligence
    alerts. Not all CTI matches are equally critical. By training a model on features
    from both the CTI source (e.g., reputation) and the corresponding network log
    (e.g., protocol), we can score and prioritize matches that are most likely to
    be malicious, allowing analysts to focus on the highest-risk events.
  answer_sources:
  - Zeek files.log
  - Zeek smtp.log
  - Zeek http.log
  - Zeek conn.log
  - Zeek dns.log
  - Email Gateway
  - Web Proxy
  - DNS Resolvers
  - User Endpoints
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      APPLY classification model to (CTI_features, log_features) for each CTI match.
      PRIORITIZE alerts with prediction score > 0.9.
- question: Are there any emails with classic phishing indicators, such as urgent
    keywords in subjects, deceptive attachment filenames, or spoofed header fields?
  context: This question looks for well-known, rule-based indicators of phishing
    emails. Adversaries often use social engineering tactics like urgency ('Urgent',
    'Invoice') or disguise malicious executables with double extensions. Mismatched
    email headers (e.g., the 'From' address not matching the 'Reply-To' address)
    are a common technique to deceive recipients about the sender's true origin.
  answer_sources:
  - Zeek smtp.log
  - Zeek files.log
  - Email Gateway
  - Mail Servers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      SEARCH smtp.log FOR subjects matching regex ('Urgent|Invoice|Action Required|Password Reset').
      SEARCH files.log FOR filenames matching regex ('.*\\.(pdf\\.exe|iso|vbs)$').
      SEARCH smtp.log WHERE header.From != header.Reply-To.
- question: Have we observed statistically unusual email characteristics, such as
    new email headers or abnormally high-entropy subject lines?
  context: This question seeks to find deviations from normal email patterns. The
    appearance of a new, non-standard 'X-' header can indicate a specific mail client
    or gateway used in a phishing campaign. High-entropy (highly random) subject
    lines can be a sign of automated, obfuscated campaign generation, designed to
    bypass simple keyword filters.
  answer_sources:
  - Zeek smtp.log
  - Zeek files.log
  - Email Gateway
  - Mail Servers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      BASELINE 'X-' headers over 30 days; ALERT on new headers.
      CALCULATE entropy for subject lines; ALERT on entropy > 98th percentile of baseline.
- question: Can machine learning models detect phishing emails based on content analysis
    or identify new, emerging campaign themes?
  context: This question leverages machine learning to go beyond simple keywords
    and analyze the full context of an email. A Naive Bayes classifier can score
    an email's likelihood of being a phish based on the words used in its body and
    subject. Topic modeling (LDA) can cluster emails by theme, allowing analysts
    to spot a new, coordinated phishing campaign even if it uses novel lures.
  answer_sources:
  - Zeek smtp.log
  - Zeek files.log
  - Email Gateway
  - Mail Servers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      APPLY Naive Bayes model to email content for phishing score.
      APPLY LDA topic modeling to email bodies to identify and flag new thematic clusters.
- question: Has a common desktop application (Office, browser, email client) spawned
    a command-line or scripting process?
  context: This question targets a very common post-exploitation pattern. After a
    user clicks a malicious link or opens a weaponized document, the compromised
    application (like Word or Outlook) is often used to launch a shell (cmd.exe)
    or scripting engine (powershell.exe) to execute further commands. This behavior
    is highly anomalous for normal user activity.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 4104
  - User Endpoints
  - Virtual Desktop Infrastructure (VDI) fleet
  - Application Servers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      SEARCH WinEvent:4688
      WHERE ParentProcess in ('outlook.exe', 'winword.exe', 'excel.exe', 'acrord32.exe', 'chrome.exe')
      AND ChildProcess in ('powershell.exe', 'cmd.exe', 'wscript.exe', 'cscript.exe', 'mshta.exe')
- question: Have any rare or never-before-seen parent-child process relationships
    been observed on endpoints?
  context: This question uses statistical rarity to detect suspicious activity. While
    some parent-child relationships are common, malware or attacker actions often
    create unique chains. By baselining all process relationships across the enterprise,
    we can flag any new or very rare pairings (e.g., 'acrord32.exe' spawning 'ftp.exe')
    as suspicious events worthy of investigation.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 4104
  - User Endpoints
  - Virtual Desktop Infrastructure (VDI) fleet
  - Application Servers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      BASELINE parent-child process pairs over 30 days.
      ALERT on pairs that are new or have a frequency < 5 in baseline.
- question: Can machine learning detect anomalous process execution chains or malicious
    PowerShell scripts?
  context: This question applies advanced ML techniques to endpoint data. By modeling
    process activity as a graph, algorithms can find suspicious execution paths that
    might be missed by simple parent-child rules. Additionally, a One-Class SVM can
    be trained on the characteristics of legitimate PowerShell scripts (e.g., length,
    commands used) to identify malicious, obfuscated, or otherwise anomalous scripts
    captured in Event ID 4104.
  answer_sources:
  - Windows Event ID 4688
  - Windows Event ID 4104
  - User Endpoints
  - Virtual Desktop Infrastructure (VDI) fleet
  - Application Servers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      MODEL process events as a graph; FIND anomalous paths using centrality algorithms.
      TRAIN One-Class SVM on PowerShell script block features (WinEvent:4104); IDENTIFY outliers.
- question: Has a user connected to and uploaded data to a domain that was registered
    within the last 30 days?
  context: This question chains together several suspicious events to detect a likely
    phishing scenario. Adversaries frequently use newly registered domains (NRDs)
    for their campaigns. Correlating a DNS lookup, a connection, and a data upload
    (HTTP POST) to an NRD within a short time window is a strong indicator of a user
    submitting credentials or other data to a malicious site.
  answer_sources:
  - Zeek smtp.log
  - Zeek dns.log
  - Zeek http.log
  - Zeek conn.log
  - Zeek ssl.log
  - DNS Resolvers
  - Web Proxy
  - User Endpoints
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      CORRELATE dns.log, http.log, and conn.log per user within 5 mins.
      CHECK domain age via WHOIS API.
      ALERT if domain_age < 30 days AND http.method == 'POST'.
- question: Are there any connections to rare domains that exhibit an unusually high
    data upload ratio or use a rare TLS client fingerprint?
  context: This question looks for statistical outliers in connection patterns. A
    connection with a much higher volume of data sent than received is anomalous
    for typical web browsing and could indicate data exfiltration. Furthermore, malware
    often has a hardcoded TLS/SSL implementation, resulting in a unique (and rare)
    JA3/JA3S client fingerprint that can be used to identify it.
  answer_sources:
  - Zeek smtp.log
  - Zeek dns.log
  - Zeek http.log
  - Zeek conn.log
  - Zeek ssl.log
  - DNS Resolvers
  - Web Proxy
  - User Endpoints
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      CALCULATE upload_bytes / download_bytes ratio for connections.
      ALERT if ratio for a rare domain (seen < 10 times in 30d) > 99th percentile.
      CALCULATE rarity of JA3/JA3S hashes; ALERT on connections to new domains with rare fingerprints.
- question: Can machine learning detect a surge in DNS queries for new domains or
    identify small, distinct clusters of web requests indicative of targeted phishing?
  context: This question applies ML to detect coordinated phishing activity. A time-series
    model can predict normal DNS query volumes for new domains, flagging a sudden,
    unexpected spike (a 'beaconing' pattern). Clustering web requests based on features
    like URI patterns can also isolate small groups of users receiving the same targeted
    phish, which would appear as a small, distinct cluster separate from general
    web traffic.
  answer_sources:
  - Zeek smtp.log
  - Zeek dns.log
  - Zeek http.log
  - Zeek conn.log
  - Zeek ssl.log
  - DNS Resolvers
  - Web Proxy
  - User Endpoints
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FORECAST DNS query volume for new domains using ARIMA; ALERT on significant deviations from forecast.
      CLUSTER http requests using DBSCAN on features (URI length, user agent); FLAG small, distinct clusters.
- question: Has an email been received from an external domain that has never been
    seen before, especially if it also fails standard email authentication checks?
  context: This question focuses on identifying communication from completely new
    or potentially impersonated domains. While receiving email from a new domain
    can be legitimate, it's a primary indicator for phishing. If that same email
    also fails authentication standards like SPF, DKIM, or DMARC, the likelihood
    of it being malicious increases significantly, as it suggests the sender is not
    authorized to send from that domain.
  answer_sources:
  - Zeek smtp.log
  - Email Gateway
  - Mail Servers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      MAINTAIN state table of known sender domains seen in last 90 days.
      ALERT on email from a new domain.
      ESCALATE if SPF/DKIM/DMARC checks fail.
- question: Has a known external sender domain shown a sudden, anomalous spike in
    email volume or a drastic shift in its recipient patterns?
  context: This question looks for changes in the behavior of known sender domains.
    A sudden, massive increase in email volume from a partner domain could indicate
    their account has been compromised and is being used to phish your organization.
    A shift from sending to many recipients to sending to just a few (a drop in entropy)
    could signal a move from general communication to a targeted spear-phishing attack.
  answer_sources:
  - Zeek smtp.log
  - Email Gateway
  - Mail Servers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      BASELINE daily email volume per sender domain (30-day moving average).
      ALERT if volume > 3 standard deviations from average.
      CALCULATE recipient entropy per sender domain; ALERT on sudden drops.
- question: Can an anomaly detection model (autoencoder) identify emails that deviate
    from the established patterns of normal mail traffic?
  context: This question uses an unsupervised machine learning approach to find 'unknown
    unknowns.' An autoencoder is trained to 'reconstruct' what it considers normal
    email, based on features like time of day, sender TLD, and number of recipients.
    When a truly novel or anomalous email arrives, the model will struggle to reconstruct
    it, resulting in a high 'reconstruction error.' This flags the email for investigation
    as a potential part of a new phishing campaign.
  answer_sources:
  - Zeek smtp.log
  - Email Gateway
  - Mail Servers
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      TRAIN autoencoder on feature vectors of normal email traffic.
      CALCULATE reconstruction error for new emails.
      ALERT on emails with high reconstruction error.
- question: Has a user submitted credentials to a newly registered domain, followed
    shortly by a successful login from an anomalous geographic location or network?
  context: This is a high-confidence question for detecting credential harvesting.
    It correlates multiple strong indicators: 1) a data submission (POST) to a suspicious,
    newly registered domain, 2) a POST size consistent with credentials, and 3) a
    subsequent successful login from an unusual location (e.g., a different country
    or a non-corporate network). This sequence strongly suggests the user's credentials
    were stolen and immediately used by an adversary.
  answer_sources:
  - Zeek http.log
  - Zeek conn.log
  - Zeek dns.log
  - Windows Event ID 4624
  - Web Proxy
  - DNS Resolvers
  - Domain Controllers
  - VPN Concentrators
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      FIND HTTP POST to domain registered < 30 days.
      IF POST body size is 50-500 bytes AND followed within 15 mins by successful login (WinEvent:4624) from an anomalous IP (foreign GEO or non-corp ASN), CRITICAL ALERT.
- question: Has a user submitted data via an HTTP POST to a domain they've never
    posted to before, or is the size of the data upload anomalously large?
  context: This question identifies deviations from an individual user's normal behavior.
    Most users submit data to a regular, limited set of websites. A POST to a brand
    new domain for that user is suspicious. Additionally, a large data upload to
    a rare domain could indicate exfiltration of more than just credentials, warranting
    investigation.
  answer_sources:
  - Zeek http.log
  - Zeek conn.log
  - Zeek dns.log
  - Windows Event ID 4624
  - Web Proxy
  - DNS Resolvers
  - Domain Controllers
  - VPN Concentrators
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      BASELINE domains with POSTs per user over 90 days.
      ALERT on POST to a domain not in user's baseline.
      FLAG POSTs to rare domains with upload size > 95th percentile.
- question: Can a machine learning model predict if a webpage is a credential phishing
    site, or can it detect anomalous clusters of login activity?
  context: This question applies machine learning to both the potential phishing
    site and the subsequent login. A classifier can be trained to recognize features
    of phishing pages (e.g., 'login' in the URL, short-lived TLS cert). Separately,
    clustering successful logins based on features like time, source IP, and client
    can automatically group normal activity together, causing anomalous logins (like
    those from an attacker) to stand out as a separate, small cluster.
  answer_sources:
  - Zeek http.log
  - Zeek conn.log
  - Zeek dns.log
  - Windows Event ID 4624
  - Web Proxy
  - DNS Resolvers
  - Domain Controllers
  - VPN Concentrators
  range: last 90 days
  queries:
  - technology: pseudocode
    query: |
      APPLY Random Forest model to page features (URI keywords, domain age, cert properties) to classify as phishing.
      CLUSTER login events (WinEvent:4624) by features (time, source IP/ASN) to identify anomalous login groups.