name: T1596.002: WHOIS
id: f8a1b2c3-d4e5-4f6a-b7c8-d9e0f1a2b3c4
description: "This playbook helps answer the question: Is an adversary performing WHOIS reconnaissance against our organization's domains or related infrastructure? It provides investigative steps to detect this activity by identifying connections to malicious WHOIS services, anomalous User-Agent strings or query patterns indicative of automation, statistically significant volumes of WHOIS queries from internal hosts, queries originating from unauthorized internal systems, and behavioral chains where WHOIS lookups are followed by network scanning."
type: technique
related:
  - TA0043: Reconnaissance
contributors:
  - Zachary Szewczyk
  - Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
  - question: "Is an internal host connecting to a known malicious WHOIS service IP or domain?"
    context: "This question aims to identify if internal systems are communicating with WHOIS services (over TCP port 43 or web) that are listed on threat intelligence feeds as malicious or associated with reconnaissance campaigns. A match against a maintained watchlist of malicious IPs and domains could indicate that an adversary is using a compromised internal host to gather information about external targets, or that an internal user is unwittingly using a malicious service."
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Zeek http.log
      - Zeek ssl.log
      - Network Egress Points (e.g., Firewalls, Web Proxies)
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: "SEARCH network logs (conn, http) for connections to destination_port 43 or WHOIS websites. COMPARE destination IP/domain against a threat intelligence watchlist of malicious WHOIS services. ALERT on match."
  - question: "Is any host exhibiting an anomalous daily volume of WHOIS connections compared to its own baseline or its peer group?"
    context: "This question detects unusual spikes in WHOIS activity from a single host. By comparing daily connection counts against a 30-day baseline and peer group activity, it can flag potential automated reconnaissance tools that deviate from normal user behavior, even if the destinations are not on a blocklist."
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Zeek http.log
      - Zeek ssl.log
      - Network Egress Points (e.g., Firewalls, Web Proxies)
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: "FOR each source host, COUNT daily connections to port 43 or WHOIS sites. COMPARE count to 95th percentile of host's 30-day baseline and peer group baseline. ALERT if count exceeds threshold."
  - question: "Is a host connecting to a WHOIS destination domain that has a high malicious reputation score?"
    context: "This question uses a machine learning model to proactively score the reputation of WHOIS destination domains based on features like domain age, registration data, and SSL certificate attributes. It aims to identify newly created or suspicious WHOIS services that may not yet be on threat intelligence feeds."
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Zeek http.log
      - Zeek ssl.log
      - Network Egress Points (e.g., Firewalls, Web Proxies)
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: "FOR each new WHOIS destination domain, EXTRACT features (domain age, SSL cert info, etc.). INPUT features into reputation scoring model. ALERT if score is 'malicious' above confidence threshold."
  - question: "Is an outbound HTTP/S request to a WHOIS website using a User-Agent string associated with a known reconnaissance tool?"
    context: "Adversaries often use specific tools for automated reconnaissance, which leave tell-tale User-Agent strings in HTTP headers. This question looks for those signatures in traffic to known WHOIS websites, providing a high-fidelity indicator of malicious tool usage."
    answer_sources:
      - Zeek http.log
      - Zeek ssl.log
      - Zeek dns.log
      - Web Proxy Servers and DNS Resolvers
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: "SEARCH http logs for requests to WHOIS websites. COMPARE User-Agent field against a watchlist of recon tool User-Agents. ALERT on match."
  - question: "Is a host exhibiting high-entropy (randomized) domain lookups on WHOIS websites, suggesting automated enumeration?"
    context: "Automated tools often enumerate or test a large list of domains, which appear random compared to human-driven queries. This question measures the randomness (Shannon entropy) of queried domains from a single source within a short time window. A spike in entropy can indicate automated domain discovery."
    answer_sources:
      - Zeek http.log
      - Zeek ssl.log
      - Zeek dns.log
      - Web Proxy Servers and DNS Resolvers
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: "FOR each source IP, CALCULATE Shannon entropy of second-level domains in WHOIS queries within a 5-minute window. COMPARE entropy to host's 30-day baseline. ALERT if entropy exceeds 3 standard deviations above baseline."
  - question: "Are the URL query parameter sequences for a WHOIS website indicative of automated activity?"
    context: "This question uses a sequence classification model to analyze the patterns of URL parameters in WHOIS lookups. The model is trained to distinguish between the patterns of manual, benign lookups and the rapid, structured patterns of automated enumeration tools, allowing for detection of suspicious query sequences in real-time."
    answer_sources:
      - Zeek http.log
      - Zeek ssl.log
      - Zeek dns.log
      - Web Proxy Servers and DNS Resolvers
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: "CAPTURE URL query sequences from http logs for WHOIS sites. INPUT sequence into a trained LSTM model. ALERT if classification is 'suspicious' or 'automated'."
  - question: "Has any single host exceeded a fixed threshold for WHOIS queries within a one-hour period?"
    context: "This question provides a simple but effective method for detecting brute-force or high-volume WHOIS reconnaissance. By setting a static threshold (e.g., 50 queries/hour), it can quickly flag hosts performing an unusually large number of lookups, which is a common indicator of automated scripting."
    answer_sources:
      - Zeek conn.log
      - Zeek http.log
      - Zeek dns.log
      - Network Egress Points and Endpoint Devices
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: "FOR each host, COUNT WHOIS queries (via port 43 or http) in a 1-hour sliding window. ALERT if count > 50."
  - question: "Is a host's current hourly WHOIS query volume a statistical outlier compared to its own historical baseline?"
    context: "This question establishes a dynamic baseline of normal WHOIS activity for each host. It then alerts when a host's query volume significantly deviates from its own established pattern (e.g., exceeds the moving average by 3 standard deviations), allowing for more nuanced detection of anomalies than a static threshold."
    answer_sources:
      - Zeek conn.log
      - Zeek http.log
      - Zeek dns.log
      - Network Egress Points and Endpoint Devices
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: "FOR each host, CALCULATE 30-day moving average and standard deviation of hourly WHOIS query volume. ALERT if current hourly count > (moving average + 3 * standard deviation)."
  - question: "Does a host's WHOIS query volume significantly deviate from its forecasted temporal pattern?"
    context: "This question uses a time series forecasting model to predict a host's expected WHOIS query volume, accounting for patterns like time of day or day of week. An alert is generated if the actual query count falls outside the model's predicted confidence interval, indicating a break from the host's normal rhythm of activity."
    answer_sources:
      - Zeek conn.log
      - Zeek http.log
      - Zeek dns.log
      - Network Egress Points and Endpoint Devices
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: "FOR each host, FORECAST expected WHOIS query volume using a time series model (ARIMA/Prophet). COMPARE actual query count to the forecasted confidence interval. ALERT if actual count is a significant outlier."
  - question: "Is an unauthorized host or user performing WHOIS queries for our organization's critical assets?"
    context: "This question focuses on 'who' is performing the query and 'what' they are querying. By cross-referencing the source of a WHOIS query with an authorized list of users/hosts (e.g., SOC team) and the target with a list of critical assets (e.g., company domains, IP ranges), it can generate high-fidelity alerts on suspicious internal reconnaissance."
    answer_sources:
      - Zeek conn.log
      - Zeek http.log
      - Zeek dns.log
      - Internal Network Segments and Identity and Access Management (IAM) Systems
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: "SEARCH for WHOIS queries where the target is a critical asset. CHECK if the source host/user is in the authorized group list. ALERT if source is not authorized."
  - question: "Is there a sudden increase in WHOIS queries for internal assets from a subnet that historically has not performed this activity?"
    context: "This question identifies anomalous behavior at the subnet level. A sudden spike in WHOIS queries for internal assets from a network segment that normally has no reason to perform such lookups (e.g., a guest Wi-Fi subnet) can indicate a compromised device or an insider threat moving into a reconnaissance phase."
    answer_sources:
      - Zeek conn.log
      - Zeek http.log
      - Zeek dns.log
      - Internal Network Segments and Identity and Access Management (IAM) Systems
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: "FOR WHOIS queries targeting internal assets, track the source subnet. CALCULATE historical activity distribution per subnet. ALERT if a subnet shows a sudden, significant increase in activity (e.g., jumps from 10th to 99th percentile)."
  - question: "Has a host from a 'low-privilege' or 'standard-user' behavioral cluster initiated a WHOIS query for a sensitive internal asset?"
    context: "This question uses machine learning to automatically group hosts into behavioral clusters (e.g., 'developer workstations', 'finance terminals', 'web servers'). A WHOIS query for a sensitive asset originating from a host in a cluster that typically does not exhibit such behavior (e.g., a standard user's machine) is a strong anomaly and warrants investigation."
    answer_sources:
      - Zeek conn.log
      - Zeek http.log
      - Zeek dns.log
      - Internal Network Segments and Identity and Access Management (IAM) Systems
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: "CLUSTER hosts based on network behavior profiles. IDENTIFY clusters (e.g., 'low-privilege'). IF a host from a low-privilege cluster performs a WHOIS query for a sensitive asset, ALERT."
  - question: "Is a WHOIS query from a host quickly followed by network scanning or connection attempts from the same host?"
    context: "This question aims to detect the 'recon-to-action' behavioral chain. By correlating a WHOIS query (Event A) with subsequent scanning activity (Event B) from the same source IP within a short time window, it connects the information gathering step to the active probing step, providing stronger evidence of malicious intent."
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Zeek http.log
      - Windows Event ID 5156
      - Endpoints, Internal Network Segments, and Network Egress Points
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: "CREATE stateful rule: IF event A (WHOIS query from source X) occurs, THEN within 15 minutes, if event B (port scan or many failed connections from source X) occurs, ALERT on the correlated activity."
  - question: "After performing a WHOIS query, does a host show an anomalously high ratio of connections to new, previously unseen IP addresses?"
    context: "This question looks for behavior indicating that an attacker used information from a WHOIS query to identify new targets. A sudden increase in the proportion of connections to 'new' IPs (those not seen in the host's recent baseline) shortly after a WHOIS lookup suggests the host is acting on newly discovered information."
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Zeek http.log
      - Windows Event ID 5156
      - Endpoints, Internal Network Segments, and Network Egress Points
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: "AFTER a host performs a WHOIS query, track its connections for 30 minutes. CALCULATE ratio of connections to 'new' IPs vs 'old' IPs. ALERT if this ratio exceeds the 95th percentile of the host's historical norm."
  - question: "Does a host's sequence of network activities transition from a 'reconnaissance' state to a 'scanning' or 'connection' state with high probability?"
    context: "This question uses a sophisticated behavioral model (HMM) to map low-level log events to higher-level adversary tactics (states). It can detect a logical progression of an attack, such as a 'whois_query' observation leading to a high probability of transitioning into a 'Scan' state, providing a model-driven alert on a full TTP chain."
    answer_sources:
      - Zeek conn.log
      - Zeek dns.log
      - Zeek http.log
      - Windows Event ID 5156
      - Endpoints, Internal Network Segments, and Network Egress Points
    range: last 90 days
    queries:
      - search_technology: pseudocode
        query: "FEED host's event stream (whois_query, port_sweep, new_connection) into a trained HMM. ALERT if the model shows a high-probability transition from a 'Recon' state to a 'Scan' or 'Connect' state."