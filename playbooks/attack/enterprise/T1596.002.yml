name: T1596.002: WHOIS
id: c1b0a9a8-7e6d-4f8a-9c1b-5a6d7e8f9a0b
description: This playbook helps determine if an adversary is performing WHOIS reconnaissance against the organization's domains or related infrastructure. It provides investigative questions to detect this activity by identifying connections to known malicious WHOIS services, flagging anomalous query volumes that deviate from historical baselines, recognizing suspicious User-Agent strings or query patterns indicative of automated tools, uncovering queries from unauthorized internal systems, and correlating WHOIS lookups with subsequent scanning or connection attempts.
type: technique
related:
- TA0043: Reconnaissance
contributors: Zachary Szewczyk, Ask Sage
created: 2025-10-01
modified: 2025-10-01
version: 1.0
tags: none
questions:
- question: Are internal hosts connecting to known malicious WHOIS services?
  context: This question aims to detect direct reconnaissance activity. Adversaries may use dedicated or compromised infrastructure for WHOIS lookups. By creating and maintaining a watchlist of malicious IPs and domains from threat intelligence, analysts can generate high-fidelity alerts when internal hosts connect to these known-bad destinations over port 43 (traditional WHOIS) or via web-based services.
  answer_sources:
  - Zeek conn.log
  - Zeek dns.log
  - Zeek http.log
  - Zeek ssl.log
  - Network Egress Points (e.g., Firewalls, Web Proxies)
  range: last 90 days
  queries:
  - search_technology: Pseudocode
    query: SEARCH network logs (conn, http) WHERE (destination_port = 43 OR destination_host IN known_whois_sites) AND destination_ip IN malicious_watchlist | ALERT
- question: Is any internal host exhibiting an anomalous volume of WHOIS connections compared to its baseline or peer group?
  context: This question helps detect low-and-slow reconnaissance that might not trigger simple threshold-based alerts. By calculating the daily connection count per source host and establishing a 30-day baseline, analysts can flag any host whose activity exceeds the 95th percentile of its own history or its peer group (e.g., 'Developer Workstations'), indicating a potential deviation from normal behavior.
  answer_sources:
  - Zeek conn.log
  - Zeek dns.log
  - Zeek http.log
  - Zeek ssl.log
  - Network Egress Points (e.g., Firewalls, Web Proxies)
  range: last 90 days
  queries:
  - search_technology: Pseudocode
    query: FOR each source_host, CALCULATE daily_whois_count | COMPARE daily_whois_count to historical_baseline(95th_percentile) AND peer_group_baseline(95th_percentile) | ALERT on deviation
- question: Are internal hosts connecting to WHOIS destination domains with a low reputation score?
  context: This question uses machine learning to proactively identify suspicious WHOIS services that may not yet be on a threat intelligence feed. By applying a pre-trained classification model to score the reputation of destination domains based on features like age, registration details, and SSL attributes, analysts can alert on connections to any domain receiving a 'malicious' score above a set confidence threshold.
  answer_sources:
  - Zeek conn.log
  - Zeek dns.log
  - Zeek http.log
  - Zeek ssl.log
  - Network Egress Points (e.g., Firewalls, Web Proxies)
  range: last 90 days
  queries:
  - search_technology: Pseudocode
    query: FOR each whois_destination_domain, APPLY classification_model(features) | IF score > confidence_threshold THEN ALERT
- question: Are internal hosts using User-Agent strings associated with reconnaissance tools for WHOIS lookups?
  context: This question focuses on identifying the specific tools an adversary might be using. Reconnaissance tools like 'python-whois' or 'recon-ng' often use unique User-Agent strings. Maintaining a list of these strings allows analysts to create a detection rule that searches web proxy logs for matches in requests to known WHOIS sites, providing a strong indicator of malicious intent.
  answer_sources:
  - Zeek http.log
  - Zeek ssl.log
  - Zeek dns.log
  - Web Proxy Servers and DNS Resolvers
  range: last 90 days
  queries:
  - search_technology: Pseudocode
    query: SEARCH http logs WHERE destination IN known_whois_sites AND user_agent IN recon_tool_list | ALERT
- question: Is any host performing automated WHOIS enumeration, as indicated by high entropy in queried domains?
  context: This question aims to distinguish automated, large-scale reconnaissance from benign, manual lookups. Automated tools often enumerate through lists of domains, resulting in non-random query patterns. By calculating the Shannon entropy of queried domains within a short time window, analysts can alert if the entropy score significantly deviates from the host's baseline, suggesting programmatic enumeration.
  answer_sources:
  - Zeek http.log
  - Zeek ssl.log
  - Zeek dns.log
  - Web Proxy Servers and DNS Resolvers
  range: last 90 days
  queries:
  - search_technology: Pseudocode
    query: FOR each source_ip, CALCULATE shannon_entropy(queried_domains) in 5_min_window | COMPARE entropy to historical_baseline(3_std_dev) | ALERT on deviation
- question: Are URL query sequences for WHOIS lookups indicative of automated enumeration?
  context: This question applies advanced sequence analysis to detect automation. Manual WHOIS lookups have different URL query patterns than automated scripts. By training a sequence classification model (e.g., LSTM) on labeled benign and malicious query sequences, analysts can deploy the model to classify new sequences in real-time and alert on those flagged as 'suspicious' or 'automated'.
  answer_sources:
  - Zeek http.log
  - Zeek ssl.log
  - Zeek dns.log
  - Web Proxy Servers and DNS Resolvers
  range: last 90 days
  queries:
  - search_technology: Pseudocode
    query: FOR each source_ip, CAPTURE url_query_sequence | APPLY sequence_classification_model(sequence) | IF classification is 'automated' THEN ALERT
- question: Has any single host generated an excessive number of WHOIS queries within a short time frame?
  context: This question provides a simple but effective method for detecting brute-force reconnaissance. By implementing a threshold rule (e.g., >50 WHOIS queries in 1 hour), analysts can quickly identify hosts exhibiting unusually high query volumes. This threshold should be tuned based on the organization's normal activity to balance detection with minimizing false positives.
  answer_sources:
  - Zeek conn.log
  - Zeek http.log
  - Zeek dns.log
  - Network Egress Points and Endpoint Devices
  range: last 90 days
  queries:
  - search_technology: Pseudocode
    query: SEARCH whois_queries | COUNT by source_host over 1_hour | IF count > 50 THEN ALERT
- question: Is any host's hourly WHOIS query volume a statistical outlier compared to its historical moving average?
  context: This question uses statistical analysis to detect deviations from a host's own established behavior. By computing a 30-day moving average and standard deviation of hourly WHOIS query volume for each host, analysts can generate a more sensitive alert when the current count exceeds the average by a significant margin (e.g., >3 standard deviations), catching anomalies that a static threshold might miss.
  answer_sources:
  - Zeek conn.log
  - Zeek http.log
  - Zeek dns.log
  - Network Egress Points and Endpoint Devices
  range: last 90 days
  queries:
  - search_technology: Pseudocode
    query: FOR each host, CALCULATE moving_avg and std_dev of hourly_whois_queries | IF current_hourly_count > (moving_avg + 3*std_dev) THEN ALERT
- question: Does any host's WHOIS query volume significantly deviate from its forecasted temporal pattern?
  context: This question uses time series forecasting to model complex, time-dependent behaviors. A model like ARIMA or Prophet can learn a host's normal rhythm of WHOIS activity. An alert is generated when the observed query count significantly deviates from the forecasted value's confidence interval, indicating a break from the established temporal pattern that is highly likely to be anomalous.
  answer_sources:
  - Zeek conn.log
  - Zeek http.log
  - Zeek dns.log
  - Network Egress Points and Endpoint Devices
  range: last 90 days
  queries:
  - search_technology: Pseudocode
    query: FOR each host, APPLY forecasting_model(historical_query_volume) | IF observed_volume is outside confidence_interval THEN ALERT
- question: Are unauthorized hosts performing WHOIS queries against our organization's critical assets?
  context: This question focuses on policy violation as an indicator of compromise. Certain groups, like Security Operations, are authorized to perform reconnaissance, while others are not. By maintaining lists of critical assets and authorized user/host groups, a SIEM rule can alert when a query for a critical asset originates from a host not in the authorized group, indicating potential internal misuse or a compromised machine.
  answer_sources:
  - Zeek conn.log
  - Zeek http.log
  - Zeek dns.log
  - Internal Network Segments and Identity and Access Management (IAM) Systems
  range: last 90 days
  queries:
  - search_technology: Pseudocode
    query: SEARCH whois_queries WHERE target IN critical_asset_list AND source_host NOT IN authorized_host_list | ALERT
- question: Are WHOIS queries for internal assets originating from unusual source subnets?
  context: This question uses network segmentation and location as a basis for anomaly detection. By analyzing the distribution of source subnets for WHOIS queries targeting internal assets, analysts can flag activity from subnets that have historically shown little to no such behavior. A sudden jump in activity from a previously quiet subnet is a strong indicator of suspicious behavior.
  answer_sources:
  - Zeek conn.log
  - Zeek http.log
  - Zeek dns.log
  - Internal Network Segments and Identity and Access Management (IAM) Systems
  range: last 90 days
  queries:
  - search_technology: Pseudocode
    query: ANALYZE source_subnet distribution for internal_asset_whois_queries | IF activity from a subnet jumps from low_percentile to high_percentile THEN ALERT
- question: Is a host from a 'low-privilege' cluster performing WHOIS queries for sensitive internal assets?
  context: This question uses unsupervised machine learning to identify behavior that contradicts a host's typical role. By clustering internal hosts based on their network behavior profiles (e.g., protocols, services), analysts can define roles like 'low-privilege'. If a host from such a cluster initiates a WHOIS query for a sensitive asset, it represents a high-fidelity anomaly worthy of an immediate alert.
  answer_sources:
  - Zeek conn.log
  - Zeek http.log
  - Zeek dns.log
  - Internal Network Segments and Identity and Access Management (IAM) Systems
  range: last 90 days
  queries:
  - search_technology: Pseudocode
    query: CLUSTER hosts by network_behavior_profile | IF host in 'low-privilege_cluster' performs WHOIS on sensitive_asset THEN ALERT
- question: Is a WHOIS query followed by subsequent scanning or connection attempts from the same host?
  context: This question aims to detect the 'recon-to-action' behavioral chain. A stateful correlation rule can be created to trigger if a WHOIS query from a source IP is followed within a short time window (e.g., 15 minutes) by network scanning or numerous failed connections from the same IP. This directly links the reconnaissance activity to a subsequent action, increasing the confidence of a malicious finding.
  answer_sources:
  - Zeek conn.log
  - Zeek dns.log
  - Zeek http.log
  - Windows Event ID 5156
  - Endpoints, Internal Network Segments, and Network Egress Points
  range: last 90 days
  queries:
  - search_technology: Pseudocode
    query: TRIGGER on Event A (whois_query from source_ip) | IF Event B (port_scan or failed_connections from same source_ip) occurs within 15 minutes THEN ALERT
- question: Is a host exhibiting a significant increase in connections to new destination IPs after performing a WHOIS query?
  context: This question provides another method for detecting the 'recon-to-action' pattern. After a host performs a WHOIS query, analysts can calculate the ratio of its connections to 'new' versus 'old' destination IPs in the subsequent 30-minute window. A ratio exceeding the host's historical norm suggests that the reconnaissance is being used to discover and then target new infrastructure.
  answer_sources:
  - Zeek conn.log
  - Zeek dns.log
  - Zeek http.log
  - Windows Event ID 5156
  - Endpoints, Internal Network Segments, and Network Egress Points
  range: last 90 days
  queries:
  - search_technology: Pseudocode
    query: AFTER whois_query from source_host, CALCULATE ratio of new_vs_old_destinations in 30_min_window | IF ratio > 95th_percentile_of_norm THEN ALERT
- question: Does a host's sequence of network events indicate a transition from reconnaissance to scanning or connection attempts?
  context: This question uses a Hidden Markov Model (HMM) to map log events to adversary tactics. By defining states like 'Recon', 'Scan', and 'Connect' and observing log events, the model can infer the adversary's progression. An alert is generated when a sequence of observations from a single host shows a high-probability transition from a 'whois_query' observation to a 'Scan' or 'Connect' state, capturing the entire attack chain.
  answer_sources:
  - Zeek conn.log
  - Zeek dns.log
  - Zeek http.log
  - Windows Event ID 5156
  - Endpoints, Internal Network Segments, and Network Egress Points
  range: last 90 days
  queries:
  - search_technology: Pseudocode
    query: APPLY HMM to sequence of host_events | IF state_transition from 'Recon' (whois_query) to 'Scan' or 'Connect' has high probability THEN ALERT