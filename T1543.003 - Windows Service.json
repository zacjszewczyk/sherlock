[
  {
    "Is the adversary establishing or maintaining persistence by creating or modifying Windows services? (TA0003 - Persistence)": {
      "Indicators": {
        "T1543.003 - Windows Service": {
          "Creation or modification of a Windows service (especially with automatic startup) that does not correlate with known software installations or updates.": {
            "Data": "Windows Event ID 4697; Windows Event ID 7045; Windows Event ID 4688",
            "Data Platform": "Servers, Endpoints",
            "NAI": "Insert site-specific NAI here",
            "Action": "Collect Windows Event IDs 4697 and 7045. Identify newly created or modified services. Cross-reference service names and binary paths against a baseline of known legitimate services and recent software installation/update logs. Flag services with unusual names or paths, or those set to automatic startup outside of typical deployment cycles."
          },
          "Changes detected in the Registry configuration of a Windows service, particularly changes to the 'ImagePath' or 'Start' values.": {
            "Data": "Windows Event ID 4657",
            "Data Platform": "Servers, Endpoints",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 4657 for modifications to HKLM\\SYSTEM\\CurrentControlSet\\Services\\* Registry keys. Focus on changes to 'ImagePath' and 'Start' values. Correlate changes with user logon events (4624) and process creation events (4688) involving registry editing tools or scripts. Use time series analysis on the frequency of Registry modifications per host to detect anomalous spikes."
          },
          "Creation or modification of a service using a legitimate-sounding name or description, but pointing to an unusual executable path or command line.": {
            "Data": "Windows Event ID 4697; Windows Event ID 7045; Windows Event ID 4688",
            "Data Platform": "Servers, Endpoints",
            "NAI": "Insert site-specific NAI here",
            "Action": "Collect Windows Event IDs 4697 (Service Created) and 7045 (Service Install). Analyze ServiceFilepath and ServiceName. Compare against a list/baseline of known legitimate service names and their corresponding standard ImagePath locations. Flag services with legitimate-sounding names but pointing to executable paths outside of standard system directories (e.g., Program Files, System32) or user profile directories. Analyze associated Event ID 4688 (Process Creation) for the command line used to create/modify the service. Use frequency analysis on service paths to identify rare occurrences."
          },
          "Creation of a new Windows service with an automatic startup type that does not align with recent documented software deployments or patch cycles.": {
            "Data": "Windows Event ID 4697; Windows Event ID 7045; Windows Event ID 4624",
            "Data Platform": "Servers, Endpoints",
            "NAI": "Insert site-specific NAI here",
            "Action": "Collect Windows Event IDs 4697 and 7045. Filter for services created with 'Automatic' startup (Start Type 0x2 for 4697/7045). Correlate service creation timestamps with timestamps of documented software installations or system updates from endpoint management systems or change management logs. Investigate newly created services with automatic startup that lack correlation with known deployment activities. Identify the user context (via Event ID 4624 logon session) under which the service was created/installed and compare to expected behavior using statistical baselining of user activities."
          }
        }
      },
      "version": "1.1",
      "last_updated": "2025-05-07"
    }
  },
  {
    "Is the adversary attempting to escalate privileges by modifying or creating Windows services? (TA0004 - Privilege Escalation)": {
      "Indicators": {
        "T1543.003 - Windows Service": {
          "Execution of command-line utilities (like sc.exe, PnPUtil.exe) or PowerShell cmdlets that create or modify services, especially when run with high privileges.": {
            "Data": "Windows Event ID 4688; Windows Event ID 4624",
            "Data Platform": "Servers, Endpoints",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 4688 for process creation events where the parent process is a shell (cmd.exe, powershell.exe) and the command line includes 'sc.exe create', 'sc.exe config', 'PnPUtil.exe', or relevant PowerShell cmdlets (e.g., New-Service, Set-Service). Filter for executions with SYSTEM or Administrator privileges (via associated logon event 4624). Use descriptive statistics to identify rare command-line arguments or execution contexts."
          },
          "Outlier process execution originating from a legitimate Windows service, particularly if the process is not typically associated with that service or is observed for the first time.": {
            "Data": "Windows Event ID 4688; Zeek conn.log",
            "Data Platform": "Servers, Endpoints, Network devices",
            "NAI": "Insert site-specific NAI here",
            "Action": "Collect Windows Event ID 4688 and analyze process trees originating from legitimate service executables (e.g., services.exe). Identify child processes that are not typically launched by the parent service. Cross-reference executed process names and hashes with threat intelligence feeds. Monitor Zeek conn.log for outbound network connections initiated by these suspicious processes. Use outlier detection methods (e.g., based on entropy of command line arguments or frequency of process names) to flag processes with unusual characteristics."
          },
          "Installation of a new Windows service configured to load a driver (.sys file), particularly from an unusual path or signed by an unexpected vendor.": {
            "Data": "Windows Event ID 4697; Windows Event ID 7045; Windows Event ID 4688",
            "Data Platform": "Servers, Endpoints",
            "NAI": "Insert site-specific NAI here",
            "Action": "Collect Windows Event IDs 4697 (Service Created) and 7045 (Service Install). Filter for services where the ServiceType indicates a kernel driver (0x1). Extract the ServiceFilepath. Check the digital signature and vendor of the .sys file if available. Flag driver services installed from temporary directories, user profile directories, or paths outside typical driver storage locations. Correlate with Event ID 4688 for the process that performed the service installation (e.g., sc.exe, PnPUtil.exe). Calculate frequency of driver installation paths across endpoints to identify rare ones."
          },
          "Unusual execution of a Windows service that is typically set to disabled or manual start, potentially followed by privileged actions.": {
            "Data": "Windows Event ID 7036; Windows Event ID 4688",
            "Data Platform": "Servers, Endpoints",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 7036 for service start/stop events. Filter for services whose StartType is configured as Disabled or Manual but are observed starting (State 'Running'). Baseline typical manual service starts per host/user. Flag instances where such services are started unexpectedly. Correlate the service start time with subsequent privileged process creation events (Windows Event ID 4688) originating from that service process or within the same logon session, looking for actions like creating users, modifying critical system files, or accessing sensitive resources. Use correlation analysis to link service starts with subsequent privileged events."
          }
        }
      },
      "version": "1.1",
      "last_updated": "2025-05-07"
    }
  }
]