[
  {
    "Is the adversary performing discovery using registry queries? (TA0007 - Discovery)": {
      "Indicators": {
        "T1012 - Query Registry": {
          "Execution of command-line utilities (Reg.exe) to query the Windows Registry.": {
            "Data": "Windows Event ID 4688",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 4688 for process creation. Filter events where the process is 'reg.exe' or variants, and the command line contains 'query' or 'read' followed by specific registry paths (e.g., HKLM\\\\SOFTWARE). Identify unusual users, parent processes, or query patterns (e.g., queries for security software, RDP settings, installed applications). Use frequency analysis to spot rare registry queries."
          },
          "Execution of PowerShell or other scripting/management tools performing unusual registry queries or unusual processes interacting directly with the registry.": {
            "Data": "Windows Event ID 4688",
            "Data Platform": "Endpoints, Servers",
            "NAI": "Insert site-specific NAI here",
            "Action": "Monitor Windows Event ID 4688 for execution of 'powershell.exe' or scripting engines. Analyze command lines for registry interactions (e.g., Get-ItemProperty, Get-ChildItem HKLM:\\\\...). Identify unusual scripts, users, or processes querying the registry. Perform correlation analysis between registry queries and subsequent suspicious activities (e.g., file writes, network connections) to establish a chain of behavior. Use time series analysis on frequency of such events per host to detect spikes."
          },
          "Suspicious network connections or host activity immediately following command-line or scripting-based registry queries.": {
            "Data": "Windows Event ID 4688; Zeek conn.log",
            "Data Platform": "Endpoints, Servers, Network devices",
            "NAI": "Insert site-specific NAI here",
            "Action": "Identify Windows Event ID 4688 events where command lines indicate registry queries (e.g., 'reg query', 'powershell.exe -command *Registry*'). Within a short time window (e.g., 60 seconds) after these events, search for Zeek conn.log entries from the same host with suspicious destinations (e.g., external IPs, internal hosts not normally accessed by this user/system) or unusual bytes transferred. Also look for subsequent suspicious process creation (4688) or network connection (5156) events. Use correlation analysis to link specific query patterns (e.g., querying for network configuration) to follow-on network activity."
          },
          "Remote management tool connections (e.g., WMI, WinRM) originating from unusual sources or targeting sensitive systems, potentially indicating remote registry discovery.": {
            "Data": "Zeek conn.log; Windows Event ID 4624",
            "Data Platform": "Servers, Network devices",
            "NAI": "Insert site-specific NAI here",
            "Action": "Filter Zeek conn.log for connections to common remote management ports (445, 5985, 5986). Identify source IPs that are external, part of known suspicious lists, or internal but associated with unexpected systems/users. Correlate these connections with successful network logons (Windows Event ID 4624, Logon Type 3) on the target system. Use frequency analysis and time series analysis to detect spikes or unusual patterns in the volume, timing, or source/destination pairs of these connections, especially targeting critical assets."
          }
        }
      },
      "version": "1.1",
      "last_updated": "2025-05-07"
    }
  }
]