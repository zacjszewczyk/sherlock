[
  {
    "information_requirement": "Is the adversary creating cloud snapshots to evade defenses or prepare for data exfiltration?",
    "tactic_id": "TA0005",
    "tactic_name": "Defense Evasion",
    "indicators": [
      {
        "technique_id": "T1578.001",
        "name": "Create Snapshot",
        "evidence": [
          {
            "description": "A cloud API call related to snapshot creation is observed where the source IP is on a threat intelligence list, or the User-Agent string deviates from known legitimate cloud SDK/CLI patterns.",
            "data_sources": [
              "Zeek conn.log",
              "Zeek http.log",
              "Zeek dns.log"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Internet Gateway, DNS Resolvers, Cloud API Endpoints",
            "action": [
              "Symbolic: Join Zeek conn.log with a threat intelligence feed on source IP addresses. Alert on any connection to a known cloud provider API endpoint (e.g., ec2.*.amazonaws.com, management.azure.com, compute.googleapis.com), identified via Zeek dns.log, from a matched malicious IP.",
              "Statistical: For all connections to cloud API endpoints, calculate the rarity of the User-Agent string from Zeek http.log across the organization over a 30-day baseline. A User-Agent that falls below the 1st percentile of frequency and is associated with snapshot creation API calls should be flagged for review.",
              "Machine Learning: Train a one-class SVM (Support Vector Machine) model on tuples of (User-Agent, Source ASN, Requested API Endpoint) from historical Zeek logs. Use the trained model to classify new API requests related to snapshots as 'normal' or 'anomalous'. Anomalies represent potential non-standard tool usage."
            ]
          },
          {
            "description": "The command-line arguments for a process creation event (Windows Event ID 4688) contain patterns indicative of snapshot creation, modification, or sharing using known cloud CLI tools (aws.exe, az.cmd, gcloud.cmd).",
            "data_sources": [
              "Windows Event ID 4688"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Administrator Workstations, CI/CD Pipeline Servers, Jump Boxes/Bastion Hosts",
            "action": [
              "Symbolic: Create a detection rule that uses regular expressions to scan the 'ProcessCommandLine' field in Windows Event ID 4688 for specific cloud CLI commands such as 'aws ec2 create-snapshot', 'az snapshot create', 'gcloud compute snapshots create', 'modify-snapshot-attribute', or 'az snapshot grant-access'. Alert on any match.",
              "Statistical: Calculate the entropy of command-line arguments for all cloud CLI tool executions. A sudden spike in entropy for a given user or host, particularly when combined with snapshot-related keywords, may indicate obfuscated commands. Flag commands with entropy scores greater than 3 standard deviations above the user's or host's 90-day baseline.",
              "Machine Learning: Use a pre-trained NLP model, like a Bidirectional LSTM, to classify command-line strings as benign or malicious. Fine-tune the model on a labeled dataset of legitimate and malicious cloud CLI commands. Deploy the model to score new snapshot-related command executions in real-time."
            ]
          },
          {
            "description": "A snapshot creation event is followed within a short time window (e.g., under 15 minutes) by an event that either makes the snapshot public, shares it with an unauthorized external account, or copies it to a different geographic region.",
            "data_sources": [
              "Windows Event ID 4688",
              "Zeek http.log",
              "AWS CloudTrail",
              "Azure Activity Logs",
              "Google Cloud Audit Logs"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Cloud Management Plane, Identity and Access Management (IAM) Service",
            "action": [
              "Symbolic: Create a correlation rule that triggers when a snapshot creation event (from Event ID 4688 or cloud audit logs) is followed within 15 minutes by a permission modification event for the same snapshot resource ID. The modification must involve adding a public group ('all') or an account ID not on an approved allow-list.",
              "Statistical: Model the time delta between snapshot creation and subsequent actions (e.g., modification, copy) for each user. Flag any user whose creation-to-sharing time delta is an outlier, for example, falling below the 5th percentile of their historical deltas, as this rapid sequence is suspicious.",
              "Machine Learning: Use a sequence analysis model, such as a Hidden Markov Model (HMM), where states represent actions (e.g., 'create-snapshot', 'modify-permissions', 'copy-snapshot'). Train the model on benign administrative workflows. A sequence of events with a low probability under the benign model, such as 'create' -> 'share-publicly', should generate a high-risk alert."
            ]
          },
          {
            "description": "A snapshot creation event is attributed to a user account or source host that has no established history of performing cloud administrative tasks, or the event occurs at a time that is anomalous for that specific user.",
            "data_sources": [
              "Windows Event ID 4688",
              "Windows Event ID 4624",
              "Zeek conn.log"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Authentication Servers, Administrator Workstations, Endpoint Devices",
            "action": [
              "Symbolic: Maintain an explicit list of authorized 'infrastructure admin' user accounts and hostnames. Trigger an alert if a snapshot creation command is executed by any user or on any host not on this list. Additionally, alert on the first time any user ever performs this action.",
              "Statistical: For each user, establish a baseline of normal activity hours using a histogram of event timestamps (from Event ID 4688 or 4624) over 90 days. Alert if a snapshot creation event occurs during a time window with historically zero activity (e.g., 2 AM - 5 AM for a 9-5 user).",
              "Machine Learning: Build an Isolation Forest model for each user based on features from their session activity: source IP geolocation, time of day, host used, and commands executed. Any snapshot creation event that is flagged as an 'anomaly' by the Isolation Forest model indicates a significant deviation from the user's established behavioral profile."
            ]
          },
          {
            "description": "A snapshot creation event is observed on a host within a short time window (e.g., 1-24 hours) following other suspicious activities such as the download of new cloud tooling, credential dumping, or extensive host/network discovery.",
            "data_sources": [
              "Windows Event ID 4688",
              "Zeek conn.log",
              "Zeek files.log"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Endpoint Devices, CI/CD Pipeline Servers, Internet Gateway",
            "action": [
              "Symbolic: Define a chained rule where an alert for a high-risk precursor event (e.g., Mimikatz execution, download of 'aws.exe' from a non-corporate URL detected in Zeek files.log) on a host is a prerequisite for escalating an alert for a subsequent snapshot creation event on the same host within 24 hours.",
              "Statistical: Develop a risk scoring system. Assign points to suspicious precursor activities (e.g., discovery commands = 1 point, credential access = 5 points, tool download = 3 points) occurring on a host. If the cumulative score for a host exceeds a statistically determined threshold (e.g., 95th percentile of daily scores across all hosts) and is followed by a snapshot creation, trigger a high-priority alert.",
              "Machine Learning: Use a supervised classification model (e.g., Gradient Boosting) trained on event sequences from known incidents and benign activity. Features would include counts of discovery commands, presence of credential access tool hashes, and network connection patterns within a time window preceding the snapshot creation. The model will output a probability that the sequence is malicious."
            ]
          }
        ]
      }
    ],
    "last_updated": "2025-09-30",
    "version": "2.2",
    "date_created": "2025-05-04",
    "contributors": [
      "Zachary Szewczyk"
    ]
  }
]