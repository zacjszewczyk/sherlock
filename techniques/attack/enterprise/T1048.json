[
  {
    "information_requirement": "Is the adversary exfiltrating data using a protocol other than the primary C2 channel? (TA0010 - Exfiltration)",
    "tactic_id": "TA0010",
    "tactic_name": "Exfiltration",
    "indicators": [
      {
        "technique_id": "T1048",
        "name": "Exfiltration Over Alternative Protocol",
        "evidence": [
          {
            "description": "An established outbound network connection (e.g., Zeek conn_state 'SF') or DNS query from an internal asset to an external destination (IP address, domain) that is present on a threat intelligence feed with a category of 'malware', 'command and control', or 'exfiltration'.",
            "data_sources": [
              "Zeek conn.log",
              "Zeek dns.log"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Internet Gateway, Egress Firewall, Corporate DNS Resolvers, Cloud Egress Points (e.g., NAT Gateways), Proxy Servers",
            "action": [
              "For every new connection in `Zeek conn.log`, join the destination IP (`id.resp_h`) against a threat intelligence feed of known malicious infrastructure. For every new query in `Zeek dns.log`, join the queried domain (`query`) against the same feed. Generate a high-severity alert for any match.",
              "For connections to newly observed domains or IPs (not seen in the last 30 days), calculate the sent-to-received byte ratio $$ R = \\frac{orig\\_bytes}{resp\\_bytes} $$. Alert on connections where $$ orig\\_bytes > 1MB $$ and the ratio $$ R $$ is in the 99th percentile of all outbound connections from the source host's subnet.",
              "Train a supervised classification model (e.g., XGBoost, Random Forest) on labeled historical data. Use features from `Zeek conn.log` (duration, protocol, service, orig_bytes, resp_bytes, conn_state) and derived features like JA3/JA3S hash, domain age, and public suffix. Use the model to predict a 'malicious exfiltration probability' for new connections to uncategorized destinations."
            ]
          },
          {
            "description": "A process creation event (Windows Event ID 4688) for a known data transfer utility (e.g., curl.exe, certutil.exe, bitsadmin.exe) or script interpreter (e.g., powershell.exe) with command-line arguments indicative of data upload, which is temporally correlated (within 60 seconds) with an outbound network connection from the same host to an external, non-corporate destination.",
            "data_sources": [
              "Windows Event ID 4688",
              "Zeek conn.log"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "User Workstations, Application Servers, Domain Controllers, Virtual Desktop Infrastructure (VDI)",
            "action": [
              "Create a detection rule that triggers on Windows Event ID 4688 where (ProcessName is 'certutil.exe' AND CommandLine contains '-urlcache -split -f') OR (ProcessName is 'bitsadmin.exe' AND CommandLine contains '/transfer') OR (ProcessName is 'powershell.exe' AND CommandLine contains 'Invoke-WebRequest -Uri'). Correlate this host-based event with an outbound connection from the same host in `Zeek conn.log` to a non-corporate IP address within 60 seconds.",
              "For processes like `curl.exe`, `certutil.exe`, and `powershell.exe`, calculate a baseline Shannon entropy score for their command-line arguments across the enterprise. Generate an alert when a new execution's command-line entropy exceeds 3 standard deviations from the historical mean for that specific process name, suggesting obfuscated or encoded data.",
              "Utilize a sequence mining algorithm to learn common process execution chains (parent -> child -> grandchild) and their associated network behaviors. Flag anomalous sequences, such as an Office application spawning `cmd.exe` which then spawns `powershell.exe` to make a large HTTP POST request, as this deviates from baselined normal user activity."
            ]
          },
          {
            "description": "Anomalous DNS or ICMP traffic patterns from a single host, evidenced by: (1) A high volume of DNS TXT or NULL queries to a single domain, (2) DNS query names with high character entropy, or (3) a sustained flow of ICMP echo request/reply packets with payloads consistently larger than 64 bytes.",
            "data_sources": [
              "Zeek dns.log",
              "Zeek icmp.log"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Internal DNS Servers, Internet Gateway, Network Egress Points, Domain Controllers",
            "action": [
              "Create a detection rule to alert when a single source IP sends more than 50 DNS TXT queries to a single domain within a 5-minute window. Also, alert on any ICMP Echo Request/Reply packet observed in `Zeek icmp.log` with a payload size greater than 128 bytes, which is anomalous for standard ping utilities.",
              "For each host, establish a 30-day baseline of DNS query type distribution (A, AAAA, TXT, etc.). Alert if the daily percentage of TXT or NULL queries exceeds the 99th percentile. Concurrently, calculate the entropy of all requested subdomains; alert on queries where the entropy is > 3.5, suggesting machine-generated names used for tunneling.",
              "Train a clustering algorithm (e.g., DBSCAN) on features extracted from `Zeek dns.log` per source-destination-domain tuple. Features should include query length, subdomain count, query entropy, and the ratio of different query types (TXT/A). Outlier clusters identified by the model represent strong candidates for DNS tunneling activity."
            ]
          },
          {
            "description": "The total volume of outbound data from a single host over a 24-hour period, segmented by protocol (e.g., HTTPS, DNS, SMB), exceeds a dynamically established statistical baseline by a significant margin. Alternatively, a single connection exhibits an anomalously high ratio of data sent versus data received ($$ orig\\_bytes >> resp\\_bytes $$).",
            "data_sources": [
              "Zeek conn.log",
              "Zeek files.log",
              "Zeek smb_files.log"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Internet Gateway, Core Network Switches, Servers Hosting Sensitive Data (e.g., file shares, databases)",
            "action": [
              "Create a rule that alerts if a single connection from a client workstation (identified by asset inventory) to an external IP address has `orig_bytes` > 100MB and `resp_bytes` < 1MB, excluding connections to known corporate cloud backup or file sharing services.",
              "For each internal host, calculate a 30-day rolling average and standard deviation of total daily outbound bytes, segmented by destination service (e.g., 'ssl', 'dns', 'smb'). Generate an alert if the daily total for any service exceeds the average by more than 3 standard deviations. This detects unusual bulk data transfer over any protocol.",
              "For high-value assets, implement a univariate time-series anomaly detection model (e.g., ARIMA) on the total outbound bytes per hour. The model forecasts the expected data volume. Generate an alert if the actual observed volume significantly exceeds the forecasted volume's upper confidence bound, indicating a potential bulk exfiltration event."
            ]
          },
          {
            "description": "Network traffic on a well-known TCP port (e.g., 53, 443) where the application-layer protocol, as identified by a network sensor's dynamic protocol detection (DPD), does not match the expected protocol for that port (e.g., SSH detected on TCP/443).",
            "data_sources": [
              "Zeek conn.log",
              "Zeek dpd.log",
              "Zeek ssl.log"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Network Taps/Sensors in the DMZ, Internet Gateway, Perimeter Firewalls",
            "action": [
              "Alert on any entry in Zeek's `dpd.log` where the `proto` and `analyzer` fields indicate a protocol violation (e.g., a connection on port 53 with an analyzer other than 'DNS'). Also, create a high-fidelity rule to find connections on TCP/443 that are in `conn.log` but have no corresponding `uid` in `ssl.log`, indicating non-TLS traffic.",
              "For each standard destination port (21, 22, 53, 80, 443), create a frequency table of the 'service' field from `Zeek conn.log` over a 30-day period. Alert if a new connection assigns a service that has historically accounted for less than 0.01% of traffic on that port, flagging rare protocol usage.",
              "Train a one-class SVM classifier on feature sets derived from legitimate traffic for a given port. For TCP/443, features would include `conn.log` fields (duration, orig_pkts, resp_pkts) and `ssl.log` fields (version, cipher, validation_status). Use the trained model to classify new connections as either 'normal' (inlier) or 'anomalous' (outlier), effectively identifying traffic like C2 over raw TCP sockets on port 443."
            ]
          }
        ]
      }
    ],
    "last_updated": "2025-09-30",
    "version": "2.3",
    "date_created": "2025-05-04",
    "contributors": [
      "Zachary Szewczyk",
      "Ask Sage"
    ]
  }
]