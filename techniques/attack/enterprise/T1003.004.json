[
  {
    "information_requirement": "Has the adversary accessed sensitive credentials stored in LSA secrets?",
    "tactic_id": "TA0006",
    "tactic_name": "Credential Access",
    "indicators": [
      {
        "technique_id": "T1003.004",
        "name": "LSA Secrets",
        "evidence": [
          {
            "description": "A new process is created where the process name or file hash matches a known credential dumping tool, or the process name is statistically rare for the environment.",
            "data_sources": [
              "Windows Event ID 4688"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Domain Controllers, Tier 0 Servers, Privileged Access Workstations (PAWs)",
            "action": "1. (Symbolic) Query process creation logs (Windows Event ID 4688) for process names (e.g., 'mimikatz.exe', 'pypykatz.exe') or file hashes matching a threat intelligence feed of known LSA secret dumping tools. An exact match generates a high-priority alert. 2. (Statistical) For all process creation events, calculate the historical frequency of each process name across the enterprise over the last 90 days. Flag any process name that falls below the 1st percentile in frequency and is not on an allowlist of known-good rare processes (e.g., installers, specific admin scripts). 3. (Machine Learning) Train a classification model (e.g., a Random Forest classifier) on features from Event ID 4688, such as parent process, user context, and process name string characteristics (entropy, length). The model will classify each process creation event as 'benign' or 'suspicious LSA access tool' and flag suspicious classifications for investigation."
          },
          {
            "description": "Process command-line arguments (Windows Event ID 4688) or PowerShell script block content (Windows Event ID 4104) contain strings, keywords, or obfuscated patterns indicative of LSA secret dumping.",
            "data_sources": [
              "Windows Event ID 4688",
              "Windows Event ID 4104"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Domain Controllers, Critical Application Servers, Endpoint devices of administrators",
            "action": "1. (Symbolic) Use regular expressions to scan command-line arguments and PowerShell script blocks for known LSA dumping commands and strings (e.g., 'lsadump::secrets', 'sekurlsa::lsa', 'Invoke-Mimikatz', 'LsaRetrievePrivateData'). A positive match triggers an alert. 2. (Statistical) Calculate the Shannon entropy of all PowerShell script blocks (Event ID 4104). Establish a baseline entropy score for typical administrative scripts. Flag any script block with an entropy score exceeding the 98th percentile, as high entropy is often indicative of obfuscation or packed payloads. 3. (Machine Learning) Use a Natural Language Processing (NLP) model to analyze the semantic content of PowerShell script blocks. The model, fine-tuned on a dataset of malicious and benign scripts, classifies them as 'malicious (credential dumping)' or 'benign' to detect novel or heavily obfuscated variations that regex might miss."
          },
          {
            "description": "A process not on an established allowlist accesses the LSA secrets registry key 'HKEY_LOCAL_MACHINE\\SECURITY\\Policy\\Secrets', as recorded by Windows Event ID 4656.",
            "data_sources": [
              "Windows Event ID 4656"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Domain Controllers, Tier 0 Servers, Servers with sensitive service accounts",
            "action": "1. (Symbolic) After enabling object access auditing on the 'HKEY_LOCAL_MACHINE\\SECURITY\\Policy\\Secrets' key, monitor Windows Event ID 4656. Create an explicit allowlist of authorized processes (e.g., 'lsass.exe') and user accounts (e.g., 'SYSTEM'). Alert on any access from a process or user not on this list. 2. (Statistical) For all access events to the LSA secrets key, build a statistical profile for each source process, including frequency of access and time of day. Alert if a process accesses the key with a frequency that is more than three standard deviations below its historical average (indicating a rare event) or at a time of day outside its typical 95% confidence interval. 3. (Machine Learning) Implement an anomaly detection model (e.g., Isolation Forest) on the stream of registry access events (Event ID 4656). Features can include the process name, user account, and time of day. The model will score each event based on its deviation from normal patterns, flagging highly anomalous access attempts."
          },
          {
            "description": "A process, not on an established allowlist, requests read access (e.g., PROCESS_VM_READ) to the LSASS process memory, as recorded by Windows Event ID 4656.",
            "data_sources": [
              "Windows Event ID 4656"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "All Windows Endpoints, All Windows Servers, Domain Controllers",
            "action": "1. (Symbolic) After configuring a SACL on the LSASS process object, monitor Windows Event ID 4656 for access requests. Maintain an allowlist of known-good processes that access LSASS memory (e.g., 'csrss.exe', 'wininit.exe', approved EDR/AV processes). Alert on any access from a source process not on this list, especially if the requested access rights include '0x10' (PROCESS_VM_READ). 2. (Statistical) For each process that accesses LSASS, track the count of unique hosts it performs this action on. Flag any non-system process that accesses LSASS memory on a number of hosts that is statistically unusual (e.g., below the 5th percentile for that process), which could indicate targeted dumping. 3. (Machine Learning) Use a time-series anomaly detection model on the count of LSASS access events per host. A sudden, sharp spike in the number of unique processes accessing LSASS memory on a single host would be flagged as a temporal anomaly indicative of a credential dumping campaign."
          },
          {
            "description": "A sequence of events occurs where a registry hive backup (SECURITY or SYSTEM) is created and then immediately accessed by a non-standard process, potentially followed by network exfiltration.",
            "data_sources": [
              "Windows Event ID 4688",
              "Windows Event ID 4663",
              "Zeek conn.log",
              "Zeek files.log"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Domain Controllers, File Servers hosting backups, Network Egress Points",
            "action": "1. (Symbolic) Create a correlation rule that triggers when a process creation event (Event ID 4688) for 'reg.exe save' or 'vssadmin create shadow' is followed within 5 minutes by file access (Event ID 4663) to the created hive file by a different, non-administrative process (e.g., 'powershell.exe', '7z.exe'). 2. (Statistical) Analyze Zeek files.log to establish a baseline of typical file types and sizes for outbound traffic. Flag any outbound transfer of files with '.sav' or '.hiv' extensions, or any file whose size is anomalously large (>95th percentile) and originates from a server shortly after a registry backup command was run on it. 3. (Machine Learning) Develop a sequence analysis model (e.g., a Hidden Markov Model) trained on sequences of events (process creation, file modification, network connection). The model flags sequences as anomalous if they match the pattern of [Backup Command -> File Access by Scripting Engine -> Outbound Network Connection to Rare IP], a strong indicator of offline hive theft."
          }
        ]
      }
    ],
    "last_updated": "2025-09-29",
    "version": "2.2",
    "date_created": "2025-05-04",
    "contributors": [
      "Zachary Szewczyk"
    ]
  }
]