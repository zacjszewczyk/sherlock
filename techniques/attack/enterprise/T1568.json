[
  {
    "information_requirement": "Is the adversary using dynamic resolution for Command and Control? (PIR)",
    "tactic_id": "TA0011",
    "tactic_name": "Command and Control",
    "indicators": [
      {
        "technique_id": "T1568",
        "name": "Dynamic Resolution",
        "evidence": [
          {
            "description": "An internal host sends a DNS query for a domain or initiates a network connection to an IP address that is present on a high-confidence threat intelligence feed of known DGA-generated domains or fast-flux C2 infrastructure.",
            "data_sources": [
              "Zeek dns.log",
              "Zeek conn.log"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Egress network gateways/firewalls, Internal DNS resolvers, Threat Intelligence Platforms",
            "action": [
              "Create a detection rule that performs a real-time lookup of every domain in the `query` field of Zeek dns.log and every destination IP in the `id.resp_h` field of Zeek conn.log against a threat intelligence feed of known DGA and fast-flux C2 indicators. Generate a critical alert for any match.",
              "For all domains matched by the threat intelligence feed, calculate the number of unique internal hosts that have queried them in the last 24 hours. Prioritize investigation of domains queried by more than one distinct host, as this may indicate a widespread campaign.",
              "Implement a machine learning model that uses the threat intelligence feed as a source of labeled data (malicious/benign). Use this model to periodically retrain a classifier that can identify new, previously unseen DGA domains based on features learned from the known-bad examples, supplementing the static IOC list."
            ]
          },
          {
            "description": "A DNS query response for a single domain contains an atypically high number of A/AAAA records or a Time-To-Live (TTL) value that falls below an established low-water mark (e.g., less than 300 seconds), indicative of fast-flux DNS.",
            "data_sources": [
              "Zeek dns.log"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Internal DNS resolvers, Egress network gateways/firewalls",
            "action": [
              "Create a detection rule that flags any DNS response in Zeek dns.log where the TTL value in the `TTLs` array is less than 300 seconds AND the number of IPs in the `answers` array is greater than 5. Tune these static thresholds based on observed network behavior.",
              "For each domain name, calculate the 30-day rolling average and standard deviation for its TTL and the number of answers in its DNS responses. Generate an alert when a new response for a domain has a TTL or answer count that is more than 3 standard deviations from its historical mean.",
              "Use time-series analysis on the set of IP addresses returned for each domain over time. Apply a clustering algorithm (e.g., DBSCAN) on the resolved IP addresses based on their ASN and geolocation to identify domains whose IPs are abnormally diverse and geographically dispersed, a characteristic of sophisticated fast-flux networks."
            ]
          },
          {
            "description": "An internal host establishes a TLS connection to a known public DNS over HTTPS (DoH) resolver, followed by periodic, low-volume network connections to an external IP address, indicative of C2 beaconing.",
            "data_sources": [
              "Zeek conn.log",
              "Zeek ssl.log"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Egress network gateways/firewalls, Endpoint devices",
            "action": [
              "Maintain a list of known public DoH resolver IPs and SNI values (e.g., 'dns.google', 'cloudflare-dns.com'). Create a rule to alert on any TLS connection from an internal host to one of these resolvers if DoH is against corporate policy, or to flag the host for heightened monitoring.",
              "For hosts flagged for DoH usage, analyze their subsequent outbound connections in Zeek conn.log. Calculate the inter-arrival time (time between connections) and data volume for all connections. Flag connections where the standard deviation of inter-arrival time is very low (indicating regular intervals) and the data volume is consistently small, which are statistical properties of C2 beaconing.",
              "Apply time-series analysis to the sequence of outbound connection events for a host following a DoH session. Use a forecasting model (e.g., ARIMA) to predict the timing and size of the next connection. A high-confidence prediction of a periodic, small connection indicates a strong beaconing signal."
            ]
          },
          {
            "description": "An internal host issues a DNS query for a domain name that exhibits statistical properties inconsistent with human-generated names, such as high Shannon entropy, unusual character distribution, or a low n-gram frequency score (T1568.002).",
            "data_sources": [
              "Zeek dns.log"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Internal DNS resolvers, Egress network gateways/firewalls",
            "action": [
              "Create a rule to flag any DNS query in Zeek dns.log for a domain that returns a 'NXDOMAIN' (non-existent domain) response code, as DGA malware often generates a high volume of queries for domains that have not yet been registered.",
              "For each domain in the Zeek dns.log `query` field, calculate its Shannon entropy score. Establish a baseline of entropy scores for legitimate domains on the network. Generate an alert for any domain whose entropy score exceeds the 99th percentile of the established baseline.",
              "Train a machine learning classification model (e.g., Random Forest) using features like domain length, entropy, vowel-to-consonant ratio, and n-gram model probability scores. Apply the trained model to all newly observed domains to classify them as DGA or legitimate."
            ]
          },
          {
            "description": "An internal host rapidly resolves the same domain name to many different IP addresses in a short time frame, indicative of a client-side fast-flux DNS behavior (T1568.001).",
            "data_sources": [
              "Zeek dns.log",
              "Zeek conn.log"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Endpoint devices, Internal DNS resolvers",
            "action": [
              "Create a rule that triggers when a single source host (Zeek dns.log `id.orig_h`) resolves a single domain name (`query`) to more than 10 unique IP addresses (`answers`) within a 5-minute window.",
              "Group DNS logs by source host and queried domain over a 1-hour window. For each group, calculate the entropy of the set of resolved IP addresses. Flag host-domain pairs where the IP set entropy is in the top 1% for the environment, indicating high IP churn.",
              "Model host-domain-IP relationships as a tripartite graph. Apply community detection or centrality algorithms to identify hosts that act as hubs connecting to an unusually large and diverse set of IPs for a single domain name, which is anomalous compared to normal browsing behavior."
            ]
          },
          {
            "description": "An internal host makes an outbound connection to an unusual IP address immediately after visiting a common, legitimate web service (e.g., social media, code repositories), suggesting a C2 IP derived via DNS Calculation (T1568.003).",
            "data_sources": [
              "Zeek http.log",
              "Zeek conn.log"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Egress network gateways/firewalls, Web proxies",
            "action": [
              "Maintain a list of legitimate services known to be abused for DNS Calculation (e.g., GitHub, Reddit, Pastebin). Create a rule to alert when a host visits one of these services and, within 5 seconds, initiates a connection to an IP address not associated with that service's known IP blocks.",
              "For each source host, calculate the time delta between an HTTP request to an abused service (from Zeek http.log) and any subsequent non-HTTP/S connection (from Zeek conn.log). Flag instances where this delta is consistently low and periodic, indicating a potential scripted C2 mechanism.",
              "Use sequence analysis to model typical user browsing patterns (e.g., sequence of sites visited, protocols used). Flag user sessions that contain the sequence [Visit Abused Service -> Initiate non-standard outbound connection] as a rare and suspicious event chain."
            ]
          },
          {
            "description": "A spike in DNS queries for newly registered domains (NRDs) or domains with very low global prevalence, which are often used for ephemeral C2 infrastructure.",
            "data_sources": [
              "Zeek dns.log",
              "Zeek conn.log"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Internal DNS resolvers, Egress network gateways/firewalls, Threat Intelligence Platforms",
            "action": [
              "Enrich Zeek dns.log with domain registration date information from a WHOIS or passive DNS provider. Create a rule to alert on any DNS query for a domain registered within the last 7 days.",
              "Establish a 30-day rolling baseline of the query volume for NRDs (domains registered < 30 days ago). Use statistical process control to alert when the hourly NRD query count exceeds 3 standard deviations above the mean, indicating an anomalous spike.",
              "Develop a reputation scoring model for domains using features such as registration age, query prevalence (e.g., via a passive DNS service), ASN reputation, and entropy. Classify domains with low reputation scores as high-risk and investigate associated connection activity in Zeek conn.log."
            ]
          }
        ]
      }
    ],
    "last_updated": "2025-09-30",
    "version": "2.2",
    "date_created": "2025-05-04",
    "contributors": [
      "Zachary Szewczyk"
    ]
  }
]