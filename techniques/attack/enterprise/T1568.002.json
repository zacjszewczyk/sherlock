[
  {
    "information_requirement": "Is the adversary communicating with command and control infrastructure using Domain Generation Algorithms?",
    "tactic_id": "TA0011",
    "tactic_name": "Command And Control",
    "indicators": [
      {
        "technique_id": "T1568.002",
        "name": "Domain Generation Algorithms",
        "evidence": [
          {
            "description": "A DNS query recorded in network logs matches a known DGA domain from a threat intelligence feed, or an outbound network connection is established to an IP address associated with a known DGA-based C2 server.",
            "data_sources": [
              "Zeek dns.log",
              "Zeek conn.log"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Enterprise DNS Resolvers, Network Egress Points (e.g., Firewalls, Proxies), Threat Intelligence Platforms",
            "action": [
              "Symbolic: Ingest DGA-specific threat intelligence feeds for domains and IPs into a watchlist. Continuously match the 'query' field in Zeek dns.log and the 'id.resp_h' field in Zeek conn.log against this watchlist. Generate a high-priority alert for any match.",
              "Statistical: For each intelligence feed, calculate its hit rate and the ratio of true positives to false positives over a 30-day rolling window. Use this to create a weighted scoring model where matches from higher-performing feeds contribute more to an alert's risk score.",
              "ML: Use a supervised learning model, such as Logistic Regression, to periodically re-classify intelligence feed effectiveness based on historical performance (hit rate, analyst feedback), automatically adjusting the weightings in the statistical scoring model."
            ]
          },
          {
            "description": "A DNS query is observed for a domain whose string characteristics (e.g., length between 16-32 characters, numeric character ratio > 20%, or a non-standard TLD) are consistent with a known, fingerprinted DGA family.",
            "data_sources": [
              "Zeek dns.log"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Enterprise DNS Resolvers, Internal host endpoints",
            "action": [
              "Symbolic: Develop and apply a library of regular expressions to the 'query' field in Zeek dns.log to detect structural patterns of known DGA families (e.g., ^[a-z0-9]{16,32}\\.com$). Alert on matches.",
              "Statistical: For each domain matching a structural pattern, calculate its statistical rarity (query prevalence) within the enterprise over the last 90 days. Combine the rule match with a rarity score below the 1st percentile to increase alert fidelity and prioritize investigation.",
              "ML: Train a classification model, such as a Decision Tree, on domain features like length, digit ratio, TLD, and n-gram score to predict if a domain belongs to a known DGA family, allowing for detection of variants that may not perfectly match a rigid regular expression."
            ]
          },
          {
            "description": "A DNS query for a domain name that scores above a statistically-defined threshold for linguistic randomness, as measured by metrics like character entropy or n-gram frequency.",
            "data_sources": [
              "Zeek dns.log"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Enterprise DNS Resolvers, Internal host endpoints",
            "action": [
              "Symbolic: Apply a whitelist of known-good high-entropy domains (e.g., CDNs like *.akamaiedge.net, cloud services). For all other domains, calculate Shannon entropy on the second-level domain string. Alert if the entropy score exceeds a fixed, high-confidence threshold (e.g., > 4.2).",
              "Statistical: For each new domain in Zeek dns.log (excluding TLD and whitelisted domains), calculate its Shannon entropy and its mean bigram/trigram frequency against a baseline model of legitimate traffic. Flag domains with entropy in the top 5th percentile and n-gram frequency in the bottom 5th percentile.",
              "ML: Implement a pre-trained machine learning classifier (e.g., Random Forest) that takes domain name string features (entropy, length, n-gram score, vowel-consonant ratio) as input and outputs a probability score of it being DGA-generated. Alert on domains with a score > 0.85."
            ]
          },
          {
            "description": "A DNS query is observed for a domain exhibiting one or more suspicious metadata characteristics: a WHOIS creation date within the last 30 days, a DNS response TTL value less than 300 seconds, or a prevalence of being queried by less than 0.1% of internal hosts over a 24-hour period.",
            "data_sources": [
              "Zeek dns.log",
              "Zeek conn.log",
              "External WHOIS Data"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Enterprise DNS Resolvers, Network Egress Points, Passive DNS and WHOIS databases",
            "action": [
              "Symbolic: For each resolved domain in Zeek dns.log, enrich it with WHOIS data. Create an alert if the domain's 'Creation Date' is within the last 30 days OR if the DNS response TTL is less than a static threshold of 300 seconds.",
              "Statistical: Calculate the prevalence of each domain queried by counting unique source IPs ('id.orig_h' in Zeek conn.log) over a 24-hour window. Flag domains queried by a number of hosts falling below the 1st percentile of the distribution. Combine flags (e.g., newly-registered AND rare) to generate a higher-confidence alert.",
              "ML: Use time-series analysis (e.g., anomaly detection on a 'newly registered domain query count' metric) to detect unusual spikes in activity related to newly created domains, which could indicate the start of a new campaign."
            ]
          },
          {
            "description": "A single source host generates a high volume of DNS queries for unique, non-existent domains, resulting in a storm of NXDOMAIN responses within a short time frame (e.g., 5 minutes).",
            "data_sources": [
              "Zeek dns.log"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Enterprise DNS Resolvers, Endpoint Devices",
            "action": [
              "Symbolic: For each source host ('id.orig_h'), count the number of unique queries in Zeek dns.log where 'rcode_name' is 'NXDOMAIN' over a 5-minute sliding window. Trigger a low-severity alert if the count exceeds a static threshold of 50.",
              "Statistical: For each host, establish a baseline of unique NXDOMAIN counts per 5-minute interval using a 14-day lookback. Continuously monitor and alert if a host's count exceeds its baseline mean by more than 3 standard deviations. Additionally, calculate the Shannon entropy of the set of failed domains; a high entropy score increases the alert's severity.",
              "ML: Use a time-series forecasting model (e.g., SARIMA) for each host's unique NXDOMAIN count. An observation that falls significantly outside the model's 95% prediction interval indicates anomalous behavior and should be flagged for investigation."
            ]
          },
          {
            "description": "The temporal correlation within a 60-second window of DGA-like DNS activity from a host (e.g., high entropy queries, NXDOMAIN storm) with the execution of an unsigned or anomalously-named process on that same host.",
            "data_sources": [
              "Zeek dns.log",
              "Windows Event ID 4688",
              "Sysmon Event ID 1"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Endpoint Devices, Domain Controllers, Application Servers, Enterprise DNS Resolvers",
            "action": [
              "Symbolic: When a host triggers a DGA-related network alert (e.g., from high entropy or NXDOMAIN analysis), query host logs (Windows Event ID 4688, Sysmon Event ID 1) from that host for +/- 60 seconds around the alert timestamp. Look for process creation events where the process is unsigned, runs from a non-standard directory (e.g., C:\\Users\\Public), or has a suspicious command line.",
              "Statistical: Establish a baseline of normal parent-child process relationships for the environment. When a DGA network alert occurs, check for associated process creation events on the host that represent a statistically rare parent-child relationship (e.g., winword.exe spawning powershell.exe, occurring less than 0.01% of the time).",
              "ML: Use an unsupervised learning model (e.g., Isolation Forest) on process features (path, name, parent, command line entropy) to identify anomalous processes. Correlate these host-based anomaly scores with network-based DGA scores in near real-time to create a composite risk score for a given host's activity."
            ]
          }
        ]
      }
    ],
    "last_updated": "2025-09-30",
    "version": "2.3",
    "date_created": "2025-05-04",
    "contributors": [
      "Zachary Szewczyk"
    ]
  }
]