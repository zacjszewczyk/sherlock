[
  {
    "information_requirement": "Is the adversary executing code using scheduled tasks via the at utility?",
    "tactic_id": "TA0002",
    "tactic_name": "Execution",
    "indicators": [
      {
        "technique_id": "T1053.002",
        "name": "At",
        "evidence": [
          {
            "description": "A scheduled task is created or executed via 'at.exe' where the command line arguments contain a file hash, domain, or IP address matching an entry in a threat intelligence feed.",
            "data_sources": [
              "Windows Event ID 4698",
              "Windows Event ID 4688",
              "Zeek conn.log",
              "Zeek dns.log"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Domain Controllers, Critical Application Servers, Standard User Workstations, Network Egress Points",
            "action": [
              "Symbolic: Create a detection rule that parses command line arguments from task creation (Event ID 4698) and process execution (Event ID 4688) events. Correlate any extracted file hashes, domains, or IP addresses against a threat intelligence feed. Generate an alert for any match.",
              "Statistical: For all network connections (Zeek conn.log) originating from processes spawned by scheduled tasks, calculate the rarity of the destination IP address across the enterprise over a 30-day window. Flag connections to IPs in the lowest percentile (e.g., <1%) of prevalence for investigation, as they may represent new or unique C2 infrastructure.",
              "Machine Learning: Train a supervised classification model (e.g., Logistic Regression) on command-line strings from process events, using features like string length, character entropy, and the presence of IOC patterns. Use the model to score the likelihood that a command executed by a scheduled task is malicious."
            ]
          },
          {
            "description": "Execution of the deprecated 'at.exe' binary, or creation of a scheduled task via the 'Win32_ScheduledJob' WMI class, which then invokes a script interpreter (e.g., powershell.exe, cmd.exe, wscript.exe).",
            "data_sources": [
              "Windows Event ID 4688",
              "Windows Event ID 4698",
              "Microsoft-Windows-WMI-Activity/Operational Event ID 5861"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Domain Controllers, Tier 0/1 Servers, Standard User Workstations",
            "action": [
              "Symbolic: Create a high-priority alert for any process creation event (Event ID 4688) where the process name is 'at.exe'. Since this utility is deprecated, any execution is highly anomalous and suspicious.",
              "Statistical: Establish a baseline of parent-child process relationships. Monitor for process creation events (Event ID 4688) where a script interpreter (powershell.exe, cmd.exe) is spawned by the Task Scheduler service's host process (svchost.exe). Flag instances that are statistically rare compared to the established baseline.",
              "Machine Learning: Use an anomaly detection algorithm (e.g., Isolation Forest) on WMI task creation events (Event ID 5861 for WMI execution, correlated with Event ID 4698). Features should include the client process ID, user, and the command being executed to identify unusual WMI-based scheduling activity."
            ]
          },
          {
            "description": "A child process is spawned by the Task Scheduler service (taskeng.exe on older systems, svchost.exe on modern systems) whose process name, command-line arguments, or file path is statistically rare compared to a historical baseline of legitimate scheduled tasks.",
            "data_sources": [
              "Windows Event ID 4688"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "All Windows Endpoints and Servers",
            "action": [
              "Symbolic: Maintain an allow-list of known-good executables run by the Task Scheduler. Alert on any process execution (Event ID 4688 with parent svchost.exe/taskeng.exe) where the child process name is not on the list.",
              "Statistical: For all child processes of the Task Scheduler service, calculate the frequency of each unique command-line string. Alert on command lines that fall into the lowest frequency percentile (e.g., 1st percentile), indicating they are rare across the environment.",
              "Machine Learning: Use an unsupervised clustering algorithm (e.g., DBSCAN) on process event features (process path, command line entropy, parent process) to group scheduled task executions. Investigate small or isolated clusters as they represent anomalous activity that deviates from common, legitimate task behavior."
            ]
          },
          {
            "description": "A scheduled task's action is configured to execute a binary located in a user-writable or non-standard system directory (e.g., %APPDATA%, %TEMP%, C:\\Users\\Public\\).",
            "data_sources": [
              "Windows Event ID 4698",
              "Windows Event ID 4688"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Standard User Workstations, Multi-user Servers (e.g., Citrix, RDS)",
            "action": [
              "Symbolic: Create a detection rule that alerts when the executable path in a task creation event (Event ID 4698) or process execution event (Event ID 4688) matches a pattern for user-writable locations like '\\Users\\', '\\Temp\\', '\\ProgramData\\', or '\\Perflogs'.",
              "Statistical: Profile the frequency of all executable parent directories for processes spawned by scheduled tasks. Any directory that is statistically rare (e.g., below the 5th percentile) should be flagged as a potential non-standard execution location.",
              "Machine Learning: Train a classifier (e.g., Naive Bayes) to distinguish between legitimate and suspicious file paths based on features like path depth, directory name semantics, and file extension. Apply this model to executable paths found in scheduled task events to produce a risk score."
            ]
          }
        ]
      }
    ],
    "version": "2.2",
    "date_created": "2025-05-04",
    "last_updated": "2025-09-30",
    "contributors": [
      "Zachary Szewczyk"
    ]
  },
  {
    "information_requirement": "Is the adversary using scheduled tasks via the at utility for persistence?",
    "tactic_id": "TA0003",
    "tactic_name": "Persistence",
    "indicators": [
      {
        "technique_id": "T1053.002",
        "name": "At",
        "evidence": [
          {
            "description": "A scheduled task is created with a persistence trigger (e.g., logon, startup) and its associated process execution subsequently initiates a network connection to a domain or IP address on a threat intelligence feed.",
            "data_sources": [
              "Windows Event ID 4698",
              "Windows Event ID 4688",
              "Zeek conn.log",
              "Zeek dns.log"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "All Windows Endpoints and Servers, Network Egress Points, DNS Servers",
            "action": [
              "Symbolic: Upon detection of a task with a persistence trigger (e.g., LogonType 3 in Event ID 4698), correlate the process execution (Event ID 4688) with subsequent network connections (Zeek conn.log). Match destination IPs against an IOC blocklist and alert on any hits.",
              "Statistical: For processes spawned by persistent scheduled tasks, analyze the entropy of their DNS queries (Zeek dns.log). A consistently high entropy score can indicate the use of a Domain Generation Algorithm (DGA) for C2 communication.",
              "Machine Learning: Use a time-series analysis model to monitor network traffic volume and connection counts (Zeek conn.log) for processes associated with persistent tasks. Detect periodic, 'heartbeat' patterns indicative of C2 beaconing, even to unknown destinations."
            ]
          },
          {
            "description": "A scheduled task is created or updated with a trigger configured for system startup, user logon, or a high-frequency recurrence (e.g., every few minutes), where the task is not associated with a known software installation or administrative script.",
            "data_sources": [
              "Windows Event ID 4698",
              "Windows Event ID 4702"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Domain Controllers, All Windows Endpoints and Servers",
            "action": [
              "Symbolic: Create a rule to alert on any task creation (Event ID 4698) or update (Event ID 4702) that includes a logon or startup trigger, or a repetition interval of less than 15 minutes, and is not on a pre-defined allow-list of administrative tasks.",
              "Statistical: Establish a baseline of task trigger types across the environment. Alert when a new task's trigger configuration (e.g., 'At logon' combined with a non-admin creator) is a statistical outlier compared to all other tasks.",
              "Machine Learning: Use a one-class SVM trained on legitimate task properties (trigger type, author, command path, binary signature) to detect novel or anomalous task configurations. This can identify persistence mechanisms that use unusual combinations of legitimate-seeming attributes."
            ]
          },
          {
            "description": "A scheduled task is created and is not subsequently deleted within a typical administrative window (e.g., 24 hours), and cannot be correlated with a change management ticket, software deployment, or patching activity.",
            "data_sources": [
              "Windows Event ID 4698",
              "Windows Event ID 4699"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Configuration Management Database (CMDB), All Windows Endpoints and Servers",
            "action": [
              "Symbolic: Join task creation events (Event ID 4698) with task deletion events (Event ID 4699) by Task Name and Host. Alert on any task that persists beyond a defined threshold (e.g., 30 days) and is not on an allow-list of known-good persistent tasks.",
              "Statistical: Analyze the distribution of scheduled task lifespans (time between creation and deletion). Flag newly created tasks whose intended lifespan (based on configuration) or observed lifespan falls in the upper percentile (e.g., 99th) and are not from a known software installer.",
              "Machine Learning: Use Natural Language Processing (NLP) on task names and descriptions from Event ID 4698 to classify them into categories like 'Software Update', 'Admin Script', or 'Unknown'. Persisting tasks classified as 'Unknown' should be prioritized for investigation."
            ]
          }
        ]
      }
    ],
    "version": "2.2",
    "date_created": "2025-05-04",
    "last_updated": "2025-09-30",
    "contributors": [
      "Zachary Szewczyk"
    ]
  },
  {
    "information_requirement": "Is the adversary escalating privileges using scheduled tasks via the at utility?",
    "tactic_id": "TA0004",
    "tactic_name": "Privilege-Escalation",
    "indicators": [
      {
        "technique_id": "T1053.002",
        "name": "At",
        "evidence": [
          {
            "description": "A file executed by a scheduled task has a hash that matches a known privilege escalation tool, exploit (e.g., PrintNightmare, Potato exploits), or credential theft utility (e.g., Mimikatz).",
            "data_sources": [
              "Windows Event ID 4698",
              "Windows Event ID 4688",
              "Sysmon Event ID 11"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "All Windows Endpoints and Servers, especially Domain Controllers and Tier 0/1 Servers",
            "action": [
              "Symbolic: Upon task execution (Event ID 4688), hash the executable file and check it against a threat intelligence feed of known hacking tools. An alert should be generated on any confirmed match.",
              "Statistical: Profile the prevalence of file hashes executed by scheduled tasks across the enterprise. Any hash that is unique or extremely rare (e.g., seen on only one machine) should be flagged for analysis, as privilege escalation tools are not typically widespread.",
              "Machine Learning: Utilize a pre-trained machine learning model that analyzes PE file features to classify binaries as malicious. When a scheduled task executes a previously unseen binary, submit its features to the model to obtain a risk score and alert if it exceeds a threshold."
            ]
          },
          {
            "description": "A process spawned by a scheduled task running with SYSTEM privileges (NT AUTHORITY\\SYSTEM) executes commands known to be used for privilege escalation, such as creating a new local administrator ('net user /add') or modifying a service ('sc.exe config').",
            "data_sources": [
              "Windows Event ID 4698",
              "Windows Event ID 4688"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Domain Controllers, Member Servers, Administrator Workstations",
            "action": [
              "Symbolic: Create a high-severity alert for any process (Event ID 4688) that is a child of the task scheduler service, runs as SYSTEM, and has a command line containing strings such as 'net user /add', 'net localgroup administrators /add', or 'sc.exe create'.",
              "Statistical: For all commands executed by SYSTEM-level scheduled tasks, establish a baseline of common administrative command patterns. Use n-gram analysis on command-line arguments to flag command sequences that are statistically improbable compared to the baseline.",
              "Machine Learning: Train a sequence-based model (e.g., an LSTM) on the typical command-line histories for hosts running sensitive workloads. An alert is generated if a privileged command executed by a task represents a significant deviation from the learned legitimate sequences of system administration."
            ]
          },
          {
            "description": "A task creation event (Windows Event ID 4698) shows the 'Subject User Name' (creator) is a standard, non-administrative user, but the task is configured to run as 'NT AUTHORITY\\SYSTEM' or another privileged account.",
            "data_sources": [
              "Windows Event ID 4698"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "All Windows Endpoints and Servers",
            "action": [
              "Symbolic: Create a high-severity alert for any task creation event (Event ID 4698) where the 'SubjectUserSid' does not belong to a privileged group (e.g., Domain Admins, BUILTIN\\Administrators) but the task's 'Principal/UserId' is 'S-1-5-18' (SYSTEM).",
              "Statistical: For each user, calculate the ratio of tasks they create that run as a privileged account versus tasks that run as themselves. Flag users whose ratio is a statistical outlier (e.g., > 3 standard deviations above the organizational mean), indicating an abnormal pattern of creating high-privilege tasks.",
              "Machine Learning: Use an anomaly detection algorithm (e.g., Isolation Forest) on task creation events, using features like the creator's account, the 'run-as' account, the host, and time of day. This can identify unusual combinations that signify a misconfiguration being exploited or an active privilege escalation attempt."
            ]
          }
        ]
      }
    ],
    "version": "2.2",
    "date_created": "2025-05-04",
    "last_updated": "2025-09-30",
    "contributors": [
      "Zachary Szewczyk"
    ]
  }
]