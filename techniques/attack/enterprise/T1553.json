[
  {
    "information_requirement": "Is the adversary attempting to bypass security controls by subverting trust mechanisms? (PIR)",
    "tactic_id": "TA0005",
    "tactic_name": "Defense Evasion",
    "indicators": [
      {
        "technique_id": "T1553",
        "name": "Subvert Trust Controls",
        "evidence": [
          {
            "description": "A process executes a binary signed by a certificate whose thumbprint or issuer matches a known-bad entry in a threat intelligence feed, or a new certificate is added to a trust store that matches a known-bad thumbprint.",
            "data_sources": [
              "Windows Event ID 4688",
              "Zeek x509.log"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "All Endpoints and Servers, Network Egress/Ingress Points, Domain Controllers",
            "action": [
              "Symbolic: Query for process creation events (Windows Event ID 4688) and network certificate logs (Zeek x509.log). Extract the certificate thumbprint and issuer for each. Join this data with a threat intelligence feed of known malicious certificate thumbprints and issuers. Alert on any match.",
              "Statistical: For all newly observed certificates in Zeek x509.log, calculate the entropy of the issuer and subject common name fields. Flag certificates where the entropy is in the 99th percentile, suggesting randomized or non-standard naming conventions often used by adversaries.",
              "Machine Learning: Train a classification model (e.g., Random Forest) on features extracted from Zeek x509.log (e.g., certificate validity period, key length, self-signed status, entropy of subject/issuer). Use the model to predict the probability of a certificate being malicious. Alert on newly observed certificates with a high probability score."
            ]
          },
          {
            "description": "The execution of certutil.exe, reg.exe, or PowerShell.exe with command-line arguments or script block content that explicitly adds a certificate to a root store, modifies certificate-related registry keys, or disables trust provider checks.",
            "data_sources": [
              "Windows Event ID 4688",
              "Windows PowerShell Logging Event ID 4104"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "All Endpoints and Servers, Domain Controllers, Certificate Authority Servers",
            "action": [
              "Symbolic: Search process command-line logs (Windows Event ID 4688) and PowerShell script block logs (Event ID 4104) for regular expressions matching known malicious patterns, such as `certutil.exe -addstore root`, `Import-Certificate -FilePath .* -CertStoreLocation Cert:\\LocalMachine\\Root`, or registry modifications to `HKLM\\SOFTWARE\\Microsoft\\SystemCertificates`.",
              "Statistical: Establish a baseline of command-line arguments for `certutil.exe`. Calculate the frequency of argument combinations (e.g., `-addstore`, `-delstore`, `-f`). Flag executions where the argument combination is rare (e.g., seen on < 1% of hosts) or has a low historical frequency for that specific host.",
              "Machine Learning: Use a sequence analysis model (e.g., LSTM) to analyze the order of commands executed by a user or on a host. Train the model on benign command sequences. Flag anomalous sequences, such as a process downloading a file from the internet, followed by a PowerShell script execution that calls `Import-Certificate`, as a high-risk deviation from normal behavior."
            ]
          },
          {
            "description": "A certificate file (e.g., .cer, .crt, .p7b) is downloaded from an external network source, and within a short time window (e.g., under 5 minutes), a process on the same host installs a certificate into a system trust store.",
            "data_sources": [
              "Zeek files.log",
              "Windows Event ID 4688",
              "Zeek conn.log"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Network Egress/Ingress Points, User Workstations, Public-Facing Servers",
            "action": [
              "Symbolic: Correlate Zeek files.log entries for mime-type `application/x-x509-ca-cert` with subsequent process creation events (Windows Event ID 4688) on the same host IP address within a 5-minute window. Specifically look for `certutil.exe` or `PowerShell.exe` in the process name with arguments related to certificate installation.",
              "Statistical: For each host, calculate the baseline rate of certificate installations per day. Use a moving average and standard deviation to model this rate. Alert when the number of certificate installations in a 24-hour period exceeds 3 standard deviations above the host's historical average, especially if preceded by downloads from uncategorized or low-reputation domains (from Zeek dns.log).",
              "Machine Learning: Apply a time-series anomaly detection algorithm (e.g., Seasonal-Hybrid ESD) to the count of certificate installation events across the enterprise. Identify statistically significant spikes in installation activity that could indicate a coordinated campaign to deploy a malicious root certificate."
            ]
          },
          {
            "description": "An executable is launched that is signed by a certificate that is either new to the environment, has an anomalously short validity period, is self-signed and not part of an established software baseline, or has a low-prevalence issuer.",
            "data_sources": [
              "Windows Event ID 4688",
              "Zeek pe.log"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "All Endpoints and Servers, Software Distribution Points, Developer Workstations",
            "action": [
              "Symbolic: Maintain an allowlist of known-good code-signing certificate thumbprints for your organization's standard software. Alert on any process execution (Windows Event ID 4688) where the signing certificate thumbprint is not on the allowlist.",
              "Statistical: Create a baseline of all code-signing certificate issuers and thumbprints seen in the environment over the last 90 days. For each new execution, calculate the prevalence of its signing certificate (number of hosts it's seen on). Flag executables signed by certificates seen on fewer than 5 hosts or less than 0.1% of the total fleet, prioritizing those with a recent `not_valid_before` date from Zeek pe.log.",
              "Machine Learning: Use a clustering algorithm (e.g., DBSCAN) on certificate features (issuer, validity duration, key algorithm, subject name) to group similar legitimate certificates. Treat certificates that do not fall into any cluster (i.e., noise points) as outliers requiring investigation, as they do not share common properties with trusted software in the environment."
            ]
          },
          {
            "description": "An executable or script file is downloaded from a 'source' of 'HTTP' or 'FTP' in Zeek files.log, and is subsequently executed on a host without evidence of the Zone.Identifier Alternate Data Stream (ADS) being present or queried, indicating a bypass of Mark-of-the-Web (MOTW) security warnings.",
            "data_sources": [
              "Zeek files.log",
              "Windows Event ID 4688",
              "Windows Event ID 4663"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "User Workstations, Email Gateway, Web Proxies, File Servers",
            "action": [
              "Symbolic: Monitor command-line logs (Windows Event ID 4688) for the execution of utilities known to manipulate ADS, such as `streams.exe -d` or PowerShell's `Remove-Item -Path .* -Stream Zone.Identifier`. Correlate this with a recent file download by the same user or on the same host.",
              "Statistical: Establish a baseline for the ratio of file downloads (from Zeek files.log) to process executions of those same files (Windows Event ID 4688) on a per-user basis. Flag users whose ratio of execution-to-download is anomalously high, suggesting they are executing downloaded files more frequently than their peers, which could indicate automated MOTW bypass.",
              "Machine Learning: Train a decision tree classifier to predict if a downloaded file execution is suspicious. Features could include: file type, download source reputation (from Zeek intel.log), time between download and execution, parent process of the execution, and whether any ADS-manipulation commands were run in the same session. A predicted suspicious execution would trigger an alert."
            ]
          }
        ]
      }
    ],
    "last_updated": "2025-09-30",
    "version": "2.2",
    "date_created": "2025-05-04",
    "contributors": [
      "Zachary Szewczyk"
    ]
  }
]