[
  {
    "information_requirement": "Are unauthorized tools or files being transferred to critical ICS assets like HMIs, Engineering Workstations, or Historians? (PIR)",
    "tactic_id": "TA0109",
    "tactic_name": "Lateral Movement",
    "indicators": [
      {
        "technique_id": "T0867",
        "name": "Lateral Tool Transfer",
        "evidence": [
          {
            "description": "A successful network file transfer event (e.g., SMB, FTP, SFTP) recorded in network flow or file logs, indicating a file with an executable (.exe, .dll, .bin), script (.ps1, .bat, .vbs, .sh), archive (.zip, .rar, .7z), or potentially malicious (e.g., .hta, .jar, .iso) extension, or with internal file magic bytes identifying it as an executable, was transferred to an IP address categorized as a critical ICS asset (e.g., HMI, Engineering Workstation, Historian, PLC programming terminal). The source IP address of this transfer is not present on an approved whitelist of systems authorized to transfer such file types to critical ICS assets.",
            "data_sources": [
              "Zeek smb_files.log",
              "Zeek ftp.log",
              "Zeek sftp.log",
              "Zeek files.log",
              "Zeek conn.log"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Network segments where critical ICS assets (e.g., HMIs, Engineering Workstations, Historians, PLC programming terminals) communicate, particularly at IT/OT zone boundaries, within the industrial control network (e.g., Level 2/3 networks), and at demilitarized zones (DMZs) connecting IT to OT.",
            "action": "1. Symbolic Logic: Query Zeek smb_files.log, ftp.log, sftp.log, and files.log for records where the 'fuid' (file unique ID) indicates a file transfer to an IP address identified as a critical ICS asset. Filter for 'filename' values ending in known executable, script, or archive extensions (.exe, .dll, .bin, .ps1, .bat, .vbs, .sh, .zip, .rar, .7z, .hta, .jar, .iso). Additionally, identify transfers where 'path' in smb_files.log contains administrative shares (e.g., 'C$', 'ADMIN$'). Alert immediately if the 'id.orig_h' (source IP) from the associated Zeek conn.log is not on an approved whitelist of IPs authorized to transfer such file types to critical ICS assets. 2. Statistical Method: For all Zeek smb_files.log, ftp.log, sftp.log, and files.log entries representing transfers to critical ICS assets, calculate the Shannon entropy of the 'filename' field and the file content (if available). Establish a rolling 30-day baseline for filename and file content entropy values for each critical ICS asset. Generate an alert when a transferred file's filename entropy value or its content entropy value exceeds the 95th percentile of the established baseline for that specific ICS asset, indicating a potentially obfuscated, compressed, or randomly generated filename/content. Also, track the frequency of file transfers by size and destination. Alert on transfers of unusually large or small files that fall outside the 99th percentile of historical file sizes transferred to ICS assets. 3. Machine Learning Application: Develop a time-series anomaly detection model (e.g., Isolation Forest or Prophet) trained on historical (e.g., 90 days) Zeek smb_files.log, ftp.log, sftp.log, and files.log data, specifically focusing on the volume, frequency, and type of executable/archive file transfers to critical ICS assets. The model should learn normal patterns of file transfer activity, including typical source IPs, destination assets, file extensions, and transfer times. Alert on significant deviations (e.g., a sudden increase in the number of executable transfers, transfers of unusual file types, or transfers from uncharacteristic source IPs/ports) that fall outside the model's learned normal behavior, which could indicate a lateral tool transfer event."
          },
          {
            "description": "A Windows Event ID 5145 ('A network share object was checked to see if client can be granted desired access') is generated on a critical ICS host, where the 'Accesses' field contains 'WriteData' or 'AppendData', the 'ShareName' corresponds to an administrative share (e.g., C$, ADMIN$) or a sensitive system directory (e.g., 'Windows\\System32', 'Program Files'), and the 'SourceAddress' or 'AccountName' associated with the event is not present on an established whitelist of authorized entities or systems permitted to perform write operations to that specific share or directory on the ICS asset.",
            "data_sources": [
              "Windows Event ID 5145"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Endpoint devices configured as critical ICS assets (e.g., HMIs, Engineering Workstations, Historians, OPC Servers, Domain Controllers within the OT network, SCADA servers) where Windows security auditing is enabled for file share access, typically configured via Group Policy Objects (GPOs).",
            "action": "1. Symbolic Logic: Filter Windows Event ID 5145 logs on critical ICS hosts. Identify events where the 'Accesses' field contains 'WriteData' or 'AppendData'. Further filter for events where the 'ShareName' ends with '$' (indicating an administrative share) or the 'RelativeTargetName' contains paths to sensitive system directories (e.g., 'Windows\\System32', 'Program Files', common application installation paths). Alert immediately if the 'SourceAddress' or 'AccountName' associated with the event is not found in an approved whitelist of users/systems authorized to write to these shares/directories on the specific ICS asset. 2. Statistical Method: For each critical ICS host, establish a 30-day rolling baseline of Windows Event ID 5145 write events. Track the frequency and volume of write operations for unique combinations of 'SourceAddress', 'AccountName', and 'ShareName'. Calculate the mean and standard deviation for these metrics. Generate an alert when the current count of write events for a specific 'SourceAddress'-'AccountName'-'ShareName' tuple exceeds the 99th percentile or two standard deviations from its historical baseline, or when a completely new 'SourceAddress'-'AccountName' pair is observed performing write operations to an administrative share for the first time. Apply a similar statistical analysis to the 'RelativeTargetName' field to detect writes to unusual or unexpected directories. 3. Machine Learning Application: Implement an unsupervised user behavior analytics (UBA) model (e.g., Isolation Forest or One-Class SVM) on aggregated Windows Event ID 5145 data. Train the model to profile normal write access patterns for each critical ICS host, considering attributes such as 'SourceAddress', 'AccountName', 'ShareName', 'Accesses', 'RelativeTargetName', 'time of day', and 'day of week'. Alert when the model identifies a significant anomaly score for a write event, indicating behavior that deviates substantially from established normal user or system interaction patterns with network shares on ICS assets, such as a write from an unusual source or to an uncommon location."
          },
          {
            "description": "A correlation between a Windows Event ID 5145 ('A network share object was checked to see if client can be granted desired access') indicating a successful file write to a critical ICS host, and a subsequent Windows Event ID 4688 ('A new process has been created') on the same host. The 'NewProcessName' (full path to executable) from Event ID 4688 must exactly match the 'RelativeTargetName' (full path of file written) from the preceding Event ID 5145, and the timestamp of Event ID 4688 must occur within 300 seconds (5 minutes) after the timestamp of Event ID 5145. This sequence directly indicates the immediate execution of a recently transferred file.",
            "data_sources": [
              "Windows Event ID 5145",
              "Windows Event ID 4688"
            ],
            "data_platforms": [
              "TBD"
            ],
            "nai": "Critical ICS hosts (e.g., HMIs, Engineering Workstations, Historians, application servers, OPC Servers, PLC programming workstations) with robust Windows security event logging enabled for both detailed file share auditing and process creation, typically configured via Group Policy Objects (GPOs).",
            "action": "1. Symbolic Logic: For critical ICS hosts, join Windows Event ID 5145 events (where 'Accesses' contains 'WriteData' or 'AppendData') with Windows Event ID 4688 events. Correlate events where the 'RelativeTargetName' from Event ID 5145 exactly matches the 'NewProcessName' from Event ID 4688, and the timestamp of Event ID 4688 occurs within 300 seconds (5 minutes) after the timestamp of Event ID 5145 on the same host. Trigger a high-priority alert for any successful correlation, as this indicates immediate execution of a recently transferred file. Exclude known legitimate applications or operational scripts that follow this pattern during specific, whitelisted maintenance windows. 2. Statistical Method: Establish a 90-day baseline of legitimate process creations from network shares on critical ICS hosts by analyzing historical correlations between Windows Event ID 5145 and 4688. Calculate the average and standard deviation of the time delta between file transfer and process creation for known legitimate applications or operational scripts. Flag correlations where the time delta is significantly shorter (e.g., below the 5th percentile) than the established baseline for legitimate applications, or where the 'NewProcessName' is entirely new or has a very low frequency count (e.g., less than 5 occurrences in 90 days) for that specific host. Additionally, track the frequency of such correlations for each unique 'SourceAddress' and 'AccountName'. Alert if a 'SourceAddress' or 'AccountName' that rarely or never initiates such sequences suddenly does so. 3. Machine Learning Application: Develop a sequence-based anomaly detection model (e.g., Hidden Markov Model or recurrent neural network) that learns typical sequences of file transfer (Windows Event ID 5145) followed by process creation (Windows Event ID 4688) on critical ICS hosts. Train the model on historical event sequences to understand normal operational workflows and application updates, considering attributes like 'SourceAddress', 'AccountName', 'ShareName', 'RelativeTargetName', 'NewProcessName', and time delta. Alert when an observed sequence deviates significantly from learned normal patterns, such as an unexpected executable being run shortly after a network transfer, a sequence occurring outside of normal maintenance windows, or a sequence involving an 'AccountName' not typically associated with such actions, indicating potential malicious lateral tool transfer and execution."
          }
        ]
      }
    ],
    "version": "1.3",
    "date_created": "2025-09-26",
    "last_updated": "2025-09-29",
    "contributors": [
      "Zachary Szewczyk"
    ]
  }
]