[
    {
        "information_requirement": "Has the adversary collected data from network shared drives?",
        "tactic_id": "TA0009",
        "tactic_name": "Collection",
        "indicators": [
            {
                "technique_id": "T1039",
                "name": "Data from Network Shared Drive",
                "evidence": [
                    {
                        "description": "Execution of known malicious scripts or tools on an endpoint that perform data collection from network shares, identified by file hash or name.",
                        "data_sources": [
                            "Windows Event ID 4688"
                        ],
                        "data_platforms": [
                            "Endpoints",
                            "Servers"
                        ],
                        "nai": "Insert site-specific NAI here",
                        "action": "Monitor process creation events (Windows Event ID 4688, ideally enriched with file hash information from sources like Sysmon). Correlate process hashes and names against a threat intelligence feed of known malicious tools and scripts used for data collection. If a match is found, immediately correlate the activity (by Process ID and host) with concurrent network share access logs (Windows Event ID 5140, 4663; Zeek smb.log) to confirm collection activity."
                    },
                    {
                        "description": "Execution of commands, scripts (PowerShell, WMI), or common utilities (`xcopy`, `robocopy`) using syntax patterns strongly indicative of bulk data collection from network shared drives.",
                        "data_sources": [
                            "Windows Event ID 4688",
                            "Windows Event ID 4104"
                        ],
                        "data_platforms": [
                            "Endpoints",
                            "Servers"
                        ],
                        "nai": "Insert site-specific NAI here",
                        "action": "Create and apply regular expressions to process command lines (Windows Event ID 4688) and PowerShell script blocks (Windows Event ID 4104) to detect patterns such as: recursive copying from UNC paths (`xcopy \\\\server\\share /s /e`), use of wildcards to gather specific file types from shares (`*.docx`, `*.pdf`), or PowerShell cmdlets like `Get-ChildItem -Recurse -Path \\\\server\\share | Copy-Item`. Alert on command patterns that are uncommon for legitimate administrative activity or originate from non-administrative users."
                    },
                    {
                        "description": "Anomalous volume or frequency of file access from a single user or host to one or more network shares, deviating significantly from established baselines.",
                        "data_sources": [
                            "Windows Event ID 4663",
                            "Zeek smb.log"
                        ],
                        "data_platforms": [
                            "Servers",
                            "Endpoints",
                            "Network devices"
                        ],
                        "nai": "Insert site-specific NAI here",
                        "action": "For each user and host, establish a baseline of data access volume (bytes transferred) and file access frequency (files read per hour) for network shares using historical Zeek smb.log and Windows Event ID 4663 data. Use statistical methods like Z-scores or Inter-Quartile Range (IQR) to detect significant spikes in activity that fall outside the normal range (e.g., > 3 standard deviations from the mean). A box-plot of daily access volume per user can help visualize and identify outlier days for investigation."
                    },
                    {
                        "description": "A user or host accessing an unusually high number of distinct network shares or sensitive file types that are inconsistent with their normal role-based activity.",
                        "data_sources": [
                            "Windows Event ID 5140",
                            "Windows Event ID 4663",
                            "Zeek smb.log"
                        ],
                        "data_platforms": [
                            "Servers",
                            "Endpoints",
                            "Network devices"
                        ],
                        "nai": "Insert site-specific NAI here",
                        "action": "Profile normal user and host activity to create a baseline of which shares and file types they typically access. Monitor for access to new shares or a sudden increase in the breadth of shares accessed by a single entity. Calculate the entropy of share names or file extensions accessed by a user within a time window; a sharp increase in entropy indicates anomalous discovery and collection behavior. Correlate access events (Windows Event ID 4663, Zeek smb.log) with a data classification map to flag any access to sensitive shares or files by non-authorized users."
                    },
                    {
                        "description": "Observation of a 'fan-in' data transfer pattern, where a single host reads files from multiple disparate network shares and writes them to a single local directory or another centralized network location.",
                        "data_sources": [
                            "Windows Event ID 4663",
                            "Zeek smb.log"
                        ],
                        "data_platforms": [
                            "Endpoints",
                            "Servers",
                            "Network devices"
                        ],
                        "nai": "Insert site-specific NAI here",
                        "action": "Correlate file read events from network shares (identified in Zeek smb.log or from Windows Event ID 4663 where Object Name contains a UNC path) with file write events (identified in Windows Event ID 4663 where 'Accesses' contains 'WriteData') on a single host. Use correlation analysis based on the source host and a short time window (e.g., 1 hour) to identify hosts that read from many unique UNC paths and write to a single local path. This pattern is a strong behavioral indicator of data staging for subsequent exfiltration."
                    }
                ]
            }
        ],
        "version": "2.1",
        "date_created": "2025-05-04",
        "last_updated": "2025-07-20",
        "contributors": [
            "Zachary Szewczyk"
        ]
    }
]
